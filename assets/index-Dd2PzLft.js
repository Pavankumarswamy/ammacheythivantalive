var q3=e=>{throw TypeError(e)};var ZC=(e,i,s)=>i.has(e)||q3("Cannot "+s);var Ms=(e,i,s)=>(ZC(e,i,"read from private field"),s?s.call(e):i.get(e)),zu=(e,i,s)=>i.has(e)?q3("Cannot add the same private member more than once"):i instanceof WeakSet?i.add(e):i.set(e,s),eu=(e,i,s,a)=>(ZC(e,i,"write to private field"),a?a.call(e,s):i.set(e,s),s),Jp=(e,i,s)=>(ZC(e,i,"access private method"),s);var t2=(e,i,s,a)=>({set _(_){eu(e,i,_,s)},get _(){return Ms(e,i,a)}});function _mergeNamespaces(e,i){for(var s=0;s<i.length;s++){const a=i[s];if(typeof a!="string"&&!Array.isArray(a)){for(const _ in a)if(_!=="default"&&!(_ in e)){const $=Object.getOwnPropertyDescriptor(a,_);$&&Object.defineProperty(e,_,$.get?$:{enumerable:!0,get:()=>a[_]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const _ of document.querySelectorAll('link[rel="modulepreload"]'))a(_);new MutationObserver(_=>{for(const $ of _)if($.type==="childList")for(const rt of $.addedNodes)rt.tagName==="LINK"&&rt.rel==="modulepreload"&&a(rt)}).observe(document,{childList:!0,subtree:!0});function s(_){const $={};return _.integrity&&($.integrity=_.integrity),_.referrerPolicy&&($.referrerPolicy=_.referrerPolicy),_.crossOrigin==="use-credentials"?$.credentials="include":_.crossOrigin==="anonymous"?$.credentials="omit":$.credentials="same-origin",$}function a(_){if(_.ep)return;_.ep=!0;const $=s(_);fetch(_.href,$)}})();var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var jsxRuntime={exports:{}},reactJsxRuntime_production_min={},react={exports:{}},react_production_min={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var l$1=Symbol.for("react.element"),n$1=Symbol.for("react.portal"),p$2=Symbol.for("react.fragment"),q$1=Symbol.for("react.strict_mode"),r$1=Symbol.for("react.profiler"),t=Symbol.for("react.provider"),u=Symbol.for("react.context"),v$4=Symbol.for("react.forward_ref"),w$2=Symbol.for("react.suspense"),x=Symbol.for("react.memo"),y=Symbol.for("react.lazy"),z$1=Symbol.iterator;function A$1(e){return e===null||typeof e!="object"?null:(e=z$1&&e[z$1]||e["@@iterator"],typeof e=="function"?e:null)}var B$1={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},C$1=Object.assign,D$2={};function E$2(e,i,s){this.props=e,this.context=i,this.refs=D$2,this.updater=s||B$1}E$2.prototype.isReactComponent={};E$2.prototype.setState=function(e,i){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,i,"setState")};E$2.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function F(){}F.prototype=E$2.prototype;function G$1(e,i,s){this.props=e,this.context=i,this.refs=D$2,this.updater=s||B$1}var H$1=G$1.prototype=new F;H$1.constructor=G$1;C$1(H$1,E$2.prototype);H$1.isPureReactComponent=!0;var I$1=Array.isArray,J=Object.prototype.hasOwnProperty,K$1={current:null},L$2={key:!0,ref:!0,__self:!0,__source:!0};function M$2(e,i,s){var a,_={},$=null,rt=null;if(i!=null)for(a in i.ref!==void 0&&(rt=i.ref),i.key!==void 0&&($=""+i.key),i)J.call(i,a)&&!L$2.hasOwnProperty(a)&&(_[a]=i[a]);var c=arguments.length-2;if(c===1)_.children=s;else if(1<c){for(var dt=Array(c),ht=0;ht<c;ht++)dt[ht]=arguments[ht+2];_.children=dt}if(e&&e.defaultProps)for(a in c=e.defaultProps,c)_[a]===void 0&&(_[a]=c[a]);return{$$typeof:l$1,type:e,key:$,ref:rt,props:_,_owner:K$1.current}}function N$1(e,i){return{$$typeof:l$1,type:e.type,key:i,ref:e.ref,props:e.props,_owner:e._owner}}function O$1(e){return typeof e=="object"&&e!==null&&e.$$typeof===l$1}function escape(e){var i={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(s){return i[s]})}var P$2=/\/+/g;function Q$1(e,i){return typeof e=="object"&&e!==null&&e.key!=null?escape(""+e.key):i.toString(36)}function R$1(e,i,s,a,_){var $=typeof e;($==="undefined"||$==="boolean")&&(e=null);var rt=!1;if(e===null)rt=!0;else switch($){case"string":case"number":rt=!0;break;case"object":switch(e.$$typeof){case l$1:case n$1:rt=!0}}if(rt)return rt=e,_=_(rt),e=a===""?"."+Q$1(rt,0):a,I$1(_)?(s="",e!=null&&(s=e.replace(P$2,"$&/")+"/"),R$1(_,i,s,"",function(ht){return ht})):_!=null&&(O$1(_)&&(_=N$1(_,s+(!_.key||rt&&rt.key===_.key?"":(""+_.key).replace(P$2,"$&/")+"/")+e)),i.push(_)),1;if(rt=0,a=a===""?".":a+":",I$1(e))for(var c=0;c<e.length;c++){$=e[c];var dt=a+Q$1($,c);rt+=R$1($,i,s,dt,_)}else if(dt=A$1(e),typeof dt=="function")for(e=dt.call(e),c=0;!($=e.next()).done;)$=$.value,dt=a+Q$1($,c++),rt+=R$1($,i,s,dt,_);else if($==="object")throw i=String(e),Error("Objects are not valid as a React child (found: "+(i==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":i)+"). If you meant to render a collection of children, use an array instead.");return rt}function S$1(e,i,s){if(e==null)return e;var a=[],_=0;return R$1(e,a,"","",function($){return i.call(s,$,_++)}),a}function T$1(e){if(e._status===-1){var i=e._result;i=i(),i.then(function(s){(e._status===0||e._status===-1)&&(e._status=1,e._result=s)},function(s){(e._status===0||e._status===-1)&&(e._status=2,e._result=s)}),e._status===-1&&(e._status=0,e._result=i)}if(e._status===1)return e._result.default;throw e._result}var U$1={current:null},V$1={transition:null},W$1={ReactCurrentDispatcher:U$1,ReactCurrentBatchConfig:V$1,ReactCurrentOwner:K$1};function X$2(){throw Error("act(...) is not supported in production builds of React.")}react_production_min.Children={map:S$1,forEach:function(e,i,s){S$1(e,function(){i.apply(this,arguments)},s)},count:function(e){var i=0;return S$1(e,function(){i++}),i},toArray:function(e){return S$1(e,function(i){return i})||[]},only:function(e){if(!O$1(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};react_production_min.Component=E$2;react_production_min.Fragment=p$2;react_production_min.Profiler=r$1;react_production_min.PureComponent=G$1;react_production_min.StrictMode=q$1;react_production_min.Suspense=w$2;react_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=W$1;react_production_min.act=X$2;react_production_min.cloneElement=function(e,i,s){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var a=C$1({},e.props),_=e.key,$=e.ref,rt=e._owner;if(i!=null){if(i.ref!==void 0&&($=i.ref,rt=K$1.current),i.key!==void 0&&(_=""+i.key),e.type&&e.type.defaultProps)var c=e.type.defaultProps;for(dt in i)J.call(i,dt)&&!L$2.hasOwnProperty(dt)&&(a[dt]=i[dt]===void 0&&c!==void 0?c[dt]:i[dt])}var dt=arguments.length-2;if(dt===1)a.children=s;else if(1<dt){c=Array(dt);for(var ht=0;ht<dt;ht++)c[ht]=arguments[ht+2];a.children=c}return{$$typeof:l$1,type:e.type,key:_,ref:$,props:a,_owner:rt}};react_production_min.createContext=function(e){return e={$$typeof:u,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:t,_context:e},e.Consumer=e};react_production_min.createElement=M$2;react_production_min.createFactory=function(e){var i=M$2.bind(null,e);return i.type=e,i};react_production_min.createRef=function(){return{current:null}};react_production_min.forwardRef=function(e){return{$$typeof:v$4,render:e}};react_production_min.isValidElement=O$1;react_production_min.lazy=function(e){return{$$typeof:y,_payload:{_status:-1,_result:e},_init:T$1}};react_production_min.memo=function(e,i){return{$$typeof:x,type:e,compare:i===void 0?null:i}};react_production_min.startTransition=function(e){var i=V$1.transition;V$1.transition={};try{e()}finally{V$1.transition=i}};react_production_min.unstable_act=X$2;react_production_min.useCallback=function(e,i){return U$1.current.useCallback(e,i)};react_production_min.useContext=function(e){return U$1.current.useContext(e)};react_production_min.useDebugValue=function(){};react_production_min.useDeferredValue=function(e){return U$1.current.useDeferredValue(e)};react_production_min.useEffect=function(e,i){return U$1.current.useEffect(e,i)};react_production_min.useId=function(){return U$1.current.useId()};react_production_min.useImperativeHandle=function(e,i,s){return U$1.current.useImperativeHandle(e,i,s)};react_production_min.useInsertionEffect=function(e,i){return U$1.current.useInsertionEffect(e,i)};react_production_min.useLayoutEffect=function(e,i){return U$1.current.useLayoutEffect(e,i)};react_production_min.useMemo=function(e,i){return U$1.current.useMemo(e,i)};react_production_min.useReducer=function(e,i,s){return U$1.current.useReducer(e,i,s)};react_production_min.useRef=function(e){return U$1.current.useRef(e)};react_production_min.useState=function(e){return U$1.current.useState(e)};react_production_min.useSyncExternalStore=function(e,i,s){return U$1.current.useSyncExternalStore(e,i,s)};react_production_min.useTransition=function(){return U$1.current.useTransition()};react_production_min.version="18.3.1";react.exports=react_production_min;var reactExports=react.exports;const React=getDefaultExportFromCjs(reactExports),React$1=_mergeNamespaces({__proto__:null,default:React},[reactExports]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var f=reactExports,k=Symbol.for("react.element"),l=Symbol.for("react.fragment"),m$1=Object.prototype.hasOwnProperty,n=f.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,p$1={key:!0,ref:!0,__self:!0,__source:!0};function q(e,i,s){var a,_={},$=null,rt=null;s!==void 0&&($=""+s),i.key!==void 0&&($=""+i.key),i.ref!==void 0&&(rt=i.ref);for(a in i)m$1.call(i,a)&&!p$1.hasOwnProperty(a)&&(_[a]=i[a]);if(e&&e.defaultProps)for(a in i=e.defaultProps,i)_[a]===void 0&&(_[a]=i[a]);return{$$typeof:k,type:e,key:$,ref:rt,props:_,_owner:n.current}}reactJsxRuntime_production_min.Fragment=l;reactJsxRuntime_production_min.jsx=q;reactJsxRuntime_production_min.jsxs=q;jsxRuntime.exports=reactJsxRuntime_production_min;var jsxRuntimeExports=jsxRuntime.exports,reactDom={exports:{}},reactDom_production_min={},scheduler={exports:{}},scheduler_production_min={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function i(dr,gr){var qr=dr.length;dr.push(gr);e:for(;0<qr;){var Lr=qr-1>>>1,_n=dr[Lr];if(0<_(_n,gr))dr[Lr]=gr,dr[qr]=_n,qr=Lr;else break e}}function s(dr){return dr.length===0?null:dr[0]}function a(dr){if(dr.length===0)return null;var gr=dr[0],qr=dr.pop();if(qr!==gr){dr[0]=qr;e:for(var Lr=0,_n=dr.length,gn=_n>>>1;Lr<gn;){var Sn=2*(Lr+1)-1,Fs=dr[Sn],rs=Sn+1,ms=dr[rs];if(0>_(Fs,qr))rs<_n&&0>_(ms,Fs)?(dr[Lr]=ms,dr[rs]=qr,Lr=rs):(dr[Lr]=Fs,dr[Sn]=qr,Lr=Sn);else if(rs<_n&&0>_(ms,qr))dr[Lr]=ms,dr[rs]=qr,Lr=rs;else break e}}return gr}function _(dr,gr){var qr=dr.sortIndex-gr.sortIndex;return qr!==0?qr:dr.id-gr.id}if(typeof performance=="object"&&typeof performance.now=="function"){var $=performance;e.unstable_now=function(){return $.now()}}else{var rt=Date,c=rt.now();e.unstable_now=function(){return rt.now()-c}}var dt=[],ht=[],Et=1,St=null,At=3,Pt=!1,Vt=!1,Bt=!1,Zt=typeof setTimeout=="function"?setTimeout:null,zt=typeof clearTimeout=="function"?clearTimeout:null,Ut=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function Nt(dr){for(var gr=s(ht);gr!==null;){if(gr.callback===null)a(ht);else if(gr.startTime<=dr)a(ht),gr.sortIndex=gr.expirationTime,i(dt,gr);else break;gr=s(ht)}}function Gt(dr){if(Bt=!1,Nt(dr),!Vt)if(s(dt)!==null)Vt=!0,Cr(er);else{var gr=s(ht);gr!==null&&Sr(Gt,gr.startTime-dr)}}function er(dr,gr){Vt=!1,Bt&&(Bt=!1,zt(mr),mr=-1),Pt=!0;var qr=At;try{for(Nt(gr),St=s(dt);St!==null&&(!(St.expirationTime>gr)||dr&&!un());){var Lr=St.callback;if(typeof Lr=="function"){St.callback=null,At=St.priorityLevel;var _n=Lr(St.expirationTime<=gr);gr=e.unstable_now(),typeof _n=="function"?St.callback=_n:St===s(dt)&&a(dt),Nt(gr)}else a(dt);St=s(dt)}if(St!==null)var gn=!0;else{var Sn=s(ht);Sn!==null&&Sr(Gt,Sn.startTime-gr),gn=!1}return gn}finally{St=null,At=qr,Pt=!1}}var ir=!1,or=null,mr=-1,Rr=5,on=-1;function un(){return!(e.unstable_now()-on<Rr)}function jr(){if(or!==null){var dr=e.unstable_now();on=dr;var gr=!0;try{gr=or(!0,dr)}finally{gr?Jr():(ir=!1,or=null)}}else ir=!1}var Jr;if(typeof Ut=="function")Jr=function(){Ut(jr)};else if(typeof MessageChannel<"u"){var fn=new MessageChannel,Fr=fn.port2;fn.port1.onmessage=jr,Jr=function(){Fr.postMessage(null)}}else Jr=function(){Zt(jr,0)};function Cr(dr){or=dr,ir||(ir=!0,Jr())}function Sr(dr,gr){mr=Zt(function(){dr(e.unstable_now())},gr)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(dr){dr.callback=null},e.unstable_continueExecution=function(){Vt||Pt||(Vt=!0,Cr(er))},e.unstable_forceFrameRate=function(dr){0>dr||125<dr?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Rr=0<dr?Math.floor(1e3/dr):5},e.unstable_getCurrentPriorityLevel=function(){return At},e.unstable_getFirstCallbackNode=function(){return s(dt)},e.unstable_next=function(dr){switch(At){case 1:case 2:case 3:var gr=3;break;default:gr=At}var qr=At;At=gr;try{return dr()}finally{At=qr}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(dr,gr){switch(dr){case 1:case 2:case 3:case 4:case 5:break;default:dr=3}var qr=At;At=dr;try{return gr()}finally{At=qr}},e.unstable_scheduleCallback=function(dr,gr,qr){var Lr=e.unstable_now();switch(typeof qr=="object"&&qr!==null?(qr=qr.delay,qr=typeof qr=="number"&&0<qr?Lr+qr:Lr):qr=Lr,dr){case 1:var _n=-1;break;case 2:_n=250;break;case 5:_n=1073741823;break;case 4:_n=1e4;break;default:_n=5e3}return _n=qr+_n,dr={id:Et++,callback:gr,priorityLevel:dr,startTime:qr,expirationTime:_n,sortIndex:-1},qr>Lr?(dr.sortIndex=qr,i(ht,dr),s(dt)===null&&dr===s(ht)&&(Bt?(zt(mr),mr=-1):Bt=!0,Sr(Gt,qr-Lr))):(dr.sortIndex=_n,i(dt,dr),Vt||Pt||(Vt=!0,Cr(er))),dr},e.unstable_shouldYield=un,e.unstable_wrapCallback=function(dr){var gr=At;return function(){var qr=At;At=gr;try{return dr.apply(this,arguments)}finally{At=qr}}}})(scheduler_production_min);scheduler.exports=scheduler_production_min;var schedulerExports=scheduler.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var aa=reactExports,ca=schedulerExports;function p(e){for(var i="https://reactjs.org/docs/error-decoder.html?invariant="+e,s=1;s<arguments.length;s++)i+="&args[]="+encodeURIComponent(arguments[s]);return"Minified React error #"+e+"; visit "+i+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var da=new Set,ea={};function fa(e,i){ha(e,i),ha(e+"Capture",i)}function ha(e,i){for(ea[e]=i,e=0;e<i.length;e++)da.add(i[e])}var ia=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ja=Object.prototype.hasOwnProperty,ka=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,la={},ma={};function oa(e){return ja.call(ma,e)?!0:ja.call(la,e)?!1:ka.test(e)?ma[e]=!0:(la[e]=!0,!1)}function pa(e,i,s,a){if(s!==null&&s.type===0)return!1;switch(typeof i){case"function":case"symbol":return!0;case"boolean":return a?!1:s!==null?!s.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function qa(e,i,s,a){if(i===null||typeof i>"u"||pa(e,i,s,a))return!0;if(a)return!1;if(s!==null)switch(s.type){case 3:return!i;case 4:return i===!1;case 5:return isNaN(i);case 6:return isNaN(i)||1>i}return!1}function v$3(e,i,s,a,_,$,rt){this.acceptsBooleans=i===2||i===3||i===4,this.attributeName=a,this.attributeNamespace=_,this.mustUseProperty=s,this.propertyName=e,this.type=i,this.sanitizeURL=$,this.removeEmptyString=rt}var z={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){z[e]=new v$3(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var i=e[0];z[i]=new v$3(i,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){z[e]=new v$3(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){z[e]=new v$3(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){z[e]=new v$3(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){z[e]=new v$3(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){z[e]=new v$3(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){z[e]=new v$3(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){z[e]=new v$3(e,5,!1,e.toLowerCase(),null,!1,!1)});var ra=/[\-:]([a-z])/g;function sa(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var i=e.replace(ra,sa);z[i]=new v$3(i,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var i=e.replace(ra,sa);z[i]=new v$3(i,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var i=e.replace(ra,sa);z[i]=new v$3(i,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){z[e]=new v$3(e,1,!1,e.toLowerCase(),null,!1,!1)});z.xlinkHref=new v$3("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){z[e]=new v$3(e,1,!1,e.toLowerCase(),null,!0,!0)});function ta(e,i,s,a){var _=z.hasOwnProperty(i)?z[i]:null;(_!==null?_.type!==0:a||!(2<i.length)||i[0]!=="o"&&i[0]!=="O"||i[1]!=="n"&&i[1]!=="N")&&(qa(i,s,_,a)&&(s=null),a||_===null?oa(i)&&(s===null?e.removeAttribute(i):e.setAttribute(i,""+s)):_.mustUseProperty?e[_.propertyName]=s===null?_.type===3?!1:"":s:(i=_.attributeName,a=_.attributeNamespace,s===null?e.removeAttribute(i):(_=_.type,s=_===3||_===4&&s===!0?"":""+s,a?e.setAttributeNS(a,i,s):e.setAttribute(i,s))))}var ua=aa.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,va=Symbol.for("react.element"),wa=Symbol.for("react.portal"),ya=Symbol.for("react.fragment"),za=Symbol.for("react.strict_mode"),Aa=Symbol.for("react.profiler"),Ba=Symbol.for("react.provider"),Ca=Symbol.for("react.context"),Da=Symbol.for("react.forward_ref"),Ea=Symbol.for("react.suspense"),Fa=Symbol.for("react.suspense_list"),Ga=Symbol.for("react.memo"),Ha=Symbol.for("react.lazy"),Ia=Symbol.for("react.offscreen"),Ja=Symbol.iterator;function Ka(e){return e===null||typeof e!="object"?null:(e=Ja&&e[Ja]||e["@@iterator"],typeof e=="function"?e:null)}var A=Object.assign,La;function Ma(e){if(La===void 0)try{throw Error()}catch(s){var i=s.stack.trim().match(/\n( *(at )?)/);La=i&&i[1]||""}return`
`+La+e}var Na=!1;function Oa(e,i){if(!e||Na)return"";Na=!0;var s=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(i)if(i=function(){throw Error()},Object.defineProperty(i.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(i,[])}catch(ht){var a=ht}Reflect.construct(e,[],i)}else{try{i.call()}catch(ht){a=ht}e.call(i.prototype)}else{try{throw Error()}catch(ht){a=ht}e()}}catch(ht){if(ht&&a&&typeof ht.stack=="string"){for(var _=ht.stack.split(`
`),$=a.stack.split(`
`),rt=_.length-1,c=$.length-1;1<=rt&&0<=c&&_[rt]!==$[c];)c--;for(;1<=rt&&0<=c;rt--,c--)if(_[rt]!==$[c]){if(rt!==1||c!==1)do if(rt--,c--,0>c||_[rt]!==$[c]){var dt=`
`+_[rt].replace(" at new "," at ");return e.displayName&&dt.includes("<anonymous>")&&(dt=dt.replace("<anonymous>",e.displayName)),dt}while(1<=rt&&0<=c);break}}}finally{Na=!1,Error.prepareStackTrace=s}return(e=e?e.displayName||e.name:"")?Ma(e):""}function Pa(e){switch(e.tag){case 5:return Ma(e.type);case 16:return Ma("Lazy");case 13:return Ma("Suspense");case 19:return Ma("SuspenseList");case 0:case 2:case 15:return e=Oa(e.type,!1),e;case 11:return e=Oa(e.type.render,!1),e;case 1:return e=Oa(e.type,!0),e;default:return""}}function Qa(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case ya:return"Fragment";case wa:return"Portal";case Aa:return"Profiler";case za:return"StrictMode";case Ea:return"Suspense";case Fa:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case Ca:return(e.displayName||"Context")+".Consumer";case Ba:return(e._context.displayName||"Context")+".Provider";case Da:var i=e.render;return e=e.displayName,e||(e=i.displayName||i.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case Ga:return i=e.displayName||null,i!==null?i:Qa(e.type)||"Memo";case Ha:i=e._payload,e=e._init;try{return Qa(e(i))}catch{}}return null}function Ra(e){var i=e.type;switch(e.tag){case 24:return"Cache";case 9:return(i.displayName||"Context")+".Consumer";case 10:return(i._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=i.render,e=e.displayName||e.name||"",i.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return i;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Qa(i);case 8:return i===za?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof i=="function")return i.displayName||i.name||null;if(typeof i=="string")return i}return null}function Sa(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function Ta(e){var i=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(i==="checkbox"||i==="radio")}function Ua(e){var i=Ta(e)?"checked":"value",s=Object.getOwnPropertyDescriptor(e.constructor.prototype,i),a=""+e[i];if(!e.hasOwnProperty(i)&&typeof s<"u"&&typeof s.get=="function"&&typeof s.set=="function"){var _=s.get,$=s.set;return Object.defineProperty(e,i,{configurable:!0,get:function(){return _.call(this)},set:function(rt){a=""+rt,$.call(this,rt)}}),Object.defineProperty(e,i,{enumerable:s.enumerable}),{getValue:function(){return a},setValue:function(rt){a=""+rt},stopTracking:function(){e._valueTracker=null,delete e[i]}}}}function Va(e){e._valueTracker||(e._valueTracker=Ua(e))}function Wa(e){if(!e)return!1;var i=e._valueTracker;if(!i)return!0;var s=i.getValue(),a="";return e&&(a=Ta(e)?e.checked?"true":"false":e.value),e=a,e!==s?(i.setValue(e),!0):!1}function Xa(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function Ya(e,i){var s=i.checked;return A({},i,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:s??e._wrapperState.initialChecked})}function Za(e,i){var s=i.defaultValue==null?"":i.defaultValue,a=i.checked!=null?i.checked:i.defaultChecked;s=Sa(i.value!=null?i.value:s),e._wrapperState={initialChecked:a,initialValue:s,controlled:i.type==="checkbox"||i.type==="radio"?i.checked!=null:i.value!=null}}function ab(e,i){i=i.checked,i!=null&&ta(e,"checked",i,!1)}function bb(e,i){ab(e,i);var s=Sa(i.value),a=i.type;if(s!=null)a==="number"?(s===0&&e.value===""||e.value!=s)&&(e.value=""+s):e.value!==""+s&&(e.value=""+s);else if(a==="submit"||a==="reset"){e.removeAttribute("value");return}i.hasOwnProperty("value")?cb(e,i.type,s):i.hasOwnProperty("defaultValue")&&cb(e,i.type,Sa(i.defaultValue)),i.checked==null&&i.defaultChecked!=null&&(e.defaultChecked=!!i.defaultChecked)}function db(e,i,s){if(i.hasOwnProperty("value")||i.hasOwnProperty("defaultValue")){var a=i.type;if(!(a!=="submit"&&a!=="reset"||i.value!==void 0&&i.value!==null))return;i=""+e._wrapperState.initialValue,s||i===e.value||(e.value=i),e.defaultValue=i}s=e.name,s!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,s!==""&&(e.name=s)}function cb(e,i,s){(i!=="number"||Xa(e.ownerDocument)!==e)&&(s==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+s&&(e.defaultValue=""+s))}var eb=Array.isArray;function fb(e,i,s,a){if(e=e.options,i){i={};for(var _=0;_<s.length;_++)i["$"+s[_]]=!0;for(s=0;s<e.length;s++)_=i.hasOwnProperty("$"+e[s].value),e[s].selected!==_&&(e[s].selected=_),_&&a&&(e[s].defaultSelected=!0)}else{for(s=""+Sa(s),i=null,_=0;_<e.length;_++){if(e[_].value===s){e[_].selected=!0,a&&(e[_].defaultSelected=!0);return}i!==null||e[_].disabled||(i=e[_])}i!==null&&(i.selected=!0)}}function gb(e,i){if(i.dangerouslySetInnerHTML!=null)throw Error(p(91));return A({},i,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function hb(e,i){var s=i.value;if(s==null){if(s=i.children,i=i.defaultValue,s!=null){if(i!=null)throw Error(p(92));if(eb(s)){if(1<s.length)throw Error(p(93));s=s[0]}i=s}i==null&&(i=""),s=i}e._wrapperState={initialValue:Sa(s)}}function ib(e,i){var s=Sa(i.value),a=Sa(i.defaultValue);s!=null&&(s=""+s,s!==e.value&&(e.value=s),i.defaultValue==null&&e.defaultValue!==s&&(e.defaultValue=s)),a!=null&&(e.defaultValue=""+a)}function jb(e){var i=e.textContent;i===e._wrapperState.initialValue&&i!==""&&i!==null&&(e.value=i)}function kb(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function lb(e,i){return e==null||e==="http://www.w3.org/1999/xhtml"?kb(i):e==="http://www.w3.org/2000/svg"&&i==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var mb,nb=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(i,s,a,_){MSApp.execUnsafeLocalFunction(function(){return e(i,s,a,_)})}:e}(function(e,i){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=i;else{for(mb=mb||document.createElement("div"),mb.innerHTML="<svg>"+i.valueOf().toString()+"</svg>",i=mb.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;i.firstChild;)e.appendChild(i.firstChild)}});function ob(e,i){if(i){var s=e.firstChild;if(s&&s===e.lastChild&&s.nodeType===3){s.nodeValue=i;return}}e.textContent=i}var pb={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},qb=["Webkit","ms","Moz","O"];Object.keys(pb).forEach(function(e){qb.forEach(function(i){i=i+e.charAt(0).toUpperCase()+e.substring(1),pb[i]=pb[e]})});function rb(e,i,s){return i==null||typeof i=="boolean"||i===""?"":s||typeof i!="number"||i===0||pb.hasOwnProperty(e)&&pb[e]?(""+i).trim():i+"px"}function sb(e,i){e=e.style;for(var s in i)if(i.hasOwnProperty(s)){var a=s.indexOf("--")===0,_=rb(s,i[s],a);s==="float"&&(s="cssFloat"),a?e.setProperty(s,_):e[s]=_}}var tb=A({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ub(e,i){if(i){if(tb[e]&&(i.children!=null||i.dangerouslySetInnerHTML!=null))throw Error(p(137,e));if(i.dangerouslySetInnerHTML!=null){if(i.children!=null)throw Error(p(60));if(typeof i.dangerouslySetInnerHTML!="object"||!("__html"in i.dangerouslySetInnerHTML))throw Error(p(61))}if(i.style!=null&&typeof i.style!="object")throw Error(p(62))}}function vb(e,i){if(e.indexOf("-")===-1)return typeof i.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var wb=null;function xb(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var yb=null,zb=null,Ab=null;function Bb(e){if(e=Cb(e)){if(typeof yb!="function")throw Error(p(280));var i=e.stateNode;i&&(i=Db(i),yb(e.stateNode,e.type,i))}}function Eb(e){zb?Ab?Ab.push(e):Ab=[e]:zb=e}function Fb(){if(zb){var e=zb,i=Ab;if(Ab=zb=null,Bb(e),i)for(e=0;e<i.length;e++)Bb(i[e])}}function Gb(e,i){return e(i)}function Hb(){}var Ib=!1;function Jb(e,i,s){if(Ib)return e(i,s);Ib=!0;try{return Gb(e,i,s)}finally{Ib=!1,(zb!==null||Ab!==null)&&(Hb(),Fb())}}function Kb(e,i){var s=e.stateNode;if(s===null)return null;var a=Db(s);if(a===null)return null;s=a[i];e:switch(i){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(a=!a.disabled)||(e=e.type,a=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!a;break e;default:e=!1}if(e)return null;if(s&&typeof s!="function")throw Error(p(231,i,typeof s));return s}var Lb=!1;if(ia)try{var Mb={};Object.defineProperty(Mb,"passive",{get:function(){Lb=!0}}),window.addEventListener("test",Mb,Mb),window.removeEventListener("test",Mb,Mb)}catch{Lb=!1}function Nb(e,i,s,a,_,$,rt,c,dt){var ht=Array.prototype.slice.call(arguments,3);try{i.apply(s,ht)}catch(Et){this.onError(Et)}}var Ob=!1,Pb=null,Qb=!1,Rb=null,Sb={onError:function(e){Ob=!0,Pb=e}};function Tb(e,i,s,a,_,$,rt,c,dt){Ob=!1,Pb=null,Nb.apply(Sb,arguments)}function Ub(e,i,s,a,_,$,rt,c,dt){if(Tb.apply(this,arguments),Ob){if(Ob){var ht=Pb;Ob=!1,Pb=null}else throw Error(p(198));Qb||(Qb=!0,Rb=ht)}}function Vb(e){var i=e,s=e;if(e.alternate)for(;i.return;)i=i.return;else{e=i;do i=e,i.flags&4098&&(s=i.return),e=i.return;while(e)}return i.tag===3?s:null}function Wb(e){if(e.tag===13){var i=e.memoizedState;if(i===null&&(e=e.alternate,e!==null&&(i=e.memoizedState)),i!==null)return i.dehydrated}return null}function Xb(e){if(Vb(e)!==e)throw Error(p(188))}function Yb(e){var i=e.alternate;if(!i){if(i=Vb(e),i===null)throw Error(p(188));return i!==e?null:e}for(var s=e,a=i;;){var _=s.return;if(_===null)break;var $=_.alternate;if($===null){if(a=_.return,a!==null){s=a;continue}break}if(_.child===$.child){for($=_.child;$;){if($===s)return Xb(_),e;if($===a)return Xb(_),i;$=$.sibling}throw Error(p(188))}if(s.return!==a.return)s=_,a=$;else{for(var rt=!1,c=_.child;c;){if(c===s){rt=!0,s=_,a=$;break}if(c===a){rt=!0,a=_,s=$;break}c=c.sibling}if(!rt){for(c=$.child;c;){if(c===s){rt=!0,s=$,a=_;break}if(c===a){rt=!0,a=$,s=_;break}c=c.sibling}if(!rt)throw Error(p(189))}}if(s.alternate!==a)throw Error(p(190))}if(s.tag!==3)throw Error(p(188));return s.stateNode.current===s?e:i}function Zb(e){return e=Yb(e),e!==null?$b(e):null}function $b(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var i=$b(e);if(i!==null)return i;e=e.sibling}return null}var ac=ca.unstable_scheduleCallback,bc=ca.unstable_cancelCallback,cc=ca.unstable_shouldYield,dc=ca.unstable_requestPaint,B=ca.unstable_now,ec=ca.unstable_getCurrentPriorityLevel,fc=ca.unstable_ImmediatePriority,gc=ca.unstable_UserBlockingPriority,hc=ca.unstable_NormalPriority,ic=ca.unstable_LowPriority,jc=ca.unstable_IdlePriority,kc=null,lc=null;function mc(e){if(lc&&typeof lc.onCommitFiberRoot=="function")try{lc.onCommitFiberRoot(kc,e,void 0,(e.current.flags&128)===128)}catch{}}var oc=Math.clz32?Math.clz32:nc,pc=Math.log,qc=Math.LN2;function nc(e){return e>>>=0,e===0?32:31-(pc(e)/qc|0)|0}var rc=64,sc=4194304;function tc(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function uc(e,i){var s=e.pendingLanes;if(s===0)return 0;var a=0,_=e.suspendedLanes,$=e.pingedLanes,rt=s&268435455;if(rt!==0){var c=rt&~_;c!==0?a=tc(c):($&=rt,$!==0&&(a=tc($)))}else rt=s&~_,rt!==0?a=tc(rt):$!==0&&(a=tc($));if(a===0)return 0;if(i!==0&&i!==a&&!(i&_)&&(_=a&-a,$=i&-i,_>=$||_===16&&($&4194240)!==0))return i;if(a&4&&(a|=s&16),i=e.entangledLanes,i!==0)for(e=e.entanglements,i&=a;0<i;)s=31-oc(i),_=1<<s,a|=e[s],i&=~_;return a}function vc(e,i){switch(e){case 1:case 2:case 4:return i+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function wc(e,i){for(var s=e.suspendedLanes,a=e.pingedLanes,_=e.expirationTimes,$=e.pendingLanes;0<$;){var rt=31-oc($),c=1<<rt,dt=_[rt];dt===-1?(!(c&s)||c&a)&&(_[rt]=vc(c,i)):dt<=i&&(e.expiredLanes|=c),$&=~c}}function xc(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function yc(){var e=rc;return rc<<=1,!(rc&4194240)&&(rc=64),e}function zc(e){for(var i=[],s=0;31>s;s++)i.push(e);return i}function Ac(e,i,s){e.pendingLanes|=i,i!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,i=31-oc(i),e[i]=s}function Bc(e,i){var s=e.pendingLanes&~i;e.pendingLanes=i,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=i,e.mutableReadLanes&=i,e.entangledLanes&=i,i=e.entanglements;var a=e.eventTimes;for(e=e.expirationTimes;0<s;){var _=31-oc(s),$=1<<_;i[_]=0,a[_]=-1,e[_]=-1,s&=~$}}function Cc(e,i){var s=e.entangledLanes|=i;for(e=e.entanglements;s;){var a=31-oc(s),_=1<<a;_&i|e[a]&i&&(e[a]|=i),s&=~_}}var C=0;function Dc(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var Ec,Fc,Gc,Hc,Ic,Jc=!1,Kc=[],Lc=null,Mc=null,Nc=null,Oc=new Map,Pc=new Map,Qc=[],Rc="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Sc(e,i){switch(e){case"focusin":case"focusout":Lc=null;break;case"dragenter":case"dragleave":Mc=null;break;case"mouseover":case"mouseout":Nc=null;break;case"pointerover":case"pointerout":Oc.delete(i.pointerId);break;case"gotpointercapture":case"lostpointercapture":Pc.delete(i.pointerId)}}function Tc(e,i,s,a,_,$){return e===null||e.nativeEvent!==$?(e={blockedOn:i,domEventName:s,eventSystemFlags:a,nativeEvent:$,targetContainers:[_]},i!==null&&(i=Cb(i),i!==null&&Fc(i)),e):(e.eventSystemFlags|=a,i=e.targetContainers,_!==null&&i.indexOf(_)===-1&&i.push(_),e)}function Uc(e,i,s,a,_){switch(i){case"focusin":return Lc=Tc(Lc,e,i,s,a,_),!0;case"dragenter":return Mc=Tc(Mc,e,i,s,a,_),!0;case"mouseover":return Nc=Tc(Nc,e,i,s,a,_),!0;case"pointerover":var $=_.pointerId;return Oc.set($,Tc(Oc.get($)||null,e,i,s,a,_)),!0;case"gotpointercapture":return $=_.pointerId,Pc.set($,Tc(Pc.get($)||null,e,i,s,a,_)),!0}return!1}function Vc(e){var i=Wc(e.target);if(i!==null){var s=Vb(i);if(s!==null){if(i=s.tag,i===13){if(i=Wb(s),i!==null){e.blockedOn=i,Ic(e.priority,function(){Gc(s)});return}}else if(i===3&&s.stateNode.current.memoizedState.isDehydrated){e.blockedOn=s.tag===3?s.stateNode.containerInfo:null;return}}}e.blockedOn=null}function Xc(e){if(e.blockedOn!==null)return!1;for(var i=e.targetContainers;0<i.length;){var s=Yc(e.domEventName,e.eventSystemFlags,i[0],e.nativeEvent);if(s===null){s=e.nativeEvent;var a=new s.constructor(s.type,s);wb=a,s.target.dispatchEvent(a),wb=null}else return i=Cb(s),i!==null&&Fc(i),e.blockedOn=s,!1;i.shift()}return!0}function Zc(e,i,s){Xc(e)&&s.delete(i)}function $c(){Jc=!1,Lc!==null&&Xc(Lc)&&(Lc=null),Mc!==null&&Xc(Mc)&&(Mc=null),Nc!==null&&Xc(Nc)&&(Nc=null),Oc.forEach(Zc),Pc.forEach(Zc)}function ad(e,i){e.blockedOn===i&&(e.blockedOn=null,Jc||(Jc=!0,ca.unstable_scheduleCallback(ca.unstable_NormalPriority,$c)))}function bd(e){function i(_){return ad(_,e)}if(0<Kc.length){ad(Kc[0],e);for(var s=1;s<Kc.length;s++){var a=Kc[s];a.blockedOn===e&&(a.blockedOn=null)}}for(Lc!==null&&ad(Lc,e),Mc!==null&&ad(Mc,e),Nc!==null&&ad(Nc,e),Oc.forEach(i),Pc.forEach(i),s=0;s<Qc.length;s++)a=Qc[s],a.blockedOn===e&&(a.blockedOn=null);for(;0<Qc.length&&(s=Qc[0],s.blockedOn===null);)Vc(s),s.blockedOn===null&&Qc.shift()}var cd=ua.ReactCurrentBatchConfig,dd=!0;function ed(e,i,s,a){var _=C,$=cd.transition;cd.transition=null;try{C=1,fd(e,i,s,a)}finally{C=_,cd.transition=$}}function gd(e,i,s,a){var _=C,$=cd.transition;cd.transition=null;try{C=4,fd(e,i,s,a)}finally{C=_,cd.transition=$}}function fd(e,i,s,a){if(dd){var _=Yc(e,i,s,a);if(_===null)hd(e,i,a,id$2,s),Sc(e,a);else if(Uc(_,e,i,s,a))a.stopPropagation();else if(Sc(e,a),i&4&&-1<Rc.indexOf(e)){for(;_!==null;){var $=Cb(_);if($!==null&&Ec($),$=Yc(e,i,s,a),$===null&&hd(e,i,a,id$2,s),$===_)break;_=$}_!==null&&a.stopPropagation()}else hd(e,i,a,null,s)}}var id$2=null;function Yc(e,i,s,a){if(id$2=null,e=xb(a),e=Wc(e),e!==null)if(i=Vb(e),i===null)e=null;else if(s=i.tag,s===13){if(e=Wb(i),e!==null)return e;e=null}else if(s===3){if(i.stateNode.current.memoizedState.isDehydrated)return i.tag===3?i.stateNode.containerInfo:null;e=null}else i!==e&&(e=null);return id$2=e,null}function jd(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(ec()){case fc:return 1;case gc:return 4;case hc:case ic:return 16;case jc:return 536870912;default:return 16}default:return 16}}var kd=null,ld=null,md=null;function nd(){if(md)return md;var e,i=ld,s=i.length,a,_="value"in kd?kd.value:kd.textContent,$=_.length;for(e=0;e<s&&i[e]===_[e];e++);var rt=s-e;for(a=1;a<=rt&&i[s-a]===_[$-a];a++);return md=_.slice(e,1<a?1-a:void 0)}function od(e){var i=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&i===13&&(e=13)):e=i,e===10&&(e=13),32<=e||e===13?e:0}function pd(){return!0}function qd(){return!1}function rd(e){function i(s,a,_,$,rt){this._reactName=s,this._targetInst=_,this.type=a,this.nativeEvent=$,this.target=rt,this.currentTarget=null;for(var c in e)e.hasOwnProperty(c)&&(s=e[c],this[c]=s?s($):$[c]);return this.isDefaultPrevented=($.defaultPrevented!=null?$.defaultPrevented:$.returnValue===!1)?pd:qd,this.isPropagationStopped=qd,this}return A(i.prototype,{preventDefault:function(){this.defaultPrevented=!0;var s=this.nativeEvent;s&&(s.preventDefault?s.preventDefault():typeof s.returnValue!="unknown"&&(s.returnValue=!1),this.isDefaultPrevented=pd)},stopPropagation:function(){var s=this.nativeEvent;s&&(s.stopPropagation?s.stopPropagation():typeof s.cancelBubble!="unknown"&&(s.cancelBubble=!0),this.isPropagationStopped=pd)},persist:function(){},isPersistent:pd}),i}var sd={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},td=rd(sd),ud=A({},sd,{view:0,detail:0}),vd=rd(ud),wd,xd,yd,Ad=A({},ud,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:zd,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==yd&&(yd&&e.type==="mousemove"?(wd=e.screenX-yd.screenX,xd=e.screenY-yd.screenY):xd=wd=0,yd=e),wd)},movementY:function(e){return"movementY"in e?e.movementY:xd}}),Bd=rd(Ad),Cd=A({},Ad,{dataTransfer:0}),Dd=rd(Cd),Ed=A({},ud,{relatedTarget:0}),Fd=rd(Ed),Gd=A({},sd,{animationName:0,elapsedTime:0,pseudoElement:0}),Hd=rd(Gd),Id=A({},sd,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),Jd=rd(Id),Kd=A({},sd,{data:0}),Ld=rd(Kd),Md={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Nd={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Od={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Pd(e){var i=this.nativeEvent;return i.getModifierState?i.getModifierState(e):(e=Od[e])?!!i[e]:!1}function zd(){return Pd}var Qd=A({},ud,{key:function(e){if(e.key){var i=Md[e.key]||e.key;if(i!=="Unidentified")return i}return e.type==="keypress"?(e=od(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?Nd[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:zd,charCode:function(e){return e.type==="keypress"?od(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?od(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),Rd=rd(Qd),Sd=A({},Ad,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Td=rd(Sd),Ud=A({},ud,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:zd}),Vd=rd(Ud),Wd=A({},sd,{propertyName:0,elapsedTime:0,pseudoElement:0}),Xd=rd(Wd),Yd=A({},Ad,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Zd=rd(Yd),$d=[9,13,27,32],ae$1=ia&&"CompositionEvent"in window,be$1=null;ia&&"documentMode"in document&&(be$1=document.documentMode);var ce$1=ia&&"TextEvent"in window&&!be$1,de$1=ia&&(!ae$1||be$1&&8<be$1&&11>=be$1),ee$1=" ",fe=!1;function ge$1(e,i){switch(e){case"keyup":return $d.indexOf(i.keyCode)!==-1;case"keydown":return i.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function he$1(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var ie$1=!1;function je(e,i){switch(e){case"compositionend":return he$1(i);case"keypress":return i.which!==32?null:(fe=!0,ee$1);case"textInput":return e=i.data,e===ee$1&&fe?null:e;default:return null}}function ke(e,i){if(ie$1)return e==="compositionend"||!ae$1&&ge$1(e,i)?(e=nd(),md=ld=kd=null,ie$1=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(i.ctrlKey||i.altKey||i.metaKey)||i.ctrlKey&&i.altKey){if(i.char&&1<i.char.length)return i.char;if(i.which)return String.fromCharCode(i.which)}return null;case"compositionend":return de$1&&i.locale!=="ko"?null:i.data;default:return null}}var le$1={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function me$1(e){var i=e&&e.nodeName&&e.nodeName.toLowerCase();return i==="input"?!!le$1[e.type]:i==="textarea"}function ne$1(e,i,s,a){Eb(a),i=oe$1(i,"onChange"),0<i.length&&(s=new td("onChange","change",null,s,a),e.push({event:s,listeners:i}))}var pe$1=null,qe=null;function re(e){se$1(e,0)}function te$1(e){var i=ue$1(e);if(Wa(i))return e}function ve$1(e,i){if(e==="change")return i}var we$1=!1;if(ia){var xe$1;if(ia){var ye$1="oninput"in document;if(!ye$1){var ze=document.createElement("div");ze.setAttribute("oninput","return;"),ye$1=typeof ze.oninput=="function"}xe$1=ye$1}else xe$1=!1;we$1=xe$1&&(!document.documentMode||9<document.documentMode)}function Ae(){pe$1&&(pe$1.detachEvent("onpropertychange",Be),qe=pe$1=null)}function Be(e){if(e.propertyName==="value"&&te$1(qe)){var i=[];ne$1(i,qe,e,xb(e)),Jb(re,i)}}function Ce(e,i,s){e==="focusin"?(Ae(),pe$1=i,qe=s,pe$1.attachEvent("onpropertychange",Be)):e==="focusout"&&Ae()}function De(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return te$1(qe)}function Ee(e,i){if(e==="click")return te$1(i)}function Fe(e,i){if(e==="input"||e==="change")return te$1(i)}function Ge(e,i){return e===i&&(e!==0||1/e===1/i)||e!==e&&i!==i}var He=typeof Object.is=="function"?Object.is:Ge;function Ie(e,i){if(He(e,i))return!0;if(typeof e!="object"||e===null||typeof i!="object"||i===null)return!1;var s=Object.keys(e),a=Object.keys(i);if(s.length!==a.length)return!1;for(a=0;a<s.length;a++){var _=s[a];if(!ja.call(i,_)||!He(e[_],i[_]))return!1}return!0}function Je(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Ke(e,i){var s=Je(e);e=0;for(var a;s;){if(s.nodeType===3){if(a=e+s.textContent.length,e<=i&&a>=i)return{node:s,offset:i-e};e=a}e:{for(;s;){if(s.nextSibling){s=s.nextSibling;break e}s=s.parentNode}s=void 0}s=Je(s)}}function Le(e,i){return e&&i?e===i?!0:e&&e.nodeType===3?!1:i&&i.nodeType===3?Le(e,i.parentNode):"contains"in e?e.contains(i):e.compareDocumentPosition?!!(e.compareDocumentPosition(i)&16):!1:!1}function Me(){for(var e=window,i=Xa();i instanceof e.HTMLIFrameElement;){try{var s=typeof i.contentWindow.location.href=="string"}catch{s=!1}if(s)e=i.contentWindow;else break;i=Xa(e.document)}return i}function Ne(e){var i=e&&e.nodeName&&e.nodeName.toLowerCase();return i&&(i==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||i==="textarea"||e.contentEditable==="true")}function Oe(e){var i=Me(),s=e.focusedElem,a=e.selectionRange;if(i!==s&&s&&s.ownerDocument&&Le(s.ownerDocument.documentElement,s)){if(a!==null&&Ne(s)){if(i=a.start,e=a.end,e===void 0&&(e=i),"selectionStart"in s)s.selectionStart=i,s.selectionEnd=Math.min(e,s.value.length);else if(e=(i=s.ownerDocument||document)&&i.defaultView||window,e.getSelection){e=e.getSelection();var _=s.textContent.length,$=Math.min(a.start,_);a=a.end===void 0?$:Math.min(a.end,_),!e.extend&&$>a&&(_=a,a=$,$=_),_=Ke(s,$);var rt=Ke(s,a);_&&rt&&(e.rangeCount!==1||e.anchorNode!==_.node||e.anchorOffset!==_.offset||e.focusNode!==rt.node||e.focusOffset!==rt.offset)&&(i=i.createRange(),i.setStart(_.node,_.offset),e.removeAllRanges(),$>a?(e.addRange(i),e.extend(rt.node,rt.offset)):(i.setEnd(rt.node,rt.offset),e.addRange(i)))}}for(i=[],e=s;e=e.parentNode;)e.nodeType===1&&i.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof s.focus=="function"&&s.focus(),s=0;s<i.length;s++)e=i[s],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var Pe=ia&&"documentMode"in document&&11>=document.documentMode,Qe=null,Re=null,Se=null,Te$1=!1;function Ue(e,i,s){var a=s.window===s?s.document:s.nodeType===9?s:s.ownerDocument;Te$1||Qe==null||Qe!==Xa(a)||(a=Qe,"selectionStart"in a&&Ne(a)?a={start:a.selectionStart,end:a.selectionEnd}:(a=(a.ownerDocument&&a.ownerDocument.defaultView||window).getSelection(),a={anchorNode:a.anchorNode,anchorOffset:a.anchorOffset,focusNode:a.focusNode,focusOffset:a.focusOffset}),Se&&Ie(Se,a)||(Se=a,a=oe$1(Re,"onSelect"),0<a.length&&(i=new td("onSelect","select",null,i,s),e.push({event:i,listeners:a}),i.target=Qe)))}function Ve(e,i){var s={};return s[e.toLowerCase()]=i.toLowerCase(),s["Webkit"+e]="webkit"+i,s["Moz"+e]="moz"+i,s}var We={animationend:Ve("Animation","AnimationEnd"),animationiteration:Ve("Animation","AnimationIteration"),animationstart:Ve("Animation","AnimationStart"),transitionend:Ve("Transition","TransitionEnd")},Xe={},Ye={};ia&&(Ye=document.createElement("div").style,"AnimationEvent"in window||(delete We.animationend.animation,delete We.animationiteration.animation,delete We.animationstart.animation),"TransitionEvent"in window||delete We.transitionend.transition);function Ze(e){if(Xe[e])return Xe[e];if(!We[e])return e;var i=We[e],s;for(s in i)if(i.hasOwnProperty(s)&&s in Ye)return Xe[e]=i[s];return e}var $e$1=Ze("animationend"),af=Ze("animationiteration"),bf=Ze("animationstart"),cf=Ze("transitionend"),df=new Map,ef="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ff(e,i){df.set(e,i),fa(i,[e])}for(var gf=0;gf<ef.length;gf++){var hf=ef[gf],jf=hf.toLowerCase(),kf=hf[0].toUpperCase()+hf.slice(1);ff(jf,"on"+kf)}ff($e$1,"onAnimationEnd");ff(af,"onAnimationIteration");ff(bf,"onAnimationStart");ff("dblclick","onDoubleClick");ff("focusin","onFocus");ff("focusout","onBlur");ff(cf,"onTransitionEnd");ha("onMouseEnter",["mouseout","mouseover"]);ha("onMouseLeave",["mouseout","mouseover"]);ha("onPointerEnter",["pointerout","pointerover"]);ha("onPointerLeave",["pointerout","pointerover"]);fa("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));fa("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));fa("onBeforeInput",["compositionend","keypress","textInput","paste"]);fa("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));fa("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));fa("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var lf="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),mf=new Set("cancel close invalid load scroll toggle".split(" ").concat(lf));function nf(e,i,s){var a=e.type||"unknown-event";e.currentTarget=s,Ub(a,i,void 0,e),e.currentTarget=null}function se$1(e,i){i=(i&4)!==0;for(var s=0;s<e.length;s++){var a=e[s],_=a.event;a=a.listeners;e:{var $=void 0;if(i)for(var rt=a.length-1;0<=rt;rt--){var c=a[rt],dt=c.instance,ht=c.currentTarget;if(c=c.listener,dt!==$&&_.isPropagationStopped())break e;nf(_,c,ht),$=dt}else for(rt=0;rt<a.length;rt++){if(c=a[rt],dt=c.instance,ht=c.currentTarget,c=c.listener,dt!==$&&_.isPropagationStopped())break e;nf(_,c,ht),$=dt}}}if(Qb)throw e=Rb,Qb=!1,Rb=null,e}function D$1(e,i){var s=i[of];s===void 0&&(s=i[of]=new Set);var a=e+"__bubble";s.has(a)||(pf(i,e,2,!1),s.add(a))}function qf(e,i,s){var a=0;i&&(a|=4),pf(s,e,a,i)}var rf="_reactListening"+Math.random().toString(36).slice(2);function sf(e){if(!e[rf]){e[rf]=!0,da.forEach(function(s){s!=="selectionchange"&&(mf.has(s)||qf(s,!1,e),qf(s,!0,e))});var i=e.nodeType===9?e:e.ownerDocument;i===null||i[rf]||(i[rf]=!0,qf("selectionchange",!1,i))}}function pf(e,i,s,a){switch(jd(i)){case 1:var _=ed;break;case 4:_=gd;break;default:_=fd}s=_.bind(null,i,s,e),_=void 0,!Lb||i!=="touchstart"&&i!=="touchmove"&&i!=="wheel"||(_=!0),a?_!==void 0?e.addEventListener(i,s,{capture:!0,passive:_}):e.addEventListener(i,s,!0):_!==void 0?e.addEventListener(i,s,{passive:_}):e.addEventListener(i,s,!1)}function hd(e,i,s,a,_){var $=a;if(!(i&1)&&!(i&2)&&a!==null)e:for(;;){if(a===null)return;var rt=a.tag;if(rt===3||rt===4){var c=a.stateNode.containerInfo;if(c===_||c.nodeType===8&&c.parentNode===_)break;if(rt===4)for(rt=a.return;rt!==null;){var dt=rt.tag;if((dt===3||dt===4)&&(dt=rt.stateNode.containerInfo,dt===_||dt.nodeType===8&&dt.parentNode===_))return;rt=rt.return}for(;c!==null;){if(rt=Wc(c),rt===null)return;if(dt=rt.tag,dt===5||dt===6){a=$=rt;continue e}c=c.parentNode}}a=a.return}Jb(function(){var ht=$,Et=xb(s),St=[];e:{var At=df.get(e);if(At!==void 0){var Pt=td,Vt=e;switch(e){case"keypress":if(od(s)===0)break e;case"keydown":case"keyup":Pt=Rd;break;case"focusin":Vt="focus",Pt=Fd;break;case"focusout":Vt="blur",Pt=Fd;break;case"beforeblur":case"afterblur":Pt=Fd;break;case"click":if(s.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Pt=Bd;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Pt=Dd;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Pt=Vd;break;case $e$1:case af:case bf:Pt=Hd;break;case cf:Pt=Xd;break;case"scroll":Pt=vd;break;case"wheel":Pt=Zd;break;case"copy":case"cut":case"paste":Pt=Jd;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Pt=Td}var Bt=(i&4)!==0,Zt=!Bt&&e==="scroll",zt=Bt?At!==null?At+"Capture":null:At;Bt=[];for(var Ut=ht,Nt;Ut!==null;){Nt=Ut;var Gt=Nt.stateNode;if(Nt.tag===5&&Gt!==null&&(Nt=Gt,zt!==null&&(Gt=Kb(Ut,zt),Gt!=null&&Bt.push(tf(Ut,Gt,Nt)))),Zt)break;Ut=Ut.return}0<Bt.length&&(At=new Pt(At,Vt,null,s,Et),St.push({event:At,listeners:Bt}))}}if(!(i&7)){e:{if(At=e==="mouseover"||e==="pointerover",Pt=e==="mouseout"||e==="pointerout",At&&s!==wb&&(Vt=s.relatedTarget||s.fromElement)&&(Wc(Vt)||Vt[uf]))break e;if((Pt||At)&&(At=Et.window===Et?Et:(At=Et.ownerDocument)?At.defaultView||At.parentWindow:window,Pt?(Vt=s.relatedTarget||s.toElement,Pt=ht,Vt=Vt?Wc(Vt):null,Vt!==null&&(Zt=Vb(Vt),Vt!==Zt||Vt.tag!==5&&Vt.tag!==6)&&(Vt=null)):(Pt=null,Vt=ht),Pt!==Vt)){if(Bt=Bd,Gt="onMouseLeave",zt="onMouseEnter",Ut="mouse",(e==="pointerout"||e==="pointerover")&&(Bt=Td,Gt="onPointerLeave",zt="onPointerEnter",Ut="pointer"),Zt=Pt==null?At:ue$1(Pt),Nt=Vt==null?At:ue$1(Vt),At=new Bt(Gt,Ut+"leave",Pt,s,Et),At.target=Zt,At.relatedTarget=Nt,Gt=null,Wc(Et)===ht&&(Bt=new Bt(zt,Ut+"enter",Vt,s,Et),Bt.target=Nt,Bt.relatedTarget=Zt,Gt=Bt),Zt=Gt,Pt&&Vt)t:{for(Bt=Pt,zt=Vt,Ut=0,Nt=Bt;Nt;Nt=vf(Nt))Ut++;for(Nt=0,Gt=zt;Gt;Gt=vf(Gt))Nt++;for(;0<Ut-Nt;)Bt=vf(Bt),Ut--;for(;0<Nt-Ut;)zt=vf(zt),Nt--;for(;Ut--;){if(Bt===zt||zt!==null&&Bt===zt.alternate)break t;Bt=vf(Bt),zt=vf(zt)}Bt=null}else Bt=null;Pt!==null&&wf(St,At,Pt,Bt,!1),Vt!==null&&Zt!==null&&wf(St,Zt,Vt,Bt,!0)}}e:{if(At=ht?ue$1(ht):window,Pt=At.nodeName&&At.nodeName.toLowerCase(),Pt==="select"||Pt==="input"&&At.type==="file")var er=ve$1;else if(me$1(At))if(we$1)er=Fe;else{er=De;var ir=Ce}else(Pt=At.nodeName)&&Pt.toLowerCase()==="input"&&(At.type==="checkbox"||At.type==="radio")&&(er=Ee);if(er&&(er=er(e,ht))){ne$1(St,er,s,Et);break e}ir&&ir(e,At,ht),e==="focusout"&&(ir=At._wrapperState)&&ir.controlled&&At.type==="number"&&cb(At,"number",At.value)}switch(ir=ht?ue$1(ht):window,e){case"focusin":(me$1(ir)||ir.contentEditable==="true")&&(Qe=ir,Re=ht,Se=null);break;case"focusout":Se=Re=Qe=null;break;case"mousedown":Te$1=!0;break;case"contextmenu":case"mouseup":case"dragend":Te$1=!1,Ue(St,s,Et);break;case"selectionchange":if(Pe)break;case"keydown":case"keyup":Ue(St,s,Et)}var or;if(ae$1)e:{switch(e){case"compositionstart":var mr="onCompositionStart";break e;case"compositionend":mr="onCompositionEnd";break e;case"compositionupdate":mr="onCompositionUpdate";break e}mr=void 0}else ie$1?ge$1(e,s)&&(mr="onCompositionEnd"):e==="keydown"&&s.keyCode===229&&(mr="onCompositionStart");mr&&(de$1&&s.locale!=="ko"&&(ie$1||mr!=="onCompositionStart"?mr==="onCompositionEnd"&&ie$1&&(or=nd()):(kd=Et,ld="value"in kd?kd.value:kd.textContent,ie$1=!0)),ir=oe$1(ht,mr),0<ir.length&&(mr=new Ld(mr,e,null,s,Et),St.push({event:mr,listeners:ir}),or?mr.data=or:(or=he$1(s),or!==null&&(mr.data=or)))),(or=ce$1?je(e,s):ke(e,s))&&(ht=oe$1(ht,"onBeforeInput"),0<ht.length&&(Et=new Ld("onBeforeInput","beforeinput",null,s,Et),St.push({event:Et,listeners:ht}),Et.data=or))}se$1(St,i)})}function tf(e,i,s){return{instance:e,listener:i,currentTarget:s}}function oe$1(e,i){for(var s=i+"Capture",a=[];e!==null;){var _=e,$=_.stateNode;_.tag===5&&$!==null&&(_=$,$=Kb(e,s),$!=null&&a.unshift(tf(e,$,_)),$=Kb(e,i),$!=null&&a.push(tf(e,$,_))),e=e.return}return a}function vf(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function wf(e,i,s,a,_){for(var $=i._reactName,rt=[];s!==null&&s!==a;){var c=s,dt=c.alternate,ht=c.stateNode;if(dt!==null&&dt===a)break;c.tag===5&&ht!==null&&(c=ht,_?(dt=Kb(s,$),dt!=null&&rt.unshift(tf(s,dt,c))):_||(dt=Kb(s,$),dt!=null&&rt.push(tf(s,dt,c)))),s=s.return}rt.length!==0&&e.push({event:i,listeners:rt})}var xf=/\r\n?/g,yf=/\u0000|\uFFFD/g;function zf(e){return(typeof e=="string"?e:""+e).replace(xf,`
`).replace(yf,"")}function Af(e,i,s){if(i=zf(i),zf(e)!==i&&s)throw Error(p(425))}function Bf(){}var Cf=null,Df=null;function Ef(e,i){return e==="textarea"||e==="noscript"||typeof i.children=="string"||typeof i.children=="number"||typeof i.dangerouslySetInnerHTML=="object"&&i.dangerouslySetInnerHTML!==null&&i.dangerouslySetInnerHTML.__html!=null}var Ff=typeof setTimeout=="function"?setTimeout:void 0,Gf=typeof clearTimeout=="function"?clearTimeout:void 0,Hf=typeof Promise=="function"?Promise:void 0,Jf=typeof queueMicrotask=="function"?queueMicrotask:typeof Hf<"u"?function(e){return Hf.resolve(null).then(e).catch(If)}:Ff;function If(e){setTimeout(function(){throw e})}function Kf(e,i){var s=i,a=0;do{var _=s.nextSibling;if(e.removeChild(s),_&&_.nodeType===8)if(s=_.data,s==="/$"){if(a===0){e.removeChild(_),bd(i);return}a--}else s!=="$"&&s!=="$?"&&s!=="$!"||a++;s=_}while(s);bd(i)}function Lf(e){for(;e!=null;e=e.nextSibling){var i=e.nodeType;if(i===1||i===3)break;if(i===8){if(i=e.data,i==="$"||i==="$!"||i==="$?")break;if(i==="/$")return null}}return e}function Mf(e){e=e.previousSibling;for(var i=0;e;){if(e.nodeType===8){var s=e.data;if(s==="$"||s==="$!"||s==="$?"){if(i===0)return e;i--}else s==="/$"&&i++}e=e.previousSibling}return null}var Nf=Math.random().toString(36).slice(2),Of="__reactFiber$"+Nf,Pf="__reactProps$"+Nf,uf="__reactContainer$"+Nf,of="__reactEvents$"+Nf,Qf="__reactListeners$"+Nf,Rf="__reactHandles$"+Nf;function Wc(e){var i=e[Of];if(i)return i;for(var s=e.parentNode;s;){if(i=s[uf]||s[Of]){if(s=i.alternate,i.child!==null||s!==null&&s.child!==null)for(e=Mf(e);e!==null;){if(s=e[Of])return s;e=Mf(e)}return i}e=s,s=e.parentNode}return null}function Cb(e){return e=e[Of]||e[uf],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function ue$1(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(p(33))}function Db(e){return e[Pf]||null}var Sf=[],Tf=-1;function Uf(e){return{current:e}}function E$1(e){0>Tf||(e.current=Sf[Tf],Sf[Tf]=null,Tf--)}function G(e,i){Tf++,Sf[Tf]=e.current,e.current=i}var Vf={},H=Uf(Vf),Wf=Uf(!1),Xf=Vf;function Yf(e,i){var s=e.type.contextTypes;if(!s)return Vf;var a=e.stateNode;if(a&&a.__reactInternalMemoizedUnmaskedChildContext===i)return a.__reactInternalMemoizedMaskedChildContext;var _={},$;for($ in s)_[$]=i[$];return a&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=_),_}function Zf(e){return e=e.childContextTypes,e!=null}function $f(){E$1(Wf),E$1(H)}function ag(e,i,s){if(H.current!==Vf)throw Error(p(168));G(H,i),G(Wf,s)}function bg(e,i,s){var a=e.stateNode;if(i=i.childContextTypes,typeof a.getChildContext!="function")return s;a=a.getChildContext();for(var _ in a)if(!(_ in i))throw Error(p(108,Ra(e)||"Unknown",_));return A({},s,a)}function cg(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Vf,Xf=H.current,G(H,e),G(Wf,Wf.current),!0}function dg(e,i,s){var a=e.stateNode;if(!a)throw Error(p(169));s?(e=bg(e,i,Xf),a.__reactInternalMemoizedMergedChildContext=e,E$1(Wf),E$1(H),G(H,e)):E$1(Wf),G(Wf,s)}var eg=null,fg=!1,gg=!1;function hg(e){eg===null?eg=[e]:eg.push(e)}function ig(e){fg=!0,hg(e)}function jg(){if(!gg&&eg!==null){gg=!0;var e=0,i=C;try{var s=eg;for(C=1;e<s.length;e++){var a=s[e];do a=a(!0);while(a!==null)}eg=null,fg=!1}catch(_){throw eg!==null&&(eg=eg.slice(e+1)),ac(fc,jg),_}finally{C=i,gg=!1}}return null}var kg=[],lg=0,mg=null,ng=0,og=[],pg=0,qg=null,rg=1,sg="";function tg(e,i){kg[lg++]=ng,kg[lg++]=mg,mg=e,ng=i}function ug(e,i,s){og[pg++]=rg,og[pg++]=sg,og[pg++]=qg,qg=e;var a=rg;e=sg;var _=32-oc(a)-1;a&=~(1<<_),s+=1;var $=32-oc(i)+_;if(30<$){var rt=_-_%5;$=(a&(1<<rt)-1).toString(32),a>>=rt,_-=rt,rg=1<<32-oc(i)+_|s<<_|a,sg=$+e}else rg=1<<$|s<<_|a,sg=e}function vg(e){e.return!==null&&(tg(e,1),ug(e,1,0))}function wg(e){for(;e===mg;)mg=kg[--lg],kg[lg]=null,ng=kg[--lg],kg[lg]=null;for(;e===qg;)qg=og[--pg],og[pg]=null,sg=og[--pg],og[pg]=null,rg=og[--pg],og[pg]=null}var xg=null,yg=null,I=!1,zg=null;function Ag(e,i){var s=Bg(5,null,null,0);s.elementType="DELETED",s.stateNode=i,s.return=e,i=e.deletions,i===null?(e.deletions=[s],e.flags|=16):i.push(s)}function Cg(e,i){switch(e.tag){case 5:var s=e.type;return i=i.nodeType!==1||s.toLowerCase()!==i.nodeName.toLowerCase()?null:i,i!==null?(e.stateNode=i,xg=e,yg=Lf(i.firstChild),!0):!1;case 6:return i=e.pendingProps===""||i.nodeType!==3?null:i,i!==null?(e.stateNode=i,xg=e,yg=null,!0):!1;case 13:return i=i.nodeType!==8?null:i,i!==null?(s=qg!==null?{id:rg,overflow:sg}:null,e.memoizedState={dehydrated:i,treeContext:s,retryLane:1073741824},s=Bg(18,null,null,0),s.stateNode=i,s.return=e,e.child=s,xg=e,yg=null,!0):!1;default:return!1}}function Dg(e){return(e.mode&1)!==0&&(e.flags&128)===0}function Eg(e){if(I){var i=yg;if(i){var s=i;if(!Cg(e,i)){if(Dg(e))throw Error(p(418));i=Lf(s.nextSibling);var a=xg;i&&Cg(e,i)?Ag(a,s):(e.flags=e.flags&-4097|2,I=!1,xg=e)}}else{if(Dg(e))throw Error(p(418));e.flags=e.flags&-4097|2,I=!1,xg=e}}}function Fg(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;xg=e}function Gg(e){if(e!==xg)return!1;if(!I)return Fg(e),I=!0,!1;var i;if((i=e.tag!==3)&&!(i=e.tag!==5)&&(i=e.type,i=i!=="head"&&i!=="body"&&!Ef(e.type,e.memoizedProps)),i&&(i=yg)){if(Dg(e))throw Hg(),Error(p(418));for(;i;)Ag(e,i),i=Lf(i.nextSibling)}if(Fg(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(p(317));e:{for(e=e.nextSibling,i=0;e;){if(e.nodeType===8){var s=e.data;if(s==="/$"){if(i===0){yg=Lf(e.nextSibling);break e}i--}else s!=="$"&&s!=="$!"&&s!=="$?"||i++}e=e.nextSibling}yg=null}}else yg=xg?Lf(e.stateNode.nextSibling):null;return!0}function Hg(){for(var e=yg;e;)e=Lf(e.nextSibling)}function Ig(){yg=xg=null,I=!1}function Jg(e){zg===null?zg=[e]:zg.push(e)}var Kg=ua.ReactCurrentBatchConfig;function Lg(e,i,s){if(e=s.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(s._owner){if(s=s._owner,s){if(s.tag!==1)throw Error(p(309));var a=s.stateNode}if(!a)throw Error(p(147,e));var _=a,$=""+e;return i!==null&&i.ref!==null&&typeof i.ref=="function"&&i.ref._stringRef===$?i.ref:(i=function(rt){var c=_.refs;rt===null?delete c[$]:c[$]=rt},i._stringRef=$,i)}if(typeof e!="string")throw Error(p(284));if(!s._owner)throw Error(p(290,e))}return e}function Mg(e,i){throw e=Object.prototype.toString.call(i),Error(p(31,e==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":e))}function Ng(e){var i=e._init;return i(e._payload)}function Og(e){function i(zt,Ut){if(e){var Nt=zt.deletions;Nt===null?(zt.deletions=[Ut],zt.flags|=16):Nt.push(Ut)}}function s(zt,Ut){if(!e)return null;for(;Ut!==null;)i(zt,Ut),Ut=Ut.sibling;return null}function a(zt,Ut){for(zt=new Map;Ut!==null;)Ut.key!==null?zt.set(Ut.key,Ut):zt.set(Ut.index,Ut),Ut=Ut.sibling;return zt}function _(zt,Ut){return zt=Pg(zt,Ut),zt.index=0,zt.sibling=null,zt}function $(zt,Ut,Nt){return zt.index=Nt,e?(Nt=zt.alternate,Nt!==null?(Nt=Nt.index,Nt<Ut?(zt.flags|=2,Ut):Nt):(zt.flags|=2,Ut)):(zt.flags|=1048576,Ut)}function rt(zt){return e&&zt.alternate===null&&(zt.flags|=2),zt}function c(zt,Ut,Nt,Gt){return Ut===null||Ut.tag!==6?(Ut=Qg(Nt,zt.mode,Gt),Ut.return=zt,Ut):(Ut=_(Ut,Nt),Ut.return=zt,Ut)}function dt(zt,Ut,Nt,Gt){var er=Nt.type;return er===ya?Et(zt,Ut,Nt.props.children,Gt,Nt.key):Ut!==null&&(Ut.elementType===er||typeof er=="object"&&er!==null&&er.$$typeof===Ha&&Ng(er)===Ut.type)?(Gt=_(Ut,Nt.props),Gt.ref=Lg(zt,Ut,Nt),Gt.return=zt,Gt):(Gt=Rg(Nt.type,Nt.key,Nt.props,null,zt.mode,Gt),Gt.ref=Lg(zt,Ut,Nt),Gt.return=zt,Gt)}function ht(zt,Ut,Nt,Gt){return Ut===null||Ut.tag!==4||Ut.stateNode.containerInfo!==Nt.containerInfo||Ut.stateNode.implementation!==Nt.implementation?(Ut=Sg(Nt,zt.mode,Gt),Ut.return=zt,Ut):(Ut=_(Ut,Nt.children||[]),Ut.return=zt,Ut)}function Et(zt,Ut,Nt,Gt,er){return Ut===null||Ut.tag!==7?(Ut=Tg(Nt,zt.mode,Gt,er),Ut.return=zt,Ut):(Ut=_(Ut,Nt),Ut.return=zt,Ut)}function St(zt,Ut,Nt){if(typeof Ut=="string"&&Ut!==""||typeof Ut=="number")return Ut=Qg(""+Ut,zt.mode,Nt),Ut.return=zt,Ut;if(typeof Ut=="object"&&Ut!==null){switch(Ut.$$typeof){case va:return Nt=Rg(Ut.type,Ut.key,Ut.props,null,zt.mode,Nt),Nt.ref=Lg(zt,null,Ut),Nt.return=zt,Nt;case wa:return Ut=Sg(Ut,zt.mode,Nt),Ut.return=zt,Ut;case Ha:var Gt=Ut._init;return St(zt,Gt(Ut._payload),Nt)}if(eb(Ut)||Ka(Ut))return Ut=Tg(Ut,zt.mode,Nt,null),Ut.return=zt,Ut;Mg(zt,Ut)}return null}function At(zt,Ut,Nt,Gt){var er=Ut!==null?Ut.key:null;if(typeof Nt=="string"&&Nt!==""||typeof Nt=="number")return er!==null?null:c(zt,Ut,""+Nt,Gt);if(typeof Nt=="object"&&Nt!==null){switch(Nt.$$typeof){case va:return Nt.key===er?dt(zt,Ut,Nt,Gt):null;case wa:return Nt.key===er?ht(zt,Ut,Nt,Gt):null;case Ha:return er=Nt._init,At(zt,Ut,er(Nt._payload),Gt)}if(eb(Nt)||Ka(Nt))return er!==null?null:Et(zt,Ut,Nt,Gt,null);Mg(zt,Nt)}return null}function Pt(zt,Ut,Nt,Gt,er){if(typeof Gt=="string"&&Gt!==""||typeof Gt=="number")return zt=zt.get(Nt)||null,c(Ut,zt,""+Gt,er);if(typeof Gt=="object"&&Gt!==null){switch(Gt.$$typeof){case va:return zt=zt.get(Gt.key===null?Nt:Gt.key)||null,dt(Ut,zt,Gt,er);case wa:return zt=zt.get(Gt.key===null?Nt:Gt.key)||null,ht(Ut,zt,Gt,er);case Ha:var ir=Gt._init;return Pt(zt,Ut,Nt,ir(Gt._payload),er)}if(eb(Gt)||Ka(Gt))return zt=zt.get(Nt)||null,Et(Ut,zt,Gt,er,null);Mg(Ut,Gt)}return null}function Vt(zt,Ut,Nt,Gt){for(var er=null,ir=null,or=Ut,mr=Ut=0,Rr=null;or!==null&&mr<Nt.length;mr++){or.index>mr?(Rr=or,or=null):Rr=or.sibling;var on=At(zt,or,Nt[mr],Gt);if(on===null){or===null&&(or=Rr);break}e&&or&&on.alternate===null&&i(zt,or),Ut=$(on,Ut,mr),ir===null?er=on:ir.sibling=on,ir=on,or=Rr}if(mr===Nt.length)return s(zt,or),I&&tg(zt,mr),er;if(or===null){for(;mr<Nt.length;mr++)or=St(zt,Nt[mr],Gt),or!==null&&(Ut=$(or,Ut,mr),ir===null?er=or:ir.sibling=or,ir=or);return I&&tg(zt,mr),er}for(or=a(zt,or);mr<Nt.length;mr++)Rr=Pt(or,zt,mr,Nt[mr],Gt),Rr!==null&&(e&&Rr.alternate!==null&&or.delete(Rr.key===null?mr:Rr.key),Ut=$(Rr,Ut,mr),ir===null?er=Rr:ir.sibling=Rr,ir=Rr);return e&&or.forEach(function(un){return i(zt,un)}),I&&tg(zt,mr),er}function Bt(zt,Ut,Nt,Gt){var er=Ka(Nt);if(typeof er!="function")throw Error(p(150));if(Nt=er.call(Nt),Nt==null)throw Error(p(151));for(var ir=er=null,or=Ut,mr=Ut=0,Rr=null,on=Nt.next();or!==null&&!on.done;mr++,on=Nt.next()){or.index>mr?(Rr=or,or=null):Rr=or.sibling;var un=At(zt,or,on.value,Gt);if(un===null){or===null&&(or=Rr);break}e&&or&&un.alternate===null&&i(zt,or),Ut=$(un,Ut,mr),ir===null?er=un:ir.sibling=un,ir=un,or=Rr}if(on.done)return s(zt,or),I&&tg(zt,mr),er;if(or===null){for(;!on.done;mr++,on=Nt.next())on=St(zt,on.value,Gt),on!==null&&(Ut=$(on,Ut,mr),ir===null?er=on:ir.sibling=on,ir=on);return I&&tg(zt,mr),er}for(or=a(zt,or);!on.done;mr++,on=Nt.next())on=Pt(or,zt,mr,on.value,Gt),on!==null&&(e&&on.alternate!==null&&or.delete(on.key===null?mr:on.key),Ut=$(on,Ut,mr),ir===null?er=on:ir.sibling=on,ir=on);return e&&or.forEach(function(jr){return i(zt,jr)}),I&&tg(zt,mr),er}function Zt(zt,Ut,Nt,Gt){if(typeof Nt=="object"&&Nt!==null&&Nt.type===ya&&Nt.key===null&&(Nt=Nt.props.children),typeof Nt=="object"&&Nt!==null){switch(Nt.$$typeof){case va:e:{for(var er=Nt.key,ir=Ut;ir!==null;){if(ir.key===er){if(er=Nt.type,er===ya){if(ir.tag===7){s(zt,ir.sibling),Ut=_(ir,Nt.props.children),Ut.return=zt,zt=Ut;break e}}else if(ir.elementType===er||typeof er=="object"&&er!==null&&er.$$typeof===Ha&&Ng(er)===ir.type){s(zt,ir.sibling),Ut=_(ir,Nt.props),Ut.ref=Lg(zt,ir,Nt),Ut.return=zt,zt=Ut;break e}s(zt,ir);break}else i(zt,ir);ir=ir.sibling}Nt.type===ya?(Ut=Tg(Nt.props.children,zt.mode,Gt,Nt.key),Ut.return=zt,zt=Ut):(Gt=Rg(Nt.type,Nt.key,Nt.props,null,zt.mode,Gt),Gt.ref=Lg(zt,Ut,Nt),Gt.return=zt,zt=Gt)}return rt(zt);case wa:e:{for(ir=Nt.key;Ut!==null;){if(Ut.key===ir)if(Ut.tag===4&&Ut.stateNode.containerInfo===Nt.containerInfo&&Ut.stateNode.implementation===Nt.implementation){s(zt,Ut.sibling),Ut=_(Ut,Nt.children||[]),Ut.return=zt,zt=Ut;break e}else{s(zt,Ut);break}else i(zt,Ut);Ut=Ut.sibling}Ut=Sg(Nt,zt.mode,Gt),Ut.return=zt,zt=Ut}return rt(zt);case Ha:return ir=Nt._init,Zt(zt,Ut,ir(Nt._payload),Gt)}if(eb(Nt))return Vt(zt,Ut,Nt,Gt);if(Ka(Nt))return Bt(zt,Ut,Nt,Gt);Mg(zt,Nt)}return typeof Nt=="string"&&Nt!==""||typeof Nt=="number"?(Nt=""+Nt,Ut!==null&&Ut.tag===6?(s(zt,Ut.sibling),Ut=_(Ut,Nt),Ut.return=zt,zt=Ut):(s(zt,Ut),Ut=Qg(Nt,zt.mode,Gt),Ut.return=zt,zt=Ut),rt(zt)):s(zt,Ut)}return Zt}var Ug=Og(!0),Vg=Og(!1),Wg=Uf(null),Xg=null,Yg=null,Zg=null;function $g(){Zg=Yg=Xg=null}function ah(e){var i=Wg.current;E$1(Wg),e._currentValue=i}function bh(e,i,s){for(;e!==null;){var a=e.alternate;if((e.childLanes&i)!==i?(e.childLanes|=i,a!==null&&(a.childLanes|=i)):a!==null&&(a.childLanes&i)!==i&&(a.childLanes|=i),e===s)break;e=e.return}}function ch(e,i){Xg=e,Zg=Yg=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&i&&(dh=!0),e.firstContext=null)}function eh(e){var i=e._currentValue;if(Zg!==e)if(e={context:e,memoizedValue:i,next:null},Yg===null){if(Xg===null)throw Error(p(308));Yg=e,Xg.dependencies={lanes:0,firstContext:e}}else Yg=Yg.next=e;return i}var fh=null;function gh(e){fh===null?fh=[e]:fh.push(e)}function hh(e,i,s,a){var _=i.interleaved;return _===null?(s.next=s,gh(i)):(s.next=_.next,_.next=s),i.interleaved=s,ih(e,a)}function ih(e,i){e.lanes|=i;var s=e.alternate;for(s!==null&&(s.lanes|=i),s=e,e=e.return;e!==null;)e.childLanes|=i,s=e.alternate,s!==null&&(s.childLanes|=i),s=e,e=e.return;return s.tag===3?s.stateNode:null}var jh=!1;function kh(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function lh(e,i){e=e.updateQueue,i.updateQueue===e&&(i.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function mh(e,i){return{eventTime:e,lane:i,tag:0,payload:null,callback:null,next:null}}function nh(e,i,s){var a=e.updateQueue;if(a===null)return null;if(a=a.shared,K&2){var _=a.pending;return _===null?i.next=i:(i.next=_.next,_.next=i),a.pending=i,ih(e,s)}return _=a.interleaved,_===null?(i.next=i,gh(a)):(i.next=_.next,_.next=i),a.interleaved=i,ih(e,s)}function oh(e,i,s){if(i=i.updateQueue,i!==null&&(i=i.shared,(s&4194240)!==0)){var a=i.lanes;a&=e.pendingLanes,s|=a,i.lanes=s,Cc(e,s)}}function ph(e,i){var s=e.updateQueue,a=e.alternate;if(a!==null&&(a=a.updateQueue,s===a)){var _=null,$=null;if(s=s.firstBaseUpdate,s!==null){do{var rt={eventTime:s.eventTime,lane:s.lane,tag:s.tag,payload:s.payload,callback:s.callback,next:null};$===null?_=$=rt:$=$.next=rt,s=s.next}while(s!==null);$===null?_=$=i:$=$.next=i}else _=$=i;s={baseState:a.baseState,firstBaseUpdate:_,lastBaseUpdate:$,shared:a.shared,effects:a.effects},e.updateQueue=s;return}e=s.lastBaseUpdate,e===null?s.firstBaseUpdate=i:e.next=i,s.lastBaseUpdate=i}function qh(e,i,s,a){var _=e.updateQueue;jh=!1;var $=_.firstBaseUpdate,rt=_.lastBaseUpdate,c=_.shared.pending;if(c!==null){_.shared.pending=null;var dt=c,ht=dt.next;dt.next=null,rt===null?$=ht:rt.next=ht,rt=dt;var Et=e.alternate;Et!==null&&(Et=Et.updateQueue,c=Et.lastBaseUpdate,c!==rt&&(c===null?Et.firstBaseUpdate=ht:c.next=ht,Et.lastBaseUpdate=dt))}if($!==null){var St=_.baseState;rt=0,Et=ht=dt=null,c=$;do{var At=c.lane,Pt=c.eventTime;if((a&At)===At){Et!==null&&(Et=Et.next={eventTime:Pt,lane:0,tag:c.tag,payload:c.payload,callback:c.callback,next:null});e:{var Vt=e,Bt=c;switch(At=i,Pt=s,Bt.tag){case 1:if(Vt=Bt.payload,typeof Vt=="function"){St=Vt.call(Pt,St,At);break e}St=Vt;break e;case 3:Vt.flags=Vt.flags&-65537|128;case 0:if(Vt=Bt.payload,At=typeof Vt=="function"?Vt.call(Pt,St,At):Vt,At==null)break e;St=A({},St,At);break e;case 2:jh=!0}}c.callback!==null&&c.lane!==0&&(e.flags|=64,At=_.effects,At===null?_.effects=[c]:At.push(c))}else Pt={eventTime:Pt,lane:At,tag:c.tag,payload:c.payload,callback:c.callback,next:null},Et===null?(ht=Et=Pt,dt=St):Et=Et.next=Pt,rt|=At;if(c=c.next,c===null){if(c=_.shared.pending,c===null)break;At=c,c=At.next,At.next=null,_.lastBaseUpdate=At,_.shared.pending=null}}while(!0);if(Et===null&&(dt=St),_.baseState=dt,_.firstBaseUpdate=ht,_.lastBaseUpdate=Et,i=_.shared.interleaved,i!==null){_=i;do rt|=_.lane,_=_.next;while(_!==i)}else $===null&&(_.shared.lanes=0);rh|=rt,e.lanes=rt,e.memoizedState=St}}function sh(e,i,s){if(e=i.effects,i.effects=null,e!==null)for(i=0;i<e.length;i++){var a=e[i],_=a.callback;if(_!==null){if(a.callback=null,a=s,typeof _!="function")throw Error(p(191,_));_.call(a)}}}var th={},uh=Uf(th),vh$1=Uf(th),wh=Uf(th);function xh(e){if(e===th)throw Error(p(174));return e}function yh(e,i){switch(G(wh,i),G(vh$1,e),G(uh,th),e=i.nodeType,e){case 9:case 11:i=(i=i.documentElement)?i.namespaceURI:lb(null,"");break;default:e=e===8?i.parentNode:i,i=e.namespaceURI||null,e=e.tagName,i=lb(i,e)}E$1(uh),G(uh,i)}function zh(){E$1(uh),E$1(vh$1),E$1(wh)}function Ah(e){xh(wh.current);var i=xh(uh.current),s=lb(i,e.type);i!==s&&(G(vh$1,e),G(uh,s))}function Bh(e){vh$1.current===e&&(E$1(uh),E$1(vh$1))}var L$1=Uf(0);function Ch(e){for(var i=e;i!==null;){if(i.tag===13){var s=i.memoizedState;if(s!==null&&(s=s.dehydrated,s===null||s.data==="$?"||s.data==="$!"))return i}else if(i.tag===19&&i.memoizedProps.revealOrder!==void 0){if(i.flags&128)return i}else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===e)break;for(;i.sibling===null;){if(i.return===null||i.return===e)return null;i=i.return}i.sibling.return=i.return,i=i.sibling}return null}var Dh=[];function Eh(){for(var e=0;e<Dh.length;e++)Dh[e]._workInProgressVersionPrimary=null;Dh.length=0}var Fh=ua.ReactCurrentDispatcher,Gh=ua.ReactCurrentBatchConfig,Hh=0,M$1=null,N=null,O=null,Ih=!1,Jh=!1,Kh=0,Lh=0;function P$1(){throw Error(p(321))}function Mh(e,i){if(i===null)return!1;for(var s=0;s<i.length&&s<e.length;s++)if(!He(e[s],i[s]))return!1;return!0}function Nh(e,i,s,a,_,$){if(Hh=$,M$1=i,i.memoizedState=null,i.updateQueue=null,i.lanes=0,Fh.current=e===null||e.memoizedState===null?Oh:Ph,e=s(a,_),Jh){$=0;do{if(Jh=!1,Kh=0,25<=$)throw Error(p(301));$+=1,O=N=null,i.updateQueue=null,Fh.current=Qh,e=s(a,_)}while(Jh)}if(Fh.current=Rh,i=N!==null&&N.next!==null,Hh=0,O=N=M$1=null,Ih=!1,i)throw Error(p(300));return e}function Sh(){var e=Kh!==0;return Kh=0,e}function Th(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return O===null?M$1.memoizedState=O=e:O=O.next=e,O}function Uh(){if(N===null){var e=M$1.alternate;e=e!==null?e.memoizedState:null}else e=N.next;var i=O===null?M$1.memoizedState:O.next;if(i!==null)O=i,N=e;else{if(e===null)throw Error(p(310));N=e,e={memoizedState:N.memoizedState,baseState:N.baseState,baseQueue:N.baseQueue,queue:N.queue,next:null},O===null?M$1.memoizedState=O=e:O=O.next=e}return O}function Vh(e,i){return typeof i=="function"?i(e):i}function Wh(e){var i=Uh(),s=i.queue;if(s===null)throw Error(p(311));s.lastRenderedReducer=e;var a=N,_=a.baseQueue,$=s.pending;if($!==null){if(_!==null){var rt=_.next;_.next=$.next,$.next=rt}a.baseQueue=_=$,s.pending=null}if(_!==null){$=_.next,a=a.baseState;var c=rt=null,dt=null,ht=$;do{var Et=ht.lane;if((Hh&Et)===Et)dt!==null&&(dt=dt.next={lane:0,action:ht.action,hasEagerState:ht.hasEagerState,eagerState:ht.eagerState,next:null}),a=ht.hasEagerState?ht.eagerState:e(a,ht.action);else{var St={lane:Et,action:ht.action,hasEagerState:ht.hasEagerState,eagerState:ht.eagerState,next:null};dt===null?(c=dt=St,rt=a):dt=dt.next=St,M$1.lanes|=Et,rh|=Et}ht=ht.next}while(ht!==null&&ht!==$);dt===null?rt=a:dt.next=c,He(a,i.memoizedState)||(dh=!0),i.memoizedState=a,i.baseState=rt,i.baseQueue=dt,s.lastRenderedState=a}if(e=s.interleaved,e!==null){_=e;do $=_.lane,M$1.lanes|=$,rh|=$,_=_.next;while(_!==e)}else _===null&&(s.lanes=0);return[i.memoizedState,s.dispatch]}function Xh(e){var i=Uh(),s=i.queue;if(s===null)throw Error(p(311));s.lastRenderedReducer=e;var a=s.dispatch,_=s.pending,$=i.memoizedState;if(_!==null){s.pending=null;var rt=_=_.next;do $=e($,rt.action),rt=rt.next;while(rt!==_);He($,i.memoizedState)||(dh=!0),i.memoizedState=$,i.baseQueue===null&&(i.baseState=$),s.lastRenderedState=$}return[$,a]}function Yh(){}function Zh(e,i){var s=M$1,a=Uh(),_=i(),$=!He(a.memoizedState,_);if($&&(a.memoizedState=_,dh=!0),a=a.queue,$h(ai.bind(null,s,a,e),[e]),a.getSnapshot!==i||$||O!==null&&O.memoizedState.tag&1){if(s.flags|=2048,bi(9,ci.bind(null,s,a,_,i),void 0,null),Q===null)throw Error(p(349));Hh&30||di(s,i,_)}return _}function di(e,i,s){e.flags|=16384,e={getSnapshot:i,value:s},i=M$1.updateQueue,i===null?(i={lastEffect:null,stores:null},M$1.updateQueue=i,i.stores=[e]):(s=i.stores,s===null?i.stores=[e]:s.push(e))}function ci(e,i,s,a){i.value=s,i.getSnapshot=a,ei(i)&&fi(e)}function ai(e,i,s){return s(function(){ei(i)&&fi(e)})}function ei(e){var i=e.getSnapshot;e=e.value;try{var s=i();return!He(e,s)}catch{return!0}}function fi(e){var i=ih(e,1);i!==null&&gi(i,e,1,-1)}function hi(e){var i=Th();return typeof e=="function"&&(e=e()),i.memoizedState=i.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Vh,lastRenderedState:e},i.queue=e,e=e.dispatch=ii.bind(null,M$1,e),[i.memoizedState,e]}function bi(e,i,s,a){return e={tag:e,create:i,destroy:s,deps:a,next:null},i=M$1.updateQueue,i===null?(i={lastEffect:null,stores:null},M$1.updateQueue=i,i.lastEffect=e.next=e):(s=i.lastEffect,s===null?i.lastEffect=e.next=e:(a=s.next,s.next=e,e.next=a,i.lastEffect=e)),e}function ji(){return Uh().memoizedState}function ki(e,i,s,a){var _=Th();M$1.flags|=e,_.memoizedState=bi(1|i,s,void 0,a===void 0?null:a)}function li(e,i,s,a){var _=Uh();a=a===void 0?null:a;var $=void 0;if(N!==null){var rt=N.memoizedState;if($=rt.destroy,a!==null&&Mh(a,rt.deps)){_.memoizedState=bi(i,s,$,a);return}}M$1.flags|=e,_.memoizedState=bi(1|i,s,$,a)}function mi(e,i){return ki(8390656,8,e,i)}function $h(e,i){return li(2048,8,e,i)}function ni(e,i){return li(4,2,e,i)}function oi(e,i){return li(4,4,e,i)}function pi(e,i){if(typeof i=="function")return e=e(),i(e),function(){i(null)};if(i!=null)return e=e(),i.current=e,function(){i.current=null}}function qi(e,i,s){return s=s!=null?s.concat([e]):null,li(4,4,pi.bind(null,i,e),s)}function ri(){}function si(e,i){var s=Uh();i=i===void 0?null:i;var a=s.memoizedState;return a!==null&&i!==null&&Mh(i,a[1])?a[0]:(s.memoizedState=[e,i],e)}function ti(e,i){var s=Uh();i=i===void 0?null:i;var a=s.memoizedState;return a!==null&&i!==null&&Mh(i,a[1])?a[0]:(e=e(),s.memoizedState=[e,i],e)}function ui$1(e,i,s){return Hh&21?(He(s,i)||(s=yc(),M$1.lanes|=s,rh|=s,e.baseState=!0),i):(e.baseState&&(e.baseState=!1,dh=!0),e.memoizedState=s)}function vi(e,i){var s=C;C=s!==0&&4>s?s:4,e(!0);var a=Gh.transition;Gh.transition={};try{e(!1),i()}finally{C=s,Gh.transition=a}}function wi(){return Uh().memoizedState}function xi(e,i,s){var a=yi(e);if(s={lane:a,action:s,hasEagerState:!1,eagerState:null,next:null},zi(e))Ai(i,s);else if(s=hh(e,i,s,a),s!==null){var _=R();gi(s,e,a,_),Bi(s,i,a)}}function ii(e,i,s){var a=yi(e),_={lane:a,action:s,hasEagerState:!1,eagerState:null,next:null};if(zi(e))Ai(i,_);else{var $=e.alternate;if(e.lanes===0&&($===null||$.lanes===0)&&($=i.lastRenderedReducer,$!==null))try{var rt=i.lastRenderedState,c=$(rt,s);if(_.hasEagerState=!0,_.eagerState=c,He(c,rt)){var dt=i.interleaved;dt===null?(_.next=_,gh(i)):(_.next=dt.next,dt.next=_),i.interleaved=_;return}}catch{}finally{}s=hh(e,i,_,a),s!==null&&(_=R(),gi(s,e,a,_),Bi(s,i,a))}}function zi(e){var i=e.alternate;return e===M$1||i!==null&&i===M$1}function Ai(e,i){Jh=Ih=!0;var s=e.pending;s===null?i.next=i:(i.next=s.next,s.next=i),e.pending=i}function Bi(e,i,s){if(s&4194240){var a=i.lanes;a&=e.pendingLanes,s|=a,i.lanes=s,Cc(e,s)}}var Rh={readContext:eh,useCallback:P$1,useContext:P$1,useEffect:P$1,useImperativeHandle:P$1,useInsertionEffect:P$1,useLayoutEffect:P$1,useMemo:P$1,useReducer:P$1,useRef:P$1,useState:P$1,useDebugValue:P$1,useDeferredValue:P$1,useTransition:P$1,useMutableSource:P$1,useSyncExternalStore:P$1,useId:P$1,unstable_isNewReconciler:!1},Oh={readContext:eh,useCallback:function(e,i){return Th().memoizedState=[e,i===void 0?null:i],e},useContext:eh,useEffect:mi,useImperativeHandle:function(e,i,s){return s=s!=null?s.concat([e]):null,ki(4194308,4,pi.bind(null,i,e),s)},useLayoutEffect:function(e,i){return ki(4194308,4,e,i)},useInsertionEffect:function(e,i){return ki(4,2,e,i)},useMemo:function(e,i){var s=Th();return i=i===void 0?null:i,e=e(),s.memoizedState=[e,i],e},useReducer:function(e,i,s){var a=Th();return i=s!==void 0?s(i):i,a.memoizedState=a.baseState=i,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:i},a.queue=e,e=e.dispatch=xi.bind(null,M$1,e),[a.memoizedState,e]},useRef:function(e){var i=Th();return e={current:e},i.memoizedState=e},useState:hi,useDebugValue:ri,useDeferredValue:function(e){return Th().memoizedState=e},useTransition:function(){var e=hi(!1),i=e[0];return e=vi.bind(null,e[1]),Th().memoizedState=e,[i,e]},useMutableSource:function(){},useSyncExternalStore:function(e,i,s){var a=M$1,_=Th();if(I){if(s===void 0)throw Error(p(407));s=s()}else{if(s=i(),Q===null)throw Error(p(349));Hh&30||di(a,i,s)}_.memoizedState=s;var $={value:s,getSnapshot:i};return _.queue=$,mi(ai.bind(null,a,$,e),[e]),a.flags|=2048,bi(9,ci.bind(null,a,$,s,i),void 0,null),s},useId:function(){var e=Th(),i=Q.identifierPrefix;if(I){var s=sg,a=rg;s=(a&~(1<<32-oc(a)-1)).toString(32)+s,i=":"+i+"R"+s,s=Kh++,0<s&&(i+="H"+s.toString(32)),i+=":"}else s=Lh++,i=":"+i+"r"+s.toString(32)+":";return e.memoizedState=i},unstable_isNewReconciler:!1},Ph={readContext:eh,useCallback:si,useContext:eh,useEffect:$h,useImperativeHandle:qi,useInsertionEffect:ni,useLayoutEffect:oi,useMemo:ti,useReducer:Wh,useRef:ji,useState:function(){return Wh(Vh)},useDebugValue:ri,useDeferredValue:function(e){var i=Uh();return ui$1(i,N.memoizedState,e)},useTransition:function(){var e=Wh(Vh)[0],i=Uh().memoizedState;return[e,i]},useMutableSource:Yh,useSyncExternalStore:Zh,useId:wi,unstable_isNewReconciler:!1},Qh={readContext:eh,useCallback:si,useContext:eh,useEffect:$h,useImperativeHandle:qi,useInsertionEffect:ni,useLayoutEffect:oi,useMemo:ti,useReducer:Xh,useRef:ji,useState:function(){return Xh(Vh)},useDebugValue:ri,useDeferredValue:function(e){var i=Uh();return N===null?i.memoizedState=e:ui$1(i,N.memoizedState,e)},useTransition:function(){var e=Xh(Vh)[0],i=Uh().memoizedState;return[e,i]},useMutableSource:Yh,useSyncExternalStore:Zh,useId:wi,unstable_isNewReconciler:!1};function Ci(e,i){if(e&&e.defaultProps){i=A({},i),e=e.defaultProps;for(var s in e)i[s]===void 0&&(i[s]=e[s]);return i}return i}function Di(e,i,s,a){i=e.memoizedState,s=s(a,i),s=s==null?i:A({},i,s),e.memoizedState=s,e.lanes===0&&(e.updateQueue.baseState=s)}var Ei={isMounted:function(e){return(e=e._reactInternals)?Vb(e)===e:!1},enqueueSetState:function(e,i,s){e=e._reactInternals;var a=R(),_=yi(e),$=mh(a,_);$.payload=i,s!=null&&($.callback=s),i=nh(e,$,_),i!==null&&(gi(i,e,_,a),oh(i,e,_))},enqueueReplaceState:function(e,i,s){e=e._reactInternals;var a=R(),_=yi(e),$=mh(a,_);$.tag=1,$.payload=i,s!=null&&($.callback=s),i=nh(e,$,_),i!==null&&(gi(i,e,_,a),oh(i,e,_))},enqueueForceUpdate:function(e,i){e=e._reactInternals;var s=R(),a=yi(e),_=mh(s,a);_.tag=2,i!=null&&(_.callback=i),i=nh(e,_,a),i!==null&&(gi(i,e,a,s),oh(i,e,a))}};function Fi(e,i,s,a,_,$,rt){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(a,$,rt):i.prototype&&i.prototype.isPureReactComponent?!Ie(s,a)||!Ie(_,$):!0}function Gi(e,i,s){var a=!1,_=Vf,$=i.contextType;return typeof $=="object"&&$!==null?$=eh($):(_=Zf(i)?Xf:H.current,a=i.contextTypes,$=(a=a!=null)?Yf(e,_):Vf),i=new i(s,$),e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,i.updater=Ei,e.stateNode=i,i._reactInternals=e,a&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=_,e.__reactInternalMemoizedMaskedChildContext=$),i}function Hi(e,i,s,a){e=i.state,typeof i.componentWillReceiveProps=="function"&&i.componentWillReceiveProps(s,a),typeof i.UNSAFE_componentWillReceiveProps=="function"&&i.UNSAFE_componentWillReceiveProps(s,a),i.state!==e&&Ei.enqueueReplaceState(i,i.state,null)}function Ii(e,i,s,a){var _=e.stateNode;_.props=s,_.state=e.memoizedState,_.refs={},kh(e);var $=i.contextType;typeof $=="object"&&$!==null?_.context=eh($):($=Zf(i)?Xf:H.current,_.context=Yf(e,$)),_.state=e.memoizedState,$=i.getDerivedStateFromProps,typeof $=="function"&&(Di(e,i,$,s),_.state=e.memoizedState),typeof i.getDerivedStateFromProps=="function"||typeof _.getSnapshotBeforeUpdate=="function"||typeof _.UNSAFE_componentWillMount!="function"&&typeof _.componentWillMount!="function"||(i=_.state,typeof _.componentWillMount=="function"&&_.componentWillMount(),typeof _.UNSAFE_componentWillMount=="function"&&_.UNSAFE_componentWillMount(),i!==_.state&&Ei.enqueueReplaceState(_,_.state,null),qh(e,s,_,a),_.state=e.memoizedState),typeof _.componentDidMount=="function"&&(e.flags|=4194308)}function Ji(e,i){try{var s="",a=i;do s+=Pa(a),a=a.return;while(a);var _=s}catch($){_=`
Error generating stack: `+$.message+`
`+$.stack}return{value:e,source:i,stack:_,digest:null}}function Ki(e,i,s){return{value:e,source:null,stack:s??null,digest:i??null}}function Li(e,i){try{console.error(i.value)}catch(s){setTimeout(function(){throw s})}}var Mi=typeof WeakMap=="function"?WeakMap:Map;function Ni(e,i,s){s=mh(-1,s),s.tag=3,s.payload={element:null};var a=i.value;return s.callback=function(){Oi||(Oi=!0,Pi=a),Li(e,i)},s}function Qi(e,i,s){s=mh(-1,s),s.tag=3;var a=e.type.getDerivedStateFromError;if(typeof a=="function"){var _=i.value;s.payload=function(){return a(_)},s.callback=function(){Li(e,i)}}var $=e.stateNode;return $!==null&&typeof $.componentDidCatch=="function"&&(s.callback=function(){Li(e,i),typeof a!="function"&&(Ri===null?Ri=new Set([this]):Ri.add(this));var rt=i.stack;this.componentDidCatch(i.value,{componentStack:rt!==null?rt:""})}),s}function Si(e,i,s){var a=e.pingCache;if(a===null){a=e.pingCache=new Mi;var _=new Set;a.set(i,_)}else _=a.get(i),_===void 0&&(_=new Set,a.set(i,_));_.has(s)||(_.add(s),e=Ti.bind(null,e,i,s),i.then(e,e))}function Ui(e){do{var i;if((i=e.tag===13)&&(i=e.memoizedState,i=i!==null?i.dehydrated!==null:!0),i)return e;e=e.return}while(e!==null);return null}function Vi(e,i,s,a,_){return e.mode&1?(e.flags|=65536,e.lanes=_,e):(e===i?e.flags|=65536:(e.flags|=128,s.flags|=131072,s.flags&=-52805,s.tag===1&&(s.alternate===null?s.tag=17:(i=mh(-1,1),i.tag=2,nh(s,i,1))),s.lanes|=1),e)}var Wi=ua.ReactCurrentOwner,dh=!1;function Xi(e,i,s,a){i.child=e===null?Vg(i,null,s,a):Ug(i,e.child,s,a)}function Yi(e,i,s,a,_){s=s.render;var $=i.ref;return ch(i,_),a=Nh(e,i,s,a,$,_),s=Sh(),e!==null&&!dh?(i.updateQueue=e.updateQueue,i.flags&=-2053,e.lanes&=~_,Zi(e,i,_)):(I&&s&&vg(i),i.flags|=1,Xi(e,i,a,_),i.child)}function $i(e,i,s,a,_){if(e===null){var $=s.type;return typeof $=="function"&&!aj($)&&$.defaultProps===void 0&&s.compare===null&&s.defaultProps===void 0?(i.tag=15,i.type=$,bj(e,i,$,a,_)):(e=Rg(s.type,null,a,i,i.mode,_),e.ref=i.ref,e.return=i,i.child=e)}if($=e.child,!(e.lanes&_)){var rt=$.memoizedProps;if(s=s.compare,s=s!==null?s:Ie,s(rt,a)&&e.ref===i.ref)return Zi(e,i,_)}return i.flags|=1,e=Pg($,a),e.ref=i.ref,e.return=i,i.child=e}function bj(e,i,s,a,_){if(e!==null){var $=e.memoizedProps;if(Ie($,a)&&e.ref===i.ref)if(dh=!1,i.pendingProps=a=$,(e.lanes&_)!==0)e.flags&131072&&(dh=!0);else return i.lanes=e.lanes,Zi(e,i,_)}return cj(e,i,s,a,_)}function dj(e,i,s){var a=i.pendingProps,_=a.children,$=e!==null?e.memoizedState:null;if(a.mode==="hidden")if(!(i.mode&1))i.memoizedState={baseLanes:0,cachePool:null,transitions:null},G(ej,fj),fj|=s;else{if(!(s&1073741824))return e=$!==null?$.baseLanes|s:s,i.lanes=i.childLanes=1073741824,i.memoizedState={baseLanes:e,cachePool:null,transitions:null},i.updateQueue=null,G(ej,fj),fj|=e,null;i.memoizedState={baseLanes:0,cachePool:null,transitions:null},a=$!==null?$.baseLanes:s,G(ej,fj),fj|=a}else $!==null?(a=$.baseLanes|s,i.memoizedState=null):a=s,G(ej,fj),fj|=a;return Xi(e,i,_,s),i.child}function gj(e,i){var s=i.ref;(e===null&&s!==null||e!==null&&e.ref!==s)&&(i.flags|=512,i.flags|=2097152)}function cj(e,i,s,a,_){var $=Zf(s)?Xf:H.current;return $=Yf(i,$),ch(i,_),s=Nh(e,i,s,a,$,_),a=Sh(),e!==null&&!dh?(i.updateQueue=e.updateQueue,i.flags&=-2053,e.lanes&=~_,Zi(e,i,_)):(I&&a&&vg(i),i.flags|=1,Xi(e,i,s,_),i.child)}function hj(e,i,s,a,_){if(Zf(s)){var $=!0;cg(i)}else $=!1;if(ch(i,_),i.stateNode===null)ij(e,i),Gi(i,s,a),Ii(i,s,a,_),a=!0;else if(e===null){var rt=i.stateNode,c=i.memoizedProps;rt.props=c;var dt=rt.context,ht=s.contextType;typeof ht=="object"&&ht!==null?ht=eh(ht):(ht=Zf(s)?Xf:H.current,ht=Yf(i,ht));var Et=s.getDerivedStateFromProps,St=typeof Et=="function"||typeof rt.getSnapshotBeforeUpdate=="function";St||typeof rt.UNSAFE_componentWillReceiveProps!="function"&&typeof rt.componentWillReceiveProps!="function"||(c!==a||dt!==ht)&&Hi(i,rt,a,ht),jh=!1;var At=i.memoizedState;rt.state=At,qh(i,a,rt,_),dt=i.memoizedState,c!==a||At!==dt||Wf.current||jh?(typeof Et=="function"&&(Di(i,s,Et,a),dt=i.memoizedState),(c=jh||Fi(i,s,c,a,At,dt,ht))?(St||typeof rt.UNSAFE_componentWillMount!="function"&&typeof rt.componentWillMount!="function"||(typeof rt.componentWillMount=="function"&&rt.componentWillMount(),typeof rt.UNSAFE_componentWillMount=="function"&&rt.UNSAFE_componentWillMount()),typeof rt.componentDidMount=="function"&&(i.flags|=4194308)):(typeof rt.componentDidMount=="function"&&(i.flags|=4194308),i.memoizedProps=a,i.memoizedState=dt),rt.props=a,rt.state=dt,rt.context=ht,a=c):(typeof rt.componentDidMount=="function"&&(i.flags|=4194308),a=!1)}else{rt=i.stateNode,lh(e,i),c=i.memoizedProps,ht=i.type===i.elementType?c:Ci(i.type,c),rt.props=ht,St=i.pendingProps,At=rt.context,dt=s.contextType,typeof dt=="object"&&dt!==null?dt=eh(dt):(dt=Zf(s)?Xf:H.current,dt=Yf(i,dt));var Pt=s.getDerivedStateFromProps;(Et=typeof Pt=="function"||typeof rt.getSnapshotBeforeUpdate=="function")||typeof rt.UNSAFE_componentWillReceiveProps!="function"&&typeof rt.componentWillReceiveProps!="function"||(c!==St||At!==dt)&&Hi(i,rt,a,dt),jh=!1,At=i.memoizedState,rt.state=At,qh(i,a,rt,_);var Vt=i.memoizedState;c!==St||At!==Vt||Wf.current||jh?(typeof Pt=="function"&&(Di(i,s,Pt,a),Vt=i.memoizedState),(ht=jh||Fi(i,s,ht,a,At,Vt,dt)||!1)?(Et||typeof rt.UNSAFE_componentWillUpdate!="function"&&typeof rt.componentWillUpdate!="function"||(typeof rt.componentWillUpdate=="function"&&rt.componentWillUpdate(a,Vt,dt),typeof rt.UNSAFE_componentWillUpdate=="function"&&rt.UNSAFE_componentWillUpdate(a,Vt,dt)),typeof rt.componentDidUpdate=="function"&&(i.flags|=4),typeof rt.getSnapshotBeforeUpdate=="function"&&(i.flags|=1024)):(typeof rt.componentDidUpdate!="function"||c===e.memoizedProps&&At===e.memoizedState||(i.flags|=4),typeof rt.getSnapshotBeforeUpdate!="function"||c===e.memoizedProps&&At===e.memoizedState||(i.flags|=1024),i.memoizedProps=a,i.memoizedState=Vt),rt.props=a,rt.state=Vt,rt.context=dt,a=ht):(typeof rt.componentDidUpdate!="function"||c===e.memoizedProps&&At===e.memoizedState||(i.flags|=4),typeof rt.getSnapshotBeforeUpdate!="function"||c===e.memoizedProps&&At===e.memoizedState||(i.flags|=1024),a=!1)}return jj(e,i,s,a,$,_)}function jj(e,i,s,a,_,$){gj(e,i);var rt=(i.flags&128)!==0;if(!a&&!rt)return _&&dg(i,s,!1),Zi(e,i,$);a=i.stateNode,Wi.current=i;var c=rt&&typeof s.getDerivedStateFromError!="function"?null:a.render();return i.flags|=1,e!==null&&rt?(i.child=Ug(i,e.child,null,$),i.child=Ug(i,null,c,$)):Xi(e,i,c,$),i.memoizedState=a.state,_&&dg(i,s,!0),i.child}function kj(e){var i=e.stateNode;i.pendingContext?ag(e,i.pendingContext,i.pendingContext!==i.context):i.context&&ag(e,i.context,!1),yh(e,i.containerInfo)}function lj(e,i,s,a,_){return Ig(),Jg(_),i.flags|=256,Xi(e,i,s,a),i.child}var mj={dehydrated:null,treeContext:null,retryLane:0};function nj(e){return{baseLanes:e,cachePool:null,transitions:null}}function oj(e,i,s){var a=i.pendingProps,_=L$1.current,$=!1,rt=(i.flags&128)!==0,c;if((c=rt)||(c=e!==null&&e.memoizedState===null?!1:(_&2)!==0),c?($=!0,i.flags&=-129):(e===null||e.memoizedState!==null)&&(_|=1),G(L$1,_&1),e===null)return Eg(i),e=i.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(i.mode&1?e.data==="$!"?i.lanes=8:i.lanes=1073741824:i.lanes=1,null):(rt=a.children,e=a.fallback,$?(a=i.mode,$=i.child,rt={mode:"hidden",children:rt},!(a&1)&&$!==null?($.childLanes=0,$.pendingProps=rt):$=pj(rt,a,0,null),e=Tg(e,a,s,null),$.return=i,e.return=i,$.sibling=e,i.child=$,i.child.memoizedState=nj(s),i.memoizedState=mj,e):qj(i,rt));if(_=e.memoizedState,_!==null&&(c=_.dehydrated,c!==null))return rj(e,i,rt,a,c,_,s);if($){$=a.fallback,rt=i.mode,_=e.child,c=_.sibling;var dt={mode:"hidden",children:a.children};return!(rt&1)&&i.child!==_?(a=i.child,a.childLanes=0,a.pendingProps=dt,i.deletions=null):(a=Pg(_,dt),a.subtreeFlags=_.subtreeFlags&14680064),c!==null?$=Pg(c,$):($=Tg($,rt,s,null),$.flags|=2),$.return=i,a.return=i,a.sibling=$,i.child=a,a=$,$=i.child,rt=e.child.memoizedState,rt=rt===null?nj(s):{baseLanes:rt.baseLanes|s,cachePool:null,transitions:rt.transitions},$.memoizedState=rt,$.childLanes=e.childLanes&~s,i.memoizedState=mj,a}return $=e.child,e=$.sibling,a=Pg($,{mode:"visible",children:a.children}),!(i.mode&1)&&(a.lanes=s),a.return=i,a.sibling=null,e!==null&&(s=i.deletions,s===null?(i.deletions=[e],i.flags|=16):s.push(e)),i.child=a,i.memoizedState=null,a}function qj(e,i){return i=pj({mode:"visible",children:i},e.mode,0,null),i.return=e,e.child=i}function sj(e,i,s,a){return a!==null&&Jg(a),Ug(i,e.child,null,s),e=qj(i,i.pendingProps.children),e.flags|=2,i.memoizedState=null,e}function rj(e,i,s,a,_,$,rt){if(s)return i.flags&256?(i.flags&=-257,a=Ki(Error(p(422))),sj(e,i,rt,a)):i.memoizedState!==null?(i.child=e.child,i.flags|=128,null):($=a.fallback,_=i.mode,a=pj({mode:"visible",children:a.children},_,0,null),$=Tg($,_,rt,null),$.flags|=2,a.return=i,$.return=i,a.sibling=$,i.child=a,i.mode&1&&Ug(i,e.child,null,rt),i.child.memoizedState=nj(rt),i.memoizedState=mj,$);if(!(i.mode&1))return sj(e,i,rt,null);if(_.data==="$!"){if(a=_.nextSibling&&_.nextSibling.dataset,a)var c=a.dgst;return a=c,$=Error(p(419)),a=Ki($,a,void 0),sj(e,i,rt,a)}if(c=(rt&e.childLanes)!==0,dh||c){if(a=Q,a!==null){switch(rt&-rt){case 4:_=2;break;case 16:_=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:_=32;break;case 536870912:_=268435456;break;default:_=0}_=_&(a.suspendedLanes|rt)?0:_,_!==0&&_!==$.retryLane&&($.retryLane=_,ih(e,_),gi(a,e,_,-1))}return tj(),a=Ki(Error(p(421))),sj(e,i,rt,a)}return _.data==="$?"?(i.flags|=128,i.child=e.child,i=uj.bind(null,e),_._reactRetry=i,null):(e=$.treeContext,yg=Lf(_.nextSibling),xg=i,I=!0,zg=null,e!==null&&(og[pg++]=rg,og[pg++]=sg,og[pg++]=qg,rg=e.id,sg=e.overflow,qg=i),i=qj(i,a.children),i.flags|=4096,i)}function vj(e,i,s){e.lanes|=i;var a=e.alternate;a!==null&&(a.lanes|=i),bh(e.return,i,s)}function wj(e,i,s,a,_){var $=e.memoizedState;$===null?e.memoizedState={isBackwards:i,rendering:null,renderingStartTime:0,last:a,tail:s,tailMode:_}:($.isBackwards=i,$.rendering=null,$.renderingStartTime=0,$.last=a,$.tail=s,$.tailMode=_)}function xj(e,i,s){var a=i.pendingProps,_=a.revealOrder,$=a.tail;if(Xi(e,i,a.children,s),a=L$1.current,a&2)a=a&1|2,i.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=i.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&vj(e,s,i);else if(e.tag===19)vj(e,s,i);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===i)break e;for(;e.sibling===null;){if(e.return===null||e.return===i)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}a&=1}if(G(L$1,a),!(i.mode&1))i.memoizedState=null;else switch(_){case"forwards":for(s=i.child,_=null;s!==null;)e=s.alternate,e!==null&&Ch(e)===null&&(_=s),s=s.sibling;s=_,s===null?(_=i.child,i.child=null):(_=s.sibling,s.sibling=null),wj(i,!1,_,s,$);break;case"backwards":for(s=null,_=i.child,i.child=null;_!==null;){if(e=_.alternate,e!==null&&Ch(e)===null){i.child=_;break}e=_.sibling,_.sibling=s,s=_,_=e}wj(i,!0,s,null,$);break;case"together":wj(i,!1,null,null,void 0);break;default:i.memoizedState=null}return i.child}function ij(e,i){!(i.mode&1)&&e!==null&&(e.alternate=null,i.alternate=null,i.flags|=2)}function Zi(e,i,s){if(e!==null&&(i.dependencies=e.dependencies),rh|=i.lanes,!(s&i.childLanes))return null;if(e!==null&&i.child!==e.child)throw Error(p(153));if(i.child!==null){for(e=i.child,s=Pg(e,e.pendingProps),i.child=s,s.return=i;e.sibling!==null;)e=e.sibling,s=s.sibling=Pg(e,e.pendingProps),s.return=i;s.sibling=null}return i.child}function yj(e,i,s){switch(i.tag){case 3:kj(i),Ig();break;case 5:Ah(i);break;case 1:Zf(i.type)&&cg(i);break;case 4:yh(i,i.stateNode.containerInfo);break;case 10:var a=i.type._context,_=i.memoizedProps.value;G(Wg,a._currentValue),a._currentValue=_;break;case 13:if(a=i.memoizedState,a!==null)return a.dehydrated!==null?(G(L$1,L$1.current&1),i.flags|=128,null):s&i.child.childLanes?oj(e,i,s):(G(L$1,L$1.current&1),e=Zi(e,i,s),e!==null?e.sibling:null);G(L$1,L$1.current&1);break;case 19:if(a=(s&i.childLanes)!==0,e.flags&128){if(a)return xj(e,i,s);i.flags|=128}if(_=i.memoizedState,_!==null&&(_.rendering=null,_.tail=null,_.lastEffect=null),G(L$1,L$1.current),a)break;return null;case 22:case 23:return i.lanes=0,dj(e,i,s)}return Zi(e,i,s)}var zj,Aj,Bj,Cj;zj=function(e,i){for(var s=i.child;s!==null;){if(s.tag===5||s.tag===6)e.appendChild(s.stateNode);else if(s.tag!==4&&s.child!==null){s.child.return=s,s=s.child;continue}if(s===i)break;for(;s.sibling===null;){if(s.return===null||s.return===i)return;s=s.return}s.sibling.return=s.return,s=s.sibling}};Aj=function(){};Bj=function(e,i,s,a){var _=e.memoizedProps;if(_!==a){e=i.stateNode,xh(uh.current);var $=null;switch(s){case"input":_=Ya(e,_),a=Ya(e,a),$=[];break;case"select":_=A({},_,{value:void 0}),a=A({},a,{value:void 0}),$=[];break;case"textarea":_=gb(e,_),a=gb(e,a),$=[];break;default:typeof _.onClick!="function"&&typeof a.onClick=="function"&&(e.onclick=Bf)}ub(s,a);var rt;s=null;for(ht in _)if(!a.hasOwnProperty(ht)&&_.hasOwnProperty(ht)&&_[ht]!=null)if(ht==="style"){var c=_[ht];for(rt in c)c.hasOwnProperty(rt)&&(s||(s={}),s[rt]="")}else ht!=="dangerouslySetInnerHTML"&&ht!=="children"&&ht!=="suppressContentEditableWarning"&&ht!=="suppressHydrationWarning"&&ht!=="autoFocus"&&(ea.hasOwnProperty(ht)?$||($=[]):($=$||[]).push(ht,null));for(ht in a){var dt=a[ht];if(c=_!=null?_[ht]:void 0,a.hasOwnProperty(ht)&&dt!==c&&(dt!=null||c!=null))if(ht==="style")if(c){for(rt in c)!c.hasOwnProperty(rt)||dt&&dt.hasOwnProperty(rt)||(s||(s={}),s[rt]="");for(rt in dt)dt.hasOwnProperty(rt)&&c[rt]!==dt[rt]&&(s||(s={}),s[rt]=dt[rt])}else s||($||($=[]),$.push(ht,s)),s=dt;else ht==="dangerouslySetInnerHTML"?(dt=dt?dt.__html:void 0,c=c?c.__html:void 0,dt!=null&&c!==dt&&($=$||[]).push(ht,dt)):ht==="children"?typeof dt!="string"&&typeof dt!="number"||($=$||[]).push(ht,""+dt):ht!=="suppressContentEditableWarning"&&ht!=="suppressHydrationWarning"&&(ea.hasOwnProperty(ht)?(dt!=null&&ht==="onScroll"&&D$1("scroll",e),$||c===dt||($=[])):($=$||[]).push(ht,dt))}s&&($=$||[]).push("style",s);var ht=$;(i.updateQueue=ht)&&(i.flags|=4)}};Cj=function(e,i,s,a){s!==a&&(i.flags|=4)};function Dj(e,i){if(!I)switch(e.tailMode){case"hidden":i=e.tail;for(var s=null;i!==null;)i.alternate!==null&&(s=i),i=i.sibling;s===null?e.tail=null:s.sibling=null;break;case"collapsed":s=e.tail;for(var a=null;s!==null;)s.alternate!==null&&(a=s),s=s.sibling;a===null?i||e.tail===null?e.tail=null:e.tail.sibling=null:a.sibling=null}}function S(e){var i=e.alternate!==null&&e.alternate.child===e.child,s=0,a=0;if(i)for(var _=e.child;_!==null;)s|=_.lanes|_.childLanes,a|=_.subtreeFlags&14680064,a|=_.flags&14680064,_.return=e,_=_.sibling;else for(_=e.child;_!==null;)s|=_.lanes|_.childLanes,a|=_.subtreeFlags,a|=_.flags,_.return=e,_=_.sibling;return e.subtreeFlags|=a,e.childLanes=s,i}function Ej(e,i,s){var a=i.pendingProps;switch(wg(i),i.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return S(i),null;case 1:return Zf(i.type)&&$f(),S(i),null;case 3:return a=i.stateNode,zh(),E$1(Wf),E$1(H),Eh(),a.pendingContext&&(a.context=a.pendingContext,a.pendingContext=null),(e===null||e.child===null)&&(Gg(i)?i.flags|=4:e===null||e.memoizedState.isDehydrated&&!(i.flags&256)||(i.flags|=1024,zg!==null&&(Fj(zg),zg=null))),Aj(e,i),S(i),null;case 5:Bh(i);var _=xh(wh.current);if(s=i.type,e!==null&&i.stateNode!=null)Bj(e,i,s,a,_),e.ref!==i.ref&&(i.flags|=512,i.flags|=2097152);else{if(!a){if(i.stateNode===null)throw Error(p(166));return S(i),null}if(e=xh(uh.current),Gg(i)){a=i.stateNode,s=i.type;var $=i.memoizedProps;switch(a[Of]=i,a[Pf]=$,e=(i.mode&1)!==0,s){case"dialog":D$1("cancel",a),D$1("close",a);break;case"iframe":case"object":case"embed":D$1("load",a);break;case"video":case"audio":for(_=0;_<lf.length;_++)D$1(lf[_],a);break;case"source":D$1("error",a);break;case"img":case"image":case"link":D$1("error",a),D$1("load",a);break;case"details":D$1("toggle",a);break;case"input":Za(a,$),D$1("invalid",a);break;case"select":a._wrapperState={wasMultiple:!!$.multiple},D$1("invalid",a);break;case"textarea":hb(a,$),D$1("invalid",a)}ub(s,$),_=null;for(var rt in $)if($.hasOwnProperty(rt)){var c=$[rt];rt==="children"?typeof c=="string"?a.textContent!==c&&($.suppressHydrationWarning!==!0&&Af(a.textContent,c,e),_=["children",c]):typeof c=="number"&&a.textContent!==""+c&&($.suppressHydrationWarning!==!0&&Af(a.textContent,c,e),_=["children",""+c]):ea.hasOwnProperty(rt)&&c!=null&&rt==="onScroll"&&D$1("scroll",a)}switch(s){case"input":Va(a),db(a,$,!0);break;case"textarea":Va(a),jb(a);break;case"select":case"option":break;default:typeof $.onClick=="function"&&(a.onclick=Bf)}a=_,i.updateQueue=a,a!==null&&(i.flags|=4)}else{rt=_.nodeType===9?_:_.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=kb(s)),e==="http://www.w3.org/1999/xhtml"?s==="script"?(e=rt.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof a.is=="string"?e=rt.createElement(s,{is:a.is}):(e=rt.createElement(s),s==="select"&&(rt=e,a.multiple?rt.multiple=!0:a.size&&(rt.size=a.size))):e=rt.createElementNS(e,s),e[Of]=i,e[Pf]=a,zj(e,i,!1,!1),i.stateNode=e;e:{switch(rt=vb(s,a),s){case"dialog":D$1("cancel",e),D$1("close",e),_=a;break;case"iframe":case"object":case"embed":D$1("load",e),_=a;break;case"video":case"audio":for(_=0;_<lf.length;_++)D$1(lf[_],e);_=a;break;case"source":D$1("error",e),_=a;break;case"img":case"image":case"link":D$1("error",e),D$1("load",e),_=a;break;case"details":D$1("toggle",e),_=a;break;case"input":Za(e,a),_=Ya(e,a),D$1("invalid",e);break;case"option":_=a;break;case"select":e._wrapperState={wasMultiple:!!a.multiple},_=A({},a,{value:void 0}),D$1("invalid",e);break;case"textarea":hb(e,a),_=gb(e,a),D$1("invalid",e);break;default:_=a}ub(s,_),c=_;for($ in c)if(c.hasOwnProperty($)){var dt=c[$];$==="style"?sb(e,dt):$==="dangerouslySetInnerHTML"?(dt=dt?dt.__html:void 0,dt!=null&&nb(e,dt)):$==="children"?typeof dt=="string"?(s!=="textarea"||dt!=="")&&ob(e,dt):typeof dt=="number"&&ob(e,""+dt):$!=="suppressContentEditableWarning"&&$!=="suppressHydrationWarning"&&$!=="autoFocus"&&(ea.hasOwnProperty($)?dt!=null&&$==="onScroll"&&D$1("scroll",e):dt!=null&&ta(e,$,dt,rt))}switch(s){case"input":Va(e),db(e,a,!1);break;case"textarea":Va(e),jb(e);break;case"option":a.value!=null&&e.setAttribute("value",""+Sa(a.value));break;case"select":e.multiple=!!a.multiple,$=a.value,$!=null?fb(e,!!a.multiple,$,!1):a.defaultValue!=null&&fb(e,!!a.multiple,a.defaultValue,!0);break;default:typeof _.onClick=="function"&&(e.onclick=Bf)}switch(s){case"button":case"input":case"select":case"textarea":a=!!a.autoFocus;break e;case"img":a=!0;break e;default:a=!1}}a&&(i.flags|=4)}i.ref!==null&&(i.flags|=512,i.flags|=2097152)}return S(i),null;case 6:if(e&&i.stateNode!=null)Cj(e,i,e.memoizedProps,a);else{if(typeof a!="string"&&i.stateNode===null)throw Error(p(166));if(s=xh(wh.current),xh(uh.current),Gg(i)){if(a=i.stateNode,s=i.memoizedProps,a[Of]=i,($=a.nodeValue!==s)&&(e=xg,e!==null))switch(e.tag){case 3:Af(a.nodeValue,s,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&Af(a.nodeValue,s,(e.mode&1)!==0)}$&&(i.flags|=4)}else a=(s.nodeType===9?s:s.ownerDocument).createTextNode(a),a[Of]=i,i.stateNode=a}return S(i),null;case 13:if(E$1(L$1),a=i.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(I&&yg!==null&&i.mode&1&&!(i.flags&128))Hg(),Ig(),i.flags|=98560,$=!1;else if($=Gg(i),a!==null&&a.dehydrated!==null){if(e===null){if(!$)throw Error(p(318));if($=i.memoizedState,$=$!==null?$.dehydrated:null,!$)throw Error(p(317));$[Of]=i}else Ig(),!(i.flags&128)&&(i.memoizedState=null),i.flags|=4;S(i),$=!1}else zg!==null&&(Fj(zg),zg=null),$=!0;if(!$)return i.flags&65536?i:null}return i.flags&128?(i.lanes=s,i):(a=a!==null,a!==(e!==null&&e.memoizedState!==null)&&a&&(i.child.flags|=8192,i.mode&1&&(e===null||L$1.current&1?T===0&&(T=3):tj())),i.updateQueue!==null&&(i.flags|=4),S(i),null);case 4:return zh(),Aj(e,i),e===null&&sf(i.stateNode.containerInfo),S(i),null;case 10:return ah(i.type._context),S(i),null;case 17:return Zf(i.type)&&$f(),S(i),null;case 19:if(E$1(L$1),$=i.memoizedState,$===null)return S(i),null;if(a=(i.flags&128)!==0,rt=$.rendering,rt===null)if(a)Dj($,!1);else{if(T!==0||e!==null&&e.flags&128)for(e=i.child;e!==null;){if(rt=Ch(e),rt!==null){for(i.flags|=128,Dj($,!1),a=rt.updateQueue,a!==null&&(i.updateQueue=a,i.flags|=4),i.subtreeFlags=0,a=s,s=i.child;s!==null;)$=s,e=a,$.flags&=14680066,rt=$.alternate,rt===null?($.childLanes=0,$.lanes=e,$.child=null,$.subtreeFlags=0,$.memoizedProps=null,$.memoizedState=null,$.updateQueue=null,$.dependencies=null,$.stateNode=null):($.childLanes=rt.childLanes,$.lanes=rt.lanes,$.child=rt.child,$.subtreeFlags=0,$.deletions=null,$.memoizedProps=rt.memoizedProps,$.memoizedState=rt.memoizedState,$.updateQueue=rt.updateQueue,$.type=rt.type,e=rt.dependencies,$.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),s=s.sibling;return G(L$1,L$1.current&1|2),i.child}e=e.sibling}$.tail!==null&&B()>Gj&&(i.flags|=128,a=!0,Dj($,!1),i.lanes=4194304)}else{if(!a)if(e=Ch(rt),e!==null){if(i.flags|=128,a=!0,s=e.updateQueue,s!==null&&(i.updateQueue=s,i.flags|=4),Dj($,!0),$.tail===null&&$.tailMode==="hidden"&&!rt.alternate&&!I)return S(i),null}else 2*B()-$.renderingStartTime>Gj&&s!==1073741824&&(i.flags|=128,a=!0,Dj($,!1),i.lanes=4194304);$.isBackwards?(rt.sibling=i.child,i.child=rt):(s=$.last,s!==null?s.sibling=rt:i.child=rt,$.last=rt)}return $.tail!==null?(i=$.tail,$.rendering=i,$.tail=i.sibling,$.renderingStartTime=B(),i.sibling=null,s=L$1.current,G(L$1,a?s&1|2:s&1),i):(S(i),null);case 22:case 23:return Hj(),a=i.memoizedState!==null,e!==null&&e.memoizedState!==null!==a&&(i.flags|=8192),a&&i.mode&1?fj&1073741824&&(S(i),i.subtreeFlags&6&&(i.flags|=8192)):S(i),null;case 24:return null;case 25:return null}throw Error(p(156,i.tag))}function Ij(e,i){switch(wg(i),i.tag){case 1:return Zf(i.type)&&$f(),e=i.flags,e&65536?(i.flags=e&-65537|128,i):null;case 3:return zh(),E$1(Wf),E$1(H),Eh(),e=i.flags,e&65536&&!(e&128)?(i.flags=e&-65537|128,i):null;case 5:return Bh(i),null;case 13:if(E$1(L$1),e=i.memoizedState,e!==null&&e.dehydrated!==null){if(i.alternate===null)throw Error(p(340));Ig()}return e=i.flags,e&65536?(i.flags=e&-65537|128,i):null;case 19:return E$1(L$1),null;case 4:return zh(),null;case 10:return ah(i.type._context),null;case 22:case 23:return Hj(),null;case 24:return null;default:return null}}var Jj=!1,U=!1,Kj=typeof WeakSet=="function"?WeakSet:Set,V=null;function Lj(e,i){var s=e.ref;if(s!==null)if(typeof s=="function")try{s(null)}catch(a){W(e,i,a)}else s.current=null}function Mj(e,i,s){try{s()}catch(a){W(e,i,a)}}var Nj=!1;function Oj(e,i){if(Cf=dd,e=Me(),Ne(e)){if("selectionStart"in e)var s={start:e.selectionStart,end:e.selectionEnd};else e:{s=(s=e.ownerDocument)&&s.defaultView||window;var a=s.getSelection&&s.getSelection();if(a&&a.rangeCount!==0){s=a.anchorNode;var _=a.anchorOffset,$=a.focusNode;a=a.focusOffset;try{s.nodeType,$.nodeType}catch{s=null;break e}var rt=0,c=-1,dt=-1,ht=0,Et=0,St=e,At=null;t:for(;;){for(var Pt;St!==s||_!==0&&St.nodeType!==3||(c=rt+_),St!==$||a!==0&&St.nodeType!==3||(dt=rt+a),St.nodeType===3&&(rt+=St.nodeValue.length),(Pt=St.firstChild)!==null;)At=St,St=Pt;for(;;){if(St===e)break t;if(At===s&&++ht===_&&(c=rt),At===$&&++Et===a&&(dt=rt),(Pt=St.nextSibling)!==null)break;St=At,At=St.parentNode}St=Pt}s=c===-1||dt===-1?null:{start:c,end:dt}}else s=null}s=s||{start:0,end:0}}else s=null;for(Df={focusedElem:e,selectionRange:s},dd=!1,V=i;V!==null;)if(i=V,e=i.child,(i.subtreeFlags&1028)!==0&&e!==null)e.return=i,V=e;else for(;V!==null;){i=V;try{var Vt=i.alternate;if(i.flags&1024)switch(i.tag){case 0:case 11:case 15:break;case 1:if(Vt!==null){var Bt=Vt.memoizedProps,Zt=Vt.memoizedState,zt=i.stateNode,Ut=zt.getSnapshotBeforeUpdate(i.elementType===i.type?Bt:Ci(i.type,Bt),Zt);zt.__reactInternalSnapshotBeforeUpdate=Ut}break;case 3:var Nt=i.stateNode.containerInfo;Nt.nodeType===1?Nt.textContent="":Nt.nodeType===9&&Nt.documentElement&&Nt.removeChild(Nt.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(p(163))}}catch(Gt){W(i,i.return,Gt)}if(e=i.sibling,e!==null){e.return=i.return,V=e;break}V=i.return}return Vt=Nj,Nj=!1,Vt}function Pj(e,i,s){var a=i.updateQueue;if(a=a!==null?a.lastEffect:null,a!==null){var _=a=a.next;do{if((_.tag&e)===e){var $=_.destroy;_.destroy=void 0,$!==void 0&&Mj(i,s,$)}_=_.next}while(_!==a)}}function Qj(e,i){if(i=i.updateQueue,i=i!==null?i.lastEffect:null,i!==null){var s=i=i.next;do{if((s.tag&e)===e){var a=s.create;s.destroy=a()}s=s.next}while(s!==i)}}function Rj(e){var i=e.ref;if(i!==null){var s=e.stateNode;switch(e.tag){case 5:e=s;break;default:e=s}typeof i=="function"?i(e):i.current=e}}function Sj(e){var i=e.alternate;i!==null&&(e.alternate=null,Sj(i)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(i=e.stateNode,i!==null&&(delete i[Of],delete i[Pf],delete i[of],delete i[Qf],delete i[Rf])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function Tj(e){return e.tag===5||e.tag===3||e.tag===4}function Uj(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||Tj(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Vj(e,i,s){var a=e.tag;if(a===5||a===6)e=e.stateNode,i?s.nodeType===8?s.parentNode.insertBefore(e,i):s.insertBefore(e,i):(s.nodeType===8?(i=s.parentNode,i.insertBefore(e,s)):(i=s,i.appendChild(e)),s=s._reactRootContainer,s!=null||i.onclick!==null||(i.onclick=Bf));else if(a!==4&&(e=e.child,e!==null))for(Vj(e,i,s),e=e.sibling;e!==null;)Vj(e,i,s),e=e.sibling}function Wj(e,i,s){var a=e.tag;if(a===5||a===6)e=e.stateNode,i?s.insertBefore(e,i):s.appendChild(e);else if(a!==4&&(e=e.child,e!==null))for(Wj(e,i,s),e=e.sibling;e!==null;)Wj(e,i,s),e=e.sibling}var X$1=null,Xj=!1;function Yj(e,i,s){for(s=s.child;s!==null;)Zj(e,i,s),s=s.sibling}function Zj(e,i,s){if(lc&&typeof lc.onCommitFiberUnmount=="function")try{lc.onCommitFiberUnmount(kc,s)}catch{}switch(s.tag){case 5:U||Lj(s,i);case 6:var a=X$1,_=Xj;X$1=null,Yj(e,i,s),X$1=a,Xj=_,X$1!==null&&(Xj?(e=X$1,s=s.stateNode,e.nodeType===8?e.parentNode.removeChild(s):e.removeChild(s)):X$1.removeChild(s.stateNode));break;case 18:X$1!==null&&(Xj?(e=X$1,s=s.stateNode,e.nodeType===8?Kf(e.parentNode,s):e.nodeType===1&&Kf(e,s),bd(e)):Kf(X$1,s.stateNode));break;case 4:a=X$1,_=Xj,X$1=s.stateNode.containerInfo,Xj=!0,Yj(e,i,s),X$1=a,Xj=_;break;case 0:case 11:case 14:case 15:if(!U&&(a=s.updateQueue,a!==null&&(a=a.lastEffect,a!==null))){_=a=a.next;do{var $=_,rt=$.destroy;$=$.tag,rt!==void 0&&($&2||$&4)&&Mj(s,i,rt),_=_.next}while(_!==a)}Yj(e,i,s);break;case 1:if(!U&&(Lj(s,i),a=s.stateNode,typeof a.componentWillUnmount=="function"))try{a.props=s.memoizedProps,a.state=s.memoizedState,a.componentWillUnmount()}catch(c){W(s,i,c)}Yj(e,i,s);break;case 21:Yj(e,i,s);break;case 22:s.mode&1?(U=(a=U)||s.memoizedState!==null,Yj(e,i,s),U=a):Yj(e,i,s);break;default:Yj(e,i,s)}}function ak(e){var i=e.updateQueue;if(i!==null){e.updateQueue=null;var s=e.stateNode;s===null&&(s=e.stateNode=new Kj),i.forEach(function(a){var _=bk.bind(null,e,a);s.has(a)||(s.add(a),a.then(_,_))})}}function ck(e,i){var s=i.deletions;if(s!==null)for(var a=0;a<s.length;a++){var _=s[a];try{var $=e,rt=i,c=rt;e:for(;c!==null;){switch(c.tag){case 5:X$1=c.stateNode,Xj=!1;break e;case 3:X$1=c.stateNode.containerInfo,Xj=!0;break e;case 4:X$1=c.stateNode.containerInfo,Xj=!0;break e}c=c.return}if(X$1===null)throw Error(p(160));Zj($,rt,_),X$1=null,Xj=!1;var dt=_.alternate;dt!==null&&(dt.return=null),_.return=null}catch(ht){W(_,i,ht)}}if(i.subtreeFlags&12854)for(i=i.child;i!==null;)dk(i,e),i=i.sibling}function dk(e,i){var s=e.alternate,a=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(ck(i,e),ek(e),a&4){try{Pj(3,e,e.return),Qj(3,e)}catch(Bt){W(e,e.return,Bt)}try{Pj(5,e,e.return)}catch(Bt){W(e,e.return,Bt)}}break;case 1:ck(i,e),ek(e),a&512&&s!==null&&Lj(s,s.return);break;case 5:if(ck(i,e),ek(e),a&512&&s!==null&&Lj(s,s.return),e.flags&32){var _=e.stateNode;try{ob(_,"")}catch(Bt){W(e,e.return,Bt)}}if(a&4&&(_=e.stateNode,_!=null)){var $=e.memoizedProps,rt=s!==null?s.memoizedProps:$,c=e.type,dt=e.updateQueue;if(e.updateQueue=null,dt!==null)try{c==="input"&&$.type==="radio"&&$.name!=null&&ab(_,$),vb(c,rt);var ht=vb(c,$);for(rt=0;rt<dt.length;rt+=2){var Et=dt[rt],St=dt[rt+1];Et==="style"?sb(_,St):Et==="dangerouslySetInnerHTML"?nb(_,St):Et==="children"?ob(_,St):ta(_,Et,St,ht)}switch(c){case"input":bb(_,$);break;case"textarea":ib(_,$);break;case"select":var At=_._wrapperState.wasMultiple;_._wrapperState.wasMultiple=!!$.multiple;var Pt=$.value;Pt!=null?fb(_,!!$.multiple,Pt,!1):At!==!!$.multiple&&($.defaultValue!=null?fb(_,!!$.multiple,$.defaultValue,!0):fb(_,!!$.multiple,$.multiple?[]:"",!1))}_[Pf]=$}catch(Bt){W(e,e.return,Bt)}}break;case 6:if(ck(i,e),ek(e),a&4){if(e.stateNode===null)throw Error(p(162));_=e.stateNode,$=e.memoizedProps;try{_.nodeValue=$}catch(Bt){W(e,e.return,Bt)}}break;case 3:if(ck(i,e),ek(e),a&4&&s!==null&&s.memoizedState.isDehydrated)try{bd(i.containerInfo)}catch(Bt){W(e,e.return,Bt)}break;case 4:ck(i,e),ek(e);break;case 13:ck(i,e),ek(e),_=e.child,_.flags&8192&&($=_.memoizedState!==null,_.stateNode.isHidden=$,!$||_.alternate!==null&&_.alternate.memoizedState!==null||(fk=B())),a&4&&ak(e);break;case 22:if(Et=s!==null&&s.memoizedState!==null,e.mode&1?(U=(ht=U)||Et,ck(i,e),U=ht):ck(i,e),ek(e),a&8192){if(ht=e.memoizedState!==null,(e.stateNode.isHidden=ht)&&!Et&&e.mode&1)for(V=e,Et=e.child;Et!==null;){for(St=V=Et;V!==null;){switch(At=V,Pt=At.child,At.tag){case 0:case 11:case 14:case 15:Pj(4,At,At.return);break;case 1:Lj(At,At.return);var Vt=At.stateNode;if(typeof Vt.componentWillUnmount=="function"){a=At,s=At.return;try{i=a,Vt.props=i.memoizedProps,Vt.state=i.memoizedState,Vt.componentWillUnmount()}catch(Bt){W(a,s,Bt)}}break;case 5:Lj(At,At.return);break;case 22:if(At.memoizedState!==null){gk(St);continue}}Pt!==null?(Pt.return=At,V=Pt):gk(St)}Et=Et.sibling}e:for(Et=null,St=e;;){if(St.tag===5){if(Et===null){Et=St;try{_=St.stateNode,ht?($=_.style,typeof $.setProperty=="function"?$.setProperty("display","none","important"):$.display="none"):(c=St.stateNode,dt=St.memoizedProps.style,rt=dt!=null&&dt.hasOwnProperty("display")?dt.display:null,c.style.display=rb("display",rt))}catch(Bt){W(e,e.return,Bt)}}}else if(St.tag===6){if(Et===null)try{St.stateNode.nodeValue=ht?"":St.memoizedProps}catch(Bt){W(e,e.return,Bt)}}else if((St.tag!==22&&St.tag!==23||St.memoizedState===null||St===e)&&St.child!==null){St.child.return=St,St=St.child;continue}if(St===e)break e;for(;St.sibling===null;){if(St.return===null||St.return===e)break e;Et===St&&(Et=null),St=St.return}Et===St&&(Et=null),St.sibling.return=St.return,St=St.sibling}}break;case 19:ck(i,e),ek(e),a&4&&ak(e);break;case 21:break;default:ck(i,e),ek(e)}}function ek(e){var i=e.flags;if(i&2){try{e:{for(var s=e.return;s!==null;){if(Tj(s)){var a=s;break e}s=s.return}throw Error(p(160))}switch(a.tag){case 5:var _=a.stateNode;a.flags&32&&(ob(_,""),a.flags&=-33);var $=Uj(e);Wj(e,$,_);break;case 3:case 4:var rt=a.stateNode.containerInfo,c=Uj(e);Vj(e,c,rt);break;default:throw Error(p(161))}}catch(dt){W(e,e.return,dt)}e.flags&=-3}i&4096&&(e.flags&=-4097)}function hk(e,i,s){V=e,ik(e)}function ik(e,i,s){for(var a=(e.mode&1)!==0;V!==null;){var _=V,$=_.child;if(_.tag===22&&a){var rt=_.memoizedState!==null||Jj;if(!rt){var c=_.alternate,dt=c!==null&&c.memoizedState!==null||U;c=Jj;var ht=U;if(Jj=rt,(U=dt)&&!ht)for(V=_;V!==null;)rt=V,dt=rt.child,rt.tag===22&&rt.memoizedState!==null?jk(_):dt!==null?(dt.return=rt,V=dt):jk(_);for(;$!==null;)V=$,ik($),$=$.sibling;V=_,Jj=c,U=ht}kk(e)}else _.subtreeFlags&8772&&$!==null?($.return=_,V=$):kk(e)}}function kk(e){for(;V!==null;){var i=V;if(i.flags&8772){var s=i.alternate;try{if(i.flags&8772)switch(i.tag){case 0:case 11:case 15:U||Qj(5,i);break;case 1:var a=i.stateNode;if(i.flags&4&&!U)if(s===null)a.componentDidMount();else{var _=i.elementType===i.type?s.memoizedProps:Ci(i.type,s.memoizedProps);a.componentDidUpdate(_,s.memoizedState,a.__reactInternalSnapshotBeforeUpdate)}var $=i.updateQueue;$!==null&&sh(i,$,a);break;case 3:var rt=i.updateQueue;if(rt!==null){if(s=null,i.child!==null)switch(i.child.tag){case 5:s=i.child.stateNode;break;case 1:s=i.child.stateNode}sh(i,rt,s)}break;case 5:var c=i.stateNode;if(s===null&&i.flags&4){s=c;var dt=i.memoizedProps;switch(i.type){case"button":case"input":case"select":case"textarea":dt.autoFocus&&s.focus();break;case"img":dt.src&&(s.src=dt.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(i.memoizedState===null){var ht=i.alternate;if(ht!==null){var Et=ht.memoizedState;if(Et!==null){var St=Et.dehydrated;St!==null&&bd(St)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(p(163))}U||i.flags&512&&Rj(i)}catch(At){W(i,i.return,At)}}if(i===e){V=null;break}if(s=i.sibling,s!==null){s.return=i.return,V=s;break}V=i.return}}function gk(e){for(;V!==null;){var i=V;if(i===e){V=null;break}var s=i.sibling;if(s!==null){s.return=i.return,V=s;break}V=i.return}}function jk(e){for(;V!==null;){var i=V;try{switch(i.tag){case 0:case 11:case 15:var s=i.return;try{Qj(4,i)}catch(dt){W(i,s,dt)}break;case 1:var a=i.stateNode;if(typeof a.componentDidMount=="function"){var _=i.return;try{a.componentDidMount()}catch(dt){W(i,_,dt)}}var $=i.return;try{Rj(i)}catch(dt){W(i,$,dt)}break;case 5:var rt=i.return;try{Rj(i)}catch(dt){W(i,rt,dt)}}}catch(dt){W(i,i.return,dt)}if(i===e){V=null;break}var c=i.sibling;if(c!==null){c.return=i.return,V=c;break}V=i.return}}var lk=Math.ceil,mk=ua.ReactCurrentDispatcher,nk=ua.ReactCurrentOwner,ok=ua.ReactCurrentBatchConfig,K=0,Q=null,Y=null,Z=0,fj=0,ej=Uf(0),T=0,pk=null,rh=0,qk=0,rk=0,sk=null,tk=null,fk=0,Gj=1/0,uk=null,Oi=!1,Pi=null,Ri=null,vk=!1,wk=null,xk=0,yk=0,zk=null,Ak=-1,Bk=0;function R(){return K&6?B():Ak!==-1?Ak:Ak=B()}function yi(e){return e.mode&1?K&2&&Z!==0?Z&-Z:Kg.transition!==null?(Bk===0&&(Bk=yc()),Bk):(e=C,e!==0||(e=window.event,e=e===void 0?16:jd(e.type)),e):1}function gi(e,i,s,a){if(50<yk)throw yk=0,zk=null,Error(p(185));Ac(e,s,a),(!(K&2)||e!==Q)&&(e===Q&&(!(K&2)&&(qk|=s),T===4&&Ck(e,Z)),Dk(e,a),s===1&&K===0&&!(i.mode&1)&&(Gj=B()+500,fg&&jg()))}function Dk(e,i){var s=e.callbackNode;wc(e,i);var a=uc(e,e===Q?Z:0);if(a===0)s!==null&&bc(s),e.callbackNode=null,e.callbackPriority=0;else if(i=a&-a,e.callbackPriority!==i){if(s!=null&&bc(s),i===1)e.tag===0?ig(Ek.bind(null,e)):hg(Ek.bind(null,e)),Jf(function(){!(K&6)&&jg()}),s=null;else{switch(Dc(a)){case 1:s=fc;break;case 4:s=gc;break;case 16:s=hc;break;case 536870912:s=jc;break;default:s=hc}s=Fk(s,Gk.bind(null,e))}e.callbackPriority=i,e.callbackNode=s}}function Gk(e,i){if(Ak=-1,Bk=0,K&6)throw Error(p(327));var s=e.callbackNode;if(Hk()&&e.callbackNode!==s)return null;var a=uc(e,e===Q?Z:0);if(a===0)return null;if(a&30||a&e.expiredLanes||i)i=Ik(e,a);else{i=a;var _=K;K|=2;var $=Jk();(Q!==e||Z!==i)&&(uk=null,Gj=B()+500,Kk(e,i));do try{Lk();break}catch(c){Mk(e,c)}while(!0);$g(),mk.current=$,K=_,Y!==null?i=0:(Q=null,Z=0,i=T)}if(i!==0){if(i===2&&(_=xc(e),_!==0&&(a=_,i=Nk(e,_))),i===1)throw s=pk,Kk(e,0),Ck(e,a),Dk(e,B()),s;if(i===6)Ck(e,a);else{if(_=e.current.alternate,!(a&30)&&!Ok(_)&&(i=Ik(e,a),i===2&&($=xc(e),$!==0&&(a=$,i=Nk(e,$))),i===1))throw s=pk,Kk(e,0),Ck(e,a),Dk(e,B()),s;switch(e.finishedWork=_,e.finishedLanes=a,i){case 0:case 1:throw Error(p(345));case 2:Pk(e,tk,uk);break;case 3:if(Ck(e,a),(a&130023424)===a&&(i=fk+500-B(),10<i)){if(uc(e,0)!==0)break;if(_=e.suspendedLanes,(_&a)!==a){R(),e.pingedLanes|=e.suspendedLanes&_;break}e.timeoutHandle=Ff(Pk.bind(null,e,tk,uk),i);break}Pk(e,tk,uk);break;case 4:if(Ck(e,a),(a&4194240)===a)break;for(i=e.eventTimes,_=-1;0<a;){var rt=31-oc(a);$=1<<rt,rt=i[rt],rt>_&&(_=rt),a&=~$}if(a=_,a=B()-a,a=(120>a?120:480>a?480:1080>a?1080:1920>a?1920:3e3>a?3e3:4320>a?4320:1960*lk(a/1960))-a,10<a){e.timeoutHandle=Ff(Pk.bind(null,e,tk,uk),a);break}Pk(e,tk,uk);break;case 5:Pk(e,tk,uk);break;default:throw Error(p(329))}}}return Dk(e,B()),e.callbackNode===s?Gk.bind(null,e):null}function Nk(e,i){var s=sk;return e.current.memoizedState.isDehydrated&&(Kk(e,i).flags|=256),e=Ik(e,i),e!==2&&(i=tk,tk=s,i!==null&&Fj(i)),e}function Fj(e){tk===null?tk=e:tk.push.apply(tk,e)}function Ok(e){for(var i=e;;){if(i.flags&16384){var s=i.updateQueue;if(s!==null&&(s=s.stores,s!==null))for(var a=0;a<s.length;a++){var _=s[a],$=_.getSnapshot;_=_.value;try{if(!He($(),_))return!1}catch{return!1}}}if(s=i.child,i.subtreeFlags&16384&&s!==null)s.return=i,i=s;else{if(i===e)break;for(;i.sibling===null;){if(i.return===null||i.return===e)return!0;i=i.return}i.sibling.return=i.return,i=i.sibling}}return!0}function Ck(e,i){for(i&=~rk,i&=~qk,e.suspendedLanes|=i,e.pingedLanes&=~i,e=e.expirationTimes;0<i;){var s=31-oc(i),a=1<<s;e[s]=-1,i&=~a}}function Ek(e){if(K&6)throw Error(p(327));Hk();var i=uc(e,0);if(!(i&1))return Dk(e,B()),null;var s=Ik(e,i);if(e.tag!==0&&s===2){var a=xc(e);a!==0&&(i=a,s=Nk(e,a))}if(s===1)throw s=pk,Kk(e,0),Ck(e,i),Dk(e,B()),s;if(s===6)throw Error(p(345));return e.finishedWork=e.current.alternate,e.finishedLanes=i,Pk(e,tk,uk),Dk(e,B()),null}function Qk(e,i){var s=K;K|=1;try{return e(i)}finally{K=s,K===0&&(Gj=B()+500,fg&&jg())}}function Rk(e){wk!==null&&wk.tag===0&&!(K&6)&&Hk();var i=K;K|=1;var s=ok.transition,a=C;try{if(ok.transition=null,C=1,e)return e()}finally{C=a,ok.transition=s,K=i,!(K&6)&&jg()}}function Hj(){fj=ej.current,E$1(ej)}function Kk(e,i){e.finishedWork=null,e.finishedLanes=0;var s=e.timeoutHandle;if(s!==-1&&(e.timeoutHandle=-1,Gf(s)),Y!==null)for(s=Y.return;s!==null;){var a=s;switch(wg(a),a.tag){case 1:a=a.type.childContextTypes,a!=null&&$f();break;case 3:zh(),E$1(Wf),E$1(H),Eh();break;case 5:Bh(a);break;case 4:zh();break;case 13:E$1(L$1);break;case 19:E$1(L$1);break;case 10:ah(a.type._context);break;case 22:case 23:Hj()}s=s.return}if(Q=e,Y=e=Pg(e.current,null),Z=fj=i,T=0,pk=null,rk=qk=rh=0,tk=sk=null,fh!==null){for(i=0;i<fh.length;i++)if(s=fh[i],a=s.interleaved,a!==null){s.interleaved=null;var _=a.next,$=s.pending;if($!==null){var rt=$.next;$.next=_,a.next=rt}s.pending=a}fh=null}return e}function Mk(e,i){do{var s=Y;try{if($g(),Fh.current=Rh,Ih){for(var a=M$1.memoizedState;a!==null;){var _=a.queue;_!==null&&(_.pending=null),a=a.next}Ih=!1}if(Hh=0,O=N=M$1=null,Jh=!1,Kh=0,nk.current=null,s===null||s.return===null){T=1,pk=i,Y=null;break}e:{var $=e,rt=s.return,c=s,dt=i;if(i=Z,c.flags|=32768,dt!==null&&typeof dt=="object"&&typeof dt.then=="function"){var ht=dt,Et=c,St=Et.tag;if(!(Et.mode&1)&&(St===0||St===11||St===15)){var At=Et.alternate;At?(Et.updateQueue=At.updateQueue,Et.memoizedState=At.memoizedState,Et.lanes=At.lanes):(Et.updateQueue=null,Et.memoizedState=null)}var Pt=Ui(rt);if(Pt!==null){Pt.flags&=-257,Vi(Pt,rt,c,$,i),Pt.mode&1&&Si($,ht,i),i=Pt,dt=ht;var Vt=i.updateQueue;if(Vt===null){var Bt=new Set;Bt.add(dt),i.updateQueue=Bt}else Vt.add(dt);break e}else{if(!(i&1)){Si($,ht,i),tj();break e}dt=Error(p(426))}}else if(I&&c.mode&1){var Zt=Ui(rt);if(Zt!==null){!(Zt.flags&65536)&&(Zt.flags|=256),Vi(Zt,rt,c,$,i),Jg(Ji(dt,c));break e}}$=dt=Ji(dt,c),T!==4&&(T=2),sk===null?sk=[$]:sk.push($),$=rt;do{switch($.tag){case 3:$.flags|=65536,i&=-i,$.lanes|=i;var zt=Ni($,dt,i);ph($,zt);break e;case 1:c=dt;var Ut=$.type,Nt=$.stateNode;if(!($.flags&128)&&(typeof Ut.getDerivedStateFromError=="function"||Nt!==null&&typeof Nt.componentDidCatch=="function"&&(Ri===null||!Ri.has(Nt)))){$.flags|=65536,i&=-i,$.lanes|=i;var Gt=Qi($,c,i);ph($,Gt);break e}}$=$.return}while($!==null)}Sk(s)}catch(er){i=er,Y===s&&s!==null&&(Y=s=s.return);continue}break}while(!0)}function Jk(){var e=mk.current;return mk.current=Rh,e===null?Rh:e}function tj(){(T===0||T===3||T===2)&&(T=4),Q===null||!(rh&268435455)&&!(qk&268435455)||Ck(Q,Z)}function Ik(e,i){var s=K;K|=2;var a=Jk();(Q!==e||Z!==i)&&(uk=null,Kk(e,i));do try{Tk();break}catch(_){Mk(e,_)}while(!0);if($g(),K=s,mk.current=a,Y!==null)throw Error(p(261));return Q=null,Z=0,T}function Tk(){for(;Y!==null;)Uk(Y)}function Lk(){for(;Y!==null&&!cc();)Uk(Y)}function Uk(e){var i=Vk(e.alternate,e,fj);e.memoizedProps=e.pendingProps,i===null?Sk(e):Y=i,nk.current=null}function Sk(e){var i=e;do{var s=i.alternate;if(e=i.return,i.flags&32768){if(s=Ij(s,i),s!==null){s.flags&=32767,Y=s;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{T=6,Y=null;return}}else if(s=Ej(s,i,fj),s!==null){Y=s;return}if(i=i.sibling,i!==null){Y=i;return}Y=i=e}while(i!==null);T===0&&(T=5)}function Pk(e,i,s){var a=C,_=ok.transition;try{ok.transition=null,C=1,Wk(e,i,s,a)}finally{ok.transition=_,C=a}return null}function Wk(e,i,s,a){do Hk();while(wk!==null);if(K&6)throw Error(p(327));s=e.finishedWork;var _=e.finishedLanes;if(s===null)return null;if(e.finishedWork=null,e.finishedLanes=0,s===e.current)throw Error(p(177));e.callbackNode=null,e.callbackPriority=0;var $=s.lanes|s.childLanes;if(Bc(e,$),e===Q&&(Y=Q=null,Z=0),!(s.subtreeFlags&2064)&&!(s.flags&2064)||vk||(vk=!0,Fk(hc,function(){return Hk(),null})),$=(s.flags&15990)!==0,s.subtreeFlags&15990||$){$=ok.transition,ok.transition=null;var rt=C;C=1;var c=K;K|=4,nk.current=null,Oj(e,s),dk(s,e),Oe(Df),dd=!!Cf,Df=Cf=null,e.current=s,hk(s),dc(),K=c,C=rt,ok.transition=$}else e.current=s;if(vk&&(vk=!1,wk=e,xk=_),$=e.pendingLanes,$===0&&(Ri=null),mc(s.stateNode),Dk(e,B()),i!==null)for(a=e.onRecoverableError,s=0;s<i.length;s++)_=i[s],a(_.value,{componentStack:_.stack,digest:_.digest});if(Oi)throw Oi=!1,e=Pi,Pi=null,e;return xk&1&&e.tag!==0&&Hk(),$=e.pendingLanes,$&1?e===zk?yk++:(yk=0,zk=e):yk=0,jg(),null}function Hk(){if(wk!==null){var e=Dc(xk),i=ok.transition,s=C;try{if(ok.transition=null,C=16>e?16:e,wk===null)var a=!1;else{if(e=wk,wk=null,xk=0,K&6)throw Error(p(331));var _=K;for(K|=4,V=e.current;V!==null;){var $=V,rt=$.child;if(V.flags&16){var c=$.deletions;if(c!==null){for(var dt=0;dt<c.length;dt++){var ht=c[dt];for(V=ht;V!==null;){var Et=V;switch(Et.tag){case 0:case 11:case 15:Pj(8,Et,$)}var St=Et.child;if(St!==null)St.return=Et,V=St;else for(;V!==null;){Et=V;var At=Et.sibling,Pt=Et.return;if(Sj(Et),Et===ht){V=null;break}if(At!==null){At.return=Pt,V=At;break}V=Pt}}}var Vt=$.alternate;if(Vt!==null){var Bt=Vt.child;if(Bt!==null){Vt.child=null;do{var Zt=Bt.sibling;Bt.sibling=null,Bt=Zt}while(Bt!==null)}}V=$}}if($.subtreeFlags&2064&&rt!==null)rt.return=$,V=rt;else e:for(;V!==null;){if($=V,$.flags&2048)switch($.tag){case 0:case 11:case 15:Pj(9,$,$.return)}var zt=$.sibling;if(zt!==null){zt.return=$.return,V=zt;break e}V=$.return}}var Ut=e.current;for(V=Ut;V!==null;){rt=V;var Nt=rt.child;if(rt.subtreeFlags&2064&&Nt!==null)Nt.return=rt,V=Nt;else e:for(rt=Ut;V!==null;){if(c=V,c.flags&2048)try{switch(c.tag){case 0:case 11:case 15:Qj(9,c)}}catch(er){W(c,c.return,er)}if(c===rt){V=null;break e}var Gt=c.sibling;if(Gt!==null){Gt.return=c.return,V=Gt;break e}V=c.return}}if(K=_,jg(),lc&&typeof lc.onPostCommitFiberRoot=="function")try{lc.onPostCommitFiberRoot(kc,e)}catch{}a=!0}return a}finally{C=s,ok.transition=i}}return!1}function Xk(e,i,s){i=Ji(s,i),i=Ni(e,i,1),e=nh(e,i,1),i=R(),e!==null&&(Ac(e,1,i),Dk(e,i))}function W(e,i,s){if(e.tag===3)Xk(e,e,s);else for(;i!==null;){if(i.tag===3){Xk(i,e,s);break}else if(i.tag===1){var a=i.stateNode;if(typeof i.type.getDerivedStateFromError=="function"||typeof a.componentDidCatch=="function"&&(Ri===null||!Ri.has(a))){e=Ji(s,e),e=Qi(i,e,1),i=nh(i,e,1),e=R(),i!==null&&(Ac(i,1,e),Dk(i,e));break}}i=i.return}}function Ti(e,i,s){var a=e.pingCache;a!==null&&a.delete(i),i=R(),e.pingedLanes|=e.suspendedLanes&s,Q===e&&(Z&s)===s&&(T===4||T===3&&(Z&130023424)===Z&&500>B()-fk?Kk(e,0):rk|=s),Dk(e,i)}function Yk(e,i){i===0&&(e.mode&1?(i=sc,sc<<=1,!(sc&130023424)&&(sc=4194304)):i=1);var s=R();e=ih(e,i),e!==null&&(Ac(e,i,s),Dk(e,s))}function uj(e){var i=e.memoizedState,s=0;i!==null&&(s=i.retryLane),Yk(e,s)}function bk(e,i){var s=0;switch(e.tag){case 13:var a=e.stateNode,_=e.memoizedState;_!==null&&(s=_.retryLane);break;case 19:a=e.stateNode;break;default:throw Error(p(314))}a!==null&&a.delete(i),Yk(e,s)}var Vk;Vk=function(e,i,s){if(e!==null)if(e.memoizedProps!==i.pendingProps||Wf.current)dh=!0;else{if(!(e.lanes&s)&&!(i.flags&128))return dh=!1,yj(e,i,s);dh=!!(e.flags&131072)}else dh=!1,I&&i.flags&1048576&&ug(i,ng,i.index);switch(i.lanes=0,i.tag){case 2:var a=i.type;ij(e,i),e=i.pendingProps;var _=Yf(i,H.current);ch(i,s),_=Nh(null,i,a,e,_,s);var $=Sh();return i.flags|=1,typeof _=="object"&&_!==null&&typeof _.render=="function"&&_.$$typeof===void 0?(i.tag=1,i.memoizedState=null,i.updateQueue=null,Zf(a)?($=!0,cg(i)):$=!1,i.memoizedState=_.state!==null&&_.state!==void 0?_.state:null,kh(i),_.updater=Ei,i.stateNode=_,_._reactInternals=i,Ii(i,a,e,s),i=jj(null,i,a,!0,$,s)):(i.tag=0,I&&$&&vg(i),Xi(null,i,_,s),i=i.child),i;case 16:a=i.elementType;e:{switch(ij(e,i),e=i.pendingProps,_=a._init,a=_(a._payload),i.type=a,_=i.tag=Zk(a),e=Ci(a,e),_){case 0:i=cj(null,i,a,e,s);break e;case 1:i=hj(null,i,a,e,s);break e;case 11:i=Yi(null,i,a,e,s);break e;case 14:i=$i(null,i,a,Ci(a.type,e),s);break e}throw Error(p(306,a,""))}return i;case 0:return a=i.type,_=i.pendingProps,_=i.elementType===a?_:Ci(a,_),cj(e,i,a,_,s);case 1:return a=i.type,_=i.pendingProps,_=i.elementType===a?_:Ci(a,_),hj(e,i,a,_,s);case 3:e:{if(kj(i),e===null)throw Error(p(387));a=i.pendingProps,$=i.memoizedState,_=$.element,lh(e,i),qh(i,a,null,s);var rt=i.memoizedState;if(a=rt.element,$.isDehydrated)if($={element:a,isDehydrated:!1,cache:rt.cache,pendingSuspenseBoundaries:rt.pendingSuspenseBoundaries,transitions:rt.transitions},i.updateQueue.baseState=$,i.memoizedState=$,i.flags&256){_=Ji(Error(p(423)),i),i=lj(e,i,a,s,_);break e}else if(a!==_){_=Ji(Error(p(424)),i),i=lj(e,i,a,s,_);break e}else for(yg=Lf(i.stateNode.containerInfo.firstChild),xg=i,I=!0,zg=null,s=Vg(i,null,a,s),i.child=s;s;)s.flags=s.flags&-3|4096,s=s.sibling;else{if(Ig(),a===_){i=Zi(e,i,s);break e}Xi(e,i,a,s)}i=i.child}return i;case 5:return Ah(i),e===null&&Eg(i),a=i.type,_=i.pendingProps,$=e!==null?e.memoizedProps:null,rt=_.children,Ef(a,_)?rt=null:$!==null&&Ef(a,$)&&(i.flags|=32),gj(e,i),Xi(e,i,rt,s),i.child;case 6:return e===null&&Eg(i),null;case 13:return oj(e,i,s);case 4:return yh(i,i.stateNode.containerInfo),a=i.pendingProps,e===null?i.child=Ug(i,null,a,s):Xi(e,i,a,s),i.child;case 11:return a=i.type,_=i.pendingProps,_=i.elementType===a?_:Ci(a,_),Yi(e,i,a,_,s);case 7:return Xi(e,i,i.pendingProps,s),i.child;case 8:return Xi(e,i,i.pendingProps.children,s),i.child;case 12:return Xi(e,i,i.pendingProps.children,s),i.child;case 10:e:{if(a=i.type._context,_=i.pendingProps,$=i.memoizedProps,rt=_.value,G(Wg,a._currentValue),a._currentValue=rt,$!==null)if(He($.value,rt)){if($.children===_.children&&!Wf.current){i=Zi(e,i,s);break e}}else for($=i.child,$!==null&&($.return=i);$!==null;){var c=$.dependencies;if(c!==null){rt=$.child;for(var dt=c.firstContext;dt!==null;){if(dt.context===a){if($.tag===1){dt=mh(-1,s&-s),dt.tag=2;var ht=$.updateQueue;if(ht!==null){ht=ht.shared;var Et=ht.pending;Et===null?dt.next=dt:(dt.next=Et.next,Et.next=dt),ht.pending=dt}}$.lanes|=s,dt=$.alternate,dt!==null&&(dt.lanes|=s),bh($.return,s,i),c.lanes|=s;break}dt=dt.next}}else if($.tag===10)rt=$.type===i.type?null:$.child;else if($.tag===18){if(rt=$.return,rt===null)throw Error(p(341));rt.lanes|=s,c=rt.alternate,c!==null&&(c.lanes|=s),bh(rt,s,i),rt=$.sibling}else rt=$.child;if(rt!==null)rt.return=$;else for(rt=$;rt!==null;){if(rt===i){rt=null;break}if($=rt.sibling,$!==null){$.return=rt.return,rt=$;break}rt=rt.return}$=rt}Xi(e,i,_.children,s),i=i.child}return i;case 9:return _=i.type,a=i.pendingProps.children,ch(i,s),_=eh(_),a=a(_),i.flags|=1,Xi(e,i,a,s),i.child;case 14:return a=i.type,_=Ci(a,i.pendingProps),_=Ci(a.type,_),$i(e,i,a,_,s);case 15:return bj(e,i,i.type,i.pendingProps,s);case 17:return a=i.type,_=i.pendingProps,_=i.elementType===a?_:Ci(a,_),ij(e,i),i.tag=1,Zf(a)?(e=!0,cg(i)):e=!1,ch(i,s),Gi(i,a,_),Ii(i,a,_,s),jj(null,i,a,!0,e,s);case 19:return xj(e,i,s);case 22:return dj(e,i,s)}throw Error(p(156,i.tag))};function Fk(e,i){return ac(e,i)}function $k(e,i,s,a){this.tag=e,this.key=s,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=i,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=a,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Bg(e,i,s,a){return new $k(e,i,s,a)}function aj(e){return e=e.prototype,!(!e||!e.isReactComponent)}function Zk(e){if(typeof e=="function")return aj(e)?1:0;if(e!=null){if(e=e.$$typeof,e===Da)return 11;if(e===Ga)return 14}return 2}function Pg(e,i){var s=e.alternate;return s===null?(s=Bg(e.tag,i,e.key,e.mode),s.elementType=e.elementType,s.type=e.type,s.stateNode=e.stateNode,s.alternate=e,e.alternate=s):(s.pendingProps=i,s.type=e.type,s.flags=0,s.subtreeFlags=0,s.deletions=null),s.flags=e.flags&14680064,s.childLanes=e.childLanes,s.lanes=e.lanes,s.child=e.child,s.memoizedProps=e.memoizedProps,s.memoizedState=e.memoizedState,s.updateQueue=e.updateQueue,i=e.dependencies,s.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext},s.sibling=e.sibling,s.index=e.index,s.ref=e.ref,s}function Rg(e,i,s,a,_,$){var rt=2;if(a=e,typeof e=="function")aj(e)&&(rt=1);else if(typeof e=="string")rt=5;else e:switch(e){case ya:return Tg(s.children,_,$,i);case za:rt=8,_|=8;break;case Aa:return e=Bg(12,s,i,_|2),e.elementType=Aa,e.lanes=$,e;case Ea:return e=Bg(13,s,i,_),e.elementType=Ea,e.lanes=$,e;case Fa:return e=Bg(19,s,i,_),e.elementType=Fa,e.lanes=$,e;case Ia:return pj(s,_,$,i);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case Ba:rt=10;break e;case Ca:rt=9;break e;case Da:rt=11;break e;case Ga:rt=14;break e;case Ha:rt=16,a=null;break e}throw Error(p(130,e==null?e:typeof e,""))}return i=Bg(rt,s,i,_),i.elementType=e,i.type=a,i.lanes=$,i}function Tg(e,i,s,a){return e=Bg(7,e,a,i),e.lanes=s,e}function pj(e,i,s,a){return e=Bg(22,e,a,i),e.elementType=Ia,e.lanes=s,e.stateNode={isHidden:!1},e}function Qg(e,i,s){return e=Bg(6,e,null,i),e.lanes=s,e}function Sg(e,i,s){return i=Bg(4,e.children!==null?e.children:[],e.key,i),i.lanes=s,i.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},i}function al(e,i,s,a,_){this.tag=i,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=zc(0),this.expirationTimes=zc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=zc(0),this.identifierPrefix=a,this.onRecoverableError=_,this.mutableSourceEagerHydrationData=null}function bl(e,i,s,a,_,$,rt,c,dt){return e=new al(e,i,s,c,dt),i===1?(i=1,$===!0&&(i|=8)):i=0,$=Bg(3,null,null,i),e.current=$,$.stateNode=e,$.memoizedState={element:a,isDehydrated:s,cache:null,transitions:null,pendingSuspenseBoundaries:null},kh($),e}function cl(e,i,s){var a=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:wa,key:a==null?null:""+a,children:e,containerInfo:i,implementation:s}}function dl(e){if(!e)return Vf;e=e._reactInternals;e:{if(Vb(e)!==e||e.tag!==1)throw Error(p(170));var i=e;do{switch(i.tag){case 3:i=i.stateNode.context;break e;case 1:if(Zf(i.type)){i=i.stateNode.__reactInternalMemoizedMergedChildContext;break e}}i=i.return}while(i!==null);throw Error(p(171))}if(e.tag===1){var s=e.type;if(Zf(s))return bg(e,s,i)}return i}function el(e,i,s,a,_,$,rt,c,dt){return e=bl(s,a,!0,e,_,$,rt,c,dt),e.context=dl(null),s=e.current,a=R(),_=yi(s),$=mh(a,_),$.callback=i??null,nh(s,$,_),e.current.lanes=_,Ac(e,_,a),Dk(e,a),e}function fl(e,i,s,a){var _=i.current,$=R(),rt=yi(_);return s=dl(s),i.context===null?i.context=s:i.pendingContext=s,i=mh($,rt),i.payload={element:e},a=a===void 0?null:a,a!==null&&(i.callback=a),e=nh(_,i,rt),e!==null&&(gi(e,_,rt,$),oh(e,_,rt)),rt}function gl(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function hl(e,i){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var s=e.retryLane;e.retryLane=s!==0&&s<i?s:i}}function il(e,i){hl(e,i),(e=e.alternate)&&hl(e,i)}function jl(){return null}var kl=typeof reportError=="function"?reportError:function(e){console.error(e)};function ll(e){this._internalRoot=e}ml.prototype.render=ll.prototype.render=function(e){var i=this._internalRoot;if(i===null)throw Error(p(409));fl(e,i,null,null)};ml.prototype.unmount=ll.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var i=e.containerInfo;Rk(function(){fl(null,e,null,null)}),i[uf]=null}};function ml(e){this._internalRoot=e}ml.prototype.unstable_scheduleHydration=function(e){if(e){var i=Hc();e={blockedOn:null,target:e,priority:i};for(var s=0;s<Qc.length&&i!==0&&i<Qc[s].priority;s++);Qc.splice(s,0,e),s===0&&Vc(e)}};function nl(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function ol(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function pl(){}function ql(e,i,s,a,_){if(_){if(typeof a=="function"){var $=a;a=function(){var ht=gl(rt);$.call(ht)}}var rt=el(i,a,e,0,null,!1,!1,"",pl);return e._reactRootContainer=rt,e[uf]=rt.current,sf(e.nodeType===8?e.parentNode:e),Rk(),rt}for(;_=e.lastChild;)e.removeChild(_);if(typeof a=="function"){var c=a;a=function(){var ht=gl(dt);c.call(ht)}}var dt=bl(e,0,!1,null,null,!1,!1,"",pl);return e._reactRootContainer=dt,e[uf]=dt.current,sf(e.nodeType===8?e.parentNode:e),Rk(function(){fl(i,dt,s,a)}),dt}function rl(e,i,s,a,_){var $=s._reactRootContainer;if($){var rt=$;if(typeof _=="function"){var c=_;_=function(){var dt=gl(rt);c.call(dt)}}fl(i,rt,e,_)}else rt=ql(s,i,e,_,a);return gl(rt)}Ec=function(e){switch(e.tag){case 3:var i=e.stateNode;if(i.current.memoizedState.isDehydrated){var s=tc(i.pendingLanes);s!==0&&(Cc(i,s|1),Dk(i,B()),!(K&6)&&(Gj=B()+500,jg()))}break;case 13:Rk(function(){var a=ih(e,1);if(a!==null){var _=R();gi(a,e,1,_)}}),il(e,1)}};Fc=function(e){if(e.tag===13){var i=ih(e,134217728);if(i!==null){var s=R();gi(i,e,134217728,s)}il(e,134217728)}};Gc=function(e){if(e.tag===13){var i=yi(e),s=ih(e,i);if(s!==null){var a=R();gi(s,e,i,a)}il(e,i)}};Hc=function(){return C};Ic=function(e,i){var s=C;try{return C=e,i()}finally{C=s}};yb=function(e,i,s){switch(i){case"input":if(bb(e,s),i=s.name,s.type==="radio"&&i!=null){for(s=e;s.parentNode;)s=s.parentNode;for(s=s.querySelectorAll("input[name="+JSON.stringify(""+i)+'][type="radio"]'),i=0;i<s.length;i++){var a=s[i];if(a!==e&&a.form===e.form){var _=Db(a);if(!_)throw Error(p(90));Wa(a),bb(a,_)}}}break;case"textarea":ib(e,s);break;case"select":i=s.value,i!=null&&fb(e,!!s.multiple,i,!1)}};Gb=Qk;Hb=Rk;var sl={usingClientEntryPoint:!1,Events:[Cb,ue$1,Db,Eb,Fb,Qk]},tl={findFiberByHostInstance:Wc,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},ul={bundleType:tl.bundleType,version:tl.version,rendererPackageName:tl.rendererPackageName,rendererConfig:tl.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ua.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=Zb(e),e===null?null:e.stateNode},findFiberByHostInstance:tl.findFiberByHostInstance||jl,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var vl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!vl.isDisabled&&vl.supportsFiber)try{kc=vl.inject(ul),lc=vl}catch{}}reactDom_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=sl;reactDom_production_min.createPortal=function(e,i){var s=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!nl(i))throw Error(p(200));return cl(e,i,null,s)};reactDom_production_min.createRoot=function(e,i){if(!nl(e))throw Error(p(299));var s=!1,a="",_=kl;return i!=null&&(i.unstable_strictMode===!0&&(s=!0),i.identifierPrefix!==void 0&&(a=i.identifierPrefix),i.onRecoverableError!==void 0&&(_=i.onRecoverableError)),i=bl(e,1,!1,null,null,s,!1,a,_),e[uf]=i.current,sf(e.nodeType===8?e.parentNode:e),new ll(i)};reactDom_production_min.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var i=e._reactInternals;if(i===void 0)throw typeof e.render=="function"?Error(p(188)):(e=Object.keys(e).join(","),Error(p(268,e)));return e=Zb(i),e=e===null?null:e.stateNode,e};reactDom_production_min.flushSync=function(e){return Rk(e)};reactDom_production_min.hydrate=function(e,i,s){if(!ol(i))throw Error(p(200));return rl(null,e,i,!0,s)};reactDom_production_min.hydrateRoot=function(e,i,s){if(!nl(e))throw Error(p(405));var a=s!=null&&s.hydratedSources||null,_=!1,$="",rt=kl;if(s!=null&&(s.unstable_strictMode===!0&&(_=!0),s.identifierPrefix!==void 0&&($=s.identifierPrefix),s.onRecoverableError!==void 0&&(rt=s.onRecoverableError)),i=el(i,null,e,1,s??null,_,!1,$,rt),e[uf]=i.current,sf(e),a)for(e=0;e<a.length;e++)s=a[e],_=s._getVersion,_=_(s._source),i.mutableSourceEagerHydrationData==null?i.mutableSourceEagerHydrationData=[s,_]:i.mutableSourceEagerHydrationData.push(s,_);return new ml(i)};reactDom_production_min.render=function(e,i,s){if(!ol(i))throw Error(p(200));return rl(null,e,i,!1,s)};reactDom_production_min.unmountComponentAtNode=function(e){if(!ol(e))throw Error(p(40));return e._reactRootContainer?(Rk(function(){rl(null,null,e,!1,function(){e._reactRootContainer=null,e[uf]=null})}),!0):!1};reactDom_production_min.unstable_batchedUpdates=Qk;reactDom_production_min.unstable_renderSubtreeIntoContainer=function(e,i,s,a){if(!ol(s))throw Error(p(200));if(e==null||e._reactInternals===void 0)throw Error(p(38));return rl(e,i,s,!1,a)};reactDom_production_min.version="18.3.1-next-f1338f8080-20240426";function checkDCE(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(checkDCE)}catch(e){console.error(e)}}checkDCE(),reactDom.exports=reactDom_production_min;var reactDomExports=reactDom.exports;const vt=getDefaultExportFromCjs(reactDomExports);var createRoot,m=reactDomExports;createRoot=m.createRoot,m.hydrateRoot;const TOAST_LIMIT=1,TOAST_REMOVE_DELAY=1e6;let count$2=0;function genId(){return count$2=(count$2+1)%Number.MAX_SAFE_INTEGER,count$2.toString()}const toastTimeouts=new Map,addToRemoveQueue=e=>{if(toastTimeouts.has(e))return;const i=setTimeout(()=>{toastTimeouts.delete(e),dispatch({type:"REMOVE_TOAST",toastId:e})},TOAST_REMOVE_DELAY);toastTimeouts.set(e,i)},reducer=(e,i)=>{switch(i.type){case"ADD_TOAST":return{...e,toasts:[i.toast,...e.toasts].slice(0,TOAST_LIMIT)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(s=>s.id===i.toast.id?{...s,...i.toast}:s)};case"DISMISS_TOAST":{const{toastId:s}=i;return s?addToRemoveQueue(s):e.toasts.forEach(a=>{addToRemoveQueue(a.id)}),{...e,toasts:e.toasts.map(a=>a.id===s||s===void 0?{...a,open:!1}:a)}}case"REMOVE_TOAST":return i.toastId===void 0?{...e,toasts:[]}:{...e,toasts:e.toasts.filter(s=>s.id!==i.toastId)}}},listeners=[];let memoryState={toasts:[]};function dispatch(e){memoryState=reducer(memoryState,e),listeners.forEach(i=>{i(memoryState)})}function toast({...e}){const i=genId(),s=_=>dispatch({type:"UPDATE_TOAST",toast:{..._,id:i}}),a=()=>dispatch({type:"DISMISS_TOAST",toastId:i});return dispatch({type:"ADD_TOAST",toast:{...e,id:i,open:!0,onOpenChange:_=>{_||a()}}}),{id:i,dismiss:a,update:s}}function useToast(){const[e,i]=reactExports.useState(memoryState);return reactExports.useEffect(()=>(listeners.push(i),()=>{const s=listeners.indexOf(i);s>-1&&listeners.splice(s,1)}),[e]),{...e,toast,dismiss:s=>dispatch({type:"DISMISS_TOAST",toastId:s})}}function composeEventHandlers(e,i,{checkForDefaultPrevented:s=!0}={}){return function(_){if(e==null||e(_),s===!1||!_.defaultPrevented)return i==null?void 0:i(_)}}function setRef$2(e,i){if(typeof e=="function")return e(i);e!=null&&(e.current=i)}function composeRefs$1(...e){return i=>{let s=!1;const a=e.map(_=>{const $=setRef$2(_,i);return!s&&typeof $=="function"&&(s=!0),$});if(s)return()=>{for(let _=0;_<a.length;_++){const $=a[_];typeof $=="function"?$():setRef$2(e[_],null)}}}}function useComposedRefs$1(...e){return reactExports.useCallback(composeRefs$1(...e),e)}function createContext2(e,i){const s=reactExports.createContext(i),a=$=>{const{children:rt,...c}=$,dt=reactExports.useMemo(()=>c,Object.values(c));return jsxRuntimeExports.jsx(s.Provider,{value:dt,children:rt})};a.displayName=e+"Provider";function _($){const rt=reactExports.useContext(s);if(rt)return rt;if(i!==void 0)return i;throw new Error(`\`${$}\` must be used within \`${e}\``)}return[a,_]}function createContextScope(e,i=[]){let s=[];function a($,rt){const c=reactExports.createContext(rt),dt=s.length;s=[...s,rt];const ht=St=>{var zt;const{scope:At,children:Pt,...Vt}=St,Bt=((zt=At==null?void 0:At[e])==null?void 0:zt[dt])||c,Zt=reactExports.useMemo(()=>Vt,Object.values(Vt));return jsxRuntimeExports.jsx(Bt.Provider,{value:Zt,children:Pt})};ht.displayName=$+"Provider";function Et(St,At){var Bt;const Pt=((Bt=At==null?void 0:At[e])==null?void 0:Bt[dt])||c,Vt=reactExports.useContext(Pt);if(Vt)return Vt;if(rt!==void 0)return rt;throw new Error(`\`${St}\` must be used within \`${$}\``)}return[ht,Et]}const _=()=>{const $=s.map(rt=>reactExports.createContext(rt));return function(c){const dt=(c==null?void 0:c[e])||$;return reactExports.useMemo(()=>({[`__scope${e}`]:{...c,[e]:dt}}),[c,dt])}};return _.scopeName=e,[a,composeContextScopes(_,...i)]}function composeContextScopes(...e){const i=e[0];if(e.length===1)return i;const s=()=>{const a=e.map(_=>({useScope:_(),scopeName:_.scopeName}));return function($){const rt=a.reduce((c,{useScope:dt,scopeName:ht})=>{const St=dt($)[`__scope${ht}`];return{...c,...St}},{});return reactExports.useMemo(()=>({[`__scope${i.scopeName}`]:rt}),[rt])}};return s.scopeName=i.scopeName,s}function createSlot(e){const i=createSlotClone(e),s=reactExports.forwardRef((a,_)=>{const{children:$,...rt}=a,c=reactExports.Children.toArray($),dt=c.find(isSlottable);if(dt){const ht=dt.props.children,Et=c.map(St=>St===dt?reactExports.Children.count(ht)>1?reactExports.Children.only(null):reactExports.isValidElement(ht)?ht.props.children:null:St);return jsxRuntimeExports.jsx(i,{...rt,ref:_,children:reactExports.isValidElement(ht)?reactExports.cloneElement(ht,void 0,Et):null})}return jsxRuntimeExports.jsx(i,{...rt,ref:_,children:$})});return s.displayName=`${e}.Slot`,s}var Slot$2=createSlot("Slot");function createSlotClone(e){const i=reactExports.forwardRef((s,a)=>{const{children:_,...$}=s;if(reactExports.isValidElement(_)){const rt=getElementRef$1(_),c=mergeProps($,_.props);return _.type!==reactExports.Fragment&&(c.ref=a?composeRefs$1(a,rt):rt),reactExports.cloneElement(_,c)}return reactExports.Children.count(_)>1?reactExports.Children.only(null):null});return i.displayName=`${e}.SlotClone`,i}var SLOTTABLE_IDENTIFIER=Symbol("radix.slottable");function createSlottable(e){const i=({children:s})=>jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:s});return i.displayName=`${e}.Slottable`,i.__radixId=SLOTTABLE_IDENTIFIER,i}function isSlottable(e){return reactExports.isValidElement(e)&&typeof e.type=="function"&&"__radixId"in e.type&&e.type.__radixId===SLOTTABLE_IDENTIFIER}function mergeProps(e,i){const s={...i};for(const a in i){const _=e[a],$=i[a];/^on[A-Z]/.test(a)?_&&$?s[a]=(...c)=>{const dt=$(...c);return _(...c),dt}:_&&(s[a]=_):a==="style"?s[a]={..._,...$}:a==="className"&&(s[a]=[_,$].filter(Boolean).join(" "))}return{...e,...s}}function getElementRef$1(e){var a,_;let i=(a=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:a.get,s=i&&"isReactWarning"in i&&i.isReactWarning;return s?e.ref:(i=(_=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:_.get,s=i&&"isReactWarning"in i&&i.isReactWarning,s?e.props.ref:e.props.ref||e.ref)}function createCollection(e){const i=e+"CollectionProvider",[s,a]=createContextScope(i),[_,$]=s(i,{collectionRef:{current:null},itemMap:new Map}),rt=Bt=>{const{scope:Zt,children:zt}=Bt,Ut=React.useRef(null),Nt=React.useRef(new Map).current;return jsxRuntimeExports.jsx(_,{scope:Zt,itemMap:Nt,collectionRef:Ut,children:zt})};rt.displayName=i;const c=e+"CollectionSlot",dt=createSlot(c),ht=React.forwardRef((Bt,Zt)=>{const{scope:zt,children:Ut}=Bt,Nt=$(c,zt),Gt=useComposedRefs$1(Zt,Nt.collectionRef);return jsxRuntimeExports.jsx(dt,{ref:Gt,children:Ut})});ht.displayName=c;const Et=e+"CollectionItemSlot",St="data-radix-collection-item",At=createSlot(Et),Pt=React.forwardRef((Bt,Zt)=>{const{scope:zt,children:Ut,...Nt}=Bt,Gt=React.useRef(null),er=useComposedRefs$1(Zt,Gt),ir=$(Et,zt);return React.useEffect(()=>(ir.itemMap.set(Gt,{ref:Gt,...Nt}),()=>void ir.itemMap.delete(Gt))),jsxRuntimeExports.jsx(At,{[St]:"",ref:er,children:Ut})});Pt.displayName=Et;function Vt(Bt){const Zt=$(e+"CollectionConsumer",Bt);return React.useCallback(()=>{const Ut=Zt.collectionRef.current;if(!Ut)return[];const Nt=Array.from(Ut.querySelectorAll(`[${St}]`));return Array.from(Zt.itemMap.values()).sort((ir,or)=>Nt.indexOf(ir.ref.current)-Nt.indexOf(or.ref.current))},[Zt.collectionRef,Zt.itemMap])}return[{Provider:rt,Slot:ht,ItemSlot:Pt},Vt,a]}var NODES=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Primitive=NODES.reduce((e,i)=>{const s=createSlot(`Primitive.${i}`),a=reactExports.forwardRef((_,$)=>{const{asChild:rt,...c}=_,dt=rt?s:i;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),jsxRuntimeExports.jsx(dt,{...c,ref:$})});return a.displayName=`Primitive.${i}`,{...e,[i]:a}},{});function dispatchDiscreteCustomEvent(e,i){e&&reactDomExports.flushSync(()=>e.dispatchEvent(i))}function useCallbackRef$1(e){const i=reactExports.useRef(e);return reactExports.useEffect(()=>{i.current=e}),reactExports.useMemo(()=>(...s)=>{var a;return(a=i.current)==null?void 0:a.call(i,...s)},[])}function useEscapeKeydown(e,i=globalThis==null?void 0:globalThis.document){const s=useCallbackRef$1(e);reactExports.useEffect(()=>{const a=_=>{_.key==="Escape"&&s(_)};return i.addEventListener("keydown",a,{capture:!0}),()=>i.removeEventListener("keydown",a,{capture:!0})},[s,i])}var DISMISSABLE_LAYER_NAME="DismissableLayer",CONTEXT_UPDATE="dismissableLayer.update",POINTER_DOWN_OUTSIDE="dismissableLayer.pointerDownOutside",FOCUS_OUTSIDE="dismissableLayer.focusOutside",originalBodyPointerEvents,DismissableLayerContext=reactExports.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),DismissableLayer=reactExports.forwardRef((e,i)=>{const{disableOutsidePointerEvents:s=!1,onEscapeKeyDown:a,onPointerDownOutside:_,onFocusOutside:$,onInteractOutside:rt,onDismiss:c,...dt}=e,ht=reactExports.useContext(DismissableLayerContext),[Et,St]=reactExports.useState(null),At=(Et==null?void 0:Et.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,Pt]=reactExports.useState({}),Vt=useComposedRefs$1(i,or=>St(or)),Bt=Array.from(ht.layers),[Zt]=[...ht.layersWithOutsidePointerEventsDisabled].slice(-1),zt=Bt.indexOf(Zt),Ut=Et?Bt.indexOf(Et):-1,Nt=ht.layersWithOutsidePointerEventsDisabled.size>0,Gt=Ut>=zt,er=usePointerDownOutside(or=>{const mr=or.target,Rr=[...ht.branches].some(on=>on.contains(mr));!Gt||Rr||(_==null||_(or),rt==null||rt(or),or.defaultPrevented||c==null||c())},At),ir=useFocusOutside(or=>{const mr=or.target;[...ht.branches].some(on=>on.contains(mr))||($==null||$(or),rt==null||rt(or),or.defaultPrevented||c==null||c())},At);return useEscapeKeydown(or=>{Ut===ht.layers.size-1&&(a==null||a(or),!or.defaultPrevented&&c&&(or.preventDefault(),c()))},At),reactExports.useEffect(()=>{if(Et)return s&&(ht.layersWithOutsidePointerEventsDisabled.size===0&&(originalBodyPointerEvents=At.body.style.pointerEvents,At.body.style.pointerEvents="none"),ht.layersWithOutsidePointerEventsDisabled.add(Et)),ht.layers.add(Et),dispatchUpdate(),()=>{s&&ht.layersWithOutsidePointerEventsDisabled.size===1&&(At.body.style.pointerEvents=originalBodyPointerEvents)}},[Et,At,s,ht]),reactExports.useEffect(()=>()=>{Et&&(ht.layers.delete(Et),ht.layersWithOutsidePointerEventsDisabled.delete(Et),dispatchUpdate())},[Et,ht]),reactExports.useEffect(()=>{const or=()=>Pt({});return document.addEventListener(CONTEXT_UPDATE,or),()=>document.removeEventListener(CONTEXT_UPDATE,or)},[]),jsxRuntimeExports.jsx(Primitive.div,{...dt,ref:Vt,style:{pointerEvents:Nt?Gt?"auto":"none":void 0,...e.style},onFocusCapture:composeEventHandlers(e.onFocusCapture,ir.onFocusCapture),onBlurCapture:composeEventHandlers(e.onBlurCapture,ir.onBlurCapture),onPointerDownCapture:composeEventHandlers(e.onPointerDownCapture,er.onPointerDownCapture)})});DismissableLayer.displayName=DISMISSABLE_LAYER_NAME;var BRANCH_NAME="DismissableLayerBranch",DismissableLayerBranch=reactExports.forwardRef((e,i)=>{const s=reactExports.useContext(DismissableLayerContext),a=reactExports.useRef(null),_=useComposedRefs$1(i,a);return reactExports.useEffect(()=>{const $=a.current;if($)return s.branches.add($),()=>{s.branches.delete($)}},[s.branches]),jsxRuntimeExports.jsx(Primitive.div,{...e,ref:_})});DismissableLayerBranch.displayName=BRANCH_NAME;function usePointerDownOutside(e,i=globalThis==null?void 0:globalThis.document){const s=useCallbackRef$1(e),a=reactExports.useRef(!1),_=reactExports.useRef(()=>{});return reactExports.useEffect(()=>{const $=c=>{if(c.target&&!a.current){let dt=function(){handleAndDispatchCustomEvent$1(POINTER_DOWN_OUTSIDE,s,ht,{discrete:!0})};const ht={originalEvent:c};c.pointerType==="touch"?(i.removeEventListener("click",_.current),_.current=dt,i.addEventListener("click",_.current,{once:!0})):dt()}else i.removeEventListener("click",_.current);a.current=!1},rt=window.setTimeout(()=>{i.addEventListener("pointerdown",$)},0);return()=>{window.clearTimeout(rt),i.removeEventListener("pointerdown",$),i.removeEventListener("click",_.current)}},[i,s]),{onPointerDownCapture:()=>a.current=!0}}function useFocusOutside(e,i=globalThis==null?void 0:globalThis.document){const s=useCallbackRef$1(e),a=reactExports.useRef(!1);return reactExports.useEffect(()=>{const _=$=>{$.target&&!a.current&&handleAndDispatchCustomEvent$1(FOCUS_OUTSIDE,s,{originalEvent:$},{discrete:!1})};return i.addEventListener("focusin",_),()=>i.removeEventListener("focusin",_)},[i,s]),{onFocusCapture:()=>a.current=!0,onBlurCapture:()=>a.current=!1}}function dispatchUpdate(){const e=new CustomEvent(CONTEXT_UPDATE);document.dispatchEvent(e)}function handleAndDispatchCustomEvent$1(e,i,s,{discrete:a}){const _=s.originalEvent.target,$=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:s});i&&_.addEventListener(e,i,{once:!0}),a?dispatchDiscreteCustomEvent(_,$):_.dispatchEvent($)}var Root$6=DismissableLayer,Branch=DismissableLayerBranch,useLayoutEffect2=globalThis!=null&&globalThis.document?reactExports.useLayoutEffect:()=>{},PORTAL_NAME$4="Portal",Portal$2=reactExports.forwardRef((e,i)=>{var c;const{container:s,...a}=e,[_,$]=reactExports.useState(!1);useLayoutEffect2(()=>$(!0),[]);const rt=s||_&&((c=globalThis==null?void 0:globalThis.document)==null?void 0:c.body);return rt?vt.createPortal(jsxRuntimeExports.jsx(Primitive.div,{...a,ref:i}),rt):null});Portal$2.displayName=PORTAL_NAME$4;function useStateMachine(e,i){return reactExports.useReducer((s,a)=>i[s][a]??s,e)}var Presence=e=>{const{present:i,children:s}=e,a=usePresence$1(i),_=typeof s=="function"?s({present:a.isPresent}):reactExports.Children.only(s),$=useComposedRefs$1(a.ref,getElementRef(_));return typeof s=="function"||a.isPresent?reactExports.cloneElement(_,{ref:$}):null};Presence.displayName="Presence";function usePresence$1(e){const[i,s]=reactExports.useState(),a=reactExports.useRef(null),_=reactExports.useRef(e),$=reactExports.useRef("none"),rt=e?"mounted":"unmounted",[c,dt]=useStateMachine(rt,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return reactExports.useEffect(()=>{const ht=getAnimationName(a.current);$.current=c==="mounted"?ht:"none"},[c]),useLayoutEffect2(()=>{const ht=a.current,Et=_.current;if(Et!==e){const At=$.current,Pt=getAnimationName(ht);e?dt("MOUNT"):Pt==="none"||(ht==null?void 0:ht.display)==="none"?dt("UNMOUNT"):dt(Et&&At!==Pt?"ANIMATION_OUT":"UNMOUNT"),_.current=e}},[e,dt]),useLayoutEffect2(()=>{if(i){let ht;const Et=i.ownerDocument.defaultView??window,St=Pt=>{const Bt=getAnimationName(a.current).includes(Pt.animationName);if(Pt.target===i&&Bt&&(dt("ANIMATION_END"),!_.current)){const Zt=i.style.animationFillMode;i.style.animationFillMode="forwards",ht=Et.setTimeout(()=>{i.style.animationFillMode==="forwards"&&(i.style.animationFillMode=Zt)})}},At=Pt=>{Pt.target===i&&($.current=getAnimationName(a.current))};return i.addEventListener("animationstart",At),i.addEventListener("animationcancel",St),i.addEventListener("animationend",St),()=>{Et.clearTimeout(ht),i.removeEventListener("animationstart",At),i.removeEventListener("animationcancel",St),i.removeEventListener("animationend",St)}}else dt("ANIMATION_END")},[i,dt]),{isPresent:["mounted","unmountSuspended"].includes(c),ref:reactExports.useCallback(ht=>{a.current=ht?getComputedStyle(ht):null,s(ht)},[])}}function getAnimationName(e){return(e==null?void 0:e.animationName)||"none"}function getElementRef(e){var a,_;let i=(a=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:a.get,s=i&&"isReactWarning"in i&&i.isReactWarning;return s?e.ref:(i=(_=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:_.get,s=i&&"isReactWarning"in i&&i.isReactWarning,s?e.props.ref:e.props.ref||e.ref)}var useInsertionEffect=React$1[" useInsertionEffect ".trim().toString()]||useLayoutEffect2;function useControllableState({prop:e,defaultProp:i,onChange:s=()=>{},caller:a}){const[_,$,rt]=useUncontrolledState({defaultProp:i,onChange:s}),c=e!==void 0,dt=c?e:_;{const Et=reactExports.useRef(e!==void 0);reactExports.useEffect(()=>{const St=Et.current;St!==c&&console.warn(`${a} is changing from ${St?"controlled":"uncontrolled"} to ${c?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),Et.current=c},[c,a])}const ht=reactExports.useCallback(Et=>{var St;if(c){const At=isFunction(Et)?Et(e):Et;At!==e&&((St=rt.current)==null||St.call(rt,At))}else $(Et)},[c,e,$,rt]);return[dt,ht]}function useUncontrolledState({defaultProp:e,onChange:i}){const[s,a]=reactExports.useState(e),_=reactExports.useRef(s),$=reactExports.useRef(i);return useInsertionEffect(()=>{$.current=i},[i]),reactExports.useEffect(()=>{var rt;_.current!==s&&((rt=$.current)==null||rt.call($,s),_.current=s)},[s,_]),[s,a,$]}function isFunction(e){return typeof e=="function"}var VISUALLY_HIDDEN_STYLES=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),NAME$2="VisuallyHidden",VisuallyHidden=reactExports.forwardRef((e,i)=>jsxRuntimeExports.jsx(Primitive.span,{...e,ref:i,style:{...VISUALLY_HIDDEN_STYLES,...e.style}}));VisuallyHidden.displayName=NAME$2;var Root$5=VisuallyHidden,PROVIDER_NAME$1="ToastProvider",[Collection$2,useCollection$2,createCollectionScope$2]=createCollection("Toast"),[createToastContext,createToastScope]=createContextScope("Toast",[createCollectionScope$2]),[ToastProviderProvider,useToastProviderContext]=createToastContext(PROVIDER_NAME$1),ToastProvider$1=e=>{const{__scopeToast:i,label:s="Notification",duration:a=5e3,swipeDirection:_="right",swipeThreshold:$=50,children:rt}=e,[c,dt]=reactExports.useState(null),[ht,Et]=reactExports.useState(0),St=reactExports.useRef(!1),At=reactExports.useRef(!1);return s.trim()||console.error(`Invalid prop \`label\` supplied to \`${PROVIDER_NAME$1}\`. Expected non-empty \`string\`.`),jsxRuntimeExports.jsx(Collection$2.Provider,{scope:i,children:jsxRuntimeExports.jsx(ToastProviderProvider,{scope:i,label:s,duration:a,swipeDirection:_,swipeThreshold:$,toastCount:ht,viewport:c,onViewportChange:dt,onToastAdd:reactExports.useCallback(()=>Et(Pt=>Pt+1),[]),onToastRemove:reactExports.useCallback(()=>Et(Pt=>Pt-1),[]),isFocusedToastEscapeKeyDownRef:St,isClosePausedRef:At,children:rt})})};ToastProvider$1.displayName=PROVIDER_NAME$1;var VIEWPORT_NAME$1="ToastViewport",VIEWPORT_DEFAULT_HOTKEY=["F8"],VIEWPORT_PAUSE="toast.viewportPause",VIEWPORT_RESUME="toast.viewportResume",ToastViewport$1=reactExports.forwardRef((e,i)=>{const{__scopeToast:s,hotkey:a=VIEWPORT_DEFAULT_HOTKEY,label:_="Notifications ({hotkey})",...$}=e,rt=useToastProviderContext(VIEWPORT_NAME$1,s),c=useCollection$2(s),dt=reactExports.useRef(null),ht=reactExports.useRef(null),Et=reactExports.useRef(null),St=reactExports.useRef(null),At=useComposedRefs$1(i,St,rt.onViewportChange),Pt=a.join("+").replace(/Key/g,"").replace(/Digit/g,""),Vt=rt.toastCount>0;reactExports.useEffect(()=>{const Zt=zt=>{var Nt;a.length!==0&&a.every(Gt=>zt[Gt]||zt.code===Gt)&&((Nt=St.current)==null||Nt.focus())};return document.addEventListener("keydown",Zt),()=>document.removeEventListener("keydown",Zt)},[a]),reactExports.useEffect(()=>{const Zt=dt.current,zt=St.current;if(Vt&&Zt&&zt){const Ut=()=>{if(!rt.isClosePausedRef.current){const ir=new CustomEvent(VIEWPORT_PAUSE);zt.dispatchEvent(ir),rt.isClosePausedRef.current=!0}},Nt=()=>{if(rt.isClosePausedRef.current){const ir=new CustomEvent(VIEWPORT_RESUME);zt.dispatchEvent(ir),rt.isClosePausedRef.current=!1}},Gt=ir=>{!Zt.contains(ir.relatedTarget)&&Nt()},er=()=>{Zt.contains(document.activeElement)||Nt()};return Zt.addEventListener("focusin",Ut),Zt.addEventListener("focusout",Gt),Zt.addEventListener("pointermove",Ut),Zt.addEventListener("pointerleave",er),window.addEventListener("blur",Ut),window.addEventListener("focus",Nt),()=>{Zt.removeEventListener("focusin",Ut),Zt.removeEventListener("focusout",Gt),Zt.removeEventListener("pointermove",Ut),Zt.removeEventListener("pointerleave",er),window.removeEventListener("blur",Ut),window.removeEventListener("focus",Nt)}}},[Vt,rt.isClosePausedRef]);const Bt=reactExports.useCallback(({tabbingDirection:Zt})=>{const Ut=c().map(Nt=>{const Gt=Nt.ref.current,er=[Gt,...getTabbableCandidates$1(Gt)];return Zt==="forwards"?er:er.reverse()});return(Zt==="forwards"?Ut.reverse():Ut).flat()},[c]);return reactExports.useEffect(()=>{const Zt=St.current;if(Zt){const zt=Ut=>{var er,ir,or;const Nt=Ut.altKey||Ut.ctrlKey||Ut.metaKey;if(Ut.key==="Tab"&&!Nt){const mr=document.activeElement,Rr=Ut.shiftKey;if(Ut.target===Zt&&Rr){(er=ht.current)==null||er.focus();return}const jr=Bt({tabbingDirection:Rr?"backwards":"forwards"}),Jr=jr.findIndex(fn=>fn===mr);focusFirst$1(jr.slice(Jr+1))?Ut.preventDefault():Rr?(ir=ht.current)==null||ir.focus():(or=Et.current)==null||or.focus()}};return Zt.addEventListener("keydown",zt),()=>Zt.removeEventListener("keydown",zt)}},[c,Bt]),jsxRuntimeExports.jsxs(Branch,{ref:dt,role:"region","aria-label":_.replace("{hotkey}",Pt),tabIndex:-1,style:{pointerEvents:Vt?void 0:"none"},children:[Vt&&jsxRuntimeExports.jsx(FocusProxy,{ref:ht,onFocusFromOutsideViewport:()=>{const Zt=Bt({tabbingDirection:"forwards"});focusFirst$1(Zt)}}),jsxRuntimeExports.jsx(Collection$2.Slot,{scope:s,children:jsxRuntimeExports.jsx(Primitive.ol,{tabIndex:-1,...$,ref:At})}),Vt&&jsxRuntimeExports.jsx(FocusProxy,{ref:Et,onFocusFromOutsideViewport:()=>{const Zt=Bt({tabbingDirection:"backwards"});focusFirst$1(Zt)}})]})});ToastViewport$1.displayName=VIEWPORT_NAME$1;var FOCUS_PROXY_NAME="ToastFocusProxy",FocusProxy=reactExports.forwardRef((e,i)=>{const{__scopeToast:s,onFocusFromOutsideViewport:a,..._}=e,$=useToastProviderContext(FOCUS_PROXY_NAME,s);return jsxRuntimeExports.jsx(VisuallyHidden,{"aria-hidden":!0,tabIndex:0,..._,ref:i,style:{position:"fixed"},onFocus:rt=>{var ht;const c=rt.relatedTarget;!((ht=$.viewport)!=null&&ht.contains(c))&&a()}})});FocusProxy.displayName=FOCUS_PROXY_NAME;var TOAST_NAME="Toast",TOAST_SWIPE_START="toast.swipeStart",TOAST_SWIPE_MOVE="toast.swipeMove",TOAST_SWIPE_CANCEL="toast.swipeCancel",TOAST_SWIPE_END="toast.swipeEnd",Toast$1=reactExports.forwardRef((e,i)=>{const{forceMount:s,open:a,defaultOpen:_,onOpenChange:$,...rt}=e,[c,dt]=useControllableState({prop:a,defaultProp:_??!0,onChange:$,caller:TOAST_NAME});return jsxRuntimeExports.jsx(Presence,{present:s||c,children:jsxRuntimeExports.jsx(ToastImpl,{open:c,...rt,ref:i,onClose:()=>dt(!1),onPause:useCallbackRef$1(e.onPause),onResume:useCallbackRef$1(e.onResume),onSwipeStart:composeEventHandlers(e.onSwipeStart,ht=>{ht.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:composeEventHandlers(e.onSwipeMove,ht=>{const{x:Et,y:St}=ht.detail.delta;ht.currentTarget.setAttribute("data-swipe","move"),ht.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${Et}px`),ht.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${St}px`)}),onSwipeCancel:composeEventHandlers(e.onSwipeCancel,ht=>{ht.currentTarget.setAttribute("data-swipe","cancel"),ht.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),ht.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),ht.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),ht.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:composeEventHandlers(e.onSwipeEnd,ht=>{const{x:Et,y:St}=ht.detail.delta;ht.currentTarget.setAttribute("data-swipe","end"),ht.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),ht.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),ht.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${Et}px`),ht.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${St}px`),dt(!1)})})})});Toast$1.displayName=TOAST_NAME;var[ToastInteractiveProvider,useToastInteractiveContext]=createToastContext(TOAST_NAME,{onClose(){}}),ToastImpl=reactExports.forwardRef((e,i)=>{const{__scopeToast:s,type:a="foreground",duration:_,open:$,onClose:rt,onEscapeKeyDown:c,onPause:dt,onResume:ht,onSwipeStart:Et,onSwipeMove:St,onSwipeCancel:At,onSwipeEnd:Pt,...Vt}=e,Bt=useToastProviderContext(TOAST_NAME,s),[Zt,zt]=reactExports.useState(null),Ut=useComposedRefs$1(i,fn=>zt(fn)),Nt=reactExports.useRef(null),Gt=reactExports.useRef(null),er=_||Bt.duration,ir=reactExports.useRef(0),or=reactExports.useRef(er),mr=reactExports.useRef(0),{onToastAdd:Rr,onToastRemove:on}=Bt,un=useCallbackRef$1(()=>{var Fr;(Zt==null?void 0:Zt.contains(document.activeElement))&&((Fr=Bt.viewport)==null||Fr.focus()),rt()}),jr=reactExports.useCallback(fn=>{!fn||fn===1/0||(window.clearTimeout(mr.current),ir.current=new Date().getTime(),mr.current=window.setTimeout(un,fn))},[un]);reactExports.useEffect(()=>{const fn=Bt.viewport;if(fn){const Fr=()=>{jr(or.current),ht==null||ht()},Cr=()=>{const Sr=new Date().getTime()-ir.current;or.current=or.current-Sr,window.clearTimeout(mr.current),dt==null||dt()};return fn.addEventListener(VIEWPORT_PAUSE,Cr),fn.addEventListener(VIEWPORT_RESUME,Fr),()=>{fn.removeEventListener(VIEWPORT_PAUSE,Cr),fn.removeEventListener(VIEWPORT_RESUME,Fr)}}},[Bt.viewport,er,dt,ht,jr]),reactExports.useEffect(()=>{$&&!Bt.isClosePausedRef.current&&jr(er)},[$,er,Bt.isClosePausedRef,jr]),reactExports.useEffect(()=>(Rr(),()=>on()),[Rr,on]);const Jr=reactExports.useMemo(()=>Zt?getAnnounceTextContent(Zt):null,[Zt]);return Bt.viewport?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[Jr&&jsxRuntimeExports.jsx(ToastAnnounce,{__scopeToast:s,role:"status","aria-live":a==="foreground"?"assertive":"polite","aria-atomic":!0,children:Jr}),jsxRuntimeExports.jsx(ToastInteractiveProvider,{scope:s,onClose:un,children:reactDomExports.createPortal(jsxRuntimeExports.jsx(Collection$2.ItemSlot,{scope:s,children:jsxRuntimeExports.jsx(Root$6,{asChild:!0,onEscapeKeyDown:composeEventHandlers(c,()=>{Bt.isFocusedToastEscapeKeyDownRef.current||un(),Bt.isFocusedToastEscapeKeyDownRef.current=!1}),children:jsxRuntimeExports.jsx(Primitive.li,{role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":$?"open":"closed","data-swipe-direction":Bt.swipeDirection,...Vt,ref:Ut,style:{userSelect:"none",touchAction:"none",...e.style},onKeyDown:composeEventHandlers(e.onKeyDown,fn=>{fn.key==="Escape"&&(c==null||c(fn.nativeEvent),fn.nativeEvent.defaultPrevented||(Bt.isFocusedToastEscapeKeyDownRef.current=!0,un()))}),onPointerDown:composeEventHandlers(e.onPointerDown,fn=>{fn.button===0&&(Nt.current={x:fn.clientX,y:fn.clientY})}),onPointerMove:composeEventHandlers(e.onPointerMove,fn=>{if(!Nt.current)return;const Fr=fn.clientX-Nt.current.x,Cr=fn.clientY-Nt.current.y,Sr=!!Gt.current,dr=["left","right"].includes(Bt.swipeDirection),gr=["left","up"].includes(Bt.swipeDirection)?Math.min:Math.max,qr=dr?gr(0,Fr):0,Lr=dr?0:gr(0,Cr),_n=fn.pointerType==="touch"?10:2,gn={x:qr,y:Lr},Sn={originalEvent:fn,delta:gn};Sr?(Gt.current=gn,handleAndDispatchCustomEvent(TOAST_SWIPE_MOVE,St,Sn,{discrete:!1})):isDeltaInDirection(gn,Bt.swipeDirection,_n)?(Gt.current=gn,handleAndDispatchCustomEvent(TOAST_SWIPE_START,Et,Sn,{discrete:!1}),fn.target.setPointerCapture(fn.pointerId)):(Math.abs(Fr)>_n||Math.abs(Cr)>_n)&&(Nt.current=null)}),onPointerUp:composeEventHandlers(e.onPointerUp,fn=>{const Fr=Gt.current,Cr=fn.target;if(Cr.hasPointerCapture(fn.pointerId)&&Cr.releasePointerCapture(fn.pointerId),Gt.current=null,Nt.current=null,Fr){const Sr=fn.currentTarget,dr={originalEvent:fn,delta:Fr};isDeltaInDirection(Fr,Bt.swipeDirection,Bt.swipeThreshold)?handleAndDispatchCustomEvent(TOAST_SWIPE_END,Pt,dr,{discrete:!0}):handleAndDispatchCustomEvent(TOAST_SWIPE_CANCEL,At,dr,{discrete:!0}),Sr.addEventListener("click",gr=>gr.preventDefault(),{once:!0})}})})})}),Bt.viewport)})]}):null}),ToastAnnounce=e=>{const{__scopeToast:i,children:s,...a}=e,_=useToastProviderContext(TOAST_NAME,i),[$,rt]=reactExports.useState(!1),[c,dt]=reactExports.useState(!1);return useNextFrame(()=>rt(!0)),reactExports.useEffect(()=>{const ht=window.setTimeout(()=>dt(!0),1e3);return()=>window.clearTimeout(ht)},[]),c?null:jsxRuntimeExports.jsx(Portal$2,{asChild:!0,children:jsxRuntimeExports.jsx(VisuallyHidden,{...a,children:$&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[_.label," ",s]})})})},TITLE_NAME$2="ToastTitle",ToastTitle$1=reactExports.forwardRef((e,i)=>{const{__scopeToast:s,...a}=e;return jsxRuntimeExports.jsx(Primitive.div,{...a,ref:i})});ToastTitle$1.displayName=TITLE_NAME$2;var DESCRIPTION_NAME$2="ToastDescription",ToastDescription$1=reactExports.forwardRef((e,i)=>{const{__scopeToast:s,...a}=e;return jsxRuntimeExports.jsx(Primitive.div,{...a,ref:i})});ToastDescription$1.displayName=DESCRIPTION_NAME$2;var ACTION_NAME$1="ToastAction",ToastAction$1=reactExports.forwardRef((e,i)=>{const{altText:s,...a}=e;return s.trim()?jsxRuntimeExports.jsx(ToastAnnounceExclude,{altText:s,asChild:!0,children:jsxRuntimeExports.jsx(ToastClose$1,{...a,ref:i})}):(console.error(`Invalid prop \`altText\` supplied to \`${ACTION_NAME$1}\`. Expected non-empty \`string\`.`),null)});ToastAction$1.displayName=ACTION_NAME$1;var CLOSE_NAME$1="ToastClose",ToastClose$1=reactExports.forwardRef((e,i)=>{const{__scopeToast:s,...a}=e,_=useToastInteractiveContext(CLOSE_NAME$1,s);return jsxRuntimeExports.jsx(ToastAnnounceExclude,{asChild:!0,children:jsxRuntimeExports.jsx(Primitive.button,{type:"button",...a,ref:i,onClick:composeEventHandlers(e.onClick,_.onClose)})})});ToastClose$1.displayName=CLOSE_NAME$1;var ToastAnnounceExclude=reactExports.forwardRef((e,i)=>{const{__scopeToast:s,altText:a,..._}=e;return jsxRuntimeExports.jsx(Primitive.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":a||void 0,..._,ref:i})});function getAnnounceTextContent(e){const i=[];return Array.from(e.childNodes).forEach(a=>{if(a.nodeType===a.TEXT_NODE&&a.textContent&&i.push(a.textContent),isHTMLElement$2(a)){const _=a.ariaHidden||a.hidden||a.style.display==="none",$=a.dataset.radixToastAnnounceExclude==="";if(!_)if($){const rt=a.dataset.radixToastAnnounceAlt;rt&&i.push(rt)}else i.push(...getAnnounceTextContent(a))}}),i}function handleAndDispatchCustomEvent(e,i,s,{discrete:a}){const _=s.originalEvent.currentTarget,$=new CustomEvent(e,{bubbles:!0,cancelable:!0,detail:s});i&&_.addEventListener(e,i,{once:!0}),a?dispatchDiscreteCustomEvent(_,$):_.dispatchEvent($)}var isDeltaInDirection=(e,i,s=0)=>{const a=Math.abs(e.x),_=Math.abs(e.y),$=a>_;return i==="left"||i==="right"?$&&a>s:!$&&_>s};function useNextFrame(e=()=>{}){const i=useCallbackRef$1(e);useLayoutEffect2(()=>{let s=0,a=0;return s=window.requestAnimationFrame(()=>a=window.requestAnimationFrame(i)),()=>{window.cancelAnimationFrame(s),window.cancelAnimationFrame(a)}},[i])}function isHTMLElement$2(e){return e.nodeType===e.ELEMENT_NODE}function getTabbableCandidates$1(e){const i=[],s=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:a=>{const _=a.tagName==="INPUT"&&a.type==="hidden";return a.disabled||a.hidden||_?NodeFilter.FILTER_SKIP:a.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;s.nextNode();)i.push(s.currentNode);return i}function focusFirst$1(e){const i=document.activeElement;return e.some(s=>s===i?!0:(s.focus(),document.activeElement!==i))}var Provider$2=ToastProvider$1,Viewport$1=ToastViewport$1,Root2$4=Toast$1,Title$1=ToastTitle$1,Description$1=ToastDescription$1,Action$2=ToastAction$1,Close$1=ToastClose$1;function r(e){var i,s,a="";if(typeof e=="string"||typeof e=="number")a+=e;else if(typeof e=="object")if(Array.isArray(e)){var _=e.length;for(i=0;i<_;i++)e[i]&&(s=r(e[i]))&&(a&&(a+=" "),a+=s)}else for(s in e)e[s]&&(a&&(a+=" "),a+=s);return a}function clsx(){for(var e,i,s=0,a="",_=arguments.length;s<_;s++)(e=arguments[s])&&(i=r(e))&&(a&&(a+=" "),a+=i);return a}const falsyToString=e=>typeof e=="boolean"?`${e}`:e===0?"0":e,cx=clsx,cva=(e,i)=>s=>{var a;if((i==null?void 0:i.variants)==null)return cx(e,s==null?void 0:s.class,s==null?void 0:s.className);const{variants:_,defaultVariants:$}=i,rt=Object.keys(_).map(ht=>{const Et=s==null?void 0:s[ht],St=$==null?void 0:$[ht];if(Et===null)return null;const At=falsyToString(Et)||falsyToString(St);return _[ht][At]}),c=s&&Object.entries(s).reduce((ht,Et)=>{let[St,At]=Et;return At===void 0||(ht[St]=At),ht},{}),dt=i==null||(a=i.compoundVariants)===null||a===void 0?void 0:a.reduce((ht,Et)=>{let{class:St,className:At,...Pt}=Et;return Object.entries(Pt).every(Vt=>{let[Bt,Zt]=Vt;return Array.isArray(Zt)?Zt.includes({...$,...c}[Bt]):{...$,...c}[Bt]===Zt})?[...ht,St,At]:ht},[]);return cx(e,rt,dt,s==null?void 0:s.class,s==null?void 0:s.className)};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const toKebabCase=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),mergeClasses=(...e)=>e.filter((i,s,a)=>!!i&&i.trim()!==""&&a.indexOf(i)===s).join(" ").trim();/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var defaultAttributes={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Icon$1=reactExports.forwardRef(({color:e="currentColor",size:i=24,strokeWidth:s=2,absoluteStrokeWidth:a,className:_="",children:$,iconNode:rt,...c},dt)=>reactExports.createElement("svg",{ref:dt,...defaultAttributes,width:i,height:i,stroke:e,strokeWidth:a?Number(s)*24/Number(i):s,className:mergeClasses("lucide",_),...c},[...rt.map(([ht,Et])=>reactExports.createElement(ht,Et)),...Array.isArray($)?$:[$]]));/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const createLucideIcon=(e,i)=>{const s=reactExports.forwardRef(({className:a,..._},$)=>reactExports.createElement(Icon$1,{ref:$,iconNode:i,className:mergeClasses(`lucide-${toKebabCase(e)}`,a),..._}));return s.displayName=`${e}`,s};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ArrowLeft=createLucideIcon("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ArrowRight=createLucideIcon("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ArrowUpRight=createLucideIcon("ArrowUpRight",[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bell=createLucideIcon("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Briefcase=createLucideIcon("Briefcase",[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Camera=createLucideIcon("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Check=createLucideIcon("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ChefHat=createLucideIcon("ChefHat",[["path",{d:"M17 21a1 1 0 0 0 1-1v-5.35c0-.457.316-.844.727-1.041a4 4 0 0 0-2.134-7.589 5 5 0 0 0-9.186 0 4 4 0 0 0-2.134 7.588c.411.198.727.585.727 1.041V20a1 1 0 0 0 1 1Z",key:"1qvrer"}],["path",{d:"M6 17h12",key:"1jwigz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ChevronDown=createLucideIcon("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ChevronLeft=createLucideIcon("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ChevronRight=createLucideIcon("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ChevronUp=createLucideIcon("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CircleHelp=createLucideIcon("CircleHelp",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Clock=createLucideIcon("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CreditCard=createLucideIcon("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DollarSign=createLucideIcon("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ExternalLink=createLucideIcon("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const EyeOff=createLucideIcon("EyeOff",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Eye=createLucideIcon("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const FileText=createLucideIcon("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Globe=createLucideIcon("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Heart=createLucideIcon("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const House=createLucideIcon("House",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Info=createLucideIcon("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Leaf=createLucideIcon("Leaf",[["path",{d:"M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10Z",key:"nnexq3"}],["path",{d:"M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12",key:"mt58a7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LoaderCircle=createLucideIcon("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lock=createLucideIcon("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LogOut=createLucideIcon("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mail=createLucideIcon("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const MapPin=createLucideIcon("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Menu=createLucideIcon("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const MessageCircle=createLucideIcon("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Minus=createLucideIcon("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Moon=createLucideIcon("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Navigation=createLucideIcon("Navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Package=createLucideIcon("Package",[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["path",{d:"m3.3 7 7.703 4.734a2 2 0 0 0 1.994 0L20.7 7",key:"yx3hmr"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Percent=createLucideIcon("Percent",[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Phone=createLucideIcon("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Plus=createLucideIcon("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const QrCode=createLucideIcon("QrCode",[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1",key:"1tu5fj"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1",key:"1v8r4q"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1",key:"1x03jg"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3",key:"177gqh"}],["path",{d:"M21 21v.01",key:"ents32"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7",key:"8crl2c"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M12 3h.01",key:"n36tog"}],["path",{d:"M12 16v.01",key:"133mhm"}],["path",{d:"M16 12h1",key:"1slzba"}],["path",{d:"M21 12v.01",key:"1lwtk9"}],["path",{d:"M12 21v-1",key:"1880an"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RefreshCw=createLucideIcon("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Search=createLucideIcon("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Settings=createLucideIcon("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Share2=createLucideIcon("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ShieldCheck=createLucideIcon("ShieldCheck",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ShoppingBag=createLucideIcon("ShoppingBag",[["path",{d:"M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z",key:"hou9p0"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M16 10a4 4 0 0 1-8 0",key:"1ltviw"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Smartphone=createLucideIcon("Smartphone",[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sparkles=createLucideIcon("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SquarePen=createLucideIcon("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Star=createLucideIcon("Star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Store$1=createLucideIcon("Store",[["path",{d:"m2 7 4.41-4.41A2 2 0 0 1 7.83 2h8.34a2 2 0 0 1 1.42.59L22 7",key:"ztvudi"}],["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}],["path",{d:"M15 22v-4a2 2 0 0 0-2-2h-2a2 2 0 0 0-2 2v4",key:"2ebpfo"}],["path",{d:"M2 7h20",key:"1fcdvo"}],["path",{d:"M22 7v3a2 2 0 0 1-2 2a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 16 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 12 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 8 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 4 12a2 2 0 0 1-2-2V7",key:"6c3vgh"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tag=createLucideIcon("Tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Trash2=createLucideIcon("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TrendingUp=createLucideIcon("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TriangleAlert=createLucideIcon("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Truck=createLucideIcon("Truck",[["path",{d:"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2",key:"wrbu53"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["path",{d:"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14",key:"lysw3i"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const UserPlus=createLucideIcon("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const User=createLucideIcon("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Users=createLucideIcon("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wallet=createLucideIcon("Wallet",[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=createLucideIcon("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),CLASS_PART_SEPARATOR="-",createClassGroupUtils=e=>{const i=createClassMap(e),{conflictingClassGroups:s,conflictingClassGroupModifiers:a}=e;return{getClassGroupId:rt=>{const c=rt.split(CLASS_PART_SEPARATOR);return c[0]===""&&c.length!==1&&c.shift(),getGroupRecursive(c,i)||getGroupIdForArbitraryProperty(rt)},getConflictingClassGroupIds:(rt,c)=>{const dt=s[rt]||[];return c&&a[rt]?[...dt,...a[rt]]:dt}}},getGroupRecursive=(e,i)=>{var rt;if(e.length===0)return i.classGroupId;const s=e[0],a=i.nextPart.get(s),_=a?getGroupRecursive(e.slice(1),a):void 0;if(_)return _;if(i.validators.length===0)return;const $=e.join(CLASS_PART_SEPARATOR);return(rt=i.validators.find(({validator:c})=>c($)))==null?void 0:rt.classGroupId},arbitraryPropertyRegex=/^\[(.+)\]$/,getGroupIdForArbitraryProperty=e=>{if(arbitraryPropertyRegex.test(e)){const i=arbitraryPropertyRegex.exec(e)[1],s=i==null?void 0:i.substring(0,i.indexOf(":"));if(s)return"arbitrary.."+s}},createClassMap=e=>{const{theme:i,prefix:s}=e,a={nextPart:new Map,validators:[]};return getPrefixedClassGroupEntries(Object.entries(e.classGroups),s).forEach(([$,rt])=>{processClassesRecursively(rt,a,$,i)}),a},processClassesRecursively=(e,i,s,a)=>{e.forEach(_=>{if(typeof _=="string"){const $=_===""?i:getPart(i,_);$.classGroupId=s;return}if(typeof _=="function"){if(isThemeGetter(_)){processClassesRecursively(_(a),i,s,a);return}i.validators.push({validator:_,classGroupId:s});return}Object.entries(_).forEach(([$,rt])=>{processClassesRecursively(rt,getPart(i,$),s,a)})})},getPart=(e,i)=>{let s=e;return i.split(CLASS_PART_SEPARATOR).forEach(a=>{s.nextPart.has(a)||s.nextPart.set(a,{nextPart:new Map,validators:[]}),s=s.nextPart.get(a)}),s},isThemeGetter=e=>e.isThemeGetter,getPrefixedClassGroupEntries=(e,i)=>i?e.map(([s,a])=>{const _=a.map($=>typeof $=="string"?i+$:typeof $=="object"?Object.fromEntries(Object.entries($).map(([rt,c])=>[i+rt,c])):$);return[s,_]}):e,createLruCache=e=>{if(e<1)return{get:()=>{},set:()=>{}};let i=0,s=new Map,a=new Map;const _=($,rt)=>{s.set($,rt),i++,i>e&&(i=0,a=s,s=new Map)};return{get($){let rt=s.get($);if(rt!==void 0)return rt;if((rt=a.get($))!==void 0)return _($,rt),rt},set($,rt){s.has($)?s.set($,rt):_($,rt)}}},IMPORTANT_MODIFIER="!",createParseClassName=e=>{const{separator:i,experimentalParseClassName:s}=e,a=i.length===1,_=i[0],$=i.length,rt=c=>{const dt=[];let ht=0,Et=0,St;for(let Zt=0;Zt<c.length;Zt++){let zt=c[Zt];if(ht===0){if(zt===_&&(a||c.slice(Zt,Zt+$)===i)){dt.push(c.slice(Et,Zt)),Et=Zt+$;continue}if(zt==="/"){St=Zt;continue}}zt==="["?ht++:zt==="]"&&ht--}const At=dt.length===0?c:c.substring(Et),Pt=At.startsWith(IMPORTANT_MODIFIER),Vt=Pt?At.substring(1):At,Bt=St&&St>Et?St-Et:void 0;return{modifiers:dt,hasImportantModifier:Pt,baseClassName:Vt,maybePostfixModifierPosition:Bt}};return s?c=>s({className:c,parseClassName:rt}):rt},sortModifiers=e=>{if(e.length<=1)return e;const i=[];let s=[];return e.forEach(a=>{a[0]==="["?(i.push(...s.sort(),a),s=[]):s.push(a)}),i.push(...s.sort()),i},createConfigUtils=e=>({cache:createLruCache(e.cacheSize),parseClassName:createParseClassName(e),...createClassGroupUtils(e)}),SPLIT_CLASSES_REGEX=/\s+/,mergeClassList=(e,i)=>{const{parseClassName:s,getClassGroupId:a,getConflictingClassGroupIds:_}=i,$=[],rt=e.trim().split(SPLIT_CLASSES_REGEX);let c="";for(let dt=rt.length-1;dt>=0;dt-=1){const ht=rt[dt],{modifiers:Et,hasImportantModifier:St,baseClassName:At,maybePostfixModifierPosition:Pt}=s(ht);let Vt=!!Pt,Bt=a(Vt?At.substring(0,Pt):At);if(!Bt){if(!Vt){c=ht+(c.length>0?" "+c:c);continue}if(Bt=a(At),!Bt){c=ht+(c.length>0?" "+c:c);continue}Vt=!1}const Zt=sortModifiers(Et).join(":"),zt=St?Zt+IMPORTANT_MODIFIER:Zt,Ut=zt+Bt;if($.includes(Ut))continue;$.push(Ut);const Nt=_(Bt,Vt);for(let Gt=0;Gt<Nt.length;++Gt){const er=Nt[Gt];$.push(zt+er)}c=ht+(c.length>0?" "+c:c)}return c};function twJoin(){let e=0,i,s,a="";for(;e<arguments.length;)(i=arguments[e++])&&(s=toValue(i))&&(a&&(a+=" "),a+=s);return a}const toValue=e=>{if(typeof e=="string")return e;let i,s="";for(let a=0;a<e.length;a++)e[a]&&(i=toValue(e[a]))&&(s&&(s+=" "),s+=i);return s};function createTailwindMerge(e,...i){let s,a,_,$=rt;function rt(dt){const ht=i.reduce((Et,St)=>St(Et),e());return s=createConfigUtils(ht),a=s.cache.get,_=s.cache.set,$=c,c(dt)}function c(dt){const ht=a(dt);if(ht)return ht;const Et=mergeClassList(dt,s);return _(dt,Et),Et}return function(){return $(twJoin.apply(null,arguments))}}const fromTheme=e=>{const i=s=>s[e]||[];return i.isThemeGetter=!0,i},arbitraryValueRegex=/^\[(?:([a-z-]+):)?(.+)\]$/i,fractionRegex=/^\d+\/\d+$/,stringLengths=new Set(["px","full","screen"]),tshirtUnitRegex=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,lengthUnitRegex=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,colorFunctionRegex=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,shadowRegex=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,imageRegex=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,isLength=e=>isNumber$1(e)||stringLengths.has(e)||fractionRegex.test(e),isArbitraryLength=e=>getIsArbitraryValue(e,"length",isLengthOnly),isNumber$1=e=>!!e&&!Number.isNaN(Number(e)),isArbitraryNumber=e=>getIsArbitraryValue(e,"number",isNumber$1),isInteger=e=>!!e&&Number.isInteger(Number(e)),isPercent=e=>e.endsWith("%")&&isNumber$1(e.slice(0,-1)),isArbitraryValue=e=>arbitraryValueRegex.test(e),isTshirtSize=e=>tshirtUnitRegex.test(e),sizeLabels=new Set(["length","size","percentage"]),isArbitrarySize=e=>getIsArbitraryValue(e,sizeLabels,isNever),isArbitraryPosition=e=>getIsArbitraryValue(e,"position",isNever),imageLabels=new Set(["image","url"]),isArbitraryImage=e=>getIsArbitraryValue(e,imageLabels,isImage),isArbitraryShadow=e=>getIsArbitraryValue(e,"",isShadow),isAny=()=>!0,getIsArbitraryValue=(e,i,s)=>{const a=arbitraryValueRegex.exec(e);return a?a[1]?typeof i=="string"?a[1]===i:i.has(a[1]):s(a[2]):!1},isLengthOnly=e=>lengthUnitRegex.test(e)&&!colorFunctionRegex.test(e),isNever=()=>!1,isShadow=e=>shadowRegex.test(e),isImage=e=>imageRegex.test(e),getDefaultConfig=()=>{const e=fromTheme("colors"),i=fromTheme("spacing"),s=fromTheme("blur"),a=fromTheme("brightness"),_=fromTheme("borderColor"),$=fromTheme("borderRadius"),rt=fromTheme("borderSpacing"),c=fromTheme("borderWidth"),dt=fromTheme("contrast"),ht=fromTheme("grayscale"),Et=fromTheme("hueRotate"),St=fromTheme("invert"),At=fromTheme("gap"),Pt=fromTheme("gradientColorStops"),Vt=fromTheme("gradientColorStopPositions"),Bt=fromTheme("inset"),Zt=fromTheme("margin"),zt=fromTheme("opacity"),Ut=fromTheme("padding"),Nt=fromTheme("saturate"),Gt=fromTheme("scale"),er=fromTheme("sepia"),ir=fromTheme("skew"),or=fromTheme("space"),mr=fromTheme("translate"),Rr=()=>["auto","contain","none"],on=()=>["auto","hidden","clip","visible","scroll"],un=()=>["auto",isArbitraryValue,i],jr=()=>[isArbitraryValue,i],Jr=()=>["",isLength,isArbitraryLength],fn=()=>["auto",isNumber$1,isArbitraryValue],Fr=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],Cr=()=>["solid","dashed","dotted","double","none"],Sr=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],dr=()=>["start","end","center","between","around","evenly","stretch"],gr=()=>["","0",isArbitraryValue],qr=()=>["auto","avoid","all","avoid-page","page","left","right","column"],Lr=()=>[isNumber$1,isArbitraryValue];return{cacheSize:500,separator:":",theme:{colors:[isAny],spacing:[isLength,isArbitraryLength],blur:["none","",isTshirtSize,isArbitraryValue],brightness:Lr(),borderColor:[e],borderRadius:["none","","full",isTshirtSize,isArbitraryValue],borderSpacing:jr(),borderWidth:Jr(),contrast:Lr(),grayscale:gr(),hueRotate:Lr(),invert:gr(),gap:jr(),gradientColorStops:[e],gradientColorStopPositions:[isPercent,isArbitraryLength],inset:un(),margin:un(),opacity:Lr(),padding:jr(),saturate:Lr(),scale:Lr(),sepia:gr(),skew:Lr(),space:jr(),translate:jr()},classGroups:{aspect:[{aspect:["auto","square","video",isArbitraryValue]}],container:["container"],columns:[{columns:[isTshirtSize]}],"break-after":[{"break-after":qr()}],"break-before":[{"break-before":qr()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...Fr(),isArbitraryValue]}],overflow:[{overflow:on()}],"overflow-x":[{"overflow-x":on()}],"overflow-y":[{"overflow-y":on()}],overscroll:[{overscroll:Rr()}],"overscroll-x":[{"overscroll-x":Rr()}],"overscroll-y":[{"overscroll-y":Rr()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[Bt]}],"inset-x":[{"inset-x":[Bt]}],"inset-y":[{"inset-y":[Bt]}],start:[{start:[Bt]}],end:[{end:[Bt]}],top:[{top:[Bt]}],right:[{right:[Bt]}],bottom:[{bottom:[Bt]}],left:[{left:[Bt]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",isInteger,isArbitraryValue]}],basis:[{basis:un()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",isArbitraryValue]}],grow:[{grow:gr()}],shrink:[{shrink:gr()}],order:[{order:["first","last","none",isInteger,isArbitraryValue]}],"grid-cols":[{"grid-cols":[isAny]}],"col-start-end":[{col:["auto",{span:["full",isInteger,isArbitraryValue]},isArbitraryValue]}],"col-start":[{"col-start":fn()}],"col-end":[{"col-end":fn()}],"grid-rows":[{"grid-rows":[isAny]}],"row-start-end":[{row:["auto",{span:[isInteger,isArbitraryValue]},isArbitraryValue]}],"row-start":[{"row-start":fn()}],"row-end":[{"row-end":fn()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",isArbitraryValue]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",isArbitraryValue]}],gap:[{gap:[At]}],"gap-x":[{"gap-x":[At]}],"gap-y":[{"gap-y":[At]}],"justify-content":[{justify:["normal",...dr()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...dr(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...dr(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[Ut]}],px:[{px:[Ut]}],py:[{py:[Ut]}],ps:[{ps:[Ut]}],pe:[{pe:[Ut]}],pt:[{pt:[Ut]}],pr:[{pr:[Ut]}],pb:[{pb:[Ut]}],pl:[{pl:[Ut]}],m:[{m:[Zt]}],mx:[{mx:[Zt]}],my:[{my:[Zt]}],ms:[{ms:[Zt]}],me:[{me:[Zt]}],mt:[{mt:[Zt]}],mr:[{mr:[Zt]}],mb:[{mb:[Zt]}],ml:[{ml:[Zt]}],"space-x":[{"space-x":[or]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[or]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",isArbitraryValue,i]}],"min-w":[{"min-w":[isArbitraryValue,i,"min","max","fit"]}],"max-w":[{"max-w":[isArbitraryValue,i,"none","full","min","max","fit","prose",{screen:[isTshirtSize]},isTshirtSize]}],h:[{h:[isArbitraryValue,i,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[isArbitraryValue,i,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[isArbitraryValue,i,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[isArbitraryValue,i,"auto","min","max","fit"]}],"font-size":[{text:["base",isTshirtSize,isArbitraryLength]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",isArbitraryNumber]}],"font-family":[{font:[isAny]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",isArbitraryValue]}],"line-clamp":[{"line-clamp":["none",isNumber$1,isArbitraryNumber]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",isLength,isArbitraryValue]}],"list-image":[{"list-image":["none",isArbitraryValue]}],"list-style-type":[{list:["none","disc","decimal",isArbitraryValue]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[e]}],"placeholder-opacity":[{"placeholder-opacity":[zt]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[e]}],"text-opacity":[{"text-opacity":[zt]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...Cr(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",isLength,isArbitraryLength]}],"underline-offset":[{"underline-offset":["auto",isLength,isArbitraryValue]}],"text-decoration-color":[{decoration:[e]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:jr()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",isArbitraryValue]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",isArbitraryValue]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[zt]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...Fr(),isArbitraryPosition]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",isArbitrarySize]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},isArbitraryImage]}],"bg-color":[{bg:[e]}],"gradient-from-pos":[{from:[Vt]}],"gradient-via-pos":[{via:[Vt]}],"gradient-to-pos":[{to:[Vt]}],"gradient-from":[{from:[Pt]}],"gradient-via":[{via:[Pt]}],"gradient-to":[{to:[Pt]}],rounded:[{rounded:[$]}],"rounded-s":[{"rounded-s":[$]}],"rounded-e":[{"rounded-e":[$]}],"rounded-t":[{"rounded-t":[$]}],"rounded-r":[{"rounded-r":[$]}],"rounded-b":[{"rounded-b":[$]}],"rounded-l":[{"rounded-l":[$]}],"rounded-ss":[{"rounded-ss":[$]}],"rounded-se":[{"rounded-se":[$]}],"rounded-ee":[{"rounded-ee":[$]}],"rounded-es":[{"rounded-es":[$]}],"rounded-tl":[{"rounded-tl":[$]}],"rounded-tr":[{"rounded-tr":[$]}],"rounded-br":[{"rounded-br":[$]}],"rounded-bl":[{"rounded-bl":[$]}],"border-w":[{border:[c]}],"border-w-x":[{"border-x":[c]}],"border-w-y":[{"border-y":[c]}],"border-w-s":[{"border-s":[c]}],"border-w-e":[{"border-e":[c]}],"border-w-t":[{"border-t":[c]}],"border-w-r":[{"border-r":[c]}],"border-w-b":[{"border-b":[c]}],"border-w-l":[{"border-l":[c]}],"border-opacity":[{"border-opacity":[zt]}],"border-style":[{border:[...Cr(),"hidden"]}],"divide-x":[{"divide-x":[c]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[c]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[zt]}],"divide-style":[{divide:Cr()}],"border-color":[{border:[_]}],"border-color-x":[{"border-x":[_]}],"border-color-y":[{"border-y":[_]}],"border-color-s":[{"border-s":[_]}],"border-color-e":[{"border-e":[_]}],"border-color-t":[{"border-t":[_]}],"border-color-r":[{"border-r":[_]}],"border-color-b":[{"border-b":[_]}],"border-color-l":[{"border-l":[_]}],"divide-color":[{divide:[_]}],"outline-style":[{outline:["",...Cr()]}],"outline-offset":[{"outline-offset":[isLength,isArbitraryValue]}],"outline-w":[{outline:[isLength,isArbitraryLength]}],"outline-color":[{outline:[e]}],"ring-w":[{ring:Jr()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[e]}],"ring-opacity":[{"ring-opacity":[zt]}],"ring-offset-w":[{"ring-offset":[isLength,isArbitraryLength]}],"ring-offset-color":[{"ring-offset":[e]}],shadow:[{shadow:["","inner","none",isTshirtSize,isArbitraryShadow]}],"shadow-color":[{shadow:[isAny]}],opacity:[{opacity:[zt]}],"mix-blend":[{"mix-blend":[...Sr(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":Sr()}],filter:[{filter:["","none"]}],blur:[{blur:[s]}],brightness:[{brightness:[a]}],contrast:[{contrast:[dt]}],"drop-shadow":[{"drop-shadow":["","none",isTshirtSize,isArbitraryValue]}],grayscale:[{grayscale:[ht]}],"hue-rotate":[{"hue-rotate":[Et]}],invert:[{invert:[St]}],saturate:[{saturate:[Nt]}],sepia:[{sepia:[er]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[s]}],"backdrop-brightness":[{"backdrop-brightness":[a]}],"backdrop-contrast":[{"backdrop-contrast":[dt]}],"backdrop-grayscale":[{"backdrop-grayscale":[ht]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[Et]}],"backdrop-invert":[{"backdrop-invert":[St]}],"backdrop-opacity":[{"backdrop-opacity":[zt]}],"backdrop-saturate":[{"backdrop-saturate":[Nt]}],"backdrop-sepia":[{"backdrop-sepia":[er]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[rt]}],"border-spacing-x":[{"border-spacing-x":[rt]}],"border-spacing-y":[{"border-spacing-y":[rt]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",isArbitraryValue]}],duration:[{duration:Lr()}],ease:[{ease:["linear","in","out","in-out",isArbitraryValue]}],delay:[{delay:Lr()}],animate:[{animate:["none","spin","ping","pulse","bounce",isArbitraryValue]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[Gt]}],"scale-x":[{"scale-x":[Gt]}],"scale-y":[{"scale-y":[Gt]}],rotate:[{rotate:[isInteger,isArbitraryValue]}],"translate-x":[{"translate-x":[mr]}],"translate-y":[{"translate-y":[mr]}],"skew-x":[{"skew-x":[ir]}],"skew-y":[{"skew-y":[ir]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",isArbitraryValue]}],accent:[{accent:["auto",e]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",isArbitraryValue]}],"caret-color":[{caret:[e]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":jr()}],"scroll-mx":[{"scroll-mx":jr()}],"scroll-my":[{"scroll-my":jr()}],"scroll-ms":[{"scroll-ms":jr()}],"scroll-me":[{"scroll-me":jr()}],"scroll-mt":[{"scroll-mt":jr()}],"scroll-mr":[{"scroll-mr":jr()}],"scroll-mb":[{"scroll-mb":jr()}],"scroll-ml":[{"scroll-ml":jr()}],"scroll-p":[{"scroll-p":jr()}],"scroll-px":[{"scroll-px":jr()}],"scroll-py":[{"scroll-py":jr()}],"scroll-ps":[{"scroll-ps":jr()}],"scroll-pe":[{"scroll-pe":jr()}],"scroll-pt":[{"scroll-pt":jr()}],"scroll-pr":[{"scroll-pr":jr()}],"scroll-pb":[{"scroll-pb":jr()}],"scroll-pl":[{"scroll-pl":jr()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",isArbitraryValue]}],fill:[{fill:[e,"none"]}],"stroke-w":[{stroke:[isLength,isArbitraryLength,isArbitraryNumber]}],stroke:[{stroke:[e,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},twMerge=createTailwindMerge(getDefaultConfig);function cn(...e){return twMerge(clsx(e))}function calculateDistance(e,i,s,a){const $=deg2rad(s-e),rt=deg2rad(a-i),c=Math.sin($/2)*Math.sin($/2)+Math.cos(deg2rad(e))*Math.cos(deg2rad(s))*Math.sin(rt/2)*Math.sin(rt/2),ht=6371*(2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)));return ht<1?`${Math.round(ht*1e3)}m`:`${ht.toFixed(1)} km`}function deg2rad(e){return e*(Math.PI/180)}const ToastProvider=Provider$2,ToastViewport=reactExports.forwardRef(({className:e,...i},s)=>jsxRuntimeExports.jsx(Viewport$1,{ref:s,className:cn("fixed top-0 z-[100] flex max-h-screen w-full flex-col p-4 sm:right-0 sm:flex-col md:max-w-[420px]",e),...i}));ToastViewport.displayName=Viewport$1.displayName;const toastVariants=cva("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-top-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),Toast=reactExports.forwardRef(({className:e,variant:i,...s},a)=>jsxRuntimeExports.jsx(Root2$4,{ref:a,className:cn(toastVariants({variant:i}),e),...s}));Toast.displayName=Root2$4.displayName;const ToastAction=reactExports.forwardRef(({className:e,...i},s)=>jsxRuntimeExports.jsx(Action$2,{ref:s,className:cn("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors group-[.destructive]:border-muted/40 hover:bg-secondary group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 group-[.destructive]:focus:ring-destructive disabled:pointer-events-none disabled:opacity-50",e),...i}));ToastAction.displayName=Action$2.displayName;const ToastClose=reactExports.forwardRef(({className:e,...i},s)=>jsxRuntimeExports.jsx(Close$1,{ref:s,className:cn("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity group-hover:opacity-100 group-[.destructive]:text-red-300 hover:text-foreground group-[.destructive]:hover:text-red-50 focus:opacity-100 focus:outline-none focus:ring-2 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",e),"toast-close":"",...i,children:jsxRuntimeExports.jsx(X,{className:"h-4 w-4"})}));ToastClose.displayName=Close$1.displayName;const ToastTitle=reactExports.forwardRef(({className:e,...i},s)=>jsxRuntimeExports.jsx(Title$1,{ref:s,className:cn("text-sm font-semibold",e),...i}));ToastTitle.displayName=Title$1.displayName;const ToastDescription=reactExports.forwardRef(({className:e,...i},s)=>jsxRuntimeExports.jsx(Description$1,{ref:s,className:cn("text-sm opacity-90",e),...i}));ToastDescription.displayName=Description$1.displayName;function Toaster$1(){const{toasts:e}=useToast();return jsxRuntimeExports.jsxs(ToastProvider,{children:[e.map(function({id:i,title:s,description:a,action:_,...$}){return jsxRuntimeExports.jsxs(Toast,{...$,children:[jsxRuntimeExports.jsxs("div",{className:"grid gap-1",children:[s&&jsxRuntimeExports.jsx(ToastTitle,{children:s}),a&&jsxRuntimeExports.jsx(ToastDescription,{children:a})]}),_,jsxRuntimeExports.jsx(ToastClose,{})]},i)}),jsxRuntimeExports.jsx(ToastViewport,{})]})}var P=["light","dark"],E="(prefers-color-scheme: dark)",L=reactExports.createContext(void 0),D={setTheme:e=>{},themes:[]},j=()=>{var e;return(e=reactExports.useContext(L))!=null?e:D};reactExports.memo(({forcedTheme:e,storageKey:i,attribute:s,enableSystem:a,enableColorScheme:_,defaultTheme:$,value:rt,attrs:c,nonce:dt})=>{let ht=$==="system",Et=s==="class"?`var d=document.documentElement,c=d.classList;${`c.remove(${c.map(Vt=>`'${Vt}'`).join(",")})`};`:`var d=document.documentElement,n='${s}',s='setAttribute';`,St=_?P.includes($)&&$?`if(e==='light'||e==='dark'||!e)d.style.colorScheme=e||'${$}'`:"if(e==='light'||e==='dark')d.style.colorScheme=e":"",At=(Vt,Bt=!1,Zt=!0)=>{let zt=rt?rt[Vt]:Vt,Ut=Bt?Vt+"|| ''":`'${zt}'`,Nt="";return _&&Zt&&!Bt&&P.includes(Vt)&&(Nt+=`d.style.colorScheme = '${Vt}';`),s==="class"?Bt||zt?Nt+=`c.add(${Ut})`:Nt+="null":zt&&(Nt+=`d[s](n,${Ut})`),Nt},Pt=e?`!function(){${Et}${At(e)}}()`:a?`!function(){try{${Et}var e=localStorage.getItem('${i}');if('system'===e||(!e&&${ht})){var t='${E}',m=window.matchMedia(t);if(m.media!==t||m.matches){${At("dark")}}else{${At("light")}}}else if(e){${rt?`var x=${JSON.stringify(rt)};`:""}${At(rt?"x[e]":"e",!0)}}${ht?"":"else{"+At($,!1,!1)+"}"}${St}}catch(e){}}()`:`!function(){try{${Et}var e=localStorage.getItem('${i}');if(e){${rt?`var x=${JSON.stringify(rt)};`:""}${At(rt?"x[e]":"e",!0)}}else{${At($,!1,!1)};}${St}}catch(t){}}();`;return reactExports.createElement("script",{nonce:dt,dangerouslySetInnerHTML:{__html:Pt}})});var jt=e=>{switch(e){case"success":return ee;case"info":return ae;case"warning":return oe;case"error":return se;default:return null}},te=Array(12).fill(0),Yt=({visible:e,className:i})=>React.createElement("div",{className:["sonner-loading-wrapper",i].filter(Boolean).join(" "),"data-visible":e},React.createElement("div",{className:"sonner-spinner"},te.map((s,a)=>React.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${a}`})))),ee=React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},React.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),oe=React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},React.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),ae=React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},React.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),se=React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},React.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),Ot=React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},React.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),React.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"})),Ft=()=>{let[e,i]=React.useState(document.hidden);return React.useEffect(()=>{let s=()=>{i(document.hidden)};return document.addEventListener("visibilitychange",s),()=>window.removeEventListener("visibilitychange",s)},[]),e},bt=1,yt=class{constructor(){this.subscribe=e=>(this.subscribers.push(e),()=>{let i=this.subscribers.indexOf(e);this.subscribers.splice(i,1)}),this.publish=e=>{this.subscribers.forEach(i=>i(e))},this.addToast=e=>{this.publish(e),this.toasts=[...this.toasts,e]},this.create=e=>{var i;let{message:s,...a}=e,_=typeof(e==null?void 0:e.id)=="number"||((i=e.id)==null?void 0:i.length)>0?e.id:bt++,$=this.toasts.find(c=>c.id===_),rt=e.dismissible===void 0?!0:e.dismissible;return this.dismissedToasts.has(_)&&this.dismissedToasts.delete(_),$?this.toasts=this.toasts.map(c=>c.id===_?(this.publish({...c,...e,id:_,title:s}),{...c,...e,id:_,dismissible:rt,title:s}):c):this.addToast({title:s,...a,dismissible:rt,id:_}),_},this.dismiss=e=>(this.dismissedToasts.add(e),e||this.toasts.forEach(i=>{this.subscribers.forEach(s=>s({id:i.id,dismiss:!0}))}),this.subscribers.forEach(i=>i({id:e,dismiss:!0})),e),this.message=(e,i)=>this.create({...i,message:e}),this.error=(e,i)=>this.create({...i,message:e,type:"error"}),this.success=(e,i)=>this.create({...i,type:"success",message:e}),this.info=(e,i)=>this.create({...i,type:"info",message:e}),this.warning=(e,i)=>this.create({...i,type:"warning",message:e}),this.loading=(e,i)=>this.create({...i,type:"loading",message:e}),this.promise=(e,i)=>{if(!i)return;let s;i.loading!==void 0&&(s=this.create({...i,promise:e,type:"loading",message:i.loading,description:typeof i.description!="function"?i.description:void 0}));let a=e instanceof Promise?e:e(),_=s!==void 0,$,rt=a.then(async dt=>{if($=["resolve",dt],React.isValidElement(dt))_=!1,this.create({id:s,type:"default",message:dt});else if(ie(dt)&&!dt.ok){_=!1;let ht=typeof i.error=="function"?await i.error(`HTTP error! status: ${dt.status}`):i.error,Et=typeof i.description=="function"?await i.description(`HTTP error! status: ${dt.status}`):i.description;this.create({id:s,type:"error",message:ht,description:Et})}else if(i.success!==void 0){_=!1;let ht=typeof i.success=="function"?await i.success(dt):i.success,Et=typeof i.description=="function"?await i.description(dt):i.description;this.create({id:s,type:"success",message:ht,description:Et})}}).catch(async dt=>{if($=["reject",dt],i.error!==void 0){_=!1;let ht=typeof i.error=="function"?await i.error(dt):i.error,Et=typeof i.description=="function"?await i.description(dt):i.description;this.create({id:s,type:"error",message:ht,description:Et})}}).finally(()=>{var dt;_&&(this.dismiss(s),s=void 0),(dt=i.finally)==null||dt.call(i)}),c=()=>new Promise((dt,ht)=>rt.then(()=>$[0]==="reject"?ht($[1]):dt($[1])).catch(ht));return typeof s!="string"&&typeof s!="number"?{unwrap:c}:Object.assign(s,{unwrap:c})},this.custom=(e,i)=>{let s=(i==null?void 0:i.id)||bt++;return this.create({jsx:e(s),id:s,...i}),s},this.getActiveToasts=()=>this.toasts.filter(e=>!this.dismissedToasts.has(e.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}},v$2=new yt,ne=(e,i)=>{let s=(i==null?void 0:i.id)||bt++;return v$2.addToast({title:e,...i,id:s}),s},ie=e=>e&&typeof e=="object"&&"ok"in e&&typeof e.ok=="boolean"&&"status"in e&&typeof e.status=="number",le=ne,ce=()=>v$2.toasts,de=()=>v$2.getActiveToasts(),ue=Object.assign(le,{success:v$2.success,info:v$2.info,warning:v$2.warning,error:v$2.error,custom:v$2.custom,message:v$2.message,promise:v$2.promise,dismiss:v$2.dismiss,loading:v$2.loading},{getHistory:ce,getToasts:de});function wt(e,{insertAt:i}={}){if(typeof document>"u")return;let s=document.head||document.getElementsByTagName("head")[0],a=document.createElement("style");a.type="text/css",i==="top"&&s.firstChild?s.insertBefore(a,s.firstChild):s.appendChild(a),a.styleSheet?a.styleSheet.cssText=e:a.appendChild(document.createTextNode(e))}wt(`:where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999;transition:transform .4s ease}:where([data-sonner-toaster][data-lifted="true"]){transform:translateY(-10px)}@media (hover: none) and (pointer: coarse){:where([data-sonner-toaster][data-lifted="true"]){transform:none}}:where([data-sonner-toaster][data-x-position="right"]){right:var(--offset-right)}:where([data-sonner-toaster][data-x-position="left"]){left:var(--offset-left)}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:var(--offset-top)}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:var(--offset-bottom)}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast] [data-close-button]{background:var(--gray1)}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:-50%;right:-50%;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y, 0px)) translate(var(--swipe-amount-x, 0px));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-bg-hover: hsl(0, 0%, 12%);--normal-border: hsl(0, 0%, 20%);--normal-border-hover: hsl(0, 0%, 25%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}
`);function tt(e){return e.label!==void 0}var pe=3,me="32px",ge="16px",Wt=4e3,he=356,be=14,ye=20,we=200;function M(...e){return e.filter(Boolean).join(" ")}function xe(e){let[i,s]=e.split("-"),a=[];return i&&a.push(i),s&&a.push(s),a}var ve=e=>{var i,s,a,_,$,rt,c,dt,ht,Et,St;let{invert:At,toast:Pt,unstyled:Vt,interacting:Bt,setHeights:Zt,visibleToasts:zt,heights:Ut,index:Nt,toasts:Gt,expanded:er,removeToast:ir,defaultRichColors:or,closeButton:mr,style:Rr,cancelButtonStyle:on,actionButtonStyle:un,className:jr="",descriptionClassName:Jr="",duration:fn,position:Fr,gap:Cr,loadingIcon:Sr,expandByDefault:dr,classNames:gr,icons:qr,closeButtonAriaLabel:Lr="Close toast",pauseWhenPageIsHidden:_n}=e,[gn,Sn]=React.useState(null),[Fs,rs]=React.useState(null),[ms,On]=React.useState(!1),[ws,Vs]=React.useState(!1),[ks,lo]=React.useState(!1),[ys,dn]=React.useState(!1),[Es,po]=React.useState(!1),[no,tn]=React.useState(0),[us,Co]=React.useState(0),Ss=React.useRef(Pt.duration||fn||Wt),Ul=React.useRef(null),Tl=React.useRef(null),ga=Nt===0,ds=Nt+1<=zt,Mn=Pt.type,Cs=Pt.dismissible!==!1,Ds=Pt.className||"",ao=Pt.descriptionClassName||"",Wo=React.useMemo(()=>Ut.findIndex(Ao=>Ao.toastId===Pt.id)||0,[Ut,Pt.id]),Gl=React.useMemo(()=>{var Ao;return(Ao=Pt.closeButton)!=null?Ao:mr},[Pt.closeButton,mr]),fs=React.useMemo(()=>Pt.duration||fn||Wt,[Pt.duration,fn]),ps=React.useRef(0),qn=React.useRef(0),qs=React.useRef(0),Gs=React.useRef(null),[Eo,Kl]=Fr.split("-"),tu=React.useMemo(()=>Ut.reduce((Ao,Ll,Jo)=>Jo>=Wo?Ao:Ao+Ll.height,0),[Ut,Wo]),Wl=Ft(),Zo=Pt.invert||At,ru=Mn==="loading";qn.current=React.useMemo(()=>Wo*Cr+tu,[Wo,tu]),React.useEffect(()=>{Ss.current=fs},[fs]),React.useEffect(()=>{On(!0)},[]),React.useEffect(()=>{let Ao=Tl.current;if(Ao){let Ll=Ao.getBoundingClientRect().height;return Co(Ll),Zt(Jo=>[{toastId:Pt.id,height:Ll,position:Pt.position},...Jo]),()=>Zt(Jo=>Jo.filter(Ku=>Ku.toastId!==Pt.id))}},[Zt,Pt.id]),React.useLayoutEffect(()=>{if(!ms)return;let Ao=Tl.current,Ll=Ao.style.height;Ao.style.height="auto";let Jo=Ao.getBoundingClientRect().height;Ao.style.height=Ll,Co(Jo),Zt(Ku=>Ku.find(zn=>zn.toastId===Pt.id)?Ku.map(zn=>zn.toastId===Pt.id?{...zn,height:Jo}:zn):[{toastId:Pt.id,height:Jo,position:Pt.position},...Ku])},[ms,Pt.title,Pt.description,Zt,Pt.id]);let Oo=React.useCallback(()=>{Vs(!0),tn(qn.current),Zt(Ao=>Ao.filter(Ll=>Ll.toastId!==Pt.id)),setTimeout(()=>{ir(Pt)},we)},[Pt,ir,Zt,qn]);React.useEffect(()=>{if(Pt.promise&&Mn==="loading"||Pt.duration===1/0||Pt.type==="loading")return;let Ao;return er||Bt||_n&&Wl?(()=>{if(qs.current<ps.current){let Ll=new Date().getTime()-ps.current;Ss.current=Ss.current-Ll}qs.current=new Date().getTime()})():Ss.current!==1/0&&(ps.current=new Date().getTime(),Ao=setTimeout(()=>{var Ll;(Ll=Pt.onAutoClose)==null||Ll.call(Pt,Pt),Oo()},Ss.current)),()=>clearTimeout(Ao)},[er,Bt,Pt,Mn,_n,Wl,Oo]),React.useEffect(()=>{Pt.delete&&Oo()},[Oo,Pt.delete]);function Tu(){var Ao,Ll,Jo;return qr!=null&&qr.loading?React.createElement("div",{className:M(gr==null?void 0:gr.loader,(Ao=Pt==null?void 0:Pt.classNames)==null?void 0:Ao.loader,"sonner-loader"),"data-visible":Mn==="loading"},qr.loading):Sr?React.createElement("div",{className:M(gr==null?void 0:gr.loader,(Ll=Pt==null?void 0:Pt.classNames)==null?void 0:Ll.loader,"sonner-loader"),"data-visible":Mn==="loading"},Sr):React.createElement(Yt,{className:M(gr==null?void 0:gr.loader,(Jo=Pt==null?void 0:Pt.classNames)==null?void 0:Jo.loader),visible:Mn==="loading"})}return React.createElement("li",{tabIndex:0,ref:Tl,className:M(jr,Ds,gr==null?void 0:gr.toast,(i=Pt==null?void 0:Pt.classNames)==null?void 0:i.toast,gr==null?void 0:gr.default,gr==null?void 0:gr[Mn],(s=Pt==null?void 0:Pt.classNames)==null?void 0:s[Mn]),"data-sonner-toast":"","data-rich-colors":(a=Pt.richColors)!=null?a:or,"data-styled":!(Pt.jsx||Pt.unstyled||Vt),"data-mounted":ms,"data-promise":!!Pt.promise,"data-swiped":Es,"data-removed":ws,"data-visible":ds,"data-y-position":Eo,"data-x-position":Kl,"data-index":Nt,"data-front":ga,"data-swiping":ks,"data-dismissible":Cs,"data-type":Mn,"data-invert":Zo,"data-swipe-out":ys,"data-swipe-direction":Fs,"data-expanded":!!(er||dr&&ms),style:{"--index":Nt,"--toasts-before":Nt,"--z-index":Gt.length-Nt,"--offset":`${ws?no:qn.current}px`,"--initial-height":dr?"auto":`${us}px`,...Rr,...Pt.style},onDragEnd:()=>{lo(!1),Sn(null),Gs.current=null},onPointerDown:Ao=>{ru||!Cs||(Ul.current=new Date,tn(qn.current),Ao.target.setPointerCapture(Ao.pointerId),Ao.target.tagName!=="BUTTON"&&(lo(!0),Gs.current={x:Ao.clientX,y:Ao.clientY}))},onPointerUp:()=>{var Ao,Ll,Jo,Ku;if(ys||!Cs)return;Gs.current=null;let zn=Number(((Ao=Tl.current)==null?void 0:Ao.style.getPropertyValue("--swipe-amount-x").replace("px",""))||0),Vu=Number(((Ll=Tl.current)==null?void 0:Ll.style.getPropertyValue("--swipe-amount-y").replace("px",""))||0),t0=new Date().getTime()-((Jo=Ul.current)==null?void 0:Jo.getTime()),Wu=gn==="x"?zn:Vu,Bo=Math.abs(Wu)/t0;if(Math.abs(Wu)>=ye||Bo>.11){tn(qn.current),(Ku=Pt.onDismiss)==null||Ku.call(Pt,Pt),rs(gn==="x"?zn>0?"right":"left":Vu>0?"down":"up"),Oo(),dn(!0),po(!1);return}lo(!1),Sn(null)},onPointerMove:Ao=>{var Ll,Jo,Ku,zn;if(!Gs.current||!Cs||((Ll=window.getSelection())==null?void 0:Ll.toString().length)>0)return;let Vu=Ao.clientY-Gs.current.y,t0=Ao.clientX-Gs.current.x,Wu=(Jo=e.swipeDirections)!=null?Jo:xe(Fr);!gn&&(Math.abs(t0)>1||Math.abs(Vu)>1)&&Sn(Math.abs(t0)>Math.abs(Vu)?"x":"y");let Bo={x:0,y:0};gn==="y"?(Wu.includes("top")||Wu.includes("bottom"))&&(Wu.includes("top")&&Vu<0||Wu.includes("bottom")&&Vu>0)&&(Bo.y=Vu):gn==="x"&&(Wu.includes("left")||Wu.includes("right"))&&(Wu.includes("left")&&t0<0||Wu.includes("right")&&t0>0)&&(Bo.x=t0),(Math.abs(Bo.x)>0||Math.abs(Bo.y)>0)&&po(!0),(Ku=Tl.current)==null||Ku.style.setProperty("--swipe-amount-x",`${Bo.x}px`),(zn=Tl.current)==null||zn.style.setProperty("--swipe-amount-y",`${Bo.y}px`)}},Gl&&!Pt.jsx?React.createElement("button",{"aria-label":Lr,"data-disabled":ru,"data-close-button":!0,onClick:ru||!Cs?()=>{}:()=>{var Ao;Oo(),(Ao=Pt.onDismiss)==null||Ao.call(Pt,Pt)},className:M(gr==null?void 0:gr.closeButton,(_=Pt==null?void 0:Pt.classNames)==null?void 0:_.closeButton)},($=qr==null?void 0:qr.close)!=null?$:Ot):null,Pt.jsx||reactExports.isValidElement(Pt.title)?Pt.jsx?Pt.jsx:typeof Pt.title=="function"?Pt.title():Pt.title:React.createElement(React.Fragment,null,Mn||Pt.icon||Pt.promise?React.createElement("div",{"data-icon":"",className:M(gr==null?void 0:gr.icon,(rt=Pt==null?void 0:Pt.classNames)==null?void 0:rt.icon)},Pt.promise||Pt.type==="loading"&&!Pt.icon?Pt.icon||Tu():null,Pt.type!=="loading"?Pt.icon||(qr==null?void 0:qr[Mn])||jt(Mn):null):null,React.createElement("div",{"data-content":"",className:M(gr==null?void 0:gr.content,(c=Pt==null?void 0:Pt.classNames)==null?void 0:c.content)},React.createElement("div",{"data-title":"",className:M(gr==null?void 0:gr.title,(dt=Pt==null?void 0:Pt.classNames)==null?void 0:dt.title)},typeof Pt.title=="function"?Pt.title():Pt.title),Pt.description?React.createElement("div",{"data-description":"",className:M(Jr,ao,gr==null?void 0:gr.description,(ht=Pt==null?void 0:Pt.classNames)==null?void 0:ht.description)},typeof Pt.description=="function"?Pt.description():Pt.description):null),reactExports.isValidElement(Pt.cancel)?Pt.cancel:Pt.cancel&&tt(Pt.cancel)?React.createElement("button",{"data-button":!0,"data-cancel":!0,style:Pt.cancelButtonStyle||on,onClick:Ao=>{var Ll,Jo;tt(Pt.cancel)&&Cs&&((Jo=(Ll=Pt.cancel).onClick)==null||Jo.call(Ll,Ao),Oo())},className:M(gr==null?void 0:gr.cancelButton,(Et=Pt==null?void 0:Pt.classNames)==null?void 0:Et.cancelButton)},Pt.cancel.label):null,reactExports.isValidElement(Pt.action)?Pt.action:Pt.action&&tt(Pt.action)?React.createElement("button",{"data-button":!0,"data-action":!0,style:Pt.actionButtonStyle||un,onClick:Ao=>{var Ll,Jo;tt(Pt.action)&&((Jo=(Ll=Pt.action).onClick)==null||Jo.call(Ll,Ao),!Ao.defaultPrevented&&Oo())},className:M(gr==null?void 0:gr.actionButton,(St=Pt==null?void 0:Pt.classNames)==null?void 0:St.actionButton)},Pt.action.label):null))};function _t(){if(typeof window>"u"||typeof document>"u")return"ltr";let e=document.documentElement.getAttribute("dir");return e==="auto"||!e?window.getComputedStyle(document.documentElement).direction:e}function Te(e,i){let s={};return[e,i].forEach((a,_)=>{let $=_===1,rt=$?"--mobile-offset":"--offset",c=$?ge:me;function dt(ht){["top","right","bottom","left"].forEach(Et=>{s[`${rt}-${Et}`]=typeof ht=="number"?`${ht}px`:ht})}typeof a=="number"||typeof a=="string"?dt(a):typeof a=="object"?["top","right","bottom","left"].forEach(ht=>{a[ht]===void 0?s[`${rt}-${ht}`]=c:s[`${rt}-${ht}`]=typeof a[ht]=="number"?`${a[ht]}px`:a[ht]}):dt(c)}),s}var $e=reactExports.forwardRef(function(e,i){let{invert:s,position:a="bottom-right",hotkey:_=["altKey","KeyT"],expand:$,closeButton:rt,className:c,offset:dt,mobileOffset:ht,theme:Et="light",richColors:St,duration:At,style:Pt,visibleToasts:Vt=pe,toastOptions:Bt,dir:Zt=_t(),gap:zt=be,loadingIcon:Ut,icons:Nt,containerAriaLabel:Gt="Notifications",pauseWhenPageIsHidden:er}=e,[ir,or]=React.useState([]),mr=React.useMemo(()=>Array.from(new Set([a].concat(ir.filter(_n=>_n.position).map(_n=>_n.position)))),[ir,a]),[Rr,on]=React.useState([]),[un,jr]=React.useState(!1),[Jr,fn]=React.useState(!1),[Fr,Cr]=React.useState(Et!=="system"?Et:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),Sr=React.useRef(null),dr=_.join("+").replace(/Key/g,"").replace(/Digit/g,""),gr=React.useRef(null),qr=React.useRef(!1),Lr=React.useCallback(_n=>{or(gn=>{var Sn;return(Sn=gn.find(Fs=>Fs.id===_n.id))!=null&&Sn.delete||v$2.dismiss(_n.id),gn.filter(({id:Fs})=>Fs!==_n.id)})},[]);return React.useEffect(()=>v$2.subscribe(_n=>{if(_n.dismiss){or(gn=>gn.map(Sn=>Sn.id===_n.id?{...Sn,delete:!0}:Sn));return}setTimeout(()=>{vt.flushSync(()=>{or(gn=>{let Sn=gn.findIndex(Fs=>Fs.id===_n.id);return Sn!==-1?[...gn.slice(0,Sn),{...gn[Sn],..._n},...gn.slice(Sn+1)]:[_n,...gn]})})})}),[]),React.useEffect(()=>{if(Et!=="system"){Cr(Et);return}if(Et==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?Cr("dark"):Cr("light")),typeof window>"u")return;let _n=window.matchMedia("(prefers-color-scheme: dark)");try{_n.addEventListener("change",({matches:gn})=>{Cr(gn?"dark":"light")})}catch{_n.addListener(({matches:Sn})=>{try{Cr(Sn?"dark":"light")}catch(Fs){console.error(Fs)}})}},[Et]),React.useEffect(()=>{ir.length<=1&&jr(!1)},[ir]),React.useEffect(()=>{let _n=gn=>{var Sn,Fs;_.every(rs=>gn[rs]||gn.code===rs)&&(jr(!0),(Sn=Sr.current)==null||Sn.focus()),gn.code==="Escape"&&(document.activeElement===Sr.current||(Fs=Sr.current)!=null&&Fs.contains(document.activeElement))&&jr(!1)};return document.addEventListener("keydown",_n),()=>document.removeEventListener("keydown",_n)},[_]),React.useEffect(()=>{if(Sr.current)return()=>{gr.current&&(gr.current.focus({preventScroll:!0}),gr.current=null,qr.current=!1)}},[Sr.current]),React.createElement("section",{ref:i,"aria-label":`${Gt} ${dr}`,tabIndex:-1,"aria-live":"polite","aria-relevant":"additions text","aria-atomic":"false",suppressHydrationWarning:!0},mr.map((_n,gn)=>{var Sn;let[Fs,rs]=_n.split("-");return ir.length?React.createElement("ol",{key:_n,dir:Zt==="auto"?_t():Zt,tabIndex:-1,ref:Sr,className:c,"data-sonner-toaster":!0,"data-theme":Fr,"data-y-position":Fs,"data-lifted":un&&ir.length>1&&!$,"data-x-position":rs,style:{"--front-toast-height":`${((Sn=Rr[0])==null?void 0:Sn.height)||0}px`,"--width":`${he}px`,"--gap":`${zt}px`,...Pt,...Te(dt,ht)},onBlur:ms=>{qr.current&&!ms.currentTarget.contains(ms.relatedTarget)&&(qr.current=!1,gr.current&&(gr.current.focus({preventScroll:!0}),gr.current=null))},onFocus:ms=>{ms.target instanceof HTMLElement&&ms.target.dataset.dismissible==="false"||qr.current||(qr.current=!0,gr.current=ms.relatedTarget)},onMouseEnter:()=>jr(!0),onMouseMove:()=>jr(!0),onMouseLeave:()=>{Jr||jr(!1)},onDragEnd:()=>jr(!1),onPointerDown:ms=>{ms.target instanceof HTMLElement&&ms.target.dataset.dismissible==="false"||fn(!0)},onPointerUp:()=>fn(!1)},ir.filter(ms=>!ms.position&&gn===0||ms.position===_n).map((ms,On)=>{var ws,Vs;return React.createElement(ve,{key:ms.id,icons:Nt,index:On,toast:ms,defaultRichColors:St,duration:(ws=Bt==null?void 0:Bt.duration)!=null?ws:At,className:Bt==null?void 0:Bt.className,descriptionClassName:Bt==null?void 0:Bt.descriptionClassName,invert:s,visibleToasts:Vt,closeButton:(Vs=Bt==null?void 0:Bt.closeButton)!=null?Vs:rt,interacting:Jr,position:_n,style:Bt==null?void 0:Bt.style,unstyled:Bt==null?void 0:Bt.unstyled,classNames:Bt==null?void 0:Bt.classNames,cancelButtonStyle:Bt==null?void 0:Bt.cancelButtonStyle,actionButtonStyle:Bt==null?void 0:Bt.actionButtonStyle,removeToast:Lr,toasts:ir.filter(ks=>ks.position==ms.position),heights:Rr.filter(ks=>ks.position==ms.position),setHeights:on,expandByDefault:$,gap:zt,loadingIcon:Ut,expanded:un,pauseWhenPageIsHidden:er,swipeDirections:e.swipeDirections})})):null}))});const Toaster=({...e})=>{const{theme:i="system"}=j();return jsxRuntimeExports.jsx($e,{theme:i,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},position:"top-center",...e})};var useReactId=React$1[" useId ".trim().toString()]||(()=>{}),count$1=0;function useId(e){const[i,s]=reactExports.useState(useReactId());return useLayoutEffect2(()=>{s(a=>a??String(count$1++))},[e]),i?`radix-${i}`:""}const sides=["top","right","bottom","left"],min=Math.min,max=Math.max,round=Math.round,floor=Math.floor,createCoords=e=>({x:e,y:e}),oppositeSideMap={left:"right",right:"left",bottom:"top",top:"bottom"},oppositeAlignmentMap={start:"end",end:"start"};function clamp$2(e,i,s){return max(e,min(i,s))}function evaluate(e,i){return typeof e=="function"?e(i):e}function getSide(e){return e.split("-")[0]}function getAlignment(e){return e.split("-")[1]}function getOppositeAxis(e){return e==="x"?"y":"x"}function getAxisLength(e){return e==="y"?"height":"width"}const yAxisSides=new Set(["top","bottom"]);function getSideAxis(e){return yAxisSides.has(getSide(e))?"y":"x"}function getAlignmentAxis(e){return getOppositeAxis(getSideAxis(e))}function getAlignmentSides(e,i,s){s===void 0&&(s=!1);const a=getAlignment(e),_=getAlignmentAxis(e),$=getAxisLength(_);let rt=_==="x"?a===(s?"end":"start")?"right":"left":a==="start"?"bottom":"top";return i.reference[$]>i.floating[$]&&(rt=getOppositePlacement(rt)),[rt,getOppositePlacement(rt)]}function getExpandedPlacements(e){const i=getOppositePlacement(e);return[getOppositeAlignmentPlacement(e),i,getOppositeAlignmentPlacement(i)]}function getOppositeAlignmentPlacement(e){return e.replace(/start|end/g,i=>oppositeAlignmentMap[i])}const lrPlacement=["left","right"],rlPlacement=["right","left"],tbPlacement=["top","bottom"],btPlacement=["bottom","top"];function getSideList(e,i,s){switch(e){case"top":case"bottom":return s?i?rlPlacement:lrPlacement:i?lrPlacement:rlPlacement;case"left":case"right":return i?tbPlacement:btPlacement;default:return[]}}function getOppositeAxisPlacements(e,i,s,a){const _=getAlignment(e);let $=getSideList(getSide(e),s==="start",a);return _&&($=$.map(rt=>rt+"-"+_),i&&($=$.concat($.map(getOppositeAlignmentPlacement)))),$}function getOppositePlacement(e){return e.replace(/left|right|bottom|top/g,i=>oppositeSideMap[i])}function expandPaddingObject(e){return{top:0,right:0,bottom:0,left:0,...e}}function getPaddingObject(e){return typeof e!="number"?expandPaddingObject(e):{top:e,right:e,bottom:e,left:e}}function rectToClientRect(e){const{x:i,y:s,width:a,height:_}=e;return{width:a,height:_,top:s,left:i,right:i+a,bottom:s+_,x:i,y:s}}function computeCoordsFromPlacement(e,i,s){let{reference:a,floating:_}=e;const $=getSideAxis(i),rt=getAlignmentAxis(i),c=getAxisLength(rt),dt=getSide(i),ht=$==="y",Et=a.x+a.width/2-_.width/2,St=a.y+a.height/2-_.height/2,At=a[c]/2-_[c]/2;let Pt;switch(dt){case"top":Pt={x:Et,y:a.y-_.height};break;case"bottom":Pt={x:Et,y:a.y+a.height};break;case"right":Pt={x:a.x+a.width,y:St};break;case"left":Pt={x:a.x-_.width,y:St};break;default:Pt={x:a.x,y:a.y}}switch(getAlignment(i)){case"start":Pt[rt]-=At*(s&&ht?-1:1);break;case"end":Pt[rt]+=At*(s&&ht?-1:1);break}return Pt}const computePosition$1=async(e,i,s)=>{const{placement:a="bottom",strategy:_="absolute",middleware:$=[],platform:rt}=s,c=$.filter(Boolean),dt=await(rt.isRTL==null?void 0:rt.isRTL(i));let ht=await rt.getElementRects({reference:e,floating:i,strategy:_}),{x:Et,y:St}=computeCoordsFromPlacement(ht,a,dt),At=a,Pt={},Vt=0;for(let Bt=0;Bt<c.length;Bt++){const{name:Zt,fn:zt}=c[Bt],{x:Ut,y:Nt,data:Gt,reset:er}=await zt({x:Et,y:St,initialPlacement:a,placement:At,strategy:_,middlewareData:Pt,rects:ht,platform:rt,elements:{reference:e,floating:i}});Et=Ut??Et,St=Nt??St,Pt={...Pt,[Zt]:{...Pt[Zt],...Gt}},er&&Vt<=50&&(Vt++,typeof er=="object"&&(er.placement&&(At=er.placement),er.rects&&(ht=er.rects===!0?await rt.getElementRects({reference:e,floating:i,strategy:_}):er.rects),{x:Et,y:St}=computeCoordsFromPlacement(ht,At,dt)),Bt=-1)}return{x:Et,y:St,placement:At,strategy:_,middlewareData:Pt}};async function detectOverflow(e,i){var s;i===void 0&&(i={});const{x:a,y:_,platform:$,rects:rt,elements:c,strategy:dt}=e,{boundary:ht="clippingAncestors",rootBoundary:Et="viewport",elementContext:St="floating",altBoundary:At=!1,padding:Pt=0}=evaluate(i,e),Vt=getPaddingObject(Pt),Zt=c[At?St==="floating"?"reference":"floating":St],zt=rectToClientRect(await $.getClippingRect({element:(s=await($.isElement==null?void 0:$.isElement(Zt)))==null||s?Zt:Zt.contextElement||await($.getDocumentElement==null?void 0:$.getDocumentElement(c.floating)),boundary:ht,rootBoundary:Et,strategy:dt})),Ut=St==="floating"?{x:a,y:_,width:rt.floating.width,height:rt.floating.height}:rt.reference,Nt=await($.getOffsetParent==null?void 0:$.getOffsetParent(c.floating)),Gt=await($.isElement==null?void 0:$.isElement(Nt))?await($.getScale==null?void 0:$.getScale(Nt))||{x:1,y:1}:{x:1,y:1},er=rectToClientRect($.convertOffsetParentRelativeRectToViewportRelativeRect?await $.convertOffsetParentRelativeRectToViewportRelativeRect({elements:c,rect:Ut,offsetParent:Nt,strategy:dt}):Ut);return{top:(zt.top-er.top+Vt.top)/Gt.y,bottom:(er.bottom-zt.bottom+Vt.bottom)/Gt.y,left:(zt.left-er.left+Vt.left)/Gt.x,right:(er.right-zt.right+Vt.right)/Gt.x}}const arrow$3=e=>({name:"arrow",options:e,async fn(i){const{x:s,y:a,placement:_,rects:$,platform:rt,elements:c,middlewareData:dt}=i,{element:ht,padding:Et=0}=evaluate(e,i)||{};if(ht==null)return{};const St=getPaddingObject(Et),At={x:s,y:a},Pt=getAlignmentAxis(_),Vt=getAxisLength(Pt),Bt=await rt.getDimensions(ht),Zt=Pt==="y",zt=Zt?"top":"left",Ut=Zt?"bottom":"right",Nt=Zt?"clientHeight":"clientWidth",Gt=$.reference[Vt]+$.reference[Pt]-At[Pt]-$.floating[Vt],er=At[Pt]-$.reference[Pt],ir=await(rt.getOffsetParent==null?void 0:rt.getOffsetParent(ht));let or=ir?ir[Nt]:0;(!or||!await(rt.isElement==null?void 0:rt.isElement(ir)))&&(or=c.floating[Nt]||$.floating[Vt]);const mr=Gt/2-er/2,Rr=or/2-Bt[Vt]/2-1,on=min(St[zt],Rr),un=min(St[Ut],Rr),jr=on,Jr=or-Bt[Vt]-un,fn=or/2-Bt[Vt]/2+mr,Fr=clamp$2(jr,fn,Jr),Cr=!dt.arrow&&getAlignment(_)!=null&&fn!==Fr&&$.reference[Vt]/2-(fn<jr?on:un)-Bt[Vt]/2<0,Sr=Cr?fn<jr?fn-jr:fn-Jr:0;return{[Pt]:At[Pt]+Sr,data:{[Pt]:Fr,centerOffset:fn-Fr-Sr,...Cr&&{alignmentOffset:Sr}},reset:Cr}}}),flip$2=function(e){return e===void 0&&(e={}),{name:"flip",options:e,async fn(i){var s,a;const{placement:_,middlewareData:$,rects:rt,initialPlacement:c,platform:dt,elements:ht}=i,{mainAxis:Et=!0,crossAxis:St=!0,fallbackPlacements:At,fallbackStrategy:Pt="bestFit",fallbackAxisSideDirection:Vt="none",flipAlignment:Bt=!0,...Zt}=evaluate(e,i);if((s=$.arrow)!=null&&s.alignmentOffset)return{};const zt=getSide(_),Ut=getSideAxis(c),Nt=getSide(c)===c,Gt=await(dt.isRTL==null?void 0:dt.isRTL(ht.floating)),er=At||(Nt||!Bt?[getOppositePlacement(c)]:getExpandedPlacements(c)),ir=Vt!=="none";!At&&ir&&er.push(...getOppositeAxisPlacements(c,Bt,Vt,Gt));const or=[c,...er],mr=await detectOverflow(i,Zt),Rr=[];let on=((a=$.flip)==null?void 0:a.overflows)||[];if(Et&&Rr.push(mr[zt]),St){const fn=getAlignmentSides(_,rt,Gt);Rr.push(mr[fn[0]],mr[fn[1]])}if(on=[...on,{placement:_,overflows:Rr}],!Rr.every(fn=>fn<=0)){var un,jr;const fn=(((un=$.flip)==null?void 0:un.index)||0)+1,Fr=or[fn];if(Fr&&(!(St==="alignment"?Ut!==getSideAxis(Fr):!1)||on.every(dr=>dr.overflows[0]>0&&getSideAxis(dr.placement)===Ut)))return{data:{index:fn,overflows:on},reset:{placement:Fr}};let Cr=(jr=on.filter(Sr=>Sr.overflows[0]<=0).sort((Sr,dr)=>Sr.overflows[1]-dr.overflows[1])[0])==null?void 0:jr.placement;if(!Cr)switch(Pt){case"bestFit":{var Jr;const Sr=(Jr=on.filter(dr=>{if(ir){const gr=getSideAxis(dr.placement);return gr===Ut||gr==="y"}return!0}).map(dr=>[dr.placement,dr.overflows.filter(gr=>gr>0).reduce((gr,qr)=>gr+qr,0)]).sort((dr,gr)=>dr[1]-gr[1])[0])==null?void 0:Jr[0];Sr&&(Cr=Sr);break}case"initialPlacement":Cr=c;break}if(_!==Cr)return{reset:{placement:Cr}}}return{}}}};function getSideOffsets(e,i){return{top:e.top-i.height,right:e.right-i.width,bottom:e.bottom-i.height,left:e.left-i.width}}function isAnySideFullyClipped(e){return sides.some(i=>e[i]>=0)}const hide$2=function(e){return e===void 0&&(e={}),{name:"hide",options:e,async fn(i){const{rects:s}=i,{strategy:a="referenceHidden",..._}=evaluate(e,i);switch(a){case"referenceHidden":{const $=await detectOverflow(i,{..._,elementContext:"reference"}),rt=getSideOffsets($,s.reference);return{data:{referenceHiddenOffsets:rt,referenceHidden:isAnySideFullyClipped(rt)}}}case"escaped":{const $=await detectOverflow(i,{..._,altBoundary:!0}),rt=getSideOffsets($,s.floating);return{data:{escapedOffsets:rt,escaped:isAnySideFullyClipped(rt)}}}default:return{}}}}},originSides=new Set(["left","top"]);async function convertValueToCoords(e,i){const{placement:s,platform:a,elements:_}=e,$=await(a.isRTL==null?void 0:a.isRTL(_.floating)),rt=getSide(s),c=getAlignment(s),dt=getSideAxis(s)==="y",ht=originSides.has(rt)?-1:1,Et=$&&dt?-1:1,St=evaluate(i,e);let{mainAxis:At,crossAxis:Pt,alignmentAxis:Vt}=typeof St=="number"?{mainAxis:St,crossAxis:0,alignmentAxis:null}:{mainAxis:St.mainAxis||0,crossAxis:St.crossAxis||0,alignmentAxis:St.alignmentAxis};return c&&typeof Vt=="number"&&(Pt=c==="end"?Vt*-1:Vt),dt?{x:Pt*Et,y:At*ht}:{x:At*ht,y:Pt*Et}}const offset$2=function(e){return e===void 0&&(e=0),{name:"offset",options:e,async fn(i){var s,a;const{x:_,y:$,placement:rt,middlewareData:c}=i,dt=await convertValueToCoords(i,e);return rt===((s=c.offset)==null?void 0:s.placement)&&(a=c.arrow)!=null&&a.alignmentOffset?{}:{x:_+dt.x,y:$+dt.y,data:{...dt,placement:rt}}}}},shift$2=function(e){return e===void 0&&(e={}),{name:"shift",options:e,async fn(i){const{x:s,y:a,placement:_}=i,{mainAxis:$=!0,crossAxis:rt=!1,limiter:c={fn:Zt=>{let{x:zt,y:Ut}=Zt;return{x:zt,y:Ut}}},...dt}=evaluate(e,i),ht={x:s,y:a},Et=await detectOverflow(i,dt),St=getSideAxis(getSide(_)),At=getOppositeAxis(St);let Pt=ht[At],Vt=ht[St];if($){const Zt=At==="y"?"top":"left",zt=At==="y"?"bottom":"right",Ut=Pt+Et[Zt],Nt=Pt-Et[zt];Pt=clamp$2(Ut,Pt,Nt)}if(rt){const Zt=St==="y"?"top":"left",zt=St==="y"?"bottom":"right",Ut=Vt+Et[Zt],Nt=Vt-Et[zt];Vt=clamp$2(Ut,Vt,Nt)}const Bt=c.fn({...i,[At]:Pt,[St]:Vt});return{...Bt,data:{x:Bt.x-s,y:Bt.y-a,enabled:{[At]:$,[St]:rt}}}}}},limitShift$2=function(e){return e===void 0&&(e={}),{options:e,fn(i){const{x:s,y:a,placement:_,rects:$,middlewareData:rt}=i,{offset:c=0,mainAxis:dt=!0,crossAxis:ht=!0}=evaluate(e,i),Et={x:s,y:a},St=getSideAxis(_),At=getOppositeAxis(St);let Pt=Et[At],Vt=Et[St];const Bt=evaluate(c,i),Zt=typeof Bt=="number"?{mainAxis:Bt,crossAxis:0}:{mainAxis:0,crossAxis:0,...Bt};if(dt){const Nt=At==="y"?"height":"width",Gt=$.reference[At]-$.floating[Nt]+Zt.mainAxis,er=$.reference[At]+$.reference[Nt]-Zt.mainAxis;Pt<Gt?Pt=Gt:Pt>er&&(Pt=er)}if(ht){var zt,Ut;const Nt=At==="y"?"width":"height",Gt=originSides.has(getSide(_)),er=$.reference[St]-$.floating[Nt]+(Gt&&((zt=rt.offset)==null?void 0:zt[St])||0)+(Gt?0:Zt.crossAxis),ir=$.reference[St]+$.reference[Nt]+(Gt?0:((Ut=rt.offset)==null?void 0:Ut[St])||0)-(Gt?Zt.crossAxis:0);Vt<er?Vt=er:Vt>ir&&(Vt=ir)}return{[At]:Pt,[St]:Vt}}}},size$2=function(e){return e===void 0&&(e={}),{name:"size",options:e,async fn(i){var s,a;const{placement:_,rects:$,platform:rt,elements:c}=i,{apply:dt=()=>{},...ht}=evaluate(e,i),Et=await detectOverflow(i,ht),St=getSide(_),At=getAlignment(_),Pt=getSideAxis(_)==="y",{width:Vt,height:Bt}=$.floating;let Zt,zt;St==="top"||St==="bottom"?(Zt=St,zt=At===(await(rt.isRTL==null?void 0:rt.isRTL(c.floating))?"start":"end")?"left":"right"):(zt=St,Zt=At==="end"?"top":"bottom");const Ut=Bt-Et.top-Et.bottom,Nt=Vt-Et.left-Et.right,Gt=min(Bt-Et[Zt],Ut),er=min(Vt-Et[zt],Nt),ir=!i.middlewareData.shift;let or=Gt,mr=er;if((s=i.middlewareData.shift)!=null&&s.enabled.x&&(mr=Nt),(a=i.middlewareData.shift)!=null&&a.enabled.y&&(or=Ut),ir&&!At){const on=max(Et.left,0),un=max(Et.right,0),jr=max(Et.top,0),Jr=max(Et.bottom,0);Pt?mr=Vt-2*(on!==0||un!==0?on+un:max(Et.left,Et.right)):or=Bt-2*(jr!==0||Jr!==0?jr+Jr:max(Et.top,Et.bottom))}await dt({...i,availableWidth:mr,availableHeight:or});const Rr=await rt.getDimensions(c.floating);return Vt!==Rr.width||Bt!==Rr.height?{reset:{rects:!0}}:{}}}};function hasWindow(){return typeof window<"u"}function getNodeName(e){return isNode(e)?(e.nodeName||"").toLowerCase():"#document"}function getWindow(e){var i;return(e==null||(i=e.ownerDocument)==null?void 0:i.defaultView)||window}function getDocumentElement(e){var i;return(i=(isNode(e)?e.ownerDocument:e.document)||window.document)==null?void 0:i.documentElement}function isNode(e){return hasWindow()?e instanceof Node||e instanceof getWindow(e).Node:!1}function isElement(e){return hasWindow()?e instanceof Element||e instanceof getWindow(e).Element:!1}function isHTMLElement$1(e){return hasWindow()?e instanceof HTMLElement||e instanceof getWindow(e).HTMLElement:!1}function isShadowRoot(e){return!hasWindow()||typeof ShadowRoot>"u"?!1:e instanceof ShadowRoot||e instanceof getWindow(e).ShadowRoot}const invalidOverflowDisplayValues=new Set(["inline","contents"]);function isOverflowElement(e){const{overflow:i,overflowX:s,overflowY:a,display:_}=getComputedStyle$2(e);return/auto|scroll|overlay|hidden|clip/.test(i+a+s)&&!invalidOverflowDisplayValues.has(_)}const tableElements=new Set(["table","td","th"]);function isTableElement(e){return tableElements.has(getNodeName(e))}const topLayerSelectors=[":popover-open",":modal"];function isTopLayer(e){return topLayerSelectors.some(i=>{try{return e.matches(i)}catch{return!1}})}const transformProperties=["transform","translate","scale","rotate","perspective"],willChangeValues=["transform","translate","scale","rotate","perspective","filter"],containValues=["paint","layout","strict","content"];function isContainingBlock(e){const i=isWebKit(),s=isElement(e)?getComputedStyle$2(e):e;return transformProperties.some(a=>s[a]?s[a]!=="none":!1)||(s.containerType?s.containerType!=="normal":!1)||!i&&(s.backdropFilter?s.backdropFilter!=="none":!1)||!i&&(s.filter?s.filter!=="none":!1)||willChangeValues.some(a=>(s.willChange||"").includes(a))||containValues.some(a=>(s.contain||"").includes(a))}function getContainingBlock(e){let i=getParentNode(e);for(;isHTMLElement$1(i)&&!isLastTraversableNode(i);){if(isContainingBlock(i))return i;if(isTopLayer(i))return null;i=getParentNode(i)}return null}function isWebKit(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const lastTraversableNodeNames=new Set(["html","body","#document"]);function isLastTraversableNode(e){return lastTraversableNodeNames.has(getNodeName(e))}function getComputedStyle$2(e){return getWindow(e).getComputedStyle(e)}function getNodeScroll(e){return isElement(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.scrollX,scrollTop:e.scrollY}}function getParentNode(e){if(getNodeName(e)==="html")return e;const i=e.assignedSlot||e.parentNode||isShadowRoot(e)&&e.host||getDocumentElement(e);return isShadowRoot(i)?i.host:i}function getNearestOverflowAncestor(e){const i=getParentNode(e);return isLastTraversableNode(i)?e.ownerDocument?e.ownerDocument.body:e.body:isHTMLElement$1(i)&&isOverflowElement(i)?i:getNearestOverflowAncestor(i)}function getOverflowAncestors(e,i,s){var a;i===void 0&&(i=[]),s===void 0&&(s=!0);const _=getNearestOverflowAncestor(e),$=_===((a=e.ownerDocument)==null?void 0:a.body),rt=getWindow(_);if($){const c=getFrameElement(rt);return i.concat(rt,rt.visualViewport||[],isOverflowElement(_)?_:[],c&&s?getOverflowAncestors(c):[])}return i.concat(_,getOverflowAncestors(_,[],s))}function getFrameElement(e){return e.parent&&Object.getPrototypeOf(e.parent)?e.frameElement:null}function getCssDimensions(e){const i=getComputedStyle$2(e);let s=parseFloat(i.width)||0,a=parseFloat(i.height)||0;const _=isHTMLElement$1(e),$=_?e.offsetWidth:s,rt=_?e.offsetHeight:a,c=round(s)!==$||round(a)!==rt;return c&&(s=$,a=rt),{width:s,height:a,$:c}}function unwrapElement(e){return isElement(e)?e:e.contextElement}function getScale(e){const i=unwrapElement(e);if(!isHTMLElement$1(i))return createCoords(1);const s=i.getBoundingClientRect(),{width:a,height:_,$}=getCssDimensions(i);let rt=($?round(s.width):s.width)/a,c=($?round(s.height):s.height)/_;return(!rt||!Number.isFinite(rt))&&(rt=1),(!c||!Number.isFinite(c))&&(c=1),{x:rt,y:c}}const noOffsets=createCoords(0);function getVisualOffsets(e){const i=getWindow(e);return!isWebKit()||!i.visualViewport?noOffsets:{x:i.visualViewport.offsetLeft,y:i.visualViewport.offsetTop}}function shouldAddVisualOffsets(e,i,s){return i===void 0&&(i=!1),!s||i&&s!==getWindow(e)?!1:i}function getBoundingClientRect(e,i,s,a){i===void 0&&(i=!1),s===void 0&&(s=!1);const _=e.getBoundingClientRect(),$=unwrapElement(e);let rt=createCoords(1);i&&(a?isElement(a)&&(rt=getScale(a)):rt=getScale(e));const c=shouldAddVisualOffsets($,s,a)?getVisualOffsets($):createCoords(0);let dt=(_.left+c.x)/rt.x,ht=(_.top+c.y)/rt.y,Et=_.width/rt.x,St=_.height/rt.y;if($){const At=getWindow($),Pt=a&&isElement(a)?getWindow(a):a;let Vt=At,Bt=getFrameElement(Vt);for(;Bt&&a&&Pt!==Vt;){const Zt=getScale(Bt),zt=Bt.getBoundingClientRect(),Ut=getComputedStyle$2(Bt),Nt=zt.left+(Bt.clientLeft+parseFloat(Ut.paddingLeft))*Zt.x,Gt=zt.top+(Bt.clientTop+parseFloat(Ut.paddingTop))*Zt.y;dt*=Zt.x,ht*=Zt.y,Et*=Zt.x,St*=Zt.y,dt+=Nt,ht+=Gt,Vt=getWindow(Bt),Bt=getFrameElement(Vt)}}return rectToClientRect({width:Et,height:St,x:dt,y:ht})}function getWindowScrollBarX(e,i){const s=getNodeScroll(e).scrollLeft;return i?i.left+s:getBoundingClientRect(getDocumentElement(e)).left+s}function getHTMLOffset(e,i,s){s===void 0&&(s=!1);const a=e.getBoundingClientRect(),_=a.left+i.scrollLeft-(s?0:getWindowScrollBarX(e,a)),$=a.top+i.scrollTop;return{x:_,y:$}}function convertOffsetParentRelativeRectToViewportRelativeRect(e){let{elements:i,rect:s,offsetParent:a,strategy:_}=e;const $=_==="fixed",rt=getDocumentElement(a),c=i?isTopLayer(i.floating):!1;if(a===rt||c&&$)return s;let dt={scrollLeft:0,scrollTop:0},ht=createCoords(1);const Et=createCoords(0),St=isHTMLElement$1(a);if((St||!St&&!$)&&((getNodeName(a)!=="body"||isOverflowElement(rt))&&(dt=getNodeScroll(a)),isHTMLElement$1(a))){const Pt=getBoundingClientRect(a);ht=getScale(a),Et.x=Pt.x+a.clientLeft,Et.y=Pt.y+a.clientTop}const At=rt&&!St&&!$?getHTMLOffset(rt,dt,!0):createCoords(0);return{width:s.width*ht.x,height:s.height*ht.y,x:s.x*ht.x-dt.scrollLeft*ht.x+Et.x+At.x,y:s.y*ht.y-dt.scrollTop*ht.y+Et.y+At.y}}function getClientRects(e){return Array.from(e.getClientRects())}function getDocumentRect(e){const i=getDocumentElement(e),s=getNodeScroll(e),a=e.ownerDocument.body,_=max(i.scrollWidth,i.clientWidth,a.scrollWidth,a.clientWidth),$=max(i.scrollHeight,i.clientHeight,a.scrollHeight,a.clientHeight);let rt=-s.scrollLeft+getWindowScrollBarX(e);const c=-s.scrollTop;return getComputedStyle$2(a).direction==="rtl"&&(rt+=max(i.clientWidth,a.clientWidth)-_),{width:_,height:$,x:rt,y:c}}function getViewportRect(e,i){const s=getWindow(e),a=getDocumentElement(e),_=s.visualViewport;let $=a.clientWidth,rt=a.clientHeight,c=0,dt=0;if(_){$=_.width,rt=_.height;const ht=isWebKit();(!ht||ht&&i==="fixed")&&(c=_.offsetLeft,dt=_.offsetTop)}return{width:$,height:rt,x:c,y:dt}}const absoluteOrFixed=new Set(["absolute","fixed"]);function getInnerBoundingClientRect(e,i){const s=getBoundingClientRect(e,!0,i==="fixed"),a=s.top+e.clientTop,_=s.left+e.clientLeft,$=isHTMLElement$1(e)?getScale(e):createCoords(1),rt=e.clientWidth*$.x,c=e.clientHeight*$.y,dt=_*$.x,ht=a*$.y;return{width:rt,height:c,x:dt,y:ht}}function getClientRectFromClippingAncestor(e,i,s){let a;if(i==="viewport")a=getViewportRect(e,s);else if(i==="document")a=getDocumentRect(getDocumentElement(e));else if(isElement(i))a=getInnerBoundingClientRect(i,s);else{const _=getVisualOffsets(e);a={x:i.x-_.x,y:i.y-_.y,width:i.width,height:i.height}}return rectToClientRect(a)}function hasFixedPositionAncestor(e,i){const s=getParentNode(e);return s===i||!isElement(s)||isLastTraversableNode(s)?!1:getComputedStyle$2(s).position==="fixed"||hasFixedPositionAncestor(s,i)}function getClippingElementAncestors(e,i){const s=i.get(e);if(s)return s;let a=getOverflowAncestors(e,[],!1).filter(c=>isElement(c)&&getNodeName(c)!=="body"),_=null;const $=getComputedStyle$2(e).position==="fixed";let rt=$?getParentNode(e):e;for(;isElement(rt)&&!isLastTraversableNode(rt);){const c=getComputedStyle$2(rt),dt=isContainingBlock(rt);!dt&&c.position==="fixed"&&(_=null),($?!dt&&!_:!dt&&c.position==="static"&&!!_&&absoluteOrFixed.has(_.position)||isOverflowElement(rt)&&!dt&&hasFixedPositionAncestor(e,rt))?a=a.filter(Et=>Et!==rt):_=c,rt=getParentNode(rt)}return i.set(e,a),a}function getClippingRect(e){let{element:i,boundary:s,rootBoundary:a,strategy:_}=e;const rt=[...s==="clippingAncestors"?isTopLayer(i)?[]:getClippingElementAncestors(i,this._c):[].concat(s),a],c=rt[0],dt=rt.reduce((ht,Et)=>{const St=getClientRectFromClippingAncestor(i,Et,_);return ht.top=max(St.top,ht.top),ht.right=min(St.right,ht.right),ht.bottom=min(St.bottom,ht.bottom),ht.left=max(St.left,ht.left),ht},getClientRectFromClippingAncestor(i,c,_));return{width:dt.right-dt.left,height:dt.bottom-dt.top,x:dt.left,y:dt.top}}function getDimensions(e){const{width:i,height:s}=getCssDimensions(e);return{width:i,height:s}}function getRectRelativeToOffsetParent(e,i,s){const a=isHTMLElement$1(i),_=getDocumentElement(i),$=s==="fixed",rt=getBoundingClientRect(e,!0,$,i);let c={scrollLeft:0,scrollTop:0};const dt=createCoords(0);function ht(){dt.x=getWindowScrollBarX(_)}if(a||!a&&!$)if((getNodeName(i)!=="body"||isOverflowElement(_))&&(c=getNodeScroll(i)),a){const Pt=getBoundingClientRect(i,!0,$,i);dt.x=Pt.x+i.clientLeft,dt.y=Pt.y+i.clientTop}else _&&ht();$&&!a&&_&&ht();const Et=_&&!a&&!$?getHTMLOffset(_,c):createCoords(0),St=rt.left+c.scrollLeft-dt.x-Et.x,At=rt.top+c.scrollTop-dt.y-Et.y;return{x:St,y:At,width:rt.width,height:rt.height}}function isStaticPositioned(e){return getComputedStyle$2(e).position==="static"}function getTrueOffsetParent(e,i){if(!isHTMLElement$1(e)||getComputedStyle$2(e).position==="fixed")return null;if(i)return i(e);let s=e.offsetParent;return getDocumentElement(e)===s&&(s=s.ownerDocument.body),s}function getOffsetParent(e,i){const s=getWindow(e);if(isTopLayer(e))return s;if(!isHTMLElement$1(e)){let _=getParentNode(e);for(;_&&!isLastTraversableNode(_);){if(isElement(_)&&!isStaticPositioned(_))return _;_=getParentNode(_)}return s}let a=getTrueOffsetParent(e,i);for(;a&&isTableElement(a)&&isStaticPositioned(a);)a=getTrueOffsetParent(a,i);return a&&isLastTraversableNode(a)&&isStaticPositioned(a)&&!isContainingBlock(a)?s:a||getContainingBlock(e)||s}const getElementRects=async function(e){const i=this.getOffsetParent||getOffsetParent,s=this.getDimensions,a=await s(e.floating);return{reference:getRectRelativeToOffsetParent(e.reference,await i(e.floating),e.strategy),floating:{x:0,y:0,width:a.width,height:a.height}}};function isRTL(e){return getComputedStyle$2(e).direction==="rtl"}const platform={convertOffsetParentRelativeRectToViewportRelativeRect,getDocumentElement,getClippingRect,getOffsetParent,getElementRects,getClientRects,getDimensions,getScale,isElement,isRTL};function rectsAreEqual(e,i){return e.x===i.x&&e.y===i.y&&e.width===i.width&&e.height===i.height}function observeMove(e,i){let s=null,a;const _=getDocumentElement(e);function $(){var c;clearTimeout(a),(c=s)==null||c.disconnect(),s=null}function rt(c,dt){c===void 0&&(c=!1),dt===void 0&&(dt=1),$();const ht=e.getBoundingClientRect(),{left:Et,top:St,width:At,height:Pt}=ht;if(c||i(),!At||!Pt)return;const Vt=floor(St),Bt=floor(_.clientWidth-(Et+At)),Zt=floor(_.clientHeight-(St+Pt)),zt=floor(Et),Nt={rootMargin:-Vt+"px "+-Bt+"px "+-Zt+"px "+-zt+"px",threshold:max(0,min(1,dt))||1};let Gt=!0;function er(ir){const or=ir[0].intersectionRatio;if(or!==dt){if(!Gt)return rt();or?rt(!1,or):a=setTimeout(()=>{rt(!1,1e-7)},1e3)}or===1&&!rectsAreEqual(ht,e.getBoundingClientRect())&&rt(),Gt=!1}try{s=new IntersectionObserver(er,{...Nt,root:_.ownerDocument})}catch{s=new IntersectionObserver(er,Nt)}s.observe(e)}return rt(!0),$}function autoUpdate(e,i,s,a){a===void 0&&(a={});const{ancestorScroll:_=!0,ancestorResize:$=!0,elementResize:rt=typeof ResizeObserver=="function",layoutShift:c=typeof IntersectionObserver=="function",animationFrame:dt=!1}=a,ht=unwrapElement(e),Et=_||$?[...ht?getOverflowAncestors(ht):[],...getOverflowAncestors(i)]:[];Et.forEach(zt=>{_&&zt.addEventListener("scroll",s,{passive:!0}),$&&zt.addEventListener("resize",s)});const St=ht&&c?observeMove(ht,s):null;let At=-1,Pt=null;rt&&(Pt=new ResizeObserver(zt=>{let[Ut]=zt;Ut&&Ut.target===ht&&Pt&&(Pt.unobserve(i),cancelAnimationFrame(At),At=requestAnimationFrame(()=>{var Nt;(Nt=Pt)==null||Nt.observe(i)})),s()}),ht&&!dt&&Pt.observe(ht),Pt.observe(i));let Vt,Bt=dt?getBoundingClientRect(e):null;dt&&Zt();function Zt(){const zt=getBoundingClientRect(e);Bt&&!rectsAreEqual(Bt,zt)&&s(),Bt=zt,Vt=requestAnimationFrame(Zt)}return s(),()=>{var zt;Et.forEach(Ut=>{_&&Ut.removeEventListener("scroll",s),$&&Ut.removeEventListener("resize",s)}),St==null||St(),(zt=Pt)==null||zt.disconnect(),Pt=null,dt&&cancelAnimationFrame(Vt)}}const offset$1=offset$2,shift$1=shift$2,flip$1=flip$2,size$1=size$2,hide$1=hide$2,arrow$2=arrow$3,limitShift$1=limitShift$2,computePosition=(e,i,s)=>{const a=new Map,_={platform,...s},$={..._.platform,_c:a};return computePosition$1(e,i,{..._,platform:$})};var isClient=typeof document<"u",noop$3=function(){},index=isClient?reactExports.useLayoutEffect:noop$3;function deepEqual$1(e,i){if(e===i)return!0;if(typeof e!=typeof i)return!1;if(typeof e=="function"&&e.toString()===i.toString())return!0;let s,a,_;if(e&&i&&typeof e=="object"){if(Array.isArray(e)){if(s=e.length,s!==i.length)return!1;for(a=s;a--!==0;)if(!deepEqual$1(e[a],i[a]))return!1;return!0}if(_=Object.keys(e),s=_.length,s!==Object.keys(i).length)return!1;for(a=s;a--!==0;)if(!{}.hasOwnProperty.call(i,_[a]))return!1;for(a=s;a--!==0;){const $=_[a];if(!($==="_owner"&&e.$$typeof)&&!deepEqual$1(e[$],i[$]))return!1}return!0}return e!==e&&i!==i}function getDPR(e){return typeof window>"u"?1:(e.ownerDocument.defaultView||window).devicePixelRatio||1}function roundByDPR(e,i){const s=getDPR(e);return Math.round(i*s)/s}function useLatestRef(e){const i=reactExports.useRef(e);return index(()=>{i.current=e}),i}function useFloating(e){e===void 0&&(e={});const{placement:i="bottom",strategy:s="absolute",middleware:a=[],platform:_,elements:{reference:$,floating:rt}={},transform:c=!0,whileElementsMounted:dt,open:ht}=e,[Et,St]=reactExports.useState({x:0,y:0,strategy:s,placement:i,middlewareData:{},isPositioned:!1}),[At,Pt]=reactExports.useState(a);deepEqual$1(At,a)||Pt(a);const[Vt,Bt]=reactExports.useState(null),[Zt,zt]=reactExports.useState(null),Ut=reactExports.useCallback(dr=>{dr!==ir.current&&(ir.current=dr,Bt(dr))},[]),Nt=reactExports.useCallback(dr=>{dr!==or.current&&(or.current=dr,zt(dr))},[]),Gt=$||Vt,er=rt||Zt,ir=reactExports.useRef(null),or=reactExports.useRef(null),mr=reactExports.useRef(Et),Rr=dt!=null,on=useLatestRef(dt),un=useLatestRef(_),jr=useLatestRef(ht),Jr=reactExports.useCallback(()=>{if(!ir.current||!or.current)return;const dr={placement:i,strategy:s,middleware:At};un.current&&(dr.platform=un.current),computePosition(ir.current,or.current,dr).then(gr=>{const qr={...gr,isPositioned:jr.current!==!1};fn.current&&!deepEqual$1(mr.current,qr)&&(mr.current=qr,reactDomExports.flushSync(()=>{St(qr)}))})},[At,i,s,un,jr]);index(()=>{ht===!1&&mr.current.isPositioned&&(mr.current.isPositioned=!1,St(dr=>({...dr,isPositioned:!1})))},[ht]);const fn=reactExports.useRef(!1);index(()=>(fn.current=!0,()=>{fn.current=!1}),[]),index(()=>{if(Gt&&(ir.current=Gt),er&&(or.current=er),Gt&&er){if(on.current)return on.current(Gt,er,Jr);Jr()}},[Gt,er,Jr,on,Rr]);const Fr=reactExports.useMemo(()=>({reference:ir,floating:or,setReference:Ut,setFloating:Nt}),[Ut,Nt]),Cr=reactExports.useMemo(()=>({reference:Gt,floating:er}),[Gt,er]),Sr=reactExports.useMemo(()=>{const dr={position:s,left:0,top:0};if(!Cr.floating)return dr;const gr=roundByDPR(Cr.floating,Et.x),qr=roundByDPR(Cr.floating,Et.y);return c?{...dr,transform:"translate("+gr+"px, "+qr+"px)",...getDPR(Cr.floating)>=1.5&&{willChange:"transform"}}:{position:s,left:gr,top:qr}},[s,c,Cr.floating,Et.x,Et.y]);return reactExports.useMemo(()=>({...Et,update:Jr,refs:Fr,elements:Cr,floatingStyles:Sr}),[Et,Jr,Fr,Cr,Sr])}const arrow$1=e=>{function i(s){return{}.hasOwnProperty.call(s,"current")}return{name:"arrow",options:e,fn(s){const{element:a,padding:_}=typeof e=="function"?e(s):e;return a&&i(a)?a.current!=null?arrow$2({element:a.current,padding:_}).fn(s):{}:a?arrow$2({element:a,padding:_}).fn(s):{}}}},offset=(e,i)=>({...offset$1(e),options:[e,i]}),shift=(e,i)=>({...shift$1(e),options:[e,i]}),limitShift=(e,i)=>({...limitShift$1(e),options:[e,i]}),flip=(e,i)=>({...flip$1(e),options:[e,i]}),size=(e,i)=>({...size$1(e),options:[e,i]}),hide=(e,i)=>({...hide$1(e),options:[e,i]}),arrow=(e,i)=>({...arrow$1(e),options:[e,i]});var NAME$1="Arrow",Arrow$1=reactExports.forwardRef((e,i)=>{const{children:s,width:a=10,height:_=5,...$}=e;return jsxRuntimeExports.jsx(Primitive.svg,{...$,ref:i,width:a,height:_,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:e.asChild?s:jsxRuntimeExports.jsx("polygon",{points:"0,0 30,0 15,10"})})});Arrow$1.displayName=NAME$1;var Root$4=Arrow$1;function useSize(e){const[i,s]=reactExports.useState(void 0);return useLayoutEffect2(()=>{if(e){s({width:e.offsetWidth,height:e.offsetHeight});const a=new ResizeObserver(_=>{if(!Array.isArray(_)||!_.length)return;const $=_[0];let rt,c;if("borderBoxSize"in $){const dt=$.borderBoxSize,ht=Array.isArray(dt)?dt[0]:dt;rt=ht.inlineSize,c=ht.blockSize}else rt=e.offsetWidth,c=e.offsetHeight;s({width:rt,height:c})});return a.observe(e,{box:"border-box"}),()=>a.unobserve(e)}else s(void 0)},[e]),i}var POPPER_NAME="Popper",[createPopperContext,createPopperScope]=createContextScope(POPPER_NAME),[PopperProvider,usePopperContext]=createPopperContext(POPPER_NAME),Popper=e=>{const{__scopePopper:i,children:s}=e,[a,_]=reactExports.useState(null);return jsxRuntimeExports.jsx(PopperProvider,{scope:i,anchor:a,onAnchorChange:_,children:s})};Popper.displayName=POPPER_NAME;var ANCHOR_NAME="PopperAnchor",PopperAnchor=reactExports.forwardRef((e,i)=>{const{__scopePopper:s,virtualRef:a,..._}=e,$=usePopperContext(ANCHOR_NAME,s),rt=reactExports.useRef(null),c=useComposedRefs$1(i,rt);return reactExports.useEffect(()=>{$.onAnchorChange((a==null?void 0:a.current)||rt.current)}),a?null:jsxRuntimeExports.jsx(Primitive.div,{..._,ref:c})});PopperAnchor.displayName=ANCHOR_NAME;var CONTENT_NAME$6="PopperContent",[PopperContentProvider,useContentContext]=createPopperContext(CONTENT_NAME$6),PopperContent=reactExports.forwardRef((e,i)=>{var ms,On,ws,Vs,ks,lo;const{__scopePopper:s,side:a="bottom",sideOffset:_=0,align:$="center",alignOffset:rt=0,arrowPadding:c=0,avoidCollisions:dt=!0,collisionBoundary:ht=[],collisionPadding:Et=0,sticky:St="partial",hideWhenDetached:At=!1,updatePositionStrategy:Pt="optimized",onPlaced:Vt,...Bt}=e,Zt=usePopperContext(CONTENT_NAME$6,s),[zt,Ut]=reactExports.useState(null),Nt=useComposedRefs$1(i,ys=>Ut(ys)),[Gt,er]=reactExports.useState(null),ir=useSize(Gt),or=(ir==null?void 0:ir.width)??0,mr=(ir==null?void 0:ir.height)??0,Rr=a+($!=="center"?"-"+$:""),on=typeof Et=="number"?Et:{top:0,right:0,bottom:0,left:0,...Et},un=Array.isArray(ht)?ht:[ht],jr=un.length>0,Jr={padding:on,boundary:un.filter(isNotNull$2),altBoundary:jr},{refs:fn,floatingStyles:Fr,placement:Cr,isPositioned:Sr,middlewareData:dr}=useFloating({strategy:"fixed",placement:Rr,whileElementsMounted:(...ys)=>autoUpdate(...ys,{animationFrame:Pt==="always"}),elements:{reference:Zt.anchor},middleware:[offset({mainAxis:_+mr,alignmentAxis:rt}),dt&&shift({mainAxis:!0,crossAxis:!1,limiter:St==="partial"?limitShift():void 0,...Jr}),dt&&flip({...Jr}),size({...Jr,apply:({elements:ys,rects:dn,availableWidth:Es,availableHeight:po})=>{const{width:no,height:tn}=dn.reference,us=ys.floating.style;us.setProperty("--radix-popper-available-width",`${Es}px`),us.setProperty("--radix-popper-available-height",`${po}px`),us.setProperty("--radix-popper-anchor-width",`${no}px`),us.setProperty("--radix-popper-anchor-height",`${tn}px`)}}),Gt&&arrow({element:Gt,padding:c}),transformOrigin({arrowWidth:or,arrowHeight:mr}),At&&hide({strategy:"referenceHidden",...Jr})]}),[gr,qr]=getSideAndAlignFromPlacement(Cr),Lr=useCallbackRef$1(Vt);useLayoutEffect2(()=>{Sr&&(Lr==null||Lr())},[Sr,Lr]);const _n=(ms=dr.arrow)==null?void 0:ms.x,gn=(On=dr.arrow)==null?void 0:On.y,Sn=((ws=dr.arrow)==null?void 0:ws.centerOffset)!==0,[Fs,rs]=reactExports.useState();return useLayoutEffect2(()=>{zt&&rs(window.getComputedStyle(zt).zIndex)},[zt]),jsxRuntimeExports.jsx("div",{ref:fn.setFloating,"data-radix-popper-content-wrapper":"",style:{...Fr,transform:Sr?Fr.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:Fs,"--radix-popper-transform-origin":[(Vs=dr.transformOrigin)==null?void 0:Vs.x,(ks=dr.transformOrigin)==null?void 0:ks.y].join(" "),...((lo=dr.hide)==null?void 0:lo.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:e.dir,children:jsxRuntimeExports.jsx(PopperContentProvider,{scope:s,placedSide:gr,onArrowChange:er,arrowX:_n,arrowY:gn,shouldHideArrow:Sn,children:jsxRuntimeExports.jsx(Primitive.div,{"data-side":gr,"data-align":qr,...Bt,ref:Nt,style:{...Bt.style,animation:Sr?void 0:"none"}})})})});PopperContent.displayName=CONTENT_NAME$6;var ARROW_NAME$2="PopperArrow",OPPOSITE_SIDE={top:"bottom",right:"left",bottom:"top",left:"right"},PopperArrow=reactExports.forwardRef(function(i,s){const{__scopePopper:a,..._}=i,$=useContentContext(ARROW_NAME$2,a),rt=OPPOSITE_SIDE[$.placedSide];return jsxRuntimeExports.jsx("span",{ref:$.onArrowChange,style:{position:"absolute",left:$.arrowX,top:$.arrowY,[rt]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[$.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[$.placedSide],visibility:$.shouldHideArrow?"hidden":void 0},children:jsxRuntimeExports.jsx(Root$4,{..._,ref:s,style:{..._.style,display:"block"}})})});PopperArrow.displayName=ARROW_NAME$2;function isNotNull$2(e){return e!==null}var transformOrigin=e=>({name:"transformOrigin",options:e,fn(i){var Zt,zt,Ut;const{placement:s,rects:a,middlewareData:_}=i,rt=((Zt=_.arrow)==null?void 0:Zt.centerOffset)!==0,c=rt?0:e.arrowWidth,dt=rt?0:e.arrowHeight,[ht,Et]=getSideAndAlignFromPlacement(s),St={start:"0%",center:"50%",end:"100%"}[Et],At=(((zt=_.arrow)==null?void 0:zt.x)??0)+c/2,Pt=(((Ut=_.arrow)==null?void 0:Ut.y)??0)+dt/2;let Vt="",Bt="";return ht==="bottom"?(Vt=rt?St:`${At}px`,Bt=`${-dt}px`):ht==="top"?(Vt=rt?St:`${At}px`,Bt=`${a.floating.height+dt}px`):ht==="right"?(Vt=`${-dt}px`,Bt=rt?St:`${Pt}px`):ht==="left"&&(Vt=`${a.floating.width+dt}px`,Bt=rt?St:`${Pt}px`),{data:{x:Vt,y:Bt}}}});function getSideAndAlignFromPlacement(e){const[i,s="center"]=e.split("-");return[i,s]}var Root2$3=Popper,Anchor=PopperAnchor,Content$2=PopperContent,Arrow=PopperArrow,[createTooltipContext,createTooltipScope]=createContextScope("Tooltip",[createPopperScope]),usePopperScope$1=createPopperScope(),PROVIDER_NAME="TooltipProvider",DEFAULT_DELAY_DURATION=700,TOOLTIP_OPEN="tooltip.open",[TooltipProviderContextProvider,useTooltipProviderContext]=createTooltipContext(PROVIDER_NAME),TooltipProvider$1=e=>{const{__scopeTooltip:i,delayDuration:s=DEFAULT_DELAY_DURATION,skipDelayDuration:a=300,disableHoverableContent:_=!1,children:$}=e,rt=reactExports.useRef(!0),c=reactExports.useRef(!1),dt=reactExports.useRef(0);return reactExports.useEffect(()=>{const ht=dt.current;return()=>window.clearTimeout(ht)},[]),jsxRuntimeExports.jsx(TooltipProviderContextProvider,{scope:i,isOpenDelayedRef:rt,delayDuration:s,onOpen:reactExports.useCallback(()=>{window.clearTimeout(dt.current),rt.current=!1},[]),onClose:reactExports.useCallback(()=>{window.clearTimeout(dt.current),dt.current=window.setTimeout(()=>rt.current=!0,a)},[a]),isPointerInTransitRef:c,onPointerInTransitChange:reactExports.useCallback(ht=>{c.current=ht},[]),disableHoverableContent:_,children:$})};TooltipProvider$1.displayName=PROVIDER_NAME;var TOOLTIP_NAME="Tooltip",[TooltipContextProvider,useTooltipContext]=createTooltipContext(TOOLTIP_NAME),TRIGGER_NAME$5="TooltipTrigger",TooltipTrigger=reactExports.forwardRef((e,i)=>{const{__scopeTooltip:s,...a}=e,_=useTooltipContext(TRIGGER_NAME$5,s),$=useTooltipProviderContext(TRIGGER_NAME$5,s),rt=usePopperScope$1(s),c=reactExports.useRef(null),dt=useComposedRefs$1(i,c,_.onTriggerChange),ht=reactExports.useRef(!1),Et=reactExports.useRef(!1),St=reactExports.useCallback(()=>ht.current=!1,[]);return reactExports.useEffect(()=>()=>document.removeEventListener("pointerup",St),[St]),jsxRuntimeExports.jsx(Anchor,{asChild:!0,...rt,children:jsxRuntimeExports.jsx(Primitive.button,{"aria-describedby":_.open?_.contentId:void 0,"data-state":_.stateAttribute,...a,ref:dt,onPointerMove:composeEventHandlers(e.onPointerMove,At=>{At.pointerType!=="touch"&&!Et.current&&!$.isPointerInTransitRef.current&&(_.onTriggerEnter(),Et.current=!0)}),onPointerLeave:composeEventHandlers(e.onPointerLeave,()=>{_.onTriggerLeave(),Et.current=!1}),onPointerDown:composeEventHandlers(e.onPointerDown,()=>{_.open&&_.onClose(),ht.current=!0,document.addEventListener("pointerup",St,{once:!0})}),onFocus:composeEventHandlers(e.onFocus,()=>{ht.current||_.onOpen()}),onBlur:composeEventHandlers(e.onBlur,_.onClose),onClick:composeEventHandlers(e.onClick,_.onClose)})})});TooltipTrigger.displayName=TRIGGER_NAME$5;var PORTAL_NAME$3="TooltipPortal",[PortalProvider$1,usePortalContext$1]=createTooltipContext(PORTAL_NAME$3,{forceMount:void 0}),CONTENT_NAME$5="TooltipContent",TooltipContent$1=reactExports.forwardRef((e,i)=>{const s=usePortalContext$1(CONTENT_NAME$5,e.__scopeTooltip),{forceMount:a=s.forceMount,side:_="top",...$}=e,rt=useTooltipContext(CONTENT_NAME$5,e.__scopeTooltip);return jsxRuntimeExports.jsx(Presence,{present:a||rt.open,children:rt.disableHoverableContent?jsxRuntimeExports.jsx(TooltipContentImpl,{side:_,...$,ref:i}):jsxRuntimeExports.jsx(TooltipContentHoverable,{side:_,...$,ref:i})})}),TooltipContentHoverable=reactExports.forwardRef((e,i)=>{const s=useTooltipContext(CONTENT_NAME$5,e.__scopeTooltip),a=useTooltipProviderContext(CONTENT_NAME$5,e.__scopeTooltip),_=reactExports.useRef(null),$=useComposedRefs$1(i,_),[rt,c]=reactExports.useState(null),{trigger:dt,onClose:ht}=s,Et=_.current,{onPointerInTransitChange:St}=a,At=reactExports.useCallback(()=>{c(null),St(!1)},[St]),Pt=reactExports.useCallback((Vt,Bt)=>{const Zt=Vt.currentTarget,zt={x:Vt.clientX,y:Vt.clientY},Ut=getExitSideFromRect(zt,Zt.getBoundingClientRect()),Nt=getPaddedExitPoints(zt,Ut),Gt=getPointsFromRect(Bt.getBoundingClientRect()),er=getHull([...Nt,...Gt]);c(er),St(!0)},[St]);return reactExports.useEffect(()=>()=>At(),[At]),reactExports.useEffect(()=>{if(dt&&Et){const Vt=Zt=>Pt(Zt,Et),Bt=Zt=>Pt(Zt,dt);return dt.addEventListener("pointerleave",Vt),Et.addEventListener("pointerleave",Bt),()=>{dt.removeEventListener("pointerleave",Vt),Et.removeEventListener("pointerleave",Bt)}}},[dt,Et,Pt,At]),reactExports.useEffect(()=>{if(rt){const Vt=Bt=>{const Zt=Bt.target,zt={x:Bt.clientX,y:Bt.clientY},Ut=(dt==null?void 0:dt.contains(Zt))||(Et==null?void 0:Et.contains(Zt)),Nt=!isPointInPolygon$1(zt,rt);Ut?At():Nt&&(At(),ht())};return document.addEventListener("pointermove",Vt),()=>document.removeEventListener("pointermove",Vt)}},[dt,Et,rt,ht,At]),jsxRuntimeExports.jsx(TooltipContentImpl,{...e,ref:$})}),[VisuallyHiddenContentContextProvider,useVisuallyHiddenContentContext]=createTooltipContext(TOOLTIP_NAME,{isInside:!1}),Slottable$1=createSlottable("TooltipContent"),TooltipContentImpl=reactExports.forwardRef((e,i)=>{const{__scopeTooltip:s,children:a,"aria-label":_,onEscapeKeyDown:$,onPointerDownOutside:rt,...c}=e,dt=useTooltipContext(CONTENT_NAME$5,s),ht=usePopperScope$1(s),{onClose:Et}=dt;return reactExports.useEffect(()=>(document.addEventListener(TOOLTIP_OPEN,Et),()=>document.removeEventListener(TOOLTIP_OPEN,Et)),[Et]),reactExports.useEffect(()=>{if(dt.trigger){const St=At=>{const Pt=At.target;Pt!=null&&Pt.contains(dt.trigger)&&Et()};return window.addEventListener("scroll",St,{capture:!0}),()=>window.removeEventListener("scroll",St,{capture:!0})}},[dt.trigger,Et]),jsxRuntimeExports.jsx(DismissableLayer,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:$,onPointerDownOutside:rt,onFocusOutside:St=>St.preventDefault(),onDismiss:Et,children:jsxRuntimeExports.jsxs(Content$2,{"data-state":dt.stateAttribute,...ht,...c,ref:i,style:{...c.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[jsxRuntimeExports.jsx(Slottable$1,{children:a}),jsxRuntimeExports.jsx(VisuallyHiddenContentContextProvider,{scope:s,isInside:!0,children:jsxRuntimeExports.jsx(Root$5,{id:dt.contentId,role:"tooltip",children:_||a})})]})})});TooltipContent$1.displayName=CONTENT_NAME$5;var ARROW_NAME$1="TooltipArrow",TooltipArrow=reactExports.forwardRef((e,i)=>{const{__scopeTooltip:s,...a}=e,_=usePopperScope$1(s);return useVisuallyHiddenContentContext(ARROW_NAME$1,s).isInside?null:jsxRuntimeExports.jsx(Arrow,{..._,...a,ref:i})});TooltipArrow.displayName=ARROW_NAME$1;function getExitSideFromRect(e,i){const s=Math.abs(i.top-e.y),a=Math.abs(i.bottom-e.y),_=Math.abs(i.right-e.x),$=Math.abs(i.left-e.x);switch(Math.min(s,a,_,$)){case $:return"left";case _:return"right";case s:return"top";case a:return"bottom";default:throw new Error("unreachable")}}function getPaddedExitPoints(e,i,s=5){const a=[];switch(i){case"top":a.push({x:e.x-s,y:e.y+s},{x:e.x+s,y:e.y+s});break;case"bottom":a.push({x:e.x-s,y:e.y-s},{x:e.x+s,y:e.y-s});break;case"left":a.push({x:e.x+s,y:e.y-s},{x:e.x+s,y:e.y+s});break;case"right":a.push({x:e.x-s,y:e.y-s},{x:e.x-s,y:e.y+s});break}return a}function getPointsFromRect(e){const{top:i,right:s,bottom:a,left:_}=e;return[{x:_,y:i},{x:s,y:i},{x:s,y:a},{x:_,y:a}]}function isPointInPolygon$1(e,i){const{x:s,y:a}=e;let _=!1;for(let $=0,rt=i.length-1;$<i.length;rt=$++){const c=i[$],dt=i[rt],ht=c.x,Et=c.y,St=dt.x,At=dt.y;Et>a!=At>a&&s<(St-ht)*(a-Et)/(At-Et)+ht&&(_=!_)}return _}function getHull(e){const i=e.slice();return i.sort((s,a)=>s.x<a.x?-1:s.x>a.x?1:s.y<a.y?-1:s.y>a.y?1:0),getHullPresorted(i)}function getHullPresorted(e){if(e.length<=1)return e.slice();const i=[];for(let a=0;a<e.length;a++){const _=e[a];for(;i.length>=2;){const $=i[i.length-1],rt=i[i.length-2];if(($.x-rt.x)*(_.y-rt.y)>=($.y-rt.y)*(_.x-rt.x))i.pop();else break}i.push(_)}i.pop();const s=[];for(let a=e.length-1;a>=0;a--){const _=e[a];for(;s.length>=2;){const $=s[s.length-1],rt=s[s.length-2];if(($.x-rt.x)*(_.y-rt.y)>=($.y-rt.y)*(_.x-rt.x))s.pop();else break}s.push(_)}return s.pop(),i.length===1&&s.length===1&&i[0].x===s[0].x&&i[0].y===s[0].y?i:i.concat(s)}var Provider$1=TooltipProvider$1,Content2$3=TooltipContent$1;const TooltipProvider=Provider$1,TooltipContent=reactExports.forwardRef(({className:e,sideOffset:i=4,...s},a)=>jsxRuntimeExports.jsx(Content2$3,{ref:a,sideOffset:i,className:cn("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...s}));TooltipContent.displayName=Content2$3.displayName;var Subscribable=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(e){return this.listeners.add(e),this.onSubscribe(),()=>{this.listeners.delete(e),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},isServer=typeof window>"u"||"Deno"in globalThis;function noop$2(){}function functionalUpdate(e,i){return typeof e=="function"?e(i):e}function isValidTimeout(e){return typeof e=="number"&&e>=0&&e!==1/0}function timeUntilStale(e,i){return Math.max(e+(i||0)-Date.now(),0)}function resolveStaleTime(e,i){return typeof e=="function"?e(i):e}function resolveEnabled(e,i){return typeof e=="function"?e(i):e}function matchQuery(e,i){const{type:s="all",exact:a,fetchStatus:_,predicate:$,queryKey:rt,stale:c}=e;if(rt){if(a){if(i.queryHash!==hashQueryKeyByOptions(rt,i.options))return!1}else if(!partialMatchKey(i.queryKey,rt))return!1}if(s!=="all"){const dt=i.isActive();if(s==="active"&&!dt||s==="inactive"&&dt)return!1}return!(typeof c=="boolean"&&i.isStale()!==c||_&&_!==i.state.fetchStatus||$&&!$(i))}function matchMutation(e,i){const{exact:s,status:a,predicate:_,mutationKey:$}=e;if($){if(!i.options.mutationKey)return!1;if(s){if(hashKey(i.options.mutationKey)!==hashKey($))return!1}else if(!partialMatchKey(i.options.mutationKey,$))return!1}return!(a&&i.state.status!==a||_&&!_(i))}function hashQueryKeyByOptions(e,i){return((i==null?void 0:i.queryKeyHashFn)||hashKey)(e)}function hashKey(e){return JSON.stringify(e,(i,s)=>isPlainObject(s)?Object.keys(s).sort().reduce((a,_)=>(a[_]=s[_],a),{}):s)}function partialMatchKey(e,i){return e===i?!0:typeof e!=typeof i?!1:e&&i&&typeof e=="object"&&typeof i=="object"?Object.keys(i).every(s=>partialMatchKey(e[s],i[s])):!1}function replaceEqualDeep(e,i){if(e===i)return e;const s=isPlainArray(e)&&isPlainArray(i);if(s||isPlainObject(e)&&isPlainObject(i)){const a=s?e:Object.keys(e),_=a.length,$=s?i:Object.keys(i),rt=$.length,c=s?[]:{},dt=new Set(a);let ht=0;for(let Et=0;Et<rt;Et++){const St=s?Et:$[Et];(!s&&dt.has(St)||s)&&e[St]===void 0&&i[St]===void 0?(c[St]=void 0,ht++):(c[St]=replaceEqualDeep(e[St],i[St]),c[St]===e[St]&&e[St]!==void 0&&ht++)}return _===rt&&ht===_?e:c}return i}function isPlainArray(e){return Array.isArray(e)&&e.length===Object.keys(e).length}function isPlainObject(e){if(!hasObjectPrototype(e))return!1;const i=e.constructor;if(i===void 0)return!0;const s=i.prototype;return!(!hasObjectPrototype(s)||!s.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(e)!==Object.prototype)}function hasObjectPrototype(e){return Object.prototype.toString.call(e)==="[object Object]"}function sleep(e){return new Promise(i=>{setTimeout(i,e)})}function replaceData(e,i,s){return typeof s.structuralSharing=="function"?s.structuralSharing(e,i):s.structuralSharing!==!1?replaceEqualDeep(e,i):i}function addToEnd(e,i,s=0){const a=[...e,i];return s&&a.length>s?a.slice(1):a}function addToStart(e,i,s=0){const a=[i,...e];return s&&a.length>s?a.slice(0,-1):a}var skipToken=Symbol();function ensureQueryFn(e,i){return!e.queryFn&&(i!=null&&i.initialPromise)?()=>i.initialPromise:!e.queryFn||e.queryFn===skipToken?()=>Promise.reject(new Error(`Missing queryFn: '${e.queryHash}'`)):e.queryFn}var H1,s1,w_,X3,FocusManager=(X3=class extends Subscribable{constructor(){super();zu(this,H1);zu(this,s1);zu(this,w_);eu(this,w_,i=>{if(!isServer&&window.addEventListener){const s=()=>i();return window.addEventListener("visibilitychange",s,!1),()=>{window.removeEventListener("visibilitychange",s)}}})}onSubscribe(){Ms(this,s1)||this.setEventListener(Ms(this,w_))}onUnsubscribe(){var i;this.hasListeners()||((i=Ms(this,s1))==null||i.call(this),eu(this,s1,void 0))}setEventListener(i){var s;eu(this,w_,i),(s=Ms(this,s1))==null||s.call(this),eu(this,s1,i(a=>{typeof a=="boolean"?this.setFocused(a):this.onFocus()}))}setFocused(i){Ms(this,H1)!==i&&(eu(this,H1,i),this.onFocus())}onFocus(){const i=this.isFocused();this.listeners.forEach(s=>{s(i)})}isFocused(){var i;return typeof Ms(this,H1)=="boolean"?Ms(this,H1):((i=globalThis.document)==null?void 0:i.visibilityState)!=="hidden"}},H1=new WeakMap,s1=new WeakMap,w_=new WeakMap,X3),focusManager=new FocusManager,C_,o1,A_,K3,OnlineManager=(K3=class extends Subscribable{constructor(){super();zu(this,C_,!0);zu(this,o1);zu(this,A_);eu(this,A_,i=>{if(!isServer&&window.addEventListener){const s=()=>i(!0),a=()=>i(!1);return window.addEventListener("online",s,!1),window.addEventListener("offline",a,!1),()=>{window.removeEventListener("online",s),window.removeEventListener("offline",a)}}})}onSubscribe(){Ms(this,o1)||this.setEventListener(Ms(this,A_))}onUnsubscribe(){var i;this.hasListeners()||((i=Ms(this,o1))==null||i.call(this),eu(this,o1,void 0))}setEventListener(i){var s;eu(this,A_,i),(s=Ms(this,o1))==null||s.call(this),eu(this,o1,i(this.setOnline.bind(this)))}setOnline(i){Ms(this,C_)!==i&&(eu(this,C_,i),this.listeners.forEach(a=>{a(i)}))}isOnline(){return Ms(this,C_)}},C_=new WeakMap,o1=new WeakMap,A_=new WeakMap,K3),onlineManager=new OnlineManager;function pendingThenable(){let e,i;const s=new Promise((_,$)=>{e=_,i=$});s.status="pending",s.catch(()=>{});function a(_){Object.assign(s,_),delete s.resolve,delete s.reject}return s.resolve=_=>{a({status:"fulfilled",value:_}),e(_)},s.reject=_=>{a({status:"rejected",reason:_}),i(_)},s}function defaultRetryDelay(e){return Math.min(1e3*2**e,3e4)}function canFetch(e){return(e??"online")==="online"?onlineManager.isOnline():!0}var CancelledError=class extends Error{constructor(e){super("CancelledError"),this.revert=e==null?void 0:e.revert,this.silent=e==null?void 0:e.silent}};function isCancelledError(e){return e instanceof CancelledError}function createRetryer(e){let i=!1,s=0,a=!1,_;const $=pendingThenable(),rt=Bt=>{var Zt;a||(At(new CancelledError(Bt)),(Zt=e.abort)==null||Zt.call(e))},c=()=>{i=!0},dt=()=>{i=!1},ht=()=>focusManager.isFocused()&&(e.networkMode==="always"||onlineManager.isOnline())&&e.canRun(),Et=()=>canFetch(e.networkMode)&&e.canRun(),St=Bt=>{var Zt;a||(a=!0,(Zt=e.onSuccess)==null||Zt.call(e,Bt),_==null||_(),$.resolve(Bt))},At=Bt=>{var Zt;a||(a=!0,(Zt=e.onError)==null||Zt.call(e,Bt),_==null||_(),$.reject(Bt))},Pt=()=>new Promise(Bt=>{var Zt;_=zt=>{(a||ht())&&Bt(zt)},(Zt=e.onPause)==null||Zt.call(e)}).then(()=>{var Bt;_=void 0,a||(Bt=e.onContinue)==null||Bt.call(e)}),Vt=()=>{if(a)return;let Bt;const Zt=s===0?e.initialPromise:void 0;try{Bt=Zt??e.fn()}catch(zt){Bt=Promise.reject(zt)}Promise.resolve(Bt).then(St).catch(zt=>{var ir;if(a)return;const Ut=e.retry??(isServer?0:3),Nt=e.retryDelay??defaultRetryDelay,Gt=typeof Nt=="function"?Nt(s,zt):Nt,er=Ut===!0||typeof Ut=="number"&&s<Ut||typeof Ut=="function"&&Ut(s,zt);if(i||!er){At(zt);return}s++,(ir=e.onFail)==null||ir.call(e,s,zt),sleep(Gt).then(()=>ht()?void 0:Pt()).then(()=>{i?At(zt):Vt()})})};return{promise:$,cancel:rt,continue:()=>(_==null||_(),$),cancelRetry:c,continueRetry:dt,canStart:Et,start:()=>(Et()?Vt():Pt().then(Vt),$)}}var defaultScheduler=e=>setTimeout(e,0);function createNotifyManager(){let e=[],i=0,s=c=>{c()},a=c=>{c()},_=defaultScheduler;const $=c=>{i?e.push(c):_(()=>{s(c)})},rt=()=>{const c=e;e=[],c.length&&_(()=>{a(()=>{c.forEach(dt=>{s(dt)})})})};return{batch:c=>{let dt;i++;try{dt=c()}finally{i--,i||rt()}return dt},batchCalls:c=>(...dt)=>{$(()=>{c(...dt)})},schedule:$,setNotifyFunction:c=>{s=c},setBatchNotifyFunction:c=>{a=c},setScheduler:c=>{_=c}}}var notifyManager=createNotifyManager(),W1,Z3,Removable=(Z3=class{constructor(){zu(this,W1)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),isValidTimeout(this.gcTime)&&eu(this,W1,setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(e){this.gcTime=Math.max(this.gcTime||0,e??(isServer?1/0:5*60*1e3))}clearGcTimeout(){Ms(this,W1)&&(clearTimeout(Ms(this,W1)),eu(this,W1,void 0))}},W1=new WeakMap,Z3),S_,q1,Q0,X1,e0,pE,K1,wm,vx,Y3,Query=(Y3=class extends Removable{constructor(i){super();zu(this,wm);zu(this,S_);zu(this,q1);zu(this,Q0);zu(this,X1);zu(this,e0);zu(this,pE);zu(this,K1);eu(this,K1,!1),eu(this,pE,i.defaultOptions),this.setOptions(i.options),this.observers=[],eu(this,X1,i.client),eu(this,Q0,Ms(this,X1).getQueryCache()),this.queryKey=i.queryKey,this.queryHash=i.queryHash,eu(this,S_,getDefaultState$1(this.options)),this.state=i.state??Ms(this,S_),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var i;return(i=Ms(this,e0))==null?void 0:i.promise}setOptions(i){this.options={...Ms(this,pE),...i},this.updateGcTime(this.options.gcTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&Ms(this,Q0).remove(this)}setData(i,s){const a=replaceData(this.state.data,i,this.options);return Jp(this,wm,vx).call(this,{data:a,type:"success",dataUpdatedAt:s==null?void 0:s.updatedAt,manual:s==null?void 0:s.manual}),a}setState(i,s){Jp(this,wm,vx).call(this,{type:"setState",state:i,setStateOptions:s})}cancel(i){var a,_;const s=(a=Ms(this,e0))==null?void 0:a.promise;return(_=Ms(this,e0))==null||_.cancel(i),s?s.then(noop$2).catch(noop$2):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(Ms(this,S_))}isActive(){return this.observers.some(i=>resolveEnabled(i.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===skipToken||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(i=>resolveStaleTime(i.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(i=>i.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(i=0){return this.state.data===void 0?!0:i==="static"?!1:this.state.isInvalidated?!0:!timeUntilStale(this.state.dataUpdatedAt,i)}onFocus(){var s;const i=this.observers.find(a=>a.shouldFetchOnWindowFocus());i==null||i.refetch({cancelRefetch:!1}),(s=Ms(this,e0))==null||s.continue()}onOnline(){var s;const i=this.observers.find(a=>a.shouldFetchOnReconnect());i==null||i.refetch({cancelRefetch:!1}),(s=Ms(this,e0))==null||s.continue()}addObserver(i){this.observers.includes(i)||(this.observers.push(i),this.clearGcTimeout(),Ms(this,Q0).notify({type:"observerAdded",query:this,observer:i}))}removeObserver(i){this.observers.includes(i)&&(this.observers=this.observers.filter(s=>s!==i),this.observers.length||(Ms(this,e0)&&(Ms(this,K1)?Ms(this,e0).cancel({revert:!0}):Ms(this,e0).cancelRetry()),this.scheduleGc()),Ms(this,Q0).notify({type:"observerRemoved",query:this,observer:i}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||Jp(this,wm,vx).call(this,{type:"invalidate"})}fetch(i,s){var ht,Et,St;if(this.state.fetchStatus!=="idle"){if(this.state.data!==void 0&&(s!=null&&s.cancelRefetch))this.cancel({silent:!0});else if(Ms(this,e0))return Ms(this,e0).continueRetry(),Ms(this,e0).promise}if(i&&this.setOptions(i),!this.options.queryFn){const At=this.observers.find(Pt=>Pt.options.queryFn);At&&this.setOptions(At.options)}const a=new AbortController,_=At=>{Object.defineProperty(At,"signal",{enumerable:!0,get:()=>(eu(this,K1,!0),a.signal)})},$=()=>{const At=ensureQueryFn(this.options,s),Vt=(()=>{const Bt={client:Ms(this,X1),queryKey:this.queryKey,meta:this.meta};return _(Bt),Bt})();return eu(this,K1,!1),this.options.persister?this.options.persister(At,Vt,this):At(Vt)},c=(()=>{const At={fetchOptions:s,options:this.options,queryKey:this.queryKey,client:Ms(this,X1),state:this.state,fetchFn:$};return _(At),At})();(ht=this.options.behavior)==null||ht.onFetch(c,this),eu(this,q1,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((Et=c.fetchOptions)==null?void 0:Et.meta))&&Jp(this,wm,vx).call(this,{type:"fetch",meta:(St=c.fetchOptions)==null?void 0:St.meta});const dt=At=>{var Pt,Vt,Bt,Zt;isCancelledError(At)&&At.silent||Jp(this,wm,vx).call(this,{type:"error",error:At}),isCancelledError(At)||((Vt=(Pt=Ms(this,Q0).config).onError)==null||Vt.call(Pt,At,this),(Zt=(Bt=Ms(this,Q0).config).onSettled)==null||Zt.call(Bt,this.state.data,At,this)),this.scheduleGc()};return eu(this,e0,createRetryer({initialPromise:s==null?void 0:s.initialPromise,fn:c.fetchFn,abort:a.abort.bind(a),onSuccess:At=>{var Pt,Vt,Bt,Zt;if(At===void 0){dt(new Error(`${this.queryHash} data is undefined`));return}try{this.setData(At)}catch(zt){dt(zt);return}(Vt=(Pt=Ms(this,Q0).config).onSuccess)==null||Vt.call(Pt,At,this),(Zt=(Bt=Ms(this,Q0).config).onSettled)==null||Zt.call(Bt,At,this.state.error,this),this.scheduleGc()},onError:dt,onFail:(At,Pt)=>{Jp(this,wm,vx).call(this,{type:"failed",failureCount:At,error:Pt})},onPause:()=>{Jp(this,wm,vx).call(this,{type:"pause"})},onContinue:()=>{Jp(this,wm,vx).call(this,{type:"continue"})},retry:c.options.retry,retryDelay:c.options.retryDelay,networkMode:c.options.networkMode,canRun:()=>!0})),Ms(this,e0).start()}},S_=new WeakMap,q1=new WeakMap,Q0=new WeakMap,X1=new WeakMap,e0=new WeakMap,pE=new WeakMap,K1=new WeakMap,wm=new WeakSet,vx=function(i){const s=a=>{switch(i.type){case"failed":return{...a,fetchFailureCount:i.failureCount,fetchFailureReason:i.error};case"pause":return{...a,fetchStatus:"paused"};case"continue":return{...a,fetchStatus:"fetching"};case"fetch":return{...a,...fetchState(a.data,this.options),fetchMeta:i.meta??null};case"success":return eu(this,q1,void 0),{...a,data:i.data,dataUpdateCount:a.dataUpdateCount+1,dataUpdatedAt:i.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!i.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const _=i.error;return isCancelledError(_)&&_.revert&&Ms(this,q1)?{...Ms(this,q1),fetchStatus:"idle"}:{...a,error:_,errorUpdateCount:a.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:a.fetchFailureCount+1,fetchFailureReason:_,fetchStatus:"idle",status:"error"};case"invalidate":return{...a,isInvalidated:!0};case"setState":return{...a,...i.state}}};this.state=s(this.state),notifyManager.batch(()=>{this.observers.forEach(a=>{a.onQueryUpdate()}),Ms(this,Q0).notify({query:this,type:"updated",action:i})})},Y3);function fetchState(e,i){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:canFetch(i.networkMode)?"fetching":"paused",...e===void 0&&{error:null,status:"pending"}}}function getDefaultState$1(e){const i=typeof e.initialData=="function"?e.initialData():e.initialData,s=i!==void 0,a=s?typeof e.initialDataUpdatedAt=="function"?e.initialDataUpdatedAt():e.initialDataUpdatedAt:0;return{data:i,dataUpdateCount:0,dataUpdatedAt:s?a??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:s?"success":"pending",fetchStatus:"idle"}}var qm,Q3,QueryCache=(Q3=class extends Subscribable{constructor(i={}){super();zu(this,qm);this.config=i,eu(this,qm,new Map)}build(i,s,a){const _=s.queryKey,$=s.queryHash??hashQueryKeyByOptions(_,s);let rt=this.get($);return rt||(rt=new Query({client:i,queryKey:_,queryHash:$,options:i.defaultQueryOptions(s),state:a,defaultOptions:i.getQueryDefaults(_)}),this.add(rt)),rt}add(i){Ms(this,qm).has(i.queryHash)||(Ms(this,qm).set(i.queryHash,i),this.notify({type:"added",query:i}))}remove(i){const s=Ms(this,qm).get(i.queryHash);s&&(i.destroy(),s===i&&Ms(this,qm).delete(i.queryHash),this.notify({type:"removed",query:i}))}clear(){notifyManager.batch(()=>{this.getAll().forEach(i=>{this.remove(i)})})}get(i){return Ms(this,qm).get(i)}getAll(){return[...Ms(this,qm).values()]}find(i){const s={exact:!0,...i};return this.getAll().find(a=>matchQuery(s,a))}findAll(i={}){const s=this.getAll();return Object.keys(i).length>0?s.filter(a=>matchQuery(i,a)):s}notify(i){notifyManager.batch(()=>{this.listeners.forEach(s=>{s(i)})})}onFocus(){notifyManager.batch(()=>{this.getAll().forEach(i=>{i.onFocus()})})}onOnline(){notifyManager.batch(()=>{this.getAll().forEach(i=>{i.onOnline()})})}},qm=new WeakMap,Q3),Xm,f0,Z1,Km,i1,J3,Mutation=(J3=class extends Removable{constructor(i){super();zu(this,Km);zu(this,Xm);zu(this,f0);zu(this,Z1);this.mutationId=i.mutationId,eu(this,f0,i.mutationCache),eu(this,Xm,[]),this.state=i.state||getDefaultState(),this.setOptions(i.options),this.scheduleGc()}setOptions(i){this.options=i,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(i){Ms(this,Xm).includes(i)||(Ms(this,Xm).push(i),this.clearGcTimeout(),Ms(this,f0).notify({type:"observerAdded",mutation:this,observer:i}))}removeObserver(i){eu(this,Xm,Ms(this,Xm).filter(s=>s!==i)),this.scheduleGc(),Ms(this,f0).notify({type:"observerRemoved",mutation:this,observer:i})}optionalRemove(){Ms(this,Xm).length||(this.state.status==="pending"?this.scheduleGc():Ms(this,f0).remove(this))}continue(){var i;return((i=Ms(this,Z1))==null?void 0:i.continue())??this.execute(this.state.variables)}async execute(i){var $,rt,c,dt,ht,Et,St,At,Pt,Vt,Bt,Zt,zt,Ut,Nt,Gt,er,ir,or,mr;const s=()=>{Jp(this,Km,i1).call(this,{type:"continue"})};eu(this,Z1,createRetryer({fn:()=>this.options.mutationFn?this.options.mutationFn(i):Promise.reject(new Error("No mutationFn found")),onFail:(Rr,on)=>{Jp(this,Km,i1).call(this,{type:"failed",failureCount:Rr,error:on})},onPause:()=>{Jp(this,Km,i1).call(this,{type:"pause"})},onContinue:s,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>Ms(this,f0).canRun(this)}));const a=this.state.status==="pending",_=!Ms(this,Z1).canStart();try{if(a)s();else{Jp(this,Km,i1).call(this,{type:"pending",variables:i,isPaused:_}),await((rt=($=Ms(this,f0).config).onMutate)==null?void 0:rt.call($,i,this));const on=await((dt=(c=this.options).onMutate)==null?void 0:dt.call(c,i));on!==this.state.context&&Jp(this,Km,i1).call(this,{type:"pending",context:on,variables:i,isPaused:_})}const Rr=await Ms(this,Z1).start();return await((Et=(ht=Ms(this,f0).config).onSuccess)==null?void 0:Et.call(ht,Rr,i,this.state.context,this)),await((At=(St=this.options).onSuccess)==null?void 0:At.call(St,Rr,i,this.state.context)),await((Vt=(Pt=Ms(this,f0).config).onSettled)==null?void 0:Vt.call(Pt,Rr,null,this.state.variables,this.state.context,this)),await((Zt=(Bt=this.options).onSettled)==null?void 0:Zt.call(Bt,Rr,null,i,this.state.context)),Jp(this,Km,i1).call(this,{type:"success",data:Rr}),Rr}catch(Rr){try{throw await((Ut=(zt=Ms(this,f0).config).onError)==null?void 0:Ut.call(zt,Rr,i,this.state.context,this)),await((Gt=(Nt=this.options).onError)==null?void 0:Gt.call(Nt,Rr,i,this.state.context)),await((ir=(er=Ms(this,f0).config).onSettled)==null?void 0:ir.call(er,void 0,Rr,this.state.variables,this.state.context,this)),await((mr=(or=this.options).onSettled)==null?void 0:mr.call(or,void 0,Rr,i,this.state.context)),Rr}finally{Jp(this,Km,i1).call(this,{type:"error",error:Rr})}}finally{Ms(this,f0).runNext(this)}}},Xm=new WeakMap,f0=new WeakMap,Z1=new WeakMap,Km=new WeakSet,i1=function(i){const s=a=>{switch(i.type){case"failed":return{...a,failureCount:i.failureCount,failureReason:i.error};case"pause":return{...a,isPaused:!0};case"continue":return{...a,isPaused:!1};case"pending":return{...a,context:i.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:i.isPaused,status:"pending",variables:i.variables,submittedAt:Date.now()};case"success":return{...a,data:i.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...a,data:void 0,error:i.error,failureCount:a.failureCount+1,failureReason:i.error,isPaused:!1,status:"error"}}};this.state=s(this.state),notifyManager.batch(()=>{Ms(this,Xm).forEach(a=>{a.onMutationUpdate(i)}),Ms(this,f0).notify({mutation:this,type:"updated",action:i})})},J3);function getDefaultState(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var Ex,Cm,mE,eR,MutationCache=(eR=class extends Subscribable{constructor(i={}){super();zu(this,Ex);zu(this,Cm);zu(this,mE);this.config=i,eu(this,Ex,new Set),eu(this,Cm,new Map),eu(this,mE,0)}build(i,s,a){const _=new Mutation({mutationCache:this,mutationId:++t2(this,mE)._,options:i.defaultMutationOptions(s),state:a});return this.add(_),_}add(i){Ms(this,Ex).add(i);const s=scopeFor(i);if(typeof s=="string"){const a=Ms(this,Cm).get(s);a?a.push(i):Ms(this,Cm).set(s,[i])}this.notify({type:"added",mutation:i})}remove(i){if(Ms(this,Ex).delete(i)){const s=scopeFor(i);if(typeof s=="string"){const a=Ms(this,Cm).get(s);if(a)if(a.length>1){const _=a.indexOf(i);_!==-1&&a.splice(_,1)}else a[0]===i&&Ms(this,Cm).delete(s)}}this.notify({type:"removed",mutation:i})}canRun(i){const s=scopeFor(i);if(typeof s=="string"){const a=Ms(this,Cm).get(s),_=a==null?void 0:a.find($=>$.state.status==="pending");return!_||_===i}else return!0}runNext(i){var a;const s=scopeFor(i);if(typeof s=="string"){const _=(a=Ms(this,Cm).get(s))==null?void 0:a.find($=>$!==i&&$.state.isPaused);return(_==null?void 0:_.continue())??Promise.resolve()}else return Promise.resolve()}clear(){notifyManager.batch(()=>{Ms(this,Ex).forEach(i=>{this.notify({type:"removed",mutation:i})}),Ms(this,Ex).clear(),Ms(this,Cm).clear()})}getAll(){return Array.from(Ms(this,Ex))}find(i){const s={exact:!0,...i};return this.getAll().find(a=>matchMutation(s,a))}findAll(i={}){return this.getAll().filter(s=>matchMutation(i,s))}notify(i){notifyManager.batch(()=>{this.listeners.forEach(s=>{s(i)})})}resumePausedMutations(){const i=this.getAll().filter(s=>s.state.isPaused);return notifyManager.batch(()=>Promise.all(i.map(s=>s.continue().catch(noop$2))))}},Ex=new WeakMap,Cm=new WeakMap,mE=new WeakMap,eR);function scopeFor(e){var i;return(i=e.options.scope)==null?void 0:i.id}function infiniteQueryBehavior(e){return{onFetch:(i,s)=>{var Et,St,At,Pt,Vt;const a=i.options,_=(At=(St=(Et=i.fetchOptions)==null?void 0:Et.meta)==null?void 0:St.fetchMore)==null?void 0:At.direction,$=((Pt=i.state.data)==null?void 0:Pt.pages)||[],rt=((Vt=i.state.data)==null?void 0:Vt.pageParams)||[];let c={pages:[],pageParams:[]},dt=0;const ht=async()=>{let Bt=!1;const Zt=Nt=>{Object.defineProperty(Nt,"signal",{enumerable:!0,get:()=>(i.signal.aborted?Bt=!0:i.signal.addEventListener("abort",()=>{Bt=!0}),i.signal)})},zt=ensureQueryFn(i.options,i.fetchOptions),Ut=async(Nt,Gt,er)=>{if(Bt)return Promise.reject();if(Gt==null&&Nt.pages.length)return Promise.resolve(Nt);const or=(()=>{const un={client:i.client,queryKey:i.queryKey,pageParam:Gt,direction:er?"backward":"forward",meta:i.options.meta};return Zt(un),un})(),mr=await zt(or),{maxPages:Rr}=i.options,on=er?addToStart:addToEnd;return{pages:on(Nt.pages,mr,Rr),pageParams:on(Nt.pageParams,Gt,Rr)}};if(_&&$.length){const Nt=_==="backward",Gt=Nt?getPreviousPageParam:getNextPageParam,er={pages:$,pageParams:rt},ir=Gt(a,er);c=await Ut(er,ir,Nt)}else{const Nt=e??$.length;do{const Gt=dt===0?rt[0]??a.initialPageParam:getNextPageParam(a,c);if(dt>0&&Gt==null)break;c=await Ut(c,Gt),dt++}while(dt<Nt)}return c};i.options.persister?i.fetchFn=()=>{var Bt,Zt;return(Zt=(Bt=i.options).persister)==null?void 0:Zt.call(Bt,ht,{client:i.client,queryKey:i.queryKey,meta:i.options.meta,signal:i.signal},s)}:i.fetchFn=ht}}}function getNextPageParam(e,{pages:i,pageParams:s}){const a=i.length-1;return i.length>0?e.getNextPageParam(i[a],i,s[a],s):void 0}function getPreviousPageParam(e,{pages:i,pageParams:s}){var a;return i.length>0?(a=e.getPreviousPageParam)==null?void 0:a.call(e,i[0],i,s[0],s):void 0}var gp,a1,l1,T_,R_,c1,I_,D_,tR,QueryClient=(tR=class{constructor(e={}){zu(this,gp);zu(this,a1);zu(this,l1);zu(this,T_);zu(this,R_);zu(this,c1);zu(this,I_);zu(this,D_);eu(this,gp,e.queryCache||new QueryCache),eu(this,a1,e.mutationCache||new MutationCache),eu(this,l1,e.defaultOptions||{}),eu(this,T_,new Map),eu(this,R_,new Map),eu(this,c1,0)}mount(){t2(this,c1)._++,Ms(this,c1)===1&&(eu(this,I_,focusManager.subscribe(async e=>{e&&(await this.resumePausedMutations(),Ms(this,gp).onFocus())})),eu(this,D_,onlineManager.subscribe(async e=>{e&&(await this.resumePausedMutations(),Ms(this,gp).onOnline())})))}unmount(){var e,i;t2(this,c1)._--,Ms(this,c1)===0&&((e=Ms(this,I_))==null||e.call(this),eu(this,I_,void 0),(i=Ms(this,D_))==null||i.call(this),eu(this,D_,void 0))}isFetching(e){return Ms(this,gp).findAll({...e,fetchStatus:"fetching"}).length}isMutating(e){return Ms(this,a1).findAll({...e,status:"pending"}).length}getQueryData(e){var s;const i=this.defaultQueryOptions({queryKey:e});return(s=Ms(this,gp).get(i.queryHash))==null?void 0:s.state.data}ensureQueryData(e){const i=this.defaultQueryOptions(e),s=Ms(this,gp).build(this,i),a=s.state.data;return a===void 0?this.fetchQuery(e):(e.revalidateIfStale&&s.isStaleByTime(resolveStaleTime(i.staleTime,s))&&this.prefetchQuery(i),Promise.resolve(a))}getQueriesData(e){return Ms(this,gp).findAll(e).map(({queryKey:i,state:s})=>{const a=s.data;return[i,a]})}setQueryData(e,i,s){const a=this.defaultQueryOptions({queryKey:e}),_=Ms(this,gp).get(a.queryHash),$=_==null?void 0:_.state.data,rt=functionalUpdate(i,$);if(rt!==void 0)return Ms(this,gp).build(this,a).setData(rt,{...s,manual:!0})}setQueriesData(e,i,s){return notifyManager.batch(()=>Ms(this,gp).findAll(e).map(({queryKey:a})=>[a,this.setQueryData(a,i,s)]))}getQueryState(e){var s;const i=this.defaultQueryOptions({queryKey:e});return(s=Ms(this,gp).get(i.queryHash))==null?void 0:s.state}removeQueries(e){const i=Ms(this,gp);notifyManager.batch(()=>{i.findAll(e).forEach(s=>{i.remove(s)})})}resetQueries(e,i){const s=Ms(this,gp);return notifyManager.batch(()=>(s.findAll(e).forEach(a=>{a.reset()}),this.refetchQueries({type:"active",...e},i)))}cancelQueries(e,i={}){const s={revert:!0,...i},a=notifyManager.batch(()=>Ms(this,gp).findAll(e).map(_=>_.cancel(s)));return Promise.all(a).then(noop$2).catch(noop$2)}invalidateQueries(e,i={}){return notifyManager.batch(()=>(Ms(this,gp).findAll(e).forEach(s=>{s.invalidate()}),(e==null?void 0:e.refetchType)==="none"?Promise.resolve():this.refetchQueries({...e,type:(e==null?void 0:e.refetchType)??(e==null?void 0:e.type)??"active"},i)))}refetchQueries(e,i={}){const s={...i,cancelRefetch:i.cancelRefetch??!0},a=notifyManager.batch(()=>Ms(this,gp).findAll(e).filter(_=>!_.isDisabled()&&!_.isStatic()).map(_=>{let $=_.fetch(void 0,s);return s.throwOnError||($=$.catch(noop$2)),_.state.fetchStatus==="paused"?Promise.resolve():$}));return Promise.all(a).then(noop$2)}fetchQuery(e){const i=this.defaultQueryOptions(e);i.retry===void 0&&(i.retry=!1);const s=Ms(this,gp).build(this,i);return s.isStaleByTime(resolveStaleTime(i.staleTime,s))?s.fetch(i):Promise.resolve(s.state.data)}prefetchQuery(e){return this.fetchQuery(e).then(noop$2).catch(noop$2)}fetchInfiniteQuery(e){return e.behavior=infiniteQueryBehavior(e.pages),this.fetchQuery(e)}prefetchInfiniteQuery(e){return this.fetchInfiniteQuery(e).then(noop$2).catch(noop$2)}ensureInfiniteQueryData(e){return e.behavior=infiniteQueryBehavior(e.pages),this.ensureQueryData(e)}resumePausedMutations(){return onlineManager.isOnline()?Ms(this,a1).resumePausedMutations():Promise.resolve()}getQueryCache(){return Ms(this,gp)}getMutationCache(){return Ms(this,a1)}getDefaultOptions(){return Ms(this,l1)}setDefaultOptions(e){eu(this,l1,e)}setQueryDefaults(e,i){Ms(this,T_).set(hashKey(e),{queryKey:e,defaultOptions:i})}getQueryDefaults(e){const i=[...Ms(this,T_).values()],s={};return i.forEach(a=>{partialMatchKey(e,a.queryKey)&&Object.assign(s,a.defaultOptions)}),s}setMutationDefaults(e,i){Ms(this,R_).set(hashKey(e),{mutationKey:e,defaultOptions:i})}getMutationDefaults(e){const i=[...Ms(this,R_).values()],s={};return i.forEach(a=>{partialMatchKey(e,a.mutationKey)&&Object.assign(s,a.defaultOptions)}),s}defaultQueryOptions(e){if(e._defaulted)return e;const i={...Ms(this,l1).queries,...this.getQueryDefaults(e.queryKey),...e,_defaulted:!0};return i.queryHash||(i.queryHash=hashQueryKeyByOptions(i.queryKey,i)),i.refetchOnReconnect===void 0&&(i.refetchOnReconnect=i.networkMode!=="always"),i.throwOnError===void 0&&(i.throwOnError=!!i.suspense),!i.networkMode&&i.persister&&(i.networkMode="offlineFirst"),i.queryFn===skipToken&&(i.enabled=!1),i}defaultMutationOptions(e){return e!=null&&e._defaulted?e:{...Ms(this,l1).mutations,...(e==null?void 0:e.mutationKey)&&this.getMutationDefaults(e.mutationKey),...e,_defaulted:!0}}clear(){Ms(this,gp).clear(),Ms(this,a1).clear()}},gp=new WeakMap,a1=new WeakMap,l1=new WeakMap,T_=new WeakMap,R_=new WeakMap,c1=new WeakMap,I_=new WeakMap,D_=new WeakMap,tR),QueryClientContext=reactExports.createContext(void 0),QueryClientProvider=({client:e,children:i})=>(reactExports.useEffect(()=>(e.mount(),()=>{e.unmount()}),[e]),jsxRuntimeExports.jsx(QueryClientContext.Provider,{value:e,children:i}));/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function _extends$2(){return _extends$2=Object.assign?Object.assign.bind():function(e){for(var i=1;i<arguments.length;i++){var s=arguments[i];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e},_extends$2.apply(this,arguments)}var Action$1;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(Action$1||(Action$1={}));const PopStateEventType="popstate";function createBrowserHistory(e){e===void 0&&(e={});function i(a,_){let{pathname:$,search:rt,hash:c}=a.location;return createLocation("",{pathname:$,search:rt,hash:c},_.state&&_.state.usr||null,_.state&&_.state.key||"default")}function s(a,_){return typeof _=="string"?_:createPath(_)}return getUrlBasedHistory(i,s,null,e)}function invariant$1(e,i){if(e===!1||e===null||typeof e>"u")throw new Error(i)}function warning$1(e,i){if(!e){typeof console<"u"&&console.warn(i);try{throw new Error(i)}catch{}}}function createKey(){return Math.random().toString(36).substr(2,8)}function getHistoryState(e,i){return{usr:e.state,key:e.key,idx:i}}function createLocation(e,i,s,a){return s===void 0&&(s=null),_extends$2({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof i=="string"?parsePath(i):i,{state:s,key:i&&i.key||a||createKey()})}function createPath(e){let{pathname:i="/",search:s="",hash:a=""}=e;return s&&s!=="?"&&(i+=s.charAt(0)==="?"?s:"?"+s),a&&a!=="#"&&(i+=a.charAt(0)==="#"?a:"#"+a),i}function parsePath(e){let i={};if(e){let s=e.indexOf("#");s>=0&&(i.hash=e.substr(s),e=e.substr(0,s));let a=e.indexOf("?");a>=0&&(i.search=e.substr(a),e=e.substr(0,a)),e&&(i.pathname=e)}return i}function getUrlBasedHistory(e,i,s,a){a===void 0&&(a={});let{window:_=document.defaultView,v5Compat:$=!1}=a,rt=_.history,c=Action$1.Pop,dt=null,ht=Et();ht==null&&(ht=0,rt.replaceState(_extends$2({},rt.state,{idx:ht}),""));function Et(){return(rt.state||{idx:null}).idx}function St(){c=Action$1.Pop;let Zt=Et(),zt=Zt==null?null:Zt-ht;ht=Zt,dt&&dt({action:c,location:Bt.location,delta:zt})}function At(Zt,zt){c=Action$1.Push;let Ut=createLocation(Bt.location,Zt,zt);ht=Et()+1;let Nt=getHistoryState(Ut,ht),Gt=Bt.createHref(Ut);try{rt.pushState(Nt,"",Gt)}catch(er){if(er instanceof DOMException&&er.name==="DataCloneError")throw er;_.location.assign(Gt)}$&&dt&&dt({action:c,location:Bt.location,delta:1})}function Pt(Zt,zt){c=Action$1.Replace;let Ut=createLocation(Bt.location,Zt,zt);ht=Et();let Nt=getHistoryState(Ut,ht),Gt=Bt.createHref(Ut);rt.replaceState(Nt,"",Gt),$&&dt&&dt({action:c,location:Bt.location,delta:0})}function Vt(Zt){let zt=_.location.origin!=="null"?_.location.origin:_.location.href,Ut=typeof Zt=="string"?Zt:createPath(Zt);return Ut=Ut.replace(/ $/,"%20"),invariant$1(zt,"No window.location.(origin|href) available to create URL for href: "+Ut),new URL(Ut,zt)}let Bt={get action(){return c},get location(){return e(_,rt)},listen(Zt){if(dt)throw new Error("A history only accepts one active listener");return _.addEventListener(PopStateEventType,St),dt=Zt,()=>{_.removeEventListener(PopStateEventType,St),dt=null}},createHref(Zt){return i(_,Zt)},createURL:Vt,encodeLocation(Zt){let zt=Vt(Zt);return{pathname:zt.pathname,search:zt.search,hash:zt.hash}},push:At,replace:Pt,go(Zt){return rt.go(Zt)}};return Bt}var ResultType;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(ResultType||(ResultType={}));function matchRoutes(e,i,s){return s===void 0&&(s="/"),matchRoutesImpl(e,i,s,!1)}function matchRoutesImpl(e,i,s,a){let _=typeof i=="string"?parsePath(i):i,$=stripBasename(_.pathname||"/",s);if($==null)return null;let rt=flattenRoutes(e);rankRouteBranches(rt);let c=null;for(let dt=0;c==null&&dt<rt.length;++dt){let ht=decodePath$1($);c=matchRouteBranch(rt[dt],ht,a)}return c}function flattenRoutes(e,i,s,a){i===void 0&&(i=[]),s===void 0&&(s=[]),a===void 0&&(a="");let _=($,rt,c)=>{let dt={relativePath:c===void 0?$.path||"":c,caseSensitive:$.caseSensitive===!0,childrenIndex:rt,route:$};dt.relativePath.startsWith("/")&&(invariant$1(dt.relativePath.startsWith(a),'Absolute route path "'+dt.relativePath+'" nested under path '+('"'+a+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),dt.relativePath=dt.relativePath.slice(a.length));let ht=joinPaths([a,dt.relativePath]),Et=s.concat(dt);$.children&&$.children.length>0&&(invariant$1($.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+ht+'".')),flattenRoutes($.children,i,Et,ht)),!($.path==null&&!$.index)&&i.push({path:ht,score:computeScore(ht,$.index),routesMeta:Et})};return e.forEach(($,rt)=>{var c;if($.path===""||!((c=$.path)!=null&&c.includes("?")))_($,rt);else for(let dt of explodeOptionalSegments($.path))_($,rt,dt)}),i}function explodeOptionalSegments(e){let i=e.split("/");if(i.length===0)return[];let[s,...a]=i,_=s.endsWith("?"),$=s.replace(/\?$/,"");if(a.length===0)return _?[$,""]:[$];let rt=explodeOptionalSegments(a.join("/")),c=[];return c.push(...rt.map(dt=>dt===""?$:[$,dt].join("/"))),_&&c.push(...rt),c.map(dt=>e.startsWith("/")&&dt===""?"/":dt)}function rankRouteBranches(e){e.sort((i,s)=>i.score!==s.score?s.score-i.score:compareIndexes(i.routesMeta.map(a=>a.childrenIndex),s.routesMeta.map(a=>a.childrenIndex)))}const paramRe=/^:[\w-]+$/,dynamicSegmentValue=3,indexRouteValue=2,emptySegmentValue=1,staticSegmentValue=10,splatPenalty=-2,isSplat=e=>e==="*";function computeScore(e,i){let s=e.split("/"),a=s.length;return s.some(isSplat)&&(a+=splatPenalty),i&&(a+=indexRouteValue),s.filter(_=>!isSplat(_)).reduce((_,$)=>_+(paramRe.test($)?dynamicSegmentValue:$===""?emptySegmentValue:staticSegmentValue),a)}function compareIndexes(e,i){return e.length===i.length&&e.slice(0,-1).every((a,_)=>a===i[_])?e[e.length-1]-i[i.length-1]:0}function matchRouteBranch(e,i,s){let{routesMeta:a}=e,_={},$="/",rt=[];for(let c=0;c<a.length;++c){let dt=a[c],ht=c===a.length-1,Et=$==="/"?i:i.slice($.length)||"/",St=matchPath({path:dt.relativePath,caseSensitive:dt.caseSensitive,end:ht},Et),At=dt.route;if(!St&&ht&&s&&!a[a.length-1].route.index&&(St=matchPath({path:dt.relativePath,caseSensitive:dt.caseSensitive,end:!1},Et)),!St)return null;Object.assign(_,St.params),rt.push({params:_,pathname:joinPaths([$,St.pathname]),pathnameBase:normalizePathname(joinPaths([$,St.pathnameBase])),route:At}),St.pathnameBase!=="/"&&($=joinPaths([$,St.pathnameBase]))}return rt}function matchPath(e,i){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[s,a]=compilePath(e.path,e.caseSensitive,e.end),_=i.match(s);if(!_)return null;let $=_[0],rt=$.replace(/(.)\/+$/,"$1"),c=_.slice(1);return{params:a.reduce((ht,Et,St)=>{let{paramName:At,isOptional:Pt}=Et;if(At==="*"){let Bt=c[St]||"";rt=$.slice(0,$.length-Bt.length).replace(/(.)\/+$/,"$1")}const Vt=c[St];return Pt&&!Vt?ht[At]=void 0:ht[At]=(Vt||"").replace(/%2F/g,"/"),ht},{}),pathname:$,pathnameBase:rt,pattern:e}}function compilePath(e,i,s){i===void 0&&(i=!1),s===void 0&&(s=!0),warning$1(e==="*"||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were '+('"'+e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+e.replace(/\*$/,"/*")+'".'));let a=[],_="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(rt,c,dt)=>(a.push({paramName:c,isOptional:dt!=null}),dt?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(a.push({paramName:"*"}),_+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):s?_+="\\/*$":e!==""&&e!=="/"&&(_+="(?:(?=\\/|$))"),[new RegExp(_,i?void 0:"i"),a]}function decodePath$1(e){try{return e.split("/").map(i=>decodeURIComponent(i).replace(/\//g,"%2F")).join("/")}catch(i){return warning$1(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+i+").")),e}}function stripBasename(e,i){if(i==="/")return e;if(!e.toLowerCase().startsWith(i.toLowerCase()))return null;let s=i.endsWith("/")?i.length-1:i.length,a=e.charAt(s);return a&&a!=="/"?null:e.slice(s)||"/"}function resolvePath(e,i){i===void 0&&(i="/");let{pathname:s,search:a="",hash:_=""}=typeof e=="string"?parsePath(e):e;return{pathname:s?s.startsWith("/")?s:resolvePathname(s,i):i,search:normalizeSearch(a),hash:normalizeHash(_)}}function resolvePathname(e,i){let s=i.replace(/\/+$/,"").split("/");return e.split("/").forEach(_=>{_===".."?s.length>1&&s.pop():_!=="."&&s.push(_)}),s.length>1?s.join("/"):"/"}function getInvalidPathError(e,i,s,a){return"Cannot include a '"+e+"' character in a manually specified "+("`to."+i+"` field ["+JSON.stringify(a)+"].  Please separate it out to the ")+("`to."+s+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function getPathContributingMatches(e){return e.filter((i,s)=>s===0||i.route.path&&i.route.path.length>0)}function getResolveToMatches(e,i){let s=getPathContributingMatches(e);return i?s.map((a,_)=>_===s.length-1?a.pathname:a.pathnameBase):s.map(a=>a.pathnameBase)}function resolveTo(e,i,s,a){a===void 0&&(a=!1);let _;typeof e=="string"?_=parsePath(e):(_=_extends$2({},e),invariant$1(!_.pathname||!_.pathname.includes("?"),getInvalidPathError("?","pathname","search",_)),invariant$1(!_.pathname||!_.pathname.includes("#"),getInvalidPathError("#","pathname","hash",_)),invariant$1(!_.search||!_.search.includes("#"),getInvalidPathError("#","search","hash",_)));let $=e===""||_.pathname==="",rt=$?"/":_.pathname,c;if(rt==null)c=s;else{let St=i.length-1;if(!a&&rt.startsWith("..")){let At=rt.split("/");for(;At[0]==="..";)At.shift(),St-=1;_.pathname=At.join("/")}c=St>=0?i[St]:"/"}let dt=resolvePath(_,c),ht=rt&&rt!=="/"&&rt.endsWith("/"),Et=($||rt===".")&&s.endsWith("/");return!dt.pathname.endsWith("/")&&(ht||Et)&&(dt.pathname+="/"),dt}const joinPaths=e=>e.join("/").replace(/\/\/+/g,"/"),normalizePathname=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),normalizeSearch=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,normalizeHash=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;function isRouteErrorResponse(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}const validMutationMethodsArr=["post","put","patch","delete"];new Set(validMutationMethodsArr);const validRequestMethodsArr=["get",...validMutationMethodsArr];new Set(validRequestMethodsArr);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function _extends$1(){return _extends$1=Object.assign?Object.assign.bind():function(e){for(var i=1;i<arguments.length;i++){var s=arguments[i];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e},_extends$1.apply(this,arguments)}const DataRouterContext=reactExports.createContext(null),DataRouterStateContext=reactExports.createContext(null),NavigationContext=reactExports.createContext(null),LocationContext$1=reactExports.createContext(null),RouteContext=reactExports.createContext({outlet:null,matches:[],isDataRoute:!1}),RouteErrorContext=reactExports.createContext(null);function useHref(e,i){let{relative:s}=i===void 0?{}:i;useInRouterContext()||invariant$1(!1);let{basename:a,navigator:_}=reactExports.useContext(NavigationContext),{hash:$,pathname:rt,search:c}=useResolvedPath(e,{relative:s}),dt=rt;return a!=="/"&&(dt=rt==="/"?a:joinPaths([a,rt])),_.createHref({pathname:dt,search:c,hash:$})}function useInRouterContext(){return reactExports.useContext(LocationContext$1)!=null}function useLocation(){return useInRouterContext()||invariant$1(!1),reactExports.useContext(LocationContext$1).location}function useIsomorphicLayoutEffect$2(e){reactExports.useContext(NavigationContext).static||reactExports.useLayoutEffect(e)}function useNavigate(){let{isDataRoute:e}=reactExports.useContext(RouteContext);return e?useNavigateStable():useNavigateUnstable()}function useNavigateUnstable(){useInRouterContext()||invariant$1(!1);let e=reactExports.useContext(DataRouterContext),{basename:i,future:s,navigator:a}=reactExports.useContext(NavigationContext),{matches:_}=reactExports.useContext(RouteContext),{pathname:$}=useLocation(),rt=JSON.stringify(getResolveToMatches(_,s.v7_relativeSplatPath)),c=reactExports.useRef(!1);return useIsomorphicLayoutEffect$2(()=>{c.current=!0}),reactExports.useCallback(function(ht,Et){if(Et===void 0&&(Et={}),!c.current)return;if(typeof ht=="number"){a.go(ht);return}let St=resolveTo(ht,JSON.parse(rt),$,Et.relative==="path");e==null&&i!=="/"&&(St.pathname=St.pathname==="/"?i:joinPaths([i,St.pathname])),(Et.replace?a.replace:a.push)(St,Et.state,Et)},[i,a,rt,$,e])}function useParams(){let{matches:e}=reactExports.useContext(RouteContext),i=e[e.length-1];return i?i.params:{}}function useResolvedPath(e,i){let{relative:s}=i===void 0?{}:i,{future:a}=reactExports.useContext(NavigationContext),{matches:_}=reactExports.useContext(RouteContext),{pathname:$}=useLocation(),rt=JSON.stringify(getResolveToMatches(_,a.v7_relativeSplatPath));return reactExports.useMemo(()=>resolveTo(e,JSON.parse(rt),$,s==="path"),[e,rt,$,s])}function useRoutes(e,i){return useRoutesImpl(e,i)}function useRoutesImpl(e,i,s,a){useInRouterContext()||invariant$1(!1);let{navigator:_}=reactExports.useContext(NavigationContext),{matches:$}=reactExports.useContext(RouteContext),rt=$[$.length-1],c=rt?rt.params:{};rt&&rt.pathname;let dt=rt?rt.pathnameBase:"/";rt&&rt.route;let ht=useLocation(),Et;if(i){var St;let Zt=typeof i=="string"?parsePath(i):i;dt==="/"||(St=Zt.pathname)!=null&&St.startsWith(dt)||invariant$1(!1),Et=Zt}else Et=ht;let At=Et.pathname||"/",Pt=At;if(dt!=="/"){let Zt=dt.replace(/^\//,"").split("/");Pt="/"+At.replace(/^\//,"").split("/").slice(Zt.length).join("/")}let Vt=matchRoutes(e,{pathname:Pt}),Bt=_renderMatches(Vt&&Vt.map(Zt=>Object.assign({},Zt,{params:Object.assign({},c,Zt.params),pathname:joinPaths([dt,_.encodeLocation?_.encodeLocation(Zt.pathname).pathname:Zt.pathname]),pathnameBase:Zt.pathnameBase==="/"?dt:joinPaths([dt,_.encodeLocation?_.encodeLocation(Zt.pathnameBase).pathname:Zt.pathnameBase])})),$,s,a);return i&&Bt?reactExports.createElement(LocationContext$1.Provider,{value:{location:_extends$1({pathname:"/",search:"",hash:"",state:null,key:"default"},Et),navigationType:Action$1.Pop}},Bt):Bt}function DefaultErrorComponent(){let e=useRouteError(),i=isRouteErrorResponse(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),s=e instanceof Error?e.stack:null,_={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return reactExports.createElement(reactExports.Fragment,null,reactExports.createElement("h2",null,"Unexpected Application Error!"),reactExports.createElement("h3",{style:{fontStyle:"italic"}},i),s?reactExports.createElement("pre",{style:_},s):null,null)}const defaultErrorElement=reactExports.createElement(DefaultErrorComponent,null);class RenderErrorBoundary extends reactExports.Component{constructor(i){super(i),this.state={location:i.location,revalidation:i.revalidation,error:i.error}}static getDerivedStateFromError(i){return{error:i}}static getDerivedStateFromProps(i,s){return s.location!==i.location||s.revalidation!=="idle"&&i.revalidation==="idle"?{error:i.error,location:i.location,revalidation:i.revalidation}:{error:i.error!==void 0?i.error:s.error,location:s.location,revalidation:i.revalidation||s.revalidation}}componentDidCatch(i,s){console.error("React Router caught the following error during render",i,s)}render(){return this.state.error!==void 0?reactExports.createElement(RouteContext.Provider,{value:this.props.routeContext},reactExports.createElement(RouteErrorContext.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function RenderedRoute(e){let{routeContext:i,match:s,children:a}=e,_=reactExports.useContext(DataRouterContext);return _&&_.static&&_.staticContext&&(s.route.errorElement||s.route.ErrorBoundary)&&(_.staticContext._deepestRenderedBoundaryId=s.route.id),reactExports.createElement(RouteContext.Provider,{value:i},a)}function _renderMatches(e,i,s,a){var _;if(i===void 0&&(i=[]),s===void 0&&(s=null),a===void 0&&(a=null),e==null){var $;if(!s)return null;if(s.errors)e=s.matches;else if(($=a)!=null&&$.v7_partialHydration&&i.length===0&&!s.initialized&&s.matches.length>0)e=s.matches;else return null}let rt=e,c=(_=s)==null?void 0:_.errors;if(c!=null){let Et=rt.findIndex(St=>St.route.id&&(c==null?void 0:c[St.route.id])!==void 0);Et>=0||invariant$1(!1),rt=rt.slice(0,Math.min(rt.length,Et+1))}let dt=!1,ht=-1;if(s&&a&&a.v7_partialHydration)for(let Et=0;Et<rt.length;Et++){let St=rt[Et];if((St.route.HydrateFallback||St.route.hydrateFallbackElement)&&(ht=Et),St.route.id){let{loaderData:At,errors:Pt}=s,Vt=St.route.loader&&At[St.route.id]===void 0&&(!Pt||Pt[St.route.id]===void 0);if(St.route.lazy||Vt){dt=!0,ht>=0?rt=rt.slice(0,ht+1):rt=[rt[0]];break}}}return rt.reduceRight((Et,St,At)=>{let Pt,Vt=!1,Bt=null,Zt=null;s&&(Pt=c&&St.route.id?c[St.route.id]:void 0,Bt=St.route.errorElement||defaultErrorElement,dt&&(ht<0&&At===0?(Vt=!0,Zt=null):ht===At&&(Vt=!0,Zt=St.route.hydrateFallbackElement||null)));let zt=i.concat(rt.slice(0,At+1)),Ut=()=>{let Nt;return Pt?Nt=Bt:Vt?Nt=Zt:St.route.Component?Nt=reactExports.createElement(St.route.Component,null):St.route.element?Nt=St.route.element:Nt=Et,reactExports.createElement(RenderedRoute,{match:St,routeContext:{outlet:Et,matches:zt,isDataRoute:s!=null},children:Nt})};return s&&(St.route.ErrorBoundary||St.route.errorElement||At===0)?reactExports.createElement(RenderErrorBoundary,{location:s.location,revalidation:s.revalidation,component:Bt,error:Pt,children:Ut(),routeContext:{outlet:null,matches:zt,isDataRoute:!0}}):Ut()},null)}var DataRouterHook$1=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(DataRouterHook$1||{}),DataRouterStateHook$1=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(DataRouterStateHook$1||{});function useDataRouterContext(e){let i=reactExports.useContext(DataRouterContext);return i||invariant$1(!1),i}function useDataRouterState(e){let i=reactExports.useContext(DataRouterStateContext);return i||invariant$1(!1),i}function useRouteContext(e){let i=reactExports.useContext(RouteContext);return i||invariant$1(!1),i}function useCurrentRouteId(e){let i=useRouteContext(),s=i.matches[i.matches.length-1];return s.route.id||invariant$1(!1),s.route.id}function useRouteError(){var e;let i=reactExports.useContext(RouteErrorContext),s=useDataRouterState(DataRouterStateHook$1.UseRouteError),a=useCurrentRouteId(DataRouterStateHook$1.UseRouteError);return i!==void 0?i:(e=s.errors)==null?void 0:e[a]}function useNavigateStable(){let{router:e}=useDataRouterContext(DataRouterHook$1.UseNavigateStable),i=useCurrentRouteId(DataRouterStateHook$1.UseNavigateStable),s=reactExports.useRef(!1);return useIsomorphicLayoutEffect$2(()=>{s.current=!0}),reactExports.useCallback(function(_,$){$===void 0&&($={}),s.current&&(typeof _=="number"?e.navigate(_):e.navigate(_,_extends$1({fromRouteId:i},$)))},[e,i])}function logV6DeprecationWarnings(e,i){e==null||e.v7_startTransition,e==null||e.v7_relativeSplatPath}function Navigate(e){let{to:i,replace:s,state:a,relative:_}=e;useInRouterContext()||invariant$1(!1);let{future:$,static:rt}=reactExports.useContext(NavigationContext),{matches:c}=reactExports.useContext(RouteContext),{pathname:dt}=useLocation(),ht=useNavigate(),Et=resolveTo(i,getResolveToMatches(c,$.v7_relativeSplatPath),dt,_==="path"),St=JSON.stringify(Et);return reactExports.useEffect(()=>ht(JSON.parse(St),{replace:s,state:a,relative:_}),[ht,St,_,s,a]),null}function Route(e){invariant$1(!1)}function Router(e){let{basename:i="/",children:s=null,location:a,navigationType:_=Action$1.Pop,navigator:$,static:rt=!1,future:c}=e;useInRouterContext()&&invariant$1(!1);let dt=i.replace(/^\/*/,"/"),ht=reactExports.useMemo(()=>({basename:dt,navigator:$,static:rt,future:_extends$1({v7_relativeSplatPath:!1},c)}),[dt,c,$,rt]);typeof a=="string"&&(a=parsePath(a));let{pathname:Et="/",search:St="",hash:At="",state:Pt=null,key:Vt="default"}=a,Bt=reactExports.useMemo(()=>{let Zt=stripBasename(Et,dt);return Zt==null?null:{location:{pathname:Zt,search:St,hash:At,state:Pt,key:Vt},navigationType:_}},[dt,Et,St,At,Pt,Vt,_]);return Bt==null?null:reactExports.createElement(NavigationContext.Provider,{value:ht},reactExports.createElement(LocationContext$1.Provider,{children:s,value:Bt}))}function Routes(e){let{children:i,location:s}=e;return useRoutes(createRoutesFromChildren(i),s)}new Promise(()=>{});function createRoutesFromChildren(e,i){i===void 0&&(i=[]);let s=[];return reactExports.Children.forEach(e,(a,_)=>{if(!reactExports.isValidElement(a))return;let $=[...i,_];if(a.type===reactExports.Fragment){s.push.apply(s,createRoutesFromChildren(a.props.children,$));return}a.type!==Route&&invariant$1(!1),!a.props.index||!a.props.children||invariant$1(!1);let rt={id:a.props.id||$.join("-"),caseSensitive:a.props.caseSensitive,element:a.props.element,Component:a.props.Component,index:a.props.index,path:a.props.path,loader:a.props.loader,action:a.props.action,errorElement:a.props.errorElement,ErrorBoundary:a.props.ErrorBoundary,hasErrorBoundary:a.props.ErrorBoundary!=null||a.props.errorElement!=null,shouldRevalidate:a.props.shouldRevalidate,handle:a.props.handle,lazy:a.props.lazy};a.props.children&&(rt.children=createRoutesFromChildren(a.props.children,$)),s.push(rt)}),s}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function _extends(){return _extends=Object.assign?Object.assign.bind():function(e){for(var i=1;i<arguments.length;i++){var s=arguments[i];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e},_extends.apply(this,arguments)}function _objectWithoutPropertiesLoose$1(e,i){if(e==null)return{};var s={},a=Object.keys(e),_,$;for($=0;$<a.length;$++)_=a[$],!(i.indexOf(_)>=0)&&(s[_]=e[_]);return s}function isModifiedEvent(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function shouldProcessLinkClick(e,i){return e.button===0&&(!i||i==="_self")&&!isModifiedEvent(e)}const _excluded$2=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],REACT_ROUTER_VERSION="6";try{window.__reactRouterVersion=REACT_ROUTER_VERSION}catch{}const START_TRANSITION="startTransition",startTransitionImpl=React$1[START_TRANSITION];function BrowserRouter(e){let{basename:i,children:s,future:a,window:_}=e,$=reactExports.useRef();$.current==null&&($.current=createBrowserHistory({window:_,v5Compat:!0}));let rt=$.current,[c,dt]=reactExports.useState({action:rt.action,location:rt.location}),{v7_startTransition:ht}=a||{},Et=reactExports.useCallback(St=>{ht&&startTransitionImpl?startTransitionImpl(()=>dt(St)):dt(St)},[dt,ht]);return reactExports.useLayoutEffect(()=>rt.listen(Et),[rt,Et]),reactExports.useEffect(()=>logV6DeprecationWarnings(a),[a]),reactExports.createElement(Router,{basename:i,children:s,location:c.location,navigationType:c.action,navigator:rt,future:a})}const isBrowser$1=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",ABSOLUTE_URL_REGEX=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Link=reactExports.forwardRef(function(i,s){let{onClick:a,relative:_,reloadDocument:$,replace:rt,state:c,target:dt,to:ht,preventScrollReset:Et,viewTransition:St}=i,At=_objectWithoutPropertiesLoose$1(i,_excluded$2),{basename:Pt}=reactExports.useContext(NavigationContext),Vt,Bt=!1;if(typeof ht=="string"&&ABSOLUTE_URL_REGEX.test(ht)&&(Vt=ht,isBrowser$1))try{let Nt=new URL(window.location.href),Gt=ht.startsWith("//")?new URL(Nt.protocol+ht):new URL(ht),er=stripBasename(Gt.pathname,Pt);Gt.origin===Nt.origin&&er!=null?ht=er+Gt.search+Gt.hash:Bt=!0}catch{}let Zt=useHref(ht,{relative:_}),zt=useLinkClickHandler(ht,{replace:rt,state:c,target:dt,preventScrollReset:Et,relative:_,viewTransition:St});function Ut(Nt){a&&a(Nt),Nt.defaultPrevented||zt(Nt)}return reactExports.createElement("a",_extends({},At,{href:Vt||Zt,onClick:Bt||$?a:Ut,ref:s,target:dt}))});var DataRouterHook;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(DataRouterHook||(DataRouterHook={}));var DataRouterStateHook;(function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(DataRouterStateHook||(DataRouterStateHook={}));function useLinkClickHandler(e,i){let{target:s,replace:a,state:_,preventScrollReset:$,relative:rt,viewTransition:c}=i===void 0?{}:i,dt=useNavigate(),ht=useLocation(),Et=useResolvedPath(e,{relative:rt});return reactExports.useCallback(St=>{if(shouldProcessLinkClick(St,s)){St.preventDefault();let At=a!==void 0?a:createPath(ht)===createPath(Et);dt(e,{replace:At,state:_,preventScrollReset:$,relative:rt,viewTransition:c})}},[ht,dt,Et,a,_,s,e,$,rt,c])}const getDefaultsFromPostinstall=()=>{};var define_process_env_default$1={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CONSTANTS={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const assert=function(e,i){if(!e)throw assertionError(i)},assertionError=function(e){return new Error("Firebase Database ("+CONSTANTS.SDK_VERSION+") INTERNAL ASSERT FAILED: "+e)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const stringToByteArray$1=function(e){const i=[];let s=0;for(let a=0;a<e.length;a++){let _=e.charCodeAt(a);_<128?i[s++]=_:_<2048?(i[s++]=_>>6|192,i[s++]=_&63|128):(_&64512)===55296&&a+1<e.length&&(e.charCodeAt(a+1)&64512)===56320?(_=65536+((_&1023)<<10)+(e.charCodeAt(++a)&1023),i[s++]=_>>18|240,i[s++]=_>>12&63|128,i[s++]=_>>6&63|128,i[s++]=_&63|128):(i[s++]=_>>12|224,i[s++]=_>>6&63|128,i[s++]=_&63|128)}return i},byteArrayToString=function(e){const i=[];let s=0,a=0;for(;s<e.length;){const _=e[s++];if(_<128)i[a++]=String.fromCharCode(_);else if(_>191&&_<224){const $=e[s++];i[a++]=String.fromCharCode((_&31)<<6|$&63)}else if(_>239&&_<365){const $=e[s++],rt=e[s++],c=e[s++],dt=((_&7)<<18|($&63)<<12|(rt&63)<<6|c&63)-65536;i[a++]=String.fromCharCode(55296+(dt>>10)),i[a++]=String.fromCharCode(56320+(dt&1023))}else{const $=e[s++],rt=e[s++];i[a++]=String.fromCharCode((_&15)<<12|($&63)<<6|rt&63)}}return i.join("")},base64={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(e,i){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const s=i?this.byteToCharMapWebSafe_:this.byteToCharMap_,a=[];for(let _=0;_<e.length;_+=3){const $=e[_],rt=_+1<e.length,c=rt?e[_+1]:0,dt=_+2<e.length,ht=dt?e[_+2]:0,Et=$>>2,St=($&3)<<4|c>>4;let At=(c&15)<<2|ht>>6,Pt=ht&63;dt||(Pt=64,rt||(At=64)),a.push(s[Et],s[St],s[At],s[Pt])}return a.join("")},encodeString(e,i){return this.HAS_NATIVE_SUPPORT&&!i?btoa(e):this.encodeByteArray(stringToByteArray$1(e),i)},decodeString(e,i){return this.HAS_NATIVE_SUPPORT&&!i?atob(e):byteArrayToString(this.decodeStringToByteArray(e,i))},decodeStringToByteArray(e,i){this.init_();const s=i?this.charToByteMapWebSafe_:this.charToByteMap_,a=[];for(let _=0;_<e.length;){const $=s[e.charAt(_++)],c=_<e.length?s[e.charAt(_)]:0;++_;const ht=_<e.length?s[e.charAt(_)]:64;++_;const St=_<e.length?s[e.charAt(_)]:64;if(++_,$==null||c==null||ht==null||St==null)throw new DecodeBase64StringError;const At=$<<2|c>>4;if(a.push(At),ht!==64){const Pt=c<<4&240|ht>>2;if(a.push(Pt),St!==64){const Vt=ht<<6&192|St;a.push(Vt)}}}return a},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class DecodeBase64StringError extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const base64Encode=function(e){const i=stringToByteArray$1(e);return base64.encodeByteArray(i,!0)},base64urlEncodeWithoutPadding=function(e){return base64Encode(e).replace(/\./g,"")},base64Decode=function(e){try{return base64.decodeString(e,!0)}catch(i){console.error("base64Decode failed: ",i)}return null};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function deepCopy(e){return deepExtend(void 0,e)}function deepExtend(e,i){if(!(i instanceof Object))return i;switch(i.constructor){case Date:const s=i;return new Date(s.getTime());case Object:e===void 0&&(e={});break;case Array:e=[];break;default:return i}for(const s in i)!i.hasOwnProperty(s)||!isValidKey$1(s)||(e[s]=deepExtend(e[s],i[s]));return e}function isValidKey$1(e){return e!=="__proto__"}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function getGlobal(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const getDefaultsFromGlobal=()=>getGlobal().__FIREBASE_DEFAULTS__,getDefaultsFromEnvVariable=()=>{if(typeof process>"u"||typeof define_process_env_default$1>"u")return;const e=define_process_env_default$1.__FIREBASE_DEFAULTS__;if(e)return JSON.parse(e)},getDefaultsFromCookie=()=>{if(typeof document>"u")return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const i=e&&base64Decode(e[1]);return i&&JSON.parse(i)},getDefaults=()=>{try{return getDefaultsFromPostinstall()||getDefaultsFromGlobal()||getDefaultsFromEnvVariable()||getDefaultsFromCookie()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},getDefaultEmulatorHost=e=>{var i,s;return(s=(i=getDefaults())==null?void 0:i.emulatorHosts)==null?void 0:s[e]},getDefaultEmulatorHostnameAndPort=e=>{const i=getDefaultEmulatorHost(e);if(!i)return;const s=i.lastIndexOf(":");if(s<=0||s+1===i.length)throw new Error(`Invalid host ${i} with no separate hostname and port!`);const a=parseInt(i.substring(s+1),10);return i[0]==="["?[i.substring(1,s-1),a]:[i.substring(0,s),a]},getDefaultAppConfig=()=>{var e;return(e=getDefaults())==null?void 0:e.config},getExperimentalSetting=e=>{var i;return(i=getDefaults())==null?void 0:i[`_${e}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Deferred{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((i,s)=>{this.resolve=i,this.reject=s})}wrapCallback(i){return(s,a)=>{s?this.reject(s):this.resolve(a),typeof i=="function"&&(this.promise.catch(()=>{}),i.length===1?i(s):i(s,a))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function isCloudWorkstation(e){try{return(e.startsWith("http://")||e.startsWith("https://")?new URL(e).hostname:e).endsWith(".cloudworkstations.dev")}catch{return!1}}async function pingServer(e){return(await fetch(e,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function createMockUserToken(e,i){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const s={alg:"none",type:"JWT"},a=i||"demo-project",_=e.iat||0,$=e.sub||e.user_id;if(!$)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const rt={iss:`https://securetoken.google.com/${a}`,aud:a,iat:_,exp:_+3600,auth_time:_,sub:$,user_id:$,firebase:{sign_in_provider:"custom",identities:{}},...e};return[base64urlEncodeWithoutPadding(JSON.stringify(s)),base64urlEncodeWithoutPadding(JSON.stringify(rt)),""].join(".")}const emulatorStatus={};function getEmulatorSummary(){const e={prod:[],emulator:[]};for(const i of Object.keys(emulatorStatus))emulatorStatus[i]?e.emulator.push(i):e.prod.push(i);return e}function getOrCreateEl(e){let i=document.getElementById(e),s=!1;return i||(i=document.createElement("div"),i.setAttribute("id",e),s=!0),{created:s,element:i}}let previouslyDismissed=!1;function updateEmulatorBanner(e,i){if(typeof window>"u"||typeof document>"u"||!isCloudWorkstation(window.location.host)||emulatorStatus[e]===i||emulatorStatus[e]||previouslyDismissed)return;emulatorStatus[e]=i;function s(At){return`__firebase__banner__${At}`}const a="__firebase__banner",$=getEmulatorSummary().prod.length>0;function rt(){const At=document.getElementById(a);At&&At.remove()}function c(At){At.style.display="flex",At.style.background="#7faaf0",At.style.position="fixed",At.style.bottom="5px",At.style.left="5px",At.style.padding=".5em",At.style.borderRadius="5px",At.style.alignItems="center"}function dt(At,Pt){At.setAttribute("width","24"),At.setAttribute("id",Pt),At.setAttribute("height","24"),At.setAttribute("viewBox","0 0 24 24"),At.setAttribute("fill","none"),At.style.marginLeft="-6px"}function ht(){const At=document.createElement("span");return At.style.cursor="pointer",At.style.marginLeft="16px",At.style.fontSize="24px",At.innerHTML=" &times;",At.onclick=()=>{previouslyDismissed=!0,rt()},At}function Et(At,Pt){At.setAttribute("id",Pt),At.innerText="Learn more",At.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",At.setAttribute("target","__blank"),At.style.paddingLeft="5px",At.style.textDecoration="underline"}function St(){const At=getOrCreateEl(a),Pt=s("text"),Vt=document.getElementById(Pt)||document.createElement("span"),Bt=s("learnmore"),Zt=document.getElementById(Bt)||document.createElement("a"),zt=s("preprendIcon"),Ut=document.getElementById(zt)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(At.created){const Nt=At.element;c(Nt),Et(Zt,Bt);const Gt=ht();dt(Ut,zt),Nt.append(Ut,Vt,Zt,Gt),document.body.appendChild(Nt)}$?(Vt.innerText="Preview backend disconnected.",Ut.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(Ut.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,Vt.innerText="Preview backend running in this workspace."),Vt.setAttribute("id",Pt)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",St):St()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function getUA(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function isMobileCordova(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(getUA())}function isCloudflareWorker(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function isBrowserExtension(){const e=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof e=="object"&&e.id!==void 0}function isReactNative(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function isIE(){const e=getUA();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function isNodeSdk(){return CONSTANTS.NODE_ADMIN===!0}function isIndexedDBAvailable(){try{return typeof indexedDB=="object"}catch{return!1}}function validateIndexedDBOpenable(){return new Promise((e,i)=>{try{let s=!0;const a="validate-browser-context-for-indexeddb-analytics-module",_=self.indexedDB.open(a);_.onsuccess=()=>{_.result.close(),s||self.indexedDB.deleteDatabase(a),e(!0)},_.onupgradeneeded=()=>{s=!1},_.onerror=()=>{var $;i((($=_.error)==null?void 0:$.message)||"")}}catch(s){i(s)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ERROR_NAME="FirebaseError";class FirebaseError extends Error{constructor(i,s,a){super(s),this.code=i,this.customData=a,this.name=ERROR_NAME,Object.setPrototypeOf(this,FirebaseError.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,ErrorFactory.prototype.create)}}class ErrorFactory{constructor(i,s,a){this.service=i,this.serviceName=s,this.errors=a}create(i,...s){const a=s[0]||{},_=`${this.service}/${i}`,$=this.errors[i],rt=$?replaceTemplate($,a):"Error",c=`${this.serviceName}: ${rt} (${_}).`;return new FirebaseError(_,c,a)}}function replaceTemplate(e,i){return e.replace(PATTERN,(s,a)=>{const _=i[a];return _!=null?String(_):`<${a}?>`})}const PATTERN=/\{\$([^}]+)}/g;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jsonEval(e){return JSON.parse(e)}function stringify(e){return JSON.stringify(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const decode=function(e){let i={},s={},a={},_="";try{const $=e.split(".");i=jsonEval(base64Decode($[0])||""),s=jsonEval(base64Decode($[1])||""),_=$[2],a=s.d||{},delete s.d}catch{}return{header:i,claims:s,data:a,signature:_}},isValidFormat=function(e){const i=decode(e),s=i.claims;return!!s&&typeof s=="object"&&s.hasOwnProperty("iat")},isAdmin=function(e){const i=decode(e).claims;return typeof i=="object"&&i.admin===!0};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function contains(e,i){return Object.prototype.hasOwnProperty.call(e,i)}function safeGet(e,i){if(Object.prototype.hasOwnProperty.call(e,i))return e[i]}function isEmpty(e){for(const i in e)if(Object.prototype.hasOwnProperty.call(e,i))return!1;return!0}function map(e,i,s){const a={};for(const _ in e)Object.prototype.hasOwnProperty.call(e,_)&&(a[_]=i.call(s,e[_],_,e));return a}function deepEqual(e,i){if(e===i)return!0;const s=Object.keys(e),a=Object.keys(i);for(const _ of s){if(!a.includes(_))return!1;const $=e[_],rt=i[_];if(isObject$1($)&&isObject$1(rt)){if(!deepEqual($,rt))return!1}else if($!==rt)return!1}for(const _ of a)if(!s.includes(_))return!1;return!0}function isObject$1(e){return e!==null&&typeof e=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function querystring(e){const i=[];for(const[s,a]of Object.entries(e))Array.isArray(a)?a.forEach(_=>{i.push(encodeURIComponent(s)+"="+encodeURIComponent(_))}):i.push(encodeURIComponent(s)+"="+encodeURIComponent(a));return i.length?"&"+i.join("&"):""}function querystringDecode(e){const i={};return e.replace(/^\?/,"").split("&").forEach(a=>{if(a){const[_,$]=a.split("=");i[decodeURIComponent(_)]=decodeURIComponent($)}}),i}function extractQuerystring(e){const i=e.indexOf("?");if(!i)return"";const s=e.indexOf("#",i);return e.substring(i,s>0?s:void 0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sha1{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let i=1;i<this.blockSize;++i)this.pad_[i]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(i,s){s||(s=0);const a=this.W_;if(typeof i=="string")for(let St=0;St<16;St++)a[St]=i.charCodeAt(s)<<24|i.charCodeAt(s+1)<<16|i.charCodeAt(s+2)<<8|i.charCodeAt(s+3),s+=4;else for(let St=0;St<16;St++)a[St]=i[s]<<24|i[s+1]<<16|i[s+2]<<8|i[s+3],s+=4;for(let St=16;St<80;St++){const At=a[St-3]^a[St-8]^a[St-14]^a[St-16];a[St]=(At<<1|At>>>31)&4294967295}let _=this.chain_[0],$=this.chain_[1],rt=this.chain_[2],c=this.chain_[3],dt=this.chain_[4],ht,Et;for(let St=0;St<80;St++){St<40?St<20?(ht=c^$&(rt^c),Et=1518500249):(ht=$^rt^c,Et=1859775393):St<60?(ht=$&rt|c&($|rt),Et=2400959708):(ht=$^rt^c,Et=3395469782);const At=(_<<5|_>>>27)+ht+dt+Et+a[St]&4294967295;dt=c,c=rt,rt=($<<30|$>>>2)&4294967295,$=_,_=At}this.chain_[0]=this.chain_[0]+_&4294967295,this.chain_[1]=this.chain_[1]+$&4294967295,this.chain_[2]=this.chain_[2]+rt&4294967295,this.chain_[3]=this.chain_[3]+c&4294967295,this.chain_[4]=this.chain_[4]+dt&4294967295}update(i,s){if(i==null)return;s===void 0&&(s=i.length);const a=s-this.blockSize;let _=0;const $=this.buf_;let rt=this.inbuf_;for(;_<s;){if(rt===0)for(;_<=a;)this.compress_(i,_),_+=this.blockSize;if(typeof i=="string"){for(;_<s;)if($[rt]=i.charCodeAt(_),++rt,++_,rt===this.blockSize){this.compress_($),rt=0;break}}else for(;_<s;)if($[rt]=i[_],++rt,++_,rt===this.blockSize){this.compress_($),rt=0;break}}this.inbuf_=rt,this.total_+=s}digest(){const i=[];let s=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let _=this.blockSize-1;_>=56;_--)this.buf_[_]=s&255,s/=256;this.compress_(this.buf_);let a=0;for(let _=0;_<5;_++)for(let $=24;$>=0;$-=8)i[a]=this.chain_[_]>>$&255,++a;return i}}function createSubscribe(e,i){const s=new ObserverProxy(e,i);return s.subscribe.bind(s)}class ObserverProxy{constructor(i,s){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=s,this.task.then(()=>{i(this)}).catch(a=>{this.error(a)})}next(i){this.forEachObserver(s=>{s.next(i)})}error(i){this.forEachObserver(s=>{s.error(i)}),this.close(i)}complete(){this.forEachObserver(i=>{i.complete()}),this.close()}subscribe(i,s,a){let _;if(i===void 0&&s===void 0&&a===void 0)throw new Error("Missing Observer.");implementsAnyMethods(i,["next","error","complete"])?_=i:_={next:i,error:s,complete:a},_.next===void 0&&(_.next=noop$1),_.error===void 0&&(_.error=noop$1),_.complete===void 0&&(_.complete=noop$1);const $=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?_.error(this.finalError):_.complete()}catch{}}),this.observers.push(_),$}unsubscribeOne(i){this.observers===void 0||this.observers[i]===void 0||(delete this.observers[i],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(i){if(!this.finalized)for(let s=0;s<this.observers.length;s++)this.sendOne(s,i)}sendOne(i,s){this.task.then(()=>{if(this.observers!==void 0&&this.observers[i]!==void 0)try{s(this.observers[i])}catch(a){typeof console<"u"&&console.error&&console.error(a)}})}close(i){this.finalized||(this.finalized=!0,i!==void 0&&(this.finalError=i),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function implementsAnyMethods(e,i){if(typeof e!="object"||e===null)return!1;for(const s of i)if(s in e&&typeof e[s]=="function")return!0;return!1}function noop$1(){}function errorPrefix(e,i){return`${e} failed: ${i} argument `}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const stringToByteArray=function(e){const i=[];let s=0;for(let a=0;a<e.length;a++){let _=e.charCodeAt(a);if(_>=55296&&_<=56319){const $=_-55296;a++,assert(a<e.length,"Surrogate pair missing trail surrogate.");const rt=e.charCodeAt(a)-56320;_=65536+($<<10)+rt}_<128?i[s++]=_:_<2048?(i[s++]=_>>6|192,i[s++]=_&63|128):_<65536?(i[s++]=_>>12|224,i[s++]=_>>6&63|128,i[s++]=_&63|128):(i[s++]=_>>18|240,i[s++]=_>>12&63|128,i[s++]=_>>6&63|128,i[s++]=_&63|128)}return i},stringLength=function(e){let i=0;for(let s=0;s<e.length;s++){const a=e.charCodeAt(s);a<128?i++:a<2048?i+=2:a>=55296&&a<=56319?(i+=4,s++):i+=3}return i};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function getModularInstance(e){return e&&e._delegate?e._delegate:e}class Component{constructor(i,s,a){this.name=i,this.instanceFactory=s,this.type=a,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(i){return this.instantiationMode=i,this}setMultipleInstances(i){return this.multipleInstances=i,this}setServiceProps(i){return this.serviceProps=i,this}setInstanceCreatedCallback(i){return this.onInstanceCreated=i,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DEFAULT_ENTRY_NAME$1="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Provider{constructor(i,s){this.name=i,this.container=s,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(i){const s=this.normalizeInstanceIdentifier(i);if(!this.instancesDeferred.has(s)){const a=new Deferred;if(this.instancesDeferred.set(s,a),this.isInitialized(s)||this.shouldAutoInitialize())try{const _=this.getOrInitializeService({instanceIdentifier:s});_&&a.resolve(_)}catch{}}return this.instancesDeferred.get(s).promise}getImmediate(i){const s=this.normalizeInstanceIdentifier(i==null?void 0:i.identifier),a=(i==null?void 0:i.optional)??!1;if(this.isInitialized(s)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:s})}catch(_){if(a)return null;throw _}else{if(a)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(i){if(i.name!==this.name)throw Error(`Mismatching Component ${i.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=i,!!this.shouldAutoInitialize()){if(isComponentEager(i))try{this.getOrInitializeService({instanceIdentifier:DEFAULT_ENTRY_NAME$1})}catch{}for(const[s,a]of this.instancesDeferred.entries()){const _=this.normalizeInstanceIdentifier(s);try{const $=this.getOrInitializeService({instanceIdentifier:_});a.resolve($)}catch{}}}}clearInstance(i=DEFAULT_ENTRY_NAME$1){this.instancesDeferred.delete(i),this.instancesOptions.delete(i),this.instances.delete(i)}async delete(){const i=Array.from(this.instances.values());await Promise.all([...i.filter(s=>"INTERNAL"in s).map(s=>s.INTERNAL.delete()),...i.filter(s=>"_delete"in s).map(s=>s._delete())])}isComponentSet(){return this.component!=null}isInitialized(i=DEFAULT_ENTRY_NAME$1){return this.instances.has(i)}getOptions(i=DEFAULT_ENTRY_NAME$1){return this.instancesOptions.get(i)||{}}initialize(i={}){const{options:s={}}=i,a=this.normalizeInstanceIdentifier(i.instanceIdentifier);if(this.isInitialized(a))throw Error(`${this.name}(${a}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const _=this.getOrInitializeService({instanceIdentifier:a,options:s});for(const[$,rt]of this.instancesDeferred.entries()){const c=this.normalizeInstanceIdentifier($);a===c&&rt.resolve(_)}return _}onInit(i,s){const a=this.normalizeInstanceIdentifier(s),_=this.onInitCallbacks.get(a)??new Set;_.add(i),this.onInitCallbacks.set(a,_);const $=this.instances.get(a);return $&&i($,a),()=>{_.delete(i)}}invokeOnInitCallbacks(i,s){const a=this.onInitCallbacks.get(s);if(a)for(const _ of a)try{_(i,s)}catch{}}getOrInitializeService({instanceIdentifier:i,options:s={}}){let a=this.instances.get(i);if(!a&&this.component&&(a=this.component.instanceFactory(this.container,{instanceIdentifier:normalizeIdentifierForFactory(i),options:s}),this.instances.set(i,a),this.instancesOptions.set(i,s),this.invokeOnInitCallbacks(a,i),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,i,a)}catch{}return a||null}normalizeInstanceIdentifier(i=DEFAULT_ENTRY_NAME$1){return this.component?this.component.multipleInstances?i:DEFAULT_ENTRY_NAME$1:i}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function normalizeIdentifierForFactory(e){return e===DEFAULT_ENTRY_NAME$1?void 0:e}function isComponentEager(e){return e.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ComponentContainer{constructor(i){this.name=i,this.providers=new Map}addComponent(i){const s=this.getProvider(i.name);if(s.isComponentSet())throw new Error(`Component ${i.name} has already been registered with ${this.name}`);s.setComponent(i)}addOrOverwriteComponent(i){this.getProvider(i.name).isComponentSet()&&this.providers.delete(i.name),this.addComponent(i)}getProvider(i){if(this.providers.has(i))return this.providers.get(i);const s=new Provider(i,this);return this.providers.set(i,s),s}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var LogLevel;(function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"})(LogLevel||(LogLevel={}));const levelStringToEnum={debug:LogLevel.DEBUG,verbose:LogLevel.VERBOSE,info:LogLevel.INFO,warn:LogLevel.WARN,error:LogLevel.ERROR,silent:LogLevel.SILENT},defaultLogLevel=LogLevel.INFO,ConsoleMethod={[LogLevel.DEBUG]:"log",[LogLevel.VERBOSE]:"log",[LogLevel.INFO]:"info",[LogLevel.WARN]:"warn",[LogLevel.ERROR]:"error"},defaultLogHandler=(e,i,...s)=>{if(i<e.logLevel)return;const a=new Date().toISOString(),_=ConsoleMethod[i];if(_)console[_](`[${a}]  ${e.name}:`,...s);else throw new Error(`Attempted to log a message with an invalid logType (value: ${i})`)};class Logger{constructor(i){this.name=i,this._logLevel=defaultLogLevel,this._logHandler=defaultLogHandler,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(i){if(!(i in LogLevel))throw new TypeError(`Invalid value "${i}" assigned to \`logLevel\``);this._logLevel=i}setLogLevel(i){this._logLevel=typeof i=="string"?levelStringToEnum[i]:i}get logHandler(){return this._logHandler}set logHandler(i){if(typeof i!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=i}get userLogHandler(){return this._userLogHandler}set userLogHandler(i){this._userLogHandler=i}debug(...i){this._userLogHandler&&this._userLogHandler(this,LogLevel.DEBUG,...i),this._logHandler(this,LogLevel.DEBUG,...i)}log(...i){this._userLogHandler&&this._userLogHandler(this,LogLevel.VERBOSE,...i),this._logHandler(this,LogLevel.VERBOSE,...i)}info(...i){this._userLogHandler&&this._userLogHandler(this,LogLevel.INFO,...i),this._logHandler(this,LogLevel.INFO,...i)}warn(...i){this._userLogHandler&&this._userLogHandler(this,LogLevel.WARN,...i),this._logHandler(this,LogLevel.WARN,...i)}error(...i){this._userLogHandler&&this._userLogHandler(this,LogLevel.ERROR,...i),this._logHandler(this,LogLevel.ERROR,...i)}}const instanceOfAny=(e,i)=>i.some(s=>e instanceof s);let idbProxyableTypes,cursorAdvanceMethods;function getIdbProxyableTypes(){return idbProxyableTypes||(idbProxyableTypes=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function getCursorAdvanceMethods(){return cursorAdvanceMethods||(cursorAdvanceMethods=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const cursorRequestMap=new WeakMap,transactionDoneMap=new WeakMap,transactionStoreNamesMap=new WeakMap,transformCache=new WeakMap,reverseTransformCache=new WeakMap;function promisifyRequest(e){const i=new Promise((s,a)=>{const _=()=>{e.removeEventListener("success",$),e.removeEventListener("error",rt)},$=()=>{s(wrap(e.result)),_()},rt=()=>{a(e.error),_()};e.addEventListener("success",$),e.addEventListener("error",rt)});return i.then(s=>{s instanceof IDBCursor&&cursorRequestMap.set(s,e)}).catch(()=>{}),reverseTransformCache.set(i,e),i}function cacheDonePromiseForTransaction(e){if(transactionDoneMap.has(e))return;const i=new Promise((s,a)=>{const _=()=>{e.removeEventListener("complete",$),e.removeEventListener("error",rt),e.removeEventListener("abort",rt)},$=()=>{s(),_()},rt=()=>{a(e.error||new DOMException("AbortError","AbortError")),_()};e.addEventListener("complete",$),e.addEventListener("error",rt),e.addEventListener("abort",rt)});transactionDoneMap.set(e,i)}let idbProxyTraps={get(e,i,s){if(e instanceof IDBTransaction){if(i==="done")return transactionDoneMap.get(e);if(i==="objectStoreNames")return e.objectStoreNames||transactionStoreNamesMap.get(e);if(i==="store")return s.objectStoreNames[1]?void 0:s.objectStore(s.objectStoreNames[0])}return wrap(e[i])},set(e,i,s){return e[i]=s,!0},has(e,i){return e instanceof IDBTransaction&&(i==="done"||i==="store")?!0:i in e}};function replaceTraps(e){idbProxyTraps=e(idbProxyTraps)}function wrapFunction(e){return e===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(i,...s){const a=e.call(unwrap(this),i,...s);return transactionStoreNamesMap.set(a,i.sort?i.sort():[i]),wrap(a)}:getCursorAdvanceMethods().includes(e)?function(...i){return e.apply(unwrap(this),i),wrap(cursorRequestMap.get(this))}:function(...i){return wrap(e.apply(unwrap(this),i))}}function transformCachableValue(e){return typeof e=="function"?wrapFunction(e):(e instanceof IDBTransaction&&cacheDonePromiseForTransaction(e),instanceOfAny(e,getIdbProxyableTypes())?new Proxy(e,idbProxyTraps):e)}function wrap(e){if(e instanceof IDBRequest)return promisifyRequest(e);if(transformCache.has(e))return transformCache.get(e);const i=transformCachableValue(e);return i!==e&&(transformCache.set(e,i),reverseTransformCache.set(i,e)),i}const unwrap=e=>reverseTransformCache.get(e);function openDB(e,i,{blocked:s,upgrade:a,blocking:_,terminated:$}={}){const rt=indexedDB.open(e,i),c=wrap(rt);return a&&rt.addEventListener("upgradeneeded",dt=>{a(wrap(rt.result),dt.oldVersion,dt.newVersion,wrap(rt.transaction),dt)}),s&&rt.addEventListener("blocked",dt=>s(dt.oldVersion,dt.newVersion,dt)),c.then(dt=>{$&&dt.addEventListener("close",()=>$()),_&&dt.addEventListener("versionchange",ht=>_(ht.oldVersion,ht.newVersion,ht))}).catch(()=>{}),c}const readMethods=["get","getKey","getAll","getAllKeys","count"],writeMethods=["put","add","delete","clear"],cachedMethods=new Map;function getMethod(e,i){if(!(e instanceof IDBDatabase&&!(i in e)&&typeof i=="string"))return;if(cachedMethods.get(i))return cachedMethods.get(i);const s=i.replace(/FromIndex$/,""),a=i!==s,_=writeMethods.includes(s);if(!(s in(a?IDBIndex:IDBObjectStore).prototype)||!(_||readMethods.includes(s)))return;const $=async function(rt,...c){const dt=this.transaction(rt,_?"readwrite":"readonly");let ht=dt.store;return a&&(ht=ht.index(c.shift())),(await Promise.all([ht[s](...c),_&&dt.done]))[0]};return cachedMethods.set(i,$),$}replaceTraps(e=>({...e,get:(i,s,a)=>getMethod(i,s)||e.get(i,s,a),has:(i,s)=>!!getMethod(i,s)||e.has(i,s)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PlatformLoggerServiceImpl{constructor(i){this.container=i}getPlatformInfoString(){return this.container.getProviders().map(s=>{if(isVersionServiceProvider(s)){const a=s.getImmediate();return`${a.library}/${a.version}`}else return null}).filter(s=>s).join(" ")}}function isVersionServiceProvider(e){const i=e.getComponent();return(i==null?void 0:i.type)==="VERSION"}const name$q="@firebase/app",version$1$1="0.14.6";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const logger$1=new Logger("@firebase/app"),name$p="@firebase/app-compat",name$o="@firebase/analytics-compat",name$n="@firebase/analytics",name$m="@firebase/app-check-compat",name$l="@firebase/app-check",name$k="@firebase/auth",name$j="@firebase/auth-compat",name$i="@firebase/database",name$h="@firebase/data-connect",name$g="@firebase/database-compat",name$f="@firebase/functions",name$e="@firebase/functions-compat",name$d="@firebase/installations",name$c="@firebase/installations-compat",name$b="@firebase/messaging",name$a="@firebase/messaging-compat",name$9="@firebase/performance",name$8="@firebase/performance-compat",name$7="@firebase/remote-config",name$6="@firebase/remote-config-compat",name$5="@firebase/storage",name$4="@firebase/storage-compat",name$3$1="@firebase/firestore",name$2$1="@firebase/ai",name$1$1="@firebase/firestore-compat",name$r="firebase",version$4="12.6.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DEFAULT_ENTRY_NAME="[DEFAULT]",PLATFORM_LOG_STRING={[name$q]:"fire-core",[name$p]:"fire-core-compat",[name$n]:"fire-analytics",[name$o]:"fire-analytics-compat",[name$l]:"fire-app-check",[name$m]:"fire-app-check-compat",[name$k]:"fire-auth",[name$j]:"fire-auth-compat",[name$i]:"fire-rtdb",[name$h]:"fire-data-connect",[name$g]:"fire-rtdb-compat",[name$f]:"fire-fn",[name$e]:"fire-fn-compat",[name$d]:"fire-iid",[name$c]:"fire-iid-compat",[name$b]:"fire-fcm",[name$a]:"fire-fcm-compat",[name$9]:"fire-perf",[name$8]:"fire-perf-compat",[name$7]:"fire-rc",[name$6]:"fire-rc-compat",[name$5]:"fire-gcs",[name$4]:"fire-gcs-compat",[name$3$1]:"fire-fst",[name$1$1]:"fire-fst-compat",[name$2$1]:"fire-vertex","fire-js":"fire-js",[name$r]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _apps=new Map,_serverApps=new Map,_components=new Map;function _addComponent(e,i){try{e.container.addComponent(i)}catch(s){logger$1.debug(`Component ${i.name} failed to register with FirebaseApp ${e.name}`,s)}}function _registerComponent(e){const i=e.name;if(_components.has(i))return logger$1.debug(`There were multiple attempts to register component ${i}.`),!1;_components.set(i,e);for(const s of _apps.values())_addComponent(s,e);for(const s of _serverApps.values())_addComponent(s,e);return!0}function _getProvider(e,i){const s=e.container.getProvider("heartbeat").getImmediate({optional:!0});return s&&s.triggerHeartbeat(),e.container.getProvider(i)}function _isFirebaseServerApp(e){return e==null?!1:e.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ERRORS={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},ERROR_FACTORY=new ErrorFactory("app","Firebase",ERRORS);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FirebaseAppImpl{constructor(i,s,a){this._isDeleted=!1,this._options={...i},this._config={...s},this._name=s.name,this._automaticDataCollectionEnabled=s.automaticDataCollectionEnabled,this._container=a,this.container.addComponent(new Component("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(i){this.checkDestroyed(),this._automaticDataCollectionEnabled=i}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(i){this._isDeleted=i}checkDestroyed(){if(this.isDeleted)throw ERROR_FACTORY.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SDK_VERSION$1=version$4;function initializeApp(e,i={}){let s=e;typeof i!="object"&&(i={name:i});const a={name:DEFAULT_ENTRY_NAME,automaticDataCollectionEnabled:!0,...i},_=a.name;if(typeof _!="string"||!_)throw ERROR_FACTORY.create("bad-app-name",{appName:String(_)});if(s||(s=getDefaultAppConfig()),!s)throw ERROR_FACTORY.create("no-options");const $=_apps.get(_);if($){if(deepEqual(s,$.options)&&deepEqual(a,$.config))return $;throw ERROR_FACTORY.create("duplicate-app",{appName:_})}const rt=new ComponentContainer(_);for(const dt of _components.values())rt.addComponent(dt);const c=new FirebaseAppImpl(s,a,rt);return _apps.set(_,c),c}function getApp(e=DEFAULT_ENTRY_NAME){const i=_apps.get(e);if(!i&&e===DEFAULT_ENTRY_NAME&&getDefaultAppConfig())return initializeApp();if(!i)throw ERROR_FACTORY.create("no-app",{appName:e});return i}function registerVersion(e,i,s){let a=PLATFORM_LOG_STRING[e]??e;s&&(a+=`-${s}`);const _=a.match(/\s|\//),$=i.match(/\s|\//);if(_||$){const rt=[`Unable to register library "${a}" with version "${i}":`];_&&rt.push(`library name "${a}" contains illegal characters (whitespace or "/")`),_&&$&&rt.push("and"),$&&rt.push(`version name "${i}" contains illegal characters (whitespace or "/")`),logger$1.warn(rt.join(" "));return}_registerComponent(new Component(`${a}-version`,()=>({library:a,version:i}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DB_NAME$1="firebase-heartbeat-database",DB_VERSION$1=1,STORE_NAME="firebase-heartbeat-store";let dbPromise=null;function getDbPromise(){return dbPromise||(dbPromise=openDB(DB_NAME$1,DB_VERSION$1,{upgrade:(e,i)=>{switch(i){case 0:try{e.createObjectStore(STORE_NAME)}catch(s){console.warn(s)}}}}).catch(e=>{throw ERROR_FACTORY.create("idb-open",{originalErrorMessage:e.message})})),dbPromise}async function readHeartbeatsFromIndexedDB(e){try{const s=(await getDbPromise()).transaction(STORE_NAME),a=await s.objectStore(STORE_NAME).get(computeKey(e));return await s.done,a}catch(i){if(i instanceof FirebaseError)logger$1.warn(i.message);else{const s=ERROR_FACTORY.create("idb-get",{originalErrorMessage:i==null?void 0:i.message});logger$1.warn(s.message)}}}async function writeHeartbeatsToIndexedDB(e,i){try{const a=(await getDbPromise()).transaction(STORE_NAME,"readwrite");await a.objectStore(STORE_NAME).put(i,computeKey(e)),await a.done}catch(s){if(s instanceof FirebaseError)logger$1.warn(s.message);else{const a=ERROR_FACTORY.create("idb-set",{originalErrorMessage:s==null?void 0:s.message});logger$1.warn(a.message)}}}function computeKey(e){return`${e.name}!${e.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MAX_HEADER_BYTES=1024,MAX_NUM_STORED_HEARTBEATS=30;class HeartbeatServiceImpl{constructor(i){this.container=i,this._heartbeatsCache=null;const s=this.container.getProvider("app").getImmediate();this._storage=new HeartbeatStorageImpl(s),this._heartbeatsCachePromise=this._storage.read().then(a=>(this._heartbeatsCache=a,a))}async triggerHeartbeat(){var i,s;try{const _=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),$=getUTCDateString();if(((i=this._heartbeatsCache)==null?void 0:i.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((s=this._heartbeatsCache)==null?void 0:s.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===$||this._heartbeatsCache.heartbeats.some(rt=>rt.date===$))return;if(this._heartbeatsCache.heartbeats.push({date:$,agent:_}),this._heartbeatsCache.heartbeats.length>MAX_NUM_STORED_HEARTBEATS){const rt=getEarliestHeartbeatIdx(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(rt,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(a){logger$1.warn(a)}}async getHeartbeatsHeader(){var i;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((i=this._heartbeatsCache)==null?void 0:i.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const s=getUTCDateString(),{heartbeatsToSend:a,unsentEntries:_}=extractHeartbeatsForHeader(this._heartbeatsCache.heartbeats),$=base64urlEncodeWithoutPadding(JSON.stringify({version:2,heartbeats:a}));return this._heartbeatsCache.lastSentHeartbeatDate=s,_.length>0?(this._heartbeatsCache.heartbeats=_,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),$}catch(s){return logger$1.warn(s),""}}}function getUTCDateString(){return new Date().toISOString().substring(0,10)}function extractHeartbeatsForHeader(e,i=MAX_HEADER_BYTES){const s=[];let a=e.slice();for(const _ of e){const $=s.find(rt=>rt.agent===_.agent);if($){if($.dates.push(_.date),countBytes(s)>i){$.dates.pop();break}}else if(s.push({agent:_.agent,dates:[_.date]}),countBytes(s)>i){s.pop();break}a=a.slice(1)}return{heartbeatsToSend:s,unsentEntries:a}}class HeartbeatStorageImpl{constructor(i){this.app=i,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return isIndexedDBAvailable()?validateIndexedDBOpenable().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const s=await readHeartbeatsFromIndexedDB(this.app);return s!=null&&s.heartbeats?s:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(i){if(await this._canUseIndexedDBPromise){const a=await this.read();return writeHeartbeatsToIndexedDB(this.app,{lastSentHeartbeatDate:i.lastSentHeartbeatDate??a.lastSentHeartbeatDate,heartbeats:i.heartbeats})}else return}async add(i){if(await this._canUseIndexedDBPromise){const a=await this.read();return writeHeartbeatsToIndexedDB(this.app,{lastSentHeartbeatDate:i.lastSentHeartbeatDate??a.lastSentHeartbeatDate,heartbeats:[...a.heartbeats,...i.heartbeats]})}else return}}function countBytes(e){return base64urlEncodeWithoutPadding(JSON.stringify({version:2,heartbeats:e})).length}function getEarliestHeartbeatIdx(e){if(e.length===0)return-1;let i=0,s=e[0].date;for(let a=1;a<e.length;a++)e[a].date<s&&(s=e[a].date,i=a);return i}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function registerCoreComponents(e){_registerComponent(new Component("platform-logger",i=>new PlatformLoggerServiceImpl(i),"PRIVATE")),_registerComponent(new Component("heartbeat",i=>new HeartbeatServiceImpl(i),"PRIVATE")),registerVersion(name$q,version$1$1,e),registerVersion(name$q,version$1$1,"esm2020"),registerVersion("fire-js","")}registerCoreComponents("");function _prodErrorMap(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const prodErrorMap=_prodErrorMap,_DEFAULT_AUTH_ERROR_FACTORY=new ErrorFactory("auth","Firebase",_prodErrorMap());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const logClient$1=new Logger("@firebase/auth");function _logWarn(e,...i){logClient$1.logLevel<=LogLevel.WARN&&logClient$1.warn(`Auth (${SDK_VERSION$1}): ${e}`,...i)}function _logError(e,...i){logClient$1.logLevel<=LogLevel.ERROR&&logClient$1.error(`Auth (${SDK_VERSION$1}): ${e}`,...i)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _fail(e,...i){throw createErrorInternal(e,...i)}function _createError(e,...i){return createErrorInternal(e,...i)}function _errorWithCustomMessage(e,i,s){const a={...prodErrorMap(),[i]:s};return new ErrorFactory("auth","Firebase",a).create(i,{appName:e.name})}function _serverAppCurrentUserOperationNotSupportedError(e){return _errorWithCustomMessage(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function createErrorInternal(e,...i){if(typeof e!="string"){const s=i[0],a=[...i.slice(1)];return a[0]&&(a[0].appName=e.name),e._errorFactory.create(s,...a)}return _DEFAULT_AUTH_ERROR_FACTORY.create(e,...i)}function _assert(e,i,...s){if(!e)throw createErrorInternal(i,...s)}function debugFail(e){const i="INTERNAL ASSERTION FAILED: "+e;throw _logError(i),new Error(i)}function debugAssert(e,i){e||debugFail(i)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _getCurrentUrl(){var e;return typeof self<"u"&&((e=self.location)==null?void 0:e.href)||""}function _isHttpOrHttps(){return _getCurrentScheme()==="http:"||_getCurrentScheme()==="https:"}function _getCurrentScheme(){var e;return typeof self<"u"&&((e=self.location)==null?void 0:e.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _isOnline(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(_isHttpOrHttps()||isBrowserExtension()||"connection"in navigator)?navigator.onLine:!0}function _getUserLanguage(){if(typeof navigator>"u")return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Delay{constructor(i,s){this.shortDelay=i,this.longDelay=s,debugAssert(s>i,"Short delay should be less than long delay!"),this.isMobile=isMobileCordova()||isReactNative()}get(){return _isOnline()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _emulatorUrl(e,i){debugAssert(e.emulator,"Emulator should always be set here");const{url:s}=e.emulator;return i?`${s}${i.startsWith("/")?i.slice(1):i}`:s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FetchProvider{static initialize(i,s,a){this.fetchImpl=i,s&&(this.headersImpl=s),a&&(this.responseImpl=a)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;debugFail("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;debugFail("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;debugFail("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SERVER_ERROR_MAP={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CookieAuthProxiedEndpoints=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],DEFAULT_API_TIMEOUT_MS=new Delay(3e4,6e4);function _addTidIfNecessary(e,i){return e.tenantId&&!i.tenantId?{...i,tenantId:e.tenantId}:i}async function _performApiRequest(e,i,s,a,_={}){return _performFetchWithErrorHandling(e,_,async()=>{let $={},rt={};a&&(i==="GET"?rt=a:$={body:JSON.stringify(a)});const c=querystring({key:e.config.apiKey,...rt}).slice(1),dt=await e._getAdditionalHeaders();dt["Content-Type"]="application/json",e.languageCode&&(dt["X-Firebase-Locale"]=e.languageCode);const ht={method:i,headers:dt,...$};return isCloudflareWorker()||(ht.referrerPolicy="no-referrer"),e.emulatorConfig&&isCloudWorkstation(e.emulatorConfig.host)&&(ht.credentials="include"),FetchProvider.fetch()(await _getFinalTarget(e,e.config.apiHost,s,c),ht)})}async function _performFetchWithErrorHandling(e,i,s){e._canInitEmulator=!1;const a={...SERVER_ERROR_MAP,...i};try{const _=new NetworkTimeout(e),$=await Promise.race([s(),_.promise]);_.clearNetworkTimeout();const rt=await $.json();if("needConfirmation"in rt)throw _makeTaggedError(e,"account-exists-with-different-credential",rt);if($.ok&&!("errorMessage"in rt))return rt;{const c=$.ok?rt.errorMessage:rt.error.message,[dt,ht]=c.split(" : ");if(dt==="FEDERATED_USER_ID_ALREADY_LINKED")throw _makeTaggedError(e,"credential-already-in-use",rt);if(dt==="EMAIL_EXISTS")throw _makeTaggedError(e,"email-already-in-use",rt);if(dt==="USER_DISABLED")throw _makeTaggedError(e,"user-disabled",rt);const Et=a[dt]||dt.toLowerCase().replace(/[_\s]+/g,"-");if(ht)throw _errorWithCustomMessage(e,Et,ht);_fail(e,Et)}}catch(_){if(_ instanceof FirebaseError)throw _;_fail(e,"network-request-failed",{message:String(_)})}}async function _performSignInRequest(e,i,s,a,_={}){const $=await _performApiRequest(e,i,s,a,_);return"mfaPendingCredential"in $&&_fail(e,"multi-factor-auth-required",{_serverResponse:$}),$}async function _getFinalTarget(e,i,s,a){const _=`${i}${s}?${a}`,$=e,rt=$.config.emulator?_emulatorUrl(e.config,_):`${e.config.apiScheme}://${_}`;return CookieAuthProxiedEndpoints.includes(s)&&(await $._persistenceManagerAvailable,$._getPersistenceType()==="COOKIE")?$._getPersistence()._getFinalTarget(rt).toString():rt}function _parseEnforcementState(e){switch(e){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class NetworkTimeout{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(i){this.auth=i,this.timer=null,this.promise=new Promise((s,a)=>{this.timer=setTimeout(()=>a(_createError(this.auth,"network-request-failed")),DEFAULT_API_TIMEOUT_MS.get())})}}function _makeTaggedError(e,i,s){const a={appName:e.name};s.email&&(a.email=s.email),s.phoneNumber&&(a.phoneNumber=s.phoneNumber);const _=_createError(e,i,a);return _.customData._tokenResponse=s,_}function isEnterprise(e){return e!==void 0&&e.enterprise!==void 0}class RecaptchaConfig{constructor(i){if(this.siteKey="",this.recaptchaEnforcementState=[],i.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=i.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=i.recaptchaEnforcementState}getProviderEnforcementState(i){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const s of this.recaptchaEnforcementState)if(s.provider&&s.provider===i)return _parseEnforcementState(s.enforcementState);return null}isProviderEnabled(i){return this.getProviderEnforcementState(i)==="ENFORCE"||this.getProviderEnforcementState(i)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function getRecaptchaConfig(e,i){return _performApiRequest(e,"GET","/v2/recaptchaConfig",_addTidIfNecessary(e,i))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function deleteAccount(e,i){return _performApiRequest(e,"POST","/v1/accounts:delete",i)}async function getAccountInfo(e,i){return _performApiRequest(e,"POST","/v1/accounts:lookup",i)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function utcTimestampToDateString(e){if(e)try{const i=new Date(Number(e));if(!isNaN(i.getTime()))return i.toUTCString()}catch{}}async function getIdTokenResult(e,i=!1){const s=getModularInstance(e),a=await s.getIdToken(i),_=_parseToken(a);_assert(_&&_.exp&&_.auth_time&&_.iat,s.auth,"internal-error");const $=typeof _.firebase=="object"?_.firebase:void 0,rt=$==null?void 0:$.sign_in_provider;return{claims:_,token:a,authTime:utcTimestampToDateString(secondsStringToMilliseconds(_.auth_time)),issuedAtTime:utcTimestampToDateString(secondsStringToMilliseconds(_.iat)),expirationTime:utcTimestampToDateString(secondsStringToMilliseconds(_.exp)),signInProvider:rt||null,signInSecondFactor:($==null?void 0:$.sign_in_second_factor)||null}}function secondsStringToMilliseconds(e){return Number(e)*1e3}function _parseToken(e){const[i,s,a]=e.split(".");if(i===void 0||s===void 0||a===void 0)return _logError("JWT malformed, contained fewer than 3 sections"),null;try{const _=base64Decode(s);return _?JSON.parse(_):(_logError("Failed to decode base64 JWT payload"),null)}catch(_){return _logError("Caught error parsing JWT payload as JSON",_==null?void 0:_.toString()),null}}function _tokenExpiresIn(e){const i=_parseToken(e);return _assert(i,"internal-error"),_assert(typeof i.exp<"u","internal-error"),_assert(typeof i.iat<"u","internal-error"),Number(i.exp)-Number(i.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _logoutIfInvalidated(e,i,s=!1){if(s)return i;try{return await i}catch(a){throw a instanceof FirebaseError&&isUserInvalidated(a)&&e.auth.currentUser===e&&await e.auth.signOut(),a}}function isUserInvalidated({code:e}){return e==="auth/user-disabled"||e==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ProactiveRefresh{constructor(i){this.user=i,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(i){if(i){const s=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),s}else{this.errorBackoff=3e4;const a=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,a)}}schedule(i=!1){if(!this.isRunning)return;const s=this.getInterval(i);this.timerId=setTimeout(async()=>{await this.iteration()},s)}async iteration(){try{await this.user.getIdToken(!0)}catch(i){(i==null?void 0:i.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UserMetadata{constructor(i,s){this.createdAt=i,this.lastLoginAt=s,this._initializeTime()}_initializeTime(){this.lastSignInTime=utcTimestampToDateString(this.lastLoginAt),this.creationTime=utcTimestampToDateString(this.createdAt)}_copy(i){this.createdAt=i.createdAt,this.lastLoginAt=i.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _reloadWithoutSaving(e){var St;const i=e.auth,s=await e.getIdToken(),a=await _logoutIfInvalidated(e,getAccountInfo(i,{idToken:s}));_assert(a==null?void 0:a.users.length,i,"internal-error");const _=a.users[0];e._notifyReloadListener(_);const $=(St=_.providerUserInfo)!=null&&St.length?extractProviderData(_.providerUserInfo):[],rt=mergeProviderData(e.providerData,$),c=e.isAnonymous,dt=!(e.email&&_.passwordHash)&&!(rt!=null&&rt.length),ht=c?dt:!1,Et={uid:_.localId,displayName:_.displayName||null,photoURL:_.photoUrl||null,email:_.email||null,emailVerified:_.emailVerified||!1,phoneNumber:_.phoneNumber||null,tenantId:_.tenantId||null,providerData:rt,metadata:new UserMetadata(_.createdAt,_.lastLoginAt),isAnonymous:ht};Object.assign(e,Et)}async function reload(e){const i=getModularInstance(e);await _reloadWithoutSaving(i),await i.auth._persistUserIfCurrent(i),i.auth._notifyListenersIfCurrent(i)}function mergeProviderData(e,i){return[...e.filter(a=>!i.some(_=>_.providerId===a.providerId)),...i]}function extractProviderData(e){return e.map(({providerId:i,...s})=>({providerId:i,uid:s.rawId||"",displayName:s.displayName||null,email:s.email||null,phoneNumber:s.phoneNumber||null,photoURL:s.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function requestStsToken(e,i){const s=await _performFetchWithErrorHandling(e,{},async()=>{const a=querystring({grant_type:"refresh_token",refresh_token:i}).slice(1),{tokenApiHost:_,apiKey:$}=e.config,rt=await _getFinalTarget(e,_,"/v1/token",`key=${$}`),c=await e._getAdditionalHeaders();c["Content-Type"]="application/x-www-form-urlencoded";const dt={method:"POST",headers:c,body:a};return e.emulatorConfig&&isCloudWorkstation(e.emulatorConfig.host)&&(dt.credentials="include"),FetchProvider.fetch()(rt,dt)});return{accessToken:s.access_token,expiresIn:s.expires_in,refreshToken:s.refresh_token}}async function revokeToken(e,i){return _performApiRequest(e,"POST","/v2/accounts:revokeToken",_addTidIfNecessary(e,i))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class StsTokenManager{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(i){_assert(i.idToken,"internal-error"),_assert(typeof i.idToken<"u","internal-error"),_assert(typeof i.refreshToken<"u","internal-error");const s="expiresIn"in i&&typeof i.expiresIn<"u"?Number(i.expiresIn):_tokenExpiresIn(i.idToken);this.updateTokensAndExpiration(i.idToken,i.refreshToken,s)}updateFromIdToken(i){_assert(i.length!==0,"internal-error");const s=_tokenExpiresIn(i);this.updateTokensAndExpiration(i,null,s)}async getToken(i,s=!1){return!s&&this.accessToken&&!this.isExpired?this.accessToken:(_assert(this.refreshToken,i,"user-token-expired"),this.refreshToken?(await this.refresh(i,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(i,s){const{accessToken:a,refreshToken:_,expiresIn:$}=await requestStsToken(i,s);this.updateTokensAndExpiration(a,_,Number($))}updateTokensAndExpiration(i,s,a){this.refreshToken=s||null,this.accessToken=i||null,this.expirationTime=Date.now()+a*1e3}static fromJSON(i,s){const{refreshToken:a,accessToken:_,expirationTime:$}=s,rt=new StsTokenManager;return a&&(_assert(typeof a=="string","internal-error",{appName:i}),rt.refreshToken=a),_&&(_assert(typeof _=="string","internal-error",{appName:i}),rt.accessToken=_),$&&(_assert(typeof $=="number","internal-error",{appName:i}),rt.expirationTime=$),rt}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(i){this.accessToken=i.accessToken,this.refreshToken=i.refreshToken,this.expirationTime=i.expirationTime}_clone(){return Object.assign(new StsTokenManager,this.toJSON())}_performRefresh(){return debugFail("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function assertStringOrUndefined(e,i){_assert(typeof e=="string"||typeof e>"u","internal-error",{appName:i})}class UserImpl{constructor({uid:i,auth:s,stsTokenManager:a,..._}){this.providerId="firebase",this.proactiveRefresh=new ProactiveRefresh(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=i,this.auth=s,this.stsTokenManager=a,this.accessToken=a.accessToken,this.displayName=_.displayName||null,this.email=_.email||null,this.emailVerified=_.emailVerified||!1,this.phoneNumber=_.phoneNumber||null,this.photoURL=_.photoURL||null,this.isAnonymous=_.isAnonymous||!1,this.tenantId=_.tenantId||null,this.providerData=_.providerData?[..._.providerData]:[],this.metadata=new UserMetadata(_.createdAt||void 0,_.lastLoginAt||void 0)}async getIdToken(i){const s=await _logoutIfInvalidated(this,this.stsTokenManager.getToken(this.auth,i));return _assert(s,this.auth,"internal-error"),this.accessToken!==s&&(this.accessToken=s,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),s}getIdTokenResult(i){return getIdTokenResult(this,i)}reload(){return reload(this)}_assign(i){this!==i&&(_assert(this.uid===i.uid,this.auth,"internal-error"),this.displayName=i.displayName,this.photoURL=i.photoURL,this.email=i.email,this.emailVerified=i.emailVerified,this.phoneNumber=i.phoneNumber,this.isAnonymous=i.isAnonymous,this.tenantId=i.tenantId,this.providerData=i.providerData.map(s=>({...s})),this.metadata._copy(i.metadata),this.stsTokenManager._assign(i.stsTokenManager))}_clone(i){const s=new UserImpl({...this,auth:i,stsTokenManager:this.stsTokenManager._clone()});return s.metadata._copy(this.metadata),s}_onReload(i){_assert(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=i,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(i){this.reloadListener?this.reloadListener(i):this.reloadUserInfo=i}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(i,s=!1){let a=!1;i.idToken&&i.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(i),a=!0),s&&await _reloadWithoutSaving(this),await this.auth._persistUserIfCurrent(this),a&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(_isFirebaseServerApp(this.auth.app))return Promise.reject(_serverAppCurrentUserOperationNotSupportedError(this.auth));const i=await this.getIdToken();return await _logoutIfInvalidated(this,deleteAccount(this.auth,{idToken:i})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(i=>({...i})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(i,s){const a=s.displayName??void 0,_=s.email??void 0,$=s.phoneNumber??void 0,rt=s.photoURL??void 0,c=s.tenantId??void 0,dt=s._redirectEventId??void 0,ht=s.createdAt??void 0,Et=s.lastLoginAt??void 0,{uid:St,emailVerified:At,isAnonymous:Pt,providerData:Vt,stsTokenManager:Bt}=s;_assert(St&&Bt,i,"internal-error");const Zt=StsTokenManager.fromJSON(this.name,Bt);_assert(typeof St=="string",i,"internal-error"),assertStringOrUndefined(a,i.name),assertStringOrUndefined(_,i.name),_assert(typeof At=="boolean",i,"internal-error"),_assert(typeof Pt=="boolean",i,"internal-error"),assertStringOrUndefined($,i.name),assertStringOrUndefined(rt,i.name),assertStringOrUndefined(c,i.name),assertStringOrUndefined(dt,i.name),assertStringOrUndefined(ht,i.name),assertStringOrUndefined(Et,i.name);const zt=new UserImpl({uid:St,auth:i,email:_,emailVerified:At,displayName:a,isAnonymous:Pt,photoURL:rt,phoneNumber:$,tenantId:c,stsTokenManager:Zt,createdAt:ht,lastLoginAt:Et});return Vt&&Array.isArray(Vt)&&(zt.providerData=Vt.map(Ut=>({...Ut}))),dt&&(zt._redirectEventId=dt),zt}static async _fromIdTokenResponse(i,s,a=!1){const _=new StsTokenManager;_.updateFromServerResponse(s);const $=new UserImpl({uid:s.localId,auth:i,stsTokenManager:_,isAnonymous:a});return await _reloadWithoutSaving($),$}static async _fromGetAccountInfoResponse(i,s,a){const _=s.users[0];_assert(_.localId!==void 0,"internal-error");const $=_.providerUserInfo!==void 0?extractProviderData(_.providerUserInfo):[],rt=!(_.email&&_.passwordHash)&&!($!=null&&$.length),c=new StsTokenManager;c.updateFromIdToken(a);const dt=new UserImpl({uid:_.localId,auth:i,stsTokenManager:c,isAnonymous:rt}),ht={uid:_.localId,displayName:_.displayName||null,photoURL:_.photoUrl||null,email:_.email||null,emailVerified:_.emailVerified||!1,phoneNumber:_.phoneNumber||null,tenantId:_.tenantId||null,providerData:$,metadata:new UserMetadata(_.createdAt,_.lastLoginAt),isAnonymous:!(_.email&&_.passwordHash)&&!($!=null&&$.length)};return Object.assign(dt,ht),dt}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const instanceCache=new Map;function _getInstance(e){debugAssert(e instanceof Function,"Expected a class definition");let i=instanceCache.get(e);return i?(debugAssert(i instanceof e,"Instance stored in cache mismatched with class"),i):(i=new e,instanceCache.set(e,i),i)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class InMemoryPersistence{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(i,s){this.storage[i]=s}async _get(i){const s=this.storage[i];return s===void 0?null:s}async _remove(i){delete this.storage[i]}_addListener(i,s){}_removeListener(i,s){}}InMemoryPersistence.type="NONE";const inMemoryPersistence=InMemoryPersistence;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _persistenceKeyName(e,i,s){return`firebase:${e}:${i}:${s}`}class PersistenceUserManager{constructor(i,s,a){this.persistence=i,this.auth=s,this.userKey=a;const{config:_,name:$}=this.auth;this.fullUserKey=_persistenceKeyName(this.userKey,_.apiKey,$),this.fullPersistenceKey=_persistenceKeyName("persistence",_.apiKey,$),this.boundEventHandler=s._onStorageEvent.bind(s),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(i){return this.persistence._set(this.fullUserKey,i.toJSON())}async getCurrentUser(){const i=await this.persistence._get(this.fullUserKey);if(!i)return null;if(typeof i=="string"){const s=await getAccountInfo(this.auth,{idToken:i}).catch(()=>{});return s?UserImpl._fromGetAccountInfoResponse(this.auth,s,i):null}return UserImpl._fromJSON(this.auth,i)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(i){if(this.persistence===i)return;const s=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=i,s)return this.setCurrentUser(s)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(i,s,a="authUser"){if(!s.length)return new PersistenceUserManager(_getInstance(inMemoryPersistence),i,a);const _=(await Promise.all(s.map(async ht=>{if(await ht._isAvailable())return ht}))).filter(ht=>ht);let $=_[0]||_getInstance(inMemoryPersistence);const rt=_persistenceKeyName(a,i.config.apiKey,i.name);let c=null;for(const ht of s)try{const Et=await ht._get(rt);if(Et){let St;if(typeof Et=="string"){const At=await getAccountInfo(i,{idToken:Et}).catch(()=>{});if(!At)break;St=await UserImpl._fromGetAccountInfoResponse(i,At,Et)}else St=UserImpl._fromJSON(i,Et);ht!==$&&(c=St),$=ht;break}}catch{}const dt=_.filter(ht=>ht._shouldAllowMigration);return!$._shouldAllowMigration||!dt.length?new PersistenceUserManager($,i,a):($=dt[0],c&&await $._set(rt,c.toJSON()),await Promise.all(s.map(async ht=>{if(ht!==$)try{await ht._remove(rt)}catch{}})),new PersistenceUserManager($,i,a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _getBrowserName(e){const i=e.toLowerCase();if(i.includes("opera/")||i.includes("opr/")||i.includes("opios/"))return"Opera";if(_isIEMobile(i))return"IEMobile";if(i.includes("msie")||i.includes("trident/"))return"IE";if(i.includes("edge/"))return"Edge";if(_isFirefox(i))return"Firefox";if(i.includes("silk/"))return"Silk";if(_isBlackBerry(i))return"Blackberry";if(_isWebOS(i))return"Webos";if(_isSafari(i))return"Safari";if((i.includes("chrome/")||_isChromeIOS(i))&&!i.includes("edge/"))return"Chrome";if(_isAndroid(i))return"Android";{const s=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,a=e.match(s);if((a==null?void 0:a.length)===2)return a[1]}return"Other"}function _isFirefox(e=getUA()){return/firefox\//i.test(e)}function _isSafari(e=getUA()){const i=e.toLowerCase();return i.includes("safari/")&&!i.includes("chrome/")&&!i.includes("crios/")&&!i.includes("android")}function _isChromeIOS(e=getUA()){return/crios\//i.test(e)}function _isIEMobile(e=getUA()){return/iemobile/i.test(e)}function _isAndroid(e=getUA()){return/android/i.test(e)}function _isBlackBerry(e=getUA()){return/blackberry/i.test(e)}function _isWebOS(e=getUA()){return/webos/i.test(e)}function _isIOS(e=getUA()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function _isIOSStandalone(e=getUA()){var i;return _isIOS(e)&&!!((i=window.navigator)!=null&&i.standalone)}function _isIE10(){return isIE()&&document.documentMode===10}function _isMobileBrowser(e=getUA()){return _isIOS(e)||_isAndroid(e)||_isWebOS(e)||_isBlackBerry(e)||/windows phone/i.test(e)||_isIEMobile(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _getClientVersion(e,i=[]){let s;switch(e){case"Browser":s=_getBrowserName(getUA());break;case"Worker":s=`${_getBrowserName(getUA())}-${e}`;break;default:s=e}const a=i.length?i.join(","):"FirebaseCore-web";return`${s}/JsCore/${SDK_VERSION$1}/${a}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AuthMiddlewareQueue{constructor(i){this.auth=i,this.queue=[]}pushCallback(i,s){const a=$=>new Promise((rt,c)=>{try{const dt=i($);rt(dt)}catch(dt){c(dt)}});a.onAbort=s,this.queue.push(a);const _=this.queue.length-1;return()=>{this.queue[_]=()=>Promise.resolve()}}async runMiddleware(i){if(this.auth.currentUser===i)return;const s=[];try{for(const a of this.queue)await a(i),a.onAbort&&s.push(a.onAbort)}catch(a){s.reverse();for(const _ of s)try{_()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:a==null?void 0:a.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _getPasswordPolicy(e,i={}){return _performApiRequest(e,"GET","/v2/passwordPolicy",_addTidIfNecessary(e,i))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MINIMUM_MIN_PASSWORD_LENGTH=6;class PasswordPolicyImpl{constructor(i){var a;const s=i.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=s.minPasswordLength??MINIMUM_MIN_PASSWORD_LENGTH,s.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=s.maxPasswordLength),s.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=s.containsLowercaseCharacter),s.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=s.containsUppercaseCharacter),s.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=s.containsNumericCharacter),s.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=s.containsNonAlphanumericCharacter),this.enforcementState=i.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=((a=i.allowedNonAlphanumericCharacters)==null?void 0:a.join(""))??"",this.forceUpgradeOnSignin=i.forceUpgradeOnSignin??!1,this.schemaVersion=i.schemaVersion}validatePassword(i){const s={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(i,s),this.validatePasswordCharacterOptions(i,s),s.isValid&&(s.isValid=s.meetsMinPasswordLength??!0),s.isValid&&(s.isValid=s.meetsMaxPasswordLength??!0),s.isValid&&(s.isValid=s.containsLowercaseLetter??!0),s.isValid&&(s.isValid=s.containsUppercaseLetter??!0),s.isValid&&(s.isValid=s.containsNumericCharacter??!0),s.isValid&&(s.isValid=s.containsNonAlphanumericCharacter??!0),s}validatePasswordLengthOptions(i,s){const a=this.customStrengthOptions.minPasswordLength,_=this.customStrengthOptions.maxPasswordLength;a&&(s.meetsMinPasswordLength=i.length>=a),_&&(s.meetsMaxPasswordLength=i.length<=_)}validatePasswordCharacterOptions(i,s){this.updatePasswordCharacterOptionsStatuses(s,!1,!1,!1,!1);let a;for(let _=0;_<i.length;_++)a=i.charAt(_),this.updatePasswordCharacterOptionsStatuses(s,a>="a"&&a<="z",a>="A"&&a<="Z",a>="0"&&a<="9",this.allowedNonAlphanumericCharacters.includes(a))}updatePasswordCharacterOptionsStatuses(i,s,a,_,$){this.customStrengthOptions.containsLowercaseLetter&&(i.containsLowercaseLetter||(i.containsLowercaseLetter=s)),this.customStrengthOptions.containsUppercaseLetter&&(i.containsUppercaseLetter||(i.containsUppercaseLetter=a)),this.customStrengthOptions.containsNumericCharacter&&(i.containsNumericCharacter||(i.containsNumericCharacter=_)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(i.containsNonAlphanumericCharacter||(i.containsNonAlphanumericCharacter=$))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AuthImpl{constructor(i,s,a,_){this.app=i,this.heartbeatServiceProvider=s,this.appCheckServiceProvider=a,this.config=_,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Subscription(this),this.idTokenSubscription=new Subscription(this),this.beforeStateQueue=new AuthMiddlewareQueue(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=_DEFAULT_AUTH_ERROR_FACTORY,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=i.name,this.clientVersion=_.sdkClientVersion,this._persistenceManagerAvailable=new Promise($=>this._resolvePersistenceManagerAvailable=$)}_initializeWithPersistence(i,s){return s&&(this._popupRedirectResolver=_getInstance(s)),this._initializationPromise=this.queue(async()=>{var a,_,$;if(!this._deleted&&(this.persistenceManager=await PersistenceUserManager.create(this,i),(a=this._resolvePersistenceManagerAvailable)==null||a.call(this),!this._deleted)){if((_=this._popupRedirectResolver)!=null&&_._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(s),this.lastNotifiedUid=(($=this.currentUser)==null?void 0:$.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const i=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!i)){if(this.currentUser&&i&&this.currentUser.uid===i.uid){this._currentUser._assign(i),await this.currentUser.getIdToken();return}await this._updateCurrentUser(i,!0)}}async initializeCurrentUserFromIdToken(i){try{const s=await getAccountInfo(this,{idToken:i}),a=await UserImpl._fromGetAccountInfoResponse(this,s,i);await this.directlySetCurrentUser(a)}catch(s){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",s),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(i){var $;if(_isFirebaseServerApp(this.app)){const rt=this.app.settings.authIdToken;return rt?new Promise(c=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(rt).then(c,c))}):this.directlySetCurrentUser(null)}const s=await this.assertedPersistence.getCurrentUser();let a=s,_=!1;if(i&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const rt=($=this.redirectUser)==null?void 0:$._redirectEventId,c=a==null?void 0:a._redirectEventId,dt=await this.tryRedirectSignIn(i);(!rt||rt===c)&&(dt!=null&&dt.user)&&(a=dt.user,_=!0)}if(!a)return this.directlySetCurrentUser(null);if(!a._redirectEventId){if(_)try{await this.beforeStateQueue.runMiddleware(a)}catch(rt){a=s,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(rt))}return a?this.reloadAndSetCurrentUserOrClear(a):this.directlySetCurrentUser(null)}return _assert(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===a._redirectEventId?this.directlySetCurrentUser(a):this.reloadAndSetCurrentUserOrClear(a)}async tryRedirectSignIn(i){let s=null;try{s=await this._popupRedirectResolver._completeRedirectFn(this,i,!0)}catch{await this._setRedirectUser(null)}return s}async reloadAndSetCurrentUserOrClear(i){try{await _reloadWithoutSaving(i)}catch(s){if((s==null?void 0:s.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(i)}useDeviceLanguage(){this.languageCode=_getUserLanguage()}async _delete(){this._deleted=!0}async updateCurrentUser(i){if(_isFirebaseServerApp(this.app))return Promise.reject(_serverAppCurrentUserOperationNotSupportedError(this));const s=i?getModularInstance(i):null;return s&&_assert(s.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(s&&s._clone(this))}async _updateCurrentUser(i,s=!1){if(!this._deleted)return i&&_assert(this.tenantId===i.tenantId,this,"tenant-id-mismatch"),s||await this.beforeStateQueue.runMiddleware(i),this.queue(async()=>{await this.directlySetCurrentUser(i),this.notifyAuthListeners()})}async signOut(){return _isFirebaseServerApp(this.app)?Promise.reject(_serverAppCurrentUserOperationNotSupportedError(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(i){return _isFirebaseServerApp(this.app)?Promise.reject(_serverAppCurrentUserOperationNotSupportedError(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(_getInstance(i))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(i){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const s=this._getPasswordPolicyInternal();return s.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):s.validatePassword(i)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const i=await _getPasswordPolicy(this),s=new PasswordPolicyImpl(i);this.tenantId===null?this._projectPasswordPolicy=s:this._tenantPasswordPolicies[this.tenantId]=s}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(i){this._errorFactory=new ErrorFactory("auth","Firebase",i())}onAuthStateChanged(i,s,a){return this.registerStateListener(this.authStateSubscription,i,s,a)}beforeAuthStateChanged(i,s){return this.beforeStateQueue.pushCallback(i,s)}onIdTokenChanged(i,s,a){return this.registerStateListener(this.idTokenSubscription,i,s,a)}authStateReady(){return new Promise((i,s)=>{if(this.currentUser)i();else{const a=this.onAuthStateChanged(()=>{a(),i()},s)}})}async revokeAccessToken(i){if(this.currentUser){const s=await this.currentUser.getIdToken(),a={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:i,idToken:s};this.tenantId!=null&&(a.tenantId=this.tenantId),await revokeToken(this,a)}}toJSON(){var i;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(i=this._currentUser)==null?void 0:i.toJSON()}}async _setRedirectUser(i,s){const a=await this.getOrInitRedirectPersistenceManager(s);return i===null?a.removeCurrentUser():a.setCurrentUser(i)}async getOrInitRedirectPersistenceManager(i){if(!this.redirectPersistenceManager){const s=i&&_getInstance(i)||this._popupRedirectResolver;_assert(s,this,"argument-error"),this.redirectPersistenceManager=await PersistenceUserManager.create(this,[_getInstance(s._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(i){var s,a;return this._isInitialized&&await this.queue(async()=>{}),((s=this._currentUser)==null?void 0:s._redirectEventId)===i?this._currentUser:((a=this.redirectUser)==null?void 0:a._redirectEventId)===i?this.redirectUser:null}async _persistUserIfCurrent(i){if(i===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(i))}_notifyListenersIfCurrent(i){i===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var s;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const i=((s=this.currentUser)==null?void 0:s.uid)??null;this.lastNotifiedUid!==i&&(this.lastNotifiedUid=i,this.authStateSubscription.next(this.currentUser))}registerStateListener(i,s,a,_){if(this._deleted)return()=>{};const $=typeof s=="function"?s:s.next.bind(s);let rt=!1;const c=this._isInitialized?Promise.resolve():this._initializationPromise;if(_assert(c,this,"internal-error"),c.then(()=>{rt||$(this.currentUser)}),typeof s=="function"){const dt=i.addObserver(s,a,_);return()=>{rt=!0,dt()}}else{const dt=i.addObserver(s);return()=>{rt=!0,dt()}}}async directlySetCurrentUser(i){this.currentUser&&this.currentUser!==i&&this._currentUser._stopProactiveRefresh(),i&&this.isProactiveRefreshEnabled&&i._startProactiveRefresh(),this.currentUser=i,i?await this.assertedPersistence.setCurrentUser(i):await this.assertedPersistence.removeCurrentUser()}queue(i){return this.operations=this.operations.then(i,i),this.operations}get assertedPersistence(){return _assert(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(i){!i||this.frameworks.includes(i)||(this.frameworks.push(i),this.frameworks.sort(),this.clientVersion=_getClientVersion(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var _;const i={"X-Client-Version":this.clientVersion};this.app.options.appId&&(i["X-Firebase-gmpid"]=this.app.options.appId);const s=await((_=this.heartbeatServiceProvider.getImmediate({optional:!0}))==null?void 0:_.getHeartbeatsHeader());s&&(i["X-Firebase-Client"]=s);const a=await this._getAppCheckToken();return a&&(i["X-Firebase-AppCheck"]=a),i}async _getAppCheckToken(){var s;if(_isFirebaseServerApp(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const i=await((s=this.appCheckServiceProvider.getImmediate({optional:!0}))==null?void 0:s.getToken());return i!=null&&i.error&&_logWarn(`Error while retrieving App Check token: ${i.error}`),i==null?void 0:i.token}}function _castAuth(e){return getModularInstance(e)}class Subscription{constructor(i){this.auth=i,this.observer=null,this.addObserver=createSubscribe(s=>this.observer=s)}get next(){return _assert(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let externalJSProvider={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function _setExternalJSProvider(e){externalJSProvider=e}function _loadJS(e){return externalJSProvider.loadJS(e)}function _recaptchaEnterpriseScriptUrl(){return externalJSProvider.recaptchaEnterpriseScript}function _gapiScriptUrl(){return externalJSProvider.gapiScript}function _generateCallbackName(e){return`__${e}${Math.floor(Math.random()*1e6)}`}class MockGreCAPTCHATopLevel{constructor(){this.enterprise=new MockGreCAPTCHA}ready(i){i()}execute(i,s){return Promise.resolve("token")}render(i,s){return""}}class MockGreCAPTCHA{ready(i){i()}execute(i,s){return Promise.resolve("token")}render(i,s){return""}}const RECAPTCHA_ENTERPRISE_VERIFIER_TYPE="recaptcha-enterprise",FAKE_TOKEN="NO_RECAPTCHA";class RecaptchaEnterpriseVerifier{constructor(i){this.type=RECAPTCHA_ENTERPRISE_VERIFIER_TYPE,this.auth=_castAuth(i)}async verify(i="verify",s=!1){async function a($){if(!s){if($.tenantId==null&&$._agentRecaptchaConfig!=null)return $._agentRecaptchaConfig.siteKey;if($.tenantId!=null&&$._tenantRecaptchaConfigs[$.tenantId]!==void 0)return $._tenantRecaptchaConfigs[$.tenantId].siteKey}return new Promise(async(rt,c)=>{getRecaptchaConfig($,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(dt=>{if(dt.recaptchaKey===void 0)c(new Error("recaptcha Enterprise site key undefined"));else{const ht=new RecaptchaConfig(dt);return $.tenantId==null?$._agentRecaptchaConfig=ht:$._tenantRecaptchaConfigs[$.tenantId]=ht,rt(ht.siteKey)}}).catch(dt=>{c(dt)})})}function _($,rt,c){const dt=window.grecaptcha;isEnterprise(dt)?dt.enterprise.ready(()=>{dt.enterprise.execute($,{action:i}).then(ht=>{rt(ht)}).catch(()=>{rt(FAKE_TOKEN)})}):c(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new MockGreCAPTCHATopLevel().execute("siteKey",{action:"verify"}):new Promise(($,rt)=>{a(this.auth).then(c=>{if(!s&&isEnterprise(window.grecaptcha))_(c,$,rt);else{if(typeof window>"u"){rt(new Error("RecaptchaVerifier is only supported in browser"));return}let dt=_recaptchaEnterpriseScriptUrl();dt.length!==0&&(dt+=c),_loadJS(dt).then(()=>{_(c,$,rt)}).catch(ht=>{rt(ht)})}}).catch(c=>{rt(c)})})}}async function injectRecaptchaFields(e,i,s,a=!1,_=!1){const $=new RecaptchaEnterpriseVerifier(e);let rt;if(_)rt=FAKE_TOKEN;else try{rt=await $.verify(s)}catch{rt=await $.verify(s,!0)}const c={...i};if(s==="mfaSmsEnrollment"||s==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in c){const dt=c.phoneEnrollmentInfo.phoneNumber,ht=c.phoneEnrollmentInfo.recaptchaToken;Object.assign(c,{phoneEnrollmentInfo:{phoneNumber:dt,recaptchaToken:ht,captchaResponse:rt,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in c){const dt=c.phoneSignInInfo.recaptchaToken;Object.assign(c,{phoneSignInInfo:{recaptchaToken:dt,captchaResponse:rt,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return c}return a?Object.assign(c,{captchaResp:rt}):Object.assign(c,{captchaResponse:rt}),Object.assign(c,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(c,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),c}async function handleRecaptchaFlow(e,i,s,a,_){var $;if(($=e._getRecaptchaConfig())!=null&&$.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const rt=await injectRecaptchaFields(e,i,s,s==="getOobCode");return a(e,rt)}else return a(e,i).catch(async rt=>{if(rt.code==="auth/missing-recaptcha-token"){console.log(`${s} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const c=await injectRecaptchaFields(e,i,s,s==="getOobCode");return a(e,c)}else return Promise.reject(rt)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function initializeAuth(e,i){const s=_getProvider(e,"auth");if(s.isInitialized()){const _=s.getImmediate(),$=s.getOptions();if(deepEqual($,i??{}))return _;_fail(_,"already-initialized")}return s.initialize({options:i})}function _initializeAuthInstance(e,i){const s=(i==null?void 0:i.persistence)||[],a=(Array.isArray(s)?s:[s]).map(_getInstance);i!=null&&i.errorMap&&e._updateErrorMap(i.errorMap),e._initializeWithPersistence(a,i==null?void 0:i.popupRedirectResolver)}function connectAuthEmulator(e,i,s){const a=_castAuth(e);_assert(/^https?:\/\//.test(i),a,"invalid-emulator-scheme");const _=!!(s!=null&&s.disableWarnings),$=extractProtocol(i),{host:rt,port:c}=extractHostAndPort(i),dt=c===null?"":`:${c}`,ht={url:`${$}//${rt}${dt}/`},Et=Object.freeze({host:rt,port:c,protocol:$.replace(":",""),options:Object.freeze({disableWarnings:_})});if(!a._canInitEmulator){_assert(a.config.emulator&&a.emulatorConfig,a,"emulator-config-failed"),_assert(deepEqual(ht,a.config.emulator)&&deepEqual(Et,a.emulatorConfig),a,"emulator-config-failed");return}a.config.emulator=ht,a.emulatorConfig=Et,a.settings.appVerificationDisabledForTesting=!0,isCloudWorkstation(rt)?(pingServer(`${$}//${rt}${dt}`),updateEmulatorBanner("Auth",!0)):emitEmulatorWarning()}function extractProtocol(e){const i=e.indexOf(":");return i<0?"":e.substr(0,i+1)}function extractHostAndPort(e){const i=extractProtocol(e),s=/(\/\/)?([^?#/]+)/.exec(e.substr(i.length));if(!s)return{host:"",port:null};const a=s[2].split("@").pop()||"",_=/^(\[[^\]]+\])(:|$)/.exec(a);if(_){const $=_[1];return{host:$,port:parsePort(a.substr($.length+1))}}else{const[$,rt]=a.split(":");return{host:$,port:parsePort(rt)}}}function parsePort(e){if(!e)return null;const i=Number(e);return isNaN(i)?null:i}function emitEmulatorWarning(){function e(){const i=document.createElement("p"),s=i.style;i.innerText="Running in emulator mode. Do not use with production credentials.",s.position="fixed",s.width="100%",s.backgroundColor="#ffffff",s.border=".1em solid #000000",s.color="#b50000",s.bottom="0px",s.left="0px",s.margin="0px",s.zIndex="10000",s.textAlign="center",i.classList.add("firebase-emulator-warning"),document.body.appendChild(i)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",e):e())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AuthCredential{constructor(i,s){this.providerId=i,this.signInMethod=s}toJSON(){return debugFail("not implemented")}_getIdTokenResponse(i){return debugFail("not implemented")}_linkToIdToken(i,s){return debugFail("not implemented")}_getReauthenticationResolver(i){return debugFail("not implemented")}}async function linkEmailPassword(e,i){return _performApiRequest(e,"POST","/v1/accounts:signUp",i)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function signInWithPassword(e,i){return _performSignInRequest(e,"POST","/v1/accounts:signInWithPassword",_addTidIfNecessary(e,i))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function signInWithEmailLink$1(e,i){return _performSignInRequest(e,"POST","/v1/accounts:signInWithEmailLink",_addTidIfNecessary(e,i))}async function signInWithEmailLinkForLinking(e,i){return _performSignInRequest(e,"POST","/v1/accounts:signInWithEmailLink",_addTidIfNecessary(e,i))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EmailAuthCredential extends AuthCredential{constructor(i,s,a,_=null){super("password",a),this._email=i,this._password=s,this._tenantId=_}static _fromEmailAndPassword(i,s){return new EmailAuthCredential(i,s,"password")}static _fromEmailAndCode(i,s,a=null){return new EmailAuthCredential(i,s,"emailLink",a)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(i){const s=typeof i=="string"?JSON.parse(i):i;if(s!=null&&s.email&&(s!=null&&s.password)){if(s.signInMethod==="password")return this._fromEmailAndPassword(s.email,s.password);if(s.signInMethod==="emailLink")return this._fromEmailAndCode(s.email,s.password,s.tenantId)}return null}async _getIdTokenResponse(i){switch(this.signInMethod){case"password":const s={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return handleRecaptchaFlow(i,s,"signInWithPassword",signInWithPassword);case"emailLink":return signInWithEmailLink$1(i,{email:this._email,oobCode:this._password});default:_fail(i,"internal-error")}}async _linkToIdToken(i,s){switch(this.signInMethod){case"password":const a={idToken:s,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return handleRecaptchaFlow(i,a,"signUpPassword",linkEmailPassword);case"emailLink":return signInWithEmailLinkForLinking(i,{idToken:s,email:this._email,oobCode:this._password});default:_fail(i,"internal-error")}}_getReauthenticationResolver(i){return this._getIdTokenResponse(i)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function signInWithIdp(e,i){return _performSignInRequest(e,"POST","/v1/accounts:signInWithIdp",_addTidIfNecessary(e,i))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IDP_REQUEST_URI$1="http://localhost";class OAuthCredential extends AuthCredential{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(i){const s=new OAuthCredential(i.providerId,i.signInMethod);return i.idToken||i.accessToken?(i.idToken&&(s.idToken=i.idToken),i.accessToken&&(s.accessToken=i.accessToken),i.nonce&&!i.pendingToken&&(s.nonce=i.nonce),i.pendingToken&&(s.pendingToken=i.pendingToken)):i.oauthToken&&i.oauthTokenSecret?(s.accessToken=i.oauthToken,s.secret=i.oauthTokenSecret):_fail("argument-error"),s}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(i){const s=typeof i=="string"?JSON.parse(i):i,{providerId:a,signInMethod:_,...$}=s;if(!a||!_)return null;const rt=new OAuthCredential(a,_);return rt.idToken=$.idToken||void 0,rt.accessToken=$.accessToken||void 0,rt.secret=$.secret,rt.nonce=$.nonce,rt.pendingToken=$.pendingToken||null,rt}_getIdTokenResponse(i){const s=this.buildRequest();return signInWithIdp(i,s)}_linkToIdToken(i,s){const a=this.buildRequest();return a.idToken=s,signInWithIdp(i,a)}_getReauthenticationResolver(i){const s=this.buildRequest();return s.autoCreate=!1,signInWithIdp(i,s)}buildRequest(){const i={requestUri:IDP_REQUEST_URI$1,returnSecureToken:!0};if(this.pendingToken)i.pendingToken=this.pendingToken;else{const s={};this.idToken&&(s.id_token=this.idToken),this.accessToken&&(s.access_token=this.accessToken),this.secret&&(s.oauth_token_secret=this.secret),s.providerId=this.providerId,this.nonce&&!this.pendingToken&&(s.nonce=this.nonce),i.postBody=querystring(s)}return i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function parseMode(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function parseDeepLink(e){const i=querystringDecode(extractQuerystring(e)).link,s=i?querystringDecode(extractQuerystring(i)).deep_link_id:null,a=querystringDecode(extractQuerystring(e)).deep_link_id;return(a?querystringDecode(extractQuerystring(a)).link:null)||a||s||i||e}class ActionCodeURL{constructor(i){const s=querystringDecode(extractQuerystring(i)),a=s.apiKey??null,_=s.oobCode??null,$=parseMode(s.mode??null);_assert(a&&_&&$,"argument-error"),this.apiKey=a,this.operation=$,this.code=_,this.continueUrl=s.continueUrl??null,this.languageCode=s.lang??null,this.tenantId=s.tenantId??null}static parseLink(i){const s=parseDeepLink(i);try{return new ActionCodeURL(s)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EmailAuthProvider{constructor(){this.providerId=EmailAuthProvider.PROVIDER_ID}static credential(i,s){return EmailAuthCredential._fromEmailAndPassword(i,s)}static credentialWithLink(i,s){const a=ActionCodeURL.parseLink(s);return _assert(a,"argument-error"),EmailAuthCredential._fromEmailAndCode(i,a.code,a.tenantId)}}EmailAuthProvider.PROVIDER_ID="password";EmailAuthProvider.EMAIL_PASSWORD_SIGN_IN_METHOD="password";EmailAuthProvider.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FederatedAuthProvider{constructor(i){this.providerId=i,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(i){this.defaultLanguageCode=i}setCustomParameters(i){return this.customParameters=i,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BaseOAuthProvider extends FederatedAuthProvider{constructor(){super(...arguments),this.scopes=[]}addScope(i){return this.scopes.includes(i)||this.scopes.push(i),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FacebookAuthProvider extends BaseOAuthProvider{constructor(){super("facebook.com")}static credential(i){return OAuthCredential._fromParams({providerId:FacebookAuthProvider.PROVIDER_ID,signInMethod:FacebookAuthProvider.FACEBOOK_SIGN_IN_METHOD,accessToken:i})}static credentialFromResult(i){return FacebookAuthProvider.credentialFromTaggedObject(i)}static credentialFromError(i){return FacebookAuthProvider.credentialFromTaggedObject(i.customData||{})}static credentialFromTaggedObject({_tokenResponse:i}){if(!i||!("oauthAccessToken"in i)||!i.oauthAccessToken)return null;try{return FacebookAuthProvider.credential(i.oauthAccessToken)}catch{return null}}}FacebookAuthProvider.FACEBOOK_SIGN_IN_METHOD="facebook.com";FacebookAuthProvider.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GoogleAuthProvider extends BaseOAuthProvider{constructor(){super("google.com"),this.addScope("profile")}static credential(i,s){return OAuthCredential._fromParams({providerId:GoogleAuthProvider.PROVIDER_ID,signInMethod:GoogleAuthProvider.GOOGLE_SIGN_IN_METHOD,idToken:i,accessToken:s})}static credentialFromResult(i){return GoogleAuthProvider.credentialFromTaggedObject(i)}static credentialFromError(i){return GoogleAuthProvider.credentialFromTaggedObject(i.customData||{})}static credentialFromTaggedObject({_tokenResponse:i}){if(!i)return null;const{oauthIdToken:s,oauthAccessToken:a}=i;if(!s&&!a)return null;try{return GoogleAuthProvider.credential(s,a)}catch{return null}}}GoogleAuthProvider.GOOGLE_SIGN_IN_METHOD="google.com";GoogleAuthProvider.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GithubAuthProvider extends BaseOAuthProvider{constructor(){super("github.com")}static credential(i){return OAuthCredential._fromParams({providerId:GithubAuthProvider.PROVIDER_ID,signInMethod:GithubAuthProvider.GITHUB_SIGN_IN_METHOD,accessToken:i})}static credentialFromResult(i){return GithubAuthProvider.credentialFromTaggedObject(i)}static credentialFromError(i){return GithubAuthProvider.credentialFromTaggedObject(i.customData||{})}static credentialFromTaggedObject({_tokenResponse:i}){if(!i||!("oauthAccessToken"in i)||!i.oauthAccessToken)return null;try{return GithubAuthProvider.credential(i.oauthAccessToken)}catch{return null}}}GithubAuthProvider.GITHUB_SIGN_IN_METHOD="github.com";GithubAuthProvider.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TwitterAuthProvider extends BaseOAuthProvider{constructor(){super("twitter.com")}static credential(i,s){return OAuthCredential._fromParams({providerId:TwitterAuthProvider.PROVIDER_ID,signInMethod:TwitterAuthProvider.TWITTER_SIGN_IN_METHOD,oauthToken:i,oauthTokenSecret:s})}static credentialFromResult(i){return TwitterAuthProvider.credentialFromTaggedObject(i)}static credentialFromError(i){return TwitterAuthProvider.credentialFromTaggedObject(i.customData||{})}static credentialFromTaggedObject({_tokenResponse:i}){if(!i)return null;const{oauthAccessToken:s,oauthTokenSecret:a}=i;if(!s||!a)return null;try{return TwitterAuthProvider.credential(s,a)}catch{return null}}}TwitterAuthProvider.TWITTER_SIGN_IN_METHOD="twitter.com";TwitterAuthProvider.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function signUp(e,i){return _performSignInRequest(e,"POST","/v1/accounts:signUp",_addTidIfNecessary(e,i))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UserCredentialImpl{constructor(i){this.user=i.user,this.providerId=i.providerId,this._tokenResponse=i._tokenResponse,this.operationType=i.operationType}static async _fromIdTokenResponse(i,s,a,_=!1){const $=await UserImpl._fromIdTokenResponse(i,a,_),rt=providerIdForResponse(a);return new UserCredentialImpl({user:$,providerId:rt,_tokenResponse:a,operationType:s})}static async _forOperation(i,s,a){await i._updateTokensIfNecessary(a,!0);const _=providerIdForResponse(a);return new UserCredentialImpl({user:i,providerId:_,_tokenResponse:a,operationType:s})}}function providerIdForResponse(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MultiFactorError extends FirebaseError{constructor(i,s,a,_){super(s.code,s.message),this.operationType=a,this.user=_,Object.setPrototypeOf(this,MultiFactorError.prototype),this.customData={appName:i.name,tenantId:i.tenantId??void 0,_serverResponse:s.customData._serverResponse,operationType:a}}static _fromErrorAndOperation(i,s,a,_){return new MultiFactorError(i,s,a,_)}}function _processCredentialSavingMfaContextIfNecessary(e,i,s,a){return(i==="reauthenticate"?s._getReauthenticationResolver(e):s._getIdTokenResponse(e)).catch($=>{throw $.code==="auth/multi-factor-auth-required"?MultiFactorError._fromErrorAndOperation(e,$,i,a):$})}async function _link$1(e,i,s=!1){const a=await _logoutIfInvalidated(e,i._linkToIdToken(e.auth,await e.getIdToken()),s);return UserCredentialImpl._forOperation(e,"link",a)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _reauthenticate(e,i,s=!1){const{auth:a}=e;if(_isFirebaseServerApp(a.app))return Promise.reject(_serverAppCurrentUserOperationNotSupportedError(a));const _="reauthenticate";try{const $=await _logoutIfInvalidated(e,_processCredentialSavingMfaContextIfNecessary(a,_,i,e),s);_assert($.idToken,a,"internal-error");const rt=_parseToken($.idToken);_assert(rt,a,"internal-error");const{sub:c}=rt;return _assert(e.uid===c,a,"user-mismatch"),UserCredentialImpl._forOperation(e,_,$)}catch($){throw($==null?void 0:$.code)==="auth/user-not-found"&&_fail(a,"user-mismatch"),$}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _signInWithCredential(e,i,s=!1){if(_isFirebaseServerApp(e.app))return Promise.reject(_serverAppCurrentUserOperationNotSupportedError(e));const a="signIn",_=await _processCredentialSavingMfaContextIfNecessary(e,a,i),$=await UserCredentialImpl._fromIdTokenResponse(e,a,_);return s||await e._updateCurrentUser($.user),$}async function signInWithCredential(e,i){return _signInWithCredential(_castAuth(e),i)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function recachePasswordPolicy(e){const i=_castAuth(e);i._getPasswordPolicyInternal()&&await i._updatePasswordPolicy()}async function createUserWithEmailAndPassword(e,i,s){if(_isFirebaseServerApp(e.app))return Promise.reject(_serverAppCurrentUserOperationNotSupportedError(e));const a=_castAuth(e),rt=await handleRecaptchaFlow(a,{returnSecureToken:!0,email:i,password:s,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",signUp).catch(dt=>{throw dt.code==="auth/password-does-not-meet-requirements"&&recachePasswordPolicy(e),dt}),c=await UserCredentialImpl._fromIdTokenResponse(a,"signIn",rt);return await a._updateCurrentUser(c.user),c}function signInWithEmailAndPassword(e,i,s){return _isFirebaseServerApp(e.app)?Promise.reject(_serverAppCurrentUserOperationNotSupportedError(e)):signInWithCredential(getModularInstance(e),EmailAuthProvider.credential(i,s)).catch(async a=>{throw a.code==="auth/password-does-not-meet-requirements"&&recachePasswordPolicy(e),a})}function onIdTokenChanged(e,i,s,a){return getModularInstance(e).onIdTokenChanged(i,s,a)}function beforeAuthStateChanged(e,i,s){return getModularInstance(e).beforeAuthStateChanged(i,s)}function signOut(e){return getModularInstance(e).signOut()}const STORAGE_AVAILABLE_KEY="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BrowserPersistenceClass{constructor(i,s){this.storageRetriever=i,this.type=s}_isAvailable(){try{return this.storage?(this.storage.setItem(STORAGE_AVAILABLE_KEY,"1"),this.storage.removeItem(STORAGE_AVAILABLE_KEY),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(i,s){return this.storage.setItem(i,JSON.stringify(s)),Promise.resolve()}_get(i){const s=this.storage.getItem(i);return Promise.resolve(s?JSON.parse(s):null)}_remove(i){return this.storage.removeItem(i),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _POLLING_INTERVAL_MS$1=1e3,IE10_LOCAL_STORAGE_SYNC_DELAY=10;class BrowserLocalPersistence extends BrowserPersistenceClass{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(i,s)=>this.onStorageEvent(i,s),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=_isMobileBrowser(),this._shouldAllowMigration=!0}forAllChangedKeys(i){for(const s of Object.keys(this.listeners)){const a=this.storage.getItem(s),_=this.localCache[s];a!==_&&i(s,_,a)}}onStorageEvent(i,s=!1){if(!i.key){this.forAllChangedKeys((rt,c,dt)=>{this.notifyListeners(rt,dt)});return}const a=i.key;s?this.detachListener():this.stopPolling();const _=()=>{const rt=this.storage.getItem(a);!s&&this.localCache[a]===rt||this.notifyListeners(a,rt)},$=this.storage.getItem(a);_isIE10()&&$!==i.newValue&&i.newValue!==i.oldValue?setTimeout(_,IE10_LOCAL_STORAGE_SYNC_DELAY):_()}notifyListeners(i,s){this.localCache[i]=s;const a=this.listeners[i];if(a)for(const _ of Array.from(a))_(s&&JSON.parse(s))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((i,s,a)=>{this.onStorageEvent(new StorageEvent("storage",{key:i,oldValue:s,newValue:a}),!0)})},_POLLING_INTERVAL_MS$1)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(i,s){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[i]||(this.listeners[i]=new Set,this.localCache[i]=this.storage.getItem(i)),this.listeners[i].add(s)}_removeListener(i,s){this.listeners[i]&&(this.listeners[i].delete(s),this.listeners[i].size===0&&delete this.listeners[i]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(i,s){await super._set(i,s),this.localCache[i]=JSON.stringify(s)}async _get(i){const s=await super._get(i);return this.localCache[i]=JSON.stringify(s),s}async _remove(i){await super._remove(i),delete this.localCache[i]}}BrowserLocalPersistence.type="LOCAL";const browserLocalPersistence=BrowserLocalPersistence;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BrowserSessionPersistence extends BrowserPersistenceClass{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(i,s){}_removeListener(i,s){}}BrowserSessionPersistence.type="SESSION";const browserSessionPersistence=BrowserSessionPersistence;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _allSettled(e){return Promise.all(e.map(async i=>{try{return{fulfilled:!0,value:await i}}catch(s){return{fulfilled:!1,reason:s}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Receiver{constructor(i){this.eventTarget=i,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(i){const s=this.receivers.find(_=>_.isListeningto(i));if(s)return s;const a=new Receiver(i);return this.receivers.push(a),a}isListeningto(i){return this.eventTarget===i}async handleEvent(i){const s=i,{eventId:a,eventType:_,data:$}=s.data,rt=this.handlersMap[_];if(!(rt!=null&&rt.size))return;s.ports[0].postMessage({status:"ack",eventId:a,eventType:_});const c=Array.from(rt).map(async ht=>ht(s.origin,$)),dt=await _allSettled(c);s.ports[0].postMessage({status:"done",eventId:a,eventType:_,response:dt})}_subscribe(i,s){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[i]||(this.handlersMap[i]=new Set),this.handlersMap[i].add(s)}_unsubscribe(i,s){this.handlersMap[i]&&s&&this.handlersMap[i].delete(s),(!s||this.handlersMap[i].size===0)&&delete this.handlersMap[i],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Receiver.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _generateEventId(e="",i=10){let s="";for(let a=0;a<i;a++)s+=Math.floor(Math.random()*10);return e+s}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sender{constructor(i){this.target=i,this.handlers=new Set}removeMessageHandler(i){i.messageChannel&&(i.messageChannel.port1.removeEventListener("message",i.onMessage),i.messageChannel.port1.close()),this.handlers.delete(i)}async _send(i,s,a=50){const _=typeof MessageChannel<"u"?new MessageChannel:null;if(!_)throw new Error("connection_unavailable");let $,rt;return new Promise((c,dt)=>{const ht=_generateEventId("",20);_.port1.start();const Et=setTimeout(()=>{dt(new Error("unsupported_event"))},a);rt={messageChannel:_,onMessage(St){const At=St;if(At.data.eventId===ht)switch(At.data.status){case"ack":clearTimeout(Et),$=setTimeout(()=>{dt(new Error("timeout"))},3e3);break;case"done":clearTimeout($),c(At.data.response);break;default:clearTimeout(Et),clearTimeout($),dt(new Error("invalid_response"));break}}},this.handlers.add(rt),_.port1.addEventListener("message",rt.onMessage),this.target.postMessage({eventType:i,eventId:ht,data:s},[_.port2])}).finally(()=>{rt&&this.removeMessageHandler(rt)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _window(){return window}function _setWindowLocation(e){_window().location.href=e}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _isWorker(){return typeof _window().WorkerGlobalScope<"u"&&typeof _window().importScripts=="function"}async function _getActiveServiceWorker(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function _getServiceWorkerController(){var e;return((e=navigator==null?void 0:navigator.serviceWorker)==null?void 0:e.controller)||null}function _getWorkerGlobalScope(){return _isWorker()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DB_NAME="firebaseLocalStorageDb",DB_VERSION=1,DB_OBJECTSTORE_NAME="firebaseLocalStorage",DB_DATA_KEYPATH="fbase_key";class DBPromise{constructor(i){this.request=i}toPromise(){return new Promise((i,s)=>{this.request.addEventListener("success",()=>{i(this.request.result)}),this.request.addEventListener("error",()=>{s(this.request.error)})})}}function getObjectStore(e,i){return e.transaction([DB_OBJECTSTORE_NAME],i?"readwrite":"readonly").objectStore(DB_OBJECTSTORE_NAME)}function _deleteDatabase(){const e=indexedDB.deleteDatabase(DB_NAME);return new DBPromise(e).toPromise()}function _openDatabase(){const e=indexedDB.open(DB_NAME,DB_VERSION);return new Promise((i,s)=>{e.addEventListener("error",()=>{s(e.error)}),e.addEventListener("upgradeneeded",()=>{const a=e.result;try{a.createObjectStore(DB_OBJECTSTORE_NAME,{keyPath:DB_DATA_KEYPATH})}catch(_){s(_)}}),e.addEventListener("success",async()=>{const a=e.result;a.objectStoreNames.contains(DB_OBJECTSTORE_NAME)?i(a):(a.close(),await _deleteDatabase(),i(await _openDatabase()))})})}async function _putObject(e,i,s){const a=getObjectStore(e,!0).put({[DB_DATA_KEYPATH]:i,value:s});return new DBPromise(a).toPromise()}async function getObject(e,i){const s=getObjectStore(e,!1).get(i),a=await new DBPromise(s).toPromise();return a===void 0?null:a.value}function _deleteObject(e,i){const s=getObjectStore(e,!0).delete(i);return new DBPromise(s).toPromise()}const _POLLING_INTERVAL_MS=800,_TRANSACTION_RETRY_COUNT=3;class IndexedDBLocalPersistence{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await _openDatabase(),this.db)}async _withRetries(i){let s=0;for(;;)try{const a=await this._openDb();return await i(a)}catch(a){if(s++>_TRANSACTION_RETRY_COUNT)throw a;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return _isWorker()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Receiver._getInstance(_getWorkerGlobalScope()),this.receiver._subscribe("keyChanged",async(i,s)=>({keyProcessed:(await this._poll()).includes(s.key)})),this.receiver._subscribe("ping",async(i,s)=>["keyChanged"])}async initializeSender(){var s,a;if(this.activeServiceWorker=await _getActiveServiceWorker(),!this.activeServiceWorker)return;this.sender=new Sender(this.activeServiceWorker);const i=await this.sender._send("ping",{},800);i&&(s=i[0])!=null&&s.fulfilled&&(a=i[0])!=null&&a.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(i){if(!(!this.sender||!this.activeServiceWorker||_getServiceWorkerController()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:i},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const i=await _openDatabase();return await _putObject(i,STORAGE_AVAILABLE_KEY,"1"),await _deleteObject(i,STORAGE_AVAILABLE_KEY),!0}catch{}return!1}async _withPendingWrite(i){this.pendingWrites++;try{await i()}finally{this.pendingWrites--}}async _set(i,s){return this._withPendingWrite(async()=>(await this._withRetries(a=>_putObject(a,i,s)),this.localCache[i]=s,this.notifyServiceWorker(i)))}async _get(i){const s=await this._withRetries(a=>getObject(a,i));return this.localCache[i]=s,s}async _remove(i){return this._withPendingWrite(async()=>(await this._withRetries(s=>_deleteObject(s,i)),delete this.localCache[i],this.notifyServiceWorker(i)))}async _poll(){const i=await this._withRetries(_=>{const $=getObjectStore(_,!1).getAll();return new DBPromise($).toPromise()});if(!i)return[];if(this.pendingWrites!==0)return[];const s=[],a=new Set;if(i.length!==0)for(const{fbase_key:_,value:$}of i)a.add(_),JSON.stringify(this.localCache[_])!==JSON.stringify($)&&(this.notifyListeners(_,$),s.push(_));for(const _ of Object.keys(this.localCache))this.localCache[_]&&!a.has(_)&&(this.notifyListeners(_,null),s.push(_));return s}notifyListeners(i,s){this.localCache[i]=s;const a=this.listeners[i];if(a)for(const _ of Array.from(a))_(s)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),_POLLING_INTERVAL_MS)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(i,s){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[i]||(this.listeners[i]=new Set,this._get(i)),this.listeners[i].add(s)}_removeListener(i,s){this.listeners[i]&&(this.listeners[i].delete(s),this.listeners[i].size===0&&delete this.listeners[i]),Object.keys(this.listeners).length===0&&this.stopPolling()}}IndexedDBLocalPersistence.type="LOCAL";const indexedDBLocalPersistence=IndexedDBLocalPersistence;new Delay(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _withDefaultResolver(e,i){return i?_getInstance(i):(_assert(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IdpCredential extends AuthCredential{constructor(i){super("custom","custom"),this.params=i}_getIdTokenResponse(i){return signInWithIdp(i,this._buildIdpRequest())}_linkToIdToken(i,s){return signInWithIdp(i,this._buildIdpRequest(s))}_getReauthenticationResolver(i){return signInWithIdp(i,this._buildIdpRequest())}_buildIdpRequest(i){const s={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return i&&(s.idToken=i),s}}function _signIn(e){return _signInWithCredential(e.auth,new IdpCredential(e),e.bypassAuthState)}function _reauth(e){const{auth:i,user:s}=e;return _assert(s,i,"internal-error"),_reauthenticate(s,new IdpCredential(e),e.bypassAuthState)}async function _link(e){const{auth:i,user:s}=e;return _assert(s,i,"internal-error"),_link$1(s,new IdpCredential(e),e.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AbstractPopupRedirectOperation{constructor(i,s,a,_,$=!1){this.auth=i,this.resolver=a,this.user=_,this.bypassAuthState=$,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(s)?s:[s]}execute(){return new Promise(async(i,s)=>{this.pendingPromise={resolve:i,reject:s};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(a){this.reject(a)}})}async onAuthEvent(i){const{urlResponse:s,sessionId:a,postBody:_,tenantId:$,error:rt,type:c}=i;if(rt){this.reject(rt);return}const dt={auth:this.auth,requestUri:s,sessionId:a,tenantId:$||void 0,postBody:_||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(c)(dt))}catch(ht){this.reject(ht)}}onError(i){this.reject(i)}getIdpTask(i){switch(i){case"signInViaPopup":case"signInViaRedirect":return _signIn;case"linkViaPopup":case"linkViaRedirect":return _link;case"reauthViaPopup":case"reauthViaRedirect":return _reauth;default:_fail(this.auth,"internal-error")}}resolve(i){debugAssert(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(i),this.unregisterAndCleanUp()}reject(i){debugAssert(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(i),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _POLL_WINDOW_CLOSE_TIMEOUT=new Delay(2e3,1e4);class PopupOperation extends AbstractPopupRedirectOperation{constructor(i,s,a,_,$){super(i,s,_,$),this.provider=a,this.authWindow=null,this.pollId=null,PopupOperation.currentPopupAction&&PopupOperation.currentPopupAction.cancel(),PopupOperation.currentPopupAction=this}async executeNotNull(){const i=await this.execute();return _assert(i,this.auth,"internal-error"),i}async onExecution(){debugAssert(this.filter.length===1,"Popup operations only handle one event");const i=_generateEventId();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],i),this.authWindow.associatedEvent=i,this.resolver._originValidation(this.auth).catch(s=>{this.reject(s)}),this.resolver._isIframeWebStorageSupported(this.auth,s=>{s||this.reject(_createError(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var i;return((i=this.authWindow)==null?void 0:i.associatedEvent)||null}cancel(){this.reject(_createError(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,PopupOperation.currentPopupAction=null}pollUserCancellation(){const i=()=>{var s,a;if((a=(s=this.authWindow)==null?void 0:s.window)!=null&&a.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(_createError(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(i,_POLL_WINDOW_CLOSE_TIMEOUT.get())};i()}}PopupOperation.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PENDING_REDIRECT_KEY="pendingRedirect",redirectOutcomeMap=new Map;class RedirectAction extends AbstractPopupRedirectOperation{constructor(i,s,a=!1){super(i,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],s,void 0,a),this.eventId=null}async execute(){let i=redirectOutcomeMap.get(this.auth._key());if(!i){try{const a=await _getAndClearPendingRedirectStatus(this.resolver,this.auth)?await super.execute():null;i=()=>Promise.resolve(a)}catch(s){i=()=>Promise.reject(s)}redirectOutcomeMap.set(this.auth._key(),i)}return this.bypassAuthState||redirectOutcomeMap.set(this.auth._key(),()=>Promise.resolve(null)),i()}async onAuthEvent(i){if(i.type==="signInViaRedirect")return super.onAuthEvent(i);if(i.type==="unknown"){this.resolve(null);return}if(i.eventId){const s=await this.auth._redirectUserForId(i.eventId);if(s)return this.user=s,super.onAuthEvent(i);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function _getAndClearPendingRedirectStatus(e,i){const s=pendingRedirectKey(i),a=resolverPersistence(e);if(!await a._isAvailable())return!1;const _=await a._get(s)==="true";return await a._remove(s),_}function _overrideRedirectResult(e,i){redirectOutcomeMap.set(e._key(),i)}function resolverPersistence(e){return _getInstance(e._redirectPersistence)}function pendingRedirectKey(e){return _persistenceKeyName(PENDING_REDIRECT_KEY,e.config.apiKey,e.name)}async function _getRedirectResult(e,i,s=!1){if(_isFirebaseServerApp(e.app))return Promise.reject(_serverAppCurrentUserOperationNotSupportedError(e));const a=_castAuth(e),_=_withDefaultResolver(a,i),rt=await new RedirectAction(a,_,s).execute();return rt&&!s&&(delete rt.user._redirectEventId,await a._persistUserIfCurrent(rt.user),await a._setRedirectUser(null,i)),rt}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EVENT_DUPLICATION_CACHE_DURATION_MS=10*60*1e3;class AuthEventManager{constructor(i){this.auth=i,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(i){this.consumers.add(i),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,i)&&(this.sendToConsumer(this.queuedRedirectEvent,i),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(i){this.consumers.delete(i)}onEvent(i){if(this.hasEventBeenHandled(i))return!1;let s=!1;return this.consumers.forEach(a=>{this.isEventForConsumer(i,a)&&(s=!0,this.sendToConsumer(i,a),this.saveEventToCache(i))}),this.hasHandledPotentialRedirect||!isRedirectEvent(i)||(this.hasHandledPotentialRedirect=!0,s||(this.queuedRedirectEvent=i,s=!0)),s}sendToConsumer(i,s){var a;if(i.error&&!isNullRedirectEvent(i)){const _=((a=i.error.code)==null?void 0:a.split("auth/")[1])||"internal-error";s.onError(_createError(this.auth,_))}else s.onAuthEvent(i)}isEventForConsumer(i,s){const a=s.eventId===null||!!i.eventId&&i.eventId===s.eventId;return s.filter.includes(i.type)&&a}hasEventBeenHandled(i){return Date.now()-this.lastProcessedEventTime>=EVENT_DUPLICATION_CACHE_DURATION_MS&&this.cachedEventUids.clear(),this.cachedEventUids.has(eventUid(i))}saveEventToCache(i){this.cachedEventUids.add(eventUid(i)),this.lastProcessedEventTime=Date.now()}}function eventUid(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(i=>i).join("-")}function isNullRedirectEvent({type:e,error:i}){return e==="unknown"&&(i==null?void 0:i.code)==="auth/no-auth-event"}function isRedirectEvent(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return isNullRedirectEvent(e);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _getProjectConfig(e,i={}){return _performApiRequest(e,"GET","/v1/projects",i)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IP_ADDRESS_REGEX=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,HTTP_REGEX=/^https?/;async function _validateOrigin(e){if(e.config.emulator)return;const{authorizedDomains:i}=await _getProjectConfig(e);for(const s of i)try{if(matchDomain(s))return}catch{}_fail(e,"unauthorized-domain")}function matchDomain(e){const i=_getCurrentUrl(),{protocol:s,hostname:a}=new URL(i);if(e.startsWith("chrome-extension://")){const rt=new URL(e);return rt.hostname===""&&a===""?s==="chrome-extension:"&&e.replace("chrome-extension://","")===i.replace("chrome-extension://",""):s==="chrome-extension:"&&rt.hostname===a}if(!HTTP_REGEX.test(s))return!1;if(IP_ADDRESS_REGEX.test(e))return a===e;const _=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+_+"|"+_+")$","i").test(a)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NETWORK_TIMEOUT=new Delay(3e4,6e4);function resetUnloadedGapiModules(){const e=_window().___jsl;if(e!=null&&e.H){for(const i of Object.keys(e.H))if(e.H[i].r=e.H[i].r||[],e.H[i].L=e.H[i].L||[],e.H[i].r=[...e.H[i].L],e.CP)for(let s=0;s<e.CP.length;s++)e.CP[s]=null}}function loadGapi(e){return new Promise((i,s)=>{var _,$,rt;function a(){resetUnloadedGapiModules(),gapi.load("gapi.iframes",{callback:()=>{i(gapi.iframes.getContext())},ontimeout:()=>{resetUnloadedGapiModules(),s(_createError(e,"network-request-failed"))},timeout:NETWORK_TIMEOUT.get()})}if(($=(_=_window().gapi)==null?void 0:_.iframes)!=null&&$.Iframe)i(gapi.iframes.getContext());else if((rt=_window().gapi)!=null&&rt.load)a();else{const c=_generateCallbackName("iframefcb");return _window()[c]=()=>{gapi.load?a():s(_createError(e,"network-request-failed"))},_loadJS(`${_gapiScriptUrl()}?onload=${c}`).catch(dt=>s(dt))}}).catch(i=>{throw cachedGApiLoader=null,i})}let cachedGApiLoader=null;function _loadGapi(e){return cachedGApiLoader=cachedGApiLoader||loadGapi(e),cachedGApiLoader}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PING_TIMEOUT=new Delay(5e3,15e3),IFRAME_PATH="__/auth/iframe",EMULATED_IFRAME_PATH="emulator/auth/iframe",IFRAME_ATTRIBUTES={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},EID_FROM_APIHOST=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function getIframeUrl(e){const i=e.config;_assert(i.authDomain,e,"auth-domain-config-required");const s=i.emulator?_emulatorUrl(i,EMULATED_IFRAME_PATH):`https://${e.config.authDomain}/${IFRAME_PATH}`,a={apiKey:i.apiKey,appName:e.name,v:SDK_VERSION$1},_=EID_FROM_APIHOST.get(e.config.apiHost);_&&(a.eid=_);const $=e._getFrameworks();return $.length&&(a.fw=$.join(",")),`${s}?${querystring(a).slice(1)}`}async function _openIframe(e){const i=await _loadGapi(e),s=_window().gapi;return _assert(s,e,"internal-error"),i.open({where:document.body,url:getIframeUrl(e),messageHandlersFilter:s.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:IFRAME_ATTRIBUTES,dontclear:!0},a=>new Promise(async(_,$)=>{await a.restyle({setHideOnLeave:!1});const rt=_createError(e,"network-request-failed"),c=_window().setTimeout(()=>{$(rt)},PING_TIMEOUT.get());function dt(){_window().clearTimeout(c),_(a)}a.ping(dt).then(dt,()=>{$(rt)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BASE_POPUP_OPTIONS={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},DEFAULT_WIDTH=500,DEFAULT_HEIGHT=600,TARGET_BLANK="_blank",FIREFOX_EMPTY_URL="http://localhost";class AuthPopup{constructor(i){this.window=i,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function _open(e,i,s,a=DEFAULT_WIDTH,_=DEFAULT_HEIGHT){const $=Math.max((window.screen.availHeight-_)/2,0).toString(),rt=Math.max((window.screen.availWidth-a)/2,0).toString();let c="";const dt={...BASE_POPUP_OPTIONS,width:a.toString(),height:_.toString(),top:$,left:rt},ht=getUA().toLowerCase();s&&(c=_isChromeIOS(ht)?TARGET_BLANK:s),_isFirefox(ht)&&(i=i||FIREFOX_EMPTY_URL,dt.scrollbars="yes");const Et=Object.entries(dt).reduce((At,[Pt,Vt])=>`${At}${Pt}=${Vt},`,"");if(_isIOSStandalone(ht)&&c!=="_self")return openAsNewWindowIOS(i||"",c),new AuthPopup(null);const St=window.open(i||"",c,Et);_assert(St,e,"popup-blocked");try{St.focus()}catch{}return new AuthPopup(St)}function openAsNewWindowIOS(e,i){const s=document.createElement("a");s.href=e,s.target=i;const a=document.createEvent("MouseEvent");a.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),s.dispatchEvent(a)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WIDGET_PATH="__/auth/handler",EMULATOR_WIDGET_PATH="emulator/auth/handler",FIREBASE_APP_CHECK_FRAGMENT_ID=encodeURIComponent("fac");async function _getRedirectUrl(e,i,s,a,_,$){_assert(e.config.authDomain,e,"auth-domain-config-required"),_assert(e.config.apiKey,e,"invalid-api-key");const rt={apiKey:e.config.apiKey,appName:e.name,authType:s,redirectUrl:a,v:SDK_VERSION$1,eventId:_};if(i instanceof FederatedAuthProvider){i.setDefaultLanguage(e.languageCode),rt.providerId=i.providerId||"",isEmpty(i.getCustomParameters())||(rt.customParameters=JSON.stringify(i.getCustomParameters()));for(const[Et,St]of Object.entries({}))rt[Et]=St}if(i instanceof BaseOAuthProvider){const Et=i.getScopes().filter(St=>St!=="");Et.length>0&&(rt.scopes=Et.join(","))}e.tenantId&&(rt.tid=e.tenantId);const c=rt;for(const Et of Object.keys(c))c[Et]===void 0&&delete c[Et];const dt=await e._getAppCheckToken(),ht=dt?`#${FIREBASE_APP_CHECK_FRAGMENT_ID}=${encodeURIComponent(dt)}`:"";return`${getHandlerBase(e)}?${querystring(c).slice(1)}${ht}`}function getHandlerBase({config:e}){return e.emulator?_emulatorUrl(e,EMULATOR_WIDGET_PATH):`https://${e.authDomain}/${WIDGET_PATH}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WEB_STORAGE_SUPPORT_KEY="webStorageSupport";class BrowserPopupRedirectResolver{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=browserSessionPersistence,this._completeRedirectFn=_getRedirectResult,this._overrideRedirectResult=_overrideRedirectResult}async _openPopup(i,s,a,_){var rt;debugAssert((rt=this.eventManagers[i._key()])==null?void 0:rt.manager,"_initialize() not called before _openPopup()");const $=await _getRedirectUrl(i,s,a,_getCurrentUrl(),_);return _open(i,$,_generateEventId())}async _openRedirect(i,s,a,_){await this._originValidation(i);const $=await _getRedirectUrl(i,s,a,_getCurrentUrl(),_);return _setWindowLocation($),new Promise(()=>{})}_initialize(i){const s=i._key();if(this.eventManagers[s]){const{manager:_,promise:$}=this.eventManagers[s];return _?Promise.resolve(_):(debugAssert($,"If manager is not set, promise should be"),$)}const a=this.initAndGetManager(i);return this.eventManagers[s]={promise:a},a.catch(()=>{delete this.eventManagers[s]}),a}async initAndGetManager(i){const s=await _openIframe(i),a=new AuthEventManager(i);return s.register("authEvent",_=>(_assert(_==null?void 0:_.authEvent,i,"invalid-auth-event"),{status:a.onEvent(_.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[i._key()]={manager:a},this.iframes[i._key()]=s,a}_isIframeWebStorageSupported(i,s){this.iframes[i._key()].send(WEB_STORAGE_SUPPORT_KEY,{type:WEB_STORAGE_SUPPORT_KEY},_=>{var rt;const $=(rt=_==null?void 0:_[0])==null?void 0:rt[WEB_STORAGE_SUPPORT_KEY];$!==void 0&&s(!!$),_fail(i,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(i){const s=i._key();return this.originValidationPromises[s]||(this.originValidationPromises[s]=_validateOrigin(i)),this.originValidationPromises[s]}get _shouldInitProactively(){return _isMobileBrowser()||_isSafari()||_isIOS()}}const browserPopupRedirectResolver=BrowserPopupRedirectResolver;var name$3="@firebase/auth",version$3="1.12.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AuthInterop{constructor(i){this.auth=i,this.internalListeners=new Map}getUid(){var i;return this.assertAuthConfigured(),((i=this.auth.currentUser)==null?void 0:i.uid)||null}async getToken(i){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(i)}:null}addAuthTokenListener(i){if(this.assertAuthConfigured(),this.internalListeners.has(i))return;const s=this.auth.onIdTokenChanged(a=>{i((a==null?void 0:a.stsTokenManager.accessToken)||null)});this.internalListeners.set(i,s),this.updateProactiveRefresh()}removeAuthTokenListener(i){this.assertAuthConfigured();const s=this.internalListeners.get(i);s&&(this.internalListeners.delete(i),s(),this.updateProactiveRefresh())}assertAuthConfigured(){_assert(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function getVersionForPlatform(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function registerAuth(e){_registerComponent(new Component("auth",(i,{options:s})=>{const a=i.getProvider("app").getImmediate(),_=i.getProvider("heartbeat"),$=i.getProvider("app-check-internal"),{apiKey:rt,authDomain:c}=a.options;_assert(rt&&!rt.includes(":"),"invalid-api-key",{appName:a.name});const dt={apiKey:rt,authDomain:c,clientPlatform:e,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:_getClientVersion(e)},ht=new AuthImpl(a,_,$,dt);return _initializeAuthInstance(ht,s),ht},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((i,s,a)=>{i.getProvider("auth-internal").initialize()})),_registerComponent(new Component("auth-internal",i=>{const s=_castAuth(i.getProvider("auth").getImmediate());return(a=>new AuthInterop(a))(s)},"PRIVATE").setInstantiationMode("EXPLICIT")),registerVersion(name$3,version$3,getVersionForPlatform(e)),registerVersion(name$3,version$3,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DEFAULT_ID_TOKEN_MAX_AGE=5*60,authIdTokenMaxAge=getExperimentalSetting("authIdTokenMaxAge")||DEFAULT_ID_TOKEN_MAX_AGE;let lastPostedIdToken=null;const mintCookieFactory=e=>async i=>{const s=i&&await i.getIdTokenResult(),a=s&&(new Date().getTime()-Date.parse(s.issuedAtTime))/1e3;if(a&&a>authIdTokenMaxAge)return;const _=s==null?void 0:s.token;lastPostedIdToken!==_&&(lastPostedIdToken=_,await fetch(e,{method:_?"POST":"DELETE",headers:_?{Authorization:`Bearer ${_}`}:{}}))};function getAuth(e=getApp()){const i=_getProvider(e,"auth");if(i.isInitialized())return i.getImmediate();const s=initializeAuth(e,{popupRedirectResolver:browserPopupRedirectResolver,persistence:[indexedDBLocalPersistence,browserLocalPersistence,browserSessionPersistence]}),a=getExperimentalSetting("authTokenSyncURL");if(a&&typeof isSecureContext=="boolean"&&isSecureContext){const $=new URL(a,location.origin);if(location.origin===$.origin){const rt=mintCookieFactory($.toString());beforeAuthStateChanged(s,rt,()=>rt(s.currentUser)),onIdTokenChanged(s,c=>rt(c))}}const _=getDefaultEmulatorHost("auth");return _&&connectAuthEmulator(s,`http://${_}`),s}function getScriptParentElement(){var e;return((e=document.getElementsByTagName("head"))==null?void 0:e[0])??document}_setExternalJSProvider({loadJS(e){return new Promise((i,s)=>{const a=document.createElement("script");a.setAttribute("src",e),a.onload=i,a.onerror=_=>{const $=_createError("internal-error");$.customData=_,s($)},a.type="text/javascript",a.charset="UTF-8",getScriptParentElement().appendChild(a)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});registerAuth("Browser");var define_process_env_default={};const name$2="@firebase/database",version$2="1.1.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let SDK_VERSION="";function setSDKVersion(e){SDK_VERSION=e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DOMStorageWrapper{constructor(i){this.domStorage_=i,this.prefix_="firebase:"}set(i,s){s==null?this.domStorage_.removeItem(this.prefixedName_(i)):this.domStorage_.setItem(this.prefixedName_(i),stringify(s))}get(i){const s=this.domStorage_.getItem(this.prefixedName_(i));return s==null?null:jsonEval(s)}remove(i){this.domStorage_.removeItem(this.prefixedName_(i))}prefixedName_(i){return this.prefix_+i}toString(){return this.domStorage_.toString()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MemoryStorage{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(i,s){s==null?delete this.cache_[i]:this.cache_[i]=s}get(i){return contains(this.cache_,i)?this.cache_[i]:null}remove(i){delete this.cache_[i]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const createStoragefor=function(e){try{if(typeof window<"u"&&typeof window[e]<"u"){const i=window[e];return i.setItem("firebase:sentinel","cache"),i.removeItem("firebase:sentinel"),new DOMStorageWrapper(i)}}catch{}return new MemoryStorage},PersistentStorage=createStoragefor("localStorage"),SessionStorage=createStoragefor("sessionStorage");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const logClient=new Logger("@firebase/database"),LUIDGenerator=function(){let e=1;return function(){return e++}}(),sha1=function(e){const i=stringToByteArray(e),s=new Sha1;s.update(i);const a=s.digest();return base64.encodeByteArray(a)},buildLogMessage_=function(...e){let i="";for(let s=0;s<e.length;s++){const a=e[s];Array.isArray(a)||a&&typeof a=="object"&&typeof a.length=="number"?i+=buildLogMessage_.apply(null,a):typeof a=="object"?i+=stringify(a):i+=a,i+=" "}return i};let logger=null,firstLog_=!0;const enableLogging$1=function(e,i){assert(!i,"Can't turn on custom loggers persistently."),logClient.logLevel=LogLevel.VERBOSE,logger=logClient.log.bind(logClient)},log=function(...e){if(firstLog_===!0&&(firstLog_=!1,logger===null&&SessionStorage.get("logging_enabled")===!0&&enableLogging$1()),logger){const i=buildLogMessage_.apply(null,e);logger(i)}},logWrapper=function(e){return function(...i){log(e,...i)}},error=function(...e){const i="FIREBASE INTERNAL ERROR: "+buildLogMessage_(...e);logClient.error(i)},fatal=function(...e){const i=`FIREBASE FATAL ERROR: ${buildLogMessage_(...e)}`;throw logClient.error(i),new Error(i)},warn=function(...e){const i="FIREBASE WARNING: "+buildLogMessage_(...e);logClient.warn(i)},warnIfPageIsSecure=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&warn("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},isInvalidJSONNumber=function(e){return typeof e=="number"&&(e!==e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)},executeWhenDOMReady=function(e){if(document.readyState==="complete")e();else{let i=!1;const s=function(){if(!document.body){setTimeout(s,Math.floor(10));return}i||(i=!0,e())};document.addEventListener?(document.addEventListener("DOMContentLoaded",s,!1),window.addEventListener("load",s,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&s()}),window.attachEvent("onload",s))}},MIN_NAME="[MIN_NAME]",MAX_NAME="[MAX_NAME]",nameCompare=function(e,i){if(e===i)return 0;if(e===MIN_NAME||i===MAX_NAME)return-1;if(i===MIN_NAME||e===MAX_NAME)return 1;{const s=tryParseInt(e),a=tryParseInt(i);return s!==null?a!==null?s-a===0?e.length-i.length:s-a:-1:a!==null?1:e<i?-1:1}},stringCompare=function(e,i){return e===i?0:e<i?-1:1},requireKey=function(e,i){if(i&&e in i)return i[e];throw new Error("Missing required key ("+e+") in object: "+stringify(i))},ObjectToUniqueKey=function(e){if(typeof e!="object"||e===null)return stringify(e);const i=[];for(const a in e)i.push(a);i.sort();let s="{";for(let a=0;a<i.length;a++)a!==0&&(s+=","),s+=stringify(i[a]),s+=":",s+=ObjectToUniqueKey(e[i[a]]);return s+="}",s},splitStringBySize=function(e,i){const s=e.length;if(s<=i)return[e];const a=[];for(let _=0;_<s;_+=i)_+i>s?a.push(e.substring(_,s)):a.push(e.substring(_,_+i));return a};function each(e,i){for(const s in e)e.hasOwnProperty(s)&&i(s,e[s])}const doubleToIEEE754String=function(e){assert(!isInvalidJSONNumber(e),"Invalid JSON number");const i=11,s=52,a=(1<<i-1)-1;let _,$,rt,c,dt;e===0?($=0,rt=0,_=1/e===-1/0?1:0):(_=e<0,e=Math.abs(e),e>=Math.pow(2,1-a)?(c=Math.min(Math.floor(Math.log(e)/Math.LN2),a),$=c+a,rt=Math.round(e*Math.pow(2,s-c)-Math.pow(2,s))):($=0,rt=Math.round(e/Math.pow(2,1-a-s))));const ht=[];for(dt=s;dt;dt-=1)ht.push(rt%2?1:0),rt=Math.floor(rt/2);for(dt=i;dt;dt-=1)ht.push($%2?1:0),$=Math.floor($/2);ht.push(_?1:0),ht.reverse();const Et=ht.join("");let St="";for(dt=0;dt<64;dt+=8){let At=parseInt(Et.substr(dt,8),2).toString(16);At.length===1&&(At="0"+At),St=St+At}return St.toLowerCase()},isChromeExtensionContentScript=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},isWindowsStoreApp=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function errorForServerCode(e,i){let s="Unknown Error";e==="too_big"?s="The data requested exceeds the maximum size that can be accessed with a single request.":e==="permission_denied"?s="Client doesn't have permission to access the desired data.":e==="unavailable"&&(s="The service is unavailable");const a=new Error(e+" at "+i._path.toString()+": "+s);return a.code=e.toUpperCase(),a}const INTEGER_REGEXP_=new RegExp("^-?(0*)\\d{1,10}$"),INTEGER_32_MIN=-2147483648,INTEGER_32_MAX=2147483647,tryParseInt=function(e){if(INTEGER_REGEXP_.test(e)){const i=Number(e);if(i>=INTEGER_32_MIN&&i<=INTEGER_32_MAX)return i}return null},exceptionGuard=function(e){try{e()}catch(i){setTimeout(()=>{const s=i.stack||"";throw warn("Exception was thrown by user callback.",s),i},Math.floor(0))}},beingCrawled=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},setTimeoutNonBlocking=function(e,i){const s=setTimeout(e,i);return typeof s=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(s):typeof s=="object"&&s.unref&&s.unref(),s};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AppCheckTokenProvider{constructor(i,s){this.appCheckProvider=s,this.appName=i.name,_isFirebaseServerApp(i)&&i.settings.appCheckToken&&(this.serverAppAppCheckToken=i.settings.appCheckToken),this.appCheck=s==null?void 0:s.getImmediate({optional:!0}),this.appCheck||s==null||s.get().then(a=>this.appCheck=a)}getToken(i){if(this.serverAppAppCheckToken){if(i)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(i):new Promise((s,a)=>{setTimeout(()=>{this.appCheck?this.getToken(i).then(s,a):s(null)},0)})}addTokenChangeListener(i){var s;(s=this.appCheckProvider)==null||s.get().then(a=>a.addTokenListener(i))}notifyForInvalidToken(){warn(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FirebaseAuthTokenProvider{constructor(i,s,a){this.appName_=i,this.firebaseOptions_=s,this.authProvider_=a,this.auth_=null,this.auth_=a.getImmediate({optional:!0}),this.auth_||a.onInit(_=>this.auth_=_)}getToken(i){return this.auth_?this.auth_.getToken(i).catch(s=>s&&s.code==="auth/token-not-initialized"?(log("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(s)):new Promise((s,a)=>{setTimeout(()=>{this.auth_?this.getToken(i).then(s,a):s(null)},0)})}addTokenChangeListener(i){this.auth_?this.auth_.addAuthTokenListener(i):this.authProvider_.get().then(s=>s.addAuthTokenListener(i))}removeTokenChangeListener(i){this.authProvider_.get().then(s=>s.removeAuthTokenListener(i))}notifyForInvalidToken(){let i='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?i+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?i+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':i+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',warn(i)}}class EmulatorTokenProvider{constructor(i){this.accessToken=i}getToken(i){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(i){i(this.accessToken)}removeTokenChangeListener(i){}notifyForInvalidToken(){}}EmulatorTokenProvider.OWNER="owner";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PROTOCOL_VERSION="5",VERSION_PARAM="v",TRANSPORT_SESSION_PARAM="s",REFERER_PARAM="r",FORGE_REF="f",FORGE_DOMAIN_RE=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,LAST_SESSION_PARAM="ls",APPLICATION_ID_PARAM="p",APP_CHECK_TOKEN_PARAM="ac",WEBSOCKET="websocket",LONG_POLLING="long_polling";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RepoInfo{constructor(i,s,a,_,$=!1,rt="",c=!1,dt=!1,ht=null){this.secure=s,this.namespace=a,this.webSocketOnly=_,this.nodeAdmin=$,this.persistenceKey=rt,this.includeNamespaceInQueryParams=c,this.isUsingEmulator=dt,this.emulatorOptions=ht,this._host=i.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=PersistentStorage.get("host:"+i)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(i){i!==this.internalHost&&(this.internalHost=i,this.isCacheableHost()&&PersistentStorage.set("host:"+this._host,this.internalHost))}toString(){let i=this.toURLString();return this.persistenceKey&&(i+="<"+this.persistenceKey+">"),i}toURLString(){const i=this.secure?"https://":"http://",s=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${i}${this.host}/${s}`}}function repoInfoNeedsQueryParam(e){return e.host!==e.internalHost||e.isCustomHost()||e.includeNamespaceInQueryParams}function repoInfoConnectionURL(e,i,s){assert(typeof i=="string","typeof type must == string"),assert(typeof s=="object","typeof params must == object");let a;if(i===WEBSOCKET)a=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else if(i===LONG_POLLING)a=(e.secure?"https://":"http://")+e.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+i);repoInfoNeedsQueryParam(e)&&(s.ns=e.namespace);const _=[];return each(s,($,rt)=>{_.push($+"="+rt)}),a+_.join("&")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class StatsCollection{constructor(){this.counters_={}}incrementCounter(i,s=1){contains(this.counters_,i)||(this.counters_[i]=0),this.counters_[i]+=s}get(){return deepCopy(this.counters_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const collections={},reporters={};function statsManagerGetCollection(e){const i=e.toString();return collections[i]||(collections[i]=new StatsCollection),collections[i]}function statsManagerGetOrCreateReporter(e,i){const s=e.toString();return reporters[s]||(reporters[s]=i()),reporters[s]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PacketReceiver{constructor(i){this.onMessage_=i,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(i,s){this.closeAfterResponse=i,this.onClose=s,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(i,s){for(this.pendingResponses[i]=s;this.pendingResponses[this.currentResponseNum];){const a=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let _=0;_<a.length;++_)a[_]&&exceptionGuard(()=>{this.onMessage_(a[_])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FIREBASE_LONGPOLL_START_PARAM="start",FIREBASE_LONGPOLL_CLOSE_COMMAND="close",FIREBASE_LONGPOLL_COMMAND_CB_NAME="pLPCommand",FIREBASE_LONGPOLL_DATA_CB_NAME="pRTLPCB",FIREBASE_LONGPOLL_ID_PARAM="id",FIREBASE_LONGPOLL_PW_PARAM="pw",FIREBASE_LONGPOLL_SERIAL_PARAM="ser",FIREBASE_LONGPOLL_CALLBACK_ID_PARAM="cb",FIREBASE_LONGPOLL_SEGMENT_NUM_PARAM="seg",FIREBASE_LONGPOLL_SEGMENTS_IN_PACKET="ts",FIREBASE_LONGPOLL_DATA_PARAM="d",FIREBASE_LONGPOLL_DISCONN_FRAME_REQUEST_PARAM="dframe",MAX_URL_DATA_SIZE=1870,SEG_HEADER_SIZE=30,MAX_PAYLOAD_SIZE=MAX_URL_DATA_SIZE-SEG_HEADER_SIZE,KEEPALIVE_REQUEST_INTERVAL=25e3,LP_CONNECT_TIMEOUT=3e4;class BrowserPollConnection{constructor(i,s,a,_,$,rt,c){this.connId=i,this.repoInfo=s,this.applicationId=a,this.appCheckToken=_,this.authToken=$,this.transportSessionId=rt,this.lastSessionId=c,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=logWrapper(i),this.stats_=statsManagerGetCollection(s),this.urlFn=dt=>(this.appCheckToken&&(dt[APP_CHECK_TOKEN_PARAM]=this.appCheckToken),repoInfoConnectionURL(s,LONG_POLLING,dt))}open(i,s){this.curSegmentNum=0,this.onDisconnect_=s,this.myPacketOrderer=new PacketReceiver(i),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(LP_CONNECT_TIMEOUT)),executeWhenDOMReady(()=>{if(this.isClosed_)return;this.scriptTagHolder=new FirebaseIFrameScriptHolder((...$)=>{const[rt,c,dt,ht,Et]=$;if(this.incrementIncomingBytes_($),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,rt===FIREBASE_LONGPOLL_START_PARAM)this.id=c,this.password=dt;else if(rt===FIREBASE_LONGPOLL_CLOSE_COMMAND)c?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(c,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+rt)},(...$)=>{const[rt,c]=$;this.incrementIncomingBytes_($),this.myPacketOrderer.handleResponse(rt,c)},()=>{this.onClosed_()},this.urlFn);const a={};a[FIREBASE_LONGPOLL_START_PARAM]="t",a[FIREBASE_LONGPOLL_SERIAL_PARAM]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(a[FIREBASE_LONGPOLL_CALLBACK_ID_PARAM]=this.scriptTagHolder.uniqueCallbackIdentifier),a[VERSION_PARAM]=PROTOCOL_VERSION,this.transportSessionId&&(a[TRANSPORT_SESSION_PARAM]=this.transportSessionId),this.lastSessionId&&(a[LAST_SESSION_PARAM]=this.lastSessionId),this.applicationId&&(a[APPLICATION_ID_PARAM]=this.applicationId),this.appCheckToken&&(a[APP_CHECK_TOKEN_PARAM]=this.appCheckToken),typeof location<"u"&&location.hostname&&FORGE_DOMAIN_RE.test(location.hostname)&&(a[REFERER_PARAM]=FORGE_REF);const _=this.urlFn(a);this.log_("Connecting via long-poll to "+_),this.scriptTagHolder.addTag(_,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){BrowserPollConnection.forceAllow_=!0}static forceDisallow(){BrowserPollConnection.forceDisallow_=!0}static isAvailable(){return BrowserPollConnection.forceAllow_?!0:!BrowserPollConnection.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!isChromeExtensionContentScript()&&!isWindowsStoreApp()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(i){const s=stringify(i);this.bytesSent+=s.length,this.stats_.incrementCounter("bytes_sent",s.length);const a=base64Encode(s),_=splitStringBySize(a,MAX_PAYLOAD_SIZE);for(let $=0;$<_.length;$++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,_.length,_[$]),this.curSegmentNum++}addDisconnectPingFrame(i,s){this.myDisconnFrame=document.createElement("iframe");const a={};a[FIREBASE_LONGPOLL_DISCONN_FRAME_REQUEST_PARAM]="t",a[FIREBASE_LONGPOLL_ID_PARAM]=i,a[FIREBASE_LONGPOLL_PW_PARAM]=s,this.myDisconnFrame.src=this.urlFn(a),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(i){const s=stringify(i).length;this.bytesReceived+=s,this.stats_.incrementCounter("bytes_received",s)}}class FirebaseIFrameScriptHolder{constructor(i,s,a,_){this.onDisconnect=a,this.urlFn=_,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=LUIDGenerator(),window[FIREBASE_LONGPOLL_COMMAND_CB_NAME+this.uniqueCallbackIdentifier]=i,window[FIREBASE_LONGPOLL_DATA_CB_NAME+this.uniqueCallbackIdentifier]=s,this.myIFrame=FirebaseIFrameScriptHolder.createIFrame_();let $="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&($='<script>document.domain="'+document.domain+'";<\/script>');const rt="<html><body>"+$+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(rt),this.myIFrame.doc.close()}catch(c){log("frame writing exception"),c.stack&&log(c.stack),log(c)}}}static createIFrame_(){const i=document.createElement("iframe");if(i.style.display="none",document.body){document.body.appendChild(i);try{i.contentWindow.document||log("No IE domain setting required")}catch{const a=document.domain;i.src="javascript:void((function(){document.open();document.domain='"+a+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return i.contentDocument?i.doc=i.contentDocument:i.contentWindow?i.doc=i.contentWindow.document:i.document&&(i.doc=i.document),i}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const i=this.onDisconnect;i&&(this.onDisconnect=null,i())}startLongPoll(i,s){for(this.myID=i,this.myPW=s,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const i={};i[FIREBASE_LONGPOLL_ID_PARAM]=this.myID,i[FIREBASE_LONGPOLL_PW_PARAM]=this.myPW,i[FIREBASE_LONGPOLL_SERIAL_PARAM]=this.currentSerial;let s=this.urlFn(i),a="",_=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+SEG_HEADER_SIZE+a.length<=MAX_URL_DATA_SIZE;){const rt=this.pendingSegs.shift();a=a+"&"+FIREBASE_LONGPOLL_SEGMENT_NUM_PARAM+_+"="+rt.seg+"&"+FIREBASE_LONGPOLL_SEGMENTS_IN_PACKET+_+"="+rt.ts+"&"+FIREBASE_LONGPOLL_DATA_PARAM+_+"="+rt.d,_++}return s=s+a,this.addLongPollTag_(s,this.currentSerial),!0}else return!1}enqueueSegment(i,s,a){this.pendingSegs.push({seg:i,ts:s,d:a}),this.alive&&this.newRequest_()}addLongPollTag_(i,s){this.outstandingRequests.add(s);const a=()=>{this.outstandingRequests.delete(s),this.newRequest_()},_=setTimeout(a,Math.floor(KEEPALIVE_REQUEST_INTERVAL)),$=()=>{clearTimeout(_),a()};this.addTag(i,$)}addTag(i,s){setTimeout(()=>{try{if(!this.sendNewPolls)return;const a=this.myIFrame.doc.createElement("script");a.type="text/javascript",a.async=!0,a.src=i,a.onload=a.onreadystatechange=function(){const _=a.readyState;(!_||_==="loaded"||_==="complete")&&(a.onload=a.onreadystatechange=null,a.parentNode&&a.parentNode.removeChild(a),s())},a.onerror=()=>{log("Long-poll script failed to load: "+i),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(a)}catch{}},Math.floor(1))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WEBSOCKET_MAX_FRAME_SIZE=16384,WEBSOCKET_KEEPALIVE_INTERVAL=45e3;let WebSocketImpl=null;typeof MozWebSocket<"u"?WebSocketImpl=MozWebSocket:typeof WebSocket<"u"&&(WebSocketImpl=WebSocket);class WebSocketConnection{constructor(i,s,a,_,$,rt,c){this.connId=i,this.applicationId=a,this.appCheckToken=_,this.authToken=$,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=logWrapper(this.connId),this.stats_=statsManagerGetCollection(s),this.connURL=WebSocketConnection.connectionURL_(s,rt,c,_,a),this.nodeAdmin=s.nodeAdmin}static connectionURL_(i,s,a,_,$){const rt={};return rt[VERSION_PARAM]=PROTOCOL_VERSION,typeof location<"u"&&location.hostname&&FORGE_DOMAIN_RE.test(location.hostname)&&(rt[REFERER_PARAM]=FORGE_REF),s&&(rt[TRANSPORT_SESSION_PARAM]=s),a&&(rt[LAST_SESSION_PARAM]=a),_&&(rt[APP_CHECK_TOKEN_PARAM]=_),$&&(rt[APPLICATION_ID_PARAM]=$),repoInfoConnectionURL(i,WEBSOCKET,rt)}open(i,s){this.onDisconnect=s,this.onMessage=i,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,PersistentStorage.set("previous_websocket_failure",!0);try{let a;isNodeSdk(),this.mySock=new WebSocketImpl(this.connURL,[],a)}catch(a){this.log_("Error instantiating WebSocket.");const _=a.message||a.data;_&&this.log_(_),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=a=>{this.handleIncomingFrame(a)},this.mySock.onerror=a=>{this.log_("WebSocket error.  Closing connection.");const _=a.message||a.data;_&&this.log_(_),this.onClosed_()}}start(){}static forceDisallow(){WebSocketConnection.forceDisallow_=!0}static isAvailable(){let i=!1;if(typeof navigator<"u"&&navigator.userAgent){const s=/Android ([0-9]{0,}\.[0-9]{0,})/,a=navigator.userAgent.match(s);a&&a.length>1&&parseFloat(a[1])<4.4&&(i=!0)}return!i&&WebSocketImpl!==null&&!WebSocketConnection.forceDisallow_}static previouslyFailed(){return PersistentStorage.isInMemoryStorage||PersistentStorage.get("previous_websocket_failure")===!0}markConnectionHealthy(){PersistentStorage.remove("previous_websocket_failure")}appendFrame_(i){if(this.frames.push(i),this.frames.length===this.totalFrames){const s=this.frames.join("");this.frames=null;const a=jsonEval(s);this.onMessage(a)}}handleNewFrameCount_(i){this.totalFrames=i,this.frames=[]}extractFrameCount_(i){if(assert(this.frames===null,"We already have a frame buffer"),i.length<=6){const s=Number(i);if(!isNaN(s))return this.handleNewFrameCount_(s),null}return this.handleNewFrameCount_(1),i}handleIncomingFrame(i){if(this.mySock===null)return;const s=i.data;if(this.bytesReceived+=s.length,this.stats_.incrementCounter("bytes_received",s.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(s);else{const a=this.extractFrameCount_(s);a!==null&&this.appendFrame_(a)}}send(i){this.resetKeepAlive();const s=stringify(i);this.bytesSent+=s.length,this.stats_.incrementCounter("bytes_sent",s.length);const a=splitStringBySize(s,WEBSOCKET_MAX_FRAME_SIZE);a.length>1&&this.sendString_(String(a.length));for(let _=0;_<a.length;_++)this.sendString_(a[_])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(WEBSOCKET_KEEPALIVE_INTERVAL))}sendString_(i){try{this.mySock.send(i)}catch(s){this.log_("Exception thrown from WebSocket.send():",s.message||s.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}WebSocketConnection.responsesRequiredToBeHealthy=2;WebSocketConnection.healthyTimeout=3e4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TransportManager{static get ALL_TRANSPORTS(){return[BrowserPollConnection,WebSocketConnection]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(i){this.initTransports_(i)}initTransports_(i){const s=WebSocketConnection&&WebSocketConnection.isAvailable();let a=s&&!WebSocketConnection.previouslyFailed();if(i.webSocketOnly&&(s||warn("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),a=!0),a)this.transports_=[WebSocketConnection];else{const _=this.transports_=[];for(const $ of TransportManager.ALL_TRANSPORTS)$&&$.isAvailable()&&_.push($);TransportManager.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}TransportManager.globalTransportInitialized_=!1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UPGRADE_TIMEOUT=6e4,DELAY_BEFORE_SENDING_EXTRA_REQUESTS=5e3,BYTES_SENT_HEALTHY_OVERRIDE=10*1024,BYTES_RECEIVED_HEALTHY_OVERRIDE=100*1024,MESSAGE_TYPE="t",MESSAGE_DATA="d",CONTROL_SHUTDOWN="s",CONTROL_RESET="r",CONTROL_ERROR="e",CONTROL_PONG="o",SWITCH_ACK="a",END_TRANSMISSION="n",PING="p",SERVER_HELLO="h";class Connection{constructor(i,s,a,_,$,rt,c,dt,ht,Et){this.id=i,this.repoInfo_=s,this.applicationId_=a,this.appCheckToken_=_,this.authToken_=$,this.onMessage_=rt,this.onReady_=c,this.onDisconnect_=dt,this.onKill_=ht,this.lastSessionId=Et,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=logWrapper("c:"+this.id+":"),this.transportManager_=new TransportManager(s),this.log_("Connection created"),this.start_()}start_(){const i=this.transportManager_.initialTransport();this.conn_=new i(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=i.responsesRequiredToBeHealthy||0;const s=this.connReceiver_(this.conn_),a=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(s,a)},Math.floor(0));const _=i.healthyTimeout||0;_>0&&(this.healthyTimeout_=setTimeoutNonBlocking(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>BYTES_RECEIVED_HEALTHY_OVERRIDE?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>BYTES_SENT_HEALTHY_OVERRIDE?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(_)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(i){return s=>{i===this.conn_?this.onConnectionLost_(s):i===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(i){return s=>{this.state_!==2&&(i===this.rx_?this.onPrimaryMessageReceived_(s):i===this.secondaryConn_?this.onSecondaryMessageReceived_(s):this.log_("message on old connection"))}}sendRequest(i){const s={t:"d",d:i};this.sendData_(s)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(i){if(MESSAGE_TYPE in i){const s=i[MESSAGE_TYPE];s===SWITCH_ACK?this.upgradeIfSecondaryHealthy_():s===CONTROL_RESET?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):s===CONTROL_PONG&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(i){const s=requireKey("t",i),a=requireKey("d",i);if(s==="c")this.onSecondaryControl_(a);else if(s==="d")this.pendingDataMessages.push(a);else throw new Error("Unknown protocol layer: "+s)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:PING,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:SWITCH_ACK,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:END_TRANSMISSION,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(i){const s=requireKey("t",i),a=requireKey("d",i);s==="c"?this.onControl_(a):s==="d"&&this.onDataMessage_(a)}onDataMessage_(i){this.onPrimaryResponse_(),this.onMessage_(i)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(i){const s=requireKey(MESSAGE_TYPE,i);if(MESSAGE_DATA in i){const a=i[MESSAGE_DATA];if(s===SERVER_HELLO){const _={...a};this.repoInfo_.isUsingEmulator&&(_.h=this.repoInfo_.host),this.onHandshake_(_)}else if(s===END_TRANSMISSION){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let _=0;_<this.pendingDataMessages.length;++_)this.onDataMessage_(this.pendingDataMessages[_]);this.pendingDataMessages=[],this.tryCleanupConnection()}else s===CONTROL_SHUTDOWN?this.onConnectionShutdown_(a):s===CONTROL_RESET?this.onReset_(a):s===CONTROL_ERROR?error("Server Error: "+a):s===CONTROL_PONG?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):error("Unknown control packet command: "+s)}}onHandshake_(i){const s=i.ts,a=i.v,_=i.h;this.sessionId=i.s,this.repoInfo_.host=_,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,s),PROTOCOL_VERSION!==a&&warn("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const i=this.transportManager_.upgradeTransport();i&&this.startUpgrade_(i)}startUpgrade_(i){this.secondaryConn_=new i(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=i.responsesRequiredToBeHealthy||0;const s=this.connReceiver_(this.secondaryConn_),a=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(s,a),setTimeoutNonBlocking(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(UPGRADE_TIMEOUT))}onReset_(i){this.log_("Reset packet received.  New host: "+i),this.repoInfo_.host=i,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(i,s){this.log_("Realtime connection established."),this.conn_=i,this.state_=1,this.onReady_&&(this.onReady_(s,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):setTimeoutNonBlocking(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(DELAY_BEFORE_SENDING_EXTRA_REQUESTS))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:PING,d:{}}}))}onSecondaryConnectionLost_(){const i=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===i||this.rx_===i)&&this.close()}onConnectionLost_(i){this.conn_=null,!i&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(PersistentStorage.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(i){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(i),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(i){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(i)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ServerActions{put(i,s,a,_){}merge(i,s,a,_){}refreshAuthToken(i){}refreshAppCheckToken(i){}onDisconnectPut(i,s,a){}onDisconnectMerge(i,s,a){}onDisconnectCancel(i,s){}reportStats(i){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EventEmitter{constructor(i){this.allowedEvents_=i,this.listeners_={},assert(Array.isArray(i)&&i.length>0,"Requires a non-empty array")}trigger(i,...s){if(Array.isArray(this.listeners_[i])){const a=[...this.listeners_[i]];for(let _=0;_<a.length;_++)a[_].callback.apply(a[_].context,s)}}on(i,s,a){this.validateEventType_(i),this.listeners_[i]=this.listeners_[i]||[],this.listeners_[i].push({callback:s,context:a});const _=this.getInitialEvent(i);_&&s.apply(a,_)}off(i,s,a){this.validateEventType_(i);const _=this.listeners_[i]||[];for(let $=0;$<_.length;$++)if(_[$].callback===s&&(!a||a===_[$].context)){_.splice($,1);return}}validateEventType_(i){assert(this.allowedEvents_.find(s=>s===i),"Unknown event: "+i)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OnlineMonitor extends EventEmitter{static getInstance(){return new OnlineMonitor}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!isMobileCordova()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(i){return assert(i==="online","Unknown event type: "+i),[this.online_]}currentlyOnline(){return this.online_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MAX_PATH_DEPTH=32,MAX_PATH_LENGTH_BYTES=768;class Path{constructor(i,s){if(s===void 0){this.pieces_=i.split("/");let a=0;for(let _=0;_<this.pieces_.length;_++)this.pieces_[_].length>0&&(this.pieces_[a]=this.pieces_[_],a++);this.pieces_.length=a,this.pieceNum_=0}else this.pieces_=i,this.pieceNum_=s}toString(){let i="";for(let s=this.pieceNum_;s<this.pieces_.length;s++)this.pieces_[s]!==""&&(i+="/"+this.pieces_[s]);return i||"/"}}function newEmptyPath(){return new Path("")}function pathGetFront(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function pathGetLength(e){return e.pieces_.length-e.pieceNum_}function pathPopFront(e){let i=e.pieceNum_;return i<e.pieces_.length&&i++,new Path(e.pieces_,i)}function pathGetBack(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function pathToUrlEncodedString(e){let i="";for(let s=e.pieceNum_;s<e.pieces_.length;s++)e.pieces_[s]!==""&&(i+="/"+encodeURIComponent(String(e.pieces_[s])));return i||"/"}function pathSlice(e,i=0){return e.pieces_.slice(e.pieceNum_+i)}function pathParent(e){if(e.pieceNum_>=e.pieces_.length)return null;const i=[];for(let s=e.pieceNum_;s<e.pieces_.length-1;s++)i.push(e.pieces_[s]);return new Path(i,0)}function pathChild(e,i){const s=[];for(let a=e.pieceNum_;a<e.pieces_.length;a++)s.push(e.pieces_[a]);if(i instanceof Path)for(let a=i.pieceNum_;a<i.pieces_.length;a++)s.push(i.pieces_[a]);else{const a=i.split("/");for(let _=0;_<a.length;_++)a[_].length>0&&s.push(a[_])}return new Path(s,0)}function pathIsEmpty(e){return e.pieceNum_>=e.pieces_.length}function newRelativePath(e,i){const s=pathGetFront(e),a=pathGetFront(i);if(s===null)return i;if(s===a)return newRelativePath(pathPopFront(e),pathPopFront(i));throw new Error("INTERNAL ERROR: innerPath ("+i+") is not within outerPath ("+e+")")}function pathCompare(e,i){const s=pathSlice(e,0),a=pathSlice(i,0);for(let _=0;_<s.length&&_<a.length;_++){const $=nameCompare(s[_],a[_]);if($!==0)return $}return s.length===a.length?0:s.length<a.length?-1:1}function pathEquals(e,i){if(pathGetLength(e)!==pathGetLength(i))return!1;for(let s=e.pieceNum_,a=i.pieceNum_;s<=e.pieces_.length;s++,a++)if(e.pieces_[s]!==i.pieces_[a])return!1;return!0}function pathContains(e,i){let s=e.pieceNum_,a=i.pieceNum_;if(pathGetLength(e)>pathGetLength(i))return!1;for(;s<e.pieces_.length;){if(e.pieces_[s]!==i.pieces_[a])return!1;++s,++a}return!0}class ValidationPath{constructor(i,s){this.errorPrefix_=s,this.parts_=pathSlice(i,0),this.byteLength_=Math.max(1,this.parts_.length);for(let a=0;a<this.parts_.length;a++)this.byteLength_+=stringLength(this.parts_[a]);validationPathCheckValid(this)}}function validationPathPush(e,i){e.parts_.length>0&&(e.byteLength_+=1),e.parts_.push(i),e.byteLength_+=stringLength(i),validationPathCheckValid(e)}function validationPathPop(e){const i=e.parts_.pop();e.byteLength_-=stringLength(i),e.parts_.length>0&&(e.byteLength_-=1)}function validationPathCheckValid(e){if(e.byteLength_>MAX_PATH_LENGTH_BYTES)throw new Error(e.errorPrefix_+"has a key path longer than "+MAX_PATH_LENGTH_BYTES+" bytes ("+e.byteLength_+").");if(e.parts_.length>MAX_PATH_DEPTH)throw new Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+MAX_PATH_DEPTH+") or object contains a cycle "+validationPathToErrorString(e))}function validationPathToErrorString(e){return e.parts_.length===0?"":"in property '"+e.parts_.join(".")+"'"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VisibilityMonitor extends EventEmitter{static getInstance(){return new VisibilityMonitor}constructor(){super(["visible"]);let i,s;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(s="visibilitychange",i="hidden"):typeof document.mozHidden<"u"?(s="mozvisibilitychange",i="mozHidden"):typeof document.msHidden<"u"?(s="msvisibilitychange",i="msHidden"):typeof document.webkitHidden<"u"&&(s="webkitvisibilitychange",i="webkitHidden")),this.visible_=!0,s&&document.addEventListener(s,()=>{const a=!document[i];a!==this.visible_&&(this.visible_=a,this.trigger("visible",a))},!1)}getInitialEvent(i){return assert(i==="visible","Unknown event type: "+i),[this.visible_]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RECONNECT_MIN_DELAY=1e3,RECONNECT_MAX_DELAY_DEFAULT=60*5*1e3,RECONNECT_MAX_DELAY_FOR_ADMINS=30*1e3,RECONNECT_DELAY_MULTIPLIER=1.3,RECONNECT_DELAY_RESET_TIMEOUT=3e4,SERVER_KILL_INTERRUPT_REASON="server_kill",INVALID_TOKEN_THRESHOLD=3;class PersistentConnection extends ServerActions{constructor(i,s,a,_,$,rt,c,dt){if(super(),this.repoInfo_=i,this.applicationId_=s,this.onDataUpdate_=a,this.onConnectStatus_=_,this.onServerInfoUpdate_=$,this.authTokenProvider_=rt,this.appCheckTokenProvider_=c,this.authOverride_=dt,this.id=PersistentConnection.nextPersistentConnectionId_++,this.log_=logWrapper("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=RECONNECT_MIN_DELAY,this.maxReconnectDelay_=RECONNECT_MAX_DELAY_DEFAULT,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,dt&&!isNodeSdk())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");VisibilityMonitor.getInstance().on("visible",this.onVisible_,this),i.host.indexOf("fblocal")===-1&&OnlineMonitor.getInstance().on("online",this.onOnline_,this)}sendRequest(i,s,a){const _=++this.requestNumber_,$={r:_,a:i,b:s};this.log_(stringify($)),assert(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest($),a&&(this.requestCBHash_[_]=a)}get(i){this.initConnection_();const s=new Deferred,_={action:"g",request:{p:i._path.toString(),q:i._queryObject},onComplete:rt=>{const c=rt.d;rt.s==="ok"?s.resolve(c):s.reject(c)}};this.outstandingGets_.push(_),this.outstandingGetCount_++;const $=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_($),s.promise}listen(i,s,a,_){this.initConnection_();const $=i._queryIdentifier,rt=i._path.toString();this.log_("Listen called for "+rt+" "+$),this.listens.has(rt)||this.listens.set(rt,new Map),assert(i._queryParams.isDefault()||!i._queryParams.loadsAllData(),"listen() called for non-default but complete query"),assert(!this.listens.get(rt).has($),"listen() called twice for same path/queryId.");const c={onComplete:_,hashFn:s,query:i,tag:a};this.listens.get(rt).set($,c),this.connected_&&this.sendListen_(c)}sendGet_(i){const s=this.outstandingGets_[i];this.sendRequest("g",s.request,a=>{delete this.outstandingGets_[i],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),s.onComplete&&s.onComplete(a)})}sendListen_(i){const s=i.query,a=s._path.toString(),_=s._queryIdentifier;this.log_("Listen on "+a+" for "+_);const $={p:a},rt="q";i.tag&&($.q=s._queryObject,$.t=i.tag),$.h=i.hashFn(),this.sendRequest(rt,$,c=>{const dt=c.d,ht=c.s;PersistentConnection.warnOnListenWarnings_(dt,s),(this.listens.get(a)&&this.listens.get(a).get(_))===i&&(this.log_("listen response",c),ht!=="ok"&&this.removeListen_(a,_),i.onComplete&&i.onComplete(ht,dt))})}static warnOnListenWarnings_(i,s){if(i&&typeof i=="object"&&contains(i,"w")){const a=safeGet(i,"w");if(Array.isArray(a)&&~a.indexOf("no_index")){const _='".indexOn": "'+s._queryParams.getIndex().toString()+'"',$=s._path.toString();warn(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${_} at ${$} to your security rules for better performance.`)}}}refreshAuthToken(i){this.authToken_=i,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(i)}reduceReconnectDelayIfAdminCredential_(i){(i&&i.length===40||isAdmin(i))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=RECONNECT_MAX_DELAY_FOR_ADMINS)}refreshAppCheckToken(i){this.appCheckToken_=i,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const i=this.authToken_,s=isValidFormat(i)?"auth":"gauth",a={cred:i};this.authOverride_===null?a.noauth=!0:typeof this.authOverride_=="object"&&(a.authvar=this.authOverride_),this.sendRequest(s,a,_=>{const $=_.s,rt=_.d||"error";this.authToken_===i&&($==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_($,rt))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},i=>{const s=i.s,a=i.d||"error";s==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(s,a)})}unlisten(i,s){const a=i._path.toString(),_=i._queryIdentifier;this.log_("Unlisten called for "+a+" "+_),assert(i._queryParams.isDefault()||!i._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(a,_)&&this.connected_&&this.sendUnlisten_(a,_,i._queryObject,s)}sendUnlisten_(i,s,a,_){this.log_("Unlisten on "+i+" for "+s);const $={p:i},rt="n";_&&($.q=a,$.t=_),this.sendRequest(rt,$)}onDisconnectPut(i,s,a){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",i,s,a):this.onDisconnectRequestQueue_.push({pathString:i,action:"o",data:s,onComplete:a})}onDisconnectMerge(i,s,a){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",i,s,a):this.onDisconnectRequestQueue_.push({pathString:i,action:"om",data:s,onComplete:a})}onDisconnectCancel(i,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",i,null,s):this.onDisconnectRequestQueue_.push({pathString:i,action:"oc",data:null,onComplete:s})}sendOnDisconnect_(i,s,a,_){const $={p:s,d:a};this.log_("onDisconnect "+i,$),this.sendRequest(i,$,rt=>{_&&setTimeout(()=>{_(rt.s,rt.d)},Math.floor(0))})}put(i,s,a,_){this.putInternal("p",i,s,a,_)}merge(i,s,a,_){this.putInternal("m",i,s,a,_)}putInternal(i,s,a,_,$){this.initConnection_();const rt={p:s,d:a};$!==void 0&&(rt.h=$),this.outstandingPuts_.push({action:i,request:rt,onComplete:_}),this.outstandingPutCount_++;const c=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(c):this.log_("Buffering put: "+s)}sendPut_(i){const s=this.outstandingPuts_[i].action,a=this.outstandingPuts_[i].request,_=this.outstandingPuts_[i].onComplete;this.outstandingPuts_[i].queued=this.connected_,this.sendRequest(s,a,$=>{this.log_(s+" response",$),delete this.outstandingPuts_[i],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),_&&_($.s,$.d)})}reportStats(i){if(this.connected_){const s={c:i};this.log_("reportStats",s),this.sendRequest("s",s,a=>{if(a.s!=="ok"){const $=a.d;this.log_("reportStats","Error sending stats: "+$)}})}}onDataMessage_(i){if("r"in i){this.log_("from server: "+stringify(i));const s=i.r,a=this.requestCBHash_[s];a&&(delete this.requestCBHash_[s],a(i.b))}else{if("error"in i)throw"A server-side error has occurred: "+i.error;"a"in i&&this.onDataPush_(i.a,i.b)}}onDataPush_(i,s){this.log_("handleServerMessage",i,s),i==="d"?this.onDataUpdate_(s.p,s.d,!1,s.t):i==="m"?this.onDataUpdate_(s.p,s.d,!0,s.t):i==="c"?this.onListenRevoked_(s.p,s.q):i==="ac"?this.onAuthRevoked_(s.s,s.d):i==="apc"?this.onAppCheckRevoked_(s.s,s.d):i==="sd"?this.onSecurityDebugPacket_(s):error("Unrecognized action received from server: "+stringify(i)+`
Are you using the latest client?`)}onReady_(i,s){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(i),this.lastSessionId=s,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(i){assert(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(i))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(i){i&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=RECONNECT_MIN_DELAY,this.realtime_||this.scheduleConnect_(0)),this.visible_=i}onOnline_(i){i?(this.log_("Browser went online."),this.reconnectDelay_=RECONNECT_MIN_DELAY,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>RECONNECT_DELAY_RESET_TIMEOUT&&(this.reconnectDelay_=RECONNECT_MIN_DELAY),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const i=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_);let s=Math.max(0,this.reconnectDelay_-i);s=Math.random()*s,this.log_("Trying to reconnect in "+s+"ms"),this.scheduleConnect_(s),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*RECONNECT_DELAY_MULTIPLIER)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const i=this.onDataMessage_.bind(this),s=this.onReady_.bind(this),a=this.onRealtimeDisconnect_.bind(this),_=this.id+":"+PersistentConnection.nextConnectionId_++,$=this.lastSessionId;let rt=!1,c=null;const dt=function(){c?c.close():(rt=!0,a())},ht=function(St){assert(c,"sendRequest call when we're not connected not allowed."),c.sendRequest(St)};this.realtime_={close:dt,sendRequest:ht};const Et=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[St,At]=await Promise.all([this.authTokenProvider_.getToken(Et),this.appCheckTokenProvider_.getToken(Et)]);rt?log("getToken() completed but was canceled"):(log("getToken() completed. Creating connection."),this.authToken_=St&&St.accessToken,this.appCheckToken_=At&&At.token,c=new Connection(_,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,i,s,a,Pt=>{warn(Pt+" ("+this.repoInfo_.toString()+")"),this.interrupt(SERVER_KILL_INTERRUPT_REASON)},$))}catch(St){this.log_("Failed to get token: "+St),rt||(this.repoInfo_.nodeAdmin&&warn(St),dt())}}}interrupt(i){log("Interrupting connection for reason: "+i),this.interruptReasons_[i]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(i){log("Resuming connection for reason: "+i),delete this.interruptReasons_[i],isEmpty(this.interruptReasons_)&&(this.reconnectDelay_=RECONNECT_MIN_DELAY,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(i){const s=i-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:s})}cancelSentTransactions_(){for(let i=0;i<this.outstandingPuts_.length;i++){const s=this.outstandingPuts_[i];s&&"h"in s.request&&s.queued&&(s.onComplete&&s.onComplete("disconnect"),delete this.outstandingPuts_[i],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(i,s){let a;s?a=s.map($=>ObjectToUniqueKey($)).join("$"):a="default";const _=this.removeListen_(i,a);_&&_.onComplete&&_.onComplete("permission_denied")}removeListen_(i,s){const a=new Path(i).toString();let _;if(this.listens.has(a)){const $=this.listens.get(a);_=$.get(s),$.delete(s),$.size===0&&this.listens.delete(a)}else _=void 0;return _}onAuthRevoked_(i,s){log("Auth token revoked: "+i+"/"+s),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(i==="invalid_token"||i==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=INVALID_TOKEN_THRESHOLD&&(this.reconnectDelay_=RECONNECT_MAX_DELAY_FOR_ADMINS,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(i,s){log("App check token revoked: "+i+"/"+s),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(i==="invalid_token"||i==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=INVALID_TOKEN_THRESHOLD&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(i){this.securityDebugCallback_?this.securityDebugCallback_(i):"msg"in i&&console.log("FIREBASE: "+i.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const i of this.listens.values())for(const s of i.values())this.sendListen_(s);for(let i=0;i<this.outstandingPuts_.length;i++)this.outstandingPuts_[i]&&this.sendPut_(i);for(;this.onDisconnectRequestQueue_.length;){const i=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(i.action,i.pathString,i.data,i.onComplete)}for(let i=0;i<this.outstandingGets_.length;i++)this.outstandingGets_[i]&&this.sendGet_(i)}sendConnectStats_(){const i={};let s="js";i["sdk."+s+"."+SDK_VERSION.replace(/\./g,"-")]=1,isMobileCordova()?i["framework.cordova"]=1:isReactNative()&&(i["framework.reactnative"]=1),this.reportStats(i)}shouldReconnect_(){const i=OnlineMonitor.getInstance().currentlyOnline();return isEmpty(this.interruptReasons_)&&i}}PersistentConnection.nextPersistentConnectionId_=0;PersistentConnection.nextConnectionId_=0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NamedNode{constructor(i,s){this.name=i,this.node=s}static Wrap(i,s){return new NamedNode(i,s)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Index{getCompare(){return this.compare.bind(this)}indexedValueChanged(i,s){const a=new NamedNode(MIN_NAME,i),_=new NamedNode(MIN_NAME,s);return this.compare(a,_)!==0}minPost(){return NamedNode.MIN}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let __EMPTY_NODE;class KeyIndex extends Index{static get __EMPTY_NODE(){return __EMPTY_NODE}static set __EMPTY_NODE(i){__EMPTY_NODE=i}compare(i,s){return nameCompare(i.name,s.name)}isDefinedOn(i){throw assertionError("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(i,s){return!1}minPost(){return NamedNode.MIN}maxPost(){return new NamedNode(MAX_NAME,__EMPTY_NODE)}makePost(i,s){return assert(typeof i=="string","KeyIndex indexValue must always be a string."),new NamedNode(i,__EMPTY_NODE)}toString(){return".key"}}const KEY_INDEX=new KeyIndex;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SortedMapIterator{constructor(i,s,a,_,$=null){this.isReverse_=_,this.resultGenerator_=$,this.nodeStack_=[];let rt=1;for(;!i.isEmpty();)if(i=i,rt=s?a(i.key,s):1,_&&(rt*=-1),rt<0)this.isReverse_?i=i.left:i=i.right;else if(rt===0){this.nodeStack_.push(i);break}else this.nodeStack_.push(i),this.isReverse_?i=i.right:i=i.left}getNext(){if(this.nodeStack_.length===0)return null;let i=this.nodeStack_.pop(),s;if(this.resultGenerator_?s=this.resultGenerator_(i.key,i.value):s={key:i.key,value:i.value},this.isReverse_)for(i=i.left;!i.isEmpty();)this.nodeStack_.push(i),i=i.right;else for(i=i.right;!i.isEmpty();)this.nodeStack_.push(i),i=i.left;return s}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const i=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(i.key,i.value):{key:i.key,value:i.value}}}class LLRBNode{constructor(i,s,a,_,$){this.key=i,this.value=s,this.color=a??LLRBNode.RED,this.left=_??SortedMap.EMPTY_NODE,this.right=$??SortedMap.EMPTY_NODE}copy(i,s,a,_,$){return new LLRBNode(i??this.key,s??this.value,a??this.color,_??this.left,$??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(i){return this.left.inorderTraversal(i)||!!i(this.key,this.value)||this.right.inorderTraversal(i)}reverseTraversal(i){return this.right.reverseTraversal(i)||i(this.key,this.value)||this.left.reverseTraversal(i)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(i,s,a){let _=this;const $=a(i,_.key);return $<0?_=_.copy(null,null,null,_.left.insert(i,s,a),null):$===0?_=_.copy(null,s,null,null,null):_=_.copy(null,null,null,null,_.right.insert(i,s,a)),_.fixUp_()}removeMin_(){if(this.left.isEmpty())return SortedMap.EMPTY_NODE;let i=this;return!i.left.isRed_()&&!i.left.left.isRed_()&&(i=i.moveRedLeft_()),i=i.copy(null,null,null,i.left.removeMin_(),null),i.fixUp_()}remove(i,s){let a,_;if(a=this,s(i,a.key)<0)!a.left.isEmpty()&&!a.left.isRed_()&&!a.left.left.isRed_()&&(a=a.moveRedLeft_()),a=a.copy(null,null,null,a.left.remove(i,s),null);else{if(a.left.isRed_()&&(a=a.rotateRight_()),!a.right.isEmpty()&&!a.right.isRed_()&&!a.right.left.isRed_()&&(a=a.moveRedRight_()),s(i,a.key)===0){if(a.right.isEmpty())return SortedMap.EMPTY_NODE;_=a.right.min_(),a=a.copy(_.key,_.value,null,null,a.right.removeMin_())}a=a.copy(null,null,null,null,a.right.remove(i,s))}return a.fixUp_()}isRed_(){return this.color}fixUp_(){let i=this;return i.right.isRed_()&&!i.left.isRed_()&&(i=i.rotateLeft_()),i.left.isRed_()&&i.left.left.isRed_()&&(i=i.rotateRight_()),i.left.isRed_()&&i.right.isRed_()&&(i=i.colorFlip_()),i}moveRedLeft_(){let i=this.colorFlip_();return i.right.left.isRed_()&&(i=i.copy(null,null,null,null,i.right.rotateRight_()),i=i.rotateLeft_(),i=i.colorFlip_()),i}moveRedRight_(){let i=this.colorFlip_();return i.left.left.isRed_()&&(i=i.rotateRight_(),i=i.colorFlip_()),i}rotateLeft_(){const i=this.copy(null,null,LLRBNode.RED,null,this.right.left);return this.right.copy(null,null,this.color,i,null)}rotateRight_(){const i=this.copy(null,null,LLRBNode.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,i)}colorFlip_(){const i=this.left.copy(null,null,!this.left.color,null,null),s=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,i,s)}checkMaxDepth_(){const i=this.check_();return Math.pow(2,i)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const i=this.left.check_();if(i!==this.right.check_())throw new Error("Black depths differ");return i+(this.isRed_()?0:1)}}LLRBNode.RED=!0;LLRBNode.BLACK=!1;class LLRBEmptyNode{copy(i,s,a,_,$){return this}insert(i,s,a){return new LLRBNode(i,s,null)}remove(i,s){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(i){return!1}reverseTraversal(i){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class SortedMap{constructor(i,s=SortedMap.EMPTY_NODE){this.comparator_=i,this.root_=s}insert(i,s){return new SortedMap(this.comparator_,this.root_.insert(i,s,this.comparator_).copy(null,null,LLRBNode.BLACK,null,null))}remove(i){return new SortedMap(this.comparator_,this.root_.remove(i,this.comparator_).copy(null,null,LLRBNode.BLACK,null,null))}get(i){let s,a=this.root_;for(;!a.isEmpty();){if(s=this.comparator_(i,a.key),s===0)return a.value;s<0?a=a.left:s>0&&(a=a.right)}return null}getPredecessorKey(i){let s,a=this.root_,_=null;for(;!a.isEmpty();)if(s=this.comparator_(i,a.key),s===0){if(a.left.isEmpty())return _?_.key:null;for(a=a.left;!a.right.isEmpty();)a=a.right;return a.key}else s<0?a=a.left:s>0&&(_=a,a=a.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(i){return this.root_.inorderTraversal(i)}reverseTraversal(i){return this.root_.reverseTraversal(i)}getIterator(i){return new SortedMapIterator(this.root_,null,this.comparator_,!1,i)}getIteratorFrom(i,s){return new SortedMapIterator(this.root_,i,this.comparator_,!1,s)}getReverseIteratorFrom(i,s){return new SortedMapIterator(this.root_,i,this.comparator_,!0,s)}getReverseIterator(i){return new SortedMapIterator(this.root_,null,this.comparator_,!0,i)}}SortedMap.EMPTY_NODE=new LLRBEmptyNode;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function NAME_ONLY_COMPARATOR(e,i){return nameCompare(e.name,i.name)}function NAME_COMPARATOR(e,i){return nameCompare(e,i)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let MAX_NODE$2;function setMaxNode$1(e){MAX_NODE$2=e}const priorityHashText=function(e){return typeof e=="number"?"number:"+doubleToIEEE754String(e):"string:"+e},validatePriorityNode=function(e){if(e.isLeafNode()){const i=e.val();assert(typeof i=="string"||typeof i=="number"||typeof i=="object"&&contains(i,".sv"),"Priority must be a string or number.")}else assert(e===MAX_NODE$2||e.isEmpty(),"priority of unexpected type.");assert(e===MAX_NODE$2||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let __childrenNodeConstructor;class LeafNode{static set __childrenNodeConstructor(i){__childrenNodeConstructor=i}static get __childrenNodeConstructor(){return __childrenNodeConstructor}constructor(i,s=LeafNode.__childrenNodeConstructor.EMPTY_NODE){this.value_=i,this.priorityNode_=s,this.lazyHash_=null,assert(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),validatePriorityNode(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(i){return new LeafNode(this.value_,i)}getImmediateChild(i){return i===".priority"?this.priorityNode_:LeafNode.__childrenNodeConstructor.EMPTY_NODE}getChild(i){return pathIsEmpty(i)?this:pathGetFront(i)===".priority"?this.priorityNode_:LeafNode.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(i,s){return null}updateImmediateChild(i,s){return i===".priority"?this.updatePriority(s):s.isEmpty()&&i!==".priority"?this:LeafNode.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(i,s).updatePriority(this.priorityNode_)}updateChild(i,s){const a=pathGetFront(i);return a===null?s:s.isEmpty()&&a!==".priority"?this:(assert(a!==".priority"||pathGetLength(i)===1,".priority must be the last token in a path"),this.updateImmediateChild(a,LeafNode.__childrenNodeConstructor.EMPTY_NODE.updateChild(pathPopFront(i),s)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(i,s){return!1}val(i){return i&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let i="";this.priorityNode_.isEmpty()||(i+="priority:"+priorityHashText(this.priorityNode_.val())+":");const s=typeof this.value_;i+=s+":",s==="number"?i+=doubleToIEEE754String(this.value_):i+=this.value_,this.lazyHash_=sha1(i)}return this.lazyHash_}getValue(){return this.value_}compareTo(i){return i===LeafNode.__childrenNodeConstructor.EMPTY_NODE?1:i instanceof LeafNode.__childrenNodeConstructor?-1:(assert(i.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(i))}compareToLeafNode_(i){const s=typeof i.value_,a=typeof this.value_,_=LeafNode.VALUE_TYPE_ORDER.indexOf(s),$=LeafNode.VALUE_TYPE_ORDER.indexOf(a);return assert(_>=0,"Unknown leaf type: "+s),assert($>=0,"Unknown leaf type: "+a),_===$?a==="object"?0:this.value_<i.value_?-1:this.value_===i.value_?0:1:$-_}withIndex(){return this}isIndexed(){return!0}equals(i){if(i===this)return!0;if(i.isLeafNode()){const s=i;return this.value_===s.value_&&this.priorityNode_.equals(s.priorityNode_)}else return!1}}LeafNode.VALUE_TYPE_ORDER=["object","boolean","number","string"];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let nodeFromJSON$1,MAX_NODE$1;function setNodeFromJSON(e){nodeFromJSON$1=e}function setMaxNode(e){MAX_NODE$1=e}class PriorityIndex extends Index{compare(i,s){const a=i.node.getPriority(),_=s.node.getPriority(),$=a.compareTo(_);return $===0?nameCompare(i.name,s.name):$}isDefinedOn(i){return!i.getPriority().isEmpty()}indexedValueChanged(i,s){return!i.getPriority().equals(s.getPriority())}minPost(){return NamedNode.MIN}maxPost(){return new NamedNode(MAX_NAME,new LeafNode("[PRIORITY-POST]",MAX_NODE$1))}makePost(i,s){const a=nodeFromJSON$1(i);return new NamedNode(s,new LeafNode("[PRIORITY-POST]",a))}toString(){return".priority"}}const PRIORITY_INDEX=new PriorityIndex;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LOG_2=Math.log(2);class Base12Num{constructor(i){const s=$=>parseInt(Math.log($)/LOG_2,10),a=$=>parseInt(Array($+1).join("1"),2);this.count=s(i+1),this.current_=this.count-1;const _=a(this.count);this.bits_=i+1&_}nextBitIsOne(){const i=!(this.bits_&1<<this.current_);return this.current_--,i}}const buildChildSet=function(e,i,s,a){e.sort(i);const _=function(dt,ht){const Et=ht-dt;let St,At;if(Et===0)return null;if(Et===1)return St=e[dt],At=s?s(St):St,new LLRBNode(At,St.node,LLRBNode.BLACK,null,null);{const Pt=parseInt(Et/2,10)+dt,Vt=_(dt,Pt),Bt=_(Pt+1,ht);return St=e[Pt],At=s?s(St):St,new LLRBNode(At,St.node,LLRBNode.BLACK,Vt,Bt)}},$=function(dt){let ht=null,Et=null,St=e.length;const At=function(Vt,Bt){const Zt=St-Vt,zt=St;St-=Vt;const Ut=_(Zt+1,zt),Nt=e[Zt],Gt=s?s(Nt):Nt;Pt(new LLRBNode(Gt,Nt.node,Bt,null,Ut))},Pt=function(Vt){ht?(ht.left=Vt,ht=Vt):(Et=Vt,ht=Vt)};for(let Vt=0;Vt<dt.count;++Vt){const Bt=dt.nextBitIsOne(),Zt=Math.pow(2,dt.count-(Vt+1));Bt?At(Zt,LLRBNode.BLACK):(At(Zt,LLRBNode.BLACK),At(Zt,LLRBNode.RED))}return Et},rt=new Base12Num(e.length),c=$(rt);return new SortedMap(a||i,c)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let _defaultIndexMap;const fallbackObject={};class IndexMap{static get Default(){return assert(fallbackObject&&PRIORITY_INDEX,"ChildrenNode.ts has not been loaded"),_defaultIndexMap=_defaultIndexMap||new IndexMap({".priority":fallbackObject},{".priority":PRIORITY_INDEX}),_defaultIndexMap}constructor(i,s){this.indexes_=i,this.indexSet_=s}get(i){const s=safeGet(this.indexes_,i);if(!s)throw new Error("No index defined for "+i);return s instanceof SortedMap?s:null}hasIndex(i){return contains(this.indexSet_,i.toString())}addIndex(i,s){assert(i!==KEY_INDEX,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const a=[];let _=!1;const $=s.getIterator(NamedNode.Wrap);let rt=$.getNext();for(;rt;)_=_||i.isDefinedOn(rt.node),a.push(rt),rt=$.getNext();let c;_?c=buildChildSet(a,i.getCompare()):c=fallbackObject;const dt=i.toString(),ht={...this.indexSet_};ht[dt]=i;const Et={...this.indexes_};return Et[dt]=c,new IndexMap(Et,ht)}addToIndexes(i,s){const a=map(this.indexes_,(_,$)=>{const rt=safeGet(this.indexSet_,$);if(assert(rt,"Missing index implementation for "+$),_===fallbackObject)if(rt.isDefinedOn(i.node)){const c=[],dt=s.getIterator(NamedNode.Wrap);let ht=dt.getNext();for(;ht;)ht.name!==i.name&&c.push(ht),ht=dt.getNext();return c.push(i),buildChildSet(c,rt.getCompare())}else return fallbackObject;else{const c=s.get(i.name);let dt=_;return c&&(dt=dt.remove(new NamedNode(i.name,c))),dt.insert(i,i.node)}});return new IndexMap(a,this.indexSet_)}removeFromIndexes(i,s){const a=map(this.indexes_,_=>{if(_===fallbackObject)return _;{const $=s.get(i.name);return $?_.remove(new NamedNode(i.name,$)):_}});return new IndexMap(a,this.indexSet_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let EMPTY_NODE;class ChildrenNode{static get EMPTY_NODE(){return EMPTY_NODE||(EMPTY_NODE=new ChildrenNode(new SortedMap(NAME_COMPARATOR),null,IndexMap.Default))}constructor(i,s,a){this.children_=i,this.priorityNode_=s,this.indexMap_=a,this.lazyHash_=null,this.priorityNode_&&validatePriorityNode(this.priorityNode_),this.children_.isEmpty()&&assert(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||EMPTY_NODE}updatePriority(i){return this.children_.isEmpty()?this:new ChildrenNode(this.children_,i,this.indexMap_)}getImmediateChild(i){if(i===".priority")return this.getPriority();{const s=this.children_.get(i);return s===null?EMPTY_NODE:s}}getChild(i){const s=pathGetFront(i);return s===null?this:this.getImmediateChild(s).getChild(pathPopFront(i))}hasChild(i){return this.children_.get(i)!==null}updateImmediateChild(i,s){if(assert(s,"We should always be passing snapshot nodes"),i===".priority")return this.updatePriority(s);{const a=new NamedNode(i,s);let _,$;s.isEmpty()?(_=this.children_.remove(i),$=this.indexMap_.removeFromIndexes(a,this.children_)):(_=this.children_.insert(i,s),$=this.indexMap_.addToIndexes(a,this.children_));const rt=_.isEmpty()?EMPTY_NODE:this.priorityNode_;return new ChildrenNode(_,rt,$)}}updateChild(i,s){const a=pathGetFront(i);if(a===null)return s;{assert(pathGetFront(i)!==".priority"||pathGetLength(i)===1,".priority must be the last token in a path");const _=this.getImmediateChild(a).updateChild(pathPopFront(i),s);return this.updateImmediateChild(a,_)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(i){if(this.isEmpty())return null;const s={};let a=0,_=0,$=!0;if(this.forEachChild(PRIORITY_INDEX,(rt,c)=>{s[rt]=c.val(i),a++,$&&ChildrenNode.INTEGER_REGEXP_.test(rt)?_=Math.max(_,Number(rt)):$=!1}),!i&&$&&_<2*a){const rt=[];for(const c in s)rt[c]=s[c];return rt}else return i&&!this.getPriority().isEmpty()&&(s[".priority"]=this.getPriority().val()),s}hash(){if(this.lazyHash_===null){let i="";this.getPriority().isEmpty()||(i+="priority:"+priorityHashText(this.getPriority().val())+":"),this.forEachChild(PRIORITY_INDEX,(s,a)=>{const _=a.hash();_!==""&&(i+=":"+s+":"+_)}),this.lazyHash_=i===""?"":sha1(i)}return this.lazyHash_}getPredecessorChildName(i,s,a){const _=this.resolveIndex_(a);if(_){const $=_.getPredecessorKey(new NamedNode(i,s));return $?$.name:null}else return this.children_.getPredecessorKey(i)}getFirstChildName(i){const s=this.resolveIndex_(i);if(s){const a=s.minKey();return a&&a.name}else return this.children_.minKey()}getFirstChild(i){const s=this.getFirstChildName(i);return s?new NamedNode(s,this.children_.get(s)):null}getLastChildName(i){const s=this.resolveIndex_(i);if(s){const a=s.maxKey();return a&&a.name}else return this.children_.maxKey()}getLastChild(i){const s=this.getLastChildName(i);return s?new NamedNode(s,this.children_.get(s)):null}forEachChild(i,s){const a=this.resolveIndex_(i);return a?a.inorderTraversal(_=>s(_.name,_.node)):this.children_.inorderTraversal(s)}getIterator(i){return this.getIteratorFrom(i.minPost(),i)}getIteratorFrom(i,s){const a=this.resolveIndex_(s);if(a)return a.getIteratorFrom(i,_=>_);{const _=this.children_.getIteratorFrom(i.name,NamedNode.Wrap);let $=_.peek();for(;$!=null&&s.compare($,i)<0;)_.getNext(),$=_.peek();return _}}getReverseIterator(i){return this.getReverseIteratorFrom(i.maxPost(),i)}getReverseIteratorFrom(i,s){const a=this.resolveIndex_(s);if(a)return a.getReverseIteratorFrom(i,_=>_);{const _=this.children_.getReverseIteratorFrom(i.name,NamedNode.Wrap);let $=_.peek();for(;$!=null&&s.compare($,i)>0;)_.getNext(),$=_.peek();return _}}compareTo(i){return this.isEmpty()?i.isEmpty()?0:-1:i.isLeafNode()||i.isEmpty()?1:i===MAX_NODE?-1:0}withIndex(i){if(i===KEY_INDEX||this.indexMap_.hasIndex(i))return this;{const s=this.indexMap_.addIndex(i,this.children_);return new ChildrenNode(this.children_,this.priorityNode_,s)}}isIndexed(i){return i===KEY_INDEX||this.indexMap_.hasIndex(i)}equals(i){if(i===this)return!0;if(i.isLeafNode())return!1;{const s=i;if(this.getPriority().equals(s.getPriority()))if(this.children_.count()===s.children_.count()){const a=this.getIterator(PRIORITY_INDEX),_=s.getIterator(PRIORITY_INDEX);let $=a.getNext(),rt=_.getNext();for(;$&&rt;){if($.name!==rt.name||!$.node.equals(rt.node))return!1;$=a.getNext(),rt=_.getNext()}return $===null&&rt===null}else return!1;else return!1}}resolveIndex_(i){return i===KEY_INDEX?null:this.indexMap_.get(i.toString())}}ChildrenNode.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class MaxNode extends ChildrenNode{constructor(){super(new SortedMap(NAME_COMPARATOR),ChildrenNode.EMPTY_NODE,IndexMap.Default)}compareTo(i){return i===this?0:1}equals(i){return i===this}getPriority(){return this}getImmediateChild(i){return ChildrenNode.EMPTY_NODE}isEmpty(){return!1}}const MAX_NODE=new MaxNode;Object.defineProperties(NamedNode,{MIN:{value:new NamedNode(MIN_NAME,ChildrenNode.EMPTY_NODE)},MAX:{value:new NamedNode(MAX_NAME,MAX_NODE)}});KeyIndex.__EMPTY_NODE=ChildrenNode.EMPTY_NODE;LeafNode.__childrenNodeConstructor=ChildrenNode;setMaxNode$1(MAX_NODE);setMaxNode(MAX_NODE);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const USE_HINZE=!0;function nodeFromJSON(e,i=null){if(e===null)return ChildrenNode.EMPTY_NODE;if(typeof e=="object"&&".priority"in e&&(i=e[".priority"]),assert(i===null||typeof i=="string"||typeof i=="number"||typeof i=="object"&&".sv"in i,"Invalid priority type found: "+typeof i),typeof e=="object"&&".value"in e&&e[".value"]!==null&&(e=e[".value"]),typeof e!="object"||".sv"in e){const s=e;return new LeafNode(s,nodeFromJSON(i))}if(!(e instanceof Array)&&USE_HINZE){const s=[];let a=!1;if(each(e,(rt,c)=>{if(rt.substring(0,1)!=="."){const dt=nodeFromJSON(c);dt.isEmpty()||(a=a||!dt.getPriority().isEmpty(),s.push(new NamedNode(rt,dt)))}}),s.length===0)return ChildrenNode.EMPTY_NODE;const $=buildChildSet(s,NAME_ONLY_COMPARATOR,rt=>rt.name,NAME_COMPARATOR);if(a){const rt=buildChildSet(s,PRIORITY_INDEX.getCompare());return new ChildrenNode($,nodeFromJSON(i),new IndexMap({".priority":rt},{".priority":PRIORITY_INDEX}))}else return new ChildrenNode($,nodeFromJSON(i),IndexMap.Default)}else{let s=ChildrenNode.EMPTY_NODE;return each(e,(a,_)=>{if(contains(e,a)&&a.substring(0,1)!=="."){const $=nodeFromJSON(_);($.isLeafNode()||!$.isEmpty())&&(s=s.updateImmediateChild(a,$))}}),s.updatePriority(nodeFromJSON(i))}}setNodeFromJSON(nodeFromJSON);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PathIndex extends Index{constructor(i){super(),this.indexPath_=i,assert(!pathIsEmpty(i)&&pathGetFront(i)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(i){return i.getChild(this.indexPath_)}isDefinedOn(i){return!i.getChild(this.indexPath_).isEmpty()}compare(i,s){const a=this.extractChild(i.node),_=this.extractChild(s.node),$=a.compareTo(_);return $===0?nameCompare(i.name,s.name):$}makePost(i,s){const a=nodeFromJSON(i),_=ChildrenNode.EMPTY_NODE.updateChild(this.indexPath_,a);return new NamedNode(s,_)}maxPost(){const i=ChildrenNode.EMPTY_NODE.updateChild(this.indexPath_,MAX_NODE);return new NamedNode(MAX_NAME,i)}toString(){return pathSlice(this.indexPath_,0).join("/")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ValueIndex extends Index{compare(i,s){const a=i.node.compareTo(s.node);return a===0?nameCompare(i.name,s.name):a}isDefinedOn(i){return!0}indexedValueChanged(i,s){return!i.equals(s)}minPost(){return NamedNode.MIN}maxPost(){return NamedNode.MAX}makePost(i,s){const a=nodeFromJSON(i);return new NamedNode(s,a)}toString(){return".value"}}const VALUE_INDEX=new ValueIndex;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function changeValue(e){return{type:"value",snapshotNode:e}}function changeChildAdded(e,i){return{type:"child_added",snapshotNode:i,childName:e}}function changeChildRemoved(e,i){return{type:"child_removed",snapshotNode:i,childName:e}}function changeChildChanged(e,i,s){return{type:"child_changed",snapshotNode:i,childName:e,oldSnap:s}}function changeChildMoved(e,i){return{type:"child_moved",snapshotNode:i,childName:e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IndexedFilter{constructor(i){this.index_=i}updateChild(i,s,a,_,$,rt){assert(i.isIndexed(this.index_),"A node must be indexed if only a child is updated");const c=i.getImmediateChild(s);return c.getChild(_).equals(a.getChild(_))&&c.isEmpty()===a.isEmpty()||(rt!=null&&(a.isEmpty()?i.hasChild(s)?rt.trackChildChange(changeChildRemoved(s,c)):assert(i.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):c.isEmpty()?rt.trackChildChange(changeChildAdded(s,a)):rt.trackChildChange(changeChildChanged(s,a,c))),i.isLeafNode()&&a.isEmpty())?i:i.updateImmediateChild(s,a).withIndex(this.index_)}updateFullNode(i,s,a){return a!=null&&(i.isLeafNode()||i.forEachChild(PRIORITY_INDEX,(_,$)=>{s.hasChild(_)||a.trackChildChange(changeChildRemoved(_,$))}),s.isLeafNode()||s.forEachChild(PRIORITY_INDEX,(_,$)=>{if(i.hasChild(_)){const rt=i.getImmediateChild(_);rt.equals($)||a.trackChildChange(changeChildChanged(_,$,rt))}else a.trackChildChange(changeChildAdded(_,$))})),s.withIndex(this.index_)}updatePriority(i,s){return i.isEmpty()?ChildrenNode.EMPTY_NODE:i.updatePriority(s)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RangedFilter{constructor(i){this.indexedFilter_=new IndexedFilter(i.getIndex()),this.index_=i.getIndex(),this.startPost_=RangedFilter.getStartPost_(i),this.endPost_=RangedFilter.getEndPost_(i),this.startIsInclusive_=!i.startAfterSet_,this.endIsInclusive_=!i.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(i){const s=this.startIsInclusive_?this.index_.compare(this.getStartPost(),i)<=0:this.index_.compare(this.getStartPost(),i)<0,a=this.endIsInclusive_?this.index_.compare(i,this.getEndPost())<=0:this.index_.compare(i,this.getEndPost())<0;return s&&a}updateChild(i,s,a,_,$,rt){return this.matches(new NamedNode(s,a))||(a=ChildrenNode.EMPTY_NODE),this.indexedFilter_.updateChild(i,s,a,_,$,rt)}updateFullNode(i,s,a){s.isLeafNode()&&(s=ChildrenNode.EMPTY_NODE);let _=s.withIndex(this.index_);_=_.updatePriority(ChildrenNode.EMPTY_NODE);const $=this;return s.forEachChild(PRIORITY_INDEX,(rt,c)=>{$.matches(new NamedNode(rt,c))||(_=_.updateImmediateChild(rt,ChildrenNode.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(i,_,a)}updatePriority(i,s){return i}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(i){if(i.hasStart()){const s=i.getIndexStartName();return i.getIndex().makePost(i.getIndexStartValue(),s)}else return i.getIndex().minPost()}static getEndPost_(i){if(i.hasEnd()){const s=i.getIndexEndName();return i.getIndex().makePost(i.getIndexEndValue(),s)}else return i.getIndex().maxPost()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LimitedFilter{constructor(i){this.withinDirectionalStart=s=>this.reverse_?this.withinEndPost(s):this.withinStartPost(s),this.withinDirectionalEnd=s=>this.reverse_?this.withinStartPost(s):this.withinEndPost(s),this.withinStartPost=s=>{const a=this.index_.compare(this.rangedFilter_.getStartPost(),s);return this.startIsInclusive_?a<=0:a<0},this.withinEndPost=s=>{const a=this.index_.compare(s,this.rangedFilter_.getEndPost());return this.endIsInclusive_?a<=0:a<0},this.rangedFilter_=new RangedFilter(i),this.index_=i.getIndex(),this.limit_=i.getLimit(),this.reverse_=!i.isViewFromLeft(),this.startIsInclusive_=!i.startAfterSet_,this.endIsInclusive_=!i.endBeforeSet_}updateChild(i,s,a,_,$,rt){return this.rangedFilter_.matches(new NamedNode(s,a))||(a=ChildrenNode.EMPTY_NODE),i.getImmediateChild(s).equals(a)?i:i.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(i,s,a,_,$,rt):this.fullLimitUpdateChild_(i,s,a,$,rt)}updateFullNode(i,s,a){let _;if(s.isLeafNode()||s.isEmpty())_=ChildrenNode.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<s.numChildren()&&s.isIndexed(this.index_)){_=ChildrenNode.EMPTY_NODE.withIndex(this.index_);let $;this.reverse_?$=s.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):$=s.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let rt=0;for(;$.hasNext()&&rt<this.limit_;){const c=$.getNext();if(this.withinDirectionalStart(c))if(this.withinDirectionalEnd(c))_=_.updateImmediateChild(c.name,c.node),rt++;else break;else continue}}else{_=s.withIndex(this.index_),_=_.updatePriority(ChildrenNode.EMPTY_NODE);let $;this.reverse_?$=_.getReverseIterator(this.index_):$=_.getIterator(this.index_);let rt=0;for(;$.hasNext();){const c=$.getNext();rt<this.limit_&&this.withinDirectionalStart(c)&&this.withinDirectionalEnd(c)?rt++:_=_.updateImmediateChild(c.name,ChildrenNode.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(i,_,a)}updatePriority(i,s){return i}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(i,s,a,_,$){let rt;if(this.reverse_){const St=this.index_.getCompare();rt=(At,Pt)=>St(Pt,At)}else rt=this.index_.getCompare();const c=i;assert(c.numChildren()===this.limit_,"");const dt=new NamedNode(s,a),ht=this.reverse_?c.getFirstChild(this.index_):c.getLastChild(this.index_),Et=this.rangedFilter_.matches(dt);if(c.hasChild(s)){const St=c.getImmediateChild(s);let At=_.getChildAfterChild(this.index_,ht,this.reverse_);for(;At!=null&&(At.name===s||c.hasChild(At.name));)At=_.getChildAfterChild(this.index_,At,this.reverse_);const Pt=At==null?1:rt(At,dt);if(Et&&!a.isEmpty()&&Pt>=0)return $!=null&&$.trackChildChange(changeChildChanged(s,a,St)),c.updateImmediateChild(s,a);{$!=null&&$.trackChildChange(changeChildRemoved(s,St));const Bt=c.updateImmediateChild(s,ChildrenNode.EMPTY_NODE);return At!=null&&this.rangedFilter_.matches(At)?($!=null&&$.trackChildChange(changeChildAdded(At.name,At.node)),Bt.updateImmediateChild(At.name,At.node)):Bt}}else return a.isEmpty()?i:Et&&rt(ht,dt)>=0?($!=null&&($.trackChildChange(changeChildRemoved(ht.name,ht.node)),$.trackChildChange(changeChildAdded(s,a))),c.updateImmediateChild(s,a).updateImmediateChild(ht.name,ChildrenNode.EMPTY_NODE)):i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QueryParams{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=PRIORITY_INDEX}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return assert(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return assert(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:MIN_NAME}hasEnd(){return this.endSet_}getIndexEndValue(){return assert(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return assert(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:MAX_NAME}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return assert(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===PRIORITY_INDEX}copy(){const i=new QueryParams;return i.limitSet_=this.limitSet_,i.limit_=this.limit_,i.startSet_=this.startSet_,i.startAfterSet_=this.startAfterSet_,i.indexStartValue_=this.indexStartValue_,i.startNameSet_=this.startNameSet_,i.indexStartName_=this.indexStartName_,i.endSet_=this.endSet_,i.endBeforeSet_=this.endBeforeSet_,i.indexEndValue_=this.indexEndValue_,i.endNameSet_=this.endNameSet_,i.indexEndName_=this.indexEndName_,i.index_=this.index_,i.viewFrom_=this.viewFrom_,i}}function queryParamsGetNodeFilter(e){return e.loadsAllData()?new IndexedFilter(e.getIndex()):e.hasLimit()?new LimitedFilter(e):new RangedFilter(e)}function queryParamsToRestQueryStringParameters(e){const i={};if(e.isDefault())return i;let s;if(e.index_===PRIORITY_INDEX?s="$priority":e.index_===VALUE_INDEX?s="$value":e.index_===KEY_INDEX?s="$key":(assert(e.index_ instanceof PathIndex,"Unrecognized index type!"),s=e.index_.toString()),i.orderBy=stringify(s),e.startSet_){const a=e.startAfterSet_?"startAfter":"startAt";i[a]=stringify(e.indexStartValue_),e.startNameSet_&&(i[a]+=","+stringify(e.indexStartName_))}if(e.endSet_){const a=e.endBeforeSet_?"endBefore":"endAt";i[a]=stringify(e.indexEndValue_),e.endNameSet_&&(i[a]+=","+stringify(e.indexEndName_))}return e.limitSet_&&(e.isViewFromLeft()?i.limitToFirst=e.limit_:i.limitToLast=e.limit_),i}function queryParamsGetQueryObject(e){const i={};if(e.startSet_&&(i.sp=e.indexStartValue_,e.startNameSet_&&(i.sn=e.indexStartName_),i.sin=!e.startAfterSet_),e.endSet_&&(i.ep=e.indexEndValue_,e.endNameSet_&&(i.en=e.indexEndName_),i.ein=!e.endBeforeSet_),e.limitSet_){i.l=e.limit_;let s=e.viewFrom_;s===""&&(e.isViewFromLeft()?s="l":s="r"),i.vf=s}return e.index_!==PRIORITY_INDEX&&(i.i=e.index_.toString()),i}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ReadonlyRestClient extends ServerActions{reportStats(i){throw new Error("Method not implemented.")}static getListenId_(i,s){return s!==void 0?"tag$"+s:(assert(i._queryParams.isDefault(),"should have a tag if it's not a default query."),i._path.toString())}constructor(i,s,a,_){super(),this.repoInfo_=i,this.onDataUpdate_=s,this.authTokenProvider_=a,this.appCheckTokenProvider_=_,this.log_=logWrapper("p:rest:"),this.listens_={}}listen(i,s,a,_){const $=i._path.toString();this.log_("Listen called for "+$+" "+i._queryIdentifier);const rt=ReadonlyRestClient.getListenId_(i,a),c={};this.listens_[rt]=c;const dt=queryParamsToRestQueryStringParameters(i._queryParams);this.restRequest_($+".json",dt,(ht,Et)=>{let St=Et;if(ht===404&&(St=null,ht=null),ht===null&&this.onDataUpdate_($,St,!1,a),safeGet(this.listens_,rt)===c){let At;ht?ht===401?At="permission_denied":At="rest_error:"+ht:At="ok",_(At,null)}})}unlisten(i,s){const a=ReadonlyRestClient.getListenId_(i,s);delete this.listens_[a]}get(i){const s=queryParamsToRestQueryStringParameters(i._queryParams),a=i._path.toString(),_=new Deferred;return this.restRequest_(a+".json",s,($,rt)=>{let c=rt;$===404&&(c=null,$=null),$===null?(this.onDataUpdate_(a,c,!1,null),_.resolve(c)):_.reject(new Error(c))}),_.promise}refreshAuthToken(i){}restRequest_(i,s={},a){return s.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([_,$])=>{_&&_.accessToken&&(s.auth=_.accessToken),$&&$.token&&(s.ac=$.token);const rt=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+i+"?ns="+this.repoInfo_.namespace+querystring(s);this.log_("Sending REST request for "+rt);const c=new XMLHttpRequest;c.onreadystatechange=()=>{if(a&&c.readyState===4){this.log_("REST Response for "+rt+" received. status:",c.status,"response:",c.responseText);let dt=null;if(c.status>=200&&c.status<300){try{dt=jsonEval(c.responseText)}catch{warn("Failed to parse JSON response for "+rt+": "+c.responseText)}a(null,dt)}else c.status!==401&&c.status!==404&&warn("Got unsuccessful REST response for "+rt+" Status: "+c.status),a(c.status);a=null}},c.open("GET",rt,!0),c.send()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SnapshotHolder{constructor(){this.rootNode_=ChildrenNode.EMPTY_NODE}getNode(i){return this.rootNode_.getChild(i)}updateSnapshot(i,s){this.rootNode_=this.rootNode_.updateChild(i,s)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function newSparseSnapshotTree(){return{value:null,children:new Map}}function sparseSnapshotTreeRemember(e,i,s){if(pathIsEmpty(i))e.value=s,e.children.clear();else if(e.value!==null)e.value=e.value.updateChild(i,s);else{const a=pathGetFront(i);e.children.has(a)||e.children.set(a,newSparseSnapshotTree());const _=e.children.get(a);i=pathPopFront(i),sparseSnapshotTreeRemember(_,i,s)}}function sparseSnapshotTreeForEachTree(e,i,s){e.value!==null?s(i,e.value):sparseSnapshotTreeForEachChild(e,(a,_)=>{const $=new Path(i.toString()+"/"+a);sparseSnapshotTreeForEachTree(_,$,s)})}function sparseSnapshotTreeForEachChild(e,i){e.children.forEach((s,a)=>{i(a,s)})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class StatsListener{constructor(i){this.collection_=i,this.last_=null}get(){const i=this.collection_.get(),s={...i};return this.last_&&each(this.last_,(a,_)=>{s[a]=s[a]-_}),this.last_=i,s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FIRST_STATS_MIN_TIME=10*1e3,FIRST_STATS_MAX_TIME=30*1e3,REPORT_STATS_INTERVAL=5*60*1e3;class StatsReporter{constructor(i,s){this.server_=s,this.statsToReport_={},this.statsListener_=new StatsListener(i);const a=FIRST_STATS_MIN_TIME+(FIRST_STATS_MAX_TIME-FIRST_STATS_MIN_TIME)*Math.random();setTimeoutNonBlocking(this.reportStats_.bind(this),Math.floor(a))}reportStats_(){const i=this.statsListener_.get(),s={};let a=!1;each(i,(_,$)=>{$>0&&contains(this.statsToReport_,_)&&(s[_]=$,a=!0)}),a&&this.server_.reportStats(s),setTimeoutNonBlocking(this.reportStats_.bind(this),Math.floor(Math.random()*2*REPORT_STATS_INTERVAL))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var OperationType;(function(e){e[e.OVERWRITE=0]="OVERWRITE",e[e.MERGE=1]="MERGE",e[e.ACK_USER_WRITE=2]="ACK_USER_WRITE",e[e.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(OperationType||(OperationType={}));function newOperationSourceUser(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function newOperationSourceServer(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function newOperationSourceServerTaggedQuery(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AckUserWrite{constructor(i,s,a){this.path=i,this.affectedTree=s,this.revert=a,this.type=OperationType.ACK_USER_WRITE,this.source=newOperationSourceUser()}operationForChild(i){if(pathIsEmpty(this.path)){if(this.affectedTree.value!=null)return assert(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const s=this.affectedTree.subtree(new Path(i));return new AckUserWrite(newEmptyPath(),s,this.revert)}}else return assert(pathGetFront(this.path)===i,"operationForChild called for unrelated child."),new AckUserWrite(pathPopFront(this.path),this.affectedTree,this.revert)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ListenComplete{constructor(i,s){this.source=i,this.path=s,this.type=OperationType.LISTEN_COMPLETE}operationForChild(i){return pathIsEmpty(this.path)?new ListenComplete(this.source,newEmptyPath()):new ListenComplete(this.source,pathPopFront(this.path))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Overwrite{constructor(i,s,a){this.source=i,this.path=s,this.snap=a,this.type=OperationType.OVERWRITE}operationForChild(i){return pathIsEmpty(this.path)?new Overwrite(this.source,newEmptyPath(),this.snap.getImmediateChild(i)):new Overwrite(this.source,pathPopFront(this.path),this.snap)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Merge{constructor(i,s,a){this.source=i,this.path=s,this.children=a,this.type=OperationType.MERGE}operationForChild(i){if(pathIsEmpty(this.path)){const s=this.children.subtree(new Path(i));return s.isEmpty()?null:s.value?new Overwrite(this.source,newEmptyPath(),s.value):new Merge(this.source,newEmptyPath(),s)}else return assert(pathGetFront(this.path)===i,"Can't get a merge for a child not on the path of the operation"),new Merge(this.source,pathPopFront(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CacheNode{constructor(i,s,a){this.node_=i,this.fullyInitialized_=s,this.filtered_=a}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(i){if(pathIsEmpty(i))return this.isFullyInitialized()&&!this.filtered_;const s=pathGetFront(i);return this.isCompleteForChild(s)}isCompleteForChild(i){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(i)}getNode(){return this.node_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EventGenerator{constructor(i){this.query_=i,this.index_=this.query_._queryParams.getIndex()}}function eventGeneratorGenerateEventsForChanges(e,i,s,a){const _=[],$=[];return i.forEach(rt=>{rt.type==="child_changed"&&e.index_.indexedValueChanged(rt.oldSnap,rt.snapshotNode)&&$.push(changeChildMoved(rt.childName,rt.snapshotNode))}),eventGeneratorGenerateEventsForType(e,_,"child_removed",i,a,s),eventGeneratorGenerateEventsForType(e,_,"child_added",i,a,s),eventGeneratorGenerateEventsForType(e,_,"child_moved",$,a,s),eventGeneratorGenerateEventsForType(e,_,"child_changed",i,a,s),eventGeneratorGenerateEventsForType(e,_,"value",i,a,s),_}function eventGeneratorGenerateEventsForType(e,i,s,a,_,$){const rt=a.filter(c=>c.type===s);rt.sort((c,dt)=>eventGeneratorCompareChanges(e,c,dt)),rt.forEach(c=>{const dt=eventGeneratorMaterializeSingleChange(e,c,$);_.forEach(ht=>{ht.respondsTo(c.type)&&i.push(ht.createEvent(dt,e.query_))})})}function eventGeneratorMaterializeSingleChange(e,i,s){return i.type==="value"||i.type==="child_removed"||(i.prevName=s.getPredecessorChildName(i.childName,i.snapshotNode,e.index_)),i}function eventGeneratorCompareChanges(e,i,s){if(i.childName==null||s.childName==null)throw assertionError("Should only compare child_ events.");const a=new NamedNode(i.childName,i.snapshotNode),_=new NamedNode(s.childName,s.snapshotNode);return e.index_.compare(a,_)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function newViewCache(e,i){return{eventCache:e,serverCache:i}}function viewCacheUpdateEventSnap(e,i,s,a){return newViewCache(new CacheNode(i,s,a),e.serverCache)}function viewCacheUpdateServerSnap(e,i,s,a){return newViewCache(e.eventCache,new CacheNode(i,s,a))}function viewCacheGetCompleteEventSnap(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function viewCacheGetCompleteServerSnap(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let emptyChildrenSingleton;const EmptyChildren=()=>(emptyChildrenSingleton||(emptyChildrenSingleton=new SortedMap(stringCompare)),emptyChildrenSingleton);class ImmutableTree{static fromObject(i){let s=new ImmutableTree(null);return each(i,(a,_)=>{s=s.set(new Path(a),_)}),s}constructor(i,s=EmptyChildren()){this.value=i,this.children=s}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(i,s){if(this.value!=null&&s(this.value))return{path:newEmptyPath(),value:this.value};if(pathIsEmpty(i))return null;{const a=pathGetFront(i),_=this.children.get(a);if(_!==null){const $=_.findRootMostMatchingPathAndValue(pathPopFront(i),s);return $!=null?{path:pathChild(new Path(a),$.path),value:$.value}:null}else return null}}findRootMostValueAndPath(i){return this.findRootMostMatchingPathAndValue(i,()=>!0)}subtree(i){if(pathIsEmpty(i))return this;{const s=pathGetFront(i),a=this.children.get(s);return a!==null?a.subtree(pathPopFront(i)):new ImmutableTree(null)}}set(i,s){if(pathIsEmpty(i))return new ImmutableTree(s,this.children);{const a=pathGetFront(i),$=(this.children.get(a)||new ImmutableTree(null)).set(pathPopFront(i),s),rt=this.children.insert(a,$);return new ImmutableTree(this.value,rt)}}remove(i){if(pathIsEmpty(i))return this.children.isEmpty()?new ImmutableTree(null):new ImmutableTree(null,this.children);{const s=pathGetFront(i),a=this.children.get(s);if(a){const _=a.remove(pathPopFront(i));let $;return _.isEmpty()?$=this.children.remove(s):$=this.children.insert(s,_),this.value===null&&$.isEmpty()?new ImmutableTree(null):new ImmutableTree(this.value,$)}else return this}}get(i){if(pathIsEmpty(i))return this.value;{const s=pathGetFront(i),a=this.children.get(s);return a?a.get(pathPopFront(i)):null}}setTree(i,s){if(pathIsEmpty(i))return s;{const a=pathGetFront(i),$=(this.children.get(a)||new ImmutableTree(null)).setTree(pathPopFront(i),s);let rt;return $.isEmpty()?rt=this.children.remove(a):rt=this.children.insert(a,$),new ImmutableTree(this.value,rt)}}fold(i){return this.fold_(newEmptyPath(),i)}fold_(i,s){const a={};return this.children.inorderTraversal((_,$)=>{a[_]=$.fold_(pathChild(i,_),s)}),s(i,this.value,a)}findOnPath(i,s){return this.findOnPath_(i,newEmptyPath(),s)}findOnPath_(i,s,a){const _=this.value?a(s,this.value):!1;if(_)return _;if(pathIsEmpty(i))return null;{const $=pathGetFront(i),rt=this.children.get($);return rt?rt.findOnPath_(pathPopFront(i),pathChild(s,$),a):null}}foreachOnPath(i,s){return this.foreachOnPath_(i,newEmptyPath(),s)}foreachOnPath_(i,s,a){if(pathIsEmpty(i))return this;{this.value&&a(s,this.value);const _=pathGetFront(i),$=this.children.get(_);return $?$.foreachOnPath_(pathPopFront(i),pathChild(s,_),a):new ImmutableTree(null)}}foreach(i){this.foreach_(newEmptyPath(),i)}foreach_(i,s){this.children.inorderTraversal((a,_)=>{_.foreach_(pathChild(i,a),s)}),this.value&&s(i,this.value)}foreachChild(i){this.children.inorderTraversal((s,a)=>{a.value&&i(s,a.value)})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CompoundWrite{constructor(i){this.writeTree_=i}static empty(){return new CompoundWrite(new ImmutableTree(null))}}function compoundWriteAddWrite(e,i,s){if(pathIsEmpty(i))return new CompoundWrite(new ImmutableTree(s));{const a=e.writeTree_.findRootMostValueAndPath(i);if(a!=null){const _=a.path;let $=a.value;const rt=newRelativePath(_,i);return $=$.updateChild(rt,s),new CompoundWrite(e.writeTree_.set(_,$))}else{const _=new ImmutableTree(s),$=e.writeTree_.setTree(i,_);return new CompoundWrite($)}}}function compoundWriteAddWrites(e,i,s){let a=e;return each(s,(_,$)=>{a=compoundWriteAddWrite(a,pathChild(i,_),$)}),a}function compoundWriteRemoveWrite(e,i){if(pathIsEmpty(i))return CompoundWrite.empty();{const s=e.writeTree_.setTree(i,new ImmutableTree(null));return new CompoundWrite(s)}}function compoundWriteHasCompleteWrite(e,i){return compoundWriteGetCompleteNode(e,i)!=null}function compoundWriteGetCompleteNode(e,i){const s=e.writeTree_.findRootMostValueAndPath(i);return s!=null?e.writeTree_.get(s.path).getChild(newRelativePath(s.path,i)):null}function compoundWriteGetCompleteChildren(e){const i=[],s=e.writeTree_.value;return s!=null?s.isLeafNode()||s.forEachChild(PRIORITY_INDEX,(a,_)=>{i.push(new NamedNode(a,_))}):e.writeTree_.children.inorderTraversal((a,_)=>{_.value!=null&&i.push(new NamedNode(a,_.value))}),i}function compoundWriteChildCompoundWrite(e,i){if(pathIsEmpty(i))return e;{const s=compoundWriteGetCompleteNode(e,i);return s!=null?new CompoundWrite(new ImmutableTree(s)):new CompoundWrite(e.writeTree_.subtree(i))}}function compoundWriteIsEmpty(e){return e.writeTree_.isEmpty()}function compoundWriteApply(e,i){return applySubtreeWrite(newEmptyPath(),e.writeTree_,i)}function applySubtreeWrite(e,i,s){if(i.value!=null)return s.updateChild(e,i.value);{let a=null;return i.children.inorderTraversal((_,$)=>{_===".priority"?(assert($.value!==null,"Priority writes must always be leaf nodes"),a=$.value):s=applySubtreeWrite(pathChild(e,_),$,s)}),!s.getChild(e).isEmpty()&&a!==null&&(s=s.updateChild(pathChild(e,".priority"),a)),s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function writeTreeChildWrites(e,i){return newWriteTreeRef(i,e)}function writeTreeAddOverwrite(e,i,s,a,_){assert(a>e.lastWriteId,"Stacking an older write on top of newer ones"),_===void 0&&(_=!0),e.allWrites.push({path:i,snap:s,writeId:a,visible:_}),_&&(e.visibleWrites=compoundWriteAddWrite(e.visibleWrites,i,s)),e.lastWriteId=a}function writeTreeAddMerge(e,i,s,a){assert(a>e.lastWriteId,"Stacking an older merge on top of newer ones"),e.allWrites.push({path:i,children:s,writeId:a,visible:!0}),e.visibleWrites=compoundWriteAddWrites(e.visibleWrites,i,s),e.lastWriteId=a}function writeTreeGetWrite(e,i){for(let s=0;s<e.allWrites.length;s++){const a=e.allWrites[s];if(a.writeId===i)return a}return null}function writeTreeRemoveWrite(e,i){const s=e.allWrites.findIndex(c=>c.writeId===i);assert(s>=0,"removeWrite called with nonexistent writeId.");const a=e.allWrites[s];e.allWrites.splice(s,1);let _=a.visible,$=!1,rt=e.allWrites.length-1;for(;_&&rt>=0;){const c=e.allWrites[rt];c.visible&&(rt>=s&&writeTreeRecordContainsPath_(c,a.path)?_=!1:pathContains(a.path,c.path)&&($=!0)),rt--}if(_){if($)return writeTreeResetTree_(e),!0;if(a.snap)e.visibleWrites=compoundWriteRemoveWrite(e.visibleWrites,a.path);else{const c=a.children;each(c,dt=>{e.visibleWrites=compoundWriteRemoveWrite(e.visibleWrites,pathChild(a.path,dt))})}return!0}else return!1}function writeTreeRecordContainsPath_(e,i){if(e.snap)return pathContains(e.path,i);for(const s in e.children)if(e.children.hasOwnProperty(s)&&pathContains(pathChild(e.path,s),i))return!0;return!1}function writeTreeResetTree_(e){e.visibleWrites=writeTreeLayerTree_(e.allWrites,writeTreeDefaultFilter_,newEmptyPath()),e.allWrites.length>0?e.lastWriteId=e.allWrites[e.allWrites.length-1].writeId:e.lastWriteId=-1}function writeTreeDefaultFilter_(e){return e.visible}function writeTreeLayerTree_(e,i,s){let a=CompoundWrite.empty();for(let _=0;_<e.length;++_){const $=e[_];if(i($)){const rt=$.path;let c;if($.snap)pathContains(s,rt)?(c=newRelativePath(s,rt),a=compoundWriteAddWrite(a,c,$.snap)):pathContains(rt,s)&&(c=newRelativePath(rt,s),a=compoundWriteAddWrite(a,newEmptyPath(),$.snap.getChild(c)));else if($.children){if(pathContains(s,rt))c=newRelativePath(s,rt),a=compoundWriteAddWrites(a,c,$.children);else if(pathContains(rt,s))if(c=newRelativePath(rt,s),pathIsEmpty(c))a=compoundWriteAddWrites(a,newEmptyPath(),$.children);else{const dt=safeGet($.children,pathGetFront(c));if(dt){const ht=dt.getChild(pathPopFront(c));a=compoundWriteAddWrite(a,newEmptyPath(),ht)}}}else throw assertionError("WriteRecord should have .snap or .children")}}return a}function writeTreeCalcCompleteEventCache(e,i,s,a,_){if(!a&&!_){const $=compoundWriteGetCompleteNode(e.visibleWrites,i);if($!=null)return $;{const rt=compoundWriteChildCompoundWrite(e.visibleWrites,i);if(compoundWriteIsEmpty(rt))return s;if(s==null&&!compoundWriteHasCompleteWrite(rt,newEmptyPath()))return null;{const c=s||ChildrenNode.EMPTY_NODE;return compoundWriteApply(rt,c)}}}else{const $=compoundWriteChildCompoundWrite(e.visibleWrites,i);if(!_&&compoundWriteIsEmpty($))return s;if(!_&&s==null&&!compoundWriteHasCompleteWrite($,newEmptyPath()))return null;{const rt=function(ht){return(ht.visible||_)&&(!a||!~a.indexOf(ht.writeId))&&(pathContains(ht.path,i)||pathContains(i,ht.path))},c=writeTreeLayerTree_(e.allWrites,rt,i),dt=s||ChildrenNode.EMPTY_NODE;return compoundWriteApply(c,dt)}}}function writeTreeCalcCompleteEventChildren(e,i,s){let a=ChildrenNode.EMPTY_NODE;const _=compoundWriteGetCompleteNode(e.visibleWrites,i);if(_)return _.isLeafNode()||_.forEachChild(PRIORITY_INDEX,($,rt)=>{a=a.updateImmediateChild($,rt)}),a;if(s){const $=compoundWriteChildCompoundWrite(e.visibleWrites,i);return s.forEachChild(PRIORITY_INDEX,(rt,c)=>{const dt=compoundWriteApply(compoundWriteChildCompoundWrite($,new Path(rt)),c);a=a.updateImmediateChild(rt,dt)}),compoundWriteGetCompleteChildren($).forEach(rt=>{a=a.updateImmediateChild(rt.name,rt.node)}),a}else{const $=compoundWriteChildCompoundWrite(e.visibleWrites,i);return compoundWriteGetCompleteChildren($).forEach(rt=>{a=a.updateImmediateChild(rt.name,rt.node)}),a}}function writeTreeCalcEventCacheAfterServerOverwrite(e,i,s,a,_){assert(a||_,"Either existingEventSnap or existingServerSnap must exist");const $=pathChild(i,s);if(compoundWriteHasCompleteWrite(e.visibleWrites,$))return null;{const rt=compoundWriteChildCompoundWrite(e.visibleWrites,$);return compoundWriteIsEmpty(rt)?_.getChild(s):compoundWriteApply(rt,_.getChild(s))}}function writeTreeCalcCompleteChild(e,i,s,a){const _=pathChild(i,s),$=compoundWriteGetCompleteNode(e.visibleWrites,_);if($!=null)return $;if(a.isCompleteForChild(s)){const rt=compoundWriteChildCompoundWrite(e.visibleWrites,_);return compoundWriteApply(rt,a.getNode().getImmediateChild(s))}else return null}function writeTreeShadowingWrite(e,i){return compoundWriteGetCompleteNode(e.visibleWrites,i)}function writeTreeCalcIndexedSlice(e,i,s,a,_,$,rt){let c;const dt=compoundWriteChildCompoundWrite(e.visibleWrites,i),ht=compoundWriteGetCompleteNode(dt,newEmptyPath());if(ht!=null)c=ht;else if(s!=null)c=compoundWriteApply(dt,s);else return[];if(c=c.withIndex(rt),!c.isEmpty()&&!c.isLeafNode()){const Et=[],St=rt.getCompare(),At=$?c.getReverseIteratorFrom(a,rt):c.getIteratorFrom(a,rt);let Pt=At.getNext();for(;Pt&&Et.length<_;)St(Pt,a)!==0&&Et.push(Pt),Pt=At.getNext();return Et}else return[]}function newWriteTree(){return{visibleWrites:CompoundWrite.empty(),allWrites:[],lastWriteId:-1}}function writeTreeRefCalcCompleteEventCache(e,i,s,a){return writeTreeCalcCompleteEventCache(e.writeTree,e.treePath,i,s,a)}function writeTreeRefCalcCompleteEventChildren(e,i){return writeTreeCalcCompleteEventChildren(e.writeTree,e.treePath,i)}function writeTreeRefCalcEventCacheAfterServerOverwrite(e,i,s,a){return writeTreeCalcEventCacheAfterServerOverwrite(e.writeTree,e.treePath,i,s,a)}function writeTreeRefShadowingWrite(e,i){return writeTreeShadowingWrite(e.writeTree,pathChild(e.treePath,i))}function writeTreeRefCalcIndexedSlice(e,i,s,a,_,$){return writeTreeCalcIndexedSlice(e.writeTree,e.treePath,i,s,a,_,$)}function writeTreeRefCalcCompleteChild(e,i,s){return writeTreeCalcCompleteChild(e.writeTree,e.treePath,i,s)}function writeTreeRefChild(e,i){return newWriteTreeRef(pathChild(e.treePath,i),e.writeTree)}function newWriteTreeRef(e,i){return{treePath:e,writeTree:i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ChildChangeAccumulator{constructor(){this.changeMap=new Map}trackChildChange(i){const s=i.type,a=i.childName;assert(s==="child_added"||s==="child_changed"||s==="child_removed","Only child changes supported for tracking"),assert(a!==".priority","Only non-priority child changes can be tracked.");const _=this.changeMap.get(a);if(_){const $=_.type;if(s==="child_added"&&$==="child_removed")this.changeMap.set(a,changeChildChanged(a,i.snapshotNode,_.snapshotNode));else if(s==="child_removed"&&$==="child_added")this.changeMap.delete(a);else if(s==="child_removed"&&$==="child_changed")this.changeMap.set(a,changeChildRemoved(a,_.oldSnap));else if(s==="child_changed"&&$==="child_added")this.changeMap.set(a,changeChildAdded(a,i.snapshotNode));else if(s==="child_changed"&&$==="child_changed")this.changeMap.set(a,changeChildChanged(a,i.snapshotNode,_.oldSnap));else throw assertionError("Illegal combination of changes: "+i+" occurred after "+_)}else this.changeMap.set(a,i)}getChanges(){return Array.from(this.changeMap.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NoCompleteChildSource_{getCompleteChild(i){return null}getChildAfterChild(i,s,a){return null}}const NO_COMPLETE_CHILD_SOURCE=new NoCompleteChildSource_;class WriteTreeCompleteChildSource{constructor(i,s,a=null){this.writes_=i,this.viewCache_=s,this.optCompleteServerCache_=a}getCompleteChild(i){const s=this.viewCache_.eventCache;if(s.isCompleteForChild(i))return s.getNode().getImmediateChild(i);{const a=this.optCompleteServerCache_!=null?new CacheNode(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return writeTreeRefCalcCompleteChild(this.writes_,i,a)}}getChildAfterChild(i,s,a){const _=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:viewCacheGetCompleteServerSnap(this.viewCache_),$=writeTreeRefCalcIndexedSlice(this.writes_,_,s,1,a,i);return $.length===0?null:$[0]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function newViewProcessor(e){return{filter:e}}function viewProcessorAssertIndexed(e,i){assert(i.eventCache.getNode().isIndexed(e.filter.getIndex()),"Event snap not indexed"),assert(i.serverCache.getNode().isIndexed(e.filter.getIndex()),"Server snap not indexed")}function viewProcessorApplyOperation(e,i,s,a,_){const $=new ChildChangeAccumulator;let rt,c;if(s.type===OperationType.OVERWRITE){const ht=s;ht.source.fromUser?rt=viewProcessorApplyUserOverwrite(e,i,ht.path,ht.snap,a,_,$):(assert(ht.source.fromServer,"Unknown source."),c=ht.source.tagged||i.serverCache.isFiltered()&&!pathIsEmpty(ht.path),rt=viewProcessorApplyServerOverwrite(e,i,ht.path,ht.snap,a,_,c,$))}else if(s.type===OperationType.MERGE){const ht=s;ht.source.fromUser?rt=viewProcessorApplyUserMerge(e,i,ht.path,ht.children,a,_,$):(assert(ht.source.fromServer,"Unknown source."),c=ht.source.tagged||i.serverCache.isFiltered(),rt=viewProcessorApplyServerMerge(e,i,ht.path,ht.children,a,_,c,$))}else if(s.type===OperationType.ACK_USER_WRITE){const ht=s;ht.revert?rt=viewProcessorRevertUserWrite(e,i,ht.path,a,_,$):rt=viewProcessorAckUserWrite(e,i,ht.path,ht.affectedTree,a,_,$)}else if(s.type===OperationType.LISTEN_COMPLETE)rt=viewProcessorListenComplete(e,i,s.path,a,$);else throw assertionError("Unknown operation type: "+s.type);const dt=$.getChanges();return viewProcessorMaybeAddValueEvent(i,rt,dt),{viewCache:rt,changes:dt}}function viewProcessorMaybeAddValueEvent(e,i,s){const a=i.eventCache;if(a.isFullyInitialized()){const _=a.getNode().isLeafNode()||a.getNode().isEmpty(),$=viewCacheGetCompleteEventSnap(e);(s.length>0||!e.eventCache.isFullyInitialized()||_&&!a.getNode().equals($)||!a.getNode().getPriority().equals($.getPriority()))&&s.push(changeValue(viewCacheGetCompleteEventSnap(i)))}}function viewProcessorGenerateEventCacheAfterServerEvent(e,i,s,a,_,$){const rt=i.eventCache;if(writeTreeRefShadowingWrite(a,s)!=null)return i;{let c,dt;if(pathIsEmpty(s))if(assert(i.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),i.serverCache.isFiltered()){const ht=viewCacheGetCompleteServerSnap(i),Et=ht instanceof ChildrenNode?ht:ChildrenNode.EMPTY_NODE,St=writeTreeRefCalcCompleteEventChildren(a,Et);c=e.filter.updateFullNode(i.eventCache.getNode(),St,$)}else{const ht=writeTreeRefCalcCompleteEventCache(a,viewCacheGetCompleteServerSnap(i));c=e.filter.updateFullNode(i.eventCache.getNode(),ht,$)}else{const ht=pathGetFront(s);if(ht===".priority"){assert(pathGetLength(s)===1,"Can't have a priority with additional path components");const Et=rt.getNode();dt=i.serverCache.getNode();const St=writeTreeRefCalcEventCacheAfterServerOverwrite(a,s,Et,dt);St!=null?c=e.filter.updatePriority(Et,St):c=rt.getNode()}else{const Et=pathPopFront(s);let St;if(rt.isCompleteForChild(ht)){dt=i.serverCache.getNode();const At=writeTreeRefCalcEventCacheAfterServerOverwrite(a,s,rt.getNode(),dt);At!=null?St=rt.getNode().getImmediateChild(ht).updateChild(Et,At):St=rt.getNode().getImmediateChild(ht)}else St=writeTreeRefCalcCompleteChild(a,ht,i.serverCache);St!=null?c=e.filter.updateChild(rt.getNode(),ht,St,Et,_,$):c=rt.getNode()}}return viewCacheUpdateEventSnap(i,c,rt.isFullyInitialized()||pathIsEmpty(s),e.filter.filtersNodes())}}function viewProcessorApplyServerOverwrite(e,i,s,a,_,$,rt,c){const dt=i.serverCache;let ht;const Et=rt?e.filter:e.filter.getIndexedFilter();if(pathIsEmpty(s))ht=Et.updateFullNode(dt.getNode(),a,null);else if(Et.filtersNodes()&&!dt.isFiltered()){const Pt=dt.getNode().updateChild(s,a);ht=Et.updateFullNode(dt.getNode(),Pt,null)}else{const Pt=pathGetFront(s);if(!dt.isCompleteForPath(s)&&pathGetLength(s)>1)return i;const Vt=pathPopFront(s),Zt=dt.getNode().getImmediateChild(Pt).updateChild(Vt,a);Pt===".priority"?ht=Et.updatePriority(dt.getNode(),Zt):ht=Et.updateChild(dt.getNode(),Pt,Zt,Vt,NO_COMPLETE_CHILD_SOURCE,null)}const St=viewCacheUpdateServerSnap(i,ht,dt.isFullyInitialized()||pathIsEmpty(s),Et.filtersNodes()),At=new WriteTreeCompleteChildSource(_,St,$);return viewProcessorGenerateEventCacheAfterServerEvent(e,St,s,_,At,c)}function viewProcessorApplyUserOverwrite(e,i,s,a,_,$,rt){const c=i.eventCache;let dt,ht;const Et=new WriteTreeCompleteChildSource(_,i,$);if(pathIsEmpty(s))ht=e.filter.updateFullNode(i.eventCache.getNode(),a,rt),dt=viewCacheUpdateEventSnap(i,ht,!0,e.filter.filtersNodes());else{const St=pathGetFront(s);if(St===".priority")ht=e.filter.updatePriority(i.eventCache.getNode(),a),dt=viewCacheUpdateEventSnap(i,ht,c.isFullyInitialized(),c.isFiltered());else{const At=pathPopFront(s),Pt=c.getNode().getImmediateChild(St);let Vt;if(pathIsEmpty(At))Vt=a;else{const Bt=Et.getCompleteChild(St);Bt!=null?pathGetBack(At)===".priority"&&Bt.getChild(pathParent(At)).isEmpty()?Vt=Bt:Vt=Bt.updateChild(At,a):Vt=ChildrenNode.EMPTY_NODE}if(Pt.equals(Vt))dt=i;else{const Bt=e.filter.updateChild(c.getNode(),St,Vt,At,Et,rt);dt=viewCacheUpdateEventSnap(i,Bt,c.isFullyInitialized(),e.filter.filtersNodes())}}}return dt}function viewProcessorCacheHasChild(e,i){return e.eventCache.isCompleteForChild(i)}function viewProcessorApplyUserMerge(e,i,s,a,_,$,rt){let c=i;return a.foreach((dt,ht)=>{const Et=pathChild(s,dt);viewProcessorCacheHasChild(i,pathGetFront(Et))&&(c=viewProcessorApplyUserOverwrite(e,c,Et,ht,_,$,rt))}),a.foreach((dt,ht)=>{const Et=pathChild(s,dt);viewProcessorCacheHasChild(i,pathGetFront(Et))||(c=viewProcessorApplyUserOverwrite(e,c,Et,ht,_,$,rt))}),c}function viewProcessorApplyMerge(e,i,s){return s.foreach((a,_)=>{i=i.updateChild(a,_)}),i}function viewProcessorApplyServerMerge(e,i,s,a,_,$,rt,c){if(i.serverCache.getNode().isEmpty()&&!i.serverCache.isFullyInitialized())return i;let dt=i,ht;pathIsEmpty(s)?ht=a:ht=new ImmutableTree(null).setTree(s,a);const Et=i.serverCache.getNode();return ht.children.inorderTraversal((St,At)=>{if(Et.hasChild(St)){const Pt=i.serverCache.getNode().getImmediateChild(St),Vt=viewProcessorApplyMerge(e,Pt,At);dt=viewProcessorApplyServerOverwrite(e,dt,new Path(St),Vt,_,$,rt,c)}}),ht.children.inorderTraversal((St,At)=>{const Pt=!i.serverCache.isCompleteForChild(St)&&At.value===null;if(!Et.hasChild(St)&&!Pt){const Vt=i.serverCache.getNode().getImmediateChild(St),Bt=viewProcessorApplyMerge(e,Vt,At);dt=viewProcessorApplyServerOverwrite(e,dt,new Path(St),Bt,_,$,rt,c)}}),dt}function viewProcessorAckUserWrite(e,i,s,a,_,$,rt){if(writeTreeRefShadowingWrite(_,s)!=null)return i;const c=i.serverCache.isFiltered(),dt=i.serverCache;if(a.value!=null){if(pathIsEmpty(s)&&dt.isFullyInitialized()||dt.isCompleteForPath(s))return viewProcessorApplyServerOverwrite(e,i,s,dt.getNode().getChild(s),_,$,c,rt);if(pathIsEmpty(s)){let ht=new ImmutableTree(null);return dt.getNode().forEachChild(KEY_INDEX,(Et,St)=>{ht=ht.set(new Path(Et),St)}),viewProcessorApplyServerMerge(e,i,s,ht,_,$,c,rt)}else return i}else{let ht=new ImmutableTree(null);return a.foreach((Et,St)=>{const At=pathChild(s,Et);dt.isCompleteForPath(At)&&(ht=ht.set(Et,dt.getNode().getChild(At)))}),viewProcessorApplyServerMerge(e,i,s,ht,_,$,c,rt)}}function viewProcessorListenComplete(e,i,s,a,_){const $=i.serverCache,rt=viewCacheUpdateServerSnap(i,$.getNode(),$.isFullyInitialized()||pathIsEmpty(s),$.isFiltered());return viewProcessorGenerateEventCacheAfterServerEvent(e,rt,s,a,NO_COMPLETE_CHILD_SOURCE,_)}function viewProcessorRevertUserWrite(e,i,s,a,_,$){let rt;if(writeTreeRefShadowingWrite(a,s)!=null)return i;{const c=new WriteTreeCompleteChildSource(a,i,_),dt=i.eventCache.getNode();let ht;if(pathIsEmpty(s)||pathGetFront(s)===".priority"){let Et;if(i.serverCache.isFullyInitialized())Et=writeTreeRefCalcCompleteEventCache(a,viewCacheGetCompleteServerSnap(i));else{const St=i.serverCache.getNode();assert(St instanceof ChildrenNode,"serverChildren would be complete if leaf node"),Et=writeTreeRefCalcCompleteEventChildren(a,St)}Et=Et,ht=e.filter.updateFullNode(dt,Et,$)}else{const Et=pathGetFront(s);let St=writeTreeRefCalcCompleteChild(a,Et,i.serverCache);St==null&&i.serverCache.isCompleteForChild(Et)&&(St=dt.getImmediateChild(Et)),St!=null?ht=e.filter.updateChild(dt,Et,St,pathPopFront(s),c,$):i.eventCache.getNode().hasChild(Et)?ht=e.filter.updateChild(dt,Et,ChildrenNode.EMPTY_NODE,pathPopFront(s),c,$):ht=dt,ht.isEmpty()&&i.serverCache.isFullyInitialized()&&(rt=writeTreeRefCalcCompleteEventCache(a,viewCacheGetCompleteServerSnap(i)),rt.isLeafNode()&&(ht=e.filter.updateFullNode(ht,rt,$)))}return rt=i.serverCache.isFullyInitialized()||writeTreeRefShadowingWrite(a,newEmptyPath())!=null,viewCacheUpdateEventSnap(i,ht,rt,e.filter.filtersNodes())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class View{constructor(i,s){this.query_=i,this.eventRegistrations_=[];const a=this.query_._queryParams,_=new IndexedFilter(a.getIndex()),$=queryParamsGetNodeFilter(a);this.processor_=newViewProcessor($);const rt=s.serverCache,c=s.eventCache,dt=_.updateFullNode(ChildrenNode.EMPTY_NODE,rt.getNode(),null),ht=$.updateFullNode(ChildrenNode.EMPTY_NODE,c.getNode(),null),Et=new CacheNode(dt,rt.isFullyInitialized(),_.filtersNodes()),St=new CacheNode(ht,c.isFullyInitialized(),$.filtersNodes());this.viewCache_=newViewCache(St,Et),this.eventGenerator_=new EventGenerator(this.query_)}get query(){return this.query_}}function viewGetServerCache(e){return e.viewCache_.serverCache.getNode()}function viewGetCompleteNode(e){return viewCacheGetCompleteEventSnap(e.viewCache_)}function viewGetCompleteServerCache(e,i){const s=viewCacheGetCompleteServerSnap(e.viewCache_);return s&&(e.query._queryParams.loadsAllData()||!pathIsEmpty(i)&&!s.getImmediateChild(pathGetFront(i)).isEmpty())?s.getChild(i):null}function viewIsEmpty(e){return e.eventRegistrations_.length===0}function viewAddEventRegistration(e,i){e.eventRegistrations_.push(i)}function viewRemoveEventRegistration(e,i,s){const a=[];if(s){assert(i==null,"A cancel should cancel all event registrations.");const _=e.query._path;e.eventRegistrations_.forEach($=>{const rt=$.createCancelEvent(s,_);rt&&a.push(rt)})}if(i){let _=[];for(let $=0;$<e.eventRegistrations_.length;++$){const rt=e.eventRegistrations_[$];if(!rt.matches(i))_.push(rt);else if(i.hasAnyCallback()){_=_.concat(e.eventRegistrations_.slice($+1));break}}e.eventRegistrations_=_}else e.eventRegistrations_=[];return a}function viewApplyOperation(e,i,s,a){i.type===OperationType.MERGE&&i.source.queryId!==null&&(assert(viewCacheGetCompleteServerSnap(e.viewCache_),"We should always have a full cache before handling merges"),assert(viewCacheGetCompleteEventSnap(e.viewCache_),"Missing event cache, even though we have a server cache"));const _=e.viewCache_,$=viewProcessorApplyOperation(e.processor_,_,i,s,a);return viewProcessorAssertIndexed(e.processor_,$.viewCache),assert($.viewCache.serverCache.isFullyInitialized()||!_.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=$.viewCache,viewGenerateEventsForChanges_(e,$.changes,$.viewCache.eventCache.getNode(),null)}function viewGetInitialEvents(e,i){const s=e.viewCache_.eventCache,a=[];return s.getNode().isLeafNode()||s.getNode().forEachChild(PRIORITY_INDEX,($,rt)=>{a.push(changeChildAdded($,rt))}),s.isFullyInitialized()&&a.push(changeValue(s.getNode())),viewGenerateEventsForChanges_(e,a,s.getNode(),i)}function viewGenerateEventsForChanges_(e,i,s,a){const _=a?[a]:e.eventRegistrations_;return eventGeneratorGenerateEventsForChanges(e.eventGenerator_,i,s,_)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let referenceConstructor$1;class SyncPoint{constructor(){this.views=new Map}}function syncPointSetReferenceConstructor(e){assert(!referenceConstructor$1,"__referenceConstructor has already been defined"),referenceConstructor$1=e}function syncPointGetReferenceConstructor(){return assert(referenceConstructor$1,"Reference.ts has not been loaded"),referenceConstructor$1}function syncPointIsEmpty(e){return e.views.size===0}function syncPointApplyOperation(e,i,s,a){const _=i.source.queryId;if(_!==null){const $=e.views.get(_);return assert($!=null,"SyncTree gave us an op for an invalid query."),viewApplyOperation($,i,s,a)}else{let $=[];for(const rt of e.views.values())$=$.concat(viewApplyOperation(rt,i,s,a));return $}}function syncPointGetView(e,i,s,a,_){const $=i._queryIdentifier,rt=e.views.get($);if(!rt){let c=writeTreeRefCalcCompleteEventCache(s,_?a:null),dt=!1;c?dt=!0:a instanceof ChildrenNode?(c=writeTreeRefCalcCompleteEventChildren(s,a),dt=!1):(c=ChildrenNode.EMPTY_NODE,dt=!1);const ht=newViewCache(new CacheNode(c,dt,!1),new CacheNode(a,_,!1));return new View(i,ht)}return rt}function syncPointAddEventRegistration(e,i,s,a,_,$){const rt=syncPointGetView(e,i,a,_,$);return e.views.has(i._queryIdentifier)||e.views.set(i._queryIdentifier,rt),viewAddEventRegistration(rt,s),viewGetInitialEvents(rt,s)}function syncPointRemoveEventRegistration(e,i,s,a){const _=i._queryIdentifier,$=[];let rt=[];const c=syncPointHasCompleteView(e);if(_==="default")for(const[dt,ht]of e.views.entries())rt=rt.concat(viewRemoveEventRegistration(ht,s,a)),viewIsEmpty(ht)&&(e.views.delete(dt),ht.query._queryParams.loadsAllData()||$.push(ht.query));else{const dt=e.views.get(_);dt&&(rt=rt.concat(viewRemoveEventRegistration(dt,s,a)),viewIsEmpty(dt)&&(e.views.delete(_),dt.query._queryParams.loadsAllData()||$.push(dt.query)))}return c&&!syncPointHasCompleteView(e)&&$.push(new(syncPointGetReferenceConstructor())(i._repo,i._path)),{removed:$,events:rt}}function syncPointGetQueryViews(e){const i=[];for(const s of e.views.values())s.query._queryParams.loadsAllData()||i.push(s);return i}function syncPointGetCompleteServerCache(e,i){let s=null;for(const a of e.views.values())s=s||viewGetCompleteServerCache(a,i);return s}function syncPointViewForQuery(e,i){if(i._queryParams.loadsAllData())return syncPointGetCompleteView(e);{const a=i._queryIdentifier;return e.views.get(a)}}function syncPointViewExistsForQuery(e,i){return syncPointViewForQuery(e,i)!=null}function syncPointHasCompleteView(e){return syncPointGetCompleteView(e)!=null}function syncPointGetCompleteView(e){for(const i of e.views.values())if(i.query._queryParams.loadsAllData())return i;return null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let referenceConstructor;function syncTreeSetReferenceConstructor(e){assert(!referenceConstructor,"__referenceConstructor has already been defined"),referenceConstructor=e}function syncTreeGetReferenceConstructor(){return assert(referenceConstructor,"Reference.ts has not been loaded"),referenceConstructor}let syncTreeNextQueryTag_=1;class SyncTree{constructor(i){this.listenProvider_=i,this.syncPointTree_=new ImmutableTree(null),this.pendingWriteTree_=newWriteTree(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function syncTreeApplyUserOverwrite(e,i,s,a,_){return writeTreeAddOverwrite(e.pendingWriteTree_,i,s,a,_),_?syncTreeApplyOperationToSyncPoints_(e,new Overwrite(newOperationSourceUser(),i,s)):[]}function syncTreeApplyUserMerge(e,i,s,a){writeTreeAddMerge(e.pendingWriteTree_,i,s,a);const _=ImmutableTree.fromObject(s);return syncTreeApplyOperationToSyncPoints_(e,new Merge(newOperationSourceUser(),i,_))}function syncTreeAckUserWrite(e,i,s=!1){const a=writeTreeGetWrite(e.pendingWriteTree_,i);if(writeTreeRemoveWrite(e.pendingWriteTree_,i)){let $=new ImmutableTree(null);return a.snap!=null?$=$.set(newEmptyPath(),!0):each(a.children,rt=>{$=$.set(new Path(rt),!0)}),syncTreeApplyOperationToSyncPoints_(e,new AckUserWrite(a.path,$,s))}else return[]}function syncTreeApplyServerOverwrite(e,i,s){return syncTreeApplyOperationToSyncPoints_(e,new Overwrite(newOperationSourceServer(),i,s))}function syncTreeApplyServerMerge(e,i,s){const a=ImmutableTree.fromObject(s);return syncTreeApplyOperationToSyncPoints_(e,new Merge(newOperationSourceServer(),i,a))}function syncTreeApplyListenComplete(e,i){return syncTreeApplyOperationToSyncPoints_(e,new ListenComplete(newOperationSourceServer(),i))}function syncTreeApplyTaggedListenComplete(e,i,s){const a=syncTreeQueryKeyForTag_(e,s);if(a){const _=syncTreeParseQueryKey_(a),$=_.path,rt=_.queryId,c=newRelativePath($,i),dt=new ListenComplete(newOperationSourceServerTaggedQuery(rt),c);return syncTreeApplyTaggedOperation_(e,$,dt)}else return[]}function syncTreeRemoveEventRegistration(e,i,s,a,_=!1){const $=i._path,rt=e.syncPointTree_.get($);let c=[];if(rt&&(i._queryIdentifier==="default"||syncPointViewExistsForQuery(rt,i))){const dt=syncPointRemoveEventRegistration(rt,i,s,a);syncPointIsEmpty(rt)&&(e.syncPointTree_=e.syncPointTree_.remove($));const ht=dt.removed;if(c=dt.events,!_){const Et=ht.findIndex(At=>At._queryParams.loadsAllData())!==-1,St=e.syncPointTree_.findOnPath($,(At,Pt)=>syncPointHasCompleteView(Pt));if(Et&&!St){const At=e.syncPointTree_.subtree($);if(!At.isEmpty()){const Pt=syncTreeCollectDistinctViewsForSubTree_(At);for(let Vt=0;Vt<Pt.length;++Vt){const Bt=Pt[Vt],Zt=Bt.query,zt=syncTreeCreateListenerForView_(e,Bt);e.listenProvider_.startListening(syncTreeQueryForListening_(Zt),syncTreeTagForQuery(e,Zt),zt.hashFn,zt.onComplete)}}}!St&&ht.length>0&&!a&&(Et?e.listenProvider_.stopListening(syncTreeQueryForListening_(i),null):ht.forEach(At=>{const Pt=e.queryToTagMap.get(syncTreeMakeQueryKey_(At));e.listenProvider_.stopListening(syncTreeQueryForListening_(At),Pt)}))}syncTreeRemoveTags_(e,ht)}return c}function syncTreeApplyTaggedQueryOverwrite(e,i,s,a){const _=syncTreeQueryKeyForTag_(e,a);if(_!=null){const $=syncTreeParseQueryKey_(_),rt=$.path,c=$.queryId,dt=newRelativePath(rt,i),ht=new Overwrite(newOperationSourceServerTaggedQuery(c),dt,s);return syncTreeApplyTaggedOperation_(e,rt,ht)}else return[]}function syncTreeApplyTaggedQueryMerge(e,i,s,a){const _=syncTreeQueryKeyForTag_(e,a);if(_){const $=syncTreeParseQueryKey_(_),rt=$.path,c=$.queryId,dt=newRelativePath(rt,i),ht=ImmutableTree.fromObject(s),Et=new Merge(newOperationSourceServerTaggedQuery(c),dt,ht);return syncTreeApplyTaggedOperation_(e,rt,Et)}else return[]}function syncTreeAddEventRegistration(e,i,s,a=!1){const _=i._path;let $=null,rt=!1;e.syncPointTree_.foreachOnPath(_,(At,Pt)=>{const Vt=newRelativePath(At,_);$=$||syncPointGetCompleteServerCache(Pt,Vt),rt=rt||syncPointHasCompleteView(Pt)});let c=e.syncPointTree_.get(_);c?(rt=rt||syncPointHasCompleteView(c),$=$||syncPointGetCompleteServerCache(c,newEmptyPath())):(c=new SyncPoint,e.syncPointTree_=e.syncPointTree_.set(_,c));let dt;$!=null?dt=!0:(dt=!1,$=ChildrenNode.EMPTY_NODE,e.syncPointTree_.subtree(_).foreachChild((Pt,Vt)=>{const Bt=syncPointGetCompleteServerCache(Vt,newEmptyPath());Bt&&($=$.updateImmediateChild(Pt,Bt))}));const ht=syncPointViewExistsForQuery(c,i);if(!ht&&!i._queryParams.loadsAllData()){const At=syncTreeMakeQueryKey_(i);assert(!e.queryToTagMap.has(At),"View does not exist, but we have a tag");const Pt=syncTreeGetNextQueryTag_();e.queryToTagMap.set(At,Pt),e.tagToQueryMap.set(Pt,At)}const Et=writeTreeChildWrites(e.pendingWriteTree_,_);let St=syncPointAddEventRegistration(c,i,s,Et,$,dt);if(!ht&&!rt&&!a){const At=syncPointViewForQuery(c,i);St=St.concat(syncTreeSetupListener_(e,i,At))}return St}function syncTreeCalcCompleteEventCache(e,i,s){const _=e.pendingWriteTree_,$=e.syncPointTree_.findOnPath(i,(rt,c)=>{const dt=newRelativePath(rt,i),ht=syncPointGetCompleteServerCache(c,dt);if(ht)return ht});return writeTreeCalcCompleteEventCache(_,i,$,s,!0)}function syncTreeGetServerValue(e,i){const s=i._path;let a=null;e.syncPointTree_.foreachOnPath(s,(ht,Et)=>{const St=newRelativePath(ht,s);a=a||syncPointGetCompleteServerCache(Et,St)});let _=e.syncPointTree_.get(s);_?a=a||syncPointGetCompleteServerCache(_,newEmptyPath()):(_=new SyncPoint,e.syncPointTree_=e.syncPointTree_.set(s,_));const $=a!=null,rt=$?new CacheNode(a,!0,!1):null,c=writeTreeChildWrites(e.pendingWriteTree_,i._path),dt=syncPointGetView(_,i,c,$?rt.getNode():ChildrenNode.EMPTY_NODE,$);return viewGetCompleteNode(dt)}function syncTreeApplyOperationToSyncPoints_(e,i){return syncTreeApplyOperationHelper_(i,e.syncPointTree_,null,writeTreeChildWrites(e.pendingWriteTree_,newEmptyPath()))}function syncTreeApplyOperationHelper_(e,i,s,a){if(pathIsEmpty(e.path))return syncTreeApplyOperationDescendantsHelper_(e,i,s,a);{const _=i.get(newEmptyPath());s==null&&_!=null&&(s=syncPointGetCompleteServerCache(_,newEmptyPath()));let $=[];const rt=pathGetFront(e.path),c=e.operationForChild(rt),dt=i.children.get(rt);if(dt&&c){const ht=s?s.getImmediateChild(rt):null,Et=writeTreeRefChild(a,rt);$=$.concat(syncTreeApplyOperationHelper_(c,dt,ht,Et))}return _&&($=$.concat(syncPointApplyOperation(_,e,a,s))),$}}function syncTreeApplyOperationDescendantsHelper_(e,i,s,a){const _=i.get(newEmptyPath());s==null&&_!=null&&(s=syncPointGetCompleteServerCache(_,newEmptyPath()));let $=[];return i.children.inorderTraversal((rt,c)=>{const dt=s?s.getImmediateChild(rt):null,ht=writeTreeRefChild(a,rt),Et=e.operationForChild(rt);Et&&($=$.concat(syncTreeApplyOperationDescendantsHelper_(Et,c,dt,ht)))}),_&&($=$.concat(syncPointApplyOperation(_,e,a,s))),$}function syncTreeCreateListenerForView_(e,i){const s=i.query,a=syncTreeTagForQuery(e,s);return{hashFn:()=>(viewGetServerCache(i)||ChildrenNode.EMPTY_NODE).hash(),onComplete:_=>{if(_==="ok")return a?syncTreeApplyTaggedListenComplete(e,s._path,a):syncTreeApplyListenComplete(e,s._path);{const $=errorForServerCode(_,s);return syncTreeRemoveEventRegistration(e,s,null,$)}}}}function syncTreeTagForQuery(e,i){const s=syncTreeMakeQueryKey_(i);return e.queryToTagMap.get(s)}function syncTreeMakeQueryKey_(e){return e._path.toString()+"$"+e._queryIdentifier}function syncTreeQueryKeyForTag_(e,i){return e.tagToQueryMap.get(i)}function syncTreeParseQueryKey_(e){const i=e.indexOf("$");return assert(i!==-1&&i<e.length-1,"Bad queryKey."),{queryId:e.substr(i+1),path:new Path(e.substr(0,i))}}function syncTreeApplyTaggedOperation_(e,i,s){const a=e.syncPointTree_.get(i);assert(a,"Missing sync point for query tag that we're tracking");const _=writeTreeChildWrites(e.pendingWriteTree_,i);return syncPointApplyOperation(a,s,_,null)}function syncTreeCollectDistinctViewsForSubTree_(e){return e.fold((i,s,a)=>{if(s&&syncPointHasCompleteView(s))return[syncPointGetCompleteView(s)];{let _=[];return s&&(_=syncPointGetQueryViews(s)),each(a,($,rt)=>{_=_.concat(rt)}),_}})}function syncTreeQueryForListening_(e){return e._queryParams.loadsAllData()&&!e._queryParams.isDefault()?new(syncTreeGetReferenceConstructor())(e._repo,e._path):e}function syncTreeRemoveTags_(e,i){for(let s=0;s<i.length;++s){const a=i[s];if(!a._queryParams.loadsAllData()){const _=syncTreeMakeQueryKey_(a),$=e.queryToTagMap.get(_);e.queryToTagMap.delete(_),e.tagToQueryMap.delete($)}}}function syncTreeGetNextQueryTag_(){return syncTreeNextQueryTag_++}function syncTreeSetupListener_(e,i,s){const a=i._path,_=syncTreeTagForQuery(e,i),$=syncTreeCreateListenerForView_(e,s),rt=e.listenProvider_.startListening(syncTreeQueryForListening_(i),_,$.hashFn,$.onComplete),c=e.syncPointTree_.subtree(a);if(_)assert(!syncPointHasCompleteView(c.value),"If we're adding a query, it shouldn't be shadowed");else{const dt=c.fold((ht,Et,St)=>{if(!pathIsEmpty(ht)&&Et&&syncPointHasCompleteView(Et))return[syncPointGetCompleteView(Et).query];{let At=[];return Et&&(At=At.concat(syncPointGetQueryViews(Et).map(Pt=>Pt.query))),each(St,(Pt,Vt)=>{At=At.concat(Vt)}),At}});for(let ht=0;ht<dt.length;++ht){const Et=dt[ht];e.listenProvider_.stopListening(syncTreeQueryForListening_(Et),syncTreeTagForQuery(e,Et))}}return rt}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ExistingValueProvider{constructor(i){this.node_=i}getImmediateChild(i){const s=this.node_.getImmediateChild(i);return new ExistingValueProvider(s)}node(){return this.node_}}class DeferredValueProvider{constructor(i,s){this.syncTree_=i,this.path_=s}getImmediateChild(i){const s=pathChild(this.path_,i);return new DeferredValueProvider(this.syncTree_,s)}node(){return syncTreeCalcCompleteEventCache(this.syncTree_,this.path_)}}const generateWithValues=function(e){return e=e||{},e.timestamp=e.timestamp||new Date().getTime(),e},resolveDeferredLeafValue=function(e,i,s){if(!e||typeof e!="object")return e;if(assert(".sv"in e,"Unexpected leaf node or priority contents"),typeof e[".sv"]=="string")return resolveScalarDeferredValue(e[".sv"],i,s);if(typeof e[".sv"]=="object")return resolveComplexDeferredValue(e[".sv"],i);assert(!1,"Unexpected server value: "+JSON.stringify(e,null,2))},resolveScalarDeferredValue=function(e,i,s){switch(e){case"timestamp":return s.timestamp;default:assert(!1,"Unexpected server value: "+e)}},resolveComplexDeferredValue=function(e,i,s){e.hasOwnProperty("increment")||assert(!1,"Unexpected server value: "+JSON.stringify(e,null,2));const a=e.increment;typeof a!="number"&&assert(!1,"Unexpected increment value: "+a);const _=i.node();if(assert(_!==null&&typeof _<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!_.isLeafNode())return a;const rt=_.getValue();return typeof rt!="number"?a:rt+a},resolveDeferredValueTree=function(e,i,s,a){return resolveDeferredValue(i,new DeferredValueProvider(s,e),a)},resolveDeferredValueSnapshot=function(e,i,s){return resolveDeferredValue(e,new ExistingValueProvider(i),s)};function resolveDeferredValue(e,i,s){const a=e.getPriority().val(),_=resolveDeferredLeafValue(a,i.getImmediateChild(".priority"),s);let $;if(e.isLeafNode()){const rt=e,c=resolveDeferredLeafValue(rt.getValue(),i,s);return c!==rt.getValue()||_!==rt.getPriority().val()?new LeafNode(c,nodeFromJSON(_)):e}else{const rt=e;return $=rt,_!==rt.getPriority().val()&&($=$.updatePriority(new LeafNode(_))),rt.forEachChild(PRIORITY_INDEX,(c,dt)=>{const ht=resolveDeferredValue(dt,i.getImmediateChild(c),s);ht!==dt&&($=$.updateImmediateChild(c,ht))}),$}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tree{constructor(i="",s=null,a={children:{},childCount:0}){this.name=i,this.parent=s,this.node=a}}function treeSubTree(e,i){let s=i instanceof Path?i:new Path(i),a=e,_=pathGetFront(s);for(;_!==null;){const $=safeGet(a.node.children,_)||{children:{},childCount:0};a=new Tree(_,a,$),s=pathPopFront(s),_=pathGetFront(s)}return a}function treeGetValue(e){return e.node.value}function treeSetValue(e,i){e.node.value=i,treeUpdateParents(e)}function treeHasChildren(e){return e.node.childCount>0}function treeIsEmpty(e){return treeGetValue(e)===void 0&&!treeHasChildren(e)}function treeForEachChild(e,i){each(e.node.children,(s,a)=>{i(new Tree(s,e,a))})}function treeForEachDescendant(e,i,s,a){s&&!a&&i(e),treeForEachChild(e,_=>{treeForEachDescendant(_,i,!0,a)}),s&&a&&i(e)}function treeForEachAncestor(e,i,s){let a=e.parent;for(;a!==null;){if(i(a))return!0;a=a.parent}return!1}function treeGetPath(e){return new Path(e.parent===null?e.name:treeGetPath(e.parent)+"/"+e.name)}function treeUpdateParents(e){e.parent!==null&&treeUpdateChild(e.parent,e.name,e)}function treeUpdateChild(e,i,s){const a=treeIsEmpty(s),_=contains(e.node.children,i);a&&_?(delete e.node.children[i],e.node.childCount--,treeUpdateParents(e)):!a&&!_&&(e.node.children[i]=s.node,e.node.childCount++,treeUpdateParents(e))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const INVALID_KEY_REGEX_=/[\[\].#$\/\u0000-\u001F\u007F]/,INVALID_PATH_REGEX_=/[\[\].#$\u0000-\u001F\u007F]/,MAX_LEAF_SIZE_=10*1024*1024,isValidKey=function(e){return typeof e=="string"&&e.length!==0&&!INVALID_KEY_REGEX_.test(e)},isValidPathString=function(e){return typeof e=="string"&&e.length!==0&&!INVALID_PATH_REGEX_.test(e)},isValidRootPathString=function(e){return e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),isValidPathString(e)},isValidPriority=function(e){return e===null||typeof e=="string"||typeof e=="number"&&!isInvalidJSONNumber(e)||e&&typeof e=="object"&&contains(e,".sv")},validateFirebaseDataArg=function(e,i,s,a){a&&i===void 0||validateFirebaseData(errorPrefix(e,"value"),i,s)},validateFirebaseData=function(e,i,s){const a=s instanceof Path?new ValidationPath(s,e):s;if(i===void 0)throw new Error(e+"contains undefined "+validationPathToErrorString(a));if(typeof i=="function")throw new Error(e+"contains a function "+validationPathToErrorString(a)+" with contents = "+i.toString());if(isInvalidJSONNumber(i))throw new Error(e+"contains "+i.toString()+" "+validationPathToErrorString(a));if(typeof i=="string"&&i.length>MAX_LEAF_SIZE_/3&&stringLength(i)>MAX_LEAF_SIZE_)throw new Error(e+"contains a string greater than "+MAX_LEAF_SIZE_+" utf8 bytes "+validationPathToErrorString(a)+" ('"+i.substring(0,50)+"...')");if(i&&typeof i=="object"){let _=!1,$=!1;if(each(i,(rt,c)=>{if(rt===".value")_=!0;else if(rt!==".priority"&&rt!==".sv"&&($=!0,!isValidKey(rt)))throw new Error(e+" contains an invalid key ("+rt+") "+validationPathToErrorString(a)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);validationPathPush(a,rt),validateFirebaseData(e,c,a),validationPathPop(a)}),_&&$)throw new Error(e+' contains ".value" child '+validationPathToErrorString(a)+" in addition to actual children.")}},validateFirebaseMergePaths=function(e,i){let s,a;for(s=0;s<i.length;s++){a=i[s];const $=pathSlice(a);for(let rt=0;rt<$.length;rt++)if(!($[rt]===".priority"&&rt===$.length-1)){if(!isValidKey($[rt]))throw new Error(e+"contains an invalid key ("+$[rt]+") in path "+a.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}i.sort(pathCompare);let _=null;for(s=0;s<i.length;s++){if(a=i[s],_!==null&&pathContains(_,a))throw new Error(e+"contains a path "+_.toString()+" that is ancestor of another path "+a.toString());_=a}},validateFirebaseMergeDataArg=function(e,i,s,a){const _=errorPrefix(e,"values");if(!(i&&typeof i=="object")||Array.isArray(i))throw new Error(_+" must be an object containing the children to replace.");const $=[];each(i,(rt,c)=>{const dt=new Path(rt);if(validateFirebaseData(_,c,pathChild(s,dt)),pathGetBack(dt)===".priority"&&!isValidPriority(c))throw new Error(_+"contains an invalid value for '"+dt.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");$.push(dt)}),validateFirebaseMergePaths(_,$)},validatePathString=function(e,i,s,a){if(!isValidPathString(s))throw new Error(errorPrefix(e,i)+'was an invalid path = "'+s+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},validateRootPathString=function(e,i,s,a){s&&(s=s.replace(/^\/*\.info(\/|$)/,"/")),validatePathString(e,i,s)},validateWritablePath=function(e,i){if(pathGetFront(i)===".info")throw new Error(e+" failed = Can't modify data under /.info/")},validateUrl=function(e,i){const s=i.path.toString();if(typeof i.repoInfo.host!="string"||i.repoInfo.host.length===0||!isValidKey(i.repoInfo.namespace)&&i.repoInfo.host.split(":")[0]!=="localhost"||s.length!==0&&!isValidRootPathString(s))throw new Error(errorPrefix(e,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EventQueue{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function eventQueueQueueEvents(e,i){let s=null;for(let a=0;a<i.length;a++){const _=i[a],$=_.getPath();s!==null&&!pathEquals($,s.path)&&(e.eventLists_.push(s),s=null),s===null&&(s={events:[],path:$}),s.events.push(_)}s&&e.eventLists_.push(s)}function eventQueueRaiseEventsAtPath(e,i,s){eventQueueQueueEvents(e,s),eventQueueRaiseQueuedEventsMatchingPredicate(e,a=>pathEquals(a,i))}function eventQueueRaiseEventsForChangedPath(e,i,s){eventQueueQueueEvents(e,s),eventQueueRaiseQueuedEventsMatchingPredicate(e,a=>pathContains(a,i)||pathContains(i,a))}function eventQueueRaiseQueuedEventsMatchingPredicate(e,i){e.recursionDepth_++;let s=!0;for(let a=0;a<e.eventLists_.length;a++){const _=e.eventLists_[a];if(_){const $=_.path;i($)?(eventListRaise(e.eventLists_[a]),e.eventLists_[a]=null):s=!1}}s&&(e.eventLists_=[]),e.recursionDepth_--}function eventListRaise(e){for(let i=0;i<e.events.length;i++){const s=e.events[i];if(s!==null){e.events[i]=null;const a=s.getEventRunner();logger&&log("event: "+s.toString()),exceptionGuard(a)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const INTERRUPT_REASON="repo_interrupt",MAX_TRANSACTION_RETRIES=25;class Repo{constructor(i,s,a,_){this.repoInfo_=i,this.forceRestClient_=s,this.authTokenProvider_=a,this.appCheckProvider_=_,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new EventQueue,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=newSparseSnapshotTree(),this.transactionQueueTree_=new Tree,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function repoStart(e,i,s){if(e.stats_=statsManagerGetCollection(e.repoInfo_),e.forceRestClient_||beingCrawled())e.server_=new ReadonlyRestClient(e.repoInfo_,(a,_,$,rt)=>{repoOnDataUpdate(e,a,_,$,rt)},e.authTokenProvider_,e.appCheckProvider_),setTimeout(()=>repoOnConnectStatus(e,!0),0);else{if(typeof s<"u"&&s!==null){if(typeof s!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{stringify(s)}catch(a){throw new Error("Invalid authOverride provided: "+a)}}e.persistentConnection_=new PersistentConnection(e.repoInfo_,i,(a,_,$,rt)=>{repoOnDataUpdate(e,a,_,$,rt)},a=>{repoOnConnectStatus(e,a)},a=>{repoOnServerInfoUpdate(e,a)},e.authTokenProvider_,e.appCheckProvider_,s),e.server_=e.persistentConnection_}e.authTokenProvider_.addTokenChangeListener(a=>{e.server_.refreshAuthToken(a)}),e.appCheckProvider_.addTokenChangeListener(a=>{e.server_.refreshAppCheckToken(a.token)}),e.statsReporter_=statsManagerGetOrCreateReporter(e.repoInfo_,()=>new StatsReporter(e.stats_,e.server_)),e.infoData_=new SnapshotHolder,e.infoSyncTree_=new SyncTree({startListening:(a,_,$,rt)=>{let c=[];const dt=e.infoData_.getNode(a._path);return dt.isEmpty()||(c=syncTreeApplyServerOverwrite(e.infoSyncTree_,a._path,dt),setTimeout(()=>{rt("ok")},0)),c},stopListening:()=>{}}),repoUpdateInfo(e,"connected",!1),e.serverSyncTree_=new SyncTree({startListening:(a,_,$,rt)=>(e.server_.listen(a,$,_,(c,dt)=>{const ht=rt(c,dt);eventQueueRaiseEventsForChangedPath(e.eventQueue_,a._path,ht)}),[]),stopListening:(a,_)=>{e.server_.unlisten(a,_)}})}function repoServerTime(e){const s=e.infoData_.getNode(new Path(".info/serverTimeOffset")).val()||0;return new Date().getTime()+s}function repoGenerateServerValues(e){return generateWithValues({timestamp:repoServerTime(e)})}function repoOnDataUpdate(e,i,s,a,_){e.dataUpdateCount++;const $=new Path(i);s=e.interceptServerDataCallback_?e.interceptServerDataCallback_(i,s):s;let rt=[];if(_)if(a){const dt=map(s,ht=>nodeFromJSON(ht));rt=syncTreeApplyTaggedQueryMerge(e.serverSyncTree_,$,dt,_)}else{const dt=nodeFromJSON(s);rt=syncTreeApplyTaggedQueryOverwrite(e.serverSyncTree_,$,dt,_)}else if(a){const dt=map(s,ht=>nodeFromJSON(ht));rt=syncTreeApplyServerMerge(e.serverSyncTree_,$,dt)}else{const dt=nodeFromJSON(s);rt=syncTreeApplyServerOverwrite(e.serverSyncTree_,$,dt)}let c=$;rt.length>0&&(c=repoRerunTransactions(e,$)),eventQueueRaiseEventsForChangedPath(e.eventQueue_,c,rt)}function repoOnConnectStatus(e,i){repoUpdateInfo(e,"connected",i),i===!1&&repoRunOnDisconnectEvents(e)}function repoOnServerInfoUpdate(e,i){each(i,(s,a)=>{repoUpdateInfo(e,s,a)})}function repoUpdateInfo(e,i,s){const a=new Path("/.info/"+i),_=nodeFromJSON(s);e.infoData_.updateSnapshot(a,_);const $=syncTreeApplyServerOverwrite(e.infoSyncTree_,a,_);eventQueueRaiseEventsForChangedPath(e.eventQueue_,a,$)}function repoGetNextWriteId(e){return e.nextWriteId_++}function repoGetValue(e,i,s){const a=syncTreeGetServerValue(e.serverSyncTree_,i);return a!=null?Promise.resolve(a):e.server_.get(i).then(_=>{const $=nodeFromJSON(_).withIndex(i._queryParams.getIndex());syncTreeAddEventRegistration(e.serverSyncTree_,i,s,!0);let rt;if(i._queryParams.loadsAllData())rt=syncTreeApplyServerOverwrite(e.serverSyncTree_,i._path,$);else{const c=syncTreeTagForQuery(e.serverSyncTree_,i);rt=syncTreeApplyTaggedQueryOverwrite(e.serverSyncTree_,i._path,$,c)}return eventQueueRaiseEventsForChangedPath(e.eventQueue_,i._path,rt),syncTreeRemoveEventRegistration(e.serverSyncTree_,i,s,null,!0),$},_=>(repoLog(e,"get for query "+stringify(i)+" failed: "+_),Promise.reject(new Error(_))))}function repoSetWithPriority(e,i,s,a,_){repoLog(e,"set",{path:i.toString(),value:s,priority:a});const $=repoGenerateServerValues(e),rt=nodeFromJSON(s,a),c=syncTreeCalcCompleteEventCache(e.serverSyncTree_,i),dt=resolveDeferredValueSnapshot(rt,c,$),ht=repoGetNextWriteId(e),Et=syncTreeApplyUserOverwrite(e.serverSyncTree_,i,dt,ht,!0);eventQueueQueueEvents(e.eventQueue_,Et),e.server_.put(i.toString(),rt.val(!0),(At,Pt)=>{const Vt=At==="ok";Vt||warn("set at "+i+" failed: "+At);const Bt=syncTreeAckUserWrite(e.serverSyncTree_,ht,!Vt);eventQueueRaiseEventsForChangedPath(e.eventQueue_,i,Bt),repoCallOnCompleteCallback(e,_,At,Pt)});const St=repoAbortTransactions(e,i);repoRerunTransactions(e,St),eventQueueRaiseEventsForChangedPath(e.eventQueue_,St,[])}function repoUpdate(e,i,s,a){repoLog(e,"update",{path:i.toString(),value:s});let _=!0;const $=repoGenerateServerValues(e),rt={};if(each(s,(c,dt)=>{_=!1,rt[c]=resolveDeferredValueTree(pathChild(i,c),nodeFromJSON(dt),e.serverSyncTree_,$)}),_)log("update() called with empty data.  Don't do anything."),repoCallOnCompleteCallback(e,a,"ok",void 0);else{const c=repoGetNextWriteId(e),dt=syncTreeApplyUserMerge(e.serverSyncTree_,i,rt,c);eventQueueQueueEvents(e.eventQueue_,dt),e.server_.merge(i.toString(),s,(ht,Et)=>{const St=ht==="ok";St||warn("update at "+i+" failed: "+ht);const At=syncTreeAckUserWrite(e.serverSyncTree_,c,!St),Pt=At.length>0?repoRerunTransactions(e,i):i;eventQueueRaiseEventsForChangedPath(e.eventQueue_,Pt,At),repoCallOnCompleteCallback(e,a,ht,Et)}),each(s,ht=>{const Et=repoAbortTransactions(e,pathChild(i,ht));repoRerunTransactions(e,Et)}),eventQueueRaiseEventsForChangedPath(e.eventQueue_,i,[])}}function repoRunOnDisconnectEvents(e){repoLog(e,"onDisconnectEvents");const i=repoGenerateServerValues(e),s=newSparseSnapshotTree();sparseSnapshotTreeForEachTree(e.onDisconnect_,newEmptyPath(),(_,$)=>{const rt=resolveDeferredValueTree(_,$,e.serverSyncTree_,i);sparseSnapshotTreeRemember(s,_,rt)});let a=[];sparseSnapshotTreeForEachTree(s,newEmptyPath(),(_,$)=>{a=a.concat(syncTreeApplyServerOverwrite(e.serverSyncTree_,_,$));const rt=repoAbortTransactions(e,_);repoRerunTransactions(e,rt)}),e.onDisconnect_=newSparseSnapshotTree(),eventQueueRaiseEventsForChangedPath(e.eventQueue_,newEmptyPath(),a)}function repoAddEventCallbackForQuery(e,i,s){let a;pathGetFront(i._path)===".info"?a=syncTreeAddEventRegistration(e.infoSyncTree_,i,s):a=syncTreeAddEventRegistration(e.serverSyncTree_,i,s),eventQueueRaiseEventsAtPath(e.eventQueue_,i._path,a)}function repoRemoveEventCallbackForQuery(e,i,s){let a;pathGetFront(i._path)===".info"?a=syncTreeRemoveEventRegistration(e.infoSyncTree_,i,s):a=syncTreeRemoveEventRegistration(e.serverSyncTree_,i,s),eventQueueRaiseEventsAtPath(e.eventQueue_,i._path,a)}function repoInterrupt(e){e.persistentConnection_&&e.persistentConnection_.interrupt(INTERRUPT_REASON)}function repoLog(e,...i){let s="";e.persistentConnection_&&(s=e.persistentConnection_.id+":"),log(s,...i)}function repoCallOnCompleteCallback(e,i,s,a){i&&exceptionGuard(()=>{if(s==="ok")i(null);else{const _=(s||"error").toUpperCase();let $=_;a&&($+=": "+a);const rt=new Error($);rt.code=_,i(rt)}})}function repoGetLatestState(e,i,s){return syncTreeCalcCompleteEventCache(e.serverSyncTree_,i,s)||ChildrenNode.EMPTY_NODE}function repoSendReadyTransactions(e,i=e.transactionQueueTree_){if(i||repoPruneCompletedTransactionsBelowNode(e,i),treeGetValue(i)){const s=repoBuildTransactionQueue(e,i);assert(s.length>0,"Sending zero length transaction queue"),s.every(_=>_.status===0)&&repoSendTransactionQueue(e,treeGetPath(i),s)}else treeHasChildren(i)&&treeForEachChild(i,s=>{repoSendReadyTransactions(e,s)})}function repoSendTransactionQueue(e,i,s){const a=s.map(ht=>ht.currentWriteId),_=repoGetLatestState(e,i,a);let $=_;const rt=_.hash();for(let ht=0;ht<s.length;ht++){const Et=s[ht];assert(Et.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),Et.status=1,Et.retryCount++;const St=newRelativePath(i,Et.path);$=$.updateChild(St,Et.currentOutputSnapshotRaw)}const c=$.val(!0),dt=i;e.server_.put(dt.toString(),c,ht=>{repoLog(e,"transaction put response",{path:dt.toString(),status:ht});let Et=[];if(ht==="ok"){const St=[];for(let At=0;At<s.length;At++)s[At].status=2,Et=Et.concat(syncTreeAckUserWrite(e.serverSyncTree_,s[At].currentWriteId)),s[At].onComplete&&St.push(()=>s[At].onComplete(null,!0,s[At].currentOutputSnapshotResolved)),s[At].unwatcher();repoPruneCompletedTransactionsBelowNode(e,treeSubTree(e.transactionQueueTree_,i)),repoSendReadyTransactions(e,e.transactionQueueTree_),eventQueueRaiseEventsForChangedPath(e.eventQueue_,i,Et);for(let At=0;At<St.length;At++)exceptionGuard(St[At])}else{if(ht==="datastale")for(let St=0;St<s.length;St++)s[St].status===3?s[St].status=4:s[St].status=0;else{warn("transaction at "+dt.toString()+" failed: "+ht);for(let St=0;St<s.length;St++)s[St].status=4,s[St].abortReason=ht}repoRerunTransactions(e,i)}},rt)}function repoRerunTransactions(e,i){const s=repoGetAncestorTransactionNode(e,i),a=treeGetPath(s),_=repoBuildTransactionQueue(e,s);return repoRerunTransactionQueue(e,_,a),a}function repoRerunTransactionQueue(e,i,s){if(i.length===0)return;const a=[];let _=[];const rt=i.filter(c=>c.status===0).map(c=>c.currentWriteId);for(let c=0;c<i.length;c++){const dt=i[c],ht=newRelativePath(s,dt.path);let Et=!1,St;if(assert(ht!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),dt.status===4)Et=!0,St=dt.abortReason,_=_.concat(syncTreeAckUserWrite(e.serverSyncTree_,dt.currentWriteId,!0));else if(dt.status===0)if(dt.retryCount>=MAX_TRANSACTION_RETRIES)Et=!0,St="maxretry",_=_.concat(syncTreeAckUserWrite(e.serverSyncTree_,dt.currentWriteId,!0));else{const At=repoGetLatestState(e,dt.path,rt);dt.currentInputSnapshot=At;const Pt=i[c].update(At.val());if(Pt!==void 0){validateFirebaseData("transaction failed: Data returned ",Pt,dt.path);let Vt=nodeFromJSON(Pt);typeof Pt=="object"&&Pt!=null&&contains(Pt,".priority")||(Vt=Vt.updatePriority(At.getPriority()));const Zt=dt.currentWriteId,zt=repoGenerateServerValues(e),Ut=resolveDeferredValueSnapshot(Vt,At,zt);dt.currentOutputSnapshotRaw=Vt,dt.currentOutputSnapshotResolved=Ut,dt.currentWriteId=repoGetNextWriteId(e),rt.splice(rt.indexOf(Zt),1),_=_.concat(syncTreeApplyUserOverwrite(e.serverSyncTree_,dt.path,Ut,dt.currentWriteId,dt.applyLocally)),_=_.concat(syncTreeAckUserWrite(e.serverSyncTree_,Zt,!0))}else Et=!0,St="nodata",_=_.concat(syncTreeAckUserWrite(e.serverSyncTree_,dt.currentWriteId,!0))}eventQueueRaiseEventsForChangedPath(e.eventQueue_,s,_),_=[],Et&&(i[c].status=2,function(At){setTimeout(At,Math.floor(0))}(i[c].unwatcher),i[c].onComplete&&(St==="nodata"?a.push(()=>i[c].onComplete(null,!1,i[c].currentInputSnapshot)):a.push(()=>i[c].onComplete(new Error(St),!1,null))))}repoPruneCompletedTransactionsBelowNode(e,e.transactionQueueTree_);for(let c=0;c<a.length;c++)exceptionGuard(a[c]);repoSendReadyTransactions(e,e.transactionQueueTree_)}function repoGetAncestorTransactionNode(e,i){let s,a=e.transactionQueueTree_;for(s=pathGetFront(i);s!==null&&treeGetValue(a)===void 0;)a=treeSubTree(a,s),i=pathPopFront(i),s=pathGetFront(i);return a}function repoBuildTransactionQueue(e,i){const s=[];return repoAggregateTransactionQueuesForNode(e,i,s),s.sort((a,_)=>a.order-_.order),s}function repoAggregateTransactionQueuesForNode(e,i,s){const a=treeGetValue(i);if(a)for(let _=0;_<a.length;_++)s.push(a[_]);treeForEachChild(i,_=>{repoAggregateTransactionQueuesForNode(e,_,s)})}function repoPruneCompletedTransactionsBelowNode(e,i){const s=treeGetValue(i);if(s){let a=0;for(let _=0;_<s.length;_++)s[_].status!==2&&(s[a]=s[_],a++);s.length=a,treeSetValue(i,s.length>0?s:void 0)}treeForEachChild(i,a=>{repoPruneCompletedTransactionsBelowNode(e,a)})}function repoAbortTransactions(e,i){const s=treeGetPath(repoGetAncestorTransactionNode(e,i)),a=treeSubTree(e.transactionQueueTree_,i);return treeForEachAncestor(a,_=>{repoAbortTransactionsOnNode(e,_)}),repoAbortTransactionsOnNode(e,a),treeForEachDescendant(a,_=>{repoAbortTransactionsOnNode(e,_)}),s}function repoAbortTransactionsOnNode(e,i){const s=treeGetValue(i);if(s){const a=[];let _=[],$=-1;for(let rt=0;rt<s.length;rt++)s[rt].status===3||(s[rt].status===1?(assert($===rt-1,"All SENT items should be at beginning of queue."),$=rt,s[rt].status=3,s[rt].abortReason="set"):(assert(s[rt].status===0,"Unexpected transaction status in abort"),s[rt].unwatcher(),_=_.concat(syncTreeAckUserWrite(e.serverSyncTree_,s[rt].currentWriteId,!0)),s[rt].onComplete&&a.push(s[rt].onComplete.bind(null,new Error("set"),!1,null))));$===-1?treeSetValue(i,void 0):s.length=$+1,eventQueueRaiseEventsForChangedPath(e.eventQueue_,treeGetPath(i),_);for(let rt=0;rt<a.length;rt++)exceptionGuard(a[rt])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function decodePath(e){let i="";const s=e.split("/");for(let a=0;a<s.length;a++)if(s[a].length>0){let _=s[a];try{_=decodeURIComponent(_.replace(/\+/g," "))}catch{}i+="/"+_}return i}function decodeQuery(e){const i={};e.charAt(0)==="?"&&(e=e.substring(1));for(const s of e.split("&")){if(s.length===0)continue;const a=s.split("=");a.length===2?i[decodeURIComponent(a[0])]=decodeURIComponent(a[1]):warn(`Invalid query segment '${s}' in query '${e}'`)}return i}const parseRepoInfo=function(e,i){const s=parseDatabaseURL(e),a=s.namespace;s.domain==="firebase.com"&&fatal(s.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!a||a==="undefined")&&s.domain!=="localhost"&&fatal("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),s.secure||warnIfPageIsSecure();const _=s.scheme==="ws"||s.scheme==="wss";return{repoInfo:new RepoInfo(s.host,s.secure,a,_,i,"",a!==s.subdomain),path:new Path(s.pathString)}},parseDatabaseURL=function(e){let i="",s="",a="",_="",$="",rt=!0,c="https",dt=443;if(typeof e=="string"){let ht=e.indexOf("//");ht>=0&&(c=e.substring(0,ht-1),e=e.substring(ht+2));let Et=e.indexOf("/");Et===-1&&(Et=e.length);let St=e.indexOf("?");St===-1&&(St=e.length),i=e.substring(0,Math.min(Et,St)),Et<St&&(_=decodePath(e.substring(Et,St)));const At=decodeQuery(e.substring(Math.min(e.length,St)));ht=i.indexOf(":"),ht>=0?(rt=c==="https"||c==="wss",dt=parseInt(i.substring(ht+1),10)):ht=i.length;const Pt=i.slice(0,ht);if(Pt.toLowerCase()==="localhost")s="localhost";else if(Pt.split(".").length<=2)s=Pt;else{const Vt=i.indexOf(".");a=i.substring(0,Vt).toLowerCase(),s=i.substring(Vt+1),$=a}"ns"in At&&($=At.ns)}return{host:i,port:dt,domain:s,subdomain:a,secure:rt,scheme:c,pathString:_,namespace:$}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PUSH_CHARS="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",nextPushId=function(){let e=0;const i=[];return function(s){const a=s===e;e=s;let _;const $=new Array(8);for(_=7;_>=0;_--)$[_]=PUSH_CHARS.charAt(s%64),s=Math.floor(s/64);assert(s===0,"Cannot push at time == 0");let rt=$.join("");if(a){for(_=11;_>=0&&i[_]===63;_--)i[_]=0;i[_]++}else for(_=0;_<12;_++)i[_]=Math.floor(Math.random()*64);for(_=0;_<12;_++)rt+=PUSH_CHARS.charAt(i[_]);return assert(rt.length===20,"nextPushId: Length should be 20."),rt}}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DataEvent{constructor(i,s,a,_){this.eventType=i,this.eventRegistration=s,this.snapshot=a,this.prevName=_}getPath(){const i=this.snapshot.ref;return this.eventType==="value"?i._path:i.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+stringify(this.snapshot.exportVal())}}class CancelEvent{constructor(i,s,a){this.eventRegistration=i,this.error=s,this.path=a}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CallbackContext{constructor(i,s){this.snapshotCallback=i,this.cancelCallback=s}onValue(i,s){this.snapshotCallback.call(null,i,s)}onCancel(i){return assert(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,i)}get hasCancelCallback(){return!!this.cancelCallback}matches(i){return this.snapshotCallback===i.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===i.snapshotCallback.userCallback&&this.snapshotCallback.context===i.snapshotCallback.context}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QueryImpl{constructor(i,s,a,_){this._repo=i,this._path=s,this._queryParams=a,this._orderByCalled=_}get key(){return pathIsEmpty(this._path)?null:pathGetBack(this._path)}get ref(){return new ReferenceImpl(this._repo,this._path)}get _queryIdentifier(){const i=queryParamsGetQueryObject(this._queryParams),s=ObjectToUniqueKey(i);return s==="{}"?"default":s}get _queryObject(){return queryParamsGetQueryObject(this._queryParams)}isEqual(i){if(i=getModularInstance(i),!(i instanceof QueryImpl))return!1;const s=this._repo===i._repo,a=pathEquals(this._path,i._path),_=this._queryIdentifier===i._queryIdentifier;return s&&a&&_}toJSON(){return this.toString()}toString(){return this._repo.toString()+pathToUrlEncodedString(this._path)}}class ReferenceImpl extends QueryImpl{constructor(i,s){super(i,s,new QueryParams,!1)}get parent(){const i=pathParent(this._path);return i===null?null:new ReferenceImpl(this._repo,i)}get root(){let i=this;for(;i.parent!==null;)i=i.parent;return i}}class DataSnapshot{constructor(i,s,a){this._node=i,this.ref=s,this._index=a}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(i){const s=new Path(i),a=child(this.ref,i);return new DataSnapshot(this._node.getChild(s),a,PRIORITY_INDEX)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(i){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(a,_)=>i(new DataSnapshot(_,child(this.ref,a),PRIORITY_INDEX)))}hasChild(i){const s=new Path(i);return!this._node.getChild(s).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function ref(e,i){return e=getModularInstance(e),e._checkNotDeleted("ref"),i!==void 0?child(e._root,i):e._root}function child(e,i){return e=getModularInstance(e),pathGetFront(e._path)===null?validateRootPathString("child","path",i):validatePathString("child","path",i),new ReferenceImpl(e._repo,pathChild(e._path,i))}function push(e,i){e=getModularInstance(e),validateWritablePath("push",e._path),validateFirebaseDataArg("push",i,e._path,!0);const s=repoServerTime(e._repo),a=nextPushId(s),_=child(e,a),$=child(e,a);let rt;return rt=Promise.resolve($),_.then=rt.then.bind(rt),_.catch=rt.then.bind(rt,void 0),_}function remove(e){return validateWritablePath("remove",e._path),set(e,null)}function set(e,i){e=getModularInstance(e),validateWritablePath("set",e._path),validateFirebaseDataArg("set",i,e._path,!1);const s=new Deferred;return repoSetWithPriority(e._repo,e._path,i,null,s.wrapCallback(()=>{})),s.promise}function update(e,i){validateFirebaseMergeDataArg("update",i,e._path);const s=new Deferred;return repoUpdate(e._repo,e._path,i,s.wrapCallback(()=>{})),s.promise}function get(e){e=getModularInstance(e);const i=new CallbackContext(()=>{}),s=new ValueEventRegistration(i);return repoGetValue(e._repo,e,s).then(a=>new DataSnapshot(a,new ReferenceImpl(e._repo,e._path),e._queryParams.getIndex()))}class ValueEventRegistration{constructor(i){this.callbackContext=i}respondsTo(i){return i==="value"}createEvent(i,s){const a=s._queryParams.getIndex();return new DataEvent("value",this,new DataSnapshot(i.snapshotNode,new ReferenceImpl(s._repo,s._path),a))}getEventRunner(i){return i.getEventType()==="cancel"?()=>this.callbackContext.onCancel(i.error):()=>this.callbackContext.onValue(i.snapshot,null)}createCancelEvent(i,s){return this.callbackContext.hasCancelCallback?new CancelEvent(this,i,s):null}matches(i){return i instanceof ValueEventRegistration?!i.callbackContext||!this.callbackContext?!0:i.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}function addEventListener(e,i,s,a,_){let $;if(typeof a=="object"&&($=void 0,_=a),typeof a=="function"&&($=a),_&&_.onlyOnce){const dt=s,ht=(Et,St)=>{repoRemoveEventCallbackForQuery(e._repo,e,c),dt(Et,St)};ht.userCallback=s.userCallback,ht.context=s.context,s=ht}const rt=new CallbackContext(s,$||void 0),c=new ValueEventRegistration(rt);return repoAddEventCallbackForQuery(e._repo,e,c),()=>repoRemoveEventCallbackForQuery(e._repo,e,c)}function onValue(e,i,s,a){return addEventListener(e,"value",i,s,a)}syncPointSetReferenceConstructor(ReferenceImpl);syncTreeSetReferenceConstructor(ReferenceImpl);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FIREBASE_DATABASE_EMULATOR_HOST_VAR="FIREBASE_DATABASE_EMULATOR_HOST",repos={};let useRestClient=!1;function repoManagerApplyEmulatorSettings(e,i,s,a){const _=i.lastIndexOf(":"),$=i.substring(0,_),rt=isCloudWorkstation($);e.repoInfo_=new RepoInfo(i,rt,e.repoInfo_.namespace,e.repoInfo_.webSocketOnly,e.repoInfo_.nodeAdmin,e.repoInfo_.persistenceKey,e.repoInfo_.includeNamespaceInQueryParams,!0,s),a&&(e.authTokenProvider_=a)}function repoManagerDatabaseFromApp(e,i,s,a,_){let $=a||e.options.databaseURL;$===void 0&&(e.options.projectId||fatal("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),log("Using default host for project ",e.options.projectId),$=`${e.options.projectId}-default-rtdb.firebaseio.com`);let rt=parseRepoInfo($,_),c=rt.repoInfo,dt;typeof process<"u"&&define_process_env_default&&(dt=define_process_env_default[FIREBASE_DATABASE_EMULATOR_HOST_VAR]),dt?($=`http://${dt}?ns=${c.namespace}`,rt=parseRepoInfo($,_),c=rt.repoInfo):rt.repoInfo.secure;const ht=new FirebaseAuthTokenProvider(e.name,e.options,i);validateUrl("Invalid Firebase Database URL",rt),pathIsEmpty(rt.path)||fatal("Database URL must point to the root of a Firebase Database (not including a child path).");const Et=repoManagerCreateRepo(c,e,ht,new AppCheckTokenProvider(e,s));return new Database(Et,e)}function repoManagerDeleteRepo(e,i){const s=repos[i];(!s||s[e.key]!==e)&&fatal(`Database ${i}(${e.repoInfo_}) has already been deleted.`),repoInterrupt(e),delete s[e.key]}function repoManagerCreateRepo(e,i,s,a){let _=repos[i.name];_||(_={},repos[i.name]=_);let $=_[e.toURLString()];return $&&fatal("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),$=new Repo(e,useRestClient,s,a),_[e.toURLString()]=$,$}class Database{constructor(i,s){this._repoInternal=i,this.app=s,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(repoStart(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new ReferenceImpl(this._repo,newEmptyPath())),this._rootInternal}_delete(){return this._rootInternal!==null&&(repoManagerDeleteRepo(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(i){this._rootInternal===null&&fatal("Cannot call "+i+" on a deleted database.")}}function getDatabase(e=getApp(),i){const s=_getProvider(e,"database").getImmediate({identifier:i});if(!s._instanceStarted){const a=getDefaultEmulatorHostnameAndPort("database");a&&connectDatabaseEmulator(s,...a)}return s}function connectDatabaseEmulator(e,i,s,a={}){e=getModularInstance(e),e._checkNotDeleted("useEmulator");const _=`${i}:${s}`,$=e._repoInternal;if(e._instanceStarted){if(_===e._repoInternal.repoInfo_.host&&deepEqual(a,$.repoInfo_.emulatorOptions))return;fatal("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let rt;if($.repoInfo_.nodeAdmin)a.mockUserToken&&fatal('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),rt=new EmulatorTokenProvider(EmulatorTokenProvider.OWNER);else if(a.mockUserToken){const c=typeof a.mockUserToken=="string"?a.mockUserToken:createMockUserToken(a.mockUserToken,e.app.options.projectId);rt=new EmulatorTokenProvider(c)}isCloudWorkstation(i)&&(pingServer(i),updateEmulatorBanner("Database",!0)),repoManagerApplyEmulatorSettings($,_,a,rt)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function registerDatabase(e){setSDKVersion(SDK_VERSION$1),_registerComponent(new Component("database",(i,{instanceIdentifier:s})=>{const a=i.getProvider("app").getImmediate(),_=i.getProvider("auth-internal"),$=i.getProvider("app-check-internal");return repoManagerDatabaseFromApp(a,_,$,s)},"PUBLIC").setMultipleInstances(!0)),registerVersion(name$2,version$2,e),registerVersion(name$2,version$2,"esm2020")}PersistentConnection.prototype.simpleListen=function(e,i){this.sendRequest("q",{p:e},i)};PersistentConnection.prototype.echo=function(e,i){this.sendRequest("echo",{d:e},i)};registerDatabase();var name$1="firebase",version$1="12.7.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */registerVersion(name$1,version$1,"app");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DEFAULT_HOST="firebasestorage.googleapis.com",CONFIG_STORAGE_BUCKET_KEY="storageBucket",DEFAULT_MAX_OPERATION_RETRY_TIME=2*60*1e3,DEFAULT_MAX_UPLOAD_RETRY_TIME=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class StorageError extends FirebaseError{constructor(i,s,a=0){super(prependCode(i),`Firebase Storage: ${s} (${prependCode(i)})`),this.status_=a,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,StorageError.prototype)}get status(){return this.status_}set status(i){this.status_=i}_codeEquals(i){return prependCode(i)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(i){this.customData.serverResponse=i,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var StorageErrorCode;(function(e){e.UNKNOWN="unknown",e.OBJECT_NOT_FOUND="object-not-found",e.BUCKET_NOT_FOUND="bucket-not-found",e.PROJECT_NOT_FOUND="project-not-found",e.QUOTA_EXCEEDED="quota-exceeded",e.UNAUTHENTICATED="unauthenticated",e.UNAUTHORIZED="unauthorized",e.UNAUTHORIZED_APP="unauthorized-app",e.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",e.INVALID_CHECKSUM="invalid-checksum",e.CANCELED="canceled",e.INVALID_EVENT_NAME="invalid-event-name",e.INVALID_URL="invalid-url",e.INVALID_DEFAULT_BUCKET="invalid-default-bucket",e.NO_DEFAULT_BUCKET="no-default-bucket",e.CANNOT_SLICE_BLOB="cannot-slice-blob",e.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",e.NO_DOWNLOAD_URL="no-download-url",e.INVALID_ARGUMENT="invalid-argument",e.INVALID_ARGUMENT_COUNT="invalid-argument-count",e.APP_DELETED="app-deleted",e.INVALID_ROOT_OPERATION="invalid-root-operation",e.INVALID_FORMAT="invalid-format",e.INTERNAL_ERROR="internal-error",e.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(StorageErrorCode||(StorageErrorCode={}));function prependCode(e){return"storage/"+e}function unknown(){const e="An unknown error occurred, please check the error payload for server response.";return new StorageError(StorageErrorCode.UNKNOWN,e)}function retryLimitExceeded(){return new StorageError(StorageErrorCode.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function canceled(){return new StorageError(StorageErrorCode.CANCELED,"User canceled the upload/download.")}function invalidUrl(e){return new StorageError(StorageErrorCode.INVALID_URL,"Invalid URL '"+e+"'.")}function invalidDefaultBucket(e){return new StorageError(StorageErrorCode.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+e+"'.")}function invalidArgument(e){return new StorageError(StorageErrorCode.INVALID_ARGUMENT,e)}function appDeleted(){return new StorageError(StorageErrorCode.APP_DELETED,"The Firebase app was deleted.")}function invalidRootOperation(e){return new StorageError(StorageErrorCode.INVALID_ROOT_OPERATION,"The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Location{constructor(i,s){this.bucket=i,this.path_=s}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const i=encodeURIComponent;return"/b/"+i(this.bucket)+"/o/"+i(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(i,s){let a;try{a=Location.makeFromUrl(i,s)}catch{return new Location(i,"")}if(a.path==="")return a;throw invalidDefaultBucket(i)}static makeFromUrl(i,s){let a=null;const _="([A-Za-z0-9.\\-_]+)";function $(Gt){Gt.path.charAt(Gt.path.length-1)==="/"&&(Gt.path_=Gt.path_.slice(0,-1))}const rt="(/(.*))?$",c=new RegExp("^gs://"+_+rt,"i"),dt={bucket:1,path:3};function ht(Gt){Gt.path_=decodeURIComponent(Gt.path)}const Et="v[A-Za-z0-9_]+",St=s.replace(/[.]/g,"\\."),At="(/([^?#]*).*)?$",Pt=new RegExp(`^https?://${St}/${Et}/b/${_}/o${At}`,"i"),Vt={bucket:1,path:3},Bt=s===DEFAULT_HOST?"(?:storage.googleapis.com|storage.cloud.google.com)":s,Zt="([^?#]*)",zt=new RegExp(`^https?://${Bt}/${_}/${Zt}`,"i"),Nt=[{regex:c,indices:dt,postModify:$},{regex:Pt,indices:Vt,postModify:ht},{regex:zt,indices:{bucket:1,path:2},postModify:ht}];for(let Gt=0;Gt<Nt.length;Gt++){const er=Nt[Gt],ir=er.regex.exec(i);if(ir){const or=ir[er.indices.bucket];let mr=ir[er.indices.path];mr||(mr=""),a=new Location(or,mr),er.postModify(a);break}}if(a==null)throw invalidUrl(i);return a}}class FailRequest{constructor(i){this.promise_=Promise.reject(i)}getPromise(){return this.promise_}cancel(i=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function start(e,i,s){let a=1,_=null,$=null,rt=!1,c=0;function dt(){return c===2}let ht=!1;function Et(...Zt){ht||(ht=!0,i.apply(null,Zt))}function St(Zt){_=setTimeout(()=>{_=null,e(Pt,dt())},Zt)}function At(){$&&clearTimeout($)}function Pt(Zt,...zt){if(ht){At();return}if(Zt){At(),Et.call(null,Zt,...zt);return}if(dt()||rt){At(),Et.call(null,Zt,...zt);return}a<64&&(a*=2);let Nt;c===1?(c=2,Nt=0):Nt=(a+Math.random())*1e3,St(Nt)}let Vt=!1;function Bt(Zt){Vt||(Vt=!0,At(),!ht&&(_!==null?(Zt||(c=2),clearTimeout(_),St(0)):Zt||(c=1)))}return St(0),$=setTimeout(()=>{rt=!0,Bt(!0)},s),Bt}function stop(e){e(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function isJustDef(e){return e!==void 0}function validateNumber(e,i,s,a){if(a<i)throw invalidArgument(`Invalid value for '${e}'. Expected ${i} or greater.`);if(a>s)throw invalidArgument(`Invalid value for '${e}'. Expected ${s} or less.`)}function makeQueryString(e){const i=encodeURIComponent;let s="?";for(const a in e)if(e.hasOwnProperty(a)){const _=i(a)+"="+i(e[a]);s=s+_+"&"}return s=s.slice(0,-1),s}var ErrorCode;(function(e){e[e.NO_ERROR=0]="NO_ERROR",e[e.NETWORK_ERROR=1]="NETWORK_ERROR",e[e.ABORT=2]="ABORT"})(ErrorCode||(ErrorCode={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function isRetryStatusCode(e,i){const s=e>=500&&e<600,_=[408,429].indexOf(e)!==-1,$=i.indexOf(e)!==-1;return s||_||$}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NetworkRequest{constructor(i,s,a,_,$,rt,c,dt,ht,Et,St,At=!0,Pt=!1){this.url_=i,this.method_=s,this.headers_=a,this.body_=_,this.successCodes_=$,this.additionalRetryCodes_=rt,this.callback_=c,this.errorCallback_=dt,this.timeout_=ht,this.progressCallback_=Et,this.connectionFactory_=St,this.retry=At,this.isUsingEmulator=Pt,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((Vt,Bt)=>{this.resolve_=Vt,this.reject_=Bt,this.start_()})}start_(){const i=(a,_)=>{if(_){a(!1,new RequestEndStatus(!1,null,!0));return}const $=this.connectionFactory_();this.pendingConnection_=$;const rt=c=>{const dt=c.loaded,ht=c.lengthComputable?c.total:-1;this.progressCallback_!==null&&this.progressCallback_(dt,ht)};this.progressCallback_!==null&&$.addUploadProgressListener(rt),$.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&$.removeUploadProgressListener(rt),this.pendingConnection_=null;const c=$.getErrorCode()===ErrorCode.NO_ERROR,dt=$.getStatus();if(!c||isRetryStatusCode(dt,this.additionalRetryCodes_)&&this.retry){const Et=$.getErrorCode()===ErrorCode.ABORT;a(!1,new RequestEndStatus(!1,null,Et));return}const ht=this.successCodes_.indexOf(dt)!==-1;a(!0,new RequestEndStatus(ht,$))})},s=(a,_)=>{const $=this.resolve_,rt=this.reject_,c=_.connection;if(_.wasSuccessCode)try{const dt=this.callback_(c,c.getResponse());isJustDef(dt)?$(dt):$()}catch(dt){rt(dt)}else if(c!==null){const dt=unknown();dt.serverResponse=c.getErrorText(),this.errorCallback_?rt(this.errorCallback_(c,dt)):rt(dt)}else if(_.canceled){const dt=this.appDelete_?appDeleted():canceled();rt(dt)}else{const dt=retryLimitExceeded();rt(dt)}};this.canceled_?s(!1,new RequestEndStatus(!1,null,!0)):this.backoffId_=start(i,s,this.timeout_)}getPromise(){return this.promise_}cancel(i){this.canceled_=!0,this.appDelete_=i||!1,this.backoffId_!==null&&stop(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class RequestEndStatus{constructor(i,s,a){this.wasSuccessCode=i,this.connection=s,this.canceled=!!a}}function addAuthHeader_(e,i){i!==null&&i.length>0&&(e.Authorization="Firebase "+i)}function addVersionHeader_(e,i){e["X-Firebase-Storage-Version"]="webjs/"+(i??"AppManager")}function addGmpidHeader_(e,i){i&&(e["X-Firebase-GMPID"]=i)}function addAppCheckHeader_(e,i){i!==null&&(e["X-Firebase-AppCheck"]=i)}function makeRequest(e,i,s,a,_,$,rt=!0,c=!1){const dt=makeQueryString(e.urlParams),ht=e.url+dt,Et=Object.assign({},e.headers);return addGmpidHeader_(Et,i),addAuthHeader_(Et,s),addVersionHeader_(Et,$),addAppCheckHeader_(Et,a),new NetworkRequest(ht,e.method,Et,e.body,e.successCodes,e.additionalRetryCodes,e.handler,e.errorHandler,e.timeout,e.progressCallback,_,rt,c)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function parent$1(e){if(e.length===0)return null;const i=e.lastIndexOf("/");return i===-1?"":e.slice(0,i)}function lastComponent(e){const i=e.lastIndexOf("/",e.length-2);return i===-1?e:e.slice(i+1)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Reference{constructor(i,s){this._service=i,s instanceof Location?this._location=s:this._location=Location.makeFromUrl(s,i.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(i,s){return new Reference(i,s)}get root(){const i=new Location(this._location.bucket,"");return this._newRef(this._service,i)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return lastComponent(this._location.path)}get storage(){return this._service}get parent(){const i=parent$1(this._location.path);if(i===null)return null;const s=new Location(this._location.bucket,i);return new Reference(this._service,s)}_throwIfRoot(i){if(this._location.path==="")throw invalidRootOperation(i)}}function extractBucket(e,i){const s=i==null?void 0:i[CONFIG_STORAGE_BUCKET_KEY];return s==null?null:Location.makeFromBucketSpec(s,e)}function connectStorageEmulator$1(e,i,s,a={}){e.host=`${i}:${s}`;const _=isCloudWorkstation(i);_&&(pingServer(`https://${e.host}/b`),updateEmulatorBanner("Storage",!0)),e._isUsingEmulator=!0,e._protocol=_?"https":"http";const{mockUserToken:$}=a;$&&(e._overrideAuthToken=typeof $=="string"?$:createMockUserToken($,e.app.options.projectId))}class FirebaseStorageImpl{constructor(i,s,a,_,$,rt=!1){this.app=i,this._authProvider=s,this._appCheckProvider=a,this._url=_,this._firebaseVersion=$,this._isUsingEmulator=rt,this._bucket=null,this._host=DEFAULT_HOST,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=DEFAULT_MAX_OPERATION_RETRY_TIME,this._maxUploadRetryTime=DEFAULT_MAX_UPLOAD_RETRY_TIME,this._requests=new Set,_!=null?this._bucket=Location.makeFromBucketSpec(_,this._host):this._bucket=extractBucket(this._host,this.app.options)}get host(){return this._host}set host(i){this._host=i,this._url!=null?this._bucket=Location.makeFromBucketSpec(this._url,i):this._bucket=extractBucket(i,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(i){validateNumber("time",0,Number.POSITIVE_INFINITY,i),this._maxUploadRetryTime=i}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(i){validateNumber("time",0,Number.POSITIVE_INFINITY,i),this._maxOperationRetryTime=i}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const i=this._authProvider.getImmediate({optional:!0});if(i){const s=await i.getToken();if(s!==null)return s.accessToken}return null}async _getAppCheckToken(){if(_isFirebaseServerApp(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const i=this._appCheckProvider.getImmediate({optional:!0});return i?(await i.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(i=>i.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(i){return new Reference(this,i)}_makeRequest(i,s,a,_,$=!0){if(this._deleted)return new FailRequest(appDeleted());{const rt=makeRequest(i,this._appId,a,_,s,this._firebaseVersion,$,this._isUsingEmulator);return this._requests.add(rt),rt.getPromise().then(()=>this._requests.delete(rt),()=>this._requests.delete(rt)),rt}}async makeRequestWithTokens(i,s){const[a,_]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(i,s,a,_).getPromise()}}const name="@firebase/storage",version="0.14.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const STORAGE_TYPE="storage";function getStorage(e=getApp(),i){e=getModularInstance(e);const a=_getProvider(e,STORAGE_TYPE).getImmediate({identifier:i}),_=getDefaultEmulatorHostnameAndPort("storage");return _&&connectStorageEmulator(a,..._),a}function connectStorageEmulator(e,i,s,a={}){connectStorageEmulator$1(e,i,s,a)}function factory(e,{instanceIdentifier:i}){const s=e.getProvider("app").getImmediate(),a=e.getProvider("auth-internal"),_=e.getProvider("app-check-internal");return new FirebaseStorageImpl(s,a,_,i,SDK_VERSION$1)}function registerStorage(){_registerComponent(new Component(STORAGE_TYPE,factory,"PUBLIC").setMultipleInstances(!0)),registerVersion(name,version,""),registerVersion(name,version,"esm2020")}registerStorage();const firebaseConfig={apiKey:"AIzaSyC_2a50875vxMTHa8jZhcfMP--nO_Jvmko",authDomain:"nulltobuild.firebaseapp.com",databaseURL:"https://nulltobuild-default-rtdb.firebaseio.com",projectId:"nulltobuild",storageBucket:"nulltobuild.firebasestorage.app",messagingSenderId:"937347030160",appId:"1:937347030160:web:d60bb96785fbc5a7e9cc15"},app=initializeApp(firebaseConfig),auth=getAuth(app),database=getDatabase(app);getStorage(app);const MAPBOX_ACCESS_TOKEN="pk.eyJ1IjoicGF2YW5rdW1hcnN3YW15IiwiYSI6ImNtNnc1c3ZpdTBkdGgyanM5b25rN2ZqcncifQ.Ls1e2W6rx3apoBsStWa5Ow",AuthContext=reactExports.createContext(void 0);async function getLocationDetails(e,i){try{const a=await(await fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${i},${e}.json?access_token=${MAPBOX_ACCESS_TOKEN}&types=address,place,postcode`)).json();let _="",$="",rt="";if(a.features&&a.features.length>0){rt=a.features[0].place_name;for(const c of a.features)c.place_type.includes("place")?_=c.text:c.place_type.includes("postcode")&&($=c.text)}return{city:_||"Unknown",pincode:$,address:rt||""}}catch(s){return console.error("Error getting location details:",s),{city:"Unknown",pincode:"",address:""}}}function AuthProvider({children:e}){const[i,s]=reactExports.useState(null),[a,_]=reactExports.useState(null),[$,rt]=reactExports.useState(!0),c=async()=>{if(i)try{const Vt=ref(database,`users/${i.uid}`),Bt=await get(Vt);Bt.exists()&&_(Bt.val())}catch(Vt){console.error("Error refreshing user data:",Vt)}};reactExports.useEffect(()=>{const Vt=auth.onAuthStateChanged(Bt=>{s(Bt),Bt?setTimeout(async()=>{try{const Zt=ref(database,`users/${Bt.uid}`),zt=await get(Zt);zt.exists()&&_(zt.val())}catch(Zt){console.error("Error fetching user data:",Zt)}rt(!1)},0):(_(null),rt(!1))});return()=>Vt()},[]);const dt=async(Vt,Bt)=>{const Zt=await signInWithEmailAndPassword(auth,Vt,Bt),zt=ref(database,`users/${Zt.user.uid}`),Ut=await get(zt);Ut.exists()&&_(Ut.val())},ht=async(Vt,Bt,Zt,zt,Ut)=>{const Nt=await createUserWithEmailAndPassword(auth,Vt,Bt),Gt={id:Nt.user.uid,email:Vt,name:Zt,phone:zt,role:Ut,createdAt:Date.now()};await set(ref(database,`users/${Nt.user.uid}`),Gt),_(Gt)},Et=async(Vt,Bt,Zt,zt="home")=>{var un,jr;if(!a)return;const{city:Ut,pincode:Nt,address:Gt}=await getLocationDetails(Vt,Bt);let er=Nt;if(!er&&Zt){const Jr=Zt.match(/\b\d{6}\b/);Jr&&(er=Jr[0])}const ir=Zt||Gt||"",or={...a.address,line2:((un=a.address)==null?void 0:un.line2)||"",landmark:((jr=a.address)==null?void 0:jr.landmark)||"",line1:ir,city:Ut,pincode:er||"",lat:Vt,lng:Bt,label:zt},mr=a.savedAddresses||[],Rr=mr.findIndex(Jr=>Jr.lat===Vt&&Jr.lng===Bt);let on;Rr>=0?(on=[...mr],on[Rr]={...on[Rr],...or,label:zt}):on=[...mr,or],await update(ref(database,`users/${a.id}`),{address:or,savedAddresses:on}),_(Jr=>Jr?{...Jr,address:or,savedAddresses:on}:null)},St=async()=>{await signOut(auth),_(null)},At=async Vt=>{if(!a)return;const Bt=a.favorites||[];let Zt;Bt.includes(Vt)?Zt=Bt.filter(zt=>zt!==Vt):Zt=[...Bt,Vt];try{await update(ref(database,`users/${a.id}`),{favorites:Zt}),_({...a,favorites:Zt})}catch(zt){console.error("Error updating favorites:",zt)}},Pt=async(Vt,Bt)=>{if(!a||!a.savedAddresses)return;const Zt=a.savedAddresses.filter(zt=>!(zt.lat===Vt&&zt.lng===Bt));try{await update(ref(database,`users/${a.id}`),{savedAddresses:Zt}),_(zt=>zt?{...zt,savedAddresses:Zt}:null)}catch(zt){console.error("Error deleting address:",zt)}};return jsxRuntimeExports.jsx(AuthContext.Provider,{value:{firebaseUser:i,user:a,loading:$,signIn:dt,signUp:ht,signOut:St,updateUserLocation:Et,toggleFavorite:At,refreshUser:c,deleteAddress:Pt},children:e})}function useAuth(){const e=reactExports.useContext(AuthContext);if(e===void 0)throw new Error("useAuth must be used within an AuthProvider");return e}const CartContext=reactExports.createContext(void 0),CART_STORAGE_KEY="amma-cheythi-cart";function CartProvider({children:e}){const[i,s]=reactExports.useState(()=>{const At=localStorage.getItem(CART_STORAGE_KEY);return At?JSON.parse(At):{items:[],kitchenId:null,kitchenName:null,cookingInstructions:{tags:[],note:""},appliedCoupon:null}});reactExports.useEffect(()=>{localStorage.setItem(CART_STORAGE_KEY,JSON.stringify(i))},[i]);const a=(At,Pt)=>{s(Vt=>({...Vt,cookingInstructions:{tags:At,note:Pt}}))},_=At=>{s(Pt=>({...Pt,appliedCoupon:At}))},$=()=>{s(At=>({...At,appliedCoupon:null}))},rt=(At,Pt,Vt)=>{s(Bt=>Bt.kitchenId&&Bt.kitchenId!==Pt?(ue.error("You can only order from one kitchen at a time. Clear cart first."),Bt):Bt.items.find(zt=>zt.dish.id===At.id)?{...Bt,items:Bt.items.map(zt=>zt.dish.id===At.id?{...zt,quantity:zt.quantity+1}:zt)}:(ue.success(`Added ${At.name} to cart!`),{items:[...Bt.items,{dish:At,quantity:1,kitchenId:Pt,kitchenName:Vt}],kitchenId:Pt,kitchenName:Vt,appliedCoupon:Bt.appliedCoupon}))},c=At=>{s(Pt=>{const Vt=Pt.items.filter(Bt=>Bt.dish.id!==At);return{items:Vt,kitchenId:Vt.length>0?Pt.kitchenId:null,kitchenName:Vt.length>0?Pt.kitchenName:null,appliedCoupon:Vt.length>0?Pt.appliedCoupon:null}})},dt=(At,Pt)=>{if(Pt<=0){c(At);return}s(Vt=>({...Vt,items:Vt.items.map(Bt=>Bt.dish.id===At?{...Bt,quantity:Pt}:Bt)}))},ht=()=>{s({items:[],kitchenId:null,kitchenName:null,cookingInstructions:{tags:[],note:""},appliedCoupon:null})},Et=()=>i.items.reduce((At,Pt)=>At+Pt.quantity,0),St=()=>i.items.reduce((At,Pt)=>At+Pt.dish.price*Pt.quantity,0);return jsxRuntimeExports.jsx(CartContext.Provider,{value:{cart:i,addToCart:rt,removeFromCart:c,updateQuantity:dt,clearCart:ht,getItemCount:Et,getTotal:St,updateCookingInstructions:a,applyCoupon:_,removeCoupon:$},children:e})}function useCart(){const e=reactExports.useContext(CartContext);if(e===void 0)throw new Error("useCart must be used within a CartProvider");return e}function isPointInPolygon(e,i){if(!i||!i.coordinates||i.coordinates.length===0)return!1;const s=i.coordinates[0],a=e.lng,_=e.lat;let $=!1;for(let rt=0,c=s.length-1;rt<s.length;c=rt++){const dt=s[rt][0],ht=s[rt][1],Et=s[c][0],St=s[c][1];ht>_!=St>_&&a<(Et-dt)*(_-ht)/(St-ht)+dt&&($=!$)}return $}function isPointInZone(e,i,s){return isPointInPolygon({lat:e,lng:i},s)}function isLocationInAnyZone(e,i){for(const s of i){if(!s.zone||!s.zone.coordinates||!s.zone.coordinates[0]){console.log(`Skipping franchise ${s.id} - invalid zone data`);continue}const a=isPointInPolygon(e,s.zone);if(console.log(`Zone check for ${s.id}:`,{point:e,zoneCoords:s.zone.coordinates[0].slice(0,3),result:a}),a)return{isInZone:!0,franchiseId:s.id}}return{isInZone:!1,franchiseId:null}}function getPolygonCenter(e){if(!e||!e.coordinates||e.coordinates.length===0)return null;const i=e.coordinates[0];let s=0,a=0;for(const _ of i)a+=_[0],s+=_[1];return{lat:s/i.length,lng:a/i.length}}function geoJSONToZonePolygon(e){return!e||!e.geometry||e.geometry.type!=="Polygon"?null:{type:"Polygon",coordinates:e.geometry.coordinates}}function useUserLocation(){const[e,i]=reactExports.useState(null),[s,a]=reactExports.useState(!0),[_,$]=reactExports.useState(null),rt=async(dt,ht)=>{try{const St=await(await fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${ht},${dt}.json?access_token=${MAPBOX_ACCESS_TOKEN}`)).json();if(St.features&&St.features.length>0){const At=St.features[0].context||[],Pt=At.find(Bt=>Bt.id.startsWith("locality")||Bt.id.startsWith("neighborhood")),Vt=At.find(Bt=>Bt.id.startsWith("place"));return Pt?Pt.text:Vt?Vt.text:St.features[0].text||"Unknown"}return"Unknown location"}catch(Et){return console.error("Geocoding error:",Et),"Unknown location"}},c=()=>{if(a(!0),$(null),!("geolocation"in navigator)){$("Geolocation not supported"),a(!1);return}navigator.geolocation.getCurrentPosition(async dt=>{const{latitude:ht,longitude:Et}=dt.coords,St=await rt(ht,Et);i({lat:ht,lng:Et,address:St}),a(!1)},dt=>{console.error("Location error:",dt),$("Location access denied"),a(!1)},{enableHighAccuracy:!0,timeout:1e4})};return reactExports.useEffect(()=>{c()},[]),{location:e,loading:s,error:_,refetch:c,setLocation:i}}const LocationContext=reactExports.createContext(void 0);function LocationProvider({children:e}){const{location:i,loading:s,error:a,refetch:_,setLocation:$}=useUserLocation(),[rt,c]=reactExports.useState([]),[dt,ht]=reactExports.useState(!0),[Et,St]=reactExports.useState(!0),[At,Pt]=reactExports.useState(null),[Vt,Bt]=reactExports.useState(!1);reactExports.useEffect(()=>{const Ut=ref(database,"franchises"),Nt=onValue(Ut,Gt=>{const er=Gt.val();if(er){const ir=Object.entries(er).map(([or,mr])=>({...mr,id:or})).filter(or=>or.isActive);c(ir)}else c([]);ht(!1)});return()=>Nt()},[]),reactExports.useEffect(()=>{if(s||dt)return;if(!i){console.log("No location available, allowing access by default"),St(!0),Pt(null),Bt(!0);return}if(rt.length===0){console.log("No franchises exist, allowing access"),St(!0),Pt(null),Bt(!0);return}const Ut=rt.filter(er=>er.zone&&er.zone.coordinates&&er.zone.coordinates[0]&&er.zone.coordinates[0].length>0);if(console.log("Location check:",{userLat:i.lat,userLng:i.lng,totalFranchises:rt.length,validFranchises:Ut.length,franchiseZones:rt.map(er=>{var ir,or,mr,Rr;return{id:er.id,name:er.name,hasZone:!!er.zone,zoneType:(ir=er.zone)==null?void 0:ir.type,coordsLength:(Rr=(mr=(or=er.zone)==null?void 0:or.coordinates)==null?void 0:mr[0])==null?void 0:Rr.length}})}),Ut.length===0){console.log("No valid franchise zones, allowing access"),St(!0),Pt(null),Bt(!0);return}const Nt=Ut.map(er=>({id:er.id,zone:er.zone})),Gt=isLocationInAnyZone({lat:i.lat,lng:i.lng},Nt);console.log("Zone check result:",Gt),St(Gt.isInZone),Pt(Gt.franchiseId),Bt(!0)},[i,rt,s,dt]);const Zt=rt.find(Ut=>Ut.id===At)||null,zt=s||dt||!Vt;return jsxRuntimeExports.jsx(LocationContext.Provider,{value:{userLocation:i,locationLoading:s,locationError:a,isInServiceArea:Et,currentFranchiseId:At,currentFranchise:Zt,franchises:rt,checkingZone:zt,refetchLocation:_,setUserLocation:$},children:e})}function useLocationContext(){const e=reactExports.useContext(LocationContext);if(e===void 0)throw new Error("useLocationContext must be used within a LocationProvider");return e}const DataContext=reactExports.createContext(void 0);function DataProvider({children:e}){const[i,s]=reactExports.useState([]),[a,_]=reactExports.useState(!0),[$,rt]=reactExports.useState(null);reactExports.useEffect(()=>{const dt=ref(database,"kitchens"),ht=onValue(dt,Et=>{try{const St=Et.val();if(St){const At=Object.entries(St).map(([Vt,Bt])=>({...Bt,id:Vt})),Pt=At.filter(Vt=>Vt.isApproved===!0);s(Pt.length>0?Pt:At)}else s([]);_(!1)}catch{rt("Failed to fetch kitchens"),_(!1)}},Et=>{rt(Et.message),_(!1)});return()=>ht()},[]);const c=()=>{_(!0)};return jsxRuntimeExports.jsx(DataContext.Provider,{value:{kitchens:i,loading:a,error:$,refreshKitchens:c},children:e})}function useDataContext(){const e=reactExports.useContext(DataContext);if(e===void 0)throw new Error("useDataContext must be used within a DataProvider");return e}const LayoutGroupContext=reactExports.createContext({});function useConstant(e){const i=reactExports.useRef(null);return i.current===null&&(i.current=e()),i.current}const isBrowser=typeof window<"u",useIsomorphicLayoutEffect$1=isBrowser?reactExports.useLayoutEffect:reactExports.useEffect,PresenceContext=reactExports.createContext(null);function addUniqueItem(e,i){e.indexOf(i)===-1&&e.push(i)}function removeItem(e,i){const s=e.indexOf(i);s>-1&&e.splice(s,1)}const clamp$1=(e,i,s)=>s>i?i:s<e?e:s;function formatErrorMessage(e,i){return i?`${e}. For more information and steps for solving, visit https://motion.dev/troubleshooting/${i}`:e}let warning=()=>{},invariant=()=>{};typeof process<"u";const MotionGlobalConfig={},isNumericalString=e=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(e);function isObject(e){return typeof e=="object"&&e!==null}const isZeroValueString=e=>/^0[^.\s]+$/u.test(e);function memo(e){let i;return()=>(i===void 0&&(i=e()),i)}const noop=e=>e,combineFunctions=(e,i)=>s=>i(e(s)),pipe=(...e)=>e.reduce(combineFunctions),progress=(e,i,s)=>{const a=i-e;return a===0?1:(s-e)/a};class SubscriptionManager{constructor(){this.subscriptions=[]}add(i){return addUniqueItem(this.subscriptions,i),()=>removeItem(this.subscriptions,i)}notify(i,s,a){const _=this.subscriptions.length;if(_)if(_===1)this.subscriptions[0](i,s,a);else for(let $=0;$<_;$++){const rt=this.subscriptions[$];rt&&rt(i,s,a)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const secondsToMilliseconds=e=>e*1e3,millisecondsToSeconds=e=>e/1e3;function velocityPerSecond(e,i){return i?e*(1e3/i):0}const calcBezier=(e,i,s)=>(((1-3*s+3*i)*e+(3*s-6*i))*e+3*i)*e,subdivisionPrecision=1e-7,subdivisionMaxIterations=12;function binarySubdivide(e,i,s,a,_){let $,rt,c=0;do rt=i+(s-i)/2,$=calcBezier(rt,a,_)-e,$>0?s=rt:i=rt;while(Math.abs($)>subdivisionPrecision&&++c<subdivisionMaxIterations);return rt}function cubicBezier(e,i,s,a){if(e===i&&s===a)return noop;const _=$=>binarySubdivide($,0,1,e,s);return $=>$===0||$===1?$:calcBezier(_($),i,a)}const mirrorEasing=e=>i=>i<=.5?e(2*i)/2:(2-e(2*(1-i)))/2,reverseEasing=e=>i=>1-e(1-i),backOut=cubicBezier(.33,1.53,.69,.99),backIn=reverseEasing(backOut),backInOut=mirrorEasing(backIn),anticipate=e=>(e*=2)<1?.5*backIn(e):.5*(2-Math.pow(2,-10*(e-1))),circIn=e=>1-Math.sin(Math.acos(e)),circOut=reverseEasing(circIn),circInOut=mirrorEasing(circIn),easeIn=cubicBezier(.42,0,1,1),easeOut=cubicBezier(0,0,.58,1),easeInOut=cubicBezier(.42,0,.58,1),isEasingArray=e=>Array.isArray(e)&&typeof e[0]!="number",isBezierDefinition=e=>Array.isArray(e)&&typeof e[0]=="number",easingLookup={linear:noop,easeIn,easeInOut,easeOut,circIn,circInOut,circOut,backIn,backInOut,backOut,anticipate},isValidEasing=e=>typeof e=="string",easingDefinitionToFunction=e=>{if(isBezierDefinition(e)){invariant(e.length===4,"Cubic bezier arrays must contain four numerical values.","cubic-bezier-length");const[i,s,a,_]=e;return cubicBezier(i,s,a,_)}else if(isValidEasing(e))return invariant(easingLookup[e]!==void 0,`Invalid easing type '${e}'`,"invalid-easing-type"),easingLookup[e];return e},stepsOrder=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"],statsBuffer={value:null,addProjectionMetrics:null};function createRenderStep(e,i){let s=new Set,a=new Set,_=!1,$=!1;const rt=new WeakSet;let c={delta:0,timestamp:0,isProcessing:!1},dt=0;function ht(St){rt.has(St)&&(Et.schedule(St),e()),dt++,St(c)}const Et={schedule:(St,At=!1,Pt=!1)=>{const Bt=Pt&&_?s:a;return At&&rt.add(St),Bt.has(St)||Bt.add(St),St},cancel:St=>{a.delete(St),rt.delete(St)},process:St=>{if(c=St,_){$=!0;return}_=!0,[s,a]=[a,s],s.forEach(ht),i&&statsBuffer.value&&statsBuffer.value.frameloop[i].push(dt),dt=0,s.clear(),_=!1,$&&($=!1,Et.process(St))}};return Et}const maxElapsed=40;function createRenderBatcher(e,i){let s=!1,a=!0;const _={delta:0,timestamp:0,isProcessing:!1},$=()=>s=!0,rt=stepsOrder.reduce((Nt,Gt)=>(Nt[Gt]=createRenderStep($,i?Gt:void 0),Nt),{}),{setup:c,read:dt,resolveKeyframes:ht,preUpdate:Et,update:St,preRender:At,render:Pt,postRender:Vt}=rt,Bt=()=>{const Nt=MotionGlobalConfig.useManualTiming?_.timestamp:performance.now();s=!1,MotionGlobalConfig.useManualTiming||(_.delta=a?1e3/60:Math.max(Math.min(Nt-_.timestamp,maxElapsed),1)),_.timestamp=Nt,_.isProcessing=!0,c.process(_),dt.process(_),ht.process(_),Et.process(_),St.process(_),At.process(_),Pt.process(_),Vt.process(_),_.isProcessing=!1,s&&i&&(a=!1,e(Bt))},Zt=()=>{s=!0,a=!0,_.isProcessing||e(Bt)};return{schedule:stepsOrder.reduce((Nt,Gt)=>{const er=rt[Gt];return Nt[Gt]=(ir,or=!1,mr=!1)=>(s||Zt(),er.schedule(ir,or,mr)),Nt},{}),cancel:Nt=>{for(let Gt=0;Gt<stepsOrder.length;Gt++)rt[stepsOrder[Gt]].cancel(Nt)},state:_,steps:rt}}const{schedule:frame,cancel:cancelFrame,state:frameData,steps:frameSteps}=createRenderBatcher(typeof requestAnimationFrame<"u"?requestAnimationFrame:noop,!0);let now;function clearTime(){now=void 0}const time={now:()=>(now===void 0&&time.set(frameData.isProcessing||MotionGlobalConfig.useManualTiming?frameData.timestamp:performance.now()),now),set:e=>{now=e,queueMicrotask(clearTime)}},checkStringStartsWith=e=>i=>typeof i=="string"&&i.startsWith(e),isCSSVariableName=checkStringStartsWith("--"),startsAsVariableToken=checkStringStartsWith("var(--"),isCSSVariableToken=e=>startsAsVariableToken(e)?singleCssVariableRegex.test(e.split("/*")[0].trim()):!1,singleCssVariableRegex=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,number={test:e=>typeof e=="number",parse:parseFloat,transform:e=>e},alpha={...number,transform:e=>clamp$1(0,1,e)},scale={...number,default:1},sanitize=e=>Math.round(e*1e5)/1e5,floatRegex=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function isNullish(e){return e==null}const singleColorRegex=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,isColorString=(e,i)=>s=>!!(typeof s=="string"&&singleColorRegex.test(s)&&s.startsWith(e)||i&&!isNullish(s)&&Object.prototype.hasOwnProperty.call(s,i)),splitColor=(e,i,s)=>a=>{if(typeof a!="string")return a;const[_,$,rt,c]=a.match(floatRegex);return{[e]:parseFloat(_),[i]:parseFloat($),[s]:parseFloat(rt),alpha:c!==void 0?parseFloat(c):1}},clampRgbUnit=e=>clamp$1(0,255,e),rgbUnit={...number,transform:e=>Math.round(clampRgbUnit(e))},rgba={test:isColorString("rgb","red"),parse:splitColor("red","green","blue"),transform:({red:e,green:i,blue:s,alpha:a=1})=>"rgba("+rgbUnit.transform(e)+", "+rgbUnit.transform(i)+", "+rgbUnit.transform(s)+", "+sanitize(alpha.transform(a))+")"};function parseHex(e){let i="",s="",a="",_="";return e.length>5?(i=e.substring(1,3),s=e.substring(3,5),a=e.substring(5,7),_=e.substring(7,9)):(i=e.substring(1,2),s=e.substring(2,3),a=e.substring(3,4),_=e.substring(4,5),i+=i,s+=s,a+=a,_+=_),{red:parseInt(i,16),green:parseInt(s,16),blue:parseInt(a,16),alpha:_?parseInt(_,16)/255:1}}const hex={test:isColorString("#"),parse:parseHex,transform:rgba.transform},createUnitType=e=>({test:i=>typeof i=="string"&&i.endsWith(e)&&i.split(" ").length===1,parse:parseFloat,transform:i=>`${i}${e}`}),degrees=createUnitType("deg"),percent=createUnitType("%"),px=createUnitType("px"),vh=createUnitType("vh"),vw=createUnitType("vw"),progressPercentage={...percent,parse:e=>percent.parse(e)/100,transform:e=>percent.transform(e*100)},hsla={test:isColorString("hsl","hue"),parse:splitColor("hue","saturation","lightness"),transform:({hue:e,saturation:i,lightness:s,alpha:a=1})=>"hsla("+Math.round(e)+", "+percent.transform(sanitize(i))+", "+percent.transform(sanitize(s))+", "+sanitize(alpha.transform(a))+")"},color={test:e=>rgba.test(e)||hex.test(e)||hsla.test(e),parse:e=>rgba.test(e)?rgba.parse(e):hsla.test(e)?hsla.parse(e):hex.parse(e),transform:e=>typeof e=="string"?e:e.hasOwnProperty("red")?rgba.transform(e):hsla.transform(e),getAnimatableNone:e=>{const i=color.parse(e);return i.alpha=0,color.transform(i)}},colorRegex=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function test(e){var i,s;return isNaN(e)&&typeof e=="string"&&(((i=e.match(floatRegex))==null?void 0:i.length)||0)+(((s=e.match(colorRegex))==null?void 0:s.length)||0)>0}const NUMBER_TOKEN="number",COLOR_TOKEN="color",VAR_TOKEN="var",VAR_FUNCTION_TOKEN="var(",SPLIT_TOKEN="${}",complexRegex=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function analyseComplexValue(e){const i=e.toString(),s=[],a={color:[],number:[],var:[]},_=[];let $=0;const c=i.replace(complexRegex,dt=>(color.test(dt)?(a.color.push($),_.push(COLOR_TOKEN),s.push(color.parse(dt))):dt.startsWith(VAR_FUNCTION_TOKEN)?(a.var.push($),_.push(VAR_TOKEN),s.push(dt)):(a.number.push($),_.push(NUMBER_TOKEN),s.push(parseFloat(dt))),++$,SPLIT_TOKEN)).split(SPLIT_TOKEN);return{values:s,split:c,indexes:a,types:_}}function parseComplexValue(e){return analyseComplexValue(e).values}function createTransformer(e){const{split:i,types:s}=analyseComplexValue(e),a=i.length;return _=>{let $="";for(let rt=0;rt<a;rt++)if($+=i[rt],_[rt]!==void 0){const c=s[rt];c===NUMBER_TOKEN?$+=sanitize(_[rt]):c===COLOR_TOKEN?$+=color.transform(_[rt]):$+=_[rt]}return $}}const convertNumbersToZero=e=>typeof e=="number"?0:color.test(e)?color.getAnimatableNone(e):e;function getAnimatableNone$1(e){const i=parseComplexValue(e);return createTransformer(e)(i.map(convertNumbersToZero))}const complex={test,parse:parseComplexValue,createTransformer,getAnimatableNone:getAnimatableNone$1};function hueToRgb(e,i,s){return s<0&&(s+=1),s>1&&(s-=1),s<1/6?e+(i-e)*6*s:s<1/2?i:s<2/3?e+(i-e)*(2/3-s)*6:e}function hslaToRgba({hue:e,saturation:i,lightness:s,alpha:a}){e/=360,i/=100,s/=100;let _=0,$=0,rt=0;if(!i)_=$=rt=s;else{const c=s<.5?s*(1+i):s+i-s*i,dt=2*s-c;_=hueToRgb(dt,c,e+1/3),$=hueToRgb(dt,c,e),rt=hueToRgb(dt,c,e-1/3)}return{red:Math.round(_*255),green:Math.round($*255),blue:Math.round(rt*255),alpha:a}}function mixImmediate(e,i){return s=>s>0?i:e}const mixNumber$1=(e,i,s)=>e+(i-e)*s,mixLinearColor=(e,i,s)=>{const a=e*e,_=s*(i*i-a)+a;return _<0?0:Math.sqrt(_)},colorTypes=[hex,rgba,hsla],getColorType=e=>colorTypes.find(i=>i.test(e));function asRGBA(e){const i=getColorType(e);if(warning(!!i,`'${e}' is not an animatable color. Use the equivalent color code instead.`,"color-not-animatable"),!i)return!1;let s=i.parse(e);return i===hsla&&(s=hslaToRgba(s)),s}const mixColor=(e,i)=>{const s=asRGBA(e),a=asRGBA(i);if(!s||!a)return mixImmediate(e,i);const _={...s};return $=>(_.red=mixLinearColor(s.red,a.red,$),_.green=mixLinearColor(s.green,a.green,$),_.blue=mixLinearColor(s.blue,a.blue,$),_.alpha=mixNumber$1(s.alpha,a.alpha,$),rgba.transform(_))},invisibleValues=new Set(["none","hidden"]);function mixVisibility(e,i){return invisibleValues.has(e)?s=>s<=0?e:i:s=>s>=1?i:e}function mixNumber(e,i){return s=>mixNumber$1(e,i,s)}function getMixer(e){return typeof e=="number"?mixNumber:typeof e=="string"?isCSSVariableToken(e)?mixImmediate:color.test(e)?mixColor:mixComplex:Array.isArray(e)?mixArray:typeof e=="object"?color.test(e)?mixColor:mixObject:mixImmediate}function mixArray(e,i){const s=[...e],a=s.length,_=e.map(($,rt)=>getMixer($)($,i[rt]));return $=>{for(let rt=0;rt<a;rt++)s[rt]=_[rt]($);return s}}function mixObject(e,i){const s={...e,...i},a={};for(const _ in s)e[_]!==void 0&&i[_]!==void 0&&(a[_]=getMixer(e[_])(e[_],i[_]));return _=>{for(const $ in a)s[$]=a[$](_);return s}}function matchOrder(e,i){const s=[],a={color:0,var:0,number:0};for(let _=0;_<i.values.length;_++){const $=i.types[_],rt=e.indexes[$][a[$]],c=e.values[rt]??0;s[_]=c,a[$]++}return s}const mixComplex=(e,i)=>{const s=complex.createTransformer(i),a=analyseComplexValue(e),_=analyseComplexValue(i);return a.indexes.var.length===_.indexes.var.length&&a.indexes.color.length===_.indexes.color.length&&a.indexes.number.length>=_.indexes.number.length?invisibleValues.has(e)&&!_.values.length||invisibleValues.has(i)&&!a.values.length?mixVisibility(e,i):pipe(mixArray(matchOrder(a,_),_.values),s):(warning(!0,`Complex values '${e}' and '${i}' too different to mix. Ensure all colors are of the same type, and that each contains the same quantity of number and color values. Falling back to instant transition.`,"complex-values-different"),mixImmediate(e,i))};function mix(e,i,s){return typeof e=="number"&&typeof i=="number"&&typeof s=="number"?mixNumber$1(e,i,s):getMixer(e)(e,i)}const frameloopDriver=e=>{const i=({timestamp:s})=>e(s);return{start:(s=!0)=>frame.update(i,s),stop:()=>cancelFrame(i),now:()=>frameData.isProcessing?frameData.timestamp:time.now()}},generateLinearEasing=(e,i,s=10)=>{let a="";const _=Math.max(Math.round(i/s),2);for(let $=0;$<_;$++)a+=Math.round(e($/(_-1))*1e4)/1e4+", ";return`linear(${a.substring(0,a.length-2)})`},maxGeneratorDuration=2e4;function calcGeneratorDuration(e){let i=0;const s=50;let a=e.next(i);for(;!a.done&&i<maxGeneratorDuration;)i+=s,a=e.next(i);return i>=maxGeneratorDuration?1/0:i}function createGeneratorEasing(e,i=100,s){const a=s({...e,keyframes:[0,i]}),_=Math.min(calcGeneratorDuration(a),maxGeneratorDuration);return{type:"keyframes",ease:$=>a.next(_*$).value/i,duration:millisecondsToSeconds(_)}}const velocitySampleDuration=5;function calcGeneratorVelocity(e,i,s){const a=Math.max(i-velocitySampleDuration,0);return velocityPerSecond(s-e(a),i-a)}const springDefaults={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},safeMin=.001;function findSpring({duration:e=springDefaults.duration,bounce:i=springDefaults.bounce,velocity:s=springDefaults.velocity,mass:a=springDefaults.mass}){let _,$;warning(e<=secondsToMilliseconds(springDefaults.maxDuration),"Spring duration must be 10 seconds or less","spring-duration-limit");let rt=1-i;rt=clamp$1(springDefaults.minDamping,springDefaults.maxDamping,rt),e=clamp$1(springDefaults.minDuration,springDefaults.maxDuration,millisecondsToSeconds(e)),rt<1?(_=ht=>{const Et=ht*rt,St=Et*e,At=Et-s,Pt=calcAngularFreq(ht,rt),Vt=Math.exp(-St);return safeMin-At/Pt*Vt},$=ht=>{const St=ht*rt*e,At=St*s+s,Pt=Math.pow(rt,2)*Math.pow(ht,2)*e,Vt=Math.exp(-St),Bt=calcAngularFreq(Math.pow(ht,2),rt);return(-_(ht)+safeMin>0?-1:1)*((At-Pt)*Vt)/Bt}):(_=ht=>{const Et=Math.exp(-ht*e),St=(ht-s)*e+1;return-safeMin+Et*St},$=ht=>{const Et=Math.exp(-ht*e),St=(s-ht)*(e*e);return Et*St});const c=5/e,dt=approximateRoot(_,$,c);if(e=secondsToMilliseconds(e),isNaN(dt))return{stiffness:springDefaults.stiffness,damping:springDefaults.damping,duration:e};{const ht=Math.pow(dt,2)*a;return{stiffness:ht,damping:rt*2*Math.sqrt(a*ht),duration:e}}}const rootIterations=12;function approximateRoot(e,i,s){let a=s;for(let _=1;_<rootIterations;_++)a=a-e(a)/i(a);return a}function calcAngularFreq(e,i){return e*Math.sqrt(1-i*i)}const durationKeys=["duration","bounce"],physicsKeys=["stiffness","damping","mass"];function isSpringType(e,i){return i.some(s=>e[s]!==void 0)}function getSpringOptions(e){let i={velocity:springDefaults.velocity,stiffness:springDefaults.stiffness,damping:springDefaults.damping,mass:springDefaults.mass,isResolvedFromDuration:!1,...e};if(!isSpringType(e,physicsKeys)&&isSpringType(e,durationKeys))if(e.visualDuration){const s=e.visualDuration,a=2*Math.PI/(s*1.2),_=a*a,$=2*clamp$1(.05,1,1-(e.bounce||0))*Math.sqrt(_);i={...i,mass:springDefaults.mass,stiffness:_,damping:$}}else{const s=findSpring(e);i={...i,...s,mass:springDefaults.mass},i.isResolvedFromDuration=!0}return i}function spring(e=springDefaults.visualDuration,i=springDefaults.bounce){const s=typeof e!="object"?{visualDuration:e,keyframes:[0,1],bounce:i}:e;let{restSpeed:a,restDelta:_}=s;const $=s.keyframes[0],rt=s.keyframes[s.keyframes.length-1],c={done:!1,value:$},{stiffness:dt,damping:ht,mass:Et,duration:St,velocity:At,isResolvedFromDuration:Pt}=getSpringOptions({...s,velocity:-millisecondsToSeconds(s.velocity||0)}),Vt=At||0,Bt=ht/(2*Math.sqrt(dt*Et)),Zt=rt-$,zt=millisecondsToSeconds(Math.sqrt(dt/Et)),Ut=Math.abs(Zt)<5;a||(a=Ut?springDefaults.restSpeed.granular:springDefaults.restSpeed.default),_||(_=Ut?springDefaults.restDelta.granular:springDefaults.restDelta.default);let Nt;if(Bt<1){const er=calcAngularFreq(zt,Bt);Nt=ir=>{const or=Math.exp(-Bt*zt*ir);return rt-or*((Vt+Bt*zt*Zt)/er*Math.sin(er*ir)+Zt*Math.cos(er*ir))}}else if(Bt===1)Nt=er=>rt-Math.exp(-zt*er)*(Zt+(Vt+zt*Zt)*er);else{const er=zt*Math.sqrt(Bt*Bt-1);Nt=ir=>{const or=Math.exp(-Bt*zt*ir),mr=Math.min(er*ir,300);return rt-or*((Vt+Bt*zt*Zt)*Math.sinh(mr)+er*Zt*Math.cosh(mr))/er}}const Gt={calculatedDuration:Pt&&St||null,next:er=>{const ir=Nt(er);if(Pt)c.done=er>=St;else{let or=er===0?Vt:0;Bt<1&&(or=er===0?secondsToMilliseconds(Vt):calcGeneratorVelocity(Nt,er,ir));const mr=Math.abs(or)<=a,Rr=Math.abs(rt-ir)<=_;c.done=mr&&Rr}return c.value=c.done?rt:ir,c},toString:()=>{const er=Math.min(calcGeneratorDuration(Gt),maxGeneratorDuration),ir=generateLinearEasing(or=>Gt.next(er*or).value,er,30);return er+"ms "+ir},toTransition:()=>{}};return Gt}spring.applyToOptions=e=>{const i=createGeneratorEasing(e,100,spring);return e.ease=i.ease,e.duration=secondsToMilliseconds(i.duration),e.type="keyframes",e};function inertia({keyframes:e,velocity:i=0,power:s=.8,timeConstant:a=325,bounceDamping:_=10,bounceStiffness:$=500,modifyTarget:rt,min:c,max:dt,restDelta:ht=.5,restSpeed:Et}){const St=e[0],At={done:!1,value:St},Pt=mr=>c!==void 0&&mr<c||dt!==void 0&&mr>dt,Vt=mr=>c===void 0?dt:dt===void 0||Math.abs(c-mr)<Math.abs(dt-mr)?c:dt;let Bt=s*i;const Zt=St+Bt,zt=rt===void 0?Zt:rt(Zt);zt!==Zt&&(Bt=zt-St);const Ut=mr=>-Bt*Math.exp(-mr/a),Nt=mr=>zt+Ut(mr),Gt=mr=>{const Rr=Ut(mr),on=Nt(mr);At.done=Math.abs(Rr)<=ht,At.value=At.done?zt:on};let er,ir;const or=mr=>{Pt(At.value)&&(er=mr,ir=spring({keyframes:[At.value,Vt(At.value)],velocity:calcGeneratorVelocity(Nt,mr,At.value),damping:_,stiffness:$,restDelta:ht,restSpeed:Et}))};return or(0),{calculatedDuration:null,next:mr=>{let Rr=!1;return!ir&&er===void 0&&(Rr=!0,Gt(mr),or(mr)),er!==void 0&&mr>=er?ir.next(mr-er):(!Rr&&Gt(mr),At)}}}function createMixers(e,i,s){const a=[],_=s||MotionGlobalConfig.mix||mix,$=e.length-1;for(let rt=0;rt<$;rt++){let c=_(e[rt],e[rt+1]);if(i){const dt=Array.isArray(i)?i[rt]||noop:i;c=pipe(dt,c)}a.push(c)}return a}function interpolate(e,i,{clamp:s=!0,ease:a,mixer:_}={}){const $=e.length;if(invariant($===i.length,"Both input and output ranges must be the same length","range-length"),$===1)return()=>i[0];if($===2&&i[0]===i[1])return()=>i[1];const rt=e[0]===e[1];e[0]>e[$-1]&&(e=[...e].reverse(),i=[...i].reverse());const c=createMixers(i,a,_),dt=c.length,ht=Et=>{if(rt&&Et<e[0])return i[0];let St=0;if(dt>1)for(;St<e.length-2&&!(Et<e[St+1]);St++);const At=progress(e[St],e[St+1],Et);return c[St](At)};return s?Et=>ht(clamp$1(e[0],e[$-1],Et)):ht}function fillOffset(e,i){const s=e[e.length-1];for(let a=1;a<=i;a++){const _=progress(0,i,a);e.push(mixNumber$1(s,1,_))}}function defaultOffset(e){const i=[0];return fillOffset(i,e.length-1),i}function convertOffsetToTimes(e,i){return e.map(s=>s*i)}function defaultEasing(e,i){return e.map(()=>i||easeInOut).splice(0,e.length-1)}function keyframes({duration:e=300,keyframes:i,times:s,ease:a="easeInOut"}){const _=isEasingArray(a)?a.map(easingDefinitionToFunction):easingDefinitionToFunction(a),$={done:!1,value:i[0]},rt=convertOffsetToTimes(s&&s.length===i.length?s:defaultOffset(i),e),c=interpolate(rt,i,{ease:Array.isArray(_)?_:defaultEasing(i,_)});return{calculatedDuration:e,next:dt=>($.value=c(dt),$.done=dt>=e,$)}}const isNotNull$1=e=>e!==null;function getFinalKeyframe$1(e,{repeat:i,repeatType:s="loop"},a,_=1){const $=e.filter(isNotNull$1),c=_<0||i&&s!=="loop"&&i%2===1?0:$.length-1;return!c||a===void 0?$[c]:a}const transitionTypeMap={decay:inertia,inertia,tween:keyframes,keyframes,spring};function replaceTransitionType(e){typeof e.type=="string"&&(e.type=transitionTypeMap[e.type])}class WithPromise{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(i=>{this.resolve=i})}notifyFinished(){this.resolve()}then(i,s){return this.finished.then(i,s)}}const percentToProgress=e=>e/100;class JSAnimation extends WithPromise{constructor(i){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{var a,_;const{motionValue:s}=this.options;s&&s.updatedAt!==time.now()&&this.tick(time.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),(_=(a=this.options).onStop)==null||_.call(a))},this.options=i,this.initAnimation(),this.play(),i.autoplay===!1&&this.pause()}initAnimation(){const{options:i}=this;replaceTransitionType(i);const{type:s=keyframes,repeat:a=0,repeatDelay:_=0,repeatType:$,velocity:rt=0}=i;let{keyframes:c}=i;const dt=s||keyframes;dt!==keyframes&&typeof c[0]!="number"&&(this.mixKeyframes=pipe(percentToProgress,mix(c[0],c[1])),c=[0,100]);const ht=dt({...i,keyframes:c});$==="mirror"&&(this.mirroredGenerator=dt({...i,keyframes:[...c].reverse(),velocity:-rt})),ht.calculatedDuration===null&&(ht.calculatedDuration=calcGeneratorDuration(ht));const{calculatedDuration:Et}=ht;this.calculatedDuration=Et,this.resolvedDuration=Et+_,this.totalDuration=this.resolvedDuration*(a+1)-_,this.generator=ht}updateTime(i){const s=Math.round(i-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=s}tick(i,s=!1){const{generator:a,totalDuration:_,mixKeyframes:$,mirroredGenerator:rt,resolvedDuration:c,calculatedDuration:dt}=this;if(this.startTime===null)return a.next(0);const{delay:ht=0,keyframes:Et,repeat:St,repeatType:At,repeatDelay:Pt,type:Vt,onUpdate:Bt,finalKeyframe:Zt}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,i):this.speed<0&&(this.startTime=Math.min(i-_/this.speed,this.startTime)),s?this.currentTime=i:this.updateTime(i);const zt=this.currentTime-ht*(this.playbackSpeed>=0?1:-1),Ut=this.playbackSpeed>=0?zt<0:zt>_;this.currentTime=Math.max(zt,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=_);let Nt=this.currentTime,Gt=a;if(St){const mr=Math.min(this.currentTime,_)/c;let Rr=Math.floor(mr),on=mr%1;!on&&mr>=1&&(on=1),on===1&&Rr--,Rr=Math.min(Rr,St+1),!!(Rr%2)&&(At==="reverse"?(on=1-on,Pt&&(on-=Pt/c)):At==="mirror"&&(Gt=rt)),Nt=clamp$1(0,1,on)*c}const er=Ut?{done:!1,value:Et[0]}:Gt.next(Nt);$&&(er.value=$(er.value));let{done:ir}=er;!Ut&&dt!==null&&(ir=this.playbackSpeed>=0?this.currentTime>=_:this.currentTime<=0);const or=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&ir);return or&&Vt!==inertia&&(er.value=getFinalKeyframe$1(Et,this.options,Zt,this.speed)),Bt&&Bt(er.value),or&&this.finish(),er}then(i,s){return this.finished.then(i,s)}get duration(){return millisecondsToSeconds(this.calculatedDuration)}get iterationDuration(){const{delay:i=0}=this.options||{};return this.duration+millisecondsToSeconds(i)}get time(){return millisecondsToSeconds(this.currentTime)}set time(i){var s;i=secondsToMilliseconds(i),this.currentTime=i,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=i:this.driver&&(this.startTime=this.driver.now()-i/this.playbackSpeed),(s=this.driver)==null||s.start(!1)}get speed(){return this.playbackSpeed}set speed(i){this.updateTime(time.now());const s=this.playbackSpeed!==i;this.playbackSpeed=i,s&&(this.time=millisecondsToSeconds(this.currentTime))}play(){var _,$;if(this.isStopped)return;const{driver:i=frameloopDriver,startTime:s}=this.options;this.driver||(this.driver=i(rt=>this.tick(rt))),($=(_=this.options).onPlay)==null||$.call(_);const a=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=a):this.holdTime!==null?this.startTime=a-this.holdTime:this.startTime||(this.startTime=s??a),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(time.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){var i,s;this.notifyFinished(),this.teardown(),this.state="finished",(s=(i=this.options).onComplete)==null||s.call(i)}cancel(){var i,s;this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),(s=(i=this.options).onCancel)==null||s.call(i)}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(i){return this.startTime=0,this.tick(i,!0)}attachTimeline(i){var s;return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),(s=this.driver)==null||s.stop(),i.observe(this)}}function fillWildcards(e){for(let i=1;i<e.length;i++)e[i]??(e[i]=e[i-1])}const radToDeg=e=>e*180/Math.PI,rotate=e=>{const i=radToDeg(Math.atan2(e[1],e[0]));return rebaseAngle(i)},matrix2dParsers={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:e=>(Math.abs(e[0])+Math.abs(e[3]))/2,rotate,rotateZ:rotate,skewX:e=>radToDeg(Math.atan(e[1])),skewY:e=>radToDeg(Math.atan(e[2])),skew:e=>(Math.abs(e[1])+Math.abs(e[2]))/2},rebaseAngle=e=>(e=e%360,e<0&&(e+=360),e),rotateZ=rotate,scaleX=e=>Math.sqrt(e[0]*e[0]+e[1]*e[1]),scaleY=e=>Math.sqrt(e[4]*e[4]+e[5]*e[5]),matrix3dParsers={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX,scaleY,scale:e=>(scaleX(e)+scaleY(e))/2,rotateX:e=>rebaseAngle(radToDeg(Math.atan2(e[6],e[5]))),rotateY:e=>rebaseAngle(radToDeg(Math.atan2(-e[2],e[0]))),rotateZ,rotate:rotateZ,skewX:e=>radToDeg(Math.atan(e[4])),skewY:e=>radToDeg(Math.atan(e[1])),skew:e=>(Math.abs(e[1])+Math.abs(e[4]))/2};function defaultTransformValue(e){return e.includes("scale")?1:0}function parseValueFromTransform(e,i){if(!e||e==="none")return defaultTransformValue(i);const s=e.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let a,_;if(s)a=matrix3dParsers,_=s;else{const c=e.match(/^matrix\(([-\d.e\s,]+)\)$/u);a=matrix2dParsers,_=c}if(!_)return defaultTransformValue(i);const $=a[i],rt=_[1].split(",").map(convertTransformToNumber);return typeof $=="function"?$(rt):rt[$]}const readTransformValue=(e,i)=>{const{transform:s="none"}=getComputedStyle(e);return parseValueFromTransform(s,i)};function convertTransformToNumber(e){return parseFloat(e.trim())}const transformPropOrder=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],transformProps=new Set(transformPropOrder),isNumOrPxType=e=>e===number||e===px,transformKeys=new Set(["x","y","z"]),nonTranslationalTransformKeys=transformPropOrder.filter(e=>!transformKeys.has(e));function removeNonTranslationalTransform(e){const i=[];return nonTranslationalTransformKeys.forEach(s=>{const a=e.getValue(s);a!==void 0&&(i.push([s,a.get()]),a.set(s.startsWith("scale")?1:0))}),i}const positionalValues={width:({x:e},{paddingLeft:i="0",paddingRight:s="0"})=>e.max-e.min-parseFloat(i)-parseFloat(s),height:({y:e},{paddingTop:i="0",paddingBottom:s="0"})=>e.max-e.min-parseFloat(i)-parseFloat(s),top:(e,{top:i})=>parseFloat(i),left:(e,{left:i})=>parseFloat(i),bottom:({y:e},{top:i})=>parseFloat(i)+(e.max-e.min),right:({x:e},{left:i})=>parseFloat(i)+(e.max-e.min),x:(e,{transform:i})=>parseValueFromTransform(i,"x"),y:(e,{transform:i})=>parseValueFromTransform(i,"y")};positionalValues.translateX=positionalValues.x;positionalValues.translateY=positionalValues.y;const toResolve=new Set;let isScheduled=!1,anyNeedsMeasurement=!1,isForced=!1;function measureAllKeyframes(){if(anyNeedsMeasurement){const e=Array.from(toResolve).filter(a=>a.needsMeasurement),i=new Set(e.map(a=>a.element)),s=new Map;i.forEach(a=>{const _=removeNonTranslationalTransform(a);_.length&&(s.set(a,_),a.render())}),e.forEach(a=>a.measureInitialState()),i.forEach(a=>{a.render();const _=s.get(a);_&&_.forEach(([$,rt])=>{var c;(c=a.getValue($))==null||c.set(rt)})}),e.forEach(a=>a.measureEndState()),e.forEach(a=>{a.suspendedScrollY!==void 0&&window.scrollTo(0,a.suspendedScrollY)})}anyNeedsMeasurement=!1,isScheduled=!1,toResolve.forEach(e=>e.complete(isForced)),toResolve.clear()}function readAllKeyframes(){toResolve.forEach(e=>{e.readKeyframes(),e.needsMeasurement&&(anyNeedsMeasurement=!0)})}function flushKeyframeResolvers(){isForced=!0,readAllKeyframes(),measureAllKeyframes(),isForced=!1}class KeyframeResolver{constructor(i,s,a,_,$,rt=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...i],this.onComplete=s,this.name=a,this.motionValue=_,this.element=$,this.isAsync=rt}scheduleResolve(){this.state="scheduled",this.isAsync?(toResolve.add(this),isScheduled||(isScheduled=!0,frame.read(readAllKeyframes),frame.resolveKeyframes(measureAllKeyframes))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:i,name:s,element:a,motionValue:_}=this;if(i[0]===null){const $=_==null?void 0:_.get(),rt=i[i.length-1];if($!==void 0)i[0]=$;else if(a&&s){const c=a.readValue(s,rt);c!=null&&(i[0]=c)}i[0]===void 0&&(i[0]=rt),_&&$===void 0&&_.set(i[0])}fillWildcards(i)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(i=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,i),toResolve.delete(this)}cancel(){this.state==="scheduled"&&(toResolve.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const isCSSVar=e=>e.startsWith("--");function setStyle(e,i,s){isCSSVar(i)?e.style.setProperty(i,s):e.style[i]=s}const supportsScrollTimeline=memo(()=>window.ScrollTimeline!==void 0),supportsFlags={};function memoSupports(e,i){const s=memo(e);return()=>supportsFlags[i]??s()}const supportsLinearEasing=memoSupports(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),cubicBezierAsString=([e,i,s,a])=>`cubic-bezier(${e}, ${i}, ${s}, ${a})`,supportedWaapiEasing={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:cubicBezierAsString([0,.65,.55,1]),circOut:cubicBezierAsString([.55,0,1,.45]),backIn:cubicBezierAsString([.31,.01,.66,-.59]),backOut:cubicBezierAsString([.33,1.53,.69,.99])};function mapEasingToNativeEasing(e,i){if(e)return typeof e=="function"?supportsLinearEasing()?generateLinearEasing(e,i):"ease-out":isBezierDefinition(e)?cubicBezierAsString(e):Array.isArray(e)?e.map(s=>mapEasingToNativeEasing(s,i)||supportedWaapiEasing.easeOut):supportedWaapiEasing[e]}function startWaapiAnimation(e,i,s,{delay:a=0,duration:_=300,repeat:$=0,repeatType:rt="loop",ease:c="easeOut",times:dt}={},ht=void 0){const Et={[i]:s};dt&&(Et.offset=dt);const St=mapEasingToNativeEasing(c,_);Array.isArray(St)&&(Et.easing=St);const At={delay:a,duration:_,easing:Array.isArray(St)?"linear":St,fill:"both",iterations:$+1,direction:rt==="reverse"?"alternate":"normal"};return ht&&(At.pseudoElement=ht),e.animate(Et,At)}function isGenerator(e){return typeof e=="function"&&"applyToOptions"in e}function applyGeneratorOptions({type:e,...i}){return isGenerator(e)&&supportsLinearEasing()?e.applyToOptions(i):(i.duration??(i.duration=300),i.ease??(i.ease="easeOut"),i)}class NativeAnimation extends WithPromise{constructor(i){if(super(),this.finishedTime=null,this.isStopped=!1,!i)return;const{element:s,name:a,keyframes:_,pseudoElement:$,allowFlatten:rt=!1,finalKeyframe:c,onComplete:dt}=i;this.isPseudoElement=!!$,this.allowFlatten=rt,this.options=i,invariant(typeof i.type!="string",`Mini animate() doesn't support "type" as a string.`,"mini-spring");const ht=applyGeneratorOptions(i);this.animation=startWaapiAnimation(s,a,_,ht,$),ht.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!$){const Et=getFinalKeyframe$1(_,this.options,c,this.speed);this.updateMotionValue?this.updateMotionValue(Et):setStyle(s,a,Et),this.animation.cancel()}dt==null||dt(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){var i,s;(s=(i=this.animation).finish)==null||s.call(i)}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:i}=this;i==="idle"||i==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){var i,s;this.isPseudoElement||(s=(i=this.animation).commitStyles)==null||s.call(i)}get duration(){var s,a;const i=((a=(s=this.animation.effect)==null?void 0:s.getComputedTiming)==null?void 0:a.call(s).duration)||0;return millisecondsToSeconds(Number(i))}get iterationDuration(){const{delay:i=0}=this.options||{};return this.duration+millisecondsToSeconds(i)}get time(){return millisecondsToSeconds(Number(this.animation.currentTime)||0)}set time(i){this.finishedTime=null,this.animation.currentTime=secondsToMilliseconds(i)}get speed(){return this.animation.playbackRate}set speed(i){i<0&&(this.finishedTime=null),this.animation.playbackRate=i}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(i){this.animation.startTime=i}attachTimeline({timeline:i,observe:s}){var a;return this.allowFlatten&&((a=this.animation.effect)==null||a.updateTiming({easing:"linear"})),this.animation.onfinish=null,i&&supportsScrollTimeline()?(this.animation.timeline=i,noop):s(this)}}const unsupportedEasingFunctions={anticipate,backInOut,circInOut};function isUnsupportedEase(e){return e in unsupportedEasingFunctions}function replaceStringEasing(e){typeof e.ease=="string"&&isUnsupportedEase(e.ease)&&(e.ease=unsupportedEasingFunctions[e.ease])}const sampleDelta=10;class NativeAnimationExtended extends NativeAnimation{constructor(i){replaceStringEasing(i),replaceTransitionType(i),super(i),i.startTime&&(this.startTime=i.startTime),this.options=i}updateMotionValue(i){const{motionValue:s,onUpdate:a,onComplete:_,element:$,...rt}=this.options;if(!s)return;if(i!==void 0){s.set(i);return}const c=new JSAnimation({...rt,autoplay:!1}),dt=secondsToMilliseconds(this.finishedTime??this.time);s.setWithVelocity(c.sample(dt-sampleDelta).value,c.sample(dt).value,sampleDelta),c.stop()}}const isAnimatable=(e,i)=>i==="zIndex"?!1:!!(typeof e=="number"||Array.isArray(e)||typeof e=="string"&&(complex.test(e)||e==="0")&&!e.startsWith("url("));function hasKeyframesChanged(e){const i=e[0];if(e.length===1)return!0;for(let s=0;s<e.length;s++)if(e[s]!==i)return!0}function canAnimate(e,i,s,a){const _=e[0];if(_===null)return!1;if(i==="display"||i==="visibility")return!0;const $=e[e.length-1],rt=isAnimatable(_,i),c=isAnimatable($,i);return warning(rt===c,`You are trying to animate ${i} from "${_}" to "${$}". "${rt?$:_}" is not an animatable value.`,"value-not-animatable"),!rt||!c?!1:hasKeyframesChanged(e)||(s==="spring"||isGenerator(s))&&a}function makeAnimationInstant(e){e.duration=0,e.type="keyframes"}const acceleratedValues=new Set(["opacity","clipPath","filter","transform"]),supportsWaapi=memo(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function supportsBrowserAnimation(e){var Et;const{motionValue:i,name:s,repeatDelay:a,repeatType:_,damping:$,type:rt}=e;if(!(((Et=i==null?void 0:i.owner)==null?void 0:Et.current)instanceof HTMLElement))return!1;const{onUpdate:dt,transformTemplate:ht}=i.owner.getProps();return supportsWaapi()&&s&&acceleratedValues.has(s)&&(s!=="transform"||!ht)&&!dt&&!a&&_!=="mirror"&&$!==0&&rt!=="inertia"}const MAX_RESOLVE_DELAY=40;class AsyncMotionValueAnimation extends WithPromise{constructor({autoplay:i=!0,delay:s=0,type:a="keyframes",repeat:_=0,repeatDelay:$=0,repeatType:rt="loop",keyframes:c,name:dt,motionValue:ht,element:Et,...St}){var Vt;super(),this.stop=()=>{var Bt,Zt;this._animation&&(this._animation.stop(),(Bt=this.stopTimeline)==null||Bt.call(this)),(Zt=this.keyframeResolver)==null||Zt.cancel()},this.createdAt=time.now();const At={autoplay:i,delay:s,type:a,repeat:_,repeatDelay:$,repeatType:rt,name:dt,motionValue:ht,element:Et,...St},Pt=(Et==null?void 0:Et.KeyframeResolver)||KeyframeResolver;this.keyframeResolver=new Pt(c,(Bt,Zt,zt)=>this.onKeyframesResolved(Bt,Zt,At,!zt),dt,ht,Et),(Vt=this.keyframeResolver)==null||Vt.scheduleResolve()}onKeyframesResolved(i,s,a,_){this.keyframeResolver=void 0;const{name:$,type:rt,velocity:c,delay:dt,isHandoff:ht,onUpdate:Et}=a;this.resolvedAt=time.now(),canAnimate(i,$,rt,c)||((MotionGlobalConfig.instantAnimations||!dt)&&(Et==null||Et(getFinalKeyframe$1(i,a,s))),i[0]=i[i.length-1],makeAnimationInstant(a),a.repeat=0);const At={startTime:_?this.resolvedAt?this.resolvedAt-this.createdAt>MAX_RESOLVE_DELAY?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:s,...a,keyframes:i},Pt=!ht&&supportsBrowserAnimation(At)?new NativeAnimationExtended({...At,element:At.motionValue.owner.current}):new JSAnimation(At);Pt.finished.then(()=>this.notifyFinished()).catch(noop),this.pendingTimeline&&(this.stopTimeline=Pt.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=Pt}get finished(){return this._animation?this.animation.finished:this._finished}then(i,s){return this.finished.finally(i).then(()=>{})}get animation(){var i;return this._animation||((i=this.keyframeResolver)==null||i.resume(),flushKeyframeResolvers()),this._animation}get duration(){return this.animation.duration}get iterationDuration(){return this.animation.iterationDuration}get time(){return this.animation.time}set time(i){this.animation.time=i}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(i){this.animation.speed=i}get startTime(){return this.animation.startTime}attachTimeline(i){return this._animation?this.stopTimeline=this.animation.attachTimeline(i):this.pendingTimeline=i,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){var i;this._animation&&this.animation.cancel(),(i=this.keyframeResolver)==null||i.cancel()}}const splitCSSVariableRegex=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function parseCSSVariable(e){const i=splitCSSVariableRegex.exec(e);if(!i)return[,];const[,s,a,_]=i;return[`--${s??a}`,_]}const maxDepth=4;function getVariableValue(e,i,s=1){invariant(s<=maxDepth,`Max CSS variable fallback depth detected in property "${e}". This may indicate a circular fallback dependency.`,"max-css-var-depth");const[a,_]=parseCSSVariable(e);if(!a)return;const $=window.getComputedStyle(i).getPropertyValue(a);if($){const rt=$.trim();return isNumericalString(rt)?parseFloat(rt):rt}return isCSSVariableToken(_)?getVariableValue(_,i,s+1):_}function getValueTransition(e,i){return(e==null?void 0:e[i])??(e==null?void 0:e.default)??e}const positionalKeys=new Set(["width","height","top","left","right","bottom",...transformPropOrder]),auto={test:e=>e==="auto",parse:e=>e},testValueType=e=>i=>i.test(e),dimensionValueTypes=[number,px,percent,degrees,vw,vh,auto],findDimensionValueType=e=>dimensionValueTypes.find(testValueType(e));function isNone(e){return typeof e=="number"?e===0:e!==null?e==="none"||e==="0"||isZeroValueString(e):!0}const maxDefaults=new Set(["brightness","contrast","saturate","opacity"]);function applyDefaultFilter(e){const[i,s]=e.slice(0,-1).split("(");if(i==="drop-shadow")return e;const[a]=s.match(floatRegex)||[];if(!a)return e;const _=s.replace(a,"");let $=maxDefaults.has(i)?1:0;return a!==s&&($*=100),i+"("+$+_+")"}const functionRegex=/\b([a-z-]*)\(.*?\)/gu,filter={...complex,getAnimatableNone:e=>{const i=e.match(functionRegex);return i?i.map(applyDefaultFilter).join(" "):e}},int={...number,transform:Math.round},transformValueTypes={rotate:degrees,rotateX:degrees,rotateY:degrees,rotateZ:degrees,scale,scaleX:scale,scaleY:scale,scaleZ:scale,skew:degrees,skewX:degrees,skewY:degrees,distance:px,translateX:px,translateY:px,translateZ:px,x:px,y:px,z:px,perspective:px,transformPerspective:px,opacity:alpha,originX:progressPercentage,originY:progressPercentage,originZ:px},numberValueTypes={borderWidth:px,borderTopWidth:px,borderRightWidth:px,borderBottomWidth:px,borderLeftWidth:px,borderRadius:px,radius:px,borderTopLeftRadius:px,borderTopRightRadius:px,borderBottomRightRadius:px,borderBottomLeftRadius:px,width:px,maxWidth:px,height:px,maxHeight:px,top:px,right:px,bottom:px,left:px,inset:px,insetBlock:px,insetBlockStart:px,insetBlockEnd:px,insetInline:px,insetInlineStart:px,insetInlineEnd:px,padding:px,paddingTop:px,paddingRight:px,paddingBottom:px,paddingLeft:px,paddingBlock:px,paddingBlockStart:px,paddingBlockEnd:px,paddingInline:px,paddingInlineStart:px,paddingInlineEnd:px,margin:px,marginTop:px,marginRight:px,marginBottom:px,marginLeft:px,marginBlock:px,marginBlockStart:px,marginBlockEnd:px,marginInline:px,marginInlineStart:px,marginInlineEnd:px,backgroundPositionX:px,backgroundPositionY:px,...transformValueTypes,zIndex:int,fillOpacity:alpha,strokeOpacity:alpha,numOctaves:int},defaultValueTypes={...numberValueTypes,color,backgroundColor:color,outlineColor:color,fill:color,stroke:color,borderColor:color,borderTopColor:color,borderRightColor:color,borderBottomColor:color,borderLeftColor:color,filter,WebkitFilter:filter},getDefaultValueType=e=>defaultValueTypes[e];function getAnimatableNone(e,i){let s=getDefaultValueType(e);return s!==filter&&(s=complex),s.getAnimatableNone?s.getAnimatableNone(i):void 0}const invalidTemplates=new Set(["auto","none","0"]);function makeNoneKeyframesAnimatable(e,i,s){let a=0,_;for(;a<e.length&&!_;){const $=e[a];typeof $=="string"&&!invalidTemplates.has($)&&analyseComplexValue($).values.length&&(_=e[a]),a++}if(_&&s)for(const $ of i)e[$]=getAnimatableNone(s,_)}class DOMKeyframesResolver extends KeyframeResolver{constructor(i,s,a,_,$){super(i,s,a,_,$,!0)}readKeyframes(){const{unresolvedKeyframes:i,element:s,name:a}=this;if(!s||!s.current)return;super.readKeyframes();for(let dt=0;dt<i.length;dt++){let ht=i[dt];if(typeof ht=="string"&&(ht=ht.trim(),isCSSVariableToken(ht))){const Et=getVariableValue(ht,s.current);Et!==void 0&&(i[dt]=Et),dt===i.length-1&&(this.finalKeyframe=ht)}}if(this.resolveNoneKeyframes(),!positionalKeys.has(a)||i.length!==2)return;const[_,$]=i,rt=findDimensionValueType(_),c=findDimensionValueType($);if(rt!==c)if(isNumOrPxType(rt)&&isNumOrPxType(c))for(let dt=0;dt<i.length;dt++){const ht=i[dt];typeof ht=="string"&&(i[dt]=parseFloat(ht))}else positionalValues[a]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:i,name:s}=this,a=[];for(let _=0;_<i.length;_++)(i[_]===null||isNone(i[_]))&&a.push(_);a.length&&makeNoneKeyframesAnimatable(i,a,s)}measureInitialState(){const{element:i,unresolvedKeyframes:s,name:a}=this;if(!i||!i.current)return;a==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=positionalValues[a](i.measureViewportBox(),window.getComputedStyle(i.current)),s[0]=this.measuredOrigin;const _=s[s.length-1];_!==void 0&&i.getValue(a,_).jump(_,!1)}measureEndState(){var c;const{element:i,name:s,unresolvedKeyframes:a}=this;if(!i||!i.current)return;const _=i.getValue(s);_&&_.jump(this.measuredOrigin,!1);const $=a.length-1,rt=a[$];a[$]=positionalValues[s](i.measureViewportBox(),window.getComputedStyle(i.current)),rt!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=rt),(c=this.removedTransforms)!=null&&c.length&&this.removedTransforms.forEach(([dt,ht])=>{i.getValue(dt).set(ht)}),this.resolveNoneKeyframes()}}function resolveElements(e,i,s){if(e instanceof EventTarget)return[e];if(typeof e=="string"){const _=document.querySelectorAll(e);return _?Array.from(_):[]}return Array.from(e)}const getValueAsType=(e,i)=>i&&typeof e=="number"?i.transform(e):e;function isHTMLElement(e){return isObject(e)&&"offsetHeight"in e}const MAX_VELOCITY_DELTA=30,isFloat=e=>!isNaN(parseFloat(e));class MotionValue{constructor(i,s={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=a=>{var $;const _=time.now();if(this.updatedAt!==_&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(a),this.current!==this.prev&&(($=this.events.change)==null||$.notify(this.current),this.dependents))for(const rt of this.dependents)rt.dirty()},this.hasAnimated=!1,this.setCurrent(i),this.owner=s.owner}setCurrent(i){this.current=i,this.updatedAt=time.now(),this.canTrackVelocity===null&&i!==void 0&&(this.canTrackVelocity=isFloat(this.current))}setPrevFrameValue(i=this.current){this.prevFrameValue=i,this.prevUpdatedAt=this.updatedAt}onChange(i){return this.on("change",i)}on(i,s){this.events[i]||(this.events[i]=new SubscriptionManager);const a=this.events[i].add(s);return i==="change"?()=>{a(),frame.read(()=>{this.events.change.getSize()||this.stop()})}:a}clearListeners(){for(const i in this.events)this.events[i].clear()}attach(i,s){this.passiveEffect=i,this.stopPassiveEffect=s}set(i){this.passiveEffect?this.passiveEffect(i,this.updateAndNotify):this.updateAndNotify(i)}setWithVelocity(i,s,a){this.set(s),this.prev=void 0,this.prevFrameValue=i,this.prevUpdatedAt=this.updatedAt-a}jump(i,s=!0){this.updateAndNotify(i),this.prev=i,this.prevUpdatedAt=this.prevFrameValue=void 0,s&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){var i;(i=this.events.change)==null||i.notify(this.current)}addDependent(i){this.dependents||(this.dependents=new Set),this.dependents.add(i)}removeDependent(i){this.dependents&&this.dependents.delete(i)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const i=time.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||i-this.updatedAt>MAX_VELOCITY_DELTA)return 0;const s=Math.min(this.updatedAt-this.prevUpdatedAt,MAX_VELOCITY_DELTA);return velocityPerSecond(parseFloat(this.current)-parseFloat(this.prevFrameValue),s)}start(i){return this.stop(),new Promise(s=>{this.hasAnimated=!0,this.animation=i(s),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){var i,s;(i=this.dependents)==null||i.clear(),(s=this.events.destroy)==null||s.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function motionValue(e,i){return new MotionValue(e,i)}const{schedule:microtask,cancel:cancelMicrotask}=createRenderBatcher(queueMicrotask,!1),isDragging={x:!1,y:!1};function isDragActive(){return isDragging.x||isDragging.y}function setDragLock(e){return e==="x"||e==="y"?isDragging[e]?null:(isDragging[e]=!0,()=>{isDragging[e]=!1}):isDragging.x||isDragging.y?null:(isDragging.x=isDragging.y=!0,()=>{isDragging.x=isDragging.y=!1})}function setupGesture(e,i){const s=resolveElements(e),a=new AbortController,_={passive:!0,...i,signal:a.signal};return[s,_,()=>a.abort()]}function isValidHover(e){return!(e.pointerType==="touch"||isDragActive())}function hover(e,i,s={}){const[a,_,$]=setupGesture(e,s),rt=c=>{if(!isValidHover(c))return;const{target:dt}=c,ht=i(dt,c);if(typeof ht!="function"||!dt)return;const Et=St=>{isValidHover(St)&&(ht(St),dt.removeEventListener("pointerleave",Et))};dt.addEventListener("pointerleave",Et,_)};return a.forEach(c=>{c.addEventListener("pointerenter",rt,_)}),$}const isNodeOrChild=(e,i)=>i?e===i?!0:isNodeOrChild(e,i.parentElement):!1,isPrimaryPointer=e=>e.pointerType==="mouse"?typeof e.button!="number"||e.button<=0:e.isPrimary!==!1,focusableElements=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function isElementKeyboardAccessible(e){return focusableElements.has(e.tagName)||e.tabIndex!==-1}const isPressing=new WeakSet;function filterEvents(e){return i=>{i.key==="Enter"&&e(i)}}function firePointerEvent(e,i){e.dispatchEvent(new PointerEvent("pointer"+i,{isPrimary:!0,bubbles:!0}))}const enableKeyboardPress=(e,i)=>{const s=e.currentTarget;if(!s)return;const a=filterEvents(()=>{if(isPressing.has(s))return;firePointerEvent(s,"down");const _=filterEvents(()=>{firePointerEvent(s,"up")}),$=()=>firePointerEvent(s,"cancel");s.addEventListener("keyup",_,i),s.addEventListener("blur",$,i)});s.addEventListener("keydown",a,i),s.addEventListener("blur",()=>s.removeEventListener("keydown",a),i)};function isValidPressEvent(e){return isPrimaryPointer(e)&&!isDragActive()}function press(e,i,s={}){const[a,_,$]=setupGesture(e,s),rt=c=>{const dt=c.currentTarget;if(!isValidPressEvent(c))return;isPressing.add(dt);const ht=i(dt,c),Et=(Pt,Vt)=>{window.removeEventListener("pointerup",St),window.removeEventListener("pointercancel",At),isPressing.has(dt)&&isPressing.delete(dt),isValidPressEvent(Pt)&&typeof ht=="function"&&ht(Pt,{success:Vt})},St=Pt=>{Et(Pt,dt===window||dt===document||s.useGlobalTarget||isNodeOrChild(dt,Pt.target))},At=Pt=>{Et(Pt,!1)};window.addEventListener("pointerup",St,_),window.addEventListener("pointercancel",At,_)};return a.forEach(c=>{(s.useGlobalTarget?window:c).addEventListener("pointerdown",rt,_),isHTMLElement(c)&&(c.addEventListener("focus",ht=>enableKeyboardPress(ht,_)),!isElementKeyboardAccessible(c)&&!c.hasAttribute("tabindex")&&(c.tabIndex=0))}),$}function isSVGElement(e){return isObject(e)&&"ownerSVGElement"in e}function isSVGSVGElement(e){return isSVGElement(e)&&e.tagName==="svg"}const isMotionValue=e=>!!(e&&e.getVelocity),valueTypes=[...dimensionValueTypes,color,complex],findValueType=e=>valueTypes.find(testValueType(e)),MotionConfigContext=reactExports.createContext({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"});function setRef$1(e,i){if(typeof e=="function")return e(i);e!=null&&(e.current=i)}function composeRefs(...e){return i=>{let s=!1;const a=e.map(_=>{const $=setRef$1(_,i);return!s&&typeof $=="function"&&(s=!0),$});if(s)return()=>{for(let _=0;_<a.length;_++){const $=a[_];typeof $=="function"?$():setRef$1(e[_],null)}}}}function useComposedRefs(...e){return reactExports.useCallback(composeRefs(...e),e)}class PopChildMeasure extends reactExports.Component{getSnapshotBeforeUpdate(i){const s=this.props.childRef.current;if(s&&i.isPresent&&!this.props.isPresent){const a=s.offsetParent,_=isHTMLElement(a)&&a.offsetWidth||0,$=this.props.sizeRef.current;$.height=s.offsetHeight||0,$.width=s.offsetWidth||0,$.top=s.offsetTop,$.left=s.offsetLeft,$.right=_-$.width-$.left}return null}componentDidUpdate(){}render(){return this.props.children}}function PopChild({children:e,isPresent:i,anchorX:s,root:a}){var Et;const _=reactExports.useId(),$=reactExports.useRef(null),rt=reactExports.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:c}=reactExports.useContext(MotionConfigContext),dt=((Et=e.props)==null?void 0:Et.ref)??(e==null?void 0:e.ref),ht=useComposedRefs($,dt);return reactExports.useInsertionEffect(()=>{const{width:St,height:At,top:Pt,left:Vt,right:Bt}=rt.current;if(i||!$.current||!St||!At)return;const Zt=s==="left"?`left: ${Vt}`:`right: ${Bt}`;$.current.dataset.motionPopId=_;const zt=document.createElement("style");c&&(zt.nonce=c);const Ut=a??document.head;return Ut.appendChild(zt),zt.sheet&&zt.sheet.insertRule(`
          [data-motion-pop-id="${_}"] {
            position: absolute !important;
            width: ${St}px !important;
            height: ${At}px !important;
            ${Zt}px !important;
            top: ${Pt}px !important;
          }
        `),()=>{Ut.contains(zt)&&Ut.removeChild(zt)}},[i]),jsxRuntimeExports.jsx(PopChildMeasure,{isPresent:i,childRef:$,sizeRef:rt,children:reactExports.cloneElement(e,{ref:ht})})}const PresenceChild=({children:e,initial:i,isPresent:s,onExitComplete:a,custom:_,presenceAffectsLayout:$,mode:rt,anchorX:c,root:dt})=>{const ht=useConstant(newChildrenMap),Et=reactExports.useId();let St=!0,At=reactExports.useMemo(()=>(St=!1,{id:Et,initial:i,isPresent:s,custom:_,onExitComplete:Pt=>{ht.set(Pt,!0);for(const Vt of ht.values())if(!Vt)return;a&&a()},register:Pt=>(ht.set(Pt,!1),()=>ht.delete(Pt))}),[s,ht,a]);return $&&St&&(At={...At}),reactExports.useMemo(()=>{ht.forEach((Pt,Vt)=>ht.set(Vt,!1))},[s]),reactExports.useEffect(()=>{!s&&!ht.size&&a&&a()},[s]),rt==="popLayout"&&(e=jsxRuntimeExports.jsx(PopChild,{isPresent:s,anchorX:c,root:dt,children:e})),jsxRuntimeExports.jsx(PresenceContext.Provider,{value:At,children:e})};function newChildrenMap(){return new Map}function usePresence(e=!0){const i=reactExports.useContext(PresenceContext);if(i===null)return[!0,null];const{isPresent:s,onExitComplete:a,register:_}=i,$=reactExports.useId();reactExports.useEffect(()=>{if(e)return _($)},[e]);const rt=reactExports.useCallback(()=>e&&a&&a($),[$,a,e]);return!s&&a?[!1,rt]:[!0]}const getChildKey=e=>e.key||"";function onlyElements(e){const i=[];return reactExports.Children.forEach(e,s=>{reactExports.isValidElement(s)&&i.push(s)}),i}const AnimatePresence=({children:e,custom:i,initial:s=!0,onExitComplete:a,presenceAffectsLayout:_=!0,mode:$="sync",propagate:rt=!1,anchorX:c="left",root:dt})=>{const[ht,Et]=usePresence(rt),St=reactExports.useMemo(()=>onlyElements(e),[e]),At=rt&&!ht?[]:St.map(getChildKey),Pt=reactExports.useRef(!0),Vt=reactExports.useRef(St),Bt=useConstant(()=>new Map),Zt=reactExports.useRef(new Set),[zt,Ut]=reactExports.useState(St),[Nt,Gt]=reactExports.useState(St);useIsomorphicLayoutEffect$1(()=>{Pt.current=!1,Vt.current=St;for(let or=0;or<Nt.length;or++){const mr=getChildKey(Nt[or]);At.includes(mr)?(Bt.delete(mr),Zt.current.delete(mr)):Bt.get(mr)!==!0&&Bt.set(mr,!1)}},[Nt,At.length,At.join("-")]);const er=[];if(St!==zt){let or=[...St];for(let mr=0;mr<Nt.length;mr++){const Rr=Nt[mr],on=getChildKey(Rr);At.includes(on)||(or.splice(mr,0,Rr),er.push(Rr))}return $==="wait"&&er.length&&(or=er),Gt(onlyElements(or)),Ut(St),null}const{forceRender:ir}=reactExports.useContext(LayoutGroupContext);return jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:Nt.map(or=>{const mr=getChildKey(or),Rr=rt&&!ht?!1:St===Nt||At.includes(mr),on=()=>{if(Zt.current.has(mr))return;if(Zt.current.add(mr),Bt.has(mr))Bt.set(mr,!0);else return;let un=!0;Bt.forEach(jr=>{jr||(un=!1)}),un&&(ir==null||ir(),Gt(Vt.current),rt&&(Et==null||Et()),a&&a())};return jsxRuntimeExports.jsx(PresenceChild,{isPresent:Rr,initial:!Pt.current||s?void 0:!1,custom:i,presenceAffectsLayout:_,mode:$,root:dt,onExitComplete:Rr?void 0:on,anchorX:c,children:or},mr)})})},LazyContext=reactExports.createContext({strict:!1}),featureProps={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},featureDefinitions={};for(const e in featureProps)featureDefinitions[e]={isEnabled:i=>featureProps[e].some(s=>!!i[s])};function loadFeatures(e){for(const i in e)featureDefinitions[i]={...featureDefinitions[i],...e[i]}}const validMotionProps=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function isValidMotionProp(e){return e.startsWith("while")||e.startsWith("drag")&&e!=="draggable"||e.startsWith("layout")||e.startsWith("onTap")||e.startsWith("onPan")||e.startsWith("onLayout")||validMotionProps.has(e)}let shouldForward=e=>!isValidMotionProp(e);function loadExternalIsValidProp(e){typeof e=="function"&&(shouldForward=i=>i.startsWith("on")?!isValidMotionProp(i):e(i))}try{loadExternalIsValidProp(require("@emotion/is-prop-valid").default)}catch{}function filterProps(e,i,s){const a={};for(const _ in e)_==="values"&&typeof e.values=="object"||(shouldForward(_)||s===!0&&isValidMotionProp(_)||!i&&!isValidMotionProp(_)||e.draggable&&_.startsWith("onDrag"))&&(a[_]=e[_]);return a}const MotionContext=reactExports.createContext({});function isAnimationControls(e){return e!==null&&typeof e=="object"&&typeof e.start=="function"}function isVariantLabel(e){return typeof e=="string"||Array.isArray(e)}const variantPriorityOrder=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],variantProps=["initial",...variantPriorityOrder];function isControllingVariants(e){return isAnimationControls(e.animate)||variantProps.some(i=>isVariantLabel(e[i]))}function isVariantNode(e){return!!(isControllingVariants(e)||e.variants)}function getCurrentTreeVariants(e,i){if(isControllingVariants(e)){const{initial:s,animate:a}=e;return{initial:s===!1||isVariantLabel(s)?s:void 0,animate:isVariantLabel(a)?a:void 0}}return e.inherit!==!1?i:{}}function useCreateMotionContext(e){const{initial:i,animate:s}=getCurrentTreeVariants(e,reactExports.useContext(MotionContext));return reactExports.useMemo(()=>({initial:i,animate:s}),[variantLabelsAsDependency(i),variantLabelsAsDependency(s)])}function variantLabelsAsDependency(e){return Array.isArray(e)?e.join(" "):e}function pixelsToPercent(e,i){return i.max===i.min?0:e/(i.max-i.min)*100}const correctBorderRadius={correct:(e,i)=>{if(!i.target)return e;if(typeof e=="string")if(px.test(e))e=parseFloat(e);else return e;const s=pixelsToPercent(e,i.target.x),a=pixelsToPercent(e,i.target.y);return`${s}% ${a}%`}},correctBoxShadow={correct:(e,{treeScale:i,projectionDelta:s})=>{const a=e,_=complex.parse(e);if(_.length>5)return a;const $=complex.createTransformer(e),rt=typeof _[0]!="number"?1:0,c=s.x.scale*i.x,dt=s.y.scale*i.y;_[0+rt]/=c,_[1+rt]/=dt;const ht=mixNumber$1(c,dt,.5);return typeof _[2+rt]=="number"&&(_[2+rt]/=ht),typeof _[3+rt]=="number"&&(_[3+rt]/=ht),$(_)}},scaleCorrectors={borderRadius:{...correctBorderRadius,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:correctBorderRadius,borderTopRightRadius:correctBorderRadius,borderBottomLeftRadius:correctBorderRadius,borderBottomRightRadius:correctBorderRadius,boxShadow:correctBoxShadow};function isForcedMotionValue(e,{layout:i,layoutId:s}){return transformProps.has(e)||e.startsWith("origin")||(i||s!==void 0)&&(!!scaleCorrectors[e]||e==="opacity")}const translateAlias={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},numTransforms=transformPropOrder.length;function buildTransform(e,i,s){let a="",_=!0;for(let $=0;$<numTransforms;$++){const rt=transformPropOrder[$],c=e[rt];if(c===void 0)continue;let dt=!0;if(typeof c=="number"?dt=c===(rt.startsWith("scale")?1:0):dt=parseFloat(c)===0,!dt||s){const ht=getValueAsType(c,numberValueTypes[rt]);if(!dt){_=!1;const Et=translateAlias[rt]||rt;a+=`${Et}(${ht}) `}s&&(i[rt]=ht)}}return a=a.trim(),s?a=s(i,_?"":a):_&&(a="none"),a}function buildHTMLStyles(e,i,s){const{style:a,vars:_,transformOrigin:$}=e;let rt=!1,c=!1;for(const dt in i){const ht=i[dt];if(transformProps.has(dt)){rt=!0;continue}else if(isCSSVariableName(dt)){_[dt]=ht;continue}else{const Et=getValueAsType(ht,numberValueTypes[dt]);dt.startsWith("origin")?(c=!0,$[dt]=Et):a[dt]=Et}}if(i.transform||(rt||s?a.transform=buildTransform(i,e.transform,s):a.transform&&(a.transform="none")),c){const{originX:dt="50%",originY:ht="50%",originZ:Et=0}=$;a.transformOrigin=`${dt} ${ht} ${Et}`}}const createHtmlRenderState=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function copyRawValuesOnly(e,i,s){for(const a in i)!isMotionValue(i[a])&&!isForcedMotionValue(a,s)&&(e[a]=i[a])}function useInitialMotionValues({transformTemplate:e},i){return reactExports.useMemo(()=>{const s=createHtmlRenderState();return buildHTMLStyles(s,i,e),Object.assign({},s.vars,s.style)},[i])}function useStyle(e,i){const s=e.style||{},a={};return copyRawValuesOnly(a,s,e),Object.assign(a,useInitialMotionValues(e,i)),a}function useHTMLProps(e,i){const s={},a=useStyle(e,i);return e.drag&&e.dragListener!==!1&&(s.draggable=!1,a.userSelect=a.WebkitUserSelect=a.WebkitTouchCallout="none",a.touchAction=e.drag===!0?"none":`pan-${e.drag==="x"?"y":"x"}`),e.tabIndex===void 0&&(e.onTap||e.onTapStart||e.whileTap)&&(s.tabIndex=0),s.style=a,s}const dashKeys={offset:"stroke-dashoffset",array:"stroke-dasharray"},camelKeys={offset:"strokeDashoffset",array:"strokeDasharray"};function buildSVGPath(e,i,s=1,a=0,_=!0){e.pathLength=1;const $=_?dashKeys:camelKeys;e[$.offset]=px.transform(-a);const rt=px.transform(i),c=px.transform(s);e[$.array]=`${rt} ${c}`}const cssMotionPathProperties=["offsetDistance","offsetPath","offsetRotate","offsetAnchor"];function buildSVGAttrs(e,{attrX:i,attrY:s,attrScale:a,pathLength:_,pathSpacing:$=1,pathOffset:rt=0,...c},dt,ht,Et){if(buildHTMLStyles(e,c,ht),dt){e.style.viewBox&&(e.attrs.viewBox=e.style.viewBox);return}e.attrs=e.style,e.style={};const{attrs:St,style:At}=e;St.transform&&(At.transform=St.transform,delete St.transform),(At.transform||St.transformOrigin)&&(At.transformOrigin=St.transformOrigin??"50% 50%",delete St.transformOrigin),At.transform&&(At.transformBox=(Et==null?void 0:Et.transformBox)??"fill-box",delete St.transformBox);for(const Pt of cssMotionPathProperties)St[Pt]!==void 0&&(At[Pt]=St[Pt],delete St[Pt]);i!==void 0&&(St.x=i),s!==void 0&&(St.y=s),a!==void 0&&(St.scale=a),_!==void 0&&buildSVGPath(St,_,$,rt,!1)}const createSvgRenderState=()=>({...createHtmlRenderState(),attrs:{}}),isSVGTag=e=>typeof e=="string"&&e.toLowerCase()==="svg";function useSVGProps(e,i,s,a){const _=reactExports.useMemo(()=>{const $=createSvgRenderState();return buildSVGAttrs($,i,isSVGTag(a),e.transformTemplate,e.style),{...$.attrs,style:{...$.style}}},[i]);if(e.style){const $={};copyRawValuesOnly($,e.style,e),_.style={...$,..._.style}}return _}const lowercaseSVGElements=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function isSVGComponent(e){return typeof e!="string"||e.includes("-")?!1:!!(lowercaseSVGElements.indexOf(e)>-1||/[A-Z]/u.test(e))}function useRender(e,i,s,{latestValues:a},_,$=!1,rt){const dt=(rt??isSVGComponent(e)?useSVGProps:useHTMLProps)(i,a,_,e),ht=filterProps(i,typeof e=="string",$),Et=e!==reactExports.Fragment?{...ht,...dt,ref:s}:{},{children:St}=i,At=reactExports.useMemo(()=>isMotionValue(St)?St.get():St,[St]);return reactExports.createElement(e,{...Et,children:At})}function getValueState(e){const i=[{},{}];return e==null||e.values.forEach((s,a)=>{i[0][a]=s.get(),i[1][a]=s.getVelocity()}),i}function resolveVariantFromProps(e,i,s,a){if(typeof i=="function"){const[_,$]=getValueState(a);i=i(s!==void 0?s:e.custom,_,$)}if(typeof i=="string"&&(i=e.variants&&e.variants[i]),typeof i=="function"){const[_,$]=getValueState(a);i=i(s!==void 0?s:e.custom,_,$)}return i}function resolveMotionValue(e){return isMotionValue(e)?e.get():e}function makeState({scrapeMotionValuesFromProps:e,createRenderState:i},s,a,_){return{latestValues:makeLatestValues(s,a,_,e),renderState:i()}}function makeLatestValues(e,i,s,a){const _={},$=a(e,{});for(const At in $)_[At]=resolveMotionValue($[At]);let{initial:rt,animate:c}=e;const dt=isControllingVariants(e),ht=isVariantNode(e);i&&ht&&!dt&&e.inherit!==!1&&(rt===void 0&&(rt=i.initial),c===void 0&&(c=i.animate));let Et=s?s.initial===!1:!1;Et=Et||rt===!1;const St=Et?c:rt;if(St&&typeof St!="boolean"&&!isAnimationControls(St)){const At=Array.isArray(St)?St:[St];for(let Pt=0;Pt<At.length;Pt++){const Vt=resolveVariantFromProps(e,At[Pt]);if(Vt){const{transitionEnd:Bt,transition:Zt,...zt}=Vt;for(const Ut in zt){let Nt=zt[Ut];if(Array.isArray(Nt)){const Gt=Et?Nt.length-1:0;Nt=Nt[Gt]}Nt!==null&&(_[Ut]=Nt)}for(const Ut in Bt)_[Ut]=Bt[Ut]}}}return _}const makeUseVisualState=e=>(i,s)=>{const a=reactExports.useContext(MotionContext),_=reactExports.useContext(PresenceContext),$=()=>makeState(e,i,a,_);return s?$():useConstant($)};function scrapeMotionValuesFromProps$1(e,i,s){var $;const{style:a}=e,_={};for(const rt in a)(isMotionValue(a[rt])||i.style&&isMotionValue(i.style[rt])||isForcedMotionValue(rt,e)||(($=s==null?void 0:s.getValue(rt))==null?void 0:$.liveStyle)!==void 0)&&(_[rt]=a[rt]);return _}const useHTMLVisualState=makeUseVisualState({scrapeMotionValuesFromProps:scrapeMotionValuesFromProps$1,createRenderState:createHtmlRenderState});function scrapeMotionValuesFromProps(e,i,s){const a=scrapeMotionValuesFromProps$1(e,i,s);for(const _ in e)if(isMotionValue(e[_])||isMotionValue(i[_])){const $=transformPropOrder.indexOf(_)!==-1?"attr"+_.charAt(0).toUpperCase()+_.substring(1):_;a[$]=e[_]}return a}const useSVGVisualState=makeUseVisualState({scrapeMotionValuesFromProps,createRenderState:createSvgRenderState}),motionComponentSymbol=Symbol.for("motionComponentSymbol");function isRefObject(e){return e&&typeof e=="object"&&Object.prototype.hasOwnProperty.call(e,"current")}function setRef(e,i){if(typeof e=="function")return e(i);isRefObject(e)&&(e.current=i)}function useMotionRef(e,i,s){const a=reactExports.useRef(null);return reactExports.useCallback(_=>{if(_&&e.onMount&&e.onMount(_),i&&(_?i.mount(_):i.unmount()),s)if(_){const $=setRef(s,_);typeof $=="function"&&(a.current=$)}else a.current?(a.current(),a.current=null):setRef(s,_)},[i,e,s])}const camelToDash=e=>e.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),optimizedAppearDataId="framerAppearId",optimizedAppearDataAttribute="data-"+camelToDash(optimizedAppearDataId),SwitchLayoutGroupContext=reactExports.createContext({});function useVisualElement(e,i,s,a,_,$){var Zt,zt;const{visualElement:rt}=reactExports.useContext(MotionContext),c=reactExports.useContext(LazyContext),dt=reactExports.useContext(PresenceContext),ht=reactExports.useContext(MotionConfigContext).reducedMotion,Et=reactExports.useRef(null);a=a||c.renderer,!Et.current&&a&&(Et.current=a(e,{visualState:i,parent:rt,props:s,presenceContext:dt,blockInitialAnimation:dt?dt.initial===!1:!1,reducedMotionConfig:ht,isSVG:$}));const St=Et.current,At=reactExports.useContext(SwitchLayoutGroupContext);St&&!St.projection&&_&&(St.type==="html"||St.type==="svg")&&createProjectionNode$1(Et.current,s,_,At);const Pt=reactExports.useRef(!1);reactExports.useInsertionEffect(()=>{St&&Pt.current&&St.update(s,dt)});const Vt=s[optimizedAppearDataAttribute],Bt=reactExports.useRef(!!Vt&&!((Zt=window.MotionHandoffIsComplete)!=null&&Zt.call(window,Vt))&&((zt=window.MotionHasOptimisedAnimation)==null?void 0:zt.call(window,Vt)));return useIsomorphicLayoutEffect$1(()=>{St&&(Pt.current=!0,window.MotionIsMounted=!0,St.updateFeatures(),St.scheduleRenderMicrotask(),Bt.current&&St.animationState&&St.animationState.animateChanges())}),reactExports.useEffect(()=>{St&&(!Bt.current&&St.animationState&&St.animationState.animateChanges(),Bt.current&&(queueMicrotask(()=>{var Ut;(Ut=window.MotionHandoffMarkAsComplete)==null||Ut.call(window,Vt)}),Bt.current=!1),St.enteringChildren=void 0)}),St}function createProjectionNode$1(e,i,s,a){const{layoutId:_,layout:$,drag:rt,dragConstraints:c,layoutScroll:dt,layoutRoot:ht,layoutCrossfade:Et}=i;e.projection=new s(e.latestValues,i["data-framer-portal-id"]?void 0:getClosestProjectingNode(e.parent)),e.projection.setOptions({layoutId:_,layout:$,alwaysMeasureLayout:!!rt||c&&isRefObject(c),visualElement:e,animationType:typeof $=="string"?$:"both",initialPromotionConfig:a,crossfade:Et,layoutScroll:dt,layoutRoot:ht})}function getClosestProjectingNode(e){if(e)return e.options.allowProjection!==!1?e.projection:getClosestProjectingNode(e.parent)}function createMotionComponent(e,{forwardMotionProps:i=!1,type:s}={},a,_){a&&loadFeatures(a);const $=s?s==="svg":isSVGComponent(e),rt=$?useSVGVisualState:useHTMLVisualState;function c(ht,Et){let St;const At={...reactExports.useContext(MotionConfigContext),...ht,layoutId:useLayoutId(ht)},{isStatic:Pt}=At,Vt=useCreateMotionContext(ht),Bt=rt(ht,Pt);if(!Pt&&isBrowser){useStrictMode();const Zt=getProjectionFunctionality(At);St=Zt.MeasureLayout,Vt.visualElement=useVisualElement(e,Bt,At,_,Zt.ProjectionNode,$)}return jsxRuntimeExports.jsxs(MotionContext.Provider,{value:Vt,children:[St&&Vt.visualElement?jsxRuntimeExports.jsx(St,{visualElement:Vt.visualElement,...At}):null,useRender(e,ht,useMotionRef(Bt,Vt.visualElement,Et),Bt,Pt,i,$)]})}c.displayName=`motion.${typeof e=="string"?e:`create(${e.displayName??e.name??""})`}`;const dt=reactExports.forwardRef(c);return dt[motionComponentSymbol]=e,dt}function useLayoutId({layoutId:e}){const i=reactExports.useContext(LayoutGroupContext).id;return i&&e!==void 0?i+"-"+e:e}function useStrictMode(e,i){reactExports.useContext(LazyContext).strict}function getProjectionFunctionality(e){const{drag:i,layout:s}=featureDefinitions;if(!i&&!s)return{};const a={...i,...s};return{MeasureLayout:i!=null&&i.isEnabled(e)||s!=null&&s.isEnabled(e)?a.MeasureLayout:void 0,ProjectionNode:a.ProjectionNode}}function createMotionProxy(e,i){if(typeof Proxy>"u")return createMotionComponent;const s=new Map,a=($,rt)=>createMotionComponent($,rt,e,i),_=($,rt)=>a($,rt);return new Proxy(_,{get:($,rt)=>rt==="create"?a:(s.has(rt)||s.set(rt,createMotionComponent(rt,void 0,e,i)),s.get(rt))})}function convertBoundingBoxToBox({top:e,left:i,right:s,bottom:a}){return{x:{min:i,max:s},y:{min:e,max:a}}}function convertBoxToBoundingBox({x:e,y:i}){return{top:i.min,right:e.max,bottom:i.max,left:e.min}}function transformBoxPoints(e,i){if(!i)return e;const s=i({x:e.left,y:e.top}),a=i({x:e.right,y:e.bottom});return{top:s.y,left:s.x,bottom:a.y,right:a.x}}function isIdentityScale(e){return e===void 0||e===1}function hasScale({scale:e,scaleX:i,scaleY:s}){return!isIdentityScale(e)||!isIdentityScale(i)||!isIdentityScale(s)}function hasTransform(e){return hasScale(e)||has2DTranslate(e)||e.z||e.rotate||e.rotateX||e.rotateY||e.skewX||e.skewY}function has2DTranslate(e){return is2DTranslate(e.x)||is2DTranslate(e.y)}function is2DTranslate(e){return e&&e!=="0%"}function scalePoint(e,i,s){const a=e-s,_=i*a;return s+_}function applyPointDelta(e,i,s,a,_){return _!==void 0&&(e=scalePoint(e,_,a)),scalePoint(e,s,a)+i}function applyAxisDelta(e,i=0,s=1,a,_){e.min=applyPointDelta(e.min,i,s,a,_),e.max=applyPointDelta(e.max,i,s,a,_)}function applyBoxDelta(e,{x:i,y:s}){applyAxisDelta(e.x,i.translate,i.scale,i.originPoint),applyAxisDelta(e.y,s.translate,s.scale,s.originPoint)}const TREE_SCALE_SNAP_MIN=.999999999999,TREE_SCALE_SNAP_MAX=1.0000000000001;function applyTreeDeltas(e,i,s,a=!1){const _=s.length;if(!_)return;i.x=i.y=1;let $,rt;for(let c=0;c<_;c++){$=s[c],rt=$.projectionDelta;const{visualElement:dt}=$.options;dt&&dt.props.style&&dt.props.style.display==="contents"||(a&&$.options.layoutScroll&&$.scroll&&$!==$.root&&transformBox(e,{x:-$.scroll.offset.x,y:-$.scroll.offset.y}),rt&&(i.x*=rt.x.scale,i.y*=rt.y.scale,applyBoxDelta(e,rt)),a&&hasTransform($.latestValues)&&transformBox(e,$.latestValues))}i.x<TREE_SCALE_SNAP_MAX&&i.x>TREE_SCALE_SNAP_MIN&&(i.x=1),i.y<TREE_SCALE_SNAP_MAX&&i.y>TREE_SCALE_SNAP_MIN&&(i.y=1)}function translateAxis(e,i){e.min=e.min+i,e.max=e.max+i}function transformAxis(e,i,s,a,_=.5){const $=mixNumber$1(e.min,e.max,_);applyAxisDelta(e,i,s,$,a)}function transformBox(e,i){transformAxis(e.x,i.x,i.scaleX,i.scale,i.originX),transformAxis(e.y,i.y,i.scaleY,i.scale,i.originY)}function measureViewportBox(e,i){return convertBoundingBoxToBox(transformBoxPoints(e.getBoundingClientRect(),i))}function measurePageBox(e,i,s){const a=measureViewportBox(e,s),{scroll:_}=i;return _&&(translateAxis(a.x,_.offset.x),translateAxis(a.y,_.offset.y)),a}const createAxisDelta=()=>({translate:0,scale:1,origin:0,originPoint:0}),createDelta=()=>({x:createAxisDelta(),y:createAxisDelta()}),createAxis=()=>({min:0,max:0}),createBox=()=>({x:createAxis(),y:createAxis()}),prefersReducedMotion={current:null},hasReducedMotionListener={current:!1};function initPrefersReducedMotion(){if(hasReducedMotionListener.current=!0,!!isBrowser)if(window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion)"),i=()=>prefersReducedMotion.current=e.matches;e.addEventListener("change",i),i()}else prefersReducedMotion.current=!1}const visualElementStore=new WeakMap;function updateMotionValuesFromProps(e,i,s){for(const a in i){const _=i[a],$=s[a];if(isMotionValue(_))e.addValue(a,_);else if(isMotionValue($))e.addValue(a,motionValue(_,{owner:e}));else if($!==_)if(e.hasValue(a)){const rt=e.getValue(a);rt.liveStyle===!0?rt.jump(_):rt.hasAnimated||rt.set(_)}else{const rt=e.getStaticValue(a);e.addValue(a,motionValue(rt!==void 0?rt:_,{owner:e}))}}for(const a in s)i[a]===void 0&&e.removeValue(a);return i}const propEventHandlers=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class VisualElement{scrapeMotionValuesFromProps(i,s,a){return{}}constructor({parent:i,props:s,presenceContext:a,reducedMotionConfig:_,blockInitialAnimation:$,visualState:rt},c={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=KeyframeResolver,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const At=time.now();this.renderScheduledAt<At&&(this.renderScheduledAt=At,frame.render(this.render,!1,!0))};const{latestValues:dt,renderState:ht}=rt;this.latestValues=dt,this.baseTarget={...dt},this.initialValues=s.initial?{...dt}:{},this.renderState=ht,this.parent=i,this.props=s,this.presenceContext=a,this.depth=i?i.depth+1:0,this.reducedMotionConfig=_,this.options=c,this.blockInitialAnimation=!!$,this.isControllingVariants=isControllingVariants(s),this.isVariantNode=isVariantNode(s),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(i&&i.current);const{willChange:Et,...St}=this.scrapeMotionValuesFromProps(s,{},this);for(const At in St){const Pt=St[At];dt[At]!==void 0&&isMotionValue(Pt)&&Pt.set(dt[At])}}mount(i){var s;this.current=i,visualElementStore.set(i,this),this.projection&&!this.projection.instance&&this.projection.mount(i),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((a,_)=>this.bindToMotionValue(_,a)),this.reducedMotionConfig==="never"?this.shouldReduceMotion=!1:this.reducedMotionConfig==="always"?this.shouldReduceMotion=!0:(hasReducedMotionListener.current||initPrefersReducedMotion(),this.shouldReduceMotion=prefersReducedMotion.current),(s=this.parent)==null||s.addChild(this),this.update(this.props,this.presenceContext)}unmount(){var i;this.projection&&this.projection.unmount(),cancelFrame(this.notifyUpdate),cancelFrame(this.render),this.valueSubscriptions.forEach(s=>s()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),(i=this.parent)==null||i.removeChild(this);for(const s in this.events)this.events[s].clear();for(const s in this.features){const a=this.features[s];a&&(a.unmount(),a.isMounted=!1)}this.current=null}addChild(i){this.children.add(i),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(i)}removeChild(i){this.children.delete(i),this.enteringChildren&&this.enteringChildren.delete(i)}bindToMotionValue(i,s){this.valueSubscriptions.has(i)&&this.valueSubscriptions.get(i)();const a=transformProps.has(i);a&&this.onBindTransform&&this.onBindTransform();const _=s.on("change",rt=>{this.latestValues[i]=rt,this.props.onUpdate&&frame.preRender(this.notifyUpdate),a&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let $;window.MotionCheckAppearSync&&($=window.MotionCheckAppearSync(this,i,s)),this.valueSubscriptions.set(i,()=>{_(),$&&$(),s.owner&&s.stop()})}sortNodePosition(i){return!this.current||!this.sortInstanceNodePosition||this.type!==i.type?0:this.sortInstanceNodePosition(this.current,i.current)}updateFeatures(){let i="animation";for(i in featureDefinitions){const s=featureDefinitions[i];if(!s)continue;const{isEnabled:a,Feature:_}=s;if(!this.features[i]&&_&&a(this.props)&&(this.features[i]=new _(this)),this.features[i]){const $=this.features[i];$.isMounted?$.update():($.mount(),$.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):createBox()}getStaticValue(i){return this.latestValues[i]}setStaticValue(i,s){this.latestValues[i]=s}update(i,s){(i.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=i,this.prevPresenceContext=this.presenceContext,this.presenceContext=s;for(let a=0;a<propEventHandlers.length;a++){const _=propEventHandlers[a];this.propEventSubscriptions[_]&&(this.propEventSubscriptions[_](),delete this.propEventSubscriptions[_]);const $="on"+_,rt=i[$];rt&&(this.propEventSubscriptions[_]=this.on(_,rt))}this.prevMotionValues=updateMotionValuesFromProps(this,this.scrapeMotionValuesFromProps(i,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(i){return this.props.variants?this.props.variants[i]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(i){const s=this.getClosestVariantNode();if(s)return s.variantChildren&&s.variantChildren.add(i),()=>s.variantChildren.delete(i)}addValue(i,s){const a=this.values.get(i);s!==a&&(a&&this.removeValue(i),this.bindToMotionValue(i,s),this.values.set(i,s),this.latestValues[i]=s.get())}removeValue(i){this.values.delete(i);const s=this.valueSubscriptions.get(i);s&&(s(),this.valueSubscriptions.delete(i)),delete this.latestValues[i],this.removeValueFromRenderState(i,this.renderState)}hasValue(i){return this.values.has(i)}getValue(i,s){if(this.props.values&&this.props.values[i])return this.props.values[i];let a=this.values.get(i);return a===void 0&&s!==void 0&&(a=motionValue(s===null?void 0:s,{owner:this}),this.addValue(i,a)),a}readValue(i,s){let a=this.latestValues[i]!==void 0||!this.current?this.latestValues[i]:this.getBaseTargetFromProps(this.props,i)??this.readValueFromInstance(this.current,i,this.options);return a!=null&&(typeof a=="string"&&(isNumericalString(a)||isZeroValueString(a))?a=parseFloat(a):!findValueType(a)&&complex.test(s)&&(a=getAnimatableNone(i,s)),this.setBaseTarget(i,isMotionValue(a)?a.get():a)),isMotionValue(a)?a.get():a}setBaseTarget(i,s){this.baseTarget[i]=s}getBaseTarget(i){var $;const{initial:s}=this.props;let a;if(typeof s=="string"||typeof s=="object"){const rt=resolveVariantFromProps(this.props,s,($=this.presenceContext)==null?void 0:$.custom);rt&&(a=rt[i])}if(s&&a!==void 0)return a;const _=this.getBaseTargetFromProps(this.props,i);return _!==void 0&&!isMotionValue(_)?_:this.initialValues[i]!==void 0&&a===void 0?void 0:this.baseTarget[i]}on(i,s){return this.events[i]||(this.events[i]=new SubscriptionManager),this.events[i].add(s)}notify(i,...s){this.events[i]&&this.events[i].notify(...s)}scheduleRenderMicrotask(){microtask.render(this.render)}}class DOMVisualElement extends VisualElement{constructor(){super(...arguments),this.KeyframeResolver=DOMKeyframesResolver}sortInstanceNodePosition(i,s){return i.compareDocumentPosition(s)&2?1:-1}getBaseTargetFromProps(i,s){return i.style?i.style[s]:void 0}removeValueFromRenderState(i,{vars:s,style:a}){delete s[i],delete a[i]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:i}=this.props;isMotionValue(i)&&(this.childSubscription=i.on("change",s=>{this.current&&(this.current.textContent=`${s}`)}))}}function renderHTML(e,{style:i,vars:s},a,_){const $=e.style;let rt;for(rt in i)$[rt]=i[rt];_==null||_.applyProjectionStyles($,a);for(rt in s)$.setProperty(rt,s[rt])}function getComputedStyle$1(e){return window.getComputedStyle(e)}class HTMLVisualElement extends DOMVisualElement{constructor(){super(...arguments),this.type="html",this.renderInstance=renderHTML}readValueFromInstance(i,s){var a;if(transformProps.has(s))return(a=this.projection)!=null&&a.isProjecting?defaultTransformValue(s):readTransformValue(i,s);{const _=getComputedStyle$1(i),$=(isCSSVariableName(s)?_.getPropertyValue(s):_[s])||0;return typeof $=="string"?$.trim():$}}measureInstanceViewportBox(i,{transformPagePoint:s}){return measureViewportBox(i,s)}build(i,s,a){buildHTMLStyles(i,s,a.transformTemplate)}scrapeMotionValuesFromProps(i,s,a){return scrapeMotionValuesFromProps$1(i,s,a)}}const camelCaseAttributes=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function renderSVG(e,i,s,a){renderHTML(e,i,void 0,a);for(const _ in i.attrs)e.setAttribute(camelCaseAttributes.has(_)?_:camelToDash(_),i.attrs[_])}class SVGVisualElement extends DOMVisualElement{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=createBox}getBaseTargetFromProps(i,s){return i[s]}readValueFromInstance(i,s){if(transformProps.has(s)){const a=getDefaultValueType(s);return a&&a.default||0}return s=camelCaseAttributes.has(s)?s:camelToDash(s),i.getAttribute(s)}scrapeMotionValuesFromProps(i,s,a){return scrapeMotionValuesFromProps(i,s,a)}build(i,s,a){buildSVGAttrs(i,s,this.isSVGTag,a.transformTemplate,a.style)}renderInstance(i,s,a,_){renderSVG(i,s,a,_)}mount(i){this.isSVGTag=isSVGTag(i.tagName),super.mount(i)}}const createDomVisualElement=(e,i)=>i.isSVG??isSVGComponent(e)?new SVGVisualElement(i):new HTMLVisualElement(i,{allowProjection:e!==reactExports.Fragment});function resolveVariant(e,i,s){const a=e.getProps();return resolveVariantFromProps(a,i,s!==void 0?s:a.custom,e)}const isKeyframesTarget=e=>Array.isArray(e);function setMotionValue(e,i,s){e.hasValue(i)?e.getValue(i).set(s):e.addValue(i,motionValue(s))}function resolveFinalValueInKeyframes(e){return isKeyframesTarget(e)?e[e.length-1]||0:e}function setTarget(e,i){const s=resolveVariant(e,i);let{transitionEnd:a={},transition:_={},...$}=s||{};$={...$,...a};for(const rt in $){const c=resolveFinalValueInKeyframes($[rt]);setMotionValue(e,rt,c)}}function isWillChangeMotionValue(e){return!!(isMotionValue(e)&&e.add)}function addValueToWillChange(e,i){const s=e.getValue("willChange");if(isWillChangeMotionValue(s))return s.add(i);if(!s&&MotionGlobalConfig.WillChange){const a=new MotionGlobalConfig.WillChange("auto");e.addValue("willChange",a),a.add(i)}}function getOptimisedAppearId(e){return e.props[optimizedAppearDataAttribute]}const isNotNull=e=>e!==null;function getFinalKeyframe(e,{repeat:i,repeatType:s="loop"},a){const _=e.filter(isNotNull),$=i&&s!=="loop"&&i%2===1?0:_.length-1;return!$||a===void 0?_[$]:a}const underDampedSpring={type:"spring",stiffness:500,damping:25,restSpeed:10},criticallyDampedSpring=e=>({type:"spring",stiffness:550,damping:e===0?2*Math.sqrt(550):30,restSpeed:10}),keyframesTransition={type:"keyframes",duration:.8},ease={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},getDefaultTransition=(e,{keyframes:i})=>i.length>2?keyframesTransition:transformProps.has(e)?e.startsWith("scale")?criticallyDampedSpring(i[1]):underDampedSpring:ease;function isTransitionDefined({when:e,delay:i,delayChildren:s,staggerChildren:a,staggerDirection:_,repeat:$,repeatType:rt,repeatDelay:c,from:dt,elapsed:ht,...Et}){return!!Object.keys(Et).length}const animateMotionValue=(e,i,s,a={},_,$)=>rt=>{const c=getValueTransition(a,e)||{},dt=c.delay||a.delay||0;let{elapsed:ht=0}=a;ht=ht-secondsToMilliseconds(dt);const Et={keyframes:Array.isArray(s)?s:[null,s],ease:"easeOut",velocity:i.getVelocity(),...c,delay:-ht,onUpdate:At=>{i.set(At),c.onUpdate&&c.onUpdate(At)},onComplete:()=>{rt(),c.onComplete&&c.onComplete()},name:e,motionValue:i,element:$?void 0:_};isTransitionDefined(c)||Object.assign(Et,getDefaultTransition(e,Et)),Et.duration&&(Et.duration=secondsToMilliseconds(Et.duration)),Et.repeatDelay&&(Et.repeatDelay=secondsToMilliseconds(Et.repeatDelay)),Et.from!==void 0&&(Et.keyframes[0]=Et.from);let St=!1;if((Et.type===!1||Et.duration===0&&!Et.repeatDelay)&&(makeAnimationInstant(Et),Et.delay===0&&(St=!0)),(MotionGlobalConfig.instantAnimations||MotionGlobalConfig.skipAnimations)&&(St=!0,makeAnimationInstant(Et),Et.delay=0),Et.allowFlatten=!c.type&&!c.ease,St&&!$&&i.get()!==void 0){const At=getFinalKeyframe(Et.keyframes,c);if(At!==void 0){frame.update(()=>{Et.onUpdate(At),Et.onComplete()});return}}return c.isSync?new JSAnimation(Et):new AsyncMotionValueAnimation(Et)};function shouldBlockAnimation({protectedKeys:e,needsAnimating:i},s){const a=e.hasOwnProperty(s)&&i[s]!==!0;return i[s]=!1,a}function animateTarget(e,i,{delay:s=0,transitionOverride:a,type:_}={}){let{transition:$=e.getDefaultTransition(),transitionEnd:rt,...c}=i;a&&($=a);const dt=[],ht=_&&e.animationState&&e.animationState.getState()[_];for(const Et in c){const St=e.getValue(Et,e.latestValues[Et]??null),At=c[Et];if(At===void 0||ht&&shouldBlockAnimation(ht,Et))continue;const Pt={delay:s,...getValueTransition($||{},Et)},Vt=St.get();if(Vt!==void 0&&!St.isAnimating&&!Array.isArray(At)&&At===Vt&&!Pt.velocity)continue;let Bt=!1;if(window.MotionHandoffAnimation){const zt=getOptimisedAppearId(e);if(zt){const Ut=window.MotionHandoffAnimation(zt,Et,frame);Ut!==null&&(Pt.startTime=Ut,Bt=!0)}}addValueToWillChange(e,Et),St.start(animateMotionValue(Et,St,At,e.shouldReduceMotion&&positionalKeys.has(Et)?{type:!1}:Pt,e,Bt));const Zt=St.animation;Zt&&dt.push(Zt)}return rt&&Promise.all(dt).then(()=>{frame.update(()=>{rt&&setTarget(e,rt)})}),dt}function calcChildStagger(e,i,s,a=0,_=1){const $=Array.from(e).sort((ht,Et)=>ht.sortNodePosition(Et)).indexOf(i),rt=e.size,c=(rt-1)*a;return typeof s=="function"?s($,rt):_===1?$*a:c-$*a}function animateVariant(e,i,s={}){var dt;const a=resolveVariant(e,i,s.type==="exit"?(dt=e.presenceContext)==null?void 0:dt.custom:void 0);let{transition:_=e.getDefaultTransition()||{}}=a||{};s.transitionOverride&&(_=s.transitionOverride);const $=a?()=>Promise.all(animateTarget(e,a,s)):()=>Promise.resolve(),rt=e.variantChildren&&e.variantChildren.size?(ht=0)=>{const{delayChildren:Et=0,staggerChildren:St,staggerDirection:At}=_;return animateChildren(e,i,ht,Et,St,At,s)}:()=>Promise.resolve(),{when:c}=_;if(c){const[ht,Et]=c==="beforeChildren"?[$,rt]:[rt,$];return ht().then(()=>Et())}else return Promise.all([$(),rt(s.delay)])}function animateChildren(e,i,s=0,a=0,_=0,$=1,rt){const c=[];for(const dt of e.variantChildren)dt.notify("AnimationStart",i),c.push(animateVariant(dt,i,{...rt,delay:s+(typeof a=="function"?0:a)+calcChildStagger(e.variantChildren,dt,a,_,$)}).then(()=>dt.notify("AnimationComplete",i)));return Promise.all(c)}function animateVisualElement(e,i,s={}){e.notify("AnimationStart",i);let a;if(Array.isArray(i)){const _=i.map($=>animateVariant(e,$,s));a=Promise.all(_)}else if(typeof i=="string")a=animateVariant(e,i,s);else{const _=typeof i=="function"?resolveVariant(e,i,s.custom):i;a=Promise.all(animateTarget(e,_,s))}return a.then(()=>{e.notify("AnimationComplete",i)})}function shallowCompare(e,i){if(!Array.isArray(i))return!1;const s=i.length;if(s!==e.length)return!1;for(let a=0;a<s;a++)if(i[a]!==e[a])return!1;return!0}const numVariantProps=variantProps.length;function getVariantContext(e){if(!e)return;if(!e.isControllingVariants){const s=e.parent?getVariantContext(e.parent)||{}:{};return e.props.initial!==void 0&&(s.initial=e.props.initial),s}const i={};for(let s=0;s<numVariantProps;s++){const a=variantProps[s],_=e.props[a];(isVariantLabel(_)||_===!1)&&(i[a]=_)}return i}const reversePriorityOrder=[...variantPriorityOrder].reverse(),numAnimationTypes=variantPriorityOrder.length;function animateList(e){return i=>Promise.all(i.map(({animation:s,options:a})=>animateVisualElement(e,s,a)))}function createAnimationState(e){let i=animateList(e),s=createState(),a=!0;const _=dt=>(ht,Et)=>{var At;const St=resolveVariant(e,Et,dt==="exit"?(At=e.presenceContext)==null?void 0:At.custom:void 0);if(St){const{transition:Pt,transitionEnd:Vt,...Bt}=St;ht={...ht,...Bt,...Vt}}return ht};function $(dt){i=dt(e)}function rt(dt){const{props:ht}=e,Et=getVariantContext(e.parent)||{},St=[],At=new Set;let Pt={},Vt=1/0;for(let Zt=0;Zt<numAnimationTypes;Zt++){const zt=reversePriorityOrder[Zt],Ut=s[zt],Nt=ht[zt]!==void 0?ht[zt]:Et[zt],Gt=isVariantLabel(Nt),er=zt===dt?Ut.isActive:null;er===!1&&(Vt=Zt);let ir=Nt===Et[zt]&&Nt!==ht[zt]&&Gt;if(ir&&a&&e.manuallyAnimateOnMount&&(ir=!1),Ut.protectedKeys={...Pt},!Ut.isActive&&er===null||!Nt&&!Ut.prevProp||isAnimationControls(Nt)||typeof Nt=="boolean")continue;const or=checkVariantsDidChange(Ut.prevProp,Nt);let mr=or||zt===dt&&Ut.isActive&&!ir&&Gt||Zt>Vt&&Gt,Rr=!1;const on=Array.isArray(Nt)?Nt:[Nt];let un=on.reduce(_(zt),{});er===!1&&(un={});const{prevResolvedValues:jr={}}=Ut,Jr={...jr,...un},fn=Sr=>{mr=!0,At.has(Sr)&&(Rr=!0,At.delete(Sr)),Ut.needsAnimating[Sr]=!0;const dr=e.getValue(Sr);dr&&(dr.liveStyle=!1)};for(const Sr in Jr){const dr=un[Sr],gr=jr[Sr];if(Pt.hasOwnProperty(Sr))continue;let qr=!1;isKeyframesTarget(dr)&&isKeyframesTarget(gr)?qr=!shallowCompare(dr,gr):qr=dr!==gr,qr?dr!=null?fn(Sr):At.add(Sr):dr!==void 0&&At.has(Sr)?fn(Sr):Ut.protectedKeys[Sr]=!0}Ut.prevProp=Nt,Ut.prevResolvedValues=un,Ut.isActive&&(Pt={...Pt,...un}),a&&e.blockInitialAnimation&&(mr=!1);const Fr=ir&&or;mr&&(!Fr||Rr)&&St.push(...on.map(Sr=>{const dr={type:zt};if(typeof Sr=="string"&&a&&!Fr&&e.manuallyAnimateOnMount&&e.parent){const{parent:gr}=e,qr=resolveVariant(gr,Sr);if(gr.enteringChildren&&qr){const{delayChildren:Lr}=qr.transition||{};dr.delay=calcChildStagger(gr.enteringChildren,e,Lr)}}return{animation:Sr,options:dr}}))}if(At.size){const Zt={};if(typeof ht.initial!="boolean"){const zt=resolveVariant(e,Array.isArray(ht.initial)?ht.initial[0]:ht.initial);zt&&zt.transition&&(Zt.transition=zt.transition)}At.forEach(zt=>{const Ut=e.getBaseTarget(zt),Nt=e.getValue(zt);Nt&&(Nt.liveStyle=!0),Zt[zt]=Ut??null}),St.push({animation:Zt})}let Bt=!!St.length;return a&&(ht.initial===!1||ht.initial===ht.animate)&&!e.manuallyAnimateOnMount&&(Bt=!1),a=!1,Bt?i(St):Promise.resolve()}function c(dt,ht){var St;if(s[dt].isActive===ht)return Promise.resolve();(St=e.variantChildren)==null||St.forEach(At=>{var Pt;return(Pt=At.animationState)==null?void 0:Pt.setActive(dt,ht)}),s[dt].isActive=ht;const Et=rt(dt);for(const At in s)s[At].protectedKeys={};return Et}return{animateChanges:rt,setActive:c,setAnimateFunction:$,getState:()=>s,reset:()=>{s=createState()}}}function checkVariantsDidChange(e,i){return typeof i=="string"?i!==e:Array.isArray(i)?!shallowCompare(i,e):!1}function createTypeState(e=!1){return{isActive:e,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function createState(){return{animate:createTypeState(!0),whileInView:createTypeState(),whileHover:createTypeState(),whileTap:createTypeState(),whileDrag:createTypeState(),whileFocus:createTypeState(),exit:createTypeState()}}let Feature$1=class{constructor(i){this.isMounted=!1,this.node=i}update(){}};class AnimationFeature extends Feature$1{constructor(i){super(i),i.animationState||(i.animationState=createAnimationState(i))}updateAnimationControlsSubscription(){const{animate:i}=this.node.getProps();isAnimationControls(i)&&(this.unmountControls=i.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:i}=this.node.getProps(),{animate:s}=this.node.prevProps||{};i!==s&&this.updateAnimationControlsSubscription()}unmount(){var i;this.node.animationState.reset(),(i=this.unmountControls)==null||i.call(this)}}let id$1=0;class ExitAnimationFeature extends Feature$1{constructor(){super(...arguments),this.id=id$1++}update(){if(!this.node.presenceContext)return;const{isPresent:i,onExitComplete:s}=this.node.presenceContext,{isPresent:a}=this.node.prevPresenceContext||{};if(!this.node.animationState||i===a)return;const _=this.node.animationState.setActive("exit",!i);s&&!i&&_.then(()=>{s(this.id)})}mount(){const{register:i,onExitComplete:s}=this.node.presenceContext||{};s&&s(this.id),i&&(this.unmount=i(this.id))}unmount(){}}const animations={animation:{Feature:AnimationFeature},exit:{Feature:ExitAnimationFeature}};function addDomEvent(e,i,s,a={passive:!0}){return e.addEventListener(i,s,a),()=>e.removeEventListener(i,s)}function extractEventInfo(e){return{point:{x:e.pageX,y:e.pageY}}}const addPointerInfo=e=>i=>isPrimaryPointer(i)&&e(i,extractEventInfo(i));function addPointerEvent(e,i,s,a){return addDomEvent(e,i,addPointerInfo(s),a)}const SCALE_PRECISION=1e-4,SCALE_MIN=1-SCALE_PRECISION,SCALE_MAX=1+SCALE_PRECISION,TRANSLATE_PRECISION=.01,TRANSLATE_MIN=0-TRANSLATE_PRECISION,TRANSLATE_MAX=0+TRANSLATE_PRECISION;function calcLength(e){return e.max-e.min}function isNear(e,i,s){return Math.abs(e-i)<=s}function calcAxisDelta(e,i,s,a=.5){e.origin=a,e.originPoint=mixNumber$1(i.min,i.max,e.origin),e.scale=calcLength(s)/calcLength(i),e.translate=mixNumber$1(s.min,s.max,e.origin)-e.originPoint,(e.scale>=SCALE_MIN&&e.scale<=SCALE_MAX||isNaN(e.scale))&&(e.scale=1),(e.translate>=TRANSLATE_MIN&&e.translate<=TRANSLATE_MAX||isNaN(e.translate))&&(e.translate=0)}function calcBoxDelta(e,i,s,a){calcAxisDelta(e.x,i.x,s.x,a?a.originX:void 0),calcAxisDelta(e.y,i.y,s.y,a?a.originY:void 0)}function calcRelativeAxis(e,i,s){e.min=s.min+i.min,e.max=e.min+calcLength(i)}function calcRelativeBox(e,i,s){calcRelativeAxis(e.x,i.x,s.x),calcRelativeAxis(e.y,i.y,s.y)}function calcRelativeAxisPosition(e,i,s){e.min=i.min-s.min,e.max=e.min+calcLength(i)}function calcRelativePosition(e,i,s){calcRelativeAxisPosition(e.x,i.x,s.x),calcRelativeAxisPosition(e.y,i.y,s.y)}function eachAxis(e){return[e("x"),e("y")]}const getContextWindow=({current:e})=>e?e.ownerDocument.defaultView:null,distance=(e,i)=>Math.abs(e-i);function distance2D(e,i){const s=distance(e.x,i.x),a=distance(e.y,i.y);return Math.sqrt(s**2+a**2)}class PanSession{constructor(i,s,{transformPagePoint:a,contextWindow:_=window,dragSnapToOrigin:$=!1,distanceThreshold:rt=3}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const At=getPanInfo(this.lastMoveEventInfo,this.history),Pt=this.startEvent!==null,Vt=distance2D(At.offset,{x:0,y:0})>=this.distanceThreshold;if(!Pt&&!Vt)return;const{point:Bt}=At,{timestamp:Zt}=frameData;this.history.push({...Bt,timestamp:Zt});const{onStart:zt,onMove:Ut}=this.handlers;Pt||(zt&&zt(this.lastMoveEvent,At),this.startEvent=this.lastMoveEvent),Ut&&Ut(this.lastMoveEvent,At)},this.handlePointerMove=(At,Pt)=>{this.lastMoveEvent=At,this.lastMoveEventInfo=transformPoint(Pt,this.transformPagePoint),frame.update(this.updatePoint,!0)},this.handlePointerUp=(At,Pt)=>{this.end();const{onEnd:Vt,onSessionEnd:Bt,resumeAnimation:Zt}=this.handlers;if(this.dragSnapToOrigin&&Zt&&Zt(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const zt=getPanInfo(At.type==="pointercancel"?this.lastMoveEventInfo:transformPoint(Pt,this.transformPagePoint),this.history);this.startEvent&&Vt&&Vt(At,zt),Bt&&Bt(At,zt)},!isPrimaryPointer(i))return;this.dragSnapToOrigin=$,this.handlers=s,this.transformPagePoint=a,this.distanceThreshold=rt,this.contextWindow=_||window;const c=extractEventInfo(i),dt=transformPoint(c,this.transformPagePoint),{point:ht}=dt,{timestamp:Et}=frameData;this.history=[{...ht,timestamp:Et}];const{onSessionStart:St}=s;St&&St(i,getPanInfo(dt,this.history)),this.removeListeners=pipe(addPointerEvent(this.contextWindow,"pointermove",this.handlePointerMove),addPointerEvent(this.contextWindow,"pointerup",this.handlePointerUp),addPointerEvent(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(i){this.handlers=i}end(){this.removeListeners&&this.removeListeners(),cancelFrame(this.updatePoint)}}function transformPoint(e,i){return i?{point:i(e.point)}:e}function subtractPoint(e,i){return{x:e.x-i.x,y:e.y-i.y}}function getPanInfo({point:e},i){return{point:e,delta:subtractPoint(e,lastDevicePoint(i)),offset:subtractPoint(e,startDevicePoint(i)),velocity:getVelocity(i,.1)}}function startDevicePoint(e){return e[0]}function lastDevicePoint(e){return e[e.length-1]}function getVelocity(e,i){if(e.length<2)return{x:0,y:0};let s=e.length-1,a=null;const _=lastDevicePoint(e);for(;s>=0&&(a=e[s],!(_.timestamp-a.timestamp>secondsToMilliseconds(i)));)s--;if(!a)return{x:0,y:0};const $=millisecondsToSeconds(_.timestamp-a.timestamp);if($===0)return{x:0,y:0};const rt={x:(_.x-a.x)/$,y:(_.y-a.y)/$};return rt.x===1/0&&(rt.x=0),rt.y===1/0&&(rt.y=0),rt}function applyConstraints(e,{min:i,max:s},a){return i!==void 0&&e<i?e=a?mixNumber$1(i,e,a.min):Math.max(e,i):s!==void 0&&e>s&&(e=a?mixNumber$1(s,e,a.max):Math.min(e,s)),e}function calcRelativeAxisConstraints(e,i,s){return{min:i!==void 0?e.min+i:void 0,max:s!==void 0?e.max+s-(e.max-e.min):void 0}}function calcRelativeConstraints(e,{top:i,left:s,bottom:a,right:_}){return{x:calcRelativeAxisConstraints(e.x,s,_),y:calcRelativeAxisConstraints(e.y,i,a)}}function calcViewportAxisConstraints(e,i){let s=i.min-e.min,a=i.max-e.max;return i.max-i.min<e.max-e.min&&([s,a]=[a,s]),{min:s,max:a}}function calcViewportConstraints(e,i){return{x:calcViewportAxisConstraints(e.x,i.x),y:calcViewportAxisConstraints(e.y,i.y)}}function calcOrigin(e,i){let s=.5;const a=calcLength(e),_=calcLength(i);return _>a?s=progress(i.min,i.max-a,e.min):a>_&&(s=progress(e.min,e.max-_,i.min)),clamp$1(0,1,s)}function rebaseAxisConstraints(e,i){const s={};return i.min!==void 0&&(s.min=i.min-e.min),i.max!==void 0&&(s.max=i.max-e.min),s}const defaultElastic=.35;function resolveDragElastic(e=defaultElastic){return e===!1?e=0:e===!0&&(e=defaultElastic),{x:resolveAxisElastic(e,"left","right"),y:resolveAxisElastic(e,"top","bottom")}}function resolveAxisElastic(e,i,s){return{min:resolvePointElastic(e,i),max:resolvePointElastic(e,s)}}function resolvePointElastic(e,i){return typeof e=="number"?e:e[i]||0}const elementDragControls=new WeakMap;class VisualElementDragControls{constructor(i){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=createBox(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=i}start(i,{snapToCursor:s=!1,distanceThreshold:a}={}){const{presenceContext:_}=this.visualElement;if(_&&_.isPresent===!1)return;const $=St=>{const{dragSnapToOrigin:At}=this.getProps();At?this.pauseAnimation():this.stopAnimation(),s&&this.snapToCursor(extractEventInfo(St).point)},rt=(St,At)=>{const{drag:Pt,dragPropagation:Vt,onDragStart:Bt}=this.getProps();if(Pt&&!Vt&&(this.openDragLock&&this.openDragLock(),this.openDragLock=setDragLock(Pt),!this.openDragLock))return;this.latestPointerEvent=St,this.latestPanInfo=At,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),eachAxis(zt=>{let Ut=this.getAxisMotionValue(zt).get()||0;if(percent.test(Ut)){const{projection:Nt}=this.visualElement;if(Nt&&Nt.layout){const Gt=Nt.layout.layoutBox[zt];Gt&&(Ut=calcLength(Gt)*(parseFloat(Ut)/100))}}this.originPoint[zt]=Ut}),Bt&&frame.postRender(()=>Bt(St,At)),addValueToWillChange(this.visualElement,"transform");const{animationState:Zt}=this.visualElement;Zt&&Zt.setActive("whileDrag",!0)},c=(St,At)=>{this.latestPointerEvent=St,this.latestPanInfo=At;const{dragPropagation:Pt,dragDirectionLock:Vt,onDirectionLock:Bt,onDrag:Zt}=this.getProps();if(!Pt&&!this.openDragLock)return;const{offset:zt}=At;if(Vt&&this.currentDirection===null){this.currentDirection=getCurrentDirection(zt),this.currentDirection!==null&&Bt&&Bt(this.currentDirection);return}this.updateAxis("x",At.point,zt),this.updateAxis("y",At.point,zt),this.visualElement.render(),Zt&&Zt(St,At)},dt=(St,At)=>{this.latestPointerEvent=St,this.latestPanInfo=At,this.stop(St,At),this.latestPointerEvent=null,this.latestPanInfo=null},ht=()=>eachAxis(St=>{var At;return this.getAnimationState(St)==="paused"&&((At=this.getAxisMotionValue(St).animation)==null?void 0:At.play())}),{dragSnapToOrigin:Et}=this.getProps();this.panSession=new PanSession(i,{onSessionStart:$,onStart:rt,onMove:c,onSessionEnd:dt,resumeAnimation:ht},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:Et,distanceThreshold:a,contextWindow:getContextWindow(this.visualElement)})}stop(i,s){const a=i||this.latestPointerEvent,_=s||this.latestPanInfo,$=this.isDragging;if(this.cancel(),!$||!_||!a)return;const{velocity:rt}=_;this.startAnimation(rt);const{onDragEnd:c}=this.getProps();c&&frame.postRender(()=>c(a,_))}cancel(){this.isDragging=!1;const{projection:i,animationState:s}=this.visualElement;i&&(i.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:a}=this.getProps();!a&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),s&&s.setActive("whileDrag",!1)}updateAxis(i,s,a){const{drag:_}=this.getProps();if(!a||!shouldDrag(i,_,this.currentDirection))return;const $=this.getAxisMotionValue(i);let rt=this.originPoint[i]+a[i];this.constraints&&this.constraints[i]&&(rt=applyConstraints(rt,this.constraints[i],this.elastic[i])),$.set(rt)}resolveConstraints(){var $;const{dragConstraints:i,dragElastic:s}=this.getProps(),a=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):($=this.visualElement.projection)==null?void 0:$.layout,_=this.constraints;i&&isRefObject(i)?this.constraints||(this.constraints=this.resolveRefConstraints()):i&&a?this.constraints=calcRelativeConstraints(a.layoutBox,i):this.constraints=!1,this.elastic=resolveDragElastic(s),_!==this.constraints&&a&&this.constraints&&!this.hasMutatedConstraints&&eachAxis(rt=>{this.constraints!==!1&&this.getAxisMotionValue(rt)&&(this.constraints[rt]=rebaseAxisConstraints(a.layoutBox[rt],this.constraints[rt]))})}resolveRefConstraints(){const{dragConstraints:i,onMeasureDragConstraints:s}=this.getProps();if(!i||!isRefObject(i))return!1;const a=i.current;invariant(a!==null,"If `dragConstraints` is set as a React ref, that ref must be passed to another component's `ref` prop.","drag-constraints-ref");const{projection:_}=this.visualElement;if(!_||!_.layout)return!1;const $=measurePageBox(a,_.root,this.visualElement.getTransformPagePoint());let rt=calcViewportConstraints(_.layout.layoutBox,$);if(s){const c=s(convertBoxToBoundingBox(rt));this.hasMutatedConstraints=!!c,c&&(rt=convertBoundingBoxToBox(c))}return rt}startAnimation(i){const{drag:s,dragMomentum:a,dragElastic:_,dragTransition:$,dragSnapToOrigin:rt,onDragTransitionEnd:c}=this.getProps(),dt=this.constraints||{},ht=eachAxis(Et=>{if(!shouldDrag(Et,s,this.currentDirection))return;let St=dt&&dt[Et]||{};rt&&(St={min:0,max:0});const At=_?200:1e6,Pt=_?40:1e7,Vt={type:"inertia",velocity:a?i[Et]:0,bounceStiffness:At,bounceDamping:Pt,timeConstant:750,restDelta:1,restSpeed:10,...$,...St};return this.startAxisValueAnimation(Et,Vt)});return Promise.all(ht).then(c)}startAxisValueAnimation(i,s){const a=this.getAxisMotionValue(i);return addValueToWillChange(this.visualElement,i),a.start(animateMotionValue(i,a,0,s,this.visualElement,!1))}stopAnimation(){eachAxis(i=>this.getAxisMotionValue(i).stop())}pauseAnimation(){eachAxis(i=>{var s;return(s=this.getAxisMotionValue(i).animation)==null?void 0:s.pause()})}getAnimationState(i){var s;return(s=this.getAxisMotionValue(i).animation)==null?void 0:s.state}getAxisMotionValue(i){const s=`_drag${i.toUpperCase()}`,a=this.visualElement.getProps(),_=a[s];return _||this.visualElement.getValue(i,(a.initial?a.initial[i]:void 0)||0)}snapToCursor(i){eachAxis(s=>{const{drag:a}=this.getProps();if(!shouldDrag(s,a,this.currentDirection))return;const{projection:_}=this.visualElement,$=this.getAxisMotionValue(s);if(_&&_.layout){const{min:rt,max:c}=_.layout.layoutBox[s],dt=$.get()||0;$.set(i[s]-mixNumber$1(rt,c,.5)+dt)}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:i,dragConstraints:s}=this.getProps(),{projection:a}=this.visualElement;if(!isRefObject(s)||!a||!this.constraints)return;this.stopAnimation();const _={x:0,y:0};eachAxis(rt=>{const c=this.getAxisMotionValue(rt);if(c&&this.constraints!==!1){const dt=c.get();_[rt]=calcOrigin({min:dt,max:dt},this.constraints[rt])}});const{transformTemplate:$}=this.visualElement.getProps();this.visualElement.current.style.transform=$?$({},""):"none",a.root&&a.root.updateScroll(),a.updateLayout(),this.resolveConstraints(),eachAxis(rt=>{if(!shouldDrag(rt,i,null))return;const c=this.getAxisMotionValue(rt),{min:dt,max:ht}=this.constraints[rt];c.set(mixNumber$1(dt,ht,_[rt]))})}addListeners(){if(!this.visualElement.current)return;elementDragControls.set(this.visualElement,this);const i=this.visualElement.current,s=addPointerEvent(i,"pointerdown",dt=>{const{drag:ht,dragListener:Et=!0}=this.getProps();ht&&Et&&this.start(dt)}),a=()=>{const{dragConstraints:dt}=this.getProps();isRefObject(dt)&&dt.current&&(this.constraints=this.resolveRefConstraints())},{projection:_}=this.visualElement,$=_.addEventListener("measure",a);_&&!_.layout&&(_.root&&_.root.updateScroll(),_.updateLayout()),frame.read(a);const rt=addDomEvent(window,"resize",()=>this.scalePositionWithinConstraints()),c=_.addEventListener("didUpdate",({delta:dt,hasLayoutChanged:ht})=>{this.isDragging&&ht&&(eachAxis(Et=>{const St=this.getAxisMotionValue(Et);St&&(this.originPoint[Et]+=dt[Et].translate,St.set(St.get()+dt[Et].translate))}),this.visualElement.render())});return()=>{rt(),s(),$(),c&&c()}}getProps(){const i=this.visualElement.getProps(),{drag:s=!1,dragDirectionLock:a=!1,dragPropagation:_=!1,dragConstraints:$=!1,dragElastic:rt=defaultElastic,dragMomentum:c=!0}=i;return{...i,drag:s,dragDirectionLock:a,dragPropagation:_,dragConstraints:$,dragElastic:rt,dragMomentum:c}}}function shouldDrag(e,i,s){return(i===!0||i===e)&&(s===null||s===e)}function getCurrentDirection(e,i=10){let s=null;return Math.abs(e.y)>i?s="y":Math.abs(e.x)>i&&(s="x"),s}class DragGesture extends Feature$1{constructor(i){super(i),this.removeGroupControls=noop,this.removeListeners=noop,this.controls=new VisualElementDragControls(i)}mount(){const{dragControls:i}=this.node.getProps();i&&(this.removeGroupControls=i.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||noop}update(){const{dragControls:i}=this.node.getProps(),{dragControls:s}=this.node.prevProps||{};i!==s&&(this.removeGroupControls(),i&&(this.removeGroupControls=i.subscribe(this.controls)))}unmount(){this.removeGroupControls(),this.removeListeners()}}const asyncHandler=e=>(i,s)=>{e&&frame.postRender(()=>e(i,s))};class PanGesture extends Feature$1{constructor(){super(...arguments),this.removePointerDownListener=noop}onPointerDown(i){this.session=new PanSession(i,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:getContextWindow(this.node)})}createPanHandlers(){const{onPanSessionStart:i,onPanStart:s,onPan:a,onPanEnd:_}=this.node.getProps();return{onSessionStart:asyncHandler(i),onStart:asyncHandler(s),onMove:a,onEnd:($,rt)=>{delete this.session,_&&frame.postRender(()=>_($,rt))}}}mount(){this.removePointerDownListener=addPointerEvent(this.node.current,"pointerdown",i=>this.onPointerDown(i))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const globalProjectionState={hasAnimatedSinceResize:!0,hasEverUpdated:!1};let hasTakenAnySnapshot=!1;class MeasureLayoutWithContext extends reactExports.Component{componentDidMount(){const{visualElement:i,layoutGroup:s,switchLayoutGroup:a,layoutId:_}=this.props,{projection:$}=i;$&&(s.group&&s.group.add($),a&&a.register&&_&&a.register($),hasTakenAnySnapshot&&$.root.didUpdate(),$.addEventListener("animationComplete",()=>{this.safeToRemove()}),$.setOptions({...$.options,onExitComplete:()=>this.safeToRemove()})),globalProjectionState.hasEverUpdated=!0}getSnapshotBeforeUpdate(i){const{layoutDependency:s,visualElement:a,drag:_,isPresent:$}=this.props,{projection:rt}=a;return rt&&(rt.isPresent=$,hasTakenAnySnapshot=!0,_||i.layoutDependency!==s||s===void 0||i.isPresent!==$?rt.willUpdate():this.safeToRemove(),i.isPresent!==$&&($?rt.promote():rt.relegate()||frame.postRender(()=>{const c=rt.getStack();(!c||!c.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:i}=this.props.visualElement;i&&(i.root.didUpdate(),microtask.postRender(()=>{!i.currentAnimation&&i.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:i,layoutGroup:s,switchLayoutGroup:a}=this.props,{projection:_}=i;hasTakenAnySnapshot=!0,_&&(_.scheduleCheckAfterUnmount(),s&&s.group&&s.group.remove(_),a&&a.deregister&&a.deregister(_))}safeToRemove(){const{safeToRemove:i}=this.props;i&&i()}render(){return null}}function MeasureLayout(e){const[i,s]=usePresence(),a=reactExports.useContext(LayoutGroupContext);return jsxRuntimeExports.jsx(MeasureLayoutWithContext,{...e,layoutGroup:a,switchLayoutGroup:reactExports.useContext(SwitchLayoutGroupContext),isPresent:i,safeToRemove:s})}function animateSingleValue(e,i,s){const a=isMotionValue(e)?e:motionValue(e);return a.start(animateMotionValue("",a,i,s)),a.animation}const compareByDepth=(e,i)=>e.depth-i.depth;class FlatTree{constructor(){this.children=[],this.isDirty=!1}add(i){addUniqueItem(this.children,i),this.isDirty=!0}remove(i){removeItem(this.children,i),this.isDirty=!0}forEach(i){this.isDirty&&this.children.sort(compareByDepth),this.isDirty=!1,this.children.forEach(i)}}function delay(e,i){const s=time.now(),a=({timestamp:_})=>{const $=_-s;$>=i&&(cancelFrame(a),e($-i))};return frame.setup(a,!0),()=>cancelFrame(a)}const borders=["TopLeft","TopRight","BottomLeft","BottomRight"],numBorders=borders.length,asNumber=e=>typeof e=="string"?parseFloat(e):e,isPx=e=>typeof e=="number"||px.test(e);function mixValues(e,i,s,a,_,$){_?(e.opacity=mixNumber$1(0,s.opacity??1,easeCrossfadeIn(a)),e.opacityExit=mixNumber$1(i.opacity??1,0,easeCrossfadeOut(a))):$&&(e.opacity=mixNumber$1(i.opacity??1,s.opacity??1,a));for(let rt=0;rt<numBorders;rt++){const c=`border${borders[rt]}Radius`;let dt=getRadius(i,c),ht=getRadius(s,c);if(dt===void 0&&ht===void 0)continue;dt||(dt=0),ht||(ht=0),dt===0||ht===0||isPx(dt)===isPx(ht)?(e[c]=Math.max(mixNumber$1(asNumber(dt),asNumber(ht),a),0),(percent.test(ht)||percent.test(dt))&&(e[c]+="%")):e[c]=ht}(i.rotate||s.rotate)&&(e.rotate=mixNumber$1(i.rotate||0,s.rotate||0,a))}function getRadius(e,i){return e[i]!==void 0?e[i]:e.borderRadius}const easeCrossfadeIn=compress(0,.5,circOut),easeCrossfadeOut=compress(.5,.95,noop);function compress(e,i,s){return a=>a<e?0:a>i?1:s(progress(e,i,a))}function copyAxisInto(e,i){e.min=i.min,e.max=i.max}function copyBoxInto(e,i){copyAxisInto(e.x,i.x),copyAxisInto(e.y,i.y)}function copyAxisDeltaInto(e,i){e.translate=i.translate,e.scale=i.scale,e.originPoint=i.originPoint,e.origin=i.origin}function removePointDelta(e,i,s,a,_){return e-=i,e=scalePoint(e,1/s,a),_!==void 0&&(e=scalePoint(e,1/_,a)),e}function removeAxisDelta(e,i=0,s=1,a=.5,_,$=e,rt=e){if(percent.test(i)&&(i=parseFloat(i),i=mixNumber$1(rt.min,rt.max,i/100)-rt.min),typeof i!="number")return;let c=mixNumber$1($.min,$.max,a);e===$&&(c-=i),e.min=removePointDelta(e.min,i,s,c,_),e.max=removePointDelta(e.max,i,s,c,_)}function removeAxisTransforms(e,i,[s,a,_],$,rt){removeAxisDelta(e,i[s],i[a],i[_],i.scale,$,rt)}const xKeys=["x","scaleX","originX"],yKeys=["y","scaleY","originY"];function removeBoxTransforms(e,i,s,a){removeAxisTransforms(e.x,i,xKeys,s?s.x:void 0,a?a.x:void 0),removeAxisTransforms(e.y,i,yKeys,s?s.y:void 0,a?a.y:void 0)}function isAxisDeltaZero(e){return e.translate===0&&e.scale===1}function isDeltaZero(e){return isAxisDeltaZero(e.x)&&isAxisDeltaZero(e.y)}function axisEquals(e,i){return e.min===i.min&&e.max===i.max}function boxEquals(e,i){return axisEquals(e.x,i.x)&&axisEquals(e.y,i.y)}function axisEqualsRounded(e,i){return Math.round(e.min)===Math.round(i.min)&&Math.round(e.max)===Math.round(i.max)}function boxEqualsRounded(e,i){return axisEqualsRounded(e.x,i.x)&&axisEqualsRounded(e.y,i.y)}function aspectRatio(e){return calcLength(e.x)/calcLength(e.y)}function axisDeltaEquals(e,i){return e.translate===i.translate&&e.scale===i.scale&&e.originPoint===i.originPoint}class NodeStack{constructor(){this.members=[]}add(i){addUniqueItem(this.members,i),i.scheduleRender()}remove(i){if(removeItem(this.members,i),i===this.prevLead&&(this.prevLead=void 0),i===this.lead){const s=this.members[this.members.length-1];s&&this.promote(s)}}relegate(i){const s=this.members.findIndex(_=>i===_);if(s===0)return!1;let a;for(let _=s;_>=0;_--){const $=this.members[_];if($.isPresent!==!1){a=$;break}}return a?(this.promote(a),!0):!1}promote(i,s){const a=this.lead;if(i!==a&&(this.prevLead=a,this.lead=i,i.show(),a)){a.instance&&a.scheduleRender(),i.scheduleRender(),i.resumeFrom=a,s&&(i.resumeFrom.preserveOpacity=!0),a.snapshot&&(i.snapshot=a.snapshot,i.snapshot.latestValues=a.animationValues||a.latestValues),i.root&&i.root.isUpdating&&(i.isLayoutDirty=!0);const{crossfade:_}=i.options;_===!1&&a.hide()}}exitAnimationComplete(){this.members.forEach(i=>{const{options:s,resumingFrom:a}=i;s.onExitComplete&&s.onExitComplete(),a&&a.options.onExitComplete&&a.options.onExitComplete()})}scheduleRender(){this.members.forEach(i=>{i.instance&&i.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function buildProjectionTransform(e,i,s){let a="";const _=e.x.translate/i.x,$=e.y.translate/i.y,rt=(s==null?void 0:s.z)||0;if((_||$||rt)&&(a=`translate3d(${_}px, ${$}px, ${rt}px) `),(i.x!==1||i.y!==1)&&(a+=`scale(${1/i.x}, ${1/i.y}) `),s){const{transformPerspective:ht,rotate:Et,rotateX:St,rotateY:At,skewX:Pt,skewY:Vt}=s;ht&&(a=`perspective(${ht}px) ${a}`),Et&&(a+=`rotate(${Et}deg) `),St&&(a+=`rotateX(${St}deg) `),At&&(a+=`rotateY(${At}deg) `),Pt&&(a+=`skewX(${Pt}deg) `),Vt&&(a+=`skewY(${Vt}deg) `)}const c=e.x.scale*i.x,dt=e.y.scale*i.y;return(c!==1||dt!==1)&&(a+=`scale(${c}, ${dt})`),a||"none"}const transformAxes=["","X","Y","Z"],animationTarget=1e3;let id=0;function resetDistortingTransform(e,i,s,a){const{latestValues:_}=i;_[e]&&(s[e]=_[e],i.setStaticValue(e,0),a&&(a[e]=0))}function cancelTreeOptimisedTransformAnimations(e){if(e.hasCheckedOptimisedAppear=!0,e.root===e)return;const{visualElement:i}=e.options;if(!i)return;const s=getOptimisedAppearId(i);if(window.MotionHasOptimisedAnimation(s,"transform")){const{layout:_,layoutId:$}=e.options;window.MotionCancelOptimisedAnimation(s,"transform",frame,!(_||$))}const{parent:a}=e;a&&!a.hasCheckedOptimisedAppear&&cancelTreeOptimisedTransformAnimations(a)}function createProjectionNode({attachResizeListener:e,defaultParent:i,measureScroll:s,checkIsScrollRoot:a,resetTransform:_}){return class{constructor(rt={},c=i==null?void 0:i()){this.id=id++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.layoutVersion=0,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(propagateDirtyNodes),this.nodes.forEach(resolveTargetDelta),this.nodes.forEach(calcProjection),this.nodes.forEach(cleanDirtyNodes)},this.resolvedRelativeTargetAt=0,this.linkedParentVersion=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=rt,this.root=c?c.root||c:this,this.path=c?[...c.path,c]:[],this.parent=c,this.depth=c?c.depth+1:0;for(let dt=0;dt<this.path.length;dt++)this.path[dt].shouldResetTransform=!0;this.root===this&&(this.nodes=new FlatTree)}addEventListener(rt,c){return this.eventHandlers.has(rt)||this.eventHandlers.set(rt,new SubscriptionManager),this.eventHandlers.get(rt).add(c)}notifyListeners(rt,...c){const dt=this.eventHandlers.get(rt);dt&&dt.notify(...c)}hasListeners(rt){return this.eventHandlers.has(rt)}mount(rt){if(this.instance)return;this.isSVG=isSVGElement(rt)&&!isSVGSVGElement(rt),this.instance=rt;const{layoutId:c,layout:dt,visualElement:ht}=this.options;if(ht&&!ht.current&&ht.mount(rt),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(dt||c)&&(this.isLayoutDirty=!0),e){let Et,St=0;const At=()=>this.root.updateBlockedByResize=!1;frame.read(()=>{St=window.innerWidth}),e(rt,()=>{const Pt=window.innerWidth;Pt!==St&&(St=Pt,this.root.updateBlockedByResize=!0,Et&&Et(),Et=delay(At,250),globalProjectionState.hasAnimatedSinceResize&&(globalProjectionState.hasAnimatedSinceResize=!1,this.nodes.forEach(finishAnimation)))})}c&&this.root.registerSharedNode(c,this),this.options.animate!==!1&&ht&&(c||dt)&&this.addEventListener("didUpdate",({delta:Et,hasLayoutChanged:St,hasRelativeLayoutChanged:At,layout:Pt})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const Vt=this.options.transition||ht.getDefaultTransition()||defaultLayoutTransition,{onLayoutAnimationStart:Bt,onLayoutAnimationComplete:Zt}=ht.getProps(),zt=!this.targetLayout||!boxEqualsRounded(this.targetLayout,Pt),Ut=!St&&At;if(this.options.layoutRoot||this.resumeFrom||Ut||St&&(zt||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const Nt={...getValueTransition(Vt,"layout"),onPlay:Bt,onComplete:Zt};(ht.shouldReduceMotion||this.options.layoutRoot)&&(Nt.delay=0,Nt.type=!1),this.startAnimation(Nt),this.setAnimationOrigin(Et,Ut)}else St||finishAnimation(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=Pt})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const rt=this.getStack();rt&&rt.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),cancelFrame(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(resetSkewAndRotation),this.animationId++)}getTransformTemplate(){const{visualElement:rt}=this.options;return rt&&rt.getProps().transformTemplate}willUpdate(rt=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&cancelTreeOptimisedTransformAnimations(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let Et=0;Et<this.path.length;Et++){const St=this.path[Et];St.shouldResetTransform=!0,St.updateScroll("snapshot"),St.options.layoutRoot&&St.willUpdate(!1)}const{layoutId:c,layout:dt}=this.options;if(c===void 0&&!dt)return;const ht=this.getTransformTemplate();this.prevTransformTemplateValue=ht?ht(this.latestValues,""):void 0,this.updateSnapshot(),rt&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(clearMeasurements);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(clearIsLayoutDirty);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(resetTransformStyle),this.nodes.forEach(updateLayout),this.nodes.forEach(notifyLayoutUpdate)):this.nodes.forEach(clearIsLayoutDirty),this.clearAllSnapshots();const c=time.now();frameData.delta=clamp$1(0,1e3/60,c-frameData.timestamp),frameData.timestamp=c,frameData.isProcessing=!0,frameSteps.update.process(frameData),frameSteps.preRender.process(frameData),frameSteps.render.process(frameData),frameData.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,microtask.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(clearSnapshot),this.sharedNodes.forEach(removeLeadSnapshots)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,frame.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){frame.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!calcLength(this.snapshot.measuredBox.x)&&!calcLength(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let dt=0;dt<this.path.length;dt++)this.path[dt].updateScroll();const rt=this.layout;this.layout=this.measure(!1),this.layoutVersion++,this.layoutCorrected=createBox(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:c}=this.options;c&&c.notify("LayoutMeasure",this.layout.layoutBox,rt?rt.layoutBox:void 0)}updateScroll(rt="measure"){let c=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===rt&&(c=!1),c&&this.instance){const dt=a(this.instance);this.scroll={animationId:this.root.animationId,phase:rt,isRoot:dt,offset:s(this.instance),wasRoot:this.scroll?this.scroll.isRoot:dt}}}resetTransform(){if(!_)return;const rt=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,c=this.projectionDelta&&!isDeltaZero(this.projectionDelta),dt=this.getTransformTemplate(),ht=dt?dt(this.latestValues,""):void 0,Et=ht!==this.prevTransformTemplateValue;rt&&this.instance&&(c||hasTransform(this.latestValues)||Et)&&(_(this.instance,ht),this.shouldResetTransform=!1,this.scheduleRender())}measure(rt=!0){const c=this.measurePageBox();let dt=this.removeElementScroll(c);return rt&&(dt=this.removeTransform(dt)),roundBox(dt),{animationId:this.root.animationId,measuredBox:c,layoutBox:dt,latestValues:{},source:this.id}}measurePageBox(){var ht;const{visualElement:rt}=this.options;if(!rt)return createBox();const c=rt.measureViewportBox();if(!(((ht=this.scroll)==null?void 0:ht.wasRoot)||this.path.some(checkNodeWasScrollRoot))){const{scroll:Et}=this.root;Et&&(translateAxis(c.x,Et.offset.x),translateAxis(c.y,Et.offset.y))}return c}removeElementScroll(rt){var dt;const c=createBox();if(copyBoxInto(c,rt),(dt=this.scroll)!=null&&dt.wasRoot)return c;for(let ht=0;ht<this.path.length;ht++){const Et=this.path[ht],{scroll:St,options:At}=Et;Et!==this.root&&St&&At.layoutScroll&&(St.wasRoot&&copyBoxInto(c,rt),translateAxis(c.x,St.offset.x),translateAxis(c.y,St.offset.y))}return c}applyTransform(rt,c=!1){const dt=createBox();copyBoxInto(dt,rt);for(let ht=0;ht<this.path.length;ht++){const Et=this.path[ht];!c&&Et.options.layoutScroll&&Et.scroll&&Et!==Et.root&&transformBox(dt,{x:-Et.scroll.offset.x,y:-Et.scroll.offset.y}),hasTransform(Et.latestValues)&&transformBox(dt,Et.latestValues)}return hasTransform(this.latestValues)&&transformBox(dt,this.latestValues),dt}removeTransform(rt){const c=createBox();copyBoxInto(c,rt);for(let dt=0;dt<this.path.length;dt++){const ht=this.path[dt];if(!ht.instance||!hasTransform(ht.latestValues))continue;hasScale(ht.latestValues)&&ht.updateSnapshot();const Et=createBox(),St=ht.measurePageBox();copyBoxInto(Et,St),removeBoxTransforms(c,ht.latestValues,ht.snapshot?ht.snapshot.layoutBox:void 0,Et)}return hasTransform(this.latestValues)&&removeBoxTransforms(c,this.latestValues),c}setTargetDelta(rt){this.targetDelta=rt,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(rt){this.options={...this.options,...rt,crossfade:rt.crossfade!==void 0?rt.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==frameData.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(rt=!1){var Pt;const c=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=c.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=c.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=c.isSharedProjectionDirty);const dt=!!this.resumingFrom||this!==c;if(!(rt||dt&&this.isSharedProjectionDirty||this.isProjectionDirty||(Pt=this.parent)!=null&&Pt.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:Et,layoutId:St}=this.options;if(!this.layout||!(Et||St))return;this.resolvedRelativeTargetAt=frameData.timestamp;const At=this.getClosestProjectingParent();At&&this.linkedParentVersion!==At.layoutVersion&&!At.options.layoutRoot&&this.removeRelativeTarget(),!this.targetDelta&&!this.relativeTarget&&(At&&At.layout?this.createRelativeTarget(At,this.layout.layoutBox,At.layout.layoutBox):this.removeRelativeTarget()),!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=createBox(),this.targetWithTransforms=createBox()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),calcRelativeBox(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):copyBoxInto(this.target,this.layout.layoutBox),applyBoxDelta(this.target,this.targetDelta)):copyBoxInto(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget&&(this.attemptToResolveRelativeTarget=!1,At&&!!At.resumingFrom==!!this.resumingFrom&&!At.options.layoutScroll&&At.target&&this.animationProgress!==1?this.createRelativeTarget(At,this.target,At.target):this.relativeParent=this.relativeTarget=void 0))}getClosestProjectingParent(){if(!(!this.parent||hasScale(this.parent.latestValues)||has2DTranslate(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}createRelativeTarget(rt,c,dt){this.relativeParent=rt,this.linkedParentVersion=rt.layoutVersion,this.forceRelativeParentToResolveTarget(),this.relativeTarget=createBox(),this.relativeTargetOrigin=createBox(),calcRelativePosition(this.relativeTargetOrigin,c,dt),copyBoxInto(this.relativeTarget,this.relativeTargetOrigin)}removeRelativeTarget(){this.relativeParent=this.relativeTarget=void 0}calcProjection(){var Vt;const rt=this.getLead(),c=!!this.resumingFrom||this!==rt;let dt=!0;if((this.isProjectionDirty||(Vt=this.parent)!=null&&Vt.isProjectionDirty)&&(dt=!1),c&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(dt=!1),this.resolvedRelativeTargetAt===frameData.timestamp&&(dt=!1),dt)return;const{layout:ht,layoutId:Et}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(ht||Et))return;copyBoxInto(this.layoutCorrected,this.layout.layoutBox);const St=this.treeScale.x,At=this.treeScale.y;applyTreeDeltas(this.layoutCorrected,this.treeScale,this.path,c),rt.layout&&!rt.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(rt.target=rt.layout.layoutBox,rt.targetWithTransforms=createBox());const{target:Pt}=rt;if(!Pt){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(copyAxisDeltaInto(this.prevProjectionDelta.x,this.projectionDelta.x),copyAxisDeltaInto(this.prevProjectionDelta.y,this.projectionDelta.y)),calcBoxDelta(this.projectionDelta,this.layoutCorrected,Pt,this.latestValues),(this.treeScale.x!==St||this.treeScale.y!==At||!axisDeltaEquals(this.projectionDelta.x,this.prevProjectionDelta.x)||!axisDeltaEquals(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",Pt))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(rt=!0){var c;if((c=this.options.visualElement)==null||c.scheduleRender(),rt){const dt=this.getStack();dt&&dt.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=createDelta(),this.projectionDelta=createDelta(),this.projectionDeltaWithTransform=createDelta()}setAnimationOrigin(rt,c=!1){const dt=this.snapshot,ht=dt?dt.latestValues:{},Et={...this.latestValues},St=createDelta();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!c;const At=createBox(),Pt=dt?dt.source:void 0,Vt=this.layout?this.layout.source:void 0,Bt=Pt!==Vt,Zt=this.getStack(),zt=!Zt||Zt.members.length<=1,Ut=!!(Bt&&!zt&&this.options.crossfade===!0&&!this.path.some(hasOpacityCrossfade));this.animationProgress=0;let Nt;this.mixTargetDelta=Gt=>{const er=Gt/1e3;mixAxisDelta(St.x,rt.x,er),mixAxisDelta(St.y,rt.y,er),this.setTargetDelta(St),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(calcRelativePosition(At,this.layout.layoutBox,this.relativeParent.layout.layoutBox),mixBox(this.relativeTarget,this.relativeTargetOrigin,At,er),Nt&&boxEquals(this.relativeTarget,Nt)&&(this.isProjectionDirty=!1),Nt||(Nt=createBox()),copyBoxInto(Nt,this.relativeTarget)),Bt&&(this.animationValues=Et,mixValues(Et,ht,this.latestValues,er,Ut,zt)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=er},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(rt){var c,dt,ht;this.notifyListeners("animationStart"),(c=this.currentAnimation)==null||c.stop(),(ht=(dt=this.resumingFrom)==null?void 0:dt.currentAnimation)==null||ht.stop(),this.pendingAnimation&&(cancelFrame(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=frame.update(()=>{globalProjectionState.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=motionValue(0)),this.currentAnimation=animateSingleValue(this.motionValue,[0,1e3],{...rt,velocity:0,isSync:!0,onUpdate:Et=>{this.mixTargetDelta(Et),rt.onUpdate&&rt.onUpdate(Et)},onStop:()=>{},onComplete:()=>{rt.onComplete&&rt.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const rt=this.getStack();rt&&rt.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(animationTarget),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const rt=this.getLead();let{targetWithTransforms:c,target:dt,layout:ht,latestValues:Et}=rt;if(!(!c||!dt||!ht)){if(this!==rt&&this.layout&&ht&&shouldAnimatePositionOnly(this.options.animationType,this.layout.layoutBox,ht.layoutBox)){dt=this.target||createBox();const St=calcLength(this.layout.layoutBox.x);dt.x.min=rt.target.x.min,dt.x.max=dt.x.min+St;const At=calcLength(this.layout.layoutBox.y);dt.y.min=rt.target.y.min,dt.y.max=dt.y.min+At}copyBoxInto(c,dt),transformBox(c,Et),calcBoxDelta(this.projectionDeltaWithTransform,this.layoutCorrected,c,Et)}}registerSharedNode(rt,c){this.sharedNodes.has(rt)||this.sharedNodes.set(rt,new NodeStack),this.sharedNodes.get(rt).add(c);const ht=c.options.initialPromotionConfig;c.promote({transition:ht?ht.transition:void 0,preserveFollowOpacity:ht&&ht.shouldPreserveFollowOpacity?ht.shouldPreserveFollowOpacity(c):void 0})}isLead(){const rt=this.getStack();return rt?rt.lead===this:!0}getLead(){var c;const{layoutId:rt}=this.options;return rt?((c=this.getStack())==null?void 0:c.lead)||this:this}getPrevLead(){var c;const{layoutId:rt}=this.options;return rt?(c=this.getStack())==null?void 0:c.prevLead:void 0}getStack(){const{layoutId:rt}=this.options;if(rt)return this.root.sharedNodes.get(rt)}promote({needsReset:rt,transition:c,preserveFollowOpacity:dt}={}){const ht=this.getStack();ht&&ht.promote(this,dt),rt&&(this.projectionDelta=void 0,this.needsReset=!0),c&&this.setOptions({transition:c})}relegate(){const rt=this.getStack();return rt?rt.relegate(this):!1}resetSkewAndRotation(){const{visualElement:rt}=this.options;if(!rt)return;let c=!1;const{latestValues:dt}=rt;if((dt.z||dt.rotate||dt.rotateX||dt.rotateY||dt.rotateZ||dt.skewX||dt.skewY)&&(c=!0),!c)return;const ht={};dt.z&&resetDistortingTransform("z",rt,ht,this.animationValues);for(let Et=0;Et<transformAxes.length;Et++)resetDistortingTransform(`rotate${transformAxes[Et]}`,rt,ht,this.animationValues),resetDistortingTransform(`skew${transformAxes[Et]}`,rt,ht,this.animationValues);rt.render();for(const Et in ht)rt.setStaticValue(Et,ht[Et]),this.animationValues&&(this.animationValues[Et]=ht[Et]);rt.scheduleRender()}applyProjectionStyles(rt,c){if(!this.instance||this.isSVG)return;if(!this.isVisible){rt.visibility="hidden";return}const dt=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,rt.visibility="",rt.opacity="",rt.pointerEvents=resolveMotionValue(c==null?void 0:c.pointerEvents)||"",rt.transform=dt?dt(this.latestValues,""):"none";return}const ht=this.getLead();if(!this.projectionDelta||!this.layout||!ht.target){this.options.layoutId&&(rt.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,rt.pointerEvents=resolveMotionValue(c==null?void 0:c.pointerEvents)||""),this.hasProjected&&!hasTransform(this.latestValues)&&(rt.transform=dt?dt({},""):"none",this.hasProjected=!1);return}rt.visibility="";const Et=ht.animationValues||ht.latestValues;this.applyTransformsToTarget();let St=buildProjectionTransform(this.projectionDeltaWithTransform,this.treeScale,Et);dt&&(St=dt(Et,St)),rt.transform=St;const{x:At,y:Pt}=this.projectionDelta;rt.transformOrigin=`${At.origin*100}% ${Pt.origin*100}% 0`,ht.animationValues?rt.opacity=ht===this?Et.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:Et.opacityExit:rt.opacity=ht===this?Et.opacity!==void 0?Et.opacity:"":Et.opacityExit!==void 0?Et.opacityExit:0;for(const Vt in scaleCorrectors){if(Et[Vt]===void 0)continue;const{correct:Bt,applyTo:Zt,isCSSVariable:zt}=scaleCorrectors[Vt],Ut=St==="none"?Et[Vt]:Bt(Et[Vt],ht);if(Zt){const Nt=Zt.length;for(let Gt=0;Gt<Nt;Gt++)rt[Zt[Gt]]=Ut}else zt?this.options.visualElement.renderState.vars[Vt]=Ut:rt[Vt]=Ut}this.options.layoutId&&(rt.pointerEvents=ht===this?resolveMotionValue(c==null?void 0:c.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(rt=>{var c;return(c=rt.currentAnimation)==null?void 0:c.stop()}),this.root.nodes.forEach(clearMeasurements),this.root.sharedNodes.clear()}}}function updateLayout(e){e.updateLayout()}function notifyLayoutUpdate(e){var s;const i=((s=e.resumeFrom)==null?void 0:s.snapshot)||e.snapshot;if(e.isLead()&&e.layout&&i&&e.hasListeners("didUpdate")){const{layoutBox:a,measuredBox:_}=e.layout,{animationType:$}=e.options,rt=i.source!==e.layout.source;$==="size"?eachAxis(St=>{const At=rt?i.measuredBox[St]:i.layoutBox[St],Pt=calcLength(At);At.min=a[St].min,At.max=At.min+Pt}):shouldAnimatePositionOnly($,i.layoutBox,a)&&eachAxis(St=>{const At=rt?i.measuredBox[St]:i.layoutBox[St],Pt=calcLength(a[St]);At.max=At.min+Pt,e.relativeTarget&&!e.currentAnimation&&(e.isProjectionDirty=!0,e.relativeTarget[St].max=e.relativeTarget[St].min+Pt)});const c=createDelta();calcBoxDelta(c,a,i.layoutBox);const dt=createDelta();rt?calcBoxDelta(dt,e.applyTransform(_,!0),i.measuredBox):calcBoxDelta(dt,a,i.layoutBox);const ht=!isDeltaZero(c);let Et=!1;if(!e.resumeFrom){const St=e.getClosestProjectingParent();if(St&&!St.resumeFrom){const{snapshot:At,layout:Pt}=St;if(At&&Pt){const Vt=createBox();calcRelativePosition(Vt,i.layoutBox,At.layoutBox);const Bt=createBox();calcRelativePosition(Bt,a,Pt.layoutBox),boxEqualsRounded(Vt,Bt)||(Et=!0),St.options.layoutRoot&&(e.relativeTarget=Bt,e.relativeTargetOrigin=Vt,e.relativeParent=St)}}}e.notifyListeners("didUpdate",{layout:a,snapshot:i,delta:dt,layoutDelta:c,hasLayoutChanged:ht,hasRelativeLayoutChanged:Et})}else if(e.isLead()){const{onExitComplete:a}=e.options;a&&a()}e.options.transition=void 0}function propagateDirtyNodes(e){e.parent&&(e.isProjecting()||(e.isProjectionDirty=e.parent.isProjectionDirty),e.isSharedProjectionDirty||(e.isSharedProjectionDirty=!!(e.isProjectionDirty||e.parent.isProjectionDirty||e.parent.isSharedProjectionDirty)),e.isTransformDirty||(e.isTransformDirty=e.parent.isTransformDirty))}function cleanDirtyNodes(e){e.isProjectionDirty=e.isSharedProjectionDirty=e.isTransformDirty=!1}function clearSnapshot(e){e.clearSnapshot()}function clearMeasurements(e){e.clearMeasurements()}function clearIsLayoutDirty(e){e.isLayoutDirty=!1}function resetTransformStyle(e){const{visualElement:i}=e.options;i&&i.getProps().onBeforeLayoutMeasure&&i.notify("BeforeLayoutMeasure"),e.resetTransform()}function finishAnimation(e){e.finishAnimation(),e.targetDelta=e.relativeTarget=e.target=void 0,e.isProjectionDirty=!0}function resolveTargetDelta(e){e.resolveTargetDelta()}function calcProjection(e){e.calcProjection()}function resetSkewAndRotation(e){e.resetSkewAndRotation()}function removeLeadSnapshots(e){e.removeLeadSnapshot()}function mixAxisDelta(e,i,s){e.translate=mixNumber$1(i.translate,0,s),e.scale=mixNumber$1(i.scale,1,s),e.origin=i.origin,e.originPoint=i.originPoint}function mixAxis(e,i,s,a){e.min=mixNumber$1(i.min,s.min,a),e.max=mixNumber$1(i.max,s.max,a)}function mixBox(e,i,s,a){mixAxis(e.x,i.x,s.x,a),mixAxis(e.y,i.y,s.y,a)}function hasOpacityCrossfade(e){return e.animationValues&&e.animationValues.opacityExit!==void 0}const defaultLayoutTransition={duration:.45,ease:[.4,0,.1,1]},userAgentContains=e=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(e),roundPoint=userAgentContains("applewebkit/")&&!userAgentContains("chrome/")?Math.round:noop;function roundAxis(e){e.min=roundPoint(e.min),e.max=roundPoint(e.max)}function roundBox(e){roundAxis(e.x),roundAxis(e.y)}function shouldAnimatePositionOnly(e,i,s){return e==="position"||e==="preserve-aspect"&&!isNear(aspectRatio(i),aspectRatio(s),.2)}function checkNodeWasScrollRoot(e){var i;return e!==e.root&&((i=e.scroll)==null?void 0:i.wasRoot)}const DocumentProjectionNode=createProjectionNode({attachResizeListener:(e,i)=>addDomEvent(e,"resize",i),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),rootProjectionNode={current:void 0},HTMLProjectionNode=createProjectionNode({measureScroll:e=>({x:e.scrollLeft,y:e.scrollTop}),defaultParent:()=>{if(!rootProjectionNode.current){const e=new DocumentProjectionNode({});e.mount(window),e.setOptions({layoutScroll:!0}),rootProjectionNode.current=e}return rootProjectionNode.current},resetTransform:(e,i)=>{e.style.transform=i!==void 0?i:"none"},checkIsScrollRoot:e=>window.getComputedStyle(e).position==="fixed"}),drag={pan:{Feature:PanGesture},drag:{Feature:DragGesture,ProjectionNode:HTMLProjectionNode,MeasureLayout}};function handleHoverEvent(e,i,s){const{props:a}=e;e.animationState&&a.whileHover&&e.animationState.setActive("whileHover",s==="Start");const _="onHover"+s,$=a[_];$&&frame.postRender(()=>$(i,extractEventInfo(i)))}class HoverGesture extends Feature$1{mount(){const{current:i}=this.node;i&&(this.unmount=hover(i,(s,a)=>(handleHoverEvent(this.node,a,"Start"),_=>handleHoverEvent(this.node,_,"End"))))}unmount(){}}class FocusGesture extends Feature$1{constructor(){super(...arguments),this.isActive=!1}onFocus(){let i=!1;try{i=this.node.current.matches(":focus-visible")}catch{i=!0}!i||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=pipe(addDomEvent(this.node.current,"focus",()=>this.onFocus()),addDomEvent(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function handlePressEvent(e,i,s){const{props:a}=e;if(e.current instanceof HTMLButtonElement&&e.current.disabled)return;e.animationState&&a.whileTap&&e.animationState.setActive("whileTap",s==="Start");const _="onTap"+(s==="End"?"":s),$=a[_];$&&frame.postRender(()=>$(i,extractEventInfo(i)))}class PressGesture extends Feature$1{mount(){const{current:i}=this.node;i&&(this.unmount=press(i,(s,a)=>(handlePressEvent(this.node,a,"Start"),(_,{success:$})=>handlePressEvent(this.node,_,$?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const observerCallbacks=new WeakMap,observers=new WeakMap,fireObserverCallback=e=>{const i=observerCallbacks.get(e.target);i&&i(e)},fireAllObserverCallbacks=e=>{e.forEach(fireObserverCallback)};function initIntersectionObserver({root:e,...i}){const s=e||document;observers.has(s)||observers.set(s,{});const a=observers.get(s),_=JSON.stringify(i);return a[_]||(a[_]=new IntersectionObserver(fireAllObserverCallbacks,{root:e,...i})),a[_]}function observeIntersection(e,i,s){const a=initIntersectionObserver(i);return observerCallbacks.set(e,s),a.observe(e),()=>{observerCallbacks.delete(e),a.unobserve(e)}}const thresholdNames={some:0,all:1};class InViewFeature extends Feature$1{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:i={}}=this.node.getProps(),{root:s,margin:a,amount:_="some",once:$}=i,rt={root:s?s.current:void 0,rootMargin:a,threshold:typeof _=="number"?_:thresholdNames[_]},c=dt=>{const{isIntersecting:ht}=dt;if(this.isInView===ht||(this.isInView=ht,$&&!ht&&this.hasEnteredView))return;ht&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",ht);const{onViewportEnter:Et,onViewportLeave:St}=this.node.getProps(),At=ht?Et:St;At&&At(dt)};return observeIntersection(this.node.current,rt,c)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:i,prevProps:s}=this.node;["amount","margin","root"].some(hasViewportOptionChanged(i,s))&&this.startObserver()}unmount(){}}function hasViewportOptionChanged({viewport:e={}},{viewport:i={}}={}){return s=>e[s]!==i[s]}const gestureAnimations={inView:{Feature:InViewFeature},tap:{Feature:PressGesture},focus:{Feature:FocusGesture},hover:{Feature:HoverGesture}},layout={layout:{ProjectionNode:HTMLProjectionNode,MeasureLayout}},featureBundle={...animations,...gestureAnimations,...drag,...layout},motion=createMotionProxy(featureBundle,createDomVisualElement);function stopAnimation(e){e.values.forEach(i=>i.stop())}function setVariants(e,i){[...i].reverse().forEach(a=>{const _=e.getVariant(a);_&&setTarget(e,_),e.variantChildren&&e.variantChildren.forEach($=>{setVariants($,i)})})}function setValues(e,i){if(Array.isArray(i))return setVariants(e,i);if(typeof i=="string")return setVariants(e,[i]);setTarget(e,i)}function animationControls(){let e=!1;const i=new Set,s={subscribe(a){return i.add(a),()=>void i.delete(a)},start(a,_){invariant(e,"controls.start() should only be called after a component has mounted. Consider calling within a useEffect hook.");const $=[];return i.forEach(rt=>{$.push(animateVisualElement(rt,a,{transitionOverride:_}))}),Promise.all($)},set(a){return invariant(e,"controls.set() should only be called after a component has mounted. Consider calling within a useEffect hook."),i.forEach(_=>{setValues(_,a)})},stop(){i.forEach(a=>{stopAnimation(a)})},mount(){return e=!0,()=>{e=!1,s.stop()}}};return s}function useAnimationControls(){const e=useConstant(animationControls);return useIsomorphicLayoutEffect$1(e.mount,[]),e}const useAnimation=useAnimationControls;var build={exports:{}};(()=>{var e={296:(_,$,rt)=>{var c=/^\s+|\s+$/g,dt=/^[-+]0x[0-9a-f]+$/i,ht=/^0b[01]+$/i,Et=/^0o[0-7]+$/i,St=parseInt,At=typeof rt.g=="object"&&rt.g&&rt.g.Object===Object&&rt.g,Pt=typeof self=="object"&&self&&self.Object===Object&&self,Vt=At||Pt||Function("return this")(),Bt=Object.prototype.toString,Zt=Math.max,zt=Math.min,Ut=function(){return Vt.Date.now()};function Nt(er){var ir=typeof er;return!!er&&(ir=="object"||ir=="function")}function Gt(er){if(typeof er=="number")return er;if(function(mr){return typeof mr=="symbol"||function(Rr){return!!Rr&&typeof Rr=="object"}(mr)&&Bt.call(mr)=="[object Symbol]"}(er))return NaN;if(Nt(er)){var ir=typeof er.valueOf=="function"?er.valueOf():er;er=Nt(ir)?ir+"":ir}if(typeof er!="string")return er===0?er:+er;er=er.replace(c,"");var or=ht.test(er);return or||Et.test(er)?St(er.slice(2),or?2:8):dt.test(er)?NaN:+er}_.exports=function(er,ir,or){var mr,Rr,on,un,jr,Jr,fn=0,Fr=!1,Cr=!1,Sr=!0;if(typeof er!="function")throw new TypeError("Expected a function");function dr(gn){var Sn=mr,Fs=Rr;return mr=Rr=void 0,fn=gn,un=er.apply(Fs,Sn)}function gr(gn){var Sn=gn-Jr;return Jr===void 0||Sn>=ir||Sn<0||Cr&&gn-fn>=on}function qr(){var gn=Ut();if(gr(gn))return Lr(gn);jr=setTimeout(qr,function(Sn){var Fs=ir-(Sn-Jr);return Cr?zt(Fs,on-(Sn-fn)):Fs}(gn))}function Lr(gn){return jr=void 0,Sr&&mr?dr(gn):(mr=Rr=void 0,un)}function _n(){var gn=Ut(),Sn=gr(gn);if(mr=arguments,Rr=this,Jr=gn,Sn){if(jr===void 0)return function(Fs){return fn=Fs,jr=setTimeout(qr,ir),Fr?dr(Fs):un}(Jr);if(Cr)return jr=setTimeout(qr,ir),dr(Jr)}return jr===void 0&&(jr=setTimeout(qr,ir)),un}return ir=Gt(ir)||0,Nt(or)&&(Fr=!!or.leading,on=(Cr="maxWait"in or)?Zt(Gt(or.maxWait)||0,ir):on,Sr="trailing"in or?!!or.trailing:Sr),_n.cancel=function(){jr!==void 0&&clearTimeout(jr),fn=0,mr=Jr=Rr=jr=void 0},_n.flush=function(){return jr===void 0?un:Lr(Ut())},_n}},96:(_,$,rt)=>{var c="Expected a function",dt=NaN,ht="[object Symbol]",Et=/^\s+|\s+$/g,St=/^[-+]0x[0-9a-f]+$/i,At=/^0b[01]+$/i,Pt=/^0o[0-7]+$/i,Vt=parseInt,Bt=typeof rt.g=="object"&&rt.g&&rt.g.Object===Object&&rt.g,Zt=typeof self=="object"&&self&&self.Object===Object&&self,zt=Bt||Zt||Function("return this")(),Ut=Object.prototype.toString,Nt=Math.max,Gt=Math.min,er=function(){return zt.Date.now()};function ir(mr){var Rr=typeof mr;return!!mr&&(Rr=="object"||Rr=="function")}function or(mr){if(typeof mr=="number")return mr;if(function(un){return typeof un=="symbol"||function(jr){return!!jr&&typeof jr=="object"}(un)&&Ut.call(un)==ht}(mr))return dt;if(ir(mr)){var Rr=typeof mr.valueOf=="function"?mr.valueOf():mr;mr=ir(Rr)?Rr+"":Rr}if(typeof mr!="string")return mr===0?mr:+mr;mr=mr.replace(Et,"");var on=At.test(mr);return on||Pt.test(mr)?Vt(mr.slice(2),on?2:8):St.test(mr)?dt:+mr}_.exports=function(mr,Rr,on){var un=!0,jr=!0;if(typeof mr!="function")throw new TypeError(c);return ir(on)&&(un="leading"in on?!!on.leading:un,jr="trailing"in on?!!on.trailing:jr),function(Jr,fn,Fr){var Cr,Sr,dr,gr,qr,Lr,_n=0,gn=!1,Sn=!1,Fs=!0;if(typeof Jr!="function")throw new TypeError(c);function rs(ks){var lo=Cr,ys=Sr;return Cr=Sr=void 0,_n=ks,gr=Jr.apply(ys,lo)}function ms(ks){var lo=ks-Lr;return Lr===void 0||lo>=fn||lo<0||Sn&&ks-_n>=dr}function On(){var ks=er();if(ms(ks))return ws(ks);qr=setTimeout(On,function(lo){var ys=fn-(lo-Lr);return Sn?Gt(ys,dr-(lo-_n)):ys}(ks))}function ws(ks){return qr=void 0,Fs&&Cr?rs(ks):(Cr=Sr=void 0,gr)}function Vs(){var ks=er(),lo=ms(ks);if(Cr=arguments,Sr=this,Lr=ks,lo){if(qr===void 0)return function(ys){return _n=ys,qr=setTimeout(On,fn),gn?rs(ys):gr}(Lr);if(Sn)return qr=setTimeout(On,fn),rs(Lr)}return qr===void 0&&(qr=setTimeout(On,fn)),gr}return fn=or(fn)||0,ir(Fr)&&(gn=!!Fr.leading,dr=(Sn="maxWait"in Fr)?Nt(or(Fr.maxWait)||0,fn):dr,Fs="trailing"in Fr?!!Fr.trailing:Fs),Vs.cancel=function(){qr!==void 0&&clearTimeout(qr),_n=0,Cr=Lr=Sr=qr=void 0},Vs.flush=function(){return qr===void 0?gr:ws(er())},Vs}(mr,Rr,{leading:un,maxWait:Rr,trailing:jr})}},703:(_,$,rt)=>{var c=rt(414);function dt(){}function ht(){}ht.resetWarningCache=dt,_.exports=function(){function Et(Pt,Vt,Bt,Zt,zt,Ut){if(Ut!==c){var Nt=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw Nt.name="Invariant Violation",Nt}}function St(){return Et}Et.isRequired=Et;var At={array:Et,bigint:Et,bool:Et,func:Et,number:Et,object:Et,string:Et,symbol:Et,any:Et,arrayOf:St,element:Et,elementType:Et,instanceOf:St,node:Et,objectOf:St,oneOf:St,oneOfType:St,shape:St,exact:St,checkPropTypes:ht,resetWarningCache:dt};return At.PropTypes=At,At}},697:(_,$,rt)=>{_.exports=rt(703)()},414:_=>{_.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"}},i={};function s(_){var $=i[_];if($!==void 0)return $.exports;var rt=i[_]={exports:{}};return e[_](rt,rt.exports,s),rt.exports}s.n=_=>{var $=_&&_.__esModule?()=>_.default:()=>_;return s.d($,{a:$}),$},s.d=(_,$)=>{for(var rt in $)s.o($,rt)&&!s.o(_,rt)&&Object.defineProperty(_,rt,{enumerable:!0,get:$[rt]})},s.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}(),s.o=(_,$)=>Object.prototype.hasOwnProperty.call(_,$),s.r=_=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(_,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(_,"__esModule",{value:!0})};var a={};(()=>{s.r(a),s.d(a,{LazyLoadComponent:()=>lo,LazyLoadImage:()=>ga,trackWindowScroll:()=>gr});const _=reactExports;var $=s.n(_),rt=s(697);function c(){return typeof window<"u"&&"IntersectionObserver"in window&&"isIntersecting"in window.IntersectionObserverEntry.prototype}function dt(ds){return dt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(Mn){return typeof Mn}:function(Mn){return Mn&&typeof Symbol=="function"&&Mn.constructor===Symbol&&Mn!==Symbol.prototype?"symbol":typeof Mn},dt(ds)}function ht(ds,Mn){var Cs=Object.keys(ds);if(Object.getOwnPropertySymbols){var Ds=Object.getOwnPropertySymbols(ds);Mn&&(Ds=Ds.filter(function(ao){return Object.getOwnPropertyDescriptor(ds,ao).enumerable})),Cs.push.apply(Cs,Ds)}return Cs}function Et(ds,Mn,Cs){return(Mn=At(Mn))in ds?Object.defineProperty(ds,Mn,{value:Cs,enumerable:!0,configurable:!0,writable:!0}):ds[Mn]=Cs,ds}function St(ds,Mn){for(var Cs=0;Cs<Mn.length;Cs++){var Ds=Mn[Cs];Ds.enumerable=Ds.enumerable||!1,Ds.configurable=!0,"value"in Ds&&(Ds.writable=!0),Object.defineProperty(ds,At(Ds.key),Ds)}}function At(ds){var Mn=function(Cs,Ds){if(dt(Cs)!=="object"||Cs===null)return Cs;var ao=Cs[Symbol.toPrimitive];if(ao!==void 0){var Wo=ao.call(Cs,"string");if(dt(Wo)!=="object")return Wo;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(Cs)}(ds);return dt(Mn)==="symbol"?Mn:String(Mn)}function Pt(ds,Mn){return Pt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(Cs,Ds){return Cs.__proto__=Ds,Cs},Pt(ds,Mn)}function Vt(ds){return Vt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(Mn){return Mn.__proto__||Object.getPrototypeOf(Mn)},Vt(ds)}var Bt=function(ds){ds.forEach(function(Mn){Mn.isIntersecting&&Mn.target.onVisible()})},Zt={},zt=function(ds){(function(fs,ps){if(typeof ps!="function"&&ps!==null)throw new TypeError("Super expression must either be null or a function");fs.prototype=Object.create(ps&&ps.prototype,{constructor:{value:fs,writable:!0,configurable:!0}}),Object.defineProperty(fs,"prototype",{writable:!1}),ps&&Pt(fs,ps)})(Gl,ds);var Mn,Cs,Ds,ao,Wo=(Ds=Gl,ao=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}(),function(){var fs,ps=Vt(Ds);if(ao){var qn=Vt(this).constructor;fs=Reflect.construct(ps,arguments,qn)}else fs=ps.apply(this,arguments);return function(qs,Gs){if(Gs&&(dt(Gs)==="object"||typeof Gs=="function"))return Gs;if(Gs!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return function(Eo){if(Eo===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return Eo}(qs)}(this,fs)});function Gl(fs){var ps;if(function(qs,Gs){if(!(qs instanceof Gs))throw new TypeError("Cannot call a class as a function")}(this,Gl),(ps=Wo.call(this,fs)).supportsObserver=!fs.scrollPosition&&fs.useIntersectionObserver&&c(),ps.supportsObserver){var qn=fs.threshold;ps.observer=function(qs){return Zt[qs]=Zt[qs]||new IntersectionObserver(Bt,{rootMargin:qs+"px"}),Zt[qs]}(qn)}return ps}return Mn=Gl,Cs=[{key:"componentDidMount",value:function(){this.placeholder&&this.observer&&(this.placeholder.onVisible=this.props.onVisible,this.observer.observe(this.placeholder)),this.supportsObserver||this.updateVisibility()}},{key:"componentWillUnmount",value:function(){this.observer&&this.placeholder&&this.observer.unobserve(this.placeholder)}},{key:"componentDidUpdate",value:function(){this.supportsObserver||this.updateVisibility()}},{key:"getPlaceholderBoundingBox",value:function(){var fs=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.props.scrollPosition,ps=this.placeholder.getBoundingClientRect(),qn=this.placeholder.style,qs=parseInt(qn.getPropertyValue("margin-left"),10)||0,Gs=parseInt(qn.getPropertyValue("margin-top"),10)||0;return{bottom:fs.y+ps.bottom+Gs,left:fs.x+ps.left+qs,right:fs.x+ps.right+qs,top:fs.y+ps.top+Gs}}},{key:"isPlaceholderInViewport",value:function(){if(typeof window>"u"||!this.placeholder)return!1;var fs=this.props,ps=fs.scrollPosition,qn=fs.threshold,qs=this.getPlaceholderBoundingBox(ps),Gs=ps.y+window.innerHeight,Eo=ps.x,Kl=ps.x+window.innerWidth,tu=ps.y;return tu-qn<=qs.bottom&&Gs+qn>=qs.top&&Eo-qn<=qs.right&&Kl+qn>=qs.left}},{key:"updateVisibility",value:function(){this.isPlaceholderInViewport()&&this.props.onVisible()}},{key:"render",value:function(){var fs=this,ps=this.props,qn=ps.className,qs=ps.height,Gs=ps.placeholder,Eo=ps.style,Kl=ps.width;if(Gs&&typeof Gs.type!="function")return $().cloneElement(Gs,{ref:function(Wl){return fs.placeholder=Wl}});var tu=function(Wl){for(var Zo=1;Zo<arguments.length;Zo++){var ru=arguments[Zo]!=null?arguments[Zo]:{};Zo%2?ht(Object(ru),!0).forEach(function(Oo){Et(Wl,Oo,ru[Oo])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Wl,Object.getOwnPropertyDescriptors(ru)):ht(Object(ru)).forEach(function(Oo){Object.defineProperty(Wl,Oo,Object.getOwnPropertyDescriptor(ru,Oo))})}return Wl}({display:"inline-block"},Eo);return Kl!==void 0&&(tu.width=Kl),qs!==void 0&&(tu.height=qs),$().createElement("span",{className:qn,ref:function(Wl){return fs.placeholder=Wl},style:tu},Gs)}}],Cs&&St(Mn.prototype,Cs),Object.defineProperty(Mn,"prototype",{writable:!1}),Gl}($().Component);zt.propTypes={onVisible:rt.PropTypes.func.isRequired,className:rt.PropTypes.string,height:rt.PropTypes.oneOfType([rt.PropTypes.number,rt.PropTypes.string]),placeholder:rt.PropTypes.element,threshold:rt.PropTypes.number,useIntersectionObserver:rt.PropTypes.bool,scrollPosition:rt.PropTypes.shape({x:rt.PropTypes.number.isRequired,y:rt.PropTypes.number.isRequired}),width:rt.PropTypes.oneOfType([rt.PropTypes.number,rt.PropTypes.string])},zt.defaultProps={className:"",placeholder:null,threshold:100,useIntersectionObserver:!0};const Ut=zt;var Nt=s(296),Gt=s.n(Nt),er=s(96),ir=s.n(er),or=function(ds){var Mn=getComputedStyle(ds,null);return Mn.getPropertyValue("overflow")+Mn.getPropertyValue("overflow-y")+Mn.getPropertyValue("overflow-x")};const mr=function(ds){if(!(ds instanceof HTMLElement))return window;for(var Mn=ds;Mn&&Mn instanceof HTMLElement;){if(/(scroll|auto)/.test(or(Mn)))return Mn;Mn=Mn.parentNode}return window};function Rr(ds){return Rr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(Mn){return typeof Mn}:function(Mn){return Mn&&typeof Symbol=="function"&&Mn.constructor===Symbol&&Mn!==Symbol.prototype?"symbol":typeof Mn},Rr(ds)}var on=["delayMethod","delayTime"];function un(){return un=Object.assign?Object.assign.bind():function(ds){for(var Mn=1;Mn<arguments.length;Mn++){var Cs=arguments[Mn];for(var Ds in Cs)Object.prototype.hasOwnProperty.call(Cs,Ds)&&(ds[Ds]=Cs[Ds])}return ds},un.apply(this,arguments)}function jr(ds,Mn){for(var Cs=0;Cs<Mn.length;Cs++){var Ds=Mn[Cs];Ds.enumerable=Ds.enumerable||!1,Ds.configurable=!0,"value"in Ds&&(Ds.writable=!0),Object.defineProperty(ds,(ao=function(Wo,Gl){if(Rr(Wo)!=="object"||Wo===null)return Wo;var fs=Wo[Symbol.toPrimitive];if(fs!==void 0){var ps=fs.call(Wo,"string");if(Rr(ps)!=="object")return ps;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(Wo)}(Ds.key),Rr(ao)==="symbol"?ao:String(ao)),Ds)}var ao}function Jr(ds,Mn){return Jr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(Cs,Ds){return Cs.__proto__=Ds,Cs},Jr(ds,Mn)}function fn(ds,Mn){if(Mn&&(Rr(Mn)==="object"||typeof Mn=="function"))return Mn;if(Mn!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Fr(ds)}function Fr(ds){if(ds===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return ds}function Cr(ds){return Cr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(Mn){return Mn.__proto__||Object.getPrototypeOf(Mn)},Cr(ds)}var Sr=function(){return typeof window>"u"?0:window.scrollX||window.pageXOffset},dr=function(){return typeof window>"u"?0:window.scrollY||window.pageYOffset};const gr=function(ds){var Mn=function(Cs){(function(qn,qs){if(typeof qs!="function"&&qs!==null)throw new TypeError("Super expression must either be null or a function");qn.prototype=Object.create(qs&&qs.prototype,{constructor:{value:qn,writable:!0,configurable:!0}}),Object.defineProperty(qn,"prototype",{writable:!1}),qs&&Jr(qn,qs)})(ps,Cs);var Ds,ao,Wo,Gl,fs=(Wo=ps,Gl=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}(),function(){var qn,qs=Cr(Wo);if(Gl){var Gs=Cr(this).constructor;qn=Reflect.construct(qs,arguments,Gs)}else qn=qs.apply(this,arguments);return fn(this,qn)});function ps(qn){var qs;if(function(Eo,Kl){if(!(Eo instanceof Kl))throw new TypeError("Cannot call a class as a function")}(this,ps),(qs=fs.call(this,qn)).useIntersectionObserver=qn.useIntersectionObserver&&c(),qs.useIntersectionObserver)return fn(qs);var Gs=qs.onChangeScroll.bind(Fr(qs));return qn.delayMethod==="debounce"?qs.delayedScroll=Gt()(Gs,qn.delayTime):qn.delayMethod==="throttle"&&(qs.delayedScroll=ir()(Gs,qn.delayTime)),qs.state={scrollPosition:{x:Sr(),y:dr()}},qs.baseComponentRef=$().createRef(),qs}return Ds=ps,(ao=[{key:"componentDidMount",value:function(){this.addListeners()}},{key:"componentWillUnmount",value:function(){this.removeListeners()}},{key:"componentDidUpdate",value:function(){typeof window>"u"||this.useIntersectionObserver||mr(this.baseComponentRef.current)!==this.scrollElement&&(this.removeListeners(),this.addListeners())}},{key:"addListeners",value:function(){typeof window>"u"||this.useIntersectionObserver||(this.scrollElement=mr(this.baseComponentRef.current),this.scrollElement.addEventListener("scroll",this.delayedScroll,{passive:!0}),window.addEventListener("resize",this.delayedScroll,{passive:!0}),this.scrollElement!==window&&window.addEventListener("scroll",this.delayedScroll,{passive:!0}))}},{key:"removeListeners",value:function(){typeof window>"u"||this.useIntersectionObserver||(this.scrollElement.removeEventListener("scroll",this.delayedScroll),window.removeEventListener("resize",this.delayedScroll),this.scrollElement!==window&&window.removeEventListener("scroll",this.delayedScroll))}},{key:"onChangeScroll",value:function(){this.useIntersectionObserver||this.setState({scrollPosition:{x:Sr(),y:dr()}})}},{key:"render",value:function(){var qn=this.props,qs=(qn.delayMethod,qn.delayTime,function(Eo,Kl){if(Eo==null)return{};var tu,Wl,Zo=function(Oo,Tu){if(Oo==null)return{};var Ao,Ll,Jo={},Ku=Object.keys(Oo);for(Ll=0;Ll<Ku.length;Ll++)Ao=Ku[Ll],Tu.indexOf(Ao)>=0||(Jo[Ao]=Oo[Ao]);return Jo}(Eo,Kl);if(Object.getOwnPropertySymbols){var ru=Object.getOwnPropertySymbols(Eo);for(Wl=0;Wl<ru.length;Wl++)tu=ru[Wl],Kl.indexOf(tu)>=0||Object.prototype.propertyIsEnumerable.call(Eo,tu)&&(Zo[tu]=Eo[tu])}return Zo}(qn,on)),Gs=this.useIntersectionObserver?null:this.state.scrollPosition;return $().createElement(ds,un({forwardRef:this.baseComponentRef,scrollPosition:Gs},qs))}}])&&jr(Ds.prototype,ao),Object.defineProperty(Ds,"prototype",{writable:!1}),ps}($().Component);return Mn.propTypes={delayMethod:rt.PropTypes.oneOf(["debounce","throttle"]),delayTime:rt.PropTypes.number,useIntersectionObserver:rt.PropTypes.bool},Mn.defaultProps={delayMethod:"throttle",delayTime:300,useIntersectionObserver:!0},Mn};function qr(ds){return qr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(Mn){return typeof Mn}:function(Mn){return Mn&&typeof Symbol=="function"&&Mn.constructor===Symbol&&Mn!==Symbol.prototype?"symbol":typeof Mn},qr(ds)}function Lr(ds,Mn){for(var Cs=0;Cs<Mn.length;Cs++){var Ds=Mn[Cs];Ds.enumerable=Ds.enumerable||!1,Ds.configurable=!0,"value"in Ds&&(Ds.writable=!0),Object.defineProperty(ds,(ao=function(Wo,Gl){if(qr(Wo)!=="object"||Wo===null)return Wo;var fs=Wo[Symbol.toPrimitive];if(fs!==void 0){var ps=fs.call(Wo,"string");if(qr(ps)!=="object")return ps;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(Wo)}(Ds.key),qr(ao)==="symbol"?ao:String(ao)),Ds)}var ao}function _n(ds,Mn){return _n=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(Cs,Ds){return Cs.__proto__=Ds,Cs},_n(ds,Mn)}function gn(ds){return gn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(Mn){return Mn.__proto__||Object.getPrototypeOf(Mn)},gn(ds)}var Sn=function(ds){(function(fs,ps){if(typeof ps!="function"&&ps!==null)throw new TypeError("Super expression must either be null or a function");fs.prototype=Object.create(ps&&ps.prototype,{constructor:{value:fs,writable:!0,configurable:!0}}),Object.defineProperty(fs,"prototype",{writable:!1}),ps&&_n(fs,ps)})(Gl,ds);var Mn,Cs,Ds,ao,Wo=(Ds=Gl,ao=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}(),function(){var fs,ps=gn(Ds);if(ao){var qn=gn(this).constructor;fs=Reflect.construct(ps,arguments,qn)}else fs=ps.apply(this,arguments);return function(qs,Gs){if(Gs&&(qr(Gs)==="object"||typeof Gs=="function"))return Gs;if(Gs!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return function(Eo){if(Eo===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return Eo}(qs)}(this,fs)});function Gl(fs){return function(ps,qn){if(!(ps instanceof qn))throw new TypeError("Cannot call a class as a function")}(this,Gl),Wo.call(this,fs)}return Mn=Gl,(Cs=[{key:"render",value:function(){return $().createElement(Ut,this.props)}}])&&Lr(Mn.prototype,Cs),Object.defineProperty(Mn,"prototype",{writable:!1}),Gl}($().Component);const Fs=gr(Sn);function rs(ds){return rs=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(Mn){return typeof Mn}:function(Mn){return Mn&&typeof Symbol=="function"&&Mn.constructor===Symbol&&Mn!==Symbol.prototype?"symbol":typeof Mn},rs(ds)}function ms(ds,Mn){for(var Cs=0;Cs<Mn.length;Cs++){var Ds=Mn[Cs];Ds.enumerable=Ds.enumerable||!1,Ds.configurable=!0,"value"in Ds&&(Ds.writable=!0),Object.defineProperty(ds,(ao=function(Wo,Gl){if(rs(Wo)!=="object"||Wo===null)return Wo;var fs=Wo[Symbol.toPrimitive];if(fs!==void 0){var ps=fs.call(Wo,"string");if(rs(ps)!=="object")return ps;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(Wo)}(Ds.key),rs(ao)==="symbol"?ao:String(ao)),Ds)}var ao}function On(ds,Mn){return On=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(Cs,Ds){return Cs.__proto__=Ds,Cs},On(ds,Mn)}function ws(ds){if(ds===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return ds}function Vs(ds){return Vs=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(Mn){return Mn.__proto__||Object.getPrototypeOf(Mn)},Vs(ds)}var ks=function(ds){(function(fs,ps){if(typeof ps!="function"&&ps!==null)throw new TypeError("Super expression must either be null or a function");fs.prototype=Object.create(ps&&ps.prototype,{constructor:{value:fs,writable:!0,configurable:!0}}),Object.defineProperty(fs,"prototype",{writable:!1}),ps&&On(fs,ps)})(Gl,ds);var Mn,Cs,Ds,ao,Wo=(Ds=Gl,ao=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}(),function(){var fs,ps=Vs(Ds);if(ao){var qn=Vs(this).constructor;fs=Reflect.construct(ps,arguments,qn)}else fs=ps.apply(this,arguments);return function(qs,Gs){if(Gs&&(rs(Gs)==="object"||typeof Gs=="function"))return Gs;if(Gs!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return ws(qs)}(this,fs)});function Gl(fs){var ps;(function(Kl,tu){if(!(Kl instanceof tu))throw new TypeError("Cannot call a class as a function")})(this,Gl),ps=Wo.call(this,fs);var qn=fs.afterLoad,qs=fs.beforeLoad,Gs=fs.scrollPosition,Eo=fs.visibleByDefault;return ps.state={visible:Eo},Eo&&(qs(),qn()),ps.onVisible=ps.onVisible.bind(ws(ps)),ps.isScrollTracked=!!(Gs&&Number.isFinite(Gs.x)&&Gs.x>=0&&Number.isFinite(Gs.y)&&Gs.y>=0),ps}return Mn=Gl,(Cs=[{key:"componentDidUpdate",value:function(fs,ps){ps.visible!==this.state.visible&&this.props.afterLoad()}},{key:"onVisible",value:function(){this.props.beforeLoad(),this.setState({visible:!0})}},{key:"render",value:function(){if(this.state.visible)return this.props.children;var fs=this.props,ps=fs.className,qn=fs.delayMethod,qs=fs.delayTime,Gs=fs.height,Eo=fs.placeholder,Kl=fs.scrollPosition,tu=fs.style,Wl=fs.threshold,Zo=fs.useIntersectionObserver,ru=fs.width;return this.isScrollTracked||Zo&&c()?$().createElement(Ut,{className:ps,height:Gs,onVisible:this.onVisible,placeholder:Eo,scrollPosition:Kl,style:tu,threshold:Wl,useIntersectionObserver:Zo,width:ru}):$().createElement(Fs,{className:ps,delayMethod:qn,delayTime:qs,height:Gs,onVisible:this.onVisible,placeholder:Eo,style:tu,threshold:Wl,width:ru})}}])&&ms(Mn.prototype,Cs),Object.defineProperty(Mn,"prototype",{writable:!1}),Gl}($().Component);ks.propTypes={afterLoad:rt.PropTypes.func,beforeLoad:rt.PropTypes.func,useIntersectionObserver:rt.PropTypes.bool,visibleByDefault:rt.PropTypes.bool},ks.defaultProps={afterLoad:function(){return{}},beforeLoad:function(){return{}},useIntersectionObserver:!0,visibleByDefault:!1};const lo=ks;function ys(ds){return ys=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(Mn){return typeof Mn}:function(Mn){return Mn&&typeof Symbol=="function"&&Mn.constructor===Symbol&&Mn!==Symbol.prototype?"symbol":typeof Mn},ys(ds)}var dn=["afterLoad","beforeLoad","delayMethod","delayTime","effect","placeholder","placeholderSrc","scrollPosition","threshold","useIntersectionObserver","visibleByDefault","wrapperClassName","wrapperProps"];function Es(ds,Mn){var Cs=Object.keys(ds);if(Object.getOwnPropertySymbols){var Ds=Object.getOwnPropertySymbols(ds);Mn&&(Ds=Ds.filter(function(ao){return Object.getOwnPropertyDescriptor(ds,ao).enumerable})),Cs.push.apply(Cs,Ds)}return Cs}function po(ds){for(var Mn=1;Mn<arguments.length;Mn++){var Cs=arguments[Mn]!=null?arguments[Mn]:{};Mn%2?Es(Object(Cs),!0).forEach(function(Ds){no(ds,Ds,Cs[Ds])}):Object.getOwnPropertyDescriptors?Object.defineProperties(ds,Object.getOwnPropertyDescriptors(Cs)):Es(Object(Cs)).forEach(function(Ds){Object.defineProperty(ds,Ds,Object.getOwnPropertyDescriptor(Cs,Ds))})}return ds}function no(ds,Mn,Cs){return(Mn=Co(Mn))in ds?Object.defineProperty(ds,Mn,{value:Cs,enumerable:!0,configurable:!0,writable:!0}):ds[Mn]=Cs,ds}function tn(){return tn=Object.assign?Object.assign.bind():function(ds){for(var Mn=1;Mn<arguments.length;Mn++){var Cs=arguments[Mn];for(var Ds in Cs)Object.prototype.hasOwnProperty.call(Cs,Ds)&&(ds[Ds]=Cs[Ds])}return ds},tn.apply(this,arguments)}function us(ds,Mn){for(var Cs=0;Cs<Mn.length;Cs++){var Ds=Mn[Cs];Ds.enumerable=Ds.enumerable||!1,Ds.configurable=!0,"value"in Ds&&(Ds.writable=!0),Object.defineProperty(ds,Co(Ds.key),Ds)}}function Co(ds){var Mn=function(Cs,Ds){if(ys(Cs)!=="object"||Cs===null)return Cs;var ao=Cs[Symbol.toPrimitive];if(ao!==void 0){var Wo=ao.call(Cs,"string");if(ys(Wo)!=="object")return Wo;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(Cs)}(ds);return ys(Mn)==="symbol"?Mn:String(Mn)}function Ss(ds,Mn){return Ss=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(Cs,Ds){return Cs.__proto__=Ds,Cs},Ss(ds,Mn)}function Ul(ds){return Ul=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(Mn){return Mn.__proto__||Object.getPrototypeOf(Mn)},Ul(ds)}var Tl=function(ds){(function(fs,ps){if(typeof ps!="function"&&ps!==null)throw new TypeError("Super expression must either be null or a function");fs.prototype=Object.create(ps&&ps.prototype,{constructor:{value:fs,writable:!0,configurable:!0}}),Object.defineProperty(fs,"prototype",{writable:!1}),ps&&Ss(fs,ps)})(Gl,ds);var Mn,Cs,Ds,ao,Wo=(Ds=Gl,ao=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}(),function(){var fs,ps=Ul(Ds);if(ao){var qn=Ul(this).constructor;fs=Reflect.construct(ps,arguments,qn)}else fs=ps.apply(this,arguments);return function(qs,Gs){if(Gs&&(ys(Gs)==="object"||typeof Gs=="function"))return Gs;if(Gs!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return function(Eo){if(Eo===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return Eo}(qs)}(this,fs)});function Gl(fs){var ps;return function(qn,qs){if(!(qn instanceof qs))throw new TypeError("Cannot call a class as a function")}(this,Gl),(ps=Wo.call(this,fs)).state={loaded:!1},ps}return Mn=Gl,(Cs=[{key:"onImageLoad",value:function(){var fs=this;return this.state.loaded?null:function(ps){fs.props.onLoad(ps),fs.props.afterLoad(),fs.setState({loaded:!0})}}},{key:"getImg",value:function(){var fs=this.props,ps=(fs.afterLoad,fs.beforeLoad,fs.delayMethod,fs.delayTime,fs.effect,fs.placeholder,fs.placeholderSrc,fs.scrollPosition,fs.threshold,fs.useIntersectionObserver,fs.visibleByDefault,fs.wrapperClassName,fs.wrapperProps,function(qn,qs){if(qn==null)return{};var Gs,Eo,Kl=function(Wl,Zo){if(Wl==null)return{};var ru,Oo,Tu={},Ao=Object.keys(Wl);for(Oo=0;Oo<Ao.length;Oo++)ru=Ao[Oo],Zo.indexOf(ru)>=0||(Tu[ru]=Wl[ru]);return Tu}(qn,qs);if(Object.getOwnPropertySymbols){var tu=Object.getOwnPropertySymbols(qn);for(Eo=0;Eo<tu.length;Eo++)Gs=tu[Eo],qs.indexOf(Gs)>=0||Object.prototype.propertyIsEnumerable.call(qn,Gs)&&(Kl[Gs]=qn[Gs])}return Kl}(fs,dn));return $().createElement("img",tn({},ps,{onLoad:this.onImageLoad()}))}},{key:"getLazyLoadImage",value:function(){var fs=this.props,ps=fs.beforeLoad,qn=fs.className,qs=fs.delayMethod,Gs=fs.delayTime,Eo=fs.height,Kl=fs.placeholder,tu=fs.scrollPosition,Wl=fs.style,Zo=fs.threshold,ru=fs.useIntersectionObserver,Oo=fs.visibleByDefault,Tu=fs.width;return $().createElement(lo,{beforeLoad:ps,className:qn,delayMethod:qs,delayTime:Gs,height:Eo,placeholder:Kl,scrollPosition:tu,style:Wl,threshold:Zo,useIntersectionObserver:ru,visibleByDefault:Oo,width:Tu},this.getImg())}},{key:"getWrappedLazyLoadImage",value:function(fs){var ps=this.props,qn=ps.effect,qs=ps.height,Gs=ps.placeholderSrc,Eo=ps.width,Kl=ps.wrapperClassName,tu=ps.wrapperProps,Wl=this.state.loaded,Zo=Wl?" lazy-load-image-loaded":"",ru=Wl||!Gs?{}:{backgroundImage:"url(".concat(Gs,")"),backgroundSize:"100% 100%"};return $().createElement("span",tn({className:Kl+" lazy-load-image-background "+qn+Zo,style:po(po({},ru),{},{color:"transparent",display:"inline-block",height:qs,width:Eo})},tu),fs)}},{key:"render",value:function(){var fs=this.props,ps=fs.effect,qn=fs.placeholderSrc,qs=fs.visibleByDefault,Gs=fs.wrapperClassName,Eo=fs.wrapperProps,Kl=this.getLazyLoadImage();return(ps||qn)&&!qs||Gs||Eo?this.getWrappedLazyLoadImage(Kl):Kl}}])&&us(Mn.prototype,Cs),Object.defineProperty(Mn,"prototype",{writable:!1}),Gl}($().Component);Tl.propTypes={onLoad:rt.PropTypes.func,afterLoad:rt.PropTypes.func,beforeLoad:rt.PropTypes.func,delayMethod:rt.PropTypes.string,delayTime:rt.PropTypes.number,effect:rt.PropTypes.string,placeholderSrc:rt.PropTypes.string,threshold:rt.PropTypes.number,useIntersectionObserver:rt.PropTypes.bool,visibleByDefault:rt.PropTypes.bool,wrapperClassName:rt.PropTypes.string,wrapperProps:rt.PropTypes.object},Tl.defaultProps={onLoad:function(){},afterLoad:function(){return{}},beforeLoad:function(){return{}},delayMethod:"throttle",delayTime:300,effect:"",placeholderSrc:null,threshold:100,useIntersectionObserver:!0,visibleByDefault:!1,wrapperClassName:""};const ga=Tl})(),build.exports=a})();var buildExports=build.exports;function Skeleton$1({className:e,...i}){return jsxRuntimeExports.jsx("div",{className:cn("animate-pulse rounded-md bg-muted",e),...i})}function CachedImage({className:e,alt:i,...s}){return jsxRuntimeExports.jsx(buildExports.LazyLoadImage,{alt:i,effect:"blur",wrapperClassName:cn("w-full h-full",e),className:cn("w-full h-full object-cover",e),placeholder:jsxRuntimeExports.jsx(Skeleton$1,{className:"w-full h-full"}),...s})}function KitchenCard({kitchen:e,index:i=0}){const{userLocation:s}=useLocationContext(),a=s&&e.address.lat&&e.address.lng?calculateDistance(s.lat,s.lng,e.address.lat,e.address.lng):e.address.city;return jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:i*.1,duration:.3},children:jsxRuntimeExports.jsx(Link,{to:`/kitchen/${e.id}`,children:jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-2xl overflow-hidden shadow-card hover:shadow-elevated transition-shadow duration-300",children:[jsxRuntimeExports.jsxs("div",{className:"relative h-36 overflow-hidden",children:[jsxRuntimeExports.jsx(CachedImage,{src:e.image,alt:e.name,className:cn("object-cover transition-all duration-300",!e.isOpen&&"opacity-60 grayscale")}),jsxRuntimeExports.jsx("div",{className:cn("absolute top-3 right-3 px-2.5 py-1 rounded-full text-xs font-semibold",e.isOpen?"bg-accent text-accent-foreground":"bg-muted text-muted-foreground"),children:e.isOpen?"Cooking Today":" Kitchen is closed"}),e.isVeg&&jsxRuntimeExports.jsx("div",{className:"absolute top-3 left-3 p-1.5 rounded-full bg-veg",children:jsxRuntimeExports.jsx(Leaf,{className:"w-3 h-3 text-white"})})]}),jsxRuntimeExports.jsxs("div",{className:"p-4",children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-foreground text-base mb-1 truncate",children:e.name}),jsxRuntimeExports.jsx("p",{className:"text-muted-foreground text-sm mb-3 line-clamp-1",children:e.specialties.slice(0,3).join("  ")}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[jsxRuntimeExports.jsx("div",{className:"flex items-center gap-1",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1 px-2 py-0.5 rounded-md bg-gold-soft",children:[jsxRuntimeExports.jsx(Star,{className:"w-3.5 h-3.5 text-gold fill-gold"}),jsxRuntimeExports.jsx("span",{className:"font-semibold text-foreground",children:e.rating.toFixed(1)})]})}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[jsxRuntimeExports.jsx(Clock,{className:"w-3.5 h-3.5"}),jsxRuntimeExports.jsx("span",{children:e.cookingTime})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[jsxRuntimeExports.jsx(MapPin,{className:"w-3.5 h-3.5"}),jsxRuntimeExports.jsx("span",{className:"truncate max-w-[80px]",children:a})]})]})]})]})})})}function useNotifications(e){const[i,s]=reactExports.useState([]),[a,_]=reactExports.useState(!0);return reactExports.useEffect(()=>{if(!e){_(!1);return}const $=ref(database,"notifications"),rt=onValue($,c=>{const dt=c.val();if(dt){const ht=Object.entries(dt).map(([Et,St])=>({...St,id:Et})).filter(Et=>Et.userId===e).sort((Et,St)=>St.createdAt-Et.createdAt);s(ht)}else s([]);_(!1)});return()=>rt()},[e]),{notifications:i,loading:a}}function useKitchens(){return useDataContext()}function useKitchen(e){const[i,s]=reactExports.useState(null),[a,_]=reactExports.useState(!0),[$,rt]=reactExports.useState(null);return reactExports.useEffect(()=>{if(!e){_(!1);return}const c=ref(database,`kitchens/${e}`),dt=onValue(c,ht=>{try{const Et=ht.val();s(Et?{...Et,id:e}:null),_(!1)}catch{rt("Failed to fetch kitchen"),_(!1)}});return()=>dt()},[e]),{kitchen:i,loading:a,error:$}}function useDishes(e){const[i,s]=reactExports.useState([]),[a,_]=reactExports.useState(!0),[$,rt]=reactExports.useState(null);return reactExports.useEffect(()=>{if(!e){_(!1);return}const c=ref(database,"dishes"),dt=onValue(c,ht=>{try{const Et=ht.val();if(Et){const St=Object.entries(Et).map(([At,Pt])=>({...Pt,id:At})).filter(At=>At.kitchenId===e);s(St)}else s([]);_(!1)}catch{rt("Failed to fetch dishes"),_(!1)}});return()=>dt()},[e]),{dishes:i,loading:a,error:$}}function useUserOrders(e){const[i,s]=reactExports.useState([]),[a,_]=reactExports.useState(!0),[$,rt]=reactExports.useState(null);return reactExports.useEffect(()=>{if(!e){_(!1);return}const c=ref(database,"orders"),dt=onValue(c,ht=>{try{const Et=ht.val();if(Et){const St=Object.entries(Et).map(([At,Pt])=>({...Pt,id:At})).filter(At=>At.userId===e).sort((At,Pt)=>Pt.createdAt-At.createdAt);s(St)}else s([]);_(!1)}catch{rt("Failed to fetch orders"),_(!1)}});return()=>dt()},[e]),{orders:i,loading:a,error:$}}async function createKitchen(e){const i=ref(database,"kitchens"),s=push(i);return await set(s,e),s.key}async function updateKitchen(e,i){const s=ref(database,`kitchens/${e}`);await update(s,i)}async function createDish(e){const i=ref(database,"dishes"),s=push(i);return await set(s,e),s.key}async function deleteDish(e){const i=ref(database,`dishes/${e}`);await remove(i)}async function createOrder(e){const i=ref(database,"orders"),s=push(i);return await set(s,e),s.key}async function createNotification(e){const i=ref(database,"notifications"),s=push(i);return await set(s,e),s.key}async function markNotificationAsRead(e){const i=ref(database,`notifications/${e}`);await update(i,{read:!0})}async function updateOrderStatus(e,i){const s=ref(database,`orders/${e}`);await update(s,{status:i,updatedAt:Date.now()});try{const a=await get(s);if(a.exists()){const _=a.val();let $=`Your order status has been updated to ${i}`,rt="Order Update";switch(i){case"accepted":$=`Yay! ${_.kitchenName} has accepted your order.`;break;case"cooking":$=`${_.kitchenName} is now preparing your delicious food.`;break;case"packed":$="Your order is packed and ready!";break;case"out_for_delivery":$="Your order is on the way!";break;case"delivered":$="Order delivered via Amma Cheythi Vanta. Enjoy your meal!";break;case"cancelled":$="Your order has been cancelled.",rt="Order Cancelled";break}i!=="pending"&&await createNotification({userId:_.userId,title:rt,message:$,type:"order",link:"/orders",read:!1,createdAt:Date.now()})}}catch(a){console.error("Failed to send notification",a)}}async function createCoupon(e){const i=ref(database,"coupons"),s=push(i);return await set(s,e),s.key}async function updateCoupon(e,i){const s=ref(database,`coupons/${e}`);await update(s,i)}async function deleteCoupon(e){const i=ref(database,`coupons/${e}`);await remove(i)}async function getCouponByCode(e){const i=ref(database,"coupons"),s=await get(i);if(s.exists()){const a=s.val(),_=Object.values(a).find($=>$.code===e);if(_)return _}return null}function useCoupons(e){const[i,s]=reactExports.useState([]),[a,_]=reactExports.useState(!0);return reactExports.useEffect(()=>{if(!e){_(!1);return}const $=ref(database,"coupons"),rt=onValue($,c=>{const dt=c.val();if(dt){const ht=Object.entries(dt).map(([Et,St])=>({...St,id:Et})).filter(Et=>Et.kitchenId===e&&Et.isActive).sort((Et,St)=>St.createdAt-Et.createdAt);s(ht)}else s([]);_(!1)});return()=>rt()},[e]),{coupons:i,loading:a}}async function submitReview(e){const i=ref(database,"reviews"),s=push(i);await set(s,e);const a=ref(database,`orders/${e.orderId}`);await update(a,{isReviewed:!0});const _=ref(database,`kitchens/${e.kitchenId}`),$=await get(_);if($.exists()){const rt=$.val(),c=rt.rating||0,dt=rt.totalRatings||0,ht=dt+1,Et=(c*dt+e.kitchenRating)/ht;await update(_,{rating:Et,totalRatings:ht})}if(e.itemRatings){const rt=[];for(const[c,dt]of Object.entries(e.itemRatings)){const ht=ref(database,`dishes/${c}`);rt.push(get(ht).then(Et=>{if(Et.exists()){const St=Et.val(),At=St.rating||0,Pt=St.totalRatings||0,Vt=Pt+1,Bt=(At*Pt+dt)/Vt;return update(ht,{rating:Bt,totalRatings:Vt})}}))}await Promise.all(rt)}return s.key}async function createWithdrawalRequest(e){const i=ref(database,"withdrawals"),s=push(i);return await set(s,e),s.key}function useKitchenWithdrawals(e){const[i,s]=reactExports.useState([]),[a,_]=reactExports.useState(!0);return reactExports.useEffect(()=>{if(!e){_(!1);return}const $=ref(database,"withdrawals"),rt=onValue($,c=>{const dt=c.val();if(dt){const ht=Object.entries(dt).map(([Et,St])=>({...St,id:Et})).filter(Et=>Et.kitchenId===e).sort((Et,St)=>St.requestedAt-Et.requestedAt);s(ht)}else s([]);_(!1)});return()=>rt()},[e]),{withdrawals:i,loading:a}}const buttonVariants=cva("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),Button=reactExports.forwardRef(({className:e,variant:i,size:s,asChild:a=!1,..._},$)=>{const rt=a?Slot$2:"button";return jsxRuntimeExports.jsx(rt,{className:cn(buttonVariants({variant:i,size:s,className:e})),ref:$,..._})});Button.displayName="Button";function BottomNav(){const e=useLocation(),{getItemCount:i}=useCart(),s=i(),a=[{icon:House,label:"Home",path:"/"},{icon:Search,label:"Search",path:"/search"},{icon:ChefHat,label:"Cart",path:"/cart",count:s},{icon:ShoppingBag,label:"Orders",path:"/orders"},{icon:User,label:"Profile",path:"/profile"}];return jsxRuntimeExports.jsx("div",{className:"fixed bottom-0 left-0 right-0 z-50 pointer-events-none safe-bottom",children:jsxRuntimeExports.jsx("nav",{className:"pointer-events-auto mx-4 mb-4 bg-background/80 backdrop-blur-lg border border-white/20 shadow-elevated rounded-2xl overflow-hidden",children:jsxRuntimeExports.jsx("div",{className:"flex items-center justify-between px-2 py-2 max-w-lg mx-auto relative",children:a.map(_=>{const $=e.pathname===_.path,rt=_.icon;return jsxRuntimeExports.jsx(Link,{to:_.path,className:"relative flex-1 group",children:jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center py-2",children:[$&&jsxRuntimeExports.jsx(motion.div,{layoutId:"navBubble",className:"absolute inset-x-2 inset-y-1 bg-primary/15 rounded-xl -z-10",transition:{type:"spring",bounce:.2,duration:.6}}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx(motion.div,{animate:{scale:$?1.2:1,y:$?-2:0},transition:{type:"spring",stiffness:400,damping:10},children:jsxRuntimeExports.jsx(rt,{className:cn("w-5 h-5 transition-all duration-300",$?"text-primary fill-primary/20":"text-muted-foreground group-hover:text-foreground"),strokeWidth:$?2.5:2})}),_.count!==void 0&&_.count>0&&jsxRuntimeExports.jsx(motion.span,{initial:{scale:0},animate:{scale:1},className:"absolute -top-2 -right-2 w-4 h-4 rounded-full bg-destructive text-destructive-foreground text-[10px] font-bold flex items-center justify-center ring-2 ring-background shadow-sm",children:_.count>9?"9+":_.count})]}),jsxRuntimeExports.jsx(motion.span,{initial:!1,animate:{opacity:$?1:.6,scale:$?1:.9,y:$?0:2},className:cn("text-[10px] font-medium mt-1 transition-colors duration-300",$?"text-primary font-bold":"text-muted-foreground"),children:_.label}),$&&jsxRuntimeExports.jsx(motion.div,{layoutId:"navDot",className:"absolute bottom-1 w-1 h-1 rounded-full bg-primary",transition:{type:"spring",bounce:.2,duration:.6}})]})},_.path)})})})})}function OutOfZoneScreen(){const{userLocation:e,refetchLocation:i,locationLoading:s}=useLocationContext();return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background flex flex-col items-center justify-center px-6 text-center",children:[jsxRuntimeExports.jsx(motion.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},className:"w-24 h-24 rounded-full bg-destructive/10 flex items-center justify-center mb-6",children:jsxRuntimeExports.jsx(TriangleAlert,{className:"w-12 h-12 text-destructive"})}),jsxRuntimeExports.jsx(motion.h1,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.1},className:"text-2xl font-bold text-foreground mb-3",children:"Service Not Available"}),jsxRuntimeExports.jsx(motion.p,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.2},className:"text-muted-foreground mb-6 max-w-sm",children:"Sorry, Amma Cheythi Vanta is not yet available in your area. We're expanding soon!"}),e&&jsxRuntimeExports.jsx(motion.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.3},className:"bg-secondary rounded-xl p-4 mb-6 w-full max-w-sm",children:jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-3",children:[jsxRuntimeExports.jsx(MapPin,{className:"w-5 h-5 text-muted-foreground mt-0.5"}),jsxRuntimeExports.jsxs("div",{className:"text-left",children:[jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Your location"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-foreground",children:e.address})]})]})}),jsxRuntimeExports.jsx(motion.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.4},children:jsxRuntimeExports.jsxs(Button,{variant:"outline",onClick:i,disabled:s,className:"gap-2",children:[jsxRuntimeExports.jsx(RefreshCw,{className:`w-4 h-4 ${s?"animate-spin":""}`}),"Refresh Location"]})}),jsxRuntimeExports.jsx(motion.p,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.5},className:"text-xs text-muted-foreground mt-8",children:"If you think this is an error, please allow location access and try again."})]})}const categories$1=[{id:"biryani",name:"Biryani",image:"https://images.unsplash.com/photo-1563379091339-03b21ab4a4f8?w=400&q=80"},{id:"tiffins",name:"Tiffins",image:"https://images.unsplash.com/photo-1589301760014-d929f3979dbc?w=400&q=80"},{id:"thali",name:"Thali",image:"https://images.unsplash.com/photo-1574484284002-952d92456975?w=400&q=80"},{id:"curries",name:"Curries",image:"https://images.unsplash.com/photo-1545247181-516773cae754?w=400&q=80"},{id:"sweets",name:"Sweets",image:"https://img.freepik.com/premium-photo/indian-festival-assorted-sweet-food-mithai-white-background_466689-64857.jpg"},{id:"snacks",name:"Snacks",image:"https://images.unsplash.com/photo-1626082927389-6cd097cdc6ec?w=400&q=80"},{id:"rice",name:"Rice",image:"https://images.unsplash.com/photo-1512058564366-18510be2db19?w=400&q=80"},{id:"pickles",name:"Pickles",image:"https://media.istockphoto.com/id/528476560/photo/mango-pickle.jpg?s=612x612&w=0&k=20&c=1Hi9BzNeMEfKkBOMniMyxWF4mVs8LXrE-qHEu3F_R5M="}];function Categories({onSelectCategory:e,selectedCategory:i}){const s={hidden:{opacity:0},show:{opacity:1,transition:{staggerChildren:.1}}},a={hidden:{opacity:0,scale:.8},show:{opacity:1,scale:1}};return jsxRuntimeExports.jsxs("div",{className:"w-full",children:[jsxRuntimeExports.jsx("div",{className:"flex items-center justify-between mb-3 px-1",children:jsxRuntimeExports.jsx("h3",{className:"font-semibold text-lg",children:"What's on your mind?"})}),jsxRuntimeExports.jsx(motion.div,{variants:s,initial:"hidden",animate:"show",className:"grid grid-cols-4 gap-x-4 gap-y-6",children:categories$1.map(_=>{const $=(i==null?void 0:i.toLowerCase())===_.name.toLowerCase();return jsxRuntimeExports.jsxs(motion.button,{variants:a,whileTap:{scale:.9},onClick:()=>e==null?void 0:e(_.name),className:"flex flex-col items-center gap-2 group w-full",children:[jsxRuntimeExports.jsxs("div",{className:`relative w-full aspect-square rounded-2xl overflow-hidden shadow-sm transition-all duration-300 ${$?"ring-4 ring-[#FFD700] ring-offset-2 ring-offset-background shadow-xl scale-105":"ring-1 ring-border/50 group-hover:ring-primary/50 group-hover:shadow-md"}`,children:[jsxRuntimeExports.jsx("img",{src:_.image,alt:_.name,className:"w-full h-full object-cover transition-transform duration-500 group-hover:scale-110",loading:"lazy"}),jsxRuntimeExports.jsx("div",{className:`absolute inset-0 bg-gradient-to-t from-black/40 to-transparent transition-opacity ${$?"opacity-100":"opacity-0 group-hover:opacity-100"}`})]}),jsxRuntimeExports.jsx("span",{className:`text-[11px] sm:text-xs font-medium text-center truncate w-full transition-colors ${$?"text-primary font-bold":"text-foreground/90 group-hover:text-primary"}`,children:_.name})]},_.id)})})]})}function useAmmaKitchens(e){const[i,s]=reactExports.useState([]),[a,_]=reactExports.useState(!0),[$,rt]=reactExports.useState(null);return reactExports.useEffect(()=>{if(!e){_(!1);return}const c=ref(database,"kitchens"),dt=onValue(c,ht=>{try{const Et=ht.val();if(Et){const St=Object.entries(Et).map(([At,Pt])=>({...Pt,id:At})).filter(At=>At.ownerId===e);s(St)}else s([]);_(!1)}catch{rt("Failed to fetch kitchens"),_(!1)}});return()=>dt()},[e]),{kitchens:i,loading:a,error:$}}function useKitchenOrders(e){const[i,s]=reactExports.useState([]),[a,_]=reactExports.useState(!0),[$,rt]=reactExports.useState(null);return reactExports.useEffect(()=>{if(!e){_(!1);return}const c=ref(database,"orders"),dt=onValue(c,ht=>{try{const Et=ht.val();if(Et){const St=Object.entries(Et).map(([At,Pt])=>({...Pt,id:At})).filter(At=>At.kitchenId===e).sort((At,Pt)=>Pt.createdAt-At.createdAt);s(St)}else s([]);_(!1)}catch{rt("Failed to fetch orders"),_(!1)}});return()=>dt()},[e]),{orders:i,loading:a,error:$}}function useAllKitchens(){const[e,i]=reactExports.useState([]),[s,a]=reactExports.useState(!0),[_,$]=reactExports.useState(null);return reactExports.useEffect(()=>{const rt=ref(database,"kitchens"),c=onValue(rt,dt=>{try{const ht=dt.val();if(ht){const Et=Object.entries(ht).map(([St,At])=>({...At,id:St}));i(Et)}else i([]);a(!1)}catch{$("Failed to fetch kitchens"),a(!1)}});return()=>c()},[]),{kitchens:e,loading:s,error:_}}function useAllOrders(){const[e,i]=reactExports.useState([]),[s,a]=reactExports.useState(!0),[_,$]=reactExports.useState(null);return reactExports.useEffect(()=>{const rt=ref(database,"orders"),c=onValue(rt,dt=>{try{const ht=dt.val();if(ht){const Et=Object.entries(ht).map(([St,At])=>({...At,id:St})).sort((St,At)=>At.createdAt-St.createdAt);i(Et)}else i([]);a(!1)}catch{$("Failed to fetch orders"),a(!1)}});return()=>c()},[]),{orders:e,loading:s,error:_}}function useAllUsers(){const[e,i]=reactExports.useState([]),[s,a]=reactExports.useState(!0),[_,$]=reactExports.useState(null);return reactExports.useEffect(()=>{const rt=ref(database,"users"),c=onValue(rt,dt=>{try{const ht=dt.val();if(ht){const Et=Object.entries(ht).map(([St,At])=>({...At,id:St}));i(Et)}else i([]);a(!1)}catch{$("Failed to fetch users"),a(!1)}});return()=>c()},[]),{users:e,loading:s,error:_}}function useAllDishes(){const[e,i]=reactExports.useState([]),[s,a]=reactExports.useState(!0),[_,$]=reactExports.useState(null);return reactExports.useEffect(()=>{const rt=ref(database,"dishes"),c=onValue(rt,dt=>{try{const ht=dt.val();if(ht){const Et=Object.entries(ht).map(([St,At])=>({...At,id:St}));i(Et)}else i([]);a(!1)}catch{$("Failed to fetch dishes"),a(!1)}});return()=>c()},[]),{dishes:e,loading:s,error:_}}async function approveKitchen(e){const i=ref(database,`kitchens/${e}`);await update(i,{isApproved:!0})}async function rejectKitchen(e){const i=ref(database,`kitchens/${e}`);await remove(i)}async function deleteUser(e){const i=ref(database,`users/${e}`);await remove(i)}async function updateUserRole(e,i,s){const a=ref(database,`users/${e}`);if(s&&s!==i){if(s==="amma"){const _=ref(database,"kitchens"),rt=(await new Promise((c,dt)=>{onValue(_,c,{onlyOnce:!0})})).val();if(rt){const c=[];Object.entries(rt).forEach(([dt,ht])=>{ht.ownerId===e&&(c.push(remove(ref(database,`kitchens/${dt}`))),c.push(deleteKitchenDishes(dt)))}),await Promise.all(c)}}if(s==="franchise_admin"){const _=ref(database,"franchises"),rt=(await new Promise((c,dt)=>{onValue(_,c,{onlyOnce:!0})})).val();if(rt){const c=[];Object.entries(rt).forEach(([dt,ht])=>{ht.adminId===e&&c.push(update(ref(database,`franchises/${dt}`),{adminId:"",adminName:"",adminEmail:""}))}),await Promise.all(c)}await update(a,{franchiseId:null})}}await update(a,{role:i})}async function updateDish(e,i){const s=ref(database,`dishes/${e}`);await update(s,i)}async function deleteKitchenDishes(e){const i=ref(database,"dishes"),a=(await new Promise((_,$)=>{onValue(i,_,{onlyOnce:!0})})).val();if(a){const _=[];Object.entries(a).forEach(([$,rt])=>{rt.kitchenId===e&&_.push(remove(ref(database,`dishes/${$}`)))}),await Promise.all(_)}}function useAllWithdrawals(){const[e,i]=reactExports.useState([]),[s,a]=reactExports.useState(!0);return reactExports.useEffect(()=>{const _=ref(database,"withdrawals"),$=onValue(_,rt=>{const c=rt.val();if(c){const dt=Object.entries(c).map(([ht,Et])=>({...Et,id:ht})).sort((ht,Et)=>Et.requestedAt-ht.requestedAt);i(dt)}else i([]);a(!1)});return()=>$()},[]),{withdrawals:e,loading:s}}async function updateWithdrawalStatus(e,i,s){const a=ref(database,`withdrawals/${e}`),_={status:i,processedAt:Date.now()};s!=null&&s.transactionId&&(_.transactionId=s.transactionId),s!=null&&s.adminNote&&(_.adminNote=s.adminNote),await update(a,_)}function DishCard({dish:e,kitchenId:i,kitchenName:s,className:a,variant:_="default"}){const{cart:$,addToCart:rt,updateQuantity:c,removeFromCart:dt}=useCart(),ht=$.items.find(Bt=>Bt.dish.id===e.id),Et=(ht==null?void 0:ht.quantity)||0,St=()=>{rt(e,i,s)},At=()=>{c(e.id,Et+1)},Pt=()=>{Et<=1?dt(e.id):c(e.id,Et-1)},Vt=jsxRuntimeExports.jsx(AnimatePresence,{mode:"wait",children:Et===0?jsxRuntimeExports.jsx(motion.div,{initial:{scale:.8},animate:{scale:1},exit:{scale:.8},className:_==="compact"?"w-full":"",children:jsxRuntimeExports.jsx(Button,{onClick:St,size:"sm",className:cn("gradient-primary text-primary-foreground font-semibold rounded-lg shadow-soft",_==="compact"?"w-full":"px-6"),children:"ADD"})},"add"):jsxRuntimeExports.jsxs(motion.div,{initial:{scale:.8},animate:{scale:1},exit:{scale:.8},className:cn("flex items-center gap-1 bg-primary rounded-lg shadow-soft",_==="compact"?"w-full justify-between":""),children:[jsxRuntimeExports.jsx(Button,{onClick:Pt,size:"icon",variant:"ghost",className:"h-8 w-8 text-primary-foreground hover:bg-primary/80",children:jsxRuntimeExports.jsx(Minus,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx("span",{className:"font-bold text-primary-foreground px-2 min-w-[24px] text-center",children:Et}),jsxRuntimeExports.jsx(Button,{onClick:At,size:"icon",variant:"ghost",className:"h-8 w-8 text-primary-foreground hover:bg-primary/80",children:jsxRuntimeExports.jsx(Plus,{className:"w-4 h-4"})})]},"quantity")});return jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},className:cn("bg-card rounded-xl shadow-card overflow-hidden",_==="compact"?"flex flex-col-reverse p-0":"flex gap-4 p-4",a),children:[jsxRuntimeExports.jsxs("div",{className:cn("flex-1 min-w-0",_==="compact"?"p-3 pt-0 flex flex-col justify-between":""),children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[jsxRuntimeExports.jsx("div",{className:cn("w-4 h-4 border-2 rounded-sm flex items-center justify-center",e.isVeg?"border-veg":"border-non-veg"),children:jsxRuntimeExports.jsx("div",{className:cn("w-2 h-2 rounded-full",e.isVeg?"bg-veg":"bg-non-veg")})}),jsxRuntimeExports.jsx("span",{className:cn("text-xs font-medium",e.isVeg?"text-veg":"text-non-veg"),children:e.isVeg?"Pure Veg":"Non Veg"})]}),jsxRuntimeExports.jsx("h3",{className:cn("font-semibold text-foreground mb-1 truncate capitalize",_==="compact"?"text-sm":"text-base"),children:e.name}),jsxRuntimeExports.jsx("p",{className:"text-muted-foreground text-sm mb-2 line-clamp-2 text-xs",children:e.description}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[jsxRuntimeExports.jsxs("span",{className:"font-bold text-foreground",children:["",e.price]}),e.originalPrice&&e.originalPrice>e.price&&jsxRuntimeExports.jsxs("span",{className:"text-sm text-muted-foreground line-through",children:["",e.originalPrice]})]})]}),_==="compact"&&e.isAvailable&&jsxRuntimeExports.jsx("div",{className:"mt-auto",children:Vt})]}),jsxRuntimeExports.jsxs("div",{className:cn("relative flex-shrink-0",_==="compact"?"w-full h-32 mb-2":""),children:[jsxRuntimeExports.jsx(CachedImage,{src:e.image,alt:e.name,className:cn("object-cover",_==="compact"?"w-full h-full":"w-24 h-24 rounded-xl")}),e.rating&&e.rating>0&&jsxRuntimeExports.jsxs("div",{className:"absolute top-2 right-2 bg-black/60 backdrop-blur-md px-1 py-[1px] rounded flex items-center gap-0.5 shadow-sm border border-white/10",children:[jsxRuntimeExports.jsx(Star,{className:"w-2 h-2 fill-gold text-gold"}),jsxRuntimeExports.jsx("span",{className:"text-[7px] font-bold text-white leading-tight",children:e.rating.toFixed(1)})]}),e.isAvailable?_!=="compact"&&jsxRuntimeExports.jsx("div",{className:"absolute -bottom-3 left-1/2 -translate-x-1/2",children:Vt}):jsxRuntimeExports.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-muted/90 text-muted-foreground text-xs text-center py-1",children:"Sold Out"})]})]})}function Skeleton({className:e}){return jsxRuntimeExports.jsx("div",{className:cn("animate-pulse-soft rounded-lg bg-muted",e)})}function CompactDishCardSkeleton(){return jsxRuntimeExports.jsxs("div",{className:"flex flex-col h-full bg-card rounded-xl shadow-card overflow-hidden min-w-[160px] max-w-[160px]",children:[jsxRuntimeExports.jsx(Skeleton,{className:"h-32 w-full rounded-none flex-shrink-0"}),jsxRuntimeExports.jsxs("div",{className:"p-3 flex-1 flex flex-col justify-between gap-2",children:[jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsx(Skeleton,{className:"h-4 w-3/4"}),jsxRuntimeExports.jsx(Skeleton,{className:"h-3 w-full"})]}),jsxRuntimeExports.jsx(Skeleton,{className:"h-8 w-full rounded-lg"})]})]})}function BestSellingSection(){const{dishes:e,loading:i}=useAllDishes(),{kitchens:s}=useKitchens(),{currentFranchiseId:a}=useLocationContext();if(i)return jsxRuntimeExports.jsxs("div",{className:"py-2",children:[jsxRuntimeExports.jsx("div",{className:"px-4 mb-3 flex items-center gap-2",children:jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold text-foreground",children:"Best Sellers"})}),jsxRuntimeExports.jsx("div",{className:"flex gap-4 overflow-x-auto px-4 pb-4 hide-scrollbar snap-x snap-mandatory",children:[1,2,3,4].map(rt=>jsxRuntimeExports.jsx("div",{className:"min-w-[160px] max-w-[160px] snap-center",children:jsxRuntimeExports.jsx(CompactDishCardSkeleton,{})},rt))})]});const _=new Map;s.forEach(rt=>{rt.isApproved&&rt.franchiseId===a&&_.set(rt.id,rt)});const $=e.filter(rt=>rt.isBestSeller&&_.has(rt.kitchenId));return $.length===0?null:jsxRuntimeExports.jsxs("div",{className:"py-2",children:[jsxRuntimeExports.jsx("div",{className:"px-4 mb-3 flex items-center gap-2",children:jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold text-foreground",children:"Best Sellers"})}),jsxRuntimeExports.jsx("div",{className:"flex gap-4 overflow-x-auto px-4 pb-4 hide-scrollbar snap-x snap-mandatory",children:$.map(rt=>{const c=_.get(rt.kitchenId);return jsxRuntimeExports.jsx("div",{className:"min-w-[160px] max-w-[160px] snap-center flex flex-col",children:jsxRuntimeExports.jsx(DishCard,{dish:rt,kitchenId:rt.kitchenId,kitchenName:(c==null?void 0:c.name)||"Unknown Kitchen",className:"h-full",variant:"compact"})},rt.id)})})]})}var lottie$1={exports:{}};(function(module,exports){typeof document<"u"&&typeof navigator<"u"&&function(e,i){module.exports=i()}(commonjsGlobal,function(){var svgNS="http://www.w3.org/2000/svg",locationHref="",_useWebWorker=!1,initialDefaultFrame=-999999,setWebWorker=function(i){_useWebWorker=!!i},getWebWorker=function(){return _useWebWorker},setLocationHref=function(i){locationHref=i},getLocationHref=function(){return locationHref};function createTag(e){return document.createElement(e)}function extendPrototype(e,i){var s,a=e.length,_;for(s=0;s<a;s+=1){_=e[s].prototype;for(var $ in _)Object.prototype.hasOwnProperty.call(_,$)&&(i.prototype[$]=_[$])}}function getDescriptor(e,i){return Object.getOwnPropertyDescriptor(e,i)}function createProxyFunction(e){function i(){}return i.prototype=e,i}var audioControllerFactory=function(){function e(i){this.audios=[],this.audioFactory=i,this._volume=1,this._isMuted=!1}return e.prototype={addAudio:function(s){this.audios.push(s)},pause:function(){var s,a=this.audios.length;for(s=0;s<a;s+=1)this.audios[s].pause()},resume:function(){var s,a=this.audios.length;for(s=0;s<a;s+=1)this.audios[s].resume()},setRate:function(s){var a,_=this.audios.length;for(a=0;a<_;a+=1)this.audios[a].setRate(s)},createAudio:function(s){return this.audioFactory?this.audioFactory(s):window.Howl?new window.Howl({src:[s]}):{isPlaying:!1,play:function(){this.isPlaying=!0},seek:function(){this.isPlaying=!1},playing:function(){},rate:function(){},setVolume:function(){}}},setAudioFactory:function(s){this.audioFactory=s},setVolume:function(s){this._volume=s,this._updateVolume()},mute:function(){this._isMuted=!0,this._updateVolume()},unmute:function(){this._isMuted=!1,this._updateVolume()},getVolume:function(){return this._volume},_updateVolume:function(){var s,a=this.audios.length;for(s=0;s<a;s+=1)this.audios[s].volume(this._volume*(this._isMuted?0:1))}},function(){return new e}}(),createTypedArray=function(){function e(s,a){var _=0,$=[],rt;switch(s){case"int16":case"uint8c":rt=1;break;default:rt=1.1;break}for(_=0;_<a;_+=1)$.push(rt);return $}function i(s,a){return s==="float32"?new Float32Array(a):s==="int16"?new Int16Array(a):s==="uint8c"?new Uint8ClampedArray(a):e(s,a)}return typeof Uint8ClampedArray=="function"&&typeof Float32Array=="function"?i:e}();function createSizedArray(e){return Array.apply(null,{length:e})}function _typeof$6(e){"@babel/helpers - typeof";return _typeof$6=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},_typeof$6(e)}var subframeEnabled=!0,expressionsPlugin=null,expressionsInterfaces=null,idPrefix$1="",isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),bmPow=Math.pow,bmSqrt=Math.sqrt,bmFloor=Math.floor,bmMax=Math.max,bmMin=Math.min,BMMath={};(function(){var e=["abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","cbrt","expm1","clz32","cos","cosh","exp","floor","fround","hypot","imul","log","log1p","log2","log10","max","min","pow","random","round","sign","sin","sinh","sqrt","tan","tanh","trunc","E","LN10","LN2","LOG10E","LOG2E","PI","SQRT1_2","SQRT2"],i,s=e.length;for(i=0;i<s;i+=1)BMMath[e[i]]=Math[e[i]]})(),BMMath.random=Math.random,BMMath.abs=function(e){var i=_typeof$6(e);if(i==="object"&&e.length){var s=createSizedArray(e.length),a,_=e.length;for(a=0;a<_;a+=1)s[a]=Math.abs(e[a]);return s}return Math.abs(e)};var defaultCurveSegments=150,degToRads=Math.PI/180,roundCorner=.5519;function styleDiv(e){e.style.position="absolute",e.style.top=0,e.style.left=0,e.style.display="block",e.style.transformOrigin="0 0",e.style.webkitTransformOrigin="0 0",e.style.backfaceVisibility="visible",e.style.webkitBackfaceVisibility="visible",e.style.transformStyle="preserve-3d",e.style.webkitTransformStyle="preserve-3d",e.style.mozTransformStyle="preserve-3d"}function BMEnterFrameEvent(e,i,s,a){this.type=e,this.currentTime=i,this.totalTime=s,this.direction=a<0?-1:1}function BMCompleteEvent(e,i){this.type=e,this.direction=i<0?-1:1}function BMCompleteLoopEvent(e,i,s,a){this.type=e,this.currentLoop=s,this.totalLoops=i,this.direction=a<0?-1:1}function BMSegmentStartEvent(e,i,s){this.type=e,this.firstFrame=i,this.totalFrames=s}function BMDestroyEvent(e,i){this.type=e,this.target=i}function BMRenderFrameErrorEvent(e,i){this.type="renderFrameError",this.nativeError=e,this.currentTime=i}function BMConfigErrorEvent(e){this.type="configError",this.nativeError=e}var createElementID=function(){var e=0;return function(){return e+=1,idPrefix$1+"__lottie_element_"+e}}();function HSVtoRGB(e,i,s){var a,_,$,rt,c,dt,ht,Et;switch(rt=Math.floor(e*6),c=e*6-rt,dt=s*(1-i),ht=s*(1-c*i),Et=s*(1-(1-c)*i),rt%6){case 0:a=s,_=Et,$=dt;break;case 1:a=ht,_=s,$=dt;break;case 2:a=dt,_=s,$=Et;break;case 3:a=dt,_=ht,$=s;break;case 4:a=Et,_=dt,$=s;break;case 5:a=s,_=dt,$=ht;break}return[a,_,$]}function RGBtoHSV(e,i,s){var a=Math.max(e,i,s),_=Math.min(e,i,s),$=a-_,rt,c=a===0?0:$/a,dt=a/255;switch(a){case _:rt=0;break;case e:rt=i-s+$*(i<s?6:0),rt/=6*$;break;case i:rt=s-e+$*2,rt/=6*$;break;case s:rt=e-i+$*4,rt/=6*$;break}return[rt,c,dt]}function addSaturationToRGB(e,i){var s=RGBtoHSV(e[0]*255,e[1]*255,e[2]*255);return s[1]+=i,s[1]>1?s[1]=1:s[1]<=0&&(s[1]=0),HSVtoRGB(s[0],s[1],s[2])}function addBrightnessToRGB(e,i){var s=RGBtoHSV(e[0]*255,e[1]*255,e[2]*255);return s[2]+=i,s[2]>1?s[2]=1:s[2]<0&&(s[2]=0),HSVtoRGB(s[0],s[1],s[2])}function addHueToRGB(e,i){var s=RGBtoHSV(e[0]*255,e[1]*255,e[2]*255);return s[0]+=i/360,s[0]>1?s[0]-=1:s[0]<0&&(s[0]+=1),HSVtoRGB(s[0],s[1],s[2])}var rgbToHex=function(){var e=[],i,s;for(i=0;i<256;i+=1)s=i.toString(16),e[i]=s.length===1?"0"+s:s;return function(a,_,$){return a<0&&(a=0),_<0&&(_=0),$<0&&($=0),"#"+e[a]+e[_]+e[$]}}(),setSubframeEnabled=function(i){subframeEnabled=!!i},getSubframeEnabled=function(){return subframeEnabled},setExpressionsPlugin=function(i){expressionsPlugin=i},getExpressionsPlugin=function(){return expressionsPlugin},setExpressionInterfaces=function(i){expressionsInterfaces=i},getExpressionInterfaces=function(){return expressionsInterfaces},setDefaultCurveSegments=function(i){defaultCurveSegments=i},getDefaultCurveSegments=function(){return defaultCurveSegments},setIdPrefix=function(i){idPrefix$1=i};function createNS(e){return document.createElementNS(svgNS,e)}function _typeof$5(e){"@babel/helpers - typeof";return _typeof$5=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},_typeof$5(e)}var dataManager=function(){var e=1,i=[],s,a,_={onmessage:function(){},postMessage:function(Pt){s({data:Pt})}},$={postMessage:function(Pt){_.onmessage({data:Pt})}};function rt(At){if(window.Worker&&window.Blob&&getWebWorker()){var Pt=new Blob(["var _workerSelf = self; self.onmessage = ",At.toString()],{type:"text/javascript"}),Vt=URL.createObjectURL(Pt);return new Worker(Vt)}return s=At,_}function c(){a||(a=rt(function(Pt){function Vt(){function Zt(Fr,Cr){var Sr,dr,gr=Fr.length,qr,Lr,_n,gn;for(dr=0;dr<gr;dr+=1)if(Sr=Fr[dr],"ks"in Sr&&!Sr.completed){if(Sr.completed=!0,Sr.hasMask){var Sn=Sr.masksProperties;for(Lr=Sn.length,qr=0;qr<Lr;qr+=1)if(Sn[qr].pt.k.i)er(Sn[qr].pt.k);else for(gn=Sn[qr].pt.k.length,_n=0;_n<gn;_n+=1)Sn[qr].pt.k[_n].s&&er(Sn[qr].pt.k[_n].s[0]),Sn[qr].pt.k[_n].e&&er(Sn[qr].pt.k[_n].e[0])}Sr.ty===0?(Sr.layers=Nt(Sr.refId,Cr),Zt(Sr.layers,Cr)):Sr.ty===4?Gt(Sr.shapes):Sr.ty===5&&Jr(Sr)}}function zt(Fr,Cr){if(Fr){var Sr=0,dr=Fr.length;for(Sr=0;Sr<dr;Sr+=1)Fr[Sr].t===1&&(Fr[Sr].data.layers=Nt(Fr[Sr].data.refId,Cr),Zt(Fr[Sr].data.layers,Cr))}}function Ut(Fr,Cr){for(var Sr=0,dr=Cr.length;Sr<dr;){if(Cr[Sr].id===Fr)return Cr[Sr];Sr+=1}return null}function Nt(Fr,Cr){var Sr=Ut(Fr,Cr);return Sr?Sr.layers.__used?JSON.parse(JSON.stringify(Sr.layers)):(Sr.layers.__used=!0,Sr.layers):null}function Gt(Fr){var Cr,Sr=Fr.length,dr,gr;for(Cr=Sr-1;Cr>=0;Cr-=1)if(Fr[Cr].ty==="sh")if(Fr[Cr].ks.k.i)er(Fr[Cr].ks.k);else for(gr=Fr[Cr].ks.k.length,dr=0;dr<gr;dr+=1)Fr[Cr].ks.k[dr].s&&er(Fr[Cr].ks.k[dr].s[0]),Fr[Cr].ks.k[dr].e&&er(Fr[Cr].ks.k[dr].e[0]);else Fr[Cr].ty==="gr"&&Gt(Fr[Cr].it)}function er(Fr){var Cr,Sr=Fr.i.length;for(Cr=0;Cr<Sr;Cr+=1)Fr.i[Cr][0]+=Fr.v[Cr][0],Fr.i[Cr][1]+=Fr.v[Cr][1],Fr.o[Cr][0]+=Fr.v[Cr][0],Fr.o[Cr][1]+=Fr.v[Cr][1]}function ir(Fr,Cr){var Sr=Cr?Cr.split("."):[100,100,100];return Fr[0]>Sr[0]?!0:Sr[0]>Fr[0]?!1:Fr[1]>Sr[1]?!0:Sr[1]>Fr[1]?!1:Fr[2]>Sr[2]?!0:Sr[2]>Fr[2]?!1:null}var or=function(){var Fr=[4,4,14];function Cr(dr){var gr=dr.t.d;dr.t.d={k:[{s:gr,t:0}]}}function Sr(dr){var gr,qr=dr.length;for(gr=0;gr<qr;gr+=1)dr[gr].ty===5&&Cr(dr[gr])}return function(dr){if(ir(Fr,dr.v)&&(Sr(dr.layers),dr.assets)){var gr,qr=dr.assets.length;for(gr=0;gr<qr;gr+=1)dr.assets[gr].layers&&Sr(dr.assets[gr].layers)}}}(),mr=function(){var Fr=[4,7,99];return function(Cr){if(Cr.chars&&!ir(Fr,Cr.v)){var Sr,dr=Cr.chars.length;for(Sr=0;Sr<dr;Sr+=1){var gr=Cr.chars[Sr];gr.data&&gr.data.shapes&&(Gt(gr.data.shapes),gr.data.ip=0,gr.data.op=99999,gr.data.st=0,gr.data.sr=1,gr.data.ks={p:{k:[0,0],a:0},s:{k:[100,100],a:0},a:{k:[0,0],a:0},r:{k:0,a:0},o:{k:100,a:0}},Cr.chars[Sr].t||(gr.data.shapes.push({ty:"no"}),gr.data.shapes[0].it.push({p:{k:[0,0],a:0},s:{k:[100,100],a:0},a:{k:[0,0],a:0},r:{k:0,a:0},o:{k:100,a:0},sk:{k:0,a:0},sa:{k:0,a:0},ty:"tr"})))}}}}(),Rr=function(){var Fr=[5,7,15];function Cr(dr){var gr=dr.t.p;typeof gr.a=="number"&&(gr.a={a:0,k:gr.a}),typeof gr.p=="number"&&(gr.p={a:0,k:gr.p}),typeof gr.r=="number"&&(gr.r={a:0,k:gr.r})}function Sr(dr){var gr,qr=dr.length;for(gr=0;gr<qr;gr+=1)dr[gr].ty===5&&Cr(dr[gr])}return function(dr){if(ir(Fr,dr.v)&&(Sr(dr.layers),dr.assets)){var gr,qr=dr.assets.length;for(gr=0;gr<qr;gr+=1)dr.assets[gr].layers&&Sr(dr.assets[gr].layers)}}}(),on=function(){var Fr=[4,1,9];function Cr(dr){var gr,qr=dr.length,Lr,_n;for(gr=0;gr<qr;gr+=1)if(dr[gr].ty==="gr")Cr(dr[gr].it);else if(dr[gr].ty==="fl"||dr[gr].ty==="st")if(dr[gr].c.k&&dr[gr].c.k[0].i)for(_n=dr[gr].c.k.length,Lr=0;Lr<_n;Lr+=1)dr[gr].c.k[Lr].s&&(dr[gr].c.k[Lr].s[0]/=255,dr[gr].c.k[Lr].s[1]/=255,dr[gr].c.k[Lr].s[2]/=255,dr[gr].c.k[Lr].s[3]/=255),dr[gr].c.k[Lr].e&&(dr[gr].c.k[Lr].e[0]/=255,dr[gr].c.k[Lr].e[1]/=255,dr[gr].c.k[Lr].e[2]/=255,dr[gr].c.k[Lr].e[3]/=255);else dr[gr].c.k[0]/=255,dr[gr].c.k[1]/=255,dr[gr].c.k[2]/=255,dr[gr].c.k[3]/=255}function Sr(dr){var gr,qr=dr.length;for(gr=0;gr<qr;gr+=1)dr[gr].ty===4&&Cr(dr[gr].shapes)}return function(dr){if(ir(Fr,dr.v)&&(Sr(dr.layers),dr.assets)){var gr,qr=dr.assets.length;for(gr=0;gr<qr;gr+=1)dr.assets[gr].layers&&Sr(dr.assets[gr].layers)}}}(),un=function(){var Fr=[4,4,18];function Cr(dr){var gr,qr=dr.length,Lr,_n;for(gr=qr-1;gr>=0;gr-=1)if(dr[gr].ty==="sh")if(dr[gr].ks.k.i)dr[gr].ks.k.c=dr[gr].closed;else for(_n=dr[gr].ks.k.length,Lr=0;Lr<_n;Lr+=1)dr[gr].ks.k[Lr].s&&(dr[gr].ks.k[Lr].s[0].c=dr[gr].closed),dr[gr].ks.k[Lr].e&&(dr[gr].ks.k[Lr].e[0].c=dr[gr].closed);else dr[gr].ty==="gr"&&Cr(dr[gr].it)}function Sr(dr){var gr,qr,Lr=dr.length,_n,gn,Sn,Fs;for(qr=0;qr<Lr;qr+=1){if(gr=dr[qr],gr.hasMask){var rs=gr.masksProperties;for(gn=rs.length,_n=0;_n<gn;_n+=1)if(rs[_n].pt.k.i)rs[_n].pt.k.c=rs[_n].cl;else for(Fs=rs[_n].pt.k.length,Sn=0;Sn<Fs;Sn+=1)rs[_n].pt.k[Sn].s&&(rs[_n].pt.k[Sn].s[0].c=rs[_n].cl),rs[_n].pt.k[Sn].e&&(rs[_n].pt.k[Sn].e[0].c=rs[_n].cl)}gr.ty===4&&Cr(gr.shapes)}}return function(dr){if(ir(Fr,dr.v)&&(Sr(dr.layers),dr.assets)){var gr,qr=dr.assets.length;for(gr=0;gr<qr;gr+=1)dr.assets[gr].layers&&Sr(dr.assets[gr].layers)}}}();function jr(Fr){Fr.__complete||(on(Fr),or(Fr),mr(Fr),Rr(Fr),un(Fr),Zt(Fr.layers,Fr.assets),zt(Fr.chars,Fr.assets),Fr.__complete=!0)}function Jr(Fr){Fr.t.a.length===0&&"m"in Fr.t.p}var fn={};return fn.completeData=jr,fn.checkColors=on,fn.checkChars=mr,fn.checkPathProperties=Rr,fn.checkShapes=un,fn.completeLayers=Zt,fn}if($.dataManager||($.dataManager=Vt()),$.assetLoader||($.assetLoader=function(){function Zt(Ut){var Nt=Ut.getResponseHeader("content-type");return Nt&&Ut.responseType==="json"&&Nt.indexOf("json")!==-1||Ut.response&&_typeof$5(Ut.response)==="object"?Ut.response:Ut.response&&typeof Ut.response=="string"?JSON.parse(Ut.response):Ut.responseText?JSON.parse(Ut.responseText):null}function zt(Ut,Nt,Gt,er){var ir,or=new XMLHttpRequest;try{or.responseType="json"}catch{}or.onreadystatechange=function(){if(or.readyState===4)if(or.status===200)ir=Zt(or),Gt(ir);else try{ir=Zt(or),Gt(ir)}catch(mr){er&&er(mr)}};try{or.open(["G","E","T"].join(""),Ut,!0)}catch{or.open(["G","E","T"].join(""),Nt+"/"+Ut,!0)}or.send()}return{load:zt}}()),Pt.data.type==="loadAnimation")$.assetLoader.load(Pt.data.path,Pt.data.fullPath,function(Zt){$.dataManager.completeData(Zt),$.postMessage({id:Pt.data.id,payload:Zt,status:"success"})},function(){$.postMessage({id:Pt.data.id,status:"error"})});else if(Pt.data.type==="complete"){var Bt=Pt.data.animation;$.dataManager.completeData(Bt),$.postMessage({id:Pt.data.id,payload:Bt,status:"success"})}else Pt.data.type==="loadData"&&$.assetLoader.load(Pt.data.path,Pt.data.fullPath,function(Zt){$.postMessage({id:Pt.data.id,payload:Zt,status:"success"})},function(){$.postMessage({id:Pt.data.id,status:"error"})})}),a.onmessage=function(At){var Pt=At.data,Vt=Pt.id,Bt=i[Vt];i[Vt]=null,Pt.status==="success"?Bt.onComplete(Pt.payload):Bt.onError&&Bt.onError()})}function dt(At,Pt){e+=1;var Vt="processId_"+e;return i[Vt]={onComplete:At,onError:Pt},Vt}function ht(At,Pt,Vt){c();var Bt=dt(Pt,Vt);a.postMessage({type:"loadAnimation",path:At,fullPath:window.location.origin+window.location.pathname,id:Bt})}function Et(At,Pt,Vt){c();var Bt=dt(Pt,Vt);a.postMessage({type:"loadData",path:At,fullPath:window.location.origin+window.location.pathname,id:Bt})}function St(At,Pt,Vt){c();var Bt=dt(Pt,Vt);a.postMessage({type:"complete",animation:At,id:Bt})}return{loadAnimation:ht,loadData:Et,completeAnimation:St}}(),ImagePreloader=function(){var e=function(){var zt=createTag("canvas");zt.width=1,zt.height=1;var Ut=zt.getContext("2d");return Ut.fillStyle="rgba(0,0,0,0)",Ut.fillRect(0,0,1,1),zt}();function i(){this.loadedAssets+=1,this.loadedAssets===this.totalImages&&this.loadedFootagesCount===this.totalFootages&&this.imagesLoadedCb&&this.imagesLoadedCb(null)}function s(){this.loadedFootagesCount+=1,this.loadedAssets===this.totalImages&&this.loadedFootagesCount===this.totalFootages&&this.imagesLoadedCb&&this.imagesLoadedCb(null)}function a(zt,Ut,Nt){var Gt="";if(zt.e)Gt=zt.p;else if(Ut){var er=zt.p;er.indexOf("images/")!==-1&&(er=er.split("/")[1]),Gt=Ut+er}else Gt=Nt,Gt+=zt.u?zt.u:"",Gt+=zt.p;return Gt}function _(zt){var Ut=0,Nt=setInterval((function(){var Gt=zt.getBBox();(Gt.width||Ut>500)&&(this._imageLoaded(),clearInterval(Nt)),Ut+=1}).bind(this),50)}function $(zt){var Ut=a(zt,this.assetsPath,this.path),Nt=createNS("image");isSafari?this.testImageLoaded(Nt):Nt.addEventListener("load",this._imageLoaded,!1),Nt.addEventListener("error",(function(){Gt.img=e,this._imageLoaded()}).bind(this),!1),Nt.setAttributeNS("http://www.w3.org/1999/xlink","href",Ut),this._elementHelper.append?this._elementHelper.append(Nt):this._elementHelper.appendChild(Nt);var Gt={img:Nt,assetData:zt};return Gt}function rt(zt){var Ut=a(zt,this.assetsPath,this.path),Nt=createTag("img");Nt.crossOrigin="anonymous",Nt.addEventListener("load",this._imageLoaded,!1),Nt.addEventListener("error",(function(){Gt.img=e,this._imageLoaded()}).bind(this),!1),Nt.src=Ut;var Gt={img:Nt,assetData:zt};return Gt}function c(zt){var Ut={assetData:zt},Nt=a(zt,this.assetsPath,this.path);return dataManager.loadData(Nt,(function(Gt){Ut.img=Gt,this._footageLoaded()}).bind(this),(function(){Ut.img={},this._footageLoaded()}).bind(this)),Ut}function dt(zt,Ut){this.imagesLoadedCb=Ut;var Nt,Gt=zt.length;for(Nt=0;Nt<Gt;Nt+=1)zt[Nt].layers||(!zt[Nt].t||zt[Nt].t==="seq"?(this.totalImages+=1,this.images.push(this._createImageData(zt[Nt]))):zt[Nt].t===3&&(this.totalFootages+=1,this.images.push(this.createFootageData(zt[Nt]))))}function ht(zt){this.path=zt||""}function Et(zt){this.assetsPath=zt||""}function St(zt){for(var Ut=0,Nt=this.images.length;Ut<Nt;){if(this.images[Ut].assetData===zt)return this.images[Ut].img;Ut+=1}return null}function At(){this.imagesLoadedCb=null,this.images.length=0}function Pt(){return this.totalImages===this.loadedAssets}function Vt(){return this.totalFootages===this.loadedFootagesCount}function Bt(zt,Ut){zt==="svg"?(this._elementHelper=Ut,this._createImageData=this.createImageData.bind(this)):this._createImageData=this.createImgData.bind(this)}function Zt(){this._imageLoaded=i.bind(this),this._footageLoaded=s.bind(this),this.testImageLoaded=_.bind(this),this.createFootageData=c.bind(this),this.assetsPath="",this.path="",this.totalImages=0,this.totalFootages=0,this.loadedAssets=0,this.loadedFootagesCount=0,this.imagesLoadedCb=null,this.images=[]}return Zt.prototype={loadAssets:dt,setAssetsPath:Et,setPath:ht,loadedImages:Pt,loadedFootages:Vt,destroy:At,getAsset:St,createImgData:rt,createImageData:$,imageLoaded:i,footageLoaded:s,setCacheType:Bt},Zt}();function BaseEvent(){}BaseEvent.prototype={triggerEvent:function(i,s){if(this._cbs[i])for(var a=this._cbs[i],_=0;_<a.length;_+=1)a[_](s)},addEventListener:function(i,s){return this._cbs[i]||(this._cbs[i]=[]),this._cbs[i].push(s),(function(){this.removeEventListener(i,s)}).bind(this)},removeEventListener:function(i,s){if(!s)this._cbs[i]=null;else if(this._cbs[i]){for(var a=0,_=this._cbs[i].length;a<_;)this._cbs[i][a]===s&&(this._cbs[i].splice(a,1),a-=1,_-=1),a+=1;this._cbs[i].length||(this._cbs[i]=null)}}};var markerParser=function(){function e(i){for(var s=i.split(`\r
`),a={},_,$=0,rt=0;rt<s.length;rt+=1)_=s[rt].split(":"),_.length===2&&(a[_[0]]=_[1].trim(),$+=1);if($===0)throw new Error;return a}return function(i){for(var s=[],a=0;a<i.length;a+=1){var _=i[a],$={time:_.tm,duration:_.dr};try{$.payload=JSON.parse(i[a].cm)}catch{try{$.payload=e(i[a].cm)}catch{$.payload={name:i[a].cm}}}s.push($)}return s}}(),ProjectInterface=function(){function e(i){this.compositions.push(i)}return function(){function i(s){for(var a=0,_=this.compositions.length;a<_;){if(this.compositions[a].data&&this.compositions[a].data.nm===s)return this.compositions[a].prepareFrame&&this.compositions[a].data.xt&&this.compositions[a].prepareFrame(this.currentFrame),this.compositions[a].compInterface;a+=1}return null}return i.compositions=[],i.currentFrame=0,i.registerComposition=e,i}}(),renderers={},registerRenderer=function(i,s){renderers[i]=s};function getRenderer(e){return renderers[e]}function getRegisteredRenderer(){if(renderers.canvas)return"canvas";for(var e in renderers)if(renderers[e])return e;return""}function _typeof$4(e){"@babel/helpers - typeof";return _typeof$4=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},_typeof$4(e)}var AnimationItem=function(){this._cbs=[],this.name="",this.path="",this.isLoaded=!1,this.currentFrame=0,this.currentRawFrame=0,this.firstFrame=0,this.totalFrames=0,this.frameRate=0,this.frameMult=0,this.playSpeed=1,this.playDirection=1,this.playCount=0,this.animationData={},this.assets=[],this.isPaused=!0,this.autoplay=!1,this.loop=!0,this.renderer=null,this.animationID=createElementID(),this.assetsPath="",this.timeCompleted=0,this.segmentPos=0,this.isSubframeEnabled=getSubframeEnabled(),this.segments=[],this._idle=!0,this._completedLoop=!1,this.projectInterface=ProjectInterface(),this.imagePreloader=new ImagePreloader,this.audioController=audioControllerFactory(),this.markers=[],this.configAnimation=this.configAnimation.bind(this),this.onSetupError=this.onSetupError.bind(this),this.onSegmentComplete=this.onSegmentComplete.bind(this),this.drawnFrameEvent=new BMEnterFrameEvent("drawnFrame",0,0,0),this.expressionsPlugin=getExpressionsPlugin()};extendPrototype([BaseEvent],AnimationItem),AnimationItem.prototype.setParams=function(e){(e.wrapper||e.container)&&(this.wrapper=e.wrapper||e.container);var i="svg";e.animType?i=e.animType:e.renderer&&(i=e.renderer);var s=getRenderer(i);this.renderer=new s(this,e.rendererSettings),this.imagePreloader.setCacheType(i,this.renderer.globalData.defs),this.renderer.setProjectInterface(this.projectInterface),this.animType=i,e.loop===""||e.loop===null||e.loop===void 0||e.loop===!0?this.loop=!0:e.loop===!1?this.loop=!1:this.loop=parseInt(e.loop,10),this.autoplay="autoplay"in e?e.autoplay:!0,this.name=e.name?e.name:"",this.autoloadSegments=Object.prototype.hasOwnProperty.call(e,"autoloadSegments")?e.autoloadSegments:!0,this.assetsPath=e.assetsPath,this.initialSegment=e.initialSegment,e.audioFactory&&this.audioController.setAudioFactory(e.audioFactory),e.animationData?this.setupAnimation(e.animationData):e.path&&(e.path.lastIndexOf("\\")!==-1?this.path=e.path.substr(0,e.path.lastIndexOf("\\")+1):this.path=e.path.substr(0,e.path.lastIndexOf("/")+1),this.fileName=e.path.substr(e.path.lastIndexOf("/")+1),this.fileName=this.fileName.substr(0,this.fileName.lastIndexOf(".json")),dataManager.loadAnimation(e.path,this.configAnimation,this.onSetupError))},AnimationItem.prototype.onSetupError=function(){this.trigger("data_failed")},AnimationItem.prototype.setupAnimation=function(e){dataManager.completeAnimation(e,this.configAnimation)},AnimationItem.prototype.setData=function(e,i){i&&_typeof$4(i)!=="object"&&(i=JSON.parse(i));var s={wrapper:e,animationData:i},a=e.attributes;s.path=a.getNamedItem("data-animation-path")?a.getNamedItem("data-animation-path").value:a.getNamedItem("data-bm-path")?a.getNamedItem("data-bm-path").value:a.getNamedItem("bm-path")?a.getNamedItem("bm-path").value:"",s.animType=a.getNamedItem("data-anim-type")?a.getNamedItem("data-anim-type").value:a.getNamedItem("data-bm-type")?a.getNamedItem("data-bm-type").value:a.getNamedItem("bm-type")?a.getNamedItem("bm-type").value:a.getNamedItem("data-bm-renderer")?a.getNamedItem("data-bm-renderer").value:a.getNamedItem("bm-renderer")?a.getNamedItem("bm-renderer").value:getRegisteredRenderer()||"canvas";var _=a.getNamedItem("data-anim-loop")?a.getNamedItem("data-anim-loop").value:a.getNamedItem("data-bm-loop")?a.getNamedItem("data-bm-loop").value:a.getNamedItem("bm-loop")?a.getNamedItem("bm-loop").value:"";_==="false"?s.loop=!1:_==="true"?s.loop=!0:_!==""&&(s.loop=parseInt(_,10));var $=a.getNamedItem("data-anim-autoplay")?a.getNamedItem("data-anim-autoplay").value:a.getNamedItem("data-bm-autoplay")?a.getNamedItem("data-bm-autoplay").value:a.getNamedItem("bm-autoplay")?a.getNamedItem("bm-autoplay").value:!0;s.autoplay=$!=="false",s.name=a.getNamedItem("data-name")?a.getNamedItem("data-name").value:a.getNamedItem("data-bm-name")?a.getNamedItem("data-bm-name").value:a.getNamedItem("bm-name")?a.getNamedItem("bm-name").value:"";var rt=a.getNamedItem("data-anim-prerender")?a.getNamedItem("data-anim-prerender").value:a.getNamedItem("data-bm-prerender")?a.getNamedItem("data-bm-prerender").value:a.getNamedItem("bm-prerender")?a.getNamedItem("bm-prerender").value:"";rt==="false"&&(s.prerender=!1),s.path?this.setParams(s):this.trigger("destroy")},AnimationItem.prototype.includeLayers=function(e){e.op>this.animationData.op&&(this.animationData.op=e.op,this.totalFrames=Math.floor(e.op-this.animationData.ip));var i=this.animationData.layers,s,a=i.length,_=e.layers,$,rt=_.length;for($=0;$<rt;$+=1)for(s=0;s<a;){if(i[s].id===_[$].id){i[s]=_[$];break}s+=1}if((e.chars||e.fonts)&&(this.renderer.globalData.fontManager.addChars(e.chars),this.renderer.globalData.fontManager.addFonts(e.fonts,this.renderer.globalData.defs)),e.assets)for(a=e.assets.length,s=0;s<a;s+=1)this.animationData.assets.push(e.assets[s]);this.animationData.__complete=!1,dataManager.completeAnimation(this.animationData,this.onSegmentComplete)},AnimationItem.prototype.onSegmentComplete=function(e){this.animationData=e;var i=getExpressionsPlugin();i&&i.initExpressions(this),this.loadNextSegment()},AnimationItem.prototype.loadNextSegment=function(){var e=this.animationData.segments;if(!e||e.length===0||!this.autoloadSegments){this.trigger("data_ready"),this.timeCompleted=this.totalFrames;return}var i=e.shift();this.timeCompleted=i.time*this.frameRate;var s=this.path+this.fileName+"_"+this.segmentPos+".json";this.segmentPos+=1,dataManager.loadData(s,this.includeLayers.bind(this),(function(){this.trigger("data_failed")}).bind(this))},AnimationItem.prototype.loadSegments=function(){var e=this.animationData.segments;e||(this.timeCompleted=this.totalFrames),this.loadNextSegment()},AnimationItem.prototype.imagesLoaded=function(){this.trigger("loaded_images"),this.checkLoaded()},AnimationItem.prototype.preloadImages=function(){this.imagePreloader.setAssetsPath(this.assetsPath),this.imagePreloader.setPath(this.path),this.imagePreloader.loadAssets(this.animationData.assets,this.imagesLoaded.bind(this))},AnimationItem.prototype.configAnimation=function(e){if(this.renderer)try{this.animationData=e,this.initialSegment?(this.totalFrames=Math.floor(this.initialSegment[1]-this.initialSegment[0]),this.firstFrame=Math.round(this.initialSegment[0])):(this.totalFrames=Math.floor(this.animationData.op-this.animationData.ip),this.firstFrame=Math.round(this.animationData.ip)),this.renderer.configAnimation(e),e.assets||(e.assets=[]),this.assets=this.animationData.assets,this.frameRate=this.animationData.fr,this.frameMult=this.animationData.fr/1e3,this.renderer.searchExtraCompositions(e.assets),this.markers=markerParser(e.markers||[]),this.trigger("config_ready"),this.preloadImages(),this.loadSegments(),this.updaFrameModifier(),this.waitForFontsLoaded(),this.isPaused&&this.audioController.pause()}catch(i){this.triggerConfigError(i)}},AnimationItem.prototype.waitForFontsLoaded=function(){this.renderer&&(this.renderer.globalData.fontManager.isLoaded?this.checkLoaded():setTimeout(this.waitForFontsLoaded.bind(this),20))},AnimationItem.prototype.checkLoaded=function(){if(!this.isLoaded&&this.renderer.globalData.fontManager.isLoaded&&(this.imagePreloader.loadedImages()||this.renderer.rendererType!=="canvas")&&this.imagePreloader.loadedFootages()){this.isLoaded=!0;var e=getExpressionsPlugin();e&&e.initExpressions(this),this.renderer.initItems(),setTimeout((function(){this.trigger("DOMLoaded")}).bind(this),0),this.gotoFrame(),this.autoplay&&this.play()}},AnimationItem.prototype.resize=function(e,i){var s=typeof e=="number"?e:void 0,a=typeof i=="number"?i:void 0;this.renderer.updateContainerSize(s,a)},AnimationItem.prototype.setSubframe=function(e){this.isSubframeEnabled=!!e},AnimationItem.prototype.gotoFrame=function(){this.currentFrame=this.isSubframeEnabled?this.currentRawFrame:~~this.currentRawFrame,this.timeCompleted!==this.totalFrames&&this.currentFrame>this.timeCompleted&&(this.currentFrame=this.timeCompleted),this.trigger("enterFrame"),this.renderFrame(),this.trigger("drawnFrame")},AnimationItem.prototype.renderFrame=function(){if(!(this.isLoaded===!1||!this.renderer))try{this.expressionsPlugin&&this.expressionsPlugin.resetFrame(),this.renderer.renderFrame(this.currentFrame+this.firstFrame)}catch(e){this.triggerRenderFrameError(e)}},AnimationItem.prototype.play=function(e){e&&this.name!==e||this.isPaused===!0&&(this.isPaused=!1,this.trigger("_play"),this.audioController.resume(),this._idle&&(this._idle=!1,this.trigger("_active")))},AnimationItem.prototype.pause=function(e){e&&this.name!==e||this.isPaused===!1&&(this.isPaused=!0,this.trigger("_pause"),this._idle=!0,this.trigger("_idle"),this.audioController.pause())},AnimationItem.prototype.togglePause=function(e){e&&this.name!==e||(this.isPaused===!0?this.play():this.pause())},AnimationItem.prototype.stop=function(e){e&&this.name!==e||(this.pause(),this.playCount=0,this._completedLoop=!1,this.setCurrentRawFrameValue(0))},AnimationItem.prototype.getMarkerData=function(e){for(var i,s=0;s<this.markers.length;s+=1)if(i=this.markers[s],i.payload&&i.payload.name===e)return i;return null},AnimationItem.prototype.goToAndStop=function(e,i,s){if(!(s&&this.name!==s)){var a=Number(e);if(isNaN(a)){var _=this.getMarkerData(e);_&&this.goToAndStop(_.time,!0)}else i?this.setCurrentRawFrameValue(e):this.setCurrentRawFrameValue(e*this.frameModifier);this.pause()}},AnimationItem.prototype.goToAndPlay=function(e,i,s){if(!(s&&this.name!==s)){var a=Number(e);if(isNaN(a)){var _=this.getMarkerData(e);_&&(_.duration?this.playSegments([_.time,_.time+_.duration],!0):this.goToAndStop(_.time,!0))}else this.goToAndStop(a,i,s);this.play()}},AnimationItem.prototype.advanceTime=function(e){if(!(this.isPaused===!0||this.isLoaded===!1)){var i=this.currentRawFrame+e*this.frameModifier,s=!1;i>=this.totalFrames-1&&this.frameModifier>0?!this.loop||this.playCount===this.loop?this.checkSegments(i>this.totalFrames?i%this.totalFrames:0)||(s=!0,i=this.totalFrames-1):i>=this.totalFrames?(this.playCount+=1,this.checkSegments(i%this.totalFrames)||(this.setCurrentRawFrameValue(i%this.totalFrames),this._completedLoop=!0,this.trigger("loopComplete"))):this.setCurrentRawFrameValue(i):i<0?this.checkSegments(i%this.totalFrames)||(this.loop&&!(this.playCount--<=0&&this.loop!==!0)?(this.setCurrentRawFrameValue(this.totalFrames+i%this.totalFrames),this._completedLoop?this.trigger("loopComplete"):this._completedLoop=!0):(s=!0,i=0)):this.setCurrentRawFrameValue(i),s&&(this.setCurrentRawFrameValue(i),this.pause(),this.trigger("complete"))}},AnimationItem.prototype.adjustSegment=function(e,i){this.playCount=0,e[1]<e[0]?(this.frameModifier>0&&(this.playSpeed<0?this.setSpeed(-this.playSpeed):this.setDirection(-1)),this.totalFrames=e[0]-e[1],this.timeCompleted=this.totalFrames,this.firstFrame=e[1],this.setCurrentRawFrameValue(this.totalFrames-.001-i)):e[1]>e[0]&&(this.frameModifier<0&&(this.playSpeed<0?this.setSpeed(-this.playSpeed):this.setDirection(1)),this.totalFrames=e[1]-e[0],this.timeCompleted=this.totalFrames,this.firstFrame=e[0],this.setCurrentRawFrameValue(.001+i)),this.trigger("segmentStart")},AnimationItem.prototype.setSegment=function(e,i){var s=-1;this.isPaused&&(this.currentRawFrame+this.firstFrame<e?s=e:this.currentRawFrame+this.firstFrame>i&&(s=i-e)),this.firstFrame=e,this.totalFrames=i-e,this.timeCompleted=this.totalFrames,s!==-1&&this.goToAndStop(s,!0)},AnimationItem.prototype.playSegments=function(e,i){if(i&&(this.segments.length=0),_typeof$4(e[0])==="object"){var s,a=e.length;for(s=0;s<a;s+=1)this.segments.push(e[s])}else this.segments.push(e);this.segments.length&&i&&this.adjustSegment(this.segments.shift(),0),this.isPaused&&this.play()},AnimationItem.prototype.resetSegments=function(e){this.segments.length=0,this.segments.push([this.animationData.ip,this.animationData.op]),e&&this.checkSegments(0)},AnimationItem.prototype.checkSegments=function(e){return this.segments.length?(this.adjustSegment(this.segments.shift(),e),!0):!1},AnimationItem.prototype.destroy=function(e){e&&this.name!==e||!this.renderer||(this.renderer.destroy(),this.imagePreloader.destroy(),this.trigger("destroy"),this._cbs=null,this.onEnterFrame=null,this.onLoopComplete=null,this.onComplete=null,this.onSegmentStart=null,this.onDestroy=null,this.renderer=null,this.expressionsPlugin=null,this.imagePreloader=null,this.projectInterface=null)},AnimationItem.prototype.setCurrentRawFrameValue=function(e){this.currentRawFrame=e,this.gotoFrame()},AnimationItem.prototype.setSpeed=function(e){this.playSpeed=e,this.updaFrameModifier()},AnimationItem.prototype.setDirection=function(e){this.playDirection=e<0?-1:1,this.updaFrameModifier()},AnimationItem.prototype.setLoop=function(e){this.loop=e},AnimationItem.prototype.setVolume=function(e,i){i&&this.name!==i||this.audioController.setVolume(e)},AnimationItem.prototype.getVolume=function(){return this.audioController.getVolume()},AnimationItem.prototype.mute=function(e){e&&this.name!==e||this.audioController.mute()},AnimationItem.prototype.unmute=function(e){e&&this.name!==e||this.audioController.unmute()},AnimationItem.prototype.updaFrameModifier=function(){this.frameModifier=this.frameMult*this.playSpeed*this.playDirection,this.audioController.setRate(this.playSpeed*this.playDirection)},AnimationItem.prototype.getPath=function(){return this.path},AnimationItem.prototype.getAssetsPath=function(e){var i="";if(e.e)i=e.p;else if(this.assetsPath){var s=e.p;s.indexOf("images/")!==-1&&(s=s.split("/")[1]),i=this.assetsPath+s}else i=this.path,i+=e.u?e.u:"",i+=e.p;return i},AnimationItem.prototype.getAssetData=function(e){for(var i=0,s=this.assets.length;i<s;){if(e===this.assets[i].id)return this.assets[i];i+=1}return null},AnimationItem.prototype.hide=function(){this.renderer.hide()},AnimationItem.prototype.show=function(){this.renderer.show()},AnimationItem.prototype.getDuration=function(e){return e?this.totalFrames:this.totalFrames/this.frameRate},AnimationItem.prototype.updateDocumentData=function(e,i,s){try{var a=this.renderer.getElementByPath(e);a.updateDocumentData(i,s)}catch{}},AnimationItem.prototype.trigger=function(e){if(this._cbs&&this._cbs[e])switch(e){case"enterFrame":this.triggerEvent(e,new BMEnterFrameEvent(e,this.currentFrame,this.totalFrames,this.frameModifier));break;case"drawnFrame":this.drawnFrameEvent.currentTime=this.currentFrame,this.drawnFrameEvent.totalTime=this.totalFrames,this.drawnFrameEvent.direction=this.frameModifier,this.triggerEvent(e,this.drawnFrameEvent);break;case"loopComplete":this.triggerEvent(e,new BMCompleteLoopEvent(e,this.loop,this.playCount,this.frameMult));break;case"complete":this.triggerEvent(e,new BMCompleteEvent(e,this.frameMult));break;case"segmentStart":this.triggerEvent(e,new BMSegmentStartEvent(e,this.firstFrame,this.totalFrames));break;case"destroy":this.triggerEvent(e,new BMDestroyEvent(e,this));break;default:this.triggerEvent(e)}e==="enterFrame"&&this.onEnterFrame&&this.onEnterFrame.call(this,new BMEnterFrameEvent(e,this.currentFrame,this.totalFrames,this.frameMult)),e==="loopComplete"&&this.onLoopComplete&&this.onLoopComplete.call(this,new BMCompleteLoopEvent(e,this.loop,this.playCount,this.frameMult)),e==="complete"&&this.onComplete&&this.onComplete.call(this,new BMCompleteEvent(e,this.frameMult)),e==="segmentStart"&&this.onSegmentStart&&this.onSegmentStart.call(this,new BMSegmentStartEvent(e,this.firstFrame,this.totalFrames)),e==="destroy"&&this.onDestroy&&this.onDestroy.call(this,new BMDestroyEvent(e,this))},AnimationItem.prototype.triggerRenderFrameError=function(e){var i=new BMRenderFrameErrorEvent(e,this.currentFrame);this.triggerEvent("error",i),this.onError&&this.onError.call(this,i)},AnimationItem.prototype.triggerConfigError=function(e){var i=new BMConfigErrorEvent(e,this.currentFrame);this.triggerEvent("error",i),this.onError&&this.onError.call(this,i)};var animationManager=function(){var e={},i=[],s=0,a=0,_=0,$=!0,rt=!1;function c(Cr){for(var Sr=0,dr=Cr.target;Sr<a;)i[Sr].animation===dr&&(i.splice(Sr,1),Sr-=1,a-=1,dr.isPaused||St()),Sr+=1}function dt(Cr,Sr){if(!Cr)return null;for(var dr=0;dr<a;){if(i[dr].elem===Cr&&i[dr].elem!==null)return i[dr].animation;dr+=1}var gr=new AnimationItem;return At(gr,Cr),gr.setData(Cr,Sr),gr}function ht(){var Cr,Sr=i.length,dr=[];for(Cr=0;Cr<Sr;Cr+=1)dr.push(i[Cr].animation);return dr}function Et(){_+=1,on()}function St(){_-=1}function At(Cr,Sr){Cr.addEventListener("destroy",c),Cr.addEventListener("_active",Et),Cr.addEventListener("_idle",St),i.push({elem:Sr,animation:Cr}),a+=1}function Pt(Cr){var Sr=new AnimationItem;return At(Sr,null),Sr.setParams(Cr),Sr}function Vt(Cr,Sr){var dr;for(dr=0;dr<a;dr+=1)i[dr].animation.setSpeed(Cr,Sr)}function Bt(Cr,Sr){var dr;for(dr=0;dr<a;dr+=1)i[dr].animation.setDirection(Cr,Sr)}function Zt(Cr){var Sr;for(Sr=0;Sr<a;Sr+=1)i[Sr].animation.play(Cr)}function zt(Cr){var Sr=Cr-s,dr;for(dr=0;dr<a;dr+=1)i[dr].animation.advanceTime(Sr);s=Cr,_&&!rt?window.requestAnimationFrame(zt):$=!0}function Ut(Cr){s=Cr,window.requestAnimationFrame(zt)}function Nt(Cr){var Sr;for(Sr=0;Sr<a;Sr+=1)i[Sr].animation.pause(Cr)}function Gt(Cr,Sr,dr){var gr;for(gr=0;gr<a;gr+=1)i[gr].animation.goToAndStop(Cr,Sr,dr)}function er(Cr){var Sr;for(Sr=0;Sr<a;Sr+=1)i[Sr].animation.stop(Cr)}function ir(Cr){var Sr;for(Sr=0;Sr<a;Sr+=1)i[Sr].animation.togglePause(Cr)}function or(Cr){var Sr;for(Sr=a-1;Sr>=0;Sr-=1)i[Sr].animation.destroy(Cr)}function mr(Cr,Sr,dr){var gr=[].concat([].slice.call(document.getElementsByClassName("lottie")),[].slice.call(document.getElementsByClassName("bodymovin"))),qr,Lr=gr.length;for(qr=0;qr<Lr;qr+=1)dr&&gr[qr].setAttribute("data-bm-type",dr),dt(gr[qr],Cr);if(Sr&&Lr===0){dr||(dr="svg");var _n=document.getElementsByTagName("body")[0];_n.innerText="";var gn=createTag("div");gn.style.width="100%",gn.style.height="100%",gn.setAttribute("data-bm-type",dr),_n.appendChild(gn),dt(gn,Cr)}}function Rr(){var Cr;for(Cr=0;Cr<a;Cr+=1)i[Cr].animation.resize()}function on(){!rt&&_&&$&&(window.requestAnimationFrame(Ut),$=!1)}function un(){rt=!0}function jr(){rt=!1,on()}function Jr(Cr,Sr){var dr;for(dr=0;dr<a;dr+=1)i[dr].animation.setVolume(Cr,Sr)}function fn(Cr){var Sr;for(Sr=0;Sr<a;Sr+=1)i[Sr].animation.mute(Cr)}function Fr(Cr){var Sr;for(Sr=0;Sr<a;Sr+=1)i[Sr].animation.unmute(Cr)}return e.registerAnimation=dt,e.loadAnimation=Pt,e.setSpeed=Vt,e.setDirection=Bt,e.play=Zt,e.pause=Nt,e.stop=er,e.togglePause=ir,e.searchAnimations=mr,e.resize=Rr,e.goToAndStop=Gt,e.destroy=or,e.freeze=un,e.unfreeze=jr,e.setVolume=Jr,e.mute=fn,e.unmute=Fr,e.getRegisteredAnimations=ht,e}(),BezierFactory=function(){var e={};e.getBezierEasing=s;var i={};function s(Ut,Nt,Gt,er,ir){var or=ir||("bez_"+Ut+"_"+Nt+"_"+Gt+"_"+er).replace(/\./g,"p");if(i[or])return i[or];var mr=new zt([Ut,Nt,Gt,er]);return i[or]=mr,mr}var a=4,_=.001,$=1e-7,rt=10,c=11,dt=1/(c-1),ht=typeof Float32Array=="function";function Et(Ut,Nt){return 1-3*Nt+3*Ut}function St(Ut,Nt){return 3*Nt-6*Ut}function At(Ut){return 3*Ut}function Pt(Ut,Nt,Gt){return((Et(Nt,Gt)*Ut+St(Nt,Gt))*Ut+At(Nt))*Ut}function Vt(Ut,Nt,Gt){return 3*Et(Nt,Gt)*Ut*Ut+2*St(Nt,Gt)*Ut+At(Nt)}function Bt(Ut,Nt,Gt,er,ir){var or,mr,Rr=0;do mr=Nt+(Gt-Nt)/2,or=Pt(mr,er,ir)-Ut,or>0?Gt=mr:Nt=mr;while(Math.abs(or)>$&&++Rr<rt);return mr}function Zt(Ut,Nt,Gt,er){for(var ir=0;ir<a;++ir){var or=Vt(Nt,Gt,er);if(or===0)return Nt;var mr=Pt(Nt,Gt,er)-Ut;Nt-=mr/or}return Nt}function zt(Ut){this._p=Ut,this._mSampleValues=ht?new Float32Array(c):new Array(c),this._precomputed=!1,this.get=this.get.bind(this)}return zt.prototype={get:function(Nt){var Gt=this._p[0],er=this._p[1],ir=this._p[2],or=this._p[3];return this._precomputed||this._precompute(),Gt===er&&ir===or?Nt:Nt===0?0:Nt===1?1:Pt(this._getTForX(Nt),er,or)},_precompute:function(){var Nt=this._p[0],Gt=this._p[1],er=this._p[2],ir=this._p[3];this._precomputed=!0,(Nt!==Gt||er!==ir)&&this._calcSampleValues()},_calcSampleValues:function(){for(var Nt=this._p[0],Gt=this._p[2],er=0;er<c;++er)this._mSampleValues[er]=Pt(er*dt,Nt,Gt)},_getTForX:function(Nt){for(var Gt=this._p[0],er=this._p[2],ir=this._mSampleValues,or=0,mr=1,Rr=c-1;mr!==Rr&&ir[mr]<=Nt;++mr)or+=dt;--mr;var on=(Nt-ir[mr])/(ir[mr+1]-ir[mr]),un=or+on*dt,jr=Vt(un,Gt,er);return jr>=_?Zt(Nt,un,Gt,er):jr===0?un:Bt(Nt,or,or+dt,Gt,er)}},e}(),pooling=function(){function e(i){return i.concat(createSizedArray(i.length))}return{double:e}}(),poolFactory=function(){return function(e,i,s){var a=0,_=e,$=createSizedArray(_),rt={newElement:c,release:dt};function c(){var ht;return a?(a-=1,ht=$[a]):ht=i(),ht}function dt(ht){a===_&&($=pooling.double($),_*=2),s&&s(ht),$[a]=ht,a+=1}return rt}}(),bezierLengthPool=function(){function e(){return{addedLength:0,percents:createTypedArray("float32",getDefaultCurveSegments()),lengths:createTypedArray("float32",getDefaultCurveSegments())}}return poolFactory(8,e)}(),segmentsLengthPool=function(){function e(){return{lengths:[],totalLength:0}}function i(s){var a,_=s.lengths.length;for(a=0;a<_;a+=1)bezierLengthPool.release(s.lengths[a]);s.lengths.length=0}return poolFactory(8,e,i)}();function bezFunction(){var e=Math;function i(At,Pt,Vt,Bt,Zt,zt){var Ut=At*Bt+Pt*Zt+Vt*zt-Zt*Bt-zt*At-Vt*Pt;return Ut>-.001&&Ut<.001}function s(At,Pt,Vt,Bt,Zt,zt,Ut,Nt,Gt){if(Vt===0&&zt===0&&Gt===0)return i(At,Pt,Bt,Zt,Ut,Nt);var er=e.sqrt(e.pow(Bt-At,2)+e.pow(Zt-Pt,2)+e.pow(zt-Vt,2)),ir=e.sqrt(e.pow(Ut-At,2)+e.pow(Nt-Pt,2)+e.pow(Gt-Vt,2)),or=e.sqrt(e.pow(Ut-Bt,2)+e.pow(Nt-Zt,2)+e.pow(Gt-zt,2)),mr;return er>ir?er>or?mr=er-ir-or:mr=or-ir-er:or>ir?mr=or-ir-er:mr=ir-er-or,mr>-1e-4&&mr<1e-4}var a=function(){return function(At,Pt,Vt,Bt){var Zt=getDefaultCurveSegments(),zt,Ut,Nt,Gt,er,ir=0,or,mr=[],Rr=[],on=bezierLengthPool.newElement();for(Nt=Vt.length,zt=0;zt<Zt;zt+=1){for(er=zt/(Zt-1),or=0,Ut=0;Ut<Nt;Ut+=1)Gt=bmPow(1-er,3)*At[Ut]+3*bmPow(1-er,2)*er*Vt[Ut]+3*(1-er)*bmPow(er,2)*Bt[Ut]+bmPow(er,3)*Pt[Ut],mr[Ut]=Gt,Rr[Ut]!==null&&(or+=bmPow(mr[Ut]-Rr[Ut],2)),Rr[Ut]=mr[Ut];or&&(or=bmSqrt(or),ir+=or),on.percents[zt]=er,on.lengths[zt]=ir}return on.addedLength=ir,on}}();function _(At){var Pt=segmentsLengthPool.newElement(),Vt=At.c,Bt=At.v,Zt=At.o,zt=At.i,Ut,Nt=At._length,Gt=Pt.lengths,er=0;for(Ut=0;Ut<Nt-1;Ut+=1)Gt[Ut]=a(Bt[Ut],Bt[Ut+1],Zt[Ut],zt[Ut+1]),er+=Gt[Ut].addedLength;return Vt&&Nt&&(Gt[Ut]=a(Bt[Ut],Bt[0],Zt[Ut],zt[0]),er+=Gt[Ut].addedLength),Pt.totalLength=er,Pt}function $(At){this.segmentLength=0,this.points=new Array(At)}function rt(At,Pt){this.partialLength=At,this.point=Pt}var c=function(){var At={};return function(Pt,Vt,Bt,Zt){var zt=(Pt[0]+"_"+Pt[1]+"_"+Vt[0]+"_"+Vt[1]+"_"+Bt[0]+"_"+Bt[1]+"_"+Zt[0]+"_"+Zt[1]).replace(/\./g,"p");if(!At[zt]){var Ut=getDefaultCurveSegments(),Nt,Gt,er,ir,or,mr=0,Rr,on,un=null;Pt.length===2&&(Pt[0]!==Vt[0]||Pt[1]!==Vt[1])&&i(Pt[0],Pt[1],Vt[0],Vt[1],Pt[0]+Bt[0],Pt[1]+Bt[1])&&i(Pt[0],Pt[1],Vt[0],Vt[1],Vt[0]+Zt[0],Vt[1]+Zt[1])&&(Ut=2);var jr=new $(Ut);for(er=Bt.length,Nt=0;Nt<Ut;Nt+=1){for(on=createSizedArray(er),or=Nt/(Ut-1),Rr=0,Gt=0;Gt<er;Gt+=1)ir=bmPow(1-or,3)*Pt[Gt]+3*bmPow(1-or,2)*or*(Pt[Gt]+Bt[Gt])+3*(1-or)*bmPow(or,2)*(Vt[Gt]+Zt[Gt])+bmPow(or,3)*Vt[Gt],on[Gt]=ir,un!==null&&(Rr+=bmPow(on[Gt]-un[Gt],2));Rr=bmSqrt(Rr),mr+=Rr,jr.points[Nt]=new rt(Rr,on),un=on}jr.segmentLength=mr,At[zt]=jr}return At[zt]}}();function dt(At,Pt){var Vt=Pt.percents,Bt=Pt.lengths,Zt=Vt.length,zt=bmFloor((Zt-1)*At),Ut=At*Pt.addedLength,Nt=0;if(zt===Zt-1||zt===0||Ut===Bt[zt])return Vt[zt];for(var Gt=Bt[zt]>Ut?-1:1,er=!0;er;)if(Bt[zt]<=Ut&&Bt[zt+1]>Ut?(Nt=(Ut-Bt[zt])/(Bt[zt+1]-Bt[zt]),er=!1):zt+=Gt,zt<0||zt>=Zt-1){if(zt===Zt-1)return Vt[zt];er=!1}return Vt[zt]+(Vt[zt+1]-Vt[zt])*Nt}function ht(At,Pt,Vt,Bt,Zt,zt){var Ut=dt(Zt,zt),Nt=1-Ut,Gt=e.round((Nt*Nt*Nt*At[0]+(Ut*Nt*Nt+Nt*Ut*Nt+Nt*Nt*Ut)*Vt[0]+(Ut*Ut*Nt+Nt*Ut*Ut+Ut*Nt*Ut)*Bt[0]+Ut*Ut*Ut*Pt[0])*1e3)/1e3,er=e.round((Nt*Nt*Nt*At[1]+(Ut*Nt*Nt+Nt*Ut*Nt+Nt*Nt*Ut)*Vt[1]+(Ut*Ut*Nt+Nt*Ut*Ut+Ut*Nt*Ut)*Bt[1]+Ut*Ut*Ut*Pt[1])*1e3)/1e3;return[Gt,er]}var Et=createTypedArray("float32",8);function St(At,Pt,Vt,Bt,Zt,zt,Ut){Zt<0?Zt=0:Zt>1&&(Zt=1);var Nt=dt(Zt,Ut);zt=zt>1?1:zt;var Gt=dt(zt,Ut),er,ir=At.length,or=1-Nt,mr=1-Gt,Rr=or*or*or,on=Nt*or*or*3,un=Nt*Nt*or*3,jr=Nt*Nt*Nt,Jr=or*or*mr,fn=Nt*or*mr+or*Nt*mr+or*or*Gt,Fr=Nt*Nt*mr+or*Nt*Gt+Nt*or*Gt,Cr=Nt*Nt*Gt,Sr=or*mr*mr,dr=Nt*mr*mr+or*Gt*mr+or*mr*Gt,gr=Nt*Gt*mr+or*Gt*Gt+Nt*mr*Gt,qr=Nt*Gt*Gt,Lr=mr*mr*mr,_n=Gt*mr*mr+mr*Gt*mr+mr*mr*Gt,gn=Gt*Gt*mr+mr*Gt*Gt+Gt*mr*Gt,Sn=Gt*Gt*Gt;for(er=0;er<ir;er+=1)Et[er*4]=e.round((Rr*At[er]+on*Vt[er]+un*Bt[er]+jr*Pt[er])*1e3)/1e3,Et[er*4+1]=e.round((Jr*At[er]+fn*Vt[er]+Fr*Bt[er]+Cr*Pt[er])*1e3)/1e3,Et[er*4+2]=e.round((Sr*At[er]+dr*Vt[er]+gr*Bt[er]+qr*Pt[er])*1e3)/1e3,Et[er*4+3]=e.round((Lr*At[er]+_n*Vt[er]+gn*Bt[er]+Sn*Pt[er])*1e3)/1e3;return Et}return{getSegmentsLength:_,getNewSegment:St,getPointInSegment:ht,buildBezierData:c,pointOnLine2D:i,pointOnLine3D:s}}var bez=bezFunction(),initFrame=initialDefaultFrame,mathAbs=Math.abs;function interpolateValue(e,i){var s=this.offsetTime,a;this.propType==="multidimensional"&&(a=createTypedArray("float32",this.pv.length));for(var _=i.lastIndex,$=_,rt=this.keyframes.length-1,c=!0,dt,ht,Et;c;){if(dt=this.keyframes[$],ht=this.keyframes[$+1],$===rt-1&&e>=ht.t-s){dt.h&&(dt=ht),_=0;break}if(ht.t-s>e){_=$;break}$<rt-1?$+=1:(_=0,c=!1)}Et=this.keyframesMetadata[$]||{};var St,At,Pt,Vt,Bt,Zt,zt=ht.t-s,Ut=dt.t-s,Nt;if(dt.to){Et.bezierData||(Et.bezierData=bez.buildBezierData(dt.s,ht.s||dt.e,dt.to,dt.ti));var Gt=Et.bezierData;if(e>=zt||e<Ut){var er=e>=zt?Gt.points.length-1:0;for(At=Gt.points[er].point.length,St=0;St<At;St+=1)a[St]=Gt.points[er].point[St]}else{Et.__fnct?Zt=Et.__fnct:(Zt=BezierFactory.getBezierEasing(dt.o.x,dt.o.y,dt.i.x,dt.i.y,dt.n).get,Et.__fnct=Zt),Pt=Zt((e-Ut)/(zt-Ut));var ir=Gt.segmentLength*Pt,or,mr=i.lastFrame<e&&i._lastKeyframeIndex===$?i._lastAddedLength:0;for(Bt=i.lastFrame<e&&i._lastKeyframeIndex===$?i._lastPoint:0,c=!0,Vt=Gt.points.length;c;){if(mr+=Gt.points[Bt].partialLength,ir===0||Pt===0||Bt===Gt.points.length-1){for(At=Gt.points[Bt].point.length,St=0;St<At;St+=1)a[St]=Gt.points[Bt].point[St];break}else if(ir>=mr&&ir<mr+Gt.points[Bt+1].partialLength){for(or=(ir-mr)/Gt.points[Bt+1].partialLength,At=Gt.points[Bt].point.length,St=0;St<At;St+=1)a[St]=Gt.points[Bt].point[St]+(Gt.points[Bt+1].point[St]-Gt.points[Bt].point[St])*or;break}Bt<Vt-1?Bt+=1:c=!1}i._lastPoint=Bt,i._lastAddedLength=mr-Gt.points[Bt].partialLength,i._lastKeyframeIndex=$}}else{var Rr,on,un,jr,Jr;if(rt=dt.s.length,Nt=ht.s||dt.e,this.sh&&dt.h!==1)if(e>=zt)a[0]=Nt[0],a[1]=Nt[1],a[2]=Nt[2];else if(e<=Ut)a[0]=dt.s[0],a[1]=dt.s[1],a[2]=dt.s[2];else{var fn=createQuaternion(dt.s),Fr=createQuaternion(Nt),Cr=(e-Ut)/(zt-Ut);quaternionToEuler(a,slerp(fn,Fr,Cr))}else for($=0;$<rt;$+=1)dt.h!==1&&(e>=zt?Pt=1:e<Ut?Pt=0:(dt.o.x.constructor===Array?(Et.__fnct||(Et.__fnct=[]),Et.__fnct[$]?Zt=Et.__fnct[$]:(Rr=dt.o.x[$]===void 0?dt.o.x[0]:dt.o.x[$],on=dt.o.y[$]===void 0?dt.o.y[0]:dt.o.y[$],un=dt.i.x[$]===void 0?dt.i.x[0]:dt.i.x[$],jr=dt.i.y[$]===void 0?dt.i.y[0]:dt.i.y[$],Zt=BezierFactory.getBezierEasing(Rr,on,un,jr).get,Et.__fnct[$]=Zt)):Et.__fnct?Zt=Et.__fnct:(Rr=dt.o.x,on=dt.o.y,un=dt.i.x,jr=dt.i.y,Zt=BezierFactory.getBezierEasing(Rr,on,un,jr).get,dt.keyframeMetadata=Zt),Pt=Zt((e-Ut)/(zt-Ut)))),Nt=ht.s||dt.e,Jr=dt.h===1?dt.s[$]:dt.s[$]+(Nt[$]-dt.s[$])*Pt,this.propType==="multidimensional"?a[$]=Jr:a=Jr}return i.lastIndex=_,a}function slerp(e,i,s){var a=[],_=e[0],$=e[1],rt=e[2],c=e[3],dt=i[0],ht=i[1],Et=i[2],St=i[3],At,Pt,Vt,Bt,Zt;return Pt=_*dt+$*ht+rt*Et+c*St,Pt<0&&(Pt=-Pt,dt=-dt,ht=-ht,Et=-Et,St=-St),1-Pt>1e-6?(At=Math.acos(Pt),Vt=Math.sin(At),Bt=Math.sin((1-s)*At)/Vt,Zt=Math.sin(s*At)/Vt):(Bt=1-s,Zt=s),a[0]=Bt*_+Zt*dt,a[1]=Bt*$+Zt*ht,a[2]=Bt*rt+Zt*Et,a[3]=Bt*c+Zt*St,a}function quaternionToEuler(e,i){var s=i[0],a=i[1],_=i[2],$=i[3],rt=Math.atan2(2*a*$-2*s*_,1-2*a*a-2*_*_),c=Math.asin(2*s*a+2*_*$),dt=Math.atan2(2*s*$-2*a*_,1-2*s*s-2*_*_);e[0]=rt/degToRads,e[1]=c/degToRads,e[2]=dt/degToRads}function createQuaternion(e){var i=e[0]*degToRads,s=e[1]*degToRads,a=e[2]*degToRads,_=Math.cos(i/2),$=Math.cos(s/2),rt=Math.cos(a/2),c=Math.sin(i/2),dt=Math.sin(s/2),ht=Math.sin(a/2),Et=_*$*rt-c*dt*ht,St=c*dt*rt+_*$*ht,At=c*$*rt+_*dt*ht,Pt=_*dt*rt-c*$*ht;return[St,At,Pt,Et]}function getValueAtCurrentTime(){var e=this.comp.renderedFrame-this.offsetTime,i=this.keyframes[0].t-this.offsetTime,s=this.keyframes[this.keyframes.length-1].t-this.offsetTime;if(!(e===this._caching.lastFrame||this._caching.lastFrame!==initFrame&&(this._caching.lastFrame>=s&&e>=s||this._caching.lastFrame<i&&e<i))){this._caching.lastFrame>=e&&(this._caching._lastKeyframeIndex=-1,this._caching.lastIndex=0);var a=this.interpolateValue(e,this._caching);this.pv=a}return this._caching.lastFrame=e,this.pv}function setVValue(e){var i;if(this.propType==="unidimensional")i=e*this.mult,mathAbs(this.v-i)>1e-5&&(this.v=i,this._mdf=!0);else for(var s=0,a=this.v.length;s<a;)i=e[s]*this.mult,mathAbs(this.v[s]-i)>1e-5&&(this.v[s]=i,this._mdf=!0),s+=1}function processEffectsSequence(){if(!(this.elem.globalData.frameId===this.frameId||!this.effectsSequence.length)){if(this.lock){this.setVValue(this.pv);return}this.lock=!0,this._mdf=this._isFirstFrame;var e,i=this.effectsSequence.length,s=this.kf?this.pv:this.data.k;for(e=0;e<i;e+=1)s=this.effectsSequence[e](s);this.setVValue(s),this._isFirstFrame=!1,this.lock=!1,this.frameId=this.elem.globalData.frameId}}function addEffect(e){this.effectsSequence.push(e),this.container.addDynamicProperty(this)}function ValueProperty(e,i,s,a){this.propType="unidimensional",this.mult=s||1,this.data=i,this.v=s?i.k*s:i.k,this.pv=i.k,this._mdf=!1,this.elem=e,this.container=a,this.comp=e.comp,this.k=!1,this.kf=!1,this.vel=0,this.effectsSequence=[],this._isFirstFrame=!0,this.getValue=processEffectsSequence,this.setVValue=setVValue,this.addEffect=addEffect}function MultiDimensionalProperty(e,i,s,a){this.propType="multidimensional",this.mult=s||1,this.data=i,this._mdf=!1,this.elem=e,this.container=a,this.comp=e.comp,this.k=!1,this.kf=!1,this.frameId=-1;var _,$=i.k.length;for(this.v=createTypedArray("float32",$),this.pv=createTypedArray("float32",$),this.vel=createTypedArray("float32",$),_=0;_<$;_+=1)this.v[_]=i.k[_]*this.mult,this.pv[_]=i.k[_];this._isFirstFrame=!0,this.effectsSequence=[],this.getValue=processEffectsSequence,this.setVValue=setVValue,this.addEffect=addEffect}function KeyframedValueProperty(e,i,s,a){this.propType="unidimensional",this.keyframes=i.k,this.keyframesMetadata=[],this.offsetTime=e.data.st,this.frameId=-1,this._caching={lastFrame:initFrame,lastIndex:0,value:0,_lastKeyframeIndex:-1},this.k=!0,this.kf=!0,this.data=i,this.mult=s||1,this.elem=e,this.container=a,this.comp=e.comp,this.v=initFrame,this.pv=initFrame,this._isFirstFrame=!0,this.getValue=processEffectsSequence,this.setVValue=setVValue,this.interpolateValue=interpolateValue,this.effectsSequence=[getValueAtCurrentTime.bind(this)],this.addEffect=addEffect}function KeyframedMultidimensionalProperty(e,i,s,a){this.propType="multidimensional";var _,$=i.k.length,rt,c,dt,ht;for(_=0;_<$-1;_+=1)i.k[_].to&&i.k[_].s&&i.k[_+1]&&i.k[_+1].s&&(rt=i.k[_].s,c=i.k[_+1].s,dt=i.k[_].to,ht=i.k[_].ti,(rt.length===2&&!(rt[0]===c[0]&&rt[1]===c[1])&&bez.pointOnLine2D(rt[0],rt[1],c[0],c[1],rt[0]+dt[0],rt[1]+dt[1])&&bez.pointOnLine2D(rt[0],rt[1],c[0],c[1],c[0]+ht[0],c[1]+ht[1])||rt.length===3&&!(rt[0]===c[0]&&rt[1]===c[1]&&rt[2]===c[2])&&bez.pointOnLine3D(rt[0],rt[1],rt[2],c[0],c[1],c[2],rt[0]+dt[0],rt[1]+dt[1],rt[2]+dt[2])&&bez.pointOnLine3D(rt[0],rt[1],rt[2],c[0],c[1],c[2],c[0]+ht[0],c[1]+ht[1],c[2]+ht[2]))&&(i.k[_].to=null,i.k[_].ti=null),rt[0]===c[0]&&rt[1]===c[1]&&dt[0]===0&&dt[1]===0&&ht[0]===0&&ht[1]===0&&(rt.length===2||rt[2]===c[2]&&dt[2]===0&&ht[2]===0)&&(i.k[_].to=null,i.k[_].ti=null));this.effectsSequence=[getValueAtCurrentTime.bind(this)],this.data=i,this.keyframes=i.k,this.keyframesMetadata=[],this.offsetTime=e.data.st,this.k=!0,this.kf=!0,this._isFirstFrame=!0,this.mult=s||1,this.elem=e,this.container=a,this.comp=e.comp,this.getValue=processEffectsSequence,this.setVValue=setVValue,this.interpolateValue=interpolateValue,this.frameId=-1;var Et=i.k[0].s.length;for(this.v=createTypedArray("float32",Et),this.pv=createTypedArray("float32",Et),_=0;_<Et;_+=1)this.v[_]=initFrame,this.pv[_]=initFrame;this._caching={lastFrame:initFrame,lastIndex:0,value:createTypedArray("float32",Et)},this.addEffect=addEffect}var PropertyFactory=function(){function e(s,a,_,$,rt){a.sid&&(a=s.globalData.slotManager.getProp(a));var c;if(!a.k.length)c=new ValueProperty(s,a,$,rt);else if(typeof a.k[0]=="number")c=new MultiDimensionalProperty(s,a,$,rt);else switch(_){case 0:c=new KeyframedValueProperty(s,a,$,rt);break;case 1:c=new KeyframedMultidimensionalProperty(s,a,$,rt);break}return c.effectsSequence.length&&rt.addDynamicProperty(c),c}var i={getProp:e};return i}();function DynamicPropertyContainer(){}DynamicPropertyContainer.prototype={addDynamicProperty:function(i){this.dynamicProperties.indexOf(i)===-1&&(this.dynamicProperties.push(i),this.container.addDynamicProperty(this),this._isAnimated=!0)},iterateDynamicProperties:function(){this._mdf=!1;var i,s=this.dynamicProperties.length;for(i=0;i<s;i+=1)this.dynamicProperties[i].getValue(),this.dynamicProperties[i]._mdf&&(this._mdf=!0)},initDynamicPropertyContainer:function(i){this.container=i,this.dynamicProperties=[],this._mdf=!1,this._isAnimated=!1}};var pointPool=function(){function e(){return createTypedArray("float32",2)}return poolFactory(8,e)}();function ShapePath(){this.c=!1,this._length=0,this._maxLength=8,this.v=createSizedArray(this._maxLength),this.o=createSizedArray(this._maxLength),this.i=createSizedArray(this._maxLength)}ShapePath.prototype.setPathData=function(e,i){this.c=e,this.setLength(i);for(var s=0;s<i;)this.v[s]=pointPool.newElement(),this.o[s]=pointPool.newElement(),this.i[s]=pointPool.newElement(),s+=1},ShapePath.prototype.setLength=function(e){for(;this._maxLength<e;)this.doubleArrayLength();this._length=e},ShapePath.prototype.doubleArrayLength=function(){this.v=this.v.concat(createSizedArray(this._maxLength)),this.i=this.i.concat(createSizedArray(this._maxLength)),this.o=this.o.concat(createSizedArray(this._maxLength)),this._maxLength*=2},ShapePath.prototype.setXYAt=function(e,i,s,a,_){var $;switch(this._length=Math.max(this._length,a+1),this._length>=this._maxLength&&this.doubleArrayLength(),s){case"v":$=this.v;break;case"i":$=this.i;break;case"o":$=this.o;break;default:$=[];break}(!$[a]||$[a]&&!_)&&($[a]=pointPool.newElement()),$[a][0]=e,$[a][1]=i},ShapePath.prototype.setTripleAt=function(e,i,s,a,_,$,rt,c){this.setXYAt(e,i,"v",rt,c),this.setXYAt(s,a,"o",rt,c),this.setXYAt(_,$,"i",rt,c)},ShapePath.prototype.reverse=function(){var e=new ShapePath;e.setPathData(this.c,this._length);var i=this.v,s=this.o,a=this.i,_=0;this.c&&(e.setTripleAt(i[0][0],i[0][1],a[0][0],a[0][1],s[0][0],s[0][1],0,!1),_=1);var $=this._length-1,rt=this._length,c;for(c=_;c<rt;c+=1)e.setTripleAt(i[$][0],i[$][1],a[$][0],a[$][1],s[$][0],s[$][1],c,!1),$-=1;return e},ShapePath.prototype.length=function(){return this._length};var shapePool=function(){function e(){return new ShapePath}function i(_){var $=_._length,rt;for(rt=0;rt<$;rt+=1)pointPool.release(_.v[rt]),pointPool.release(_.i[rt]),pointPool.release(_.o[rt]),_.v[rt]=null,_.i[rt]=null,_.o[rt]=null;_._length=0,_.c=!1}function s(_){var $=a.newElement(),rt,c=_._length===void 0?_.v.length:_._length;for($.setLength(c),$.c=_.c,rt=0;rt<c;rt+=1)$.setTripleAt(_.v[rt][0],_.v[rt][1],_.o[rt][0],_.o[rt][1],_.i[rt][0],_.i[rt][1],rt);return $}var a=poolFactory(4,e,i);return a.clone=s,a}();function ShapeCollection(){this._length=0,this._maxLength=4,this.shapes=createSizedArray(this._maxLength)}ShapeCollection.prototype.addShape=function(e){this._length===this._maxLength&&(this.shapes=this.shapes.concat(createSizedArray(this._maxLength)),this._maxLength*=2),this.shapes[this._length]=e,this._length+=1},ShapeCollection.prototype.releaseShapes=function(){var e;for(e=0;e<this._length;e+=1)shapePool.release(this.shapes[e]);this._length=0};var shapeCollectionPool=function(){var e={newShapeCollection:_,release:$},i=0,s=4,a=createSizedArray(s);function _(){var rt;return i?(i-=1,rt=a[i]):rt=new ShapeCollection,rt}function $(rt){var c,dt=rt._length;for(c=0;c<dt;c+=1)shapePool.release(rt.shapes[c]);rt._length=0,i===s&&(a=pooling.double(a),s*=2),a[i]=rt,i+=1}return e}(),ShapePropertyFactory=function(){var e=-999999;function i(zt,Ut,Nt){var Gt=Nt.lastIndex,er,ir,or,mr,Rr,on,un,jr,Jr,fn=this.keyframes;if(zt<fn[0].t-this.offsetTime)er=fn[0].s[0],or=!0,Gt=0;else if(zt>=fn[fn.length-1].t-this.offsetTime)er=fn[fn.length-1].s?fn[fn.length-1].s[0]:fn[fn.length-2].e[0],or=!0;else{for(var Fr=Gt,Cr=fn.length-1,Sr=!0,dr,gr,qr;Sr&&(dr=fn[Fr],gr=fn[Fr+1],!(gr.t-this.offsetTime>zt));)Fr<Cr-1?Fr+=1:Sr=!1;if(qr=this.keyframesMetadata[Fr]||{},or=dr.h===1,Gt=Fr,!or){if(zt>=gr.t-this.offsetTime)jr=1;else if(zt<dr.t-this.offsetTime)jr=0;else{var Lr;qr.__fnct?Lr=qr.__fnct:(Lr=BezierFactory.getBezierEasing(dr.o.x,dr.o.y,dr.i.x,dr.i.y).get,qr.__fnct=Lr),jr=Lr((zt-(dr.t-this.offsetTime))/(gr.t-this.offsetTime-(dr.t-this.offsetTime)))}ir=gr.s?gr.s[0]:dr.e[0]}er=dr.s[0]}for(on=Ut._length,un=er.i[0].length,Nt.lastIndex=Gt,mr=0;mr<on;mr+=1)for(Rr=0;Rr<un;Rr+=1)Jr=or?er.i[mr][Rr]:er.i[mr][Rr]+(ir.i[mr][Rr]-er.i[mr][Rr])*jr,Ut.i[mr][Rr]=Jr,Jr=or?er.o[mr][Rr]:er.o[mr][Rr]+(ir.o[mr][Rr]-er.o[mr][Rr])*jr,Ut.o[mr][Rr]=Jr,Jr=or?er.v[mr][Rr]:er.v[mr][Rr]+(ir.v[mr][Rr]-er.v[mr][Rr])*jr,Ut.v[mr][Rr]=Jr}function s(){var zt=this.comp.renderedFrame-this.offsetTime,Ut=this.keyframes[0].t-this.offsetTime,Nt=this.keyframes[this.keyframes.length-1].t-this.offsetTime,Gt=this._caching.lastFrame;return Gt!==e&&(Gt<Ut&&zt<Ut||Gt>Nt&&zt>Nt)||(this._caching.lastIndex=Gt<zt?this._caching.lastIndex:0,this.interpolateShape(zt,this.pv,this._caching)),this._caching.lastFrame=zt,this.pv}function a(){this.paths=this.localShapeCollection}function _(zt,Ut){if(zt._length!==Ut._length||zt.c!==Ut.c)return!1;var Nt,Gt=zt._length;for(Nt=0;Nt<Gt;Nt+=1)if(zt.v[Nt][0]!==Ut.v[Nt][0]||zt.v[Nt][1]!==Ut.v[Nt][1]||zt.o[Nt][0]!==Ut.o[Nt][0]||zt.o[Nt][1]!==Ut.o[Nt][1]||zt.i[Nt][0]!==Ut.i[Nt][0]||zt.i[Nt][1]!==Ut.i[Nt][1])return!1;return!0}function $(zt){_(this.v,zt)||(this.v=shapePool.clone(zt),this.localShapeCollection.releaseShapes(),this.localShapeCollection.addShape(this.v),this._mdf=!0,this.paths=this.localShapeCollection)}function rt(){if(this.elem.globalData.frameId!==this.frameId){if(!this.effectsSequence.length){this._mdf=!1;return}if(this.lock){this.setVValue(this.pv);return}this.lock=!0,this._mdf=!1;var zt;this.kf?zt=this.pv:this.data.ks?zt=this.data.ks.k:zt=this.data.pt.k;var Ut,Nt=this.effectsSequence.length;for(Ut=0;Ut<Nt;Ut+=1)zt=this.effectsSequence[Ut](zt);this.setVValue(zt),this.lock=!1,this.frameId=this.elem.globalData.frameId}}function c(zt,Ut,Nt){this.propType="shape",this.comp=zt.comp,this.container=zt,this.elem=zt,this.data=Ut,this.k=!1,this.kf=!1,this._mdf=!1;var Gt=Nt===3?Ut.pt.k:Ut.ks.k;this.v=shapePool.clone(Gt),this.pv=shapePool.clone(this.v),this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.paths=this.localShapeCollection,this.paths.addShape(this.v),this.reset=a,this.effectsSequence=[]}function dt(zt){this.effectsSequence.push(zt),this.container.addDynamicProperty(this)}c.prototype.interpolateShape=i,c.prototype.getValue=rt,c.prototype.setVValue=$,c.prototype.addEffect=dt;function ht(zt,Ut,Nt){this.propType="shape",this.comp=zt.comp,this.elem=zt,this.container=zt,this.offsetTime=zt.data.st,this.keyframes=Nt===3?Ut.pt.k:Ut.ks.k,this.keyframesMetadata=[],this.k=!0,this.kf=!0;var Gt=this.keyframes[0].s[0].i.length;this.v=shapePool.newElement(),this.v.setPathData(this.keyframes[0].s[0].c,Gt),this.pv=shapePool.clone(this.v),this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.paths=this.localShapeCollection,this.paths.addShape(this.v),this.lastFrame=e,this.reset=a,this._caching={lastFrame:e,lastIndex:0},this.effectsSequence=[s.bind(this)]}ht.prototype.getValue=rt,ht.prototype.interpolateShape=i,ht.prototype.setVValue=$,ht.prototype.addEffect=dt;var Et=function(){var zt=roundCorner;function Ut(Nt,Gt){this.v=shapePool.newElement(),this.v.setPathData(!0,4),this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.paths=this.localShapeCollection,this.localShapeCollection.addShape(this.v),this.d=Gt.d,this.elem=Nt,this.comp=Nt.comp,this.frameId=-1,this.initDynamicPropertyContainer(Nt),this.p=PropertyFactory.getProp(Nt,Gt.p,1,0,this),this.s=PropertyFactory.getProp(Nt,Gt.s,1,0,this),this.dynamicProperties.length?this.k=!0:(this.k=!1,this.convertEllToPath())}return Ut.prototype={reset:a,getValue:function(){this.elem.globalData.frameId!==this.frameId&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties(),this._mdf&&this.convertEllToPath())},convertEllToPath:function(){var Gt=this.p.v[0],er=this.p.v[1],ir=this.s.v[0]/2,or=this.s.v[1]/2,mr=this.d!==3,Rr=this.v;Rr.v[0][0]=Gt,Rr.v[0][1]=er-or,Rr.v[1][0]=mr?Gt+ir:Gt-ir,Rr.v[1][1]=er,Rr.v[2][0]=Gt,Rr.v[2][1]=er+or,Rr.v[3][0]=mr?Gt-ir:Gt+ir,Rr.v[3][1]=er,Rr.i[0][0]=mr?Gt-ir*zt:Gt+ir*zt,Rr.i[0][1]=er-or,Rr.i[1][0]=mr?Gt+ir:Gt-ir,Rr.i[1][1]=er-or*zt,Rr.i[2][0]=mr?Gt+ir*zt:Gt-ir*zt,Rr.i[2][1]=er+or,Rr.i[3][0]=mr?Gt-ir:Gt+ir,Rr.i[3][1]=er+or*zt,Rr.o[0][0]=mr?Gt+ir*zt:Gt-ir*zt,Rr.o[0][1]=er-or,Rr.o[1][0]=mr?Gt+ir:Gt-ir,Rr.o[1][1]=er+or*zt,Rr.o[2][0]=mr?Gt-ir*zt:Gt+ir*zt,Rr.o[2][1]=er+or,Rr.o[3][0]=mr?Gt-ir:Gt+ir,Rr.o[3][1]=er-or*zt}},extendPrototype([DynamicPropertyContainer],Ut),Ut}(),St=function(){function zt(Ut,Nt){this.v=shapePool.newElement(),this.v.setPathData(!0,0),this.elem=Ut,this.comp=Ut.comp,this.data=Nt,this.frameId=-1,this.d=Nt.d,this.initDynamicPropertyContainer(Ut),Nt.sy===1?(this.ir=PropertyFactory.getProp(Ut,Nt.ir,0,0,this),this.is=PropertyFactory.getProp(Ut,Nt.is,0,.01,this),this.convertToPath=this.convertStarToPath):this.convertToPath=this.convertPolygonToPath,this.pt=PropertyFactory.getProp(Ut,Nt.pt,0,0,this),this.p=PropertyFactory.getProp(Ut,Nt.p,1,0,this),this.r=PropertyFactory.getProp(Ut,Nt.r,0,degToRads,this),this.or=PropertyFactory.getProp(Ut,Nt.or,0,0,this),this.os=PropertyFactory.getProp(Ut,Nt.os,0,.01,this),this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.localShapeCollection.addShape(this.v),this.paths=this.localShapeCollection,this.dynamicProperties.length?this.k=!0:(this.k=!1,this.convertToPath())}return zt.prototype={reset:a,getValue:function(){this.elem.globalData.frameId!==this.frameId&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties(),this._mdf&&this.convertToPath())},convertStarToPath:function(){var Nt=Math.floor(this.pt.v)*2,Gt=Math.PI*2/Nt,er=!0,ir=this.or.v,or=this.ir.v,mr=this.os.v,Rr=this.is.v,on=2*Math.PI*ir/(Nt*2),un=2*Math.PI*or/(Nt*2),jr,Jr,fn,Fr,Cr=-Math.PI/2;Cr+=this.r.v;var Sr=this.data.d===3?-1:1;for(this.v._length=0,jr=0;jr<Nt;jr+=1){Jr=er?ir:or,fn=er?mr:Rr,Fr=er?on:un;var dr=Jr*Math.cos(Cr),gr=Jr*Math.sin(Cr),qr=dr===0&&gr===0?0:gr/Math.sqrt(dr*dr+gr*gr),Lr=dr===0&&gr===0?0:-dr/Math.sqrt(dr*dr+gr*gr);dr+=+this.p.v[0],gr+=+this.p.v[1],this.v.setTripleAt(dr,gr,dr-qr*Fr*fn*Sr,gr-Lr*Fr*fn*Sr,dr+qr*Fr*fn*Sr,gr+Lr*Fr*fn*Sr,jr,!0),er=!er,Cr+=Gt*Sr}},convertPolygonToPath:function(){var Nt=Math.floor(this.pt.v),Gt=Math.PI*2/Nt,er=this.or.v,ir=this.os.v,or=2*Math.PI*er/(Nt*4),mr,Rr=-Math.PI*.5,on=this.data.d===3?-1:1;for(Rr+=this.r.v,this.v._length=0,mr=0;mr<Nt;mr+=1){var un=er*Math.cos(Rr),jr=er*Math.sin(Rr),Jr=un===0&&jr===0?0:jr/Math.sqrt(un*un+jr*jr),fn=un===0&&jr===0?0:-un/Math.sqrt(un*un+jr*jr);un+=+this.p.v[0],jr+=+this.p.v[1],this.v.setTripleAt(un,jr,un-Jr*or*ir*on,jr-fn*or*ir*on,un+Jr*or*ir*on,jr+fn*or*ir*on,mr,!0),Rr+=Gt*on}this.paths.length=0,this.paths[0]=this.v}},extendPrototype([DynamicPropertyContainer],zt),zt}(),At=function(){function zt(Ut,Nt){this.v=shapePool.newElement(),this.v.c=!0,this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.localShapeCollection.addShape(this.v),this.paths=this.localShapeCollection,this.elem=Ut,this.comp=Ut.comp,this.frameId=-1,this.d=Nt.d,this.initDynamicPropertyContainer(Ut),this.p=PropertyFactory.getProp(Ut,Nt.p,1,0,this),this.s=PropertyFactory.getProp(Ut,Nt.s,1,0,this),this.r=PropertyFactory.getProp(Ut,Nt.r,0,0,this),this.dynamicProperties.length?this.k=!0:(this.k=!1,this.convertRectToPath())}return zt.prototype={convertRectToPath:function(){var Nt=this.p.v[0],Gt=this.p.v[1],er=this.s.v[0]/2,ir=this.s.v[1]/2,or=bmMin(er,ir,this.r.v),mr=or*(1-roundCorner);this.v._length=0,this.d===2||this.d===1?(this.v.setTripleAt(Nt+er,Gt-ir+or,Nt+er,Gt-ir+or,Nt+er,Gt-ir+mr,0,!0),this.v.setTripleAt(Nt+er,Gt+ir-or,Nt+er,Gt+ir-mr,Nt+er,Gt+ir-or,1,!0),or!==0?(this.v.setTripleAt(Nt+er-or,Gt+ir,Nt+er-or,Gt+ir,Nt+er-mr,Gt+ir,2,!0),this.v.setTripleAt(Nt-er+or,Gt+ir,Nt-er+mr,Gt+ir,Nt-er+or,Gt+ir,3,!0),this.v.setTripleAt(Nt-er,Gt+ir-or,Nt-er,Gt+ir-or,Nt-er,Gt+ir-mr,4,!0),this.v.setTripleAt(Nt-er,Gt-ir+or,Nt-er,Gt-ir+mr,Nt-er,Gt-ir+or,5,!0),this.v.setTripleAt(Nt-er+or,Gt-ir,Nt-er+or,Gt-ir,Nt-er+mr,Gt-ir,6,!0),this.v.setTripleAt(Nt+er-or,Gt-ir,Nt+er-mr,Gt-ir,Nt+er-or,Gt-ir,7,!0)):(this.v.setTripleAt(Nt-er,Gt+ir,Nt-er+mr,Gt+ir,Nt-er,Gt+ir,2),this.v.setTripleAt(Nt-er,Gt-ir,Nt-er,Gt-ir+mr,Nt-er,Gt-ir,3))):(this.v.setTripleAt(Nt+er,Gt-ir+or,Nt+er,Gt-ir+mr,Nt+er,Gt-ir+or,0,!0),or!==0?(this.v.setTripleAt(Nt+er-or,Gt-ir,Nt+er-or,Gt-ir,Nt+er-mr,Gt-ir,1,!0),this.v.setTripleAt(Nt-er+or,Gt-ir,Nt-er+mr,Gt-ir,Nt-er+or,Gt-ir,2,!0),this.v.setTripleAt(Nt-er,Gt-ir+or,Nt-er,Gt-ir+or,Nt-er,Gt-ir+mr,3,!0),this.v.setTripleAt(Nt-er,Gt+ir-or,Nt-er,Gt+ir-mr,Nt-er,Gt+ir-or,4,!0),this.v.setTripleAt(Nt-er+or,Gt+ir,Nt-er+or,Gt+ir,Nt-er+mr,Gt+ir,5,!0),this.v.setTripleAt(Nt+er-or,Gt+ir,Nt+er-mr,Gt+ir,Nt+er-or,Gt+ir,6,!0),this.v.setTripleAt(Nt+er,Gt+ir-or,Nt+er,Gt+ir-or,Nt+er,Gt+ir-mr,7,!0)):(this.v.setTripleAt(Nt-er,Gt-ir,Nt-er+mr,Gt-ir,Nt-er,Gt-ir,1,!0),this.v.setTripleAt(Nt-er,Gt+ir,Nt-er,Gt+ir-mr,Nt-er,Gt+ir,2,!0),this.v.setTripleAt(Nt+er,Gt+ir,Nt+er-mr,Gt+ir,Nt+er,Gt+ir,3,!0)))},getValue:function(){this.elem.globalData.frameId!==this.frameId&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties(),this._mdf&&this.convertRectToPath())},reset:a},extendPrototype([DynamicPropertyContainer],zt),zt}();function Pt(zt,Ut,Nt){var Gt;if(Nt===3||Nt===4){var er=Nt===3?Ut.pt:Ut.ks,ir=er.k;ir.length?Gt=new ht(zt,Ut,Nt):Gt=new c(zt,Ut,Nt)}else Nt===5?Gt=new At(zt,Ut):Nt===6?Gt=new Et(zt,Ut):Nt===7&&(Gt=new St(zt,Ut));return Gt.k&&zt.addDynamicProperty(Gt),Gt}function Vt(){return c}function Bt(){return ht}var Zt={};return Zt.getShapeProp=Pt,Zt.getConstructorFunction=Vt,Zt.getKeyframedConstructorFunction=Bt,Zt}();/*!
 Transformation Matrix v2.0
 (c) Epistemex 2014-2015
 www.epistemex.com
 By Ken Fyrstenberg
 Contributions by leeoniya.
 License: MIT, header required.
 */var Matrix=function(){var e=Math.cos,i=Math.sin,s=Math.tan,a=Math.round;function _(){return this.props[0]=1,this.props[1]=0,this.props[2]=0,this.props[3]=0,this.props[4]=0,this.props[5]=1,this.props[6]=0,this.props[7]=0,this.props[8]=0,this.props[9]=0,this.props[10]=1,this.props[11]=0,this.props[12]=0,this.props[13]=0,this.props[14]=0,this.props[15]=1,this}function $(dr){if(dr===0)return this;var gr=e(dr),qr=i(dr);return this._t(gr,-qr,0,0,qr,gr,0,0,0,0,1,0,0,0,0,1)}function rt(dr){if(dr===0)return this;var gr=e(dr),qr=i(dr);return this._t(1,0,0,0,0,gr,-qr,0,0,qr,gr,0,0,0,0,1)}function c(dr){if(dr===0)return this;var gr=e(dr),qr=i(dr);return this._t(gr,0,qr,0,0,1,0,0,-qr,0,gr,0,0,0,0,1)}function dt(dr){if(dr===0)return this;var gr=e(dr),qr=i(dr);return this._t(gr,-qr,0,0,qr,gr,0,0,0,0,1,0,0,0,0,1)}function ht(dr,gr){return this._t(1,gr,dr,1,0,0)}function Et(dr,gr){return this.shear(s(dr),s(gr))}function St(dr,gr){var qr=e(gr),Lr=i(gr);return this._t(qr,Lr,0,0,-Lr,qr,0,0,0,0,1,0,0,0,0,1)._t(1,0,0,0,s(dr),1,0,0,0,0,1,0,0,0,0,1)._t(qr,-Lr,0,0,Lr,qr,0,0,0,0,1,0,0,0,0,1)}function At(dr,gr,qr){return!qr&&qr!==0&&(qr=1),dr===1&&gr===1&&qr===1?this:this._t(dr,0,0,0,0,gr,0,0,0,0,qr,0,0,0,0,1)}function Pt(dr,gr,qr,Lr,_n,gn,Sn,Fs,rs,ms,On,ws,Vs,ks,lo,ys){return this.props[0]=dr,this.props[1]=gr,this.props[2]=qr,this.props[3]=Lr,this.props[4]=_n,this.props[5]=gn,this.props[6]=Sn,this.props[7]=Fs,this.props[8]=rs,this.props[9]=ms,this.props[10]=On,this.props[11]=ws,this.props[12]=Vs,this.props[13]=ks,this.props[14]=lo,this.props[15]=ys,this}function Vt(dr,gr,qr){return qr=qr||0,dr!==0||gr!==0||qr!==0?this._t(1,0,0,0,0,1,0,0,0,0,1,0,dr,gr,qr,1):this}function Bt(dr,gr,qr,Lr,_n,gn,Sn,Fs,rs,ms,On,ws,Vs,ks,lo,ys){var dn=this.props;if(dr===1&&gr===0&&qr===0&&Lr===0&&_n===0&&gn===1&&Sn===0&&Fs===0&&rs===0&&ms===0&&On===1&&ws===0)return dn[12]=dn[12]*dr+dn[15]*Vs,dn[13]=dn[13]*gn+dn[15]*ks,dn[14]=dn[14]*On+dn[15]*lo,dn[15]*=ys,this._identityCalculated=!1,this;var Es=dn[0],po=dn[1],no=dn[2],tn=dn[3],us=dn[4],Co=dn[5],Ss=dn[6],Ul=dn[7],Tl=dn[8],ga=dn[9],ds=dn[10],Mn=dn[11],Cs=dn[12],Ds=dn[13],ao=dn[14],Wo=dn[15];return dn[0]=Es*dr+po*_n+no*rs+tn*Vs,dn[1]=Es*gr+po*gn+no*ms+tn*ks,dn[2]=Es*qr+po*Sn+no*On+tn*lo,dn[3]=Es*Lr+po*Fs+no*ws+tn*ys,dn[4]=us*dr+Co*_n+Ss*rs+Ul*Vs,dn[5]=us*gr+Co*gn+Ss*ms+Ul*ks,dn[6]=us*qr+Co*Sn+Ss*On+Ul*lo,dn[7]=us*Lr+Co*Fs+Ss*ws+Ul*ys,dn[8]=Tl*dr+ga*_n+ds*rs+Mn*Vs,dn[9]=Tl*gr+ga*gn+ds*ms+Mn*ks,dn[10]=Tl*qr+ga*Sn+ds*On+Mn*lo,dn[11]=Tl*Lr+ga*Fs+ds*ws+Mn*ys,dn[12]=Cs*dr+Ds*_n+ao*rs+Wo*Vs,dn[13]=Cs*gr+Ds*gn+ao*ms+Wo*ks,dn[14]=Cs*qr+Ds*Sn+ao*On+Wo*lo,dn[15]=Cs*Lr+Ds*Fs+ao*ws+Wo*ys,this._identityCalculated=!1,this}function Zt(dr){var gr=dr.props;return this.transform(gr[0],gr[1],gr[2],gr[3],gr[4],gr[5],gr[6],gr[7],gr[8],gr[9],gr[10],gr[11],gr[12],gr[13],gr[14],gr[15])}function zt(){return this._identityCalculated||(this._identity=!(this.props[0]!==1||this.props[1]!==0||this.props[2]!==0||this.props[3]!==0||this.props[4]!==0||this.props[5]!==1||this.props[6]!==0||this.props[7]!==0||this.props[8]!==0||this.props[9]!==0||this.props[10]!==1||this.props[11]!==0||this.props[12]!==0||this.props[13]!==0||this.props[14]!==0||this.props[15]!==1),this._identityCalculated=!0),this._identity}function Ut(dr){for(var gr=0;gr<16;){if(dr.props[gr]!==this.props[gr])return!1;gr+=1}return!0}function Nt(dr){var gr;for(gr=0;gr<16;gr+=1)dr.props[gr]=this.props[gr];return dr}function Gt(dr){var gr;for(gr=0;gr<16;gr+=1)this.props[gr]=dr[gr]}function er(dr,gr,qr){return{x:dr*this.props[0]+gr*this.props[4]+qr*this.props[8]+this.props[12],y:dr*this.props[1]+gr*this.props[5]+qr*this.props[9]+this.props[13],z:dr*this.props[2]+gr*this.props[6]+qr*this.props[10]+this.props[14]}}function ir(dr,gr,qr){return dr*this.props[0]+gr*this.props[4]+qr*this.props[8]+this.props[12]}function or(dr,gr,qr){return dr*this.props[1]+gr*this.props[5]+qr*this.props[9]+this.props[13]}function mr(dr,gr,qr){return dr*this.props[2]+gr*this.props[6]+qr*this.props[10]+this.props[14]}function Rr(){var dr=this.props[0]*this.props[5]-this.props[1]*this.props[4],gr=this.props[5]/dr,qr=-this.props[1]/dr,Lr=-this.props[4]/dr,_n=this.props[0]/dr,gn=(this.props[4]*this.props[13]-this.props[5]*this.props[12])/dr,Sn=-(this.props[0]*this.props[13]-this.props[1]*this.props[12])/dr,Fs=new Matrix;return Fs.props[0]=gr,Fs.props[1]=qr,Fs.props[4]=Lr,Fs.props[5]=_n,Fs.props[12]=gn,Fs.props[13]=Sn,Fs}function on(dr){var gr=this.getInverseMatrix();return gr.applyToPointArray(dr[0],dr[1],dr[2]||0)}function un(dr){var gr,qr=dr.length,Lr=[];for(gr=0;gr<qr;gr+=1)Lr[gr]=on(dr[gr]);return Lr}function jr(dr,gr,qr){var Lr=createTypedArray("float32",6);if(this.isIdentity())Lr[0]=dr[0],Lr[1]=dr[1],Lr[2]=gr[0],Lr[3]=gr[1],Lr[4]=qr[0],Lr[5]=qr[1];else{var _n=this.props[0],gn=this.props[1],Sn=this.props[4],Fs=this.props[5],rs=this.props[12],ms=this.props[13];Lr[0]=dr[0]*_n+dr[1]*Sn+rs,Lr[1]=dr[0]*gn+dr[1]*Fs+ms,Lr[2]=gr[0]*_n+gr[1]*Sn+rs,Lr[3]=gr[0]*gn+gr[1]*Fs+ms,Lr[4]=qr[0]*_n+qr[1]*Sn+rs,Lr[5]=qr[0]*gn+qr[1]*Fs+ms}return Lr}function Jr(dr,gr,qr){var Lr;return this.isIdentity()?Lr=[dr,gr,qr]:Lr=[dr*this.props[0]+gr*this.props[4]+qr*this.props[8]+this.props[12],dr*this.props[1]+gr*this.props[5]+qr*this.props[9]+this.props[13],dr*this.props[2]+gr*this.props[6]+qr*this.props[10]+this.props[14]],Lr}function fn(dr,gr){if(this.isIdentity())return dr+","+gr;var qr=this.props;return Math.round((dr*qr[0]+gr*qr[4]+qr[12])*100)/100+","+Math.round((dr*qr[1]+gr*qr[5]+qr[13])*100)/100}function Fr(){for(var dr=0,gr=this.props,qr="matrix3d(",Lr=1e4;dr<16;)qr+=a(gr[dr]*Lr)/Lr,qr+=dr===15?")":",",dr+=1;return qr}function Cr(dr){var gr=1e4;return dr<1e-6&&dr>0||dr>-1e-6&&dr<0?a(dr*gr)/gr:dr}function Sr(){var dr=this.props,gr=Cr(dr[0]),qr=Cr(dr[1]),Lr=Cr(dr[4]),_n=Cr(dr[5]),gn=Cr(dr[12]),Sn=Cr(dr[13]);return"matrix("+gr+","+qr+","+Lr+","+_n+","+gn+","+Sn+")"}return function(){this.reset=_,this.rotate=$,this.rotateX=rt,this.rotateY=c,this.rotateZ=dt,this.skew=Et,this.skewFromAxis=St,this.shear=ht,this.scale=At,this.setTransform=Pt,this.translate=Vt,this.transform=Bt,this.multiply=Zt,this.applyToPoint=er,this.applyToX=ir,this.applyToY=or,this.applyToZ=mr,this.applyToPointArray=Jr,this.applyToTriplePoints=jr,this.applyToPointStringified=fn,this.toCSS=Fr,this.to2dCSS=Sr,this.clone=Nt,this.cloneFromProps=Gt,this.equals=Ut,this.inversePoints=un,this.inversePoint=on,this.getInverseMatrix=Rr,this._t=this.transform,this.isIdentity=zt,this._identity=!0,this._identityCalculated=!1,this.props=createTypedArray("float32",16),this.reset()}}();function _typeof$3(e){"@babel/helpers - typeof";return _typeof$3=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},_typeof$3(e)}var lottie={};function setLocation(e){setLocationHref(e)}function searchAnimations(){animationManager.searchAnimations()}function setSubframeRendering(e){setSubframeEnabled(e)}function setPrefix(e){setIdPrefix(e)}function loadAnimation(e){return animationManager.loadAnimation(e)}function setQuality(e){if(typeof e=="string")switch(e){case"high":setDefaultCurveSegments(200);break;default:case"medium":setDefaultCurveSegments(50);break;case"low":setDefaultCurveSegments(10);break}else!isNaN(e)&&e>1&&setDefaultCurveSegments(e)}function inBrowser(){return typeof navigator<"u"}function installPlugin(e,i){e==="expressions"&&setExpressionsPlugin(i)}function getFactory(e){switch(e){case"propertyFactory":return PropertyFactory;case"shapePropertyFactory":return ShapePropertyFactory;case"matrix":return Matrix;default:return null}}lottie.play=animationManager.play,lottie.pause=animationManager.pause,lottie.setLocationHref=setLocation,lottie.togglePause=animationManager.togglePause,lottie.setSpeed=animationManager.setSpeed,lottie.setDirection=animationManager.setDirection,lottie.stop=animationManager.stop,lottie.searchAnimations=searchAnimations,lottie.registerAnimation=animationManager.registerAnimation,lottie.loadAnimation=loadAnimation,lottie.setSubframeRendering=setSubframeRendering,lottie.resize=animationManager.resize,lottie.goToAndStop=animationManager.goToAndStop,lottie.destroy=animationManager.destroy,lottie.setQuality=setQuality,lottie.inBrowser=inBrowser,lottie.installPlugin=installPlugin,lottie.freeze=animationManager.freeze,lottie.unfreeze=animationManager.unfreeze,lottie.setVolume=animationManager.setVolume,lottie.mute=animationManager.mute,lottie.unmute=animationManager.unmute,lottie.getRegisteredAnimations=animationManager.getRegisteredAnimations,lottie.useWebWorker=setWebWorker,lottie.setIDPrefix=setPrefix,lottie.__getFactory=getFactory,lottie.version="5.13.0";function checkReady(){document.readyState==="complete"&&(clearInterval(readyStateCheckInterval),searchAnimations())}function getQueryVariable(e){for(var i=queryString.split("&"),s=0;s<i.length;s+=1){var a=i[s].split("=");if(decodeURIComponent(a[0])==e)return decodeURIComponent(a[1])}return null}var queryString="";{var scripts=document.getElementsByTagName("script"),index=scripts.length-1,myScript=scripts[index]||{src:""};queryString=myScript.src?myScript.src.replace(/^[^\?]+\??/,""):"",getQueryVariable("renderer")}var readyStateCheckInterval=setInterval(checkReady,100);try{_typeof$3(exports)!=="object"&&(window.bodymovin=lottie)}catch(e){}var ShapeModifiers=function(){var e={},i={};e.registerModifier=s,e.getModifier=a;function s(_,$){i[_]||(i[_]=$)}function a(_,$,rt){return new i[_]($,rt)}return e}();function ShapeModifier(){}ShapeModifier.prototype.initModifierProperties=function(){},ShapeModifier.prototype.addShapeToModifier=function(){},ShapeModifier.prototype.addShape=function(e){if(!this.closed){e.sh.container.addDynamicProperty(e.sh);var i={shape:e.sh,data:e,localShapeCollection:shapeCollectionPool.newShapeCollection()};this.shapes.push(i),this.addShapeToModifier(i),this._isAnimated&&e.setAsAnimated()}},ShapeModifier.prototype.init=function(e,i){this.shapes=[],this.elem=e,this.initDynamicPropertyContainer(e),this.initModifierProperties(e,i),this.frameId=initialDefaultFrame,this.closed=!1,this.k=!1,this.dynamicProperties.length?this.k=!0:this.getValue(!0)},ShapeModifier.prototype.processKeys=function(){this.elem.globalData.frameId!==this.frameId&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties())},extendPrototype([DynamicPropertyContainer],ShapeModifier);function TrimModifier(){}extendPrototype([ShapeModifier],TrimModifier),TrimModifier.prototype.initModifierProperties=function(e,i){this.s=PropertyFactory.getProp(e,i.s,0,.01,this),this.e=PropertyFactory.getProp(e,i.e,0,.01,this),this.o=PropertyFactory.getProp(e,i.o,0,0,this),this.sValue=0,this.eValue=0,this.getValue=this.processKeys,this.m=i.m,this._isAnimated=!!this.s.effectsSequence.length||!!this.e.effectsSequence.length||!!this.o.effectsSequence.length},TrimModifier.prototype.addShapeToModifier=function(e){e.pathsData=[]},TrimModifier.prototype.calculateShapeEdges=function(e,i,s,a,_){var $=[];i<=1?$.push({s:e,e:i}):e>=1?$.push({s:e-1,e:i-1}):($.push({s:e,e:1}),$.push({s:0,e:i-1}));var rt=[],c,dt=$.length,ht;for(c=0;c<dt;c+=1)if(ht=$[c],!(ht.e*_<a||ht.s*_>a+s)){var Et,St;ht.s*_<=a?Et=0:Et=(ht.s*_-a)/s,ht.e*_>=a+s?St=1:St=(ht.e*_-a)/s,rt.push([Et,St])}return rt.length||rt.push([0,0]),rt},TrimModifier.prototype.releasePathsData=function(e){var i,s=e.length;for(i=0;i<s;i+=1)segmentsLengthPool.release(e[i]);return e.length=0,e},TrimModifier.prototype.processShapes=function(e){var i,s;if(this._mdf||e){var a=this.o.v%360/360;if(a<0&&(a+=1),this.s.v>1?i=1+a:this.s.v<0?i=0+a:i=this.s.v+a,this.e.v>1?s=1+a:this.e.v<0?s=0+a:s=this.e.v+a,i>s){var _=i;i=s,s=_}i=Math.round(i*1e4)*1e-4,s=Math.round(s*1e4)*1e-4,this.sValue=i,this.eValue=s}else i=this.sValue,s=this.eValue;var $,rt,c=this.shapes.length,dt,ht,Et,St,At,Pt=0;if(s===i)for(rt=0;rt<c;rt+=1)this.shapes[rt].localShapeCollection.releaseShapes(),this.shapes[rt].shape._mdf=!0,this.shapes[rt].shape.paths=this.shapes[rt].localShapeCollection,this._mdf&&(this.shapes[rt].pathsData.length=0);else if(s===1&&i===0||s===0&&i===1){if(this._mdf)for(rt=0;rt<c;rt+=1)this.shapes[rt].pathsData.length=0,this.shapes[rt].shape._mdf=!0}else{var Vt=[],Bt,Zt;for(rt=0;rt<c;rt+=1)if(Bt=this.shapes[rt],!Bt.shape._mdf&&!this._mdf&&!e&&this.m!==2)Bt.shape.paths=Bt.localShapeCollection;else{if($=Bt.shape.paths,ht=$._length,At=0,!Bt.shape._mdf&&Bt.pathsData.length)At=Bt.totalShapeLength;else{for(Et=this.releasePathsData(Bt.pathsData),dt=0;dt<ht;dt+=1)St=bez.getSegmentsLength($.shapes[dt]),Et.push(St),At+=St.totalLength;Bt.totalShapeLength=At,Bt.pathsData=Et}Pt+=At,Bt.shape._mdf=!0}var zt=i,Ut=s,Nt=0,Gt;for(rt=c-1;rt>=0;rt-=1)if(Bt=this.shapes[rt],Bt.shape._mdf){for(Zt=Bt.localShapeCollection,Zt.releaseShapes(),this.m===2&&c>1?(Gt=this.calculateShapeEdges(i,s,Bt.totalShapeLength,Nt,Pt),Nt+=Bt.totalShapeLength):Gt=[[zt,Ut]],ht=Gt.length,dt=0;dt<ht;dt+=1){zt=Gt[dt][0],Ut=Gt[dt][1],Vt.length=0,Ut<=1?Vt.push({s:Bt.totalShapeLength*zt,e:Bt.totalShapeLength*Ut}):zt>=1?Vt.push({s:Bt.totalShapeLength*(zt-1),e:Bt.totalShapeLength*(Ut-1)}):(Vt.push({s:Bt.totalShapeLength*zt,e:Bt.totalShapeLength}),Vt.push({s:0,e:Bt.totalShapeLength*(Ut-1)}));var er=this.addShapes(Bt,Vt[0]);if(Vt[0].s!==Vt[0].e){if(Vt.length>1){var ir=Bt.shape.paths.shapes[Bt.shape.paths._length-1];if(ir.c){var or=er.pop();this.addPaths(er,Zt),er=this.addShapes(Bt,Vt[1],or)}else this.addPaths(er,Zt),er=this.addShapes(Bt,Vt[1])}this.addPaths(er,Zt)}}Bt.shape.paths=Zt}}},TrimModifier.prototype.addPaths=function(e,i){var s,a=e.length;for(s=0;s<a;s+=1)i.addShape(e[s])},TrimModifier.prototype.addSegment=function(e,i,s,a,_,$,rt){_.setXYAt(i[0],i[1],"o",$),_.setXYAt(s[0],s[1],"i",$+1),rt&&_.setXYAt(e[0],e[1],"v",$),_.setXYAt(a[0],a[1],"v",$+1)},TrimModifier.prototype.addSegmentFromArray=function(e,i,s,a){i.setXYAt(e[1],e[5],"o",s),i.setXYAt(e[2],e[6],"i",s+1),a&&i.setXYAt(e[0],e[4],"v",s),i.setXYAt(e[3],e[7],"v",s+1)},TrimModifier.prototype.addShapes=function(e,i,s){var a=e.pathsData,_=e.shape.paths.shapes,$,rt=e.shape.paths._length,c,dt,ht=0,Et,St,At,Pt,Vt=[],Bt,Zt=!0;for(s?(St=s._length,Bt=s._length):(s=shapePool.newElement(),St=0,Bt=0),Vt.push(s),$=0;$<rt;$+=1){for(At=a[$].lengths,s.c=_[$].c,dt=_[$].c?At.length:At.length+1,c=1;c<dt;c+=1)if(Et=At[c-1],ht+Et.addedLength<i.s)ht+=Et.addedLength,s.c=!1;else if(ht>i.e){s.c=!1;break}else i.s<=ht&&i.e>=ht+Et.addedLength?(this.addSegment(_[$].v[c-1],_[$].o[c-1],_[$].i[c],_[$].v[c],s,St,Zt),Zt=!1):(Pt=bez.getNewSegment(_[$].v[c-1],_[$].v[c],_[$].o[c-1],_[$].i[c],(i.s-ht)/Et.addedLength,(i.e-ht)/Et.addedLength,At[c-1]),this.addSegmentFromArray(Pt,s,St,Zt),Zt=!1,s.c=!1),ht+=Et.addedLength,St+=1;if(_[$].c&&At.length){if(Et=At[c-1],ht<=i.e){var zt=At[c-1].addedLength;i.s<=ht&&i.e>=ht+zt?(this.addSegment(_[$].v[c-1],_[$].o[c-1],_[$].i[0],_[$].v[0],s,St,Zt),Zt=!1):(Pt=bez.getNewSegment(_[$].v[c-1],_[$].v[0],_[$].o[c-1],_[$].i[0],(i.s-ht)/zt,(i.e-ht)/zt,At[c-1]),this.addSegmentFromArray(Pt,s,St,Zt),Zt=!1,s.c=!1)}else s.c=!1;ht+=Et.addedLength,St+=1}if(s._length&&(s.setXYAt(s.v[Bt][0],s.v[Bt][1],"i",Bt),s.setXYAt(s.v[s._length-1][0],s.v[s._length-1][1],"o",s._length-1)),ht>i.e)break;$<rt-1&&(s=shapePool.newElement(),Zt=!0,Vt.push(s),St=0)}return Vt};function PuckerAndBloatModifier(){}extendPrototype([ShapeModifier],PuckerAndBloatModifier),PuckerAndBloatModifier.prototype.initModifierProperties=function(e,i){this.getValue=this.processKeys,this.amount=PropertyFactory.getProp(e,i.a,0,null,this),this._isAnimated=!!this.amount.effectsSequence.length},PuckerAndBloatModifier.prototype.processPath=function(e,i){var s=i/100,a=[0,0],_=e._length,$=0;for($=0;$<_;$+=1)a[0]+=e.v[$][0],a[1]+=e.v[$][1];a[0]/=_,a[1]/=_;var rt=shapePool.newElement();rt.c=e.c;var c,dt,ht,Et,St,At;for($=0;$<_;$+=1)c=e.v[$][0]+(a[0]-e.v[$][0])*s,dt=e.v[$][1]+(a[1]-e.v[$][1])*s,ht=e.o[$][0]+(a[0]-e.o[$][0])*-s,Et=e.o[$][1]+(a[1]-e.o[$][1])*-s,St=e.i[$][0]+(a[0]-e.i[$][0])*-s,At=e.i[$][1]+(a[1]-e.i[$][1])*-s,rt.setTripleAt(c,dt,ht,Et,St,At,$);return rt},PuckerAndBloatModifier.prototype.processShapes=function(e){var i,s,a=this.shapes.length,_,$,rt=this.amount.v;if(rt!==0){var c,dt;for(s=0;s<a;s+=1){if(c=this.shapes[s],dt=c.localShapeCollection,!(!c.shape._mdf&&!this._mdf&&!e))for(dt.releaseShapes(),c.shape._mdf=!0,i=c.shape.paths.shapes,$=c.shape.paths._length,_=0;_<$;_+=1)dt.addShape(this.processPath(i[_],rt));c.shape.paths=c.localShapeCollection}}this.dynamicProperties.length||(this._mdf=!1)};var TransformPropertyFactory=function(){var e=[0,0];function i(dt){var ht=this._mdf;this.iterateDynamicProperties(),this._mdf=this._mdf||ht,this.a&&dt.translate(-this.a.v[0],-this.a.v[1],this.a.v[2]),this.s&&dt.scale(this.s.v[0],this.s.v[1],this.s.v[2]),this.sk&&dt.skewFromAxis(-this.sk.v,this.sa.v),this.r?dt.rotate(-this.r.v):dt.rotateZ(-this.rz.v).rotateY(this.ry.v).rotateX(this.rx.v).rotateZ(-this.or.v[2]).rotateY(this.or.v[1]).rotateX(this.or.v[0]),this.data.p.s?this.data.p.z?dt.translate(this.px.v,this.py.v,-this.pz.v):dt.translate(this.px.v,this.py.v,0):dt.translate(this.p.v[0],this.p.v[1],-this.p.v[2])}function s(dt){if(this.elem.globalData.frameId!==this.frameId){if(this._isDirty&&(this.precalculateMatrix(),this._isDirty=!1),this.iterateDynamicProperties(),this._mdf||dt){var ht;if(this.v.cloneFromProps(this.pre.props),this.appliedTransformations<1&&this.v.translate(-this.a.v[0],-this.a.v[1],this.a.v[2]),this.appliedTransformations<2&&this.v.scale(this.s.v[0],this.s.v[1],this.s.v[2]),this.sk&&this.appliedTransformations<3&&this.v.skewFromAxis(-this.sk.v,this.sa.v),this.r&&this.appliedTransformations<4?this.v.rotate(-this.r.v):!this.r&&this.appliedTransformations<4&&this.v.rotateZ(-this.rz.v).rotateY(this.ry.v).rotateX(this.rx.v).rotateZ(-this.or.v[2]).rotateY(this.or.v[1]).rotateX(this.or.v[0]),this.autoOriented){var Et,St;if(ht=this.elem.globalData.frameRate,this.p&&this.p.keyframes&&this.p.getValueAtTime)this.p._caching.lastFrame+this.p.offsetTime<=this.p.keyframes[0].t?(Et=this.p.getValueAtTime((this.p.keyframes[0].t+.01)/ht,0),St=this.p.getValueAtTime(this.p.keyframes[0].t/ht,0)):this.p._caching.lastFrame+this.p.offsetTime>=this.p.keyframes[this.p.keyframes.length-1].t?(Et=this.p.getValueAtTime(this.p.keyframes[this.p.keyframes.length-1].t/ht,0),St=this.p.getValueAtTime((this.p.keyframes[this.p.keyframes.length-1].t-.05)/ht,0)):(Et=this.p.pv,St=this.p.getValueAtTime((this.p._caching.lastFrame+this.p.offsetTime-.01)/ht,this.p.offsetTime));else if(this.px&&this.px.keyframes&&this.py.keyframes&&this.px.getValueAtTime&&this.py.getValueAtTime){Et=[],St=[];var At=this.px,Pt=this.py;At._caching.lastFrame+At.offsetTime<=At.keyframes[0].t?(Et[0]=At.getValueAtTime((At.keyframes[0].t+.01)/ht,0),Et[1]=Pt.getValueAtTime((Pt.keyframes[0].t+.01)/ht,0),St[0]=At.getValueAtTime(At.keyframes[0].t/ht,0),St[1]=Pt.getValueAtTime(Pt.keyframes[0].t/ht,0)):At._caching.lastFrame+At.offsetTime>=At.keyframes[At.keyframes.length-1].t?(Et[0]=At.getValueAtTime(At.keyframes[At.keyframes.length-1].t/ht,0),Et[1]=Pt.getValueAtTime(Pt.keyframes[Pt.keyframes.length-1].t/ht,0),St[0]=At.getValueAtTime((At.keyframes[At.keyframes.length-1].t-.01)/ht,0),St[1]=Pt.getValueAtTime((Pt.keyframes[Pt.keyframes.length-1].t-.01)/ht,0)):(Et=[At.pv,Pt.pv],St[0]=At.getValueAtTime((At._caching.lastFrame+At.offsetTime-.01)/ht,At.offsetTime),St[1]=Pt.getValueAtTime((Pt._caching.lastFrame+Pt.offsetTime-.01)/ht,Pt.offsetTime))}else St=e,Et=St;this.v.rotate(-Math.atan2(Et[1]-St[1],Et[0]-St[0]))}this.data.p&&this.data.p.s?this.data.p.z?this.v.translate(this.px.v,this.py.v,-this.pz.v):this.v.translate(this.px.v,this.py.v,0):this.v.translate(this.p.v[0],this.p.v[1],-this.p.v[2])}this.frameId=this.elem.globalData.frameId}}function a(){if(this.appliedTransformations=0,this.pre.reset(),!this.a.effectsSequence.length)this.pre.translate(-this.a.v[0],-this.a.v[1],this.a.v[2]),this.appliedTransformations=1;else return;if(!this.s.effectsSequence.length)this.pre.scale(this.s.v[0],this.s.v[1],this.s.v[2]),this.appliedTransformations=2;else return;if(this.sk)if(!this.sk.effectsSequence.length&&!this.sa.effectsSequence.length)this.pre.skewFromAxis(-this.sk.v,this.sa.v),this.appliedTransformations=3;else return;this.r?this.r.effectsSequence.length||(this.pre.rotate(-this.r.v),this.appliedTransformations=4):!this.rz.effectsSequence.length&&!this.ry.effectsSequence.length&&!this.rx.effectsSequence.length&&!this.or.effectsSequence.length&&(this.pre.rotateZ(-this.rz.v).rotateY(this.ry.v).rotateX(this.rx.v).rotateZ(-this.or.v[2]).rotateY(this.or.v[1]).rotateX(this.or.v[0]),this.appliedTransformations=4)}function _(){}function $(dt){this._addDynamicProperty(dt),this.elem.addDynamicProperty(dt),this._isDirty=!0}function rt(dt,ht,Et){if(this.elem=dt,this.frameId=-1,this.propType="transform",this.data=ht,this.v=new Matrix,this.pre=new Matrix,this.appliedTransformations=0,this.initDynamicPropertyContainer(Et||dt),ht.p&&ht.p.s?(this.px=PropertyFactory.getProp(dt,ht.p.x,0,0,this),this.py=PropertyFactory.getProp(dt,ht.p.y,0,0,this),ht.p.z&&(this.pz=PropertyFactory.getProp(dt,ht.p.z,0,0,this))):this.p=PropertyFactory.getProp(dt,ht.p||{k:[0,0,0]},1,0,this),ht.rx){if(this.rx=PropertyFactory.getProp(dt,ht.rx,0,degToRads,this),this.ry=PropertyFactory.getProp(dt,ht.ry,0,degToRads,this),this.rz=PropertyFactory.getProp(dt,ht.rz,0,degToRads,this),ht.or.k[0].ti){var St,At=ht.or.k.length;for(St=0;St<At;St+=1)ht.or.k[St].to=null,ht.or.k[St].ti=null}this.or=PropertyFactory.getProp(dt,ht.or,1,degToRads,this),this.or.sh=!0}else this.r=PropertyFactory.getProp(dt,ht.r||{k:0},0,degToRads,this);ht.sk&&(this.sk=PropertyFactory.getProp(dt,ht.sk,0,degToRads,this),this.sa=PropertyFactory.getProp(dt,ht.sa,0,degToRads,this)),this.a=PropertyFactory.getProp(dt,ht.a||{k:[0,0,0]},1,0,this),this.s=PropertyFactory.getProp(dt,ht.s||{k:[100,100,100]},1,.01,this),ht.o?this.o=PropertyFactory.getProp(dt,ht.o,0,.01,dt):this.o={_mdf:!1,v:1},this._isDirty=!0,this.dynamicProperties.length||this.getValue(!0)}rt.prototype={applyToMatrix:i,getValue:s,precalculateMatrix:a,autoOrient:_},extendPrototype([DynamicPropertyContainer],rt),rt.prototype.addDynamicProperty=$,rt.prototype._addDynamicProperty=DynamicPropertyContainer.prototype.addDynamicProperty;function c(dt,ht,Et){return new rt(dt,ht,Et)}return{getTransformProperty:c}}();function RepeaterModifier(){}extendPrototype([ShapeModifier],RepeaterModifier),RepeaterModifier.prototype.initModifierProperties=function(e,i){this.getValue=this.processKeys,this.c=PropertyFactory.getProp(e,i.c,0,null,this),this.o=PropertyFactory.getProp(e,i.o,0,null,this),this.tr=TransformPropertyFactory.getTransformProperty(e,i.tr,this),this.so=PropertyFactory.getProp(e,i.tr.so,0,.01,this),this.eo=PropertyFactory.getProp(e,i.tr.eo,0,.01,this),this.data=i,this.dynamicProperties.length||this.getValue(!0),this._isAnimated=!!this.dynamicProperties.length,this.pMatrix=new Matrix,this.rMatrix=new Matrix,this.sMatrix=new Matrix,this.tMatrix=new Matrix,this.matrix=new Matrix},RepeaterModifier.prototype.applyTransforms=function(e,i,s,a,_,$){var rt=$?-1:1,c=a.s.v[0]+(1-a.s.v[0])*(1-_),dt=a.s.v[1]+(1-a.s.v[1])*(1-_);e.translate(a.p.v[0]*rt*_,a.p.v[1]*rt*_,a.p.v[2]),i.translate(-a.a.v[0],-a.a.v[1],a.a.v[2]),i.rotate(-a.r.v*rt*_),i.translate(a.a.v[0],a.a.v[1],a.a.v[2]),s.translate(-a.a.v[0],-a.a.v[1],a.a.v[2]),s.scale($?1/c:c,$?1/dt:dt),s.translate(a.a.v[0],a.a.v[1],a.a.v[2])},RepeaterModifier.prototype.init=function(e,i,s,a){for(this.elem=e,this.arr=i,this.pos=s,this.elemsData=a,this._currentCopies=0,this._elements=[],this._groups=[],this.frameId=-1,this.initDynamicPropertyContainer(e),this.initModifierProperties(e,i[s]);s>0;)s-=1,this._elements.unshift(i[s]);this.dynamicProperties.length?this.k=!0:this.getValue(!0)},RepeaterModifier.prototype.resetElements=function(e){var i,s=e.length;for(i=0;i<s;i+=1)e[i]._processed=!1,e[i].ty==="gr"&&this.resetElements(e[i].it)},RepeaterModifier.prototype.cloneElements=function(e){var i=JSON.parse(JSON.stringify(e));return this.resetElements(i),i},RepeaterModifier.prototype.changeGroupRender=function(e,i){var s,a=e.length;for(s=0;s<a;s+=1)e[s]._render=i,e[s].ty==="gr"&&this.changeGroupRender(e[s].it,i)},RepeaterModifier.prototype.processShapes=function(e){var i,s,a,_,$,rt=!1;if(this._mdf||e){var c=Math.ceil(this.c.v);if(this._groups.length<c){for(;this._groups.length<c;){var dt={it:this.cloneElements(this._elements),ty:"gr"};dt.it.push({a:{a:0,ix:1,k:[0,0]},nm:"Transform",o:{a:0,ix:7,k:100},p:{a:0,ix:2,k:[0,0]},r:{a:1,ix:6,k:[{s:0,e:0,t:0},{s:0,e:0,t:1}]},s:{a:0,ix:3,k:[100,100]},sa:{a:0,ix:5,k:0},sk:{a:0,ix:4,k:0},ty:"tr"}),this.arr.splice(0,0,dt),this._groups.splice(0,0,dt),this._currentCopies+=1}this.elem.reloadShapes(),rt=!0}$=0;var ht;for(a=0;a<=this._groups.length-1;a+=1){if(ht=$<c,this._groups[a]._render=ht,this.changeGroupRender(this._groups[a].it,ht),!ht){var Et=this.elemsData[a].it,St=Et[Et.length-1];St.transform.op.v!==0?(St.transform.op._mdf=!0,St.transform.op.v=0):St.transform.op._mdf=!1}$+=1}this._currentCopies=c;var At=this.o.v,Pt=At%1,Vt=At>0?Math.floor(At):Math.ceil(At),Bt=this.pMatrix.props,Zt=this.rMatrix.props,zt=this.sMatrix.props;this.pMatrix.reset(),this.rMatrix.reset(),this.sMatrix.reset(),this.tMatrix.reset(),this.matrix.reset();var Ut=0;if(At>0){for(;Ut<Vt;)this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,1,!1),Ut+=1;Pt&&(this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,Pt,!1),Ut+=Pt)}else if(At<0){for(;Ut>Vt;)this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,1,!0),Ut-=1;Pt&&(this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,-Pt,!0),Ut-=Pt)}a=this.data.m===1?0:this._currentCopies-1,_=this.data.m===1?1:-1,$=this._currentCopies;for(var Nt,Gt;$;){if(i=this.elemsData[a].it,s=i[i.length-1].transform.mProps.v.props,Gt=s.length,i[i.length-1].transform.mProps._mdf=!0,i[i.length-1].transform.op._mdf=!0,i[i.length-1].transform.op.v=this._currentCopies===1?this.so.v:this.so.v+(this.eo.v-this.so.v)*(a/(this._currentCopies-1)),Ut!==0){for((a!==0&&_===1||a!==this._currentCopies-1&&_===-1)&&this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,1,!1),this.matrix.transform(Zt[0],Zt[1],Zt[2],Zt[3],Zt[4],Zt[5],Zt[6],Zt[7],Zt[8],Zt[9],Zt[10],Zt[11],Zt[12],Zt[13],Zt[14],Zt[15]),this.matrix.transform(zt[0],zt[1],zt[2],zt[3],zt[4],zt[5],zt[6],zt[7],zt[8],zt[9],zt[10],zt[11],zt[12],zt[13],zt[14],zt[15]),this.matrix.transform(Bt[0],Bt[1],Bt[2],Bt[3],Bt[4],Bt[5],Bt[6],Bt[7],Bt[8],Bt[9],Bt[10],Bt[11],Bt[12],Bt[13],Bt[14],Bt[15]),Nt=0;Nt<Gt;Nt+=1)s[Nt]=this.matrix.props[Nt];this.matrix.reset()}else for(this.matrix.reset(),Nt=0;Nt<Gt;Nt+=1)s[Nt]=this.matrix.props[Nt];Ut+=1,$-=1,a+=_}}else for($=this._currentCopies,a=0,_=1;$;)i=this.elemsData[a].it,s=i[i.length-1].transform.mProps.v.props,i[i.length-1].transform.mProps._mdf=!1,i[i.length-1].transform.op._mdf=!1,$-=1,a+=_;return rt},RepeaterModifier.prototype.addShape=function(){};function RoundCornersModifier(){}extendPrototype([ShapeModifier],RoundCornersModifier),RoundCornersModifier.prototype.initModifierProperties=function(e,i){this.getValue=this.processKeys,this.rd=PropertyFactory.getProp(e,i.r,0,null,this),this._isAnimated=!!this.rd.effectsSequence.length},RoundCornersModifier.prototype.processPath=function(e,i){var s=shapePool.newElement();s.c=e.c;var a,_=e._length,$,rt,c,dt,ht,Et,St=0,At,Pt,Vt,Bt,Zt,zt;for(a=0;a<_;a+=1)$=e.v[a],c=e.o[a],rt=e.i[a],$[0]===c[0]&&$[1]===c[1]&&$[0]===rt[0]&&$[1]===rt[1]?(a===0||a===_-1)&&!e.c?(s.setTripleAt($[0],$[1],c[0],c[1],rt[0],rt[1],St),St+=1):(a===0?dt=e.v[_-1]:dt=e.v[a-1],ht=Math.sqrt(Math.pow($[0]-dt[0],2)+Math.pow($[1]-dt[1],2)),Et=ht?Math.min(ht/2,i)/ht:0,Zt=$[0]+(dt[0]-$[0])*Et,At=Zt,zt=$[1]-($[1]-dt[1])*Et,Pt=zt,Vt=At-(At-$[0])*roundCorner,Bt=Pt-(Pt-$[1])*roundCorner,s.setTripleAt(At,Pt,Vt,Bt,Zt,zt,St),St+=1,a===_-1?dt=e.v[0]:dt=e.v[a+1],ht=Math.sqrt(Math.pow($[0]-dt[0],2)+Math.pow($[1]-dt[1],2)),Et=ht?Math.min(ht/2,i)/ht:0,Vt=$[0]+(dt[0]-$[0])*Et,At=Vt,Bt=$[1]+(dt[1]-$[1])*Et,Pt=Bt,Zt=At-(At-$[0])*roundCorner,zt=Pt-(Pt-$[1])*roundCorner,s.setTripleAt(At,Pt,Vt,Bt,Zt,zt,St),St+=1):(s.setTripleAt(e.v[a][0],e.v[a][1],e.o[a][0],e.o[a][1],e.i[a][0],e.i[a][1],St),St+=1);return s},RoundCornersModifier.prototype.processShapes=function(e){var i,s,a=this.shapes.length,_,$,rt=this.rd.v;if(rt!==0){var c,dt;for(s=0;s<a;s+=1){if(c=this.shapes[s],dt=c.localShapeCollection,!(!c.shape._mdf&&!this._mdf&&!e))for(dt.releaseShapes(),c.shape._mdf=!0,i=c.shape.paths.shapes,$=c.shape.paths._length,_=0;_<$;_+=1)dt.addShape(this.processPath(i[_],rt));c.shape.paths=c.localShapeCollection}}this.dynamicProperties.length||(this._mdf=!1)};function floatEqual(e,i){return Math.abs(e-i)*1e5<=Math.min(Math.abs(e),Math.abs(i))}function floatZero(e){return Math.abs(e)<=1e-5}function lerp(e,i,s){return e*(1-s)+i*s}function lerpPoint(e,i,s){return[lerp(e[0],i[0],s),lerp(e[1],i[1],s)]}function quadRoots(e,i,s){if(e===0)return[];var a=i*i-4*e*s;if(a<0)return[];var _=-i/(2*e);if(a===0)return[_];var $=Math.sqrt(a)/(2*e);return[_-$,_+$]}function polynomialCoefficients(e,i,s,a){return[-e+3*i-3*s+a,3*e-6*i+3*s,-3*e+3*i,e]}function singlePoint(e){return new PolynomialBezier(e,e,e,e,!1)}function PolynomialBezier(e,i,s,a,_){_&&pointEqual(e,i)&&(i=lerpPoint(e,a,1/3)),_&&pointEqual(s,a)&&(s=lerpPoint(e,a,2/3));var $=polynomialCoefficients(e[0],i[0],s[0],a[0]),rt=polynomialCoefficients(e[1],i[1],s[1],a[1]);this.a=[$[0],rt[0]],this.b=[$[1],rt[1]],this.c=[$[2],rt[2]],this.d=[$[3],rt[3]],this.points=[e,i,s,a]}PolynomialBezier.prototype.point=function(e){return[((this.a[0]*e+this.b[0])*e+this.c[0])*e+this.d[0],((this.a[1]*e+this.b[1])*e+this.c[1])*e+this.d[1]]},PolynomialBezier.prototype.derivative=function(e){return[(3*e*this.a[0]+2*this.b[0])*e+this.c[0],(3*e*this.a[1]+2*this.b[1])*e+this.c[1]]},PolynomialBezier.prototype.tangentAngle=function(e){var i=this.derivative(e);return Math.atan2(i[1],i[0])},PolynomialBezier.prototype.normalAngle=function(e){var i=this.derivative(e);return Math.atan2(i[0],i[1])},PolynomialBezier.prototype.inflectionPoints=function(){var e=this.a[1]*this.b[0]-this.a[0]*this.b[1];if(floatZero(e))return[];var i=-.5*(this.a[1]*this.c[0]-this.a[0]*this.c[1])/e,s=i*i-1/3*(this.b[1]*this.c[0]-this.b[0]*this.c[1])/e;if(s<0)return[];var a=Math.sqrt(s);return floatZero(a)?a>0&&a<1?[i]:[]:[i-a,i+a].filter(function(_){return _>0&&_<1})},PolynomialBezier.prototype.split=function(e){if(e<=0)return[singlePoint(this.points[0]),this];if(e>=1)return[this,singlePoint(this.points[this.points.length-1])];var i=lerpPoint(this.points[0],this.points[1],e),s=lerpPoint(this.points[1],this.points[2],e),a=lerpPoint(this.points[2],this.points[3],e),_=lerpPoint(i,s,e),$=lerpPoint(s,a,e),rt=lerpPoint(_,$,e);return[new PolynomialBezier(this.points[0],i,_,rt,!0),new PolynomialBezier(rt,$,a,this.points[3],!0)]};function extrema(e,i){var s=e.points[0][i],a=e.points[e.points.length-1][i];if(s>a){var _=a;a=s,s=_}for(var $=quadRoots(3*e.a[i],2*e.b[i],e.c[i]),rt=0;rt<$.length;rt+=1)if($[rt]>0&&$[rt]<1){var c=e.point($[rt])[i];c<s?s=c:c>a&&(a=c)}return{min:s,max:a}}PolynomialBezier.prototype.bounds=function(){return{x:extrema(this,0),y:extrema(this,1)}},PolynomialBezier.prototype.boundingBox=function(){var e=this.bounds();return{left:e.x.min,right:e.x.max,top:e.y.min,bottom:e.y.max,width:e.x.max-e.x.min,height:e.y.max-e.y.min,cx:(e.x.max+e.x.min)/2,cy:(e.y.max+e.y.min)/2}};function intersectData(e,i,s){var a=e.boundingBox();return{cx:a.cx,cy:a.cy,width:a.width,height:a.height,bez:e,t:(i+s)/2,t1:i,t2:s}}function splitData(e){var i=e.bez.split(.5);return[intersectData(i[0],e.t1,e.t),intersectData(i[1],e.t,e.t2)]}function boxIntersect(e,i){return Math.abs(e.cx-i.cx)*2<e.width+i.width&&Math.abs(e.cy-i.cy)*2<e.height+i.height}function intersectsImpl(e,i,s,a,_,$){if(boxIntersect(e,i)){if(s>=$||e.width<=a&&e.height<=a&&i.width<=a&&i.height<=a){_.push([e.t,i.t]);return}var rt=splitData(e),c=splitData(i);intersectsImpl(rt[0],c[0],s+1,a,_,$),intersectsImpl(rt[0],c[1],s+1,a,_,$),intersectsImpl(rt[1],c[0],s+1,a,_,$),intersectsImpl(rt[1],c[1],s+1,a,_,$)}}PolynomialBezier.prototype.intersections=function(e,i,s){i===void 0&&(i=2),s===void 0&&(s=7);var a=[];return intersectsImpl(intersectData(this,0,1),intersectData(e,0,1),0,i,a,s),a},PolynomialBezier.shapeSegment=function(e,i){var s=(i+1)%e.length();return new PolynomialBezier(e.v[i],e.o[i],e.i[s],e.v[s],!0)},PolynomialBezier.shapeSegmentInverted=function(e,i){var s=(i+1)%e.length();return new PolynomialBezier(e.v[s],e.i[s],e.o[i],e.v[i],!0)};function crossProduct(e,i){return[e[1]*i[2]-e[2]*i[1],e[2]*i[0]-e[0]*i[2],e[0]*i[1]-e[1]*i[0]]}function lineIntersection(e,i,s,a){var _=[e[0],e[1],1],$=[i[0],i[1],1],rt=[s[0],s[1],1],c=[a[0],a[1],1],dt=crossProduct(crossProduct(_,$),crossProduct(rt,c));return floatZero(dt[2])?null:[dt[0]/dt[2],dt[1]/dt[2]]}function polarOffset(e,i,s){return[e[0]+Math.cos(i)*s,e[1]-Math.sin(i)*s]}function pointDistance(e,i){return Math.hypot(e[0]-i[0],e[1]-i[1])}function pointEqual(e,i){return floatEqual(e[0],i[0])&&floatEqual(e[1],i[1])}function ZigZagModifier(){}extendPrototype([ShapeModifier],ZigZagModifier),ZigZagModifier.prototype.initModifierProperties=function(e,i){this.getValue=this.processKeys,this.amplitude=PropertyFactory.getProp(e,i.s,0,null,this),this.frequency=PropertyFactory.getProp(e,i.r,0,null,this),this.pointsType=PropertyFactory.getProp(e,i.pt,0,null,this),this._isAnimated=this.amplitude.effectsSequence.length!==0||this.frequency.effectsSequence.length!==0||this.pointsType.effectsSequence.length!==0};function setPoint(e,i,s,a,_,$,rt){var c=s-Math.PI/2,dt=s+Math.PI/2,ht=i[0]+Math.cos(s)*a*_,Et=i[1]-Math.sin(s)*a*_;e.setTripleAt(ht,Et,ht+Math.cos(c)*$,Et-Math.sin(c)*$,ht+Math.cos(dt)*rt,Et-Math.sin(dt)*rt,e.length())}function getPerpendicularVector(e,i){var s=[i[0]-e[0],i[1]-e[1]],a=-Math.PI*.5,_=[Math.cos(a)*s[0]-Math.sin(a)*s[1],Math.sin(a)*s[0]+Math.cos(a)*s[1]];return _}function getProjectingAngle(e,i){var s=i===0?e.length()-1:i-1,a=(i+1)%e.length(),_=e.v[s],$=e.v[a],rt=getPerpendicularVector(_,$);return Math.atan2(0,1)-Math.atan2(rt[1],rt[0])}function zigZagCorner(e,i,s,a,_,$,rt){var c=getProjectingAngle(i,s),dt=i.v[s%i._length],ht=i.v[s===0?i._length-1:s-1],Et=i.v[(s+1)%i._length],St=$===2?Math.sqrt(Math.pow(dt[0]-ht[0],2)+Math.pow(dt[1]-ht[1],2)):0,At=$===2?Math.sqrt(Math.pow(dt[0]-Et[0],2)+Math.pow(dt[1]-Et[1],2)):0;setPoint(e,i.v[s%i._length],c,rt,a,At/((_+1)*2),St/((_+1)*2))}function zigZagSegment(e,i,s,a,_,$){for(var rt=0;rt<a;rt+=1){var c=(rt+1)/(a+1),dt=_===2?Math.sqrt(Math.pow(i.points[3][0]-i.points[0][0],2)+Math.pow(i.points[3][1]-i.points[0][1],2)):0,ht=i.normalAngle(c),Et=i.point(c);setPoint(e,Et,ht,$,s,dt/((a+1)*2),dt/((a+1)*2)),$=-$}return $}ZigZagModifier.prototype.processPath=function(e,i,s,a){var _=e._length,$=shapePool.newElement();if($.c=e.c,e.c||(_-=1),_===0)return $;var rt=-1,c=PolynomialBezier.shapeSegment(e,0);zigZagCorner($,e,0,i,s,a,rt);for(var dt=0;dt<_;dt+=1)rt=zigZagSegment($,c,i,s,a,-rt),dt===_-1&&!e.c?c=null:c=PolynomialBezier.shapeSegment(e,(dt+1)%_),zigZagCorner($,e,dt+1,i,s,a,rt);return $},ZigZagModifier.prototype.processShapes=function(e){var i,s,a=this.shapes.length,_,$,rt=this.amplitude.v,c=Math.max(0,Math.round(this.frequency.v)),dt=this.pointsType.v;if(rt!==0){var ht,Et;for(s=0;s<a;s+=1){if(ht=this.shapes[s],Et=ht.localShapeCollection,!(!ht.shape._mdf&&!this._mdf&&!e))for(Et.releaseShapes(),ht.shape._mdf=!0,i=ht.shape.paths.shapes,$=ht.shape.paths._length,_=0;_<$;_+=1)Et.addShape(this.processPath(i[_],rt,c,dt));ht.shape.paths=ht.localShapeCollection}}this.dynamicProperties.length||(this._mdf=!1)};function linearOffset(e,i,s){var a=Math.atan2(i[0]-e[0],i[1]-e[1]);return[polarOffset(e,a,s),polarOffset(i,a,s)]}function offsetSegment(e,i){var s,a,_,$,rt,c,dt;dt=linearOffset(e.points[0],e.points[1],i),s=dt[0],a=dt[1],dt=linearOffset(e.points[1],e.points[2],i),_=dt[0],$=dt[1],dt=linearOffset(e.points[2],e.points[3],i),rt=dt[0],c=dt[1];var ht=lineIntersection(s,a,_,$);ht===null&&(ht=a);var Et=lineIntersection(rt,c,_,$);return Et===null&&(Et=rt),new PolynomialBezier(s,ht,Et,c)}function joinLines(e,i,s,a,_){var $=i.points[3],rt=s.points[0];if(a===3||pointEqual($,rt))return $;if(a===2){var c=-i.tangentAngle(1),dt=-s.tangentAngle(0)+Math.PI,ht=lineIntersection($,polarOffset($,c+Math.PI/2,100),rt,polarOffset(rt,c+Math.PI/2,100)),Et=ht?pointDistance(ht,$):pointDistance($,rt)/2,St=polarOffset($,c,2*Et*roundCorner);return e.setXYAt(St[0],St[1],"o",e.length()-1),St=polarOffset(rt,dt,2*Et*roundCorner),e.setTripleAt(rt[0],rt[1],rt[0],rt[1],St[0],St[1],e.length()),rt}var At=pointEqual($,i.points[2])?i.points[0]:i.points[2],Pt=pointEqual(rt,s.points[1])?s.points[3]:s.points[1],Vt=lineIntersection(At,$,rt,Pt);return Vt&&pointDistance(Vt,$)<_?(e.setTripleAt(Vt[0],Vt[1],Vt[0],Vt[1],Vt[0],Vt[1],e.length()),Vt):$}function getIntersection(e,i){var s=e.intersections(i);return s.length&&floatEqual(s[0][0],1)&&s.shift(),s.length?s[0]:null}function pruneSegmentIntersection(e,i){var s=e.slice(),a=i.slice(),_=getIntersection(e[e.length-1],i[0]);return _&&(s[e.length-1]=e[e.length-1].split(_[0])[0],a[0]=i[0].split(_[1])[1]),e.length>1&&i.length>1&&(_=getIntersection(e[0],i[i.length-1]),_)?[[e[0].split(_[0])[0]],[i[i.length-1].split(_[1])[1]]]:[s,a]}function pruneIntersections(e){for(var i,s=1;s<e.length;s+=1)i=pruneSegmentIntersection(e[s-1],e[s]),e[s-1]=i[0],e[s]=i[1];return e.length>1&&(i=pruneSegmentIntersection(e[e.length-1],e[0]),e[e.length-1]=i[0],e[0]=i[1]),e}function offsetSegmentSplit(e,i){var s=e.inflectionPoints(),a,_,$,rt;if(s.length===0)return[offsetSegment(e,i)];if(s.length===1||floatEqual(s[1],1))return $=e.split(s[0]),a=$[0],_=$[1],[offsetSegment(a,i),offsetSegment(_,i)];$=e.split(s[0]),a=$[0];var c=(s[1]-s[0])/(1-s[0]);return $=$[1].split(c),rt=$[0],_=$[1],[offsetSegment(a,i),offsetSegment(rt,i),offsetSegment(_,i)]}function OffsetPathModifier(){}extendPrototype([ShapeModifier],OffsetPathModifier),OffsetPathModifier.prototype.initModifierProperties=function(e,i){this.getValue=this.processKeys,this.amount=PropertyFactory.getProp(e,i.a,0,null,this),this.miterLimit=PropertyFactory.getProp(e,i.ml,0,null,this),this.lineJoin=i.lj,this._isAnimated=this.amount.effectsSequence.length!==0},OffsetPathModifier.prototype.processPath=function(e,i,s,a){var _=shapePool.newElement();_.c=e.c;var $=e.length();e.c||($-=1);var rt,c,dt,ht=[];for(rt=0;rt<$;rt+=1)dt=PolynomialBezier.shapeSegment(e,rt),ht.push(offsetSegmentSplit(dt,i));if(!e.c)for(rt=$-1;rt>=0;rt-=1)dt=PolynomialBezier.shapeSegmentInverted(e,rt),ht.push(offsetSegmentSplit(dt,i));ht=pruneIntersections(ht);var Et=null,St=null;for(rt=0;rt<ht.length;rt+=1){var At=ht[rt];for(St&&(Et=joinLines(_,St,At[0],s,a)),St=At[At.length-1],c=0;c<At.length;c+=1)dt=At[c],Et&&pointEqual(dt.points[0],Et)?_.setXYAt(dt.points[1][0],dt.points[1][1],"o",_.length()-1):_.setTripleAt(dt.points[0][0],dt.points[0][1],dt.points[1][0],dt.points[1][1],dt.points[0][0],dt.points[0][1],_.length()),_.setTripleAt(dt.points[3][0],dt.points[3][1],dt.points[3][0],dt.points[3][1],dt.points[2][0],dt.points[2][1],_.length()),Et=dt.points[3]}return ht.length&&joinLines(_,St,ht[0][0],s,a),_},OffsetPathModifier.prototype.processShapes=function(e){var i,s,a=this.shapes.length,_,$,rt=this.amount.v,c=this.miterLimit.v,dt=this.lineJoin;if(rt!==0){var ht,Et;for(s=0;s<a;s+=1){if(ht=this.shapes[s],Et=ht.localShapeCollection,!(!ht.shape._mdf&&!this._mdf&&!e))for(Et.releaseShapes(),ht.shape._mdf=!0,i=ht.shape.paths.shapes,$=ht.shape.paths._length,_=0;_<$;_+=1)Et.addShape(this.processPath(i[_],rt,dt,c));ht.shape.paths=ht.localShapeCollection}}this.dynamicProperties.length||(this._mdf=!1)};function getFontProperties(e){for(var i=e.fStyle?e.fStyle.split(" "):[],s="normal",a="normal",_=i.length,$,rt=0;rt<_;rt+=1)switch($=i[rt].toLowerCase(),$){case"italic":a="italic";break;case"bold":s="700";break;case"black":s="900";break;case"medium":s="500";break;case"regular":case"normal":s="400";break;case"light":case"thin":s="200";break}return{style:a,weight:e.fWeight||s}}var FontManager=function(){var e=5e3,i={w:0,size:0,shapes:[],data:{shapes:[]}},s=[];s=s.concat([2304,2305,2306,2307,2362,2363,2364,2364,2366,2367,2368,2369,2370,2371,2372,2373,2374,2375,2376,2377,2378,2379,2380,2381,2382,2383,2387,2388,2389,2390,2391,2402,2403]);var a=127988,_=917631,$=917601,rt=917626,c=65039,dt=8205,ht=127462,Et=127487,St=["d83cdffb","d83cdffc","d83cdffd","d83cdffe","d83cdfff"];function At(Cr){var Sr=Cr.split(","),dr,gr=Sr.length,qr=[];for(dr=0;dr<gr;dr+=1)Sr[dr]!=="sans-serif"&&Sr[dr]!=="monospace"&&qr.push(Sr[dr]);return qr.join(",")}function Pt(Cr,Sr){var dr=createTag("span");dr.setAttribute("aria-hidden",!0),dr.style.fontFamily=Sr;var gr=createTag("span");gr.innerText="giItT1WQy@!-/#",dr.style.position="absolute",dr.style.left="-10000px",dr.style.top="-10000px",dr.style.fontSize="300px",dr.style.fontVariant="normal",dr.style.fontStyle="normal",dr.style.fontWeight="normal",dr.style.letterSpacing="0",dr.appendChild(gr),document.body.appendChild(dr);var qr=gr.offsetWidth;return gr.style.fontFamily=At(Cr)+", "+Sr,{node:gr,w:qr,parent:dr}}function Vt(){var Cr,Sr=this.fonts.length,dr,gr,qr=Sr;for(Cr=0;Cr<Sr;Cr+=1)this.fonts[Cr].loaded?qr-=1:this.fonts[Cr].fOrigin==="n"||this.fonts[Cr].origin===0?this.fonts[Cr].loaded=!0:(dr=this.fonts[Cr].monoCase.node,gr=this.fonts[Cr].monoCase.w,dr.offsetWidth!==gr?(qr-=1,this.fonts[Cr].loaded=!0):(dr=this.fonts[Cr].sansCase.node,gr=this.fonts[Cr].sansCase.w,dr.offsetWidth!==gr&&(qr-=1,this.fonts[Cr].loaded=!0)),this.fonts[Cr].loaded&&(this.fonts[Cr].sansCase.parent.parentNode.removeChild(this.fonts[Cr].sansCase.parent),this.fonts[Cr].monoCase.parent.parentNode.removeChild(this.fonts[Cr].monoCase.parent)));qr!==0&&Date.now()-this.initTime<e?setTimeout(this.checkLoadedFontsBinded,20):setTimeout(this.setIsLoadedBinded,10)}function Bt(Cr,Sr){var dr=document.body&&Sr?"svg":"canvas",gr,qr=getFontProperties(Cr);if(dr==="svg"){var Lr=createNS("text");Lr.style.fontSize="100px",Lr.setAttribute("font-family",Cr.fFamily),Lr.setAttribute("font-style",qr.style),Lr.setAttribute("font-weight",qr.weight),Lr.textContent="1",Cr.fClass?(Lr.style.fontFamily="inherit",Lr.setAttribute("class",Cr.fClass)):Lr.style.fontFamily=Cr.fFamily,Sr.appendChild(Lr),gr=Lr}else{var _n=new OffscreenCanvas(500,500).getContext("2d");_n.font=qr.style+" "+qr.weight+" 100px "+Cr.fFamily,gr=_n}function gn(Sn){return dr==="svg"?(gr.textContent=Sn,gr.getComputedTextLength()):gr.measureText(Sn).width}return{measureText:gn}}function Zt(Cr,Sr){if(!Cr){this.isLoaded=!0;return}if(this.chars){this.isLoaded=!0,this.fonts=Cr.list;return}if(!document.body){this.isLoaded=!0,Cr.list.forEach(function(On){On.helper=Bt(On),On.cache={}}),this.fonts=Cr.list;return}var dr=Cr.list,gr,qr=dr.length,Lr=qr;for(gr=0;gr<qr;gr+=1){var _n=!0,gn,Sn;if(dr[gr].loaded=!1,dr[gr].monoCase=Pt(dr[gr].fFamily,"monospace"),dr[gr].sansCase=Pt(dr[gr].fFamily,"sans-serif"),!dr[gr].fPath)dr[gr].loaded=!0,Lr-=1;else if(dr[gr].fOrigin==="p"||dr[gr].origin===3){if(gn=document.querySelectorAll('style[f-forigin="p"][f-family="'+dr[gr].fFamily+'"], style[f-origin="3"][f-family="'+dr[gr].fFamily+'"]'),gn.length>0&&(_n=!1),_n){var Fs=createTag("style");Fs.setAttribute("f-forigin",dr[gr].fOrigin),Fs.setAttribute("f-origin",dr[gr].origin),Fs.setAttribute("f-family",dr[gr].fFamily),Fs.type="text/css",Fs.innerText="@font-face {font-family: "+dr[gr].fFamily+"; font-style: normal; src: url('"+dr[gr].fPath+"');}",Sr.appendChild(Fs)}}else if(dr[gr].fOrigin==="g"||dr[gr].origin===1){for(gn=document.querySelectorAll('link[f-forigin="g"], link[f-origin="1"]'),Sn=0;Sn<gn.length;Sn+=1)gn[Sn].href.indexOf(dr[gr].fPath)!==-1&&(_n=!1);if(_n){var rs=createTag("link");rs.setAttribute("f-forigin",dr[gr].fOrigin),rs.setAttribute("f-origin",dr[gr].origin),rs.type="text/css",rs.rel="stylesheet",rs.href=dr[gr].fPath,document.body.appendChild(rs)}}else if(dr[gr].fOrigin==="t"||dr[gr].origin===2){for(gn=document.querySelectorAll('script[f-forigin="t"], script[f-origin="2"]'),Sn=0;Sn<gn.length;Sn+=1)dr[gr].fPath===gn[Sn].src&&(_n=!1);if(_n){var ms=createTag("link");ms.setAttribute("f-forigin",dr[gr].fOrigin),ms.setAttribute("f-origin",dr[gr].origin),ms.setAttribute("rel","stylesheet"),ms.setAttribute("href",dr[gr].fPath),Sr.appendChild(ms)}}dr[gr].helper=Bt(dr[gr],Sr),dr[gr].cache={},this.fonts.push(dr[gr])}Lr===0?this.isLoaded=!0:setTimeout(this.checkLoadedFonts.bind(this),100)}function zt(Cr){if(Cr){this.chars||(this.chars=[]);var Sr,dr=Cr.length,gr,qr=this.chars.length,Lr;for(Sr=0;Sr<dr;Sr+=1){for(gr=0,Lr=!1;gr<qr;)this.chars[gr].style===Cr[Sr].style&&this.chars[gr].fFamily===Cr[Sr].fFamily&&this.chars[gr].ch===Cr[Sr].ch&&(Lr=!0),gr+=1;Lr||(this.chars.push(Cr[Sr]),qr+=1)}}}function Ut(Cr,Sr,dr){for(var gr=0,qr=this.chars.length;gr<qr;){if(this.chars[gr].ch===Cr&&this.chars[gr].style===Sr&&this.chars[gr].fFamily===dr)return this.chars[gr];gr+=1}return(typeof Cr=="string"&&Cr.charCodeAt(0)!==13||!Cr)&&console&&console.warn&&!this._warned&&(this._warned=!0,console.warn("Missing character from exported characters list: ",Cr,Sr,dr)),i}function Nt(Cr,Sr,dr){var gr=this.getFontByName(Sr),qr=Cr;if(!gr.cache[qr]){var Lr=gr.helper;if(Cr===" "){var _n=Lr.measureText("|"+Cr+"|"),gn=Lr.measureText("||");gr.cache[qr]=(_n-gn)/100}else gr.cache[qr]=Lr.measureText(Cr)/100}return gr.cache[qr]*dr}function Gt(Cr){for(var Sr=0,dr=this.fonts.length;Sr<dr;){if(this.fonts[Sr].fName===Cr)return this.fonts[Sr];Sr+=1}return this.fonts[0]}function er(Cr){var Sr=0,dr=Cr.charCodeAt(0);if(dr>=55296&&dr<=56319){var gr=Cr.charCodeAt(1);gr>=56320&&gr<=57343&&(Sr=(dr-55296)*1024+gr-56320+65536)}return Sr}function ir(Cr,Sr){var dr=Cr.toString(16)+Sr.toString(16);return St.indexOf(dr)!==-1}function or(Cr){return Cr===dt}function mr(Cr){return Cr===c}function Rr(Cr){var Sr=er(Cr);return Sr>=ht&&Sr<=Et}function on(Cr){return Rr(Cr.substr(0,2))&&Rr(Cr.substr(2,2))}function un(Cr){return s.indexOf(Cr)!==-1}function jr(Cr,Sr){var dr=er(Cr.substr(Sr,2));if(dr!==a)return!1;var gr=0;for(Sr+=2;gr<5;){if(dr=er(Cr.substr(Sr,2)),dr<$||dr>rt)return!1;gr+=1,Sr+=2}return er(Cr.substr(Sr,2))===_}function Jr(){this.isLoaded=!0}var fn=function(){this.fonts=[],this.chars=null,this.typekitLoaded=0,this.isLoaded=!1,this._warned=!1,this.initTime=Date.now(),this.setIsLoadedBinded=this.setIsLoaded.bind(this),this.checkLoadedFontsBinded=this.checkLoadedFonts.bind(this)};fn.isModifier=ir,fn.isZeroWidthJoiner=or,fn.isFlagEmoji=on,fn.isRegionalCode=Rr,fn.isCombinedCharacter=un,fn.isRegionalFlag=jr,fn.isVariationSelector=mr,fn.BLACK_FLAG_CODE_POINT=a;var Fr={addChars:zt,addFonts:Zt,getCharData:Ut,getFontByName:Gt,measureText:Nt,checkLoadedFonts:Vt,setIsLoaded:Jr};return fn.prototype=Fr,fn}();function SlotManager(e){this.animationData=e}SlotManager.prototype.getProp=function(e){return this.animationData.slots&&this.animationData.slots[e.sid]?Object.assign(e,this.animationData.slots[e.sid].p):e};function slotFactory(e){return new SlotManager(e)}function RenderableElement(){}RenderableElement.prototype={initRenderable:function(){this.isInRange=!1,this.hidden=!1,this.isTransparent=!1,this.renderableComponents=[]},addRenderableComponent:function(i){this.renderableComponents.indexOf(i)===-1&&this.renderableComponents.push(i)},removeRenderableComponent:function(i){this.renderableComponents.indexOf(i)!==-1&&this.renderableComponents.splice(this.renderableComponents.indexOf(i),1)},prepareRenderableFrame:function(i){this.checkLayerLimits(i)},checkTransparency:function(){this.finalTransform.mProp.o.v<=0?!this.isTransparent&&this.globalData.renderConfig.hideOnTransparent&&(this.isTransparent=!0,this.hide()):this.isTransparent&&(this.isTransparent=!1,this.show())},checkLayerLimits:function(i){this.data.ip-this.data.st<=i&&this.data.op-this.data.st>i?this.isInRange!==!0&&(this.globalData._mdf=!0,this._mdf=!0,this.isInRange=!0,this.show()):this.isInRange!==!1&&(this.globalData._mdf=!0,this.isInRange=!1,this.hide())},renderRenderable:function(){var i,s=this.renderableComponents.length;for(i=0;i<s;i+=1)this.renderableComponents[i].renderFrame(this._isFirstFrame)},sourceRectAtTime:function(){return{top:0,left:0,width:100,height:100}},getLayerSize:function(){return this.data.ty===5?{w:this.data.textData.width,h:this.data.textData.height}:{w:this.data.width,h:this.data.height}}};var getBlendMode=function(){var e={0:"source-over",1:"multiply",2:"screen",3:"overlay",4:"darken",5:"lighten",6:"color-dodge",7:"color-burn",8:"hard-light",9:"soft-light",10:"difference",11:"exclusion",12:"hue",13:"saturation",14:"color",15:"luminosity"};return function(i){return e[i]||""}}();function SliderEffect(e,i,s){this.p=PropertyFactory.getProp(i,e.v,0,0,s)}function AngleEffect(e,i,s){this.p=PropertyFactory.getProp(i,e.v,0,0,s)}function ColorEffect(e,i,s){this.p=PropertyFactory.getProp(i,e.v,1,0,s)}function PointEffect(e,i,s){this.p=PropertyFactory.getProp(i,e.v,1,0,s)}function LayerIndexEffect(e,i,s){this.p=PropertyFactory.getProp(i,e.v,0,0,s)}function MaskIndexEffect(e,i,s){this.p=PropertyFactory.getProp(i,e.v,0,0,s)}function CheckboxEffect(e,i,s){this.p=PropertyFactory.getProp(i,e.v,0,0,s)}function NoValueEffect(){this.p={}}function EffectsManager(e,i){var s=e.ef||[];this.effectElements=[];var a,_=s.length,$;for(a=0;a<_;a+=1)$=new GroupEffect(s[a],i),this.effectElements.push($)}function GroupEffect(e,i){this.init(e,i)}extendPrototype([DynamicPropertyContainer],GroupEffect),GroupEffect.prototype.getValue=GroupEffect.prototype.iterateDynamicProperties,GroupEffect.prototype.init=function(e,i){this.data=e,this.effectElements=[],this.initDynamicPropertyContainer(i);var s,a=this.data.ef.length,_,$=this.data.ef;for(s=0;s<a;s+=1){switch(_=null,$[s].ty){case 0:_=new SliderEffect($[s],i,this);break;case 1:_=new AngleEffect($[s],i,this);break;case 2:_=new ColorEffect($[s],i,this);break;case 3:_=new PointEffect($[s],i,this);break;case 4:case 7:_=new CheckboxEffect($[s],i,this);break;case 10:_=new LayerIndexEffect($[s],i,this);break;case 11:_=new MaskIndexEffect($[s],i,this);break;case 5:_=new EffectsManager($[s],i);break;default:_=new NoValueEffect($[s]);break}_&&this.effectElements.push(_)}};function BaseElement(){}BaseElement.prototype={checkMasks:function(){if(!this.data.hasMask)return!1;for(var i=0,s=this.data.masksProperties.length;i<s;){if(this.data.masksProperties[i].mode!=="n"&&this.data.masksProperties[i].cl!==!1)return!0;i+=1}return!1},initExpressions:function(){var i=getExpressionInterfaces();if(i){var s=i("layer"),a=i("effects"),_=i("shape"),$=i("text"),rt=i("comp");this.layerInterface=s(this),this.data.hasMask&&this.maskManager&&this.layerInterface.registerMaskInterface(this.maskManager);var c=a.createEffectsInterface(this,this.layerInterface);this.layerInterface.registerEffectsInterface(c),this.data.ty===0||this.data.xt?this.compInterface=rt(this):this.data.ty===4?(this.layerInterface.shapeInterface=_(this.shapesData,this.itemsData,this.layerInterface),this.layerInterface.content=this.layerInterface.shapeInterface):this.data.ty===5&&(this.layerInterface.textInterface=$(this),this.layerInterface.text=this.layerInterface.textInterface)}},setBlendMode:function(){var i=getBlendMode(this.data.bm),s=this.baseElement||this.layerElement;s.style["mix-blend-mode"]=i},initBaseData:function(i,s,a){this.globalData=s,this.comp=a,this.data=i,this.layerId=createElementID(),this.data.sr||(this.data.sr=1),this.effectsManager=new EffectsManager(this.data,this,this.dynamicProperties)},getType:function(){return this.type},sourceRectAtTime:function(){}};function FrameElement(){}FrameElement.prototype={initFrame:function(){this._isFirstFrame=!1,this.dynamicProperties=[],this._mdf=!1},prepareProperties:function(i,s){var a,_=this.dynamicProperties.length;for(a=0;a<_;a+=1)(s||this._isParent&&this.dynamicProperties[a].propType==="transform")&&(this.dynamicProperties[a].getValue(),this.dynamicProperties[a]._mdf&&(this.globalData._mdf=!0,this._mdf=!0))},addDynamicProperty:function(i){this.dynamicProperties.indexOf(i)===-1&&this.dynamicProperties.push(i)}};function FootageElement(e,i,s){this.initFrame(),this.initRenderable(),this.assetData=i.getAssetData(e.refId),this.footageData=i.imageLoader.getAsset(this.assetData),this.initBaseData(e,i,s)}FootageElement.prototype.prepareFrame=function(){},extendPrototype([RenderableElement,BaseElement,FrameElement],FootageElement),FootageElement.prototype.getBaseElement=function(){return null},FootageElement.prototype.renderFrame=function(){},FootageElement.prototype.destroy=function(){},FootageElement.prototype.initExpressions=function(){var e=getExpressionInterfaces();if(e){var i=e("footage");this.layerInterface=i(this)}},FootageElement.prototype.getFootageData=function(){return this.footageData};function AudioElement(e,i,s){this.initFrame(),this.initRenderable(),this.assetData=i.getAssetData(e.refId),this.initBaseData(e,i,s),this._isPlaying=!1,this._canPlay=!1;var a=this.globalData.getAssetsPath(this.assetData);this.audio=this.globalData.audioController.createAudio(a),this._currentTime=0,this.globalData.audioController.addAudio(this),this._volumeMultiplier=1,this._volume=1,this._previousVolume=null,this.tm=e.tm?PropertyFactory.getProp(this,e.tm,0,i.frameRate,this):{_placeholder:!0},this.lv=PropertyFactory.getProp(this,e.au&&e.au.lv?e.au.lv:{k:[100]},1,.01,this)}AudioElement.prototype.prepareFrame=function(e){if(this.prepareRenderableFrame(e,!0),this.prepareProperties(e,!0),this.tm._placeholder)this._currentTime=e/this.data.sr;else{var i=this.tm.v;this._currentTime=i}this._volume=this.lv.v[0];var s=this._volume*this._volumeMultiplier;this._previousVolume!==s&&(this._previousVolume=s,this.audio.volume(s))},extendPrototype([RenderableElement,BaseElement,FrameElement],AudioElement),AudioElement.prototype.renderFrame=function(){this.isInRange&&this._canPlay&&(this._isPlaying?(!this.audio.playing()||Math.abs(this._currentTime/this.globalData.frameRate-this.audio.seek())>.1)&&this.audio.seek(this._currentTime/this.globalData.frameRate):(this.audio.play(),this.audio.seek(this._currentTime/this.globalData.frameRate),this._isPlaying=!0))},AudioElement.prototype.show=function(){},AudioElement.prototype.hide=function(){this.audio.pause(),this._isPlaying=!1},AudioElement.prototype.pause=function(){this.audio.pause(),this._isPlaying=!1,this._canPlay=!1},AudioElement.prototype.resume=function(){this._canPlay=!0},AudioElement.prototype.setRate=function(e){this.audio.rate(e)},AudioElement.prototype.volume=function(e){this._volumeMultiplier=e,this._previousVolume=e*this._volume,this.audio.volume(this._previousVolume)},AudioElement.prototype.getBaseElement=function(){return null},AudioElement.prototype.destroy=function(){},AudioElement.prototype.sourceRectAtTime=function(){},AudioElement.prototype.initExpressions=function(){};function BaseRenderer(){}BaseRenderer.prototype.checkLayers=function(e){var i,s=this.layers.length,a;for(this.completeLayers=!0,i=s-1;i>=0;i-=1)this.elements[i]||(a=this.layers[i],a.ip-a.st<=e-this.layers[i].st&&a.op-a.st>e-this.layers[i].st&&this.buildItem(i)),this.completeLayers=this.elements[i]?this.completeLayers:!1;this.checkPendingElements()},BaseRenderer.prototype.createItem=function(e){switch(e.ty){case 2:return this.createImage(e);case 0:return this.createComp(e);case 1:return this.createSolid(e);case 3:return this.createNull(e);case 4:return this.createShape(e);case 5:return this.createText(e);case 6:return this.createAudio(e);case 13:return this.createCamera(e);case 15:return this.createFootage(e);default:return this.createNull(e)}},BaseRenderer.prototype.createCamera=function(){throw new Error("You're using a 3d camera. Try the html renderer.")},BaseRenderer.prototype.createAudio=function(e){return new AudioElement(e,this.globalData,this)},BaseRenderer.prototype.createFootage=function(e){return new FootageElement(e,this.globalData,this)},BaseRenderer.prototype.buildAllItems=function(){var e,i=this.layers.length;for(e=0;e<i;e+=1)this.buildItem(e);this.checkPendingElements()},BaseRenderer.prototype.includeLayers=function(e){this.completeLayers=!1;var i,s=e.length,a,_=this.layers.length;for(i=0;i<s;i+=1)for(a=0;a<_;){if(this.layers[a].id===e[i].id){this.layers[a]=e[i];break}a+=1}},BaseRenderer.prototype.setProjectInterface=function(e){this.globalData.projectInterface=e},BaseRenderer.prototype.initItems=function(){this.globalData.progressiveLoad||this.buildAllItems()},BaseRenderer.prototype.buildElementParenting=function(e,i,s){for(var a=this.elements,_=this.layers,$=0,rt=_.length;$<rt;)_[$].ind==i&&(!a[$]||a[$]===!0?(this.buildItem($),this.addPendingElement(e)):(s.push(a[$]),a[$].setAsParent(),_[$].parent!==void 0?this.buildElementParenting(e,_[$].parent,s):e.setHierarchy(s))),$+=1},BaseRenderer.prototype.addPendingElement=function(e){this.pendingElements.push(e)},BaseRenderer.prototype.searchExtraCompositions=function(e){var i,s=e.length;for(i=0;i<s;i+=1)if(e[i].xt){var a=this.createComp(e[i]);a.initExpressions(),this.globalData.projectInterface.registerComposition(a)}},BaseRenderer.prototype.getElementById=function(e){var i,s=this.elements.length;for(i=0;i<s;i+=1)if(this.elements[i].data.ind===e)return this.elements[i];return null},BaseRenderer.prototype.getElementByPath=function(e){var i=e.shift(),s;if(typeof i=="number")s=this.elements[i];else{var a,_=this.elements.length;for(a=0;a<_;a+=1)if(this.elements[a].data.nm===i){s=this.elements[a];break}}return e.length===0?s:s.getElementByPath(e)},BaseRenderer.prototype.setupGlobalData=function(e,i){this.globalData.fontManager=new FontManager,this.globalData.slotManager=slotFactory(e),this.globalData.fontManager.addChars(e.chars),this.globalData.fontManager.addFonts(e.fonts,i),this.globalData.getAssetData=this.animationItem.getAssetData.bind(this.animationItem),this.globalData.getAssetsPath=this.animationItem.getAssetsPath.bind(this.animationItem),this.globalData.imageLoader=this.animationItem.imagePreloader,this.globalData.audioController=this.animationItem.audioController,this.globalData.frameId=0,this.globalData.frameRate=e.fr,this.globalData.nm=e.nm,this.globalData.compSize={w:e.w,h:e.h}};var effectTypes={TRANSFORM_EFFECT:"transformEFfect"};function TransformElement(){}TransformElement.prototype={initTransform:function(){var i=new Matrix;this.finalTransform={mProp:this.data.ks?TransformPropertyFactory.getTransformProperty(this,this.data.ks,this):{o:0},_matMdf:!1,_localMatMdf:!1,_opMdf:!1,mat:i,localMat:i,localOpacity:1},this.data.ao&&(this.finalTransform.mProp.autoOriented=!0),this.data.ty},renderTransform:function(){if(this.finalTransform._opMdf=this.finalTransform.mProp.o._mdf||this._isFirstFrame,this.finalTransform._matMdf=this.finalTransform.mProp._mdf||this._isFirstFrame,this.hierarchy){var i,s=this.finalTransform.mat,a=0,_=this.hierarchy.length;if(!this.finalTransform._matMdf)for(;a<_;){if(this.hierarchy[a].finalTransform.mProp._mdf){this.finalTransform._matMdf=!0;break}a+=1}if(this.finalTransform._matMdf)for(i=this.finalTransform.mProp.v.props,s.cloneFromProps(i),a=0;a<_;a+=1)s.multiply(this.hierarchy[a].finalTransform.mProp.v)}(!this.localTransforms||this.finalTransform._matMdf)&&(this.finalTransform._localMatMdf=this.finalTransform._matMdf),this.finalTransform._opMdf&&(this.finalTransform.localOpacity=this.finalTransform.mProp.o.v)},renderLocalTransform:function(){if(this.localTransforms){var i=0,s=this.localTransforms.length;if(this.finalTransform._localMatMdf=this.finalTransform._matMdf,!this.finalTransform._localMatMdf||!this.finalTransform._opMdf)for(;i<s;)this.localTransforms[i]._mdf&&(this.finalTransform._localMatMdf=!0),this.localTransforms[i]._opMdf&&!this.finalTransform._opMdf&&(this.finalTransform.localOpacity=this.finalTransform.mProp.o.v,this.finalTransform._opMdf=!0),i+=1;if(this.finalTransform._localMatMdf){var a=this.finalTransform.localMat;for(this.localTransforms[0].matrix.clone(a),i=1;i<s;i+=1){var _=this.localTransforms[i].matrix;a.multiply(_)}a.multiply(this.finalTransform.mat)}if(this.finalTransform._opMdf){var $=this.finalTransform.localOpacity;for(i=0;i<s;i+=1)$*=this.localTransforms[i].opacity*.01;this.finalTransform.localOpacity=$}}},searchEffectTransforms:function(){if(this.renderableEffectsManager){var i=this.renderableEffectsManager.getEffects(effectTypes.TRANSFORM_EFFECT);if(i.length){this.localTransforms=[],this.finalTransform.localMat=new Matrix;var s=0,a=i.length;for(s=0;s<a;s+=1)this.localTransforms.push(i[s])}}},globalToLocal:function(i){var s=[];s.push(this.finalTransform);for(var a=!0,_=this.comp;a;)_.finalTransform?(_.data.hasMask&&s.splice(0,0,_.finalTransform),_=_.comp):a=!1;var $,rt=s.length,c;for($=0;$<rt;$+=1)c=s[$].mat.applyToPointArray(0,0,0),i=[i[0]-c[0],i[1]-c[1],0];return i},mHelper:new Matrix};function MaskElement(e,i,s){this.data=e,this.element=i,this.globalData=s,this.storedData=[],this.masksProperties=this.data.masksProperties||[],this.maskElement=null;var a=this.globalData.defs,_,$=this.masksProperties?this.masksProperties.length:0;this.viewData=createSizedArray($),this.solidPath="";var rt,c=this.masksProperties,dt=0,ht=[],Et,St,At=createElementID(),Pt,Vt,Bt,Zt,zt="clipPath",Ut="clip-path";for(_=0;_<$;_+=1)if((c[_].mode!=="a"&&c[_].mode!=="n"||c[_].inv||c[_].o.k!==100||c[_].o.x)&&(zt="mask",Ut="mask"),(c[_].mode==="s"||c[_].mode==="i")&&dt===0?(Pt=createNS("rect"),Pt.setAttribute("fill","#ffffff"),Pt.setAttribute("width",this.element.comp.data.w||0),Pt.setAttribute("height",this.element.comp.data.h||0),ht.push(Pt)):Pt=null,rt=createNS("path"),c[_].mode==="n")this.viewData[_]={op:PropertyFactory.getProp(this.element,c[_].o,0,.01,this.element),prop:ShapePropertyFactory.getShapeProp(this.element,c[_],3),elem:rt,lastPath:""},a.appendChild(rt);else{dt+=1,rt.setAttribute("fill",c[_].mode==="s"?"#000000":"#ffffff"),rt.setAttribute("clip-rule","nonzero");var Nt;if(c[_].x.k!==0?(zt="mask",Ut="mask",Zt=PropertyFactory.getProp(this.element,c[_].x,0,null,this.element),Nt=createElementID(),Vt=createNS("filter"),Vt.setAttribute("id",Nt),Bt=createNS("feMorphology"),Bt.setAttribute("operator","erode"),Bt.setAttribute("in","SourceGraphic"),Bt.setAttribute("radius","0"),Vt.appendChild(Bt),a.appendChild(Vt),rt.setAttribute("stroke",c[_].mode==="s"?"#000000":"#ffffff")):(Bt=null,Zt=null),this.storedData[_]={elem:rt,x:Zt,expan:Bt,lastPath:"",lastOperator:"",filterId:Nt,lastRadius:0},c[_].mode==="i"){St=ht.length;var Gt=createNS("g");for(Et=0;Et<St;Et+=1)Gt.appendChild(ht[Et]);var er=createNS("mask");er.setAttribute("mask-type","alpha"),er.setAttribute("id",At+"_"+dt),er.appendChild(rt),a.appendChild(er),Gt.setAttribute("mask","url("+getLocationHref()+"#"+At+"_"+dt+")"),ht.length=0,ht.push(Gt)}else ht.push(rt);c[_].inv&&!this.solidPath&&(this.solidPath=this.createLayerSolidPath()),this.viewData[_]={elem:rt,lastPath:"",op:PropertyFactory.getProp(this.element,c[_].o,0,.01,this.element),prop:ShapePropertyFactory.getShapeProp(this.element,c[_],3),invRect:Pt},this.viewData[_].prop.k||this.drawPath(c[_],this.viewData[_].prop.v,this.viewData[_])}for(this.maskElement=createNS(zt),$=ht.length,_=0;_<$;_+=1)this.maskElement.appendChild(ht[_]);dt>0&&(this.maskElement.setAttribute("id",At),this.element.maskedElement.setAttribute(Ut,"url("+getLocationHref()+"#"+At+")"),a.appendChild(this.maskElement)),this.viewData.length&&this.element.addRenderableComponent(this)}MaskElement.prototype.getMaskProperty=function(e){return this.viewData[e].prop},MaskElement.prototype.renderFrame=function(e){var i=this.element.finalTransform.mat,s,a=this.masksProperties.length;for(s=0;s<a;s+=1)if((this.viewData[s].prop._mdf||e)&&this.drawPath(this.masksProperties[s],this.viewData[s].prop.v,this.viewData[s]),(this.viewData[s].op._mdf||e)&&this.viewData[s].elem.setAttribute("fill-opacity",this.viewData[s].op.v),this.masksProperties[s].mode!=="n"&&(this.viewData[s].invRect&&(this.element.finalTransform.mProp._mdf||e)&&this.viewData[s].invRect.setAttribute("transform",i.getInverseMatrix().to2dCSS()),this.storedData[s].x&&(this.storedData[s].x._mdf||e))){var _=this.storedData[s].expan;this.storedData[s].x.v<0?(this.storedData[s].lastOperator!=="erode"&&(this.storedData[s].lastOperator="erode",this.storedData[s].elem.setAttribute("filter","url("+getLocationHref()+"#"+this.storedData[s].filterId+")")),_.setAttribute("radius",-this.storedData[s].x.v)):(this.storedData[s].lastOperator!=="dilate"&&(this.storedData[s].lastOperator="dilate",this.storedData[s].elem.setAttribute("filter",null)),this.storedData[s].elem.setAttribute("stroke-width",this.storedData[s].x.v*2))}},MaskElement.prototype.getMaskelement=function(){return this.maskElement},MaskElement.prototype.createLayerSolidPath=function(){var e="M0,0 ";return e+=" h"+this.globalData.compSize.w,e+=" v"+this.globalData.compSize.h,e+=" h-"+this.globalData.compSize.w,e+=" v-"+this.globalData.compSize.h+" ",e},MaskElement.prototype.drawPath=function(e,i,s){var a=" M"+i.v[0][0]+","+i.v[0][1],_,$;for($=i._length,_=1;_<$;_+=1)a+=" C"+i.o[_-1][0]+","+i.o[_-1][1]+" "+i.i[_][0]+","+i.i[_][1]+" "+i.v[_][0]+","+i.v[_][1];if(i.c&&$>1&&(a+=" C"+i.o[_-1][0]+","+i.o[_-1][1]+" "+i.i[0][0]+","+i.i[0][1]+" "+i.v[0][0]+","+i.v[0][1]),s.lastPath!==a){var rt="";s.elem&&(i.c&&(rt=e.inv?this.solidPath+a:a),s.elem.setAttribute("d",rt)),s.lastPath=a}},MaskElement.prototype.destroy=function(){this.element=null,this.globalData=null,this.maskElement=null,this.data=null,this.masksProperties=null};var filtersFactory=function(){var e={};e.createFilter=i,e.createAlphaToLuminanceFilter=s;function i(a,_){var $=createNS("filter");return $.setAttribute("id",a),_!==!0&&($.setAttribute("filterUnits","objectBoundingBox"),$.setAttribute("x","0%"),$.setAttribute("y","0%"),$.setAttribute("width","100%"),$.setAttribute("height","100%")),$}function s(){var a=createNS("feColorMatrix");return a.setAttribute("type","matrix"),a.setAttribute("color-interpolation-filters","sRGB"),a.setAttribute("values","0 0 0 1 0  0 0 0 1 0  0 0 0 1 0  0 0 0 1 1"),a}return e}(),featureSupport=function(){var e={maskType:!0,svgLumaHidden:!0,offscreenCanvas:typeof OffscreenCanvas<"u"};return(/MSIE 10/i.test(navigator.userAgent)||/MSIE 9/i.test(navigator.userAgent)||/rv:11.0/i.test(navigator.userAgent)||/Edge\/\d./i.test(navigator.userAgent))&&(e.maskType=!1),/firefox/i.test(navigator.userAgent)&&(e.svgLumaHidden=!1),e}(),registeredEffects$1={},idPrefix="filter_result_";function SVGEffects(e){var i,s="SourceGraphic",a=e.data.ef?e.data.ef.length:0,_=createElementID(),$=filtersFactory.createFilter(_,!0),rt=0;this.filters=[];var c;for(i=0;i<a;i+=1){c=null;var dt=e.data.ef[i].ty;if(registeredEffects$1[dt]){var ht=registeredEffects$1[dt].effect;c=new ht($,e.effectsManager.effectElements[i],e,idPrefix+rt,s),s=idPrefix+rt,registeredEffects$1[dt].countsAsEffect&&(rt+=1)}c&&this.filters.push(c)}rt&&(e.globalData.defs.appendChild($),e.layerElement.setAttribute("filter","url("+getLocationHref()+"#"+_+")")),this.filters.length&&e.addRenderableComponent(this)}SVGEffects.prototype.renderFrame=function(e){var i,s=this.filters.length;for(i=0;i<s;i+=1)this.filters[i].renderFrame(e)},SVGEffects.prototype.getEffects=function(e){var i,s=this.filters.length,a=[];for(i=0;i<s;i+=1)this.filters[i].type===e&&a.push(this.filters[i]);return a};function registerEffect$1(e,i,s){registeredEffects$1[e]={effect:i,countsAsEffect:s}}function SVGBaseElement(){}SVGBaseElement.prototype={initRendererElement:function(){this.layerElement=createNS("g")},createContainerElements:function(){this.matteElement=createNS("g"),this.transformedElement=this.layerElement,this.maskedElement=this.layerElement,this._sizeChanged=!1;var i=null;if(this.data.td){this.matteMasks={};var s=createNS("g");s.setAttribute("id",this.layerId),s.appendChild(this.layerElement),i=s,this.globalData.defs.appendChild(s)}else this.data.tt?(this.matteElement.appendChild(this.layerElement),i=this.matteElement,this.baseElement=this.matteElement):this.baseElement=this.layerElement;if(this.data.ln&&this.layerElement.setAttribute("id",this.data.ln),this.data.cl&&this.layerElement.setAttribute("class",this.data.cl),this.data.ty===0&&!this.data.hd){var a=createNS("clipPath"),_=createNS("path");_.setAttribute("d","M0,0 L"+this.data.w+",0 L"+this.data.w+","+this.data.h+" L0,"+this.data.h+"z");var $=createElementID();if(a.setAttribute("id",$),a.appendChild(_),this.globalData.defs.appendChild(a),this.checkMasks()){var rt=createNS("g");rt.setAttribute("clip-path","url("+getLocationHref()+"#"+$+")"),rt.appendChild(this.layerElement),this.transformedElement=rt,i?i.appendChild(this.transformedElement):this.baseElement=this.transformedElement}else this.layerElement.setAttribute("clip-path","url("+getLocationHref()+"#"+$+")")}this.data.bm!==0&&this.setBlendMode()},renderElement:function(){this.finalTransform._localMatMdf&&this.transformedElement.setAttribute("transform",this.finalTransform.localMat.to2dCSS()),this.finalTransform._opMdf&&this.transformedElement.setAttribute("opacity",this.finalTransform.localOpacity)},destroyBaseElement:function(){this.layerElement=null,this.matteElement=null,this.maskManager.destroy()},getBaseElement:function(){return this.data.hd?null:this.baseElement},createRenderableComponents:function(){this.maskManager=new MaskElement(this.data,this,this.globalData),this.renderableEffectsManager=new SVGEffects(this),this.searchEffectTransforms()},getMatte:function(i){if(this.matteMasks||(this.matteMasks={}),!this.matteMasks[i]){var s=this.layerId+"_"+i,a,_,$,rt;if(i===1||i===3){var c=createNS("mask");c.setAttribute("id",s),c.setAttribute("mask-type",i===3?"luminance":"alpha"),$=createNS("use"),$.setAttributeNS("http://www.w3.org/1999/xlink","href","#"+this.layerId),c.appendChild($),this.globalData.defs.appendChild(c),!featureSupport.maskType&&i===1&&(c.setAttribute("mask-type","luminance"),a=createElementID(),_=filtersFactory.createFilter(a),this.globalData.defs.appendChild(_),_.appendChild(filtersFactory.createAlphaToLuminanceFilter()),rt=createNS("g"),rt.appendChild($),c.appendChild(rt),rt.setAttribute("filter","url("+getLocationHref()+"#"+a+")"))}else if(i===2){var dt=createNS("mask");dt.setAttribute("id",s),dt.setAttribute("mask-type","alpha");var ht=createNS("g");dt.appendChild(ht),a=createElementID(),_=filtersFactory.createFilter(a);var Et=createNS("feComponentTransfer");Et.setAttribute("in","SourceGraphic"),_.appendChild(Et);var St=createNS("feFuncA");St.setAttribute("type","table"),St.setAttribute("tableValues","1.0 0.0"),Et.appendChild(St),this.globalData.defs.appendChild(_);var At=createNS("rect");At.setAttribute("width",this.comp.data.w),At.setAttribute("height",this.comp.data.h),At.setAttribute("x","0"),At.setAttribute("y","0"),At.setAttribute("fill","#ffffff"),At.setAttribute("opacity","0"),ht.setAttribute("filter","url("+getLocationHref()+"#"+a+")"),ht.appendChild(At),$=createNS("use"),$.setAttributeNS("http://www.w3.org/1999/xlink","href","#"+this.layerId),ht.appendChild($),featureSupport.maskType||(dt.setAttribute("mask-type","luminance"),_.appendChild(filtersFactory.createAlphaToLuminanceFilter()),rt=createNS("g"),ht.appendChild(At),rt.appendChild(this.layerElement),ht.appendChild(rt)),this.globalData.defs.appendChild(dt)}this.matteMasks[i]=s}return this.matteMasks[i]},setMatte:function(i){this.matteElement&&this.matteElement.setAttribute("mask","url("+getLocationHref()+"#"+i+")")}};function HierarchyElement(){}HierarchyElement.prototype={initHierarchy:function(){this.hierarchy=[],this._isParent=!1,this.checkParenting()},setHierarchy:function(i){this.hierarchy=i},setAsParent:function(){this._isParent=!0},checkParenting:function(){this.data.parent!==void 0&&this.comp.buildElementParenting(this,this.data.parent,[])}};function RenderableDOMElement(){}(function(){var e={initElement:function(s,a,_){this.initFrame(),this.initBaseData(s,a,_),this.initTransform(s,a,_),this.initHierarchy(),this.initRenderable(),this.initRendererElement(),this.createContainerElements(),this.createRenderableComponents(),this.createContent(),this.hide()},hide:function(){if(!this.hidden&&(!this.isInRange||this.isTransparent)){var s=this.baseElement||this.layerElement;s.style.display="none",this.hidden=!0}},show:function(){if(this.isInRange&&!this.isTransparent){if(!this.data.hd){var s=this.baseElement||this.layerElement;s.style.display="block"}this.hidden=!1,this._isFirstFrame=!0}},renderFrame:function(){this.data.hd||this.hidden||(this.renderTransform(),this.renderRenderable(),this.renderLocalTransform(),this.renderElement(),this.renderInnerContent(),this._isFirstFrame&&(this._isFirstFrame=!1))},renderInnerContent:function(){},prepareFrame:function(s){this._mdf=!1,this.prepareRenderableFrame(s),this.prepareProperties(s,this.isInRange),this.checkTransparency()},destroy:function(){this.innerElem=null,this.destroyBaseElement()}};extendPrototype([RenderableElement,createProxyFunction(e)],RenderableDOMElement)})();function IImageElement(e,i,s){this.assetData=i.getAssetData(e.refId),this.assetData&&this.assetData.sid&&(this.assetData=i.slotManager.getProp(this.assetData)),this.initElement(e,i,s),this.sourceRect={top:0,left:0,width:this.assetData.w,height:this.assetData.h}}extendPrototype([BaseElement,TransformElement,SVGBaseElement,HierarchyElement,FrameElement,RenderableDOMElement],IImageElement),IImageElement.prototype.createContent=function(){var e=this.globalData.getAssetsPath(this.assetData);this.innerElem=createNS("image"),this.innerElem.setAttribute("width",this.assetData.w+"px"),this.innerElem.setAttribute("height",this.assetData.h+"px"),this.innerElem.setAttribute("preserveAspectRatio",this.assetData.pr||this.globalData.renderConfig.imagePreserveAspectRatio),this.innerElem.setAttributeNS("http://www.w3.org/1999/xlink","href",e),this.layerElement.appendChild(this.innerElem)},IImageElement.prototype.sourceRectAtTime=function(){return this.sourceRect};function ProcessedElement(e,i){this.elem=e,this.pos=i}function IShapeElement(){}IShapeElement.prototype={addShapeToModifiers:function(i){var s,a=this.shapeModifiers.length;for(s=0;s<a;s+=1)this.shapeModifiers[s].addShape(i)},isShapeInAnimatedModifiers:function(i){for(var s=0,a=this.shapeModifiers.length;s<a;)if(this.shapeModifiers[s].isAnimatedWithShape(i))return!0;return!1},renderModifiers:function(){if(this.shapeModifiers.length){var i,s=this.shapes.length;for(i=0;i<s;i+=1)this.shapes[i].sh.reset();s=this.shapeModifiers.length;var a;for(i=s-1;i>=0&&(a=this.shapeModifiers[i].processShapes(this._isFirstFrame),!a);i-=1);}},searchProcessedElement:function(i){for(var s=this.processedElements,a=0,_=s.length;a<_;){if(s[a].elem===i)return s[a].pos;a+=1}return 0},addProcessedElement:function(i,s){for(var a=this.processedElements,_=a.length;_;)if(_-=1,a[_].elem===i){a[_].pos=s;return}a.push(new ProcessedElement(i,s))},prepareFrame:function(i){this.prepareRenderableFrame(i),this.prepareProperties(i,this.isInRange)}};var lineCapEnum={1:"butt",2:"round",3:"square"},lineJoinEnum={1:"miter",2:"round",3:"bevel"};function SVGShapeData(e,i,s){this.caches=[],this.styles=[],this.transformers=e,this.lStr="",this.sh=s,this.lvl=i,this._isAnimated=!!s.k;for(var a=0,_=e.length;a<_;){if(e[a].mProps.dynamicProperties.length){this._isAnimated=!0;break}a+=1}}SVGShapeData.prototype.setAsAnimated=function(){this._isAnimated=!0};function SVGStyleData(e,i){this.data=e,this.type=e.ty,this.d="",this.lvl=i,this._mdf=!1,this.closed=e.hd===!0,this.pElem=createNS("path"),this.msElem=null}SVGStyleData.prototype.reset=function(){this.d="",this._mdf=!1};function DashProperty(e,i,s,a){this.elem=e,this.frameId=-1,this.dataProps=createSizedArray(i.length),this.renderer=s,this.k=!1,this.dashStr="",this.dashArray=createTypedArray("float32",i.length?i.length-1:0),this.dashoffset=createTypedArray("float32",1),this.initDynamicPropertyContainer(a);var _,$=i.length||0,rt;for(_=0;_<$;_+=1)rt=PropertyFactory.getProp(e,i[_].v,0,0,this),this.k=rt.k||this.k,this.dataProps[_]={n:i[_].n,p:rt};this.k||this.getValue(!0),this._isAnimated=this.k}DashProperty.prototype.getValue=function(e){if(!(this.elem.globalData.frameId===this.frameId&&!e)&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties(),this._mdf=this._mdf||e,this._mdf)){var i=0,s=this.dataProps.length;for(this.renderer==="svg"&&(this.dashStr=""),i=0;i<s;i+=1)this.dataProps[i].n!=="o"?this.renderer==="svg"?this.dashStr+=" "+this.dataProps[i].p.v:this.dashArray[i]=this.dataProps[i].p.v:this.dashoffset[0]=this.dataProps[i].p.v}},extendPrototype([DynamicPropertyContainer],DashProperty);function SVGStrokeStyleData(e,i,s){this.initDynamicPropertyContainer(e),this.getValue=this.iterateDynamicProperties,this.o=PropertyFactory.getProp(e,i.o,0,.01,this),this.w=PropertyFactory.getProp(e,i.w,0,null,this),this.d=new DashProperty(e,i.d||{},"svg",this),this.c=PropertyFactory.getProp(e,i.c,1,255,this),this.style=s,this._isAnimated=!!this._isAnimated}extendPrototype([DynamicPropertyContainer],SVGStrokeStyleData);function SVGFillStyleData(e,i,s){this.initDynamicPropertyContainer(e),this.getValue=this.iterateDynamicProperties,this.o=PropertyFactory.getProp(e,i.o,0,.01,this),this.c=PropertyFactory.getProp(e,i.c,1,255,this),this.style=s}extendPrototype([DynamicPropertyContainer],SVGFillStyleData);function SVGNoStyleData(e,i,s){this.initDynamicPropertyContainer(e),this.getValue=this.iterateDynamicProperties,this.style=s}extendPrototype([DynamicPropertyContainer],SVGNoStyleData);function GradientProperty(e,i,s){this.data=i,this.c=createTypedArray("uint8c",i.p*4);var a=i.k.k[0].s?i.k.k[0].s.length-i.p*4:i.k.k.length-i.p*4;this.o=createTypedArray("float32",a),this._cmdf=!1,this._omdf=!1,this._collapsable=this.checkCollapsable(),this._hasOpacity=a,this.initDynamicPropertyContainer(s),this.prop=PropertyFactory.getProp(e,i.k,1,null,this),this.k=this.prop.k,this.getValue(!0)}GradientProperty.prototype.comparePoints=function(e,i){for(var s=0,a=this.o.length/2,_;s<a;){if(_=Math.abs(e[s*4]-e[i*4+s*2]),_>.01)return!1;s+=1}return!0},GradientProperty.prototype.checkCollapsable=function(){if(this.o.length/2!==this.c.length/4)return!1;if(this.data.k.k[0].s)for(var e=0,i=this.data.k.k.length;e<i;){if(!this.comparePoints(this.data.k.k[e].s,this.data.p))return!1;e+=1}else if(!this.comparePoints(this.data.k.k,this.data.p))return!1;return!0},GradientProperty.prototype.getValue=function(e){if(this.prop.getValue(),this._mdf=!1,this._cmdf=!1,this._omdf=!1,this.prop._mdf||e){var i,s=this.data.p*4,a,_;for(i=0;i<s;i+=1)a=i%4===0?100:255,_=Math.round(this.prop.v[i]*a),this.c[i]!==_&&(this.c[i]=_,this._cmdf=!e);if(this.o.length)for(s=this.prop.v.length,i=this.data.p*4;i<s;i+=1)a=i%2===0?100:1,_=i%2===0?Math.round(this.prop.v[i]*100):this.prop.v[i],this.o[i-this.data.p*4]!==_&&(this.o[i-this.data.p*4]=_,this._omdf=!e);this._mdf=!e}},extendPrototype([DynamicPropertyContainer],GradientProperty);function SVGGradientFillStyleData(e,i,s){this.initDynamicPropertyContainer(e),this.getValue=this.iterateDynamicProperties,this.initGradientData(e,i,s)}SVGGradientFillStyleData.prototype.initGradientData=function(e,i,s){this.o=PropertyFactory.getProp(e,i.o,0,.01,this),this.s=PropertyFactory.getProp(e,i.s,1,null,this),this.e=PropertyFactory.getProp(e,i.e,1,null,this),this.h=PropertyFactory.getProp(e,i.h||{k:0},0,.01,this),this.a=PropertyFactory.getProp(e,i.a||{k:0},0,degToRads,this),this.g=new GradientProperty(e,i.g,this),this.style=s,this.stops=[],this.setGradientData(s.pElem,i),this.setGradientOpacity(i,s),this._isAnimated=!!this._isAnimated},SVGGradientFillStyleData.prototype.setGradientData=function(e,i){var s=createElementID(),a=createNS(i.t===1?"linearGradient":"radialGradient");a.setAttribute("id",s),a.setAttribute("spreadMethod","pad"),a.setAttribute("gradientUnits","userSpaceOnUse");var _=[],$,rt,c;for(c=i.g.p*4,rt=0;rt<c;rt+=4)$=createNS("stop"),a.appendChild($),_.push($);e.setAttribute(i.ty==="gf"?"fill":"stroke","url("+getLocationHref()+"#"+s+")"),this.gf=a,this.cst=_},SVGGradientFillStyleData.prototype.setGradientOpacity=function(e,i){if(this.g._hasOpacity&&!this.g._collapsable){var s,a,_,$=createNS("mask"),rt=createNS("path");$.appendChild(rt);var c=createElementID(),dt=createElementID();$.setAttribute("id",dt);var ht=createNS(e.t===1?"linearGradient":"radialGradient");ht.setAttribute("id",c),ht.setAttribute("spreadMethod","pad"),ht.setAttribute("gradientUnits","userSpaceOnUse"),_=e.g.k.k[0].s?e.g.k.k[0].s.length:e.g.k.k.length;var Et=this.stops;for(a=e.g.p*4;a<_;a+=2)s=createNS("stop"),s.setAttribute("stop-color","rgb(255,255,255)"),ht.appendChild(s),Et.push(s);rt.setAttribute(e.ty==="gf"?"fill":"stroke","url("+getLocationHref()+"#"+c+")"),e.ty==="gs"&&(rt.setAttribute("stroke-linecap",lineCapEnum[e.lc||2]),rt.setAttribute("stroke-linejoin",lineJoinEnum[e.lj||2]),e.lj===1&&rt.setAttribute("stroke-miterlimit",e.ml)),this.of=ht,this.ms=$,this.ost=Et,this.maskId=dt,i.msElem=rt}},extendPrototype([DynamicPropertyContainer],SVGGradientFillStyleData);function SVGGradientStrokeStyleData(e,i,s){this.initDynamicPropertyContainer(e),this.getValue=this.iterateDynamicProperties,this.w=PropertyFactory.getProp(e,i.w,0,null,this),this.d=new DashProperty(e,i.d||{},"svg",this),this.initGradientData(e,i,s),this._isAnimated=!!this._isAnimated}extendPrototype([SVGGradientFillStyleData,DynamicPropertyContainer],SVGGradientStrokeStyleData);function ShapeGroupData(){this.it=[],this.prevViewData=[],this.gr=createNS("g")}function SVGTransformData(e,i,s){this.transform={mProps:e,op:i,container:s},this.elements=[],this._isAnimated=this.transform.mProps.dynamicProperties.length||this.transform.op.effectsSequence.length}var buildShapeString=function(i,s,a,_){if(s===0)return"";var $=i.o,rt=i.i,c=i.v,dt,ht=" M"+_.applyToPointStringified(c[0][0],c[0][1]);for(dt=1;dt<s;dt+=1)ht+=" C"+_.applyToPointStringified($[dt-1][0],$[dt-1][1])+" "+_.applyToPointStringified(rt[dt][0],rt[dt][1])+" "+_.applyToPointStringified(c[dt][0],c[dt][1]);return a&&s&&(ht+=" C"+_.applyToPointStringified($[dt-1][0],$[dt-1][1])+" "+_.applyToPointStringified(rt[0][0],rt[0][1])+" "+_.applyToPointStringified(c[0][0],c[0][1]),ht+="z"),ht},SVGElementsRenderer=function(){var e=new Matrix,i=new Matrix,s={createRenderFunction:a};function a(St){switch(St.ty){case"fl":return c;case"gf":return ht;case"gs":return dt;case"st":return Et;case"sh":case"el":case"rc":case"sr":return rt;case"tr":return _;case"no":return $;default:return null}}function _(St,At,Pt){(Pt||At.transform.op._mdf)&&At.transform.container.setAttribute("opacity",At.transform.op.v),(Pt||At.transform.mProps._mdf)&&At.transform.container.setAttribute("transform",At.transform.mProps.v.to2dCSS())}function $(){}function rt(St,At,Pt){var Vt,Bt,Zt,zt,Ut,Nt,Gt=At.styles.length,er=At.lvl,ir,or,mr,Rr;for(Nt=0;Nt<Gt;Nt+=1){if(zt=At.sh._mdf||Pt,At.styles[Nt].lvl<er){for(or=i.reset(),mr=er-At.styles[Nt].lvl,Rr=At.transformers.length-1;!zt&&mr>0;)zt=At.transformers[Rr].mProps._mdf||zt,mr-=1,Rr-=1;if(zt)for(mr=er-At.styles[Nt].lvl,Rr=At.transformers.length-1;mr>0;)or.multiply(At.transformers[Rr].mProps.v),mr-=1,Rr-=1}else or=e;if(ir=At.sh.paths,Bt=ir._length,zt){for(Zt="",Vt=0;Vt<Bt;Vt+=1)Ut=ir.shapes[Vt],Ut&&Ut._length&&(Zt+=buildShapeString(Ut,Ut._length,Ut.c,or));At.caches[Nt]=Zt}else Zt=At.caches[Nt];At.styles[Nt].d+=St.hd===!0?"":Zt,At.styles[Nt]._mdf=zt||At.styles[Nt]._mdf}}function c(St,At,Pt){var Vt=At.style;(At.c._mdf||Pt)&&Vt.pElem.setAttribute("fill","rgb("+bmFloor(At.c.v[0])+","+bmFloor(At.c.v[1])+","+bmFloor(At.c.v[2])+")"),(At.o._mdf||Pt)&&Vt.pElem.setAttribute("fill-opacity",At.o.v)}function dt(St,At,Pt){ht(St,At,Pt),Et(St,At,Pt)}function ht(St,At,Pt){var Vt=At.gf,Bt=At.g._hasOpacity,Zt=At.s.v,zt=At.e.v;if(At.o._mdf||Pt){var Ut=St.ty==="gf"?"fill-opacity":"stroke-opacity";At.style.pElem.setAttribute(Ut,At.o.v)}if(At.s._mdf||Pt){var Nt=St.t===1?"x1":"cx",Gt=Nt==="x1"?"y1":"cy";Vt.setAttribute(Nt,Zt[0]),Vt.setAttribute(Gt,Zt[1]),Bt&&!At.g._collapsable&&(At.of.setAttribute(Nt,Zt[0]),At.of.setAttribute(Gt,Zt[1]))}var er,ir,or,mr;if(At.g._cmdf||Pt){er=At.cst;var Rr=At.g.c;for(or=er.length,ir=0;ir<or;ir+=1)mr=er[ir],mr.setAttribute("offset",Rr[ir*4]+"%"),mr.setAttribute("stop-color","rgb("+Rr[ir*4+1]+","+Rr[ir*4+2]+","+Rr[ir*4+3]+")")}if(Bt&&(At.g._omdf||Pt)){var on=At.g.o;for(At.g._collapsable?er=At.cst:er=At.ost,or=er.length,ir=0;ir<or;ir+=1)mr=er[ir],At.g._collapsable||mr.setAttribute("offset",on[ir*2]+"%"),mr.setAttribute("stop-opacity",on[ir*2+1])}if(St.t===1)(At.e._mdf||Pt)&&(Vt.setAttribute("x2",zt[0]),Vt.setAttribute("y2",zt[1]),Bt&&!At.g._collapsable&&(At.of.setAttribute("x2",zt[0]),At.of.setAttribute("y2",zt[1])));else{var un;if((At.s._mdf||At.e._mdf||Pt)&&(un=Math.sqrt(Math.pow(Zt[0]-zt[0],2)+Math.pow(Zt[1]-zt[1],2)),Vt.setAttribute("r",un),Bt&&!At.g._collapsable&&At.of.setAttribute("r",un)),At.s._mdf||At.e._mdf||At.h._mdf||At.a._mdf||Pt){un||(un=Math.sqrt(Math.pow(Zt[0]-zt[0],2)+Math.pow(Zt[1]-zt[1],2)));var jr=Math.atan2(zt[1]-Zt[1],zt[0]-Zt[0]),Jr=At.h.v;Jr>=1?Jr=.99:Jr<=-1&&(Jr=-.99);var fn=un*Jr,Fr=Math.cos(jr+At.a.v)*fn+Zt[0],Cr=Math.sin(jr+At.a.v)*fn+Zt[1];Vt.setAttribute("fx",Fr),Vt.setAttribute("fy",Cr),Bt&&!At.g._collapsable&&(At.of.setAttribute("fx",Fr),At.of.setAttribute("fy",Cr))}}}function Et(St,At,Pt){var Vt=At.style,Bt=At.d;Bt&&(Bt._mdf||Pt)&&Bt.dashStr&&(Vt.pElem.setAttribute("stroke-dasharray",Bt.dashStr),Vt.pElem.setAttribute("stroke-dashoffset",Bt.dashoffset[0])),At.c&&(At.c._mdf||Pt)&&Vt.pElem.setAttribute("stroke","rgb("+bmFloor(At.c.v[0])+","+bmFloor(At.c.v[1])+","+bmFloor(At.c.v[2])+")"),(At.o._mdf||Pt)&&Vt.pElem.setAttribute("stroke-opacity",At.o.v),(At.w._mdf||Pt)&&(Vt.pElem.setAttribute("stroke-width",At.w.v),Vt.msElem&&Vt.msElem.setAttribute("stroke-width",At.w.v))}return s}();function SVGShapeElement(e,i,s){this.shapes=[],this.shapesData=e.shapes,this.stylesList=[],this.shapeModifiers=[],this.itemsData=[],this.processedElements=[],this.animatedContents=[],this.initElement(e,i,s),this.prevViewData=[]}extendPrototype([BaseElement,TransformElement,SVGBaseElement,IShapeElement,HierarchyElement,FrameElement,RenderableDOMElement],SVGShapeElement),SVGShapeElement.prototype.initSecondaryElement=function(){},SVGShapeElement.prototype.identityMatrix=new Matrix,SVGShapeElement.prototype.buildExpressionInterface=function(){},SVGShapeElement.prototype.createContent=function(){this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,this.layerElement,0,[],!0),this.filterUniqueShapes()},SVGShapeElement.prototype.filterUniqueShapes=function(){var e,i=this.shapes.length,s,a,_=this.stylesList.length,$,rt=[],c=!1;for(a=0;a<_;a+=1){for($=this.stylesList[a],c=!1,rt.length=0,e=0;e<i;e+=1)s=this.shapes[e],s.styles.indexOf($)!==-1&&(rt.push(s),c=s._isAnimated||c);rt.length>1&&c&&this.setShapesAsAnimated(rt)}},SVGShapeElement.prototype.setShapesAsAnimated=function(e){var i,s=e.length;for(i=0;i<s;i+=1)e[i].setAsAnimated()},SVGShapeElement.prototype.createStyleElement=function(e,i){var s,a=new SVGStyleData(e,i),_=a.pElem;if(e.ty==="st")s=new SVGStrokeStyleData(this,e,a);else if(e.ty==="fl")s=new SVGFillStyleData(this,e,a);else if(e.ty==="gf"||e.ty==="gs"){var $=e.ty==="gf"?SVGGradientFillStyleData:SVGGradientStrokeStyleData;s=new $(this,e,a),this.globalData.defs.appendChild(s.gf),s.maskId&&(this.globalData.defs.appendChild(s.ms),this.globalData.defs.appendChild(s.of),_.setAttribute("mask","url("+getLocationHref()+"#"+s.maskId+")"))}else e.ty==="no"&&(s=new SVGNoStyleData(this,e,a));return(e.ty==="st"||e.ty==="gs")&&(_.setAttribute("stroke-linecap",lineCapEnum[e.lc||2]),_.setAttribute("stroke-linejoin",lineJoinEnum[e.lj||2]),_.setAttribute("fill-opacity","0"),e.lj===1&&_.setAttribute("stroke-miterlimit",e.ml)),e.r===2&&_.setAttribute("fill-rule","evenodd"),e.ln&&_.setAttribute("id",e.ln),e.cl&&_.setAttribute("class",e.cl),e.bm&&(_.style["mix-blend-mode"]=getBlendMode(e.bm)),this.stylesList.push(a),this.addToAnimatedContents(e,s),s},SVGShapeElement.prototype.createGroupElement=function(e){var i=new ShapeGroupData;return e.ln&&i.gr.setAttribute("id",e.ln),e.cl&&i.gr.setAttribute("class",e.cl),e.bm&&(i.gr.style["mix-blend-mode"]=getBlendMode(e.bm)),i},SVGShapeElement.prototype.createTransformElement=function(e,i){var s=TransformPropertyFactory.getTransformProperty(this,e,this),a=new SVGTransformData(s,s.o,i);return this.addToAnimatedContents(e,a),a},SVGShapeElement.prototype.createShapeElement=function(e,i,s){var a=4;e.ty==="rc"?a=5:e.ty==="el"?a=6:e.ty==="sr"&&(a=7);var _=ShapePropertyFactory.getShapeProp(this,e,a,this),$=new SVGShapeData(i,s,_);return this.shapes.push($),this.addShapeToModifiers($),this.addToAnimatedContents(e,$),$},SVGShapeElement.prototype.addToAnimatedContents=function(e,i){for(var s=0,a=this.animatedContents.length;s<a;){if(this.animatedContents[s].element===i)return;s+=1}this.animatedContents.push({fn:SVGElementsRenderer.createRenderFunction(e),element:i,data:e})},SVGShapeElement.prototype.setElementStyles=function(e){var i=e.styles,s,a=this.stylesList.length;for(s=0;s<a;s+=1)i.indexOf(this.stylesList[s])===-1&&!this.stylesList[s].closed&&i.push(this.stylesList[s])},SVGShapeElement.prototype.reloadShapes=function(){this._isFirstFrame=!0;var e,i=this.itemsData.length;for(e=0;e<i;e+=1)this.prevViewData[e]=this.itemsData[e];for(this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,this.layerElement,0,[],!0),this.filterUniqueShapes(),i=this.dynamicProperties.length,e=0;e<i;e+=1)this.dynamicProperties[e].getValue();this.renderModifiers()},SVGShapeElement.prototype.searchShapes=function(e,i,s,a,_,$,rt){var c=[].concat($),dt,ht=e.length-1,Et,St,At=[],Pt=[],Vt,Bt,Zt;for(dt=ht;dt>=0;dt-=1){if(Zt=this.searchProcessedElement(e[dt]),Zt?i[dt]=s[Zt-1]:e[dt]._render=rt,e[dt].ty==="fl"||e[dt].ty==="st"||e[dt].ty==="gf"||e[dt].ty==="gs"||e[dt].ty==="no")Zt?i[dt].style.closed=e[dt].hd:i[dt]=this.createStyleElement(e[dt],_),e[dt]._render&&i[dt].style.pElem.parentNode!==a&&a.appendChild(i[dt].style.pElem),At.push(i[dt].style);else if(e[dt].ty==="gr"){if(!Zt)i[dt]=this.createGroupElement(e[dt]);else for(St=i[dt].it.length,Et=0;Et<St;Et+=1)i[dt].prevViewData[Et]=i[dt].it[Et];this.searchShapes(e[dt].it,i[dt].it,i[dt].prevViewData,i[dt].gr,_+1,c,rt),e[dt]._render&&i[dt].gr.parentNode!==a&&a.appendChild(i[dt].gr)}else e[dt].ty==="tr"?(Zt||(i[dt]=this.createTransformElement(e[dt],a)),Vt=i[dt].transform,c.push(Vt)):e[dt].ty==="sh"||e[dt].ty==="rc"||e[dt].ty==="el"||e[dt].ty==="sr"?(Zt||(i[dt]=this.createShapeElement(e[dt],c,_)),this.setElementStyles(i[dt])):e[dt].ty==="tm"||e[dt].ty==="rd"||e[dt].ty==="ms"||e[dt].ty==="pb"||e[dt].ty==="zz"||e[dt].ty==="op"?(Zt?(Bt=i[dt],Bt.closed=!1):(Bt=ShapeModifiers.getModifier(e[dt].ty),Bt.init(this,e[dt]),i[dt]=Bt,this.shapeModifiers.push(Bt)),Pt.push(Bt)):e[dt].ty==="rp"&&(Zt?(Bt=i[dt],Bt.closed=!0):(Bt=ShapeModifiers.getModifier(e[dt].ty),i[dt]=Bt,Bt.init(this,e,dt,i),this.shapeModifiers.push(Bt),rt=!1),Pt.push(Bt));this.addProcessedElement(e[dt],dt+1)}for(ht=At.length,dt=0;dt<ht;dt+=1)At[dt].closed=!0;for(ht=Pt.length,dt=0;dt<ht;dt+=1)Pt[dt].closed=!0},SVGShapeElement.prototype.renderInnerContent=function(){this.renderModifiers();var e,i=this.stylesList.length;for(e=0;e<i;e+=1)this.stylesList[e].reset();for(this.renderShape(),e=0;e<i;e+=1)(this.stylesList[e]._mdf||this._isFirstFrame)&&(this.stylesList[e].msElem&&(this.stylesList[e].msElem.setAttribute("d",this.stylesList[e].d),this.stylesList[e].d="M0 0"+this.stylesList[e].d),this.stylesList[e].pElem.setAttribute("d",this.stylesList[e].d||"M0 0"))},SVGShapeElement.prototype.renderShape=function(){var e,i=this.animatedContents.length,s;for(e=0;e<i;e+=1)s=this.animatedContents[e],(this._isFirstFrame||s.element._isAnimated)&&s.data!==!0&&s.fn(s.data,s.element,this._isFirstFrame)},SVGShapeElement.prototype.destroy=function(){this.destroyBaseElement(),this.shapesData=null,this.itemsData=null};function LetterProps(e,i,s,a,_,$){this.o=e,this.sw=i,this.sc=s,this.fc=a,this.m=_,this.p=$,this._mdf={o:!0,sw:!!i,sc:!!s,fc:!!a,m:!0,p:!0}}LetterProps.prototype.update=function(e,i,s,a,_,$){this._mdf.o=!1,this._mdf.sw=!1,this._mdf.sc=!1,this._mdf.fc=!1,this._mdf.m=!1,this._mdf.p=!1;var rt=!1;return this.o!==e&&(this.o=e,this._mdf.o=!0,rt=!0),this.sw!==i&&(this.sw=i,this._mdf.sw=!0,rt=!0),this.sc!==s&&(this.sc=s,this._mdf.sc=!0,rt=!0),this.fc!==a&&(this.fc=a,this._mdf.fc=!0,rt=!0),this.m!==_&&(this.m=_,this._mdf.m=!0,rt=!0),$.length&&(this.p[0]!==$[0]||this.p[1]!==$[1]||this.p[4]!==$[4]||this.p[5]!==$[5]||this.p[12]!==$[12]||this.p[13]!==$[13])&&(this.p=$,this._mdf.p=!0,rt=!0),rt};function TextProperty(e,i){this._frameId=initialDefaultFrame,this.pv="",this.v="",this.kf=!1,this._isFirstFrame=!0,this._mdf=!1,i.d&&i.d.sid&&(i.d=e.globalData.slotManager.getProp(i.d)),this.data=i,this.elem=e,this.comp=this.elem.comp,this.keysIndex=0,this.canResize=!1,this.minimumFontSize=1,this.effectsSequence=[],this.currentData={ascent:0,boxWidth:this.defaultBoxWidth,f:"",fStyle:"",fWeight:"",fc:"",j:"",justifyOffset:"",l:[],lh:0,lineWidths:[],ls:"",of:"",s:"",sc:"",sw:0,t:0,tr:0,sz:0,ps:null,fillColorAnim:!1,strokeColorAnim:!1,strokeWidthAnim:!1,yOffset:0,finalSize:0,finalText:[],finalLineHeight:0,__complete:!1},this.copyData(this.currentData,this.data.d.k[0].s),this.searchProperty()||this.completeTextData(this.currentData)}TextProperty.prototype.defaultBoxWidth=[0,0],TextProperty.prototype.copyData=function(e,i){for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(e[s]=i[s]);return e},TextProperty.prototype.setCurrentData=function(e){e.__complete||this.completeTextData(e),this.currentData=e,this.currentData.boxWidth=this.currentData.boxWidth||this.defaultBoxWidth,this._mdf=!0},TextProperty.prototype.searchProperty=function(){return this.searchKeyframes()},TextProperty.prototype.searchKeyframes=function(){return this.kf=this.data.d.k.length>1,this.kf&&this.addEffect(this.getKeyframeValue.bind(this)),this.kf},TextProperty.prototype.addEffect=function(e){this.effectsSequence.push(e),this.elem.addDynamicProperty(this)},TextProperty.prototype.getValue=function(e){if(!((this.elem.globalData.frameId===this.frameId||!this.effectsSequence.length)&&!e)){this.currentData.t=this.data.d.k[this.keysIndex].s.t;var i=this.currentData,s=this.keysIndex;if(this.lock){this.setCurrentData(this.currentData);return}this.lock=!0,this._mdf=!1;var a,_=this.effectsSequence.length,$=e||this.data.d.k[this.keysIndex].s;for(a=0;a<_;a+=1)s!==this.keysIndex?$=this.effectsSequence[a]($,$.t):$=this.effectsSequence[a](this.currentData,$.t);i!==$&&this.setCurrentData($),this.v=this.currentData,this.pv=this.v,this.lock=!1,this.frameId=this.elem.globalData.frameId}},TextProperty.prototype.getKeyframeValue=function(){for(var e=this.data.d.k,i=this.elem.comp.renderedFrame,s=0,a=e.length;s<=a-1&&!(s===a-1||e[s+1].t>i);)s+=1;return this.keysIndex!==s&&(this.keysIndex=s),this.data.d.k[this.keysIndex].s},TextProperty.prototype.buildFinalText=function(e){for(var i=[],s=0,a=e.length,_,$,rt=!1,c=!1,dt="";s<a;)rt=c,c=!1,_=e.charCodeAt(s),dt=e.charAt(s),FontManager.isCombinedCharacter(_)?rt=!0:_>=55296&&_<=56319?FontManager.isRegionalFlag(e,s)?dt=e.substr(s,14):($=e.charCodeAt(s+1),$>=56320&&$<=57343&&(FontManager.isModifier(_,$)?(dt=e.substr(s,2),rt=!0):FontManager.isFlagEmoji(e.substr(s,4))?dt=e.substr(s,4):dt=e.substr(s,2))):_>56319?($=e.charCodeAt(s+1),FontManager.isVariationSelector(_)&&(rt=!0)):FontManager.isZeroWidthJoiner(_)&&(rt=!0,c=!0),rt?(i[i.length-1]+=dt,rt=!1):i.push(dt),s+=dt.length;return i},TextProperty.prototype.completeTextData=function(e){e.__complete=!0;var i=this.elem.globalData.fontManager,s=this.data,a=[],_,$,rt,c=0,dt,ht=s.m.g,Et=0,St=0,At=0,Pt=[],Vt=0,Bt=0,Zt,zt,Ut=i.getFontByName(e.f),Nt,Gt=0,er=getFontProperties(Ut);e.fWeight=er.weight,e.fStyle=er.style,e.finalSize=e.s,e.finalText=this.buildFinalText(e.t),$=e.finalText.length,e.finalLineHeight=e.lh;var ir=e.tr/1e3*e.finalSize,or;if(e.sz)for(var mr=!0,Rr=e.sz[0],on=e.sz[1],un,jr;mr;){jr=this.buildFinalText(e.t),un=0,Vt=0,$=jr.length,ir=e.tr/1e3*e.finalSize;var Jr=-1;for(_=0;_<$;_+=1)or=jr[_].charCodeAt(0),rt=!1,jr[_]===" "?Jr=_:(or===13||or===3)&&(Vt=0,rt=!0,un+=e.finalLineHeight||e.finalSize*1.2),i.chars?(Nt=i.getCharData(jr[_],Ut.fStyle,Ut.fFamily),Gt=rt?0:Nt.w*e.finalSize/100):Gt=i.measureText(jr[_],e.f,e.finalSize),Vt+Gt>Rr&&jr[_]!==" "?(Jr===-1?$+=1:_=Jr,un+=e.finalLineHeight||e.finalSize*1.2,jr.splice(_,Jr===_?1:0,"\r"),Jr=-1,Vt=0):(Vt+=Gt,Vt+=ir);un+=Ut.ascent*e.finalSize/100,this.canResize&&e.finalSize>this.minimumFontSize&&on<un?(e.finalSize-=1,e.finalLineHeight=e.finalSize*e.lh/e.s):(e.finalText=jr,$=e.finalText.length,mr=!1)}Vt=-ir,Gt=0;var fn=0,Fr;for(_=0;_<$;_+=1)if(rt=!1,Fr=e.finalText[_],or=Fr.charCodeAt(0),or===13||or===3?(fn=0,Pt.push(Vt),Bt=Vt>Bt?Vt:Bt,Vt=-2*ir,dt="",rt=!0,At+=1):dt=Fr,i.chars?(Nt=i.getCharData(Fr,Ut.fStyle,i.getFontByName(e.f).fFamily),Gt=rt?0:Nt.w*e.finalSize/100):Gt=i.measureText(dt,e.f,e.finalSize),Fr===" "?fn+=Gt+ir:(Vt+=Gt+ir+fn,fn=0),a.push({l:Gt,an:Gt,add:Et,n:rt,anIndexes:[],val:dt,line:At,animatorJustifyOffset:0}),ht==2){if(Et+=Gt,dt===""||dt===" "||_===$-1){for((dt===""||dt===" ")&&(Et-=Gt);St<=_;)a[St].an=Et,a[St].ind=c,a[St].extra=Gt,St+=1;c+=1,Et=0}}else if(ht==3){if(Et+=Gt,dt===""||_===$-1){for(dt===""&&(Et-=Gt);St<=_;)a[St].an=Et,a[St].ind=c,a[St].extra=Gt,St+=1;Et=0,c+=1}}else a[c].ind=c,a[c].extra=0,c+=1;if(e.l=a,Bt=Vt>Bt?Vt:Bt,Pt.push(Vt),e.sz)e.boxWidth=e.sz[0],e.justifyOffset=0;else switch(e.boxWidth=Bt,e.j){case 1:e.justifyOffset=-e.boxWidth;break;case 2:e.justifyOffset=-e.boxWidth/2;break;default:e.justifyOffset=0}e.lineWidths=Pt;var Cr=s.a,Sr,dr;zt=Cr.length;var gr,qr,Lr=[];for(Zt=0;Zt<zt;Zt+=1){for(Sr=Cr[Zt],Sr.a.sc&&(e.strokeColorAnim=!0),Sr.a.sw&&(e.strokeWidthAnim=!0),(Sr.a.fc||Sr.a.fh||Sr.a.fs||Sr.a.fb)&&(e.fillColorAnim=!0),qr=0,gr=Sr.s.b,_=0;_<$;_+=1)dr=a[_],dr.anIndexes[Zt]=qr,(gr==1&&dr.val!==""||gr==2&&dr.val!==""&&dr.val!==" "||gr==3&&(dr.n||dr.val==" "||_==$-1)||gr==4&&(dr.n||_==$-1))&&(Sr.s.rn===1&&Lr.push(qr),qr+=1);s.a[Zt].s.totalChars=qr;var _n=-1,gn;if(Sr.s.rn===1)for(_=0;_<$;_+=1)dr=a[_],_n!=dr.anIndexes[Zt]&&(_n=dr.anIndexes[Zt],gn=Lr.splice(Math.floor(Math.random()*Lr.length),1)[0]),dr.anIndexes[Zt]=gn}e.yOffset=e.finalLineHeight||e.finalSize*1.2,e.ls=e.ls||0,e.ascent=Ut.ascent*e.finalSize/100},TextProperty.prototype.updateDocumentData=function(e,i){i=i===void 0?this.keysIndex:i;var s=this.copyData({},this.data.d.k[i].s);s=this.copyData(s,e),this.data.d.k[i].s=s,this.recalculate(i),this.setCurrentData(s),this.elem.addDynamicProperty(this)},TextProperty.prototype.recalculate=function(e){var i=this.data.d.k[e].s;i.__complete=!1,this.keysIndex=0,this._isFirstFrame=!0,this.getValue(i)},TextProperty.prototype.canResizeFont=function(e){this.canResize=e,this.recalculate(this.keysIndex),this.elem.addDynamicProperty(this)},TextProperty.prototype.setMinimumFontSize=function(e){this.minimumFontSize=Math.floor(e)||1,this.recalculate(this.keysIndex),this.elem.addDynamicProperty(this)};var TextSelectorProp=function(){var e=Math.max,i=Math.min,s=Math.floor;function a($,rt){this._currentTextLength=-1,this.k=!1,this.data=rt,this.elem=$,this.comp=$.comp,this.finalS=0,this.finalE=0,this.initDynamicPropertyContainer($),this.s=PropertyFactory.getProp($,rt.s||{k:0},0,0,this),"e"in rt?this.e=PropertyFactory.getProp($,rt.e,0,0,this):this.e={v:100},this.o=PropertyFactory.getProp($,rt.o||{k:0},0,0,this),this.xe=PropertyFactory.getProp($,rt.xe||{k:0},0,0,this),this.ne=PropertyFactory.getProp($,rt.ne||{k:0},0,0,this),this.sm=PropertyFactory.getProp($,rt.sm||{k:100},0,0,this),this.a=PropertyFactory.getProp($,rt.a,0,.01,this),this.dynamicProperties.length||this.getValue()}a.prototype={getMult:function(rt){this._currentTextLength!==this.elem.textProperty.currentData.l.length&&this.getValue();var c=0,dt=0,ht=1,Et=1;this.ne.v>0?c=this.ne.v/100:dt=-this.ne.v/100,this.xe.v>0?ht=1-this.xe.v/100:Et=1+this.xe.v/100;var St=BezierFactory.getBezierEasing(c,dt,ht,Et).get,At=0,Pt=this.finalS,Vt=this.finalE,Bt=this.data.sh;if(Bt===2)Vt===Pt?At=rt>=Vt?1:0:At=e(0,i(.5/(Vt-Pt)+(rt-Pt)/(Vt-Pt),1)),At=St(At);else if(Bt===3)Vt===Pt?At=rt>=Vt?0:1:At=1-e(0,i(.5/(Vt-Pt)+(rt-Pt)/(Vt-Pt),1)),At=St(At);else if(Bt===4)Vt===Pt?At=0:(At=e(0,i(.5/(Vt-Pt)+(rt-Pt)/(Vt-Pt),1)),At<.5?At*=2:At=1-2*(At-.5)),At=St(At);else if(Bt===5){if(Vt===Pt)At=0;else{var Zt=Vt-Pt;rt=i(e(0,rt+.5-Pt),Vt-Pt);var zt=-Zt/2+rt,Ut=Zt/2;At=Math.sqrt(1-zt*zt/(Ut*Ut))}At=St(At)}else Bt===6?(Vt===Pt?At=0:(rt=i(e(0,rt+.5-Pt),Vt-Pt),At=(1+Math.cos(Math.PI+Math.PI*2*rt/(Vt-Pt)))/2),At=St(At)):(rt>=s(Pt)&&(rt-Pt<0?At=e(0,i(i(Vt,1)-(Pt-rt),1)):At=e(0,i(Vt-rt,1))),At=St(At));if(this.sm.v!==100){var Nt=this.sm.v*.01;Nt===0&&(Nt=1e-8);var Gt=.5-Nt*.5;At<Gt?At=0:(At=(At-Gt)/Nt,At>1&&(At=1))}return At*this.a.v},getValue:function(rt){this.iterateDynamicProperties(),this._mdf=rt||this._mdf,this._currentTextLength=this.elem.textProperty.currentData.l.length||0,rt&&this.data.r===2&&(this.e.v=this._currentTextLength);var c=this.data.r===2?1:100/this.data.totalChars,dt=this.o.v/c,ht=this.s.v/c+dt,Et=this.e.v/c+dt;if(ht>Et){var St=ht;ht=Et,Et=St}this.finalS=ht,this.finalE=Et}},extendPrototype([DynamicPropertyContainer],a);function _($,rt,c){return new a($,rt)}return{getTextSelectorProp:_}}();function TextAnimatorDataProperty(e,i,s){var a={propType:!1},_=PropertyFactory.getProp,$=i.a;this.a={r:$.r?_(e,$.r,0,degToRads,s):a,rx:$.rx?_(e,$.rx,0,degToRads,s):a,ry:$.ry?_(e,$.ry,0,degToRads,s):a,sk:$.sk?_(e,$.sk,0,degToRads,s):a,sa:$.sa?_(e,$.sa,0,degToRads,s):a,s:$.s?_(e,$.s,1,.01,s):a,a:$.a?_(e,$.a,1,0,s):a,o:$.o?_(e,$.o,0,.01,s):a,p:$.p?_(e,$.p,1,0,s):a,sw:$.sw?_(e,$.sw,0,0,s):a,sc:$.sc?_(e,$.sc,1,0,s):a,fc:$.fc?_(e,$.fc,1,0,s):a,fh:$.fh?_(e,$.fh,0,0,s):a,fs:$.fs?_(e,$.fs,0,.01,s):a,fb:$.fb?_(e,$.fb,0,.01,s):a,t:$.t?_(e,$.t,0,0,s):a},this.s=TextSelectorProp.getTextSelectorProp(e,i.s,s),this.s.t=i.s.t}function TextAnimatorProperty(e,i,s){this._isFirstFrame=!0,this._hasMaskedPath=!1,this._frameId=-1,this._textData=e,this._renderType=i,this._elem=s,this._animatorsData=createSizedArray(this._textData.a.length),this._pathData={},this._moreOptions={alignment:{}},this.renderedLetters=[],this.lettersChangedFlag=!1,this.initDynamicPropertyContainer(s)}TextAnimatorProperty.prototype.searchProperties=function(){var e,i=this._textData.a.length,s,a=PropertyFactory.getProp;for(e=0;e<i;e+=1)s=this._textData.a[e],this._animatorsData[e]=new TextAnimatorDataProperty(this._elem,s,this);this._textData.p&&"m"in this._textData.p?(this._pathData={a:a(this._elem,this._textData.p.a,0,0,this),f:a(this._elem,this._textData.p.f,0,0,this),l:a(this._elem,this._textData.p.l,0,0,this),r:a(this._elem,this._textData.p.r,0,0,this),p:a(this._elem,this._textData.p.p,0,0,this),m:this._elem.maskManager.getMaskProperty(this._textData.p.m)},this._hasMaskedPath=!0):this._hasMaskedPath=!1,this._moreOptions.alignment=a(this._elem,this._textData.m.a,1,0,this)},TextAnimatorProperty.prototype.getMeasures=function(e,i){if(this.lettersChangedFlag=i,!(!this._mdf&&!this._isFirstFrame&&!i&&(!this._hasMaskedPath||!this._pathData.m._mdf))){this._isFirstFrame=!1;var s=this._moreOptions.alignment.v,a=this._animatorsData,_=this._textData,$=this.mHelper,rt=this._renderType,c=this.renderedLetters.length,dt,ht,Et,St,At=e.l,Pt,Vt,Bt,Zt,zt,Ut,Nt,Gt,er,ir,or,mr,Rr,on,un;if(this._hasMaskedPath){if(un=this._pathData.m,!this._pathData.n||this._pathData._mdf){var jr=un.v;this._pathData.r.v&&(jr=jr.reverse()),Pt={tLength:0,segments:[]},St=jr._length-1;var Jr;for(mr=0,Et=0;Et<St;Et+=1)Jr=bez.buildBezierData(jr.v[Et],jr.v[Et+1],[jr.o[Et][0]-jr.v[Et][0],jr.o[Et][1]-jr.v[Et][1]],[jr.i[Et+1][0]-jr.v[Et+1][0],jr.i[Et+1][1]-jr.v[Et+1][1]]),Pt.tLength+=Jr.segmentLength,Pt.segments.push(Jr),mr+=Jr.segmentLength;Et=St,un.v.c&&(Jr=bez.buildBezierData(jr.v[Et],jr.v[0],[jr.o[Et][0]-jr.v[Et][0],jr.o[Et][1]-jr.v[Et][1]],[jr.i[0][0]-jr.v[0][0],jr.i[0][1]-jr.v[0][1]]),Pt.tLength+=Jr.segmentLength,Pt.segments.push(Jr),mr+=Jr.segmentLength),this._pathData.pi=Pt}if(Pt=this._pathData.pi,Vt=this._pathData.f.v,Nt=0,Ut=1,Zt=0,zt=!0,ir=Pt.segments,Vt<0&&un.v.c)for(Pt.tLength<Math.abs(Vt)&&(Vt=-Math.abs(Vt)%Pt.tLength),Nt=ir.length-1,er=ir[Nt].points,Ut=er.length-1;Vt<0;)Vt+=er[Ut].partialLength,Ut-=1,Ut<0&&(Nt-=1,er=ir[Nt].points,Ut=er.length-1);er=ir[Nt].points,Gt=er[Ut-1],Bt=er[Ut],or=Bt.partialLength}St=At.length,dt=0,ht=0;var fn=e.finalSize*1.2*.714,Fr=!0,Cr,Sr,dr,gr,qr;gr=a.length;var Lr,_n=-1,gn,Sn,Fs,rs=Vt,ms=Nt,On=Ut,ws=-1,Vs,ks,lo,ys,dn,Es,po,no,tn="",us=this.defaultPropsArray,Co;if(e.j===2||e.j===1){var Ss=0,Ul=0,Tl=e.j===2?-.5:-1,ga=0,ds=!0;for(Et=0;Et<St;Et+=1)if(At[Et].n){for(Ss&&(Ss+=Ul);ga<Et;)At[ga].animatorJustifyOffset=Ss,ga+=1;Ss=0,ds=!0}else{for(dr=0;dr<gr;dr+=1)Cr=a[dr].a,Cr.t.propType&&(ds&&e.j===2&&(Ul+=Cr.t.v*Tl),Sr=a[dr].s,Lr=Sr.getMult(At[Et].anIndexes[dr],_.a[dr].s.totalChars),Lr.length?Ss+=Cr.t.v*Lr[0]*Tl:Ss+=Cr.t.v*Lr*Tl);ds=!1}for(Ss&&(Ss+=Ul);ga<Et;)At[ga].animatorJustifyOffset=Ss,ga+=1}for(Et=0;Et<St;Et+=1){if($.reset(),Vs=1,At[Et].n)dt=0,ht+=e.yOffset,ht+=Fr?1:0,Vt=rs,Fr=!1,this._hasMaskedPath&&(Nt=ms,Ut=On,er=ir[Nt].points,Gt=er[Ut-1],Bt=er[Ut],or=Bt.partialLength,Zt=0),tn="",no="",Es="",Co="",us=this.defaultPropsArray;else{if(this._hasMaskedPath){if(ws!==At[Et].line){switch(e.j){case 1:Vt+=mr-e.lineWidths[At[Et].line];break;case 2:Vt+=(mr-e.lineWidths[At[Et].line])/2;break}ws=At[Et].line}_n!==At[Et].ind&&(At[_n]&&(Vt+=At[_n].extra),Vt+=At[Et].an/2,_n=At[Et].ind),Vt+=s[0]*At[Et].an*.005;var Mn=0;for(dr=0;dr<gr;dr+=1)Cr=a[dr].a,Cr.p.propType&&(Sr=a[dr].s,Lr=Sr.getMult(At[Et].anIndexes[dr],_.a[dr].s.totalChars),Lr.length?Mn+=Cr.p.v[0]*Lr[0]:Mn+=Cr.p.v[0]*Lr),Cr.a.propType&&(Sr=a[dr].s,Lr=Sr.getMult(At[Et].anIndexes[dr],_.a[dr].s.totalChars),Lr.length?Mn+=Cr.a.v[0]*Lr[0]:Mn+=Cr.a.v[0]*Lr);for(zt=!0,this._pathData.a.v&&(Vt=At[0].an*.5+(mr-this._pathData.f.v-At[0].an*.5-At[At.length-1].an*.5)*_n/(St-1),Vt+=this._pathData.f.v);zt;)Zt+or>=Vt+Mn||!er?(Rr=(Vt+Mn-Zt)/Bt.partialLength,Sn=Gt.point[0]+(Bt.point[0]-Gt.point[0])*Rr,Fs=Gt.point[1]+(Bt.point[1]-Gt.point[1])*Rr,$.translate(-s[0]*At[Et].an*.005,-(s[1]*fn)*.01),zt=!1):er&&(Zt+=Bt.partialLength,Ut+=1,Ut>=er.length&&(Ut=0,Nt+=1,ir[Nt]?er=ir[Nt].points:un.v.c?(Ut=0,Nt=0,er=ir[Nt].points):(Zt-=Bt.partialLength,er=null)),er&&(Gt=Bt,Bt=er[Ut],or=Bt.partialLength));gn=At[Et].an/2-At[Et].add,$.translate(-gn,0,0)}else gn=At[Et].an/2-At[Et].add,$.translate(-gn,0,0),$.translate(-s[0]*At[Et].an*.005,-s[1]*fn*.01,0);for(dr=0;dr<gr;dr+=1)Cr=a[dr].a,Cr.t.propType&&(Sr=a[dr].s,Lr=Sr.getMult(At[Et].anIndexes[dr],_.a[dr].s.totalChars),(dt!==0||e.j!==0)&&(this._hasMaskedPath?Lr.length?Vt+=Cr.t.v*Lr[0]:Vt+=Cr.t.v*Lr:Lr.length?dt+=Cr.t.v*Lr[0]:dt+=Cr.t.v*Lr));for(e.strokeWidthAnim&&(lo=e.sw||0),e.strokeColorAnim&&(e.sc?ks=[e.sc[0],e.sc[1],e.sc[2]]:ks=[0,0,0]),e.fillColorAnim&&e.fc&&(ys=[e.fc[0],e.fc[1],e.fc[2]]),dr=0;dr<gr;dr+=1)Cr=a[dr].a,Cr.a.propType&&(Sr=a[dr].s,Lr=Sr.getMult(At[Et].anIndexes[dr],_.a[dr].s.totalChars),Lr.length?$.translate(-Cr.a.v[0]*Lr[0],-Cr.a.v[1]*Lr[1],Cr.a.v[2]*Lr[2]):$.translate(-Cr.a.v[0]*Lr,-Cr.a.v[1]*Lr,Cr.a.v[2]*Lr));for(dr=0;dr<gr;dr+=1)Cr=a[dr].a,Cr.s.propType&&(Sr=a[dr].s,Lr=Sr.getMult(At[Et].anIndexes[dr],_.a[dr].s.totalChars),Lr.length?$.scale(1+(Cr.s.v[0]-1)*Lr[0],1+(Cr.s.v[1]-1)*Lr[1],1):$.scale(1+(Cr.s.v[0]-1)*Lr,1+(Cr.s.v[1]-1)*Lr,1));for(dr=0;dr<gr;dr+=1){if(Cr=a[dr].a,Sr=a[dr].s,Lr=Sr.getMult(At[Et].anIndexes[dr],_.a[dr].s.totalChars),Cr.sk.propType&&(Lr.length?$.skewFromAxis(-Cr.sk.v*Lr[0],Cr.sa.v*Lr[1]):$.skewFromAxis(-Cr.sk.v*Lr,Cr.sa.v*Lr)),Cr.r.propType&&(Lr.length?$.rotateZ(-Cr.r.v*Lr[2]):$.rotateZ(-Cr.r.v*Lr)),Cr.ry.propType&&(Lr.length?$.rotateY(Cr.ry.v*Lr[1]):$.rotateY(Cr.ry.v*Lr)),Cr.rx.propType&&(Lr.length?$.rotateX(Cr.rx.v*Lr[0]):$.rotateX(Cr.rx.v*Lr)),Cr.o.propType&&(Lr.length?Vs+=(Cr.o.v*Lr[0]-Vs)*Lr[0]:Vs+=(Cr.o.v*Lr-Vs)*Lr),e.strokeWidthAnim&&Cr.sw.propType&&(Lr.length?lo+=Cr.sw.v*Lr[0]:lo+=Cr.sw.v*Lr),e.strokeColorAnim&&Cr.sc.propType)for(dn=0;dn<3;dn+=1)Lr.length?ks[dn]+=(Cr.sc.v[dn]-ks[dn])*Lr[0]:ks[dn]+=(Cr.sc.v[dn]-ks[dn])*Lr;if(e.fillColorAnim&&e.fc){if(Cr.fc.propType)for(dn=0;dn<3;dn+=1)Lr.length?ys[dn]+=(Cr.fc.v[dn]-ys[dn])*Lr[0]:ys[dn]+=(Cr.fc.v[dn]-ys[dn])*Lr;Cr.fh.propType&&(Lr.length?ys=addHueToRGB(ys,Cr.fh.v*Lr[0]):ys=addHueToRGB(ys,Cr.fh.v*Lr)),Cr.fs.propType&&(Lr.length?ys=addSaturationToRGB(ys,Cr.fs.v*Lr[0]):ys=addSaturationToRGB(ys,Cr.fs.v*Lr)),Cr.fb.propType&&(Lr.length?ys=addBrightnessToRGB(ys,Cr.fb.v*Lr[0]):ys=addBrightnessToRGB(ys,Cr.fb.v*Lr))}}for(dr=0;dr<gr;dr+=1)Cr=a[dr].a,Cr.p.propType&&(Sr=a[dr].s,Lr=Sr.getMult(At[Et].anIndexes[dr],_.a[dr].s.totalChars),this._hasMaskedPath?Lr.length?$.translate(0,Cr.p.v[1]*Lr[0],-Cr.p.v[2]*Lr[1]):$.translate(0,Cr.p.v[1]*Lr,-Cr.p.v[2]*Lr):Lr.length?$.translate(Cr.p.v[0]*Lr[0],Cr.p.v[1]*Lr[1],-Cr.p.v[2]*Lr[2]):$.translate(Cr.p.v[0]*Lr,Cr.p.v[1]*Lr,-Cr.p.v[2]*Lr));if(e.strokeWidthAnim&&(Es=lo<0?0:lo),e.strokeColorAnim&&(po="rgb("+Math.round(ks[0]*255)+","+Math.round(ks[1]*255)+","+Math.round(ks[2]*255)+")"),e.fillColorAnim&&e.fc&&(no="rgb("+Math.round(ys[0]*255)+","+Math.round(ys[1]*255)+","+Math.round(ys[2]*255)+")"),this._hasMaskedPath){if($.translate(0,-e.ls),$.translate(0,s[1]*fn*.01+ht,0),this._pathData.p.v){on=(Bt.point[1]-Gt.point[1])/(Bt.point[0]-Gt.point[0]);var Cs=Math.atan(on)*180/Math.PI;Bt.point[0]<Gt.point[0]&&(Cs+=180),$.rotate(-Cs*Math.PI/180)}$.translate(Sn,Fs,0),Vt-=s[0]*At[Et].an*.005,At[Et+1]&&_n!==At[Et+1].ind&&(Vt+=At[Et].an/2,Vt+=e.tr*.001*e.finalSize)}else{switch($.translate(dt,ht,0),e.ps&&$.translate(e.ps[0],e.ps[1]+e.ascent,0),e.j){case 1:$.translate(At[Et].animatorJustifyOffset+e.justifyOffset+(e.boxWidth-e.lineWidths[At[Et].line]),0,0);break;case 2:$.translate(At[Et].animatorJustifyOffset+e.justifyOffset+(e.boxWidth-e.lineWidths[At[Et].line])/2,0,0);break}$.translate(0,-e.ls),$.translate(gn,0,0),$.translate(s[0]*At[Et].an*.005,s[1]*fn*.01,0),dt+=At[Et].l+e.tr*.001*e.finalSize}rt==="html"?tn=$.toCSS():rt==="svg"?tn=$.to2dCSS():us=[$.props[0],$.props[1],$.props[2],$.props[3],$.props[4],$.props[5],$.props[6],$.props[7],$.props[8],$.props[9],$.props[10],$.props[11],$.props[12],$.props[13],$.props[14],$.props[15]],Co=Vs}c<=Et?(qr=new LetterProps(Co,Es,po,no,tn,us),this.renderedLetters.push(qr),c+=1,this.lettersChangedFlag=!0):(qr=this.renderedLetters[Et],this.lettersChangedFlag=qr.update(Co,Es,po,no,tn,us)||this.lettersChangedFlag)}}},TextAnimatorProperty.prototype.getValue=function(){this._elem.globalData.frameId!==this._frameId&&(this._frameId=this._elem.globalData.frameId,this.iterateDynamicProperties())},TextAnimatorProperty.prototype.mHelper=new Matrix,TextAnimatorProperty.prototype.defaultPropsArray=[],extendPrototype([DynamicPropertyContainer],TextAnimatorProperty);function ITextElement(){}ITextElement.prototype.initElement=function(e,i,s){this.lettersChangedFlag=!0,this.initFrame(),this.initBaseData(e,i,s),this.textProperty=new TextProperty(this,e.t,this.dynamicProperties),this.textAnimator=new TextAnimatorProperty(e.t,this.renderType,this),this.initTransform(e,i,s),this.initHierarchy(),this.initRenderable(),this.initRendererElement(),this.createContainerElements(),this.createRenderableComponents(),this.createContent(),this.hide(),this.textAnimator.searchProperties(this.dynamicProperties)},ITextElement.prototype.prepareFrame=function(e){this._mdf=!1,this.prepareRenderableFrame(e),this.prepareProperties(e,this.isInRange)},ITextElement.prototype.createPathShape=function(e,i){var s,a=i.length,_,$="";for(s=0;s<a;s+=1)i[s].ty==="sh"&&(_=i[s].ks.k,$+=buildShapeString(_,_.i.length,!0,e));return $},ITextElement.prototype.updateDocumentData=function(e,i){this.textProperty.updateDocumentData(e,i)},ITextElement.prototype.canResizeFont=function(e){this.textProperty.canResizeFont(e)},ITextElement.prototype.setMinimumFontSize=function(e){this.textProperty.setMinimumFontSize(e)},ITextElement.prototype.applyTextPropertiesToMatrix=function(e,i,s,a,_){switch(e.ps&&i.translate(e.ps[0],e.ps[1]+e.ascent,0),i.translate(0,-e.ls,0),e.j){case 1:i.translate(e.justifyOffset+(e.boxWidth-e.lineWidths[s]),0,0);break;case 2:i.translate(e.justifyOffset+(e.boxWidth-e.lineWidths[s])/2,0,0);break}i.translate(a,_,0)},ITextElement.prototype.buildColor=function(e){return"rgb("+Math.round(e[0]*255)+","+Math.round(e[1]*255)+","+Math.round(e[2]*255)+")"},ITextElement.prototype.emptyProp=new LetterProps,ITextElement.prototype.destroy=function(){},ITextElement.prototype.validateText=function(){(this.textProperty._mdf||this.textProperty._isFirstFrame)&&(this.buildNewText(),this.textProperty._isFirstFrame=!1,this.textProperty._mdf=!1)};var emptyShapeData={shapes:[]};function SVGTextLottieElement(e,i,s){this.textSpans=[],this.renderType="svg",this.initElement(e,i,s)}extendPrototype([BaseElement,TransformElement,SVGBaseElement,HierarchyElement,FrameElement,RenderableDOMElement,ITextElement],SVGTextLottieElement),SVGTextLottieElement.prototype.createContent=function(){this.data.singleShape&&!this.globalData.fontManager.chars&&(this.textContainer=createNS("text"))},SVGTextLottieElement.prototype.buildTextContents=function(e){for(var i=0,s=e.length,a=[],_="";i<s;)e[i]==="\r"||e[i]===""?(a.push(_),_=""):_+=e[i],i+=1;return a.push(_),a},SVGTextLottieElement.prototype.buildShapeData=function(e,i){if(e.shapes&&e.shapes.length){var s=e.shapes[0];if(s.it){var a=s.it[s.it.length-1];a.s&&(a.s.k[0]=i,a.s.k[1]=i)}}return e},SVGTextLottieElement.prototype.buildNewText=function(){this.addDynamicProperty(this);var e,i,s=this.textProperty.currentData;this.renderedLetters=createSizedArray(s?s.l.length:0),s.fc?this.layerElement.setAttribute("fill",this.buildColor(s.fc)):this.layerElement.setAttribute("fill","rgba(0,0,0,0)"),s.sc&&(this.layerElement.setAttribute("stroke",this.buildColor(s.sc)),this.layerElement.setAttribute("stroke-width",s.sw)),this.layerElement.setAttribute("font-size",s.finalSize);var a=this.globalData.fontManager.getFontByName(s.f);if(a.fClass)this.layerElement.setAttribute("class",a.fClass);else{this.layerElement.setAttribute("font-family",a.fFamily);var _=s.fWeight,$=s.fStyle;this.layerElement.setAttribute("font-style",$),this.layerElement.setAttribute("font-weight",_)}this.layerElement.setAttribute("aria-label",s.t);var rt=s.l||[],c=!!this.globalData.fontManager.chars;i=rt.length;var dt,ht=this.mHelper,Et="",St=this.data.singleShape,At=0,Pt=0,Vt=!0,Bt=s.tr*.001*s.finalSize;if(St&&!c&&!s.sz){var Zt=this.textContainer,zt="start";switch(s.j){case 1:zt="end";break;case 2:zt="middle";break;default:zt="start";break}Zt.setAttribute("text-anchor",zt),Zt.setAttribute("letter-spacing",Bt);var Ut=this.buildTextContents(s.finalText);for(i=Ut.length,Pt=s.ps?s.ps[1]+s.ascent:0,e=0;e<i;e+=1)dt=this.textSpans[e].span||createNS("tspan"),dt.textContent=Ut[e],dt.setAttribute("x",0),dt.setAttribute("y",Pt),dt.style.display="inherit",Zt.appendChild(dt),this.textSpans[e]||(this.textSpans[e]={span:null,glyph:null}),this.textSpans[e].span=dt,Pt+=s.finalLineHeight;this.layerElement.appendChild(Zt)}else{var Nt=this.textSpans.length,Gt;for(e=0;e<i;e+=1){if(this.textSpans[e]||(this.textSpans[e]={span:null,childSpan:null,glyph:null}),!c||!St||e===0){if(dt=Nt>e?this.textSpans[e].span:createNS(c?"g":"text"),Nt<=e){if(dt.setAttribute("stroke-linecap","butt"),dt.setAttribute("stroke-linejoin","round"),dt.setAttribute("stroke-miterlimit","4"),this.textSpans[e].span=dt,c){var er=createNS("g");dt.appendChild(er),this.textSpans[e].childSpan=er}this.textSpans[e].span=dt,this.layerElement.appendChild(dt)}dt.style.display="inherit"}if(ht.reset(),St&&(rt[e].n&&(At=-Bt,Pt+=s.yOffset,Pt+=Vt?1:0,Vt=!1),this.applyTextPropertiesToMatrix(s,ht,rt[e].line,At,Pt),At+=rt[e].l||0,At+=Bt),c){Gt=this.globalData.fontManager.getCharData(s.finalText[e],a.fStyle,this.globalData.fontManager.getFontByName(s.f).fFamily);var ir;if(Gt.t===1)ir=new SVGCompElement(Gt.data,this.globalData,this);else{var or=emptyShapeData;Gt.data&&Gt.data.shapes&&(or=this.buildShapeData(Gt.data,s.finalSize)),ir=new SVGShapeElement(or,this.globalData,this)}if(this.textSpans[e].glyph){var mr=this.textSpans[e].glyph;this.textSpans[e].childSpan.removeChild(mr.layerElement),mr.destroy()}this.textSpans[e].glyph=ir,ir._debug=!0,ir.prepareFrame(0),ir.renderFrame(),this.textSpans[e].childSpan.appendChild(ir.layerElement),Gt.t===1&&this.textSpans[e].childSpan.setAttribute("transform","scale("+s.finalSize/100+","+s.finalSize/100+")")}else St&&dt.setAttribute("transform","translate("+ht.props[12]+","+ht.props[13]+")"),dt.textContent=rt[e].val,dt.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve")}St&&dt&&dt.setAttribute("d",Et)}for(;e<this.textSpans.length;)this.textSpans[e].span.style.display="none",e+=1;this._sizeChanged=!0},SVGTextLottieElement.prototype.sourceRectAtTime=function(){if(this.prepareFrame(this.comp.renderedFrame-this.data.st),this.renderInnerContent(),this._sizeChanged){this._sizeChanged=!1;var e=this.layerElement.getBBox();this.bbox={top:e.y,left:e.x,width:e.width,height:e.height}}return this.bbox},SVGTextLottieElement.prototype.getValue=function(){var e,i=this.textSpans.length,s;for(this.renderedFrame=this.comp.renderedFrame,e=0;e<i;e+=1)s=this.textSpans[e].glyph,s&&(s.prepareFrame(this.comp.renderedFrame-this.data.st),s._mdf&&(this._mdf=!0))},SVGTextLottieElement.prototype.renderInnerContent=function(){if(this.validateText(),(!this.data.singleShape||this._mdf)&&(this.textAnimator.getMeasures(this.textProperty.currentData,this.lettersChangedFlag),this.lettersChangedFlag||this.textAnimator.lettersChangedFlag)){this._sizeChanged=!0;var e,i,s=this.textAnimator.renderedLetters,a=this.textProperty.currentData.l;i=a.length;var _,$,rt;for(e=0;e<i;e+=1)a[e].n||(_=s[e],$=this.textSpans[e].span,rt=this.textSpans[e].glyph,rt&&rt.renderFrame(),_._mdf.m&&$.setAttribute("transform",_.m),_._mdf.o&&$.setAttribute("opacity",_.o),_._mdf.sw&&$.setAttribute("stroke-width",_.sw),_._mdf.sc&&$.setAttribute("stroke",_.sc),_._mdf.fc&&$.setAttribute("fill",_.fc))}};function ISolidElement(e,i,s){this.initElement(e,i,s)}extendPrototype([IImageElement],ISolidElement),ISolidElement.prototype.createContent=function(){var e=createNS("rect");e.setAttribute("width",this.data.sw),e.setAttribute("height",this.data.sh),e.setAttribute("fill",this.data.sc),this.layerElement.appendChild(e)};function NullElement(e,i,s){this.initFrame(),this.initBaseData(e,i,s),this.initFrame(),this.initTransform(e,i,s),this.initHierarchy()}NullElement.prototype.prepareFrame=function(e){this.prepareProperties(e,!0)},NullElement.prototype.renderFrame=function(){},NullElement.prototype.getBaseElement=function(){return null},NullElement.prototype.destroy=function(){},NullElement.prototype.sourceRectAtTime=function(){},NullElement.prototype.hide=function(){},extendPrototype([BaseElement,TransformElement,HierarchyElement,FrameElement],NullElement);function SVGRendererBase(){}extendPrototype([BaseRenderer],SVGRendererBase),SVGRendererBase.prototype.createNull=function(e){return new NullElement(e,this.globalData,this)},SVGRendererBase.prototype.createShape=function(e){return new SVGShapeElement(e,this.globalData,this)},SVGRendererBase.prototype.createText=function(e){return new SVGTextLottieElement(e,this.globalData,this)},SVGRendererBase.prototype.createImage=function(e){return new IImageElement(e,this.globalData,this)},SVGRendererBase.prototype.createSolid=function(e){return new ISolidElement(e,this.globalData,this)},SVGRendererBase.prototype.configAnimation=function(e){this.svgElement.setAttribute("xmlns","http://www.w3.org/2000/svg"),this.svgElement.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),this.renderConfig.viewBoxSize?this.svgElement.setAttribute("viewBox",this.renderConfig.viewBoxSize):this.svgElement.setAttribute("viewBox","0 0 "+e.w+" "+e.h),this.renderConfig.viewBoxOnly||(this.svgElement.setAttribute("width",e.w),this.svgElement.setAttribute("height",e.h),this.svgElement.style.width="100%",this.svgElement.style.height="100%",this.svgElement.style.transform="translate3d(0,0,0)",this.svgElement.style.contentVisibility=this.renderConfig.contentVisibility),this.renderConfig.width&&this.svgElement.setAttribute("width",this.renderConfig.width),this.renderConfig.height&&this.svgElement.setAttribute("height",this.renderConfig.height),this.renderConfig.className&&this.svgElement.setAttribute("class",this.renderConfig.className),this.renderConfig.id&&this.svgElement.setAttribute("id",this.renderConfig.id),this.renderConfig.focusable!==void 0&&this.svgElement.setAttribute("focusable",this.renderConfig.focusable),this.svgElement.setAttribute("preserveAspectRatio",this.renderConfig.preserveAspectRatio),this.animationItem.wrapper.appendChild(this.svgElement);var i=this.globalData.defs;this.setupGlobalData(e,i),this.globalData.progressiveLoad=this.renderConfig.progressiveLoad,this.data=e;var s=createNS("clipPath"),a=createNS("rect");a.setAttribute("width",e.w),a.setAttribute("height",e.h),a.setAttribute("x",0),a.setAttribute("y",0);var _=createElementID();s.setAttribute("id",_),s.appendChild(a),this.layerElement.setAttribute("clip-path","url("+getLocationHref()+"#"+_+")"),i.appendChild(s),this.layers=e.layers,this.elements=createSizedArray(e.layers.length)},SVGRendererBase.prototype.destroy=function(){this.animationItem.wrapper&&(this.animationItem.wrapper.innerText=""),this.layerElement=null,this.globalData.defs=null;var e,i=this.layers?this.layers.length:0;for(e=0;e<i;e+=1)this.elements[e]&&this.elements[e].destroy&&this.elements[e].destroy();this.elements.length=0,this.destroyed=!0,this.animationItem=null},SVGRendererBase.prototype.updateContainerSize=function(){},SVGRendererBase.prototype.findIndexByInd=function(e){var i=0,s=this.layers.length;for(i=0;i<s;i+=1)if(this.layers[i].ind===e)return i;return-1},SVGRendererBase.prototype.buildItem=function(e){var i=this.elements;if(!(i[e]||this.layers[e].ty===99)){i[e]=!0;var s=this.createItem(this.layers[e]);if(i[e]=s,getExpressionsPlugin()&&(this.layers[e].ty===0&&this.globalData.projectInterface.registerComposition(s),s.initExpressions()),this.appendElementInPos(s,e),this.layers[e].tt){var a="tp"in this.layers[e]?this.findIndexByInd(this.layers[e].tp):e-1;if(a===-1)return;if(!this.elements[a]||this.elements[a]===!0)this.buildItem(a),this.addPendingElement(s);else{var _=i[a],$=_.getMatte(this.layers[e].tt);s.setMatte($)}}}},SVGRendererBase.prototype.checkPendingElements=function(){for(;this.pendingElements.length;){var e=this.pendingElements.pop();if(e.checkParenting(),e.data.tt)for(var i=0,s=this.elements.length;i<s;){if(this.elements[i]===e){var a="tp"in e.data?this.findIndexByInd(e.data.tp):i-1,_=this.elements[a],$=_.getMatte(this.layers[i].tt);e.setMatte($);break}i+=1}}},SVGRendererBase.prototype.renderFrame=function(e){if(!(this.renderedFrame===e||this.destroyed)){e===null?e=this.renderedFrame:this.renderedFrame=e,this.globalData.frameNum=e,this.globalData.frameId+=1,this.globalData.projectInterface.currentFrame=e,this.globalData._mdf=!1;var i,s=this.layers.length;for(this.completeLayers||this.checkLayers(e),i=s-1;i>=0;i-=1)(this.completeLayers||this.elements[i])&&this.elements[i].prepareFrame(e-this.layers[i].st);if(this.globalData._mdf)for(i=0;i<s;i+=1)(this.completeLayers||this.elements[i])&&this.elements[i].renderFrame()}},SVGRendererBase.prototype.appendElementInPos=function(e,i){var s=e.getBaseElement();if(s){for(var a=0,_;a<i;)this.elements[a]&&this.elements[a]!==!0&&this.elements[a].getBaseElement()&&(_=this.elements[a].getBaseElement()),a+=1;_?this.layerElement.insertBefore(s,_):this.layerElement.appendChild(s)}},SVGRendererBase.prototype.hide=function(){this.layerElement.style.display="none"},SVGRendererBase.prototype.show=function(){this.layerElement.style.display="block"};function ICompElement(){}extendPrototype([BaseElement,TransformElement,HierarchyElement,FrameElement,RenderableDOMElement],ICompElement),ICompElement.prototype.initElement=function(e,i,s){this.initFrame(),this.initBaseData(e,i,s),this.initTransform(e,i,s),this.initRenderable(),this.initHierarchy(),this.initRendererElement(),this.createContainerElements(),this.createRenderableComponents(),(this.data.xt||!i.progressiveLoad)&&this.buildAllItems(),this.hide()},ICompElement.prototype.prepareFrame=function(e){if(this._mdf=!1,this.prepareRenderableFrame(e),this.prepareProperties(e,this.isInRange),!(!this.isInRange&&!this.data.xt)){if(this.tm._placeholder)this.renderedFrame=e/this.data.sr;else{var i=this.tm.v;i===this.data.op&&(i=this.data.op-1),this.renderedFrame=i}var s,a=this.elements.length;for(this.completeLayers||this.checkLayers(this.renderedFrame),s=a-1;s>=0;s-=1)(this.completeLayers||this.elements[s])&&(this.elements[s].prepareFrame(this.renderedFrame-this.layers[s].st),this.elements[s]._mdf&&(this._mdf=!0))}},ICompElement.prototype.renderInnerContent=function(){var e,i=this.layers.length;for(e=0;e<i;e+=1)(this.completeLayers||this.elements[e])&&this.elements[e].renderFrame()},ICompElement.prototype.setElements=function(e){this.elements=e},ICompElement.prototype.getElements=function(){return this.elements},ICompElement.prototype.destroyElements=function(){var e,i=this.layers.length;for(e=0;e<i;e+=1)this.elements[e]&&this.elements[e].destroy()},ICompElement.prototype.destroy=function(){this.destroyElements(),this.destroyBaseElement()};function SVGCompElement(e,i,s){this.layers=e.layers,this.supports3d=!0,this.completeLayers=!1,this.pendingElements=[],this.elements=this.layers?createSizedArray(this.layers.length):[],this.initElement(e,i,s),this.tm=e.tm?PropertyFactory.getProp(this,e.tm,0,i.frameRate,this):{_placeholder:!0}}extendPrototype([SVGRendererBase,ICompElement,SVGBaseElement],SVGCompElement),SVGCompElement.prototype.createComp=function(e){return new SVGCompElement(e,this.globalData,this)};function SVGRenderer(e,i){this.animationItem=e,this.layers=null,this.renderedFrame=-1,this.svgElement=createNS("svg");var s="";if(i&&i.title){var a=createNS("title"),_=createElementID();a.setAttribute("id",_),a.textContent=i.title,this.svgElement.appendChild(a),s+=_}if(i&&i.description){var $=createNS("desc"),rt=createElementID();$.setAttribute("id",rt),$.textContent=i.description,this.svgElement.appendChild($),s+=" "+rt}s&&this.svgElement.setAttribute("aria-labelledby",s);var c=createNS("defs");this.svgElement.appendChild(c);var dt=createNS("g");this.svgElement.appendChild(dt),this.layerElement=dt,this.renderConfig={preserveAspectRatio:i&&i.preserveAspectRatio||"xMidYMid meet",imagePreserveAspectRatio:i&&i.imagePreserveAspectRatio||"xMidYMid slice",contentVisibility:i&&i.contentVisibility||"visible",progressiveLoad:i&&i.progressiveLoad||!1,hideOnTransparent:!(i&&i.hideOnTransparent===!1),viewBoxOnly:i&&i.viewBoxOnly||!1,viewBoxSize:i&&i.viewBoxSize||!1,className:i&&i.className||"",id:i&&i.id||"",focusable:i&&i.focusable,filterSize:{width:i&&i.filterSize&&i.filterSize.width||"100%",height:i&&i.filterSize&&i.filterSize.height||"100%",x:i&&i.filterSize&&i.filterSize.x||"0%",y:i&&i.filterSize&&i.filterSize.y||"0%"},width:i&&i.width,height:i&&i.height,runExpressions:!i||i.runExpressions===void 0||i.runExpressions},this.globalData={_mdf:!1,frameNum:-1,defs:c,renderConfig:this.renderConfig},this.elements=[],this.pendingElements=[],this.destroyed=!1,this.rendererType="svg"}extendPrototype([SVGRendererBase],SVGRenderer),SVGRenderer.prototype.createComp=function(e){return new SVGCompElement(e,this.globalData,this)};function ShapeTransformManager(){this.sequences={},this.sequenceList=[],this.transform_key_count=0}ShapeTransformManager.prototype={addTransformSequence:function(i){var s,a=i.length,_="_";for(s=0;s<a;s+=1)_+=i[s].transform.key+"_";var $=this.sequences[_];return $||($={transforms:[].concat(i),finalTransform:new Matrix,_mdf:!1},this.sequences[_]=$,this.sequenceList.push($)),$},processSequence:function(i,s){for(var a=0,_=i.transforms.length,$=s;a<_&&!s;){if(i.transforms[a].transform.mProps._mdf){$=!0;break}a+=1}if($)for(i.finalTransform.reset(),a=_-1;a>=0;a-=1)i.finalTransform.multiply(i.transforms[a].transform.mProps.v);i._mdf=$},processSequences:function(i){var s,a=this.sequenceList.length;for(s=0;s<a;s+=1)this.processSequence(this.sequenceList[s],i)},getNewKey:function(){return this.transform_key_count+=1,"_"+this.transform_key_count}};var lumaLoader=function(){var i="__lottie_element_luma_buffer",s=null,a=null,_=null;function $(){var dt=createNS("svg"),ht=createNS("filter"),Et=createNS("feColorMatrix");return ht.setAttribute("id",i),Et.setAttribute("type","matrix"),Et.setAttribute("color-interpolation-filters","sRGB"),Et.setAttribute("values","0.3, 0.3, 0.3, 0, 0, 0.3, 0.3, 0.3, 0, 0, 0.3, 0.3, 0.3, 0, 0, 0.3, 0.3, 0.3, 0, 0"),ht.appendChild(Et),dt.appendChild(ht),dt.setAttribute("id",i+"_svg"),featureSupport.svgLumaHidden&&(dt.style.display="none"),dt}function rt(){s||(_=$(),document.body.appendChild(_),s=createTag("canvas"),a=s.getContext("2d"),a.filter="url(#"+i+")",a.fillStyle="rgba(0,0,0,0)",a.fillRect(0,0,1,1))}function c(dt){return s||rt(),s.width=dt.width,s.height=dt.height,a.filter="url(#"+i+")",s}return{load:rt,get:c}};function createCanvas(e,i){if(featureSupport.offscreenCanvas)return new OffscreenCanvas(e,i);var s=createTag("canvas");return s.width=e,s.height=i,s}var assetLoader=function(){return{loadLumaCanvas:lumaLoader.load,getLumaCanvas:lumaLoader.get,createCanvas}}(),registeredEffects={};function CVEffects(e){var i,s=e.data.ef?e.data.ef.length:0;this.filters=[];var a;for(i=0;i<s;i+=1){a=null;var _=e.data.ef[i].ty;if(registeredEffects[_]){var $=registeredEffects[_].effect;a=new $(e.effectsManager.effectElements[i],e)}a&&this.filters.push(a)}this.filters.length&&e.addRenderableComponent(this)}CVEffects.prototype.renderFrame=function(e){var i,s=this.filters.length;for(i=0;i<s;i+=1)this.filters[i].renderFrame(e)},CVEffects.prototype.getEffects=function(e){var i,s=this.filters.length,a=[];for(i=0;i<s;i+=1)this.filters[i].type===e&&a.push(this.filters[i]);return a};function registerEffect(e,i){registeredEffects[e]={effect:i}}function CVMaskElement(e,i){this.data=e,this.element=i,this.masksProperties=this.data.masksProperties||[],this.viewData=createSizedArray(this.masksProperties.length);var s,a=this.masksProperties.length,_=!1;for(s=0;s<a;s+=1)this.masksProperties[s].mode!=="n"&&(_=!0),this.viewData[s]=ShapePropertyFactory.getShapeProp(this.element,this.masksProperties[s],3);this.hasMasks=_,_&&this.element.addRenderableComponent(this)}CVMaskElement.prototype.renderFrame=function(){if(this.hasMasks){var e=this.element.finalTransform.mat,i=this.element.canvasContext,s,a=this.masksProperties.length,_,$,rt;for(i.beginPath(),s=0;s<a;s+=1)if(this.masksProperties[s].mode!=="n"){this.masksProperties[s].inv&&(i.moveTo(0,0),i.lineTo(this.element.globalData.compSize.w,0),i.lineTo(this.element.globalData.compSize.w,this.element.globalData.compSize.h),i.lineTo(0,this.element.globalData.compSize.h),i.lineTo(0,0)),rt=this.viewData[s].v,_=e.applyToPointArray(rt.v[0][0],rt.v[0][1],0),i.moveTo(_[0],_[1]);var c,dt=rt._length;for(c=1;c<dt;c+=1)$=e.applyToTriplePoints(rt.o[c-1],rt.i[c],rt.v[c]),i.bezierCurveTo($[0],$[1],$[2],$[3],$[4],$[5]);$=e.applyToTriplePoints(rt.o[c-1],rt.i[0],rt.v[0]),i.bezierCurveTo($[0],$[1],$[2],$[3],$[4],$[5])}this.element.globalData.renderer.save(!0),i.clip()}},CVMaskElement.prototype.getMaskProperty=MaskElement.prototype.getMaskProperty,CVMaskElement.prototype.destroy=function(){this.element=null};function CVBaseElement(){}var operationsMap={1:"source-in",2:"source-out",3:"source-in",4:"source-out"};CVBaseElement.prototype={createElements:function(){},initRendererElement:function(){},createContainerElements:function(){if(this.data.tt>=1){this.buffers=[];var i=this.globalData.canvasContext,s=assetLoader.createCanvas(i.canvas.width,i.canvas.height);this.buffers.push(s);var a=assetLoader.createCanvas(i.canvas.width,i.canvas.height);this.buffers.push(a),this.data.tt>=3&&!document._isProxy&&assetLoader.loadLumaCanvas()}this.canvasContext=this.globalData.canvasContext,this.transformCanvas=this.globalData.transformCanvas,this.renderableEffectsManager=new CVEffects(this),this.searchEffectTransforms()},createContent:function(){},setBlendMode:function(){var i=this.globalData;if(i.blendMode!==this.data.bm){i.blendMode=this.data.bm;var s=getBlendMode(this.data.bm);i.canvasContext.globalCompositeOperation=s}},createRenderableComponents:function(){this.maskManager=new CVMaskElement(this.data,this),this.transformEffects=this.renderableEffectsManager.getEffects(effectTypes.TRANSFORM_EFFECT)},hideElement:function(){!this.hidden&&(!this.isInRange||this.isTransparent)&&(this.hidden=!0)},showElement:function(){this.isInRange&&!this.isTransparent&&(this.hidden=!1,this._isFirstFrame=!0,this.maskManager._isFirstFrame=!0)},clearCanvas:function(i){i.clearRect(this.transformCanvas.tx,this.transformCanvas.ty,this.transformCanvas.w*this.transformCanvas.sx,this.transformCanvas.h*this.transformCanvas.sy)},prepareLayer:function(){if(this.data.tt>=1){var i=this.buffers[0],s=i.getContext("2d");this.clearCanvas(s),s.drawImage(this.canvasContext.canvas,0,0),this.currentTransform=this.canvasContext.getTransform(),this.canvasContext.setTransform(1,0,0,1,0,0),this.clearCanvas(this.canvasContext),this.canvasContext.setTransform(this.currentTransform)}},exitLayer:function(){if(this.data.tt>=1){var i=this.buffers[1],s=i.getContext("2d");this.clearCanvas(s),s.drawImage(this.canvasContext.canvas,0,0),this.canvasContext.setTransform(1,0,0,1,0,0),this.clearCanvas(this.canvasContext),this.canvasContext.setTransform(this.currentTransform);var a=this.comp.getElementById("tp"in this.data?this.data.tp:this.data.ind-1);if(a.renderFrame(!0),this.canvasContext.setTransform(1,0,0,1,0,0),this.data.tt>=3&&!document._isProxy){var _=assetLoader.getLumaCanvas(this.canvasContext.canvas),$=_.getContext("2d");$.drawImage(this.canvasContext.canvas,0,0),this.clearCanvas(this.canvasContext),this.canvasContext.drawImage(_,0,0)}this.canvasContext.globalCompositeOperation=operationsMap[this.data.tt],this.canvasContext.drawImage(i,0,0),this.canvasContext.globalCompositeOperation="destination-over",this.canvasContext.drawImage(this.buffers[0],0,0),this.canvasContext.setTransform(this.currentTransform),this.canvasContext.globalCompositeOperation="source-over"}},renderFrame:function(i){if(!(this.hidden||this.data.hd)&&!(this.data.td===1&&!i)){this.renderTransform(),this.renderRenderable(),this.renderLocalTransform(),this.setBlendMode();var s=this.data.ty===0;this.prepareLayer(),this.globalData.renderer.save(s),this.globalData.renderer.ctxTransform(this.finalTransform.localMat.props),this.globalData.renderer.ctxOpacity(this.finalTransform.localOpacity),this.renderInnerContent(),this.globalData.renderer.restore(s),this.exitLayer(),this.maskManager.hasMasks&&this.globalData.renderer.restore(!0),this._isFirstFrame&&(this._isFirstFrame=!1)}},destroy:function(){this.canvasContext=null,this.data=null,this.globalData=null,this.maskManager.destroy()},mHelper:new Matrix},CVBaseElement.prototype.hide=CVBaseElement.prototype.hideElement,CVBaseElement.prototype.show=CVBaseElement.prototype.showElement;function CVShapeData(e,i,s,a){this.styledShapes=[],this.tr=[0,0,0,0,0,0];var _=4;i.ty==="rc"?_=5:i.ty==="el"?_=6:i.ty==="sr"&&(_=7),this.sh=ShapePropertyFactory.getShapeProp(e,i,_,e);var $,rt=s.length,c;for($=0;$<rt;$+=1)s[$].closed||(c={transforms:a.addTransformSequence(s[$].transforms),trNodes:[]},this.styledShapes.push(c),s[$].elements.push(c))}CVShapeData.prototype.setAsAnimated=SVGShapeData.prototype.setAsAnimated;function CVShapeElement(e,i,s){this.shapes=[],this.shapesData=e.shapes,this.stylesList=[],this.itemsData=[],this.prevViewData=[],this.shapeModifiers=[],this.processedElements=[],this.transformsManager=new ShapeTransformManager,this.initElement(e,i,s)}extendPrototype([BaseElement,TransformElement,CVBaseElement,IShapeElement,HierarchyElement,FrameElement,RenderableElement],CVShapeElement),CVShapeElement.prototype.initElement=RenderableDOMElement.prototype.initElement,CVShapeElement.prototype.transformHelper={opacity:1,_opMdf:!1},CVShapeElement.prototype.dashResetter=[],CVShapeElement.prototype.createContent=function(){this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,!0,[])},CVShapeElement.prototype.createStyleElement=function(e,i){var s={data:e,type:e.ty,preTransforms:this.transformsManager.addTransformSequence(i),transforms:[],elements:[],closed:e.hd===!0},a={};if(e.ty==="fl"||e.ty==="st"?(a.c=PropertyFactory.getProp(this,e.c,1,255,this),a.c.k||(s.co="rgb("+bmFloor(a.c.v[0])+","+bmFloor(a.c.v[1])+","+bmFloor(a.c.v[2])+")")):(e.ty==="gf"||e.ty==="gs")&&(a.s=PropertyFactory.getProp(this,e.s,1,null,this),a.e=PropertyFactory.getProp(this,e.e,1,null,this),a.h=PropertyFactory.getProp(this,e.h||{k:0},0,.01,this),a.a=PropertyFactory.getProp(this,e.a||{k:0},0,degToRads,this),a.g=new GradientProperty(this,e.g,this)),a.o=PropertyFactory.getProp(this,e.o,0,.01,this),e.ty==="st"||e.ty==="gs"){if(s.lc=lineCapEnum[e.lc||2],s.lj=lineJoinEnum[e.lj||2],e.lj==1&&(s.ml=e.ml),a.w=PropertyFactory.getProp(this,e.w,0,null,this),a.w.k||(s.wi=a.w.v),e.d){var _=new DashProperty(this,e.d,"canvas",this);a.d=_,a.d.k||(s.da=a.d.dashArray,s.do=a.d.dashoffset[0])}}else s.r=e.r===2?"evenodd":"nonzero";return this.stylesList.push(s),a.style=s,a},CVShapeElement.prototype.createGroupElement=function(){var e={it:[],prevViewData:[]};return e},CVShapeElement.prototype.createTransformElement=function(e){var i={transform:{opacity:1,_opMdf:!1,key:this.transformsManager.getNewKey(),op:PropertyFactory.getProp(this,e.o,0,.01,this),mProps:TransformPropertyFactory.getTransformProperty(this,e,this)}};return i},CVShapeElement.prototype.createShapeElement=function(e){var i=new CVShapeData(this,e,this.stylesList,this.transformsManager);return this.shapes.push(i),this.addShapeToModifiers(i),i},CVShapeElement.prototype.reloadShapes=function(){this._isFirstFrame=!0;var e,i=this.itemsData.length;for(e=0;e<i;e+=1)this.prevViewData[e]=this.itemsData[e];for(this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,!0,[]),i=this.dynamicProperties.length,e=0;e<i;e+=1)this.dynamicProperties[e].getValue();this.renderModifiers(),this.transformsManager.processSequences(this._isFirstFrame)},CVShapeElement.prototype.addTransformToStyleList=function(e){var i,s=this.stylesList.length;for(i=0;i<s;i+=1)this.stylesList[i].closed||this.stylesList[i].transforms.push(e)},CVShapeElement.prototype.removeTransformFromStyleList=function(){var e,i=this.stylesList.length;for(e=0;e<i;e+=1)this.stylesList[e].closed||this.stylesList[e].transforms.pop()},CVShapeElement.prototype.closeStyles=function(e){var i,s=e.length;for(i=0;i<s;i+=1)e[i].closed=!0},CVShapeElement.prototype.searchShapes=function(e,i,s,a,_){var $,rt=e.length-1,c,dt,ht=[],Et=[],St,At,Pt,Vt=[].concat(_);for($=rt;$>=0;$-=1){if(St=this.searchProcessedElement(e[$]),St?i[$]=s[St-1]:e[$]._shouldRender=a,e[$].ty==="fl"||e[$].ty==="st"||e[$].ty==="gf"||e[$].ty==="gs")St?i[$].style.closed=!1:i[$]=this.createStyleElement(e[$],Vt),ht.push(i[$].style);else if(e[$].ty==="gr"){if(!St)i[$]=this.createGroupElement(e[$]);else for(dt=i[$].it.length,c=0;c<dt;c+=1)i[$].prevViewData[c]=i[$].it[c];this.searchShapes(e[$].it,i[$].it,i[$].prevViewData,a,Vt)}else e[$].ty==="tr"?(St||(Pt=this.createTransformElement(e[$]),i[$]=Pt),Vt.push(i[$]),this.addTransformToStyleList(i[$])):e[$].ty==="sh"||e[$].ty==="rc"||e[$].ty==="el"||e[$].ty==="sr"?St||(i[$]=this.createShapeElement(e[$])):e[$].ty==="tm"||e[$].ty==="rd"||e[$].ty==="pb"||e[$].ty==="zz"||e[$].ty==="op"?(St?(At=i[$],At.closed=!1):(At=ShapeModifiers.getModifier(e[$].ty),At.init(this,e[$]),i[$]=At,this.shapeModifiers.push(At)),Et.push(At)):e[$].ty==="rp"&&(St?(At=i[$],At.closed=!0):(At=ShapeModifiers.getModifier(e[$].ty),i[$]=At,At.init(this,e,$,i),this.shapeModifiers.push(At),a=!1),Et.push(At));this.addProcessedElement(e[$],$+1)}for(this.removeTransformFromStyleList(),this.closeStyles(ht),rt=Et.length,$=0;$<rt;$+=1)Et[$].closed=!0},CVShapeElement.prototype.renderInnerContent=function(){this.transformHelper.opacity=1,this.transformHelper._opMdf=!1,this.renderModifiers(),this.transformsManager.processSequences(this._isFirstFrame),this.renderShape(this.transformHelper,this.shapesData,this.itemsData,!0)},CVShapeElement.prototype.renderShapeTransform=function(e,i){(e._opMdf||i.op._mdf||this._isFirstFrame)&&(i.opacity=e.opacity,i.opacity*=i.op.v,i._opMdf=!0)},CVShapeElement.prototype.drawLayer=function(){var e,i=this.stylesList.length,s,a,_,$,rt,c,dt=this.globalData.renderer,ht=this.globalData.canvasContext,Et,St;for(e=0;e<i;e+=1)if(St=this.stylesList[e],Et=St.type,!((Et==="st"||Et==="gs")&&St.wi===0||!St.data._shouldRender||St.coOp===0||this.globalData.currentGlobalAlpha===0)){for(dt.save(),rt=St.elements,Et==="st"||Et==="gs"?(dt.ctxStrokeStyle(Et==="st"?St.co:St.grd),dt.ctxLineWidth(St.wi),dt.ctxLineCap(St.lc),dt.ctxLineJoin(St.lj),dt.ctxMiterLimit(St.ml||0)):dt.ctxFillStyle(Et==="fl"?St.co:St.grd),dt.ctxOpacity(St.coOp),Et!=="st"&&Et!=="gs"&&ht.beginPath(),dt.ctxTransform(St.preTransforms.finalTransform.props),a=rt.length,s=0;s<a;s+=1){for((Et==="st"||Et==="gs")&&(ht.beginPath(),St.da&&(ht.setLineDash(St.da),ht.lineDashOffset=St.do)),c=rt[s].trNodes,$=c.length,_=0;_<$;_+=1)c[_].t==="m"?ht.moveTo(c[_].p[0],c[_].p[1]):c[_].t==="c"?ht.bezierCurveTo(c[_].pts[0],c[_].pts[1],c[_].pts[2],c[_].pts[3],c[_].pts[4],c[_].pts[5]):ht.closePath();(Et==="st"||Et==="gs")&&(dt.ctxStroke(),St.da&&ht.setLineDash(this.dashResetter))}Et!=="st"&&Et!=="gs"&&this.globalData.renderer.ctxFill(St.r),dt.restore()}},CVShapeElement.prototype.renderShape=function(e,i,s,a){var _,$=i.length-1,rt;for(rt=e,_=$;_>=0;_-=1)i[_].ty==="tr"?(rt=s[_].transform,this.renderShapeTransform(e,rt)):i[_].ty==="sh"||i[_].ty==="el"||i[_].ty==="rc"||i[_].ty==="sr"?this.renderPath(i[_],s[_]):i[_].ty==="fl"?this.renderFill(i[_],s[_],rt):i[_].ty==="st"?this.renderStroke(i[_],s[_],rt):i[_].ty==="gf"||i[_].ty==="gs"?this.renderGradientFill(i[_],s[_],rt):i[_].ty==="gr"?this.renderShape(rt,i[_].it,s[_].it):i[_].ty;a&&this.drawLayer()},CVShapeElement.prototype.renderStyledShape=function(e,i){if(this._isFirstFrame||i._mdf||e.transforms._mdf){var s=e.trNodes,a=i.paths,_,$,rt,c=a._length;s.length=0;var dt=e.transforms.finalTransform;for(rt=0;rt<c;rt+=1){var ht=a.shapes[rt];if(ht&&ht.v){for($=ht._length,_=1;_<$;_+=1)_===1&&s.push({t:"m",p:dt.applyToPointArray(ht.v[0][0],ht.v[0][1],0)}),s.push({t:"c",pts:dt.applyToTriplePoints(ht.o[_-1],ht.i[_],ht.v[_])});$===1&&s.push({t:"m",p:dt.applyToPointArray(ht.v[0][0],ht.v[0][1],0)}),ht.c&&$&&(s.push({t:"c",pts:dt.applyToTriplePoints(ht.o[_-1],ht.i[0],ht.v[0])}),s.push({t:"z"}))}}e.trNodes=s}},CVShapeElement.prototype.renderPath=function(e,i){if(e.hd!==!0&&e._shouldRender){var s,a=i.styledShapes.length;for(s=0;s<a;s+=1)this.renderStyledShape(i.styledShapes[s],i.sh)}},CVShapeElement.prototype.renderFill=function(e,i,s){var a=i.style;(i.c._mdf||this._isFirstFrame)&&(a.co="rgb("+bmFloor(i.c.v[0])+","+bmFloor(i.c.v[1])+","+bmFloor(i.c.v[2])+")"),(i.o._mdf||s._opMdf||this._isFirstFrame)&&(a.coOp=i.o.v*s.opacity)},CVShapeElement.prototype.renderGradientFill=function(e,i,s){var a=i.style,_;if(!a.grd||i.g._mdf||i.s._mdf||i.e._mdf||e.t!==1&&(i.h._mdf||i.a._mdf)){var $=this.globalData.canvasContext,rt=i.s.v,c=i.e.v;if(e.t===1)_=$.createLinearGradient(rt[0],rt[1],c[0],c[1]);else{var dt=Math.sqrt(Math.pow(rt[0]-c[0],2)+Math.pow(rt[1]-c[1],2)),ht=Math.atan2(c[1]-rt[1],c[0]-rt[0]),Et=i.h.v;Et>=1?Et=.99:Et<=-1&&(Et=-.99);var St=dt*Et,At=Math.cos(ht+i.a.v)*St+rt[0],Pt=Math.sin(ht+i.a.v)*St+rt[1];_=$.createRadialGradient(At,Pt,0,rt[0],rt[1],dt)}var Vt,Bt=e.g.p,Zt=i.g.c,zt=1;for(Vt=0;Vt<Bt;Vt+=1)i.g._hasOpacity&&i.g._collapsable&&(zt=i.g.o[Vt*2+1]),_.addColorStop(Zt[Vt*4]/100,"rgba("+Zt[Vt*4+1]+","+Zt[Vt*4+2]+","+Zt[Vt*4+3]+","+zt+")");a.grd=_}a.coOp=i.o.v*s.opacity},CVShapeElement.prototype.renderStroke=function(e,i,s){var a=i.style,_=i.d;_&&(_._mdf||this._isFirstFrame)&&(a.da=_.dashArray,a.do=_.dashoffset[0]),(i.c._mdf||this._isFirstFrame)&&(a.co="rgb("+bmFloor(i.c.v[0])+","+bmFloor(i.c.v[1])+","+bmFloor(i.c.v[2])+")"),(i.o._mdf||s._opMdf||this._isFirstFrame)&&(a.coOp=i.o.v*s.opacity),(i.w._mdf||this._isFirstFrame)&&(a.wi=i.w.v)},CVShapeElement.prototype.destroy=function(){this.shapesData=null,this.globalData=null,this.canvasContext=null,this.stylesList.length=0,this.itemsData.length=0};function CVTextElement(e,i,s){this.textSpans=[],this.yOffset=0,this.fillColorAnim=!1,this.strokeColorAnim=!1,this.strokeWidthAnim=!1,this.stroke=!1,this.fill=!1,this.justifyOffset=0,this.currentRender=null,this.renderType="canvas",this.values={fill:"rgba(0,0,0,0)",stroke:"rgba(0,0,0,0)",sWidth:0,fValue:""},this.initElement(e,i,s)}extendPrototype([BaseElement,TransformElement,CVBaseElement,HierarchyElement,FrameElement,RenderableElement,ITextElement],CVTextElement),CVTextElement.prototype.tHelper=createTag("canvas").getContext("2d"),CVTextElement.prototype.buildNewText=function(){var e=this.textProperty.currentData;this.renderedLetters=createSizedArray(e.l?e.l.length:0);var i=!1;e.fc?(i=!0,this.values.fill=this.buildColor(e.fc)):this.values.fill="rgba(0,0,0,0)",this.fill=i;var s=!1;e.sc&&(s=!0,this.values.stroke=this.buildColor(e.sc),this.values.sWidth=e.sw);var a=this.globalData.fontManager.getFontByName(e.f),_,$,rt=e.l,c=this.mHelper;this.stroke=s,this.values.fValue=e.finalSize+"px "+this.globalData.fontManager.getFontByName(e.f).fFamily,$=e.finalText.length;var dt,ht,Et,St,At,Pt,Vt,Bt,Zt,zt,Ut=this.data.singleShape,Nt=e.tr*.001*e.finalSize,Gt=0,er=0,ir=!0,or=0;for(_=0;_<$;_+=1){dt=this.globalData.fontManager.getCharData(e.finalText[_],a.fStyle,this.globalData.fontManager.getFontByName(e.f).fFamily),ht=dt&&dt.data||{},c.reset(),Ut&&rt[_].n&&(Gt=-Nt,er+=e.yOffset,er+=ir?1:0,ir=!1),At=ht.shapes?ht.shapes[0].it:[],Vt=At.length,c.scale(e.finalSize/100,e.finalSize/100),Ut&&this.applyTextPropertiesToMatrix(e,c,rt[_].line,Gt,er),Zt=createSizedArray(Vt-1);var mr=0;for(Pt=0;Pt<Vt;Pt+=1)if(At[Pt].ty==="sh"){for(St=At[Pt].ks.k.i.length,Bt=At[Pt].ks.k,zt=[],Et=1;Et<St;Et+=1)Et===1&&zt.push(c.applyToX(Bt.v[0][0],Bt.v[0][1],0),c.applyToY(Bt.v[0][0],Bt.v[0][1],0)),zt.push(c.applyToX(Bt.o[Et-1][0],Bt.o[Et-1][1],0),c.applyToY(Bt.o[Et-1][0],Bt.o[Et-1][1],0),c.applyToX(Bt.i[Et][0],Bt.i[Et][1],0),c.applyToY(Bt.i[Et][0],Bt.i[Et][1],0),c.applyToX(Bt.v[Et][0],Bt.v[Et][1],0),c.applyToY(Bt.v[Et][0],Bt.v[Et][1],0));zt.push(c.applyToX(Bt.o[Et-1][0],Bt.o[Et-1][1],0),c.applyToY(Bt.o[Et-1][0],Bt.o[Et-1][1],0),c.applyToX(Bt.i[0][0],Bt.i[0][1],0),c.applyToY(Bt.i[0][0],Bt.i[0][1],0),c.applyToX(Bt.v[0][0],Bt.v[0][1],0),c.applyToY(Bt.v[0][0],Bt.v[0][1],0)),Zt[mr]=zt,mr+=1}Ut&&(Gt+=rt[_].l,Gt+=Nt),this.textSpans[or]?this.textSpans[or].elem=Zt:this.textSpans[or]={elem:Zt},or+=1}},CVTextElement.prototype.renderInnerContent=function(){this.validateText();var e=this.canvasContext;e.font=this.values.fValue,this.globalData.renderer.ctxLineCap("butt"),this.globalData.renderer.ctxLineJoin("miter"),this.globalData.renderer.ctxMiterLimit(4),this.data.singleShape||this.textAnimator.getMeasures(this.textProperty.currentData,this.lettersChangedFlag);var i,s,a,_,$,rt,c=this.textAnimator.renderedLetters,dt=this.textProperty.currentData.l;s=dt.length;var ht,Et=null,St=null,At=null,Pt,Vt,Bt=this.globalData.renderer;for(i=0;i<s;i+=1)if(!dt[i].n){if(ht=c[i],ht&&(Bt.save(),Bt.ctxTransform(ht.p),Bt.ctxOpacity(ht.o)),this.fill){for(ht&&ht.fc?Et!==ht.fc&&(Bt.ctxFillStyle(ht.fc),Et=ht.fc):Et!==this.values.fill&&(Et=this.values.fill,Bt.ctxFillStyle(this.values.fill)),Pt=this.textSpans[i].elem,_=Pt.length,this.globalData.canvasContext.beginPath(),a=0;a<_;a+=1)for(Vt=Pt[a],rt=Vt.length,this.globalData.canvasContext.moveTo(Vt[0],Vt[1]),$=2;$<rt;$+=6)this.globalData.canvasContext.bezierCurveTo(Vt[$],Vt[$+1],Vt[$+2],Vt[$+3],Vt[$+4],Vt[$+5]);this.globalData.canvasContext.closePath(),Bt.ctxFill()}if(this.stroke){for(ht&&ht.sw?At!==ht.sw&&(At=ht.sw,Bt.ctxLineWidth(ht.sw)):At!==this.values.sWidth&&(At=this.values.sWidth,Bt.ctxLineWidth(this.values.sWidth)),ht&&ht.sc?St!==ht.sc&&(St=ht.sc,Bt.ctxStrokeStyle(ht.sc)):St!==this.values.stroke&&(St=this.values.stroke,Bt.ctxStrokeStyle(this.values.stroke)),Pt=this.textSpans[i].elem,_=Pt.length,this.globalData.canvasContext.beginPath(),a=0;a<_;a+=1)for(Vt=Pt[a],rt=Vt.length,this.globalData.canvasContext.moveTo(Vt[0],Vt[1]),$=2;$<rt;$+=6)this.globalData.canvasContext.bezierCurveTo(Vt[$],Vt[$+1],Vt[$+2],Vt[$+3],Vt[$+4],Vt[$+5]);this.globalData.canvasContext.closePath(),Bt.ctxStroke()}ht&&this.globalData.renderer.restore()}};function CVImageElement(e,i,s){this.assetData=i.getAssetData(e.refId),this.img=i.imageLoader.getAsset(this.assetData),this.initElement(e,i,s)}extendPrototype([BaseElement,TransformElement,CVBaseElement,HierarchyElement,FrameElement,RenderableElement],CVImageElement),CVImageElement.prototype.initElement=SVGShapeElement.prototype.initElement,CVImageElement.prototype.prepareFrame=IImageElement.prototype.prepareFrame,CVImageElement.prototype.createContent=function(){if(this.img.width&&(this.assetData.w!==this.img.width||this.assetData.h!==this.img.height)){var e=createTag("canvas");e.width=this.assetData.w,e.height=this.assetData.h;var i=e.getContext("2d"),s=this.img.width,a=this.img.height,_=s/a,$=this.assetData.w/this.assetData.h,rt,c,dt=this.assetData.pr||this.globalData.renderConfig.imagePreserveAspectRatio;_>$&&dt==="xMidYMid slice"||_<$&&dt!=="xMidYMid slice"?(c=a,rt=c*$):(rt=s,c=rt/$),i.drawImage(this.img,(s-rt)/2,(a-c)/2,rt,c,0,0,this.assetData.w,this.assetData.h),this.img=e}},CVImageElement.prototype.renderInnerContent=function(){this.canvasContext.drawImage(this.img,0,0)},CVImageElement.prototype.destroy=function(){this.img=null};function CVSolidElement(e,i,s){this.initElement(e,i,s)}extendPrototype([BaseElement,TransformElement,CVBaseElement,HierarchyElement,FrameElement,RenderableElement],CVSolidElement),CVSolidElement.prototype.initElement=SVGShapeElement.prototype.initElement,CVSolidElement.prototype.prepareFrame=IImageElement.prototype.prepareFrame,CVSolidElement.prototype.renderInnerContent=function(){this.globalData.renderer.ctxFillStyle(this.data.sc),this.globalData.renderer.ctxFillRect(0,0,this.data.sw,this.data.sh)};function CanvasRendererBase(){}extendPrototype([BaseRenderer],CanvasRendererBase),CanvasRendererBase.prototype.createShape=function(e){return new CVShapeElement(e,this.globalData,this)},CanvasRendererBase.prototype.createText=function(e){return new CVTextElement(e,this.globalData,this)},CanvasRendererBase.prototype.createImage=function(e){return new CVImageElement(e,this.globalData,this)},CanvasRendererBase.prototype.createSolid=function(e){return new CVSolidElement(e,this.globalData,this)},CanvasRendererBase.prototype.createNull=SVGRenderer.prototype.createNull,CanvasRendererBase.prototype.ctxTransform=function(e){e[0]===1&&e[1]===0&&e[4]===0&&e[5]===1&&e[12]===0&&e[13]===0||this.canvasContext.transform(e[0],e[1],e[4],e[5],e[12],e[13])},CanvasRendererBase.prototype.ctxOpacity=function(e){this.canvasContext.globalAlpha*=e<0?0:e},CanvasRendererBase.prototype.ctxFillStyle=function(e){this.canvasContext.fillStyle=e},CanvasRendererBase.prototype.ctxStrokeStyle=function(e){this.canvasContext.strokeStyle=e},CanvasRendererBase.prototype.ctxLineWidth=function(e){this.canvasContext.lineWidth=e},CanvasRendererBase.prototype.ctxLineCap=function(e){this.canvasContext.lineCap=e},CanvasRendererBase.prototype.ctxLineJoin=function(e){this.canvasContext.lineJoin=e},CanvasRendererBase.prototype.ctxMiterLimit=function(e){this.canvasContext.miterLimit=e},CanvasRendererBase.prototype.ctxFill=function(e){this.canvasContext.fill(e)},CanvasRendererBase.prototype.ctxFillRect=function(e,i,s,a){this.canvasContext.fillRect(e,i,s,a)},CanvasRendererBase.prototype.ctxStroke=function(){this.canvasContext.stroke()},CanvasRendererBase.prototype.reset=function(){if(!this.renderConfig.clearCanvas){this.canvasContext.restore();return}this.contextData.reset()},CanvasRendererBase.prototype.save=function(){this.canvasContext.save()},CanvasRendererBase.prototype.restore=function(e){if(!this.renderConfig.clearCanvas){this.canvasContext.restore();return}e&&(this.globalData.blendMode="source-over"),this.contextData.restore(e)},CanvasRendererBase.prototype.configAnimation=function(e){if(this.animationItem.wrapper){this.animationItem.container=createTag("canvas");var i=this.animationItem.container.style;i.width="100%",i.height="100%";var s="0px 0px 0px";i.transformOrigin=s,i.mozTransformOrigin=s,i.webkitTransformOrigin=s,i["-webkit-transform"]=s,i.contentVisibility=this.renderConfig.contentVisibility,this.animationItem.wrapper.appendChild(this.animationItem.container),this.canvasContext=this.animationItem.container.getContext("2d"),this.renderConfig.className&&this.animationItem.container.setAttribute("class",this.renderConfig.className),this.renderConfig.id&&this.animationItem.container.setAttribute("id",this.renderConfig.id)}else this.canvasContext=this.renderConfig.context;this.contextData.setContext(this.canvasContext),this.data=e,this.layers=e.layers,this.transformCanvas={w:e.w,h:e.h,sx:0,sy:0,tx:0,ty:0},this.setupGlobalData(e,document.body),this.globalData.canvasContext=this.canvasContext,this.globalData.renderer=this,this.globalData.isDashed=!1,this.globalData.progressiveLoad=this.renderConfig.progressiveLoad,this.globalData.transformCanvas=this.transformCanvas,this.elements=createSizedArray(e.layers.length),this.updateContainerSize()},CanvasRendererBase.prototype.updateContainerSize=function(e,i){this.reset();var s,a;e?(s=e,a=i,this.canvasContext.canvas.width=s,this.canvasContext.canvas.height=a):(this.animationItem.wrapper&&this.animationItem.container?(s=this.animationItem.wrapper.offsetWidth,a=this.animationItem.wrapper.offsetHeight):(s=this.canvasContext.canvas.width,a=this.canvasContext.canvas.height),this.canvasContext.canvas.width=s*this.renderConfig.dpr,this.canvasContext.canvas.height=a*this.renderConfig.dpr);var _,$;if(this.renderConfig.preserveAspectRatio.indexOf("meet")!==-1||this.renderConfig.preserveAspectRatio.indexOf("slice")!==-1){var rt=this.renderConfig.preserveAspectRatio.split(" "),c=rt[1]||"meet",dt=rt[0]||"xMidYMid",ht=dt.substr(0,4),Et=dt.substr(4);_=s/a,$=this.transformCanvas.w/this.transformCanvas.h,$>_&&c==="meet"||$<_&&c==="slice"?(this.transformCanvas.sx=s/(this.transformCanvas.w/this.renderConfig.dpr),this.transformCanvas.sy=s/(this.transformCanvas.w/this.renderConfig.dpr)):(this.transformCanvas.sx=a/(this.transformCanvas.h/this.renderConfig.dpr),this.transformCanvas.sy=a/(this.transformCanvas.h/this.renderConfig.dpr)),ht==="xMid"&&($<_&&c==="meet"||$>_&&c==="slice")?this.transformCanvas.tx=(s-this.transformCanvas.w*(a/this.transformCanvas.h))/2*this.renderConfig.dpr:ht==="xMax"&&($<_&&c==="meet"||$>_&&c==="slice")?this.transformCanvas.tx=(s-this.transformCanvas.w*(a/this.transformCanvas.h))*this.renderConfig.dpr:this.transformCanvas.tx=0,Et==="YMid"&&($>_&&c==="meet"||$<_&&c==="slice")?this.transformCanvas.ty=(a-this.transformCanvas.h*(s/this.transformCanvas.w))/2*this.renderConfig.dpr:Et==="YMax"&&($>_&&c==="meet"||$<_&&c==="slice")?this.transformCanvas.ty=(a-this.transformCanvas.h*(s/this.transformCanvas.w))*this.renderConfig.dpr:this.transformCanvas.ty=0}else this.renderConfig.preserveAspectRatio==="none"?(this.transformCanvas.sx=s/(this.transformCanvas.w/this.renderConfig.dpr),this.transformCanvas.sy=a/(this.transformCanvas.h/this.renderConfig.dpr),this.transformCanvas.tx=0,this.transformCanvas.ty=0):(this.transformCanvas.sx=this.renderConfig.dpr,this.transformCanvas.sy=this.renderConfig.dpr,this.transformCanvas.tx=0,this.transformCanvas.ty=0);this.transformCanvas.props=[this.transformCanvas.sx,0,0,0,0,this.transformCanvas.sy,0,0,0,0,1,0,this.transformCanvas.tx,this.transformCanvas.ty,0,1],this.ctxTransform(this.transformCanvas.props),this.canvasContext.beginPath(),this.canvasContext.rect(0,0,this.transformCanvas.w,this.transformCanvas.h),this.canvasContext.closePath(),this.canvasContext.clip(),this.renderFrame(this.renderedFrame,!0)},CanvasRendererBase.prototype.destroy=function(){this.renderConfig.clearCanvas&&this.animationItem.wrapper&&(this.animationItem.wrapper.innerText="");var e,i=this.layers?this.layers.length:0;for(e=i-1;e>=0;e-=1)this.elements[e]&&this.elements[e].destroy&&this.elements[e].destroy();this.elements.length=0,this.globalData.canvasContext=null,this.animationItem.container=null,this.destroyed=!0},CanvasRendererBase.prototype.renderFrame=function(e,i){if(!(this.renderedFrame===e&&this.renderConfig.clearCanvas===!0&&!i||this.destroyed||e===-1)){this.renderedFrame=e,this.globalData.frameNum=e-this.animationItem._isFirstFrame,this.globalData.frameId+=1,this.globalData._mdf=!this.renderConfig.clearCanvas||i,this.globalData.projectInterface.currentFrame=e;var s,a=this.layers.length;for(this.completeLayers||this.checkLayers(e),s=a-1;s>=0;s-=1)(this.completeLayers||this.elements[s])&&this.elements[s].prepareFrame(e-this.layers[s].st);if(this.globalData._mdf){for(this.renderConfig.clearCanvas===!0?this.canvasContext.clearRect(0,0,this.transformCanvas.w,this.transformCanvas.h):this.save(),s=a-1;s>=0;s-=1)(this.completeLayers||this.elements[s])&&this.elements[s].renderFrame();this.renderConfig.clearCanvas!==!0&&this.restore()}}},CanvasRendererBase.prototype.buildItem=function(e){var i=this.elements;if(!(i[e]||this.layers[e].ty===99)){var s=this.createItem(this.layers[e],this,this.globalData);i[e]=s,s.initExpressions()}},CanvasRendererBase.prototype.checkPendingElements=function(){for(;this.pendingElements.length;){var e=this.pendingElements.pop();e.checkParenting()}},CanvasRendererBase.prototype.hide=function(){this.animationItem.container.style.display="none"},CanvasRendererBase.prototype.show=function(){this.animationItem.container.style.display="block"};function CanvasContext(){this.opacity=-1,this.transform=createTypedArray("float32",16),this.fillStyle="",this.strokeStyle="",this.lineWidth="",this.lineCap="",this.lineJoin="",this.miterLimit="",this.id=Math.random()}function CVContextData(){this.stack=[],this.cArrPos=0,this.cTr=new Matrix;var e,i=15;for(e=0;e<i;e+=1){var s=new CanvasContext;this.stack[e]=s}this._length=i,this.nativeContext=null,this.transformMat=new Matrix,this.currentOpacity=1,this.currentFillStyle="",this.appliedFillStyle="",this.currentStrokeStyle="",this.appliedStrokeStyle="",this.currentLineWidth="",this.appliedLineWidth="",this.currentLineCap="",this.appliedLineCap="",this.currentLineJoin="",this.appliedLineJoin="",this.appliedMiterLimit="",this.currentMiterLimit=""}CVContextData.prototype.duplicate=function(){var e=this._length*2,i=0;for(i=this._length;i<e;i+=1)this.stack[i]=new CanvasContext;this._length=e},CVContextData.prototype.reset=function(){this.cArrPos=0,this.cTr.reset(),this.stack[this.cArrPos].opacity=1},CVContextData.prototype.restore=function(e){this.cArrPos-=1;var i=this.stack[this.cArrPos],s=i.transform,a,_=this.cTr.props;for(a=0;a<16;a+=1)_[a]=s[a];if(e){this.nativeContext.restore();var $=this.stack[this.cArrPos+1];this.appliedFillStyle=$.fillStyle,this.appliedStrokeStyle=$.strokeStyle,this.appliedLineWidth=$.lineWidth,this.appliedLineCap=$.lineCap,this.appliedLineJoin=$.lineJoin,this.appliedMiterLimit=$.miterLimit}this.nativeContext.setTransform(s[0],s[1],s[4],s[5],s[12],s[13]),(e||i.opacity!==-1&&this.currentOpacity!==i.opacity)&&(this.nativeContext.globalAlpha=i.opacity,this.currentOpacity=i.opacity),this.currentFillStyle=i.fillStyle,this.currentStrokeStyle=i.strokeStyle,this.currentLineWidth=i.lineWidth,this.currentLineCap=i.lineCap,this.currentLineJoin=i.lineJoin,this.currentMiterLimit=i.miterLimit},CVContextData.prototype.save=function(e){e&&this.nativeContext.save();var i=this.cTr.props;this._length<=this.cArrPos&&this.duplicate();var s=this.stack[this.cArrPos],a;for(a=0;a<16;a+=1)s.transform[a]=i[a];this.cArrPos+=1;var _=this.stack[this.cArrPos];_.opacity=s.opacity,_.fillStyle=s.fillStyle,_.strokeStyle=s.strokeStyle,_.lineWidth=s.lineWidth,_.lineCap=s.lineCap,_.lineJoin=s.lineJoin,_.miterLimit=s.miterLimit},CVContextData.prototype.setOpacity=function(e){this.stack[this.cArrPos].opacity=e},CVContextData.prototype.setContext=function(e){this.nativeContext=e},CVContextData.prototype.fillStyle=function(e){this.stack[this.cArrPos].fillStyle!==e&&(this.currentFillStyle=e,this.stack[this.cArrPos].fillStyle=e)},CVContextData.prototype.strokeStyle=function(e){this.stack[this.cArrPos].strokeStyle!==e&&(this.currentStrokeStyle=e,this.stack[this.cArrPos].strokeStyle=e)},CVContextData.prototype.lineWidth=function(e){this.stack[this.cArrPos].lineWidth!==e&&(this.currentLineWidth=e,this.stack[this.cArrPos].lineWidth=e)},CVContextData.prototype.lineCap=function(e){this.stack[this.cArrPos].lineCap!==e&&(this.currentLineCap=e,this.stack[this.cArrPos].lineCap=e)},CVContextData.prototype.lineJoin=function(e){this.stack[this.cArrPos].lineJoin!==e&&(this.currentLineJoin=e,this.stack[this.cArrPos].lineJoin=e)},CVContextData.prototype.miterLimit=function(e){this.stack[this.cArrPos].miterLimit!==e&&(this.currentMiterLimit=e,this.stack[this.cArrPos].miterLimit=e)},CVContextData.prototype.transform=function(e){this.transformMat.cloneFromProps(e);var i=this.cTr;this.transformMat.multiply(i),i.cloneFromProps(this.transformMat.props);var s=i.props;this.nativeContext.setTransform(s[0],s[1],s[4],s[5],s[12],s[13])},CVContextData.prototype.opacity=function(e){var i=this.stack[this.cArrPos].opacity;i*=e<0?0:e,this.stack[this.cArrPos].opacity!==i&&(this.currentOpacity!==e&&(this.nativeContext.globalAlpha=e,this.currentOpacity=e),this.stack[this.cArrPos].opacity=i)},CVContextData.prototype.fill=function(e){this.appliedFillStyle!==this.currentFillStyle&&(this.appliedFillStyle=this.currentFillStyle,this.nativeContext.fillStyle=this.appliedFillStyle),this.nativeContext.fill(e)},CVContextData.prototype.fillRect=function(e,i,s,a){this.appliedFillStyle!==this.currentFillStyle&&(this.appliedFillStyle=this.currentFillStyle,this.nativeContext.fillStyle=this.appliedFillStyle),this.nativeContext.fillRect(e,i,s,a)},CVContextData.prototype.stroke=function(){this.appliedStrokeStyle!==this.currentStrokeStyle&&(this.appliedStrokeStyle=this.currentStrokeStyle,this.nativeContext.strokeStyle=this.appliedStrokeStyle),this.appliedLineWidth!==this.currentLineWidth&&(this.appliedLineWidth=this.currentLineWidth,this.nativeContext.lineWidth=this.appliedLineWidth),this.appliedLineCap!==this.currentLineCap&&(this.appliedLineCap=this.currentLineCap,this.nativeContext.lineCap=this.appliedLineCap),this.appliedLineJoin!==this.currentLineJoin&&(this.appliedLineJoin=this.currentLineJoin,this.nativeContext.lineJoin=this.appliedLineJoin),this.appliedMiterLimit!==this.currentMiterLimit&&(this.appliedMiterLimit=this.currentMiterLimit,this.nativeContext.miterLimit=this.appliedMiterLimit),this.nativeContext.stroke()};function CVCompElement(e,i,s){this.completeLayers=!1,this.layers=e.layers,this.pendingElements=[],this.elements=createSizedArray(this.layers.length),this.initElement(e,i,s),this.tm=e.tm?PropertyFactory.getProp(this,e.tm,0,i.frameRate,this):{_placeholder:!0}}extendPrototype([CanvasRendererBase,ICompElement,CVBaseElement],CVCompElement),CVCompElement.prototype.renderInnerContent=function(){var e=this.canvasContext;e.beginPath(),e.moveTo(0,0),e.lineTo(this.data.w,0),e.lineTo(this.data.w,this.data.h),e.lineTo(0,this.data.h),e.lineTo(0,0),e.clip();var i,s=this.layers.length;for(i=s-1;i>=0;i-=1)(this.completeLayers||this.elements[i])&&this.elements[i].renderFrame()},CVCompElement.prototype.destroy=function(){var e,i=this.layers.length;for(e=i-1;e>=0;e-=1)this.elements[e]&&this.elements[e].destroy();this.layers=null,this.elements=null},CVCompElement.prototype.createComp=function(e){return new CVCompElement(e,this.globalData,this)};function CanvasRenderer(e,i){this.animationItem=e,this.renderConfig={clearCanvas:i&&i.clearCanvas!==void 0?i.clearCanvas:!0,context:i&&i.context||null,progressiveLoad:i&&i.progressiveLoad||!1,preserveAspectRatio:i&&i.preserveAspectRatio||"xMidYMid meet",imagePreserveAspectRatio:i&&i.imagePreserveAspectRatio||"xMidYMid slice",contentVisibility:i&&i.contentVisibility||"visible",className:i&&i.className||"",id:i&&i.id||"",runExpressions:!i||i.runExpressions===void 0||i.runExpressions},this.renderConfig.dpr=i&&i.dpr||1,this.animationItem.wrapper&&(this.renderConfig.dpr=i&&i.dpr||window.devicePixelRatio||1),this.renderedFrame=-1,this.globalData={frameNum:-1,_mdf:!1,renderConfig:this.renderConfig,currentGlobalAlpha:-1},this.contextData=new CVContextData,this.elements=[],this.pendingElements=[],this.transformMat=new Matrix,this.completeLayers=!1,this.rendererType="canvas",this.renderConfig.clearCanvas&&(this.ctxTransform=this.contextData.transform.bind(this.contextData),this.ctxOpacity=this.contextData.opacity.bind(this.contextData),this.ctxFillStyle=this.contextData.fillStyle.bind(this.contextData),this.ctxStrokeStyle=this.contextData.strokeStyle.bind(this.contextData),this.ctxLineWidth=this.contextData.lineWidth.bind(this.contextData),this.ctxLineCap=this.contextData.lineCap.bind(this.contextData),this.ctxLineJoin=this.contextData.lineJoin.bind(this.contextData),this.ctxMiterLimit=this.contextData.miterLimit.bind(this.contextData),this.ctxFill=this.contextData.fill.bind(this.contextData),this.ctxFillRect=this.contextData.fillRect.bind(this.contextData),this.ctxStroke=this.contextData.stroke.bind(this.contextData),this.save=this.contextData.save.bind(this.contextData))}extendPrototype([CanvasRendererBase],CanvasRenderer),CanvasRenderer.prototype.createComp=function(e){return new CVCompElement(e,this.globalData,this)};function HBaseElement(){}HBaseElement.prototype={checkBlendMode:function(){},initRendererElement:function(){this.baseElement=createTag(this.data.tg||"div"),this.data.hasMask?(this.svgElement=createNS("svg"),this.layerElement=createNS("g"),this.maskedElement=this.layerElement,this.svgElement.appendChild(this.layerElement),this.baseElement.appendChild(this.svgElement)):this.layerElement=this.baseElement,styleDiv(this.baseElement)},createContainerElements:function(){this.renderableEffectsManager=new CVEffects(this),this.transformedElement=this.baseElement,this.maskedElement=this.layerElement,this.data.ln&&this.layerElement.setAttribute("id",this.data.ln),this.data.cl&&this.layerElement.setAttribute("class",this.data.cl),this.data.bm!==0&&this.setBlendMode()},renderElement:function(){var i=this.transformedElement?this.transformedElement.style:{};if(this.finalTransform._matMdf){var s=this.finalTransform.mat.toCSS();i.transform=s,i.webkitTransform=s}this.finalTransform._opMdf&&(i.opacity=this.finalTransform.mProp.o.v)},renderFrame:function(){this.data.hd||this.hidden||(this.renderTransform(),this.renderRenderable(),this.renderElement(),this.renderInnerContent(),this._isFirstFrame&&(this._isFirstFrame=!1))},destroy:function(){this.layerElement=null,this.transformedElement=null,this.matteElement&&(this.matteElement=null),this.maskManager&&(this.maskManager.destroy(),this.maskManager=null)},createRenderableComponents:function(){this.maskManager=new MaskElement(this.data,this,this.globalData)},addEffects:function(){},setMatte:function(){}},HBaseElement.prototype.getBaseElement=SVGBaseElement.prototype.getBaseElement,HBaseElement.prototype.destroyBaseElement=HBaseElement.prototype.destroy,HBaseElement.prototype.buildElementParenting=BaseRenderer.prototype.buildElementParenting;function HSolidElement(e,i,s){this.initElement(e,i,s)}extendPrototype([BaseElement,TransformElement,HBaseElement,HierarchyElement,FrameElement,RenderableDOMElement],HSolidElement),HSolidElement.prototype.createContent=function(){var e;this.data.hasMask?(e=createNS("rect"),e.setAttribute("width",this.data.sw),e.setAttribute("height",this.data.sh),e.setAttribute("fill",this.data.sc),this.svgElement.setAttribute("width",this.data.sw),this.svgElement.setAttribute("height",this.data.sh)):(e=createTag("div"),e.style.width=this.data.sw+"px",e.style.height=this.data.sh+"px",e.style.backgroundColor=this.data.sc),this.layerElement.appendChild(e)};function HShapeElement(e,i,s){this.shapes=[],this.shapesData=e.shapes,this.stylesList=[],this.shapeModifiers=[],this.itemsData=[],this.processedElements=[],this.animatedContents=[],this.shapesContainer=createNS("g"),this.initElement(e,i,s),this.prevViewData=[],this.currentBBox={x:999999,y:-999999,h:0,w:0}}extendPrototype([BaseElement,TransformElement,HSolidElement,SVGShapeElement,HBaseElement,HierarchyElement,FrameElement,RenderableElement],HShapeElement),HShapeElement.prototype._renderShapeFrame=HShapeElement.prototype.renderInnerContent,HShapeElement.prototype.createContent=function(){var e;if(this.baseElement.style.fontSize=0,this.data.hasMask)this.layerElement.appendChild(this.shapesContainer),e=this.svgElement;else{e=createNS("svg");var i=this.comp.data?this.comp.data:this.globalData.compSize;e.setAttribute("width",i.w),e.setAttribute("height",i.h),e.appendChild(this.shapesContainer),this.layerElement.appendChild(e)}this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,this.shapesContainer,0,[],!0),this.filterUniqueShapes(),this.shapeCont=e},HShapeElement.prototype.getTransformedPoint=function(e,i){var s,a=e.length;for(s=0;s<a;s+=1)i=e[s].mProps.v.applyToPointArray(i[0],i[1],0);return i},HShapeElement.prototype.calculateShapeBoundingBox=function(e,i){var s=e.sh.v,a=e.transformers,_,$=s._length,rt,c,dt,ht;if(!($<=1)){for(_=0;_<$-1;_+=1)rt=this.getTransformedPoint(a,s.v[_]),c=this.getTransformedPoint(a,s.o[_]),dt=this.getTransformedPoint(a,s.i[_+1]),ht=this.getTransformedPoint(a,s.v[_+1]),this.checkBounds(rt,c,dt,ht,i);s.c&&(rt=this.getTransformedPoint(a,s.v[_]),c=this.getTransformedPoint(a,s.o[_]),dt=this.getTransformedPoint(a,s.i[0]),ht=this.getTransformedPoint(a,s.v[0]),this.checkBounds(rt,c,dt,ht,i))}},HShapeElement.prototype.checkBounds=function(e,i,s,a,_){this.getBoundsOfCurve(e,i,s,a);var $=this.shapeBoundingBox;_.x=bmMin($.left,_.x),_.xMax=bmMax($.right,_.xMax),_.y=bmMin($.top,_.y),_.yMax=bmMax($.bottom,_.yMax)},HShapeElement.prototype.shapeBoundingBox={left:0,right:0,top:0,bottom:0},HShapeElement.prototype.tempBoundingBox={x:0,xMax:0,y:0,yMax:0,width:0,height:0},HShapeElement.prototype.getBoundsOfCurve=function(e,i,s,a){for(var _=[[e[0],a[0]],[e[1],a[1]]],$,rt,c,dt,ht,Et,St,At=0;At<2;++At)rt=6*e[At]-12*i[At]+6*s[At],$=-3*e[At]+9*i[At]-9*s[At]+3*a[At],c=3*i[At]-3*e[At],rt|=0,$|=0,c|=0,$===0&&rt===0||($===0?(dt=-c/rt,dt>0&&dt<1&&_[At].push(this.calculateF(dt,e,i,s,a,At))):(ht=rt*rt-4*c*$,ht>=0&&(Et=(-rt+bmSqrt(ht))/(2*$),Et>0&&Et<1&&_[At].push(this.calculateF(Et,e,i,s,a,At)),St=(-rt-bmSqrt(ht))/(2*$),St>0&&St<1&&_[At].push(this.calculateF(St,e,i,s,a,At)))));this.shapeBoundingBox.left=bmMin.apply(null,_[0]),this.shapeBoundingBox.top=bmMin.apply(null,_[1]),this.shapeBoundingBox.right=bmMax.apply(null,_[0]),this.shapeBoundingBox.bottom=bmMax.apply(null,_[1])},HShapeElement.prototype.calculateF=function(e,i,s,a,_,$){return bmPow(1-e,3)*i[$]+3*bmPow(1-e,2)*e*s[$]+3*(1-e)*bmPow(e,2)*a[$]+bmPow(e,3)*_[$]},HShapeElement.prototype.calculateBoundingBox=function(e,i){var s,a=e.length;for(s=0;s<a;s+=1)e[s]&&e[s].sh?this.calculateShapeBoundingBox(e[s],i):e[s]&&e[s].it?this.calculateBoundingBox(e[s].it,i):e[s]&&e[s].style&&e[s].w&&this.expandStrokeBoundingBox(e[s].w,i)},HShapeElement.prototype.expandStrokeBoundingBox=function(e,i){var s=0;if(e.keyframes){for(var a=0;a<e.keyframes.length;a+=1){var _=e.keyframes[a].s;_>s&&(s=_)}s*=e.mult}else s=e.v*e.mult;i.x-=s,i.xMax+=s,i.y-=s,i.yMax+=s},HShapeElement.prototype.currentBoxContains=function(e){return this.currentBBox.x<=e.x&&this.currentBBox.y<=e.y&&this.currentBBox.width+this.currentBBox.x>=e.x+e.width&&this.currentBBox.height+this.currentBBox.y>=e.y+e.height},HShapeElement.prototype.renderInnerContent=function(){if(this._renderShapeFrame(),!this.hidden&&(this._isFirstFrame||this._mdf)){var e=this.tempBoundingBox,i=999999;if(e.x=i,e.xMax=-i,e.y=i,e.yMax=-i,this.calculateBoundingBox(this.itemsData,e),e.width=e.xMax<e.x?0:e.xMax-e.x,e.height=e.yMax<e.y?0:e.yMax-e.y,this.currentBoxContains(e))return;var s=!1;if(this.currentBBox.w!==e.width&&(this.currentBBox.w=e.width,this.shapeCont.setAttribute("width",e.width),s=!0),this.currentBBox.h!==e.height&&(this.currentBBox.h=e.height,this.shapeCont.setAttribute("height",e.height),s=!0),s||this.currentBBox.x!==e.x||this.currentBBox.y!==e.y){this.currentBBox.w=e.width,this.currentBBox.h=e.height,this.currentBBox.x=e.x,this.currentBBox.y=e.y,this.shapeCont.setAttribute("viewBox",this.currentBBox.x+" "+this.currentBBox.y+" "+this.currentBBox.w+" "+this.currentBBox.h);var a=this.shapeCont.style,_="translate("+this.currentBBox.x+"px,"+this.currentBBox.y+"px)";a.transform=_,a.webkitTransform=_}}};function HTextElement(e,i,s){this.textSpans=[],this.textPaths=[],this.currentBBox={x:999999,y:-999999,h:0,w:0},this.renderType="svg",this.isMasked=!1,this.initElement(e,i,s)}extendPrototype([BaseElement,TransformElement,HBaseElement,HierarchyElement,FrameElement,RenderableDOMElement,ITextElement],HTextElement),HTextElement.prototype.createContent=function(){if(this.isMasked=this.checkMasks(),this.isMasked){this.renderType="svg",this.compW=this.comp.data.w,this.compH=this.comp.data.h,this.svgElement.setAttribute("width",this.compW),this.svgElement.setAttribute("height",this.compH);var e=createNS("g");this.maskedElement.appendChild(e),this.innerElem=e}else this.renderType="html",this.innerElem=this.layerElement;this.checkParenting()},HTextElement.prototype.buildNewText=function(){var e=this.textProperty.currentData;this.renderedLetters=createSizedArray(e.l?e.l.length:0);var i=this.innerElem.style,s=e.fc?this.buildColor(e.fc):"rgba(0,0,0,0)";i.fill=s,i.color=s,e.sc&&(i.stroke=this.buildColor(e.sc),i.strokeWidth=e.sw+"px");var a=this.globalData.fontManager.getFontByName(e.f);if(!this.globalData.fontManager.chars)if(i.fontSize=e.finalSize+"px",i.lineHeight=e.finalSize+"px",a.fClass)this.innerElem.className=a.fClass;else{i.fontFamily=a.fFamily;var _=e.fWeight,$=e.fStyle;i.fontStyle=$,i.fontWeight=_}var rt,c,dt=e.l;c=dt.length;var ht,Et,St,At=this.mHelper,Pt,Vt="",Bt=0;for(rt=0;rt<c;rt+=1){if(this.globalData.fontManager.chars?(this.textPaths[Bt]?ht=this.textPaths[Bt]:(ht=createNS("path"),ht.setAttribute("stroke-linecap",lineCapEnum[1]),ht.setAttribute("stroke-linejoin",lineJoinEnum[2]),ht.setAttribute("stroke-miterlimit","4")),this.isMasked||(this.textSpans[Bt]?(Et=this.textSpans[Bt],St=Et.children[0]):(Et=createTag("div"),Et.style.lineHeight=0,St=createNS("svg"),St.appendChild(ht),styleDiv(Et)))):this.isMasked?ht=this.textPaths[Bt]?this.textPaths[Bt]:createNS("text"):this.textSpans[Bt]?(Et=this.textSpans[Bt],ht=this.textPaths[Bt]):(Et=createTag("span"),styleDiv(Et),ht=createTag("span"),styleDiv(ht),Et.appendChild(ht)),this.globalData.fontManager.chars){var Zt=this.globalData.fontManager.getCharData(e.finalText[rt],a.fStyle,this.globalData.fontManager.getFontByName(e.f).fFamily),zt;if(Zt?zt=Zt.data:zt=null,At.reset(),zt&&zt.shapes&&zt.shapes.length&&(Pt=zt.shapes[0].it,At.scale(e.finalSize/100,e.finalSize/100),Vt=this.createPathShape(At,Pt),ht.setAttribute("d",Vt)),this.isMasked)this.innerElem.appendChild(ht);else{if(this.innerElem.appendChild(Et),zt&&zt.shapes){document.body.appendChild(St);var Ut=St.getBBox();St.setAttribute("width",Ut.width+2),St.setAttribute("height",Ut.height+2),St.setAttribute("viewBox",Ut.x-1+" "+(Ut.y-1)+" "+(Ut.width+2)+" "+(Ut.height+2));var Nt=St.style,Gt="translate("+(Ut.x-1)+"px,"+(Ut.y-1)+"px)";Nt.transform=Gt,Nt.webkitTransform=Gt,dt[rt].yOffset=Ut.y-1}else St.setAttribute("width",1),St.setAttribute("height",1);Et.appendChild(St)}}else if(ht.textContent=dt[rt].val,ht.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve"),this.isMasked)this.innerElem.appendChild(ht);else{this.innerElem.appendChild(Et);var er=ht.style,ir="translate3d(0,"+-e.finalSize/1.2+"px,0)";er.transform=ir,er.webkitTransform=ir}this.isMasked?this.textSpans[Bt]=ht:this.textSpans[Bt]=Et,this.textSpans[Bt].style.display="block",this.textPaths[Bt]=ht,Bt+=1}for(;Bt<this.textSpans.length;)this.textSpans[Bt].style.display="none",Bt+=1},HTextElement.prototype.renderInnerContent=function(){this.validateText();var e;if(this.data.singleShape){if(!this._isFirstFrame&&!this.lettersChangedFlag)return;if(this.isMasked&&this.finalTransform._matMdf){this.svgElement.setAttribute("viewBox",-this.finalTransform.mProp.p.v[0]+" "+-this.finalTransform.mProp.p.v[1]+" "+this.compW+" "+this.compH),e=this.svgElement.style;var i="translate("+-this.finalTransform.mProp.p.v[0]+"px,"+-this.finalTransform.mProp.p.v[1]+"px)";e.transform=i,e.webkitTransform=i}}if(this.textAnimator.getMeasures(this.textProperty.currentData,this.lettersChangedFlag),!(!this.lettersChangedFlag&&!this.textAnimator.lettersChangedFlag)){var s,a,_=0,$=this.textAnimator.renderedLetters,rt=this.textProperty.currentData.l;a=rt.length;var c,dt,ht;for(s=0;s<a;s+=1)rt[s].n?_+=1:(dt=this.textSpans[s],ht=this.textPaths[s],c=$[_],_+=1,c._mdf.m&&(this.isMasked?dt.setAttribute("transform",c.m):(dt.style.webkitTransform=c.m,dt.style.transform=c.m)),dt.style.opacity=c.o,c.sw&&c._mdf.sw&&ht.setAttribute("stroke-width",c.sw),c.sc&&c._mdf.sc&&ht.setAttribute("stroke",c.sc),c.fc&&c._mdf.fc&&(ht.setAttribute("fill",c.fc),ht.style.color=c.fc));if(this.innerElem.getBBox&&!this.hidden&&(this._isFirstFrame||this._mdf)){var Et=this.innerElem.getBBox();this.currentBBox.w!==Et.width&&(this.currentBBox.w=Et.width,this.svgElement.setAttribute("width",Et.width)),this.currentBBox.h!==Et.height&&(this.currentBBox.h=Et.height,this.svgElement.setAttribute("height",Et.height));var St=1;if(this.currentBBox.w!==Et.width+St*2||this.currentBBox.h!==Et.height+St*2||this.currentBBox.x!==Et.x-St||this.currentBBox.y!==Et.y-St){this.currentBBox.w=Et.width+St*2,this.currentBBox.h=Et.height+St*2,this.currentBBox.x=Et.x-St,this.currentBBox.y=Et.y-St,this.svgElement.setAttribute("viewBox",this.currentBBox.x+" "+this.currentBBox.y+" "+this.currentBBox.w+" "+this.currentBBox.h),e=this.svgElement.style;var At="translate("+this.currentBBox.x+"px,"+this.currentBBox.y+"px)";e.transform=At,e.webkitTransform=At}}}};function HCameraElement(e,i,s){this.initFrame(),this.initBaseData(e,i,s),this.initHierarchy();var a=PropertyFactory.getProp;if(this.pe=a(this,e.pe,0,0,this),e.ks.p.s?(this.px=a(this,e.ks.p.x,1,0,this),this.py=a(this,e.ks.p.y,1,0,this),this.pz=a(this,e.ks.p.z,1,0,this)):this.p=a(this,e.ks.p,1,0,this),e.ks.a&&(this.a=a(this,e.ks.a,1,0,this)),e.ks.or.k.length&&e.ks.or.k[0].to){var _,$=e.ks.or.k.length;for(_=0;_<$;_+=1)e.ks.or.k[_].to=null,e.ks.or.k[_].ti=null}this.or=a(this,e.ks.or,1,degToRads,this),this.or.sh=!0,this.rx=a(this,e.ks.rx,0,degToRads,this),this.ry=a(this,e.ks.ry,0,degToRads,this),this.rz=a(this,e.ks.rz,0,degToRads,this),this.mat=new Matrix,this._prevMat=new Matrix,this._isFirstFrame=!0,this.finalTransform={mProp:this}}extendPrototype([BaseElement,FrameElement,HierarchyElement],HCameraElement),HCameraElement.prototype.setup=function(){var e,i=this.comp.threeDElements.length,s,a,_;for(e=0;e<i;e+=1)if(s=this.comp.threeDElements[e],s.type==="3d"){a=s.perspectiveElem.style,_=s.container.style;var $=this.pe.v+"px",rt="0px 0px 0px",c="matrix3d(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)";a.perspective=$,a.webkitPerspective=$,_.transformOrigin=rt,_.mozTransformOrigin=rt,_.webkitTransformOrigin=rt,a.transform=c,a.webkitTransform=c}},HCameraElement.prototype.createElements=function(){},HCameraElement.prototype.hide=function(){},HCameraElement.prototype.renderFrame=function(){var e=this._isFirstFrame,i,s;if(this.hierarchy)for(s=this.hierarchy.length,i=0;i<s;i+=1)e=this.hierarchy[i].finalTransform.mProp._mdf||e;if(e||this.pe._mdf||this.p&&this.p._mdf||this.px&&(this.px._mdf||this.py._mdf||this.pz._mdf)||this.rx._mdf||this.ry._mdf||this.rz._mdf||this.or._mdf||this.a&&this.a._mdf){if(this.mat.reset(),this.hierarchy)for(s=this.hierarchy.length-1,i=s;i>=0;i-=1){var a=this.hierarchy[i].finalTransform.mProp;this.mat.translate(-a.p.v[0],-a.p.v[1],a.p.v[2]),this.mat.rotateX(-a.or.v[0]).rotateY(-a.or.v[1]).rotateZ(a.or.v[2]),this.mat.rotateX(-a.rx.v).rotateY(-a.ry.v).rotateZ(a.rz.v),this.mat.scale(1/a.s.v[0],1/a.s.v[1],1/a.s.v[2]),this.mat.translate(a.a.v[0],a.a.v[1],a.a.v[2])}if(this.p?this.mat.translate(-this.p.v[0],-this.p.v[1],this.p.v[2]):this.mat.translate(-this.px.v,-this.py.v,this.pz.v),this.a){var _;this.p?_=[this.p.v[0]-this.a.v[0],this.p.v[1]-this.a.v[1],this.p.v[2]-this.a.v[2]]:_=[this.px.v-this.a.v[0],this.py.v-this.a.v[1],this.pz.v-this.a.v[2]];var $=Math.sqrt(Math.pow(_[0],2)+Math.pow(_[1],2)+Math.pow(_[2],2)),rt=[_[0]/$,_[1]/$,_[2]/$],c=Math.sqrt(rt[2]*rt[2]+rt[0]*rt[0]),dt=Math.atan2(rt[1],c),ht=Math.atan2(rt[0],-rt[2]);this.mat.rotateY(ht).rotateX(-dt)}this.mat.rotateX(-this.rx.v).rotateY(-this.ry.v).rotateZ(this.rz.v),this.mat.rotateX(-this.or.v[0]).rotateY(-this.or.v[1]).rotateZ(this.or.v[2]),this.mat.translate(this.globalData.compSize.w/2,this.globalData.compSize.h/2,0),this.mat.translate(0,0,this.pe.v);var Et=!this._prevMat.equals(this.mat);if((Et||this.pe._mdf)&&this.comp.threeDElements){s=this.comp.threeDElements.length;var St,At,Pt;for(i=0;i<s;i+=1)if(St=this.comp.threeDElements[i],St.type==="3d"){if(Et){var Vt=this.mat.toCSS();Pt=St.container.style,Pt.transform=Vt,Pt.webkitTransform=Vt}this.pe._mdf&&(At=St.perspectiveElem.style,At.perspective=this.pe.v+"px",At.webkitPerspective=this.pe.v+"px")}this.mat.clone(this._prevMat)}}this._isFirstFrame=!1},HCameraElement.prototype.prepareFrame=function(e){this.prepareProperties(e,!0)},HCameraElement.prototype.destroy=function(){},HCameraElement.prototype.getBaseElement=function(){return null};function HImageElement(e,i,s){this.assetData=i.getAssetData(e.refId),this.initElement(e,i,s)}extendPrototype([BaseElement,TransformElement,HBaseElement,HSolidElement,HierarchyElement,FrameElement,RenderableElement],HImageElement),HImageElement.prototype.createContent=function(){var e=this.globalData.getAssetsPath(this.assetData),i=new Image;this.data.hasMask?(this.imageElem=createNS("image"),this.imageElem.setAttribute("width",this.assetData.w+"px"),this.imageElem.setAttribute("height",this.assetData.h+"px"),this.imageElem.setAttributeNS("http://www.w3.org/1999/xlink","href",e),this.layerElement.appendChild(this.imageElem),this.baseElement.setAttribute("width",this.assetData.w),this.baseElement.setAttribute("height",this.assetData.h)):this.layerElement.appendChild(i),i.crossOrigin="anonymous",i.src=e,this.data.ln&&this.baseElement.setAttribute("id",this.data.ln)};function HybridRendererBase(e,i){this.animationItem=e,this.layers=null,this.renderedFrame=-1,this.renderConfig={className:i&&i.className||"",imagePreserveAspectRatio:i&&i.imagePreserveAspectRatio||"xMidYMid slice",hideOnTransparent:!(i&&i.hideOnTransparent===!1),filterSize:{width:i&&i.filterSize&&i.filterSize.width||"400%",height:i&&i.filterSize&&i.filterSize.height||"400%",x:i&&i.filterSize&&i.filterSize.x||"-100%",y:i&&i.filterSize&&i.filterSize.y||"-100%"}},this.globalData={_mdf:!1,frameNum:-1,renderConfig:this.renderConfig},this.pendingElements=[],this.elements=[],this.threeDElements=[],this.destroyed=!1,this.camera=null,this.supports3d=!0,this.rendererType="html"}extendPrototype([BaseRenderer],HybridRendererBase),HybridRendererBase.prototype.buildItem=SVGRenderer.prototype.buildItem,HybridRendererBase.prototype.checkPendingElements=function(){for(;this.pendingElements.length;){var e=this.pendingElements.pop();e.checkParenting()}},HybridRendererBase.prototype.appendElementInPos=function(e,i){var s=e.getBaseElement();if(s){var a=this.layers[i];if(!a.ddd||!this.supports3d)if(this.threeDElements)this.addTo3dContainer(s,i);else{for(var _=0,$,rt,c;_<i;)this.elements[_]&&this.elements[_]!==!0&&this.elements[_].getBaseElement&&(rt=this.elements[_],c=this.layers[_].ddd?this.getThreeDContainerByPos(_):rt.getBaseElement(),$=c||$),_+=1;$?(!a.ddd||!this.supports3d)&&this.layerElement.insertBefore(s,$):(!a.ddd||!this.supports3d)&&this.layerElement.appendChild(s)}else this.addTo3dContainer(s,i)}},HybridRendererBase.prototype.createShape=function(e){return this.supports3d?new HShapeElement(e,this.globalData,this):new SVGShapeElement(e,this.globalData,this)},HybridRendererBase.prototype.createText=function(e){return this.supports3d?new HTextElement(e,this.globalData,this):new SVGTextLottieElement(e,this.globalData,this)},HybridRendererBase.prototype.createCamera=function(e){return this.camera=new HCameraElement(e,this.globalData,this),this.camera},HybridRendererBase.prototype.createImage=function(e){return this.supports3d?new HImageElement(e,this.globalData,this):new IImageElement(e,this.globalData,this)},HybridRendererBase.prototype.createSolid=function(e){return this.supports3d?new HSolidElement(e,this.globalData,this):new ISolidElement(e,this.globalData,this)},HybridRendererBase.prototype.createNull=SVGRenderer.prototype.createNull,HybridRendererBase.prototype.getThreeDContainerByPos=function(e){for(var i=0,s=this.threeDElements.length;i<s;){if(this.threeDElements[i].startPos<=e&&this.threeDElements[i].endPos>=e)return this.threeDElements[i].perspectiveElem;i+=1}return null},HybridRendererBase.prototype.createThreeDContainer=function(e,i){var s=createTag("div"),a,_;styleDiv(s);var $=createTag("div");if(styleDiv($),i==="3d"){a=s.style,a.width=this.globalData.compSize.w+"px",a.height=this.globalData.compSize.h+"px";var rt="50% 50%";a.webkitTransformOrigin=rt,a.mozTransformOrigin=rt,a.transformOrigin=rt,_=$.style;var c="matrix3d(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)";_.transform=c,_.webkitTransform=c}s.appendChild($);var dt={container:$,perspectiveElem:s,startPos:e,endPos:e,type:i};return this.threeDElements.push(dt),dt},HybridRendererBase.prototype.build3dContainers=function(){var e,i=this.layers.length,s,a="";for(e=0;e<i;e+=1)this.layers[e].ddd&&this.layers[e].ty!==3?(a!=="3d"&&(a="3d",s=this.createThreeDContainer(e,"3d")),s.endPos=Math.max(s.endPos,e)):(a!=="2d"&&(a="2d",s=this.createThreeDContainer(e,"2d")),s.endPos=Math.max(s.endPos,e));for(i=this.threeDElements.length,e=i-1;e>=0;e-=1)this.resizerElem.appendChild(this.threeDElements[e].perspectiveElem)},HybridRendererBase.prototype.addTo3dContainer=function(e,i){for(var s=0,a=this.threeDElements.length;s<a;){if(i<=this.threeDElements[s].endPos){for(var _=this.threeDElements[s].startPos,$;_<i;)this.elements[_]&&this.elements[_].getBaseElement&&($=this.elements[_].getBaseElement()),_+=1;$?this.threeDElements[s].container.insertBefore(e,$):this.threeDElements[s].container.appendChild(e);break}s+=1}},HybridRendererBase.prototype.configAnimation=function(e){var i=createTag("div"),s=this.animationItem.wrapper,a=i.style;a.width=e.w+"px",a.height=e.h+"px",this.resizerElem=i,styleDiv(i),a.transformStyle="flat",a.mozTransformStyle="flat",a.webkitTransformStyle="flat",this.renderConfig.className&&i.setAttribute("class",this.renderConfig.className),s.appendChild(i),a.overflow="hidden";var _=createNS("svg");_.setAttribute("width","1"),_.setAttribute("height","1"),styleDiv(_),this.resizerElem.appendChild(_);var $=createNS("defs");_.appendChild($),this.data=e,this.setupGlobalData(e,_),this.globalData.defs=$,this.layers=e.layers,this.layerElement=this.resizerElem,this.build3dContainers(),this.updateContainerSize()},HybridRendererBase.prototype.destroy=function(){this.animationItem.wrapper&&(this.animationItem.wrapper.innerText=""),this.animationItem.container=null,this.globalData.defs=null;var e,i=this.layers?this.layers.length:0;for(e=0;e<i;e+=1)this.elements[e]&&this.elements[e].destroy&&this.elements[e].destroy();this.elements.length=0,this.destroyed=!0,this.animationItem=null},HybridRendererBase.prototype.updateContainerSize=function(){var e=this.animationItem.wrapper.offsetWidth,i=this.animationItem.wrapper.offsetHeight,s=e/i,a=this.globalData.compSize.w/this.globalData.compSize.h,_,$,rt,c;a>s?(_=e/this.globalData.compSize.w,$=e/this.globalData.compSize.w,rt=0,c=(i-this.globalData.compSize.h*(e/this.globalData.compSize.w))/2):(_=i/this.globalData.compSize.h,$=i/this.globalData.compSize.h,rt=(e-this.globalData.compSize.w*(i/this.globalData.compSize.h))/2,c=0);var dt=this.resizerElem.style;dt.webkitTransform="matrix3d("+_+",0,0,0,0,"+$+",0,0,0,0,1,0,"+rt+","+c+",0,1)",dt.transform=dt.webkitTransform},HybridRendererBase.prototype.renderFrame=SVGRenderer.prototype.renderFrame,HybridRendererBase.prototype.hide=function(){this.resizerElem.style.display="none"},HybridRendererBase.prototype.show=function(){this.resizerElem.style.display="block"},HybridRendererBase.prototype.initItems=function(){if(this.buildAllItems(),this.camera)this.camera.setup();else{var e=this.globalData.compSize.w,i=this.globalData.compSize.h,s,a=this.threeDElements.length;for(s=0;s<a;s+=1){var _=this.threeDElements[s].perspectiveElem.style;_.webkitPerspective=Math.sqrt(Math.pow(e,2)+Math.pow(i,2))+"px",_.perspective=_.webkitPerspective}}},HybridRendererBase.prototype.searchExtraCompositions=function(e){var i,s=e.length,a=createTag("div");for(i=0;i<s;i+=1)if(e[i].xt){var _=this.createComp(e[i],a,this.globalData.comp,null);_.initExpressions(),this.globalData.projectInterface.registerComposition(_)}};function HCompElement(e,i,s){this.layers=e.layers,this.supports3d=!e.hasMask,this.completeLayers=!1,this.pendingElements=[],this.elements=this.layers?createSizedArray(this.layers.length):[],this.initElement(e,i,s),this.tm=e.tm?PropertyFactory.getProp(this,e.tm,0,i.frameRate,this):{_placeholder:!0}}extendPrototype([HybridRendererBase,ICompElement,HBaseElement],HCompElement),HCompElement.prototype._createBaseContainerElements=HCompElement.prototype.createContainerElements,HCompElement.prototype.createContainerElements=function(){this._createBaseContainerElements(),this.data.hasMask?(this.svgElement.setAttribute("width",this.data.w),this.svgElement.setAttribute("height",this.data.h),this.transformedElement=this.baseElement):this.transformedElement=this.layerElement},HCompElement.prototype.addTo3dContainer=function(e,i){for(var s=0,a;s<i;)this.elements[s]&&this.elements[s].getBaseElement&&(a=this.elements[s].getBaseElement()),s+=1;a?this.layerElement.insertBefore(e,a):this.layerElement.appendChild(e)},HCompElement.prototype.createComp=function(e){return this.supports3d?new HCompElement(e,this.globalData,this):new SVGCompElement(e,this.globalData,this)};function HybridRenderer(e,i){this.animationItem=e,this.layers=null,this.renderedFrame=-1,this.renderConfig={className:i&&i.className||"",imagePreserveAspectRatio:i&&i.imagePreserveAspectRatio||"xMidYMid slice",hideOnTransparent:!(i&&i.hideOnTransparent===!1),filterSize:{width:i&&i.filterSize&&i.filterSize.width||"400%",height:i&&i.filterSize&&i.filterSize.height||"400%",x:i&&i.filterSize&&i.filterSize.x||"-100%",y:i&&i.filterSize&&i.filterSize.y||"-100%"},runExpressions:!i||i.runExpressions===void 0||i.runExpressions},this.globalData={_mdf:!1,frameNum:-1,renderConfig:this.renderConfig},this.pendingElements=[],this.elements=[],this.threeDElements=[],this.destroyed=!1,this.camera=null,this.supports3d=!0,this.rendererType="html"}extendPrototype([HybridRendererBase],HybridRenderer),HybridRenderer.prototype.createComp=function(e){return this.supports3d?new HCompElement(e,this.globalData,this):new SVGCompElement(e,this.globalData,this)};var CompExpressionInterface=function(){return function(e){function i(s){for(var a=0,_=e.layers.length;a<_;){if(e.layers[a].nm===s||e.layers[a].ind===s)return e.elements[a].layerInterface;a+=1}return null}return Object.defineProperty(i,"_name",{value:e.data.nm}),i.layer=i,i.pixelAspect=1,i.height=e.data.h||e.globalData.compSize.h,i.width=e.data.w||e.globalData.compSize.w,i.pixelAspect=1,i.frameDuration=1/e.globalData.frameRate,i.displayStartTime=0,i.numLayers=e.layers.length,i}}();function _typeof$2(e){"@babel/helpers - typeof";return _typeof$2=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},_typeof$2(e)}function seedRandom(e,i){var s=this,a=256,_=6,$=52,rt="random",c=i.pow(a,_),dt=i.pow(2,$),ht=dt*2,Et=a-1,St;function At(Nt,Gt,er){var ir=[];Gt=Gt===!0?{entropy:!0}:Gt||{};var or=Zt(Bt(Gt.entropy?[Nt,Ut(e)]:Nt===null?zt():Nt,3),ir),mr=new Pt(ir),Rr=function(){for(var un=mr.g(_),jr=c,Jr=0;un<dt;)un=(un+Jr)*a,jr*=a,Jr=mr.g(1);for(;un>=ht;)un/=2,jr/=2,Jr>>>=1;return(un+Jr)/jr};return Rr.int32=function(){return mr.g(4)|0},Rr.quick=function(){return mr.g(4)/4294967296},Rr.double=Rr,Zt(Ut(mr.S),e),(Gt.pass||er||function(on,un,jr,Jr){return Jr&&(Jr.S&&Vt(Jr,mr),on.state=function(){return Vt(mr,{})}),jr?(i[rt]=on,un):on})(Rr,or,"global"in Gt?Gt.global:this==i,Gt.state)}i["seed"+rt]=At;function Pt(Nt){var Gt,er=Nt.length,ir=this,or=0,mr=ir.i=ir.j=0,Rr=ir.S=[];for(er||(Nt=[er++]);or<a;)Rr[or]=or++;for(or=0;or<a;or++)Rr[or]=Rr[mr=Et&mr+Nt[or%er]+(Gt=Rr[or])],Rr[mr]=Gt;ir.g=function(on){for(var un,jr=0,Jr=ir.i,fn=ir.j,Fr=ir.S;on--;)un=Fr[Jr=Et&Jr+1],jr=jr*a+Fr[Et&(Fr[Jr]=Fr[fn=Et&fn+un])+(Fr[fn]=un)];return ir.i=Jr,ir.j=fn,jr}}function Vt(Nt,Gt){return Gt.i=Nt.i,Gt.j=Nt.j,Gt.S=Nt.S.slice(),Gt}function Bt(Nt,Gt){var er=[],ir=_typeof$2(Nt),or;if(Gt&&ir=="object")for(or in Nt)try{er.push(Bt(Nt[or],Gt-1))}catch{}return er.length?er:ir=="string"?Nt:Nt+"\0"}function Zt(Nt,Gt){for(var er=Nt+"",ir,or=0;or<er.length;)Gt[Et&or]=Et&(ir^=Gt[Et&or]*19)+er.charCodeAt(or++);return Ut(Gt)}function zt(){try{var Nt=new Uint8Array(a);return(s.crypto||s.msCrypto).getRandomValues(Nt),Ut(Nt)}catch{var Gt=s.navigator,er=Gt&&Gt.plugins;return[+new Date,s,er,s.screen,Ut(e)]}}function Ut(Nt){return String.fromCharCode.apply(0,Nt)}Zt(i.random(),e)}function initialize$2(e){seedRandom([],e)}var propTypes={SHAPE:"shape"};function _typeof$1(e){"@babel/helpers - typeof";return _typeof$1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},_typeof$1(e)}var ExpressionManager=function(){var ob={},Math=BMMath,window=null,document=null,XMLHttpRequest=null,fetch=null,frames=null,_lottieGlobal={};initialize$2(BMMath);function resetFrame(){_lottieGlobal={}}function $bm_isInstanceOfArray(e){return e.constructor===Array||e.constructor===Float32Array}function isNumerable(e,i){return e==="number"||i instanceof Number||e==="boolean"||e==="string"}function $bm_neg(e){var i=_typeof$1(e);if(i==="number"||e instanceof Number||i==="boolean")return-e;if($bm_isInstanceOfArray(e)){var s,a=e.length,_=[];for(s=0;s<a;s+=1)_[s]=-e[s];return _}return e.propType?e.v:-e}var easeInBez=BezierFactory.getBezierEasing(.333,0,.833,.833,"easeIn").get,easeOutBez=BezierFactory.getBezierEasing(.167,.167,.667,1,"easeOut").get,easeInOutBez=BezierFactory.getBezierEasing(.33,0,.667,1,"easeInOut").get;function sum(e,i){var s=_typeof$1(e),a=_typeof$1(i);if(isNumerable(s,e)&&isNumerable(a,i)||s==="string"||a==="string")return e+i;if($bm_isInstanceOfArray(e)&&isNumerable(a,i))return e=e.slice(0),e[0]+=i,e;if(isNumerable(s,e)&&$bm_isInstanceOfArray(i))return i=i.slice(0),i[0]=e+i[0],i;if($bm_isInstanceOfArray(e)&&$bm_isInstanceOfArray(i)){for(var _=0,$=e.length,rt=i.length,c=[];_<$||_<rt;)(typeof e[_]=="number"||e[_]instanceof Number)&&(typeof i[_]=="number"||i[_]instanceof Number)?c[_]=e[_]+i[_]:c[_]=i[_]===void 0?e[_]:e[_]||i[_],_+=1;return c}return 0}var add=sum;function sub(e,i){var s=_typeof$1(e),a=_typeof$1(i);if(isNumerable(s,e)&&isNumerable(a,i))return s==="string"&&(e=parseInt(e,10)),a==="string"&&(i=parseInt(i,10)),e-i;if($bm_isInstanceOfArray(e)&&isNumerable(a,i))return e=e.slice(0),e[0]-=i,e;if(isNumerable(s,e)&&$bm_isInstanceOfArray(i))return i=i.slice(0),i[0]=e-i[0],i;if($bm_isInstanceOfArray(e)&&$bm_isInstanceOfArray(i)){for(var _=0,$=e.length,rt=i.length,c=[];_<$||_<rt;)(typeof e[_]=="number"||e[_]instanceof Number)&&(typeof i[_]=="number"||i[_]instanceof Number)?c[_]=e[_]-i[_]:c[_]=i[_]===void 0?e[_]:e[_]||i[_],_+=1;return c}return 0}function mul(e,i){var s=_typeof$1(e),a=_typeof$1(i),_;if(isNumerable(s,e)&&isNumerable(a,i))return e*i;var $,rt;if($bm_isInstanceOfArray(e)&&isNumerable(a,i)){for(rt=e.length,_=createTypedArray("float32",rt),$=0;$<rt;$+=1)_[$]=e[$]*i;return _}if(isNumerable(s,e)&&$bm_isInstanceOfArray(i)){for(rt=i.length,_=createTypedArray("float32",rt),$=0;$<rt;$+=1)_[$]=e*i[$];return _}return 0}function div(e,i){var s=_typeof$1(e),a=_typeof$1(i),_;if(isNumerable(s,e)&&isNumerable(a,i))return e/i;var $,rt;if($bm_isInstanceOfArray(e)&&isNumerable(a,i)){for(rt=e.length,_=createTypedArray("float32",rt),$=0;$<rt;$+=1)_[$]=e[$]/i;return _}if(isNumerable(s,e)&&$bm_isInstanceOfArray(i)){for(rt=i.length,_=createTypedArray("float32",rt),$=0;$<rt;$+=1)_[$]=e/i[$];return _}return 0}function mod(e,i){return typeof e=="string"&&(e=parseInt(e,10)),typeof i=="string"&&(i=parseInt(i,10)),e%i}var $bm_sum=sum,$bm_sub=sub,$bm_mul=mul,$bm_div=div,$bm_mod=mod;function clamp(e,i,s){if(i>s){var a=s;s=i,i=a}return Math.min(Math.max(e,i),s)}function radiansToDegrees(e){return e/degToRads}var radians_to_degrees=radiansToDegrees;function degreesToRadians(e){return e*degToRads}var degrees_to_radians=radiansToDegrees,helperLengthArray=[0,0,0,0,0,0];function length(e,i){if(typeof e=="number"||e instanceof Number)return i=i||0,Math.abs(e-i);i||(i=helperLengthArray);var s,a=Math.min(e.length,i.length),_=0;for(s=0;s<a;s+=1)_+=Math.pow(i[s]-e[s],2);return Math.sqrt(_)}function normalize(e){return div(e,length(e))}function rgbToHsl(e){var i=e[0],s=e[1],a=e[2],_=Math.max(i,s,a),$=Math.min(i,s,a),rt,c,dt=(_+$)/2;if(_===$)rt=0,c=0;else{var ht=_-$;switch(c=dt>.5?ht/(2-_-$):ht/(_+$),_){case i:rt=(s-a)/ht+(s<a?6:0);break;case s:rt=(a-i)/ht+2;break;case a:rt=(i-s)/ht+4;break}rt/=6}return[rt,c,dt,e[3]]}function hue2rgb(e,i,s){return s<0&&(s+=1),s>1&&(s-=1),s<1/6?e+(i-e)*6*s:s<1/2?i:s<2/3?e+(i-e)*(2/3-s)*6:e}function hslToRgb(e){var i=e[0],s=e[1],a=e[2],_,$,rt;if(s===0)_=a,rt=a,$=a;else{var c=a<.5?a*(1+s):a+s-a*s,dt=2*a-c;_=hue2rgb(dt,c,i+1/3),$=hue2rgb(dt,c,i),rt=hue2rgb(dt,c,i-1/3)}return[_,$,rt,e[3]]}function linear(e,i,s,a,_){if((a===void 0||_===void 0)&&(a=i,_=s,i=0,s=1),s<i){var $=s;s=i,i=$}if(e<=i)return a;if(e>=s)return _;var rt=s===i?0:(e-i)/(s-i);if(!a.length)return a+(_-a)*rt;var c,dt=a.length,ht=createTypedArray("float32",dt);for(c=0;c<dt;c+=1)ht[c]=a[c]+(_[c]-a[c])*rt;return ht}function random(e,i){if(i===void 0&&(e===void 0?(e=0,i=1):(i=e,e=void 0)),i.length){var s,a=i.length;e||(e=createTypedArray("float32",a));var _=createTypedArray("float32",a),$=BMMath.random();for(s=0;s<a;s+=1)_[s]=e[s]+$*(i[s]-e[s]);return _}e===void 0&&(e=0);var rt=BMMath.random();return e+rt*(i-e)}function createPath(e,i,s,a){var _,$=e.length,rt=shapePool.newElement();rt.setPathData(!!a,$);var c=[0,0],dt,ht;for(_=0;_<$;_+=1)dt=i&&i[_]?i[_]:c,ht=s&&s[_]?s[_]:c,rt.setTripleAt(e[_][0],e[_][1],ht[0]+e[_][0],ht[1]+e[_][1],dt[0]+e[_][0],dt[1]+e[_][1],_,!0);return rt}function initiateExpression(elem,data,property){function noOp(e){return e}if(!elem.globalData.renderConfig.runExpressions)return noOp;var val=data.x,needsVelocity=/velocity(?![\w\d])/.test(val),_needsRandom=val.indexOf("random")!==-1,elemType=elem.data.ty,transform,$bm_transform,content,effect,thisProperty=property;thisProperty._name=elem.data.nm,thisProperty.valueAtTime=thisProperty.getValueAtTime,Object.defineProperty(thisProperty,"value",{get:function(){return thisProperty.v}}),elem.comp.frameDuration=1/elem.comp.globalData.frameRate,elem.comp.displayStartTime=0;var inPoint=elem.data.ip/elem.comp.globalData.frameRate,outPoint=elem.data.op/elem.comp.globalData.frameRate,width=elem.data.sw?elem.data.sw:0,height=elem.data.sh?elem.data.sh:0,name=elem.data.nm,loopIn,loop_in,loopOut,loop_out,smooth,toWorld,fromWorld,fromComp,toComp,fromCompToSurface,position,rotation,anchorPoint,scale,thisLayer,thisComp,mask,valueAtTime,velocityAtTime,scoped_bm_rt,expression_function=eval("[function _expression_function(){"+val+";scoped_bm_rt=$bm_rt}]")[0],numKeys=property.kf?data.k.length:0,active=!this.data||this.data.hd!==!0,wiggle=(function e(i,s){var a,_,$=this.pv.length?this.pv.length:1,rt=createTypedArray("float32",$);i=5;var c=Math.floor(time*i);for(a=0,_=0;a<c;){for(_=0;_<$;_+=1)rt[_]+=-s+s*2*BMMath.random();a+=1}var dt=time*i,ht=dt-Math.floor(dt),Et=createTypedArray("float32",$);if($>1){for(_=0;_<$;_+=1)Et[_]=this.pv[_]+rt[_]+(-s+s*2*BMMath.random())*ht;return Et}return this.pv+rt[0]+(-s+s*2*BMMath.random())*ht}).bind(this);thisProperty.loopIn&&(loopIn=thisProperty.loopIn.bind(thisProperty),loop_in=loopIn),thisProperty.loopOut&&(loopOut=thisProperty.loopOut.bind(thisProperty),loop_out=loopOut),thisProperty.smooth&&(smooth=thisProperty.smooth.bind(thisProperty));function loopInDuration(e,i){return loopIn(e,i,!0)}function loopOutDuration(e,i){return loopOut(e,i,!0)}this.getValueAtTime&&(valueAtTime=this.getValueAtTime.bind(this)),this.getVelocityAtTime&&(velocityAtTime=this.getVelocityAtTime.bind(this));var comp=elem.comp.globalData.projectInterface.bind(elem.comp.globalData.projectInterface);function lookAt(e,i){var s=[i[0]-e[0],i[1]-e[1],i[2]-e[2]],a=Math.atan2(s[0],Math.sqrt(s[1]*s[1]+s[2]*s[2]))/degToRads,_=-Math.atan2(s[1],s[2])/degToRads;return[_,a,0]}function easeOut(e,i,s,a,_){return applyEase(easeOutBez,e,i,s,a,_)}function easeIn(e,i,s,a,_){return applyEase(easeInBez,e,i,s,a,_)}function ease(e,i,s,a,_){return applyEase(easeInOutBez,e,i,s,a,_)}function applyEase(e,i,s,a,_,$){_===void 0?(_=s,$=a):i=(i-s)/(a-s),i>1?i=1:i<0&&(i=0);var rt=e(i);if($bm_isInstanceOfArray(_)){var c,dt=_.length,ht=createTypedArray("float32",dt);for(c=0;c<dt;c+=1)ht[c]=($[c]-_[c])*rt+_[c];return ht}return($-_)*rt+_}function nearestKey(e){var i,s=data.k.length,a,_;if(!data.k.length||typeof data.k[0]=="number")a=0,_=0;else if(a=-1,e*=elem.comp.globalData.frameRate,e<data.k[0].t)a=1,_=data.k[0].t;else{for(i=0;i<s-1;i+=1)if(e===data.k[i].t){a=i+1,_=data.k[i].t;break}else if(e>data.k[i].t&&e<data.k[i+1].t){e-data.k[i].t>data.k[i+1].t-e?(a=i+2,_=data.k[i+1].t):(a=i+1,_=data.k[i].t);break}a===-1&&(a=i+1,_=data.k[i].t)}var $={};return $.index=a,$.time=_/elem.comp.globalData.frameRate,$}function key(e){var i,s,a;if(!data.k.length||typeof data.k[0]=="number")throw new Error("The property has no keyframe at index "+e);e-=1,i={time:data.k[e].t/elem.comp.globalData.frameRate,value:[]};var _=Object.prototype.hasOwnProperty.call(data.k[e],"s")?data.k[e].s:data.k[e-1].e;for(a=_.length,s=0;s<a;s+=1)i[s]=_[s],i.value[s]=_[s];return i}function framesToTime(e,i){return i||(i=elem.comp.globalData.frameRate),e/i}function timeToFrames(e,i){return!e&&e!==0&&(e=time),i||(i=elem.comp.globalData.frameRate),e*i}function seedRandom(e){BMMath.seedrandom(randSeed+e)}function sourceRectAtTime(){return elem.sourceRectAtTime()}function substring(e,i){return typeof value=="string"?i===void 0?value.substring(e):value.substring(e,i):""}function substr(e,i){return typeof value=="string"?i===void 0?value.substr(e):value.substr(e,i):""}function posterizeTime(e){time=e===0?0:Math.floor(time*e)/e,value=valueAtTime(time)}var time,velocity,value,text,textIndex,textTotal,selectorValue,index=elem.data.ind,hasParent=!!(elem.hierarchy&&elem.hierarchy.length),parent,randSeed=Math.floor(Math.random()*1e6),globalData=elem.globalData;function executeExpression(e){return value=e,this.frameExpressionId===elem.globalData.frameId&&this.propType!=="textSelector"?value:(this.propType==="textSelector"&&(textIndex=this.textIndex,textTotal=this.textTotal,selectorValue=this.selectorValue),thisLayer||(text=elem.layerInterface.text,thisLayer=elem.layerInterface,thisComp=elem.comp.compInterface,toWorld=thisLayer.toWorld.bind(thisLayer),fromWorld=thisLayer.fromWorld.bind(thisLayer),fromComp=thisLayer.fromComp.bind(thisLayer),toComp=thisLayer.toComp.bind(thisLayer),mask=thisLayer.mask?thisLayer.mask.bind(thisLayer):null,fromCompToSurface=fromComp),transform||(transform=elem.layerInterface("ADBE Transform Group"),$bm_transform=transform,transform&&(anchorPoint=transform.anchorPoint)),elemType===4&&!content&&(content=thisLayer("ADBE Root Vectors Group")),effect||(effect=thisLayer(4)),hasParent=!!(elem.hierarchy&&elem.hierarchy.length),hasParent&&!parent&&(parent=elem.hierarchy[0].layerInterface),time=this.comp.renderedFrame/this.comp.globalData.frameRate,_needsRandom&&seedRandom(randSeed+time),needsVelocity&&(velocity=velocityAtTime(time)),expression_function(),this.frameExpressionId=elem.globalData.frameId,scoped_bm_rt=scoped_bm_rt.propType===propTypes.SHAPE?scoped_bm_rt.v:scoped_bm_rt,scoped_bm_rt)}return executeExpression.__preventDeadCodeRemoval=[$bm_transform,anchorPoint,time,velocity,inPoint,outPoint,width,height,name,loop_in,loop_out,smooth,toComp,fromCompToSurface,toWorld,fromWorld,mask,position,rotation,scale,thisComp,numKeys,active,wiggle,loopInDuration,loopOutDuration,comp,lookAt,easeOut,easeIn,ease,nearestKey,key,text,textIndex,textTotal,selectorValue,framesToTime,timeToFrames,sourceRectAtTime,substring,substr,posterizeTime,index,globalData],executeExpression}return ob.initiateExpression=initiateExpression,ob.__preventDeadCodeRemoval=[window,document,XMLHttpRequest,fetch,frames,$bm_neg,add,$bm_sum,$bm_sub,$bm_mul,$bm_div,$bm_mod,clamp,radians_to_degrees,degreesToRadians,degrees_to_radians,normalize,rgbToHsl,hslToRgb,linear,random,createPath,_lottieGlobal],ob.resetFrame=resetFrame,ob}(),Expressions=function(){var e={};e.initExpressions=i,e.resetFrame=ExpressionManager.resetFrame;function i(s){var a=0,_=[];function $(){a+=1}function rt(){a-=1,a===0&&dt()}function c(ht){_.indexOf(ht)===-1&&_.push(ht)}function dt(){var ht,Et=_.length;for(ht=0;ht<Et;ht+=1)_[ht].release();_.length=0}s.renderer.compInterface=CompExpressionInterface(s.renderer),s.renderer.globalData.projectInterface.registerComposition(s.renderer),s.renderer.globalData.pushExpression=$,s.renderer.globalData.popExpression=rt,s.renderer.globalData.registerExpressionProperty=c}return e}(),MaskManagerInterface=function(){function e(s,a){this._mask=s,this._data=a}Object.defineProperty(e.prototype,"maskPath",{get:function(){return this._mask.prop.k&&this._mask.prop.getValue(),this._mask.prop}}),Object.defineProperty(e.prototype,"maskOpacity",{get:function(){return this._mask.op.k&&this._mask.op.getValue(),this._mask.op.v*100}});var i=function(a){var _=createSizedArray(a.viewData.length),$,rt=a.viewData.length;for($=0;$<rt;$+=1)_[$]=new e(a.viewData[$],a.masksProperties[$]);var c=function(ht){for($=0;$<rt;){if(a.masksProperties[$].nm===ht)return _[$];$+=1}return null};return c};return i}(),ExpressionPropertyInterface=function(){var e={pv:0,v:0,mult:1},i={pv:[0,0,0],v:[0,0,0],mult:1};function s(rt,c,dt){Object.defineProperty(rt,"velocity",{get:function(){return c.getVelocityAtTime(c.comp.currentFrame)}}),rt.numKeys=c.keyframes?c.keyframes.length:0,rt.key=function(ht){if(!rt.numKeys)return 0;var Et="";"s"in c.keyframes[ht-1]?Et=c.keyframes[ht-1].s:"e"in c.keyframes[ht-2]?Et=c.keyframes[ht-2].e:Et=c.keyframes[ht-2].s;var St=dt==="unidimensional"?new Number(Et):Object.assign({},Et);return St.time=c.keyframes[ht-1].t/c.elem.comp.globalData.frameRate,St.value=dt==="unidimensional"?Et[0]:Et,St},rt.valueAtTime=c.getValueAtTime,rt.speedAtTime=c.getSpeedAtTime,rt.velocityAtTime=c.getVelocityAtTime,rt.propertyGroup=c.propertyGroup}function a(rt){(!rt||!("pv"in rt))&&(rt=e);var c=1/rt.mult,dt=rt.pv*c,ht=new Number(dt);return ht.value=dt,s(ht,rt,"unidimensional"),function(){return rt.k&&rt.getValue(),dt=rt.v*c,ht.value!==dt&&(ht=new Number(dt),ht.value=dt,ht[0]=dt,s(ht,rt,"unidimensional")),ht}}function _(rt){(!rt||!("pv"in rt))&&(rt=i);var c=1/rt.mult,dt=rt.data&&rt.data.l||rt.pv.length,ht=createTypedArray("float32",dt),Et=createTypedArray("float32",dt);return ht.value=Et,s(ht,rt,"multidimensional"),function(){rt.k&&rt.getValue();for(var St=0;St<dt;St+=1)Et[St]=rt.v[St]*c,ht[St]=Et[St];return ht}}function $(){return e}return function(rt){return rt?rt.propType==="unidimensional"?a(rt):_(rt):$}}(),TransformExpressionInterface=function(){return function(e){function i(rt){switch(rt){case"scale":case"Scale":case"ADBE Scale":case 6:return i.scale;case"rotation":case"Rotation":case"ADBE Rotation":case"ADBE Rotate Z":case 10:return i.rotation;case"ADBE Rotate X":return i.xRotation;case"ADBE Rotate Y":return i.yRotation;case"position":case"Position":case"ADBE Position":case 2:return i.position;case"ADBE Position_0":return i.xPosition;case"ADBE Position_1":return i.yPosition;case"ADBE Position_2":return i.zPosition;case"anchorPoint":case"AnchorPoint":case"Anchor Point":case"ADBE AnchorPoint":case 1:return i.anchorPoint;case"opacity":case"Opacity":case 11:return i.opacity;default:return null}}Object.defineProperty(i,"rotation",{get:ExpressionPropertyInterface(e.r||e.rz)}),Object.defineProperty(i,"zRotation",{get:ExpressionPropertyInterface(e.rz||e.r)}),Object.defineProperty(i,"xRotation",{get:ExpressionPropertyInterface(e.rx)}),Object.defineProperty(i,"yRotation",{get:ExpressionPropertyInterface(e.ry)}),Object.defineProperty(i,"scale",{get:ExpressionPropertyInterface(e.s)});var s,a,_,$;return e.p?$=ExpressionPropertyInterface(e.p):(s=ExpressionPropertyInterface(e.px),a=ExpressionPropertyInterface(e.py),e.pz&&(_=ExpressionPropertyInterface(e.pz))),Object.defineProperty(i,"position",{get:function(){return e.p?$():[s(),a(),_?_():0]}}),Object.defineProperty(i,"xPosition",{get:ExpressionPropertyInterface(e.px)}),Object.defineProperty(i,"yPosition",{get:ExpressionPropertyInterface(e.py)}),Object.defineProperty(i,"zPosition",{get:ExpressionPropertyInterface(e.pz)}),Object.defineProperty(i,"anchorPoint",{get:ExpressionPropertyInterface(e.a)}),Object.defineProperty(i,"opacity",{get:ExpressionPropertyInterface(e.o)}),Object.defineProperty(i,"skew",{get:ExpressionPropertyInterface(e.sk)}),Object.defineProperty(i,"skewAxis",{get:ExpressionPropertyInterface(e.sa)}),Object.defineProperty(i,"orientation",{get:ExpressionPropertyInterface(e.or)}),i}}(),LayerExpressionInterface=function(){function e(ht){var Et=new Matrix;if(ht!==void 0){var St=this._elem.finalTransform.mProp.getValueAtTime(ht);St.clone(Et)}else{var At=this._elem.finalTransform.mProp;At.applyToMatrix(Et)}return Et}function i(ht,Et){var St=this.getMatrix(Et);return St.props[12]=0,St.props[13]=0,St.props[14]=0,this.applyPoint(St,ht)}function s(ht,Et){var St=this.getMatrix(Et);return this.applyPoint(St,ht)}function a(ht,Et){var St=this.getMatrix(Et);return St.props[12]=0,St.props[13]=0,St.props[14]=0,this.invertPoint(St,ht)}function _(ht,Et){var St=this.getMatrix(Et);return this.invertPoint(St,ht)}function $(ht,Et){if(this._elem.hierarchy&&this._elem.hierarchy.length){var St,At=this._elem.hierarchy.length;for(St=0;St<At;St+=1)this._elem.hierarchy[St].finalTransform.mProp.applyToMatrix(ht)}return ht.applyToPointArray(Et[0],Et[1],Et[2]||0)}function rt(ht,Et){if(this._elem.hierarchy&&this._elem.hierarchy.length){var St,At=this._elem.hierarchy.length;for(St=0;St<At;St+=1)this._elem.hierarchy[St].finalTransform.mProp.applyToMatrix(ht)}return ht.inversePoint(Et)}function c(ht){var Et=new Matrix;if(Et.reset(),this._elem.finalTransform.mProp.applyToMatrix(Et),this._elem.hierarchy&&this._elem.hierarchy.length){var St,At=this._elem.hierarchy.length;for(St=0;St<At;St+=1)this._elem.hierarchy[St].finalTransform.mProp.applyToMatrix(Et);return Et.inversePoint(ht)}return Et.inversePoint(ht)}function dt(){return[1,1,1,1]}return function(ht){var Et;function St(Bt){Pt.mask=new MaskManagerInterface(Bt,ht)}function At(Bt){Pt.effect=Bt}function Pt(Bt){switch(Bt){case"ADBE Root Vectors Group":case"Contents":case 2:return Pt.shapeInterface;case 1:case 6:case"Transform":case"transform":case"ADBE Transform Group":return Et;case 4:case"ADBE Effect Parade":case"effects":case"Effects":return Pt.effect;case"ADBE Text Properties":return Pt.textInterface;default:return null}}Pt.getMatrix=e,Pt.invertPoint=rt,Pt.applyPoint=$,Pt.toWorld=s,Pt.toWorldVec=i,Pt.fromWorld=_,Pt.fromWorldVec=a,Pt.toComp=s,Pt.fromComp=c,Pt.sampleImage=dt,Pt.sourceRectAtTime=ht.sourceRectAtTime.bind(ht),Pt._elem=ht,Et=TransformExpressionInterface(ht.finalTransform.mProp);var Vt=getDescriptor(Et,"anchorPoint");return Object.defineProperties(Pt,{hasParent:{get:function(){return ht.hierarchy.length}},parent:{get:function(){return ht.hierarchy[0].layerInterface}},rotation:getDescriptor(Et,"rotation"),scale:getDescriptor(Et,"scale"),position:getDescriptor(Et,"position"),opacity:getDescriptor(Et,"opacity"),anchorPoint:Vt,anchor_point:Vt,transform:{get:function(){return Et}},active:{get:function(){return ht.isInRange}}}),Pt.startTime=ht.data.st,Pt.index=ht.data.ind,Pt.source=ht.data.refId,Pt.height=ht.data.ty===0?ht.data.h:100,Pt.width=ht.data.ty===0?ht.data.w:100,Pt.inPoint=ht.data.ip/ht.comp.globalData.frameRate,Pt.outPoint=ht.data.op/ht.comp.globalData.frameRate,Pt._name=ht.data.nm,Pt.registerMaskInterface=St,Pt.registerEffectsInterface=At,Pt}}(),propertyGroupFactory=function(){return function(e,i){return function(s){return s=s===void 0?1:s,s<=0?e:i(s-1)}}}(),PropertyInterface=function(){return function(e,i){var s={_name:e};function a(_){return _=_===void 0?1:_,_<=0?s:i(_-1)}return a}}(),EffectsExpressionInterface=function(){var e={createEffectsInterface:i};function i(_,$){if(_.effectsManager){var rt=[],c=_.data.ef,dt,ht=_.effectsManager.effectElements.length;for(dt=0;dt<ht;dt+=1)rt.push(s(c[dt],_.effectsManager.effectElements[dt],$,_));var Et=_.data.ef||[],St=function(Pt){for(dt=0,ht=Et.length;dt<ht;){if(Pt===Et[dt].nm||Pt===Et[dt].mn||Pt===Et[dt].ix)return rt[dt];dt+=1}return null};return Object.defineProperty(St,"numProperties",{get:function(){return Et.length}}),St}return null}function s(_,$,rt,c){function dt(Pt){for(var Vt=_.ef,Bt=0,Zt=Vt.length;Bt<Zt;){if(Pt===Vt[Bt].nm||Pt===Vt[Bt].mn||Pt===Vt[Bt].ix)return Vt[Bt].ty===5?Et[Bt]:Et[Bt]();Bt+=1}throw new Error}var ht=propertyGroupFactory(dt,rt),Et=[],St,At=_.ef.length;for(St=0;St<At;St+=1)_.ef[St].ty===5?Et.push(s(_.ef[St],$.effectElements[St],$.effectElements[St].propertyGroup,c)):Et.push(a($.effectElements[St],_.ef[St].ty,c,ht));return _.mn==="ADBE Color Control"&&Object.defineProperty(dt,"color",{get:function(){return Et[0]()}}),Object.defineProperties(dt,{numProperties:{get:function(){return _.np}},_name:{value:_.nm},propertyGroup:{value:ht}}),dt.enabled=_.en!==0,dt.active=dt.enabled,dt}function a(_,$,rt,c){var dt=ExpressionPropertyInterface(_.p);function ht(){return $===10?rt.comp.compInterface(_.p.v):dt()}return _.p.setGroupProperty&&_.p.setGroupProperty(PropertyInterface("",c)),ht}return e}(),ShapePathInterface=function(){return function(i,s,a){var _=s.sh;function $(c){return c==="Shape"||c==="shape"||c==="Path"||c==="path"||c==="ADBE Vector Shape"||c===2?$.path:null}var rt=propertyGroupFactory($,a);return _.setGroupProperty(PropertyInterface("Path",rt)),Object.defineProperties($,{path:{get:function(){return _.k&&_.getValue(),_}},shape:{get:function(){return _.k&&_.getValue(),_}},_name:{value:i.nm},ix:{value:i.ix},propertyIndex:{value:i.ix},mn:{value:i.mn},propertyGroup:{value:a}}),$}}(),ShapeExpressionInterface=function(){function e(Vt,Bt,Zt){var zt=[],Ut,Nt=Vt?Vt.length:0;for(Ut=0;Ut<Nt;Ut+=1)Vt[Ut].ty==="gr"?zt.push(s(Vt[Ut],Bt[Ut],Zt)):Vt[Ut].ty==="fl"?zt.push(a(Vt[Ut],Bt[Ut],Zt)):Vt[Ut].ty==="st"?zt.push(rt(Vt[Ut],Bt[Ut],Zt)):Vt[Ut].ty==="tm"?zt.push(c(Vt[Ut],Bt[Ut],Zt)):Vt[Ut].ty==="tr"||(Vt[Ut].ty==="el"?zt.push(ht(Vt[Ut],Bt[Ut],Zt)):Vt[Ut].ty==="sr"?zt.push(Et(Vt[Ut],Bt[Ut],Zt)):Vt[Ut].ty==="sh"?zt.push(ShapePathInterface(Vt[Ut],Bt[Ut],Zt)):Vt[Ut].ty==="rc"?zt.push(St(Vt[Ut],Bt[Ut],Zt)):Vt[Ut].ty==="rd"?zt.push(At(Vt[Ut],Bt[Ut],Zt)):Vt[Ut].ty==="rp"?zt.push(Pt(Vt[Ut],Bt[Ut],Zt)):Vt[Ut].ty==="gf"?zt.push(_(Vt[Ut],Bt[Ut],Zt)):zt.push($(Vt[Ut],Bt[Ut])));return zt}function i(Vt,Bt,Zt){var zt,Ut=function(er){for(var ir=0,or=zt.length;ir<or;){if(zt[ir]._name===er||zt[ir].mn===er||zt[ir].propertyIndex===er||zt[ir].ix===er||zt[ir].ind===er)return zt[ir];ir+=1}return typeof er=="number"?zt[er-1]:null};Ut.propertyGroup=propertyGroupFactory(Ut,Zt),zt=e(Vt.it,Bt.it,Ut.propertyGroup),Ut.numProperties=zt.length;var Nt=dt(Vt.it[Vt.it.length-1],Bt.it[Bt.it.length-1],Ut.propertyGroup);return Ut.transform=Nt,Ut.propertyIndex=Vt.cix,Ut._name=Vt.nm,Ut}function s(Vt,Bt,Zt){var zt=function(er){switch(er){case"ADBE Vectors Group":case"Contents":case 2:return zt.content;default:return zt.transform}};zt.propertyGroup=propertyGroupFactory(zt,Zt);var Ut=i(Vt,Bt,zt.propertyGroup),Nt=dt(Vt.it[Vt.it.length-1],Bt.it[Bt.it.length-1],zt.propertyGroup);return zt.content=Ut,zt.transform=Nt,Object.defineProperty(zt,"_name",{get:function(){return Vt.nm}}),zt.numProperties=Vt.np,zt.propertyIndex=Vt.ix,zt.nm=Vt.nm,zt.mn=Vt.mn,zt}function a(Vt,Bt,Zt){function zt(Ut){return Ut==="Color"||Ut==="color"?zt.color:Ut==="Opacity"||Ut==="opacity"?zt.opacity:null}return Object.defineProperties(zt,{color:{get:ExpressionPropertyInterface(Bt.c)},opacity:{get:ExpressionPropertyInterface(Bt.o)},_name:{value:Vt.nm},mn:{value:Vt.mn}}),Bt.c.setGroupProperty(PropertyInterface("Color",Zt)),Bt.o.setGroupProperty(PropertyInterface("Opacity",Zt)),zt}function _(Vt,Bt,Zt){function zt(Ut){return Ut==="Start Point"||Ut==="start point"?zt.startPoint:Ut==="End Point"||Ut==="end point"?zt.endPoint:Ut==="Opacity"||Ut==="opacity"?zt.opacity:null}return Object.defineProperties(zt,{startPoint:{get:ExpressionPropertyInterface(Bt.s)},endPoint:{get:ExpressionPropertyInterface(Bt.e)},opacity:{get:ExpressionPropertyInterface(Bt.o)},type:{get:function(){return"a"}},_name:{value:Vt.nm},mn:{value:Vt.mn}}),Bt.s.setGroupProperty(PropertyInterface("Start Point",Zt)),Bt.e.setGroupProperty(PropertyInterface("End Point",Zt)),Bt.o.setGroupProperty(PropertyInterface("Opacity",Zt)),zt}function $(){function Vt(){return null}return Vt}function rt(Vt,Bt,Zt){var zt=propertyGroupFactory(or,Zt),Ut=propertyGroupFactory(ir,zt);function Nt(mr){Object.defineProperty(ir,Vt.d[mr].nm,{get:ExpressionPropertyInterface(Bt.d.dataProps[mr].p)})}var Gt,er=Vt.d?Vt.d.length:0,ir={};for(Gt=0;Gt<er;Gt+=1)Nt(Gt),Bt.d.dataProps[Gt].p.setGroupProperty(Ut);function or(mr){return mr==="Color"||mr==="color"?or.color:mr==="Opacity"||mr==="opacity"?or.opacity:mr==="Stroke Width"||mr==="stroke width"?or.strokeWidth:null}return Object.defineProperties(or,{color:{get:ExpressionPropertyInterface(Bt.c)},opacity:{get:ExpressionPropertyInterface(Bt.o)},strokeWidth:{get:ExpressionPropertyInterface(Bt.w)},dash:{get:function(){return ir}},_name:{value:Vt.nm},mn:{value:Vt.mn}}),Bt.c.setGroupProperty(PropertyInterface("Color",zt)),Bt.o.setGroupProperty(PropertyInterface("Opacity",zt)),Bt.w.setGroupProperty(PropertyInterface("Stroke Width",zt)),or}function c(Vt,Bt,Zt){function zt(Nt){return Nt===Vt.e.ix||Nt==="End"||Nt==="end"?zt.end:Nt===Vt.s.ix?zt.start:Nt===Vt.o.ix?zt.offset:null}var Ut=propertyGroupFactory(zt,Zt);return zt.propertyIndex=Vt.ix,Bt.s.setGroupProperty(PropertyInterface("Start",Ut)),Bt.e.setGroupProperty(PropertyInterface("End",Ut)),Bt.o.setGroupProperty(PropertyInterface("Offset",Ut)),zt.propertyIndex=Vt.ix,zt.propertyGroup=Zt,Object.defineProperties(zt,{start:{get:ExpressionPropertyInterface(Bt.s)},end:{get:ExpressionPropertyInterface(Bt.e)},offset:{get:ExpressionPropertyInterface(Bt.o)},_name:{value:Vt.nm}}),zt.mn=Vt.mn,zt}function dt(Vt,Bt,Zt){function zt(Nt){return Vt.a.ix===Nt||Nt==="Anchor Point"?zt.anchorPoint:Vt.o.ix===Nt||Nt==="Opacity"?zt.opacity:Vt.p.ix===Nt||Nt==="Position"?zt.position:Vt.r.ix===Nt||Nt==="Rotation"||Nt==="ADBE Vector Rotation"?zt.rotation:Vt.s.ix===Nt||Nt==="Scale"?zt.scale:Vt.sk&&Vt.sk.ix===Nt||Nt==="Skew"?zt.skew:Vt.sa&&Vt.sa.ix===Nt||Nt==="Skew Axis"?zt.skewAxis:null}var Ut=propertyGroupFactory(zt,Zt);return Bt.transform.mProps.o.setGroupProperty(PropertyInterface("Opacity",Ut)),Bt.transform.mProps.p.setGroupProperty(PropertyInterface("Position",Ut)),Bt.transform.mProps.a.setGroupProperty(PropertyInterface("Anchor Point",Ut)),Bt.transform.mProps.s.setGroupProperty(PropertyInterface("Scale",Ut)),Bt.transform.mProps.r.setGroupProperty(PropertyInterface("Rotation",Ut)),Bt.transform.mProps.sk&&(Bt.transform.mProps.sk.setGroupProperty(PropertyInterface("Skew",Ut)),Bt.transform.mProps.sa.setGroupProperty(PropertyInterface("Skew Angle",Ut))),Bt.transform.op.setGroupProperty(PropertyInterface("Opacity",Ut)),Object.defineProperties(zt,{opacity:{get:ExpressionPropertyInterface(Bt.transform.mProps.o)},position:{get:ExpressionPropertyInterface(Bt.transform.mProps.p)},anchorPoint:{get:ExpressionPropertyInterface(Bt.transform.mProps.a)},scale:{get:ExpressionPropertyInterface(Bt.transform.mProps.s)},rotation:{get:ExpressionPropertyInterface(Bt.transform.mProps.r)},skew:{get:ExpressionPropertyInterface(Bt.transform.mProps.sk)},skewAxis:{get:ExpressionPropertyInterface(Bt.transform.mProps.sa)},_name:{value:Vt.nm}}),zt.ty="tr",zt.mn=Vt.mn,zt.propertyGroup=Zt,zt}function ht(Vt,Bt,Zt){function zt(Gt){return Vt.p.ix===Gt?zt.position:Vt.s.ix===Gt?zt.size:null}var Ut=propertyGroupFactory(zt,Zt);zt.propertyIndex=Vt.ix;var Nt=Bt.sh.ty==="tm"?Bt.sh.prop:Bt.sh;return Nt.s.setGroupProperty(PropertyInterface("Size",Ut)),Nt.p.setGroupProperty(PropertyInterface("Position",Ut)),Object.defineProperties(zt,{size:{get:ExpressionPropertyInterface(Nt.s)},position:{get:ExpressionPropertyInterface(Nt.p)},_name:{value:Vt.nm}}),zt.mn=Vt.mn,zt}function Et(Vt,Bt,Zt){function zt(Gt){return Vt.p.ix===Gt?zt.position:Vt.r.ix===Gt?zt.rotation:Vt.pt.ix===Gt?zt.points:Vt.or.ix===Gt||Gt==="ADBE Vector Star Outer Radius"?zt.outerRadius:Vt.os.ix===Gt?zt.outerRoundness:Vt.ir&&(Vt.ir.ix===Gt||Gt==="ADBE Vector Star Inner Radius")?zt.innerRadius:Vt.is&&Vt.is.ix===Gt?zt.innerRoundness:null}var Ut=propertyGroupFactory(zt,Zt),Nt=Bt.sh.ty==="tm"?Bt.sh.prop:Bt.sh;return zt.propertyIndex=Vt.ix,Nt.or.setGroupProperty(PropertyInterface("Outer Radius",Ut)),Nt.os.setGroupProperty(PropertyInterface("Outer Roundness",Ut)),Nt.pt.setGroupProperty(PropertyInterface("Points",Ut)),Nt.p.setGroupProperty(PropertyInterface("Position",Ut)),Nt.r.setGroupProperty(PropertyInterface("Rotation",Ut)),Vt.ir&&(Nt.ir.setGroupProperty(PropertyInterface("Inner Radius",Ut)),Nt.is.setGroupProperty(PropertyInterface("Inner Roundness",Ut))),Object.defineProperties(zt,{position:{get:ExpressionPropertyInterface(Nt.p)},rotation:{get:ExpressionPropertyInterface(Nt.r)},points:{get:ExpressionPropertyInterface(Nt.pt)},outerRadius:{get:ExpressionPropertyInterface(Nt.or)},outerRoundness:{get:ExpressionPropertyInterface(Nt.os)},innerRadius:{get:ExpressionPropertyInterface(Nt.ir)},innerRoundness:{get:ExpressionPropertyInterface(Nt.is)},_name:{value:Vt.nm}}),zt.mn=Vt.mn,zt}function St(Vt,Bt,Zt){function zt(Gt){return Vt.p.ix===Gt?zt.position:Vt.r.ix===Gt?zt.roundness:Vt.s.ix===Gt||Gt==="Size"||Gt==="ADBE Vector Rect Size"?zt.size:null}var Ut=propertyGroupFactory(zt,Zt),Nt=Bt.sh.ty==="tm"?Bt.sh.prop:Bt.sh;return zt.propertyIndex=Vt.ix,Nt.p.setGroupProperty(PropertyInterface("Position",Ut)),Nt.s.setGroupProperty(PropertyInterface("Size",Ut)),Nt.r.setGroupProperty(PropertyInterface("Rotation",Ut)),Object.defineProperties(zt,{position:{get:ExpressionPropertyInterface(Nt.p)},roundness:{get:ExpressionPropertyInterface(Nt.r)},size:{get:ExpressionPropertyInterface(Nt.s)},_name:{value:Vt.nm}}),zt.mn=Vt.mn,zt}function At(Vt,Bt,Zt){function zt(Gt){return Vt.r.ix===Gt||Gt==="Round Corners 1"?zt.radius:null}var Ut=propertyGroupFactory(zt,Zt),Nt=Bt;return zt.propertyIndex=Vt.ix,Nt.rd.setGroupProperty(PropertyInterface("Radius",Ut)),Object.defineProperties(zt,{radius:{get:ExpressionPropertyInterface(Nt.rd)},_name:{value:Vt.nm}}),zt.mn=Vt.mn,zt}function Pt(Vt,Bt,Zt){function zt(Gt){return Vt.c.ix===Gt||Gt==="Copies"?zt.copies:Vt.o.ix===Gt||Gt==="Offset"?zt.offset:null}var Ut=propertyGroupFactory(zt,Zt),Nt=Bt;return zt.propertyIndex=Vt.ix,Nt.c.setGroupProperty(PropertyInterface("Copies",Ut)),Nt.o.setGroupProperty(PropertyInterface("Offset",Ut)),Object.defineProperties(zt,{copies:{get:ExpressionPropertyInterface(Nt.c)},offset:{get:ExpressionPropertyInterface(Nt.o)},_name:{value:Vt.nm}}),zt.mn=Vt.mn,zt}return function(Vt,Bt,Zt){var zt;function Ut(Gt){if(typeof Gt=="number")return Gt=Gt===void 0?1:Gt,Gt===0?Zt:zt[Gt-1];for(var er=0,ir=zt.length;er<ir;){if(zt[er]._name===Gt)return zt[er];er+=1}return null}function Nt(){return Zt}return Ut.propertyGroup=propertyGroupFactory(Ut,Nt),zt=e(Vt,Bt,Ut.propertyGroup),Ut.numProperties=zt.length,Ut._name="Contents",Ut}}(),TextExpressionInterface=function(){return function(e){var i;function s(a){switch(a){case"ADBE Text Document":return s.sourceText;default:return null}}return Object.defineProperty(s,"sourceText",{get:function(){e.textProperty.getValue();var _=e.textProperty.currentData.t;return(!i||_!==i.value)&&(i=new String(_),i.value=_||new String(_),Object.defineProperty(i,"style",{get:function(){return{fillColor:e.textProperty.currentData.fc}}})),i}}),s}}();function _typeof(e){"@babel/helpers - typeof";return _typeof=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},_typeof(e)}var FootageInterface=function(){var e=function(a){var _="",$=a.getFootageData();function rt(){return _="",$=a.getFootageData(),c}function c(dt){if($[dt])return _=dt,$=$[dt],_typeof($)==="object"?c:$;var ht=dt.indexOf(_);if(ht!==-1){var Et=parseInt(dt.substr(ht+_.length),10);return $=$[Et],_typeof($)==="object"?c:$}return""}return rt},i=function(a){function _($){return $==="Outline"?_.outlineInterface():null}return _._name="Outline",_.outlineInterface=e(a),_};return function(s){function a(_){return _==="Data"?a.dataInterface:null}return a._name="Data",a.dataInterface=i(s),a}}(),interfaces={layer:LayerExpressionInterface,effects:EffectsExpressionInterface,comp:CompExpressionInterface,shape:ShapeExpressionInterface,text:TextExpressionInterface,footage:FootageInterface};function getInterface(e){return interfaces[e]||null}var expressionHelpers=function(){function e(rt,c,dt){c.x&&(dt.k=!0,dt.x=!0,dt.initiateExpression=ExpressionManager.initiateExpression,dt.effectsSequence.push(dt.initiateExpression(rt,c,dt).bind(dt)))}function i(rt){return rt*=this.elem.globalData.frameRate,rt-=this.offsetTime,rt!==this._cachingAtTime.lastFrame&&(this._cachingAtTime.lastIndex=this._cachingAtTime.lastFrame<rt?this._cachingAtTime.lastIndex:0,this._cachingAtTime.value=this.interpolateValue(rt,this._cachingAtTime),this._cachingAtTime.lastFrame=rt),this._cachingAtTime.value}function s(rt){var c=-.01,dt=this.getValueAtTime(rt),ht=this.getValueAtTime(rt+c),Et=0;if(dt.length){var St;for(St=0;St<dt.length;St+=1)Et+=Math.pow(ht[St]-dt[St],2);Et=Math.sqrt(Et)*100}else Et=0;return Et}function a(rt){if(this.vel!==void 0)return this.vel;var c=-.001,dt=this.getValueAtTime(rt),ht=this.getValueAtTime(rt+c),Et;if(dt.length){Et=createTypedArray("float32",dt.length);var St;for(St=0;St<dt.length;St+=1)Et[St]=(ht[St]-dt[St])/c}else Et=(ht-dt)/c;return Et}function _(){return this.pv}function $(rt){this.propertyGroup=rt}return{searchExpressions:e,getSpeedAtTime:s,getVelocityAtTime:a,getValueAtTime:i,getStaticValueAtTime:_,setGroupProperty:$}}();function addPropertyDecorator(){function e(At,Pt,Vt){if(!this.k||!this.keyframes)return this.pv;At=At?At.toLowerCase():"";var Bt=this.comp.renderedFrame,Zt=this.keyframes,zt=Zt[Zt.length-1].t;if(Bt<=zt)return this.pv;var Ut,Nt;Vt?(Pt?Ut=Math.abs(zt-this.elem.comp.globalData.frameRate*Pt):Ut=Math.max(0,zt-this.elem.data.ip),Nt=zt-Ut):((!Pt||Pt>Zt.length-1)&&(Pt=Zt.length-1),Nt=Zt[Zt.length-1-Pt].t,Ut=zt-Nt);var Gt,er,ir;if(At==="pingpong"){var or=Math.floor((Bt-Nt)/Ut);if(or%2!==0)return this.getValueAtTime((Ut-(Bt-Nt)%Ut+Nt)/this.comp.globalData.frameRate,0)}else if(At==="offset"){var mr=this.getValueAtTime(Nt/this.comp.globalData.frameRate,0),Rr=this.getValueAtTime(zt/this.comp.globalData.frameRate,0),on=this.getValueAtTime(((Bt-Nt)%Ut+Nt)/this.comp.globalData.frameRate,0),un=Math.floor((Bt-Nt)/Ut);if(this.pv.length){for(ir=new Array(mr.length),er=ir.length,Gt=0;Gt<er;Gt+=1)ir[Gt]=(Rr[Gt]-mr[Gt])*un+on[Gt];return ir}return(Rr-mr)*un+on}else if(At==="continue"){var jr=this.getValueAtTime(zt/this.comp.globalData.frameRate,0),Jr=this.getValueAtTime((zt-.001)/this.comp.globalData.frameRate,0);if(this.pv.length){for(ir=new Array(jr.length),er=ir.length,Gt=0;Gt<er;Gt+=1)ir[Gt]=jr[Gt]+(jr[Gt]-Jr[Gt])*((Bt-zt)/this.comp.globalData.frameRate)/5e-4;return ir}return jr+(jr-Jr)*((Bt-zt)/.001)}return this.getValueAtTime(((Bt-Nt)%Ut+Nt)/this.comp.globalData.frameRate,0)}function i(At,Pt,Vt){if(!this.k)return this.pv;At=At?At.toLowerCase():"";var Bt=this.comp.renderedFrame,Zt=this.keyframes,zt=Zt[0].t;if(Bt>=zt)return this.pv;var Ut,Nt;Vt?(Pt?Ut=Math.abs(this.elem.comp.globalData.frameRate*Pt):Ut=Math.max(0,this.elem.data.op-zt),Nt=zt+Ut):((!Pt||Pt>Zt.length-1)&&(Pt=Zt.length-1),Nt=Zt[Pt].t,Ut=Nt-zt);var Gt,er,ir;if(At==="pingpong"){var or=Math.floor((zt-Bt)/Ut);if(or%2===0)return this.getValueAtTime(((zt-Bt)%Ut+zt)/this.comp.globalData.frameRate,0)}else if(At==="offset"){var mr=this.getValueAtTime(zt/this.comp.globalData.frameRate,0),Rr=this.getValueAtTime(Nt/this.comp.globalData.frameRate,0),on=this.getValueAtTime((Ut-(zt-Bt)%Ut+zt)/this.comp.globalData.frameRate,0),un=Math.floor((zt-Bt)/Ut)+1;if(this.pv.length){for(ir=new Array(mr.length),er=ir.length,Gt=0;Gt<er;Gt+=1)ir[Gt]=on[Gt]-(Rr[Gt]-mr[Gt])*un;return ir}return on-(Rr-mr)*un}else if(At==="continue"){var jr=this.getValueAtTime(zt/this.comp.globalData.frameRate,0),Jr=this.getValueAtTime((zt+.001)/this.comp.globalData.frameRate,0);if(this.pv.length){for(ir=new Array(jr.length),er=ir.length,Gt=0;Gt<er;Gt+=1)ir[Gt]=jr[Gt]+(jr[Gt]-Jr[Gt])*(zt-Bt)/.001;return ir}return jr+(jr-Jr)*(zt-Bt)/.001}return this.getValueAtTime((Ut-((zt-Bt)%Ut+zt))/this.comp.globalData.frameRate,0)}function s(At,Pt){if(!this.k)return this.pv;if(At=(At||.4)*.5,Pt=Math.floor(Pt||5),Pt<=1)return this.pv;var Vt=this.comp.renderedFrame/this.comp.globalData.frameRate,Bt=Vt-At,Zt=Vt+At,zt=Pt>1?(Zt-Bt)/(Pt-1):1,Ut=0,Nt=0,Gt;this.pv.length?Gt=createTypedArray("float32",this.pv.length):Gt=0;for(var er;Ut<Pt;){if(er=this.getValueAtTime(Bt+Ut*zt),this.pv.length)for(Nt=0;Nt<this.pv.length;Nt+=1)Gt[Nt]+=er[Nt];else Gt+=er;Ut+=1}if(this.pv.length)for(Nt=0;Nt<this.pv.length;Nt+=1)Gt[Nt]/=Pt;else Gt/=Pt;return Gt}function a(At){this._transformCachingAtTime||(this._transformCachingAtTime={v:new Matrix});var Pt=this._transformCachingAtTime.v;if(Pt.cloneFromProps(this.pre.props),this.appliedTransformations<1){var Vt=this.a.getValueAtTime(At);Pt.translate(-Vt[0]*this.a.mult,-Vt[1]*this.a.mult,Vt[2]*this.a.mult)}if(this.appliedTransformations<2){var Bt=this.s.getValueAtTime(At);Pt.scale(Bt[0]*this.s.mult,Bt[1]*this.s.mult,Bt[2]*this.s.mult)}if(this.sk&&this.appliedTransformations<3){var Zt=this.sk.getValueAtTime(At),zt=this.sa.getValueAtTime(At);Pt.skewFromAxis(-Zt*this.sk.mult,zt*this.sa.mult)}if(this.r&&this.appliedTransformations<4){var Ut=this.r.getValueAtTime(At);Pt.rotate(-Ut*this.r.mult)}else if(!this.r&&this.appliedTransformations<4){var Nt=this.rz.getValueAtTime(At),Gt=this.ry.getValueAtTime(At),er=this.rx.getValueAtTime(At),ir=this.or.getValueAtTime(At);Pt.rotateZ(-Nt*this.rz.mult).rotateY(Gt*this.ry.mult).rotateX(er*this.rx.mult).rotateZ(-ir[2]*this.or.mult).rotateY(ir[1]*this.or.mult).rotateX(ir[0]*this.or.mult)}if(this.data.p&&this.data.p.s){var or=this.px.getValueAtTime(At),mr=this.py.getValueAtTime(At);if(this.data.p.z){var Rr=this.pz.getValueAtTime(At);Pt.translate(or*this.px.mult,mr*this.py.mult,-Rr*this.pz.mult)}else Pt.translate(or*this.px.mult,mr*this.py.mult,0)}else{var on=this.p.getValueAtTime(At);Pt.translate(on[0]*this.p.mult,on[1]*this.p.mult,-on[2]*this.p.mult)}return Pt}function _(){return this.v.clone(new Matrix)}var $=TransformPropertyFactory.getTransformProperty;TransformPropertyFactory.getTransformProperty=function(At,Pt,Vt){var Bt=$(At,Pt,Vt);return Bt.dynamicProperties.length?Bt.getValueAtTime=a.bind(Bt):Bt.getValueAtTime=_.bind(Bt),Bt.setGroupProperty=expressionHelpers.setGroupProperty,Bt};var rt=PropertyFactory.getProp;PropertyFactory.getProp=function(At,Pt,Vt,Bt,Zt){var zt=rt(At,Pt,Vt,Bt,Zt);zt.kf?zt.getValueAtTime=expressionHelpers.getValueAtTime.bind(zt):zt.getValueAtTime=expressionHelpers.getStaticValueAtTime.bind(zt),zt.setGroupProperty=expressionHelpers.setGroupProperty,zt.loopOut=e,zt.loopIn=i,zt.smooth=s,zt.getVelocityAtTime=expressionHelpers.getVelocityAtTime.bind(zt),zt.getSpeedAtTime=expressionHelpers.getSpeedAtTime.bind(zt),zt.numKeys=Pt.a===1?Pt.k.length:0,zt.propertyIndex=Pt.ix;var Ut=0;return Vt!==0&&(Ut=createTypedArray("float32",Pt.a===1?Pt.k[0].s.length:Pt.k.length)),zt._cachingAtTime={lastFrame:initialDefaultFrame,lastIndex:0,value:Ut},expressionHelpers.searchExpressions(At,Pt,zt),zt.k&&Zt.addDynamicProperty(zt),zt};function c(At){return this._cachingAtTime||(this._cachingAtTime={shapeValue:shapePool.clone(this.pv),lastIndex:0,lastTime:initialDefaultFrame}),At*=this.elem.globalData.frameRate,At-=this.offsetTime,At!==this._cachingAtTime.lastTime&&(this._cachingAtTime.lastIndex=this._cachingAtTime.lastTime<At?this._caching.lastIndex:0,this._cachingAtTime.lastTime=At,this.interpolateShape(At,this._cachingAtTime.shapeValue,this._cachingAtTime)),this._cachingAtTime.shapeValue}var dt=ShapePropertyFactory.getConstructorFunction(),ht=ShapePropertyFactory.getKeyframedConstructorFunction();function Et(){}Et.prototype={vertices:function(Pt,Vt){this.k&&this.getValue();var Bt=this.v;Vt!==void 0&&(Bt=this.getValueAtTime(Vt,0));var Zt,zt=Bt._length,Ut=Bt[Pt],Nt=Bt.v,Gt=createSizedArray(zt);for(Zt=0;Zt<zt;Zt+=1)Pt==="i"||Pt==="o"?Gt[Zt]=[Ut[Zt][0]-Nt[Zt][0],Ut[Zt][1]-Nt[Zt][1]]:Gt[Zt]=[Ut[Zt][0],Ut[Zt][1]];return Gt},points:function(Pt){return this.vertices("v",Pt)},inTangents:function(Pt){return this.vertices("i",Pt)},outTangents:function(Pt){return this.vertices("o",Pt)},isClosed:function(){return this.v.c},pointOnPath:function(Pt,Vt){var Bt=this.v;Vt!==void 0&&(Bt=this.getValueAtTime(Vt,0)),this._segmentsLength||(this._segmentsLength=bez.getSegmentsLength(Bt));for(var Zt=this._segmentsLength,zt=Zt.lengths,Ut=Zt.totalLength*Pt,Nt=0,Gt=zt.length,er=0,ir;Nt<Gt;){if(er+zt[Nt].addedLength>Ut){var or=Nt,mr=Bt.c&&Nt===Gt-1?0:Nt+1,Rr=(Ut-er)/zt[Nt].addedLength;ir=bez.getPointInSegment(Bt.v[or],Bt.v[mr],Bt.o[or],Bt.i[mr],Rr,zt[Nt]);break}else er+=zt[Nt].addedLength;Nt+=1}return ir||(ir=Bt.c?[Bt.v[0][0],Bt.v[0][1]]:[Bt.v[Bt._length-1][0],Bt.v[Bt._length-1][1]]),ir},vectorOnPath:function(Pt,Vt,Bt){Pt==1?Pt=this.v.c:Pt==0&&(Pt=.999);var Zt=this.pointOnPath(Pt,Vt),zt=this.pointOnPath(Pt+.001,Vt),Ut=zt[0]-Zt[0],Nt=zt[1]-Zt[1],Gt=Math.sqrt(Math.pow(Ut,2)+Math.pow(Nt,2));if(Gt===0)return[0,0];var er=Bt==="tangent"?[Ut/Gt,Nt/Gt]:[-Nt/Gt,Ut/Gt];return er},tangentOnPath:function(Pt,Vt){return this.vectorOnPath(Pt,Vt,"tangent")},normalOnPath:function(Pt,Vt){return this.vectorOnPath(Pt,Vt,"normal")},setGroupProperty:expressionHelpers.setGroupProperty,getValueAtTime:expressionHelpers.getStaticValueAtTime},extendPrototype([Et],dt),extendPrototype([Et],ht),ht.prototype.getValueAtTime=c,ht.prototype.initiateExpression=ExpressionManager.initiateExpression;var St=ShapePropertyFactory.getShapeProp;ShapePropertyFactory.getShapeProp=function(At,Pt,Vt,Bt,Zt){var zt=St(At,Pt,Vt,Bt,Zt);return zt.propertyIndex=Pt.ix,zt.lock=!1,Vt===3?expressionHelpers.searchExpressions(At,Pt.pt,zt):Vt===4&&expressionHelpers.searchExpressions(At,Pt.ks,zt),zt.k&&At.addDynamicProperty(zt),zt}}function initialize$1(){addPropertyDecorator()}function addDecorator(){function e(){return this.data.d.x?(this.calculateExpression=ExpressionManager.initiateExpression.bind(this)(this.elem,this.data.d,this),this.addEffect(this.getExpressionValue.bind(this)),!0):null}TextProperty.prototype.getExpressionValue=function(i,s){var a=this.calculateExpression(s);if(i.t!==a){var _={};return this.copyData(_,i),_.t=a.toString(),_.__complete=!1,_}return i},TextProperty.prototype.searchProperty=function(){var i=this.searchKeyframes(),s=this.searchExpressions();return this.kf=i||s,this.kf},TextProperty.prototype.searchExpressions=e}function initialize(){addDecorator()}function SVGComposableEffect(){}SVGComposableEffect.prototype={createMergeNode:function e(i,s){var a=createNS("feMerge");a.setAttribute("result",i);var _,$;for($=0;$<s.length;$+=1)_=createNS("feMergeNode"),_.setAttribute("in",s[$]),a.appendChild(_),a.appendChild(_);return a}};var linearFilterValue="0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0 0 0";function SVGTintFilter(e,i,s,a,_){this.filterManager=i;var $=createNS("feColorMatrix");$.setAttribute("type","matrix"),$.setAttribute("color-interpolation-filters","linearRGB"),$.setAttribute("values",linearFilterValue+" 1 0"),this.linearFilter=$,$.setAttribute("result",a+"_tint_1"),e.appendChild($),$=createNS("feColorMatrix"),$.setAttribute("type","matrix"),$.setAttribute("color-interpolation-filters","sRGB"),$.setAttribute("values","1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 1 0"),$.setAttribute("result",a+"_tint_2"),e.appendChild($),this.matrixFilter=$;var rt=this.createMergeNode(a,[_,a+"_tint_1",a+"_tint_2"]);e.appendChild(rt)}extendPrototype([SVGComposableEffect],SVGTintFilter),SVGTintFilter.prototype.renderFrame=function(e){if(e||this.filterManager._mdf){var i=this.filterManager.effectElements[0].p.v,s=this.filterManager.effectElements[1].p.v,a=this.filterManager.effectElements[2].p.v/100;this.linearFilter.setAttribute("values",linearFilterValue+" "+a+" 0"),this.matrixFilter.setAttribute("values",s[0]-i[0]+" 0 0 0 "+i[0]+" "+(s[1]-i[1])+" 0 0 0 "+i[1]+" "+(s[2]-i[2])+" 0 0 0 "+i[2]+" 0 0 0 1 0")}};function SVGFillFilter(e,i,s,a){this.filterManager=i;var _=createNS("feColorMatrix");_.setAttribute("type","matrix"),_.setAttribute("color-interpolation-filters","sRGB"),_.setAttribute("values","1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 1 0"),_.setAttribute("result",a),e.appendChild(_),this.matrixFilter=_}SVGFillFilter.prototype.renderFrame=function(e){if(e||this.filterManager._mdf){var i=this.filterManager.effectElements[2].p.v,s=this.filterManager.effectElements[6].p.v;this.matrixFilter.setAttribute("values","0 0 0 0 "+i[0]+" 0 0 0 0 "+i[1]+" 0 0 0 0 "+i[2]+" 0 0 0 "+s+" 0")}};function SVGStrokeEffect(e,i,s){this.initialized=!1,this.filterManager=i,this.elem=s,this.paths=[]}SVGStrokeEffect.prototype.initialize=function(){var e=this.elem.layerElement.children||this.elem.layerElement.childNodes,i,s,a,_;for(this.filterManager.effectElements[1].p.v===1?(_=this.elem.maskManager.masksProperties.length,a=0):(a=this.filterManager.effectElements[0].p.v-1,_=a+1),s=createNS("g"),s.setAttribute("fill","none"),s.setAttribute("stroke-linecap","round"),s.setAttribute("stroke-dashoffset",1),a;a<_;a+=1)i=createNS("path"),s.appendChild(i),this.paths.push({p:i,m:a});if(this.filterManager.effectElements[10].p.v===3){var $=createNS("mask"),rt=createElementID();$.setAttribute("id",rt),$.setAttribute("mask-type","alpha"),$.appendChild(s),this.elem.globalData.defs.appendChild($);var c=createNS("g");for(c.setAttribute("mask","url("+getLocationHref()+"#"+rt+")");e[0];)c.appendChild(e[0]);this.elem.layerElement.appendChild(c),this.masker=$,s.setAttribute("stroke","#fff")}else if(this.filterManager.effectElements[10].p.v===1||this.filterManager.effectElements[10].p.v===2){if(this.filterManager.effectElements[10].p.v===2)for(e=this.elem.layerElement.children||this.elem.layerElement.childNodes;e.length;)this.elem.layerElement.removeChild(e[0]);this.elem.layerElement.appendChild(s),this.elem.layerElement.removeAttribute("mask"),s.setAttribute("stroke","#fff")}this.initialized=!0,this.pathMasker=s},SVGStrokeEffect.prototype.renderFrame=function(e){this.initialized||this.initialize();var i,s=this.paths.length,a,_;for(i=0;i<s;i+=1)if(this.paths[i].m!==-1&&(a=this.elem.maskManager.viewData[this.paths[i].m],_=this.paths[i].p,(e||this.filterManager._mdf||a.prop._mdf)&&_.setAttribute("d",a.lastPath),e||this.filterManager.effectElements[9].p._mdf||this.filterManager.effectElements[4].p._mdf||this.filterManager.effectElements[7].p._mdf||this.filterManager.effectElements[8].p._mdf||a.prop._mdf)){var $;if(this.filterManager.effectElements[7].p.v!==0||this.filterManager.effectElements[8].p.v!==100){var rt=Math.min(this.filterManager.effectElements[7].p.v,this.filterManager.effectElements[8].p.v)*.01,c=Math.max(this.filterManager.effectElements[7].p.v,this.filterManager.effectElements[8].p.v)*.01,dt=_.getTotalLength();$="0 0 0 "+dt*rt+" ";var ht=dt*(c-rt),Et=1+this.filterManager.effectElements[4].p.v*2*this.filterManager.effectElements[9].p.v*.01,St=Math.floor(ht/Et),At;for(At=0;At<St;At+=1)$+="1 "+this.filterManager.effectElements[4].p.v*2*this.filterManager.effectElements[9].p.v*.01+" ";$+="0 "+dt*10+" 0 0"}else $="1 "+this.filterManager.effectElements[4].p.v*2*this.filterManager.effectElements[9].p.v*.01;_.setAttribute("stroke-dasharray",$)}if((e||this.filterManager.effectElements[4].p._mdf)&&this.pathMasker.setAttribute("stroke-width",this.filterManager.effectElements[4].p.v*2),(e||this.filterManager.effectElements[6].p._mdf)&&this.pathMasker.setAttribute("opacity",this.filterManager.effectElements[6].p.v),(this.filterManager.effectElements[10].p.v===1||this.filterManager.effectElements[10].p.v===2)&&(e||this.filterManager.effectElements[3].p._mdf)){var Pt=this.filterManager.effectElements[3].p.v;this.pathMasker.setAttribute("stroke","rgb("+bmFloor(Pt[0]*255)+","+bmFloor(Pt[1]*255)+","+bmFloor(Pt[2]*255)+")")}};function SVGTritoneFilter(e,i,s,a){this.filterManager=i;var _=createNS("feColorMatrix");_.setAttribute("type","matrix"),_.setAttribute("color-interpolation-filters","linearRGB"),_.setAttribute("values","0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0 0 0 1 0"),e.appendChild(_);var $=createNS("feComponentTransfer");$.setAttribute("color-interpolation-filters","sRGB"),$.setAttribute("result",a),this.matrixFilter=$;var rt=createNS("feFuncR");rt.setAttribute("type","table"),$.appendChild(rt),this.feFuncR=rt;var c=createNS("feFuncG");c.setAttribute("type","table"),$.appendChild(c),this.feFuncG=c;var dt=createNS("feFuncB");dt.setAttribute("type","table"),$.appendChild(dt),this.feFuncB=dt,e.appendChild($)}SVGTritoneFilter.prototype.renderFrame=function(e){if(e||this.filterManager._mdf){var i=this.filterManager.effectElements[0].p.v,s=this.filterManager.effectElements[1].p.v,a=this.filterManager.effectElements[2].p.v,_=a[0]+" "+s[0]+" "+i[0],$=a[1]+" "+s[1]+" "+i[1],rt=a[2]+" "+s[2]+" "+i[2];this.feFuncR.setAttribute("tableValues",_),this.feFuncG.setAttribute("tableValues",$),this.feFuncB.setAttribute("tableValues",rt)}};function SVGProLevelsFilter(e,i,s,a){this.filterManager=i;var _=this.filterManager.effectElements,$=createNS("feComponentTransfer");(_[10].p.k||_[10].p.v!==0||_[11].p.k||_[11].p.v!==1||_[12].p.k||_[12].p.v!==1||_[13].p.k||_[13].p.v!==0||_[14].p.k||_[14].p.v!==1)&&(this.feFuncR=this.createFeFunc("feFuncR",$)),(_[17].p.k||_[17].p.v!==0||_[18].p.k||_[18].p.v!==1||_[19].p.k||_[19].p.v!==1||_[20].p.k||_[20].p.v!==0||_[21].p.k||_[21].p.v!==1)&&(this.feFuncG=this.createFeFunc("feFuncG",$)),(_[24].p.k||_[24].p.v!==0||_[25].p.k||_[25].p.v!==1||_[26].p.k||_[26].p.v!==1||_[27].p.k||_[27].p.v!==0||_[28].p.k||_[28].p.v!==1)&&(this.feFuncB=this.createFeFunc("feFuncB",$)),(_[31].p.k||_[31].p.v!==0||_[32].p.k||_[32].p.v!==1||_[33].p.k||_[33].p.v!==1||_[34].p.k||_[34].p.v!==0||_[35].p.k||_[35].p.v!==1)&&(this.feFuncA=this.createFeFunc("feFuncA",$)),(this.feFuncR||this.feFuncG||this.feFuncB||this.feFuncA)&&($.setAttribute("color-interpolation-filters","sRGB"),e.appendChild($)),(_[3].p.k||_[3].p.v!==0||_[4].p.k||_[4].p.v!==1||_[5].p.k||_[5].p.v!==1||_[6].p.k||_[6].p.v!==0||_[7].p.k||_[7].p.v!==1)&&($=createNS("feComponentTransfer"),$.setAttribute("color-interpolation-filters","sRGB"),$.setAttribute("result",a),e.appendChild($),this.feFuncRComposed=this.createFeFunc("feFuncR",$),this.feFuncGComposed=this.createFeFunc("feFuncG",$),this.feFuncBComposed=this.createFeFunc("feFuncB",$))}SVGProLevelsFilter.prototype.createFeFunc=function(e,i){var s=createNS(e);return s.setAttribute("type","table"),i.appendChild(s),s},SVGProLevelsFilter.prototype.getTableValue=function(e,i,s,a,_){for(var $=0,rt=256,c,dt=Math.min(e,i),ht=Math.max(e,i),Et=Array.call(null,{length:rt}),St,At=0,Pt=_-a,Vt=i-e;$<=256;)c=$/256,c<=dt?St=Vt<0?_:a:c>=ht?St=Vt<0?a:_:St=a+Pt*Math.pow((c-e)/Vt,1/s),Et[At]=St,At+=1,$+=256/(rt-1);return Et.join(" ")},SVGProLevelsFilter.prototype.renderFrame=function(e){if(e||this.filterManager._mdf){var i,s=this.filterManager.effectElements;this.feFuncRComposed&&(e||s[3].p._mdf||s[4].p._mdf||s[5].p._mdf||s[6].p._mdf||s[7].p._mdf)&&(i=this.getTableValue(s[3].p.v,s[4].p.v,s[5].p.v,s[6].p.v,s[7].p.v),this.feFuncRComposed.setAttribute("tableValues",i),this.feFuncGComposed.setAttribute("tableValues",i),this.feFuncBComposed.setAttribute("tableValues",i)),this.feFuncR&&(e||s[10].p._mdf||s[11].p._mdf||s[12].p._mdf||s[13].p._mdf||s[14].p._mdf)&&(i=this.getTableValue(s[10].p.v,s[11].p.v,s[12].p.v,s[13].p.v,s[14].p.v),this.feFuncR.setAttribute("tableValues",i)),this.feFuncG&&(e||s[17].p._mdf||s[18].p._mdf||s[19].p._mdf||s[20].p._mdf||s[21].p._mdf)&&(i=this.getTableValue(s[17].p.v,s[18].p.v,s[19].p.v,s[20].p.v,s[21].p.v),this.feFuncG.setAttribute("tableValues",i)),this.feFuncB&&(e||s[24].p._mdf||s[25].p._mdf||s[26].p._mdf||s[27].p._mdf||s[28].p._mdf)&&(i=this.getTableValue(s[24].p.v,s[25].p.v,s[26].p.v,s[27].p.v,s[28].p.v),this.feFuncB.setAttribute("tableValues",i)),this.feFuncA&&(e||s[31].p._mdf||s[32].p._mdf||s[33].p._mdf||s[34].p._mdf||s[35].p._mdf)&&(i=this.getTableValue(s[31].p.v,s[32].p.v,s[33].p.v,s[34].p.v,s[35].p.v),this.feFuncA.setAttribute("tableValues",i))}};function SVGDropShadowEffect(e,i,s,a,_){var $=i.container.globalData.renderConfig.filterSize,rt=i.data.fs||$;e.setAttribute("x",rt.x||$.x),e.setAttribute("y",rt.y||$.y),e.setAttribute("width",rt.width||$.width),e.setAttribute("height",rt.height||$.height),this.filterManager=i;var c=createNS("feGaussianBlur");c.setAttribute("in","SourceAlpha"),c.setAttribute("result",a+"_drop_shadow_1"),c.setAttribute("stdDeviation","0"),this.feGaussianBlur=c,e.appendChild(c);var dt=createNS("feOffset");dt.setAttribute("dx","25"),dt.setAttribute("dy","0"),dt.setAttribute("in",a+"_drop_shadow_1"),dt.setAttribute("result",a+"_drop_shadow_2"),this.feOffset=dt,e.appendChild(dt);var ht=createNS("feFlood");ht.setAttribute("flood-color","#00ff00"),ht.setAttribute("flood-opacity","1"),ht.setAttribute("result",a+"_drop_shadow_3"),this.feFlood=ht,e.appendChild(ht);var Et=createNS("feComposite");Et.setAttribute("in",a+"_drop_shadow_3"),Et.setAttribute("in2",a+"_drop_shadow_2"),Et.setAttribute("operator","in"),Et.setAttribute("result",a+"_drop_shadow_4"),e.appendChild(Et);var St=this.createMergeNode(a,[a+"_drop_shadow_4",_]);e.appendChild(St)}extendPrototype([SVGComposableEffect],SVGDropShadowEffect),SVGDropShadowEffect.prototype.renderFrame=function(e){if(e||this.filterManager._mdf){if((e||this.filterManager.effectElements[4].p._mdf)&&this.feGaussianBlur.setAttribute("stdDeviation",this.filterManager.effectElements[4].p.v/4),e||this.filterManager.effectElements[0].p._mdf){var i=this.filterManager.effectElements[0].p.v;this.feFlood.setAttribute("flood-color",rgbToHex(Math.round(i[0]*255),Math.round(i[1]*255),Math.round(i[2]*255)))}if((e||this.filterManager.effectElements[1].p._mdf)&&this.feFlood.setAttribute("flood-opacity",this.filterManager.effectElements[1].p.v/255),e||this.filterManager.effectElements[2].p._mdf||this.filterManager.effectElements[3].p._mdf){var s=this.filterManager.effectElements[3].p.v,a=(this.filterManager.effectElements[2].p.v-90)*degToRads,_=s*Math.cos(a),$=s*Math.sin(a);this.feOffset.setAttribute("dx",_),this.feOffset.setAttribute("dy",$)}}};var _svgMatteSymbols=[];function SVGMatte3Effect(e,i,s){this.initialized=!1,this.filterManager=i,this.filterElem=e,this.elem=s,s.matteElement=createNS("g"),s.matteElement.appendChild(s.layerElement),s.matteElement.appendChild(s.transformedElement),s.baseElement=s.matteElement}SVGMatte3Effect.prototype.findSymbol=function(e){for(var i=0,s=_svgMatteSymbols.length;i<s;){if(_svgMatteSymbols[i]===e)return _svgMatteSymbols[i];i+=1}return null},SVGMatte3Effect.prototype.replaceInParent=function(e,i){var s=e.layerElement.parentNode;if(s){for(var a=s.children,_=0,$=a.length;_<$&&a[_]!==e.layerElement;)_+=1;var rt;_<=$-2&&(rt=a[_+1]);var c=createNS("use");c.setAttribute("href","#"+i),rt?s.insertBefore(c,rt):s.appendChild(c)}},SVGMatte3Effect.prototype.setElementAsMask=function(e,i){if(!this.findSymbol(i)){var s=createElementID(),a=createNS("mask");a.setAttribute("id",i.layerId),a.setAttribute("mask-type","alpha"),_svgMatteSymbols.push(i);var _=e.globalData.defs;_.appendChild(a);var $=createNS("symbol");$.setAttribute("id",s),this.replaceInParent(i,s),$.appendChild(i.layerElement),_.appendChild($);var rt=createNS("use");rt.setAttribute("href","#"+s),a.appendChild(rt),i.data.hd=!1,i.show()}e.setMatte(i.layerId)},SVGMatte3Effect.prototype.initialize=function(){for(var e=this.filterManager.effectElements[0].p.v,i=this.elem.comp.elements,s=0,a=i.length;s<a;)i[s]&&i[s].data.ind===e&&this.setElementAsMask(this.elem,i[s]),s+=1;this.initialized=!0},SVGMatte3Effect.prototype.renderFrame=function(){this.initialized||this.initialize()};function SVGGaussianBlurEffect(e,i,s,a){e.setAttribute("x","-100%"),e.setAttribute("y","-100%"),e.setAttribute("width","300%"),e.setAttribute("height","300%"),this.filterManager=i;var _=createNS("feGaussianBlur");_.setAttribute("result",a),e.appendChild(_),this.feGaussianBlur=_}SVGGaussianBlurEffect.prototype.renderFrame=function(e){if(e||this.filterManager._mdf){var i=.3,s=this.filterManager.effectElements[0].p.v*i,a=this.filterManager.effectElements[1].p.v,_=a==3?0:s,$=a==2?0:s;this.feGaussianBlur.setAttribute("stdDeviation",_+" "+$);var rt=this.filterManager.effectElements[2].p.v==1?"wrap":"duplicate";this.feGaussianBlur.setAttribute("edgeMode",rt)}};function TransformEffect(){}TransformEffect.prototype.init=function(e){this.effectsManager=e,this.type=effectTypes.TRANSFORM_EFFECT,this.matrix=new Matrix,this.opacity=-1,this._mdf=!1,this._opMdf=!1},TransformEffect.prototype.renderFrame=function(e){if(this._opMdf=!1,this._mdf=!1,e||this.effectsManager._mdf){var i=this.effectsManager.effectElements,s=i[0].p.v,a=i[1].p.v,_=i[2].p.v===1,$=i[3].p.v,rt=_?$:i[4].p.v,c=i[5].p.v,dt=i[6].p.v,ht=i[7].p.v;this.matrix.reset(),this.matrix.translate(-s[0],-s[1],s[2]),this.matrix.scale(rt*.01,$*.01,1),this.matrix.rotate(-ht*degToRads),this.matrix.skewFromAxis(-c*degToRads,(dt+90)*degToRads),this.matrix.translate(a[0],a[1],0),this._mdf=!0,this.opacity!==i[8].p.v&&(this.opacity=i[8].p.v,this._opMdf=!0)}};function SVGTransformEffect(e,i){this.init(i)}extendPrototype([TransformEffect],SVGTransformEffect);function CVTransformEffect(e){this.init(e)}return extendPrototype([TransformEffect],CVTransformEffect),registerRenderer("canvas",CanvasRenderer),registerRenderer("html",HybridRenderer),registerRenderer("svg",SVGRenderer),ShapeModifiers.registerModifier("tm",TrimModifier),ShapeModifiers.registerModifier("pb",PuckerAndBloatModifier),ShapeModifiers.registerModifier("rp",RepeaterModifier),ShapeModifiers.registerModifier("rd",RoundCornersModifier),ShapeModifiers.registerModifier("zz",ZigZagModifier),ShapeModifiers.registerModifier("op",OffsetPathModifier),setExpressionsPlugin(Expressions),setExpressionInterfaces(getInterface),initialize$1(),initialize(),registerEffect$1(20,SVGTintFilter,!0),registerEffect$1(21,SVGFillFilter,!0),registerEffect$1(22,SVGStrokeEffect,!1),registerEffect$1(23,SVGTritoneFilter,!0),registerEffect$1(24,SVGProLevelsFilter,!0),registerEffect$1(25,SVGDropShadowEffect,!0),registerEffect$1(28,SVGMatte3Effect,!1),registerEffect$1(29,SVGGaussianBlurEffect,!0),registerEffect$1(35,SVGTransformEffect,!1),registerEffect(35,CVTransformEffect),lottie})})(lottie$1,lottie$1.exports);var lottieExports=lottie$1.exports;const lottie=getDefaultExportFromCjs(lottieExports);function _arrayLikeToArray(e,i){(i==null||i>e.length)&&(i=e.length);for(var s=0,a=Array(i);s<i;s++)a[s]=e[s];return a}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _defineProperty(e,i,s){return(i=_toPropertyKey(i))in e?Object.defineProperty(e,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[i]=s,e}function _iterableToArrayLimit(e,i){var s=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(s!=null){var a,_,$,rt,c=[],dt=!0,ht=!1;try{if($=(s=s.call(e)).next,i!==0)for(;!(dt=(a=$.call(s)).done)&&(c.push(a.value),c.length!==i);dt=!0);}catch(Et){ht=!0,_=Et}finally{try{if(!dt&&s.return!=null&&(rt=s.return(),Object(rt)!==rt))return}finally{if(ht)throw _}}return c}}function _nonIterableRest(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ownKeys(e,i){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);i&&(a=a.filter(function(_){return Object.getOwnPropertyDescriptor(e,_).enumerable})),s.push.apply(s,a)}return s}function _objectSpread2(e){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?ownKeys(Object(s),!0).forEach(function(a){_defineProperty(e,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):ownKeys(Object(s)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(s,a))})}return e}function _objectWithoutProperties(e,i){if(e==null)return{};var s,a,_=_objectWithoutPropertiesLoose(e,i);if(Object.getOwnPropertySymbols){var $=Object.getOwnPropertySymbols(e);for(a=0;a<$.length;a++)s=$[a],i.includes(s)||{}.propertyIsEnumerable.call(e,s)&&(_[s]=e[s])}return _}function _objectWithoutPropertiesLoose(e,i){if(e==null)return{};var s={};for(var a in e)if({}.hasOwnProperty.call(e,a)){if(i.includes(a))continue;s[a]=e[a]}return s}function _slicedToArray(e,i){return _arrayWithHoles(e)||_iterableToArrayLimit(e,i)||_unsupportedIterableToArray(e,i)||_nonIterableRest()}function _toPrimitive(e,i){if(typeof e!="object"||!e)return e;var s=e[Symbol.toPrimitive];if(s!==void 0){var a=s.call(e,i||"default");if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(e)}function _toPropertyKey(e){var i=_toPrimitive(e,"string");return typeof i=="symbol"?i:i+""}function _unsupportedIterableToArray(e,i){if(e){if(typeof e=="string")return _arrayLikeToArray(e,i);var s={}.toString.call(e).slice(8,-1);return s==="Object"&&e.constructor&&(s=e.constructor.name),s==="Map"||s==="Set"?Array.from(e):s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s)?_arrayLikeToArray(e,i):void 0}}var _excluded$1=["animationData","loop","autoplay","initialSegment","onComplete","onLoopComplete","onEnterFrame","onSegmentStart","onConfigReady","onDataReady","onDataFailed","onLoadedImages","onDOMLoaded","onDestroy","lottieRef","renderer","name","assetsPath","rendererSettings"],useLottie=function e(i,s){var a=i.animationData,_=i.loop,$=i.autoplay,rt=i.initialSegment,c=i.onComplete,dt=i.onLoopComplete,ht=i.onEnterFrame,Et=i.onSegmentStart,St=i.onConfigReady,At=i.onDataReady,Pt=i.onDataFailed,Vt=i.onLoadedImages,Bt=i.onDOMLoaded,Zt=i.onDestroy;i.lottieRef,i.renderer,i.name,i.assetsPath,i.rendererSettings;var zt=_objectWithoutProperties(i,_excluded$1),Ut=reactExports.useState(!1),Nt=_slicedToArray(Ut,2),Gt=Nt[0],er=Nt[1],ir=reactExports.useRef(),or=reactExports.useRef(null),mr=function(){var _n;(_n=ir.current)===null||_n===void 0||_n.play()},Rr=function(){var _n;(_n=ir.current)===null||_n===void 0||_n.stop()},on=function(){var _n;(_n=ir.current)===null||_n===void 0||_n.pause()},un=function(_n){var gn;(gn=ir.current)===null||gn===void 0||gn.setSpeed(_n)},jr=function(_n,gn){var Sn;(Sn=ir.current)===null||Sn===void 0||Sn.goToAndPlay(_n,gn)},Jr=function(_n,gn){var Sn;(Sn=ir.current)===null||Sn===void 0||Sn.goToAndStop(_n,gn)},fn=function(_n){var gn;(gn=ir.current)===null||gn===void 0||gn.setDirection(_n)},Fr=function(_n,gn){var Sn;(Sn=ir.current)===null||Sn===void 0||Sn.playSegments(_n,gn)},Cr=function(_n){var gn;(gn=ir.current)===null||gn===void 0||gn.setSubframe(_n)},Sr=function(_n){var gn;return(gn=ir.current)===null||gn===void 0?void 0:gn.getDuration(_n)},dr=function(){var _n;(_n=ir.current)===null||_n===void 0||_n.destroy(),ir.current=void 0},gr=function(){var _n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},gn;if(or.current){(gn=ir.current)===null||gn===void 0||gn.destroy();var Sn=_objectSpread2(_objectSpread2(_objectSpread2({},i),_n),{},{container:or.current});return ir.current=lottie.loadAnimation(Sn),er(!!ir.current),function(){var Fs;(Fs=ir.current)===null||Fs===void 0||Fs.destroy(),ir.current=void 0}}};reactExports.useEffect(function(){var Lr=gr();return function(){return Lr==null?void 0:Lr()}},[a,_]),reactExports.useEffect(function(){ir.current&&(ir.current.autoplay=!!$)},[$]),reactExports.useEffect(function(){if(ir.current){if(!rt){ir.current.resetSegments(!0);return}!Array.isArray(rt)||!rt.length||((ir.current.currentRawFrame<rt[0]||ir.current.currentRawFrame>rt[1])&&(ir.current.currentRawFrame=rt[0]),ir.current.setSegment(rt[0],rt[1]))}},[rt]),reactExports.useEffect(function(){var Lr=[{name:"complete",handler:c},{name:"loopComplete",handler:dt},{name:"enterFrame",handler:ht},{name:"segmentStart",handler:Et},{name:"config_ready",handler:St},{name:"data_ready",handler:At},{name:"data_failed",handler:Pt},{name:"loaded_images",handler:Vt},{name:"DOMLoaded",handler:Bt},{name:"destroy",handler:Zt}],_n=Lr.filter(function(Sn){return Sn.handler!=null});if(_n.length){var gn=_n.map(function(Sn){var Fs;return(Fs=ir.current)===null||Fs===void 0||Fs.addEventListener(Sn.name,Sn.handler),function(){var rs;(rs=ir.current)===null||rs===void 0||rs.removeEventListener(Sn.name,Sn.handler)}});return function(){gn.forEach(function(Sn){return Sn()})}}},[c,dt,ht,Et,St,At,Pt,Vt,Bt,Zt]);var qr=React.createElement("div",_objectSpread2({style:s,ref:or},zt));return{View:qr,play:mr,stop:Rr,pause:on,setSpeed:un,goToAndStop:Jr,goToAndPlay:jr,setDirection:fn,playSegments:Fr,setSubframe:Cr,getDuration:Sr,destroy:dr,animationContainerRef:or,animationLoaded:Gt,animationItem:ir.current}};function getContainerVisibility(e){var i=e.getBoundingClientRect(),s=i.top,a=i.height,_=window.innerHeight-s,$=window.innerHeight+a;return _/$}function getContainerCursorPosition(e,i,s){var a=e.getBoundingClientRect(),_=a.top,$=a.left,rt=a.width,c=a.height,dt=(i-$)/rt,ht=(s-_)/c;return{x:dt,y:ht}}var useInitInteractivity=function e(i){var s=i.wrapperRef,a=i.animationItem,_=i.mode,$=i.actions;reactExports.useEffect(function(){var rt=s.current;if(!(!rt||!a||!$.length)){a.stop();var c=function(){var Et=null,St=function(){var Pt=getContainerVisibility(rt),Vt=$.find(function(Zt){var zt=Zt.visibility;return zt&&Pt>=zt[0]&&Pt<=zt[1]});if(Vt){if(Vt.type==="seek"&&Vt.visibility&&Vt.frames.length===2){var Bt=Vt.frames[0]+Math.ceil((Pt-Vt.visibility[0])/(Vt.visibility[1]-Vt.visibility[0])*Vt.frames[1]);//! goToAndStop must be relative to the start of the current segment
a.goToAndStop(Bt-a.firstFrame-1,!0)}Vt.type==="loop"&&(Et===null||Et!==Vt.frames||a.isPaused)&&(a.playSegments(Vt.frames,!0),Et=Vt.frames),Vt.type==="play"&&a.isPaused&&(a.resetSegments(!0),a.play()),Vt.type==="stop"&&a.goToAndStop(Vt.frames[0]-a.firstFrame-1,!0)}};return document.addEventListener("scroll",St),function(){document.removeEventListener("scroll",St)}},dt=function(){var Et=function(Vt,Bt){var Zt=Vt,zt=Bt;if(Zt!==-1&&zt!==-1){var Ut=getContainerCursorPosition(rt,Zt,zt);Zt=Ut.x,zt=Ut.y}var Nt=$.find(function(ir){var or=ir.position;return or&&Array.isArray(or.x)&&Array.isArray(or.y)?Zt>=or.x[0]&&Zt<=or.x[1]&&zt>=or.y[0]&&zt<=or.y[1]:or&&!Number.isNaN(or.x)&&!Number.isNaN(or.y)?Zt===or.x&&zt===or.y:!1});if(Nt){if(Nt.type==="seek"&&Nt.position&&Array.isArray(Nt.position.x)&&Array.isArray(Nt.position.y)&&Nt.frames.length===2){var Gt=(Zt-Nt.position.x[0])/(Nt.position.x[1]-Nt.position.x[0]),er=(zt-Nt.position.y[0])/(Nt.position.y[1]-Nt.position.y[0]);a.playSegments(Nt.frames,!0),a.goToAndStop(Math.ceil((Gt+er)/2*(Nt.frames[1]-Nt.frames[0])),!0)}Nt.type==="loop"&&a.playSegments(Nt.frames,!0),Nt.type==="play"&&(a.isPaused&&a.resetSegments(!1),a.playSegments(Nt.frames)),Nt.type==="stop"&&a.goToAndStop(Nt.frames[0],!0)}},St=function(Vt){Et(Vt.clientX,Vt.clientY)},At=function(){Et(-1,-1)};return rt.addEventListener("mousemove",St),rt.addEventListener("mouseout",At),function(){rt.removeEventListener("mousemove",St),rt.removeEventListener("mouseout",At)}};switch(_){case"scroll":return c();case"cursor":return dt()}}},[_,a])},useLottieInteractivity=function e(i){var s=i.actions,a=i.mode,_=i.lottieObj,$=_.animationItem,rt=_.View,c=_.animationContainerRef;return useInitInteractivity({actions:s,animationItem:$,mode:a,wrapperRef:c}),rt},_excluded=["style","interactivity"],Lottie=function e(i){var s,a,_,$=i.style,rt=i.interactivity,c=_objectWithoutProperties(i,_excluded),dt=useLottie(c,$),ht=dt.View,Et=dt.play,St=dt.stop,At=dt.pause,Pt=dt.setSpeed,Vt=dt.goToAndStop,Bt=dt.goToAndPlay,Zt=dt.setDirection,zt=dt.playSegments,Ut=dt.setSubframe,Nt=dt.getDuration,Gt=dt.destroy,er=dt.animationContainerRef,ir=dt.animationLoaded,or=dt.animationItem;return reactExports.useEffect(function(){i.lottieRef&&(i.lottieRef.current={play:Et,stop:St,pause:At,setSpeed:Pt,goToAndPlay:Bt,goToAndStop:Vt,setDirection:Zt,playSegments:zt,setSubframe:Ut,getDuration:Nt,destroy:Gt,animationContainerRef:er,animationLoaded:ir,animationItem:or})},[(s=i.lottieRef)===null||s===void 0?void 0:s.current]),useLottieInteractivity({lottieObj:{View:ht,play:Et,stop:St,pause:At,setSpeed:Pt,goToAndStop:Vt,goToAndPlay:Bt,setDirection:Zt,playSegments:zt,setSubframe:Ut,getDuration:Nt,destroy:Gt,animationContainerRef:er,animationLoaded:ir,animationItem:or},actions:(a=rt==null?void 0:rt.actions)!==null&&a!==void 0?a:[],mode:(_=rt==null?void 0:rt.mode)!==null&&_!==void 0?_:"scroll"})};const v$1="5.7.4",fr$1=29.9700012207031,ip$1=0,op$1=210.000008553475,w$1=1e3,h$1=1e3,nm$1="Order Prepare",ddd$1=0,assets$1=[],layers$1=[{ddd:0,ind:1,ty:4,nm:"food Outlines",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:180,ix:10},p:{a:0,k:[856,836,0],ix:2,l:2},a:{a:0,k:[11,10.5,0],ix:1,l:2},s:{a:0,k:[-946.729,-946.729,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-1.539,0],[0,0],[0,1.538],[0,0]],o:[[0,0],[1.538,0],[0,0],[0,1.538]],v:[[-5.348,1.393],[5.348,1.393],[8.133,-1.393],[-8.133,-1.393]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.463355449602,.325916963465,.232582466275,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[11.995,16.497],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-.029,.024],[-.117,.028],[.022,.306],[-.008,.026],[-.002,.019],[-.035,-.117],[-.124,-.297],[-.007,.007],[-.012,.019],[-.034,.014],[-.055,-.043],[.018,-.051],[.104,-.071],[.077,-.005],[.02,.005],[.145,.068]],o:[[.101,-.082],[-.134,-.281],[-.015,-.024],[.007,-.017],[.03,-.135],[.095,.31],[.008,-.007],[-.004,-.018],[-.004,-.038],[.068,-.026],[.039,.03],[-.039,.116],[-.021,.059],[-.024,.001],[-.164,.049],[-.034,-.017]],v:[[-.465,.568],[-.128,.432],[-.402,-.468],[-.415,-.548],[-.402,-.6],[-.15,-.596],[.182,.308],[.206,.289],[.215,.234],[.264,.137],[.424,.175],[.477,.303],[.251,.585],[.1,.693],[.035,.686],[-.454,.665]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.490714069441,.535409665575,.431828487621,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[16.263,11.185],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 2",np:2,cix:2,bm:0,ix:2,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[.373,.43],[.729,-.144],[.325,-.221],[-.049,-.175],[-1.283,-.751],[-.455,.413],[.229,.919]],o:[[-.457,-.526],[-.291,.059],[-1.295,.885],[.048,.176],[1.283,.75],[.455,-.413],[-.146,-.584]],v:[[1.419,-2.015],[-.478,-2.648],[-1.408,-2.247],[-2.48,-.031],[-1.152,2.042],[1.413,1.921],[2.473,-.307]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.979146082261,.656308821136,.240585072835,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[17.199,13.517],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 3",np:2,cix:2,bm:0,ix:3,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-.037,.006],[-.116,-.034],[-.13,.277],[-.02,.017],[-.011,.013],[.026,-.12],[.036,-.32],[-.011,.003],[-.019,.01],[-.035,-.004],[-.027,-.064],[.041,-.038],[.126,-.01],[.069,.033],[.015,.013],[.093,.131]],o:[[.128,-.023],[.019,-.312],[-.002,-.028],[.014,-.012],[.091,-.105],[-.069,.316],[.01,-.002],[.004,-.017],[.015,-.035],[.073,.01],[.019,.045],[-.091,.081],[-.046,.042],[-.022,-.011],[-.168,-.037],[-.022,-.03]],v:[[-.467,.339],[-.105,.385],[.094,-.536],[.12,-.611],[.158,-.65],[.376,-.525],[.225,.426],[.255,.421],[.288,.378],[.38,.318],[.501,.428],[.484,.566],[.15,.701],[-.035,.723],[-.087,.686],[-.503,.428]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.490714069441,.535409665575,.431828487621,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[7.231,10.872],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 4",np:2,cix:2,bm:0,ix:4,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[.116,.557],[.706,.229],[.391,-.036],[.043,-.178],[-.755,-1.281],[-.598,.138],[-.247,.914]],o:[[-.142,-.683],[-.282,-.09],[-1.563,.141],[-.044,.178],[.755,1.28],[.598,-.139],[.158,-.581]],v:[[2.365,-.979],[1.018,-2.456],[.012,-2.558],[-2.005,-1.146],[-1.857,1.31],[.443,2.456],[2.454,1.027]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.979146082261,.656308821136,.240585072835,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[6.983,13.344],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 5",np:2,cix:2,bm:0,ix:5,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-.037,-.005],[-.1,-.067],[-.209,.224],[-.025,.012],[-.014,.01],[.062,-.107],[.132,-.294],[-.011,-.001],[-.021,.003],[-.032,-.015],[-.007,-.07],[.05,-.023],[.123,.028],[.056,.053],[.01,.018],[.049,.154]],o:[[.129,.018],[.114,-.29],[.007,-.028],[.016,-.006],[.119,-.071],[-.162,.28],[.01,.001],[.008,-.016],[.025,-.029],[.067,.031],[.004,.049],[-.111,.05],[-.057,.026],[-.017,-.018],[-.148,-.087],[-.012,-.036]],v:[[-.527,.128],[-.197,.283],[.275,-.531],[.324,-.596],[.37,-.62],[.54,-.434],[.104,.426],[.135,.43],[.18,.398],[.285,.37],[.367,.512],[.309,.637],[-.051,.663],[-.234,.628],[-.273,.576],[-.59,.202]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.390436269723,.426955608293,.342077846153,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[12.69,11.329],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 6",np:2,cix:2,bm:0,ix:6,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-.061,.565],[.602,.433],[.382,.086],[.096,-.155],[-.325,-1.451],[-.612,-.052],[-.516,.794]],o:[[.074,-.693],[-.241,-.174],[-1.53,-.345],[-.096,.155],[.325,1.45],[.613,.051],[.328,-.504]],v:[[2.486,-.079],[1.657,-1.898],[.73,-2.305],[-1.623,-1.581],[-2.235,.803],[-.399,2.6],[1.954,1.857]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.817884677064,.28898043165,.265481268191,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[11.782,13.429],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 7",np:2,cix:2,bm:0,ix:7,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-.124,0],[-1.312,.003],[.123,-.001],[1.312,-.003]],o:[[1.312,-.004],[.123,-.001],[-1.312,.003],[-.123,0]],v:[[-1.967,.1],[1.969,.092],[1.969,-.099],[-1.967,-.091]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.951655548694,.448623597388,.329247268976,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[6.905,3.499],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 8",np:2,cix:2,bm:0,ix:8,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-.124,-.002],[-1.374,-.017],[.123,.001],[1.374,.016]],o:[[1.374,.016],[.123,.001],[-1.374,-.017],[-.123,-.002]],v:[[-2.061,.096],[2.062,.096],[2.062,-.095],[-2.061,-.095]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.951655548694,.448623597388,.329247268976,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[8.64,5.812],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 9",np:2,cix:2,bm:0,ix:9,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]],v:[[-3.229,-7.487],[-3.229,-6.941],[-1.277,-4.63],[-1.277,7.487],[3.229,7.487],[3.229,-4.63],[1.283,-6.941],[1.283,-7.487]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.986887254902,.735047942517,.48431486242,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[7.815,10.403],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 10",np:2,cix:2,bm:0,ix:10,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0],[0,0]],v:[[-.324,-7.214],[-2.467,-4.902],[-2.467,7.214],[2.467,7.214],[2.467,-4.902]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.958784335267,.52412516276,.43046913895,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[4.911,10.676],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 11",np:2,cix:2,bm:0,ix:11,mn:"ADBE Vector Group",hd:!1}],ip:0,op:210.000008553475,st:0,bm:0},{ddd:0,ind:2,ty:4,nm:"kitchen Outlines",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[488,856,0],ix:2,l:2},a:{a:0,k:[44.5,23,0],ix:1,l:2},s:{a:0,k:[1259.236,1259.236,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-.142,.004],[-4.785,.116],[.142,-.003],[4.785,-.116]],o:[[4.785,-.116],[.142,-.004],[-4.785,.117],[-.142,.004]],v:[[-7.178,.176],[7.178,.044],[7.178,-.177],[-7.178,-.045]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[1,.999998743394,1,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[24.813,25.109],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:4,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[.362,0],[0,0],[0,-.361],[0,-.226],[-.002,-.108],[-.153,0],[-.043,-.18],[-.568,0],[0,0],[-.131,.552],[-.185,0],[0,0],[-.043,-.18],[-.568,0],[0,0],[-.131,.552],[-.185,0],[0,0],[-.043,-.18],[-.567,0],[0,0],[-.131,.552],[-.185,0],[-.101,.002],[.001,.055],[0,.123],[0,0]],o:[[0,0],[-.362,0],[0,.226],[0,.108],[.004,.235],[.185,0],[.131,.552],[0,0],[.567,0],[.043,-.18],[0,0],[.185,0],[.131,.552],[0,0],[.567,0],[.043,-.18],[0,0],[.185,0],[.131,.552],[0,0],[.567,0],[.043,-.18],[.102,0],[.047,-.001],[-.002,-.117],[0,0],[0,-.361]],v:[[7.191,-1.53],[-7.187,-1.53],[-7.842,-.875],[-7.846,-.198],[-7.844,.127],[-7.418,.28],[-7.029,.587],[-5.837,1.53],[-4.068,1.53],[-2.877,.587],[-2.488,.28],[-2.463,.28],[-2.074,.587],[-.882,1.53],[.887,1.53],[2.078,.587],[2.467,.28],[2.492,.28],[2.881,.587],[4.072,1.53],[5.842,1.53],[7.033,.587],[7.422,.28],[7.765,.28],[7.845,.227],[7.846,-.266],[7.846,-.875]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.357465945973,.368503884708,.606296015721,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[24.777,25.377],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 2",np:4,cix:2,bm:0,ix:2,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,1.152],[-1.152,0],[0,-1.152],[1.152,0]],o:[[0,-1.152],[1.152,0],[0,1.152],[-1.152,0]],v:[[-2.087,.674],[.001,-2.76],[2.087,.674],[.001,2.76]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.947452859318,.905771651922,.884520227769,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[29.724,23.848],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 3",np:4,cix:2,bm:0,ix:3,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,1.152],[-1.152,0],[0,-1.152],[1.152,0]],o:[[0,-1.152],[1.152,0],[0,1.152],[-1.152,0]],v:[[-2.087,.674],[.001,-2.76],[2.087,.674],[.001,2.76]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.947452859318,.905771651922,.884520227769,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[24.771,23.848],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 4",np:4,cix:2,bm:0,ix:4,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,1.152],[-1.152,0],[0,-1.152],[1.153,0]],o:[[0,-1.152],[1.153,0],[0,1.152],[-1.152,0]],v:[[-2.087,.674],[-.001,-2.76],[2.087,.674],[-.001,2.76]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.947452859318,.905771651922,.884520227769,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[19.818,23.848],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 5",np:4,cix:2,bm:0,ix:5,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-1.649,0],[0,0],[0,1.649],[0,0]],o:[[0,0],[1.649,0],[0,0],[0,1.649]],v:[[-5.734,1.493],[5.734,1.493],[8.721,-1.493],[-8.721,-1.493]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.914726526597,.817986462163,.791576071347,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[20.7,25.413],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 6",np:4,cix:2,bm:0,ix:6,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[4.002,-.297],[0,0],[2.52,-1.482],[0,0],[-.741,-2.075],[0,0]],o:[[0,0],[-4.002,.296],[0,0],[-2.519,1.482],[0,0],[.741,2.074],[0,0]],v:[[5.633,4.743],[3.26,-4.594],[.445,.001],[-3.41,-4.299],[-2.223,1.779],[-6.521,1.482],[-1.482,5.781]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.205477456486,.468678672641,.326348368327,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[16.21,19.711],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 7",np:4,cix:2,bm:0,ix:7,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[3.557,.444],[0,0],[3.408,.593],[0,0]],o:[[0,0],[-3.558,-.446],[0,0],[-3.409,-.593],[0,0]],v:[[.592,4.372],[2.372,-1.408],[-2.965,1.408],[-2.52,-4.372],[-5.337,4.965]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.662919646618,.737403959386,.547142238243,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[27.094,20.527],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 8",np:4,cix:2,bm:0,ix:8,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[.152,-.06],[.2,-.129],[.205,-.146],[-.214,.13],[-.21,.141],[-.168,.17]],o:[[-.222,.087],[-.212,.138],[-.197,.14],[.216,-.13],[.197,-.13],[.102,-.104]],v:[[.598,-.587],[-.023,-.229],[-.656,.187],[-.462,.517],[.171,.1],[.751,-.325]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.849499511719,.431366355746,.265743719363,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[23.803,20.639],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 9",np:4,cix:2,bm:0,ix:9,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[.164,-.094],[.272,-.186],[.233,-.205],[-.181,.104],[-.269,.188],[-.232,.207]],o:[[-.287,.162],[-.256,.174],[-.162,.143],[.284,-.164],[.255,-.176],[.146,-.13]],v:[[.699,-.697],[-.126,-.15],[-.889,.392],[-.661,.687],[.154,.123],[.904,-.431]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.849499511719,.431366355746,.265743719363,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[22.315,18.117],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 10",np:4,cix:2,bm:0,ix:10,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[.131,-.029],[.266,-.164],[.293,-.182],[-.217,.136],[-.292,.185],[-.198,.245]],o:[[-.307,.069],[-.294,.181],[-.217,.134],[.292,-.183],[.265,-.166],[.078,-.097]],v:[[.872,-.719],[.021,-.275],[-.857,.271],[-.659,.612],[.219,.062],[.997,-.506]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.849499511719,.431366355746,.265743719363,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[20.644,16.034],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 11",np:4,cix:2,bm:0,ix:11,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[.184,-.053],[.823,-.124],[-.248,.039],[-.709,.371]],o:[[-.779,.223],[-.25,.037],[.814,-.122],[.171,-.09]],v:[[1.032,-.712],[-1.083,.348],[-.978,.725],[1.162,-.402]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.849499511719,.431366355746,.265743719363,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[19.196,14.264],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 12",np:4,cix:2,bm:0,ix:12,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[1.436,-1.017],[-.442,-.499],[-.537,-1.014],[-.585,.211],[.238,1.763],[1.064,1.306]],o:[[0,0],[-1.436,1.017],[.442,.499],[.537,1.014],[.584,-.212],[-.239,-1.763],[-1.064,-1.304]],v:[[-1.186,-5.635],[-3.492,-5.848],[-3.574,-2.514],[1.419,3.148],[4.344,6.654],[4.245,3.975],[2.124,-1.029]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.963083543964,.543955485026,.24977164175,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[20.841,18.166],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 13",np:4,cix:2,bm:0,ix:13,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[.406,1.771],[.381,-.562],[-.375,-1.198],[0,0],[.902,.12],[-.306,-.454],[-.897,-1.155],[.657,-.907],[-1.423,-1.051],[0,0],[1.218,.798],[.188,-.618],[-1.528,-.587],[0,0]],o:[[0,0],[-.237,-1.034],[-.381,.56],[.302,.966],[0,0],[-.903,-.121],[1.021,1.514],[0,0],[-.657,.906],[1.091,.807],[0,0],[-1.834,-1.201],[-.256,.839],[3.404,1.308],[0,0]],v:[[4.495,4.184],[3.042,.309],[1.346,-4.762],[2.135,-.371],[3.456,3.479],[-.413,-2.473],[.516,.087],[3.115,3.74],[-3.837,-1.477],[-.02,1.755],[3.43,4.518],[1.874,3.154],[-3.342,1.113],[-.283,2.825],[3.516,5.324]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.231436187146,.400447022681,.341441554649,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[13.884,8.267],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 14",np:4,cix:2,bm:0,ix:14,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0]],o:[[0,0],[0,0]],v:[[-2.637,3.538],[2.637,-3.538]],c:!1},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"st",c:{a:0,k:[.800162221871,.915541884478,.902066518746,1],ix:3},o:{a:0,k:100,ix:4},w:{a:0,k:1.301,ix:5},lc:2,lj:1,ml:10,bm:0,nm:"Stroke 1",mn:"ADBE Vector Graphic - Stroke",hd:!1},{ty:"tr",p:{a:0,k:[22.509,13.632],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 15",np:2,cix:2,bm:0,ix:15,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0]],o:[[0,0],[0,0]],v:[[-3.013,3.938],[3.013,-3.938]],c:!1},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"st",c:{a:0,k:[.800162221871,.915541884478,.902066518746,1],ix:3},o:{a:0,k:100,ix:4},w:{a:0,k:1.301,ix:5},lc:2,lj:1,ml:10,bm:0,nm:"Stroke 1",mn:"ADBE Vector Graphic - Stroke",hd:!1},{ty:"tr",p:{a:0,k:[22.863,14.876],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 16",np:2,cix:2,bm:0,ix:16,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[3.462,5.095],[-3.463,5.095],[-3.463,-5.095],[3.462,-5.095]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.800162221871,.915541884478,.902066518746,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[22.898,18.724],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 17",np:4,cix:2,bm:0,ix:17,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-4,-7.738],[4,-7.738],[4,7.738],[-4,7.738]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.702359307981,.876050163718,.851058660769,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[22.898,16.471],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 18",np:4,cix:2,bm:0,ix:18,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[9.784,.202],[-9.784,.202],[-9.784,-.202],[9.784,-.202]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.85749021044,.941752893784,.95355164771,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[45.536,13.431],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 19",np:4,cix:2,bm:0,ix:19,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[5.337,0],[0,0],[0,5.338],[0,0],[0,0],[0,0]],o:[[0,0],[-5.337,0],[0,0],[0,0],[0,0],[0,5.338]],v:[[.001,5.782],[.001,5.782],[-9.665,-3.883],[-9.665,-5.782],[9.665,-5.782],[9.665,-3.883]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.589915017521,.776821420707,.782229554419,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[45.568,19.179],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 20",np:4,cix:2,bm:0,ix:20,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-.043,-.046],[.318,-1.062],[0,0],[-1.019,.441],[-.063,.034],[-.059,.04],[-.058,.106],[.168,.124],[.253,-.036],[.212,-.049],[.02,.055],[-.846,.279],[-.263,.051],[-.172,-.005],[-.154,-.11],[-.036,-.2],[.097,-.167],[.311,-.134],[.819,-.138],[0,0],[0,0]],o:[[.043,.045],[0,0],[.77,-.183],[.078,-.032],[.07,-.031],[.116,-.081],[.13,-.21],[-.168,-.131],[-.247,.034],[-.846,.204],[-.019,-.049],[.212,-.067],[.137,-.023],[.163,.007],[.154,.107],[.038,.201],[-.19,.345],[-1.049,.453],[0,0],[0,0],[.421,-1.121]],v:[[-1.228,-.579],[-1.684,1.255],[-1.861,1.051],[.914,.113],[1.128,.014],[1.316,-.098],[1.59,-.38],[1.51,-.947],[.849,-1.027],[.159,-.893],[-1.228,-.579],[.084,-1.165],[.794,-1.352],[1.228,-1.4],[1.725,-1.245],[2.038,-.762],[1.929,-.186],[1.072,.479],[-1.805,1.359],[-2.076,1.406],[-1.982,1.154]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.204622410793,.204736836751,.20461286657,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[56.21,15.794],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 21",np:4,cix:2,bm:0,ix:21,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-.043,.045],[-.42,-1.121],[0,0],[0,0],[1.05,.454],[.19,.347],[-.04,.2],[-.155,.106],[-.163,.005],[0,0],[0,0],[-.065,-.005],[-.208,-.075],[-.222,-.109],[.022,-.017],[.223,.059],[.4,.117],[.247,.005],[.066,.002],[0,0],[0,0],[.081,-.066],[-.128,-.21],[-.296,-.125],[-.77,-.183],[0,0]],o:[[.043,-.046],[0,0],[0,0],[-.821,-.138],[-.313,-.135],[-.095,-.169],[.037,-.201],[.155,-.11],[0,0],[0,0],[.067,.005],[.272,.021],[.421,.154],[.237,.117],[-.022,.017],[-.262,-.077],[-.211,-.056],[-.064,-.002],[0,0],[0,0],[-.108,.009],[-.169,.122],[.122,.219],[1.02,.443],[0,0],[-.319,-1.062]],v:[[1.228,-.581],[1.981,1.152],[2.076,1.402],[1.805,1.357],[-1.076,.475],[-1.933,-.193],[-2.036,-.771],[-1.719,-1.253],[-1.22,-1.402],[-1.099,-1.4],[-1,-1.393],[-.802,-1.376],[-.067,-1.206],[.899,-.792],[1.228,-.581],[.844,-.646],[-.151,-.938],[-.824,-1.046],[-1.02,-1.053],[-1.123,-1.057],[-1.207,-1.053],[-1.507,-.952],[-1.593,-.385],[-.918,.109],[1.86,1.049],[1.684,1.253]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.204622410793,.204736836751,.20461286657,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[34.619,15.796],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 22",np:4,cix:2,bm:0,ix:22,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-14.547,-.924],[14.547,-.924],[14.547,.924],[-14.547,.924]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.204622410793,.204736836751,.20461286657,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[47.64,25.859],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 23",np:2,cix:2,bm:0,ix:23,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[35.501,.88],[-35.501,.88],[-35.501,-.881],[35.501,-.881]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.942020730411,.806368300494,.335119030522,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[46.752,27.61],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 24",np:2,cix:2,bm:0,ix:24,mn:"ADBE Vector Group",hd:!1}],ip:0,op:210.000008553475,st:0,bm:0},{ddd:0,ind:3,ty:4,nm:"Shape Layer 6",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[482,520,0],ix:2,l:2},a:{a:0,k:[-356,-210,0],ix:1,l:2},s:{a:0,k:[41.54,30.042,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[68,96],[0,0]],o:[[0,0],[-68,-96],[0,0]],v:[[-364,-50],[-362,-202],[-322,-346]],c:!1},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"st",c:{a:0,k:[1,1,1,1],ix:3},o:{a:0,k:100,ix:4},w:{a:0,k:10,ix:5},lc:1,lj:1,ml:4,bm:0,d:[{n:"d",nm:"dash",v:{a:0,k:367,ix:1}},{n:"o",nm:"offset",v:{a:1,k:[{i:{x:[.833],y:[.836]},o:{x:[.167],y:[.167]},t:16,s:[385]},{i:{x:[.833],y:[.833]},o:{x:[.167],y:[.169]},t:40,s:[0]},{t:63.0000025660426,s:[-358]}],ix:7}}],nm:"Stroke 1",mn:"ADBE Vector Graphic - Stroke",hd:!1},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Shape 1",np:3,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:16.0000006516934,op:67.0000027289659,st:16.0000006516934,bm:0},{ddd:0,ind:4,ty:4,nm:"Shape Layer 5",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[482,520,0],ix:2,l:2},a:{a:0,k:[-356,-210,0],ix:1,l:2},s:{a:0,k:[41.54,30.042,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[68,96],[0,0]],o:[[0,0],[-68,-96],[0,0]],v:[[-364,-50],[-362,-202],[-322,-346]],c:!1},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"st",c:{a:0,k:[1,1,1,1],ix:3},o:{a:0,k:100,ix:4},w:{a:0,k:10,ix:5},lc:1,lj:1,ml:4,bm:0,d:[{n:"d",nm:"dash",v:{a:0,k:367,ix:1}},{n:"o",nm:"offset",v:{a:1,k:[{i:{x:[.833],y:[.836]},o:{x:[.167],y:[.167]},t:133,s:[385]},{i:{x:[.833],y:[.833]},o:{x:[.167],y:[.169]},t:157,s:[0]},{t:180.00000733155,s:[-358]}],ix:7}}],nm:"Stroke 1",mn:"ADBE Vector Graphic - Stroke",hd:!1},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Shape 1",np:3,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:133.000005417201,op:184.000007494474,st:133.000005417201,bm:0},{ddd:0,ind:5,ty:4,nm:"Shape Layer 4",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[534,652,0],ix:2,l:2},a:{a:0,k:[-356,-210,0],ix:1,l:2},s:{a:0,k:[58.824,42.542,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[68,96],[0,0]],o:[[0,0],[-68,-96],[0,0]],v:[[-364,-50],[-362,-202],[-322,-346]],c:!1},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"st",c:{a:0,k:[1,1,1,1],ix:3},o:{a:0,k:100,ix:4},w:{a:0,k:10,ix:5},lc:1,lj:1,ml:4,bm:0,d:[{n:"d",nm:"dash",v:{a:0,k:367,ix:1}},{n:"o",nm:"offset",v:{a:1,k:[{i:{x:[.833],y:[.836]},o:{x:[.167],y:[.167]},t:114,s:[385]},{i:{x:[.833],y:[.833]},o:{x:[.167],y:[.169]},t:138,s:[0]},{t:161.000006557664,s:[-358]}],ix:7}}],nm:"Stroke 1",mn:"ADBE Vector Graphic - Stroke",hd:!1},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Shape 1",np:3,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:114.000004643315,op:165.000006720588,st:114.000004643315,bm:0},{ddd:0,ind:6,ty:4,nm:"Shape Layer 3",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[462,690,0],ix:2,l:2},a:{a:0,k:[-356,-210,0],ix:1,l:2},s:{a:0,k:[82.353,59.559,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[68,96],[0,0]],o:[[0,0],[-68,-96],[0,0]],v:[[-364,-50],[-362,-202],[-322,-346]],c:!1},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"st",c:{a:0,k:[1,1,1,1],ix:3},o:{a:0,k:100,ix:4},w:{a:0,k:10,ix:5},lc:1,lj:1,ml:4,bm:0,d:[{n:"d",nm:"dash",v:{a:0,k:367,ix:1}},{n:"o",nm:"offset",v:{a:1,k:[{i:{x:[.833],y:[.836]},o:{x:[.167],y:[.167]},t:84,s:[385]},{i:{x:[.833],y:[.833]},o:{x:[.167],y:[.169]},t:108,s:[0]},{t:131.000005335739,s:[-358]}],ix:7}}],nm:"Stroke 1",mn:"ADBE Vector Graphic - Stroke",hd:!1},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Shape 1",np:3,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:84.0000034213901,op:135.000005498663,st:84.0000034213901,bm:0},{ddd:0,ind:7,ty:4,nm:"Shape Layer 7",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[534,520,0],ix:2,l:2},a:{a:0,k:[-356,-210,0],ix:1,l:2},s:{a:0,k:[48.453,35.042,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[68,96],[0,0]],o:[[0,0],[-68,-96],[0,0]],v:[[-364,-50],[-362,-202],[-322,-346]],c:!1},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"st",c:{a:0,k:[1,1,1,1],ix:3},o:{a:0,k:100,ix:4},w:{a:0,k:10,ix:5},lc:1,lj:1,ml:4,bm:0,d:[{n:"d",nm:"dash",v:{a:0,k:367,ix:1}},{n:"o",nm:"offset",v:{a:1,k:[{i:{x:[.833],y:[.836]},o:{x:[.167],y:[.167]},t:42,s:[385]},{i:{x:[.833],y:[.833]},o:{x:[.167],y:[.169]},t:66,s:[0]},{t:89.0000036250443,s:[-358]}],ix:7}}],nm:"Stroke 1",mn:"ADBE Vector Graphic - Stroke",hd:!1},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Shape 1",np:3,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:42.0000017106951,op:93.0000037879676,st:42.0000017106951,bm:0},{ddd:0,ind:8,ty:4,nm:"Shape Layer 2",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[552,676,0],ix:2,l:2},a:{a:0,k:[-356,-210,0],ix:1,l:2},s:{a:0,k:[58.824,42.542,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[68,96],[0,0]],o:[[0,0],[-68,-96],[0,0]],v:[[-364,-50],[-362,-202],[-322,-346]],c:!1},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"st",c:{a:0,k:[1,1,1,1],ix:3},o:{a:0,k:100,ix:4},w:{a:0,k:10,ix:5},lc:1,lj:1,ml:4,bm:0,d:[{n:"d",nm:"dash",v:{a:0,k:367,ix:1}},{n:"o",nm:"offset",v:{a:1,k:[{i:{x:[.833],y:[.836]},o:{x:[.167],y:[.167]},t:30,s:[385]},{i:{x:[.833],y:[.833]},o:{x:[.167],y:[.169]},t:54,s:[0]},{t:77.0000031362743,s:[-358]}],ix:7}}],nm:"Stroke 1",mn:"ADBE Vector Graphic - Stroke",hd:!1},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Shape 1",np:3,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:30.0000012219251,op:81.0000032991976,st:30.0000012219251,bm:0},{ddd:0,ind:9,ty:4,nm:"Shape Layer 1",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[462,690,0],ix:2,l:2},a:{a:0,k:[-356,-210,0],ix:1,l:2},s:{a:0,k:[82.353,59.559,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[68,96],[0,0]],o:[[0,0],[-68,-96],[0,0]],v:[[-364,-50],[-362,-202],[-322,-346]],c:!1},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"st",c:{a:0,k:[1,1,1,1],ix:3},o:{a:0,k:100,ix:4},w:{a:0,k:10,ix:5},lc:1,lj:1,ml:4,bm:0,d:[{n:"d",nm:"dash",v:{a:0,k:367,ix:1}},{n:"o",nm:"offset",v:{a:1,k:[{i:{x:[.833],y:[.836]},o:{x:[.167],y:[.167]},t:0,s:[385]},{i:{x:[.833],y:[.833]},o:{x:[.167],y:[.169]},t:24,s:[0]},{t:47.0000019143492,s:[-358]}],ix:7}}],nm:"Stroke 1",mn:"ADBE Vector Graphic - Stroke",hd:!1},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Shape 1",np:3,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:0,op:51.0000020772726,st:0,bm:0},{ddd:0,ind:10,ty:4,nm:"KC Outlines",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[496,670,0],ix:2,l:2},a:{a:0,k:[10.303,22.837,0],ix:1,l:2},s:{a:0,k:[1224.359,1224.359,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[.023,.022],[.082,.457],[.72,.417],[.493,.095],[.594,.051],[.661,.192],[.551,.548],[.131,.362],[0,0],[0,0],[-.167,.043],[-.125,-.035],[-.101,-.097],[-.019,-.167],[.176,-.146],[.209,-.022],[.248,.176],[.211,.169],[.674,.391],[-.021,.112],[-.448,-.065],[-.739,-.358],[-.855,-.649],[-.32,.051],[-.05,.046],[-.007,.018],[-.002,.008],[-.002,.004],[0,0],[0,0],[.039,.002],[0,0],[0,0],[.024,-.013],[.012,.001],[.023,.007],[.006,.001],[.003,.009],[.009,.021],[-.091,-.028],[0,0],[-.222,-.221],[-.58,-.177],[-.59,-.073],[-.829,-.545],[-.01,-.552]],o:[[-.057,-.022],[-.082,-.445],[-.348,-.2],[-.498,-.096],[-.59,-.056],[-.653,-.191],[-.285,-.284],[0,0],[0,0],[.039,-.171],[.167,-.053],[.125,.037],[.101,.094],[.032,.309],[-.18,.146],[-.452,.028],[-.245,-.186],[-.824,-.672],[-1.348,-.791],[.004,-.038],[.448,.062],[.741,.355],[.424,.306],[.081,-.01],[.026,-.022],[.004,-.008],[0,-.004],[0,0],[0,0],[-.009,0],[0,0],[0,0],[.002,-.001],[-.026,.018],[-.009,-.009],[-.012,-.002],[-.003,-.001],[-.003,-.022],[-.026,-.078],[0,0],[.098,.265],[.425,.427],[.579,.179],[1.172,.129],[.811,.548],[.001,.564]],v:[[7.036,3.92],[7.035,3.175],[5.848,1.687],[4.546,1.251],[2.902,1.057],[1.003,.754],[-.881,-.289],[-1.525,-1.285],[-1.56,-1.383],[-1.532,-1.502],[-1.152,-1.895],[-.719,-1.897],[-.379,-1.702],[-.171,-1.297],[-.471,-.602],[-1.062,-.364],[-2.074,-.722],[-2.723,-1.245],[-4.969,-2.872],[-7.286,-3.878],[-6.583,-3.877],[-4.749,-3.286],[-2.34,-1.734],[-1.126,-1.03],[-.908,-1.122],[-.859,-1.184],[-.851,-1.208],[-.85,-1.22],[-.85,-1.222],[-.85,-1.223],[-.805,-1.222],[-.805,-1.221],[-.799,-1.221],[-.833,-1.207],[-.853,-1.204],[-.909,-1.233],[-.936,-1.237],[-.941,-1.24],[-.954,-1.299],[-.921,-1.325],[-.872,-1.525],[-.383,-.782],[1.199,.097],[2.971,.416],[6.109,1.268],[7.305,3.147]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.204622410793,.204736836751,.20461286657,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[25.25,33.084],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[.02,.082],[-1.456,.72],[-.294,.308],[-.057,.089],[-.018,.067],[.002,.004],[.085,.003],[.09,-.034],[.107,-.064],[.232,-.178],[.5,-.382],[.067,-.051],[0,0],[-.395,.944],[0,0],[-.008,.03],[-.001,-.006],[-.045,-.01],[.023,-.008],[.043,-.032],[.083,-.073],[.232,-.307],[.226,-.382],[.044,.019],[-.151,.424],[-.441,.701],[-.37,.339],[-.101,.083],[-.093,.04],[-.173,-.071],[-.012,-.129],[.02,-.089],[.021,-.064],[0,0],[.861,-.942],[0,0],[-.073,.056],[-.474,.359],[-.272,.15],[-.17,.062],[-.189,-.011],[-.169,-.215],[.066,-.167],[.084,-.12],[.099,-.094],[.388,-.165]],o:[[-.03,-.104],[.355,-.182],[.073,-.077],[.057,-.086],[.02,-.074],[.004,-.001],[-.084,-.003],[-.091,.037],[-.224,.131],[-.472,.362],[-.073,.056],[0,0],[.802,-.873],[0,0],[.024,-.06],[.012,-.036],[-.005,.003],[.055,.019],[-.021,.008],[-.091,.068],[-.34,.279],[-.462,.619],[-.223,.385],[-.043,-.02],[.154,-.422],[.222,-.349],[.089,-.088],[.051,-.042],[.09,-.039],[.163,.058],[.02,.133],[-.024,.095],[0,0],[-.387,1.025],[0,0],[.067,-.052],[.502,-.379],[.24,-.178],[.141,-.077],[.174,-.058],[.181,.018],[.165,.208],[-.063,.178],[-.084,.118],[-.4,.375],[-1.562,.628]],v:[[-2.026,2.324],[.383,1.201],[1.412,.495],[1.609,.247],[1.742,-.012],[1.74,-.096],[1.609,-.128],[1.332,-.079],[1.006,.085],[.328,.559],[-1.13,1.678],[-1.343,1.84],[-1.813,1.327],[-.025,-1.469],[.047,-1.646],[.105,-1.796],[.119,-1.861],[.197,-1.775],[.248,-1.768],[.154,-1.712],[-.112,-1.508],[-.961,-.605],[-1.952,.965],[-2.358,1.54],[-2.194,.852],[-1.361,-.883],[-.489,-1.939],[-.197,-2.189],[.022,-2.322],[.436,-2.335],[.727,-1.958],[.709,-1.641],[.639,-1.424],[.568,-1.232],[-1.297,1.799],[-1.766,1.285],[-1.553,1.122],[-.086,.014],[.676,-.495],[1.113,-.699],[1.65,-.771],[2.236,-.486],[2.327,.178],[2.099,.59],[1.82,.906],[.59,1.65]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.204622410793,.204736836751,.20461286657,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[26.03,30.112],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 2",np:2,cix:2,bm:0,ix:2,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-.052,-.067],[.378,-.874],[.406,-1.445],[.194,.036],[-.812,2.916],[-.544,.882]],o:[[.075,.077],[-.393,.863],[-.803,2.881],[-.186,-.034],[.408,-1.445],[.53,-.889]],v:[[1.768,-5.097],[1.061,-3.693],[-.066,-.076],[-1.658,5.128],[-.74,-.264],[.622,-3.921]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.204622410793,.204736836751,.20461286657,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[7.225,5.987],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,84.544],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 3",np:2,cix:2,bm:0,ix:3,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[.195,.027],[-.558,2.513],[-.181,-.056],[.547,-2.484]],o:[[-.187,-.025],[.554,-2.515],[.188,.058],[-.552,2.482]],v:[[-1,4.533],[-.501,-.096],[.999,-4.504],[.182,.055]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.204622410793,.204736836751,.20461286657,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[17.624,6.314],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,85.892],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 4",np:2,cix:2,bm:0,ix:4,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]],v:[[-8.269,-16.731],[3.045,-16.953],[4.154,2.348],[11.919,16.768],[-11.919,16.953],[-11.027,4.783]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.308235318053,.185718865488,.029252067267,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 2",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"fl",c:{a:0,k:[.308235318053,.185718865488,.029252067267,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[13.684,27.153],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 5",np:3,cix:2,bm:0,ix:5,mn:"ADBE Vector Group",hd:!1}],ip:0,op:210.000008553475,st:0,bm:0},{ddd:0,ind:11,ty:4,nm:"tshirt Outlines",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[556,604,0],ix:2,l:2},a:{a:0,k:[11.5,14,0],ix:1,l:2},s:{a:0,k:[1373.215,1457.36,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0],[0,0],[0,0],[.08,-.09],[.05,-.059],[0,0],[-.08,.02],[-.56,0],[-.17,-.01],[0,0],[-2.27,-.21],[-.045,.103],[0,0],[0,0],[0,0],[.19,.021]],o:[[0,0],[0,0],[0,0],[-.08,.09],[-.05,.05],[0,0],[.08,-.031],[.71,-.219],[.2,0],[0,0],[.22,.779],[1.59,.149],[0,0],[0,0],[0,0],[-.3,-.04],[0,0]],v:[[2.975,2.332],[10.153,19.034],[-12.271,19.906],[-12.882,19.586],[-7.296,.711],[-7.296,.711],[-7.933,-12.294],[-7.703,-12.365],[-6.47,-12.655],[-5.92,-12.635],[-3.693,-12.424],[-.859,-10.1],[2.611,-11.841],[4.155,-12.498],[7.063,-12.338],[2.935,1.952],[2.935,1.952]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.942710487515,.347555332558,.257082142549,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[9.953,14.526],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:0,op:210.000008553475,st:0,bm:0},{ddd:0,ind:12,ty:4,nm:"hand1 Outlines",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:1,k:[{i:{x:[.833],y:[1]},o:{x:[.167],y:[.167]},t:10,s:[0]},{i:{x:[.833],y:[.938]},o:{x:[.167],y:[0]},t:30,s:[-14]},{i:{x:[.833],y:[2.491]},o:{x:[.167],y:[1.464]},t:71,s:[0]},{i:{x:[.833],y:[1]},o:{x:[.167],y:[.06]},t:140,s:[0]},{i:{x:[.833],y:[.833]},o:{x:[.167],y:[0]},t:179,s:[-14]},{t:210.000008553475,s:[0]}],ix:10},p:{a:0,k:[448,460,0],ix:2,l:2},a:{a:0,k:[25.542,17.296,0],ix:1,l:2},s:{a:0,k:[694.636,694.636,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[.018,.073],[-.433,.033],[-.118,.01],[-.039,-.012],[.021,-.047],[.075,-.033],[.209,-.021]],o:[[-.018,-.069],[.214,-.02],[.117,-.003],[.015,.008],[-.02,.049],[-.151,.067],[-.415,.032]],v:[[-.742,.121],[.008,-.123],[.533,-.145],[.738,-.182],[.738,-.098],[.585,.035],[.031,.142]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.204622410793,.204736836751,.20461286657,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[9.865,15.034],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[.018,.923],[-.341,.196],[-.107,-.401],[0,0],[.605,-.7],[0,0],[.143,-.275],[0,0],[-.216,-1.579],[0,0]],o:[[-.379,-1.524],[-.016,-.814],[1.408,-.812],[.087,.328],[0,0],[-.323,.373],[0,0],[-.255,.488],[0,0],[.157,1.148],[0,0]],v:[[-2.528,3.295],[-2.953,-1.622],[-2.099,-2.986],[2.278,-3.985],[-.106,-2.857],[2.364,-2.663],[.313,-2.144],[2.046,-1.671],[.248,-1.25],[1.206,.953],[-.992,4.386]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.985606414197,.768474563898,.65874077292,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[10.351,16.075],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 2",np:2,cix:2,bm:0,ix:2,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-.11,.241],[-.286,-.306],[-1.49,-2.398],[0,0],[0,0],[2.32,2.076],[0,0],[3.391,2.803]],o:[[.174,-.381],[1.322,1.407],[2.112,3.399],[0,0],[0,0],[-1.756,-1.571],[0,0],[-.205,-.169]],v:[[-8.162,-9.56],[-7.198,-9.719],[-1.422,-2.374],[2.089,3.253],[8.272,8.593],[3.338,7.949],[.765,3.598],[-8.005,-8.867]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.436724404728,.356003615435,.281163144579,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[13.538,16.769],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 3",np:2,cix:2,bm:0,ix:3,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-.192,-.159],[-.003,.41],[.534,-.6]],o:[[.286,-.301],[.004,-.724],[.224,.143]],v:[[-.249,1.176],[.878,-.451],[-.883,.725]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.972558414235,.642884018842,.502590284161,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[10.793,11.983],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 4",np:2,cix:2,bm:0,ix:4,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[.108,.028],[-.668,2.188],[-.101,-.037],[.663,-2.182]],o:[[-.105,-.026],[.666,-2.192],[.106,.037],[-.665,2.179]],v:[[-1.206,3.958],[-.268,-.077],[1.204,-3.95],[.113,.04]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.204622410793,.204736836751,.20461286657,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[10.47,26.425],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 5",np:2,cix:2,bm:0,ix:5,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0],[.474,-1.203],[0,0],[0,0],[4.94,0],[-4.81,9.181],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[-.07,.101],[-1.15,1.42],[-.32,.38],[-.48,.51],[-1.37,-.12]],o:[[0,0],[1.29,.094],[0,0],[0,0],[-4.24,4.47],[-2.86,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[.08,-.1],[1.35,-1.75],[.35,-.41],[2.07,-2.52],[2.14,-2.231],[0,0]],v:[[11.266,-12.46],[11.266,-12.46],[12.91,-9.845],[10.229,-3.038],[8.516,.75],[-8.395,12.57],[-8.574,-3.731],[-7.895,-3.65],[-3.064,-3.061],[-2.514,-2.99],[-2.674,-2.44],[-2.674,-2.43],[-3.624,.95],[-3.395,.649],[.396,-4.13],[1.385,-5.32],[5.445,-10.08],[11.266,-12.45]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.980392216701,.654901960784,.239215701234,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[14.156,25.207],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 6",np:2,cix:2,bm:0,ix:6,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[0,0]],v:[[-2.505,2.066],[-.993,-2.624],[2.505,-1.432],[2.346,2.624]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.985606414197,.768474563898,.65874077292,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[8.745,19.546],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 7",np:2,cix:2,bm:0,ix:7,mn:"ADBE Vector Group",hd:!1}],ip:0,op:210.000008553475,st:0,bm:0},{ddd:0,ind:13,ty:4,nm:"hand Outlines",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:1,k:[{i:{x:[.833],y:[1.012]},o:{x:[.167],y:[.167]},t:10,s:[0]},{i:{x:[.833],y:[1]},o:{x:[.167],y:[.013]},t:23,s:[-12]},{i:{x:[.833],y:[.989]},o:{x:[.167],y:[0]},t:40,s:[2]},{i:{x:[.833],y:[1]},o:{x:[.167],y:[-.015]},t:70,s:[-12]},{i:{x:[.833],y:[1.012]},o:{x:[.167],y:[0]},t:104,s:[0]},{i:{x:[.833],y:[.953]},o:{x:[.167],y:[.013]},t:117,s:[-12]},{i:{x:[.833],y:[.149]},o:{x:[.167],y:[-.673]},t:134,s:[2]},{i:{x:[.833],y:[1.009]},o:{x:[.167],y:[.053]},t:169,s:[0]},{i:{x:[.833],y:[.833]},o:{x:[.167],y:[.016]},t:182,s:[-12]},{t:210.000008553475,s:[2]}],ix:10},p:{a:0,k:[618,468,0],ix:2,l:2},a:{a:0,k:[4.382,27.179,0],ix:1,l:2},s:{a:0,k:[690.078,690.078,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[.08,-.07],[.78,.45],[0,.12],[0,0],[-.2,-.03],[-.51,-.301]],o:[[-.08,.08],[-.76,-.451],[0,0],[.01,-.04],[.31,.05],[.84,.489]],v:[[1.395,.83],[-.025,-.03],[-1.475,-.851],[-1.475,-.86],[-1.135,-.88],[.175,-.38]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.204622410793,.204736836751,.20461286657,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[18.85,24.454],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[.05,0],[.45,.931],[-.08,.08],[-.01,0],[-.23,-.22],[-.24,-.52],[-.01,-.37]],o:[[-.12,0],[-.43,-.96],[0,-.01],[.07,0],[.27,.25],[.23,.51],[.02,.37]],v:[[.795,1.74],[.155,-.071],[-.815,-1.73],[-.795,-1.74],[-.305,-1.41],[.525,-.24],[.875,1.15]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.204622410793,.204736836751,.20461286657,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[17.509,25.384],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 2",np:2,cix:2,bm:0,ix:2,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[.08,-.07],[.78,.45],[0,.12],[-.11,.02],[-.51,-.301]],o:[[-.08,.08],[-.76,-.451],[.12,0],[.31,.05],[.84,.489]],v:[[1.395,.815],[-.025,-.045],[-1.475,-.866],[-1.135,-.895],[.175,-.395]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.942710487515,.347555332558,.257082142549,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[18.85,24.469],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 3",np:2,cix:2,bm:0,ix:3,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-.01,-.37],[.05,0],[.45,.931],[-.08,.08],[-.01,0],[-.23,-.219],[-.24,-.519]],o:[[.02,.37],[-.12,0],[-.43,-.96],[0,-.011],[.07,0],[.27,.25],[.23,.511]],v:[[.875,1.15],[.795,1.74],[.155,-.07],[-.815,-1.73],[-.795,-1.74],[-.305,-1.411],[.525,-.24]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.942710487515,.347555332558,.257082142549,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[17.509,25.384],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 4",np:2,cix:2,bm:0,ix:4,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-1.561,-1.339],[.512,-1.321],[3.378,-2.096],[4.406,.418],[.286,1.448],[0,0],[-2.639,.537],[-4.33,.151],[0,-.011],[-.431,-.96],[-.119,0],[.02,.37],[.23,.511],[.27,.25],[.071,0],[-.209,.021],[-.76,-.451],[-.08,.08],[.84,.489],[.31,.05],[-.549,.26],[-1.564,2.58]],o:[[1.075,.923],[-1.429,3.689],[-3.289,2.028],[-1.469,-.139],[0,0],[-1.85,-1.955],[2.009,-.09],[-.009,0],[-.08,.08],[.449,.931],[.05,0],[-.01,-.37],[-.241,-.519],[-.23,-.219],[.23,-.009],[0,.12],[.78,.45],[.079,-.07],[-.509,-.301],[.77,-.08],[2.082,-.978],[1.067,-1.758]],v:[[14.605,-8.695],[15.548,-4.958],[7.615,8.005],[-8.247,9.176],[-13.059,7.398],[-14.615,5.064],[-11.895,-1.865],[.654,-.546],[.635,-.535],[1.605,1.124],[2.245,2.936],[2.325,2.346],[1.975,.954],[1.146,-.215],[.654,-.546],[1.314,-.585],[2.764,.236],[4.186,1.096],[2.965,-.115],[1.654,-.615],[3.654,-1.105],[9.585,-7.906]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.980392216701,.654901960784,.239215701234,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[16.059,24.189],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 5",np:4,cix:2,bm:0,ix:5,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[6.865,-5.361],[2.371,-.85],[.445,2.622],[-1.907,1.299],[-.965,1.886],[-.048,.099],[0,0],[-.1,.299],[0,0],[-.093,-1.255],[0,0],[-.652,-.144],[.388,-.451],[0,0],[-.596,-.289],[.71,-.729],[0,0],[-.292,-.157],[.341,-.69],[-.095,-.445],[.873,-2.244],[.098,-.281],[0,0]],o:[[-1.942,1.516],[-.682,-2.58],[1.853,-.383],[2.898,-1.975],[.048,-.099],[0,0],[0,0],[.252,-.75],[0,0],[.092,1.256],[0,0],[.243,.055],[-.387,.449],[0,0],[0,0],[-.985,1.011],[0,0],[.486,.259],[0,0],[.091,.426],[-.065,.22],[0,0],[0,0]],v:[[-2.185,10.463],[-9.046,13.991],[-10.773,6.192],[-4.989,3.815],[2.732,-7.339],[2.877,-7.636],[2.87,-7.639],[3.718,-9.918],[4.277,-12.523],[4.918,-11.449],[5.227,-10.566],[8.155,-13.847],[7.762,-12.559],[6.974,-11.407],[9.79,-13.572],[9.376,-12.654],[7.744,-10.723],[10.287,-12.523],[8.152,-9.578],[9.932,-10.722],[7.226,-6.375],[6.982,-5.622],[6.983,-5.623]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.985606414197,.768474563898,.65874077292,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[25.793,18.914],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 6",np:2,cix:2,bm:0,ix:6,mn:"ADBE Vector Group",hd:!1}],ip:0,op:210.000008553475,st:0,bm:0},{ddd:0,ind:14,ty:4,nm:"face Outlines",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:1,k:[{i:{x:[.667],y:[1]},o:{x:[.333],y:[0]},t:10,s:[0]},{i:{x:[.667],y:[1]},o:{x:[.333],y:[0]},t:26,s:[-8]},{i:{x:[.833],y:[.667]},o:{x:[.167],y:[0]},t:56,s:[5]},{i:{x:[.667],y:[1]},o:{x:[.167],y:[.063]},t:109,s:[0]},{i:{x:[.667],y:[1]},o:{x:[.333],y:[0]},t:125,s:[-8]},{i:{x:[.833],y:[.833]},o:{x:[.167],y:[0]},t:155,s:[5]},{t:183.000007453743,s:[0]}],ix:10},p:{a:0,k:[517.87,475.474,0],ix:2,l:2},a:{a:0,k:[8.573,24.351,0],ix:1,l:2},s:{a:0,k:[920.358,920.358,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-.029,-3.684],[-4.085,2.337],[-3.963,2.856],[-.591,-.176],[0,0],[3.321,1.146]],o:[[0,0],[0,0],[0,0],[0,0],[0,0],[-3.32,-1.147]],v:[[-5.445,-1.27],[1.66,-2.955],[4.146,2.136],[5.288,1.89],[5.445,1.941],[1.903,-4.602]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.204622410793,.204736836751,.20461286657,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[9.162,6.131],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-.068,-.187],[.331,-.114],[.069,.187],[-.332,.114]],o:[[.068,.187],[-.332,.115],[-.068,-.188],[.331,-.115]],v:[[.6,-.208],[.124,.339],[-.6,.208],[-.123,-.339]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.204622410793,.204736836751,.20461286657,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[4.026,5.924],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 2",np:2,cix:2,bm:0,ix:2,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[.03,-.196],[.348,.055],[-.03,.195],[-.348,-.055]],o:[[-.03,.195],[-.349,-.055],[.03,-.197],[.348,.055]],v:[[.63,.1],[-.055,.355],[-.631,-.098],[.055,-.355]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.204622410793,.204736836751,.20461286657,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[8.83,6.348],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 3",np:2,cix:2,bm:0,ix:3,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[-.02,-.239],[-.034,-.095],[-.025,.001],[-.08,.068],[-.074,.093],[-.131,.212],[0,0],[-.062,-.038],[.018,-.056],[.153,-.233],[.118,-.105],[.089,-.036],[.112,.034],[.057,.079],[.021,.076],[-.003,.139],[-.079,.26],[-.059,-.019],[.002,-.05]],o:[[-.009,.25],[.013,.119],[.034,.099],[.016,.009],[.08,-.063],[.146,-.189],[0,0],[.039,-.062],[.053,.033],[-.082,.26],[-.076,.117],[-.061,.052],[-.089,.037],[-.111,-.03],[-.058,-.08],[-.041,-.154],[.006,-.28],[.018,-.059],[.05,.014],[0,0]],v:[[-.447,-.758],[-.438,-.012],[-.374,.318],[-.268,.462],[-.102,.385],[.128,.139],[.544,-.478],[.548,-.482],[.73,-.525],[.786,-.372],[.445,.365],[.163,.699],[-.057,.837],[-.378,.859],[-.641,.674],[-.753,.437],[-.801,.001],[-.667,-.801],[-.527,-.874],[-.447,-.764]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.204622410793,.204736836751,.20461286657,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[3.903,7.829],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 4",np:2,cix:2,bm:0,ix:4,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[-.04,-.248],[-.137,-.033],[-.176,.179],[-.15,.215],[0,0],[-.06,-.042],[.022,-.056],[.198,-.232],[.151,-.087],[.198,.074],[.065,.156],[.009,.151],[-.079,.281],[-.059,-.017],[.002,-.051]],o:[[-.008,.265],[.038,.249],[.122,.054],[.175,-.178],[0,0],[.042,-.061],[.052,.036],[-.108,.273],[-.099,.114],[-.146,.084],[-.196,-.069],[-.069,-.158],[-.017,-.303],[.017,-.06],[.051,.013],[0,0]],v:[[-.616,-.813],[-.578,-.025],[-.301,.482],[.208,.232],[.7,-.378],[.704,-.383],[.888,-.417],[.936,-.26],[.493,.497],[.129,.807],[-.436,.872],[-.837,.48],[-.941,.014],[-.836,-.852],[-.698,-.93],[-.616,-.818]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.204622410793,.204736836751,.20461286657,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[8.288,8.359],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 5",np:2,cix:2,bm:0,ix:5,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-.116,.336],[.045,-.175],[.088,-.156],[.273,-.235],[0,0],[-.269,-.25],[.322,.162],[0,0],[0,0],[-.104,.129],[-.095,.135]],o:[[.045,.175],[-.046,.178],[-.182,.312],[0,0],[.296,.206],[-.348,-.12],[0,0],[0,0],[.105,-.125],[.102,-.134],[.194,-.272]],v:[[.592,-1.156],[.57,-.617],[.358,-.117],[-.324,.701],[-.35,.486],[.505,1.156],[-.491,.721],[-.637,.648],[-.517,.505],[-.204,.115],[.098,-.285]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.204622410793,.204736836751,.20461286657,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[5.41,8.245],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 6",np:2,cix:2,bm:0,ix:6,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[.062,.195],[-.159,-.063],[-.138,.002],[-.152,.07],[-.176,.107],[.156,-.15],[.243,.002],[.153,.143]],o:[[.192,.083],[.157,.067],[.138,.001],[.151,-.071],[-.034,.205],[-.15,.152],[-.243,0],[-.162,-.139]],v:[[-.928,-.365],[-.421,-.122],[.019,-.014],[.448,-.124],[.928,-.404],[.638,.139],[.018,.402],[-.598,.148]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.204622410793,.204736836751,.20461286657,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[6.174,13.211],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 7",np:2,cix:2,bm:0,ix:7,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[.26,-.175],[-.094,.127],[-.167,.064],[-.15,-.085],[-.058,-.144],[.122,.012],[.105,-.041]],o:[[.015,-.16],[.095,-.129],[.168,-.062],[.157,.077],[-.156,-.047],[-.119,-.015],[-.213,.076]],v:[[-.704,.398],[-.529,-.035],[-.135,-.337],[.389,-.299],[.704,.059],[.303,-.055],[-.023,-.023]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.204622410793,.204736836751,.20461286657,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[14.148,9.554],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 8",np:2,cix:2,bm:0,ix:8,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-.198,-.815],[.815,-.198],[.198,.815],[-.815,.198]],o:[[.198,.815],[-.816,.197],[-.198,-.816],[.815,-.198]],v:[[1.477,-.358],[.359,1.477],[-1.477,.359],[-.359,-1.476]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.985606414197,.768474563898,.65874077292,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[14.149,9.528],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 9",np:2,cix:2,bm:0,ix:9,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[-3.818,2.373],[3.884,-1.285]],o:[[0,0],[0,0],[0,0]],v:[[-2.827,-.517],[3.015,-2.213],[-3.015,2.213]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.721688364066,.479523094028,.467095109528,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[8.539,17.076],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 12",np:2,cix:2,bm:0,ix:10,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-.497,3.139],[-4.946,-2.877],[-.316,-1.715],[0,0],[.243,5.732],[0,0]],o:[[.443,-2.796],[1.556,.906],[.221,1.195],[-.419,4.708],[0,0],[-3.583,-1.151]],v:[[-5.204,-5.157],[2.969,-9.751],[5.503,-5.48],[5.301,7.464],[-2.432,7.557],[-2.141,3.632]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.985606414197,.768474563898,.65874077292,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[7.853,12.927],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 13",np:4,cix:2,bm:0,ix:11,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-9.867,-1.823],[2.523,7.152]],o:[[0,0],[-1.641,-4.654]],v:[[2.951,7.533],[4.393,-2.88]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.204622410793,.204736836751,.20461286657,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[9.581,8.291],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 14",np:2,cix:2,bm:0,ix:12,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,-1.703],[1.526,0],[0,1.703],[-1.525,0]],o:[[0,1.703],[-1.525,0],[0,-1.703],[1.526,0]],v:[[2.762,-.001],[-.922,5.066],[-2.762,-.001],[-.001,-3.083]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.204622410793,.204736836751,.20461286657,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[14.597,14.618],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 15",np:2,cix:2,bm:0,ix:13,mn:"ADBE Vector Group",hd:!1}],ip:0,op:210.000008553475,st:0,bm:0}],markers$1=[],cookingAnimation={v:v$1,fr:fr$1,ip:ip$1,op:op$1,w:w$1,h:h$1,nm:nm$1,ddd:ddd$1,assets:assets$1,layers:layers$1,markers:markers$1};function LoadingAnimation({message:e="Cooking up something delicious...",className:i="",fullScreen:s=!0,speed:a=2}){const _=reactExports.useRef(null);reactExports.useEffect(()=>{_.current&&_.current.setSpeed(a)},[a]);const $=jsxRuntimeExports.jsxs("div",{className:`flex flex-col items-center justify-center ${i}`,children:[jsxRuntimeExports.jsx("div",{className:"w-64 h-64",children:jsxRuntimeExports.jsx(Lottie,{lottieRef:_,animationData:cookingAnimation,loop:!0})}),e&&jsxRuntimeExports.jsx("p",{className:"text-muted-foreground mt-4 font-medium animate-pulse",children:e})]});return s?jsxRuntimeExports.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background safe-top safe-bottom",children:$}):$}function HomePage(){const{kitchens:e,loading:i,error:s}=useKitchens(),{user:a,loading:_}=useAuth(),{notifications:$}=useNotifications(a==null?void 0:a.id),rt=$.filter(ir=>!ir.read).length,{userLocation:c,locationLoading:dt,isInServiceArea:ht,checkingZone:Et,currentFranchiseId:St,refetchLocation:At}=useLocationContext(),Pt=useNavigate(),[Vt,Bt]=reactExports.useState("all"),[Zt,zt]=reactExports.useState(""),[Ut,Nt]=reactExports.useState(!0),Gt=reactExports.useRef(0);reactExports.useEffect(()=>{const ir=()=>{const or=window.scrollY;or<10?Nt(!0):or>Gt.current&&or>50?Nt(!1):or<Gt.current&&Nt(!0),Gt.current=or};return window.addEventListener("scroll",ir,{passive:!0}),()=>window.removeEventListener("scroll",ir)},[]),reactExports.useEffect(()=>{!_&&a&&(a.role==="amma"?Pt("/amma/dashboard"):a.role==="admin"?Pt("/admin"):a.role==="super_admin"?Pt("/super-admin"):a.role==="franchise_admin"&&a.franchiseId&&Pt("/admin"))},[a,_,Pt]);const er=e.filter(ir=>{if(!ir.isApproved||St&&ir.franchiseId!==St||Vt==="veg"&&!ir.isVeg||Vt==="open"&&!ir.isOpen)return!1;if(Zt){const or=Zt.toLowerCase();return ir.name.toLowerCase().includes(or)||ir.specialties.some(mr=>mr.toLowerCase().includes(or))}return!0});return Et?jsxRuntimeExports.jsx(LoadingAnimation,{message:"Finding your location..."}):ht?jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-32",children:[jsxRuntimeExports.jsx(motion.header,{initial:{y:0},animate:{y:Ut?0:"-100%"},transition:{duration:.3},className:"sticky top-0 z-40 bg-card/95 backdrop-blur-lg border-b border-border",children:jsxRuntimeExports.jsxs("div",{className:"px-4 py-3",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-3",children:[jsxRuntimeExports.jsxs(motion.button,{whileTap:{scale:.98},onClick:()=>Pt("/location-select"),className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center",children:dt?jsxRuntimeExports.jsx(LoaderCircle,{className:"w-5 h-5 text-primary animate-spin"}):jsxRuntimeExports.jsx(MapPin,{className:"w-5 h-5 text-primary"})}),jsxRuntimeExports.jsxs("div",{className:"text-left",children:[jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Deliver to"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1",children:[jsxRuntimeExports.jsx("span",{className:"font-semibold text-foreground max-w-[180px] truncate",children:dt?"Finding location...":(c==null?void 0:c.address)||"Set location"}),jsxRuntimeExports.jsx(ChevronDown,{className:"w-4 h-4 text-muted-foreground"})]})]})]}),jsxRuntimeExports.jsx(Link,{to:"/notifications",children:jsxRuntimeExports.jsxs(Button,{variant:"ghost",size:"icon",className:"relative",children:[jsxRuntimeExports.jsx(Bell,{className:"w-5 h-5"}),rt>0&&jsxRuntimeExports.jsx("span",{className:"absolute top-1 right-1 w-2 h-2 rounded-full bg-primary animate-pulse"})]})})]}),jsxRuntimeExports.jsx(Link,{to:"/search",children:jsxRuntimeExports.jsxs(motion.div,{whileTap:{scale:.99},className:"relative",children:[jsxRuntimeExports.jsx(Search,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-muted-foreground"}),jsxRuntimeExports.jsx("input",{type:"text",placeholder:"Search Biryani or Amma's Kitchen",value:Zt,onChange:ir=>zt(ir.target.value),className:"w-full pl-12 pr-4 py-3 rounded-xl bg-secondary border-0 text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary/20"})]})})]})}),jsxRuntimeExports.jsx("div",{className:"px-4 pt-4 pb-2",children:jsxRuntimeExports.jsx(Categories,{onSelectCategory:ir=>zt(ir),selectedCategory:Zt})}),jsxRuntimeExports.jsx(BestSellingSection,{}),jsxRuntimeExports.jsx("div",{className:"px-4 py-4 flex gap-2 overflow-x-auto hide-scrollbar",children:[{id:"all",label:"All"},{id:"open",label:" Open Now"},{id:"veg",label:" Pure Veg"}].map(ir=>jsxRuntimeExports.jsx(motion.button,{whileTap:{scale:.95},onClick:()=>Bt(ir.id),className:`px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors ${Vt===ir.id?"gradient-primary text-primary-foreground":"bg-secondary text-secondary-foreground"}`,children:ir.label},ir.id))}),jsxRuntimeExports.jsxs("div",{className:"px-4 mb-3",children:[jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold text-foreground",children:"Kitchens Near You"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:"Order homemade food from loving Ammas"})]}),jsxRuntimeExports.jsxs("div",{className:"px-4 space-y-4",children:[i?jsxRuntimeExports.jsx(LoadingAnimation,{fullScreen:!1,className:"py-12"}):s?jsxRuntimeExports.jsx("div",{className:"text-center py-12",children:jsxRuntimeExports.jsx("p",{className:"text-destructive",children:s})}):er.map((ir,or)=>jsxRuntimeExports.jsx(KitchenCard,{kitchen:ir,index:or},ir.id)),er.length===0&&!i&&!s&&jsxRuntimeExports.jsxs("div",{className:"text-center py-12",children:[jsxRuntimeExports.jsx("p",{className:"text-muted-foreground",children:"No kitchens found"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Be the first Amma to register your kitchen!"})]})]}),jsxRuntimeExports.jsx(BottomNav,{})]}):jsxRuntimeExports.jsx(OutOfZoneScreen,{})}function KitchenPage(){var Gt;const{id:e}=useParams(),{kitchen:i,loading:s,error:a}=useKitchen(e),{dishes:_,loading:$}=useDishes(e),{cart:rt,getTotal:c,getItemCount:dt}=useCart(),{user:ht,toggleFavorite:Et}=useAuth(),{userLocation:St}=useLocationContext(),[At,Pt]=reactExports.useState(!1),Vt=useNavigate(),Bt=e&&((Gt=ht==null?void 0:ht.favorites)==null?void 0:Gt.includes(e));reactExports.useEffect(()=>{const er=()=>{Pt(window.scrollY>100)};return window.addEventListener("scroll",er),()=>window.removeEventListener("scroll",er)},[]);const Zt=async()=>{if(navigator.share)try{await navigator.share({title:i==null?void 0:i.name,text:`Check out ${i==null?void 0:i.name} on Amma Cheythi Vanta!`,url:window.location.href})}catch(er){console.error("Error sharing:",er)}else navigator.clipboard.writeText(window.location.href),alert("Link copied to clipboard!")},zt=async er=>{if(er.stopPropagation(),!!e){if(!ht){alert("Please login to add favorites");return}await Et(e)}};if(s)return jsxRuntimeExports.jsx(LoadingAnimation,{});if(a||!i)return jsxRuntimeExports.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center bg-background px-4",children:[jsxRuntimeExports.jsx("p",{className:"text-muted-foreground mb-4",children:"Kitchen not found"}),jsxRuntimeExports.jsx(Link,{to:"/",children:jsxRuntimeExports.jsx(Button,{className:"gradient-primary text-primary-foreground",children:"Go Back Home"})})]});const Ut=St&&i.address.lat&&i.address.lng?calculateDistance(St.lat,St.lng,i.address.lat,i.address.lng):`${i.address.line1}, ${i.address.city}`,Nt=[...new Set(_.map(er=>er.category))];return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-32",children:[jsxRuntimeExports.jsx(AnimatePresence,{children:At&&jsxRuntimeExports.jsxs(motion.div,{initial:{y:-100},animate:{y:0},exit:{y:-100},transition:{type:"spring",stiffness:300,damping:30},className:"fixed top-0 left-0 right-0 z-50 bg-background/95 backdrop-blur-md shadow-sm border-b border-border px-4 py-2 flex items-center justify-between safe-top",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx(Link,{to:"/",children:jsxRuntimeExports.jsx(Button,{variant:"ghost",size:"icon",className:"h-9 w-9 -ml-2 rounded-full hover:bg-muted",children:jsxRuntimeExports.jsx(ArrowLeft,{className:"w-5 h-5 text-foreground"})})}),jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-foreground truncate max-w-[200px]",children:i.name})]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsx(Button,{variant:"ghost",size:"icon",className:"h-9 w-9 rounded-full hover:bg-muted",onClick:Zt,children:jsxRuntimeExports.jsx(Share2,{className:"w-5 h-5"})}),jsxRuntimeExports.jsx(Button,{variant:"ghost",size:"icon",className:"h-9 w-9 rounded-full hover:bg-muted",onClick:zt,children:jsxRuntimeExports.jsx(Heart,{className:cn("w-5 h-5",Bt?"fill-red-500 text-red-500":"")})})]})]})}),jsxRuntimeExports.jsxs("div",{className:"relative h-56",children:[jsxRuntimeExports.jsx(CachedImage,{src:i.coverImage||i.image,alt:i.name,className:"w-full h-full object-cover"}),jsxRuntimeExports.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-background via-transparent to-transparent"}),jsxRuntimeExports.jsxs("div",{className:"absolute top-4 left-4 right-4 flex justify-between z-10",children:[jsxRuntimeExports.jsx(Link,{to:"/",children:jsxRuntimeExports.jsx(motion.div,{whileTap:{scale:.9},className:"w-10 h-10 rounded-full bg-card/90 backdrop-blur-sm flex items-center justify-center shadow-soft cursor-pointer",children:jsxRuntimeExports.jsx(ArrowLeft,{className:"w-5 h-5"})})}),jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsx(motion.button,{whileTap:{scale:.9},onClick:Zt,className:"w-10 h-10 rounded-full bg-card/90 backdrop-blur-sm flex items-center justify-center shadow-soft",children:jsxRuntimeExports.jsx(Share2,{className:"w-5 h-5"})}),jsxRuntimeExports.jsx(motion.button,{whileTap:{scale:.9},onClick:zt,className:"w-10 h-10 rounded-full bg-card/90 backdrop-blur-sm flex items-center justify-center shadow-soft",children:jsxRuntimeExports.jsx(Heart,{className:cn("w-5 h-5 transition-colors",Bt?"fill-red-500 text-red-500":"")})})]})]})]}),jsxRuntimeExports.jsx("div",{className:"px-4 -mt-8 relative z-10",children:jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-card rounded-2xl p-4 shadow-elevated",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-start justify-between mb-3",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[i.isVeg&&jsxRuntimeExports.jsx("div",{className:"p-1 rounded-full bg-veg/10",children:jsxRuntimeExports.jsx(Leaf,{className:"w-3 h-3 text-veg"})}),jsxRuntimeExports.jsx("h1",{className:"text-xl font-bold text-foreground",children:i.name})]}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:i.specialties.join("  ")})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1 px-2.5 py-1 rounded-lg bg-gold-soft",children:[jsxRuntimeExports.jsx(Star,{className:"w-4 h-4 text-gold fill-gold"}),jsxRuntimeExports.jsx("span",{className:"font-bold text-foreground",children:i.rating}),jsxRuntimeExports.jsxs("span",{className:"text-muted-foreground text-sm",children:["(",i.totalRatings,")"]})]})]}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:i.description}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1.5 text-muted-foreground",children:[jsxRuntimeExports.jsx(Clock,{className:"w-4 h-4"}),jsxRuntimeExports.jsx("span",{children:i.cookingTime})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1.5 text-muted-foreground",children:[jsxRuntimeExports.jsx(MapPin,{className:"w-4 h-4"}),jsxRuntimeExports.jsx("span",{children:Ut})]})]}),jsxRuntimeExports.jsx("div",{className:cn("mt-4 px-3 py-2 rounded-lg text-sm font-medium text-center",i.isOpen?"bg-accent/10 text-accent":"bg-muted text-muted-foreground"),children:i.isOpen?" Kitchen is open and cooking!":" Kitchen is closed"})]})}),jsxRuntimeExports.jsxs("div",{className:"px-4 mt-6",children:[jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold text-foreground mb-4",children:"Menu"}),$?jsxRuntimeExports.jsx(LoadingAnimation,{fullScreen:!1,className:"py-12"}):_.length===0?jsxRuntimeExports.jsx("div",{className:"text-center py-12",children:jsxRuntimeExports.jsx("p",{className:"text-muted-foreground",children:"No dishes available yet"})}):Nt.map(er=>jsxRuntimeExports.jsxs("div",{className:"mb-6",children:[jsxRuntimeExports.jsx("h3",{className:"text-sm font-semibold text-muted-foreground uppercase tracking-wide mb-3",children:er}),jsxRuntimeExports.jsx("div",{className:"space-y-4",children:_.filter(ir=>ir.category===er).map(ir=>jsxRuntimeExports.jsx(DishCard,{dish:ir,kitchenId:i.id,kitchenName:i.name},ir.id))})]},er))]}),rt.items.length>0&&rt.kitchenId===i.id&&jsxRuntimeExports.jsx(motion.div,{initial:{y:100},animate:{y:0},className:"fixed bottom-0 left-0 right-0 p-4 bg-card/95 backdrop-blur-lg border-t border-border safe-bottom z-50",children:jsxRuntimeExports.jsxs(Button,{onClick:()=>Vt("/cart"),className:"w-full h-14 gradient-primary text-primary-foreground text-lg font-bold rounded-xl shadow-lg hover:shadow-xl transition-all flex items-center justify-between px-6",children:[jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-start text-xs font-normal",children:[jsxRuntimeExports.jsxs("span",{className:"font-bold text-base",children:[dt()," items"]}),jsxRuntimeExports.jsx("span",{className:"opacity-90",children:"Place Order"})]}),jsxRuntimeExports.jsxs("span",{className:"text-xl",children:["",c()]})]})})]})}const scriptRel="modulepreload",assetsURL=function(e){return"/ammacheythivantalive/"+e},seen={},__vitePreload=function e(i,s,a){let _=Promise.resolve();if(s&&s.length>0){document.getElementsByTagName("link");const rt=document.querySelector("meta[property=csp-nonce]"),c=(rt==null?void 0:rt.nonce)||(rt==null?void 0:rt.getAttribute("nonce"));_=Promise.allSettled(s.map(dt=>{if(dt=assetsURL(dt),dt in seen)return;seen[dt]=!0;const ht=dt.endsWith(".css"),Et=ht?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${dt}"]${Et}`))return;const St=document.createElement("link");if(St.rel=ht?"stylesheet":scriptRel,ht||(St.as="script"),St.crossOrigin="",St.href=dt,c&&St.setAttribute("nonce",c),document.head.appendChild(St),ht)return new Promise((At,Pt)=>{St.addEventListener("load",At),St.addEventListener("error",()=>Pt(new Error(`Unable to preload CSS for ${dt}`)))})}))}function $(rt){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=rt,window.dispatchEvent(c),!c.defaultPrevented)throw rt}return _.then(rt=>{for(const c of rt||[])c.status==="rejected"&&$(c.reason);return i().catch($)})},Input=reactExports.forwardRef(({className:e,type:i,...s},a)=>jsxRuntimeExports.jsx("input",{type:i,className:cn("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),ref:a,...s}));Input.displayName="Input";const Textarea=reactExports.forwardRef(({className:e,...i},s)=>jsxRuntimeExports.jsx("textarea",{className:cn("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:s,...i}));Textarea.displayName="Textarea";const RAZORPAY_KEY_ID="rzp_live_HJl9NwyBSY9rwV";function loadRazorpayScript(){return new Promise(e=>{if(window.Razorpay){e(!0);return}const i=document.createElement("script");i.src="https://checkout.razorpay.com/v1/checkout.js",i.onload=()=>e(!0),i.onerror=()=>e(!1),document.body.appendChild(i)})}async function createRazorpayOrder(e,i,s){const a="https://shesettipavankumarswamy-popandfun2.hf.space/create-order";try{const _=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:e,email:i,contact:s})});if(!_.ok)throw new Error(`Backend error: ${_.statusText}`);const $=await _.json();if($.success&&$.order_id)return{orderId:$.order_id};throw new Error($.error||"Failed to create order")}catch(_){throw console.error("Error creating Razorpay order:",_),_}}async function fetchRazorpayKey(){try{return(await(await fetch("https://shesettipavankumarswamy-popandfun2.hf.space/razorpay-key")).json()).key||RAZORPAY_KEY_ID}catch{return RAZORPAY_KEY_ID}}async function initiatePayment(e,i,s,a,_,$,rt,c){if(!await loadRazorpayScript())throw new Error("Failed to load Razorpay SDK");const ht={key:c||RAZORPAY_KEY_ID,amount:e*100,currency:"INR",name:"Amma Cheythi Vanta",description:"Homemade food order payment",order_id:rt,prefill:{name:i,email:s,contact:a},theme:{color:"#D97706"},handler:_,modal:{ondismiss:$}};new window.Razorpay(ht).open()}const razorpay=Object.freeze(Object.defineProperty({__proto__:null,RAZORPAY_KEY_ID,createRazorpayOrder,fetchRazorpayKey,initiatePayment,loadRazorpayScript},Symbol.toStringTag,{value:"Module"}));function CartPage(){var On,ws,Vs,ks,lo,ys,dn,Es,po,no;const{cart:e,updateQuantity:i,removeFromCart:s,clearCart:a,getTotal:_,getItemCount:$,updateCookingInstructions:rt,applyCoupon:c,removeCoupon:dt,addToCart:ht}=useCart(),{user:Et}=useAuth();useLocationContext();const St=useNavigate(),[At,Pt]=reactExports.useState(!1),[Vt,Bt]=reactExports.useState({line1:((On=Et==null?void 0:Et.address)==null?void 0:On.line1)||"",line2:((ws=Et==null?void 0:Et.address)==null?void 0:ws.line2)||"",city:((Vs=Et==null?void 0:Et.address)==null?void 0:Vs.city)||"",pincode:((ks=Et==null?void 0:Et.address)==null?void 0:ks.pincode)||"",landmark:((lo=Et==null?void 0:Et.address)==null?void 0:lo.landmark)||"",label:(ys=Et==null?void 0:Et.address)==null?void 0:ys.label}),[Zt,zt]=reactExports.useState(!0),[Ut,Nt]=reactExports.useState(!1),[Gt,er]=reactExports.useState(!1),{coupons:ir,loading:or}=useCoupons(e.kitchenId||void 0),[mr,Rr]=reactExports.useState(""),[on,un]=reactExports.useState(!1),[jr,Jr]=reactExports.useState("");reactExports.useEffect(()=>{Et!=null&&Et.address&&(Et.address.line1||Et.address.city)&&Bt(Et.address)},[Et]);const fn=tn=>{var Ss,Ul;const us=((Ss=e.cookingInstructions)==null?void 0:Ss.tags)||[],Co=us.includes(tn)?us.filter(Tl=>Tl!==tn):[...us,tn];if(Co.length>3){ue.error("You can select up to 3 instructions");return}rt(Co,((Ul=e.cookingInstructions)==null?void 0:Ul.note)||"")},Fr=tn=>{var us;rt(((us=e.cookingInstructions)==null?void 0:us.tags)||[],tn)},{kitchen:Cr}=useKitchen(e.kitchenId||void 0),{dishes:Sr}=useDishes(e.kitchenId||void 0),dr=(()=>{var ga,ds;if(!((ga=Cr==null?void 0:Cr.address)!=null&&ga.lat)||!((ds=Cr==null?void 0:Cr.address)!=null&&ds.lng)||!Vt.lat||!Vt.lng)return 30;const tn=6371,us=(Vt.lat-Cr.address.lat)*(Math.PI/180),Co=(Vt.lng-Cr.address.lng)*(Math.PI/180),Ss=Math.sin(us/2)*Math.sin(us/2)+Math.cos(Cr.address.lat*(Math.PI/180))*Math.cos(Vt.lat*(Math.PI/180))*Math.sin(Co/2)*Math.sin(Co/2),Ul=2*Math.atan2(Math.sqrt(Ss),Math.sqrt(1-Ss)),Tl=tn*Ul;return 20+Math.ceil(Tl*5)})(),gr=0,qr=_(),_n=(()=>{if(!e.appliedCoupon)return 0;if(e.appliedCoupon.code.toUpperCase()==="PA1")return qr+dr+gr-1;if(e.appliedCoupon.discountType==="percentage"){const tn=qr*e.appliedCoupon.discountValue/100;return e.appliedCoupon.maxDiscount?Math.min(tn,e.appliedCoupon.maxDiscount):tn}else{if(e.appliedCoupon.discountType==="fixed")return Math.min(e.appliedCoupon.discountValue,qr);if(e.appliedCoupon.discountType==="final_price")return qr+dr+gr-e.appliedCoupon.discountValue}return 0})(),gn=Math.max(1,qr+dr+gr-_n),Sn=async()=>{if(!mr.trim()){Jr("Please enter a coupon code");return}un(!0),Jr("");try{if(mr.toUpperCase()==="PA1"){const us={id:"pa1-default",code:"PA1",kitchenId:"system",discountType:"final_price",discountValue:1,usedCount:0,isActive:!0,createdAt:Date.now()};c(us),ue.success(" Special coupon applied! Final price: 1"),un(!1);return}const tn=await getCouponByCode(mr);if(!tn){Jr("Invalid coupon code"),un(!1);return}if(!tn.isActive){Jr("This coupon is no longer active"),un(!1);return}if(tn.expiresAt&&tn.expiresAt<Date.now()){Jr("This coupon has expired"),un(!1);return}if(tn.usageLimit&&tn.usedCount>=tn.usageLimit){Jr("This coupon has reached its usage limit"),un(!1);return}if(tn.minOrderAmount&&qr<tn.minOrderAmount){Jr(`Minimum order amount is ${tn.minOrderAmount}`),un(!1);return}if(tn.kitchenId!==e.kitchenId&&tn.kitchenId!=="system"){Jr("This coupon is not valid for this kitchen"),un(!1);return}c(tn),ue.success("Coupon applied successfully!")}catch{Jr("Failed to apply coupon")}un(!1)},Fs=()=>{dt(),Rr(""),Jr("")},rs=()=>!Vt.line1&&!Vt.city?(ue.error("Please select a valid delivery address"),!1):!Vt.pincode&&!Vt.city?(ue.error("Address information is incomplete (missing city/pincode)"),!1):!0,ms=async()=>{if(!Et){ue.error("Please login to continue"),St("/auth");return}if(rs()){if(e.items.length===0){ue.error("Your cart is empty");return}Pt(!0);try{let tn,us;try{const{createRazorpayOrder:Co,fetchRazorpayKey:Ss}=await __vitePreload(async()=>{const{createRazorpayOrder:Tl,fetchRazorpayKey:ga}=await Promise.resolve().then(()=>razorpay);return{createRazorpayOrder:Tl,fetchRazorpayKey:ga}},void 0);us=await Ss(),tn=(await Co(gn,Et.email,Et.phone)).orderId}catch(Co){console.warn("Backend order creation failed, falling back to client-side checkout:",Co)}await initiatePayment(gn,Et.name,Et.email,Et.phone||"",async Co=>{var Ss,Ul;try{const Tl=await createOrder({userId:Et.id,kitchenId:e.kitchenId,kitchenName:e.kitchenName,items:e.items,status:"pending",totalAmount:gn,deliveryAddress:Vt,notes:[...((Ss=e.cookingInstructions)==null?void 0:Ss.tags)||[],(Ul=e.cookingInstructions)==null?void 0:Ul.note].filter(Boolean).join(", "),createdAt:Date.now(),updatedAt:Date.now(),estimatedDelivery:"30-45 mins",paymentId:Co.razorpay_payment_id,razorpayOrderId:Co.razorpay_order_id});ue.success("Order placed successfully!"),a(),St("/order-success",{replace:!0})}catch(Tl){console.error("Order creation failed:",Tl),ue.error("Failed to create order. Please contact support.")}Pt(!1)},()=>{Pt(!1)},tn,us)}catch(tn){console.error("Payment initiation failed:",tn),ue.error("Payment failed. Please try again."),Pt(!1)}}};return e.items.length===0?jsxRuntimeExports.jsx("div",{className:"min-h-screen bg-background flex flex-col items-center justify-center px-4",children:jsxRuntimeExports.jsxs(motion.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},className:"text-center",children:[jsxRuntimeExports.jsx("div",{className:"w-24 h-24 rounded-full bg-secondary flex items-center justify-center mx-auto mb-4",children:jsxRuntimeExports.jsx(ChefHat,{className:"w-12 h-12 text-muted-foreground"})}),jsxRuntimeExports.jsx("h2",{className:"text-xl font-semibold text-foreground mb-2",children:"Your cart is empty"}),jsxRuntimeExports.jsx("p",{className:"text-muted-foreground mb-6",children:"Add delicious homemade food from nearby Ammas"}),jsxRuntimeExports.jsx(Link,{to:"/",children:jsxRuntimeExports.jsx(Button,{className:"gradient-primary text-primary-foreground px-8",children:"Explore Kitchens"})})]})}):jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-32",children:[jsxRuntimeExports.jsx("header",{className:"sticky top-0 z-40 bg-card/95 backdrop-blur-lg border-b border-border",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-4 px-4 py-4",children:[jsxRuntimeExports.jsx(Link,{to:"/",children:jsxRuntimeExports.jsx(motion.div,{whileTap:{scale:.9},className:"w-10 h-10 rounded-full bg-secondary flex items-center justify-center",children:jsxRuntimeExports.jsx(ArrowLeft,{className:"w-5 h-5"})})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 flex flex-col justify-center min-w-0",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground mb-0.5",children:[jsxRuntimeExports.jsxs("span",{className:"font-medium text-foreground truncate",children:["Order from ",e.kitchenName]}),jsxRuntimeExports.jsx("span",{className:"text-[10px] text-muted-foreground/50 shrink-0",children:"|"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1 shrink-0",children:[jsxRuntimeExports.jsx(Clock,{className:"w-3 h-3"}),jsxRuntimeExports.jsx("span",{children:"30-45 mins"})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1 cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>Nt(!0),children:[jsxRuntimeExports.jsxs("span",{className:"font-bold text-sm text-foreground truncate leading-none",children:["To ",Vt.line1?Vt.line1:"Select Address"]}),jsxRuntimeExports.jsx(ChevronDown,{className:"w-4 h-4 text-primary shrink-0"})]})]})]})}),jsxRuntimeExports.jsx("div",{className:"px-4 py-4",children:jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-2xl p-4 shadow-card",children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-foreground mb-3",children:"Items"}),jsxRuntimeExports.jsx(AnimatePresence,{children:e.items.map((tn,us)=>jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{delay:us*.05},className:"flex gap-4 py-4 border-b border-border last:border-0",children:[jsxRuntimeExports.jsx("div",{className:cn("w-4 h-4 border-2 rounded-sm flex items-center justify-center mt-1 flex-shrink-0",tn.dish.isVeg?"border-veg":"border-non-veg"),children:jsxRuntimeExports.jsx("div",{className:cn("w-2 h-2 rounded-full",tn.dish.isVeg?"bg-veg":"bg-non-veg")})}),jsxRuntimeExports.jsx("div",{className:"flex-1 min-w-0",children:jsxRuntimeExports.jsx("h3",{className:"font-medium text-foreground truncate capitalize",children:tn.dish.name})}),jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-end gap-1",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1 bg-secondary rounded-lg",children:[jsxRuntimeExports.jsx(Button,{onClick:()=>i(tn.dish.id,tn.quantity-1),size:"icon",variant:"ghost",className:"h-7 w-7",children:tn.quantity===1?jsxRuntimeExports.jsx(Trash2,{className:"w-3 h-3 text-destructive"}):jsxRuntimeExports.jsx(Minus,{className:"w-3 h-3"})}),jsxRuntimeExports.jsx("span",{className:"font-semibold text-foreground px-2 min-w-[20px] text-center text-sm",children:tn.quantity}),jsxRuntimeExports.jsx(Button,{onClick:()=>i(tn.dish.id,tn.quantity+1),size:"icon",variant:"ghost",className:"h-7 w-7",children:jsxRuntimeExports.jsx(Plus,{className:"w-3 h-3"})})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1.5 mt-0.5",children:[tn.dish.originalPrice&&tn.dish.originalPrice>tn.dish.price&&jsxRuntimeExports.jsxs("span",{className:"text-xs text-muted-foreground line-through decoration-destructive/60",children:["",tn.dish.originalPrice*tn.quantity]}),jsxRuntimeExports.jsxs("span",{className:"font-semibold text-foreground text-sm",children:["",tn.dish.price*tn.quantity]})]})]})]},tn.dish.id))}),jsxRuntimeExports.jsx(Link,{to:`/kitchen/${e.kitchenId}`,children:jsxRuntimeExports.jsx(Button,{variant:"ghost",className:"w-full mt-2 text-primary rounded-none pt-4 pb-0 h-auto hover:bg-transparent hover:text-primary/80",children:"+ (Add more items)"})}),jsxRuntimeExports.jsxs("div",{className:"pt-4 mt-2",children:[jsxRuntimeExports.jsx("div",{className:"flex gap-2 overflow-x-auto pb-1 [&::-webkit-scrollbar]:hidden -mx-4 px-4",children:["Less Spicy","More Spicy","No Onions","Extra Cutlery","Leave at Door","Quick","Other"].map(tn=>{var us;return jsxRuntimeExports.jsx("button",{onClick:()=>fn(tn),className:cn("px-3 py-1.5 rounded-full text-xs font-medium border transition-all whitespace-nowrap flex-shrink-0",(((us=e.cookingInstructions)==null?void 0:us.tags)||[]).includes(tn)?"bg-primary/10 border-primary text-primary":"bg-background border-border text-muted-foreground hover:border-primary/50"),children:tn},tn)})}),(((dn=e.cookingInstructions)==null?void 0:dn.tags)||[]).includes("Other")&&jsxRuntimeExports.jsx(Textarea,{placeholder:"Please type your custom instructions here...",value:((Es=e.cookingInstructions)==null?void 0:Es.note)||"",onChange:tn=>Fr(tn.target.value),className:"bg-secondary border-0 resize-none animate-in fade-in slide-in-from-top-2 mt-3",rows:2})]})]})}),Sr.length>0&&jsxRuntimeExports.jsxs("div",{className:"px-4 mt-4",children:[jsxRuntimeExports.jsx("div",{className:"flex items-center justify-between mb-3 px-1",children:jsxRuntimeExports.jsx("h3",{className:"font-semibold text-foreground",children:"Complete your meal with"})}),jsxRuntimeExports.jsx("div",{className:"flex gap-4 overflow-x-auto px-4 pb-4 [&::-webkit-scrollbar]:hidden snap-x snap-mandatory -mx-4",children:Sr.map(tn=>jsxRuntimeExports.jsx("div",{className:"min-w-[160px] max-w-[160px] snap-center flex flex-col",children:jsxRuntimeExports.jsx(DishCard,{dish:tn,kitchenId:e.kitchenId,kitchenName:e.kitchenName||"Unknown Kitchen",className:"h-full",variant:"compact"})},tn.id))})]}),jsxRuntimeExports.jsx("div",{className:"px-4 mt-4",children:jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-2xl p-4 shadow-card",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[jsxRuntimeExports.jsx(Tag,{className:"w-5 h-5 text-primary"}),jsxRuntimeExports.jsx("h3",{className:"font-semibold text-foreground",children:"Apply Discount Coupon"})]}),e.appliedCoupon?jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between bg-veg/10 rounded-xl p-3",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx(Check,{className:"w-5 h-5 text-veg"}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"font-semibold text-foreground",children:e.appliedCoupon.code}),jsxRuntimeExports.jsx("p",{className:"text-xs text-veg",children:e.appliedCoupon.code.toUpperCase()==="PA1"?"Special offer: Final price 1!":`Saving ${_n}`})]})]}),jsxRuntimeExports.jsx(Button,{variant:"ghost",size:"sm",onClick:Fs,className:"text-destructive",children:jsxRuntimeExports.jsx(X,{className:"w-4 h-4"})})]}):jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsx(Input,{placeholder:"Enter coupon code ",value:mr,onChange:tn=>{Rr(tn.target.value.toUpperCase()),Jr("")},className:"bg-secondary border-0 uppercase"}),jsxRuntimeExports.jsx(Button,{onClick:Sn,disabled:on,className:"gradient-primary text-primary-foreground",children:on?jsxRuntimeExports.jsx(LoaderCircle,{className:"w-4 h-4 animate-spin"}):"Apply"})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center pt-2",children:[jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Have a promo code?"}),jsxRuntimeExports.jsx(Button,{variant:"link",size:"sm",onClick:()=>er(!0),className:"text-primary font-semibold text-xs h-auto p-0",children:"View Available Coupons"})]}),jr&&jsxRuntimeExports.jsx("p",{className:"text-xs text-destructive",children:jr})]})]})}),jsxRuntimeExports.jsx("div",{className:"px-4 mt-4",children:jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-2xl p-4 shadow-card",children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-foreground mb-4",children:"Bill Details"}),jsxRuntimeExports.jsxs("div",{className:"space-y-2 text-sm",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-muted-foreground",children:"Item Total"}),jsxRuntimeExports.jsxs("span",{className:"text-foreground",children:["",qr]})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-muted-foreground",children:"Delivery Fee"}),jsxRuntimeExports.jsxs("span",{className:"text-foreground",children:["",dr]})]}),gr>0,e.appliedCoupon&&_n>0&&jsxRuntimeExports.jsxs("div",{className:"flex justify-between text-veg",children:[jsxRuntimeExports.jsxs("span",{children:["Discount (",e.appliedCoupon.code,")"]}),jsxRuntimeExports.jsxs("span",{children:["-",_n]})]}),jsxRuntimeExports.jsx("div",{className:"border-t border-border pt-2 mt-2",children:jsxRuntimeExports.jsxs("div",{className:"flex justify-between font-semibold",children:[jsxRuntimeExports.jsx("span",{className:"text-foreground",children:"To Pay"}),jsxRuntimeExports.jsxs("span",{className:"text-foreground",children:["",gn]})]})})]})]})}),jsxRuntimeExports.jsxs(motion.div,{initial:{y:100},animate:{y:0},className:"fixed bottom-0 left-0 right-0 p-4 bg-card/95 backdrop-blur-lg border-t border-border safe-bottom z-40 flex items-center gap-3",children:[jsxRuntimeExports.jsxs("div",{className:"flex-1 h-14 flex flex-col items-start justify-center p-1 pl-3 bg-white rounded-xl border border-gray-200 shadow-sm",children:[jsxRuntimeExports.jsx("span",{className:"text-[10px] text-muted-foreground font-medium leading-tight",children:"Pay using"}),jsxRuntimeExports.jsx("img",{src:"https://upload.wikimedia.org/wikipedia/commons/8/89/Razorpay_logo.svg",alt:"Pay with Razorpay",className:"h-4 w-auto object-contain"})]}),jsxRuntimeExports.jsx(Button,{onClick:ms,disabled:At||!Zt,className:`flex-1 h-14 rounded-xl shadow-elevated ${Zt?"gradient-primary text-primary-foreground":"bg-muted text-muted-foreground cursor-not-allowed"}`,children:At?jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx(LoaderCircle,{className:"w-5 h-5 animate-spin"}),jsxRuntimeExports.jsx("span",{children:"Processing..."})]}):Zt?jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between w-full px-1",children:[jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-start leading-none",children:[jsxRuntimeExports.jsxs("span",{className:"font-bold text-base",children:["",gn]}),jsxRuntimeExports.jsx("span",{className:"text-[10px] font-medium opacity-80 uppercase mt-0.5",children:"TOTAL"})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1",children:[jsxRuntimeExports.jsx("span",{className:"font-semibold text-[11px] uppercase tracking-wider leading-none",children:"Place Order"}),jsxRuntimeExports.jsx(ChevronRight,{className:"w-4 h-4"})]})]}):jsxRuntimeExports.jsx("div",{className:"flex items-center gap-2 text-sm",children:jsxRuntimeExports.jsx("span",{className:"font-semibold text-center leading-tight",children:"Delivery Unavail."})})})]}),jsxRuntimeExports.jsxs(AnimatePresence,{children:[Ut&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>Nt(!1),className:"fixed inset-0 bg-black/60 z-50 backdrop-blur-sm"}),jsxRuntimeExports.jsxs(motion.div,{initial:{y:"100%"},animate:{y:0},exit:{y:"100%"},transition:{type:"spring",damping:25,stiffness:300},className:"fixed bottom-0 left-0 right-0 bg-background z-50 rounded-t-3xl shadow-2xl h-[70vh] flex flex-col",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center p-5 pb-2 shrink-0",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"font-bold text-xl text-foreground",children:"Select Location"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:"Choose where to deliver your food"})]}),jsxRuntimeExports.jsx(Button,{variant:"ghost",size:"icon",onClick:()=>Nt(!1),className:"rounded-full bg-secondary",children:jsxRuntimeExports.jsx(X,{className:"w-5 h-5"})})]}),jsxRuntimeExports.jsxs("div",{className:"p-5 pt-2 space-y-4 overflow-y-auto flex-1 [&::-webkit-scrollbar]:hidden [-ms-overflow-style:none] [scrollbar-width:none]",children:[(po=Et==null?void 0:Et.savedAddresses)==null?void 0:po.map((tn,us)=>jsxRuntimeExports.jsxs("div",{onClick:()=>{Bt(tn),Nt(!1)},className:cn("p-4 rounded-2xl border transition-all cursor-pointer flex items-start gap-4",Vt.line1===tn.line1?"border-primary bg-primary/5 ring-1 ring-primary/20":"border-border hover:border-primary/30"),children:[jsxRuntimeExports.jsx("div",{className:cn("w-10 h-10 rounded-full flex items-center justify-center shrink-0",Vt.line1===tn.line1?"bg-primary text-white":"bg-secondary text-muted-foreground"),children:jsxRuntimeExports.jsx(MapPin,{className:"w-5 h-5"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h4",{className:"font-bold text-foreground capitalize mb-0.5",children:tn.label||"Address"}),jsxRuntimeExports.jsxs("p",{className:"text-sm text-muted-foreground line-clamp-2",children:[tn.line1,", ",tn.city]})]}),Vt.line1===tn.line1&&jsxRuntimeExports.jsx(Check,{className:"w-5 h-5 text-primary ml-auto"})]},us)),(!(Et!=null&&Et.savedAddresses)||Et.savedAddresses.length===0)&&jsxRuntimeExports.jsx("div",{className:"text-center py-8",children:jsxRuntimeExports.jsx("p",{className:"text-muted-foreground",children:"No saved addresses found"})})]}),jsxRuntimeExports.jsx("div",{className:"p-5 pt-2 border-t border-border shrink-0 bg-background",children:jsxRuntimeExports.jsxs(Button,{onClick:()=>St("/addresses"),variant:"outline",className:"w-full h-14 border-dashed border-primary/50 text-primary hover:bg-primary/5 rounded-xl font-semibold gap-2",children:[jsxRuntimeExports.jsx(Plus,{className:"w-5 h-5"}),"Add New Address"]})})]})]}),Gt&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>er(!1),className:"fixed inset-0 bg-black/60 z-50 backdrop-blur-sm"}),jsxRuntimeExports.jsxs(motion.div,{initial:{y:"100%"},animate:{y:0},exit:{y:"100%"},transition:{type:"spring",damping:25,stiffness:300},className:"fixed bottom-0 left-0 right-0 bg-background z-50 rounded-t-3xl shadow-2xl h-[70vh] flex flex-col",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center p-5 pb-2 shrink-0",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"font-bold text-xl text-foreground",children:"Apply Coupon"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:"Available offers for you"})]}),jsxRuntimeExports.jsx(Button,{variant:"ghost",size:"icon",onClick:()=>er(!1),className:"rounded-full bg-secondary",children:jsxRuntimeExports.jsx(X,{className:"w-5 h-5"})})]}),jsxRuntimeExports.jsxs("div",{className:"p-5 pt-2 space-y-4 overflow-y-auto flex-1 [&::-webkit-scrollbar]:hidden [-ms-overflow-style:none] [scrollbar-width:none]",children:[jsxRuntimeExports.jsxs("div",{onClick:()=>{const tn={id:"pa1-default",code:"PA1",kitchenId:"system",discountType:"final_price",discountValue:1,usedCount:0,isActive:!0,createdAt:Date.now()};c(tn),ue.success(" Special coupon applied!"),er(!1)},className:"bg-card border border-border rounded-xl p-4 relative overflow-hidden cursor-pointer hover:border-primary transition-all shadow-sm active:scale-[0.98]",children:[jsxRuntimeExports.jsx("div",{className:"absolute top-0 right-0 bg-gold/10 text-gold text-[10px] font-bold px-2 py-1 rounded-bl-lg",children:"SPECIAL"}),jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-4",children:[jsxRuntimeExports.jsx("div",{className:"w-12 h-12 rounded-lg bg-gold/10 flex items-center justify-center flex-shrink-0",children:jsxRuntimeExports.jsx(Percent,{className:"w-6 h-6 text-gold"})}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsx("h3",{className:"font-bold text-foreground",children:"PAY ONLY 1"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-green-600 font-medium mb-1",children:"Code: PA1"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Get your entire order for just 1. Limited time special offer!"})]}),((no=e.appliedCoupon)==null?void 0:no.code)==="PA1"&&jsxRuntimeExports.jsx(Check,{className:"w-6 h-6 text-primary"})]}),jsxRuntimeExports.jsx("div",{className:"mt-3 pt-3 border-t border-dashed border-border flex justify-between items-center text-xs",children:jsxRuntimeExports.jsx("span",{className:"text-primary font-bold",children:"APPLY COUPON"})})]}),or?jsxRuntimeExports.jsx("div",{className:"flex justify-center py-4",children:jsxRuntimeExports.jsx(LoaderCircle,{className:"w-6 h-6 animate-spin text-primary"})}):ir.length>0?ir.map(tn=>{var us,Co;return jsxRuntimeExports.jsxs("div",{onClick:()=>{c(tn),ue.success("Coupon applied successfully!"),er(!1)},className:cn("bg-card border rounded-xl p-4 relative overflow-hidden cursor-pointer hover:border-primary transition-all shadow-sm active:scale-[0.98]",((us=e.appliedCoupon)==null?void 0:us.id)===tn.id?"border-primary bg-primary/5":"border-border"),children:[jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-4",children:[jsxRuntimeExports.jsx("div",{className:"w-12 h-12 rounded-lg bg-primary/10 flex items-center justify-center flex-shrink-0",children:jsxRuntimeExports.jsx(Tag,{className:"w-6 h-6 text-primary"})}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsx("h3",{className:"font-bold text-foreground",children:tn.discountType==="percentage"?`${tn.discountValue}% OFF`:tn.discountType==="fixed"?`FLAT ${tn.discountValue} OFF`:`PAY ${tn.discountValue}`}),jsxRuntimeExports.jsxs("p",{className:"text-sm text-green-600 font-medium mb-1",children:["Code: ",tn.code]}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-muted-foreground",children:[tn.minOrderAmount?`Min order: ${tn.minOrderAmount}`:"No minimum order",tn.maxDiscount?` | Max: ${tn.maxDiscount}`:""]})]}),((Co=e.appliedCoupon)==null?void 0:Co.id)===tn.id&&jsxRuntimeExports.jsx(Check,{className:"w-6 h-6 text-primary"})]}),jsxRuntimeExports.jsx("div",{className:"mt-3 pt-3 border-t border-dashed border-border flex justify-between items-center text-xs",children:jsxRuntimeExports.jsx("span",{className:"text-primary font-bold",children:"APPLY COUPON"})})]},tn.id)}):jsxRuntimeExports.jsx("div",{className:"text-center py-4 text-muted-foreground text-sm",children:"No other coupons available"})]})]})]})]})]})}function CheckoutPage(){var Sr,dr,gr,qr,Lr,_n;const{cart:e,getTotal:i,clearCart:s,applyCoupon:a,removeCoupon:_}=useCart(),{user:$}=useAuth(),{currentFranchise:rt,userLocation:c}=useLocationContext(),dt=useNavigate(),[ht,Et]=reactExports.useState(!1),[St,At]=reactExports.useState({line1:((Sr=$==null?void 0:$.address)==null?void 0:Sr.line1)||"",line2:((dr=$==null?void 0:$.address)==null?void 0:dr.line2)||"",city:((gr=$==null?void 0:$.address)==null?void 0:gr.city)||"",pincode:((qr=$==null?void 0:$.address)==null?void 0:qr.pincode)||"",landmark:((Lr=$==null?void 0:$.address)==null?void 0:Lr.landmark)||"",label:(_n=$==null?void 0:$.address)==null?void 0:_n.label}),[Pt,Vt]=reactExports.useState(null);reactExports.useEffect(()=>{$!=null&&$.address&&($.address.line1||$.address.city)&&(At($.address),$.address.lat&&$.address.lng&&Vt({lat:$.address.lat,lng:$.address.lng}))},[$]);const[Bt,Zt]=reactExports.useState(!0),[zt,Ut]=reactExports.useState(""),[Nt,Gt]=reactExports.useState(!1),[er,ir]=reactExports.useState(""),or=30,mr=5,Rr=i(),un=(()=>{if(!e.appliedCoupon)return 0;if(e.appliedCoupon.code.toUpperCase()==="PA1")return Rr+or+mr-1;if(e.appliedCoupon.discountType==="percentage"){const gn=Rr*e.appliedCoupon.discountValue/100;return e.appliedCoupon.maxDiscount?Math.min(gn,e.appliedCoupon.maxDiscount):gn}else{if(e.appliedCoupon.discountType==="fixed")return Math.min(e.appliedCoupon.discountValue,Rr);if(e.appliedCoupon.discountType==="final_price")return Rr+or+mr-e.appliedCoupon.discountValue}return 0})(),jr=Math.max(1,Rr+or+mr-un),Jr=async()=>{if(!zt.trim()){ir("Please enter a coupon code");return}Gt(!0),ir("");try{if(zt.toUpperCase()==="PA1"){const Sn={id:"pa1-default",code:"PA1",kitchenId:"system",discountType:"final_price",discountValue:1,usedCount:0,isActive:!0,createdAt:Date.now()};a(Sn),ue.success(" Special coupon applied! Final price: 1"),Gt(!1);return}const gn=await getCouponByCode(zt);if(!gn){ir("Invalid coupon code"),Gt(!1);return}if(!gn.isActive){ir("This coupon is no longer active"),Gt(!1);return}if(gn.expiresAt&&gn.expiresAt<Date.now()){ir("This coupon has expired"),Gt(!1);return}if(gn.usageLimit&&gn.usedCount>=gn.usageLimit){ir("This coupon has reached its usage limit"),Gt(!1);return}if(gn.minOrderAmount&&Rr<gn.minOrderAmount){ir(`Minimum order amount is ${gn.minOrderAmount}`),Gt(!1);return}if(gn.kitchenId!==e.kitchenId&&gn.kitchenId!=="system"){ir("This coupon is not valid for this kitchen"),Gt(!1);return}a(gn),ue.success("Coupon applied successfully!")}catch{ir("Failed to apply coupon")}Gt(!1)},fn=()=>{_(),Ut(""),ir("")},Fr=()=>!St.line1&&!St.city?(ue.error("Please select a valid delivery address"),!1):!St.pincode&&!St.city?(ue.error("Address information is incomplete (missing city/pincode)"),!1):!0,Cr=async()=>{if(!$){ue.error("Please login to continue"),dt("/auth");return}if(Fr()){if(e.items.length===0){ue.error("Your cart is empty");return}Et(!0);try{let gn,Sn;try{const{createRazorpayOrder:Fs,fetchRazorpayKey:rs}=await __vitePreload(async()=>{const{createRazorpayOrder:On,fetchRazorpayKey:ws}=await Promise.resolve().then(()=>razorpay);return{createRazorpayOrder:On,fetchRazorpayKey:ws}},void 0);Sn=await rs(),gn=(await Fs(jr,$.email,$.phone)).orderId}catch(Fs){console.warn("Backend order creation failed, falling back to client-side checkout:",Fs)}await initiatePayment(jr,$.name,$.email,$.phone||"",async Fs=>{var rs,ms;try{const On=await createOrder({userId:$.id,kitchenId:e.kitchenId,kitchenName:e.kitchenName,items:e.items,status:"pending",totalAmount:jr,deliveryAddress:St,notes:[...((rs=e.cookingInstructions)==null?void 0:rs.tags)||[],(ms=e.cookingInstructions)==null?void 0:ms.note].filter(Boolean).join(", "),createdAt:Date.now(),updatedAt:Date.now(),estimatedDelivery:"30-45 mins",paymentId:Fs.razorpay_payment_id,razorpayOrderId:Fs.razorpay_order_id});ue.success("Order placed successfully!"),s(),dt("/order-success",{replace:!0})}catch(On){console.error("Order creation failed:",On),ue.error("Failed to create order. Please contact support.")}Et(!1)},()=>{Et(!1)},gn,Sn)}catch(gn){console.error("Payment initiation failed:",gn),ue.error("Payment failed. Please try again."),Et(!1)}}};return e.items.length===0?jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background flex flex-col items-center justify-center px-4",children:[jsxRuntimeExports.jsx("p",{className:"text-muted-foreground mb-4",children:"Your cart is empty"}),jsxRuntimeExports.jsx(Link,{to:"/",children:jsxRuntimeExports.jsx(Button,{className:"gradient-primary text-primary-foreground",children:"Explore Kitchens"})})]}):jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-32",children:[jsxRuntimeExports.jsx("header",{className:"sticky top-0 z-40 bg-card/95 backdrop-blur-lg border-b border-border",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-4 px-4 py-4",children:[jsxRuntimeExports.jsx(Link,{to:"/cart",children:jsxRuntimeExports.jsx(motion.div,{whileTap:{scale:.9},className:"w-10 h-10 rounded-full bg-secondary flex items-center justify-center",children:jsxRuntimeExports.jsx(ArrowLeft,{className:"w-5 h-5"})})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h1",{className:"font-semibold text-foreground",children:"Checkout"}),jsxRuntimeExports.jsxs("p",{className:"text-sm text-muted-foreground",children:[e.items.length," items from ",e.kitchenName]})]})]})}),jsxRuntimeExports.jsx("div",{className:"px-4 py-4",children:jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-2xl p-4 shadow-card",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx(MapPin,{className:"w-5 h-5 text-primary"}),jsxRuntimeExports.jsx("h3",{className:"font-semibold text-foreground",children:"Delivery Location"})]}),jsxRuntimeExports.jsx("div",{className:"flex items-center gap-2",children:St.city&&jsxRuntimeExports.jsx(Button,{variant:"link",size:"sm",onClick:()=>dt("/addresses"),className:"text-primary h-auto p-0 font-semibold",children:"Change"})})]}),St.city?jsxRuntimeExports.jsxs("div",{className:"bg-secondary/30 rounded-xl p-4 border border-border",children:[jsxRuntimeExports.jsx("div",{className:"pt-1",children:jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h4",{className:"font-medium text-foreground mb-1 capitalize",children:St.label||"Home"}),jsxRuntimeExports.jsxs("p",{className:"text-sm text-muted-foreground",children:[St.line1?jsxRuntimeExports.jsx("span",{className:"block break-words leading-tight",children:(()=>{const gn=St.line1.split(",").map(Sn=>Sn.trim());return gn.length>=5?gn.slice(2).join(", "):St.line1})()}):jsxRuntimeExports.jsxs("span",{className:"block break-words",children:[St.pincode?`${St.pincode}, `:"",St.city]}),St.line2&&jsxRuntimeExports.jsx("span",{className:"block break-words text-xs mt-1",children:St.line2}),(!St.line1||St.city&&!St.line1.toLowerCase().includes(St.city.toLowerCase()))&&St.city&&jsxRuntimeExports.jsxs("span",{className:"block text-xs mt-0.5",children:[St.city,St.pincode?`, ${St.pincode}`:""]})]})]})}),rt&&Bt&&jsxRuntimeExports.jsxs("div",{className:"mt-3",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 text-xs text-green-600 font-medium",children:[jsxRuntimeExports.jsx(Check,{className:"w-3 h-3"}),"Deliverable address"]}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-muted-foreground mt-1 ml-5",children:[rt.name," Zone"]})]}),rt&&!Bt&&jsxRuntimeExports.jsxs("div",{className:"mt-3 flex items-center gap-2 text-xs text-destructive font-medium",children:[jsxRuntimeExports.jsx(X,{className:"w-3 h-3"}),"Address outside delivery zone"]})]}):jsxRuntimeExports.jsxs("div",{className:"text-center py-6 bg-secondary/30 rounded-xl border border-dashed border-border",children:[jsxRuntimeExports.jsx("p",{className:"text-muted-foreground mb-4",children:"No delivery address found"}),jsxRuntimeExports.jsx(Button,{onClick:()=>dt("/addresses"),className:"gradient-primary text-primary-foreground",children:"Add Address"})]})]})}),jsxRuntimeExports.jsx("div",{className:"px-4 mt-4",children:jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-2xl p-4 shadow-card",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[jsxRuntimeExports.jsx(Tag,{className:"w-5 h-5 text-primary"}),jsxRuntimeExports.jsx("h3",{className:"font-semibold text-foreground",children:"Apply Discount Coupon"})]}),e.appliedCoupon?jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between bg-veg/10 rounded-xl p-3",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx(Check,{className:"w-5 h-5 text-veg"}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"font-semibold text-foreground",children:e.appliedCoupon.code}),jsxRuntimeExports.jsx("p",{className:"text-xs text-veg",children:e.appliedCoupon.code.toUpperCase()==="PA1"?"Special offer: Final price 1!":`Saving ${un}`})]})]}),jsxRuntimeExports.jsx(Button,{variant:"ghost",size:"sm",onClick:fn,className:"text-destructive",children:jsxRuntimeExports.jsx(X,{className:"w-4 h-4"})})]}):jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsx(Input,{placeholder:"Enter coupon code ",value:zt,onChange:gn=>{Ut(gn.target.value.toUpperCase()),ir("")},className:"bg-secondary border-0 uppercase"}),jsxRuntimeExports.jsx(Button,{onClick:Jr,disabled:Nt,className:"gradient-primary text-primary-foreground",children:Nt?jsxRuntimeExports.jsx(LoaderCircle,{className:"w-4 h-4 animate-spin"}):"Apply"})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center pt-2",children:[jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Have a promo code?"}),jsxRuntimeExports.jsx(Button,{variant:"link",size:"sm",onClick:()=>dt("/coupons"),className:"text-primary font-semibold text-xs h-auto p-0",children:"View Available Coupons"})]}),er&&jsxRuntimeExports.jsx("p",{className:"text-xs text-destructive",children:er})]})]})}),jsxRuntimeExports.jsx("div",{className:"px-4 mt-4",children:jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-2xl p-4 shadow-card",children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-foreground mb-4",children:"Order Summary"}),e.items.map(gn=>jsxRuntimeExports.jsxs("div",{className:"flex justify-between text-sm py-2 border-b border-border",children:[jsxRuntimeExports.jsxs("span",{className:"text-muted-foreground",children:[gn.dish.name," x ",gn.quantity]}),jsxRuntimeExports.jsxs("span",{className:"text-foreground",children:["",gn.dish.price*gn.quantity]})]},gn.dish.id)),jsxRuntimeExports.jsxs("div",{className:"space-y-2 text-sm mt-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-muted-foreground",children:"Item Total"}),jsxRuntimeExports.jsxs("span",{className:"text-foreground",children:["",Rr]})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-muted-foreground",children:"Delivery Fee"}),jsxRuntimeExports.jsxs("span",{className:"text-foreground",children:["",or]})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-muted-foreground",children:"Platform Fee"}),jsxRuntimeExports.jsxs("span",{className:"text-foreground",children:["",mr]})]}),e.appliedCoupon&&un>0&&jsxRuntimeExports.jsxs("div",{className:"flex justify-between text-veg",children:[jsxRuntimeExports.jsxs("span",{children:["Discount (",e.appliedCoupon.code,")"]}),jsxRuntimeExports.jsxs("span",{children:["-",un]})]}),jsxRuntimeExports.jsx("div",{className:"border-t border-border pt-2 mt-2",children:jsxRuntimeExports.jsxs("div",{className:"flex justify-between font-semibold text-base",children:[jsxRuntimeExports.jsx("span",{className:"text-foreground",children:"Total"}),jsxRuntimeExports.jsxs("span",{className:"text-foreground",children:["",jr]})]})})]})]})}),jsxRuntimeExports.jsx(motion.div,{initial:{y:100},animate:{y:0},className:"fixed bottom-0 left-0 right-0 p-4 bg-card/95 backdrop-blur-lg border-t border-border safe-bottom",children:jsxRuntimeExports.jsx(Button,{onClick:Cr,disabled:ht||!Bt,className:`w-full py-6 rounded-xl shadow-elevated ${Bt?"gradient-primary text-primary-foreground":"bg-muted text-muted-foreground cursor-not-allowed"}`,children:ht?jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx(LoaderCircle,{className:"w-5 h-5 animate-spin"}),jsxRuntimeExports.jsx("span",{children:"Processing..."})]}):Bt?jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between w-full",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx(CreditCard,{className:"w-5 h-5"}),jsxRuntimeExports.jsx("span",{className:"font-semibold",children:"Pay Now"})]}),jsxRuntimeExports.jsxs("span",{className:"font-bold",children:["",jr]})]}):jsxRuntimeExports.jsx("div",{className:"flex items-center gap-2",children:jsxRuntimeExports.jsx("span",{className:"font-semibold",children:"Delivery Not Available"})})})})]})}var NAME="Label",Label$2=reactExports.forwardRef((e,i)=>jsxRuntimeExports.jsx(Primitive.label,{...e,ref:i,onMouseDown:s=>{var _;s.target.closest("button, input, select, textarea")||((_=e.onMouseDown)==null||_.call(e,s),!s.defaultPrevented&&s.detail>1&&s.preventDefault())}}));Label$2.displayName=NAME;var Root$3=Label$2;const labelVariants=cva("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),Label$1=reactExports.forwardRef(({className:e,...i},s)=>jsxRuntimeExports.jsx(Root$3,{ref:s,className:cn(labelVariants(),e),...i}));Label$1.displayName=Root$3.displayName;function getDashboardRoute(e){switch(e){case"super_admin":return"/super-admin";case"franchise_admin":return"/franchise-admin";case"amma":return"/amma/dashboard";case"admin":return"/admin";default:return"/"}}function AuthPage(){const[e,i]=reactExports.useState("login"),[s,a]=reactExports.useState("user"),[_,$]=reactExports.useState(!1),[rt,c]=reactExports.useState(!1),[dt,ht]=reactExports.useState(!0),[Et,St]=reactExports.useState({email:"",password:"",name:"",phone:""}),{signIn:At,signUp:Pt,updateUserLocation:Vt,user:Bt,loading:Zt}=useAuth(),zt=useNavigate();if(reactExports.useEffect(()=>{if(!Zt&&Bt){const Gt=getDashboardRoute(Bt.role);zt(Gt,{replace:!0})}else Zt||ht(!1)},[Bt,Zt,zt]),dt||Zt)return jsxRuntimeExports.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:jsxRuntimeExports.jsx(LoaderCircle,{className:"w-8 h-8 animate-spin text-primary"})});const Ut=async()=>{if(!navigator.geolocation){console.log("Geolocation not supported");return}try{const Gt=await new Promise((or,mr)=>{navigator.geolocation.getCurrentPosition(or,mr,{enableHighAccuracy:!0,timeout:1e4,maximumAge:0})}),{latitude:er,longitude:ir}=Gt.coords;await Vt(er,ir),ue.success("Location saved!",{icon:jsxRuntimeExports.jsx(MapPin,{className:"w-4 h-4"}),duration:2e3})}catch(Gt){console.log("Could not get location:",Gt)}},Nt=async Gt=>{Gt.preventDefault(),c(!0);try{if(e==="login"){let er=Et.email;Et.email==="admin"&&(er="admin@admin.com"),await At(er,Et.password),ue.success("Welcome back!");const ir=auth.currentUser;if(ir){const or=ref(database,`users/${ir.uid}`),mr=await get(or);if(mr.exists()){const Rr=mr.val();if(Rr.role==="super_admin"){zt("/super-admin");return}else if(Rr.role==="franchise_admin"){zt("/franchise-admin");return}else if(Rr.role==="amma"){zt("/amma/dashboard");return}else if(Rr.role==="admin"){zt("/admin");return}}}zt("/")}else await Pt(Et.email,Et.password,Et.name,Et.phone,s),ue.success("Account created successfully!"),Ut(),s==="amma"?(ue.info("Now register your kitchen to start selling!"),zt("/amma/register")):zt("/")}catch(er){console.error("Auth error:",er);let ir="Authentication failed";er.code==="auth/email-already-in-use"?ir="Email already registered. Please login instead.":er.code==="auth/weak-password"?ir="Password should be at least 6 characters":er.code==="auth/invalid-email"?ir="Invalid email address":(er.code==="auth/user-not-found"||er.code==="auth/wrong-password"||er.code==="auth/invalid-credential")&&(ir="Invalid email or password"),ue.error(ir)}finally{c(!1)}};return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[jsxRuntimeExports.jsx("div",{className:"gradient-hero px-6 pt-12 pb-8 text-primary-foreground",children:jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"text-center",children:[jsxRuntimeExports.jsx("div",{className:"w-24 h-24 rounded-full overflow-hidden mx-auto mb-4 border-4 border-white/20 shadow-xl",children:jsxRuntimeExports.jsx("img",{src:"https://storage.googleapis.com/gpt-engineer-file-uploads/wphPPaB8JpV2QMB0AuasxRAm9dk1/uploads/1767719189515-Screenshot%202026-01-06%20223348.png",alt:"Amma Cheythi Vanta Logo",className:"w-full h-full object-cover"})}),jsxRuntimeExports.jsx("h1",{className:"text-2xl font-bold mb-2",children:"Amma Cheythi Vanta"}),jsxRuntimeExports.jsx("p",{className:"text-primary-foreground/80 text-sm",children:e==="login"?"Welcome back!":"Join our family of home cooks"})]})}),jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"flex-1 -mt-6 bg-card rounded-t-3xl px-6 pt-8",children:[jsxRuntimeExports.jsx("div",{className:"flex bg-secondary rounded-xl p-1 mb-6",children:["login","signup"].map(Gt=>jsxRuntimeExports.jsx("button",{onClick:()=>i(Gt),className:`flex-1 py-2.5 rounded-lg text-sm font-medium transition-all ${e===Gt?"bg-card text-foreground shadow-soft":"text-muted-foreground"}`,children:Gt==="login"?"Login":"Sign Up"},Gt))}),e==="signup"&&jsxRuntimeExports.jsxs("div",{className:"mb-6",children:[jsxRuntimeExports.jsx(Label$1,{className:"text-sm font-medium text-foreground mb-3 block",children:"I am a..."}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[jsxRuntimeExports.jsxs(motion.button,{whileTap:{scale:.98},onClick:()=>a("user"),className:`p-4 rounded-xl border-2 text-left transition-all ${s==="user"?"border-primary bg-primary/5":"border-border"}`,children:[jsxRuntimeExports.jsx("span",{className:"text-2xl mb-2 block",children:""}),jsxRuntimeExports.jsx("span",{className:"font-medium text-foreground block",children:"Food Lover"}),jsxRuntimeExports.jsx("span",{className:"text-xs text-muted-foreground",children:"I want to order"})]}),jsxRuntimeExports.jsxs(motion.button,{whileTap:{scale:.98},onClick:()=>a("amma"),className:`p-4 rounded-xl border-2 text-left transition-all ${s==="amma"?"border-primary bg-primary/5":"border-border"}`,children:[jsxRuntimeExports.jsx("span",{className:"text-2xl mb-2 block",children:""}),jsxRuntimeExports.jsx("span",{className:"font-medium text-foreground block",children:"Home Cook"}),jsxRuntimeExports.jsx("span",{className:"text-xs text-muted-foreground",children:"I want to sell"})]})]})]}),jsxRuntimeExports.jsxs("form",{onSubmit:Nt,className:"space-y-4",children:[e==="signup"&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Label$1,{htmlFor:"name",className:"text-sm font-medium text-foreground",children:"Full Name"}),jsxRuntimeExports.jsx(Input,{id:"name",type:"text",placeholder:"Enter your name",value:Et.name,onChange:Gt=>St(er=>({...er,name:Gt.target.value})),className:"mt-1.5 bg-secondary border-0 py-6",required:!0})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Label$1,{htmlFor:"phone",className:"text-sm font-medium text-foreground",children:"Phone Number"}),jsxRuntimeExports.jsx(Input,{id:"phone",type:"tel",placeholder:"Enter phone number",value:Et.phone,onChange:Gt=>St(er=>({...er,phone:Gt.target.value})),className:"mt-1.5 bg-secondary border-0 py-6",required:!0})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Label$1,{htmlFor:"email",className:"text-sm font-medium text-foreground",children:"Email"}),jsxRuntimeExports.jsx(Input,{id:"email",type:"email",placeholder:"Enter your email",value:Et.email,onChange:Gt=>St(er=>({...er,email:Gt.target.value})),className:"mt-1.5 bg-secondary border-0 py-6",required:!0})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Label$1,{htmlFor:"password",className:"text-sm font-medium text-foreground",children:"Password"}),jsxRuntimeExports.jsxs("div",{className:"relative mt-1.5",children:[jsxRuntimeExports.jsx(Input,{id:"password",type:_?"text":"password",placeholder:"Enter password",value:Et.password,onChange:Gt=>St(er=>({...er,password:Gt.target.value})),className:"bg-secondary border-0 py-6 pr-12",required:!0}),jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>$(!_),className:"absolute right-4 top-1/2 -translate-y-1/2 text-muted-foreground",children:_?jsxRuntimeExports.jsx(EyeOff,{className:"w-5 h-5"}):jsxRuntimeExports.jsx(Eye,{className:"w-5 h-5"})})]})]}),jsxRuntimeExports.jsx(Button,{type:"submit",disabled:rt,className:"w-full gradient-primary text-primary-foreground py-6 rounded-xl mt-6",children:rt?jsxRuntimeExports.jsx(motion.div,{animate:{rotate:360},transition:{repeat:1/0,duration:1},className:"w-5 h-5 border-2 border-primary-foreground border-t-transparent rounded-full"}):jsxRuntimeExports.jsxs("span",{className:"flex items-center gap-2",children:[e==="login"?"Login":"Create Account",jsxRuntimeExports.jsx(ArrowRight,{className:"w-5 h-5"})]})})]}),jsxRuntimeExports.jsx("div",{className:"text-center mt-6",children:jsxRuntimeExports.jsx(Link,{to:"/",className:"text-sm text-muted-foreground",children:"Skip for now"})})]})]})}async function clearAllDataExceptSuperAdmin(){try{const e={},i=ref(database,"users"),s=await get(i);if(s.exists()){const a=s.val();Object.keys(a).forEach(_=>{a[_].role!=="super_admin"&&(e[`users/${_}`]=null)})}return e.franchises=null,e.kitchens=null,e.dishes=null,e.orders=null,e.coupons=null,e.reviews=null,await update(ref(database),e),console.log("Database cleared successfully! (Super Admin preserved)"),!0}catch(e){return console.error("Error clearing database:",e),!1}}function ProfilePage(){const{user:e,signOut:i}=useAuth(),s=useNavigate();reactExports.useState(!1);const a=async()=>{await i(),s("/")},_=[{icon:ShoppingBag,label:"My Orders",path:"/orders",color:"text-primary"},{icon:Heart,label:"Favorite Kitchens",path:"/favorites",color:"text-destructive"},{icon:MapPin,label:"Saved Addresses",path:"/addresses",color:"text-accent"},{icon:Settings,label:"Settings",path:"/settings",color:"text-muted-foreground"},{icon:CircleHelp,label:"Help & Support",path:"/help",color:"text-gold"},...(e==null?void 0:e.role)==="super_admin"||(e==null?void 0:e.role)==="admin"?[{icon:ShieldCheck,label:"Super Admin Panel",path:"/super-admin",color:"text-primary"}]:[]];return e?jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-24",children:[jsxRuntimeExports.jsx("div",{className:"gradient-hero px-6 pt-12 pb-16 text-primary-foreground",children:jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"flex items-center gap-4",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 rounded-full bg-primary-foreground/20 flex items-center justify-center",children:e.avatar?jsxRuntimeExports.jsx("img",{src:e.avatar,alt:e.name,className:"w-full h-full rounded-full object-cover"}):jsxRuntimeExports.jsx(User,{className:"w-8 h-8"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h1",{className:"text-xl font-bold",children:e.name}),jsxRuntimeExports.jsx("p",{className:"text-primary-foreground/80 text-sm",children:e.email}),jsxRuntimeExports.jsx("p",{className:"text-primary-foreground/60 text-xs mt-0.5",children:e.role==="amma"?" Home Cook":" Food Lover"})]})]})}),jsxRuntimeExports.jsx("div",{className:"px-4 -mt-6",children:jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-card rounded-2xl shadow-elevated overflow-hidden",children:[e.role==="amma"&&jsxRuntimeExports.jsx(Link,{to:"/amma/dashboard",children:jsxRuntimeExports.jsxs(motion.div,{whileTap:{scale:.98},className:"flex items-center gap-4 p-4 border-b border-border bg-gold-soft",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-xl bg-gold/20 flex items-center justify-center text-gold",children:jsxRuntimeExports.jsx(ChefHat,{className:"w-5 h-5"})}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsx("span",{className:"font-medium text-foreground block",children:"My Kitchen Dashboard"}),jsxRuntimeExports.jsx("span",{className:"text-xs text-muted-foreground",children:"Manage orders & menu"})]}),jsxRuntimeExports.jsx(ChevronRight,{className:"w-5 h-5 text-muted-foreground"})]})}),_.map($=>jsxRuntimeExports.jsx(Link,{to:$.path,children:jsxRuntimeExports.jsxs(motion.div,{whileTap:{scale:.98},className:"flex items-center gap-4 p-4 border-b border-border last:border-0",children:[jsxRuntimeExports.jsx("div",{className:`w-10 h-10 rounded-xl bg-secondary flex items-center justify-center ${$.color}`,children:jsxRuntimeExports.jsx($.icon,{className:"w-5 h-5"})}),jsxRuntimeExports.jsx("span",{className:"flex-1 font-medium text-foreground",children:$.label}),jsxRuntimeExports.jsx(ChevronRight,{className:"w-5 h-5 text-muted-foreground"})]})},$.path)),jsxRuntimeExports.jsxs(motion.button,{whileTap:{scale:.98},onClick:a,className:"w-full flex items-center gap-4 p-4 text-destructive",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-xl bg-destructive/10 flex items-center justify-center",children:jsxRuntimeExports.jsx(LogOut,{className:"w-5 h-5"})}),jsxRuntimeExports.jsx("span",{className:"flex-1 font-medium text-left",children:"Logout"})]})]})}),jsxRuntimeExports.jsx(BottomNav,{})]}):jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-24",children:[jsxRuntimeExports.jsx("div",{className:"gradient-hero px-6 pt-12 pb-16 text-primary-foreground",children:jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"text-center",children:[jsxRuntimeExports.jsx("div",{className:"w-20 h-20 rounded-full bg-primary-foreground/20 flex items-center justify-center mx-auto mb-4",children:jsxRuntimeExports.jsx(User,{className:"w-10 h-10"})}),jsxRuntimeExports.jsx("h1",{className:"text-xl font-bold mb-2",children:"Welcome, Guest!"}),jsxRuntimeExports.jsx("p",{className:"text-primary-foreground/80 text-sm mb-4",children:"Login to order delicious homemade food"}),jsxRuntimeExports.jsx(Link,{to:"/auth",children:jsxRuntimeExports.jsx(Button,{className:"bg-primary-foreground text-primary px-8 py-5 rounded-xl font-semibold",children:"Login / Sign Up"})})]})}),jsxRuntimeExports.jsx("div",{className:"px-4 -mt-6",children:jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-card rounded-2xl shadow-elevated overflow-hidden",children:_.slice(3).map(($,rt)=>jsxRuntimeExports.jsx(Link,{to:$.path,children:jsxRuntimeExports.jsxs(motion.div,{whileTap:{scale:.98},className:"flex items-center gap-4 p-4 border-b border-border last:border-0",children:[jsxRuntimeExports.jsx("div",{className:`w-10 h-10 rounded-xl bg-secondary flex items-center justify-center ${$.color}`,children:jsxRuntimeExports.jsx($.icon,{className:"w-5 h-5"})}),jsxRuntimeExports.jsx("span",{className:"flex-1 font-medium text-foreground",children:$.label}),jsxRuntimeExports.jsx(ChevronRight,{className:"w-5 h-5 text-muted-foreground"})]})},$.path))})}),jsxRuntimeExports.jsx(BottomNav,{})]})}function usePrevious(e){const i=reactExports.useRef({value:e,previous:e});return reactExports.useMemo(()=>(i.current.value!==e&&(i.current.previous=i.current.value,i.current.value=e),i.current.previous),[e])}var SWITCH_NAME="Switch",[createSwitchContext,createSwitchScope]=createContextScope(SWITCH_NAME),[SwitchProvider,useSwitchContext]=createSwitchContext(SWITCH_NAME),Switch$1=reactExports.forwardRef((e,i)=>{const{__scopeSwitch:s,name:a,checked:_,defaultChecked:$,required:rt,disabled:c,value:dt="on",onCheckedChange:ht,form:Et,...St}=e,[At,Pt]=reactExports.useState(null),Vt=useComposedRefs$1(i,Nt=>Pt(Nt)),Bt=reactExports.useRef(!1),Zt=At?Et||!!At.closest("form"):!0,[zt,Ut]=useControllableState({prop:_,defaultProp:$??!1,onChange:ht,caller:SWITCH_NAME});return jsxRuntimeExports.jsxs(SwitchProvider,{scope:s,checked:zt,disabled:c,children:[jsxRuntimeExports.jsx(Primitive.button,{type:"button",role:"switch","aria-checked":zt,"aria-required":rt,"data-state":getState$3(zt),"data-disabled":c?"":void 0,disabled:c,value:dt,...St,ref:Vt,onClick:composeEventHandlers(e.onClick,Nt=>{Ut(Gt=>!Gt),Zt&&(Bt.current=Nt.isPropagationStopped(),Bt.current||Nt.stopPropagation())})}),Zt&&jsxRuntimeExports.jsx(SwitchBubbleInput,{control:At,bubbles:!Bt.current,name:a,value:dt,checked:zt,required:rt,disabled:c,form:Et,style:{transform:"translateX(-100%)"}})]})});Switch$1.displayName=SWITCH_NAME;var THUMB_NAME="SwitchThumb",SwitchThumb=reactExports.forwardRef((e,i)=>{const{__scopeSwitch:s,...a}=e,_=useSwitchContext(THUMB_NAME,s);return jsxRuntimeExports.jsx(Primitive.span,{"data-state":getState$3(_.checked),"data-disabled":_.disabled?"":void 0,...a,ref:i})});SwitchThumb.displayName=THUMB_NAME;var BUBBLE_INPUT_NAME$1="SwitchBubbleInput",SwitchBubbleInput=reactExports.forwardRef(({__scopeSwitch:e,control:i,checked:s,bubbles:a=!0,..._},$)=>{const rt=reactExports.useRef(null),c=useComposedRefs$1(rt,$),dt=usePrevious(s),ht=useSize(i);return reactExports.useEffect(()=>{const Et=rt.current;if(!Et)return;const St=window.HTMLInputElement.prototype,Pt=Object.getOwnPropertyDescriptor(St,"checked").set;if(dt!==s&&Pt){const Vt=new Event("click",{bubbles:a});Pt.call(Et,s),Et.dispatchEvent(Vt)}},[dt,s,a]),jsxRuntimeExports.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:s,..._,tabIndex:-1,ref:c,style:{..._.style,...ht,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});SwitchBubbleInput.displayName=BUBBLE_INPUT_NAME$1;function getState$3(e){return e?"checked":"unchecked"}var Root$2=Switch$1,Thumb=SwitchThumb;const Switch=reactExports.forwardRef(({className:e,...i},s)=>jsxRuntimeExports.jsx(Root$2,{className:cn("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50",e),...i,ref:s,children:jsxRuntimeExports.jsx(Thumb,{className:cn("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));Switch.displayName=Root$2.displayName;var AUTOFOCUS_ON_MOUNT="focusScope.autoFocusOnMount",AUTOFOCUS_ON_UNMOUNT="focusScope.autoFocusOnUnmount",EVENT_OPTIONS={bubbles:!1,cancelable:!0},FOCUS_SCOPE_NAME="FocusScope",FocusScope=reactExports.forwardRef((e,i)=>{const{loop:s=!1,trapped:a=!1,onMountAutoFocus:_,onUnmountAutoFocus:$,...rt}=e,[c,dt]=reactExports.useState(null),ht=useCallbackRef$1(_),Et=useCallbackRef$1($),St=reactExports.useRef(null),At=useComposedRefs$1(i,Bt=>dt(Bt)),Pt=reactExports.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;reactExports.useEffect(()=>{if(a){let Bt=function(Nt){if(Pt.paused||!c)return;const Gt=Nt.target;c.contains(Gt)?St.current=Gt:focus(St.current,{select:!0})},Zt=function(Nt){if(Pt.paused||!c)return;const Gt=Nt.relatedTarget;Gt!==null&&(c.contains(Gt)||focus(St.current,{select:!0}))},zt=function(Nt){if(document.activeElement===document.body)for(const er of Nt)er.removedNodes.length>0&&focus(c)};document.addEventListener("focusin",Bt),document.addEventListener("focusout",Zt);const Ut=new MutationObserver(zt);return c&&Ut.observe(c,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",Bt),document.removeEventListener("focusout",Zt),Ut.disconnect()}}},[a,c,Pt.paused]),reactExports.useEffect(()=>{if(c){focusScopesStack.add(Pt);const Bt=document.activeElement;if(!c.contains(Bt)){const zt=new CustomEvent(AUTOFOCUS_ON_MOUNT,EVENT_OPTIONS);c.addEventListener(AUTOFOCUS_ON_MOUNT,ht),c.dispatchEvent(zt),zt.defaultPrevented||(focusFirst(removeLinks(getTabbableCandidates(c)),{select:!0}),document.activeElement===Bt&&focus(c))}return()=>{c.removeEventListener(AUTOFOCUS_ON_MOUNT,ht),setTimeout(()=>{const zt=new CustomEvent(AUTOFOCUS_ON_UNMOUNT,EVENT_OPTIONS);c.addEventListener(AUTOFOCUS_ON_UNMOUNT,Et),c.dispatchEvent(zt),zt.defaultPrevented||focus(Bt??document.body,{select:!0}),c.removeEventListener(AUTOFOCUS_ON_UNMOUNT,Et),focusScopesStack.remove(Pt)},0)}}},[c,ht,Et,Pt]);const Vt=reactExports.useCallback(Bt=>{if(!s&&!a||Pt.paused)return;const Zt=Bt.key==="Tab"&&!Bt.altKey&&!Bt.ctrlKey&&!Bt.metaKey,zt=document.activeElement;if(Zt&&zt){const Ut=Bt.currentTarget,[Nt,Gt]=getTabbableEdges(Ut);Nt&&Gt?!Bt.shiftKey&&zt===Gt?(Bt.preventDefault(),s&&focus(Nt,{select:!0})):Bt.shiftKey&&zt===Nt&&(Bt.preventDefault(),s&&focus(Gt,{select:!0})):zt===Ut&&Bt.preventDefault()}},[s,a,Pt.paused]);return jsxRuntimeExports.jsx(Primitive.div,{tabIndex:-1,...rt,ref:At,onKeyDown:Vt})});FocusScope.displayName=FOCUS_SCOPE_NAME;function focusFirst(e,{select:i=!1}={}){const s=document.activeElement;for(const a of e)if(focus(a,{select:i}),document.activeElement!==s)return}function getTabbableEdges(e){const i=getTabbableCandidates(e),s=findVisible(i,e),a=findVisible(i.reverse(),e);return[s,a]}function getTabbableCandidates(e){const i=[],s=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:a=>{const _=a.tagName==="INPUT"&&a.type==="hidden";return a.disabled||a.hidden||_?NodeFilter.FILTER_SKIP:a.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;s.nextNode();)i.push(s.currentNode);return i}function findVisible(e,i){for(const s of e)if(!isHidden(s,{upTo:i}))return s}function isHidden(e,{upTo:i}){if(getComputedStyle(e).visibility==="hidden")return!0;for(;e;){if(i!==void 0&&e===i)return!1;if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1}function isSelectableInput(e){return e instanceof HTMLInputElement&&"select"in e}function focus(e,{select:i=!1}={}){if(e&&e.focus){const s=document.activeElement;e.focus({preventScroll:!0}),e!==s&&isSelectableInput(e)&&i&&e.select()}}var focusScopesStack=createFocusScopesStack();function createFocusScopesStack(){let e=[];return{add(i){const s=e[0];i!==s&&(s==null||s.pause()),e=arrayRemove(e,i),e.unshift(i)},remove(i){var s;e=arrayRemove(e,i),(s=e[0])==null||s.resume()}}}function arrayRemove(e,i){const s=[...e],a=s.indexOf(i);return a!==-1&&s.splice(a,1),s}function removeLinks(e){return e.filter(i=>i.tagName!=="A")}var count=0;function useFocusGuards(){reactExports.useEffect(()=>{const e=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",e[0]??createFocusGuard()),document.body.insertAdjacentElement("beforeend",e[1]??createFocusGuard()),count++,()=>{count===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(i=>i.remove()),count--}},[])}function createFocusGuard(){const e=document.createElement("span");return e.setAttribute("data-radix-focus-guard",""),e.tabIndex=0,e.style.outline="none",e.style.opacity="0",e.style.position="fixed",e.style.pointerEvents="none",e}var __assign=function(){return __assign=Object.assign||function(i){for(var s,a=1,_=arguments.length;a<_;a++){s=arguments[a];for(var $ in s)Object.prototype.hasOwnProperty.call(s,$)&&(i[$]=s[$])}return i},__assign.apply(this,arguments)};function __rest(e,i){var s={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&i.indexOf(a)<0&&(s[a]=e[a]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var _=0,a=Object.getOwnPropertySymbols(e);_<a.length;_++)i.indexOf(a[_])<0&&Object.prototype.propertyIsEnumerable.call(e,a[_])&&(s[a[_]]=e[a[_]]);return s}function __spreadArray(e,i,s){if(s||arguments.length===2)for(var a=0,_=i.length,$;a<_;a++)($||!(a in i))&&($||($=Array.prototype.slice.call(i,0,a)),$[a]=i[a]);return e.concat($||Array.prototype.slice.call(i))}typeof SuppressedError=="function"&&SuppressedError;var zeroRightClassName="right-scroll-bar-position",fullWidthClassName="width-before-scroll-bar",noScrollbarsClassName="with-scroll-bars-hidden",removedBarSizeVariable="--removed-body-scroll-bar-size";function assignRef(e,i){return typeof e=="function"?e(i):e&&(e.current=i),e}function useCallbackRef(e,i){var s=reactExports.useState(function(){return{value:e,callback:i,facade:{get current(){return s.value},set current(a){var _=s.value;_!==a&&(s.value=a,s.callback(a,_))}}}})[0];return s.callback=i,s.facade}var useIsomorphicLayoutEffect=typeof window<"u"?reactExports.useLayoutEffect:reactExports.useEffect,currentValues=new WeakMap;function useMergeRefs(e,i){var s=useCallbackRef(null,function(a){return e.forEach(function(_){return assignRef(_,a)})});return useIsomorphicLayoutEffect(function(){var a=currentValues.get(s);if(a){var _=new Set(a),$=new Set(e),rt=s.current;_.forEach(function(c){$.has(c)||assignRef(c,null)}),$.forEach(function(c){_.has(c)||assignRef(c,rt)})}currentValues.set(s,e)},[e]),s}function ItoI(e){return e}function innerCreateMedium(e,i){i===void 0&&(i=ItoI);var s=[],a=!1,_={read:function(){if(a)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return s.length?s[s.length-1]:e},useMedium:function($){var rt=i($,a);return s.push(rt),function(){s=s.filter(function(c){return c!==rt})}},assignSyncMedium:function($){for(a=!0;s.length;){var rt=s;s=[],rt.forEach($)}s={push:function(c){return $(c)},filter:function(){return s}}},assignMedium:function($){a=!0;var rt=[];if(s.length){var c=s;s=[],c.forEach($),rt=s}var dt=function(){var Et=rt;rt=[],Et.forEach($)},ht=function(){return Promise.resolve().then(dt)};ht(),s={push:function(Et){rt.push(Et),ht()},filter:function(Et){return rt=rt.filter(Et),s}}}};return _}function createSidecarMedium(e){e===void 0&&(e={});var i=innerCreateMedium(null);return i.options=__assign({async:!0,ssr:!1},e),i}var SideCar$1=function(e){var i=e.sideCar,s=__rest(e,["sideCar"]);if(!i)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var a=i.read();if(!a)throw new Error("Sidecar medium not found");return reactExports.createElement(a,__assign({},s))};SideCar$1.isSideCarExport=!0;function exportSidecar(e,i){return e.useMedium(i),SideCar$1}var effectCar=createSidecarMedium(),nothing=function(){},RemoveScroll=reactExports.forwardRef(function(e,i){var s=reactExports.useRef(null),a=reactExports.useState({onScrollCapture:nothing,onWheelCapture:nothing,onTouchMoveCapture:nothing}),_=a[0],$=a[1],rt=e.forwardProps,c=e.children,dt=e.className,ht=e.removeScrollBar,Et=e.enabled,St=e.shards,At=e.sideCar,Pt=e.noRelative,Vt=e.noIsolation,Bt=e.inert,Zt=e.allowPinchZoom,zt=e.as,Ut=zt===void 0?"div":zt,Nt=e.gapMode,Gt=__rest(e,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),er=At,ir=useMergeRefs([s,i]),or=__assign(__assign({},Gt),_);return reactExports.createElement(reactExports.Fragment,null,Et&&reactExports.createElement(er,{sideCar:effectCar,removeScrollBar:ht,shards:St,noRelative:Pt,noIsolation:Vt,inert:Bt,setCallbacks:$,allowPinchZoom:!!Zt,lockRef:s,gapMode:Nt}),rt?reactExports.cloneElement(reactExports.Children.only(c),__assign(__assign({},or),{ref:ir})):reactExports.createElement(Ut,__assign({},or,{className:dt,ref:ir}),c))});RemoveScroll.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};RemoveScroll.classNames={fullWidth:fullWidthClassName,zeroRight:zeroRightClassName};var getNonce=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function makeStyleTag(){if(!document)return null;var e=document.createElement("style");e.type="text/css";var i=getNonce();return i&&e.setAttribute("nonce",i),e}function injectStyles(e,i){e.styleSheet?e.styleSheet.cssText=i:e.appendChild(document.createTextNode(i))}function insertStyleTag(e){var i=document.head||document.getElementsByTagName("head")[0];i.appendChild(e)}var stylesheetSingleton=function(){var e=0,i=null;return{add:function(s){e==0&&(i=makeStyleTag())&&(injectStyles(i,s),insertStyleTag(i)),e++},remove:function(){e--,!e&&i&&(i.parentNode&&i.parentNode.removeChild(i),i=null)}}},styleHookSingleton=function(){var e=stylesheetSingleton();return function(i,s){reactExports.useEffect(function(){return e.add(i),function(){e.remove()}},[i&&s])}},styleSingleton=function(){var e=styleHookSingleton(),i=function(s){var a=s.styles,_=s.dynamic;return e(a,_),null};return i},zeroGap={left:0,top:0,right:0,gap:0},parse=function(e){return parseInt(e||"",10)||0},getOffset=function(e){var i=window.getComputedStyle(document.body),s=i[e==="padding"?"paddingLeft":"marginLeft"],a=i[e==="padding"?"paddingTop":"marginTop"],_=i[e==="padding"?"paddingRight":"marginRight"];return[parse(s),parse(a),parse(_)]},getGapWidth=function(e){if(e===void 0&&(e="margin"),typeof window>"u")return zeroGap;var i=getOffset(e),s=document.documentElement.clientWidth,a=window.innerWidth;return{left:i[0],top:i[1],right:i[2],gap:Math.max(0,a-s+i[2]-i[0])}},Style=styleSingleton(),lockAttribute="data-scroll-locked",getStyles=function(e,i,s,a){var _=e.left,$=e.top,rt=e.right,c=e.gap;return s===void 0&&(s="margin"),`
  .`.concat(noScrollbarsClassName,` {
   overflow: hidden `).concat(a,`;
   padding-right: `).concat(c,"px ").concat(a,`;
  }
  body[`).concat(lockAttribute,`] {
    overflow: hidden `).concat(a,`;
    overscroll-behavior: contain;
    `).concat([i&&"position: relative ".concat(a,";"),s==="margin"&&`
    padding-left: `.concat(_,`px;
    padding-top: `).concat($,`px;
    padding-right: `).concat(rt,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(c,"px ").concat(a,`;
    `),s==="padding"&&"padding-right: ".concat(c,"px ").concat(a,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(zeroRightClassName,` {
    right: `).concat(c,"px ").concat(a,`;
  }
  
  .`).concat(fullWidthClassName,` {
    margin-right: `).concat(c,"px ").concat(a,`;
  }
  
  .`).concat(zeroRightClassName," .").concat(zeroRightClassName,` {
    right: 0 `).concat(a,`;
  }
  
  .`).concat(fullWidthClassName," .").concat(fullWidthClassName,` {
    margin-right: 0 `).concat(a,`;
  }
  
  body[`).concat(lockAttribute,`] {
    `).concat(removedBarSizeVariable,": ").concat(c,`px;
  }
`)},getCurrentUseCounter=function(){var e=parseInt(document.body.getAttribute(lockAttribute)||"0",10);return isFinite(e)?e:0},useLockAttribute=function(){reactExports.useEffect(function(){return document.body.setAttribute(lockAttribute,(getCurrentUseCounter()+1).toString()),function(){var e=getCurrentUseCounter()-1;e<=0?document.body.removeAttribute(lockAttribute):document.body.setAttribute(lockAttribute,e.toString())}},[])},RemoveScrollBar=function(e){var i=e.noRelative,s=e.noImportant,a=e.gapMode,_=a===void 0?"margin":a;useLockAttribute();var $=reactExports.useMemo(function(){return getGapWidth(_)},[_]);return reactExports.createElement(Style,{styles:getStyles($,!i,_,s?"":"!important")})},passiveSupported=!1;if(typeof window<"u")try{var options=Object.defineProperty({},"passive",{get:function(){return passiveSupported=!0,!0}});window.addEventListener("test",options,options),window.removeEventListener("test",options,options)}catch{passiveSupported=!1}var nonPassive=passiveSupported?{passive:!1}:!1,alwaysContainsScroll=function(e){return e.tagName==="TEXTAREA"},elementCanBeScrolled=function(e,i){if(!(e instanceof Element))return!1;var s=window.getComputedStyle(e);return s[i]!=="hidden"&&!(s.overflowY===s.overflowX&&!alwaysContainsScroll(e)&&s[i]==="visible")},elementCouldBeVScrolled=function(e){return elementCanBeScrolled(e,"overflowY")},elementCouldBeHScrolled=function(e){return elementCanBeScrolled(e,"overflowX")},locationCouldBeScrolled=function(e,i){var s=i.ownerDocument,a=i;do{typeof ShadowRoot<"u"&&a instanceof ShadowRoot&&(a=a.host);var _=elementCouldBeScrolled(e,a);if(_){var $=getScrollVariables(e,a),rt=$[1],c=$[2];if(rt>c)return!0}a=a.parentNode}while(a&&a!==s.body);return!1},getVScrollVariables=function(e){var i=e.scrollTop,s=e.scrollHeight,a=e.clientHeight;return[i,s,a]},getHScrollVariables=function(e){var i=e.scrollLeft,s=e.scrollWidth,a=e.clientWidth;return[i,s,a]},elementCouldBeScrolled=function(e,i){return e==="v"?elementCouldBeVScrolled(i):elementCouldBeHScrolled(i)},getScrollVariables=function(e,i){return e==="v"?getVScrollVariables(i):getHScrollVariables(i)},getDirectionFactor=function(e,i){return e==="h"&&i==="rtl"?-1:1},handleScroll=function(e,i,s,a,_){var $=getDirectionFactor(e,window.getComputedStyle(i).direction),rt=$*a,c=s.target,dt=i.contains(c),ht=!1,Et=rt>0,St=0,At=0;do{if(!c)break;var Pt=getScrollVariables(e,c),Vt=Pt[0],Bt=Pt[1],Zt=Pt[2],zt=Bt-Zt-$*Vt;(Vt||zt)&&elementCouldBeScrolled(e,c)&&(St+=zt,At+=Vt);var Ut=c.parentNode;c=Ut&&Ut.nodeType===Node.DOCUMENT_FRAGMENT_NODE?Ut.host:Ut}while(!dt&&c!==document.body||dt&&(i.contains(c)||i===c));return(Et&&(Math.abs(St)<1||!_)||!Et&&(Math.abs(At)<1||!_))&&(ht=!0),ht},getTouchXY=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},getDeltaXY=function(e){return[e.deltaX,e.deltaY]},extractRef=function(e){return e&&"current"in e?e.current:e},deltaCompare=function(e,i){return e[0]===i[0]&&e[1]===i[1]},generateStyle=function(e){return`
  .block-interactivity-`.concat(e,` {pointer-events: none;}
  .allow-interactivity-`).concat(e,` {pointer-events: all;}
`)},idCounter=0,lockStack=[];function RemoveScrollSideCar(e){var i=reactExports.useRef([]),s=reactExports.useRef([0,0]),a=reactExports.useRef(),_=reactExports.useState(idCounter++)[0],$=reactExports.useState(styleSingleton)[0],rt=reactExports.useRef(e);reactExports.useEffect(function(){rt.current=e},[e]),reactExports.useEffect(function(){if(e.inert){document.body.classList.add("block-interactivity-".concat(_));var Bt=__spreadArray([e.lockRef.current],(e.shards||[]).map(extractRef),!0).filter(Boolean);return Bt.forEach(function(Zt){return Zt.classList.add("allow-interactivity-".concat(_))}),function(){document.body.classList.remove("block-interactivity-".concat(_)),Bt.forEach(function(Zt){return Zt.classList.remove("allow-interactivity-".concat(_))})}}},[e.inert,e.lockRef.current,e.shards]);var c=reactExports.useCallback(function(Bt,Zt){if("touches"in Bt&&Bt.touches.length===2||Bt.type==="wheel"&&Bt.ctrlKey)return!rt.current.allowPinchZoom;var zt=getTouchXY(Bt),Ut=s.current,Nt="deltaX"in Bt?Bt.deltaX:Ut[0]-zt[0],Gt="deltaY"in Bt?Bt.deltaY:Ut[1]-zt[1],er,ir=Bt.target,or=Math.abs(Nt)>Math.abs(Gt)?"h":"v";if("touches"in Bt&&or==="h"&&ir.type==="range")return!1;var mr=locationCouldBeScrolled(or,ir);if(!mr)return!0;if(mr?er=or:(er=or==="v"?"h":"v",mr=locationCouldBeScrolled(or,ir)),!mr)return!1;if(!a.current&&"changedTouches"in Bt&&(Nt||Gt)&&(a.current=er),!er)return!0;var Rr=a.current||er;return handleScroll(Rr,Zt,Bt,Rr==="h"?Nt:Gt,!0)},[]),dt=reactExports.useCallback(function(Bt){var Zt=Bt;if(!(!lockStack.length||lockStack[lockStack.length-1]!==$)){var zt="deltaY"in Zt?getDeltaXY(Zt):getTouchXY(Zt),Ut=i.current.filter(function(er){return er.name===Zt.type&&(er.target===Zt.target||Zt.target===er.shadowParent)&&deltaCompare(er.delta,zt)})[0];if(Ut&&Ut.should){Zt.cancelable&&Zt.preventDefault();return}if(!Ut){var Nt=(rt.current.shards||[]).map(extractRef).filter(Boolean).filter(function(er){return er.contains(Zt.target)}),Gt=Nt.length>0?c(Zt,Nt[0]):!rt.current.noIsolation;Gt&&Zt.cancelable&&Zt.preventDefault()}}},[]),ht=reactExports.useCallback(function(Bt,Zt,zt,Ut){var Nt={name:Bt,delta:Zt,target:zt,should:Ut,shadowParent:getOutermostShadowParent(zt)};i.current.push(Nt),setTimeout(function(){i.current=i.current.filter(function(Gt){return Gt!==Nt})},1)},[]),Et=reactExports.useCallback(function(Bt){s.current=getTouchXY(Bt),a.current=void 0},[]),St=reactExports.useCallback(function(Bt){ht(Bt.type,getDeltaXY(Bt),Bt.target,c(Bt,e.lockRef.current))},[]),At=reactExports.useCallback(function(Bt){ht(Bt.type,getTouchXY(Bt),Bt.target,c(Bt,e.lockRef.current))},[]);reactExports.useEffect(function(){return lockStack.push($),e.setCallbacks({onScrollCapture:St,onWheelCapture:St,onTouchMoveCapture:At}),document.addEventListener("wheel",dt,nonPassive),document.addEventListener("touchmove",dt,nonPassive),document.addEventListener("touchstart",Et,nonPassive),function(){lockStack=lockStack.filter(function(Bt){return Bt!==$}),document.removeEventListener("wheel",dt,nonPassive),document.removeEventListener("touchmove",dt,nonPassive),document.removeEventListener("touchstart",Et,nonPassive)}},[]);var Pt=e.removeScrollBar,Vt=e.inert;return reactExports.createElement(reactExports.Fragment,null,Vt?reactExports.createElement($,{styles:generateStyle(_)}):null,Pt?reactExports.createElement(RemoveScrollBar,{noRelative:e.noRelative,gapMode:e.gapMode}):null)}function getOutermostShadowParent(e){for(var i=null;e!==null;)e instanceof ShadowRoot&&(i=e.host,e=e.host),e=e.parentNode;return i}const SideCar=exportSidecar(effectCar,RemoveScrollSideCar);var ReactRemoveScroll=reactExports.forwardRef(function(e,i){return reactExports.createElement(RemoveScroll,__assign({},e,{ref:i,sideCar:SideCar}))});ReactRemoveScroll.classNames=RemoveScroll.classNames;var getDefaultParent=function(e){if(typeof document>"u")return null;var i=Array.isArray(e)?e[0]:e;return i.ownerDocument.body},counterMap=new WeakMap,uncontrolledNodes=new WeakMap,markerMap={},lockCount=0,unwrapHost=function(e){return e&&(e.host||unwrapHost(e.parentNode))},correctTargets=function(e,i){return i.map(function(s){if(e.contains(s))return s;var a=unwrapHost(s);return a&&e.contains(a)?a:(console.error("aria-hidden",s,"in not contained inside",e,". Doing nothing"),null)}).filter(function(s){return!!s})},applyAttributeToOthers=function(e,i,s,a){var _=correctTargets(i,Array.isArray(e)?e:[e]);markerMap[s]||(markerMap[s]=new WeakMap);var $=markerMap[s],rt=[],c=new Set,dt=new Set(_),ht=function(St){!St||c.has(St)||(c.add(St),ht(St.parentNode))};_.forEach(ht);var Et=function(St){!St||dt.has(St)||Array.prototype.forEach.call(St.children,function(At){if(c.has(At))Et(At);else try{var Pt=At.getAttribute(a),Vt=Pt!==null&&Pt!=="false",Bt=(counterMap.get(At)||0)+1,Zt=($.get(At)||0)+1;counterMap.set(At,Bt),$.set(At,Zt),rt.push(At),Bt===1&&Vt&&uncontrolledNodes.set(At,!0),Zt===1&&At.setAttribute(s,"true"),Vt||At.setAttribute(a,"true")}catch(zt){console.error("aria-hidden: cannot operate on ",At,zt)}})};return Et(i),c.clear(),lockCount++,function(){rt.forEach(function(St){var At=counterMap.get(St)-1,Pt=$.get(St)-1;counterMap.set(St,At),$.set(St,Pt),At||(uncontrolledNodes.has(St)||St.removeAttribute(a),uncontrolledNodes.delete(St)),Pt||St.removeAttribute(s)}),lockCount--,lockCount||(counterMap=new WeakMap,counterMap=new WeakMap,uncontrolledNodes=new WeakMap,markerMap={})}},hideOthers=function(e,i,s){s===void 0&&(s="data-aria-hidden");var a=Array.from(Array.isArray(e)?e:[e]),_=getDefaultParent(e);return _?(a.push.apply(a,Array.from(_.querySelectorAll("[aria-live]"))),applyAttributeToOthers(a,_,s,"aria-hidden")):function(){return null}},DIALOG_NAME="Dialog",[createDialogContext,createDialogScope]=createContextScope(DIALOG_NAME),[DialogProvider,useDialogContext]=createDialogContext(DIALOG_NAME),Dialog$1=e=>{const{__scopeDialog:i,children:s,open:a,defaultOpen:_,onOpenChange:$,modal:rt=!0}=e,c=reactExports.useRef(null),dt=reactExports.useRef(null),[ht,Et]=useControllableState({prop:a,defaultProp:_??!1,onChange:$,caller:DIALOG_NAME});return jsxRuntimeExports.jsx(DialogProvider,{scope:i,triggerRef:c,contentRef:dt,contentId:useId(),titleId:useId(),descriptionId:useId(),open:ht,onOpenChange:Et,onOpenToggle:reactExports.useCallback(()=>Et(St=>!St),[Et]),modal:rt,children:s})};Dialog$1.displayName=DIALOG_NAME;var TRIGGER_NAME$4="DialogTrigger",DialogTrigger$1=reactExports.forwardRef((e,i)=>{const{__scopeDialog:s,...a}=e,_=useDialogContext(TRIGGER_NAME$4,s),$=useComposedRefs$1(i,_.triggerRef);return jsxRuntimeExports.jsx(Primitive.button,{type:"button","aria-haspopup":"dialog","aria-expanded":_.open,"aria-controls":_.contentId,"data-state":getState$2(_.open),...a,ref:$,onClick:composeEventHandlers(e.onClick,_.onOpenToggle)})});DialogTrigger$1.displayName=TRIGGER_NAME$4;var PORTAL_NAME$2="DialogPortal",[PortalProvider,usePortalContext]=createDialogContext(PORTAL_NAME$2,{forceMount:void 0}),DialogPortal$1=e=>{const{__scopeDialog:i,forceMount:s,children:a,container:_}=e,$=useDialogContext(PORTAL_NAME$2,i);return jsxRuntimeExports.jsx(PortalProvider,{scope:i,forceMount:s,children:reactExports.Children.map(a,rt=>jsxRuntimeExports.jsx(Presence,{present:s||$.open,children:jsxRuntimeExports.jsx(Portal$2,{asChild:!0,container:_,children:rt})}))})};DialogPortal$1.displayName=PORTAL_NAME$2;var OVERLAY_NAME$1="DialogOverlay",DialogOverlay$1=reactExports.forwardRef((e,i)=>{const s=usePortalContext(OVERLAY_NAME$1,e.__scopeDialog),{forceMount:a=s.forceMount,..._}=e,$=useDialogContext(OVERLAY_NAME$1,e.__scopeDialog);return $.modal?jsxRuntimeExports.jsx(Presence,{present:a||$.open,children:jsxRuntimeExports.jsx(DialogOverlayImpl,{..._,ref:i})}):null});DialogOverlay$1.displayName=OVERLAY_NAME$1;var Slot$1=createSlot("DialogOverlay.RemoveScroll"),DialogOverlayImpl=reactExports.forwardRef((e,i)=>{const{__scopeDialog:s,...a}=e,_=useDialogContext(OVERLAY_NAME$1,s);return jsxRuntimeExports.jsx(ReactRemoveScroll,{as:Slot$1,allowPinchZoom:!0,shards:[_.contentRef],children:jsxRuntimeExports.jsx(Primitive.div,{"data-state":getState$2(_.open),...a,ref:i,style:{pointerEvents:"auto",...a.style}})})}),CONTENT_NAME$4="DialogContent",DialogContent$1=reactExports.forwardRef((e,i)=>{const s=usePortalContext(CONTENT_NAME$4,e.__scopeDialog),{forceMount:a=s.forceMount,..._}=e,$=useDialogContext(CONTENT_NAME$4,e.__scopeDialog);return jsxRuntimeExports.jsx(Presence,{present:a||$.open,children:$.modal?jsxRuntimeExports.jsx(DialogContentModal,{..._,ref:i}):jsxRuntimeExports.jsx(DialogContentNonModal,{..._,ref:i})})});DialogContent$1.displayName=CONTENT_NAME$4;var DialogContentModal=reactExports.forwardRef((e,i)=>{const s=useDialogContext(CONTENT_NAME$4,e.__scopeDialog),a=reactExports.useRef(null),_=useComposedRefs$1(i,s.contentRef,a);return reactExports.useEffect(()=>{const $=a.current;if($)return hideOthers($)},[]),jsxRuntimeExports.jsx(DialogContentImpl,{...e,ref:_,trapFocus:s.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:composeEventHandlers(e.onCloseAutoFocus,$=>{var rt;$.preventDefault(),(rt=s.triggerRef.current)==null||rt.focus()}),onPointerDownOutside:composeEventHandlers(e.onPointerDownOutside,$=>{const rt=$.detail.originalEvent,c=rt.button===0&&rt.ctrlKey===!0;(rt.button===2||c)&&$.preventDefault()}),onFocusOutside:composeEventHandlers(e.onFocusOutside,$=>$.preventDefault())})}),DialogContentNonModal=reactExports.forwardRef((e,i)=>{const s=useDialogContext(CONTENT_NAME$4,e.__scopeDialog),a=reactExports.useRef(!1),_=reactExports.useRef(!1);return jsxRuntimeExports.jsx(DialogContentImpl,{...e,ref:i,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:$=>{var rt,c;(rt=e.onCloseAutoFocus)==null||rt.call(e,$),$.defaultPrevented||(a.current||(c=s.triggerRef.current)==null||c.focus(),$.preventDefault()),a.current=!1,_.current=!1},onInteractOutside:$=>{var dt,ht;(dt=e.onInteractOutside)==null||dt.call(e,$),$.defaultPrevented||(a.current=!0,$.detail.originalEvent.type==="pointerdown"&&(_.current=!0));const rt=$.target;((ht=s.triggerRef.current)==null?void 0:ht.contains(rt))&&$.preventDefault(),$.detail.originalEvent.type==="focusin"&&_.current&&$.preventDefault()}})}),DialogContentImpl=reactExports.forwardRef((e,i)=>{const{__scopeDialog:s,trapFocus:a,onOpenAutoFocus:_,onCloseAutoFocus:$,...rt}=e,c=useDialogContext(CONTENT_NAME$4,s),dt=reactExports.useRef(null),ht=useComposedRefs$1(i,dt);return useFocusGuards(),jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(FocusScope,{asChild:!0,loop:!0,trapped:a,onMountAutoFocus:_,onUnmountAutoFocus:$,children:jsxRuntimeExports.jsx(DismissableLayer,{role:"dialog",id:c.contentId,"aria-describedby":c.descriptionId,"aria-labelledby":c.titleId,"data-state":getState$2(c.open),...rt,ref:ht,onDismiss:()=>c.onOpenChange(!1)})}),jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(TitleWarning,{titleId:c.titleId}),jsxRuntimeExports.jsx(DescriptionWarning$1,{contentRef:dt,descriptionId:c.descriptionId})]})]})}),TITLE_NAME$1="DialogTitle",DialogTitle$1=reactExports.forwardRef((e,i)=>{const{__scopeDialog:s,...a}=e,_=useDialogContext(TITLE_NAME$1,s);return jsxRuntimeExports.jsx(Primitive.h2,{id:_.titleId,...a,ref:i})});DialogTitle$1.displayName=TITLE_NAME$1;var DESCRIPTION_NAME$1="DialogDescription",DialogDescription$1=reactExports.forwardRef((e,i)=>{const{__scopeDialog:s,...a}=e,_=useDialogContext(DESCRIPTION_NAME$1,s);return jsxRuntimeExports.jsx(Primitive.p,{id:_.descriptionId,...a,ref:i})});DialogDescription$1.displayName=DESCRIPTION_NAME$1;var CLOSE_NAME="DialogClose",DialogClose=reactExports.forwardRef((e,i)=>{const{__scopeDialog:s,...a}=e,_=useDialogContext(CLOSE_NAME,s);return jsxRuntimeExports.jsx(Primitive.button,{type:"button",...a,ref:i,onClick:composeEventHandlers(e.onClick,()=>_.onOpenChange(!1))})});DialogClose.displayName=CLOSE_NAME;function getState$2(e){return e?"open":"closed"}var TITLE_WARNING_NAME="DialogTitleWarning",[WarningProvider,useWarningContext]=createContext2(TITLE_WARNING_NAME,{contentName:CONTENT_NAME$4,titleName:TITLE_NAME$1,docsSlug:"dialog"}),TitleWarning=({titleId:e})=>{const i=useWarningContext(TITLE_WARNING_NAME),s=`\`${i.contentName}\` requires a \`${i.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${i.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${i.docsSlug}`;return reactExports.useEffect(()=>{e&&(document.getElementById(e)||console.error(s))},[s,e]),null},DESCRIPTION_WARNING_NAME="DialogDescriptionWarning",DescriptionWarning$1=({contentRef:e,descriptionId:i})=>{const a=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${useWarningContext(DESCRIPTION_WARNING_NAME).contentName}}.`;return reactExports.useEffect(()=>{var $;const _=($=e.current)==null?void 0:$.getAttribute("aria-describedby");i&&_&&(document.getElementById(i)||console.warn(a))},[a,e,i]),null},Root$1=Dialog$1,Trigger$2=DialogTrigger$1,Portal$1=DialogPortal$1,Overlay=DialogOverlay$1,Content$1=DialogContent$1,Title=DialogTitle$1,Description=DialogDescription$1,Close=DialogClose,ROOT_NAME="AlertDialog",[createAlertDialogContext,createAlertDialogScope]=createContextScope(ROOT_NAME,[createDialogScope]),useDialogScope=createDialogScope(),AlertDialog$1=e=>{const{__scopeAlertDialog:i,...s}=e,a=useDialogScope(i);return jsxRuntimeExports.jsx(Root$1,{...a,...s,modal:!0})};AlertDialog$1.displayName=ROOT_NAME;var TRIGGER_NAME$3="AlertDialogTrigger",AlertDialogTrigger$1=reactExports.forwardRef((e,i)=>{const{__scopeAlertDialog:s,...a}=e,_=useDialogScope(s);return jsxRuntimeExports.jsx(Trigger$2,{..._,...a,ref:i})});AlertDialogTrigger$1.displayName=TRIGGER_NAME$3;var PORTAL_NAME$1="AlertDialogPortal",AlertDialogPortal$1=e=>{const{__scopeAlertDialog:i,...s}=e,a=useDialogScope(i);return jsxRuntimeExports.jsx(Portal$1,{...a,...s})};AlertDialogPortal$1.displayName=PORTAL_NAME$1;var OVERLAY_NAME="AlertDialogOverlay",AlertDialogOverlay$1=reactExports.forwardRef((e,i)=>{const{__scopeAlertDialog:s,...a}=e,_=useDialogScope(s);return jsxRuntimeExports.jsx(Overlay,{..._,...a,ref:i})});AlertDialogOverlay$1.displayName=OVERLAY_NAME;var CONTENT_NAME$3="AlertDialogContent",[AlertDialogContentProvider,useAlertDialogContentContext]=createAlertDialogContext(CONTENT_NAME$3),Slottable=createSlottable("AlertDialogContent"),AlertDialogContent$1=reactExports.forwardRef((e,i)=>{const{__scopeAlertDialog:s,children:a,..._}=e,$=useDialogScope(s),rt=reactExports.useRef(null),c=useComposedRefs$1(i,rt),dt=reactExports.useRef(null);return jsxRuntimeExports.jsx(WarningProvider,{contentName:CONTENT_NAME$3,titleName:TITLE_NAME,docsSlug:"alert-dialog",children:jsxRuntimeExports.jsx(AlertDialogContentProvider,{scope:s,cancelRef:dt,children:jsxRuntimeExports.jsxs(Content$1,{role:"alertdialog",...$,..._,ref:c,onOpenAutoFocus:composeEventHandlers(_.onOpenAutoFocus,ht=>{var Et;ht.preventDefault(),(Et=dt.current)==null||Et.focus({preventScroll:!0})}),onPointerDownOutside:ht=>ht.preventDefault(),onInteractOutside:ht=>ht.preventDefault(),children:[jsxRuntimeExports.jsx(Slottable,{children:a}),jsxRuntimeExports.jsx(DescriptionWarning,{contentRef:rt})]})})})});AlertDialogContent$1.displayName=CONTENT_NAME$3;var TITLE_NAME="AlertDialogTitle",AlertDialogTitle$1=reactExports.forwardRef((e,i)=>{const{__scopeAlertDialog:s,...a}=e,_=useDialogScope(s);return jsxRuntimeExports.jsx(Title,{..._,...a,ref:i})});AlertDialogTitle$1.displayName=TITLE_NAME;var DESCRIPTION_NAME="AlertDialogDescription",AlertDialogDescription$1=reactExports.forwardRef((e,i)=>{const{__scopeAlertDialog:s,...a}=e,_=useDialogScope(s);return jsxRuntimeExports.jsx(Description,{..._,...a,ref:i})});AlertDialogDescription$1.displayName=DESCRIPTION_NAME;var ACTION_NAME="AlertDialogAction",AlertDialogAction$1=reactExports.forwardRef((e,i)=>{const{__scopeAlertDialog:s,...a}=e,_=useDialogScope(s);return jsxRuntimeExports.jsx(Close,{..._,...a,ref:i})});AlertDialogAction$1.displayName=ACTION_NAME;var CANCEL_NAME="AlertDialogCancel",AlertDialogCancel$1=reactExports.forwardRef((e,i)=>{const{__scopeAlertDialog:s,...a}=e,{cancelRef:_}=useAlertDialogContentContext(CANCEL_NAME,s),$=useDialogScope(s),rt=useComposedRefs$1(i,_);return jsxRuntimeExports.jsx(Close,{...$,...a,ref:rt})});AlertDialogCancel$1.displayName=CANCEL_NAME;var DescriptionWarning=({contentRef:e})=>{const i=`\`${CONTENT_NAME$3}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${CONTENT_NAME$3}\` by passing a \`${DESCRIPTION_NAME}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${CONTENT_NAME$3}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return reactExports.useEffect(()=>{var a;document.getElementById((a=e.current)==null?void 0:a.getAttribute("aria-describedby"))||console.warn(i)},[i,e]),null},Root2$2=AlertDialog$1,Trigger2$1=AlertDialogTrigger$1,Portal2=AlertDialogPortal$1,Overlay2=AlertDialogOverlay$1,Content2$2=AlertDialogContent$1,Action=AlertDialogAction$1,Cancel=AlertDialogCancel$1,Title2=AlertDialogTitle$1,Description2=AlertDialogDescription$1;const AlertDialog=Root2$2,AlertDialogTrigger=Trigger2$1,AlertDialogPortal=Portal2,AlertDialogOverlay=reactExports.forwardRef(({className:e,...i},s)=>jsxRuntimeExports.jsx(Overlay2,{className:cn("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...i,ref:s}));AlertDialogOverlay.displayName=Overlay2.displayName;const AlertDialogContent=reactExports.forwardRef(({className:e,...i},s)=>jsxRuntimeExports.jsxs(AlertDialogPortal,{children:[jsxRuntimeExports.jsx(AlertDialogOverlay,{}),jsxRuntimeExports.jsx(Content2$2,{ref:s,className:cn("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...i})]}));AlertDialogContent.displayName=Content2$2.displayName;const AlertDialogHeader=({className:e,...i})=>jsxRuntimeExports.jsx("div",{className:cn("flex flex-col space-y-2 text-center sm:text-left",e),...i});AlertDialogHeader.displayName="AlertDialogHeader";const AlertDialogFooter=({className:e,...i})=>jsxRuntimeExports.jsx("div",{className:cn("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...i});AlertDialogFooter.displayName="AlertDialogFooter";const AlertDialogTitle=reactExports.forwardRef(({className:e,...i},s)=>jsxRuntimeExports.jsx(Title2,{ref:s,className:cn("text-lg font-semibold",e),...i}));AlertDialogTitle.displayName=Title2.displayName;const AlertDialogDescription=reactExports.forwardRef(({className:e,...i},s)=>jsxRuntimeExports.jsx(Description2,{ref:s,className:cn("text-sm text-muted-foreground",e),...i}));AlertDialogDescription.displayName=Description2.displayName;const AlertDialogAction=reactExports.forwardRef(({className:e,...i},s)=>jsxRuntimeExports.jsx(Action,{ref:s,className:cn(buttonVariants(),e),...i}));AlertDialogAction.displayName=Action.displayName;const AlertDialogCancel=reactExports.forwardRef(({className:e,...i},s)=>jsxRuntimeExports.jsx(Cancel,{ref:s,className:cn(buttonVariants({variant:"outline"}),"mt-2 sm:mt-0",e),...i}));AlertDialogCancel.displayName=Cancel.displayName;function SettingsPage(){const[e,i]=reactExports.useState(!0),[s,a]=reactExports.useState(!0),[_,$]=reactExports.useState(!1),[rt,c]=reactExports.useState(!1),dt=()=>{ue.success("Account deletion request submitted")};return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-24",children:[jsxRuntimeExports.jsxs("div",{className:"bg-card border-b border-border px-4 py-4 flex items-center gap-4 sticky top-0 z-10",children:[jsxRuntimeExports.jsx(Link,{to:"/profile",children:jsxRuntimeExports.jsx(motion.div,{whileTap:{scale:.9},className:"p-2 -ml-2",children:jsxRuntimeExports.jsx(ArrowLeft,{className:"w-6 h-6 text-foreground"})})}),jsxRuntimeExports.jsx("h1",{className:"text-lg font-bold text-foreground",children:"Settings"})]}),jsxRuntimeExports.jsxs("div",{className:"p-4 space-y-4",children:[jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-card rounded-2xl shadow-elevated overflow-hidden",children:[jsxRuntimeExports.jsx("div",{className:"p-4 border-b border-border",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-xl bg-primary/10 flex items-center justify-center text-primary",children:jsxRuntimeExports.jsx(Bell,{className:"w-5 h-5"})}),jsxRuntimeExports.jsx("h2",{className:"font-semibold text-foreground",children:"Notifications"})]})}),jsxRuntimeExports.jsxs("div",{className:"divide-y divide-border",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between p-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"font-medium text-foreground",children:"Push Notifications"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:"Receive push notifications"})]}),jsxRuntimeExports.jsx(Switch,{checked:e,onCheckedChange:i})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between p-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"font-medium text-foreground",children:"Order Updates"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:"Get notified about order status"})]}),jsxRuntimeExports.jsx(Switch,{checked:s,onCheckedChange:a})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between p-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"font-medium text-foreground",children:"Promotions"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:"Receive offers and discounts"})]}),jsxRuntimeExports.jsx(Switch,{checked:_,onCheckedChange:$})]})]})]}),jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"bg-card rounded-2xl shadow-elevated overflow-hidden",children:[jsxRuntimeExports.jsx("div",{className:"p-4 border-b border-border",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-xl bg-secondary flex items-center justify-center text-muted-foreground",children:jsxRuntimeExports.jsx(Moon,{className:"w-5 h-5"})}),jsxRuntimeExports.jsx("h2",{className:"font-semibold text-foreground",children:"Appearance"})]})}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between p-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"font-medium text-foreground",children:"Dark Mode"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:"Switch to dark theme"})]}),jsxRuntimeExports.jsx(Switch,{checked:rt,onCheckedChange:c})]})]}),jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"bg-card rounded-2xl shadow-elevated overflow-hidden",children:[jsxRuntimeExports.jsx("div",{className:"p-4 border-b border-border",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-xl bg-accent/10 flex items-center justify-center text-accent",children:jsxRuntimeExports.jsx(Globe,{className:"w-5 h-5"})}),jsxRuntimeExports.jsx("h2",{className:"font-semibold text-foreground",children:"Language & Region"})]})}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between p-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"font-medium text-foreground",children:"Language"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:"English (India)"})]}),jsxRuntimeExports.jsx(ChevronRight,{className:"w-5 h-5 text-muted-foreground"})]})]}),jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"bg-card rounded-2xl shadow-elevated overflow-hidden",children:[jsxRuntimeExports.jsx("div",{className:"p-4 border-b border-border",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-xl bg-gold/10 flex items-center justify-center text-gold",children:jsxRuntimeExports.jsx(Lock,{className:"w-5 h-5"})}),jsxRuntimeExports.jsx("h2",{className:"font-semibold text-foreground",children:"Security"})]})}),jsxRuntimeExports.jsxs("div",{className:"divide-y divide-border",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between p-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"font-medium text-foreground",children:"Change Password"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:"Update your password"})]}),jsxRuntimeExports.jsx(ChevronRight,{className:"w-5 h-5 text-muted-foreground"})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between p-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"font-medium text-foreground",children:"Two-Factor Authentication"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:"Add extra security"})]}),jsxRuntimeExports.jsx(ChevronRight,{className:"w-5 h-5 text-muted-foreground"})]})]})]}),jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"bg-card rounded-2xl shadow-elevated overflow-hidden",children:[jsxRuntimeExports.jsx("div",{className:"p-4 border-b border-border",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-xl bg-secondary flex items-center justify-center text-muted-foreground",children:jsxRuntimeExports.jsx(Smartphone,{className:"w-5 h-5"})}),jsxRuntimeExports.jsx("h2",{className:"font-semibold text-foreground",children:"App Info"})]})}),jsxRuntimeExports.jsx("div",{className:"p-4",children:jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsx("p",{className:"text-muted-foreground",children:"Version"}),jsxRuntimeExports.jsx("p",{className:"font-medium text-foreground",children:"1.0.0"})]})})]}),jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},className:"bg-card rounded-2xl shadow-elevated overflow-hidden border border-destructive/20",children:[jsxRuntimeExports.jsx("div",{className:"p-4 border-b border-border",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-xl bg-destructive/10 flex items-center justify-center text-destructive",children:jsxRuntimeExports.jsx(Trash2,{className:"w-5 h-5"})}),jsxRuntimeExports.jsx("h2",{className:"font-semibold text-destructive",children:"Danger Zone"})]})}),jsxRuntimeExports.jsx("div",{className:"p-4",children:jsxRuntimeExports.jsxs(AlertDialog,{children:[jsxRuntimeExports.jsx(AlertDialogTrigger,{asChild:!0,children:jsxRuntimeExports.jsx(Button,{variant:"destructive",className:"w-full",children:"Delete Account"})}),jsxRuntimeExports.jsxs(AlertDialogContent,{children:[jsxRuntimeExports.jsxs(AlertDialogHeader,{children:[jsxRuntimeExports.jsx(AlertDialogTitle,{children:"Are you absolutely sure?"}),jsxRuntimeExports.jsx(AlertDialogDescription,{children:"This action cannot be undone. This will permanently delete your account and remove all your data from our servers."})]}),jsxRuntimeExports.jsxs(AlertDialogFooter,{children:[jsxRuntimeExports.jsx(AlertDialogCancel,{children:"Cancel"}),jsxRuntimeExports.jsx(AlertDialogAction,{onClick:dt,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete Account"})]})]})]})})]})]}),jsxRuntimeExports.jsx(BottomNav,{})]})}var COLLAPSIBLE_NAME="Collapsible",[createCollapsibleContext,createCollapsibleScope]=createContextScope(COLLAPSIBLE_NAME),[CollapsibleProvider,useCollapsibleContext]=createCollapsibleContext(COLLAPSIBLE_NAME),Collapsible=reactExports.forwardRef((e,i)=>{const{__scopeCollapsible:s,open:a,defaultOpen:_,disabled:$,onOpenChange:rt,...c}=e,[dt,ht]=useControllableState({prop:a,defaultProp:_??!1,onChange:rt,caller:COLLAPSIBLE_NAME});return jsxRuntimeExports.jsx(CollapsibleProvider,{scope:s,disabled:$,contentId:useId(),open:dt,onOpenToggle:reactExports.useCallback(()=>ht(Et=>!Et),[ht]),children:jsxRuntimeExports.jsx(Primitive.div,{"data-state":getState$1(dt),"data-disabled":$?"":void 0,...c,ref:i})})});Collapsible.displayName=COLLAPSIBLE_NAME;var TRIGGER_NAME$2="CollapsibleTrigger",CollapsibleTrigger=reactExports.forwardRef((e,i)=>{const{__scopeCollapsible:s,...a}=e,_=useCollapsibleContext(TRIGGER_NAME$2,s);return jsxRuntimeExports.jsx(Primitive.button,{type:"button","aria-controls":_.contentId,"aria-expanded":_.open||!1,"data-state":getState$1(_.open),"data-disabled":_.disabled?"":void 0,disabled:_.disabled,...a,ref:i,onClick:composeEventHandlers(e.onClick,_.onOpenToggle)})});CollapsibleTrigger.displayName=TRIGGER_NAME$2;var CONTENT_NAME$2="CollapsibleContent",CollapsibleContent=reactExports.forwardRef((e,i)=>{const{forceMount:s,...a}=e,_=useCollapsibleContext(CONTENT_NAME$2,e.__scopeCollapsible);return jsxRuntimeExports.jsx(Presence,{present:s||_.open,children:({present:$})=>jsxRuntimeExports.jsx(CollapsibleContentImpl,{...a,ref:i,present:$})})});CollapsibleContent.displayName=CONTENT_NAME$2;var CollapsibleContentImpl=reactExports.forwardRef((e,i)=>{const{__scopeCollapsible:s,present:a,children:_,...$}=e,rt=useCollapsibleContext(CONTENT_NAME$2,s),[c,dt]=reactExports.useState(a),ht=reactExports.useRef(null),Et=useComposedRefs$1(i,ht),St=reactExports.useRef(0),At=St.current,Pt=reactExports.useRef(0),Vt=Pt.current,Bt=rt.open||c,Zt=reactExports.useRef(Bt),zt=reactExports.useRef(void 0);return reactExports.useEffect(()=>{const Ut=requestAnimationFrame(()=>Zt.current=!1);return()=>cancelAnimationFrame(Ut)},[]),useLayoutEffect2(()=>{const Ut=ht.current;if(Ut){zt.current=zt.current||{transitionDuration:Ut.style.transitionDuration,animationName:Ut.style.animationName},Ut.style.transitionDuration="0s",Ut.style.animationName="none";const Nt=Ut.getBoundingClientRect();St.current=Nt.height,Pt.current=Nt.width,Zt.current||(Ut.style.transitionDuration=zt.current.transitionDuration,Ut.style.animationName=zt.current.animationName),dt(a)}},[rt.open,a]),jsxRuntimeExports.jsx(Primitive.div,{"data-state":getState$1(rt.open),"data-disabled":rt.disabled?"":void 0,id:rt.contentId,hidden:!Bt,...$,ref:Et,style:{"--radix-collapsible-content-height":At?`${At}px`:void 0,"--radix-collapsible-content-width":Vt?`${Vt}px`:void 0,...e.style},children:Bt&&_})});function getState$1(e){return e?"open":"closed"}var Root=Collapsible,Trigger$1=CollapsibleTrigger,Content=CollapsibleContent,DirectionContext=reactExports.createContext(void 0);function useDirection(e){const i=reactExports.useContext(DirectionContext);return e||i||"ltr"}var ACCORDION_NAME="Accordion",ACCORDION_KEYS=["Home","End","ArrowDown","ArrowUp","ArrowLeft","ArrowRight"],[Collection$1,useCollection$1,createCollectionScope$1]=createCollection(ACCORDION_NAME),[createAccordionContext,createAccordionScope]=createContextScope(ACCORDION_NAME,[createCollectionScope$1,createCollapsibleScope]),useCollapsibleScope=createCollapsibleScope(),Accordion$1=React.forwardRef((e,i)=>{const{type:s,...a}=e,_=a,$=a;return jsxRuntimeExports.jsx(Collection$1.Provider,{scope:e.__scopeAccordion,children:s==="multiple"?jsxRuntimeExports.jsx(AccordionImplMultiple,{...$,ref:i}):jsxRuntimeExports.jsx(AccordionImplSingle,{..._,ref:i})})});Accordion$1.displayName=ACCORDION_NAME;var[AccordionValueProvider,useAccordionValueContext]=createAccordionContext(ACCORDION_NAME),[AccordionCollapsibleProvider,useAccordionCollapsibleContext]=createAccordionContext(ACCORDION_NAME,{collapsible:!1}),AccordionImplSingle=React.forwardRef((e,i)=>{const{value:s,defaultValue:a,onValueChange:_=()=>{},collapsible:$=!1,...rt}=e,[c,dt]=useControllableState({prop:s,defaultProp:a??"",onChange:_,caller:ACCORDION_NAME});return jsxRuntimeExports.jsx(AccordionValueProvider,{scope:e.__scopeAccordion,value:React.useMemo(()=>c?[c]:[],[c]),onItemOpen:dt,onItemClose:React.useCallback(()=>$&&dt(""),[$,dt]),children:jsxRuntimeExports.jsx(AccordionCollapsibleProvider,{scope:e.__scopeAccordion,collapsible:$,children:jsxRuntimeExports.jsx(AccordionImpl,{...rt,ref:i})})})}),AccordionImplMultiple=React.forwardRef((e,i)=>{const{value:s,defaultValue:a,onValueChange:_=()=>{},...$}=e,[rt,c]=useControllableState({prop:s,defaultProp:a??[],onChange:_,caller:ACCORDION_NAME}),dt=React.useCallback(Et=>c((St=[])=>[...St,Et]),[c]),ht=React.useCallback(Et=>c((St=[])=>St.filter(At=>At!==Et)),[c]);return jsxRuntimeExports.jsx(AccordionValueProvider,{scope:e.__scopeAccordion,value:rt,onItemOpen:dt,onItemClose:ht,children:jsxRuntimeExports.jsx(AccordionCollapsibleProvider,{scope:e.__scopeAccordion,collapsible:!0,children:jsxRuntimeExports.jsx(AccordionImpl,{...$,ref:i})})})}),[AccordionImplProvider,useAccordionContext]=createAccordionContext(ACCORDION_NAME),AccordionImpl=React.forwardRef((e,i)=>{const{__scopeAccordion:s,disabled:a,dir:_,orientation:$="vertical",...rt}=e,c=React.useRef(null),dt=useComposedRefs$1(c,i),ht=useCollection$1(s),St=useDirection(_)==="ltr",At=composeEventHandlers(e.onKeyDown,Pt=>{var mr;if(!ACCORDION_KEYS.includes(Pt.key))return;const Vt=Pt.target,Bt=ht().filter(Rr=>{var on;return!((on=Rr.ref.current)!=null&&on.disabled)}),Zt=Bt.findIndex(Rr=>Rr.ref.current===Vt),zt=Bt.length;if(Zt===-1)return;Pt.preventDefault();let Ut=Zt;const Nt=0,Gt=zt-1,er=()=>{Ut=Zt+1,Ut>Gt&&(Ut=Nt)},ir=()=>{Ut=Zt-1,Ut<Nt&&(Ut=Gt)};switch(Pt.key){case"Home":Ut=Nt;break;case"End":Ut=Gt;break;case"ArrowRight":$==="horizontal"&&(St?er():ir());break;case"ArrowDown":$==="vertical"&&er();break;case"ArrowLeft":$==="horizontal"&&(St?ir():er());break;case"ArrowUp":$==="vertical"&&ir();break}const or=Ut%zt;(mr=Bt[or].ref.current)==null||mr.focus()});return jsxRuntimeExports.jsx(AccordionImplProvider,{scope:s,disabled:a,direction:_,orientation:$,children:jsxRuntimeExports.jsx(Collection$1.Slot,{scope:s,children:jsxRuntimeExports.jsx(Primitive.div,{...rt,"data-orientation":$,ref:dt,onKeyDown:a?void 0:At})})})}),ITEM_NAME$1="AccordionItem",[AccordionItemProvider,useAccordionItemContext]=createAccordionContext(ITEM_NAME$1),AccordionItem$1=React.forwardRef((e,i)=>{const{__scopeAccordion:s,value:a,..._}=e,$=useAccordionContext(ITEM_NAME$1,s),rt=useAccordionValueContext(ITEM_NAME$1,s),c=useCollapsibleScope(s),dt=useId(),ht=a&&rt.value.includes(a)||!1,Et=$.disabled||e.disabled;return jsxRuntimeExports.jsx(AccordionItemProvider,{scope:s,open:ht,disabled:Et,triggerId:dt,children:jsxRuntimeExports.jsx(Root,{"data-orientation":$.orientation,"data-state":getState(ht),...c,..._,ref:i,disabled:Et,open:ht,onOpenChange:St=>{St?rt.onItemOpen(a):rt.onItemClose(a)}})})});AccordionItem$1.displayName=ITEM_NAME$1;var HEADER_NAME="AccordionHeader",AccordionHeader=React.forwardRef((e,i)=>{const{__scopeAccordion:s,...a}=e,_=useAccordionContext(ACCORDION_NAME,s),$=useAccordionItemContext(HEADER_NAME,s);return jsxRuntimeExports.jsx(Primitive.h3,{"data-orientation":_.orientation,"data-state":getState($.open),"data-disabled":$.disabled?"":void 0,...a,ref:i})});AccordionHeader.displayName=HEADER_NAME;var TRIGGER_NAME$1="AccordionTrigger",AccordionTrigger$1=React.forwardRef((e,i)=>{const{__scopeAccordion:s,...a}=e,_=useAccordionContext(ACCORDION_NAME,s),$=useAccordionItemContext(TRIGGER_NAME$1,s),rt=useAccordionCollapsibleContext(TRIGGER_NAME$1,s),c=useCollapsibleScope(s);return jsxRuntimeExports.jsx(Collection$1.ItemSlot,{scope:s,children:jsxRuntimeExports.jsx(Trigger$1,{"aria-disabled":$.open&&!rt.collapsible||void 0,"data-orientation":_.orientation,id:$.triggerId,...c,...a,ref:i})})});AccordionTrigger$1.displayName=TRIGGER_NAME$1;var CONTENT_NAME$1="AccordionContent",AccordionContent$1=React.forwardRef((e,i)=>{const{__scopeAccordion:s,...a}=e,_=useAccordionContext(ACCORDION_NAME,s),$=useAccordionItemContext(CONTENT_NAME$1,s),rt=useCollapsibleScope(s);return jsxRuntimeExports.jsx(Content,{role:"region","aria-labelledby":$.triggerId,"data-orientation":_.orientation,...rt,...a,ref:i,style:{"--radix-accordion-content-height":"var(--radix-collapsible-content-height)","--radix-accordion-content-width":"var(--radix-collapsible-content-width)",...e.style}})});AccordionContent$1.displayName=CONTENT_NAME$1;function getState(e){return e?"open":"closed"}var Root2$1=Accordion$1,Item$1=AccordionItem$1,Header=AccordionHeader,Trigger2=AccordionTrigger$1,Content2$1=AccordionContent$1;const Accordion=Root2$1,AccordionItem=reactExports.forwardRef(({className:e,...i},s)=>jsxRuntimeExports.jsx(Item$1,{ref:s,className:cn("border-b",e),...i}));AccordionItem.displayName="AccordionItem";const AccordionTrigger=reactExports.forwardRef(({className:e,children:i,...s},a)=>jsxRuntimeExports.jsx(Header,{className:"flex",children:jsxRuntimeExports.jsxs(Trigger2,{ref:a,className:cn("flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",e),...s,children:[i,jsxRuntimeExports.jsx(ChevronDown,{className:"h-4 w-4 shrink-0 transition-transform duration-200"})]})}));AccordionTrigger.displayName=Trigger2.displayName;const AccordionContent=reactExports.forwardRef(({className:e,children:i,...s},a)=>jsxRuntimeExports.jsx(Content2$1,{ref:a,className:"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...s,children:jsxRuntimeExports.jsx("div",{className:cn("pb-4 pt-0",e),children:i})}));AccordionContent.displayName=Content2$1.displayName;const faqs=[{question:"How do I place an order?",answer:"Browse kitchens near you, select dishes from the menu, add them to your cart, and proceed to checkout. You can pay using various payment methods including UPI, cards, and cash on delivery."},{question:"How can I track my order?",answer:"Once your order is placed, you can track it in real-time from the 'My Orders' section. You'll receive notifications at each stage - from acceptance to delivery."},{question:"What if I want to cancel my order?",answer:"You can cancel your order before it's accepted by the kitchen. Go to 'My Orders', select the order, and tap 'Cancel Order'. Once accepted, please contact support for cancellation."},{question:"How do refunds work?",answer:"Refunds are processed within 5-7 business days to your original payment method. For wallet credits, refunds are instant."},{question:"How do I become an Amma (Home Cook)?",answer:"Go to your Profile, tap 'Become an Amma', and follow the registration process. You'll need to provide your kitchen details, FSSAI license (if applicable), and complete verification."},{question:"What areas do you serve?",answer:"We currently serve in select cities. Enter your location on the home page to check if we deliver to your area. We're expanding rapidly!"},{question:"How do I apply a coupon?",answer:"At checkout, enter your coupon code in the 'Apply Discount Coupon' section and tap 'Apply'. Valid coupons will be applied to your order total."}],contactOptions=[{icon:MessageCircle,title:"Live Chat",subtitle:"Chat with our support team",action:"Start Chat",color:"text-primary",bgColor:"bg-primary/10"},{icon:Phone,title:"Call Us",subtitle:"+91 1800-XXX-XXXX",action:"Call Now",color:"text-green-600",bgColor:"bg-green-100"},{icon:Mail,title:"Email Support",subtitle:"support@ammacheythivanta.com",action:"Send Email",color:"text-gold",bgColor:"bg-gold/10"}];function HelpSupportPage(){return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-24",children:[jsxRuntimeExports.jsxs("div",{className:"bg-card border-b border-border px-4 py-4 flex items-center gap-4 sticky top-0 z-10",children:[jsxRuntimeExports.jsx(Link,{to:"/profile",children:jsxRuntimeExports.jsx(motion.div,{whileTap:{scale:.9},className:"p-2 -ml-2",children:jsxRuntimeExports.jsx(ArrowLeft,{className:"w-6 h-6 text-foreground"})})}),jsxRuntimeExports.jsx("h1",{className:"text-lg font-bold text-foreground",children:"Help & Support"})]}),jsxRuntimeExports.jsxs("div",{className:"p-4 space-y-4",children:[jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-card rounded-2xl shadow-elevated overflow-hidden",children:[jsxRuntimeExports.jsxs("div",{className:"p-4 border-b border-border",children:[jsxRuntimeExports.jsx("h2",{className:"font-semibold text-foreground",children:"Contact Us"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:"We're here to help 24/7"})]}),jsxRuntimeExports.jsx("div",{className:"divide-y divide-border",children:contactOptions.map((e,i)=>jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:i*.1},className:"flex items-center gap-4 p-4",children:[jsxRuntimeExports.jsx("div",{className:`w-12 h-12 rounded-xl ${e.bgColor} flex items-center justify-center ${e.color}`,children:jsxRuntimeExports.jsx(e.icon,{className:"w-6 h-6"})}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsx("p",{className:"font-medium text-foreground",children:e.title}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:e.subtitle})]}),jsxRuntimeExports.jsx(Button,{variant:"outline",size:"sm",className:"rounded-xl",children:e.action})]},e.title))})]}),jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"bg-card rounded-2xl shadow-elevated overflow-hidden",children:[jsxRuntimeExports.jsxs("div",{className:"p-4 border-b border-border",children:[jsxRuntimeExports.jsx("h2",{className:"font-semibold text-foreground",children:"Frequently Asked Questions"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:"Quick answers to common questions"})]}),jsxRuntimeExports.jsx(Accordion,{type:"single",collapsible:!0,className:"px-4",children:faqs.map((e,i)=>jsxRuntimeExports.jsxs(AccordionItem,{value:`item-${i}`,children:[jsxRuntimeExports.jsx(AccordionTrigger,{className:"text-left text-foreground hover:text-primary",children:e.question}),jsxRuntimeExports.jsx(AccordionContent,{className:"text-muted-foreground",children:e.answer})]},i))})]}),jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"bg-card rounded-2xl shadow-elevated overflow-hidden",children:[jsxRuntimeExports.jsx("div",{className:"p-4 border-b border-border",children:jsxRuntimeExports.jsx("h2",{className:"font-semibold text-foreground",children:"Quick Links"})}),jsxRuntimeExports.jsxs("div",{className:"divide-y divide-border",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-4 p-4",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-xl bg-secondary flex items-center justify-center text-muted-foreground",children:jsxRuntimeExports.jsx(FileText,{className:"w-5 h-5"})}),jsxRuntimeExports.jsx("span",{className:"flex-1 font-medium text-foreground",children:"Terms & Conditions"}),jsxRuntimeExports.jsx(ExternalLink,{className:"w-5 h-5 text-muted-foreground"})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-4 p-4",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-xl bg-secondary flex items-center justify-center text-muted-foreground",children:jsxRuntimeExports.jsx(FileText,{className:"w-5 h-5"})}),jsxRuntimeExports.jsx("span",{className:"flex-1 font-medium text-foreground",children:"Privacy Policy"}),jsxRuntimeExports.jsx(ExternalLink,{className:"w-5 h-5 text-muted-foreground"})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-4 p-4",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-xl bg-secondary flex items-center justify-center text-muted-foreground",children:jsxRuntimeExports.jsx(FileText,{className:"w-5 h-5"})}),jsxRuntimeExports.jsx("span",{className:"flex-1 font-medium text-foreground",children:"Refund Policy"}),jsxRuntimeExports.jsx(ExternalLink,{className:"w-5 h-5 text-muted-foreground"})]})]})]}),jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"bg-gradient-to-br from-primary/10 to-gold/10 rounded-2xl p-6 text-center",children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-foreground mb-2",children:"Love our app?"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Rate us on the Play Store and help us improve!"}),jsxRuntimeExports.jsx(Button,{className:"rounded-xl px-6",children:"Rate Now "})]})]}),jsxRuntimeExports.jsx(BottomNav,{})]})}function SavedAddressesPage(){const{user:e,loading:i,updateUserLocation:s,deleteAddress:a}=useAuth(),_=useNavigate(),$=reactExports.useRef(null),rt=(ht,Et)=>{$.current=setTimeout(()=>{window.confirm("Delete this saved address?")&&a(ht,Et)},800)},c=()=>{$.current&&(clearTimeout($.current),$.current=null)},dt=async ht=>{try{await s(ht.lat,ht.lng,ht.line1||ht.city,ht.label)}catch(Et){console.error("Failed to set default address:",Et)}};return i?jsxRuntimeExports.jsx(LoadingAnimation,{}):e?jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background safe-top pb-24",children:[jsxRuntimeExports.jsx("div",{className:"sticky top-0 z-40 bg-card/95 backdrop-blur-lg border-b border-border",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-4 px-4 py-4",children:[jsxRuntimeExports.jsx(motion.div,{whileTap:{scale:.9},onClick:()=>_(-1),className:"w-10 h-10 rounded-full bg-secondary flex items-center justify-center cursor-pointer",children:jsxRuntimeExports.jsx(ArrowLeft,{className:"w-5 h-5"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h1",{className:"font-semibold text-foreground",children:"Saved Addresses"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:"Manage your delivery locations"})]})]})}),jsxRuntimeExports.jsxs("div",{className:"p-4 space-y-4",children:[e.savedAddresses&&e.savedAddresses.length>0?e.savedAddresses.filter((ht,Et,St)=>Et===St.findIndex(At=>At.line1&&ht.line1&&At.line1===ht.line1||At.lat===ht.lat&&At.lng===ht.lng)).map((ht,Et)=>{var St,At,Pt,Vt;return jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:Et*.1},className:"bg-card rounded-xl p-4 shadow-sm border border-border select-none",onTouchStart:()=>rt(ht.lat,ht.lng),onTouchEnd:c,onMouseDown:()=>rt(ht.lat,ht.lng),onMouseUp:c,onMouseLeave:c,onContextMenu:Bt=>Bt.preventDefault(),children:jsxRuntimeExports.jsxs("div",{className:"flex gap-4",onClick:()=>dt(ht),children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center shrink-0 cursor-pointer",children:ht.label==="work"?jsxRuntimeExports.jsx(Briefcase,{className:"w-5 h-5 text-primary"}):ht.label==="other"?jsxRuntimeExports.jsx(MapPin,{className:"w-5 h-5 text-primary"}):jsxRuntimeExports.jsx(House,{className:"w-5 h-5 text-primary"})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 cursor-pointer",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-start",children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-foreground capitalize",children:ht.label||(ht.line1?"Home":"Saved Location")}),((St=e.address)==null?void 0:St.lat)===ht.lat&&((At=e.address)==null?void 0:At.lng)===ht.lng&&jsxRuntimeExports.jsx("div",{className:"px-2 py-0.5 rounded text-[10px] font-bold bg-primary/10 text-primary uppercase tracking-wide",children:"Selected"})]}),jsxRuntimeExports.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:[ht.line1?jsxRuntimeExports.jsx("span",{className:"block",children:ht.line1}):jsxRuntimeExports.jsxs("span",{className:"block",children:[ht.pincode?`${ht.pincode}, `:"",ht.city]}),ht.line2&&jsxRuntimeExports.jsx("span",{className:"block",children:ht.line2})]}),((Pt=e.address)==null?void 0:Pt.lat)===ht.lat&&((Vt=e.address)==null?void 0:Vt.lng)===ht.lng&&jsxRuntimeExports.jsxs("div",{className:"mt-4 pt-4 border-t border-border",onClick:Bt=>Bt.stopPropagation(),children:[jsxRuntimeExports.jsx("p",{className:"text-xs font-medium text-muted-foreground mb-2",children:"Tag this location"}),jsxRuntimeExports.jsx("div",{className:"flex gap-2",children:["home","work","other"].map(Bt=>jsxRuntimeExports.jsxs("button",{onClick:()=>s(ht.lat,ht.lng,ht.line1||ht.city,Bt),className:`flex items-center gap-1.5 px-3 py-1.5 rounded-full border text-xs transition-all ${ht.label===Bt?"bg-primary text-primary-foreground border-primary":"bg-background border-border text-muted-foreground hover:border-primary/50"}`,children:[Bt==="home"&&jsxRuntimeExports.jsx(House,{className:"w-3 h-3"}),Bt==="work"&&jsxRuntimeExports.jsx(Briefcase,{className:"w-3 h-3"}),Bt==="other"&&jsxRuntimeExports.jsx(MapPin,{className:"w-3 h-3"}),jsxRuntimeExports.jsx("span",{className:"capitalize",children:Bt})]},Bt))})]})]})]})},Et)}):e.address?jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"bg-card rounded-xl p-4 shadow-sm border border-border",children:jsxRuntimeExports.jsxs("div",{className:"flex gap-4",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center shrink-0",children:jsxRuntimeExports.jsx(House,{className:"w-5 h-5 text-primary"})}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-start",children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-foreground",children:"Home"}),jsxRuntimeExports.jsx("div",{className:"px-2 py-0.5 rounded text-[10px] font-bold bg-primary/10 text-primary uppercase tracking-wide",children:"Default"})]}),jsxRuntimeExports.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:[e.address.line1?jsxRuntimeExports.jsx("span",{className:"block",children:e.address.line1}):jsxRuntimeExports.jsxs("span",{className:"block",children:[e.address.pincode?`${e.address.pincode}, `:"",e.address.city]}),e.address.line2&&jsxRuntimeExports.jsx("span",{className:"block",children:e.address.line2})]})]})]})}):jsxRuntimeExports.jsxs("div",{className:"text-center py-12 bg-card rounded-xl border border-dashed border-border",children:[jsxRuntimeExports.jsx(MapPin,{className:"w-10 h-10 text-muted-foreground mx-auto mb-3"}),jsxRuntimeExports.jsx("p",{className:"text-muted-foreground mb-4",children:"No saved addresses found"}),jsxRuntimeExports.jsx(Button,{onClick:()=>_("/location-select"),children:"Add Address"})]}),jsxRuntimeExports.jsxs(Button,{variant:"ghost",className:"w-full flex items-center justify-center gap-2 py-6 border border-dashed border-border rounded-xl text-muted-foreground hover:text-primary hover:border-primary/50 hover:bg-primary/5 transition-all",onClick:()=>_("/location-select"),children:[jsxRuntimeExports.jsx(Plus,{className:"w-5 h-5"}),jsxRuntimeExports.jsx("span",{children:"Add New Address"})]})]})]}):jsxRuntimeExports.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center bg-background px-4",children:[jsxRuntimeExports.jsx(MapPin,{className:"w-16 h-16 text-muted-foreground mb-4"}),jsxRuntimeExports.jsx("h1",{className:"text-xl font-bold mb-2",children:"Login Required"}),jsxRuntimeExports.jsx("p",{className:"text-muted-foreground text-center mb-6",children:"Please login to manage your saved addresses"}),jsxRuntimeExports.jsx(Link,{to:"/auth",children:jsxRuntimeExports.jsx(Button,{className:"gradient-primary text-primary-foreground",children:"Login Now"})})]})}function FavoritesPage(){const{user:e,loading:i}=useAuth(),{kitchens:s,loading:a}=useKitchens();if(useLocationContext(),i||a)return jsxRuntimeExports.jsx(LoadingAnimation,{});if(!e)return jsxRuntimeExports.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center bg-background px-4",children:[jsxRuntimeExports.jsx(Heart,{className:"w-16 h-16 text-muted-foreground mb-4"}),jsxRuntimeExports.jsx("h1",{className:"text-xl font-bold mb-2",children:"Login Required"}),jsxRuntimeExports.jsx("p",{className:"text-muted-foreground text-center mb-6",children:"Please login to view your favorite kitchens"}),jsxRuntimeExports.jsx(Link,{to:"/auth",children:jsxRuntimeExports.jsx(Button,{className:"gradient-primary text-primary-foreground",children:"Login Now"})})]});const _=s.filter($=>{var rt;return(rt=e.favorites)==null?void 0:rt.includes($.id)});return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background safe-top pb-24",children:[jsxRuntimeExports.jsx("div",{className:"sticky top-0 z-40 bg-background/80 backdrop-blur-lg border-b border-border",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3 px-4 py-3",children:[jsxRuntimeExports.jsx(Link,{to:"/",children:jsxRuntimeExports.jsx(Button,{variant:"ghost",size:"icon",className:"h-10 w-10 -ml-2 rounded-full hover:bg-muted",children:jsxRuntimeExports.jsx(ArrowLeft,{className:"w-6 h-6"})})}),jsxRuntimeExports.jsx("h1",{className:"text-xl font-bold text-foreground",children:"My Favorites"})]})}),jsxRuntimeExports.jsx("div",{className:"p-4",children:_.length>0?jsxRuntimeExports.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:_.map(($,rt)=>jsxRuntimeExports.jsx(KitchenCard,{kitchen:$,index:rt},$.id))}):jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-center",children:[jsxRuntimeExports.jsx("div",{className:"w-20 h-20 rounded-full bg-muted flex items-center justify-center mb-4",children:jsxRuntimeExports.jsx(Heart,{className:"w-8 h-8 text-muted-foreground"})}),jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold text-foreground mb-2",children:"No favorites yet"}),jsxRuntimeExports.jsx("p",{className:"text-muted-foreground mb-6 max-w-xs",children:"Start exploring kitchens and save your favorites here for quick access!"}),jsxRuntimeExports.jsx(Link,{to:"/",children:jsxRuntimeExports.jsx(Button,{className:"gradient-primary text-primary-foreground shadow-elevated",children:"Explore Kitchens"})})]})})]})}function SearchPage(){const[e,i]=reactExports.useState(""),[s,a]=reactExports.useState(null),{kitchens:_,loading:$}=useKitchens(),rt=[{id:"veg",label:"Veg",icon:Leaf},{id:"biryani",label:"Biryani",emoji:""},{id:"tiffin",label:"Tiffins",emoji:""},{id:"meals",label:"Meals",emoji:""},{id:"sweets",label:"Sweets",emoji:""}],c=_.filter(dt=>{const ht=!e||dt.name.toLowerCase().includes(e.toLowerCase())||dt.specialties.some(St=>St.toLowerCase().includes(e.toLowerCase())),Et=!s||s==="veg"&&dt.isVeg||dt.specialties.some(St=>St.toLowerCase().includes(s.toLowerCase()));return ht&&Et});return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-24",children:[jsxRuntimeExports.jsxs("header",{className:"sticky top-0 z-40 bg-card/95 backdrop-blur-lg border-b border-border px-4 py-4",children:[jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx(Search,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-muted-foreground"}),jsxRuntimeExports.jsx("input",{type:"text",value:e,onChange:dt=>i(dt.target.value),placeholder:"Search dishes, kitchens...",className:"w-full pl-12 pr-4 py-3 rounded-xl bg-secondary border-0 text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary/20",autoFocus:!0})]}),jsxRuntimeExports.jsx("div",{className:"flex gap-2 mt-4 overflow-x-auto hide-scrollbar",children:rt.map(dt=>jsxRuntimeExports.jsxs(motion.button,{whileTap:{scale:.95},onClick:()=>a(s===dt.id?null:dt.id),className:`flex items-center gap-1.5 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors ${s===dt.id?"gradient-primary text-primary-foreground":"bg-secondary text-secondary-foreground"}`,children:[dt.icon?jsxRuntimeExports.jsx(dt.icon,{className:"w-4 h-4"}):jsxRuntimeExports.jsx("span",{children:dt.emoji}),dt.label]},dt.id))})]}),!e&&jsxRuntimeExports.jsxs("div",{className:"px-4 py-4",children:[jsxRuntimeExports.jsx("h3",{className:"text-sm font-semibold text-muted-foreground uppercase tracking-wide mb-3",children:"Popular Searches"}),jsxRuntimeExports.jsx("div",{className:"flex flex-wrap gap-2",children:["Biryani","Idli Dosa","Thali","Chicken Curry","Pickles"].map(dt=>jsxRuntimeExports.jsx(motion.button,{whileTap:{scale:.95},onClick:()=>i(dt),className:"px-4 py-2 rounded-full bg-secondary text-secondary-foreground text-sm",children:dt},dt))})]}),jsxRuntimeExports.jsx("div",{className:"px-4 py-4",children:$?jsxRuntimeExports.jsx("div",{className:"flex items-center justify-center py-12",children:jsxRuntimeExports.jsx(LoaderCircle,{className:"w-8 h-8 animate-spin text-primary"})}):c.length===0?jsxRuntimeExports.jsx("div",{className:"text-center py-12",children:jsxRuntimeExports.jsx("p",{className:"text-muted-foreground",children:"No kitchens found"})}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("p",{className:"text-sm text-muted-foreground mb-4",children:[c.length," kitchens found"]}),jsxRuntimeExports.jsx("div",{className:"space-y-4",children:c.map((dt,ht)=>jsxRuntimeExports.jsx(KitchenCard,{kitchen:dt,index:ht},dt.id))})]})}),jsxRuntimeExports.jsx(BottomNav,{})]})}function OrderReviewForm({order:e,onClose:i,onSuccess:s}){const[a,_]=reactExports.useState(0),[$,rt]=reactExports.useState({}),[c,dt]=reactExports.useState(""),[ht,Et]=reactExports.useState(!1),St=async()=>{if(a===0){ue.error("Please rate the kitchen");return}Et(!0);try{await submitReview({orderId:e.id,kitchenId:e.kitchenId,userId:e.userId,userName:"User",kitchenRating:a,itemRatings:$,comment:c,createdAt:Date.now()}),ue.success("Review submitted successfully!"),s()}catch(Pt){console.error(Pt),ue.error("Failed to submit review")}Et(!1)},At=(Pt,Vt)=>{rt(Bt=>({...Bt,[Pt]:Vt}))};return jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"border-t border-border mt-4 pt-4",children:jsxRuntimeExports.jsxs("div",{className:"space-y-6",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-foreground",children:"Rate Your Experience"}),jsxRuntimeExports.jsx(Button,{variant:"ghost",size:"sm",onClick:i,className:"h-8 text-xs",children:"Cancel"})]}),jsxRuntimeExports.jsxs("div",{className:"text-center bg-secondary/20 rounded-xl p-4",children:[jsxRuntimeExports.jsx("h3",{className:"font-medium text-sm mb-1",children:e.kitchenName}),jsxRuntimeExports.jsx("div",{className:"flex justify-center gap-2 mt-2",children:[1,2,3,4,5].map(Pt=>jsxRuntimeExports.jsx("button",{onClick:()=>_(Pt),className:"transition-transform hover:scale-110 focus:outline-none",children:jsxRuntimeExports.jsx(Star,{className:cn("w-8 h-8",Pt<=a?"fill-gold text-gold":"text-muted-foreground/30")})},Pt))})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsx("h4",{className:"font-medium text-xs text-muted-foreground uppercase tracking-wider",children:"Rate Items"}),e.items.map((Pt,Vt)=>jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center bg-secondary/20 rounded-lg p-3",children:[jsxRuntimeExports.jsx("span",{className:"font-medium text-sm",children:Pt.dish.name}),jsxRuntimeExports.jsx("div",{className:"flex gap-1",children:[1,2,3,4,5].map(Bt=>jsxRuntimeExports.jsx("button",{onClick:()=>At(Pt.dish.id,Bt),className:"focus:outline-none",children:jsxRuntimeExports.jsx(Star,{className:cn("w-4 h-4",Bt<=($[Pt.dish.id]||0)?"fill-gold text-gold":"text-muted-foreground/30")})},Bt))})]},Vt))]}),jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsx(Input,{placeholder:"Tell us more about your experience...",value:c,onChange:Pt=>dt(Pt.target.value),className:"bg-secondary/20 border-0"})}),jsxRuntimeExports.jsx(Button,{className:"w-full gradient-primary text-primary-foreground",onClick:St,disabled:ht,children:ht?"Submitting...":"Submit Review"})]})})}const statusConfig$1={pending:{label:"Order Placed",color:"text-muted-foreground",icon:Clock},accepted:{label:"Accepted",color:"text-gold",icon:Check},cooking:{label:"Cooking",color:"text-primary",icon:ChefHat},packed:{label:"Ready",color:"text-accent",icon:Package},out_for_delivery:{label:"On the way",color:"text-accent",icon:Truck},delivered:{label:"Delivered",color:"text-accent",icon:Check},cancelled:{label:"Cancelled",color:"text-destructive",icon:Clock}};function OrdersPage(){const{user:e}=useAuth(),{orders:i,loading:s,error:a}=useUserOrders(e==null?void 0:e.id),[_,$]=reactExports.useState("active"),[rt,c]=reactExports.useState(null),[dt,ht]=reactExports.useState(!1),Et=i.filter(Pt=>!["delivered","cancelled"].includes(Pt.status)),St=i.filter(Pt=>["delivered","cancelled"].includes(Pt.status)),At=()=>{ht(!0),setTimeout(()=>{ht(!1)},1e3)};return e?jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-24",children:[jsxRuntimeExports.jsxs("header",{className:"sticky top-0 z-40 bg-card/95 backdrop-blur-lg border-b border-border px-4 py-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsx("h1",{className:"text-xl font-bold text-foreground",children:"My Orders"}),jsxRuntimeExports.jsx(Button,{variant:"ghost",size:"icon",onClick:At,className:"rounded-full hover:bg-secondary",children:jsxRuntimeExports.jsx(RefreshCw,{className:cn("w-5 h-5 text-muted-foreground",dt&&"animate-spin text-primary")})})]}),jsxRuntimeExports.jsx("div",{className:"flex bg-secondary rounded-xl p-1 mt-4",children:["active","past"].map(Pt=>jsxRuntimeExports.jsx("button",{onClick:()=>$(Pt),className:`flex-1 py-2 rounded-lg text-sm font-medium transition-all ${_===Pt?"bg-card text-foreground shadow-soft":"text-muted-foreground"}`,children:Pt==="active"?"Active":"Past Orders"},Pt))})]}),jsxRuntimeExports.jsxs("div",{className:"px-4 py-4 space-y-4",children:[s?jsxRuntimeExports.jsx("div",{className:"flex items-center justify-center py-12",children:jsxRuntimeExports.jsx(LoaderCircle,{className:"w-8 h-8 animate-spin text-primary"})}):a?jsxRuntimeExports.jsx("div",{className:"text-center py-12",children:jsxRuntimeExports.jsx("p",{className:"text-destructive",children:a})}):(_==="active"?Et:St).map((Pt,Vt)=>{const Bt=statusConfig$1[Pt.status],Zt=Bt.icon,zt=Pt.isReviewed;return jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:Vt*.1},className:"bg-card rounded-2xl p-4 shadow-card",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-start justify-between mb-3",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-foreground",children:Pt.kitchenName}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-muted-foreground",children:["#",Pt.id.slice(-8)]})]}),jsxRuntimeExports.jsxs("div",{className:cn("flex items-center gap-1 px-2 py-1 rounded-full bg-secondary",Bt.color),children:[jsxRuntimeExports.jsx(Zt,{className:"w-3 h-3"}),jsxRuntimeExports.jsx("span",{className:"text-xs font-medium",children:Bt.label})]})]}),jsxRuntimeExports.jsx("div",{className:"text-sm text-muted-foreground mb-3",children:Pt.items.map((Ut,Nt)=>jsxRuntimeExports.jsxs("span",{children:[Ut.dish.name," x",Ut.quantity,Nt<Pt.items.length-1&&", "]},Nt))}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-border",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("span",{className:"font-semibold text-foreground",children:["",Pt.totalAmount]}),Pt.estimatedDelivery&&jsxRuntimeExports.jsxs("p",{className:"text-sm text-muted-foreground",children:["ETA: ",Pt.estimatedDelivery]})]}),Pt.status==="delivered"&&jsxRuntimeExports.jsx(Button,{size:"sm",variant:zt?"ghost":"outline",className:zt?"text-muted-foreground cursor-default":"border-gold text-gold hover:bg-gold/10",onClick:()=>{zt||c(rt===Pt.id?null:Pt.id)},disabled:zt&&rt!==Pt.id,children:zt?"Reviewed":"Review Order"})]}),!zt&&rt===Pt.id&&jsxRuntimeExports.jsx(OrderReviewForm,{order:Pt,onClose:()=>c(null),onSuccess:()=>c(null)}),!["delivered","cancelled"].includes(Pt.status)&&jsxRuntimeExports.jsx("div",{className:"mt-4 pt-4 border-t border-border",children:jsxRuntimeExports.jsx("div",{className:"flex items-center justify-between",children:["accepted","cooking","packed","out_for_delivery"].map((Ut,Nt)=>{const Gt=statusConfig$1[Ut],er=Gt.icon,ir=["pending","accepted","cooking","packed","out_for_delivery"],or=ir.indexOf(Pt.status),mr=ir.indexOf(Ut),Rr=or>=mr;return jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center gap-1",children:[jsxRuntimeExports.jsx("div",{className:cn("w-8 h-8 rounded-full flex items-center justify-center transition-all",Rr?"bg-primary text-primary-foreground":"bg-secondary text-muted-foreground"),children:jsxRuntimeExports.jsx(er,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx("span",{className:cn("text-[10px]",Rr?"text-foreground":"text-muted-foreground"),children:Gt.label})]},Ut)})})})]},Pt.id)}),!s&&(_==="active"?Et:St).length===0&&jsxRuntimeExports.jsxs("div",{className:"text-center py-12",children:[jsxRuntimeExports.jsx(Package,{className:"w-12 h-12 text-muted-foreground mx-auto mb-3"}),jsxRuntimeExports.jsx("p",{className:"text-muted-foreground",children:_==="active"?"No active orders":"No past orders"})]})]}),jsxRuntimeExports.jsx(BottomNav,{})]}):jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background flex flex-col items-center justify-center px-4 pb-24",children:[jsxRuntimeExports.jsx(Package,{className:"w-16 h-16 text-muted-foreground mb-4"}),jsxRuntimeExports.jsx("p",{className:"text-muted-foreground mb-4",children:"Please login to view orders"}),jsxRuntimeExports.jsx(Link,{to:"/auth",children:jsxRuntimeExports.jsx(Button,{className:"gradient-primary text-primary-foreground",children:"Login"})}),jsxRuntimeExports.jsx(BottomNav,{})]})}var jsQR$1={exports:{}};(function(e,i){(function(a,_){e.exports=_()})(typeof self<"u"?self:commonjsGlobal,function(){return function(s){var a={};function _($){if(a[$])return a[$].exports;var rt=a[$]={i:$,l:!1,exports:{}};return s[$].call(rt.exports,rt,rt.exports,_),rt.l=!0,rt.exports}return _.m=s,_.c=a,_.d=function($,rt,c){_.o($,rt)||Object.defineProperty($,rt,{configurable:!1,enumerable:!0,get:c})},_.n=function($){var rt=$&&$.__esModule?function(){return $.default}:function(){return $};return _.d(rt,"a",rt),rt},_.o=function($,rt){return Object.prototype.hasOwnProperty.call($,rt)},_.p="",_(_.s=3)}([function(s,a,_){Object.defineProperty(a,"__esModule",{value:!0});var $=function(){function rt(c,dt){this.width=dt,this.height=c.length/dt,this.data=c}return rt.createEmpty=function(c,dt){return new rt(new Uint8ClampedArray(c*dt),c)},rt.prototype.get=function(c,dt){return c<0||c>=this.width||dt<0||dt>=this.height?!1:!!this.data[dt*this.width+c]},rt.prototype.set=function(c,dt,ht){this.data[dt*this.width+c]=ht?1:0},rt.prototype.setRegion=function(c,dt,ht,Et,St){for(var At=dt;At<dt+Et;At++)for(var Pt=c;Pt<c+ht;Pt++)this.set(Pt,At,!!St)},rt}();a.BitMatrix=$},function(s,a,_){Object.defineProperty(a,"__esModule",{value:!0});var $=_(2);function rt(dt,ht){return dt^ht}a.addOrSubtractGF=rt;var c=function(){function dt(ht,Et,St){this.primitive=ht,this.size=Et,this.generatorBase=St,this.expTable=new Array(this.size),this.logTable=new Array(this.size);for(var At=1,Pt=0;Pt<this.size;Pt++)this.expTable[Pt]=At,At=At*2,At>=this.size&&(At=(At^this.primitive)&this.size-1);for(var Pt=0;Pt<this.size-1;Pt++)this.logTable[this.expTable[Pt]]=Pt;this.zero=new $.default(this,Uint8ClampedArray.from([0])),this.one=new $.default(this,Uint8ClampedArray.from([1]))}return dt.prototype.multiply=function(ht,Et){return ht===0||Et===0?0:this.expTable[(this.logTable[ht]+this.logTable[Et])%(this.size-1)]},dt.prototype.inverse=function(ht){if(ht===0)throw new Error("Can't invert 0");return this.expTable[this.size-this.logTable[ht]-1]},dt.prototype.buildMonomial=function(ht,Et){if(ht<0)throw new Error("Invalid monomial degree less than 0");if(Et===0)return this.zero;var St=new Uint8ClampedArray(ht+1);return St[0]=Et,new $.default(this,St)},dt.prototype.log=function(ht){if(ht===0)throw new Error("Can't take log(0)");return this.logTable[ht]},dt.prototype.exp=function(ht){return this.expTable[ht]},dt}();a.default=c},function(s,a,_){Object.defineProperty(a,"__esModule",{value:!0});var $=_(1),rt=function(){function c(dt,ht){if(ht.length===0)throw new Error("No coefficients.");this.field=dt;var Et=ht.length;if(Et>1&&ht[0]===0){for(var St=1;St<Et&&ht[St]===0;)St++;if(St===Et)this.coefficients=dt.zero.coefficients;else{this.coefficients=new Uint8ClampedArray(Et-St);for(var At=0;At<this.coefficients.length;At++)this.coefficients[At]=ht[St+At]}}else this.coefficients=ht}return c.prototype.degree=function(){return this.coefficients.length-1},c.prototype.isZero=function(){return this.coefficients[0]===0},c.prototype.getCoefficient=function(dt){return this.coefficients[this.coefficients.length-1-dt]},c.prototype.addOrSubtract=function(dt){var ht;if(this.isZero())return dt;if(dt.isZero())return this;var Et=this.coefficients,St=dt.coefficients;Et.length>St.length&&(ht=[St,Et],Et=ht[0],St=ht[1]);for(var At=new Uint8ClampedArray(St.length),Pt=St.length-Et.length,Vt=0;Vt<Pt;Vt++)At[Vt]=St[Vt];for(var Vt=Pt;Vt<St.length;Vt++)At[Vt]=$.addOrSubtractGF(Et[Vt-Pt],St[Vt]);return new c(this.field,At)},c.prototype.multiply=function(dt){if(dt===0)return this.field.zero;if(dt===1)return this;for(var ht=this.coefficients.length,Et=new Uint8ClampedArray(ht),St=0;St<ht;St++)Et[St]=this.field.multiply(this.coefficients[St],dt);return new c(this.field,Et)},c.prototype.multiplyPoly=function(dt){if(this.isZero()||dt.isZero())return this.field.zero;for(var ht=this.coefficients,Et=ht.length,St=dt.coefficients,At=St.length,Pt=new Uint8ClampedArray(Et+At-1),Vt=0;Vt<Et;Vt++)for(var Bt=ht[Vt],Zt=0;Zt<At;Zt++)Pt[Vt+Zt]=$.addOrSubtractGF(Pt[Vt+Zt],this.field.multiply(Bt,St[Zt]));return new c(this.field,Pt)},c.prototype.multiplyByMonomial=function(dt,ht){if(dt<0)throw new Error("Invalid degree less than 0");if(ht===0)return this.field.zero;for(var Et=this.coefficients.length,St=new Uint8ClampedArray(Et+dt),At=0;At<Et;At++)St[At]=this.field.multiply(this.coefficients[At],ht);return new c(this.field,St)},c.prototype.evaluateAt=function(dt){var ht=0;if(dt===0)return this.getCoefficient(0);var Et=this.coefficients.length;if(dt===1)return this.coefficients.forEach(function(At){ht=$.addOrSubtractGF(ht,At)}),ht;ht=this.coefficients[0];for(var St=1;St<Et;St++)ht=$.addOrSubtractGF(this.field.multiply(dt,ht),this.coefficients[St]);return ht},c}();a.default=rt},function(s,a,_){Object.defineProperty(a,"__esModule",{value:!0});var $=_(4),rt=_(5),c=_(11),dt=_(12);function ht(At){var Pt=dt.locate(At);if(!Pt)return null;for(var Vt=0,Bt=Pt;Vt<Bt.length;Vt++){var Zt=Bt[Vt],zt=c.extract(At,Zt),Ut=rt.decode(zt.matrix);if(Ut)return{binaryData:Ut.bytes,data:Ut.text,chunks:Ut.chunks,version:Ut.version,location:{topRightCorner:zt.mappingFunction(Zt.dimension,0),topLeftCorner:zt.mappingFunction(0,0),bottomRightCorner:zt.mappingFunction(Zt.dimension,Zt.dimension),bottomLeftCorner:zt.mappingFunction(0,Zt.dimension),topRightFinderPattern:Zt.topRight,topLeftFinderPattern:Zt.topLeft,bottomLeftFinderPattern:Zt.bottomLeft,bottomRightAlignmentPattern:Zt.alignmentPattern}}}return null}var Et={inversionAttempts:"attemptBoth"};function St(At,Pt,Vt,Bt){Bt===void 0&&(Bt={});var Zt=Et;Object.keys(Zt||{}).forEach(function(or){Zt[or]=Bt[or]||Zt[or]});var zt=Zt.inversionAttempts==="attemptBoth"||Zt.inversionAttempts==="invertFirst",Ut=Zt.inversionAttempts==="onlyInvert"||Zt.inversionAttempts==="invertFirst",Nt=$.binarize(At,Pt,Vt,zt),Gt=Nt.binarized,er=Nt.inverted,ir=ht(Ut?er:Gt);return!ir&&(Zt.inversionAttempts==="attemptBoth"||Zt.inversionAttempts==="invertFirst")&&(ir=ht(Ut?Gt:er)),ir}St.default=St,a.default=St},function(s,a,_){Object.defineProperty(a,"__esModule",{value:!0});var $=_(0),rt=8,c=24;function dt(St,At,Pt){return St<At?At:St>Pt?Pt:St}var ht=function(){function St(At,Pt){this.width=At,this.data=new Uint8ClampedArray(At*Pt)}return St.prototype.get=function(At,Pt){return this.data[Pt*this.width+At]},St.prototype.set=function(At,Pt,Vt){this.data[Pt*this.width+At]=Vt},St}();function Et(St,At,Pt,Vt){if(St.length!==At*Pt*4)throw new Error("Malformed data passed to binarizer.");for(var Bt=new ht(At,Pt),Zt=0;Zt<At;Zt++)for(var zt=0;zt<Pt;zt++){var Ut=St[(zt*At+Zt)*4+0],Nt=St[(zt*At+Zt)*4+1],Gt=St[(zt*At+Zt)*4+2];Bt.set(Zt,zt,.2126*Ut+.7152*Nt+.0722*Gt)}for(var er=Math.ceil(At/rt),ir=Math.ceil(Pt/rt),or=new ht(er,ir),mr=0;mr<ir;mr++)for(var Rr=0;Rr<er;Rr++){for(var on=0,un=1/0,jr=0,zt=0;zt<rt;zt++)for(var Zt=0;Zt<rt;Zt++){var Jr=Bt.get(Rr*rt+Zt,mr*rt+zt);on+=Jr,un=Math.min(un,Jr),jr=Math.max(jr,Jr)}var fn=on/Math.pow(rt,2);if(jr-un<=c&&(fn=un/2,mr>0&&Rr>0)){var Fr=(or.get(Rr,mr-1)+2*or.get(Rr-1,mr)+or.get(Rr-1,mr-1))/4;un<Fr&&(fn=Fr)}or.set(Rr,mr,fn)}var Cr=$.BitMatrix.createEmpty(At,Pt),Sr=null;Vt&&(Sr=$.BitMatrix.createEmpty(At,Pt));for(var mr=0;mr<ir;mr++)for(var Rr=0;Rr<er;Rr++){for(var dr=dt(Rr,2,er-3),gr=dt(mr,2,ir-3),on=0,qr=-2;qr<=2;qr++)for(var Lr=-2;Lr<=2;Lr++)on+=or.get(dr+qr,gr+Lr);for(var _n=on/25,qr=0;qr<rt;qr++)for(var Lr=0;Lr<rt;Lr++){var Zt=Rr*rt+qr,zt=mr*rt+Lr,gn=Bt.get(Zt,zt);Cr.set(Zt,zt,gn<=_n),Vt&&Sr.set(Zt,zt,!(gn<=_n))}}return Vt?{binarized:Cr,inverted:Sr}:{binarized:Cr}}a.binarize=Et},function(s,a,_){Object.defineProperty(a,"__esModule",{value:!0});var $=_(0),rt=_(6),c=_(9),dt=_(10);function ht(Gt,er){for(var ir=Gt^er,or=0;ir;)or++,ir&=ir-1;return or}function Et(Gt,er){return er<<1|Gt}var St=[{bits:21522,formatInfo:{errorCorrectionLevel:1,dataMask:0}},{bits:20773,formatInfo:{errorCorrectionLevel:1,dataMask:1}},{bits:24188,formatInfo:{errorCorrectionLevel:1,dataMask:2}},{bits:23371,formatInfo:{errorCorrectionLevel:1,dataMask:3}},{bits:17913,formatInfo:{errorCorrectionLevel:1,dataMask:4}},{bits:16590,formatInfo:{errorCorrectionLevel:1,dataMask:5}},{bits:20375,formatInfo:{errorCorrectionLevel:1,dataMask:6}},{bits:19104,formatInfo:{errorCorrectionLevel:1,dataMask:7}},{bits:30660,formatInfo:{errorCorrectionLevel:0,dataMask:0}},{bits:29427,formatInfo:{errorCorrectionLevel:0,dataMask:1}},{bits:32170,formatInfo:{errorCorrectionLevel:0,dataMask:2}},{bits:30877,formatInfo:{errorCorrectionLevel:0,dataMask:3}},{bits:26159,formatInfo:{errorCorrectionLevel:0,dataMask:4}},{bits:25368,formatInfo:{errorCorrectionLevel:0,dataMask:5}},{bits:27713,formatInfo:{errorCorrectionLevel:0,dataMask:6}},{bits:26998,formatInfo:{errorCorrectionLevel:0,dataMask:7}},{bits:5769,formatInfo:{errorCorrectionLevel:3,dataMask:0}},{bits:5054,formatInfo:{errorCorrectionLevel:3,dataMask:1}},{bits:7399,formatInfo:{errorCorrectionLevel:3,dataMask:2}},{bits:6608,formatInfo:{errorCorrectionLevel:3,dataMask:3}},{bits:1890,formatInfo:{errorCorrectionLevel:3,dataMask:4}},{bits:597,formatInfo:{errorCorrectionLevel:3,dataMask:5}},{bits:3340,formatInfo:{errorCorrectionLevel:3,dataMask:6}},{bits:2107,formatInfo:{errorCorrectionLevel:3,dataMask:7}},{bits:13663,formatInfo:{errorCorrectionLevel:2,dataMask:0}},{bits:12392,formatInfo:{errorCorrectionLevel:2,dataMask:1}},{bits:16177,formatInfo:{errorCorrectionLevel:2,dataMask:2}},{bits:14854,formatInfo:{errorCorrectionLevel:2,dataMask:3}},{bits:9396,formatInfo:{errorCorrectionLevel:2,dataMask:4}},{bits:8579,formatInfo:{errorCorrectionLevel:2,dataMask:5}},{bits:11994,formatInfo:{errorCorrectionLevel:2,dataMask:6}},{bits:11245,formatInfo:{errorCorrectionLevel:2,dataMask:7}}],At=[function(Gt){return(Gt.y+Gt.x)%2===0},function(Gt){return Gt.y%2===0},function(Gt){return Gt.x%3===0},function(Gt){return(Gt.y+Gt.x)%3===0},function(Gt){return(Math.floor(Gt.y/2)+Math.floor(Gt.x/3))%2===0},function(Gt){return Gt.x*Gt.y%2+Gt.x*Gt.y%3===0},function(Gt){return(Gt.y*Gt.x%2+Gt.y*Gt.x%3)%2===0},function(Gt){return((Gt.y+Gt.x)%2+Gt.y*Gt.x%3)%2===0}];function Pt(Gt){var er=17+4*Gt.versionNumber,ir=$.BitMatrix.createEmpty(er,er);ir.setRegion(0,0,9,9,!0),ir.setRegion(er-8,0,8,9,!0),ir.setRegion(0,er-8,9,8,!0);for(var or=0,mr=Gt.alignmentPatternCenters;or<mr.length;or++)for(var Rr=mr[or],on=0,un=Gt.alignmentPatternCenters;on<un.length;on++){var jr=un[on];Rr===6&&jr===6||Rr===6&&jr===er-7||Rr===er-7&&jr===6||ir.setRegion(Rr-2,jr-2,5,5,!0)}return ir.setRegion(6,9,1,er-17,!0),ir.setRegion(9,6,er-17,1,!0),Gt.versionNumber>6&&(ir.setRegion(er-11,0,3,6,!0),ir.setRegion(0,er-11,6,3,!0)),ir}function Vt(Gt,er,ir){for(var or=At[ir.dataMask],mr=Gt.height,Rr=Pt(er),on=[],un=0,jr=0,Jr=!0,fn=mr-1;fn>0;fn-=2){fn===6&&fn--;for(var Fr=0;Fr<mr;Fr++)for(var Cr=Jr?mr-1-Fr:Fr,Sr=0;Sr<2;Sr++){var dr=fn-Sr;if(!Rr.get(dr,Cr)){jr++;var gr=Gt.get(dr,Cr);or({y:Cr,x:dr})&&(gr=!gr),un=Et(gr,un),jr===8&&(on.push(un),jr=0,un=0)}}Jr=!Jr}return on}function Bt(Gt){var er=Gt.height,ir=Math.floor((er-17)/4);if(ir<=6)return dt.VERSIONS[ir-1];for(var or=0,mr=5;mr>=0;mr--)for(var Rr=er-9;Rr>=er-11;Rr--)or=Et(Gt.get(Rr,mr),or);for(var on=0,Rr=5;Rr>=0;Rr--)for(var mr=er-9;mr>=er-11;mr--)on=Et(Gt.get(Rr,mr),on);for(var un=1/0,jr,Jr=0,fn=dt.VERSIONS;Jr<fn.length;Jr++){var Fr=fn[Jr];if(Fr.infoBits===or||Fr.infoBits===on)return Fr;var Cr=ht(or,Fr.infoBits);Cr<un&&(jr=Fr,un=Cr),Cr=ht(on,Fr.infoBits),Cr<un&&(jr=Fr,un=Cr)}if(un<=3)return jr}function Zt(Gt){for(var er=0,ir=0;ir<=8;ir++)ir!==6&&(er=Et(Gt.get(ir,8),er));for(var or=7;or>=0;or--)or!==6&&(er=Et(Gt.get(8,or),er));for(var mr=Gt.height,Rr=0,or=mr-1;or>=mr-7;or--)Rr=Et(Gt.get(8,or),Rr);for(var ir=mr-8;ir<mr;ir++)Rr=Et(Gt.get(ir,8),Rr);for(var on=1/0,un=null,jr=0,Jr=St;jr<Jr.length;jr++){var fn=Jr[jr],Fr=fn.bits,Cr=fn.formatInfo;if(Fr===er||Fr===Rr)return Cr;var Sr=ht(er,Fr);Sr<on&&(un=Cr,on=Sr),er!==Rr&&(Sr=ht(Rr,Fr),Sr<on&&(un=Cr,on=Sr))}return on<=3?un:null}function zt(Gt,er,ir){var or=er.errorCorrectionLevels[ir],mr=[],Rr=0;if(or.ecBlocks.forEach(function(gr){for(var qr=0;qr<gr.numBlocks;qr++)mr.push({numDataCodewords:gr.dataCodewordsPerBlock,codewords:[]}),Rr+=gr.dataCodewordsPerBlock+or.ecCodewordsPerBlock}),Gt.length<Rr)return null;Gt=Gt.slice(0,Rr);for(var on=or.ecBlocks[0].dataCodewordsPerBlock,un=0;un<on;un++)for(var jr=0,Jr=mr;jr<Jr.length;jr++){var fn=Jr[jr];fn.codewords.push(Gt.shift())}if(or.ecBlocks.length>1)for(var Fr=or.ecBlocks[0].numBlocks,Cr=or.ecBlocks[1].numBlocks,un=0;un<Cr;un++)mr[Fr+un].codewords.push(Gt.shift());for(;Gt.length>0;)for(var Sr=0,dr=mr;Sr<dr.length;Sr++){var fn=dr[Sr];fn.codewords.push(Gt.shift())}return mr}function Ut(Gt){var er=Bt(Gt);if(!er)return null;var ir=Zt(Gt);if(!ir)return null;var or=Vt(Gt,er,ir),mr=zt(or,er,ir.errorCorrectionLevel);if(!mr)return null;for(var Rr=mr.reduce(function(Sr,dr){return Sr+dr.numDataCodewords},0),on=new Uint8ClampedArray(Rr),un=0,jr=0,Jr=mr;jr<Jr.length;jr++){var fn=Jr[jr],Fr=c.decode(fn.codewords,fn.codewords.length-fn.numDataCodewords);if(!Fr)return null;for(var Cr=0;Cr<fn.numDataCodewords;Cr++)on[un++]=Fr[Cr]}try{return rt.decode(on,er.versionNumber)}catch{return null}}function Nt(Gt){if(Gt==null)return null;var er=Ut(Gt);if(er)return er;for(var ir=0;ir<Gt.width;ir++)for(var or=ir+1;or<Gt.height;or++)Gt.get(ir,or)!==Gt.get(or,ir)&&(Gt.set(ir,or,!Gt.get(ir,or)),Gt.set(or,ir,!Gt.get(or,ir)));return Ut(Gt)}a.decode=Nt},function(s,a,_){Object.defineProperty(a,"__esModule",{value:!0});var $=_(7),rt=_(8),c;(function(Bt){Bt.Numeric="numeric",Bt.Alphanumeric="alphanumeric",Bt.Byte="byte",Bt.Kanji="kanji",Bt.ECI="eci"})(c=a.Mode||(a.Mode={}));var dt;(function(Bt){Bt[Bt.Terminator=0]="Terminator",Bt[Bt.Numeric=1]="Numeric",Bt[Bt.Alphanumeric=2]="Alphanumeric",Bt[Bt.Byte=4]="Byte",Bt[Bt.Kanji=8]="Kanji",Bt[Bt.ECI=7]="ECI"})(dt||(dt={}));function ht(Bt,Zt){for(var zt=[],Ut="",Nt=[10,12,14][Zt],Gt=Bt.readBits(Nt);Gt>=3;){var er=Bt.readBits(10);if(er>=1e3)throw new Error("Invalid numeric value above 999");var ir=Math.floor(er/100),or=Math.floor(er/10)%10,mr=er%10;zt.push(48+ir,48+or,48+mr),Ut+=ir.toString()+or.toString()+mr.toString(),Gt-=3}if(Gt===2){var er=Bt.readBits(7);if(er>=100)throw new Error("Invalid numeric value above 99");var ir=Math.floor(er/10),or=er%10;zt.push(48+ir,48+or),Ut+=ir.toString()+or.toString()}else if(Gt===1){var er=Bt.readBits(4);if(er>=10)throw new Error("Invalid numeric value above 9");zt.push(48+er),Ut+=er.toString()}return{bytes:zt,text:Ut}}var Et=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function St(Bt,Zt){for(var zt=[],Ut="",Nt=[9,11,13][Zt],Gt=Bt.readBits(Nt);Gt>=2;){var er=Bt.readBits(11),ir=Math.floor(er/45),or=er%45;zt.push(Et[ir].charCodeAt(0),Et[or].charCodeAt(0)),Ut+=Et[ir]+Et[or],Gt-=2}if(Gt===1){var ir=Bt.readBits(6);zt.push(Et[ir].charCodeAt(0)),Ut+=Et[ir]}return{bytes:zt,text:Ut}}function At(Bt,Zt){for(var zt=[],Ut="",Nt=[8,16,16][Zt],Gt=Bt.readBits(Nt),er=0;er<Gt;er++){var ir=Bt.readBits(8);zt.push(ir)}try{Ut+=decodeURIComponent(zt.map(function(or){return"%"+("0"+or.toString(16)).substr(-2)}).join(""))}catch{}return{bytes:zt,text:Ut}}function Pt(Bt,Zt){for(var zt=[],Ut="",Nt=[8,10,12][Zt],Gt=Bt.readBits(Nt),er=0;er<Gt;er++){var ir=Bt.readBits(13),or=Math.floor(ir/192)<<8|ir%192;or<7936?or+=33088:or+=49472,zt.push(or>>8,or&255),Ut+=String.fromCharCode(rt.shiftJISTable[or])}return{bytes:zt,text:Ut}}function Vt(Bt,Zt){for(var zt,Ut,Nt,Gt,er=new $.BitStream(Bt),ir=Zt<=9?0:Zt<=26?1:2,or={text:"",bytes:[],chunks:[],version:Zt};er.available()>=4;){var mr=er.readBits(4);if(mr===dt.Terminator)return or;if(mr===dt.ECI)er.readBits(1)===0?or.chunks.push({type:c.ECI,assignmentNumber:er.readBits(7)}):er.readBits(1)===0?or.chunks.push({type:c.ECI,assignmentNumber:er.readBits(14)}):er.readBits(1)===0?or.chunks.push({type:c.ECI,assignmentNumber:er.readBits(21)}):or.chunks.push({type:c.ECI,assignmentNumber:-1});else if(mr===dt.Numeric){var Rr=ht(er,ir);or.text+=Rr.text,(zt=or.bytes).push.apply(zt,Rr.bytes),or.chunks.push({type:c.Numeric,text:Rr.text})}else if(mr===dt.Alphanumeric){var on=St(er,ir);or.text+=on.text,(Ut=or.bytes).push.apply(Ut,on.bytes),or.chunks.push({type:c.Alphanumeric,text:on.text})}else if(mr===dt.Byte){var un=At(er,ir);or.text+=un.text,(Nt=or.bytes).push.apply(Nt,un.bytes),or.chunks.push({type:c.Byte,bytes:un.bytes,text:un.text})}else if(mr===dt.Kanji){var jr=Pt(er,ir);or.text+=jr.text,(Gt=or.bytes).push.apply(Gt,jr.bytes),or.chunks.push({type:c.Kanji,bytes:jr.bytes,text:jr.text})}}if(er.available()===0||er.readBits(er.available())===0)return or}a.decode=Vt},function(s,a,_){Object.defineProperty(a,"__esModule",{value:!0});var $=function(){function rt(c){this.byteOffset=0,this.bitOffset=0,this.bytes=c}return rt.prototype.readBits=function(c){if(c<1||c>32||c>this.available())throw new Error("Cannot read "+c.toString()+" bits");var dt=0;if(this.bitOffset>0){var ht=8-this.bitOffset,Et=c<ht?c:ht,St=ht-Et,At=255>>8-Et<<St;dt=(this.bytes[this.byteOffset]&At)>>St,c-=Et,this.bitOffset+=Et,this.bitOffset===8&&(this.bitOffset=0,this.byteOffset++)}if(c>0){for(;c>=8;)dt=dt<<8|this.bytes[this.byteOffset]&255,this.byteOffset++,c-=8;if(c>0){var St=8-c,At=255>>St<<St;dt=dt<<c|(this.bytes[this.byteOffset]&At)>>St,this.bitOffset+=c}}return dt},rt.prototype.available=function(){return 8*(this.bytes.length-this.byteOffset)-this.bitOffset},rt}();a.BitStream=$},function(s,a,_){Object.defineProperty(a,"__esModule",{value:!0}),a.shiftJISTable={32:32,33:33,34:34,35:35,36:36,37:37,38:38,39:39,40:40,41:41,42:42,43:43,44:44,45:45,46:46,47:47,48:48,49:49,50:50,51:51,52:52,53:53,54:54,55:55,56:56,57:57,58:58,59:59,60:60,61:61,62:62,63:63,64:64,65:65,66:66,67:67,68:68,69:69,70:70,71:71,72:72,73:73,74:74,75:75,76:76,77:77,78:78,79:79,80:80,81:81,82:82,83:83,84:84,85:85,86:86,87:87,88:88,89:89,90:90,91:91,92:165,93:93,94:94,95:95,96:96,97:97,98:98,99:99,100:100,101:101,102:102,103:103,104:104,105:105,106:106,107:107,108:108,109:109,110:110,111:111,112:112,113:113,114:114,115:115,116:116,117:117,118:118,119:119,120:120,121:121,122:122,123:123,124:124,125:125,126:8254,33088:12288,33089:12289,33090:12290,33091:65292,33092:65294,33093:12539,33094:65306,33095:65307,33096:65311,33097:65281,33098:12443,33099:12444,33100:180,33101:65344,33102:168,33103:65342,33104:65507,33105:65343,33106:12541,33107:12542,33108:12445,33109:12446,33110:12291,33111:20189,33112:12293,33113:12294,33114:12295,33115:12540,33116:8213,33117:8208,33118:65295,33119:92,33120:12316,33121:8214,33122:65372,33123:8230,33124:8229,33125:8216,33126:8217,33127:8220,33128:8221,33129:65288,33130:65289,33131:12308,33132:12309,33133:65339,33134:65341,33135:65371,33136:65373,33137:12296,33138:12297,33139:12298,33140:12299,33141:12300,33142:12301,33143:12302,33144:12303,33145:12304,33146:12305,33147:65291,33148:8722,33149:177,33150:215,33152:247,33153:65309,33154:8800,33155:65308,33156:65310,33157:8806,33158:8807,33159:8734,33160:8756,33161:9794,33162:9792,33163:176,33164:8242,33165:8243,33166:8451,33167:65509,33168:65284,33169:162,33170:163,33171:65285,33172:65283,33173:65286,33174:65290,33175:65312,33176:167,33177:9734,33178:9733,33179:9675,33180:9679,33181:9678,33182:9671,33183:9670,33184:9633,33185:9632,33186:9651,33187:9650,33188:9661,33189:9660,33190:8251,33191:12306,33192:8594,33193:8592,33194:8593,33195:8595,33196:12307,33208:8712,33209:8715,33210:8838,33211:8839,33212:8834,33213:8835,33214:8746,33215:8745,33224:8743,33225:8744,33226:172,33227:8658,33228:8660,33229:8704,33230:8707,33242:8736,33243:8869,33244:8978,33245:8706,33246:8711,33247:8801,33248:8786,33249:8810,33250:8811,33251:8730,33252:8765,33253:8733,33254:8757,33255:8747,33256:8748,33264:8491,33265:8240,33266:9839,33267:9837,33268:9834,33269:8224,33270:8225,33271:182,33276:9711,33359:65296,33360:65297,33361:65298,33362:65299,33363:65300,33364:65301,33365:65302,33366:65303,33367:65304,33368:65305,33376:65313,33377:65314,33378:65315,33379:65316,33380:65317,33381:65318,33382:65319,33383:65320,33384:65321,33385:65322,33386:65323,33387:65324,33388:65325,33389:65326,33390:65327,33391:65328,33392:65329,33393:65330,33394:65331,33395:65332,33396:65333,33397:65334,33398:65335,33399:65336,33400:65337,33401:65338,33409:65345,33410:65346,33411:65347,33412:65348,33413:65349,33414:65350,33415:65351,33416:65352,33417:65353,33418:65354,33419:65355,33420:65356,33421:65357,33422:65358,33423:65359,33424:65360,33425:65361,33426:65362,33427:65363,33428:65364,33429:65365,33430:65366,33431:65367,33432:65368,33433:65369,33434:65370,33439:12353,33440:12354,33441:12355,33442:12356,33443:12357,33444:12358,33445:12359,33446:12360,33447:12361,33448:12362,33449:12363,33450:12364,33451:12365,33452:12366,33453:12367,33454:12368,33455:12369,33456:12370,33457:12371,33458:12372,33459:12373,33460:12374,33461:12375,33462:12376,33463:12377,33464:12378,33465:12379,33466:12380,33467:12381,33468:12382,33469:12383,33470:12384,33471:12385,33472:12386,33473:12387,33474:12388,33475:12389,33476:12390,33477:12391,33478:12392,33479:12393,33480:12394,33481:12395,33482:12396,33483:12397,33484:12398,33485:12399,33486:12400,33487:12401,33488:12402,33489:12403,33490:12404,33491:12405,33492:12406,33493:12407,33494:12408,33495:12409,33496:12410,33497:12411,33498:12412,33499:12413,33500:12414,33501:12415,33502:12416,33503:12417,33504:12418,33505:12419,33506:12420,33507:12421,33508:12422,33509:12423,33510:12424,33511:12425,33512:12426,33513:12427,33514:12428,33515:12429,33516:12430,33517:12431,33518:12432,33519:12433,33520:12434,33521:12435,33600:12449,33601:12450,33602:12451,33603:12452,33604:12453,33605:12454,33606:12455,33607:12456,33608:12457,33609:12458,33610:12459,33611:12460,33612:12461,33613:12462,33614:12463,33615:12464,33616:12465,33617:12466,33618:12467,33619:12468,33620:12469,33621:12470,33622:12471,33623:12472,33624:12473,33625:12474,33626:12475,33627:12476,33628:12477,33629:12478,33630:12479,33631:12480,33632:12481,33633:12482,33634:12483,33635:12484,33636:12485,33637:12486,33638:12487,33639:12488,33640:12489,33641:12490,33642:12491,33643:12492,33644:12493,33645:12494,33646:12495,33647:12496,33648:12497,33649:12498,33650:12499,33651:12500,33652:12501,33653:12502,33654:12503,33655:12504,33656:12505,33657:12506,33658:12507,33659:12508,33660:12509,33661:12510,33662:12511,33664:12512,33665:12513,33666:12514,33667:12515,33668:12516,33669:12517,33670:12518,33671:12519,33672:12520,33673:12521,33674:12522,33675:12523,33676:12524,33677:12525,33678:12526,33679:12527,33680:12528,33681:12529,33682:12530,33683:12531,33684:12532,33685:12533,33686:12534,33695:913,33696:914,33697:915,33698:916,33699:917,33700:918,33701:919,33702:920,33703:921,33704:922,33705:923,33706:924,33707:925,33708:926,33709:927,33710:928,33711:929,33712:931,33713:932,33714:933,33715:934,33716:935,33717:936,33718:937,33727:945,33728:946,33729:947,33730:948,33731:949,33732:950,33733:951,33734:952,33735:953,33736:954,33737:955,33738:956,33739:957,33740:958,33741:959,33742:960,33743:961,33744:963,33745:964,33746:965,33747:966,33748:967,33749:968,33750:969,33856:1040,33857:1041,33858:1042,33859:1043,33860:1044,33861:1045,33862:1025,33863:1046,33864:1047,33865:1048,33866:1049,33867:1050,33868:1051,33869:1052,33870:1053,33871:1054,33872:1055,33873:1056,33874:1057,33875:1058,33876:1059,33877:1060,33878:1061,33879:1062,33880:1063,33881:1064,33882:1065,33883:1066,33884:1067,33885:1068,33886:1069,33887:1070,33888:1071,33904:1072,33905:1073,33906:1074,33907:1075,33908:1076,33909:1077,33910:1105,33911:1078,33912:1079,33913:1080,33914:1081,33915:1082,33916:1083,33917:1084,33918:1085,33920:1086,33921:1087,33922:1088,33923:1089,33924:1090,33925:1091,33926:1092,33927:1093,33928:1094,33929:1095,33930:1096,33931:1097,33932:1098,33933:1099,33934:1100,33935:1101,33936:1102,33937:1103,33951:9472,33952:9474,33953:9484,33954:9488,33955:9496,33956:9492,33957:9500,33958:9516,33959:9508,33960:9524,33961:9532,33962:9473,33963:9475,33964:9487,33965:9491,33966:9499,33967:9495,33968:9507,33969:9523,33970:9515,33971:9531,33972:9547,33973:9504,33974:9519,33975:9512,33976:9527,33977:9535,33978:9501,33979:9520,33980:9509,33981:9528,33982:9538,34975:20124,34976:21782,34977:23043,34978:38463,34979:21696,34980:24859,34981:25384,34982:23030,34983:36898,34984:33909,34985:33564,34986:31312,34987:24746,34988:25569,34989:28197,34990:26093,34991:33894,34992:33446,34993:39925,34994:26771,34995:22311,34996:26017,34997:25201,34998:23451,34999:22992,35e3:34427,35001:39156,35002:32098,35003:32190,35004:39822,35005:25110,35006:31903,35007:34999,35008:23433,35009:24245,35010:25353,35011:26263,35012:26696,35013:38343,35014:38797,35015:26447,35016:20197,35017:20234,35018:20301,35019:20381,35020:20553,35021:22258,35022:22839,35023:22996,35024:23041,35025:23561,35026:24799,35027:24847,35028:24944,35029:26131,35030:26885,35031:28858,35032:30031,35033:30064,35034:31227,35035:32173,35036:32239,35037:32963,35038:33806,35039:34915,35040:35586,35041:36949,35042:36986,35043:21307,35044:20117,35045:20133,35046:22495,35047:32946,35048:37057,35049:30959,35050:19968,35051:22769,35052:28322,35053:36920,35054:31282,35055:33576,35056:33419,35057:39983,35058:20801,35059:21360,35060:21693,35061:21729,35062:22240,35063:23035,35064:24341,35065:39154,35066:28139,35067:32996,35068:34093,35136:38498,35137:38512,35138:38560,35139:38907,35140:21515,35141:21491,35142:23431,35143:28879,35144:32701,35145:36802,35146:38632,35147:21359,35148:40284,35149:31418,35150:19985,35151:30867,35152:33276,35153:28198,35154:22040,35155:21764,35156:27421,35157:34074,35158:39995,35159:23013,35160:21417,35161:28006,35162:29916,35163:38287,35164:22082,35165:20113,35166:36939,35167:38642,35168:33615,35169:39180,35170:21473,35171:21942,35172:23344,35173:24433,35174:26144,35175:26355,35176:26628,35177:27704,35178:27891,35179:27945,35180:29787,35181:30408,35182:31310,35183:38964,35184:33521,35185:34907,35186:35424,35187:37613,35188:28082,35189:30123,35190:30410,35191:39365,35192:24742,35193:35585,35194:36234,35195:38322,35196:27022,35197:21421,35198:20870,35200:22290,35201:22576,35202:22852,35203:23476,35204:24310,35205:24616,35206:25513,35207:25588,35208:27839,35209:28436,35210:28814,35211:28948,35212:29017,35213:29141,35214:29503,35215:32257,35216:33398,35217:33489,35218:34199,35219:36960,35220:37467,35221:40219,35222:22633,35223:26044,35224:27738,35225:29989,35226:20985,35227:22830,35228:22885,35229:24448,35230:24540,35231:25276,35232:26106,35233:27178,35234:27431,35235:27572,35236:29579,35237:32705,35238:35158,35239:40236,35240:40206,35241:40644,35242:23713,35243:27798,35244:33659,35245:20740,35246:23627,35247:25014,35248:33222,35249:26742,35250:29281,35251:20057,35252:20474,35253:21368,35254:24681,35255:28201,35256:31311,35257:38899,35258:19979,35259:21270,35260:20206,35261:20309,35262:20285,35263:20385,35264:20339,35265:21152,35266:21487,35267:22025,35268:22799,35269:23233,35270:23478,35271:23521,35272:31185,35273:26247,35274:26524,35275:26550,35276:27468,35277:27827,35278:28779,35279:29634,35280:31117,35281:31166,35282:31292,35283:31623,35284:33457,35285:33499,35286:33540,35287:33655,35288:33775,35289:33747,35290:34662,35291:35506,35292:22057,35293:36008,35294:36838,35295:36942,35296:38686,35297:34442,35298:20420,35299:23784,35300:25105,35301:29273,35302:30011,35303:33253,35304:33469,35305:34558,35306:36032,35307:38597,35308:39187,35309:39381,35310:20171,35311:20250,35312:35299,35313:22238,35314:22602,35315:22730,35316:24315,35317:24555,35318:24618,35319:24724,35320:24674,35321:25040,35322:25106,35323:25296,35324:25913,35392:39745,35393:26214,35394:26800,35395:28023,35396:28784,35397:30028,35398:30342,35399:32117,35400:33445,35401:34809,35402:38283,35403:38542,35404:35997,35405:20977,35406:21182,35407:22806,35408:21683,35409:23475,35410:23830,35411:24936,35412:27010,35413:28079,35414:30861,35415:33995,35416:34903,35417:35442,35418:37799,35419:39608,35420:28012,35421:39336,35422:34521,35423:22435,35424:26623,35425:34510,35426:37390,35427:21123,35428:22151,35429:21508,35430:24275,35431:25313,35432:25785,35433:26684,35434:26680,35435:27579,35436:29554,35437:30906,35438:31339,35439:35226,35440:35282,35441:36203,35442:36611,35443:37101,35444:38307,35445:38548,35446:38761,35447:23398,35448:23731,35449:27005,35450:38989,35451:38990,35452:25499,35453:31520,35454:27179,35456:27263,35457:26806,35458:39949,35459:28511,35460:21106,35461:21917,35462:24688,35463:25324,35464:27963,35465:28167,35466:28369,35467:33883,35468:35088,35469:36676,35470:19988,35471:39993,35472:21494,35473:26907,35474:27194,35475:38788,35476:26666,35477:20828,35478:31427,35479:33970,35480:37340,35481:37772,35482:22107,35483:40232,35484:26658,35485:33541,35486:33841,35487:31909,35488:21e3,35489:33477,35490:29926,35491:20094,35492:20355,35493:20896,35494:23506,35495:21002,35496:21208,35497:21223,35498:24059,35499:21914,35500:22570,35501:23014,35502:23436,35503:23448,35504:23515,35505:24178,35506:24185,35507:24739,35508:24863,35509:24931,35510:25022,35511:25563,35512:25954,35513:26577,35514:26707,35515:26874,35516:27454,35517:27475,35518:27735,35519:28450,35520:28567,35521:28485,35522:29872,35523:29976,35524:30435,35525:30475,35526:31487,35527:31649,35528:31777,35529:32233,35530:32566,35531:32752,35532:32925,35533:33382,35534:33694,35535:35251,35536:35532,35537:36011,35538:36996,35539:37969,35540:38291,35541:38289,35542:38306,35543:38501,35544:38867,35545:39208,35546:33304,35547:20024,35548:21547,35549:23736,35550:24012,35551:29609,35552:30284,35553:30524,35554:23721,35555:32747,35556:36107,35557:38593,35558:38929,35559:38996,35560:39e3,35561:20225,35562:20238,35563:21361,35564:21916,35565:22120,35566:22522,35567:22855,35568:23305,35569:23492,35570:23696,35571:24076,35572:24190,35573:24524,35574:25582,35575:26426,35576:26071,35577:26082,35578:26399,35579:26827,35580:26820,35648:27231,35649:24112,35650:27589,35651:27671,35652:27773,35653:30079,35654:31048,35655:23395,35656:31232,35657:32e3,35658:24509,35659:35215,35660:35352,35661:36020,35662:36215,35663:36556,35664:36637,35665:39138,35666:39438,35667:39740,35668:20096,35669:20605,35670:20736,35671:22931,35672:23452,35673:25135,35674:25216,35675:25836,35676:27450,35677:29344,35678:30097,35679:31047,35680:32681,35681:34811,35682:35516,35683:35696,35684:25516,35685:33738,35686:38816,35687:21513,35688:21507,35689:21931,35690:26708,35691:27224,35692:35440,35693:30759,35694:26485,35695:40653,35696:21364,35697:23458,35698:33050,35699:34384,35700:36870,35701:19992,35702:20037,35703:20167,35704:20241,35705:21450,35706:21560,35707:23470,35708:24339,35709:24613,35710:25937,35712:26429,35713:27714,35714:27762,35715:27875,35716:28792,35717:29699,35718:31350,35719:31406,35720:31496,35721:32026,35722:31998,35723:32102,35724:26087,35725:29275,35726:21435,35727:23621,35728:24040,35729:25298,35730:25312,35731:25369,35732:28192,35733:34394,35734:35377,35735:36317,35736:37624,35737:28417,35738:31142,35739:39770,35740:20136,35741:20139,35742:20140,35743:20379,35744:20384,35745:20689,35746:20807,35747:31478,35748:20849,35749:20982,35750:21332,35751:21281,35752:21375,35753:21483,35754:21932,35755:22659,35756:23777,35757:24375,35758:24394,35759:24623,35760:24656,35761:24685,35762:25375,35763:25945,35764:27211,35765:27841,35766:29378,35767:29421,35768:30703,35769:33016,35770:33029,35771:33288,35772:34126,35773:37111,35774:37857,35775:38911,35776:39255,35777:39514,35778:20208,35779:20957,35780:23597,35781:26241,35782:26989,35783:23616,35784:26354,35785:26997,35786:29577,35787:26704,35788:31873,35789:20677,35790:21220,35791:22343,35792:24062,35793:37670,35794:26020,35795:27427,35796:27453,35797:29748,35798:31105,35799:31165,35800:31563,35801:32202,35802:33465,35803:33740,35804:34943,35805:35167,35806:35641,35807:36817,35808:37329,35809:21535,35810:37504,35811:20061,35812:20534,35813:21477,35814:21306,35815:29399,35816:29590,35817:30697,35818:33510,35819:36527,35820:39366,35821:39368,35822:39378,35823:20855,35824:24858,35825:34398,35826:21936,35827:31354,35828:20598,35829:23507,35830:36935,35831:38533,35832:20018,35833:27355,35834:37351,35835:23633,35836:23624,35904:25496,35905:31391,35906:27795,35907:38772,35908:36705,35909:31402,35910:29066,35911:38536,35912:31874,35913:26647,35914:32368,35915:26705,35916:37740,35917:21234,35918:21531,35919:34219,35920:35347,35921:32676,35922:36557,35923:37089,35924:21350,35925:34952,35926:31041,35927:20418,35928:20670,35929:21009,35930:20804,35931:21843,35932:22317,35933:29674,35934:22411,35935:22865,35936:24418,35937:24452,35938:24693,35939:24950,35940:24935,35941:25001,35942:25522,35943:25658,35944:25964,35945:26223,35946:26690,35947:28179,35948:30054,35949:31293,35950:31995,35951:32076,35952:32153,35953:32331,35954:32619,35955:33550,35956:33610,35957:34509,35958:35336,35959:35427,35960:35686,35961:36605,35962:38938,35963:40335,35964:33464,35965:36814,35966:39912,35968:21127,35969:25119,35970:25731,35971:28608,35972:38553,35973:26689,35974:20625,35975:27424,35976:27770,35977:28500,35978:31348,35979:32080,35980:34880,35981:35363,35982:26376,35983:20214,35984:20537,35985:20518,35986:20581,35987:20860,35988:21048,35989:21091,35990:21927,35991:22287,35992:22533,35993:23244,35994:24314,35995:25010,35996:25080,35997:25331,35998:25458,35999:26908,36e3:27177,36001:29309,36002:29356,36003:29486,36004:30740,36005:30831,36006:32121,36007:30476,36008:32937,36009:35211,36010:35609,36011:36066,36012:36562,36013:36963,36014:37749,36015:38522,36016:38997,36017:39443,36018:40568,36019:20803,36020:21407,36021:21427,36022:24187,36023:24358,36024:28187,36025:28304,36026:29572,36027:29694,36028:32067,36029:33335,36030:35328,36031:35578,36032:38480,36033:20046,36034:20491,36035:21476,36036:21628,36037:22266,36038:22993,36039:23396,36040:24049,36041:24235,36042:24359,36043:25144,36044:25925,36045:26543,36046:28246,36047:29392,36048:31946,36049:34996,36050:32929,36051:32993,36052:33776,36053:34382,36054:35463,36055:36328,36056:37431,36057:38599,36058:39015,36059:40723,36060:20116,36061:20114,36062:20237,36063:21320,36064:21577,36065:21566,36066:23087,36067:24460,36068:24481,36069:24735,36070:26791,36071:27278,36072:29786,36073:30849,36074:35486,36075:35492,36076:35703,36077:37264,36078:20062,36079:39881,36080:20132,36081:20348,36082:20399,36083:20505,36084:20502,36085:20809,36086:20844,36087:21151,36088:21177,36089:21246,36090:21402,36091:21475,36092:21521,36160:21518,36161:21897,36162:22353,36163:22434,36164:22909,36165:23380,36166:23389,36167:23439,36168:24037,36169:24039,36170:24055,36171:24184,36172:24195,36173:24218,36174:24247,36175:24344,36176:24658,36177:24908,36178:25239,36179:25304,36180:25511,36181:25915,36182:26114,36183:26179,36184:26356,36185:26477,36186:26657,36187:26775,36188:27083,36189:27743,36190:27946,36191:28009,36192:28207,36193:28317,36194:30002,36195:30343,36196:30828,36197:31295,36198:31968,36199:32005,36200:32024,36201:32094,36202:32177,36203:32789,36204:32771,36205:32943,36206:32945,36207:33108,36208:33167,36209:33322,36210:33618,36211:34892,36212:34913,36213:35611,36214:36002,36215:36092,36216:37066,36217:37237,36218:37489,36219:30783,36220:37628,36221:38308,36222:38477,36224:38917,36225:39321,36226:39640,36227:40251,36228:21083,36229:21163,36230:21495,36231:21512,36232:22741,36233:25335,36234:28640,36235:35946,36236:36703,36237:40633,36238:20811,36239:21051,36240:21578,36241:22269,36242:31296,36243:37239,36244:40288,36245:40658,36246:29508,36247:28425,36248:33136,36249:29969,36250:24573,36251:24794,36252:39592,36253:29403,36254:36796,36255:27492,36256:38915,36257:20170,36258:22256,36259:22372,36260:22718,36261:23130,36262:24680,36263:25031,36264:26127,36265:26118,36266:26681,36267:26801,36268:28151,36269:30165,36270:32058,36271:33390,36272:39746,36273:20123,36274:20304,36275:21449,36276:21766,36277:23919,36278:24038,36279:24046,36280:26619,36281:27801,36282:29811,36283:30722,36284:35408,36285:37782,36286:35039,36287:22352,36288:24231,36289:25387,36290:20661,36291:20652,36292:20877,36293:26368,36294:21705,36295:22622,36296:22971,36297:23472,36298:24425,36299:25165,36300:25505,36301:26685,36302:27507,36303:28168,36304:28797,36305:37319,36306:29312,36307:30741,36308:30758,36309:31085,36310:25998,36311:32048,36312:33756,36313:35009,36314:36617,36315:38555,36316:21092,36317:22312,36318:26448,36319:32618,36320:36001,36321:20916,36322:22338,36323:38442,36324:22586,36325:27018,36326:32948,36327:21682,36328:23822,36329:22524,36330:30869,36331:40442,36332:20316,36333:21066,36334:21643,36335:25662,36336:26152,36337:26388,36338:26613,36339:31364,36340:31574,36341:32034,36342:37679,36343:26716,36344:39853,36345:31545,36346:21273,36347:20874,36348:21047,36416:23519,36417:25334,36418:25774,36419:25830,36420:26413,36421:27578,36422:34217,36423:38609,36424:30352,36425:39894,36426:25420,36427:37638,36428:39851,36429:30399,36430:26194,36431:19977,36432:20632,36433:21442,36434:23665,36435:24808,36436:25746,36437:25955,36438:26719,36439:29158,36440:29642,36441:29987,36442:31639,36443:32386,36444:34453,36445:35715,36446:36059,36447:37240,36448:39184,36449:26028,36450:26283,36451:27531,36452:20181,36453:20180,36454:20282,36455:20351,36456:21050,36457:21496,36458:21490,36459:21987,36460:22235,36461:22763,36462:22987,36463:22985,36464:23039,36465:23376,36466:23629,36467:24066,36468:24107,36469:24535,36470:24605,36471:25351,36472:25903,36473:23388,36474:26031,36475:26045,36476:26088,36477:26525,36478:27490,36480:27515,36481:27663,36482:29509,36483:31049,36484:31169,36485:31992,36486:32025,36487:32043,36488:32930,36489:33026,36490:33267,36491:35222,36492:35422,36493:35433,36494:35430,36495:35468,36496:35566,36497:36039,36498:36060,36499:38604,36500:39164,36501:27503,36502:20107,36503:20284,36504:20365,36505:20816,36506:23383,36507:23546,36508:24904,36509:25345,36510:26178,36511:27425,36512:28363,36513:27835,36514:29246,36515:29885,36516:30164,36517:30913,36518:31034,36519:32780,36520:32819,36521:33258,36522:33940,36523:36766,36524:27728,36525:40575,36526:24335,36527:35672,36528:40235,36529:31482,36530:36600,36531:23437,36532:38635,36533:19971,36534:21489,36535:22519,36536:22833,36537:23241,36538:23460,36539:24713,36540:28287,36541:28422,36542:30142,36543:36074,36544:23455,36545:34048,36546:31712,36547:20594,36548:26612,36549:33437,36550:23649,36551:34122,36552:32286,36553:33294,36554:20889,36555:23556,36556:25448,36557:36198,36558:26012,36559:29038,36560:31038,36561:32023,36562:32773,36563:35613,36564:36554,36565:36974,36566:34503,36567:37034,36568:20511,36569:21242,36570:23610,36571:26451,36572:28796,36573:29237,36574:37196,36575:37320,36576:37675,36577:33509,36578:23490,36579:24369,36580:24825,36581:20027,36582:21462,36583:23432,36584:25163,36585:26417,36586:27530,36587:29417,36588:29664,36589:31278,36590:33131,36591:36259,36592:37202,36593:39318,36594:20754,36595:21463,36596:21610,36597:23551,36598:25480,36599:27193,36600:32172,36601:38656,36602:22234,36603:21454,36604:21608,36672:23447,36673:23601,36674:24030,36675:20462,36676:24833,36677:25342,36678:27954,36679:31168,36680:31179,36681:32066,36682:32333,36683:32722,36684:33261,36685:33311,36686:33936,36687:34886,36688:35186,36689:35728,36690:36468,36691:36655,36692:36913,36693:37195,36694:37228,36695:38598,36696:37276,36697:20160,36698:20303,36699:20805,36700:21313,36701:24467,36702:25102,36703:26580,36704:27713,36705:28171,36706:29539,36707:32294,36708:37325,36709:37507,36710:21460,36711:22809,36712:23487,36713:28113,36714:31069,36715:32302,36716:31899,36717:22654,36718:29087,36719:20986,36720:34899,36721:36848,36722:20426,36723:23803,36724:26149,36725:30636,36726:31459,36727:33308,36728:39423,36729:20934,36730:24490,36731:26092,36732:26991,36733:27529,36734:28147,36736:28310,36737:28516,36738:30462,36739:32020,36740:24033,36741:36981,36742:37255,36743:38918,36744:20966,36745:21021,36746:25152,36747:26257,36748:26329,36749:28186,36750:24246,36751:32210,36752:32626,36753:26360,36754:34223,36755:34295,36756:35576,36757:21161,36758:21465,36759:22899,36760:24207,36761:24464,36762:24661,36763:37604,36764:38500,36765:20663,36766:20767,36767:21213,36768:21280,36769:21319,36770:21484,36771:21736,36772:21830,36773:21809,36774:22039,36775:22888,36776:22974,36777:23100,36778:23477,36779:23558,36780:23567,36781:23569,36782:23578,36783:24196,36784:24202,36785:24288,36786:24432,36787:25215,36788:25220,36789:25307,36790:25484,36791:25463,36792:26119,36793:26124,36794:26157,36795:26230,36796:26494,36797:26786,36798:27167,36799:27189,36800:27836,36801:28040,36802:28169,36803:28248,36804:28988,36805:28966,36806:29031,36807:30151,36808:30465,36809:30813,36810:30977,36811:31077,36812:31216,36813:31456,36814:31505,36815:31911,36816:32057,36817:32918,36818:33750,36819:33931,36820:34121,36821:34909,36822:35059,36823:35359,36824:35388,36825:35412,36826:35443,36827:35937,36828:36062,36829:37284,36830:37478,36831:37758,36832:37912,36833:38556,36834:38808,36835:19978,36836:19976,36837:19998,36838:20055,36839:20887,36840:21104,36841:22478,36842:22580,36843:22732,36844:23330,36845:24120,36846:24773,36847:25854,36848:26465,36849:26454,36850:27972,36851:29366,36852:30067,36853:31331,36854:33976,36855:35698,36856:37304,36857:37664,36858:22065,36859:22516,36860:39166,36928:25325,36929:26893,36930:27542,36931:29165,36932:32340,36933:32887,36934:33394,36935:35302,36936:39135,36937:34645,36938:36785,36939:23611,36940:20280,36941:20449,36942:20405,36943:21767,36944:23072,36945:23517,36946:23529,36947:24515,36948:24910,36949:25391,36950:26032,36951:26187,36952:26862,36953:27035,36954:28024,36955:28145,36956:30003,36957:30137,36958:30495,36959:31070,36960:31206,36961:32051,36962:33251,36963:33455,36964:34218,36965:35242,36966:35386,36967:36523,36968:36763,36969:36914,36970:37341,36971:38663,36972:20154,36973:20161,36974:20995,36975:22645,36976:22764,36977:23563,36978:29978,36979:23613,36980:33102,36981:35338,36982:36805,36983:38499,36984:38765,36985:31525,36986:35535,36987:38920,36988:37218,36989:22259,36990:21416,36992:36887,36993:21561,36994:22402,36995:24101,36996:25512,36997:27700,36998:28810,36999:30561,37e3:31883,37001:32736,37002:34928,37003:36930,37004:37204,37005:37648,37006:37656,37007:38543,37008:29790,37009:39620,37010:23815,37011:23913,37012:25968,37013:26530,37014:36264,37015:38619,37016:25454,37017:26441,37018:26905,37019:33733,37020:38935,37021:38592,37022:35070,37023:28548,37024:25722,37025:23544,37026:19990,37027:28716,37028:30045,37029:26159,37030:20932,37031:21046,37032:21218,37033:22995,37034:24449,37035:24615,37036:25104,37037:25919,37038:25972,37039:26143,37040:26228,37041:26866,37042:26646,37043:27491,37044:28165,37045:29298,37046:29983,37047:30427,37048:31934,37049:32854,37050:22768,37051:35069,37052:35199,37053:35488,37054:35475,37055:35531,37056:36893,37057:37266,37058:38738,37059:38745,37060:25993,37061:31246,37062:33030,37063:38587,37064:24109,37065:24796,37066:25114,37067:26021,37068:26132,37069:26512,37070:30707,37071:31309,37072:31821,37073:32318,37074:33034,37075:36012,37076:36196,37077:36321,37078:36447,37079:30889,37080:20999,37081:25305,37082:25509,37083:25666,37084:25240,37085:35373,37086:31363,37087:31680,37088:35500,37089:38634,37090:32118,37091:33292,37092:34633,37093:20185,37094:20808,37095:21315,37096:21344,37097:23459,37098:23554,37099:23574,37100:24029,37101:25126,37102:25159,37103:25776,37104:26643,37105:26676,37106:27849,37107:27973,37108:27927,37109:26579,37110:28508,37111:29006,37112:29053,37113:26059,37114:31359,37115:31661,37116:32218,37184:32330,37185:32680,37186:33146,37187:33307,37188:33337,37189:34214,37190:35438,37191:36046,37192:36341,37193:36984,37194:36983,37195:37549,37196:37521,37197:38275,37198:39854,37199:21069,37200:21892,37201:28472,37202:28982,37203:20840,37204:31109,37205:32341,37206:33203,37207:31950,37208:22092,37209:22609,37210:23720,37211:25514,37212:26366,37213:26365,37214:26970,37215:29401,37216:30095,37217:30094,37218:30990,37219:31062,37220:31199,37221:31895,37222:32032,37223:32068,37224:34311,37225:35380,37226:38459,37227:36961,37228:40736,37229:20711,37230:21109,37231:21452,37232:21474,37233:20489,37234:21930,37235:22766,37236:22863,37237:29245,37238:23435,37239:23652,37240:21277,37241:24803,37242:24819,37243:25436,37244:25475,37245:25407,37246:25531,37248:25805,37249:26089,37250:26361,37251:24035,37252:27085,37253:27133,37254:28437,37255:29157,37256:20105,37257:30185,37258:30456,37259:31379,37260:31967,37261:32207,37262:32156,37263:32865,37264:33609,37265:33624,37266:33900,37267:33980,37268:34299,37269:35013,37270:36208,37271:36865,37272:36973,37273:37783,37274:38684,37275:39442,37276:20687,37277:22679,37278:24974,37279:33235,37280:34101,37281:36104,37282:36896,37283:20419,37284:20596,37285:21063,37286:21363,37287:24687,37288:25417,37289:26463,37290:28204,37291:36275,37292:36895,37293:20439,37294:23646,37295:36042,37296:26063,37297:32154,37298:21330,37299:34966,37300:20854,37301:25539,37302:23384,37303:23403,37304:23562,37305:25613,37306:26449,37307:36956,37308:20182,37309:22810,37310:22826,37311:27760,37312:35409,37313:21822,37314:22549,37315:22949,37316:24816,37317:25171,37318:26561,37319:33333,37320:26965,37321:38464,37322:39364,37323:39464,37324:20307,37325:22534,37326:23550,37327:32784,37328:23729,37329:24111,37330:24453,37331:24608,37332:24907,37333:25140,37334:26367,37335:27888,37336:28382,37337:32974,37338:33151,37339:33492,37340:34955,37341:36024,37342:36864,37343:36910,37344:38538,37345:40667,37346:39899,37347:20195,37348:21488,37349:22823,37350:31532,37351:37261,37352:38988,37353:40441,37354:28381,37355:28711,37356:21331,37357:21828,37358:23429,37359:25176,37360:25246,37361:25299,37362:27810,37363:28655,37364:29730,37365:35351,37366:37944,37367:28609,37368:35582,37369:33592,37370:20967,37371:34552,37372:21482,37440:21481,37441:20294,37442:36948,37443:36784,37444:22890,37445:33073,37446:24061,37447:31466,37448:36799,37449:26842,37450:35895,37451:29432,37452:40008,37453:27197,37454:35504,37455:20025,37456:21336,37457:22022,37458:22374,37459:25285,37460:25506,37461:26086,37462:27470,37463:28129,37464:28251,37465:28845,37466:30701,37467:31471,37468:31658,37469:32187,37470:32829,37471:32966,37472:34507,37473:35477,37474:37723,37475:22243,37476:22727,37477:24382,37478:26029,37479:26262,37480:27264,37481:27573,37482:30007,37483:35527,37484:20516,37485:30693,37486:22320,37487:24347,37488:24677,37489:26234,37490:27744,37491:30196,37492:31258,37493:32622,37494:33268,37495:34584,37496:36933,37497:39347,37498:31689,37499:30044,37500:31481,37501:31569,37502:33988,37504:36880,37505:31209,37506:31378,37507:33590,37508:23265,37509:30528,37510:20013,37511:20210,37512:23449,37513:24544,37514:25277,37515:26172,37516:26609,37517:27880,37518:34411,37519:34935,37520:35387,37521:37198,37522:37619,37523:39376,37524:27159,37525:28710,37526:29482,37527:33511,37528:33879,37529:36015,37530:19969,37531:20806,37532:20939,37533:21899,37534:23541,37535:24086,37536:24115,37537:24193,37538:24340,37539:24373,37540:24427,37541:24500,37542:25074,37543:25361,37544:26274,37545:26397,37546:28526,37547:29266,37548:30010,37549:30522,37550:32884,37551:33081,37552:33144,37553:34678,37554:35519,37555:35548,37556:36229,37557:36339,37558:37530,37559:38263,37560:38914,37561:40165,37562:21189,37563:25431,37564:30452,37565:26389,37566:27784,37567:29645,37568:36035,37569:37806,37570:38515,37571:27941,37572:22684,37573:26894,37574:27084,37575:36861,37576:37786,37577:30171,37578:36890,37579:22618,37580:26626,37581:25524,37582:27131,37583:20291,37584:28460,37585:26584,37586:36795,37587:34086,37588:32180,37589:37716,37590:26943,37591:28528,37592:22378,37593:22775,37594:23340,37595:32044,37596:29226,37597:21514,37598:37347,37599:40372,37600:20141,37601:20302,37602:20572,37603:20597,37604:21059,37605:35998,37606:21576,37607:22564,37608:23450,37609:24093,37610:24213,37611:24237,37612:24311,37613:24351,37614:24716,37615:25269,37616:25402,37617:25552,37618:26799,37619:27712,37620:30855,37621:31118,37622:31243,37623:32224,37624:33351,37625:35330,37626:35558,37627:36420,37628:36883,37696:37048,37697:37165,37698:37336,37699:40718,37700:27877,37701:25688,37702:25826,37703:25973,37704:28404,37705:30340,37706:31515,37707:36969,37708:37841,37709:28346,37710:21746,37711:24505,37712:25764,37713:36685,37714:36845,37715:37444,37716:20856,37717:22635,37718:22825,37719:23637,37720:24215,37721:28155,37722:32399,37723:29980,37724:36028,37725:36578,37726:39003,37727:28857,37728:20253,37729:27583,37730:28593,37731:3e4,37732:38651,37733:20814,37734:21520,37735:22581,37736:22615,37737:22956,37738:23648,37739:24466,37740:26007,37741:26460,37742:28193,37743:30331,37744:33759,37745:36077,37746:36884,37747:37117,37748:37709,37749:30757,37750:30778,37751:21162,37752:24230,37753:22303,37754:22900,37755:24594,37756:20498,37757:20826,37758:20908,37760:20941,37761:20992,37762:21776,37763:22612,37764:22616,37765:22871,37766:23445,37767:23798,37768:23947,37769:24764,37770:25237,37771:25645,37772:26481,37773:26691,37774:26812,37775:26847,37776:30423,37777:28120,37778:28271,37779:28059,37780:28783,37781:29128,37782:24403,37783:30168,37784:31095,37785:31561,37786:31572,37787:31570,37788:31958,37789:32113,37790:21040,37791:33891,37792:34153,37793:34276,37794:35342,37795:35588,37796:35910,37797:36367,37798:36867,37799:36879,37800:37913,37801:38518,37802:38957,37803:39472,37804:38360,37805:20685,37806:21205,37807:21516,37808:22530,37809:23566,37810:24999,37811:25758,37812:27934,37813:30643,37814:31461,37815:33012,37816:33796,37817:36947,37818:37509,37819:23776,37820:40199,37821:21311,37822:24471,37823:24499,37824:28060,37825:29305,37826:30563,37827:31167,37828:31716,37829:27602,37830:29420,37831:35501,37832:26627,37833:27233,37834:20984,37835:31361,37836:26932,37837:23626,37838:40182,37839:33515,37840:23493,37841:37193,37842:28702,37843:22136,37844:23663,37845:24775,37846:25958,37847:27788,37848:35930,37849:36929,37850:38931,37851:21585,37852:26311,37853:37389,37854:22856,37855:37027,37856:20869,37857:20045,37858:20970,37859:34201,37860:35598,37861:28760,37862:25466,37863:37707,37864:26978,37865:39348,37866:32260,37867:30071,37868:21335,37869:26976,37870:36575,37871:38627,37872:27741,37873:20108,37874:23612,37875:24336,37876:36841,37877:21250,37878:36049,37879:32905,37880:34425,37881:24319,37882:26085,37883:20083,37884:20837,37952:22914,37953:23615,37954:38894,37955:20219,37956:22922,37957:24525,37958:35469,37959:28641,37960:31152,37961:31074,37962:23527,37963:33905,37964:29483,37965:29105,37966:24180,37967:24565,37968:25467,37969:25754,37970:29123,37971:31896,37972:20035,37973:24316,37974:20043,37975:22492,37976:22178,37977:24745,37978:28611,37979:32013,37980:33021,37981:33075,37982:33215,37983:36786,37984:35223,37985:34468,37986:24052,37987:25226,37988:25773,37989:35207,37990:26487,37991:27874,37992:27966,37993:29750,37994:30772,37995:23110,37996:32629,37997:33453,37998:39340,37999:20467,38e3:24259,38001:25309,38002:25490,38003:25943,38004:26479,38005:30403,38006:29260,38007:32972,38008:32954,38009:36649,38010:37197,38011:20493,38012:22521,38013:23186,38014:26757,38016:26995,38017:29028,38018:29437,38019:36023,38020:22770,38021:36064,38022:38506,38023:36889,38024:34687,38025:31204,38026:30695,38027:33833,38028:20271,38029:21093,38030:21338,38031:25293,38032:26575,38033:27850,38034:30333,38035:31636,38036:31893,38037:33334,38038:34180,38039:36843,38040:26333,38041:28448,38042:29190,38043:32283,38044:33707,38045:39361,38046:40614,38047:20989,38048:31665,38049:30834,38050:31672,38051:32903,38052:31560,38053:27368,38054:24161,38055:32908,38056:30033,38057:30048,38058:20843,38059:37474,38060:28300,38061:30330,38062:37271,38063:39658,38064:20240,38065:32624,38066:25244,38067:31567,38068:38309,38069:40169,38070:22138,38071:22617,38072:34532,38073:38588,38074:20276,38075:21028,38076:21322,38077:21453,38078:21467,38079:24070,38080:25644,38081:26001,38082:26495,38083:27710,38084:27726,38085:29256,38086:29359,38087:29677,38088:30036,38089:32321,38090:33324,38091:34281,38092:36009,38093:31684,38094:37318,38095:29033,38096:38930,38097:39151,38098:25405,38099:26217,38100:30058,38101:30436,38102:30928,38103:34115,38104:34542,38105:21290,38106:21329,38107:21542,38108:22915,38109:24199,38110:24444,38111:24754,38112:25161,38113:25209,38114:25259,38115:26e3,38116:27604,38117:27852,38118:30130,38119:30382,38120:30865,38121:31192,38122:32203,38123:32631,38124:32933,38125:34987,38126:35513,38127:36027,38128:36991,38129:38750,38130:39131,38131:27147,38132:31800,38133:20633,38134:23614,38135:24494,38136:26503,38137:27608,38138:29749,38139:30473,38140:32654,38208:40763,38209:26570,38210:31255,38211:21305,38212:30091,38213:39661,38214:24422,38215:33181,38216:33777,38217:32920,38218:24380,38219:24517,38220:30050,38221:31558,38222:36924,38223:26727,38224:23019,38225:23195,38226:32016,38227:30334,38228:35628,38229:20469,38230:24426,38231:27161,38232:27703,38233:28418,38234:29922,38235:31080,38236:34920,38237:35413,38238:35961,38239:24287,38240:25551,38241:30149,38242:31186,38243:33495,38244:37672,38245:37618,38246:33948,38247:34541,38248:39981,38249:21697,38250:24428,38251:25996,38252:27996,38253:28693,38254:36007,38255:36051,38256:38971,38257:25935,38258:29942,38259:19981,38260:20184,38261:22496,38262:22827,38263:23142,38264:23500,38265:20904,38266:24067,38267:24220,38268:24598,38269:25206,38270:25975,38272:26023,38273:26222,38274:28014,38275:29238,38276:31526,38277:33104,38278:33178,38279:33433,38280:35676,38281:36e3,38282:36070,38283:36212,38284:38428,38285:38468,38286:20398,38287:25771,38288:27494,38289:33310,38290:33889,38291:34154,38292:37096,38293:23553,38294:26963,38295:39080,38296:33914,38297:34135,38298:20239,38299:21103,38300:24489,38301:24133,38302:26381,38303:31119,38304:33145,38305:35079,38306:35206,38307:28149,38308:24343,38309:25173,38310:27832,38311:20175,38312:29289,38313:39826,38314:20998,38315:21563,38316:22132,38317:22707,38318:24996,38319:25198,38320:28954,38321:22894,38322:31881,38323:31966,38324:32027,38325:38640,38326:25991,38327:32862,38328:19993,38329:20341,38330:20853,38331:22592,38332:24163,38333:24179,38334:24330,38335:26564,38336:20006,38337:34109,38338:38281,38339:38491,38340:31859,38341:38913,38342:20731,38343:22721,38344:30294,38345:30887,38346:21029,38347:30629,38348:34065,38349:31622,38350:20559,38351:22793,38352:29255,38353:31687,38354:32232,38355:36794,38356:36820,38357:36941,38358:20415,38359:21193,38360:23081,38361:24321,38362:38829,38363:20445,38364:33303,38365:37610,38366:22275,38367:25429,38368:27497,38369:29995,38370:35036,38371:36628,38372:31298,38373:21215,38374:22675,38375:24917,38376:25098,38377:26286,38378:27597,38379:31807,38380:33769,38381:20515,38382:20472,38383:21253,38384:21574,38385:22577,38386:22857,38387:23453,38388:23792,38389:23791,38390:23849,38391:24214,38392:25265,38393:25447,38394:25918,38395:26041,38396:26379,38464:27861,38465:27873,38466:28921,38467:30770,38468:32299,38469:32990,38470:33459,38471:33804,38472:34028,38473:34562,38474:35090,38475:35370,38476:35914,38477:37030,38478:37586,38479:39165,38480:40179,38481:40300,38482:20047,38483:20129,38484:20621,38485:21078,38486:22346,38487:22952,38488:24125,38489:24536,38490:24537,38491:25151,38492:26292,38493:26395,38494:26576,38495:26834,38496:20882,38497:32033,38498:32938,38499:33192,38500:35584,38501:35980,38502:36031,38503:37502,38504:38450,38505:21536,38506:38956,38507:21271,38508:20693,38509:21340,38510:22696,38511:25778,38512:26420,38513:29287,38514:30566,38515:31302,38516:37350,38517:21187,38518:27809,38519:27526,38520:22528,38521:24140,38522:22868,38523:26412,38524:32763,38525:20961,38526:30406,38528:25705,38529:30952,38530:39764,38531:40635,38532:22475,38533:22969,38534:26151,38535:26522,38536:27598,38537:21737,38538:27097,38539:24149,38540:33180,38541:26517,38542:39850,38543:26622,38544:40018,38545:26717,38546:20134,38547:20451,38548:21448,38549:25273,38550:26411,38551:27819,38552:36804,38553:20397,38554:32365,38555:40639,38556:19975,38557:24930,38558:28288,38559:28459,38560:34067,38561:21619,38562:26410,38563:39749,38564:24051,38565:31637,38566:23724,38567:23494,38568:34588,38569:28234,38570:34001,38571:31252,38572:33032,38573:22937,38574:31885,38575:27665,38576:30496,38577:21209,38578:22818,38579:28961,38580:29279,38581:30683,38582:38695,38583:40289,38584:26891,38585:23167,38586:23064,38587:20901,38588:21517,38589:21629,38590:26126,38591:30431,38592:36855,38593:37528,38594:40180,38595:23018,38596:29277,38597:28357,38598:20813,38599:26825,38600:32191,38601:32236,38602:38754,38603:40634,38604:25720,38605:27169,38606:33538,38607:22916,38608:23391,38609:27611,38610:29467,38611:30450,38612:32178,38613:32791,38614:33945,38615:20786,38616:26408,38617:40665,38618:30446,38619:26466,38620:21247,38621:39173,38622:23588,38623:25147,38624:31870,38625:36016,38626:21839,38627:24758,38628:32011,38629:38272,38630:21249,38631:20063,38632:20918,38633:22812,38634:29242,38635:32822,38636:37326,38637:24357,38638:30690,38639:21380,38640:24441,38641:32004,38642:34220,38643:35379,38644:36493,38645:38742,38646:26611,38647:34222,38648:37971,38649:24841,38650:24840,38651:27833,38652:30290,38720:35565,38721:36664,38722:21807,38723:20305,38724:20778,38725:21191,38726:21451,38727:23461,38728:24189,38729:24736,38730:24962,38731:25558,38732:26377,38733:26586,38734:28263,38735:28044,38736:29494,38737:29495,38738:30001,38739:31056,38740:35029,38741:35480,38742:36938,38743:37009,38744:37109,38745:38596,38746:34701,38747:22805,38748:20104,38749:20313,38750:19982,38751:35465,38752:36671,38753:38928,38754:20653,38755:24188,38756:22934,38757:23481,38758:24248,38759:25562,38760:25594,38761:25793,38762:26332,38763:26954,38764:27096,38765:27915,38766:28342,38767:29076,38768:29992,38769:31407,38770:32650,38771:32768,38772:33865,38773:33993,38774:35201,38775:35617,38776:36362,38777:36965,38778:38525,38779:39178,38780:24958,38781:25233,38782:27442,38784:27779,38785:28020,38786:32716,38787:32764,38788:28096,38789:32645,38790:34746,38791:35064,38792:26469,38793:33713,38794:38972,38795:38647,38796:27931,38797:32097,38798:33853,38799:37226,38800:20081,38801:21365,38802:23888,38803:27396,38804:28651,38805:34253,38806:34349,38807:35239,38808:21033,38809:21519,38810:23653,38811:26446,38812:26792,38813:29702,38814:29827,38815:30178,38816:35023,38817:35041,38818:37324,38819:38626,38820:38520,38821:24459,38822:29575,38823:31435,38824:33870,38825:25504,38826:30053,38827:21129,38828:27969,38829:28316,38830:29705,38831:30041,38832:30827,38833:31890,38834:38534,38835:31452,38836:40845,38837:20406,38838:24942,38839:26053,38840:34396,38841:20102,38842:20142,38843:20698,38844:20001,38845:20940,38846:23534,38847:26009,38848:26753,38849:28092,38850:29471,38851:30274,38852:30637,38853:31260,38854:31975,38855:33391,38856:35538,38857:36988,38858:37327,38859:38517,38860:38936,38861:21147,38862:32209,38863:20523,38864:21400,38865:26519,38866:28107,38867:29136,38868:29747,38869:33256,38870:36650,38871:38563,38872:40023,38873:40607,38874:29792,38875:22593,38876:28057,38877:32047,38878:39006,38879:20196,38880:20278,38881:20363,38882:20919,38883:21169,38884:23994,38885:24604,38886:29618,38887:31036,38888:33491,38889:37428,38890:38583,38891:38646,38892:38666,38893:40599,38894:40802,38895:26278,38896:27508,38897:21015,38898:21155,38899:28872,38900:35010,38901:24265,38902:24651,38903:24976,38904:28451,38905:29001,38906:31806,38907:32244,38908:32879,38976:34030,38977:36899,38978:37676,38979:21570,38980:39791,38981:27347,38982:28809,38983:36034,38984:36335,38985:38706,38986:21172,38987:23105,38988:24266,38989:24324,38990:26391,38991:27004,38992:27028,38993:28010,38994:28431,38995:29282,38996:29436,38997:31725,38998:32769,38999:32894,39e3:34635,39001:37070,39002:20845,39003:40595,39004:31108,39005:32907,39006:37682,39007:35542,39008:20525,39009:21644,39010:35441,39011:27498,39012:36036,39013:33031,39014:24785,39015:26528,39016:40434,39017:20121,39018:20120,39019:39952,39020:35435,39021:34241,39022:34152,39023:26880,39024:28286,39025:30871,39026:33109,39071:24332,39072:19984,39073:19989,39074:20010,39075:20017,39076:20022,39077:20028,39078:20031,39079:20034,39080:20054,39081:20056,39082:20098,39083:20101,39084:35947,39085:20106,39086:33298,39087:24333,39088:20110,39089:20126,39090:20127,39091:20128,39092:20130,39093:20144,39094:20147,39095:20150,39096:20174,39097:20173,39098:20164,39099:20166,39100:20162,39101:20183,39102:20190,39103:20205,39104:20191,39105:20215,39106:20233,39107:20314,39108:20272,39109:20315,39110:20317,39111:20311,39112:20295,39113:20342,39114:20360,39115:20367,39116:20376,39117:20347,39118:20329,39119:20336,39120:20369,39121:20335,39122:20358,39123:20374,39124:20760,39125:20436,39126:20447,39127:20430,39128:20440,39129:20443,39130:20433,39131:20442,39132:20432,39133:20452,39134:20453,39135:20506,39136:20520,39137:20500,39138:20522,39139:20517,39140:20485,39141:20252,39142:20470,39143:20513,39144:20521,39145:20524,39146:20478,39147:20463,39148:20497,39149:20486,39150:20547,39151:20551,39152:26371,39153:20565,39154:20560,39155:20552,39156:20570,39157:20566,39158:20588,39159:20600,39160:20608,39161:20634,39162:20613,39163:20660,39164:20658,39232:20681,39233:20682,39234:20659,39235:20674,39236:20694,39237:20702,39238:20709,39239:20717,39240:20707,39241:20718,39242:20729,39243:20725,39244:20745,39245:20737,39246:20738,39247:20758,39248:20757,39249:20756,39250:20762,39251:20769,39252:20794,39253:20791,39254:20796,39255:20795,39256:20799,39257:20800,39258:20818,39259:20812,39260:20820,39261:20834,39262:31480,39263:20841,39264:20842,39265:20846,39266:20864,39267:20866,39268:22232,39269:20876,39270:20873,39271:20879,39272:20881,39273:20883,39274:20885,39275:20886,39276:20900,39277:20902,39278:20898,39279:20905,39280:20906,39281:20907,39282:20915,39283:20913,39284:20914,39285:20912,39286:20917,39287:20925,39288:20933,39289:20937,39290:20955,39291:20960,39292:34389,39293:20969,39294:20973,39296:20976,39297:20981,39298:20990,39299:20996,39300:21003,39301:21012,39302:21006,39303:21031,39304:21034,39305:21038,39306:21043,39307:21049,39308:21071,39309:21060,39310:21067,39311:21068,39312:21086,39313:21076,39314:21098,39315:21108,39316:21097,39317:21107,39318:21119,39319:21117,39320:21133,39321:21140,39322:21138,39323:21105,39324:21128,39325:21137,39326:36776,39327:36775,39328:21164,39329:21165,39330:21180,39331:21173,39332:21185,39333:21197,39334:21207,39335:21214,39336:21219,39337:21222,39338:39149,39339:21216,39340:21235,39341:21237,39342:21240,39343:21241,39344:21254,39345:21256,39346:30008,39347:21261,39348:21264,39349:21263,39350:21269,39351:21274,39352:21283,39353:21295,39354:21297,39355:21299,39356:21304,39357:21312,39358:21318,39359:21317,39360:19991,39361:21321,39362:21325,39363:20950,39364:21342,39365:21353,39366:21358,39367:22808,39368:21371,39369:21367,39370:21378,39371:21398,39372:21408,39373:21414,39374:21413,39375:21422,39376:21424,39377:21430,39378:21443,39379:31762,39380:38617,39381:21471,39382:26364,39383:29166,39384:21486,39385:21480,39386:21485,39387:21498,39388:21505,39389:21565,39390:21568,39391:21548,39392:21549,39393:21564,39394:21550,39395:21558,39396:21545,39397:21533,39398:21582,39399:21647,39400:21621,39401:21646,39402:21599,39403:21617,39404:21623,39405:21616,39406:21650,39407:21627,39408:21632,39409:21622,39410:21636,39411:21648,39412:21638,39413:21703,39414:21666,39415:21688,39416:21669,39417:21676,39418:21700,39419:21704,39420:21672,39488:21675,39489:21698,39490:21668,39491:21694,39492:21692,39493:21720,39494:21733,39495:21734,39496:21775,39497:21780,39498:21757,39499:21742,39500:21741,39501:21754,39502:21730,39503:21817,39504:21824,39505:21859,39506:21836,39507:21806,39508:21852,39509:21829,39510:21846,39511:21847,39512:21816,39513:21811,39514:21853,39515:21913,39516:21888,39517:21679,39518:21898,39519:21919,39520:21883,39521:21886,39522:21912,39523:21918,39524:21934,39525:21884,39526:21891,39527:21929,39528:21895,39529:21928,39530:21978,39531:21957,39532:21983,39533:21956,39534:21980,39535:21988,39536:21972,39537:22036,39538:22007,39539:22038,39540:22014,39541:22013,39542:22043,39543:22009,39544:22094,39545:22096,39546:29151,39547:22068,39548:22070,39549:22066,39550:22072,39552:22123,39553:22116,39554:22063,39555:22124,39556:22122,39557:22150,39558:22144,39559:22154,39560:22176,39561:22164,39562:22159,39563:22181,39564:22190,39565:22198,39566:22196,39567:22210,39568:22204,39569:22209,39570:22211,39571:22208,39572:22216,39573:22222,39574:22225,39575:22227,39576:22231,39577:22254,39578:22265,39579:22272,39580:22271,39581:22276,39582:22281,39583:22280,39584:22283,39585:22285,39586:22291,39587:22296,39588:22294,39589:21959,39590:22300,39591:22310,39592:22327,39593:22328,39594:22350,39595:22331,39596:22336,39597:22351,39598:22377,39599:22464,39600:22408,39601:22369,39602:22399,39603:22409,39604:22419,39605:22432,39606:22451,39607:22436,39608:22442,39609:22448,39610:22467,39611:22470,39612:22484,39613:22482,39614:22483,39615:22538,39616:22486,39617:22499,39618:22539,39619:22553,39620:22557,39621:22642,39622:22561,39623:22626,39624:22603,39625:22640,39626:27584,39627:22610,39628:22589,39629:22649,39630:22661,39631:22713,39632:22687,39633:22699,39634:22714,39635:22750,39636:22715,39637:22712,39638:22702,39639:22725,39640:22739,39641:22737,39642:22743,39643:22745,39644:22744,39645:22757,39646:22748,39647:22756,39648:22751,39649:22767,39650:22778,39651:22777,39652:22779,39653:22780,39654:22781,39655:22786,39656:22794,39657:22800,39658:22811,39659:26790,39660:22821,39661:22828,39662:22829,39663:22834,39664:22840,39665:22846,39666:31442,39667:22869,39668:22864,39669:22862,39670:22874,39671:22872,39672:22882,39673:22880,39674:22887,39675:22892,39676:22889,39744:22904,39745:22913,39746:22941,39747:20318,39748:20395,39749:22947,39750:22962,39751:22982,39752:23016,39753:23004,39754:22925,39755:23001,39756:23002,39757:23077,39758:23071,39759:23057,39760:23068,39761:23049,39762:23066,39763:23104,39764:23148,39765:23113,39766:23093,39767:23094,39768:23138,39769:23146,39770:23194,39771:23228,39772:23230,39773:23243,39774:23234,39775:23229,39776:23267,39777:23255,39778:23270,39779:23273,39780:23254,39781:23290,39782:23291,39783:23308,39784:23307,39785:23318,39786:23346,39787:23248,39788:23338,39789:23350,39790:23358,39791:23363,39792:23365,39793:23360,39794:23377,39795:23381,39796:23386,39797:23387,39798:23397,39799:23401,39800:23408,39801:23411,39802:23413,39803:23416,39804:25992,39805:23418,39806:23424,39808:23427,39809:23462,39810:23480,39811:23491,39812:23495,39813:23497,39814:23508,39815:23504,39816:23524,39817:23526,39818:23522,39819:23518,39820:23525,39821:23531,39822:23536,39823:23542,39824:23539,39825:23557,39826:23559,39827:23560,39828:23565,39829:23571,39830:23584,39831:23586,39832:23592,39833:23608,39834:23609,39835:23617,39836:23622,39837:23630,39838:23635,39839:23632,39840:23631,39841:23409,39842:23660,39843:23662,39844:20066,39845:23670,39846:23673,39847:23692,39848:23697,39849:23700,39850:22939,39851:23723,39852:23739,39853:23734,39854:23740,39855:23735,39856:23749,39857:23742,39858:23751,39859:23769,39860:23785,39861:23805,39862:23802,39863:23789,39864:23948,39865:23786,39866:23819,39867:23829,39868:23831,39869:23900,39870:23839,39871:23835,39872:23825,39873:23828,39874:23842,39875:23834,39876:23833,39877:23832,39878:23884,39879:23890,39880:23886,39881:23883,39882:23916,39883:23923,39884:23926,39885:23943,39886:23940,39887:23938,39888:23970,39889:23965,39890:23980,39891:23982,39892:23997,39893:23952,39894:23991,39895:23996,39896:24009,39897:24013,39898:24019,39899:24018,39900:24022,39901:24027,39902:24043,39903:24050,39904:24053,39905:24075,39906:24090,39907:24089,39908:24081,39909:24091,39910:24118,39911:24119,39912:24132,39913:24131,39914:24128,39915:24142,39916:24151,39917:24148,39918:24159,39919:24162,39920:24164,39921:24135,39922:24181,39923:24182,39924:24186,39925:40636,39926:24191,39927:24224,39928:24257,39929:24258,39930:24264,39931:24272,39932:24271,4e4:24278,40001:24291,40002:24285,40003:24282,40004:24283,40005:24290,40006:24289,40007:24296,40008:24297,40009:24300,40010:24305,40011:24307,40012:24304,40013:24308,40014:24312,40015:24318,40016:24323,40017:24329,40018:24413,40019:24412,40020:24331,40021:24337,40022:24342,40023:24361,40024:24365,40025:24376,40026:24385,40027:24392,40028:24396,40029:24398,40030:24367,40031:24401,40032:24406,40033:24407,40034:24409,40035:24417,40036:24429,40037:24435,40038:24439,40039:24451,40040:24450,40041:24447,40042:24458,40043:24456,40044:24465,40045:24455,40046:24478,40047:24473,40048:24472,40049:24480,40050:24488,40051:24493,40052:24508,40053:24534,40054:24571,40055:24548,40056:24568,40057:24561,40058:24541,40059:24755,40060:24575,40061:24609,40062:24672,40064:24601,40065:24592,40066:24617,40067:24590,40068:24625,40069:24603,40070:24597,40071:24619,40072:24614,40073:24591,40074:24634,40075:24666,40076:24641,40077:24682,40078:24695,40079:24671,40080:24650,40081:24646,40082:24653,40083:24675,40084:24643,40085:24676,40086:24642,40087:24684,40088:24683,40089:24665,40090:24705,40091:24717,40092:24807,40093:24707,40094:24730,40095:24708,40096:24731,40097:24726,40098:24727,40099:24722,40100:24743,40101:24715,40102:24801,40103:24760,40104:24800,40105:24787,40106:24756,40107:24560,40108:24765,40109:24774,40110:24757,40111:24792,40112:24909,40113:24853,40114:24838,40115:24822,40116:24823,40117:24832,40118:24820,40119:24826,40120:24835,40121:24865,40122:24827,40123:24817,40124:24845,40125:24846,40126:24903,40127:24894,40128:24872,40129:24871,40130:24906,40131:24895,40132:24892,40133:24876,40134:24884,40135:24893,40136:24898,40137:24900,40138:24947,40139:24951,40140:24920,40141:24921,40142:24922,40143:24939,40144:24948,40145:24943,40146:24933,40147:24945,40148:24927,40149:24925,40150:24915,40151:24949,40152:24985,40153:24982,40154:24967,40155:25004,40156:24980,40157:24986,40158:24970,40159:24977,40160:25003,40161:25006,40162:25036,40163:25034,40164:25033,40165:25079,40166:25032,40167:25027,40168:25030,40169:25018,40170:25035,40171:32633,40172:25037,40173:25062,40174:25059,40175:25078,40176:25082,40177:25076,40178:25087,40179:25085,40180:25084,40181:25086,40182:25088,40183:25096,40184:25097,40185:25101,40186:25100,40187:25108,40188:25115,40256:25118,40257:25121,40258:25130,40259:25134,40260:25136,40261:25138,40262:25139,40263:25153,40264:25166,40265:25182,40266:25187,40267:25179,40268:25184,40269:25192,40270:25212,40271:25218,40272:25225,40273:25214,40274:25234,40275:25235,40276:25238,40277:25300,40278:25219,40279:25236,40280:25303,40281:25297,40282:25275,40283:25295,40284:25343,40285:25286,40286:25812,40287:25288,40288:25308,40289:25292,40290:25290,40291:25282,40292:25287,40293:25243,40294:25289,40295:25356,40296:25326,40297:25329,40298:25383,40299:25346,40300:25352,40301:25327,40302:25333,40303:25424,40304:25406,40305:25421,40306:25628,40307:25423,40308:25494,40309:25486,40310:25472,40311:25515,40312:25462,40313:25507,40314:25487,40315:25481,40316:25503,40317:25525,40318:25451,40320:25449,40321:25534,40322:25577,40323:25536,40324:25542,40325:25571,40326:25545,40327:25554,40328:25590,40329:25540,40330:25622,40331:25652,40332:25606,40333:25619,40334:25638,40335:25654,40336:25885,40337:25623,40338:25640,40339:25615,40340:25703,40341:25711,40342:25718,40343:25678,40344:25898,40345:25749,40346:25747,40347:25765,40348:25769,40349:25736,40350:25788,40351:25818,40352:25810,40353:25797,40354:25799,40355:25787,40356:25816,40357:25794,40358:25841,40359:25831,40360:33289,40361:25824,40362:25825,40363:25260,40364:25827,40365:25839,40366:25900,40367:25846,40368:25844,40369:25842,40370:25850,40371:25856,40372:25853,40373:25880,40374:25884,40375:25861,40376:25892,40377:25891,40378:25899,40379:25908,40380:25909,40381:25911,40382:25910,40383:25912,40384:30027,40385:25928,40386:25942,40387:25941,40388:25933,40389:25944,40390:25950,40391:25949,40392:25970,40393:25976,40394:25986,40395:25987,40396:35722,40397:26011,40398:26015,40399:26027,40400:26039,40401:26051,40402:26054,40403:26049,40404:26052,40405:26060,40406:26066,40407:26075,40408:26073,40409:26080,40410:26081,40411:26097,40412:26482,40413:26122,40414:26115,40415:26107,40416:26483,40417:26165,40418:26166,40419:26164,40420:26140,40421:26191,40422:26180,40423:26185,40424:26177,40425:26206,40426:26205,40427:26212,40428:26215,40429:26216,40430:26207,40431:26210,40432:26224,40433:26243,40434:26248,40435:26254,40436:26249,40437:26244,40438:26264,40439:26269,40440:26305,40441:26297,40442:26313,40443:26302,40444:26300,40512:26308,40513:26296,40514:26326,40515:26330,40516:26336,40517:26175,40518:26342,40519:26345,40520:26352,40521:26357,40522:26359,40523:26383,40524:26390,40525:26398,40526:26406,40527:26407,40528:38712,40529:26414,40530:26431,40531:26422,40532:26433,40533:26424,40534:26423,40535:26438,40536:26462,40537:26464,40538:26457,40539:26467,40540:26468,40541:26505,40542:26480,40543:26537,40544:26492,40545:26474,40546:26508,40547:26507,40548:26534,40549:26529,40550:26501,40551:26551,40552:26607,40553:26548,40554:26604,40555:26547,40556:26601,40557:26552,40558:26596,40559:26590,40560:26589,40561:26594,40562:26606,40563:26553,40564:26574,40565:26566,40566:26599,40567:27292,40568:26654,40569:26694,40570:26665,40571:26688,40572:26701,40573:26674,40574:26702,40576:26803,40577:26667,40578:26713,40579:26723,40580:26743,40581:26751,40582:26783,40583:26767,40584:26797,40585:26772,40586:26781,40587:26779,40588:26755,40589:27310,40590:26809,40591:26740,40592:26805,40593:26784,40594:26810,40595:26895,40596:26765,40597:26750,40598:26881,40599:26826,40600:26888,40601:26840,40602:26914,40603:26918,40604:26849,40605:26892,40606:26829,40607:26836,40608:26855,40609:26837,40610:26934,40611:26898,40612:26884,40613:26839,40614:26851,40615:26917,40616:26873,40617:26848,40618:26863,40619:26920,40620:26922,40621:26906,40622:26915,40623:26913,40624:26822,40625:27001,40626:26999,40627:26972,40628:27e3,40629:26987,40630:26964,40631:27006,40632:26990,40633:26937,40634:26996,40635:26941,40636:26969,40637:26928,40638:26977,40639:26974,40640:26973,40641:27009,40642:26986,40643:27058,40644:27054,40645:27088,40646:27071,40647:27073,40648:27091,40649:27070,40650:27086,40651:23528,40652:27082,40653:27101,40654:27067,40655:27075,40656:27047,40657:27182,40658:27025,40659:27040,40660:27036,40661:27029,40662:27060,40663:27102,40664:27112,40665:27138,40666:27163,40667:27135,40668:27402,40669:27129,40670:27122,40671:27111,40672:27141,40673:27057,40674:27166,40675:27117,40676:27156,40677:27115,40678:27146,40679:27154,40680:27329,40681:27171,40682:27155,40683:27204,40684:27148,40685:27250,40686:27190,40687:27256,40688:27207,40689:27234,40690:27225,40691:27238,40692:27208,40693:27192,40694:27170,40695:27280,40696:27277,40697:27296,40698:27268,40699:27298,40700:27299,40768:27287,40769:34327,40770:27323,40771:27331,40772:27330,40773:27320,40774:27315,40775:27308,40776:27358,40777:27345,40778:27359,40779:27306,40780:27354,40781:27370,40782:27387,40783:27397,40784:34326,40785:27386,40786:27410,40787:27414,40788:39729,40789:27423,40790:27448,40791:27447,40792:30428,40793:27449,40794:39150,40795:27463,40796:27459,40797:27465,40798:27472,40799:27481,40800:27476,40801:27483,40802:27487,40803:27489,40804:27512,40805:27513,40806:27519,40807:27520,40808:27524,40809:27523,40810:27533,40811:27544,40812:27541,40813:27550,40814:27556,40815:27562,40816:27563,40817:27567,40818:27570,40819:27569,40820:27571,40821:27575,40822:27580,40823:27590,40824:27595,40825:27603,40826:27615,40827:27628,40828:27627,40829:27635,40830:27631,40832:40638,40833:27656,40834:27667,40835:27668,40836:27675,40837:27684,40838:27683,40839:27742,40840:27733,40841:27746,40842:27754,40843:27778,40844:27789,40845:27802,40846:27777,40847:27803,40848:27774,40849:27752,40850:27763,40851:27794,40852:27792,40853:27844,40854:27889,40855:27859,40856:27837,40857:27863,40858:27845,40859:27869,40860:27822,40861:27825,40862:27838,40863:27834,40864:27867,40865:27887,40866:27865,40867:27882,40868:27935,40869:34893,40870:27958,40871:27947,40872:27965,40873:27960,40874:27929,40875:27957,40876:27955,40877:27922,40878:27916,40879:28003,40880:28051,40881:28004,40882:27994,40883:28025,40884:27993,40885:28046,40886:28053,40887:28644,40888:28037,40889:28153,40890:28181,40891:28170,40892:28085,40893:28103,40894:28134,40895:28088,40896:28102,40897:28140,40898:28126,40899:28108,40900:28136,40901:28114,40902:28101,40903:28154,40904:28121,40905:28132,40906:28117,40907:28138,40908:28142,40909:28205,40910:28270,40911:28206,40912:28185,40913:28274,40914:28255,40915:28222,40916:28195,40917:28267,40918:28203,40919:28278,40920:28237,40921:28191,40922:28227,40923:28218,40924:28238,40925:28196,40926:28415,40927:28189,40928:28216,40929:28290,40930:28330,40931:28312,40932:28361,40933:28343,40934:28371,40935:28349,40936:28335,40937:28356,40938:28338,40939:28372,40940:28373,40941:28303,40942:28325,40943:28354,40944:28319,40945:28481,40946:28433,40947:28748,40948:28396,40949:28408,40950:28414,40951:28479,40952:28402,40953:28465,40954:28399,40955:28466,40956:28364,161:65377,162:65378,163:65379,164:65380,165:65381,166:65382,167:65383,168:65384,169:65385,170:65386,171:65387,172:65388,173:65389,174:65390,175:65391,176:65392,177:65393,178:65394,179:65395,180:65396,181:65397,182:65398,183:65399,184:65400,185:65401,186:65402,187:65403,188:65404,189:65405,190:65406,191:65407,192:65408,193:65409,194:65410,195:65411,196:65412,197:65413,198:65414,199:65415,200:65416,201:65417,202:65418,203:65419,204:65420,205:65421,206:65422,207:65423,208:65424,209:65425,210:65426,211:65427,212:65428,213:65429,214:65430,215:65431,216:65432,217:65433,218:65434,219:65435,220:65436,221:65437,222:65438,223:65439,57408:28478,57409:28435,57410:28407,57411:28550,57412:28538,57413:28536,57414:28545,57415:28544,57416:28527,57417:28507,57418:28659,57419:28525,57420:28546,57421:28540,57422:28504,57423:28558,57424:28561,57425:28610,57426:28518,57427:28595,57428:28579,57429:28577,57430:28580,57431:28601,57432:28614,57433:28586,57434:28639,57435:28629,57436:28652,57437:28628,57438:28632,57439:28657,57440:28654,57441:28635,57442:28681,57443:28683,57444:28666,57445:28689,57446:28673,57447:28687,57448:28670,57449:28699,57450:28698,57451:28532,57452:28701,57453:28696,57454:28703,57455:28720,57456:28734,57457:28722,57458:28753,57459:28771,57460:28825,57461:28818,57462:28847,57463:28913,57464:28844,57465:28856,57466:28851,57467:28846,57468:28895,57469:28875,57470:28893,57472:28889,57473:28937,57474:28925,57475:28956,57476:28953,57477:29029,57478:29013,57479:29064,57480:29030,57481:29026,57482:29004,57483:29014,57484:29036,57485:29071,57486:29179,57487:29060,57488:29077,57489:29096,57490:29100,57491:29143,57492:29113,57493:29118,57494:29138,57495:29129,57496:29140,57497:29134,57498:29152,57499:29164,57500:29159,57501:29173,57502:29180,57503:29177,57504:29183,57505:29197,57506:29200,57507:29211,57508:29224,57509:29229,57510:29228,57511:29232,57512:29234,57513:29243,57514:29244,57515:29247,57516:29248,57517:29254,57518:29259,57519:29272,57520:29300,57521:29310,57522:29314,57523:29313,57524:29319,57525:29330,57526:29334,57527:29346,57528:29351,57529:29369,57530:29362,57531:29379,57532:29382,57533:29380,57534:29390,57535:29394,57536:29410,57537:29408,57538:29409,57539:29433,57540:29431,57541:20495,57542:29463,57543:29450,57544:29468,57545:29462,57546:29469,57547:29492,57548:29487,57549:29481,57550:29477,57551:29502,57552:29518,57553:29519,57554:40664,57555:29527,57556:29546,57557:29544,57558:29552,57559:29560,57560:29557,57561:29563,57562:29562,57563:29640,57564:29619,57565:29646,57566:29627,57567:29632,57568:29669,57569:29678,57570:29662,57571:29858,57572:29701,57573:29807,57574:29733,57575:29688,57576:29746,57577:29754,57578:29781,57579:29759,57580:29791,57581:29785,57582:29761,57583:29788,57584:29801,57585:29808,57586:29795,57587:29802,57588:29814,57589:29822,57590:29835,57591:29854,57592:29863,57593:29898,57594:29903,57595:29908,57596:29681,57664:29920,57665:29923,57666:29927,57667:29929,57668:29934,57669:29938,57670:29936,57671:29937,57672:29944,57673:29943,57674:29956,57675:29955,57676:29957,57677:29964,57678:29966,57679:29965,57680:29973,57681:29971,57682:29982,57683:29990,57684:29996,57685:30012,57686:30020,57687:30029,57688:30026,57689:30025,57690:30043,57691:30022,57692:30042,57693:30057,57694:30052,57695:30055,57696:30059,57697:30061,57698:30072,57699:30070,57700:30086,57701:30087,57702:30068,57703:30090,57704:30089,57705:30082,57706:30100,57707:30106,57708:30109,57709:30117,57710:30115,57711:30146,57712:30131,57713:30147,57714:30133,57715:30141,57716:30136,57717:30140,57718:30129,57719:30157,57720:30154,57721:30162,57722:30169,57723:30179,57724:30174,57725:30206,57726:30207,57728:30204,57729:30209,57730:30192,57731:30202,57732:30194,57733:30195,57734:30219,57735:30221,57736:30217,57737:30239,57738:30247,57739:30240,57740:30241,57741:30242,57742:30244,57743:30260,57744:30256,57745:30267,57746:30279,57747:30280,57748:30278,57749:30300,57750:30296,57751:30305,57752:30306,57753:30312,57754:30313,57755:30314,57756:30311,57757:30316,57758:30320,57759:30322,57760:30326,57761:30328,57762:30332,57763:30336,57764:30339,57765:30344,57766:30347,57767:30350,57768:30358,57769:30355,57770:30361,57771:30362,57772:30384,57773:30388,57774:30392,57775:30393,57776:30394,57777:30402,57778:30413,57779:30422,57780:30418,57781:30430,57782:30433,57783:30437,57784:30439,57785:30442,57786:34351,57787:30459,57788:30472,57789:30471,57790:30468,57791:30505,57792:30500,57793:30494,57794:30501,57795:30502,57796:30491,57797:30519,57798:30520,57799:30535,57800:30554,57801:30568,57802:30571,57803:30555,57804:30565,57805:30591,57806:30590,57807:30585,57808:30606,57809:30603,57810:30609,57811:30624,57812:30622,57813:30640,57814:30646,57815:30649,57816:30655,57817:30652,57818:30653,57819:30651,57820:30663,57821:30669,57822:30679,57823:30682,57824:30684,57825:30691,57826:30702,57827:30716,57828:30732,57829:30738,57830:31014,57831:30752,57832:31018,57833:30789,57834:30862,57835:30836,57836:30854,57837:30844,57838:30874,57839:30860,57840:30883,57841:30901,57842:30890,57843:30895,57844:30929,57845:30918,57846:30923,57847:30932,57848:30910,57849:30908,57850:30917,57851:30922,57852:30956,57920:30951,57921:30938,57922:30973,57923:30964,57924:30983,57925:30994,57926:30993,57927:31001,57928:31020,57929:31019,57930:31040,57931:31072,57932:31063,57933:31071,57934:31066,57935:31061,57936:31059,57937:31098,57938:31103,57939:31114,57940:31133,57941:31143,57942:40779,57943:31146,57944:31150,57945:31155,57946:31161,57947:31162,57948:31177,57949:31189,57950:31207,57951:31212,57952:31201,57953:31203,57954:31240,57955:31245,57956:31256,57957:31257,57958:31264,57959:31263,57960:31104,57961:31281,57962:31291,57963:31294,57964:31287,57965:31299,57966:31319,57967:31305,57968:31329,57969:31330,57970:31337,57971:40861,57972:31344,57973:31353,57974:31357,57975:31368,57976:31383,57977:31381,57978:31384,57979:31382,57980:31401,57981:31432,57982:31408,57984:31414,57985:31429,57986:31428,57987:31423,57988:36995,57989:31431,57990:31434,57991:31437,57992:31439,57993:31445,57994:31443,57995:31449,57996:31450,57997:31453,57998:31457,57999:31458,58e3:31462,58001:31469,58002:31472,58003:31490,58004:31503,58005:31498,58006:31494,58007:31539,58008:31512,58009:31513,58010:31518,58011:31541,58012:31528,58013:31542,58014:31568,58015:31610,58016:31492,58017:31565,58018:31499,58019:31564,58020:31557,58021:31605,58022:31589,58023:31604,58024:31591,58025:31600,58026:31601,58027:31596,58028:31598,58029:31645,58030:31640,58031:31647,58032:31629,58033:31644,58034:31642,58035:31627,58036:31634,58037:31631,58038:31581,58039:31641,58040:31691,58041:31681,58042:31692,58043:31695,58044:31668,58045:31686,58046:31709,58047:31721,58048:31761,58049:31764,58050:31718,58051:31717,58052:31840,58053:31744,58054:31751,58055:31763,58056:31731,58057:31735,58058:31767,58059:31757,58060:31734,58061:31779,58062:31783,58063:31786,58064:31775,58065:31799,58066:31787,58067:31805,58068:31820,58069:31811,58070:31828,58071:31823,58072:31808,58073:31824,58074:31832,58075:31839,58076:31844,58077:31830,58078:31845,58079:31852,58080:31861,58081:31875,58082:31888,58083:31908,58084:31917,58085:31906,58086:31915,58087:31905,58088:31912,58089:31923,58090:31922,58091:31921,58092:31918,58093:31929,58094:31933,58095:31936,58096:31941,58097:31938,58098:31960,58099:31954,58100:31964,58101:31970,58102:39739,58103:31983,58104:31986,58105:31988,58106:31990,58107:31994,58108:32006,58176:32002,58177:32028,58178:32021,58179:32010,58180:32069,58181:32075,58182:32046,58183:32050,58184:32063,58185:32053,58186:32070,58187:32115,58188:32086,58189:32078,58190:32114,58191:32104,58192:32110,58193:32079,58194:32099,58195:32147,58196:32137,58197:32091,58198:32143,58199:32125,58200:32155,58201:32186,58202:32174,58203:32163,58204:32181,58205:32199,58206:32189,58207:32171,58208:32317,58209:32162,58210:32175,58211:32220,58212:32184,58213:32159,58214:32176,58215:32216,58216:32221,58217:32228,58218:32222,58219:32251,58220:32242,58221:32225,58222:32261,58223:32266,58224:32291,58225:32289,58226:32274,58227:32305,58228:32287,58229:32265,58230:32267,58231:32290,58232:32326,58233:32358,58234:32315,58235:32309,58236:32313,58237:32323,58238:32311,58240:32306,58241:32314,58242:32359,58243:32349,58244:32342,58245:32350,58246:32345,58247:32346,58248:32377,58249:32362,58250:32361,58251:32380,58252:32379,58253:32387,58254:32213,58255:32381,58256:36782,58257:32383,58258:32392,58259:32393,58260:32396,58261:32402,58262:32400,58263:32403,58264:32404,58265:32406,58266:32398,58267:32411,58268:32412,58269:32568,58270:32570,58271:32581,58272:32588,58273:32589,58274:32590,58275:32592,58276:32593,58277:32597,58278:32596,58279:32600,58280:32607,58281:32608,58282:32616,58283:32617,58284:32615,58285:32632,58286:32642,58287:32646,58288:32643,58289:32648,58290:32647,58291:32652,58292:32660,58293:32670,58294:32669,58295:32666,58296:32675,58297:32687,58298:32690,58299:32697,58300:32686,58301:32694,58302:32696,58303:35697,58304:32709,58305:32710,58306:32714,58307:32725,58308:32724,58309:32737,58310:32742,58311:32745,58312:32755,58313:32761,58314:39132,58315:32774,58316:32772,58317:32779,58318:32786,58319:32792,58320:32793,58321:32796,58322:32801,58323:32808,58324:32831,58325:32827,58326:32842,58327:32838,58328:32850,58329:32856,58330:32858,58331:32863,58332:32866,58333:32872,58334:32883,58335:32882,58336:32880,58337:32886,58338:32889,58339:32893,58340:32895,58341:32900,58342:32902,58343:32901,58344:32923,58345:32915,58346:32922,58347:32941,58348:20880,58349:32940,58350:32987,58351:32997,58352:32985,58353:32989,58354:32964,58355:32986,58356:32982,58357:33033,58358:33007,58359:33009,58360:33051,58361:33065,58362:33059,58363:33071,58364:33099,58432:38539,58433:33094,58434:33086,58435:33107,58436:33105,58437:33020,58438:33137,58439:33134,58440:33125,58441:33126,58442:33140,58443:33155,58444:33160,58445:33162,58446:33152,58447:33154,58448:33184,58449:33173,58450:33188,58451:33187,58452:33119,58453:33171,58454:33193,58455:33200,58456:33205,58457:33214,58458:33208,58459:33213,58460:33216,58461:33218,58462:33210,58463:33225,58464:33229,58465:33233,58466:33241,58467:33240,58468:33224,58469:33242,58470:33247,58471:33248,58472:33255,58473:33274,58474:33275,58475:33278,58476:33281,58477:33282,58478:33285,58479:33287,58480:33290,58481:33293,58482:33296,58483:33302,58484:33321,58485:33323,58486:33336,58487:33331,58488:33344,58489:33369,58490:33368,58491:33373,58492:33370,58493:33375,58494:33380,58496:33378,58497:33384,58498:33386,58499:33387,58500:33326,58501:33393,58502:33399,58503:33400,58504:33406,58505:33421,58506:33426,58507:33451,58508:33439,58509:33467,58510:33452,58511:33505,58512:33507,58513:33503,58514:33490,58515:33524,58516:33523,58517:33530,58518:33683,58519:33539,58520:33531,58521:33529,58522:33502,58523:33542,58524:33500,58525:33545,58526:33497,58527:33589,58528:33588,58529:33558,58530:33586,58531:33585,58532:33600,58533:33593,58534:33616,58535:33605,58536:33583,58537:33579,58538:33559,58539:33560,58540:33669,58541:33690,58542:33706,58543:33695,58544:33698,58545:33686,58546:33571,58547:33678,58548:33671,58549:33674,58550:33660,58551:33717,58552:33651,58553:33653,58554:33696,58555:33673,58556:33704,58557:33780,58558:33811,58559:33771,58560:33742,58561:33789,58562:33795,58563:33752,58564:33803,58565:33729,58566:33783,58567:33799,58568:33760,58569:33778,58570:33805,58571:33826,58572:33824,58573:33725,58574:33848,58575:34054,58576:33787,58577:33901,58578:33834,58579:33852,58580:34138,58581:33924,58582:33911,58583:33899,58584:33965,58585:33902,58586:33922,58587:33897,58588:33862,58589:33836,58590:33903,58591:33913,58592:33845,58593:33994,58594:33890,58595:33977,58596:33983,58597:33951,58598:34009,58599:33997,58600:33979,58601:34010,58602:34e3,58603:33985,58604:33990,58605:34006,58606:33953,58607:34081,58608:34047,58609:34036,58610:34071,58611:34072,58612:34092,58613:34079,58614:34069,58615:34068,58616:34044,58617:34112,58618:34147,58619:34136,58620:34120,58688:34113,58689:34306,58690:34123,58691:34133,58692:34176,58693:34212,58694:34184,58695:34193,58696:34186,58697:34216,58698:34157,58699:34196,58700:34203,58701:34282,58702:34183,58703:34204,58704:34167,58705:34174,58706:34192,58707:34249,58708:34234,58709:34255,58710:34233,58711:34256,58712:34261,58713:34269,58714:34277,58715:34268,58716:34297,58717:34314,58718:34323,58719:34315,58720:34302,58721:34298,58722:34310,58723:34338,58724:34330,58725:34352,58726:34367,58727:34381,58728:20053,58729:34388,58730:34399,58731:34407,58732:34417,58733:34451,58734:34467,58735:34473,58736:34474,58737:34443,58738:34444,58739:34486,58740:34479,58741:34500,58742:34502,58743:34480,58744:34505,58745:34851,58746:34475,58747:34516,58748:34526,58749:34537,58750:34540,58752:34527,58753:34523,58754:34543,58755:34578,58756:34566,58757:34568,58758:34560,58759:34563,58760:34555,58761:34577,58762:34569,58763:34573,58764:34553,58765:34570,58766:34612,58767:34623,58768:34615,58769:34619,58770:34597,58771:34601,58772:34586,58773:34656,58774:34655,58775:34680,58776:34636,58777:34638,58778:34676,58779:34647,58780:34664,58781:34670,58782:34649,58783:34643,58784:34659,58785:34666,58786:34821,58787:34722,58788:34719,58789:34690,58790:34735,58791:34763,58792:34749,58793:34752,58794:34768,58795:38614,58796:34731,58797:34756,58798:34739,58799:34759,58800:34758,58801:34747,58802:34799,58803:34802,58804:34784,58805:34831,58806:34829,58807:34814,58808:34806,58809:34807,58810:34830,58811:34770,58812:34833,58813:34838,58814:34837,58815:34850,58816:34849,58817:34865,58818:34870,58819:34873,58820:34855,58821:34875,58822:34884,58823:34882,58824:34898,58825:34905,58826:34910,58827:34914,58828:34923,58829:34945,58830:34942,58831:34974,58832:34933,58833:34941,58834:34997,58835:34930,58836:34946,58837:34967,58838:34962,58839:34990,58840:34969,58841:34978,58842:34957,58843:34980,58844:34992,58845:35007,58846:34993,58847:35011,58848:35012,58849:35028,58850:35032,58851:35033,58852:35037,58853:35065,58854:35074,58855:35068,58856:35060,58857:35048,58858:35058,58859:35076,58860:35084,58861:35082,58862:35091,58863:35139,58864:35102,58865:35109,58866:35114,58867:35115,58868:35137,58869:35140,58870:35131,58871:35126,58872:35128,58873:35148,58874:35101,58875:35168,58876:35166,58944:35174,58945:35172,58946:35181,58947:35178,58948:35183,58949:35188,58950:35191,58951:35198,58952:35203,58953:35208,58954:35210,58955:35219,58956:35224,58957:35233,58958:35241,58959:35238,58960:35244,58961:35247,58962:35250,58963:35258,58964:35261,58965:35263,58966:35264,58967:35290,58968:35292,58969:35293,58970:35303,58971:35316,58972:35320,58973:35331,58974:35350,58975:35344,58976:35340,58977:35355,58978:35357,58979:35365,58980:35382,58981:35393,58982:35419,58983:35410,58984:35398,58985:35400,58986:35452,58987:35437,58988:35436,58989:35426,58990:35461,58991:35458,58992:35460,58993:35496,58994:35489,58995:35473,58996:35493,58997:35494,58998:35482,58999:35491,59e3:35524,59001:35533,59002:35522,59003:35546,59004:35563,59005:35571,59006:35559,59008:35556,59009:35569,59010:35604,59011:35552,59012:35554,59013:35575,59014:35550,59015:35547,59016:35596,59017:35591,59018:35610,59019:35553,59020:35606,59021:35600,59022:35607,59023:35616,59024:35635,59025:38827,59026:35622,59027:35627,59028:35646,59029:35624,59030:35649,59031:35660,59032:35663,59033:35662,59034:35657,59035:35670,59036:35675,59037:35674,59038:35691,59039:35679,59040:35692,59041:35695,59042:35700,59043:35709,59044:35712,59045:35724,59046:35726,59047:35730,59048:35731,59049:35734,59050:35737,59051:35738,59052:35898,59053:35905,59054:35903,59055:35912,59056:35916,59057:35918,59058:35920,59059:35925,59060:35938,59061:35948,59062:35960,59063:35962,59064:35970,59065:35977,59066:35973,59067:35978,59068:35981,59069:35982,59070:35988,59071:35964,59072:35992,59073:25117,59074:36013,59075:36010,59076:36029,59077:36018,59078:36019,59079:36014,59080:36022,59081:36040,59082:36033,59083:36068,59084:36067,59085:36058,59086:36093,59087:36090,59088:36091,59089:36100,59090:36101,59091:36106,59092:36103,59093:36111,59094:36109,59095:36112,59096:40782,59097:36115,59098:36045,59099:36116,59100:36118,59101:36199,59102:36205,59103:36209,59104:36211,59105:36225,59106:36249,59107:36290,59108:36286,59109:36282,59110:36303,59111:36314,59112:36310,59113:36300,59114:36315,59115:36299,59116:36330,59117:36331,59118:36319,59119:36323,59120:36348,59121:36360,59122:36361,59123:36351,59124:36381,59125:36382,59126:36368,59127:36383,59128:36418,59129:36405,59130:36400,59131:36404,59132:36426,59200:36423,59201:36425,59202:36428,59203:36432,59204:36424,59205:36441,59206:36452,59207:36448,59208:36394,59209:36451,59210:36437,59211:36470,59212:36466,59213:36476,59214:36481,59215:36487,59216:36485,59217:36484,59218:36491,59219:36490,59220:36499,59221:36497,59222:36500,59223:36505,59224:36522,59225:36513,59226:36524,59227:36528,59228:36550,59229:36529,59230:36542,59231:36549,59232:36552,59233:36555,59234:36571,59235:36579,59236:36604,59237:36603,59238:36587,59239:36606,59240:36618,59241:36613,59242:36629,59243:36626,59244:36633,59245:36627,59246:36636,59247:36639,59248:36635,59249:36620,59250:36646,59251:36659,59252:36667,59253:36665,59254:36677,59255:36674,59256:36670,59257:36684,59258:36681,59259:36678,59260:36686,59261:36695,59262:36700,59264:36706,59265:36707,59266:36708,59267:36764,59268:36767,59269:36771,59270:36781,59271:36783,59272:36791,59273:36826,59274:36837,59275:36834,59276:36842,59277:36847,59278:36999,59279:36852,59280:36869,59281:36857,59282:36858,59283:36881,59284:36885,59285:36897,59286:36877,59287:36894,59288:36886,59289:36875,59290:36903,59291:36918,59292:36917,59293:36921,59294:36856,59295:36943,59296:36944,59297:36945,59298:36946,59299:36878,59300:36937,59301:36926,59302:36950,59303:36952,59304:36958,59305:36968,59306:36975,59307:36982,59308:38568,59309:36978,59310:36994,59311:36989,59312:36993,59313:36992,59314:37002,59315:37001,59316:37007,59317:37032,59318:37039,59319:37041,59320:37045,59321:37090,59322:37092,59323:25160,59324:37083,59325:37122,59326:37138,59327:37145,59328:37170,59329:37168,59330:37194,59331:37206,59332:37208,59333:37219,59334:37221,59335:37225,59336:37235,59337:37234,59338:37259,59339:37257,59340:37250,59341:37282,59342:37291,59343:37295,59344:37290,59345:37301,59346:37300,59347:37306,59348:37312,59349:37313,59350:37321,59351:37323,59352:37328,59353:37334,59354:37343,59355:37345,59356:37339,59357:37372,59358:37365,59359:37366,59360:37406,59361:37375,59362:37396,59363:37420,59364:37397,59365:37393,59366:37470,59367:37463,59368:37445,59369:37449,59370:37476,59371:37448,59372:37525,59373:37439,59374:37451,59375:37456,59376:37532,59377:37526,59378:37523,59379:37531,59380:37466,59381:37583,59382:37561,59383:37559,59384:37609,59385:37647,59386:37626,59387:37700,59388:37678,59456:37657,59457:37666,59458:37658,59459:37667,59460:37690,59461:37685,59462:37691,59463:37724,59464:37728,59465:37756,59466:37742,59467:37718,59468:37808,59469:37804,59470:37805,59471:37780,59472:37817,59473:37846,59474:37847,59475:37864,59476:37861,59477:37848,59478:37827,59479:37853,59480:37840,59481:37832,59482:37860,59483:37914,59484:37908,59485:37907,59486:37891,59487:37895,59488:37904,59489:37942,59490:37931,59491:37941,59492:37921,59493:37946,59494:37953,59495:37970,59496:37956,59497:37979,59498:37984,59499:37986,59500:37982,59501:37994,59502:37417,59503:38e3,59504:38005,59505:38007,59506:38013,59507:37978,59508:38012,59509:38014,59510:38017,59511:38015,59512:38274,59513:38279,59514:38282,59515:38292,59516:38294,59517:38296,59518:38297,59520:38304,59521:38312,59522:38311,59523:38317,59524:38332,59525:38331,59526:38329,59527:38334,59528:38346,59529:28662,59530:38339,59531:38349,59532:38348,59533:38357,59534:38356,59535:38358,59536:38364,59537:38369,59538:38373,59539:38370,59540:38433,59541:38440,59542:38446,59543:38447,59544:38466,59545:38476,59546:38479,59547:38475,59548:38519,59549:38492,59550:38494,59551:38493,59552:38495,59553:38502,59554:38514,59555:38508,59556:38541,59557:38552,59558:38549,59559:38551,59560:38570,59561:38567,59562:38577,59563:38578,59564:38576,59565:38580,59566:38582,59567:38584,59568:38585,59569:38606,59570:38603,59571:38601,59572:38605,59573:35149,59574:38620,59575:38669,59576:38613,59577:38649,59578:38660,59579:38662,59580:38664,59581:38675,59582:38670,59583:38673,59584:38671,59585:38678,59586:38681,59587:38692,59588:38698,59589:38704,59590:38713,59591:38717,59592:38718,59593:38724,59594:38726,59595:38728,59596:38722,59597:38729,59598:38748,59599:38752,59600:38756,59601:38758,59602:38760,59603:21202,59604:38763,59605:38769,59606:38777,59607:38789,59608:38780,59609:38785,59610:38778,59611:38790,59612:38795,59613:38799,59614:38800,59615:38812,59616:38824,59617:38822,59618:38819,59619:38835,59620:38836,59621:38851,59622:38854,59623:38856,59624:38859,59625:38876,59626:38893,59627:40783,59628:38898,59629:31455,59630:38902,59631:38901,59632:38927,59633:38924,59634:38968,59635:38948,59636:38945,59637:38967,59638:38973,59639:38982,59640:38991,59641:38987,59642:39019,59643:39023,59644:39024,59712:39025,59713:39028,59714:39027,59715:39082,59716:39087,59717:39089,59718:39094,59719:39108,59720:39107,59721:39110,59722:39145,59723:39147,59724:39171,59725:39177,59726:39186,59727:39188,59728:39192,59729:39201,59730:39197,59731:39198,59732:39204,59733:39200,59734:39212,59735:39214,59736:39229,59737:39230,59738:39234,59739:39241,59740:39237,59741:39248,59742:39243,59743:39249,59744:39250,59745:39244,59746:39253,59747:39319,59748:39320,59749:39333,59750:39341,59751:39342,59752:39356,59753:39391,59754:39387,59755:39389,59756:39384,59757:39377,59758:39405,59759:39406,59760:39409,59761:39410,59762:39419,59763:39416,59764:39425,59765:39439,59766:39429,59767:39394,59768:39449,59769:39467,59770:39479,59771:39493,59772:39490,59773:39488,59774:39491,59776:39486,59777:39509,59778:39501,59779:39515,59780:39511,59781:39519,59782:39522,59783:39525,59784:39524,59785:39529,59786:39531,59787:39530,59788:39597,59789:39600,59790:39612,59791:39616,59792:39631,59793:39633,59794:39635,59795:39636,59796:39646,59797:39647,59798:39650,59799:39651,59800:39654,59801:39663,59802:39659,59803:39662,59804:39668,59805:39665,59806:39671,59807:39675,59808:39686,59809:39704,59810:39706,59811:39711,59812:39714,59813:39715,59814:39717,59815:39719,59816:39720,59817:39721,59818:39722,59819:39726,59820:39727,59821:39730,59822:39748,59823:39747,59824:39759,59825:39757,59826:39758,59827:39761,59828:39768,59829:39796,59830:39827,59831:39811,59832:39825,59833:39830,59834:39831,59835:39839,59836:39840,59837:39848,59838:39860,59839:39872,59840:39882,59841:39865,59842:39878,59843:39887,59844:39889,59845:39890,59846:39907,59847:39906,59848:39908,59849:39892,59850:39905,59851:39994,59852:39922,59853:39921,59854:39920,59855:39957,59856:39956,59857:39945,59858:39955,59859:39948,59860:39942,59861:39944,59862:39954,59863:39946,59864:39940,59865:39982,59866:39963,59867:39973,59868:39972,59869:39969,59870:39984,59871:40007,59872:39986,59873:40006,59874:39998,59875:40026,59876:40032,59877:40039,59878:40054,59879:40056,59880:40167,59881:40172,59882:40176,59883:40201,59884:40200,59885:40171,59886:40195,59887:40198,59888:40234,59889:40230,59890:40367,59891:40227,59892:40223,59893:40260,59894:40213,59895:40210,59896:40257,59897:40255,59898:40254,59899:40262,59900:40264,59968:40285,59969:40286,59970:40292,59971:40273,59972:40272,59973:40281,59974:40306,59975:40329,59976:40327,59977:40363,59978:40303,59979:40314,59980:40346,59981:40356,59982:40361,59983:40370,59984:40388,59985:40385,59986:40379,59987:40376,59988:40378,59989:40390,59990:40399,59991:40386,59992:40409,59993:40403,59994:40440,59995:40422,59996:40429,59997:40431,59998:40445,59999:40474,6e4:40475,60001:40478,60002:40565,60003:40569,60004:40573,60005:40577,60006:40584,60007:40587,60008:40588,60009:40594,60010:40597,60011:40593,60012:40605,60013:40613,60014:40617,60015:40632,60016:40618,60017:40621,60018:38753,60019:40652,60020:40654,60021:40655,60022:40656,60023:40660,60024:40668,60025:40670,60026:40669,60027:40672,60028:40677,60029:40680,60030:40687,60032:40692,60033:40694,60034:40695,60035:40697,60036:40699,60037:40700,60038:40701,60039:40711,60040:40712,60041:30391,60042:40725,60043:40737,60044:40748,60045:40766,60046:40778,60047:40786,60048:40788,60049:40803,60050:40799,60051:40800,60052:40801,60053:40806,60054:40807,60055:40812,60056:40810,60057:40823,60058:40818,60059:40822,60060:40853,60061:40860,60062:40864,60063:22575,60064:27079,60065:36953,60066:29796,60067:20956,60068:29081}},function(s,a,_){Object.defineProperty(a,"__esModule",{value:!0});var $=_(1),rt=_(2);function c(St,At,Pt,Vt){var Bt;At.degree()<Pt.degree()&&(Bt=[Pt,At],At=Bt[0],Pt=Bt[1]);for(var Zt=At,zt=Pt,Ut=St.zero,Nt=St.one;zt.degree()>=Vt/2;){var Gt=Zt,er=Ut;if(Zt=zt,Ut=Nt,Zt.isZero())return null;zt=Gt;for(var ir=St.zero,or=Zt.getCoefficient(Zt.degree()),mr=St.inverse(or);zt.degree()>=Zt.degree()&&!zt.isZero();){var Rr=zt.degree()-Zt.degree(),on=St.multiply(zt.getCoefficient(zt.degree()),mr);ir=ir.addOrSubtract(St.buildMonomial(Rr,on)),zt=zt.addOrSubtract(Zt.multiplyByMonomial(Rr,on))}if(Nt=ir.multiplyPoly(Ut).addOrSubtract(er),zt.degree()>=Zt.degree())return null}var un=Nt.getCoefficient(0);if(un===0)return null;var jr=St.inverse(un);return[Nt.multiply(jr),zt.multiply(jr)]}function dt(St,At){var Pt=At.degree();if(Pt===1)return[At.getCoefficient(1)];for(var Vt=new Array(Pt),Bt=0,Zt=1;Zt<St.size&&Bt<Pt;Zt++)At.evaluateAt(Zt)===0&&(Vt[Bt]=St.inverse(Zt),Bt++);return Bt!==Pt?null:Vt}function ht(St,At,Pt){for(var Vt=Pt.length,Bt=new Array(Vt),Zt=0;Zt<Vt;Zt++){for(var zt=St.inverse(Pt[Zt]),Ut=1,Nt=0;Nt<Vt;Nt++)Zt!==Nt&&(Ut=St.multiply(Ut,$.addOrSubtractGF(1,St.multiply(Pt[Nt],zt))));Bt[Zt]=St.multiply(At.evaluateAt(zt),St.inverse(Ut)),St.generatorBase!==0&&(Bt[Zt]=St.multiply(Bt[Zt],zt))}return Bt}function Et(St,At){var Pt=new Uint8ClampedArray(St.length);Pt.set(St);for(var Vt=new $.default(285,256,0),Bt=new rt.default(Vt,Pt),Zt=new Uint8ClampedArray(At),zt=!1,Ut=0;Ut<At;Ut++){var Nt=Bt.evaluateAt(Vt.exp(Ut+Vt.generatorBase));Zt[Zt.length-1-Ut]=Nt,Nt!==0&&(zt=!0)}if(!zt)return Pt;var Gt=new rt.default(Vt,Zt),er=c(Vt,Vt.buildMonomial(At,1),Gt,At);if(er===null)return null;var ir=dt(Vt,er[0]);if(ir==null)return null;for(var or=ht(Vt,er[1],ir),mr=0;mr<ir.length;mr++){var Rr=Pt.length-1-Vt.log(ir[mr]);if(Rr<0)return null;Pt[Rr]=$.addOrSubtractGF(Pt[Rr],or[mr])}return Pt}a.decode=Et},function(s,a,_){Object.defineProperty(a,"__esModule",{value:!0}),a.VERSIONS=[{infoBits:null,versionNumber:1,alignmentPatternCenters:[],errorCorrectionLevels:[{ecCodewordsPerBlock:7,ecBlocks:[{numBlocks:1,dataCodewordsPerBlock:19}]},{ecCodewordsPerBlock:10,ecBlocks:[{numBlocks:1,dataCodewordsPerBlock:16}]},{ecCodewordsPerBlock:13,ecBlocks:[{numBlocks:1,dataCodewordsPerBlock:13}]},{ecCodewordsPerBlock:17,ecBlocks:[{numBlocks:1,dataCodewordsPerBlock:9}]}]},{infoBits:null,versionNumber:2,alignmentPatternCenters:[6,18],errorCorrectionLevels:[{ecCodewordsPerBlock:10,ecBlocks:[{numBlocks:1,dataCodewordsPerBlock:34}]},{ecCodewordsPerBlock:16,ecBlocks:[{numBlocks:1,dataCodewordsPerBlock:28}]},{ecCodewordsPerBlock:22,ecBlocks:[{numBlocks:1,dataCodewordsPerBlock:22}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:1,dataCodewordsPerBlock:16}]}]},{infoBits:null,versionNumber:3,alignmentPatternCenters:[6,22],errorCorrectionLevels:[{ecCodewordsPerBlock:15,ecBlocks:[{numBlocks:1,dataCodewordsPerBlock:55}]},{ecCodewordsPerBlock:26,ecBlocks:[{numBlocks:1,dataCodewordsPerBlock:44}]},{ecCodewordsPerBlock:18,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:17}]},{ecCodewordsPerBlock:22,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:13}]}]},{infoBits:null,versionNumber:4,alignmentPatternCenters:[6,26],errorCorrectionLevels:[{ecCodewordsPerBlock:20,ecBlocks:[{numBlocks:1,dataCodewordsPerBlock:80}]},{ecCodewordsPerBlock:18,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:32}]},{ecCodewordsPerBlock:26,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:24}]},{ecCodewordsPerBlock:16,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:9}]}]},{infoBits:null,versionNumber:5,alignmentPatternCenters:[6,30],errorCorrectionLevels:[{ecCodewordsPerBlock:26,ecBlocks:[{numBlocks:1,dataCodewordsPerBlock:108}]},{ecCodewordsPerBlock:24,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:43}]},{ecCodewordsPerBlock:18,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:15},{numBlocks:2,dataCodewordsPerBlock:16}]},{ecCodewordsPerBlock:22,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:11},{numBlocks:2,dataCodewordsPerBlock:12}]}]},{infoBits:null,versionNumber:6,alignmentPatternCenters:[6,34],errorCorrectionLevels:[{ecCodewordsPerBlock:18,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:68}]},{ecCodewordsPerBlock:16,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:27}]},{ecCodewordsPerBlock:24,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:19}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:15}]}]},{infoBits:31892,versionNumber:7,alignmentPatternCenters:[6,22,38],errorCorrectionLevels:[{ecCodewordsPerBlock:20,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:78}]},{ecCodewordsPerBlock:18,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:31}]},{ecCodewordsPerBlock:18,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:14},{numBlocks:4,dataCodewordsPerBlock:15}]},{ecCodewordsPerBlock:26,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:13},{numBlocks:1,dataCodewordsPerBlock:14}]}]},{infoBits:34236,versionNumber:8,alignmentPatternCenters:[6,24,42],errorCorrectionLevels:[{ecCodewordsPerBlock:24,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:97}]},{ecCodewordsPerBlock:22,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:38},{numBlocks:2,dataCodewordsPerBlock:39}]},{ecCodewordsPerBlock:22,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:18},{numBlocks:2,dataCodewordsPerBlock:19}]},{ecCodewordsPerBlock:26,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:14},{numBlocks:2,dataCodewordsPerBlock:15}]}]},{infoBits:39577,versionNumber:9,alignmentPatternCenters:[6,26,46],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:116}]},{ecCodewordsPerBlock:22,ecBlocks:[{numBlocks:3,dataCodewordsPerBlock:36},{numBlocks:2,dataCodewordsPerBlock:37}]},{ecCodewordsPerBlock:20,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:16},{numBlocks:4,dataCodewordsPerBlock:17}]},{ecCodewordsPerBlock:24,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:12},{numBlocks:4,dataCodewordsPerBlock:13}]}]},{infoBits:42195,versionNumber:10,alignmentPatternCenters:[6,28,50],errorCorrectionLevels:[{ecCodewordsPerBlock:18,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:68},{numBlocks:2,dataCodewordsPerBlock:69}]},{ecCodewordsPerBlock:26,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:43},{numBlocks:1,dataCodewordsPerBlock:44}]},{ecCodewordsPerBlock:24,ecBlocks:[{numBlocks:6,dataCodewordsPerBlock:19},{numBlocks:2,dataCodewordsPerBlock:20}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:6,dataCodewordsPerBlock:15},{numBlocks:2,dataCodewordsPerBlock:16}]}]},{infoBits:48118,versionNumber:11,alignmentPatternCenters:[6,30,54],errorCorrectionLevels:[{ecCodewordsPerBlock:20,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:81}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:1,dataCodewordsPerBlock:50},{numBlocks:4,dataCodewordsPerBlock:51}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:22},{numBlocks:4,dataCodewordsPerBlock:23}]},{ecCodewordsPerBlock:24,ecBlocks:[{numBlocks:3,dataCodewordsPerBlock:12},{numBlocks:8,dataCodewordsPerBlock:13}]}]},{infoBits:51042,versionNumber:12,alignmentPatternCenters:[6,32,58],errorCorrectionLevels:[{ecCodewordsPerBlock:24,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:92},{numBlocks:2,dataCodewordsPerBlock:93}]},{ecCodewordsPerBlock:22,ecBlocks:[{numBlocks:6,dataCodewordsPerBlock:36},{numBlocks:2,dataCodewordsPerBlock:37}]},{ecCodewordsPerBlock:26,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:20},{numBlocks:6,dataCodewordsPerBlock:21}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:7,dataCodewordsPerBlock:14},{numBlocks:4,dataCodewordsPerBlock:15}]}]},{infoBits:55367,versionNumber:13,alignmentPatternCenters:[6,34,62],errorCorrectionLevels:[{ecCodewordsPerBlock:26,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:107}]},{ecCodewordsPerBlock:22,ecBlocks:[{numBlocks:8,dataCodewordsPerBlock:37},{numBlocks:1,dataCodewordsPerBlock:38}]},{ecCodewordsPerBlock:24,ecBlocks:[{numBlocks:8,dataCodewordsPerBlock:20},{numBlocks:4,dataCodewordsPerBlock:21}]},{ecCodewordsPerBlock:22,ecBlocks:[{numBlocks:12,dataCodewordsPerBlock:11},{numBlocks:4,dataCodewordsPerBlock:12}]}]},{infoBits:58893,versionNumber:14,alignmentPatternCenters:[6,26,46,66],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:3,dataCodewordsPerBlock:115},{numBlocks:1,dataCodewordsPerBlock:116}]},{ecCodewordsPerBlock:24,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:40},{numBlocks:5,dataCodewordsPerBlock:41}]},{ecCodewordsPerBlock:20,ecBlocks:[{numBlocks:11,dataCodewordsPerBlock:16},{numBlocks:5,dataCodewordsPerBlock:17}]},{ecCodewordsPerBlock:24,ecBlocks:[{numBlocks:11,dataCodewordsPerBlock:12},{numBlocks:5,dataCodewordsPerBlock:13}]}]},{infoBits:63784,versionNumber:15,alignmentPatternCenters:[6,26,48,70],errorCorrectionLevels:[{ecCodewordsPerBlock:22,ecBlocks:[{numBlocks:5,dataCodewordsPerBlock:87},{numBlocks:1,dataCodewordsPerBlock:88}]},{ecCodewordsPerBlock:24,ecBlocks:[{numBlocks:5,dataCodewordsPerBlock:41},{numBlocks:5,dataCodewordsPerBlock:42}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:5,dataCodewordsPerBlock:24},{numBlocks:7,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:24,ecBlocks:[{numBlocks:11,dataCodewordsPerBlock:12},{numBlocks:7,dataCodewordsPerBlock:13}]}]},{infoBits:68472,versionNumber:16,alignmentPatternCenters:[6,26,50,74],errorCorrectionLevels:[{ecCodewordsPerBlock:24,ecBlocks:[{numBlocks:5,dataCodewordsPerBlock:98},{numBlocks:1,dataCodewordsPerBlock:99}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:7,dataCodewordsPerBlock:45},{numBlocks:3,dataCodewordsPerBlock:46}]},{ecCodewordsPerBlock:24,ecBlocks:[{numBlocks:15,dataCodewordsPerBlock:19},{numBlocks:2,dataCodewordsPerBlock:20}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:3,dataCodewordsPerBlock:15},{numBlocks:13,dataCodewordsPerBlock:16}]}]},{infoBits:70749,versionNumber:17,alignmentPatternCenters:[6,30,54,78],errorCorrectionLevels:[{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:1,dataCodewordsPerBlock:107},{numBlocks:5,dataCodewordsPerBlock:108}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:10,dataCodewordsPerBlock:46},{numBlocks:1,dataCodewordsPerBlock:47}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:1,dataCodewordsPerBlock:22},{numBlocks:15,dataCodewordsPerBlock:23}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:14},{numBlocks:17,dataCodewordsPerBlock:15}]}]},{infoBits:76311,versionNumber:18,alignmentPatternCenters:[6,30,56,82],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:5,dataCodewordsPerBlock:120},{numBlocks:1,dataCodewordsPerBlock:121}]},{ecCodewordsPerBlock:26,ecBlocks:[{numBlocks:9,dataCodewordsPerBlock:43},{numBlocks:4,dataCodewordsPerBlock:44}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:17,dataCodewordsPerBlock:22},{numBlocks:1,dataCodewordsPerBlock:23}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:14},{numBlocks:19,dataCodewordsPerBlock:15}]}]},{infoBits:79154,versionNumber:19,alignmentPatternCenters:[6,30,58,86],errorCorrectionLevels:[{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:3,dataCodewordsPerBlock:113},{numBlocks:4,dataCodewordsPerBlock:114}]},{ecCodewordsPerBlock:26,ecBlocks:[{numBlocks:3,dataCodewordsPerBlock:44},{numBlocks:11,dataCodewordsPerBlock:45}]},{ecCodewordsPerBlock:26,ecBlocks:[{numBlocks:17,dataCodewordsPerBlock:21},{numBlocks:4,dataCodewordsPerBlock:22}]},{ecCodewordsPerBlock:26,ecBlocks:[{numBlocks:9,dataCodewordsPerBlock:13},{numBlocks:16,dataCodewordsPerBlock:14}]}]},{infoBits:84390,versionNumber:20,alignmentPatternCenters:[6,34,62,90],errorCorrectionLevels:[{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:3,dataCodewordsPerBlock:107},{numBlocks:5,dataCodewordsPerBlock:108}]},{ecCodewordsPerBlock:26,ecBlocks:[{numBlocks:3,dataCodewordsPerBlock:41},{numBlocks:13,dataCodewordsPerBlock:42}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:15,dataCodewordsPerBlock:24},{numBlocks:5,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:15,dataCodewordsPerBlock:15},{numBlocks:10,dataCodewordsPerBlock:16}]}]},{infoBits:87683,versionNumber:21,alignmentPatternCenters:[6,28,50,72,94],errorCorrectionLevels:[{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:116},{numBlocks:4,dataCodewordsPerBlock:117}]},{ecCodewordsPerBlock:26,ecBlocks:[{numBlocks:17,dataCodewordsPerBlock:42}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:17,dataCodewordsPerBlock:22},{numBlocks:6,dataCodewordsPerBlock:23}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:19,dataCodewordsPerBlock:16},{numBlocks:6,dataCodewordsPerBlock:17}]}]},{infoBits:92361,versionNumber:22,alignmentPatternCenters:[6,26,50,74,98],errorCorrectionLevels:[{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:111},{numBlocks:7,dataCodewordsPerBlock:112}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:17,dataCodewordsPerBlock:46}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:7,dataCodewordsPerBlock:24},{numBlocks:16,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:24,ecBlocks:[{numBlocks:34,dataCodewordsPerBlock:13}]}]},{infoBits:96236,versionNumber:23,alignmentPatternCenters:[6,30,54,74,102],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:121},{numBlocks:5,dataCodewordsPerBlock:122}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:47},{numBlocks:14,dataCodewordsPerBlock:48}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:11,dataCodewordsPerBlock:24},{numBlocks:14,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:16,dataCodewordsPerBlock:15},{numBlocks:14,dataCodewordsPerBlock:16}]}]},{infoBits:102084,versionNumber:24,alignmentPatternCenters:[6,28,54,80,106],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:6,dataCodewordsPerBlock:117},{numBlocks:4,dataCodewordsPerBlock:118}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:6,dataCodewordsPerBlock:45},{numBlocks:14,dataCodewordsPerBlock:46}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:11,dataCodewordsPerBlock:24},{numBlocks:16,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:30,dataCodewordsPerBlock:16},{numBlocks:2,dataCodewordsPerBlock:17}]}]},{infoBits:102881,versionNumber:25,alignmentPatternCenters:[6,32,58,84,110],errorCorrectionLevels:[{ecCodewordsPerBlock:26,ecBlocks:[{numBlocks:8,dataCodewordsPerBlock:106},{numBlocks:4,dataCodewordsPerBlock:107}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:8,dataCodewordsPerBlock:47},{numBlocks:13,dataCodewordsPerBlock:48}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:7,dataCodewordsPerBlock:24},{numBlocks:22,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:22,dataCodewordsPerBlock:15},{numBlocks:13,dataCodewordsPerBlock:16}]}]},{infoBits:110507,versionNumber:26,alignmentPatternCenters:[6,30,58,86,114],errorCorrectionLevels:[{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:10,dataCodewordsPerBlock:114},{numBlocks:2,dataCodewordsPerBlock:115}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:19,dataCodewordsPerBlock:46},{numBlocks:4,dataCodewordsPerBlock:47}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:28,dataCodewordsPerBlock:22},{numBlocks:6,dataCodewordsPerBlock:23}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:33,dataCodewordsPerBlock:16},{numBlocks:4,dataCodewordsPerBlock:17}]}]},{infoBits:110734,versionNumber:27,alignmentPatternCenters:[6,34,62,90,118],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:8,dataCodewordsPerBlock:122},{numBlocks:4,dataCodewordsPerBlock:123}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:22,dataCodewordsPerBlock:45},{numBlocks:3,dataCodewordsPerBlock:46}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:8,dataCodewordsPerBlock:23},{numBlocks:26,dataCodewordsPerBlock:24}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:12,dataCodewordsPerBlock:15},{numBlocks:28,dataCodewordsPerBlock:16}]}]},{infoBits:117786,versionNumber:28,alignmentPatternCenters:[6,26,50,74,98,122],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:3,dataCodewordsPerBlock:117},{numBlocks:10,dataCodewordsPerBlock:118}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:3,dataCodewordsPerBlock:45},{numBlocks:23,dataCodewordsPerBlock:46}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:24},{numBlocks:31,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:11,dataCodewordsPerBlock:15},{numBlocks:31,dataCodewordsPerBlock:16}]}]},{infoBits:119615,versionNumber:29,alignmentPatternCenters:[6,30,54,78,102,126],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:7,dataCodewordsPerBlock:116},{numBlocks:7,dataCodewordsPerBlock:117}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:21,dataCodewordsPerBlock:45},{numBlocks:7,dataCodewordsPerBlock:46}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:1,dataCodewordsPerBlock:23},{numBlocks:37,dataCodewordsPerBlock:24}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:19,dataCodewordsPerBlock:15},{numBlocks:26,dataCodewordsPerBlock:16}]}]},{infoBits:126325,versionNumber:30,alignmentPatternCenters:[6,26,52,78,104,130],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:5,dataCodewordsPerBlock:115},{numBlocks:10,dataCodewordsPerBlock:116}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:19,dataCodewordsPerBlock:47},{numBlocks:10,dataCodewordsPerBlock:48}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:15,dataCodewordsPerBlock:24},{numBlocks:25,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:23,dataCodewordsPerBlock:15},{numBlocks:25,dataCodewordsPerBlock:16}]}]},{infoBits:127568,versionNumber:31,alignmentPatternCenters:[6,30,56,82,108,134],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:13,dataCodewordsPerBlock:115},{numBlocks:3,dataCodewordsPerBlock:116}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:46},{numBlocks:29,dataCodewordsPerBlock:47}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:42,dataCodewordsPerBlock:24},{numBlocks:1,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:23,dataCodewordsPerBlock:15},{numBlocks:28,dataCodewordsPerBlock:16}]}]},{infoBits:133589,versionNumber:32,alignmentPatternCenters:[6,34,60,86,112,138],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:17,dataCodewordsPerBlock:115}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:10,dataCodewordsPerBlock:46},{numBlocks:23,dataCodewordsPerBlock:47}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:10,dataCodewordsPerBlock:24},{numBlocks:35,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:19,dataCodewordsPerBlock:15},{numBlocks:35,dataCodewordsPerBlock:16}]}]},{infoBits:136944,versionNumber:33,alignmentPatternCenters:[6,30,58,86,114,142],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:17,dataCodewordsPerBlock:115},{numBlocks:1,dataCodewordsPerBlock:116}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:14,dataCodewordsPerBlock:46},{numBlocks:21,dataCodewordsPerBlock:47}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:29,dataCodewordsPerBlock:24},{numBlocks:19,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:11,dataCodewordsPerBlock:15},{numBlocks:46,dataCodewordsPerBlock:16}]}]},{infoBits:141498,versionNumber:34,alignmentPatternCenters:[6,34,62,90,118,146],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:13,dataCodewordsPerBlock:115},{numBlocks:6,dataCodewordsPerBlock:116}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:14,dataCodewordsPerBlock:46},{numBlocks:23,dataCodewordsPerBlock:47}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:44,dataCodewordsPerBlock:24},{numBlocks:7,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:59,dataCodewordsPerBlock:16},{numBlocks:1,dataCodewordsPerBlock:17}]}]},{infoBits:145311,versionNumber:35,alignmentPatternCenters:[6,30,54,78,102,126,150],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:12,dataCodewordsPerBlock:121},{numBlocks:7,dataCodewordsPerBlock:122}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:12,dataCodewordsPerBlock:47},{numBlocks:26,dataCodewordsPerBlock:48}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:39,dataCodewordsPerBlock:24},{numBlocks:14,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:22,dataCodewordsPerBlock:15},{numBlocks:41,dataCodewordsPerBlock:16}]}]},{infoBits:150283,versionNumber:36,alignmentPatternCenters:[6,24,50,76,102,128,154],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:6,dataCodewordsPerBlock:121},{numBlocks:14,dataCodewordsPerBlock:122}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:6,dataCodewordsPerBlock:47},{numBlocks:34,dataCodewordsPerBlock:48}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:46,dataCodewordsPerBlock:24},{numBlocks:10,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:15},{numBlocks:64,dataCodewordsPerBlock:16}]}]},{infoBits:152622,versionNumber:37,alignmentPatternCenters:[6,28,54,80,106,132,158],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:17,dataCodewordsPerBlock:122},{numBlocks:4,dataCodewordsPerBlock:123}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:29,dataCodewordsPerBlock:46},{numBlocks:14,dataCodewordsPerBlock:47}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:49,dataCodewordsPerBlock:24},{numBlocks:10,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:24,dataCodewordsPerBlock:15},{numBlocks:46,dataCodewordsPerBlock:16}]}]},{infoBits:158308,versionNumber:38,alignmentPatternCenters:[6,32,58,84,110,136,162],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:122},{numBlocks:18,dataCodewordsPerBlock:123}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:13,dataCodewordsPerBlock:46},{numBlocks:32,dataCodewordsPerBlock:47}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:48,dataCodewordsPerBlock:24},{numBlocks:14,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:42,dataCodewordsPerBlock:15},{numBlocks:32,dataCodewordsPerBlock:16}]}]},{infoBits:161089,versionNumber:39,alignmentPatternCenters:[6,26,54,82,110,138,166],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:20,dataCodewordsPerBlock:117},{numBlocks:4,dataCodewordsPerBlock:118}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:40,dataCodewordsPerBlock:47},{numBlocks:7,dataCodewordsPerBlock:48}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:43,dataCodewordsPerBlock:24},{numBlocks:22,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:10,dataCodewordsPerBlock:15},{numBlocks:67,dataCodewordsPerBlock:16}]}]},{infoBits:167017,versionNumber:40,alignmentPatternCenters:[6,30,58,86,114,142,170],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:19,dataCodewordsPerBlock:118},{numBlocks:6,dataCodewordsPerBlock:119}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:18,dataCodewordsPerBlock:47},{numBlocks:31,dataCodewordsPerBlock:48}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:34,dataCodewordsPerBlock:24},{numBlocks:34,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:20,dataCodewordsPerBlock:15},{numBlocks:61,dataCodewordsPerBlock:16}]}]}]},function(s,a,_){Object.defineProperty(a,"__esModule",{value:!0});var $=_(0);function rt(Et,St,At,Pt){var Vt=Et.x-St.x+At.x-Pt.x,Bt=Et.y-St.y+At.y-Pt.y;if(Vt===0&&Bt===0)return{a11:St.x-Et.x,a12:St.y-Et.y,a13:0,a21:At.x-St.x,a22:At.y-St.y,a23:0,a31:Et.x,a32:Et.y,a33:1};var Zt=St.x-At.x,zt=Pt.x-At.x,Ut=St.y-At.y,Nt=Pt.y-At.y,Gt=Zt*Nt-zt*Ut,er=(Vt*Nt-zt*Bt)/Gt,ir=(Zt*Bt-Vt*Ut)/Gt;return{a11:St.x-Et.x+er*St.x,a12:St.y-Et.y+er*St.y,a13:er,a21:Pt.x-Et.x+ir*Pt.x,a22:Pt.y-Et.y+ir*Pt.y,a23:ir,a31:Et.x,a32:Et.y,a33:1}}function c(Et,St,At,Pt){var Vt=rt(Et,St,At,Pt);return{a11:Vt.a22*Vt.a33-Vt.a23*Vt.a32,a12:Vt.a13*Vt.a32-Vt.a12*Vt.a33,a13:Vt.a12*Vt.a23-Vt.a13*Vt.a22,a21:Vt.a23*Vt.a31-Vt.a21*Vt.a33,a22:Vt.a11*Vt.a33-Vt.a13*Vt.a31,a23:Vt.a13*Vt.a21-Vt.a11*Vt.a23,a31:Vt.a21*Vt.a32-Vt.a22*Vt.a31,a32:Vt.a12*Vt.a31-Vt.a11*Vt.a32,a33:Vt.a11*Vt.a22-Vt.a12*Vt.a21}}function dt(Et,St){return{a11:Et.a11*St.a11+Et.a21*St.a12+Et.a31*St.a13,a12:Et.a12*St.a11+Et.a22*St.a12+Et.a32*St.a13,a13:Et.a13*St.a11+Et.a23*St.a12+Et.a33*St.a13,a21:Et.a11*St.a21+Et.a21*St.a22+Et.a31*St.a23,a22:Et.a12*St.a21+Et.a22*St.a22+Et.a32*St.a23,a23:Et.a13*St.a21+Et.a23*St.a22+Et.a33*St.a23,a31:Et.a11*St.a31+Et.a21*St.a32+Et.a31*St.a33,a32:Et.a12*St.a31+Et.a22*St.a32+Et.a32*St.a33,a33:Et.a13*St.a31+Et.a23*St.a32+Et.a33*St.a33}}function ht(Et,St){for(var At=c({x:3.5,y:3.5},{x:St.dimension-3.5,y:3.5},{x:St.dimension-6.5,y:St.dimension-6.5},{x:3.5,y:St.dimension-3.5}),Pt=rt(St.topLeft,St.topRight,St.alignmentPattern,St.bottomLeft),Vt=dt(Pt,At),Bt=$.BitMatrix.createEmpty(St.dimension,St.dimension),Zt=function(ir,or){var mr=Vt.a13*ir+Vt.a23*or+Vt.a33;return{x:(Vt.a11*ir+Vt.a21*or+Vt.a31)/mr,y:(Vt.a12*ir+Vt.a22*or+Vt.a32)/mr}},zt=0;zt<St.dimension;zt++)for(var Ut=0;Ut<St.dimension;Ut++){var Nt=Ut+.5,Gt=zt+.5,er=Zt(Nt,Gt);Bt.set(Ut,zt,Et.get(Math.floor(er.x),Math.floor(er.y)))}return{matrix:Bt,mappingFunction:Zt}}a.extract=ht},function(s,a,_){Object.defineProperty(a,"__esModule",{value:!0});var $=4,rt=.5,c=1.5,dt=function(Nt,Gt){return Math.sqrt(Math.pow(Gt.x-Nt.x,2)+Math.pow(Gt.y-Nt.y,2))};function ht(Nt){return Nt.reduce(function(Gt,er){return Gt+er})}function Et(Nt,Gt,er){var ir,or,mr,Rr,on=dt(Nt,Gt),un=dt(Gt,er),jr=dt(Nt,er),Jr,fn,Fr;return un>=on&&un>=jr?(ir=[Gt,Nt,er],Jr=ir[0],fn=ir[1],Fr=ir[2]):jr>=un&&jr>=on?(or=[Nt,Gt,er],Jr=or[0],fn=or[1],Fr=or[2]):(mr=[Nt,er,Gt],Jr=mr[0],fn=mr[1],Fr=mr[2]),(Fr.x-fn.x)*(Jr.y-fn.y)-(Fr.y-fn.y)*(Jr.x-fn.x)<0&&(Rr=[Fr,Jr],Jr=Rr[0],Fr=Rr[1]),{bottomLeft:Jr,topLeft:fn,topRight:Fr}}function St(Nt,Gt,er,ir){var or=(ht(Pt(Nt,er,ir,5))/7+ht(Pt(Nt,Gt,ir,5))/7+ht(Pt(er,Nt,ir,5))/7+ht(Pt(Gt,Nt,ir,5))/7)/4;if(or<1)throw new Error("Invalid module size");var mr=Math.round(dt(Nt,Gt)/or),Rr=Math.round(dt(Nt,er)/or),on=Math.floor((mr+Rr)/2)+7;switch(on%4){case 0:on++;break;case 2:on--;break}return{dimension:on,moduleSize:or}}function At(Nt,Gt,er,ir){var or=[{x:Math.floor(Nt.x),y:Math.floor(Nt.y)}],mr=Math.abs(Gt.y-Nt.y)>Math.abs(Gt.x-Nt.x),Rr,on,un,jr;mr?(Rr=Math.floor(Nt.y),on=Math.floor(Nt.x),un=Math.floor(Gt.y),jr=Math.floor(Gt.x)):(Rr=Math.floor(Nt.x),on=Math.floor(Nt.y),un=Math.floor(Gt.x),jr=Math.floor(Gt.y));for(var Jr=Math.abs(un-Rr),fn=Math.abs(jr-on),Fr=Math.floor(-Jr/2),Cr=Rr<un?1:-1,Sr=on<jr?1:-1,dr=!0,gr=Rr,qr=on;gr!==un+Cr;gr+=Cr){var Lr=mr?qr:gr,_n=mr?gr:qr;if(er.get(Lr,_n)!==dr&&(dr=!dr,or.push({x:Lr,y:_n}),or.length===ir+1))break;if(Fr+=fn,Fr>0){if(qr===jr)break;qr+=Sr,Fr-=Jr}}for(var gn=[],Sn=0;Sn<ir;Sn++)or[Sn]&&or[Sn+1]?gn.push(dt(or[Sn],or[Sn+1])):gn.push(0);return gn}function Pt(Nt,Gt,er,ir){var or,mr=Gt.y-Nt.y,Rr=Gt.x-Nt.x,on=At(Nt,Gt,er,Math.ceil(ir/2)),un=At(Nt,{x:Nt.x-Rr,y:Nt.y-mr},er,Math.ceil(ir/2)),jr=on.shift()+un.shift()-1;return(or=un.concat(jr)).concat.apply(or,on)}function Vt(Nt,Gt){var er=ht(Nt)/ht(Gt),ir=0;return Gt.forEach(function(or,mr){ir+=Math.pow(Nt[mr]-or*er,2)}),{averageSize:er,error:ir}}function Bt(Nt,Gt,er){try{var ir=Pt(Nt,{x:-1,y:Nt.y},er,Gt.length),or=Pt(Nt,{x:Nt.x,y:-1},er,Gt.length),mr={x:Math.max(0,Nt.x-Nt.y)-1,y:Math.max(0,Nt.y-Nt.x)-1},Rr=Pt(Nt,mr,er,Gt.length),on={x:Math.min(er.width,Nt.x+Nt.y)+1,y:Math.min(er.height,Nt.y+Nt.x)+1},un=Pt(Nt,on,er,Gt.length),jr=Vt(ir,Gt),Jr=Vt(or,Gt),fn=Vt(Rr,Gt),Fr=Vt(un,Gt),Cr=Math.sqrt(jr.error*jr.error+Jr.error*Jr.error+fn.error*fn.error+Fr.error*Fr.error),Sr=(jr.averageSize+Jr.averageSize+fn.averageSize+Fr.averageSize)/4,dr=(Math.pow(jr.averageSize-Sr,2)+Math.pow(Jr.averageSize-Sr,2)+Math.pow(fn.averageSize-Sr,2)+Math.pow(Fr.averageSize-Sr,2))/Sr;return Cr+dr}catch{return 1/0}}function Zt(Nt,Gt){for(var er=Math.round(Gt.x);Nt.get(er,Math.round(Gt.y));)er--;for(var ir=Math.round(Gt.x);Nt.get(ir,Math.round(Gt.y));)ir++;for(var or=(er+ir)/2,mr=Math.round(Gt.y);Nt.get(Math.round(or),mr);)mr--;for(var Rr=Math.round(Gt.y);Nt.get(Math.round(or),Rr);)Rr++;var on=(mr+Rr)/2;return{x:or,y:on}}function zt(Nt){for(var Gt=[],er=[],ir=[],or=[],mr=function(Lr){for(var _n=0,gn=!1,Sn=[0,0,0,0,0],Fs=function(ms){var On=Nt.get(ms,Lr);if(On===gn)_n++;else{Sn=[Sn[1],Sn[2],Sn[3],Sn[4],_n],_n=1,gn=On;var ws=ht(Sn)/7,Vs=Math.abs(Sn[0]-ws)<ws&&Math.abs(Sn[1]-ws)<ws&&Math.abs(Sn[2]-3*ws)<3*ws&&Math.abs(Sn[3]-ws)<ws&&Math.abs(Sn[4]-ws)<ws&&!On,ks=ht(Sn.slice(-3))/3,lo=Math.abs(Sn[2]-ks)<ks&&Math.abs(Sn[3]-ks)<ks&&Math.abs(Sn[4]-ks)<ks&&On;if(Vs){var ys=ms-Sn[3]-Sn[4],dn=ys-Sn[2],Es={startX:dn,endX:ys,y:Lr},po=er.filter(function(us){return dn>=us.bottom.startX&&dn<=us.bottom.endX||ys>=us.bottom.startX&&dn<=us.bottom.endX||dn<=us.bottom.startX&&ys>=us.bottom.endX&&Sn[2]/(us.bottom.endX-us.bottom.startX)<c&&Sn[2]/(us.bottom.endX-us.bottom.startX)>rt});po.length>0?po[0].bottom=Es:er.push({top:Es,bottom:Es})}if(lo){var no=ms-Sn[4],tn=no-Sn[3],Es={startX:tn,y:Lr,endX:no},po=or.filter(function(Ss){return tn>=Ss.bottom.startX&&tn<=Ss.bottom.endX||no>=Ss.bottom.startX&&tn<=Ss.bottom.endX||tn<=Ss.bottom.startX&&no>=Ss.bottom.endX&&Sn[2]/(Ss.bottom.endX-Ss.bottom.startX)<c&&Sn[2]/(Ss.bottom.endX-Ss.bottom.startX)>rt});po.length>0?po[0].bottom=Es:or.push({top:Es,bottom:Es})}}},rs=-1;rs<=Nt.width;rs++)Fs(rs);Gt.push.apply(Gt,er.filter(function(ms){return ms.bottom.y!==Lr&&ms.bottom.y-ms.top.y>=2})),er=er.filter(function(ms){return ms.bottom.y===Lr}),ir.push.apply(ir,or.filter(function(ms){return ms.bottom.y!==Lr})),or=or.filter(function(ms){return ms.bottom.y===Lr})},Rr=0;Rr<=Nt.height;Rr++)mr(Rr);Gt.push.apply(Gt,er.filter(function(Lr){return Lr.bottom.y-Lr.top.y>=2})),ir.push.apply(ir,or);var on=Gt.filter(function(Lr){return Lr.bottom.y-Lr.top.y>=2}).map(function(Lr){var _n=(Lr.top.startX+Lr.top.endX+Lr.bottom.startX+Lr.bottom.endX)/4,gn=(Lr.top.y+Lr.bottom.y+1)/2;if(Nt.get(Math.round(_n),Math.round(gn))){var Sn=[Lr.top.endX-Lr.top.startX,Lr.bottom.endX-Lr.bottom.startX,Lr.bottom.y-Lr.top.y+1],Fs=ht(Sn)/Sn.length,rs=Bt({x:Math.round(_n),y:Math.round(gn)},[1,1,3,1,1],Nt);return{score:rs,x:_n,y:gn,size:Fs}}}).filter(function(Lr){return!!Lr}).sort(function(Lr,_n){return Lr.score-_n.score}).map(function(Lr,_n,gn){if(_n>$)return null;var Sn=gn.filter(function(rs,ms){return _n!==ms}).map(function(rs){return{x:rs.x,y:rs.y,score:rs.score+Math.pow(rs.size-Lr.size,2)/Lr.size,size:rs.size}}).sort(function(rs,ms){return rs.score-ms.score});if(Sn.length<2)return null;var Fs=Lr.score+Sn[0].score+Sn[1].score;return{points:[Lr].concat(Sn.slice(0,2)),score:Fs}}).filter(function(Lr){return!!Lr}).sort(function(Lr,_n){return Lr.score-_n.score});if(on.length===0)return null;var un=Et(on[0].points[0],on[0].points[1],on[0].points[2]),jr=un.topRight,Jr=un.topLeft,fn=un.bottomLeft,Fr=Ut(Nt,ir,jr,Jr,fn),Cr=[];Fr&&Cr.push({alignmentPattern:{x:Fr.alignmentPattern.x,y:Fr.alignmentPattern.y},bottomLeft:{x:fn.x,y:fn.y},dimension:Fr.dimension,topLeft:{x:Jr.x,y:Jr.y},topRight:{x:jr.x,y:jr.y}});var Sr=Zt(Nt,jr),dr=Zt(Nt,Jr),gr=Zt(Nt,fn),qr=Ut(Nt,ir,Sr,dr,gr);return qr&&Cr.push({alignmentPattern:{x:qr.alignmentPattern.x,y:qr.alignmentPattern.y},bottomLeft:{x:gr.x,y:gr.y},topLeft:{x:dr.x,y:dr.y},topRight:{x:Sr.x,y:Sr.y},dimension:qr.dimension}),Cr.length===0?null:Cr}a.locate=zt;function Ut(Nt,Gt,er,ir,or){var mr,Rr,on;try{mr=St(ir,er,or,Nt),Rr=mr.dimension,on=mr.moduleSize}catch{return null}var un={x:er.x-ir.x+or.x,y:er.y-ir.y+or.y},jr=(dt(ir,or)+dt(ir,er))/2/on,Jr=1-3/jr,fn={x:ir.x+Jr*(un.x-ir.x),y:ir.y+Jr*(un.y-ir.y)},Fr=Gt.map(function(Sr){var dr=(Sr.top.startX+Sr.top.endX+Sr.bottom.startX+Sr.bottom.endX)/4,gr=(Sr.top.y+Sr.bottom.y+1)/2;if(Nt.get(Math.floor(dr),Math.floor(gr))){var qr=[Sr.top.endX-Sr.top.startX,Sr.bottom.endX-Sr.bottom.startX,Sr.bottom.y-Sr.top.y+1];ht(qr)/qr.length;var Lr=Bt({x:Math.floor(dr),y:Math.floor(gr)},[1,1,1],Nt),_n=Lr+dt({x:dr,y:gr},fn);return{x:dr,y:gr,score:_n}}}).filter(function(Sr){return!!Sr}).sort(function(Sr,dr){return Sr.score-dr.score}),Cr=jr>=15&&Fr.length?Fr[0]:fn;return{alignmentPattern:Cr,dimension:Rr}}}]).default})})(jsQR$1);var jsQRExports=jsQR$1.exports;const jsQR=getDefaultExportFromCjs(jsQRExports);var Html5QrcodeSupportedFormats;(function(e){e[e.QR_CODE=0]="QR_CODE",e[e.AZTEC=1]="AZTEC",e[e.CODABAR=2]="CODABAR",e[e.CODE_39=3]="CODE_39",e[e.CODE_93=4]="CODE_93",e[e.CODE_128=5]="CODE_128",e[e.DATA_MATRIX=6]="DATA_MATRIX",e[e.MAXICODE=7]="MAXICODE",e[e.ITF=8]="ITF",e[e.EAN_13=9]="EAN_13",e[e.EAN_8=10]="EAN_8",e[e.PDF_417=11]="PDF_417",e[e.RSS_14=12]="RSS_14",e[e.RSS_EXPANDED=13]="RSS_EXPANDED",e[e.UPC_A=14]="UPC_A",e[e.UPC_E=15]="UPC_E",e[e.UPC_EAN_EXTENSION=16]="UPC_EAN_EXTENSION"})(Html5QrcodeSupportedFormats||(Html5QrcodeSupportedFormats={}));var html5QrcodeSupportedFormatsTextMap=new Map([[Html5QrcodeSupportedFormats.QR_CODE,"QR_CODE"],[Html5QrcodeSupportedFormats.AZTEC,"AZTEC"],[Html5QrcodeSupportedFormats.CODABAR,"CODABAR"],[Html5QrcodeSupportedFormats.CODE_39,"CODE_39"],[Html5QrcodeSupportedFormats.CODE_93,"CODE_93"],[Html5QrcodeSupportedFormats.CODE_128,"CODE_128"],[Html5QrcodeSupportedFormats.DATA_MATRIX,"DATA_MATRIX"],[Html5QrcodeSupportedFormats.MAXICODE,"MAXICODE"],[Html5QrcodeSupportedFormats.ITF,"ITF"],[Html5QrcodeSupportedFormats.EAN_13,"EAN_13"],[Html5QrcodeSupportedFormats.EAN_8,"EAN_8"],[Html5QrcodeSupportedFormats.PDF_417,"PDF_417"],[Html5QrcodeSupportedFormats.RSS_14,"RSS_14"],[Html5QrcodeSupportedFormats.RSS_EXPANDED,"RSS_EXPANDED"],[Html5QrcodeSupportedFormats.UPC_A,"UPC_A"],[Html5QrcodeSupportedFormats.UPC_E,"UPC_E"],[Html5QrcodeSupportedFormats.UPC_EAN_EXTENSION,"UPC_EAN_EXTENSION"]]),DecodedTextType;(function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.URL=1]="URL"})(DecodedTextType||(DecodedTextType={}));function isValidHtml5QrcodeSupportedFormats(e){return Object.values(Html5QrcodeSupportedFormats).includes(e)}var Html5QrcodeScanType;(function(e){e[e.SCAN_TYPE_CAMERA=0]="SCAN_TYPE_CAMERA",e[e.SCAN_TYPE_FILE=1]="SCAN_TYPE_FILE"})(Html5QrcodeScanType||(Html5QrcodeScanType={}));var Html5QrcodeConstants=function(){function e(){}return e.GITHUB_PROJECT_URL="https://github.com/mebjas/html5-qrcode",e.SCAN_DEFAULT_FPS=2,e.DEFAULT_DISABLE_FLIP=!1,e.DEFAULT_REMEMBER_LAST_CAMERA_USED=!0,e.DEFAULT_SUPPORTED_SCAN_TYPE=[Html5QrcodeScanType.SCAN_TYPE_CAMERA,Html5QrcodeScanType.SCAN_TYPE_FILE],e}(),QrcodeResultFormat=function(){function e(i,s){this.format=i,this.formatName=s}return e.prototype.toString=function(){return this.formatName},e.create=function(i){if(!html5QrcodeSupportedFormatsTextMap.has(i))throw"".concat(i," not in html5QrcodeSupportedFormatsTextMap");return new e(i,html5QrcodeSupportedFormatsTextMap.get(i))},e}(),Html5QrcodeResultFactory=function(){function e(){}return e.createFromText=function(i){var s={text:i};return{decodedText:i,result:s}},e.createFromQrcodeResult=function(i){return{decodedText:i.text,result:i}},e}(),Html5QrcodeErrorTypes;(function(e){e[e.UNKWOWN_ERROR=0]="UNKWOWN_ERROR",e[e.IMPLEMENTATION_ERROR=1]="IMPLEMENTATION_ERROR",e[e.NO_CODE_FOUND_ERROR=2]="NO_CODE_FOUND_ERROR"})(Html5QrcodeErrorTypes||(Html5QrcodeErrorTypes={}));var Html5QrcodeErrorFactory=function(){function e(){}return e.createFrom=function(i){return{errorMessage:i,type:Html5QrcodeErrorTypes.UNKWOWN_ERROR}},e}(),BaseLoggger=function(){function e(i){this.verbose=i}return e.prototype.log=function(i){this.verbose&&console.log(i)},e.prototype.warn=function(i){this.verbose&&console.warn(i)},e.prototype.logError=function(i,s){(this.verbose||s===!0)&&console.error(i)},e.prototype.logErrors=function(i){if(i.length===0)throw"Logger#logError called without arguments";this.verbose&&console.error(i)},e}();function isNullOrUndefined(e){return typeof e>"u"||e===null}var Html5QrcodeStrings=function(){function e(){}return e.codeParseError=function(i){return"QR code parse error, error = ".concat(i)},e.errorGettingUserMedia=function(i){return"Error getting userMedia, error = ".concat(i)},e.onlyDeviceSupportedError=function(){return"The device doesn't support navigator.mediaDevices , only supported cameraIdOrConfig in this case is deviceId parameter (string)."},e.cameraStreamingNotSupported=function(){return"Camera streaming not supported by the browser."},e.unableToQuerySupportedDevices=function(){return"Unable to query supported devices, unknown error."},e.insecureContextCameraQueryError=function(){return"Camera access is only supported in secure context like https or localhost."},e.scannerPaused=function(){return"Scanner paused"},e}(),VideoConstraintsUtil=function(){function e(){}return e.isMediaStreamConstraintsValid=function(i,s){if(typeof i!="object"){var a=typeof i;return s.logError("videoConstraints should be of type object, the "+"object passed is of type ".concat(a,"."),!0),!1}for(var _=["autoGainControl","channelCount","echoCancellation","latency","noiseSuppression","sampleRate","sampleSize","volume"],$=new Set(_),rt=Object.keys(i),c=0,dt=rt;c<dt.length;c++){var ht=dt[c];if($.has(ht))return s.logError("".concat(ht," is not supported videoConstaints."),!0),!1}return!0},e}(),zxingJs_umd$1={exports:{}};(function(e,i){(function(s,a){a(i)})(commonjsGlobal,function(s){function a(wr){return wr==null}var _=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(wr,it){wr.__proto__=it}||function(wr,it){for(var ct in it)it.hasOwnProperty(ct)&&(wr[ct]=it[ct])};function $(wr,it){_(wr,it);function ct(){this.constructor=wr}wr.prototype=it===null?Object.create(it):(ct.prototype=it.prototype,new ct)}function rt(wr,it){var ct=Object.setPrototypeOf;ct?ct(wr,it):wr.__proto__=it}function c(wr,it){it===void 0&&(it=wr.constructor);var ct=Error.captureStackTrace;ct&&ct(wr,it)}var dt=function(wr){$(it,wr);function it(ct){var pt=this.constructor,Ct=wr.call(this,ct)||this;return Object.defineProperty(Ct,"name",{value:pt.name,enumerable:!1}),rt(Ct,pt.prototype),c(Ct),Ct}return it}(Error);class ht extends dt{constructor(it=void 0){super(it),this.message=it}getKind(){return this.constructor.kind}}ht.kind="Exception";class Et extends ht{}Et.kind="ArgumentException";class St extends ht{}St.kind="IllegalArgumentException";class At{constructor(it){if(this.binarizer=it,it===null)throw new St("Binarizer must be non-null.")}getWidth(){return this.binarizer.getWidth()}getHeight(){return this.binarizer.getHeight()}getBlackRow(it,ct){return this.binarizer.getBlackRow(it,ct)}getBlackMatrix(){return(this.matrix===null||this.matrix===void 0)&&(this.matrix=this.binarizer.getBlackMatrix()),this.matrix}isCropSupported(){return this.binarizer.getLuminanceSource().isCropSupported()}crop(it,ct,pt,Ct){const It=this.binarizer.getLuminanceSource().crop(it,ct,pt,Ct);return new At(this.binarizer.createBinarizer(It))}isRotateSupported(){return this.binarizer.getLuminanceSource().isRotateSupported()}rotateCounterClockwise(){const it=this.binarizer.getLuminanceSource().rotateCounterClockwise();return new At(this.binarizer.createBinarizer(it))}rotateCounterClockwise45(){const it=this.binarizer.getLuminanceSource().rotateCounterClockwise45();return new At(this.binarizer.createBinarizer(it))}toString(){try{return this.getBlackMatrix().toString()}catch{return""}}}class Pt extends ht{static getChecksumInstance(){return new Pt}}Pt.kind="ChecksumException";class Vt{constructor(it){this.source=it}getLuminanceSource(){return this.source}getWidth(){return this.source.getWidth()}getHeight(){return this.source.getHeight()}}class Bt{static arraycopy(it,ct,pt,Ct,It){for(;It--;)pt[Ct++]=it[ct++]}static currentTimeMillis(){return Date.now()}}class Zt extends ht{}Zt.kind="IndexOutOfBoundsException";class zt extends Zt{constructor(it=void 0,ct=void 0){super(ct),this.index=it,this.message=ct}}zt.kind="ArrayIndexOutOfBoundsException";class Ut{static fill(it,ct){for(let pt=0,Ct=it.length;pt<Ct;pt++)it[pt]=ct}static fillWithin(it,ct,pt,Ct){Ut.rangeCheck(it.length,ct,pt);for(let It=ct;It<pt;It++)it[It]=Ct}static rangeCheck(it,ct,pt){if(ct>pt)throw new St("fromIndex("+ct+") > toIndex("+pt+")");if(ct<0)throw new zt(ct);if(pt>it)throw new zt(pt)}static asList(...it){return it}static create(it,ct,pt){return Array.from({length:it}).map(It=>Array.from({length:ct}).fill(pt))}static createInt32Array(it,ct,pt){return Array.from({length:it}).map(It=>Int32Array.from({length:ct}).fill(pt))}static equals(it,ct){if(!it||!ct||!it.length||!ct.length||it.length!==ct.length)return!1;for(let pt=0,Ct=it.length;pt<Ct;pt++)if(it[pt]!==ct[pt])return!1;return!0}static hashCode(it){if(it===null)return 0;let ct=1;for(const pt of it)ct=31*ct+pt;return ct}static fillUint8Array(it,ct){for(let pt=0;pt!==it.length;pt++)it[pt]=ct}static copyOf(it,ct){return it.slice(0,ct)}static copyOfUint8Array(it,ct){if(it.length<=ct){const pt=new Uint8Array(ct);return pt.set(it),pt}return it.slice(0,ct)}static copyOfRange(it,ct,pt){const Ct=pt-ct,It=new Int32Array(Ct);return Bt.arraycopy(it,ct,It,0,Ct),It}static binarySearch(it,ct,pt){pt===void 0&&(pt=Ut.numberComparator);let Ct=0,It=it.length-1;for(;Ct<=It;){const Dt=It+Ct>>1,qt=pt(ct,it[Dt]);if(qt>0)Ct=Dt+1;else if(qt<0)It=Dt-1;else return Dt}return-Ct-1}static numberComparator(it,ct){return it-ct}}class Nt{static numberOfTrailingZeros(it){let ct;if(it===0)return 32;let pt=31;return ct=it<<16,ct!==0&&(pt-=16,it=ct),ct=it<<8,ct!==0&&(pt-=8,it=ct),ct=it<<4,ct!==0&&(pt-=4,it=ct),ct=it<<2,ct!==0&&(pt-=2,it=ct),pt-(it<<1>>>31)}static numberOfLeadingZeros(it){if(it===0)return 32;let ct=1;return it>>>16||(ct+=16,it<<=16),it>>>24||(ct+=8,it<<=8),it>>>28||(ct+=4,it<<=4),it>>>30||(ct+=2,it<<=2),ct-=it>>>31,ct}static toHexString(it){return it.toString(16)}static toBinaryString(it){return String(parseInt(String(it),2))}static bitCount(it){return it=it-(it>>>1&1431655765),it=(it&858993459)+(it>>>2&858993459),it=it+(it>>>4)&252645135,it=it+(it>>>8),it=it+(it>>>16),it&63}static truncDivision(it,ct){return Math.trunc(it/ct)}static parseInt(it,ct=void 0){return parseInt(it,ct)}}Nt.MIN_VALUE_32_BITS=-2147483648,Nt.MAX_VALUE=Number.MAX_SAFE_INTEGER;class Gt{constructor(it,ct){it===void 0?(this.size=0,this.bits=new Int32Array(1)):(this.size=it,ct==null?this.bits=Gt.makeArray(it):this.bits=ct)}getSize(){return this.size}getSizeInBytes(){return Math.floor((this.size+7)/8)}ensureCapacity(it){if(it>this.bits.length*32){const ct=Gt.makeArray(it);Bt.arraycopy(this.bits,0,ct,0,this.bits.length),this.bits=ct}}get(it){return(this.bits[Math.floor(it/32)]&1<<(it&31))!==0}set(it){this.bits[Math.floor(it/32)]|=1<<(it&31)}flip(it){this.bits[Math.floor(it/32)]^=1<<(it&31)}getNextSet(it){const ct=this.size;if(it>=ct)return ct;const pt=this.bits;let Ct=Math.floor(it/32),It=pt[Ct];It&=~((1<<(it&31))-1);const Dt=pt.length;for(;It===0;){if(++Ct===Dt)return ct;It=pt[Ct]}const qt=Ct*32+Nt.numberOfTrailingZeros(It);return qt>ct?ct:qt}getNextUnset(it){const ct=this.size;if(it>=ct)return ct;const pt=this.bits;let Ct=Math.floor(it/32),It=~pt[Ct];It&=~((1<<(it&31))-1);const Dt=pt.length;for(;It===0;){if(++Ct===Dt)return ct;It=~pt[Ct]}const qt=Ct*32+Nt.numberOfTrailingZeros(It);return qt>ct?ct:qt}setBulk(it,ct){this.bits[Math.floor(it/32)]=ct}setRange(it,ct){if(ct<it||it<0||ct>this.size)throw new St;if(ct===it)return;ct--;const pt=Math.floor(it/32),Ct=Math.floor(ct/32),It=this.bits;for(let Dt=pt;Dt<=Ct;Dt++){const qt=Dt>pt?0:it&31,ar=(2<<(Dt<Ct?31:ct&31))-(1<<qt);It[Dt]|=ar}}clear(){const it=this.bits.length,ct=this.bits;for(let pt=0;pt<it;pt++)ct[pt]=0}isRange(it,ct,pt){if(ct<it||it<0||ct>this.size)throw new St;if(ct===it)return!0;ct--;const Ct=Math.floor(it/32),It=Math.floor(ct/32),Dt=this.bits;for(let qt=Ct;qt<=It;qt++){const Jt=qt>Ct?0:it&31,Er=(2<<(qt<It?31:ct&31))-(1<<Jt)&4294967295;if((Dt[qt]&Er)!==(pt?Er:0))return!1}return!0}appendBit(it){this.ensureCapacity(this.size+1),it&&(this.bits[Math.floor(this.size/32)]|=1<<(this.size&31)),this.size++}appendBits(it,ct){if(ct<0||ct>32)throw new St("Num bits must be between 0 and 32");this.ensureCapacity(this.size+ct);for(let pt=ct;pt>0;pt--)this.appendBit((it>>pt-1&1)===1)}appendBitArray(it){const ct=it.size;this.ensureCapacity(this.size+ct);for(let pt=0;pt<ct;pt++)this.appendBit(it.get(pt))}xor(it){if(this.size!==it.size)throw new St("Sizes don't match");const ct=this.bits;for(let pt=0,Ct=ct.length;pt<Ct;pt++)ct[pt]^=it.bits[pt]}toBytes(it,ct,pt,Ct){for(let It=0;It<Ct;It++){let Dt=0;for(let qt=0;qt<8;qt++)this.get(it)&&(Dt|=1<<7-qt),it++;ct[pt+It]=Dt}}getBitArray(){return this.bits}reverse(){const it=new Int32Array(this.bits.length),ct=Math.floor((this.size-1)/32),pt=ct+1,Ct=this.bits;for(let It=0;It<pt;It++){let Dt=Ct[It];Dt=Dt>>1&1431655765|(Dt&1431655765)<<1,Dt=Dt>>2&858993459|(Dt&858993459)<<2,Dt=Dt>>4&252645135|(Dt&252645135)<<4,Dt=Dt>>8&16711935|(Dt&16711935)<<8,Dt=Dt>>16&65535|(Dt&65535)<<16,it[ct-It]=Dt}if(this.size!==pt*32){const It=pt*32-this.size;let Dt=it[0]>>>It;for(let qt=1;qt<pt;qt++){const Jt=it[qt];Dt|=Jt<<32-It,it[qt-1]=Dt,Dt=Jt>>>It}it[pt-1]=Dt}this.bits=it}static makeArray(it){return new Int32Array(Math.floor((it+31)/32))}equals(it){if(!(it instanceof Gt))return!1;const ct=it;return this.size===ct.size&&Ut.equals(this.bits,ct.bits)}hashCode(){return 31*this.size+Ut.hashCode(this.bits)}toString(){let it="";for(let ct=0,pt=this.size;ct<pt;ct++)ct&7||(it+=" "),it+=this.get(ct)?"X":".";return it}clone(){return new Gt(this.size,this.bits.slice())}}var er;(function(wr){wr[wr.OTHER=0]="OTHER",wr[wr.PURE_BARCODE=1]="PURE_BARCODE",wr[wr.POSSIBLE_FORMATS=2]="POSSIBLE_FORMATS",wr[wr.TRY_HARDER=3]="TRY_HARDER",wr[wr.CHARACTER_SET=4]="CHARACTER_SET",wr[wr.ALLOWED_LENGTHS=5]="ALLOWED_LENGTHS",wr[wr.ASSUME_CODE_39_CHECK_DIGIT=6]="ASSUME_CODE_39_CHECK_DIGIT",wr[wr.ASSUME_GS1=7]="ASSUME_GS1",wr[wr.RETURN_CODABAR_START_END=8]="RETURN_CODABAR_START_END",wr[wr.NEED_RESULT_POINT_CALLBACK=9]="NEED_RESULT_POINT_CALLBACK",wr[wr.ALLOWED_EAN_EXTENSIONS=10]="ALLOWED_EAN_EXTENSIONS"})(er||(er={}));var ir=er;class or extends ht{static getFormatInstance(){return new or}}or.kind="FormatException";var mr;(function(wr){wr[wr.Cp437=0]="Cp437",wr[wr.ISO8859_1=1]="ISO8859_1",wr[wr.ISO8859_2=2]="ISO8859_2",wr[wr.ISO8859_3=3]="ISO8859_3",wr[wr.ISO8859_4=4]="ISO8859_4",wr[wr.ISO8859_5=5]="ISO8859_5",wr[wr.ISO8859_6=6]="ISO8859_6",wr[wr.ISO8859_7=7]="ISO8859_7",wr[wr.ISO8859_8=8]="ISO8859_8",wr[wr.ISO8859_9=9]="ISO8859_9",wr[wr.ISO8859_10=10]="ISO8859_10",wr[wr.ISO8859_11=11]="ISO8859_11",wr[wr.ISO8859_13=12]="ISO8859_13",wr[wr.ISO8859_14=13]="ISO8859_14",wr[wr.ISO8859_15=14]="ISO8859_15",wr[wr.ISO8859_16=15]="ISO8859_16",wr[wr.SJIS=16]="SJIS",wr[wr.Cp1250=17]="Cp1250",wr[wr.Cp1251=18]="Cp1251",wr[wr.Cp1252=19]="Cp1252",wr[wr.Cp1256=20]="Cp1256",wr[wr.UnicodeBigUnmarked=21]="UnicodeBigUnmarked",wr[wr.UTF8=22]="UTF8",wr[wr.ASCII=23]="ASCII",wr[wr.Big5=24]="Big5",wr[wr.GB18030=25]="GB18030",wr[wr.EUC_KR=26]="EUC_KR"})(mr||(mr={}));class Rr{constructor(it,ct,pt,...Ct){this.valueIdentifier=it,this.name=pt,typeof ct=="number"?this.values=Int32Array.from([ct]):this.values=ct,this.otherEncodingNames=Ct,Rr.VALUE_IDENTIFIER_TO_ECI.set(it,this),Rr.NAME_TO_ECI.set(pt,this);const It=this.values;for(let Dt=0,qt=It.length;Dt!==qt;Dt++){const Jt=It[Dt];Rr.VALUES_TO_ECI.set(Jt,this)}for(const Dt of Ct)Rr.NAME_TO_ECI.set(Dt,this)}getValueIdentifier(){return this.valueIdentifier}getName(){return this.name}getValue(){return this.values[0]}static getCharacterSetECIByValue(it){if(it<0||it>=900)throw new or("incorect value");const ct=Rr.VALUES_TO_ECI.get(it);if(ct===void 0)throw new or("incorect value");return ct}static getCharacterSetECIByName(it){const ct=Rr.NAME_TO_ECI.get(it);if(ct===void 0)throw new or("incorect value");return ct}equals(it){if(!(it instanceof Rr))return!1;const ct=it;return this.getName()===ct.getName()}}Rr.VALUE_IDENTIFIER_TO_ECI=new Map,Rr.VALUES_TO_ECI=new Map,Rr.NAME_TO_ECI=new Map,Rr.Cp437=new Rr(mr.Cp437,Int32Array.from([0,2]),"Cp437"),Rr.ISO8859_1=new Rr(mr.ISO8859_1,Int32Array.from([1,3]),"ISO-8859-1","ISO88591","ISO8859_1"),Rr.ISO8859_2=new Rr(mr.ISO8859_2,4,"ISO-8859-2","ISO88592","ISO8859_2"),Rr.ISO8859_3=new Rr(mr.ISO8859_3,5,"ISO-8859-3","ISO88593","ISO8859_3"),Rr.ISO8859_4=new Rr(mr.ISO8859_4,6,"ISO-8859-4","ISO88594","ISO8859_4"),Rr.ISO8859_5=new Rr(mr.ISO8859_5,7,"ISO-8859-5","ISO88595","ISO8859_5"),Rr.ISO8859_6=new Rr(mr.ISO8859_6,8,"ISO-8859-6","ISO88596","ISO8859_6"),Rr.ISO8859_7=new Rr(mr.ISO8859_7,9,"ISO-8859-7","ISO88597","ISO8859_7"),Rr.ISO8859_8=new Rr(mr.ISO8859_8,10,"ISO-8859-8","ISO88598","ISO8859_8"),Rr.ISO8859_9=new Rr(mr.ISO8859_9,11,"ISO-8859-9","ISO88599","ISO8859_9"),Rr.ISO8859_10=new Rr(mr.ISO8859_10,12,"ISO-8859-10","ISO885910","ISO8859_10"),Rr.ISO8859_11=new Rr(mr.ISO8859_11,13,"ISO-8859-11","ISO885911","ISO8859_11"),Rr.ISO8859_13=new Rr(mr.ISO8859_13,15,"ISO-8859-13","ISO885913","ISO8859_13"),Rr.ISO8859_14=new Rr(mr.ISO8859_14,16,"ISO-8859-14","ISO885914","ISO8859_14"),Rr.ISO8859_15=new Rr(mr.ISO8859_15,17,"ISO-8859-15","ISO885915","ISO8859_15"),Rr.ISO8859_16=new Rr(mr.ISO8859_16,18,"ISO-8859-16","ISO885916","ISO8859_16"),Rr.SJIS=new Rr(mr.SJIS,20,"SJIS","Shift_JIS"),Rr.Cp1250=new Rr(mr.Cp1250,21,"Cp1250","windows-1250"),Rr.Cp1251=new Rr(mr.Cp1251,22,"Cp1251","windows-1251"),Rr.Cp1252=new Rr(mr.Cp1252,23,"Cp1252","windows-1252"),Rr.Cp1256=new Rr(mr.Cp1256,24,"Cp1256","windows-1256"),Rr.UnicodeBigUnmarked=new Rr(mr.UnicodeBigUnmarked,25,"UnicodeBigUnmarked","UTF-16BE","UnicodeBig"),Rr.UTF8=new Rr(mr.UTF8,26,"UTF8","UTF-8"),Rr.ASCII=new Rr(mr.ASCII,Int32Array.from([27,170]),"ASCII","US-ASCII"),Rr.Big5=new Rr(mr.Big5,28,"Big5"),Rr.GB18030=new Rr(mr.GB18030,29,"GB18030","GB2312","EUC_CN","GBK"),Rr.EUC_KR=new Rr(mr.EUC_KR,30,"EUC_KR","EUC-KR");class on extends ht{}on.kind="UnsupportedOperationException";class un{static decode(it,ct){const pt=this.encodingName(ct);return this.customDecoder?this.customDecoder(it,pt):typeof TextDecoder>"u"||this.shouldDecodeOnFallback(pt)?this.decodeFallback(it,pt):new TextDecoder(pt).decode(it)}static shouldDecodeOnFallback(it){return!un.isBrowser()&&it==="ISO-8859-1"}static encode(it,ct){const pt=this.encodingName(ct);return this.customEncoder?this.customEncoder(it,pt):typeof TextEncoder>"u"?this.encodeFallback(it):new TextEncoder().encode(it)}static isBrowser(){return typeof window<"u"&&{}.toString.call(window)==="[object Window]"}static encodingName(it){return typeof it=="string"?it:it.getName()}static encodingCharacterSet(it){return it instanceof Rr?it:Rr.getCharacterSetECIByName(it)}static decodeFallback(it,ct){const pt=this.encodingCharacterSet(ct);if(un.isDecodeFallbackSupported(pt)){let Ct="";for(let It=0,Dt=it.length;It<Dt;It++){let qt=it[It].toString(16);qt.length<2&&(qt="0"+qt),Ct+="%"+qt}return decodeURIComponent(Ct)}if(pt.equals(Rr.UnicodeBigUnmarked))return String.fromCharCode.apply(null,new Uint16Array(it.buffer));throw new on(`Encoding ${this.encodingName(ct)} not supported by fallback.`)}static isDecodeFallbackSupported(it){return it.equals(Rr.UTF8)||it.equals(Rr.ISO8859_1)||it.equals(Rr.ASCII)}static encodeFallback(it){const pt=btoa(unescape(encodeURIComponent(it))).split(""),Ct=[];for(let It=0;It<pt.length;It++)Ct.push(pt[It].charCodeAt(0));return new Uint8Array(Ct)}}class jr{static castAsNonUtf8Char(it,ct=null){const pt=ct?ct.getName():this.ISO88591;return un.decode(new Uint8Array([it]),pt)}static guessEncoding(it,ct){if(ct!=null&&ct.get(ir.CHARACTER_SET)!==void 0)return ct.get(ir.CHARACTER_SET).toString();const pt=it.length;let Ct=!0,It=!0,Dt=!0,qt=0,Jt=0,ar=0,Er=0,Pr=0,Gr=0,pn=0,An=0,Pn=0,Xn=0,os=0;const Ks=it.length>3&&it[0]===239&&it[1]===187&&it[2]===191;for(let Js=0;Js<pt&&(Ct||It||Dt);Js++){const Hs=it[Js]&255;Dt&&(qt>0?Hs&128?qt--:Dt=!1:Hs&128&&(Hs&64?(qt++,Hs&32?(qt++,Hs&16?(qt++,Hs&8?Dt=!1:Er++):ar++):Jt++):Dt=!1)),Ct&&(Hs>127&&Hs<160?Ct=!1:Hs>159&&(Hs<192||Hs===215||Hs===247)&&os++),It&&(Pr>0?Hs<64||Hs===127||Hs>252?It=!1:Pr--:Hs===128||Hs===160||Hs>239?It=!1:Hs>160&&Hs<224?(Gr++,An=0,pn++,pn>Pn&&(Pn=pn)):Hs>127?(Pr++,pn=0,An++,An>Xn&&(Xn=An)):(pn=0,An=0))}return Dt&&qt>0&&(Dt=!1),It&&Pr>0&&(It=!1),Dt&&(Ks||Jt+ar+Er>0)?jr.UTF8:It&&(jr.ASSUME_SHIFT_JIS||Pn>=3||Xn>=3)?jr.SHIFT_JIS:Ct&&It?Pn===2&&Gr===2||os*10>=pt?jr.SHIFT_JIS:jr.ISO88591:Ct?jr.ISO88591:It?jr.SHIFT_JIS:Dt?jr.UTF8:jr.PLATFORM_DEFAULT_ENCODING}static format(it,...ct){let pt=-1;function Ct(Dt,qt,Jt,ar,Er,Pr){if(Dt==="%%")return"%";if(ct[++pt]===void 0)return;Dt=ar?parseInt(ar.substr(1)):void 0;let Gr=Er?parseInt(Er.substr(1)):void 0,pn;switch(Pr){case"s":pn=ct[pt];break;case"c":pn=ct[pt][0];break;case"f":pn=parseFloat(ct[pt]).toFixed(Dt);break;case"p":pn=parseFloat(ct[pt]).toPrecision(Dt);break;case"e":pn=parseFloat(ct[pt]).toExponential(Dt);break;case"x":pn=parseInt(ct[pt]).toString(Gr||16);break;case"d":pn=parseFloat(parseInt(ct[pt],Gr||10).toPrecision(Dt)).toFixed(0);break}pn=typeof pn=="object"?JSON.stringify(pn):(+pn).toString(Gr);let An=parseInt(Jt),Pn=Jt&&Jt[0]+""=="0"?"0":" ";for(;pn.length<An;)pn=qt!==void 0?pn+Pn:Pn+pn;return pn}let It=/%(-)?(0?[0-9]+)?([.][0-9]+)?([#][0-9]+)?([scfpexd%])/g;return it.replace(It,Ct)}static getBytes(it,ct){return un.encode(it,ct)}static getCharCode(it,ct=0){return it.charCodeAt(ct)}static getCharAt(it){return String.fromCharCode(it)}}jr.SHIFT_JIS=Rr.SJIS.getName(),jr.GB2312="GB2312",jr.ISO88591=Rr.ISO8859_1.getName(),jr.EUC_JP="EUC_JP",jr.UTF8=Rr.UTF8.getName(),jr.PLATFORM_DEFAULT_ENCODING=jr.UTF8,jr.ASSUME_SHIFT_JIS=!1;class Jr{constructor(it=""){this.value=it}enableDecoding(it){return this.encoding=it,this}append(it){return typeof it=="string"?this.value+=it.toString():this.encoding?this.value+=jr.castAsNonUtf8Char(it,this.encoding):this.value+=String.fromCharCode(it),this}appendChars(it,ct,pt){for(let Ct=ct;ct<ct+pt;Ct++)this.append(it[Ct]);return this}length(){return this.value.length}charAt(it){return this.value.charAt(it)}deleteCharAt(it){this.value=this.value.substr(0,it)+this.value.substring(it+1)}setCharAt(it,ct){this.value=this.value.substr(0,it)+ct+this.value.substr(it+1)}substring(it,ct){return this.value.substring(it,ct)}setLengthToZero(){this.value=""}toString(){return this.value}insert(it,ct){this.value=this.value.substr(0,it)+ct+this.value.substr(it+ct.length)}}class fn{constructor(it,ct,pt,Ct){if(this.width=it,this.height=ct,this.rowSize=pt,this.bits=Ct,ct==null&&(ct=it),this.height=ct,it<1||ct<1)throw new St("Both dimensions must be greater than 0");pt==null&&(pt=Math.floor((it+31)/32)),this.rowSize=pt,Ct==null&&(this.bits=new Int32Array(this.rowSize*this.height))}static parseFromBooleanArray(it){const ct=it.length,pt=it[0].length,Ct=new fn(pt,ct);for(let It=0;It<ct;It++){const Dt=it[It];for(let qt=0;qt<pt;qt++)Dt[qt]&&Ct.set(qt,It)}return Ct}static parseFromString(it,ct,pt){if(it===null)throw new St("stringRepresentation cannot be null");const Ct=new Array(it.length);let It=0,Dt=0,qt=-1,Jt=0,ar=0;for(;ar<it.length;)if(it.charAt(ar)===`
`||it.charAt(ar)==="\r"){if(It>Dt){if(qt===-1)qt=It-Dt;else if(It-Dt!==qt)throw new St("row lengths do not match");Dt=It,Jt++}ar++}else if(it.substring(ar,ar+ct.length)===ct)ar+=ct.length,Ct[It]=!0,It++;else if(it.substring(ar,ar+pt.length)===pt)ar+=pt.length,Ct[It]=!1,It++;else throw new St("illegal character encountered: "+it.substring(ar));if(It>Dt){if(qt===-1)qt=It-Dt;else if(It-Dt!==qt)throw new St("row lengths do not match");Jt++}const Er=new fn(qt,Jt);for(let Pr=0;Pr<It;Pr++)Ct[Pr]&&Er.set(Math.floor(Pr%qt),Math.floor(Pr/qt));return Er}get(it,ct){const pt=ct*this.rowSize+Math.floor(it/32);return(this.bits[pt]>>>(it&31)&1)!==0}set(it,ct){const pt=ct*this.rowSize+Math.floor(it/32);this.bits[pt]|=1<<(it&31)&4294967295}unset(it,ct){const pt=ct*this.rowSize+Math.floor(it/32);this.bits[pt]&=~(1<<(it&31)&4294967295)}flip(it,ct){const pt=ct*this.rowSize+Math.floor(it/32);this.bits[pt]^=1<<(it&31)&4294967295}xor(it){if(this.width!==it.getWidth()||this.height!==it.getHeight()||this.rowSize!==it.getRowSize())throw new St("input matrix dimensions do not match");const ct=new Gt(Math.floor(this.width/32)+1),pt=this.rowSize,Ct=this.bits;for(let It=0,Dt=this.height;It<Dt;It++){const qt=It*pt,Jt=it.getRow(It,ct).getBitArray();for(let ar=0;ar<pt;ar++)Ct[qt+ar]^=Jt[ar]}}clear(){const it=this.bits,ct=it.length;for(let pt=0;pt<ct;pt++)it[pt]=0}setRegion(it,ct,pt,Ct){if(ct<0||it<0)throw new St("Left and top must be nonnegative");if(Ct<1||pt<1)throw new St("Height and width must be at least 1");const It=it+pt,Dt=ct+Ct;if(Dt>this.height||It>this.width)throw new St("The region must fit inside the matrix");const qt=this.rowSize,Jt=this.bits;for(let ar=ct;ar<Dt;ar++){const Er=ar*qt;for(let Pr=it;Pr<It;Pr++)Jt[Er+Math.floor(Pr/32)]|=1<<(Pr&31)&4294967295}}getRow(it,ct){ct==null||ct.getSize()<this.width?ct=new Gt(this.width):ct.clear();const pt=this.rowSize,Ct=this.bits,It=it*pt;for(let Dt=0;Dt<pt;Dt++)ct.setBulk(Dt*32,Ct[It+Dt]);return ct}setRow(it,ct){Bt.arraycopy(ct.getBitArray(),0,this.bits,it*this.rowSize,this.rowSize)}rotate180(){const it=this.getWidth(),ct=this.getHeight();let pt=new Gt(it),Ct=new Gt(it);for(let It=0,Dt=Math.floor((ct+1)/2);It<Dt;It++)pt=this.getRow(It,pt),Ct=this.getRow(ct-1-It,Ct),pt.reverse(),Ct.reverse(),this.setRow(It,Ct),this.setRow(ct-1-It,pt)}getEnclosingRectangle(){const it=this.width,ct=this.height,pt=this.rowSize,Ct=this.bits;let It=it,Dt=ct,qt=-1,Jt=-1;for(let ar=0;ar<ct;ar++)for(let Er=0;Er<pt;Er++){const Pr=Ct[ar*pt+Er];if(Pr!==0){if(ar<Dt&&(Dt=ar),ar>Jt&&(Jt=ar),Er*32<It){let Gr=0;for(;!(Pr<<31-Gr&4294967295);)Gr++;Er*32+Gr<It&&(It=Er*32+Gr)}if(Er*32+31>qt){let Gr=31;for(;!(Pr>>>Gr);)Gr--;Er*32+Gr>qt&&(qt=Er*32+Gr)}}}return qt<It||Jt<Dt?null:Int32Array.from([It,Dt,qt-It+1,Jt-Dt+1])}getTopLeftOnBit(){const it=this.rowSize,ct=this.bits;let pt=0;for(;pt<ct.length&&ct[pt]===0;)pt++;if(pt===ct.length)return null;const Ct=pt/it;let It=pt%it*32;const Dt=ct[pt];let qt=0;for(;!(Dt<<31-qt&4294967295);)qt++;return It+=qt,Int32Array.from([It,Ct])}getBottomRightOnBit(){const it=this.rowSize,ct=this.bits;let pt=ct.length-1;for(;pt>=0&&ct[pt]===0;)pt--;if(pt<0)return null;const Ct=Math.floor(pt/it);let It=Math.floor(pt%it)*32;const Dt=ct[pt];let qt=31;for(;!(Dt>>>qt);)qt--;return It+=qt,Int32Array.from([It,Ct])}getWidth(){return this.width}getHeight(){return this.height}getRowSize(){return this.rowSize}equals(it){if(!(it instanceof fn))return!1;const ct=it;return this.width===ct.width&&this.height===ct.height&&this.rowSize===ct.rowSize&&Ut.equals(this.bits,ct.bits)}hashCode(){let it=this.width;return it=31*it+this.width,it=31*it+this.height,it=31*it+this.rowSize,it=31*it+Ut.hashCode(this.bits),it}toString(it="X ",ct="  ",pt=`
`){return this.buildToString(it,ct,pt)}buildToString(it,ct,pt){let Ct=new Jr;for(let It=0,Dt=this.height;It<Dt;It++){for(let qt=0,Jt=this.width;qt<Jt;qt++)Ct.append(this.get(qt,It)?it:ct);Ct.append(pt)}return Ct.toString()}clone(){return new fn(this.width,this.height,this.rowSize,this.bits.slice())}}class Fr extends ht{static getNotFoundInstance(){return new Fr}}Fr.kind="NotFoundException";class Cr extends Vt{constructor(it){super(it),this.luminances=Cr.EMPTY,this.buckets=new Int32Array(Cr.LUMINANCE_BUCKETS)}getBlackRow(it,ct){const pt=this.getLuminanceSource(),Ct=pt.getWidth();ct==null||ct.getSize()<Ct?ct=new Gt(Ct):ct.clear(),this.initArrays(Ct);const It=pt.getRow(it,this.luminances),Dt=this.buckets;for(let Jt=0;Jt<Ct;Jt++)Dt[(It[Jt]&255)>>Cr.LUMINANCE_SHIFT]++;const qt=Cr.estimateBlackPoint(Dt);if(Ct<3)for(let Jt=0;Jt<Ct;Jt++)(It[Jt]&255)<qt&&ct.set(Jt);else{let Jt=It[0]&255,ar=It[1]&255;for(let Er=1;Er<Ct-1;Er++){const Pr=It[Er+1]&255;(ar*4-Jt-Pr)/2<qt&&ct.set(Er),Jt=ar,ar=Pr}}return ct}getBlackMatrix(){const it=this.getLuminanceSource(),ct=it.getWidth(),pt=it.getHeight(),Ct=new fn(ct,pt);this.initArrays(ct);const It=this.buckets;for(let Jt=1;Jt<5;Jt++){const ar=Math.floor(pt*Jt/5),Er=it.getRow(ar,this.luminances),Pr=Math.floor(ct*4/5);for(let Gr=Math.floor(ct/5);Gr<Pr;Gr++){const pn=Er[Gr]&255;It[pn>>Cr.LUMINANCE_SHIFT]++}}const Dt=Cr.estimateBlackPoint(It),qt=it.getMatrix();for(let Jt=0;Jt<pt;Jt++){const ar=Jt*ct;for(let Er=0;Er<ct;Er++)(qt[ar+Er]&255)<Dt&&Ct.set(Er,Jt)}return Ct}createBinarizer(it){return new Cr(it)}initArrays(it){this.luminances.length<it&&(this.luminances=new Uint8ClampedArray(it));const ct=this.buckets;for(let pt=0;pt<Cr.LUMINANCE_BUCKETS;pt++)ct[pt]=0}static estimateBlackPoint(it){const ct=it.length;let pt=0,Ct=0,It=0;for(let Er=0;Er<ct;Er++)it[Er]>It&&(Ct=Er,It=it[Er]),it[Er]>pt&&(pt=it[Er]);let Dt=0,qt=0;for(let Er=0;Er<ct;Er++){const Pr=Er-Ct,Gr=it[Er]*Pr*Pr;Gr>qt&&(Dt=Er,qt=Gr)}if(Ct>Dt){const Er=Ct;Ct=Dt,Dt=Er}if(Dt-Ct<=ct/16)throw new Fr;let Jt=Dt-1,ar=-1;for(let Er=Dt-1;Er>Ct;Er--){const Pr=Er-Ct,Gr=Pr*Pr*(Dt-Er)*(pt-it[Er]);Gr>ar&&(Jt=Er,ar=Gr)}return Jt<<Cr.LUMINANCE_SHIFT}}Cr.LUMINANCE_BITS=5,Cr.LUMINANCE_SHIFT=8-Cr.LUMINANCE_BITS,Cr.LUMINANCE_BUCKETS=1<<Cr.LUMINANCE_BITS,Cr.EMPTY=Uint8ClampedArray.from([0]);class Sr extends Cr{constructor(it){super(it),this.matrix=null}getBlackMatrix(){if(this.matrix!==null)return this.matrix;const it=this.getLuminanceSource(),ct=it.getWidth(),pt=it.getHeight();if(ct>=Sr.MINIMUM_DIMENSION&&pt>=Sr.MINIMUM_DIMENSION){const Ct=it.getMatrix();let It=ct>>Sr.BLOCK_SIZE_POWER;ct&Sr.BLOCK_SIZE_MASK&&It++;let Dt=pt>>Sr.BLOCK_SIZE_POWER;pt&Sr.BLOCK_SIZE_MASK&&Dt++;const qt=Sr.calculateBlackPoints(Ct,It,Dt,ct,pt),Jt=new fn(ct,pt);Sr.calculateThresholdForBlock(Ct,It,Dt,ct,pt,qt,Jt),this.matrix=Jt}else this.matrix=super.getBlackMatrix();return this.matrix}createBinarizer(it){return new Sr(it)}static calculateThresholdForBlock(it,ct,pt,Ct,It,Dt,qt){const Jt=It-Sr.BLOCK_SIZE,ar=Ct-Sr.BLOCK_SIZE;for(let Er=0;Er<pt;Er++){let Pr=Er<<Sr.BLOCK_SIZE_POWER;Pr>Jt&&(Pr=Jt);const Gr=Sr.cap(Er,2,pt-3);for(let pn=0;pn<ct;pn++){let An=pn<<Sr.BLOCK_SIZE_POWER;An>ar&&(An=ar);const Pn=Sr.cap(pn,2,ct-3);let Xn=0;for(let Ks=-2;Ks<=2;Ks++){const Js=Dt[Gr+Ks];Xn+=Js[Pn-2]+Js[Pn-1]+Js[Pn]+Js[Pn+1]+Js[Pn+2]}const os=Xn/25;Sr.thresholdBlock(it,An,Pr,os,Ct,qt)}}}static cap(it,ct,pt){return it<ct?ct:it>pt?pt:it}static thresholdBlock(it,ct,pt,Ct,It,Dt){for(let qt=0,Jt=pt*It+ct;qt<Sr.BLOCK_SIZE;qt++,Jt+=It)for(let ar=0;ar<Sr.BLOCK_SIZE;ar++)(it[Jt+ar]&255)<=Ct&&Dt.set(ct+ar,pt+qt)}static calculateBlackPoints(it,ct,pt,Ct,It){const Dt=It-Sr.BLOCK_SIZE,qt=Ct-Sr.BLOCK_SIZE,Jt=new Array(pt);for(let ar=0;ar<pt;ar++){Jt[ar]=new Int32Array(ct);let Er=ar<<Sr.BLOCK_SIZE_POWER;Er>Dt&&(Er=Dt);for(let Pr=0;Pr<ct;Pr++){let Gr=Pr<<Sr.BLOCK_SIZE_POWER;Gr>qt&&(Gr=qt);let pn=0,An=255,Pn=0;for(let os=0,Ks=Er*Ct+Gr;os<Sr.BLOCK_SIZE;os++,Ks+=Ct){for(let Js=0;Js<Sr.BLOCK_SIZE;Js++){const Hs=it[Ks+Js]&255;pn+=Hs,Hs<An&&(An=Hs),Hs>Pn&&(Pn=Hs)}if(Pn-An>Sr.MIN_DYNAMIC_RANGE)for(os++,Ks+=Ct;os<Sr.BLOCK_SIZE;os++,Ks+=Ct)for(let Js=0;Js<Sr.BLOCK_SIZE;Js++)pn+=it[Ks+Js]&255}let Xn=pn>>Sr.BLOCK_SIZE_POWER*2;if(Pn-An<=Sr.MIN_DYNAMIC_RANGE&&(Xn=An/2,ar>0&&Pr>0)){const os=(Jt[ar-1][Pr]+2*Jt[ar][Pr-1]+Jt[ar-1][Pr-1])/4;An<os&&(Xn=os)}Jt[ar][Pr]=Xn}}return Jt}}Sr.BLOCK_SIZE_POWER=3,Sr.BLOCK_SIZE=1<<Sr.BLOCK_SIZE_POWER,Sr.BLOCK_SIZE_MASK=Sr.BLOCK_SIZE-1,Sr.MINIMUM_DIMENSION=Sr.BLOCK_SIZE*5,Sr.MIN_DYNAMIC_RANGE=24;class dr{constructor(it,ct){this.width=it,this.height=ct}getWidth(){return this.width}getHeight(){return this.height}isCropSupported(){return!1}crop(it,ct,pt,Ct){throw new on("This luminance source does not support cropping.")}isRotateSupported(){return!1}rotateCounterClockwise(){throw new on("This luminance source does not support rotation by 90 degrees.")}rotateCounterClockwise45(){throw new on("This luminance source does not support rotation by 45 degrees.")}toString(){const it=new Uint8ClampedArray(this.width);let ct=new Jr;for(let pt=0;pt<this.height;pt++){const Ct=this.getRow(pt,it);for(let It=0;It<this.width;It++){const Dt=Ct[It]&255;let qt;Dt<64?qt="#":Dt<128?qt="+":Dt<192?qt=".":qt=" ",ct.append(qt)}ct.append(`
`)}return ct.toString()}}class gr extends dr{constructor(it){super(it.getWidth(),it.getHeight()),this.delegate=it}getRow(it,ct){const pt=this.delegate.getRow(it,ct),Ct=this.getWidth();for(let It=0;It<Ct;It++)pt[It]=255-(pt[It]&255);return pt}getMatrix(){const it=this.delegate.getMatrix(),ct=this.getWidth()*this.getHeight(),pt=new Uint8ClampedArray(ct);for(let Ct=0;Ct<ct;Ct++)pt[Ct]=255-(it[Ct]&255);return pt}isCropSupported(){return this.delegate.isCropSupported()}crop(it,ct,pt,Ct){return new gr(this.delegate.crop(it,ct,pt,Ct))}isRotateSupported(){return this.delegate.isRotateSupported()}invert(){return this.delegate}rotateCounterClockwise(){return new gr(this.delegate.rotateCounterClockwise())}rotateCounterClockwise45(){return new gr(this.delegate.rotateCounterClockwise45())}}class qr extends dr{constructor(it){super(it.width,it.height),this.canvas=it,this.tempCanvasElement=null,this.buffer=qr.makeBufferFromCanvasImageData(it)}static makeBufferFromCanvasImageData(it){const ct=it.getContext("2d").getImageData(0,0,it.width,it.height);return qr.toGrayscaleBuffer(ct.data,it.width,it.height)}static toGrayscaleBuffer(it,ct,pt){const Ct=new Uint8ClampedArray(ct*pt);for(let It=0,Dt=0,qt=it.length;It<qt;It+=4,Dt++){let Jt;if(it[It+3]===0)Jt=255;else{const Er=it[It],Pr=it[It+1],Gr=it[It+2];Jt=306*Er+601*Pr+117*Gr+512>>10}Ct[Dt]=Jt}return Ct}getRow(it,ct){if(it<0||it>=this.getHeight())throw new St("Requested row is outside the image: "+it);const pt=this.getWidth(),Ct=it*pt;return ct===null?ct=this.buffer.slice(Ct,Ct+pt):(ct.length<pt&&(ct=new Uint8ClampedArray(pt)),ct.set(this.buffer.slice(Ct,Ct+pt))),ct}getMatrix(){return this.buffer}isCropSupported(){return!0}crop(it,ct,pt,Ct){return super.crop(it,ct,pt,Ct),this}isRotateSupported(){return!0}rotateCounterClockwise(){return this.rotate(-90),this}rotateCounterClockwise45(){return this.rotate(-45),this}getTempCanvasElement(){if(this.tempCanvasElement===null){const it=this.canvas.ownerDocument.createElement("canvas");it.width=this.canvas.width,it.height=this.canvas.height,this.tempCanvasElement=it}return this.tempCanvasElement}rotate(it){const ct=this.getTempCanvasElement(),pt=ct.getContext("2d"),Ct=it*qr.DEGREE_TO_RADIANS,It=this.canvas.width,Dt=this.canvas.height,qt=Math.ceil(Math.abs(Math.cos(Ct))*It+Math.abs(Math.sin(Ct))*Dt),Jt=Math.ceil(Math.abs(Math.sin(Ct))*It+Math.abs(Math.cos(Ct))*Dt);return ct.width=qt,ct.height=Jt,pt.translate(qt/2,Jt/2),pt.rotate(Ct),pt.drawImage(this.canvas,It/-2,Dt/-2),this.buffer=qr.makeBufferFromCanvasImageData(ct),this}invert(){return new gr(this)}}qr.DEGREE_TO_RADIANS=Math.PI/180;class Lr{constructor(it,ct,pt){this.deviceId=it,this.label=ct,this.kind="videoinput",this.groupId=pt||void 0}toJSON(){return{kind:this.kind,groupId:this.groupId,deviceId:this.deviceId,label:this.label}}}var _n=(globalThis||commonjsGlobal||self||window||void 0)&&(globalThis||commonjsGlobal||self||window||void 0).__awaiter||function(wr,it,ct,pt){function Ct(It){return It instanceof ct?It:new ct(function(Dt){Dt(It)})}return new(ct||(ct=Promise))(function(It,Dt){function qt(Er){try{ar(pt.next(Er))}catch(Pr){Dt(Pr)}}function Jt(Er){try{ar(pt.throw(Er))}catch(Pr){Dt(Pr)}}function ar(Er){Er.done?It(Er.value):Ct(Er.value).then(qt,Jt)}ar((pt=pt.apply(wr,it||[])).next())})};class gn{constructor(it,ct=500,pt){this.reader=it,this.timeBetweenScansMillis=ct,this._hints=pt,this._stopContinuousDecode=!1,this._stopAsyncDecode=!1,this._timeBetweenDecodingAttempts=0}get hasNavigator(){return typeof navigator<"u"}get isMediaDevicesSuported(){return this.hasNavigator&&!!navigator.mediaDevices}get canEnumerateDevices(){return!!(this.isMediaDevicesSuported&&navigator.mediaDevices.enumerateDevices)}get timeBetweenDecodingAttempts(){return this._timeBetweenDecodingAttempts}set timeBetweenDecodingAttempts(it){this._timeBetweenDecodingAttempts=it<0?0:it}set hints(it){this._hints=it||null}get hints(){return this._hints}listVideoInputDevices(){return _n(this,void 0,void 0,function*(){if(!this.hasNavigator)throw new Error("Can't enumerate devices, navigator is not present.");if(!this.canEnumerateDevices)throw new Error("Can't enumerate devices, method not supported.");const it=yield navigator.mediaDevices.enumerateDevices(),ct=[];for(const pt of it){const Ct=pt.kind==="video"?"videoinput":pt.kind;if(Ct!=="videoinput")continue;const It=pt.deviceId||pt.id,Dt=pt.label||`Video device ${ct.length+1}`,qt=pt.groupId,Jt={deviceId:It,label:Dt,kind:Ct,groupId:qt};ct.push(Jt)}return ct})}getVideoInputDevices(){return _n(this,void 0,void 0,function*(){return(yield this.listVideoInputDevices()).map(ct=>new Lr(ct.deviceId,ct.label))})}findDeviceById(it){return _n(this,void 0,void 0,function*(){const ct=yield this.listVideoInputDevices();return ct?ct.find(pt=>pt.deviceId===it):null})}decodeFromInputVideoDevice(it,ct){return _n(this,void 0,void 0,function*(){return yield this.decodeOnceFromVideoDevice(it,ct)})}decodeOnceFromVideoDevice(it,ct){return _n(this,void 0,void 0,function*(){this.reset();let pt;it?pt={deviceId:{exact:it}}:pt={facingMode:"environment"};const Ct={video:pt};return yield this.decodeOnceFromConstraints(Ct,ct)})}decodeOnceFromConstraints(it,ct){return _n(this,void 0,void 0,function*(){const pt=yield navigator.mediaDevices.getUserMedia(it);return yield this.decodeOnceFromStream(pt,ct)})}decodeOnceFromStream(it,ct){return _n(this,void 0,void 0,function*(){this.reset();const pt=yield this.attachStreamToVideo(it,ct);return yield this.decodeOnce(pt)})}decodeFromInputVideoDeviceContinuously(it,ct,pt){return _n(this,void 0,void 0,function*(){return yield this.decodeFromVideoDevice(it,ct,pt)})}decodeFromVideoDevice(it,ct,pt){return _n(this,void 0,void 0,function*(){let Ct;it?Ct={deviceId:{exact:it}}:Ct={facingMode:"environment"};const It={video:Ct};return yield this.decodeFromConstraints(It,ct,pt)})}decodeFromConstraints(it,ct,pt){return _n(this,void 0,void 0,function*(){const Ct=yield navigator.mediaDevices.getUserMedia(it);return yield this.decodeFromStream(Ct,ct,pt)})}decodeFromStream(it,ct,pt){return _n(this,void 0,void 0,function*(){this.reset();const Ct=yield this.attachStreamToVideo(it,ct);return yield this.decodeContinuously(Ct,pt)})}stopAsyncDecode(){this._stopAsyncDecode=!0}stopContinuousDecode(){this._stopContinuousDecode=!0}attachStreamToVideo(it,ct){return _n(this,void 0,void 0,function*(){const pt=this.prepareVideoElement(ct);return this.addVideoSource(pt,it),this.videoElement=pt,this.stream=it,yield this.playVideoOnLoadAsync(pt),pt})}playVideoOnLoadAsync(it){return new Promise((ct,pt)=>this.playVideoOnLoad(it,()=>ct()))}playVideoOnLoad(it,ct){this.videoEndedListener=()=>this.stopStreams(),this.videoCanPlayListener=()=>this.tryPlayVideo(it),it.addEventListener("ended",this.videoEndedListener),it.addEventListener("canplay",this.videoCanPlayListener),it.addEventListener("playing",ct),this.tryPlayVideo(it)}isVideoPlaying(it){return it.currentTime>0&&!it.paused&&!it.ended&&it.readyState>2}tryPlayVideo(it){return _n(this,void 0,void 0,function*(){if(this.isVideoPlaying(it)){console.warn("Trying to play video that is already playing.");return}try{yield it.play()}catch{console.warn("It was not possible to play the video.")}})}getMediaElement(it,ct){const pt=document.getElementById(it);if(!pt)throw new Et(`element with id '${it}' not found`);if(pt.nodeName.toLowerCase()!==ct.toLowerCase())throw new Et(`element with id '${it}' must be an ${ct} element`);return pt}decodeFromImage(it,ct){if(!it&&!ct)throw new Et("either imageElement with a src set or an url must be provided");return ct&&!it?this.decodeFromImageUrl(ct):this.decodeFromImageElement(it)}decodeFromVideo(it,ct){if(!it&&!ct)throw new Et("Either an element with a src set or an URL must be provided");return ct&&!it?this.decodeFromVideoUrl(ct):this.decodeFromVideoElement(it)}decodeFromVideoContinuously(it,ct,pt){if(it===void 0&&ct===void 0)throw new Et("Either an element with a src set or an URL must be provided");return ct&&!it?this.decodeFromVideoUrlContinuously(ct,pt):this.decodeFromVideoElementContinuously(it,pt)}decodeFromImageElement(it){if(!it)throw new Et("An image element must be provided.");this.reset();const ct=this.prepareImageElement(it);this.imageElement=ct;let pt;return this.isImageLoaded(ct)?pt=this.decodeOnce(ct,!1,!0):pt=this._decodeOnLoadImage(ct),pt}decodeFromVideoElement(it){const ct=this._decodeFromVideoElementSetup(it);return this._decodeOnLoadVideo(ct)}decodeFromVideoElementContinuously(it,ct){const pt=this._decodeFromVideoElementSetup(it);return this._decodeOnLoadVideoContinuously(pt,ct)}_decodeFromVideoElementSetup(it){if(!it)throw new Et("A video element must be provided.");this.reset();const ct=this.prepareVideoElement(it);return this.videoElement=ct,ct}decodeFromImageUrl(it){if(!it)throw new Et("An URL must be provided.");this.reset();const ct=this.prepareImageElement();this.imageElement=ct;const pt=this._decodeOnLoadImage(ct);return ct.src=it,pt}decodeFromVideoUrl(it){if(!it)throw new Et("An URL must be provided.");this.reset();const ct=this.prepareVideoElement(),pt=this.decodeFromVideoElement(ct);return ct.src=it,pt}decodeFromVideoUrlContinuously(it,ct){if(!it)throw new Et("An URL must be provided.");this.reset();const pt=this.prepareVideoElement(),Ct=this.decodeFromVideoElementContinuously(pt,ct);return pt.src=it,Ct}_decodeOnLoadImage(it){return new Promise((ct,pt)=>{this.imageLoadedListener=()=>this.decodeOnce(it,!1,!0).then(ct,pt),it.addEventListener("load",this.imageLoadedListener)})}_decodeOnLoadVideo(it){return _n(this,void 0,void 0,function*(){return yield this.playVideoOnLoadAsync(it),yield this.decodeOnce(it)})}_decodeOnLoadVideoContinuously(it,ct){return _n(this,void 0,void 0,function*(){yield this.playVideoOnLoadAsync(it),this.decodeContinuously(it,ct)})}isImageLoaded(it){return!(!it.complete||it.naturalWidth===0)}prepareImageElement(it){let ct;return typeof it>"u"&&(ct=document.createElement("img"),ct.width=200,ct.height=200),typeof it=="string"&&(ct=this.getMediaElement(it,"img")),it instanceof HTMLImageElement&&(ct=it),ct}prepareVideoElement(it){let ct;return!it&&typeof document<"u"&&(ct=document.createElement("video"),ct.width=200,ct.height=200),typeof it=="string"&&(ct=this.getMediaElement(it,"video")),it instanceof HTMLVideoElement&&(ct=it),ct.setAttribute("autoplay","true"),ct.setAttribute("muted","true"),ct.setAttribute("playsinline","true"),ct}decodeOnce(it,ct=!0,pt=!0){this._stopAsyncDecode=!1;const Ct=(It,Dt)=>{if(this._stopAsyncDecode){Dt(new Fr("Video stream has ended before any code could be detected.")),this._stopAsyncDecode=void 0;return}try{const qt=this.decode(it);It(qt)}catch(qt){const Jt=ct&&qt instanceof Fr,Er=(qt instanceof Pt||qt instanceof or)&&pt;if(Jt||Er)return setTimeout(Ct,this._timeBetweenDecodingAttempts,It,Dt);Dt(qt)}};return new Promise((It,Dt)=>Ct(It,Dt))}decodeContinuously(it,ct){this._stopContinuousDecode=!1;const pt=()=>{if(this._stopContinuousDecode){this._stopContinuousDecode=void 0;return}try{const Ct=this.decode(it);ct(Ct,null),setTimeout(pt,this.timeBetweenScansMillis)}catch(Ct){ct(null,Ct);const It=Ct instanceof Pt||Ct instanceof or,Dt=Ct instanceof Fr;(It||Dt)&&setTimeout(pt,this._timeBetweenDecodingAttempts)}};pt()}decode(it){const ct=this.createBinaryBitmap(it);return this.decodeBitmap(ct)}_isHTMLVideoElement(it){return it.videoWidth!==0}drawFrameOnCanvas(it,ct,pt){ct||(ct={sx:0,sy:0,sWidth:it.videoWidth,sHeight:it.videoHeight,dx:0,dy:0,dWidth:it.videoWidth,dHeight:it.videoHeight}),pt||(pt=this.captureCanvasContext),pt.drawImage(it,ct.sx,ct.sy,ct.sWidth,ct.sHeight,ct.dx,ct.dy,ct.dWidth,ct.dHeight)}drawImageOnCanvas(it,ct,pt=this.captureCanvasContext){ct||(ct={sx:0,sy:0,sWidth:it.naturalWidth,sHeight:it.naturalHeight,dx:0,dy:0,dWidth:it.naturalWidth,dHeight:it.naturalHeight}),pt||(pt=this.captureCanvasContext),pt.drawImage(it,ct.sx,ct.sy,ct.sWidth,ct.sHeight,ct.dx,ct.dy,ct.dWidth,ct.dHeight)}createBinaryBitmap(it){this.getCaptureCanvasContext(it),this._isHTMLVideoElement(it)?this.drawFrameOnCanvas(it):this.drawImageOnCanvas(it);const ct=this.getCaptureCanvas(it),pt=new qr(ct),Ct=new Sr(pt);return new At(Ct)}getCaptureCanvasContext(it){if(!this.captureCanvasContext){const pt=this.getCaptureCanvas(it).getContext("2d");this.captureCanvasContext=pt}return this.captureCanvasContext}getCaptureCanvas(it){if(!this.captureCanvas){const ct=this.createCaptureCanvas(it);this.captureCanvas=ct}return this.captureCanvas}decodeBitmap(it){return this.reader.decode(it,this._hints)}createCaptureCanvas(it){if(typeof document>"u")return this._destroyCaptureCanvas(),null;const ct=document.createElement("canvas");let pt,Ct;return typeof it<"u"&&(it instanceof HTMLVideoElement?(pt=it.videoWidth,Ct=it.videoHeight):it instanceof HTMLImageElement&&(pt=it.naturalWidth||it.width,Ct=it.naturalHeight||it.height)),ct.style.width=pt+"px",ct.style.height=Ct+"px",ct.width=pt,ct.height=Ct,ct}stopStreams(){this.stream&&(this.stream.getVideoTracks().forEach(it=>it.stop()),this.stream=void 0),this._stopAsyncDecode===!1&&this.stopAsyncDecode(),this._stopContinuousDecode===!1&&this.stopContinuousDecode()}reset(){this.stopStreams(),this._destroyVideoElement(),this._destroyImageElement(),this._destroyCaptureCanvas()}_destroyVideoElement(){this.videoElement&&(typeof this.videoEndedListener<"u"&&this.videoElement.removeEventListener("ended",this.videoEndedListener),typeof this.videoPlayingEventListener<"u"&&this.videoElement.removeEventListener("playing",this.videoPlayingEventListener),typeof this.videoCanPlayListener<"u"&&this.videoElement.removeEventListener("loadedmetadata",this.videoCanPlayListener),this.cleanVideoSource(this.videoElement),this.videoElement=void 0)}_destroyImageElement(){this.imageElement&&(this.imageLoadedListener!==void 0&&this.imageElement.removeEventListener("load",this.imageLoadedListener),this.imageElement.src=void 0,this.imageElement.removeAttribute("src"),this.imageElement=void 0)}_destroyCaptureCanvas(){this.captureCanvasContext=void 0,this.captureCanvas=void 0}addVideoSource(it,ct){try{it.srcObject=ct}catch{it.src=URL.createObjectURL(ct)}}cleanVideoSource(it){try{it.srcObject=null}catch{it.src=""}this.videoElement.removeAttribute("src")}}class Sn{constructor(it,ct,pt=ct==null?0:8*ct.length,Ct,It,Dt=Bt.currentTimeMillis()){this.text=it,this.rawBytes=ct,this.numBits=pt,this.resultPoints=Ct,this.format=It,this.timestamp=Dt,this.text=it,this.rawBytes=ct,pt==null?this.numBits=ct==null?0:8*ct.length:this.numBits=pt,this.resultPoints=Ct,this.format=It,this.resultMetadata=null,Dt==null?this.timestamp=Bt.currentTimeMillis():this.timestamp=Dt}getText(){return this.text}getRawBytes(){return this.rawBytes}getNumBits(){return this.numBits}getResultPoints(){return this.resultPoints}getBarcodeFormat(){return this.format}getResultMetadata(){return this.resultMetadata}putMetadata(it,ct){this.resultMetadata===null&&(this.resultMetadata=new Map),this.resultMetadata.set(it,ct)}putAllMetadata(it){it!==null&&(this.resultMetadata===null?this.resultMetadata=it:this.resultMetadata=new Map(it))}addResultPoints(it){const ct=this.resultPoints;if(ct===null)this.resultPoints=it;else if(it!==null&&it.length>0){const pt=new Array(ct.length+it.length);Bt.arraycopy(ct,0,pt,0,ct.length),Bt.arraycopy(it,0,pt,ct.length,it.length),this.resultPoints=pt}}getTimestamp(){return this.timestamp}toString(){return this.text}}var Fs;(function(wr){wr[wr.AZTEC=0]="AZTEC",wr[wr.CODABAR=1]="CODABAR",wr[wr.CODE_39=2]="CODE_39",wr[wr.CODE_93=3]="CODE_93",wr[wr.CODE_128=4]="CODE_128",wr[wr.DATA_MATRIX=5]="DATA_MATRIX",wr[wr.EAN_8=6]="EAN_8",wr[wr.EAN_13=7]="EAN_13",wr[wr.ITF=8]="ITF",wr[wr.MAXICODE=9]="MAXICODE",wr[wr.PDF_417=10]="PDF_417",wr[wr.QR_CODE=11]="QR_CODE",wr[wr.RSS_14=12]="RSS_14",wr[wr.RSS_EXPANDED=13]="RSS_EXPANDED",wr[wr.UPC_A=14]="UPC_A",wr[wr.UPC_E=15]="UPC_E",wr[wr.UPC_EAN_EXTENSION=16]="UPC_EAN_EXTENSION"})(Fs||(Fs={}));var rs=Fs,ms;(function(wr){wr[wr.OTHER=0]="OTHER",wr[wr.ORIENTATION=1]="ORIENTATION",wr[wr.BYTE_SEGMENTS=2]="BYTE_SEGMENTS",wr[wr.ERROR_CORRECTION_LEVEL=3]="ERROR_CORRECTION_LEVEL",wr[wr.ISSUE_NUMBER=4]="ISSUE_NUMBER",wr[wr.SUGGESTED_PRICE=5]="SUGGESTED_PRICE",wr[wr.POSSIBLE_COUNTRY=6]="POSSIBLE_COUNTRY",wr[wr.UPC_EAN_EXTENSION=7]="UPC_EAN_EXTENSION",wr[wr.PDF417_EXTRA_METADATA=8]="PDF417_EXTRA_METADATA",wr[wr.STRUCTURED_APPEND_SEQUENCE=9]="STRUCTURED_APPEND_SEQUENCE",wr[wr.STRUCTURED_APPEND_PARITY=10]="STRUCTURED_APPEND_PARITY"})(ms||(ms={}));var On=ms;class ws{constructor(it,ct,pt,Ct,It=-1,Dt=-1){this.rawBytes=it,this.text=ct,this.byteSegments=pt,this.ecLevel=Ct,this.structuredAppendSequenceNumber=It,this.structuredAppendParity=Dt,this.numBits=it==null?0:8*it.length}getRawBytes(){return this.rawBytes}getNumBits(){return this.numBits}setNumBits(it){this.numBits=it}getText(){return this.text}getByteSegments(){return this.byteSegments}getECLevel(){return this.ecLevel}getErrorsCorrected(){return this.errorsCorrected}setErrorsCorrected(it){this.errorsCorrected=it}getErasures(){return this.erasures}setErasures(it){this.erasures=it}getOther(){return this.other}setOther(it){this.other=it}hasStructuredAppend(){return this.structuredAppendParity>=0&&this.structuredAppendSequenceNumber>=0}getStructuredAppendParity(){return this.structuredAppendParity}getStructuredAppendSequenceNumber(){return this.structuredAppendSequenceNumber}}class Vs{exp(it){return this.expTable[it]}log(it){if(it===0)throw new St;return this.logTable[it]}static addOrSubtract(it,ct){return it^ct}}class ks{constructor(it,ct){if(ct.length===0)throw new St;this.field=it;const pt=ct.length;if(pt>1&&ct[0]===0){let Ct=1;for(;Ct<pt&&ct[Ct]===0;)Ct++;Ct===pt?this.coefficients=Int32Array.from([0]):(this.coefficients=new Int32Array(pt-Ct),Bt.arraycopy(ct,Ct,this.coefficients,0,this.coefficients.length))}else this.coefficients=ct}getCoefficients(){return this.coefficients}getDegree(){return this.coefficients.length-1}isZero(){return this.coefficients[0]===0}getCoefficient(it){return this.coefficients[this.coefficients.length-1-it]}evaluateAt(it){if(it===0)return this.getCoefficient(0);const ct=this.coefficients;let pt;if(it===1){pt=0;for(let Dt=0,qt=ct.length;Dt!==qt;Dt++){const Jt=ct[Dt];pt=Vs.addOrSubtract(pt,Jt)}return pt}pt=ct[0];const Ct=ct.length,It=this.field;for(let Dt=1;Dt<Ct;Dt++)pt=Vs.addOrSubtract(It.multiply(it,pt),ct[Dt]);return pt}addOrSubtract(it){if(!this.field.equals(it.field))throw new St("GenericGFPolys do not have same GenericGF field");if(this.isZero())return it;if(it.isZero())return this;let ct=this.coefficients,pt=it.coefficients;if(ct.length>pt.length){const Dt=ct;ct=pt,pt=Dt}let Ct=new Int32Array(pt.length);const It=pt.length-ct.length;Bt.arraycopy(pt,0,Ct,0,It);for(let Dt=It;Dt<pt.length;Dt++)Ct[Dt]=Vs.addOrSubtract(ct[Dt-It],pt[Dt]);return new ks(this.field,Ct)}multiply(it){if(!this.field.equals(it.field))throw new St("GenericGFPolys do not have same GenericGF field");if(this.isZero()||it.isZero())return this.field.getZero();const ct=this.coefficients,pt=ct.length,Ct=it.coefficients,It=Ct.length,Dt=new Int32Array(pt+It-1),qt=this.field;for(let Jt=0;Jt<pt;Jt++){const ar=ct[Jt];for(let Er=0;Er<It;Er++)Dt[Jt+Er]=Vs.addOrSubtract(Dt[Jt+Er],qt.multiply(ar,Ct[Er]))}return new ks(qt,Dt)}multiplyScalar(it){if(it===0)return this.field.getZero();if(it===1)return this;const ct=this.coefficients.length,pt=this.field,Ct=new Int32Array(ct),It=this.coefficients;for(let Dt=0;Dt<ct;Dt++)Ct[Dt]=pt.multiply(It[Dt],it);return new ks(pt,Ct)}multiplyByMonomial(it,ct){if(it<0)throw new St;if(ct===0)return this.field.getZero();const pt=this.coefficients,Ct=pt.length,It=new Int32Array(Ct+it),Dt=this.field;for(let qt=0;qt<Ct;qt++)It[qt]=Dt.multiply(pt[qt],ct);return new ks(Dt,It)}divide(it){if(!this.field.equals(it.field))throw new St("GenericGFPolys do not have same GenericGF field");if(it.isZero())throw new St("Divide by 0");const ct=this.field;let pt=ct.getZero(),Ct=this;const It=it.getCoefficient(it.getDegree()),Dt=ct.inverse(It);for(;Ct.getDegree()>=it.getDegree()&&!Ct.isZero();){const qt=Ct.getDegree()-it.getDegree(),Jt=ct.multiply(Ct.getCoefficient(Ct.getDegree()),Dt),ar=it.multiplyByMonomial(qt,Jt),Er=ct.buildMonomial(qt,Jt);pt=pt.addOrSubtract(Er),Ct=Ct.addOrSubtract(ar)}return[pt,Ct]}toString(){let it="";for(let ct=this.getDegree();ct>=0;ct--){let pt=this.getCoefficient(ct);if(pt!==0){if(pt<0?(it+=" - ",pt=-pt):it.length>0&&(it+=" + "),ct===0||pt!==1){const Ct=this.field.log(pt);Ct===0?it+="1":Ct===1?it+="a":(it+="a^",it+=Ct)}ct!==0&&(ct===1?it+="x":(it+="x^",it+=ct))}}return it}}class lo extends ht{}lo.kind="ArithmeticException";class ys extends Vs{constructor(it,ct,pt){super(),this.primitive=it,this.size=ct,this.generatorBase=pt;const Ct=new Int32Array(ct);let It=1;for(let qt=0;qt<ct;qt++)Ct[qt]=It,It*=2,It>=ct&&(It^=it,It&=ct-1);this.expTable=Ct;const Dt=new Int32Array(ct);for(let qt=0;qt<ct-1;qt++)Dt[Ct[qt]]=qt;this.logTable=Dt,this.zero=new ks(this,Int32Array.from([0])),this.one=new ks(this,Int32Array.from([1]))}getZero(){return this.zero}getOne(){return this.one}buildMonomial(it,ct){if(it<0)throw new St;if(ct===0)return this.zero;const pt=new Int32Array(it+1);return pt[0]=ct,new ks(this,pt)}inverse(it){if(it===0)throw new lo;return this.expTable[this.size-this.logTable[it]-1]}multiply(it,ct){return it===0||ct===0?0:this.expTable[(this.logTable[it]+this.logTable[ct])%(this.size-1)]}getSize(){return this.size}getGeneratorBase(){return this.generatorBase}toString(){return"GF(0x"+Nt.toHexString(this.primitive)+","+this.size+")"}equals(it){return it===this}}ys.AZTEC_DATA_12=new ys(4201,4096,1),ys.AZTEC_DATA_10=new ys(1033,1024,1),ys.AZTEC_DATA_6=new ys(67,64,1),ys.AZTEC_PARAM=new ys(19,16,1),ys.QR_CODE_FIELD_256=new ys(285,256,0),ys.DATA_MATRIX_FIELD_256=new ys(301,256,1),ys.AZTEC_DATA_8=ys.DATA_MATRIX_FIELD_256,ys.MAXICODE_FIELD_64=ys.AZTEC_DATA_6;class dn extends ht{}dn.kind="ReedSolomonException";class Es extends ht{}Es.kind="IllegalStateException";class po{constructor(it){this.field=it}decode(it,ct){const pt=this.field,Ct=new ks(pt,it),It=new Int32Array(ct);let Dt=!0;for(let pn=0;pn<ct;pn++){const An=Ct.evaluateAt(pt.exp(pn+pt.getGeneratorBase()));It[It.length-1-pn]=An,An!==0&&(Dt=!1)}if(Dt)return;const qt=new ks(pt,It),Jt=this.runEuclideanAlgorithm(pt.buildMonomial(ct,1),qt,ct),ar=Jt[0],Er=Jt[1],Pr=this.findErrorLocations(ar),Gr=this.findErrorMagnitudes(Er,Pr);for(let pn=0;pn<Pr.length;pn++){const An=it.length-1-pt.log(Pr[pn]);if(An<0)throw new dn("Bad error location");it[An]=ys.addOrSubtract(it[An],Gr[pn])}}runEuclideanAlgorithm(it,ct,pt){if(it.getDegree()<ct.getDegree()){const pn=it;it=ct,ct=pn}const Ct=this.field;let It=it,Dt=ct,qt=Ct.getZero(),Jt=Ct.getOne();for(;Dt.getDegree()>=(pt/2|0);){let pn=It,An=qt;if(It=Dt,qt=Jt,It.isZero())throw new dn("r_{i-1} was zero");Dt=pn;let Pn=Ct.getZero();const Xn=It.getCoefficient(It.getDegree()),os=Ct.inverse(Xn);for(;Dt.getDegree()>=It.getDegree()&&!Dt.isZero();){const Ks=Dt.getDegree()-It.getDegree(),Js=Ct.multiply(Dt.getCoefficient(Dt.getDegree()),os);Pn=Pn.addOrSubtract(Ct.buildMonomial(Ks,Js)),Dt=Dt.addOrSubtract(It.multiplyByMonomial(Ks,Js))}if(Jt=Pn.multiply(qt).addOrSubtract(An),Dt.getDegree()>=It.getDegree())throw new Es("Division algorithm failed to reduce polynomial?")}const ar=Jt.getCoefficient(0);if(ar===0)throw new dn("sigmaTilde(0) was zero");const Er=Ct.inverse(ar),Pr=Jt.multiplyScalar(Er),Gr=Dt.multiplyScalar(Er);return[Pr,Gr]}findErrorLocations(it){const ct=it.getDegree();if(ct===1)return Int32Array.from([it.getCoefficient(1)]);const pt=new Int32Array(ct);let Ct=0;const It=this.field;for(let Dt=1;Dt<It.getSize()&&Ct<ct;Dt++)it.evaluateAt(Dt)===0&&(pt[Ct]=It.inverse(Dt),Ct++);if(Ct!==ct)throw new dn("Error locator degree does not match number of roots");return pt}findErrorMagnitudes(it,ct){const pt=ct.length,Ct=new Int32Array(pt),It=this.field;for(let Dt=0;Dt<pt;Dt++){const qt=It.inverse(ct[Dt]);let Jt=1;for(let ar=0;ar<pt;ar++)if(Dt!==ar){const Er=It.multiply(ct[ar],qt),Pr=Er&1?Er&-2:Er|1;Jt=It.multiply(Jt,Pr)}Ct[Dt]=It.multiply(it.evaluateAt(qt),It.inverse(Jt)),It.getGeneratorBase()!==0&&(Ct[Dt]=It.multiply(Ct[Dt],qt))}return Ct}}var no;(function(wr){wr[wr.UPPER=0]="UPPER",wr[wr.LOWER=1]="LOWER",wr[wr.MIXED=2]="MIXED",wr[wr.DIGIT=3]="DIGIT",wr[wr.PUNCT=4]="PUNCT",wr[wr.BINARY=5]="BINARY"})(no||(no={}));class tn{decode(it){this.ddata=it;let ct=it.getBits(),pt=this.extractBits(ct),Ct=this.correctBits(pt),It=tn.convertBoolArrayToByteArray(Ct),Dt=tn.getEncodedData(Ct),qt=new ws(It,Dt,null,null);return qt.setNumBits(Ct.length),qt}static highLevelDecode(it){return this.getEncodedData(it)}static getEncodedData(it){let ct=it.length,pt=no.UPPER,Ct=no.UPPER,It="",Dt=0;for(;Dt<ct;)if(Ct===no.BINARY){if(ct-Dt<5)break;let qt=tn.readCode(it,Dt,5);if(Dt+=5,qt===0){if(ct-Dt<11)break;qt=tn.readCode(it,Dt,11)+31,Dt+=11}for(let Jt=0;Jt<qt;Jt++){if(ct-Dt<8){Dt=ct;break}const ar=tn.readCode(it,Dt,8);It+=jr.castAsNonUtf8Char(ar),Dt+=8}Ct=pt}else{let qt=Ct===no.DIGIT?4:5;if(ct-Dt<qt)break;let Jt=tn.readCode(it,Dt,qt);Dt+=qt;let ar=tn.getCharacter(Ct,Jt);ar.startsWith("CTRL_")?(pt=Ct,Ct=tn.getTable(ar.charAt(5)),ar.charAt(6)==="L"&&(pt=Ct)):(It+=ar,Ct=pt)}return It}static getTable(it){switch(it){case"L":return no.LOWER;case"P":return no.PUNCT;case"M":return no.MIXED;case"D":return no.DIGIT;case"B":return no.BINARY;case"U":default:return no.UPPER}}static getCharacter(it,ct){switch(it){case no.UPPER:return tn.UPPER_TABLE[ct];case no.LOWER:return tn.LOWER_TABLE[ct];case no.MIXED:return tn.MIXED_TABLE[ct];case no.PUNCT:return tn.PUNCT_TABLE[ct];case no.DIGIT:return tn.DIGIT_TABLE[ct];default:throw new Es("Bad table")}}correctBits(it){let ct,pt;this.ddata.getNbLayers()<=2?(pt=6,ct=ys.AZTEC_DATA_6):this.ddata.getNbLayers()<=8?(pt=8,ct=ys.AZTEC_DATA_8):this.ddata.getNbLayers()<=22?(pt=10,ct=ys.AZTEC_DATA_10):(pt=12,ct=ys.AZTEC_DATA_12);let Ct=this.ddata.getNbDatablocks(),It=it.length/pt;if(It<Ct)throw new or;let Dt=it.length%pt,qt=new Int32Array(It);for(let Gr=0;Gr<It;Gr++,Dt+=pt)qt[Gr]=tn.readCode(it,Dt,pt);try{new po(ct).decode(qt,It-Ct)}catch(Gr){throw new or(Gr)}let Jt=(1<<pt)-1,ar=0;for(let Gr=0;Gr<Ct;Gr++){let pn=qt[Gr];if(pn===0||pn===Jt)throw new or;(pn===1||pn===Jt-1)&&ar++}let Er=new Array(Ct*pt-ar),Pr=0;for(let Gr=0;Gr<Ct;Gr++){let pn=qt[Gr];if(pn===1||pn===Jt-1)Er.fill(pn>1,Pr,Pr+pt-1),Pr+=pt-1;else for(let An=pt-1;An>=0;--An)Er[Pr++]=(pn&1<<An)!==0}return Er}extractBits(it){let ct=this.ddata.isCompact(),pt=this.ddata.getNbLayers(),Ct=(ct?11:14)+pt*4,It=new Int32Array(Ct),Dt=new Array(this.totalBitsInLayer(pt,ct));if(ct)for(let qt=0;qt<It.length;qt++)It[qt]=qt;else{let qt=Ct+1+2*Nt.truncDivision(Nt.truncDivision(Ct,2)-1,15),Jt=Ct/2,ar=Nt.truncDivision(qt,2);for(let Er=0;Er<Jt;Er++){let Pr=Er+Nt.truncDivision(Er,15);It[Jt-Er-1]=ar-Pr-1,It[Jt+Er]=ar+Pr+1}}for(let qt=0,Jt=0;qt<pt;qt++){let ar=(pt-qt)*4+(ct?9:12),Er=qt*2,Pr=Ct-1-Er;for(let Gr=0;Gr<ar;Gr++){let pn=Gr*2;for(let An=0;An<2;An++)Dt[Jt+pn+An]=it.get(It[Er+An],It[Er+Gr]),Dt[Jt+2*ar+pn+An]=it.get(It[Er+Gr],It[Pr-An]),Dt[Jt+4*ar+pn+An]=it.get(It[Pr-An],It[Pr-Gr]),Dt[Jt+6*ar+pn+An]=it.get(It[Pr-Gr],It[Er+An])}Jt+=ar*8}return Dt}static readCode(it,ct,pt){let Ct=0;for(let It=ct;It<ct+pt;It++)Ct<<=1,it[It]&&(Ct|=1);return Ct}static readByte(it,ct){let pt=it.length-ct;return pt>=8?tn.readCode(it,ct,8):tn.readCode(it,ct,pt)<<8-pt}static convertBoolArrayToByteArray(it){let ct=new Uint8Array((it.length+7)/8);for(let pt=0;pt<ct.length;pt++)ct[pt]=tn.readByte(it,8*pt);return ct}totalBitsInLayer(it,ct){return((ct?88:112)+16*it)*it}}tn.UPPER_TABLE=["CTRL_PS"," ","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","CTRL_LL","CTRL_ML","CTRL_DL","CTRL_BS"],tn.LOWER_TABLE=["CTRL_PS"," ","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","CTRL_US","CTRL_ML","CTRL_DL","CTRL_BS"],tn.MIXED_TABLE=["CTRL_PS"," ","\\1","\\2","\\3","\\4","\\5","\\6","\\7","\b","	",`
`,"\\13","\f","\r","\\33","\\34","\\35","\\36","\\37","@","\\","^","_","`","|","~","\\177","CTRL_LL","CTRL_UL","CTRL_PL","CTRL_BS"],tn.PUNCT_TABLE=["","\r",`\r
`,". ",", ",": ","!",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","[","]","{","}","CTRL_UL"],tn.DIGIT_TABLE=["CTRL_PS"," ","0","1","2","3","4","5","6","7","8","9",",",".","CTRL_UL","CTRL_US"];class us{constructor(){}static round(it){return it===NaN?0:it<=Number.MIN_SAFE_INTEGER?Number.MIN_SAFE_INTEGER:it>=Number.MAX_SAFE_INTEGER?Number.MAX_SAFE_INTEGER:it+(it<0?-.5:.5)|0}static distance(it,ct,pt,Ct){const It=it-pt,Dt=ct-Ct;return Math.sqrt(It*It+Dt*Dt)}static sum(it){let ct=0;for(let pt=0,Ct=it.length;pt!==Ct;pt++){const It=it[pt];ct+=It}return ct}}class Co{static floatToIntBits(it){return it}}Co.MAX_VALUE=Number.MAX_SAFE_INTEGER;class Ss{constructor(it,ct){this.x=it,this.y=ct}getX(){return this.x}getY(){return this.y}equals(it){if(it instanceof Ss){const ct=it;return this.x===ct.x&&this.y===ct.y}return!1}hashCode(){return 31*Co.floatToIntBits(this.x)+Co.floatToIntBits(this.y)}toString(){return"("+this.x+","+this.y+")"}static orderBestPatterns(it){const ct=this.distance(it[0],it[1]),pt=this.distance(it[1],it[2]),Ct=this.distance(it[0],it[2]);let It,Dt,qt;if(pt>=ct&&pt>=Ct?(Dt=it[0],It=it[1],qt=it[2]):Ct>=pt&&Ct>=ct?(Dt=it[1],It=it[0],qt=it[2]):(Dt=it[2],It=it[0],qt=it[1]),this.crossProductZ(It,Dt,qt)<0){const Jt=It;It=qt,qt=Jt}it[0]=It,it[1]=Dt,it[2]=qt}static distance(it,ct){return us.distance(it.x,it.y,ct.x,ct.y)}static crossProductZ(it,ct,pt){const Ct=ct.x,It=ct.y;return(pt.x-Ct)*(it.y-It)-(pt.y-It)*(it.x-Ct)}}class Ul{constructor(it,ct){this.bits=it,this.points=ct}getBits(){return this.bits}getPoints(){return this.points}}class Tl extends Ul{constructor(it,ct,pt,Ct,It){super(it,ct),this.compact=pt,this.nbDatablocks=Ct,this.nbLayers=It}getNbLayers(){return this.nbLayers}getNbDatablocks(){return this.nbDatablocks}isCompact(){return this.compact}}class ga{constructor(it,ct,pt,Ct){this.image=it,this.height=it.getHeight(),this.width=it.getWidth(),ct==null&&(ct=ga.INIT_SIZE),pt==null&&(pt=it.getWidth()/2|0),Ct==null&&(Ct=it.getHeight()/2|0);const It=ct/2|0;if(this.leftInit=pt-It,this.rightInit=pt+It,this.upInit=Ct-It,this.downInit=Ct+It,this.upInit<0||this.leftInit<0||this.downInit>=this.height||this.rightInit>=this.width)throw new Fr}detect(){let it=this.leftInit,ct=this.rightInit,pt=this.upInit,Ct=this.downInit,It=!1,Dt=!0,qt=!1,Jt=!1,ar=!1,Er=!1,Pr=!1;const Gr=this.width,pn=this.height;for(;Dt;){Dt=!1;let An=!0;for(;(An||!Jt)&&ct<Gr;)An=this.containsBlackPoint(pt,Ct,ct,!1),An?(ct++,Dt=!0,Jt=!0):Jt||ct++;if(ct>=Gr){It=!0;break}let Pn=!0;for(;(Pn||!ar)&&Ct<pn;)Pn=this.containsBlackPoint(it,ct,Ct,!0),Pn?(Ct++,Dt=!0,ar=!0):ar||Ct++;if(Ct>=pn){It=!0;break}let Xn=!0;for(;(Xn||!Er)&&it>=0;)Xn=this.containsBlackPoint(pt,Ct,it,!1),Xn?(it--,Dt=!0,Er=!0):Er||it--;if(it<0){It=!0;break}let os=!0;for(;(os||!Pr)&&pt>=0;)os=this.containsBlackPoint(it,ct,pt,!0),os?(pt--,Dt=!0,Pr=!0):Pr||pt--;if(pt<0){It=!0;break}Dt&&(qt=!0)}if(!It&&qt){const An=ct-it;let Pn=null;for(let Js=1;Pn===null&&Js<An;Js++)Pn=this.getBlackPointOnSegment(it,Ct-Js,it+Js,Ct);if(Pn==null)throw new Fr;let Xn=null;for(let Js=1;Xn===null&&Js<An;Js++)Xn=this.getBlackPointOnSegment(it,pt+Js,it+Js,pt);if(Xn==null)throw new Fr;let os=null;for(let Js=1;os===null&&Js<An;Js++)os=this.getBlackPointOnSegment(ct,pt+Js,ct-Js,pt);if(os==null)throw new Fr;let Ks=null;for(let Js=1;Ks===null&&Js<An;Js++)Ks=this.getBlackPointOnSegment(ct,Ct-Js,ct-Js,Ct);if(Ks==null)throw new Fr;return this.centerEdges(Ks,Pn,os,Xn)}else throw new Fr}getBlackPointOnSegment(it,ct,pt,Ct){const It=us.round(us.distance(it,ct,pt,Ct)),Dt=(pt-it)/It,qt=(Ct-ct)/It,Jt=this.image;for(let ar=0;ar<It;ar++){const Er=us.round(it+ar*Dt),Pr=us.round(ct+ar*qt);if(Jt.get(Er,Pr))return new Ss(Er,Pr)}return null}centerEdges(it,ct,pt,Ct){const It=it.getX(),Dt=it.getY(),qt=ct.getX(),Jt=ct.getY(),ar=pt.getX(),Er=pt.getY(),Pr=Ct.getX(),Gr=Ct.getY(),pn=ga.CORR;return It<this.width/2?[new Ss(Pr-pn,Gr+pn),new Ss(qt+pn,Jt+pn),new Ss(ar-pn,Er-pn),new Ss(It+pn,Dt-pn)]:[new Ss(Pr+pn,Gr+pn),new Ss(qt+pn,Jt-pn),new Ss(ar-pn,Er+pn),new Ss(It-pn,Dt-pn)]}containsBlackPoint(it,ct,pt,Ct){const It=this.image;if(Ct){for(let Dt=it;Dt<=ct;Dt++)if(It.get(Dt,pt))return!0}else for(let Dt=it;Dt<=ct;Dt++)if(It.get(pt,Dt))return!0;return!1}}ga.INIT_SIZE=10,ga.CORR=1;class ds{static checkAndNudgePoints(it,ct){const pt=it.getWidth(),Ct=it.getHeight();let It=!0;for(let Dt=0;Dt<ct.length&&It;Dt+=2){const qt=Math.floor(ct[Dt]),Jt=Math.floor(ct[Dt+1]);if(qt<-1||qt>pt||Jt<-1||Jt>Ct)throw new Fr;It=!1,qt===-1?(ct[Dt]=0,It=!0):qt===pt&&(ct[Dt]=pt-1,It=!0),Jt===-1?(ct[Dt+1]=0,It=!0):Jt===Ct&&(ct[Dt+1]=Ct-1,It=!0)}It=!0;for(let Dt=ct.length-2;Dt>=0&&It;Dt-=2){const qt=Math.floor(ct[Dt]),Jt=Math.floor(ct[Dt+1]);if(qt<-1||qt>pt||Jt<-1||Jt>Ct)throw new Fr;It=!1,qt===-1?(ct[Dt]=0,It=!0):qt===pt&&(ct[Dt]=pt-1,It=!0),Jt===-1?(ct[Dt+1]=0,It=!0):Jt===Ct&&(ct[Dt+1]=Ct-1,It=!0)}}}class Mn{constructor(it,ct,pt,Ct,It,Dt,qt,Jt,ar){this.a11=it,this.a21=ct,this.a31=pt,this.a12=Ct,this.a22=It,this.a32=Dt,this.a13=qt,this.a23=Jt,this.a33=ar}static quadrilateralToQuadrilateral(it,ct,pt,Ct,It,Dt,qt,Jt,ar,Er,Pr,Gr,pn,An,Pn,Xn){const os=Mn.quadrilateralToSquare(it,ct,pt,Ct,It,Dt,qt,Jt);return Mn.squareToQuadrilateral(ar,Er,Pr,Gr,pn,An,Pn,Xn).times(os)}transformPoints(it){const ct=it.length,pt=this.a11,Ct=this.a12,It=this.a13,Dt=this.a21,qt=this.a22,Jt=this.a23,ar=this.a31,Er=this.a32,Pr=this.a33;for(let Gr=0;Gr<ct;Gr+=2){const pn=it[Gr],An=it[Gr+1],Pn=It*pn+Jt*An+Pr;it[Gr]=(pt*pn+Dt*An+ar)/Pn,it[Gr+1]=(Ct*pn+qt*An+Er)/Pn}}transformPointsWithValues(it,ct){const pt=this.a11,Ct=this.a12,It=this.a13,Dt=this.a21,qt=this.a22,Jt=this.a23,ar=this.a31,Er=this.a32,Pr=this.a33,Gr=it.length;for(let pn=0;pn<Gr;pn++){const An=it[pn],Pn=ct[pn],Xn=It*An+Jt*Pn+Pr;it[pn]=(pt*An+Dt*Pn+ar)/Xn,ct[pn]=(Ct*An+qt*Pn+Er)/Xn}}static squareToQuadrilateral(it,ct,pt,Ct,It,Dt,qt,Jt){const ar=it-pt+It-qt,Er=ct-Ct+Dt-Jt;if(ar===0&&Er===0)return new Mn(pt-it,It-pt,it,Ct-ct,Dt-Ct,ct,0,0,1);{const Pr=pt-It,Gr=qt-It,pn=Ct-Dt,An=Jt-Dt,Pn=Pr*An-Gr*pn,Xn=(ar*An-Gr*Er)/Pn,os=(Pr*Er-ar*pn)/Pn;return new Mn(pt-it+Xn*pt,qt-it+os*qt,it,Ct-ct+Xn*Ct,Jt-ct+os*Jt,ct,Xn,os,1)}}static quadrilateralToSquare(it,ct,pt,Ct,It,Dt,qt,Jt){return Mn.squareToQuadrilateral(it,ct,pt,Ct,It,Dt,qt,Jt).buildAdjoint()}buildAdjoint(){return new Mn(this.a22*this.a33-this.a23*this.a32,this.a23*this.a31-this.a21*this.a33,this.a21*this.a32-this.a22*this.a31,this.a13*this.a32-this.a12*this.a33,this.a11*this.a33-this.a13*this.a31,this.a12*this.a31-this.a11*this.a32,this.a12*this.a23-this.a13*this.a22,this.a13*this.a21-this.a11*this.a23,this.a11*this.a22-this.a12*this.a21)}times(it){return new Mn(this.a11*it.a11+this.a21*it.a12+this.a31*it.a13,this.a11*it.a21+this.a21*it.a22+this.a31*it.a23,this.a11*it.a31+this.a21*it.a32+this.a31*it.a33,this.a12*it.a11+this.a22*it.a12+this.a32*it.a13,this.a12*it.a21+this.a22*it.a22+this.a32*it.a23,this.a12*it.a31+this.a22*it.a32+this.a32*it.a33,this.a13*it.a11+this.a23*it.a12+this.a33*it.a13,this.a13*it.a21+this.a23*it.a22+this.a33*it.a23,this.a13*it.a31+this.a23*it.a32+this.a33*it.a33)}}class Cs extends ds{sampleGrid(it,ct,pt,Ct,It,Dt,qt,Jt,ar,Er,Pr,Gr,pn,An,Pn,Xn,os,Ks,Js){const Hs=Mn.quadrilateralToQuadrilateral(Ct,It,Dt,qt,Jt,ar,Er,Pr,Gr,pn,An,Pn,Xn,os,Ks,Js);return this.sampleGridWithTransform(it,ct,pt,Hs)}sampleGridWithTransform(it,ct,pt,Ct){if(ct<=0||pt<=0)throw new Fr;const It=new fn(ct,pt),Dt=new Float32Array(2*ct);for(let qt=0;qt<pt;qt++){const Jt=Dt.length,ar=qt+.5;for(let Er=0;Er<Jt;Er+=2)Dt[Er]=Er/2+.5,Dt[Er+1]=ar;Ct.transformPoints(Dt),ds.checkAndNudgePoints(it,Dt);try{for(let Er=0;Er<Jt;Er+=2)it.get(Math.floor(Dt[Er]),Math.floor(Dt[Er+1]))&&It.set(Er/2,qt)}catch{throw new Fr}}return It}}class Ds{static setGridSampler(it){Ds.gridSampler=it}static getInstance(){return Ds.gridSampler}}Ds.gridSampler=new Cs;class ao{constructor(it,ct){this.x=it,this.y=ct}toResultPoint(){return new Ss(this.getX(),this.getY())}getX(){return this.x}getY(){return this.y}}class Wo{constructor(it){this.EXPECTED_CORNER_BITS=new Int32Array([3808,476,2107,1799]),this.image=it}detect(){return this.detectMirror(!1)}detectMirror(it){let ct=this.getMatrixCenter(),pt=this.getBullsEyeCorners(ct);if(it){let Dt=pt[0];pt[0]=pt[2],pt[2]=Dt}this.extractParameters(pt);let Ct=this.sampleGrid(this.image,pt[this.shift%4],pt[(this.shift+1)%4],pt[(this.shift+2)%4],pt[(this.shift+3)%4]),It=this.getMatrixCornerPoints(pt);return new Tl(Ct,It,this.compact,this.nbDataBlocks,this.nbLayers)}extractParameters(it){if(!this.isValidPoint(it[0])||!this.isValidPoint(it[1])||!this.isValidPoint(it[2])||!this.isValidPoint(it[3]))throw new Fr;let ct=2*this.nbCenterLayers,pt=new Int32Array([this.sampleLine(it[0],it[1],ct),this.sampleLine(it[1],it[2],ct),this.sampleLine(it[2],it[3],ct),this.sampleLine(it[3],it[0],ct)]);this.shift=this.getRotation(pt,ct);let Ct=0;for(let Dt=0;Dt<4;Dt++){let qt=pt[(this.shift+Dt)%4];this.compact?(Ct<<=7,Ct+=qt>>1&127):(Ct<<=10,Ct+=(qt>>2&992)+(qt>>1&31))}let It=this.getCorrectedParameterData(Ct,this.compact);this.compact?(this.nbLayers=(It>>6)+1,this.nbDataBlocks=(It&63)+1):(this.nbLayers=(It>>11)+1,this.nbDataBlocks=(It&2047)+1)}getRotation(it,ct){let pt=0;it.forEach((Ct,It,Dt)=>{let qt=(Ct>>ct-2<<1)+(Ct&1);pt=(pt<<3)+qt}),pt=((pt&1)<<11)+(pt>>1);for(let Ct=0;Ct<4;Ct++)if(Nt.bitCount(pt^this.EXPECTED_CORNER_BITS[Ct])<=2)return Ct;throw new Fr}getCorrectedParameterData(it,ct){let pt,Ct;ct?(pt=7,Ct=2):(pt=10,Ct=4);let It=pt-Ct,Dt=new Int32Array(pt);for(let Jt=pt-1;Jt>=0;--Jt)Dt[Jt]=it&15,it>>=4;try{new po(ys.AZTEC_PARAM).decode(Dt,It)}catch{throw new Fr}let qt=0;for(let Jt=0;Jt<Ct;Jt++)qt=(qt<<4)+Dt[Jt];return qt}getBullsEyeCorners(it){let ct=it,pt=it,Ct=it,It=it,Dt=!0;for(this.nbCenterLayers=1;this.nbCenterLayers<9;this.nbCenterLayers++){let Pr=this.getFirstDifferent(ct,Dt,1,-1),Gr=this.getFirstDifferent(pt,Dt,1,1),pn=this.getFirstDifferent(Ct,Dt,-1,1),An=this.getFirstDifferent(It,Dt,-1,-1);if(this.nbCenterLayers>2){let Pn=this.distancePoint(An,Pr)*this.nbCenterLayers/(this.distancePoint(It,ct)*(this.nbCenterLayers+2));if(Pn<.75||Pn>1.25||!this.isWhiteOrBlackRectangle(Pr,Gr,pn,An))break}ct=Pr,pt=Gr,Ct=pn,It=An,Dt=!Dt}if(this.nbCenterLayers!==5&&this.nbCenterLayers!==7)throw new Fr;this.compact=this.nbCenterLayers===5;let qt=new Ss(ct.getX()+.5,ct.getY()-.5),Jt=new Ss(pt.getX()+.5,pt.getY()+.5),ar=new Ss(Ct.getX()-.5,Ct.getY()+.5),Er=new Ss(It.getX()-.5,It.getY()-.5);return this.expandSquare([qt,Jt,ar,Er],2*this.nbCenterLayers-3,2*this.nbCenterLayers)}getMatrixCenter(){let it,ct,pt,Ct;try{let qt=new ga(this.image).detect();it=qt[0],ct=qt[1],pt=qt[2],Ct=qt[3]}catch{let Jt=this.image.getWidth()/2,ar=this.image.getHeight()/2;it=this.getFirstDifferent(new ao(Jt+7,ar-7),!1,1,-1).toResultPoint(),ct=this.getFirstDifferent(new ao(Jt+7,ar+7),!1,1,1).toResultPoint(),pt=this.getFirstDifferent(new ao(Jt-7,ar+7),!1,-1,1).toResultPoint(),Ct=this.getFirstDifferent(new ao(Jt-7,ar-7),!1,-1,-1).toResultPoint()}let It=us.round((it.getX()+Ct.getX()+ct.getX()+pt.getX())/4),Dt=us.round((it.getY()+Ct.getY()+ct.getY()+pt.getY())/4);try{let qt=new ga(this.image,15,It,Dt).detect();it=qt[0],ct=qt[1],pt=qt[2],Ct=qt[3]}catch{it=this.getFirstDifferent(new ao(It+7,Dt-7),!1,1,-1).toResultPoint(),ct=this.getFirstDifferent(new ao(It+7,Dt+7),!1,1,1).toResultPoint(),pt=this.getFirstDifferent(new ao(It-7,Dt+7),!1,-1,1).toResultPoint(),Ct=this.getFirstDifferent(new ao(It-7,Dt-7),!1,-1,-1).toResultPoint()}return It=us.round((it.getX()+Ct.getX()+ct.getX()+pt.getX())/4),Dt=us.round((it.getY()+Ct.getY()+ct.getY()+pt.getY())/4),new ao(It,Dt)}getMatrixCornerPoints(it){return this.expandSquare(it,2*this.nbCenterLayers,this.getDimension())}sampleGrid(it,ct,pt,Ct,It){let Dt=Ds.getInstance(),qt=this.getDimension(),Jt=qt/2-this.nbCenterLayers,ar=qt/2+this.nbCenterLayers;return Dt.sampleGrid(it,qt,qt,Jt,Jt,ar,Jt,ar,ar,Jt,ar,ct.getX(),ct.getY(),pt.getX(),pt.getY(),Ct.getX(),Ct.getY(),It.getX(),It.getY())}sampleLine(it,ct,pt){let Ct=0,It=this.distanceResultPoint(it,ct),Dt=It/pt,qt=it.getX(),Jt=it.getY(),ar=Dt*(ct.getX()-it.getX())/It,Er=Dt*(ct.getY()-it.getY())/It;for(let Pr=0;Pr<pt;Pr++)this.image.get(us.round(qt+Pr*ar),us.round(Jt+Pr*Er))&&(Ct|=1<<pt-Pr-1);return Ct}isWhiteOrBlackRectangle(it,ct,pt,Ct){let It=3;it=new ao(it.getX()-It,it.getY()+It),ct=new ao(ct.getX()-It,ct.getY()-It),pt=new ao(pt.getX()+It,pt.getY()-It),Ct=new ao(Ct.getX()+It,Ct.getY()+It);let Dt=this.getColor(Ct,it);if(Dt===0)return!1;let qt=this.getColor(it,ct);return qt!==Dt||(qt=this.getColor(ct,pt),qt!==Dt)?!1:(qt=this.getColor(pt,Ct),qt===Dt)}getColor(it,ct){let pt=this.distancePoint(it,ct),Ct=(ct.getX()-it.getX())/pt,It=(ct.getY()-it.getY())/pt,Dt=0,qt=it.getX(),Jt=it.getY(),ar=this.image.get(it.getX(),it.getY()),Er=Math.ceil(pt);for(let Gr=0;Gr<Er;Gr++)qt+=Ct,Jt+=It,this.image.get(us.round(qt),us.round(Jt))!==ar&&Dt++;let Pr=Dt/pt;return Pr>.1&&Pr<.9?0:Pr<=.1===ar?1:-1}getFirstDifferent(it,ct,pt,Ct){let It=it.getX()+pt,Dt=it.getY()+Ct;for(;this.isValid(It,Dt)&&this.image.get(It,Dt)===ct;)It+=pt,Dt+=Ct;for(It-=pt,Dt-=Ct;this.isValid(It,Dt)&&this.image.get(It,Dt)===ct;)It+=pt;for(It-=pt;this.isValid(It,Dt)&&this.image.get(It,Dt)===ct;)Dt+=Ct;return Dt-=Ct,new ao(It,Dt)}expandSquare(it,ct,pt){let Ct=pt/(2*ct),It=it[0].getX()-it[2].getX(),Dt=it[0].getY()-it[2].getY(),qt=(it[0].getX()+it[2].getX())/2,Jt=(it[0].getY()+it[2].getY())/2,ar=new Ss(qt+Ct*It,Jt+Ct*Dt),Er=new Ss(qt-Ct*It,Jt-Ct*Dt);It=it[1].getX()-it[3].getX(),Dt=it[1].getY()-it[3].getY(),qt=(it[1].getX()+it[3].getX())/2,Jt=(it[1].getY()+it[3].getY())/2;let Pr=new Ss(qt+Ct*It,Jt+Ct*Dt),Gr=new Ss(qt-Ct*It,Jt-Ct*Dt);return[ar,Pr,Er,Gr]}isValid(it,ct){return it>=0&&it<this.image.getWidth()&&ct>0&&ct<this.image.getHeight()}isValidPoint(it){let ct=us.round(it.getX()),pt=us.round(it.getY());return this.isValid(ct,pt)}distancePoint(it,ct){return us.distance(it.getX(),it.getY(),ct.getX(),ct.getY())}distanceResultPoint(it,ct){return us.distance(it.getX(),it.getY(),ct.getX(),ct.getY())}getDimension(){return this.compact?4*this.nbLayers+11:this.nbLayers<=4?4*this.nbLayers+15:4*this.nbLayers+2*(Nt.truncDivision(this.nbLayers-4,8)+1)+15}}class Gl{decode(it,ct=null){let pt=null,Ct=new Wo(it.getBlackMatrix()),It=null,Dt=null;try{let Er=Ct.detectMirror(!1);It=Er.getPoints(),this.reportFoundResultPoints(ct,It),Dt=new tn().decode(Er)}catch(Er){pt=Er}if(Dt==null)try{let Er=Ct.detectMirror(!0);It=Er.getPoints(),this.reportFoundResultPoints(ct,It),Dt=new tn().decode(Er)}catch(Er){throw pt??Er}let qt=new Sn(Dt.getText(),Dt.getRawBytes(),Dt.getNumBits(),It,rs.AZTEC,Bt.currentTimeMillis()),Jt=Dt.getByteSegments();Jt!=null&&qt.putMetadata(On.BYTE_SEGMENTS,Jt);let ar=Dt.getECLevel();return ar!=null&&qt.putMetadata(On.ERROR_CORRECTION_LEVEL,ar),qt}reportFoundResultPoints(it,ct){if(it!=null){let pt=it.get(ir.NEED_RESULT_POINT_CALLBACK);pt!=null&&ct.forEach((Ct,It,Dt)=>{pt.foundPossibleResultPoint(Ct)})}}reset(){}}class fs extends gn{constructor(it=500){super(new Gl,it)}}class ps{decode(it,ct){try{return this.doDecode(it,ct)}catch{if(ct&&ct.get(ir.TRY_HARDER)===!0&&it.isRotateSupported()){const It=it.rotateCounterClockwise(),Dt=this.doDecode(It,ct),qt=Dt.getResultMetadata();let Jt=270;qt!==null&&qt.get(On.ORIENTATION)===!0&&(Jt=Jt+qt.get(On.ORIENTATION)%360),Dt.putMetadata(On.ORIENTATION,Jt);const ar=Dt.getResultPoints();if(ar!==null){const Er=It.getHeight();for(let Pr=0;Pr<ar.length;Pr++)ar[Pr]=new Ss(Er-ar[Pr].getY()-1,ar[Pr].getX())}return Dt}else throw new Fr}}reset(){}doDecode(it,ct){const pt=it.getWidth(),Ct=it.getHeight();let It=new Gt(pt);const Dt=ct&&ct.get(ir.TRY_HARDER)===!0,qt=Math.max(1,Ct>>(Dt?8:5));let Jt;Dt?Jt=Ct:Jt=15;const ar=Math.trunc(Ct/2);for(let Er=0;Er<Jt;Er++){const Pr=Math.trunc((Er+1)/2),Gr=(Er&1)===0,pn=ar+qt*(Gr?Pr:-Pr);if(pn<0||pn>=Ct)break;try{It=it.getBlackRow(pn,It)}catch{continue}for(let An=0;An<2;An++){if(An===1&&(It.reverse(),ct&&ct.get(ir.NEED_RESULT_POINT_CALLBACK)===!0)){const Pn=new Map;ct.forEach((Xn,os)=>Pn.set(os,Xn)),Pn.delete(ir.NEED_RESULT_POINT_CALLBACK),ct=Pn}try{const Pn=this.decodeRow(pn,It,ct);if(An===1){Pn.putMetadata(On.ORIENTATION,180);const Xn=Pn.getResultPoints();Xn!==null&&(Xn[0]=new Ss(pt-Xn[0].getX()-1,Xn[0].getY()),Xn[1]=new Ss(pt-Xn[1].getX()-1,Xn[1].getY()))}return Pn}catch{}}}throw new Fr}static recordPattern(it,ct,pt){const Ct=pt.length;for(let ar=0;ar<Ct;ar++)pt[ar]=0;const It=it.getSize();if(ct>=It)throw new Fr;let Dt=!it.get(ct),qt=0,Jt=ct;for(;Jt<It;){if(it.get(Jt)!==Dt)pt[qt]++;else{if(++qt===Ct)break;pt[qt]=1,Dt=!Dt}Jt++}if(!(qt===Ct||qt===Ct-1&&Jt===It))throw new Fr}static recordPatternInReverse(it,ct,pt){let Ct=pt.length,It=it.get(ct);for(;ct>0&&Ct>=0;)it.get(--ct)!==It&&(Ct--,It=!It);if(Ct>=0)throw new Fr;ps.recordPattern(it,ct+1,pt)}static patternMatchVariance(it,ct,pt){const Ct=it.length;let It=0,Dt=0;for(let ar=0;ar<Ct;ar++)It+=it[ar],Dt+=ct[ar];if(It<Dt)return Number.POSITIVE_INFINITY;const qt=It/Dt;pt*=qt;let Jt=0;for(let ar=0;ar<Ct;ar++){const Er=it[ar],Pr=ct[ar]*qt,Gr=Er>Pr?Er-Pr:Pr-Er;if(Gr>pt)return Number.POSITIVE_INFINITY;Jt+=Gr}return Jt/It}}class qn extends ps{static findStartPattern(it){const ct=it.getSize(),pt=it.getNextSet(0);let Ct=0,It=Int32Array.from([0,0,0,0,0,0]),Dt=pt,qt=!1;const Jt=6;for(let ar=pt;ar<ct;ar++)if(it.get(ar)!==qt)It[Ct]++;else{if(Ct===Jt-1){let Er=qn.MAX_AVG_VARIANCE,Pr=-1;for(let Gr=qn.CODE_START_A;Gr<=qn.CODE_START_C;Gr++){const pn=ps.patternMatchVariance(It,qn.CODE_PATTERNS[Gr],qn.MAX_INDIVIDUAL_VARIANCE);pn<Er&&(Er=pn,Pr=Gr)}if(Pr>=0&&it.isRange(Math.max(0,Dt-(ar-Dt)/2),Dt,!1))return Int32Array.from([Dt,ar,Pr]);Dt+=It[0]+It[1],It=It.slice(2,It.length-1),It[Ct-1]=0,It[Ct]=0,Ct--}else Ct++;It[Ct]=1,qt=!qt}throw new Fr}static decodeCode(it,ct,pt){ps.recordPattern(it,pt,ct);let Ct=qn.MAX_AVG_VARIANCE,It=-1;for(let Dt=0;Dt<qn.CODE_PATTERNS.length;Dt++){const qt=qn.CODE_PATTERNS[Dt],Jt=this.patternMatchVariance(ct,qt,qn.MAX_INDIVIDUAL_VARIANCE);Jt<Ct&&(Ct=Jt,It=Dt)}if(It>=0)return It;throw new Fr}decodeRow(it,ct,pt){const Ct=pt&&pt.get(ir.ASSUME_GS1)===!0,It=qn.findStartPattern(ct),Dt=It[2];let qt=0;const Jt=new Uint8Array(20);Jt[qt++]=Dt;let ar;switch(Dt){case qn.CODE_START_A:ar=qn.CODE_CODE_A;break;case qn.CODE_START_B:ar=qn.CODE_CODE_B;break;case qn.CODE_START_C:ar=qn.CODE_CODE_C;break;default:throw new or}let Er=!1,Pr=!1,Gr="",pn=It[0],An=It[1];const Pn=Int32Array.from([0,0,0,0,0,0]);let Xn=0,os=0,Ks=Dt,Js=0,Hs=!0,lu=!1,zl=!1;for(;!Er;){const E0=Pr;switch(Pr=!1,Xn=os,os=qn.decodeCode(ct,Pn,An),Jt[qt++]=os,os!==qn.CODE_STOP&&(Hs=!0),os!==qn.CODE_STOP&&(Js++,Ks+=Js*os),pn=An,An+=Pn.reduce((Zp,ty)=>Zp+ty,0),os){case qn.CODE_START_A:case qn.CODE_START_B:case qn.CODE_START_C:throw new or}switch(ar){case qn.CODE_CODE_A:if(os<64)zl===lu?Gr+=String.fromCharCode(32+os):Gr+=String.fromCharCode(32+os+128),zl=!1;else if(os<96)zl===lu?Gr+=String.fromCharCode(os-64):Gr+=String.fromCharCode(os+64),zl=!1;else switch(os!==qn.CODE_STOP&&(Hs=!1),os){case qn.CODE_FNC_1:Ct&&(Gr.length===0?Gr+="]C1":Gr+="");break;case qn.CODE_FNC_2:case qn.CODE_FNC_3:break;case qn.CODE_FNC_4_A:!lu&&zl?(lu=!0,zl=!1):lu&&zl?(lu=!1,zl=!1):zl=!0;break;case qn.CODE_SHIFT:Pr=!0,ar=qn.CODE_CODE_B;break;case qn.CODE_CODE_B:ar=qn.CODE_CODE_B;break;case qn.CODE_CODE_C:ar=qn.CODE_CODE_C;break;case qn.CODE_STOP:Er=!0;break}break;case qn.CODE_CODE_B:if(os<96)zl===lu?Gr+=String.fromCharCode(32+os):Gr+=String.fromCharCode(32+os+128),zl=!1;else switch(os!==qn.CODE_STOP&&(Hs=!1),os){case qn.CODE_FNC_1:Ct&&(Gr.length===0?Gr+="]C1":Gr+="");break;case qn.CODE_FNC_2:case qn.CODE_FNC_3:break;case qn.CODE_FNC_4_B:!lu&&zl?(lu=!0,zl=!1):lu&&zl?(lu=!1,zl=!1):zl=!0;break;case qn.CODE_SHIFT:Pr=!0,ar=qn.CODE_CODE_A;break;case qn.CODE_CODE_A:ar=qn.CODE_CODE_A;break;case qn.CODE_CODE_C:ar=qn.CODE_CODE_C;break;case qn.CODE_STOP:Er=!0;break}break;case qn.CODE_CODE_C:if(os<100)os<10&&(Gr+="0"),Gr+=os;else switch(os!==qn.CODE_STOP&&(Hs=!1),os){case qn.CODE_FNC_1:Ct&&(Gr.length===0?Gr+="]C1":Gr+="");break;case qn.CODE_CODE_A:ar=qn.CODE_CODE_A;break;case qn.CODE_CODE_B:ar=qn.CODE_CODE_B;break;case qn.CODE_STOP:Er=!0;break}break}E0&&(ar=ar===qn.CODE_CODE_A?qn.CODE_CODE_B:qn.CODE_CODE_A)}const kp=An-pn;if(An=ct.getNextUnset(An),!ct.isRange(An,Math.min(ct.getSize(),An+(An-pn)/2),!1))throw new Fr;if(Ks-=Js*Xn,Ks%103!==Xn)throw new Pt;const Up=Gr.length;if(Up===0)throw new Fr;Up>0&&Hs&&(ar===qn.CODE_CODE_C?Gr=Gr.substring(0,Up-2):Gr=Gr.substring(0,Up-1));const ap=(It[1]+It[0])/2,Ou=pn+kp/2,mp=Jt.length,Cp=new Uint8Array(mp);for(let E0=0;E0<mp;E0++)Cp[E0]=Jt[E0];const Gp=[new Ss(ap,it),new Ss(Ou,it)];return new Sn(Gr,Cp,0,Gp,rs.CODE_128,new Date().getTime())}}qn.CODE_PATTERNS=[Int32Array.from([2,1,2,2,2,2]),Int32Array.from([2,2,2,1,2,2]),Int32Array.from([2,2,2,2,2,1]),Int32Array.from([1,2,1,2,2,3]),Int32Array.from([1,2,1,3,2,2]),Int32Array.from([1,3,1,2,2,2]),Int32Array.from([1,2,2,2,1,3]),Int32Array.from([1,2,2,3,1,2]),Int32Array.from([1,3,2,2,1,2]),Int32Array.from([2,2,1,2,1,3]),Int32Array.from([2,2,1,3,1,2]),Int32Array.from([2,3,1,2,1,2]),Int32Array.from([1,1,2,2,3,2]),Int32Array.from([1,2,2,1,3,2]),Int32Array.from([1,2,2,2,3,1]),Int32Array.from([1,1,3,2,2,2]),Int32Array.from([1,2,3,1,2,2]),Int32Array.from([1,2,3,2,2,1]),Int32Array.from([2,2,3,2,1,1]),Int32Array.from([2,2,1,1,3,2]),Int32Array.from([2,2,1,2,3,1]),Int32Array.from([2,1,3,2,1,2]),Int32Array.from([2,2,3,1,1,2]),Int32Array.from([3,1,2,1,3,1]),Int32Array.from([3,1,1,2,2,2]),Int32Array.from([3,2,1,1,2,2]),Int32Array.from([3,2,1,2,2,1]),Int32Array.from([3,1,2,2,1,2]),Int32Array.from([3,2,2,1,1,2]),Int32Array.from([3,2,2,2,1,1]),Int32Array.from([2,1,2,1,2,3]),Int32Array.from([2,1,2,3,2,1]),Int32Array.from([2,3,2,1,2,1]),Int32Array.from([1,1,1,3,2,3]),Int32Array.from([1,3,1,1,2,3]),Int32Array.from([1,3,1,3,2,1]),Int32Array.from([1,1,2,3,1,3]),Int32Array.from([1,3,2,1,1,3]),Int32Array.from([1,3,2,3,1,1]),Int32Array.from([2,1,1,3,1,3]),Int32Array.from([2,3,1,1,1,3]),Int32Array.from([2,3,1,3,1,1]),Int32Array.from([1,1,2,1,3,3]),Int32Array.from([1,1,2,3,3,1]),Int32Array.from([1,3,2,1,3,1]),Int32Array.from([1,1,3,1,2,3]),Int32Array.from([1,1,3,3,2,1]),Int32Array.from([1,3,3,1,2,1]),Int32Array.from([3,1,3,1,2,1]),Int32Array.from([2,1,1,3,3,1]),Int32Array.from([2,3,1,1,3,1]),Int32Array.from([2,1,3,1,1,3]),Int32Array.from([2,1,3,3,1,1]),Int32Array.from([2,1,3,1,3,1]),Int32Array.from([3,1,1,1,2,3]),Int32Array.from([3,1,1,3,2,1]),Int32Array.from([3,3,1,1,2,1]),Int32Array.from([3,1,2,1,1,3]),Int32Array.from([3,1,2,3,1,1]),Int32Array.from([3,3,2,1,1,1]),Int32Array.from([3,1,4,1,1,1]),Int32Array.from([2,2,1,4,1,1]),Int32Array.from([4,3,1,1,1,1]),Int32Array.from([1,1,1,2,2,4]),Int32Array.from([1,1,1,4,2,2]),Int32Array.from([1,2,1,1,2,4]),Int32Array.from([1,2,1,4,2,1]),Int32Array.from([1,4,1,1,2,2]),Int32Array.from([1,4,1,2,2,1]),Int32Array.from([1,1,2,2,1,4]),Int32Array.from([1,1,2,4,1,2]),Int32Array.from([1,2,2,1,1,4]),Int32Array.from([1,2,2,4,1,1]),Int32Array.from([1,4,2,1,1,2]),Int32Array.from([1,4,2,2,1,1]),Int32Array.from([2,4,1,2,1,1]),Int32Array.from([2,2,1,1,1,4]),Int32Array.from([4,1,3,1,1,1]),Int32Array.from([2,4,1,1,1,2]),Int32Array.from([1,3,4,1,1,1]),Int32Array.from([1,1,1,2,4,2]),Int32Array.from([1,2,1,1,4,2]),Int32Array.from([1,2,1,2,4,1]),Int32Array.from([1,1,4,2,1,2]),Int32Array.from([1,2,4,1,1,2]),Int32Array.from([1,2,4,2,1,1]),Int32Array.from([4,1,1,2,1,2]),Int32Array.from([4,2,1,1,1,2]),Int32Array.from([4,2,1,2,1,1]),Int32Array.from([2,1,2,1,4,1]),Int32Array.from([2,1,4,1,2,1]),Int32Array.from([4,1,2,1,2,1]),Int32Array.from([1,1,1,1,4,3]),Int32Array.from([1,1,1,3,4,1]),Int32Array.from([1,3,1,1,4,1]),Int32Array.from([1,1,4,1,1,3]),Int32Array.from([1,1,4,3,1,1]),Int32Array.from([4,1,1,1,1,3]),Int32Array.from([4,1,1,3,1,1]),Int32Array.from([1,1,3,1,4,1]),Int32Array.from([1,1,4,1,3,1]),Int32Array.from([3,1,1,1,4,1]),Int32Array.from([4,1,1,1,3,1]),Int32Array.from([2,1,1,4,1,2]),Int32Array.from([2,1,1,2,1,4]),Int32Array.from([2,1,1,2,3,2]),Int32Array.from([2,3,3,1,1,1,2])],qn.MAX_AVG_VARIANCE=.25,qn.MAX_INDIVIDUAL_VARIANCE=.7,qn.CODE_SHIFT=98,qn.CODE_CODE_C=99,qn.CODE_CODE_B=100,qn.CODE_CODE_A=101,qn.CODE_FNC_1=102,qn.CODE_FNC_2=97,qn.CODE_FNC_3=96,qn.CODE_FNC_4_A=101,qn.CODE_FNC_4_B=100,qn.CODE_START_A=103,qn.CODE_START_B=104,qn.CODE_START_C=105,qn.CODE_STOP=106;class qs extends ps{constructor(it=!1,ct=!1){super(),this.usingCheckDigit=it,this.extendedMode=ct,this.decodeRowResult="",this.counters=new Int32Array(9)}decodeRow(it,ct,pt){let Ct=this.counters;Ct.fill(0),this.decodeRowResult="";let It=qs.findAsteriskPattern(ct,Ct),Dt=ct.getNextSet(It[1]),qt=ct.getSize(),Jt,ar;do{qs.recordPattern(ct,Dt,Ct);let Pn=qs.toNarrowWidePattern(Ct);if(Pn<0)throw new Fr;Jt=qs.patternToChar(Pn),this.decodeRowResult+=Jt,ar=Dt;for(let Xn of Ct)Dt+=Xn;Dt=ct.getNextSet(Dt)}while(Jt!=="*");this.decodeRowResult=this.decodeRowResult.substring(0,this.decodeRowResult.length-1);let Er=0;for(let Pn of Ct)Er+=Pn;let Pr=Dt-ar-Er;if(Dt!==qt&&Pr*2<Er)throw new Fr;if(this.usingCheckDigit){let Pn=this.decodeRowResult.length-1,Xn=0;for(let os=0;os<Pn;os++)Xn+=qs.ALPHABET_STRING.indexOf(this.decodeRowResult.charAt(os));if(this.decodeRowResult.charAt(Pn)!==qs.ALPHABET_STRING.charAt(Xn%43))throw new Pt;this.decodeRowResult=this.decodeRowResult.substring(0,Pn)}if(this.decodeRowResult.length===0)throw new Fr;let Gr;this.extendedMode?Gr=qs.decodeExtended(this.decodeRowResult):Gr=this.decodeRowResult;let pn=(It[1]+It[0])/2,An=ar+Er/2;return new Sn(Gr,null,0,[new Ss(pn,it),new Ss(An,it)],rs.CODE_39,new Date().getTime())}static findAsteriskPattern(it,ct){let pt=it.getSize(),Ct=it.getNextSet(0),It=0,Dt=Ct,qt=!1,Jt=ct.length;for(let ar=Ct;ar<pt;ar++)if(it.get(ar)!==qt)ct[It]++;else{if(It===Jt-1){if(this.toNarrowWidePattern(ct)===qs.ASTERISK_ENCODING&&it.isRange(Math.max(0,Dt-Math.floor((ar-Dt)/2)),Dt,!1))return[Dt,ar];Dt+=ct[0]+ct[1],ct.copyWithin(0,2,2+It-1),ct[It-1]=0,ct[It]=0,It--}else It++;ct[It]=1,qt=!qt}throw new Fr}static toNarrowWidePattern(it){let ct=it.length,pt=0,Ct;do{let It=2147483647;for(let Jt of it)Jt<It&&Jt>pt&&(It=Jt);pt=It,Ct=0;let Dt=0,qt=0;for(let Jt=0;Jt<ct;Jt++){let ar=it[Jt];ar>pt&&(qt|=1<<ct-1-Jt,Ct++,Dt+=ar)}if(Ct===3){for(let Jt=0;Jt<ct&&Ct>0;Jt++){let ar=it[Jt];if(ar>pt&&(Ct--,ar*2>=Dt))return-1}return qt}}while(Ct>3);return-1}static patternToChar(it){for(let ct=0;ct<qs.CHARACTER_ENCODINGS.length;ct++)if(qs.CHARACTER_ENCODINGS[ct]===it)return qs.ALPHABET_STRING.charAt(ct);if(it===qs.ASTERISK_ENCODING)return"*";throw new Fr}static decodeExtended(it){let ct=it.length,pt="";for(let Ct=0;Ct<ct;Ct++){let It=it.charAt(Ct);if(It==="+"||It==="$"||It==="%"||It==="/"){let Dt=it.charAt(Ct+1),qt="\0";switch(It){case"+":if(Dt>="A"&&Dt<="Z")qt=String.fromCharCode(Dt.charCodeAt(0)+32);else throw new or;break;case"$":if(Dt>="A"&&Dt<="Z")qt=String.fromCharCode(Dt.charCodeAt(0)-64);else throw new or;break;case"%":if(Dt>="A"&&Dt<="E")qt=String.fromCharCode(Dt.charCodeAt(0)-38);else if(Dt>="F"&&Dt<="J")qt=String.fromCharCode(Dt.charCodeAt(0)-11);else if(Dt>="K"&&Dt<="O")qt=String.fromCharCode(Dt.charCodeAt(0)+16);else if(Dt>="P"&&Dt<="T")qt=String.fromCharCode(Dt.charCodeAt(0)+43);else if(Dt==="U")qt="\0";else if(Dt==="V")qt="@";else if(Dt==="W")qt="`";else if(Dt==="X"||Dt==="Y"||Dt==="Z")qt="";else throw new or;break;case"/":if(Dt>="A"&&Dt<="O")qt=String.fromCharCode(Dt.charCodeAt(0)-32);else if(Dt==="Z")qt=":";else throw new or;break}pt+=qt,Ct++}else pt+=It}return pt}}qs.ALPHABET_STRING="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ-. $/+%",qs.CHARACTER_ENCODINGS=[52,289,97,352,49,304,112,37,292,100,265,73,328,25,280,88,13,268,76,28,259,67,322,19,274,82,7,262,70,22,385,193,448,145,400,208,133,388,196,168,162,138,42],qs.ASTERISK_ENCODING=148;class Gs extends ps{constructor(){super(...arguments),this.narrowLineWidth=-1}decodeRow(it,ct,pt){let Ct=this.decodeStart(ct),It=this.decodeEnd(ct),Dt=new Jr;Gs.decodeMiddle(ct,Ct[1],It[0],Dt);let qt=Dt.toString(),Jt=null;pt!=null&&(Jt=pt.get(ir.ALLOWED_LENGTHS)),Jt==null&&(Jt=Gs.DEFAULT_ALLOWED_LENGTHS);let ar=qt.length,Er=!1,Pr=0;for(let An of Jt){if(ar===An){Er=!0;break}An>Pr&&(Pr=An)}if(!Er&&ar>Pr&&(Er=!0),!Er)throw new or;const Gr=[new Ss(Ct[1],it),new Ss(It[0],it)];return new Sn(qt,null,0,Gr,rs.ITF,new Date().getTime())}static decodeMiddle(it,ct,pt,Ct){let It=new Int32Array(10),Dt=new Int32Array(5),qt=new Int32Array(5);for(It.fill(0),Dt.fill(0),qt.fill(0);ct<pt;){ps.recordPattern(it,ct,It);for(let ar=0;ar<5;ar++){let Er=2*ar;Dt[ar]=It[Er],qt[ar]=It[Er+1]}let Jt=Gs.decodeDigit(Dt);Ct.append(Jt.toString()),Jt=this.decodeDigit(qt),Ct.append(Jt.toString()),It.forEach(function(ar){ct+=ar})}}decodeStart(it){let ct=Gs.skipWhiteSpace(it),pt=Gs.findGuardPattern(it,ct,Gs.START_PATTERN);return this.narrowLineWidth=(pt[1]-pt[0])/4,this.validateQuietZone(it,pt[0]),pt}validateQuietZone(it,ct){let pt=this.narrowLineWidth*10;pt=pt<ct?pt:ct;for(let Ct=ct-1;pt>0&&Ct>=0&&!it.get(Ct);Ct--)pt--;if(pt!==0)throw new Fr}static skipWhiteSpace(it){const ct=it.getSize(),pt=it.getNextSet(0);if(pt===ct)throw new Fr;return pt}decodeEnd(it){it.reverse();try{let ct=Gs.skipWhiteSpace(it),pt;try{pt=Gs.findGuardPattern(it,ct,Gs.END_PATTERN_REVERSED[0])}catch(It){It instanceof Fr&&(pt=Gs.findGuardPattern(it,ct,Gs.END_PATTERN_REVERSED[1]))}this.validateQuietZone(it,pt[0]);let Ct=pt[0];return pt[0]=it.getSize()-pt[1],pt[1]=it.getSize()-Ct,pt}finally{it.reverse()}}static findGuardPattern(it,ct,pt){let Ct=pt.length,It=new Int32Array(Ct),Dt=it.getSize(),qt=!1,Jt=0,ar=ct;It.fill(0);for(let Er=ct;Er<Dt;Er++)if(it.get(Er)!==qt)It[Jt]++;else{if(Jt===Ct-1){if(ps.patternMatchVariance(It,pt,Gs.MAX_INDIVIDUAL_VARIANCE)<Gs.MAX_AVG_VARIANCE)return[ar,Er];ar+=It[0]+It[1],Bt.arraycopy(It,2,It,0,Jt-1),It[Jt-1]=0,It[Jt]=0,Jt--}else Jt++;It[Jt]=1,qt=!qt}throw new Fr}static decodeDigit(it){let ct=Gs.MAX_AVG_VARIANCE,pt=-1,Ct=Gs.PATTERNS.length;for(let It=0;It<Ct;It++){let Dt=Gs.PATTERNS[It],qt=ps.patternMatchVariance(it,Dt,Gs.MAX_INDIVIDUAL_VARIANCE);qt<ct?(ct=qt,pt=It):qt===ct&&(pt=-1)}if(pt>=0)return pt%10;throw new Fr}}Gs.PATTERNS=[Int32Array.from([1,1,2,2,1]),Int32Array.from([2,1,1,1,2]),Int32Array.from([1,2,1,1,2]),Int32Array.from([2,2,1,1,1]),Int32Array.from([1,1,2,1,2]),Int32Array.from([2,1,2,1,1]),Int32Array.from([1,2,2,1,1]),Int32Array.from([1,1,1,2,2]),Int32Array.from([2,1,1,2,1]),Int32Array.from([1,2,1,2,1]),Int32Array.from([1,1,3,3,1]),Int32Array.from([3,1,1,1,3]),Int32Array.from([1,3,1,1,3]),Int32Array.from([3,3,1,1,1]),Int32Array.from([1,1,3,1,3]),Int32Array.from([3,1,3,1,1]),Int32Array.from([1,3,3,1,1]),Int32Array.from([1,1,1,3,3]),Int32Array.from([3,1,1,3,1]),Int32Array.from([1,3,1,3,1])],Gs.MAX_AVG_VARIANCE=.38,Gs.MAX_INDIVIDUAL_VARIANCE=.5,Gs.DEFAULT_ALLOWED_LENGTHS=[6,8,10,12,14],Gs.START_PATTERN=Int32Array.from([1,1,1,1]),Gs.END_PATTERN_REVERSED=[Int32Array.from([1,1,2]),Int32Array.from([1,1,3])];class Eo extends ps{constructor(){super(...arguments),this.decodeRowStringBuffer=""}static findStartGuardPattern(it){let ct=!1,pt,Ct=0,It=Int32Array.from([0,0,0]);for(;!ct;){It=Int32Array.from([0,0,0]),pt=Eo.findGuardPattern(it,Ct,!1,this.START_END_PATTERN,It);let Dt=pt[0];Ct=pt[1];let qt=Dt-(Ct-Dt);qt>=0&&(ct=it.isRange(qt,Dt,!1))}return pt}static checkChecksum(it){return Eo.checkStandardUPCEANChecksum(it)}static checkStandardUPCEANChecksum(it){let ct=it.length;if(ct===0)return!1;let pt=parseInt(it.charAt(ct-1),10);return Eo.getStandardUPCEANChecksum(it.substring(0,ct-1))===pt}static getStandardUPCEANChecksum(it){let ct=it.length,pt=0;for(let Ct=ct-1;Ct>=0;Ct-=2){let It=it.charAt(Ct).charCodeAt(0)-48;if(It<0||It>9)throw new or;pt+=It}pt*=3;for(let Ct=ct-2;Ct>=0;Ct-=2){let It=it.charAt(Ct).charCodeAt(0)-48;if(It<0||It>9)throw new or;pt+=It}return(1e3-pt)%10}static decodeEnd(it,ct){return Eo.findGuardPattern(it,ct,!1,Eo.START_END_PATTERN,new Int32Array(Eo.START_END_PATTERN.length).fill(0))}static findGuardPatternWithoutCounters(it,ct,pt,Ct){return this.findGuardPattern(it,ct,pt,Ct,new Int32Array(Ct.length))}static findGuardPattern(it,ct,pt,Ct,It){let Dt=it.getSize();ct=pt?it.getNextUnset(ct):it.getNextSet(ct);let qt=0,Jt=ct,ar=Ct.length,Er=pt;for(let Pr=ct;Pr<Dt;Pr++)if(it.get(Pr)!==Er)It[qt]++;else{if(qt===ar-1){if(ps.patternMatchVariance(It,Ct,Eo.MAX_INDIVIDUAL_VARIANCE)<Eo.MAX_AVG_VARIANCE)return Int32Array.from([Jt,Pr]);Jt+=It[0]+It[1];let Gr=It.slice(2,It.length-1);for(let pn=0;pn<qt-1;pn++)It[pn]=Gr[pn];It[qt-1]=0,It[qt]=0,qt--}else qt++;It[qt]=1,Er=!Er}throw new Fr}static decodeDigit(it,ct,pt,Ct){this.recordPattern(it,pt,ct);let It=this.MAX_AVG_VARIANCE,Dt=-1,qt=Ct.length;for(let Jt=0;Jt<qt;Jt++){let ar=Ct[Jt],Er=ps.patternMatchVariance(ct,ar,Eo.MAX_INDIVIDUAL_VARIANCE);Er<It&&(It=Er,Dt=Jt)}if(Dt>=0)return Dt;throw new Fr}}Eo.MAX_AVG_VARIANCE=.48,Eo.MAX_INDIVIDUAL_VARIANCE=.7,Eo.START_END_PATTERN=Int32Array.from([1,1,1]),Eo.MIDDLE_PATTERN=Int32Array.from([1,1,1,1,1]),Eo.END_PATTERN=Int32Array.from([1,1,1,1,1,1]),Eo.L_PATTERNS=[Int32Array.from([3,2,1,1]),Int32Array.from([2,2,2,1]),Int32Array.from([2,1,2,2]),Int32Array.from([1,4,1,1]),Int32Array.from([1,1,3,2]),Int32Array.from([1,2,3,1]),Int32Array.from([1,1,1,4]),Int32Array.from([1,3,1,2]),Int32Array.from([1,2,1,3]),Int32Array.from([3,1,1,2])];class Kl{constructor(){this.CHECK_DIGIT_ENCODINGS=[24,20,18,17,12,6,3,10,9,5],this.decodeMiddleCounters=Int32Array.from([0,0,0,0]),this.decodeRowStringBuffer=""}decodeRow(it,ct,pt){let Ct=this.decodeRowStringBuffer,It=this.decodeMiddle(ct,pt,Ct),Dt=Ct.toString(),qt=Kl.parseExtensionString(Dt),Jt=[new Ss((pt[0]+pt[1])/2,it),new Ss(It,it)],ar=new Sn(Dt,null,0,Jt,rs.UPC_EAN_EXTENSION,new Date().getTime());return qt!=null&&ar.putAllMetadata(qt),ar}decodeMiddle(it,ct,pt){let Ct=this.decodeMiddleCounters;Ct[0]=0,Ct[1]=0,Ct[2]=0,Ct[3]=0;let It=it.getSize(),Dt=ct[1],qt=0;for(let ar=0;ar<5&&Dt<It;ar++){let Er=Eo.decodeDigit(it,Ct,Dt,Eo.L_AND_G_PATTERNS);pt+=String.fromCharCode(48+Er%10);for(let Pr of Ct)Dt+=Pr;Er>=10&&(qt|=1<<4-ar),ar!==4&&(Dt=it.getNextSet(Dt),Dt=it.getNextUnset(Dt))}if(pt.length!==5)throw new Fr;let Jt=this.determineCheckDigit(qt);if(Kl.extensionChecksum(pt.toString())!==Jt)throw new Fr;return Dt}static extensionChecksum(it){let ct=it.length,pt=0;for(let Ct=ct-2;Ct>=0;Ct-=2)pt+=it.charAt(Ct).charCodeAt(0)-48;pt*=3;for(let Ct=ct-1;Ct>=0;Ct-=2)pt+=it.charAt(Ct).charCodeAt(0)-48;return pt*=3,pt%10}determineCheckDigit(it){for(let ct=0;ct<10;ct++)if(it===this.CHECK_DIGIT_ENCODINGS[ct])return ct;throw new Fr}static parseExtensionString(it){if(it.length!==5)return null;let ct=Kl.parseExtension5String(it);return ct==null?null:new Map([[On.SUGGESTED_PRICE,ct]])}static parseExtension5String(it){let ct;switch(it.charAt(0)){case"0":ct="";break;case"5":ct="$";break;case"9":switch(it){case"90000":return null;case"99991":return"0.00";case"99990":return"Used"}ct="";break;default:ct="";break}let pt=parseInt(it.substring(1)),Ct=(pt/100).toString(),It=pt%100,Dt=It<10?"0"+It:It.toString();return ct+Ct+"."+Dt}}class tu{constructor(){this.decodeMiddleCounters=Int32Array.from([0,0,0,0]),this.decodeRowStringBuffer=""}decodeRow(it,ct,pt){let Ct=this.decodeRowStringBuffer,It=this.decodeMiddle(ct,pt,Ct),Dt=Ct.toString(),qt=tu.parseExtensionString(Dt),Jt=[new Ss((pt[0]+pt[1])/2,it),new Ss(It,it)],ar=new Sn(Dt,null,0,Jt,rs.UPC_EAN_EXTENSION,new Date().getTime());return qt!=null&&ar.putAllMetadata(qt),ar}decodeMiddle(it,ct,pt){let Ct=this.decodeMiddleCounters;Ct[0]=0,Ct[1]=0,Ct[2]=0,Ct[3]=0;let It=it.getSize(),Dt=ct[1],qt=0;for(let Jt=0;Jt<2&&Dt<It;Jt++){let ar=Eo.decodeDigit(it,Ct,Dt,Eo.L_AND_G_PATTERNS);pt+=String.fromCharCode(48+ar%10);for(let Er of Ct)Dt+=Er;ar>=10&&(qt|=1<<1-Jt),Jt!==1&&(Dt=it.getNextSet(Dt),Dt=it.getNextUnset(Dt))}if(pt.length!==2)throw new Fr;if(parseInt(pt.toString())%4!==qt)throw new Fr;return Dt}static parseExtensionString(it){return it.length!==2?null:new Map([[On.ISSUE_NUMBER,parseInt(it)]])}}class Wl{static decodeRow(it,ct,pt){let Ct=Eo.findGuardPattern(ct,pt,!1,this.EXTENSION_START_PATTERN,new Int32Array(this.EXTENSION_START_PATTERN.length).fill(0));try{return new Kl().decodeRow(it,ct,Ct)}catch{return new tu().decodeRow(it,ct,Ct)}}}Wl.EXTENSION_START_PATTERN=Int32Array.from([1,1,2]);class Zo extends Eo{constructor(){super(),this.decodeRowStringBuffer="",Zo.L_AND_G_PATTERNS=Zo.L_PATTERNS.map(it=>Int32Array.from(it));for(let it=10;it<20;it++){let ct=Zo.L_PATTERNS[it-10],pt=new Int32Array(ct.length);for(let Ct=0;Ct<ct.length;Ct++)pt[Ct]=ct[ct.length-Ct-1];Zo.L_AND_G_PATTERNS[it]=pt}}decodeRow(it,ct,pt){let Ct=Zo.findStartGuardPattern(ct),It=pt==null?null:pt.get(ir.NEED_RESULT_POINT_CALLBACK);if(It!=null){const Hs=new Ss((Ct[0]+Ct[1])/2,it);It.foundPossibleResultPoint(Hs)}let Dt=this.decodeMiddle(ct,Ct,this.decodeRowStringBuffer),qt=Dt.rowOffset,Jt=Dt.resultString;if(It!=null){const Hs=new Ss(qt,it);It.foundPossibleResultPoint(Hs)}let ar=this.decodeEnd(ct,qt);if(It!=null){const Hs=new Ss((ar[0]+ar[1])/2,it);It.foundPossibleResultPoint(Hs)}let Er=ar[1],Pr=Er+(Er-ar[0]);if(Pr>=ct.getSize()||!ct.isRange(Er,Pr,!1))throw new Fr;let Gr=Jt.toString();if(Gr.length<8)throw new or;if(!Zo.checkChecksum(Gr))throw new Pt;let pn=(Ct[1]+Ct[0])/2,An=(ar[1]+ar[0])/2,Pn=this.getBarcodeFormat(),Xn=[new Ss(pn,it),new Ss(An,it)],os=new Sn(Gr,null,0,Xn,Pn,new Date().getTime()),Ks=0;try{let Hs=Wl.decodeRow(it,ct,ar[1]);os.putMetadata(On.UPC_EAN_EXTENSION,Hs.getText()),os.putAllMetadata(Hs.getResultMetadata()),os.addResultPoints(Hs.getResultPoints()),Ks=Hs.getText().length}catch{}let Js=pt==null?null:pt.get(ir.ALLOWED_EAN_EXTENSIONS);if(Js!=null){let Hs=!1;for(let lu in Js)if(Ks.toString()===lu){Hs=!0;break}if(!Hs)throw new Fr}return os}decodeEnd(it,ct){return Zo.findGuardPattern(it,ct,!1,Zo.START_END_PATTERN,new Int32Array(Zo.START_END_PATTERN.length).fill(0))}static checkChecksum(it){return Zo.checkStandardUPCEANChecksum(it)}static checkStandardUPCEANChecksum(it){let ct=it.length;if(ct===0)return!1;let pt=parseInt(it.charAt(ct-1),10);return Zo.getStandardUPCEANChecksum(it.substring(0,ct-1))===pt}static getStandardUPCEANChecksum(it){let ct=it.length,pt=0;for(let Ct=ct-1;Ct>=0;Ct-=2){let It=it.charAt(Ct).charCodeAt(0)-48;if(It<0||It>9)throw new or;pt+=It}pt*=3;for(let Ct=ct-2;Ct>=0;Ct-=2){let It=it.charAt(Ct).charCodeAt(0)-48;if(It<0||It>9)throw new or;pt+=It}return(1e3-pt)%10}}class ru extends Zo{constructor(){super(),this.decodeMiddleCounters=Int32Array.from([0,0,0,0])}decodeMiddle(it,ct,pt){let Ct=this.decodeMiddleCounters;Ct[0]=0,Ct[1]=0,Ct[2]=0,Ct[3]=0;let It=it.getSize(),Dt=ct[1],qt=0;for(let ar=0;ar<6&&Dt<It;ar++){let Er=Zo.decodeDigit(it,Ct,Dt,Zo.L_AND_G_PATTERNS);pt+=String.fromCharCode(48+Er%10);for(let Pr of Ct)Dt+=Pr;Er>=10&&(qt|=1<<5-ar)}pt=ru.determineFirstDigit(pt,qt),Dt=Zo.findGuardPattern(it,Dt,!0,Zo.MIDDLE_PATTERN,new Int32Array(Zo.MIDDLE_PATTERN.length).fill(0))[1];for(let ar=0;ar<6&&Dt<It;ar++){let Er=Zo.decodeDigit(it,Ct,Dt,Zo.L_PATTERNS);pt+=String.fromCharCode(48+Er);for(let Pr of Ct)Dt+=Pr}return{rowOffset:Dt,resultString:pt}}getBarcodeFormat(){return rs.EAN_13}static determineFirstDigit(it,ct){for(let pt=0;pt<10;pt++)if(ct===this.FIRST_DIGIT_ENCODINGS[pt])return it=String.fromCharCode(48+pt)+it,it;throw new Fr}}ru.FIRST_DIGIT_ENCODINGS=[0,11,13,14,19,25,28,21,22,26];class Oo extends Zo{constructor(){super(),this.decodeMiddleCounters=Int32Array.from([0,0,0,0])}decodeMiddle(it,ct,pt){const Ct=this.decodeMiddleCounters;Ct[0]=0,Ct[1]=0,Ct[2]=0,Ct[3]=0;let It=it.getSize(),Dt=ct[1];for(let Jt=0;Jt<4&&Dt<It;Jt++){let ar=Zo.decodeDigit(it,Ct,Dt,Zo.L_PATTERNS);pt+=String.fromCharCode(48+ar);for(let Er of Ct)Dt+=Er}Dt=Zo.findGuardPattern(it,Dt,!0,Zo.MIDDLE_PATTERN,new Int32Array(Zo.MIDDLE_PATTERN.length).fill(0))[1];for(let Jt=0;Jt<4&&Dt<It;Jt++){let ar=Zo.decodeDigit(it,Ct,Dt,Zo.L_PATTERNS);pt+=String.fromCharCode(48+ar);for(let Er of Ct)Dt+=Er}return{rowOffset:Dt,resultString:pt}}getBarcodeFormat(){return rs.EAN_8}}class Tu extends Zo{constructor(){super(...arguments),this.ean13Reader=new ru}getBarcodeFormat(){return rs.UPC_A}decode(it,ct){return this.maybeReturnResult(this.ean13Reader.decode(it))}decodeRow(it,ct,pt){return this.maybeReturnResult(this.ean13Reader.decodeRow(it,ct,pt))}decodeMiddle(it,ct,pt){return this.ean13Reader.decodeMiddle(it,ct,pt)}maybeReturnResult(it){let ct=it.getText();if(ct.charAt(0)==="0"){let pt=new Sn(ct.substring(1),null,null,it.getResultPoints(),rs.UPC_A);return it.getResultMetadata()!=null&&pt.putAllMetadata(it.getResultMetadata()),pt}else throw new Fr}reset(){this.ean13Reader.reset()}}class Ao extends Zo{constructor(){super(),this.decodeMiddleCounters=new Int32Array(4)}decodeMiddle(it,ct,pt){const Ct=this.decodeMiddleCounters.map(ar=>ar);Ct[0]=0,Ct[1]=0,Ct[2]=0,Ct[3]=0;const It=it.getSize();let Dt=ct[1],qt=0;for(let ar=0;ar<6&&Dt<It;ar++){const Er=Ao.decodeDigit(it,Ct,Dt,Ao.L_AND_G_PATTERNS);pt+=String.fromCharCode(48+Er%10);for(let Pr of Ct)Dt+=Pr;Er>=10&&(qt|=1<<5-ar)}let Jt=Ao.determineNumSysAndCheckDigit(pt,qt);return{rowOffset:Dt,resultString:Jt}}decodeEnd(it,ct){return Ao.findGuardPatternWithoutCounters(it,ct,!0,Ao.MIDDLE_END_PATTERN)}checkChecksum(it){return Zo.checkChecksum(Ao.convertUPCEtoUPCA(it))}static determineNumSysAndCheckDigit(it,ct){for(let pt=0;pt<=1;pt++)for(let Ct=0;Ct<10;Ct++)if(ct===this.NUMSYS_AND_CHECK_DIGIT_PATTERNS[pt][Ct]){let It=String.fromCharCode(48+pt),Dt=String.fromCharCode(48+Ct);return It+it+Dt}throw Fr.getNotFoundInstance()}getBarcodeFormat(){return rs.UPC_E}static convertUPCEtoUPCA(it){const ct=it.slice(1,7).split("").map(It=>It.charCodeAt(0)),pt=new Jr;pt.append(it.charAt(0));let Ct=ct[5];switch(Ct){case 0:case 1:case 2:pt.appendChars(ct,0,2),pt.append(Ct),pt.append("0000"),pt.appendChars(ct,2,3);break;case 3:pt.appendChars(ct,0,3),pt.append("00000"),pt.appendChars(ct,3,2);break;case 4:pt.appendChars(ct,0,4),pt.append("00000"),pt.append(ct[4]);break;default:pt.appendChars(ct,0,5),pt.append("0000"),pt.append(Ct);break}return it.length>=8&&pt.append(it.charAt(7)),pt.toString()}}Ao.MIDDLE_END_PATTERN=Int32Array.from([1,1,1,1,1,1]),Ao.NUMSYS_AND_CHECK_DIGIT_PATTERNS=[Int32Array.from([56,52,50,49,44,38,35,42,41,37]),Int32Array.from([7,11,13,14,19,25,28,21,22,26])];class Ll extends ps{constructor(it){super();let ct=it==null?null:it.get(ir.POSSIBLE_FORMATS),pt=[];a(ct)?(pt.push(new ru),pt.push(new Tu),pt.push(new Oo),pt.push(new Ao)):(ct.indexOf(rs.EAN_13)>-1&&pt.push(new ru),ct.indexOf(rs.UPC_A)>-1&&pt.push(new Tu),ct.indexOf(rs.EAN_8)>-1&&pt.push(new Oo),ct.indexOf(rs.UPC_E)>-1&&pt.push(new Ao)),this.readers=pt}decodeRow(it,ct,pt){for(let Ct of this.readers)try{const It=Ct.decodeRow(it,ct,pt),Dt=It.getBarcodeFormat()===rs.EAN_13&&It.getText().charAt(0)==="0",qt=pt==null?null:pt.get(ir.POSSIBLE_FORMATS),Jt=qt==null||qt.includes(rs.UPC_A);if(Dt&&Jt){const ar=It.getRawBytes(),Er=new Sn(It.getText().substring(1),ar,ar?ar.length:null,It.getResultPoints(),rs.UPC_A);return Er.putAllMetadata(It.getResultMetadata()),Er}return It}catch{}throw new Fr}reset(){for(let it of this.readers)it.reset()}}class Jo extends ps{constructor(){super(),this.decodeFinderCounters=new Int32Array(4),this.dataCharacterCounters=new Int32Array(8),this.oddRoundingErrors=new Array(4),this.evenRoundingErrors=new Array(4),this.oddCounts=new Array(this.dataCharacterCounters.length/2),this.evenCounts=new Array(this.dataCharacterCounters.length/2)}getDecodeFinderCounters(){return this.decodeFinderCounters}getDataCharacterCounters(){return this.dataCharacterCounters}getOddRoundingErrors(){return this.oddRoundingErrors}getEvenRoundingErrors(){return this.evenRoundingErrors}getOddCounts(){return this.oddCounts}getEvenCounts(){return this.evenCounts}parseFinderValue(it,ct){for(let pt=0;pt<ct.length;pt++)if(ps.patternMatchVariance(it,ct[pt],Jo.MAX_INDIVIDUAL_VARIANCE)<Jo.MAX_AVG_VARIANCE)return pt;throw new Fr}static count(it){return us.sum(new Int32Array(it))}static increment(it,ct){let pt=0,Ct=ct[0];for(let It=1;It<it.length;It++)ct[It]>Ct&&(Ct=ct[It],pt=It);it[pt]++}static decrement(it,ct){let pt=0,Ct=ct[0];for(let It=1;It<it.length;It++)ct[It]<Ct&&(Ct=ct[It],pt=It);it[pt]--}static isFinderPattern(it){let ct=it[0]+it[1],pt=ct+it[2]+it[3],Ct=ct/pt;if(Ct>=Jo.MIN_FINDER_PATTERN_RATIO&&Ct<=Jo.MAX_FINDER_PATTERN_RATIO){let It=Number.MAX_SAFE_INTEGER,Dt=Number.MIN_SAFE_INTEGER;for(let qt of it)qt>Dt&&(Dt=qt),qt<It&&(It=qt);return Dt<10*It}return!1}}Jo.MAX_AVG_VARIANCE=.2,Jo.MAX_INDIVIDUAL_VARIANCE=.45,Jo.MIN_FINDER_PATTERN_RATIO=9.5/12,Jo.MAX_FINDER_PATTERN_RATIO=12.5/14;class Ku{constructor(it,ct){this.value=it,this.checksumPortion=ct}getValue(){return this.value}getChecksumPortion(){return this.checksumPortion}toString(){return this.value+"("+this.checksumPortion+")"}equals(it){if(!(it instanceof Ku))return!1;const ct=it;return this.value===ct.value&&this.checksumPortion===ct.checksumPortion}hashCode(){return this.value^this.checksumPortion}}class zn{constructor(it,ct,pt,Ct,It){this.value=it,this.startEnd=ct,this.value=it,this.startEnd=ct,this.resultPoints=new Array,this.resultPoints.push(new Ss(pt,It)),this.resultPoints.push(new Ss(Ct,It))}getValue(){return this.value}getStartEnd(){return this.startEnd}getResultPoints(){return this.resultPoints}equals(it){if(!(it instanceof zn))return!1;const ct=it;return this.value===ct.value}hashCode(){return this.value}}class Vu{constructor(){}static getRSSvalue(it,ct,pt){let Ct=0;for(let Jt of it)Ct+=Jt;let It=0,Dt=0,qt=it.length;for(let Jt=0;Jt<qt-1;Jt++){let ar;for(ar=1,Dt|=1<<Jt;ar<it[Jt];ar++,Dt&=~(1<<Jt)){let Er=Vu.combins(Ct-ar-1,qt-Jt-2);if(pt&&Dt===0&&Ct-ar-(qt-Jt-1)>=qt-Jt-1&&(Er-=Vu.combins(Ct-ar-(qt-Jt),qt-Jt-2)),qt-Jt-1>1){let Pr=0;for(let Gr=Ct-ar-(qt-Jt-2);Gr>ct;Gr--)Pr+=Vu.combins(Ct-ar-Gr-1,qt-Jt-3);Er-=Pr*(qt-1-Jt)}else Ct-ar>ct&&Er--;It+=Er}Ct-=ar}return It}static combins(it,ct){let pt,Ct;it-ct>ct?(Ct=ct,pt=it-ct):(Ct=it-ct,pt=ct);let It=1,Dt=1;for(let qt=it;qt>pt;qt--)It*=qt,Dt<=Ct&&(It/=Dt,Dt++);for(;Dt<=Ct;)It/=Dt,Dt++;return It}}class t0{static buildBitArray(it){let ct=it.length*2-1;it[it.length-1].getRightChar()==null&&(ct-=1);let pt=12*ct,Ct=new Gt(pt),It=0,qt=it[0].getRightChar().getValue();for(let Jt=11;Jt>=0;--Jt)qt&1<<Jt&&Ct.set(It),It++;for(let Jt=1;Jt<it.length;++Jt){let ar=it[Jt],Er=ar.getLeftChar().getValue();for(let Pr=11;Pr>=0;--Pr)Er&1<<Pr&&Ct.set(It),It++;if(ar.getRightChar()!=null){let Pr=ar.getRightChar().getValue();for(let Gr=11;Gr>=0;--Gr)Pr&1<<Gr&&Ct.set(It),It++}}return Ct}}class Wu{constructor(it,ct){ct?this.decodedInformation=null:(this.finished=it,this.decodedInformation=ct)}getDecodedInformation(){return this.decodedInformation}isFinished(){return this.finished}}class Bo{constructor(it){this.newPosition=it}getNewPosition(){return this.newPosition}}class Ru extends Bo{constructor(it,ct){super(it),this.value=ct}getValue(){return this.value}isFNC1(){return this.value===Ru.FNC1}}Ru.FNC1="$";class T0 extends Bo{constructor(it,ct,pt){super(it),pt?(this.remaining=!0,this.remainingValue=this.remainingValue):(this.remaining=!1,this.remainingValue=0),this.newString=ct}getNewString(){return this.newString}isRemaining(){return this.remaining}getRemainingValue(){return this.remainingValue}}class fp extends Bo{constructor(it,ct,pt){if(super(it),ct<0||ct>10||pt<0||pt>10)throw new or;this.firstDigit=ct,this.secondDigit=pt}getFirstDigit(){return this.firstDigit}getSecondDigit(){return this.secondDigit}getValue(){return this.firstDigit*10+this.secondDigit}isFirstDigitFNC1(){return this.firstDigit===fp.FNC1}isSecondDigitFNC1(){return this.secondDigit===fp.FNC1}isAnyFNC1(){return this.firstDigit===fp.FNC1||this.secondDigit===fp.FNC1}}fp.FNC1=10;class xo{constructor(){}static parseFieldsInGeneralPurpose(it){if(!it)return null;if(it.length<2)throw new Fr;let ct=it.substring(0,2);for(let It of xo.TWO_DIGIT_DATA_LENGTH)if(It[0]===ct)return It[1]===xo.VARIABLE_LENGTH?xo.processVariableAI(2,It[2],it):xo.processFixedAI(2,It[1],it);if(it.length<3)throw new Fr;let pt=it.substring(0,3);for(let It of xo.THREE_DIGIT_DATA_LENGTH)if(It[0]===pt)return It[1]===xo.VARIABLE_LENGTH?xo.processVariableAI(3,It[2],it):xo.processFixedAI(3,It[1],it);for(let It of xo.THREE_DIGIT_PLUS_DIGIT_DATA_LENGTH)if(It[0]===pt)return It[1]===xo.VARIABLE_LENGTH?xo.processVariableAI(4,It[2],it):xo.processFixedAI(4,It[1],it);if(it.length<4)throw new Fr;let Ct=it.substring(0,4);for(let It of xo.FOUR_DIGIT_DATA_LENGTH)if(It[0]===Ct)return It[1]===xo.VARIABLE_LENGTH?xo.processVariableAI(4,It[2],it):xo.processFixedAI(4,It[1],it);throw new Fr}static processFixedAI(it,ct,pt){if(pt.length<it)throw new Fr;let Ct=pt.substring(0,it);if(pt.length<it+ct)throw new Fr;let It=pt.substring(it,it+ct),Dt=pt.substring(it+ct),qt="("+Ct+")"+It,Jt=xo.parseFieldsInGeneralPurpose(Dt);return Jt==null?qt:qt+Jt}static processVariableAI(it,ct,pt){let Ct=pt.substring(0,it),It;pt.length<it+ct?It=pt.length:It=it+ct;let Dt=pt.substring(it,It),qt=pt.substring(It),Jt="("+Ct+")"+Dt,ar=xo.parseFieldsInGeneralPurpose(qt);return ar==null?Jt:Jt+ar}}xo.VARIABLE_LENGTH=[],xo.TWO_DIGIT_DATA_LENGTH=[["00",18],["01",14],["02",14],["10",xo.VARIABLE_LENGTH,20],["11",6],["12",6],["13",6],["15",6],["17",6],["20",2],["21",xo.VARIABLE_LENGTH,20],["22",xo.VARIABLE_LENGTH,29],["30",xo.VARIABLE_LENGTH,8],["37",xo.VARIABLE_LENGTH,8],["90",xo.VARIABLE_LENGTH,30],["91",xo.VARIABLE_LENGTH,30],["92",xo.VARIABLE_LENGTH,30],["93",xo.VARIABLE_LENGTH,30],["94",xo.VARIABLE_LENGTH,30],["95",xo.VARIABLE_LENGTH,30],["96",xo.VARIABLE_LENGTH,30],["97",xo.VARIABLE_LENGTH,3],["98",xo.VARIABLE_LENGTH,30],["99",xo.VARIABLE_LENGTH,30]],xo.THREE_DIGIT_DATA_LENGTH=[["240",xo.VARIABLE_LENGTH,30],["241",xo.VARIABLE_LENGTH,30],["242",xo.VARIABLE_LENGTH,6],["250",xo.VARIABLE_LENGTH,30],["251",xo.VARIABLE_LENGTH,30],["253",xo.VARIABLE_LENGTH,17],["254",xo.VARIABLE_LENGTH,20],["400",xo.VARIABLE_LENGTH,30],["401",xo.VARIABLE_LENGTH,30],["402",17],["403",xo.VARIABLE_LENGTH,30],["410",13],["411",13],["412",13],["413",13],["414",13],["420",xo.VARIABLE_LENGTH,20],["421",xo.VARIABLE_LENGTH,15],["422",3],["423",xo.VARIABLE_LENGTH,15],["424",3],["425",3],["426",3]],xo.THREE_DIGIT_PLUS_DIGIT_DATA_LENGTH=[["310",6],["311",6],["312",6],["313",6],["314",6],["315",6],["316",6],["320",6],["321",6],["322",6],["323",6],["324",6],["325",6],["326",6],["327",6],["328",6],["329",6],["330",6],["331",6],["332",6],["333",6],["334",6],["335",6],["336",6],["340",6],["341",6],["342",6],["343",6],["344",6],["345",6],["346",6],["347",6],["348",6],["349",6],["350",6],["351",6],["352",6],["353",6],["354",6],["355",6],["356",6],["357",6],["360",6],["361",6],["362",6],["363",6],["364",6],["365",6],["366",6],["367",6],["368",6],["369",6],["390",xo.VARIABLE_LENGTH,15],["391",xo.VARIABLE_LENGTH,18],["392",xo.VARIABLE_LENGTH,15],["393",xo.VARIABLE_LENGTH,18],["703",xo.VARIABLE_LENGTH,30]],xo.FOUR_DIGIT_DATA_LENGTH=[["7001",13],["7002",xo.VARIABLE_LENGTH,30],["7003",10],["8001",14],["8002",xo.VARIABLE_LENGTH,20],["8003",xo.VARIABLE_LENGTH,30],["8004",xo.VARIABLE_LENGTH,30],["8005",6],["8006",18],["8007",xo.VARIABLE_LENGTH,30],["8008",xo.VARIABLE_LENGTH,12],["8018",18],["8020",xo.VARIABLE_LENGTH,25],["8100",6],["8101",10],["8102",2],["8110",xo.VARIABLE_LENGTH,70],["8200",xo.VARIABLE_LENGTH,70]];class xn{constructor(it){this.buffer=new Jr,this.information=it}decodeAllCodes(it,ct){let pt=ct,Ct=null;do{let It=this.decodeGeneralPurposeField(pt,Ct),Dt=xo.parseFieldsInGeneralPurpose(It.getNewString());if(Dt!=null&&it.append(Dt),It.isRemaining()?Ct=""+It.getRemainingValue():Ct=null,pt===It.getNewPosition())break;pt=It.getNewPosition()}while(!0);return it.toString()}isStillNumeric(it){if(it+7>this.information.getSize())return it+4<=this.information.getSize();for(let ct=it;ct<it+3;++ct)if(this.information.get(ct))return!0;return this.information.get(it+3)}decodeNumeric(it){if(it+7>this.information.getSize()){let It=this.extractNumericValueFromBitArray(it,4);return It===0?new fp(this.information.getSize(),fp.FNC1,fp.FNC1):new fp(this.information.getSize(),It-1,fp.FNC1)}let ct=this.extractNumericValueFromBitArray(it,7),pt=(ct-8)/11,Ct=(ct-8)%11;return new fp(it+7,pt,Ct)}extractNumericValueFromBitArray(it,ct){return xn.extractNumericValueFromBitArray(this.information,it,ct)}static extractNumericValueFromBitArray(it,ct,pt){let Ct=0;for(let It=0;It<pt;++It)it.get(ct+It)&&(Ct|=1<<pt-It-1);return Ct}decodeGeneralPurposeField(it,ct){this.buffer.setLengthToZero(),ct!=null&&this.buffer.append(ct),this.current.setPosition(it);let pt=this.parseBlocks();return pt!=null&&pt.isRemaining()?new T0(this.current.getPosition(),this.buffer.toString(),pt.getRemainingValue()):new T0(this.current.getPosition(),this.buffer.toString())}parseBlocks(){let it,ct;do{let pt=this.current.getPosition();if(this.current.isAlpha()?(ct=this.parseAlphaBlock(),it=ct.isFinished()):this.current.isIsoIec646()?(ct=this.parseIsoIec646Block(),it=ct.isFinished()):(ct=this.parseNumericBlock(),it=ct.isFinished()),!(pt!==this.current.getPosition())&&!it)break}while(!it);return ct.getDecodedInformation()}parseNumericBlock(){for(;this.isStillNumeric(this.current.getPosition());){let it=this.decodeNumeric(this.current.getPosition());if(this.current.setPosition(it.getNewPosition()),it.isFirstDigitFNC1()){let ct;return it.isSecondDigitFNC1()?ct=new T0(this.current.getPosition(),this.buffer.toString()):ct=new T0(this.current.getPosition(),this.buffer.toString(),it.getSecondDigit()),new Wu(!0,ct)}if(this.buffer.append(it.getFirstDigit()),it.isSecondDigitFNC1()){let ct=new T0(this.current.getPosition(),this.buffer.toString());return new Wu(!0,ct)}this.buffer.append(it.getSecondDigit())}return this.isNumericToAlphaNumericLatch(this.current.getPosition())&&(this.current.setAlpha(),this.current.incrementPosition(4)),new Wu(!1)}parseIsoIec646Block(){for(;this.isStillIsoIec646(this.current.getPosition());){let it=this.decodeIsoIec646(this.current.getPosition());if(this.current.setPosition(it.getNewPosition()),it.isFNC1()){let ct=new T0(this.current.getPosition(),this.buffer.toString());return new Wu(!0,ct)}this.buffer.append(it.getValue())}return this.isAlphaOr646ToNumericLatch(this.current.getPosition())?(this.current.incrementPosition(3),this.current.setNumeric()):this.isAlphaTo646ToAlphaLatch(this.current.getPosition())&&(this.current.getPosition()+5<this.information.getSize()?this.current.incrementPosition(5):this.current.setPosition(this.information.getSize()),this.current.setAlpha()),new Wu(!1)}parseAlphaBlock(){for(;this.isStillAlpha(this.current.getPosition());){let it=this.decodeAlphanumeric(this.current.getPosition());if(this.current.setPosition(it.getNewPosition()),it.isFNC1()){let ct=new T0(this.current.getPosition(),this.buffer.toString());return new Wu(!0,ct)}this.buffer.append(it.getValue())}return this.isAlphaOr646ToNumericLatch(this.current.getPosition())?(this.current.incrementPosition(3),this.current.setNumeric()):this.isAlphaTo646ToAlphaLatch(this.current.getPosition())&&(this.current.getPosition()+5<this.information.getSize()?this.current.incrementPosition(5):this.current.setPosition(this.information.getSize()),this.current.setIsoIec646()),new Wu(!1)}isStillIsoIec646(it){if(it+5>this.information.getSize())return!1;let ct=this.extractNumericValueFromBitArray(it,5);if(ct>=5&&ct<16)return!0;if(it+7>this.information.getSize())return!1;let pt=this.extractNumericValueFromBitArray(it,7);if(pt>=64&&pt<116)return!0;if(it+8>this.information.getSize())return!1;let Ct=this.extractNumericValueFromBitArray(it,8);return Ct>=232&&Ct<253}decodeIsoIec646(it){let ct=this.extractNumericValueFromBitArray(it,5);if(ct===15)return new Ru(it+5,Ru.FNC1);if(ct>=5&&ct<15)return new Ru(it+5,"0"+(ct-5));let pt=this.extractNumericValueFromBitArray(it,7);if(pt>=64&&pt<90)return new Ru(it+7,""+(pt+1));if(pt>=90&&pt<116)return new Ru(it+7,""+(pt+7));let Ct=this.extractNumericValueFromBitArray(it,8),It;switch(Ct){case 232:It="!";break;case 233:It='"';break;case 234:It="%";break;case 235:It="&";break;case 236:It="'";break;case 237:It="(";break;case 238:It=")";break;case 239:It="*";break;case 240:It="+";break;case 241:It=",";break;case 242:It="-";break;case 243:It=".";break;case 244:It="/";break;case 245:It=":";break;case 246:It=";";break;case 247:It="<";break;case 248:It="=";break;case 249:It=">";break;case 250:It="?";break;case 251:It="_";break;case 252:It=" ";break;default:throw new or}return new Ru(it+8,It)}isStillAlpha(it){if(it+5>this.information.getSize())return!1;let ct=this.extractNumericValueFromBitArray(it,5);if(ct>=5&&ct<16)return!0;if(it+6>this.information.getSize())return!1;let pt=this.extractNumericValueFromBitArray(it,6);return pt>=16&&pt<63}decodeAlphanumeric(it){let ct=this.extractNumericValueFromBitArray(it,5);if(ct===15)return new Ru(it+5,Ru.FNC1);if(ct>=5&&ct<15)return new Ru(it+5,"0"+(ct-5));let pt=this.extractNumericValueFromBitArray(it,6);if(pt>=32&&pt<58)return new Ru(it+6,""+(pt+33));let Ct;switch(pt){case 58:Ct="*";break;case 59:Ct=",";break;case 60:Ct="-";break;case 61:Ct=".";break;case 62:Ct="/";break;default:throw new Es("Decoding invalid alphanumeric value: "+pt)}return new Ru(it+6,Ct)}isAlphaTo646ToAlphaLatch(it){if(it+1>this.information.getSize())return!1;for(let ct=0;ct<5&&ct+it<this.information.getSize();++ct)if(ct===2){if(!this.information.get(it+2))return!1}else if(this.information.get(it+ct))return!1;return!0}isAlphaOr646ToNumericLatch(it){if(it+3>this.information.getSize())return!1;for(let ct=it;ct<it+3;++ct)if(this.information.get(ct))return!1;return!0}isNumericToAlphaNumericLatch(it){if(it+1>this.information.getSize())return!1;for(let ct=0;ct<4&&ct+it<this.information.getSize();++ct)if(this.information.get(it+ct))return!1;return!0}}class pr{constructor(it){this.information=it,this.generalDecoder=new xn(it)}getInformation(){return this.information}getGeneralDecoder(){return this.generalDecoder}}class vr extends pr{constructor(it){super(it)}encodeCompressedGtin(it,ct){it.append("(01)");let pt=it.length();it.append("9"),this.encodeCompressedGtinWithoutAI(it,ct,pt)}encodeCompressedGtinWithoutAI(it,ct,pt){for(let Ct=0;Ct<4;++Ct){let It=this.getGeneralDecoder().extractNumericValueFromBitArray(ct+10*Ct,10);It/100===0&&it.append("0"),It/10===0&&it.append("0"),it.append(It)}vr.appendCheckDigit(it,pt)}static appendCheckDigit(it,ct){let pt=0;for(let Ct=0;Ct<13;Ct++){let It=it.charAt(Ct+ct).charCodeAt(0)-48;pt+=Ct&1?It:3*It}pt=10-pt%10,pt===10&&(pt=0),it.append(pt)}}vr.GTIN_SIZE=40;class kr extends vr{constructor(it){super(it)}parseInformation(){let it=new Jr;it.append("(01)");let ct=it.length(),pt=this.getGeneralDecoder().extractNumericValueFromBitArray(kr.HEADER_SIZE,4);return it.append(pt),this.encodeCompressedGtinWithoutAI(it,kr.HEADER_SIZE+4,ct),this.getGeneralDecoder().decodeAllCodes(it,kr.HEADER_SIZE+44)}}kr.HEADER_SIZE=4;class Yr extends pr{constructor(it){super(it)}parseInformation(){let it=new Jr;return this.getGeneralDecoder().decodeAllCodes(it,Yr.HEADER_SIZE)}}Yr.HEADER_SIZE=5;class Kr extends vr{constructor(it){super(it)}encodeCompressedWeight(it,ct,pt){let Ct=this.getGeneralDecoder().extractNumericValueFromBitArray(ct,pt);this.addWeightCode(it,Ct);let It=this.checkWeight(Ct),Dt=1e5;for(let qt=0;qt<5;++qt)It/Dt===0&&it.append("0"),Dt/=10;it.append(It)}}class rn extends Kr{constructor(it){super(it)}parseInformation(){if(this.getInformation().getSize()!=rn.HEADER_SIZE+Kr.GTIN_SIZE+rn.WEIGHT_SIZE)throw new Fr;let it=new Jr;return this.encodeCompressedGtin(it,rn.HEADER_SIZE),this.encodeCompressedWeight(it,rn.HEADER_SIZE+Kr.GTIN_SIZE,rn.WEIGHT_SIZE),it.toString()}}rn.HEADER_SIZE=5,rn.WEIGHT_SIZE=15;class En extends rn{constructor(it){super(it)}addWeightCode(it,ct){it.append("(3103)")}checkWeight(it){return it}}class hn extends rn{constructor(it){super(it)}addWeightCode(it,ct){ct<1e4?it.append("(3202)"):it.append("(3203)")}checkWeight(it){return it<1e4?it:it-1e4}}class vn extends vr{constructor(it){super(it)}parseInformation(){if(this.getInformation().getSize()<vn.HEADER_SIZE+vr.GTIN_SIZE)throw new Fr;let it=new Jr;this.encodeCompressedGtin(it,vn.HEADER_SIZE);let ct=this.getGeneralDecoder().extractNumericValueFromBitArray(vn.HEADER_SIZE+vr.GTIN_SIZE,vn.LAST_DIGIT_SIZE);it.append("(392"),it.append(ct),it.append(")");let pt=this.getGeneralDecoder().decodeGeneralPurposeField(vn.HEADER_SIZE+vr.GTIN_SIZE+vn.LAST_DIGIT_SIZE,null);return it.append(pt.getNewString()),it.toString()}}vn.HEADER_SIZE=8,vn.LAST_DIGIT_SIZE=2;class Vn extends vr{constructor(it){super(it)}parseInformation(){if(this.getInformation().getSize()<Vn.HEADER_SIZE+vr.GTIN_SIZE)throw new Fr;let it=new Jr;this.encodeCompressedGtin(it,Vn.HEADER_SIZE);let ct=this.getGeneralDecoder().extractNumericValueFromBitArray(Vn.HEADER_SIZE+vr.GTIN_SIZE,Vn.LAST_DIGIT_SIZE);it.append("(393"),it.append(ct),it.append(")");let pt=this.getGeneralDecoder().extractNumericValueFromBitArray(Vn.HEADER_SIZE+vr.GTIN_SIZE+Vn.LAST_DIGIT_SIZE,Vn.FIRST_THREE_DIGITS_SIZE);pt/100==0&&it.append("0"),pt/10==0&&it.append("0"),it.append(pt);let Ct=this.getGeneralDecoder().decodeGeneralPurposeField(Vn.HEADER_SIZE+vr.GTIN_SIZE+Vn.LAST_DIGIT_SIZE+Vn.FIRST_THREE_DIGITS_SIZE,null);return it.append(Ct.getNewString()),it.toString()}}Vn.HEADER_SIZE=8,Vn.LAST_DIGIT_SIZE=2,Vn.FIRST_THREE_DIGITS_SIZE=10;class Rn extends Kr{constructor(it,ct,pt){super(it),this.dateCode=pt,this.firstAIdigits=ct}parseInformation(){if(this.getInformation().getSize()!=Rn.HEADER_SIZE+Rn.GTIN_SIZE+Rn.WEIGHT_SIZE+Rn.DATE_SIZE)throw new Fr;let it=new Jr;return this.encodeCompressedGtin(it,Rn.HEADER_SIZE),this.encodeCompressedWeight(it,Rn.HEADER_SIZE+Rn.GTIN_SIZE,Rn.WEIGHT_SIZE),this.encodeCompressedDate(it,Rn.HEADER_SIZE+Rn.GTIN_SIZE+Rn.WEIGHT_SIZE),it.toString()}encodeCompressedDate(it,ct){let pt=this.getGeneralDecoder().extractNumericValueFromBitArray(ct,Rn.DATE_SIZE);if(pt==38400)return;it.append("("),it.append(this.dateCode),it.append(")");let Ct=pt%32;pt/=32;let It=pt%12+1;pt/=12;let Dt=pt;Dt/10==0&&it.append("0"),it.append(Dt),It/10==0&&it.append("0"),it.append(It),Ct/10==0&&it.append("0"),it.append(Ct)}addWeightCode(it,ct){it.append("("),it.append(this.firstAIdigits),it.append(ct/1e5),it.append(")")}checkWeight(it){return it%1e5}}Rn.HEADER_SIZE=8,Rn.WEIGHT_SIZE=20,Rn.DATE_SIZE=16;function Ts(wr){try{if(wr.get(1))return new kr(wr);if(!wr.get(2))return new Yr(wr);switch(xn.extractNumericValueFromBitArray(wr,1,4)){case 4:return new En(wr);case 5:return new hn(wr)}switch(xn.extractNumericValueFromBitArray(wr,1,5)){case 12:return new vn(wr);case 13:return new Vn(wr)}switch(xn.extractNumericValueFromBitArray(wr,1,7)){case 56:return new Rn(wr,"310","11");case 57:return new Rn(wr,"320","11");case 58:return new Rn(wr,"310","13");case 59:return new Rn(wr,"320","13");case 60:return new Rn(wr,"310","15");case 61:return new Rn(wr,"320","15");case 62:return new Rn(wr,"310","17");case 63:return new Rn(wr,"320","17")}}catch(it){throw console.log(it),new Es("unknown decoder: "+wr)}}class Xs{constructor(it,ct,pt,Ct){this.leftchar=it,this.rightchar=ct,this.finderpattern=pt,this.maybeLast=Ct}mayBeLast(){return this.maybeLast}getLeftChar(){return this.leftchar}getRightChar(){return this.rightchar}getFinderPattern(){return this.finderpattern}mustBeLast(){return this.rightchar==null}toString(){return"[ "+this.leftchar+", "+this.rightchar+" : "+(this.finderpattern==null?"null":this.finderpattern.getValue())+" ]"}static equals(it,ct){return it instanceof Xs?Xs.equalsOrNull(it.leftchar,ct.leftchar)&&Xs.equalsOrNull(it.rightchar,ct.rightchar)&&Xs.equalsOrNull(it.finderpattern,ct.finderpattern):!1}static equalsOrNull(it,ct){return it===null?ct===null:Xs.equals(it,ct)}hashCode(){return this.leftchar.getValue()^this.rightchar.getValue()^this.finderpattern.getValue()}}class bs{constructor(it,ct,pt){this.pairs=it,this.rowNumber=ct,this.wasReversed=pt}getPairs(){return this.pairs}getRowNumber(){return this.rowNumber}isReversed(){return this.wasReversed}isEquivalent(it){return this.checkEqualitity(this,it)}toString(){return"{ "+this.pairs+" }"}equals(it,ct){return it instanceof bs?this.checkEqualitity(it,ct)&&it.wasReversed===ct.wasReversed:!1}checkEqualitity(it,ct){if(!it||!ct)return;let pt;return it.forEach((Ct,It)=>{ct.forEach(Dt=>{Ct.getLeftChar().getValue()===Dt.getLeftChar().getValue()&&Ct.getRightChar().getValue()===Dt.getRightChar().getValue()&&Ct.getFinderPatter().getValue()===Dt.getFinderPatter().getValue()&&(pt=!0)})}),pt}}class Gn extends Jo{constructor(it){super(...arguments),this.pairs=new Array(Gn.MAX_PAIRS),this.rows=new Array,this.startEnd=[2],this.verbose=it===!0}decodeRow(it,ct,pt){this.pairs.length=0,this.startFromEven=!1;try{return Gn.constructResult(this.decodeRow2pairs(it,ct))}catch(Ct){this.verbose&&console.log(Ct)}return this.pairs.length=0,this.startFromEven=!0,Gn.constructResult(this.decodeRow2pairs(it,ct))}reset(){this.pairs.length=0,this.rows.length=0}decodeRow2pairs(it,ct){let pt=!1;for(;!pt;)try{this.pairs.push(this.retrieveNextPair(ct,this.pairs,it))}catch(It){if(It instanceof Fr){if(!this.pairs.length)throw new Fr;pt=!0}}if(this.checkChecksum())return this.pairs;let Ct;if(this.rows.length?Ct=!0:Ct=!1,this.storeRow(it,!1),Ct){let It=this.checkRowsBoolean(!1);if(It!=null||(It=this.checkRowsBoolean(!0),It!=null))return It}throw new Fr}checkRowsBoolean(it){if(this.rows.length>25)return this.rows.length=0,null;this.pairs.length=0,it&&(this.rows=this.rows.reverse());let ct=null;try{ct=this.checkRows(new Array,0)}catch(pt){this.verbose&&console.log(pt)}return it&&(this.rows=this.rows.reverse()),ct}checkRows(it,ct){for(let pt=ct;pt<this.rows.length;pt++){let Ct=this.rows[pt];this.pairs.length=0;for(let Dt of it)this.pairs.push(Dt.getPairs());if(this.pairs.push(Ct.getPairs()),!Gn.isValidSequence(this.pairs))continue;if(this.checkChecksum())return this.pairs;let It=new Array(it);It.push(Ct);try{return this.checkRows(It,pt+1)}catch(Dt){this.verbose&&console.log(Dt)}}throw new Fr}static isValidSequence(it){for(let ct of Gn.FINDER_PATTERN_SEQUENCES){if(it.length>ct.length)continue;let pt=!0;for(let Ct=0;Ct<it.length;Ct++)if(it[Ct].getFinderPattern().getValue()!=ct[Ct]){pt=!1;break}if(pt)return!0}return!1}storeRow(it,ct){let pt=0,Ct=!1,It=!1;for(;pt<this.rows.length;){let Dt=this.rows[pt];if(Dt.getRowNumber()>it){It=Dt.isEquivalent(this.pairs);break}Ct=Dt.isEquivalent(this.pairs),pt++}It||Ct||Gn.isPartialRow(this.pairs,this.rows)||(this.rows.push(pt,new bs(this.pairs,it,ct)),this.removePartialRows(this.pairs,this.rows))}removePartialRows(it,ct){for(let pt of ct)if(pt.getPairs().length!==it.length){for(let Ct of pt.getPairs())for(let It of it)if(Xs.equals(Ct,It))break}}static isPartialRow(it,ct){for(let pt of ct){let Ct=!0;for(let It of it){let Dt=!1;for(let qt of pt.getPairs())if(It.equals(qt)){Dt=!0;break}if(!Dt){Ct=!1;break}}if(Ct)return!0}return!1}getRows(){return this.rows}static constructResult(it){let ct=t0.buildBitArray(it),Ct=Ts(ct).parseInformation(),It=it[0].getFinderPattern().getResultPoints(),Dt=it[it.length-1].getFinderPattern().getResultPoints(),qt=[It[0],It[1],Dt[0],Dt[1]];return new Sn(Ct,null,null,qt,rs.RSS_EXPANDED,null)}checkChecksum(){let it=this.pairs.get(0),ct=it.getLeftChar(),pt=it.getRightChar();if(pt==null)return!1;let Ct=pt.getChecksumPortion(),It=2;for(let qt=1;qt<this.pairs.size();++qt){let Jt=this.pairs.get(qt);Ct+=Jt.getLeftChar().getChecksumPortion(),It++;let ar=Jt.getRightChar();ar!=null&&(Ct+=ar.getChecksumPortion(),It++)}return Ct%=211,211*(It-4)+Ct==ct.getValue()}static getNextSecondBar(it,ct){let pt;return it.get(ct)?(pt=it.getNextUnset(ct),pt=it.getNextSet(pt)):(pt=it.getNextSet(ct),pt=it.getNextUnset(pt)),pt}retrieveNextPair(it,ct,pt){let Ct=ct.length%2==0;this.startFromEven&&(Ct=!Ct);let It,Dt=!0,qt=-1;do this.findNextPair(it,ct,qt),It=this.parseFoundFinderPattern(it,pt,Ct),It==null?qt=Gn.getNextSecondBar(it,this.startEnd[0]):Dt=!1;while(Dt);let Jt=this.decodeDataCharacter(it,It,Ct,!0);if(!this.isEmptyPair(ct)&&ct[ct.length-1].mustBeLast())throw new Fr;let ar;try{ar=this.decodeDataCharacter(it,It,Ct,!1)}catch(Er){ar=null,this.verbose&&console.log(Er)}return new Xs(Jt,ar,It,!0)}isEmptyPair(it){return it.length===0}findNextPair(it,ct,pt){let Ct=this.getDecodeFinderCounters();Ct[0]=0,Ct[1]=0,Ct[2]=0,Ct[3]=0;let It=it.getSize(),Dt;pt>=0?Dt=pt:this.isEmptyPair(ct)?Dt=0:Dt=ct[ct.length-1].getFinderPattern().getStartEnd()[1];let qt=ct.length%2!=0;this.startFromEven&&(qt=!qt);let Jt=!1;for(;Dt<It&&(Jt=!it.get(Dt),!!Jt);)Dt++;let ar=0,Er=Dt;for(let Pr=Dt;Pr<It;Pr++)if(it.get(Pr)!=Jt)Ct[ar]++;else{if(ar==3){if(qt&&Gn.reverseCounters(Ct),Gn.isFinderPattern(Ct)){this.startEnd[0]=Er,this.startEnd[1]=Pr;return}qt&&Gn.reverseCounters(Ct),Er+=Ct[0]+Ct[1],Ct[0]=Ct[2],Ct[1]=Ct[3],Ct[2]=0,Ct[3]=0,ar--}else ar++;Ct[ar]=1,Jt=!Jt}throw new Fr}static reverseCounters(it){let ct=it.length;for(let pt=0;pt<ct/2;++pt){let Ct=it[pt];it[pt]=it[ct-pt-1],it[ct-pt-1]=Ct}}parseFoundFinderPattern(it,ct,pt){let Ct,It,Dt;if(pt){let ar=this.startEnd[0]-1;for(;ar>=0&&!it.get(ar);)ar--;ar++,Ct=this.startEnd[0]-ar,It=ar,Dt=this.startEnd[1]}else It=this.startEnd[0],Dt=it.getNextUnset(this.startEnd[1]+1),Ct=Dt-this.startEnd[1];let qt=this.getDecodeFinderCounters();Bt.arraycopy(qt,0,qt,1,qt.length-1),qt[0]=Ct;let Jt;try{Jt=this.parseFinderValue(qt,Gn.FINDER_PATTERNS)}catch{return null}return new zn(Jt,[It,Dt],It,Dt,ct)}decodeDataCharacter(it,ct,pt,Ct){let It=this.getDataCharacterCounters();for(let Ou=0;Ou<It.length;Ou++)It[Ou]=0;if(Ct)Gn.recordPatternInReverse(it,ct.getStartEnd()[0],It);else{Gn.recordPattern(it,ct.getStartEnd()[1],It);for(let Ou=0,mp=It.length-1;Ou<mp;Ou++,mp--){let Cp=It[Ou];It[Ou]=It[mp],It[mp]=Cp}}let Dt=17,qt=us.sum(new Int32Array(It))/Dt,Jt=(ct.getStartEnd()[1]-ct.getStartEnd()[0])/15;if(Math.abs(qt-Jt)/Jt>.3)throw new Fr;let ar=this.getOddCounts(),Er=this.getEvenCounts(),Pr=this.getOddRoundingErrors(),Gr=this.getEvenRoundingErrors();for(let Ou=0;Ou<It.length;Ou++){let mp=1*It[Ou]/qt,Cp=mp+.5;if(Cp<1){if(mp<.3)throw new Fr;Cp=1}else if(Cp>8){if(mp>8.7)throw new Fr;Cp=8}let Gp=Ou/2;Ou&1?(Er[Gp]=Cp,Gr[Gp]=mp-Cp):(ar[Gp]=Cp,Pr[Gp]=mp-Cp)}this.adjustOddEvenCounts(Dt);let pn=4*ct.getValue()+(pt?0:2)+(Ct?0:1)-1,An=0,Pn=0;for(let Ou=ar.length-1;Ou>=0;Ou--){if(Gn.isNotA1left(ct,pt,Ct)){let mp=Gn.WEIGHTS[pn][2*Ou];Pn+=ar[Ou]*mp}An+=ar[Ou]}let Xn=0;for(let Ou=Er.length-1;Ou>=0;Ou--)if(Gn.isNotA1left(ct,pt,Ct)){let mp=Gn.WEIGHTS[pn][2*Ou+1];Xn+=Er[Ou]*mp}let os=Pn+Xn;if(An&1||An>13||An<4)throw new Fr;let Ks=(13-An)/2,Js=Gn.SYMBOL_WIDEST[Ks],Hs=9-Js,lu=Vu.getRSSvalue(ar,Js,!0),zl=Vu.getRSSvalue(Er,Hs,!1),kp=Gn.EVEN_TOTAL_SUBSET[Ks],Up=Gn.GSUM[Ks],ap=lu*kp+zl+Up;return new Ku(ap,os)}static isNotA1left(it,ct,pt){return!(it.getValue()==0&&ct&&pt)}adjustOddEvenCounts(it){let ct=us.sum(new Int32Array(this.getOddCounts())),pt=us.sum(new Int32Array(this.getEvenCounts())),Ct=!1,It=!1;ct>13?It=!0:ct<4&&(Ct=!0);let Dt=!1,qt=!1;pt>13?qt=!0:pt<4&&(Dt=!0);let Jt=ct+pt-it,ar=(ct&1)==1,Er=(pt&1)==0;if(Jt==1)if(ar){if(Er)throw new Fr;It=!0}else{if(!Er)throw new Fr;qt=!0}else if(Jt==-1)if(ar){if(Er)throw new Fr;Ct=!0}else{if(!Er)throw new Fr;Dt=!0}else if(Jt==0){if(ar){if(!Er)throw new Fr;ct<pt?(Ct=!0,qt=!0):(It=!0,Dt=!0)}else if(Er)throw new Fr}else throw new Fr;if(Ct){if(It)throw new Fr;Gn.increment(this.getOddCounts(),this.getOddRoundingErrors())}if(It&&Gn.decrement(this.getOddCounts(),this.getOddRoundingErrors()),Dt){if(qt)throw new Fr;Gn.increment(this.getEvenCounts(),this.getOddRoundingErrors())}qt&&Gn.decrement(this.getEvenCounts(),this.getEvenRoundingErrors())}}Gn.SYMBOL_WIDEST=[7,5,4,3,1],Gn.EVEN_TOTAL_SUBSET=[4,20,52,104,204],Gn.GSUM=[0,348,1388,2948,3988],Gn.FINDER_PATTERNS=[Int32Array.from([1,8,4,1]),Int32Array.from([3,6,4,1]),Int32Array.from([3,4,6,1]),Int32Array.from([3,2,8,1]),Int32Array.from([2,6,5,1]),Int32Array.from([2,2,9,1])],Gn.WEIGHTS=[[1,3,9,27,81,32,96,77],[20,60,180,118,143,7,21,63],[189,145,13,39,117,140,209,205],[193,157,49,147,19,57,171,91],[62,186,136,197,169,85,44,132],[185,133,188,142,4,12,36,108],[113,128,173,97,80,29,87,50],[150,28,84,41,123,158,52,156],[46,138,203,187,139,206,196,166],[76,17,51,153,37,111,122,155],[43,129,176,106,107,110,119,146],[16,48,144,10,30,90,59,177],[109,116,137,200,178,112,125,164],[70,210,208,202,184,130,179,115],[134,191,151,31,93,68,204,190],[148,22,66,198,172,94,71,2],[6,18,54,162,64,192,154,40],[120,149,25,75,14,42,126,167],[79,26,78,23,69,207,199,175],[103,98,83,38,114,131,182,124],[161,61,183,127,170,88,53,159],[55,165,73,8,24,72,5,15],[45,135,194,160,58,174,100,89]],Gn.FINDER_PAT_A=0,Gn.FINDER_PAT_B=1,Gn.FINDER_PAT_C=2,Gn.FINDER_PAT_D=3,Gn.FINDER_PAT_E=4,Gn.FINDER_PAT_F=5,Gn.FINDER_PATTERN_SEQUENCES=[[Gn.FINDER_PAT_A,Gn.FINDER_PAT_A],[Gn.FINDER_PAT_A,Gn.FINDER_PAT_B,Gn.FINDER_PAT_B],[Gn.FINDER_PAT_A,Gn.FINDER_PAT_C,Gn.FINDER_PAT_B,Gn.FINDER_PAT_D],[Gn.FINDER_PAT_A,Gn.FINDER_PAT_E,Gn.FINDER_PAT_B,Gn.FINDER_PAT_D,Gn.FINDER_PAT_C],[Gn.FINDER_PAT_A,Gn.FINDER_PAT_E,Gn.FINDER_PAT_B,Gn.FINDER_PAT_D,Gn.FINDER_PAT_D,Gn.FINDER_PAT_F],[Gn.FINDER_PAT_A,Gn.FINDER_PAT_E,Gn.FINDER_PAT_B,Gn.FINDER_PAT_D,Gn.FINDER_PAT_E,Gn.FINDER_PAT_F,Gn.FINDER_PAT_F],[Gn.FINDER_PAT_A,Gn.FINDER_PAT_A,Gn.FINDER_PAT_B,Gn.FINDER_PAT_B,Gn.FINDER_PAT_C,Gn.FINDER_PAT_C,Gn.FINDER_PAT_D,Gn.FINDER_PAT_D],[Gn.FINDER_PAT_A,Gn.FINDER_PAT_A,Gn.FINDER_PAT_B,Gn.FINDER_PAT_B,Gn.FINDER_PAT_C,Gn.FINDER_PAT_C,Gn.FINDER_PAT_D,Gn.FINDER_PAT_E,Gn.FINDER_PAT_E],[Gn.FINDER_PAT_A,Gn.FINDER_PAT_A,Gn.FINDER_PAT_B,Gn.FINDER_PAT_B,Gn.FINDER_PAT_C,Gn.FINDER_PAT_C,Gn.FINDER_PAT_D,Gn.FINDER_PAT_E,Gn.FINDER_PAT_F,Gn.FINDER_PAT_F],[Gn.FINDER_PAT_A,Gn.FINDER_PAT_A,Gn.FINDER_PAT_B,Gn.FINDER_PAT_B,Gn.FINDER_PAT_C,Gn.FINDER_PAT_D,Gn.FINDER_PAT_D,Gn.FINDER_PAT_E,Gn.FINDER_PAT_E,Gn.FINDER_PAT_F,Gn.FINDER_PAT_F]],Gn.MAX_PAIRS=11;class bo extends Ku{constructor(it,ct,pt){super(it,ct),this.count=0,this.finderPattern=pt}getFinderPattern(){return this.finderPattern}getCount(){return this.count}incrementCount(){this.count++}}class Ys extends Jo{constructor(){super(...arguments),this.possibleLeftPairs=[],this.possibleRightPairs=[]}decodeRow(it,ct,pt){const Ct=this.decodePair(ct,!1,it,pt);Ys.addOrTally(this.possibleLeftPairs,Ct),ct.reverse();let It=this.decodePair(ct,!0,it,pt);Ys.addOrTally(this.possibleRightPairs,It),ct.reverse();for(let Dt of this.possibleLeftPairs)if(Dt.getCount()>1){for(let qt of this.possibleRightPairs)if(qt.getCount()>1&&Ys.checkChecksum(Dt,qt))return Ys.constructResult(Dt,qt)}throw new Fr}static addOrTally(it,ct){if(ct==null)return;let pt=!1;for(let Ct of it)if(Ct.getValue()===ct.getValue()){Ct.incrementCount(),pt=!0;break}pt||it.push(ct)}reset(){this.possibleLeftPairs.length=0,this.possibleRightPairs.length=0}static constructResult(it,ct){let pt=4537077*it.getValue()+ct.getValue(),Ct=new String(pt).toString(),It=new Jr;for(let ar=13-Ct.length;ar>0;ar--)It.append("0");It.append(Ct);let Dt=0;for(let ar=0;ar<13;ar++){let Er=It.charAt(ar).charCodeAt(0)-48;Dt+=ar&1?Er:3*Er}Dt=10-Dt%10,Dt===10&&(Dt=0),It.append(Dt.toString());let qt=it.getFinderPattern().getResultPoints(),Jt=ct.getFinderPattern().getResultPoints();return new Sn(It.toString(),null,0,[qt[0],qt[1],Jt[0],Jt[1]],rs.RSS_14,new Date().getTime())}static checkChecksum(it,ct){let pt=(it.getChecksumPortion()+16*ct.getChecksumPortion())%79,Ct=9*it.getFinderPattern().getValue()+ct.getFinderPattern().getValue();return Ct>72&&Ct--,Ct>8&&Ct--,pt===Ct}decodePair(it,ct,pt,Ct){try{let It=this.findFinderPattern(it,ct),Dt=this.parseFoundFinderPattern(it,pt,ct,It),qt=Ct==null?null:Ct.get(ir.NEED_RESULT_POINT_CALLBACK);if(qt!=null){let Er=(It[0]+It[1])/2;ct&&(Er=it.getSize()-1-Er),qt.foundPossibleResultPoint(new Ss(Er,pt))}let Jt=this.decodeDataCharacter(it,Dt,!0),ar=this.decodeDataCharacter(it,Dt,!1);return new bo(1597*Jt.getValue()+ar.getValue(),Jt.getChecksumPortion()+4*ar.getChecksumPortion(),Dt)}catch{return null}}decodeDataCharacter(it,ct,pt){let Ct=this.getDataCharacterCounters();for(let Xn=0;Xn<Ct.length;Xn++)Ct[Xn]=0;if(pt)ps.recordPatternInReverse(it,ct.getStartEnd()[0],Ct);else{ps.recordPattern(it,ct.getStartEnd()[1]+1,Ct);for(let Xn=0,os=Ct.length-1;Xn<os;Xn++,os--){let Ks=Ct[Xn];Ct[Xn]=Ct[os],Ct[os]=Ks}}let It=pt?16:15,Dt=us.sum(new Int32Array(Ct))/It,qt=this.getOddCounts(),Jt=this.getEvenCounts(),ar=this.getOddRoundingErrors(),Er=this.getEvenRoundingErrors();for(let Xn=0;Xn<Ct.length;Xn++){let os=Ct[Xn]/Dt,Ks=Math.floor(os+.5);Ks<1?Ks=1:Ks>8&&(Ks=8);let Js=Math.floor(Xn/2);Xn&1?(Jt[Js]=Ks,Er[Js]=os-Ks):(qt[Js]=Ks,ar[Js]=os-Ks)}this.adjustOddEvenCounts(pt,It);let Pr=0,Gr=0;for(let Xn=qt.length-1;Xn>=0;Xn--)Gr*=9,Gr+=qt[Xn],Pr+=qt[Xn];let pn=0,An=0;for(let Xn=Jt.length-1;Xn>=0;Xn--)pn*=9,pn+=Jt[Xn],An+=Jt[Xn];let Pn=Gr+3*pn;if(pt){if(Pr&1||Pr>12||Pr<4)throw new Fr;let Xn=(12-Pr)/2,os=Ys.OUTSIDE_ODD_WIDEST[Xn],Ks=9-os,Js=Vu.getRSSvalue(qt,os,!1),Hs=Vu.getRSSvalue(Jt,Ks,!0),lu=Ys.OUTSIDE_EVEN_TOTAL_SUBSET[Xn],zl=Ys.OUTSIDE_GSUM[Xn];return new Ku(Js*lu+Hs+zl,Pn)}else{if(An&1||An>10||An<4)throw new Fr;let Xn=(10-An)/2,os=Ys.INSIDE_ODD_WIDEST[Xn],Ks=9-os,Js=Vu.getRSSvalue(qt,os,!0),Hs=Vu.getRSSvalue(Jt,Ks,!1),lu=Ys.INSIDE_ODD_TOTAL_SUBSET[Xn],zl=Ys.INSIDE_GSUM[Xn];return new Ku(Hs*lu+Js+zl,Pn)}}findFinderPattern(it,ct){let pt=this.getDecodeFinderCounters();pt[0]=0,pt[1]=0,pt[2]=0,pt[3]=0;let Ct=it.getSize(),It=!1,Dt=0;for(;Dt<Ct&&(It=!it.get(Dt),ct!==It);)Dt++;let qt=0,Jt=Dt;for(let ar=Dt;ar<Ct;ar++)if(it.get(ar)!==It)pt[qt]++;else{if(qt===3){if(Jo.isFinderPattern(pt))return[Jt,ar];Jt+=pt[0]+pt[1],pt[0]=pt[2],pt[1]=pt[3],pt[2]=0,pt[3]=0,qt--}else qt++;pt[qt]=1,It=!It}throw new Fr}parseFoundFinderPattern(it,ct,pt,Ct){let It=it.get(Ct[0]),Dt=Ct[0]-1;for(;Dt>=0&&It!==it.get(Dt);)Dt--;Dt++;const qt=Ct[0]-Dt,Jt=this.getDecodeFinderCounters(),ar=new Int32Array(Jt.length);Bt.arraycopy(Jt,0,ar,1,Jt.length-1),ar[0]=qt;const Er=this.parseFinderValue(ar,Ys.FINDER_PATTERNS);let Pr=Dt,Gr=Ct[1];return pt&&(Pr=it.getSize()-1-Pr,Gr=it.getSize()-1-Gr),new zn(Er,[Dt,Ct[1]],Pr,Gr,ct)}adjustOddEvenCounts(it,ct){let pt=us.sum(new Int32Array(this.getOddCounts())),Ct=us.sum(new Int32Array(this.getEvenCounts())),It=!1,Dt=!1,qt=!1,Jt=!1;it?(pt>12?Dt=!0:pt<4&&(It=!0),Ct>12?Jt=!0:Ct<4&&(qt=!0)):(pt>11?Dt=!0:pt<5&&(It=!0),Ct>10?Jt=!0:Ct<4&&(qt=!0));let ar=pt+Ct-ct,Er=(pt&1)===(it?1:0),Pr=(Ct&1)===1;if(ar===1)if(Er){if(Pr)throw new Fr;Dt=!0}else{if(!Pr)throw new Fr;Jt=!0}else if(ar===-1)if(Er){if(Pr)throw new Fr;It=!0}else{if(!Pr)throw new Fr;qt=!0}else if(ar===0){if(Er){if(!Pr)throw new Fr;pt<Ct?(It=!0,Jt=!0):(Dt=!0,qt=!0)}else if(Pr)throw new Fr}else throw new Fr;if(It){if(Dt)throw new Fr;Jo.increment(this.getOddCounts(),this.getOddRoundingErrors())}if(Dt&&Jo.decrement(this.getOddCounts(),this.getOddRoundingErrors()),qt){if(Jt)throw new Fr;Jo.increment(this.getEvenCounts(),this.getOddRoundingErrors())}Jt&&Jo.decrement(this.getEvenCounts(),this.getEvenRoundingErrors())}}Ys.OUTSIDE_EVEN_TOTAL_SUBSET=[1,10,34,70,126],Ys.INSIDE_ODD_TOTAL_SUBSET=[4,20,48,81],Ys.OUTSIDE_GSUM=[0,161,961,2015,2715],Ys.INSIDE_GSUM=[0,336,1036,1516],Ys.OUTSIDE_ODD_WIDEST=[8,6,4,3,1],Ys.INSIDE_ODD_WIDEST=[2,4,6,8],Ys.FINDER_PATTERNS=[Int32Array.from([3,8,2,1]),Int32Array.from([3,5,5,1]),Int32Array.from([3,3,7,1]),Int32Array.from([3,1,9,1]),Int32Array.from([2,7,4,1]),Int32Array.from([2,5,6,1]),Int32Array.from([2,3,8,1]),Int32Array.from([1,5,7,1]),Int32Array.from([1,3,9,1])];class jo extends ps{constructor(it,ct){super(),this.readers=[],this.verbose=ct===!0;const pt=it?it.get(ir.POSSIBLE_FORMATS):null,Ct=it&&it.get(ir.ASSUME_CODE_39_CHECK_DIGIT)!==void 0;pt?((pt.includes(rs.EAN_13)||pt.includes(rs.UPC_A)||pt.includes(rs.EAN_8)||pt.includes(rs.UPC_E))&&this.readers.push(new Ll(it)),pt.includes(rs.CODE_39)&&this.readers.push(new qs(Ct)),pt.includes(rs.CODE_128)&&this.readers.push(new qn),pt.includes(rs.ITF)&&this.readers.push(new Gs),pt.includes(rs.RSS_14)&&this.readers.push(new Ys),pt.includes(rs.RSS_EXPANDED)&&this.readers.push(new Gn(this.verbose))):(this.readers.push(new Ll(it)),this.readers.push(new qs),this.readers.push(new Ll(it)),this.readers.push(new qn),this.readers.push(new Gs),this.readers.push(new Ys),this.readers.push(new Gn(this.verbose)))}decodeRow(it,ct,pt){for(let Ct=0;Ct<this.readers.length;Ct++)try{return this.readers[Ct].decodeRow(it,ct,pt)}catch{}throw new Fr}reset(){this.readers.forEach(it=>it.reset())}}class yu extends gn{constructor(it=500,ct){super(new jo(ct),it,ct)}}class Yo{constructor(it,ct,pt){this.ecCodewords=it,this.ecBlocks=[ct],pt&&this.ecBlocks.push(pt)}getECCodewords(){return this.ecCodewords}getECBlocks(){return this.ecBlocks}}class Lo{constructor(it,ct){this.count=it,this.dataCodewords=ct}getCount(){return this.count}getDataCodewords(){return this.dataCodewords}}class zo{constructor(it,ct,pt,Ct,It,Dt){this.versionNumber=it,this.symbolSizeRows=ct,this.symbolSizeColumns=pt,this.dataRegionSizeRows=Ct,this.dataRegionSizeColumns=It,this.ecBlocks=Dt;let qt=0;const Jt=Dt.getECCodewords(),ar=Dt.getECBlocks();for(let Er of ar)qt+=Er.getCount()*(Er.getDataCodewords()+Jt);this.totalCodewords=qt}getVersionNumber(){return this.versionNumber}getSymbolSizeRows(){return this.symbolSizeRows}getSymbolSizeColumns(){return this.symbolSizeColumns}getDataRegionSizeRows(){return this.dataRegionSizeRows}getDataRegionSizeColumns(){return this.dataRegionSizeColumns}getTotalCodewords(){return this.totalCodewords}getECBlocks(){return this.ecBlocks}static getVersionForDimensions(it,ct){if(it&1||ct&1)throw new or;for(let pt of zo.VERSIONS)if(pt.symbolSizeRows===it&&pt.symbolSizeColumns===ct)return pt;throw new or}toString(){return""+this.versionNumber}static buildVersions(){return[new zo(1,10,10,8,8,new Yo(5,new Lo(1,3))),new zo(2,12,12,10,10,new Yo(7,new Lo(1,5))),new zo(3,14,14,12,12,new Yo(10,new Lo(1,8))),new zo(4,16,16,14,14,new Yo(12,new Lo(1,12))),new zo(5,18,18,16,16,new Yo(14,new Lo(1,18))),new zo(6,20,20,18,18,new Yo(18,new Lo(1,22))),new zo(7,22,22,20,20,new Yo(20,new Lo(1,30))),new zo(8,24,24,22,22,new Yo(24,new Lo(1,36))),new zo(9,26,26,24,24,new Yo(28,new Lo(1,44))),new zo(10,32,32,14,14,new Yo(36,new Lo(1,62))),new zo(11,36,36,16,16,new Yo(42,new Lo(1,86))),new zo(12,40,40,18,18,new Yo(48,new Lo(1,114))),new zo(13,44,44,20,20,new Yo(56,new Lo(1,144))),new zo(14,48,48,22,22,new Yo(68,new Lo(1,174))),new zo(15,52,52,24,24,new Yo(42,new Lo(2,102))),new zo(16,64,64,14,14,new Yo(56,new Lo(2,140))),new zo(17,72,72,16,16,new Yo(36,new Lo(4,92))),new zo(18,80,80,18,18,new Yo(48,new Lo(4,114))),new zo(19,88,88,20,20,new Yo(56,new Lo(4,144))),new zo(20,96,96,22,22,new Yo(68,new Lo(4,174))),new zo(21,104,104,24,24,new Yo(56,new Lo(6,136))),new zo(22,120,120,18,18,new Yo(68,new Lo(6,175))),new zo(23,132,132,20,20,new Yo(62,new Lo(8,163))),new zo(24,144,144,22,22,new Yo(62,new Lo(8,156),new Lo(2,155))),new zo(25,8,18,6,16,new Yo(7,new Lo(1,5))),new zo(26,8,32,6,14,new Yo(11,new Lo(1,10))),new zo(27,12,26,10,24,new Yo(14,new Lo(1,16))),new zo(28,12,36,10,16,new Yo(18,new Lo(1,22))),new zo(29,16,36,14,16,new Yo(24,new Lo(1,32))),new zo(30,16,48,14,22,new Yo(28,new Lo(1,49)))]}}zo.VERSIONS=zo.buildVersions();class uu{constructor(it){const ct=it.getHeight();if(ct<8||ct>144||ct&1)throw new or;this.version=uu.readVersion(it),this.mappingBitMatrix=this.extractDataRegion(it),this.readMappingMatrix=new fn(this.mappingBitMatrix.getWidth(),this.mappingBitMatrix.getHeight())}getVersion(){return this.version}static readVersion(it){const ct=it.getHeight(),pt=it.getWidth();return zo.getVersionForDimensions(ct,pt)}readCodewords(){const it=new Int8Array(this.version.getTotalCodewords());let ct=0,pt=4,Ct=0;const It=this.mappingBitMatrix.getHeight(),Dt=this.mappingBitMatrix.getWidth();let qt=!1,Jt=!1,ar=!1,Er=!1;do if(pt===It&&Ct===0&&!qt)it[ct++]=this.readCorner1(It,Dt)&255,pt-=2,Ct+=2,qt=!0;else if(pt===It-2&&Ct===0&&Dt&3&&!Jt)it[ct++]=this.readCorner2(It,Dt)&255,pt-=2,Ct+=2,Jt=!0;else if(pt===It+4&&Ct===2&&!(Dt&7)&&!ar)it[ct++]=this.readCorner3(It,Dt)&255,pt-=2,Ct+=2,ar=!0;else if(pt===It-2&&Ct===0&&(Dt&7)===4&&!Er)it[ct++]=this.readCorner4(It,Dt)&255,pt-=2,Ct+=2,Er=!0;else{do pt<It&&Ct>=0&&!this.readMappingMatrix.get(Ct,pt)&&(it[ct++]=this.readUtah(pt,Ct,It,Dt)&255),pt-=2,Ct+=2;while(pt>=0&&Ct<Dt);pt+=1,Ct+=3;do pt>=0&&Ct<Dt&&!this.readMappingMatrix.get(Ct,pt)&&(it[ct++]=this.readUtah(pt,Ct,It,Dt)&255),pt+=2,Ct-=2;while(pt<It&&Ct>=0);pt+=3,Ct+=1}while(pt<It||Ct<Dt);if(ct!==this.version.getTotalCodewords())throw new or;return it}readModule(it,ct,pt,Ct){return it<0&&(it+=pt,ct+=4-(pt+4&7)),ct<0&&(ct+=Ct,it+=4-(Ct+4&7)),this.readMappingMatrix.set(ct,it),this.mappingBitMatrix.get(ct,it)}readUtah(it,ct,pt,Ct){let It=0;return this.readModule(it-2,ct-2,pt,Ct)&&(It|=1),It<<=1,this.readModule(it-2,ct-1,pt,Ct)&&(It|=1),It<<=1,this.readModule(it-1,ct-2,pt,Ct)&&(It|=1),It<<=1,this.readModule(it-1,ct-1,pt,Ct)&&(It|=1),It<<=1,this.readModule(it-1,ct,pt,Ct)&&(It|=1),It<<=1,this.readModule(it,ct-2,pt,Ct)&&(It|=1),It<<=1,this.readModule(it,ct-1,pt,Ct)&&(It|=1),It<<=1,this.readModule(it,ct,pt,Ct)&&(It|=1),It}readCorner1(it,ct){let pt=0;return this.readModule(it-1,0,it,ct)&&(pt|=1),pt<<=1,this.readModule(it-1,1,it,ct)&&(pt|=1),pt<<=1,this.readModule(it-1,2,it,ct)&&(pt|=1),pt<<=1,this.readModule(0,ct-2,it,ct)&&(pt|=1),pt<<=1,this.readModule(0,ct-1,it,ct)&&(pt|=1),pt<<=1,this.readModule(1,ct-1,it,ct)&&(pt|=1),pt<<=1,this.readModule(2,ct-1,it,ct)&&(pt|=1),pt<<=1,this.readModule(3,ct-1,it,ct)&&(pt|=1),pt}readCorner2(it,ct){let pt=0;return this.readModule(it-3,0,it,ct)&&(pt|=1),pt<<=1,this.readModule(it-2,0,it,ct)&&(pt|=1),pt<<=1,this.readModule(it-1,0,it,ct)&&(pt|=1),pt<<=1,this.readModule(0,ct-4,it,ct)&&(pt|=1),pt<<=1,this.readModule(0,ct-3,it,ct)&&(pt|=1),pt<<=1,this.readModule(0,ct-2,it,ct)&&(pt|=1),pt<<=1,this.readModule(0,ct-1,it,ct)&&(pt|=1),pt<<=1,this.readModule(1,ct-1,it,ct)&&(pt|=1),pt}readCorner3(it,ct){let pt=0;return this.readModule(it-1,0,it,ct)&&(pt|=1),pt<<=1,this.readModule(it-1,ct-1,it,ct)&&(pt|=1),pt<<=1,this.readModule(0,ct-3,it,ct)&&(pt|=1),pt<<=1,this.readModule(0,ct-2,it,ct)&&(pt|=1),pt<<=1,this.readModule(0,ct-1,it,ct)&&(pt|=1),pt<<=1,this.readModule(1,ct-3,it,ct)&&(pt|=1),pt<<=1,this.readModule(1,ct-2,it,ct)&&(pt|=1),pt<<=1,this.readModule(1,ct-1,it,ct)&&(pt|=1),pt}readCorner4(it,ct){let pt=0;return this.readModule(it-3,0,it,ct)&&(pt|=1),pt<<=1,this.readModule(it-2,0,it,ct)&&(pt|=1),pt<<=1,this.readModule(it-1,0,it,ct)&&(pt|=1),pt<<=1,this.readModule(0,ct-2,it,ct)&&(pt|=1),pt<<=1,this.readModule(0,ct-1,it,ct)&&(pt|=1),pt<<=1,this.readModule(1,ct-1,it,ct)&&(pt|=1),pt<<=1,this.readModule(2,ct-1,it,ct)&&(pt|=1),pt<<=1,this.readModule(3,ct-1,it,ct)&&(pt|=1),pt}extractDataRegion(it){const ct=this.version.getSymbolSizeRows(),pt=this.version.getSymbolSizeColumns();if(it.getHeight()!==ct)throw new St("Dimension of bitMatrix must match the version size");const Ct=this.version.getDataRegionSizeRows(),It=this.version.getDataRegionSizeColumns(),Dt=ct/Ct|0,qt=pt/It|0,Jt=Dt*Ct,ar=qt*It,Er=new fn(ar,Jt);for(let Pr=0;Pr<Dt;++Pr){const Gr=Pr*Ct;for(let pn=0;pn<qt;++pn){const An=pn*It;for(let Pn=0;Pn<Ct;++Pn){const Xn=Pr*(Ct+2)+1+Pn,os=Gr+Pn;for(let Ks=0;Ks<It;++Ks){const Js=pn*(It+2)+1+Ks;if(it.get(Js,Xn)){const Hs=An+Ks;Er.set(Hs,os)}}}}}return Er}}class na{constructor(it,ct){this.numDataCodewords=it,this.codewords=ct}static getDataBlocks(it,ct){const pt=ct.getECBlocks();let Ct=0;const It=pt.getECBlocks();for(let Pn of It)Ct+=Pn.getCount();const Dt=new Array(Ct);let qt=0;for(let Pn of It)for(let Xn=0;Xn<Pn.getCount();Xn++){const os=Pn.getDataCodewords(),Ks=pt.getECCodewords()+os;Dt[qt++]=new na(os,new Uint8Array(Ks))}const ar=Dt[0].codewords.length-pt.getECCodewords(),Er=ar-1;let Pr=0;for(let Pn=0;Pn<Er;Pn++)for(let Xn=0;Xn<qt;Xn++)Dt[Xn].codewords[Pn]=it[Pr++];const Gr=ct.getVersionNumber()===24,pn=Gr?8:qt;for(let Pn=0;Pn<pn;Pn++)Dt[Pn].codewords[ar-1]=it[Pr++];const An=Dt[0].codewords.length;for(let Pn=ar;Pn<An;Pn++)for(let Xn=0;Xn<qt;Xn++){const os=Gr?(Xn+8)%qt:Xn,Ks=Gr&&os>7?Pn-1:Pn;Dt[os].codewords[Ks]=it[Pr++]}if(Pr!==it.length)throw new St;return Dt}getNumDataCodewords(){return this.numDataCodewords}getCodewords(){return this.codewords}}class du{constructor(it){this.bytes=it,this.byteOffset=0,this.bitOffset=0}getBitOffset(){return this.bitOffset}getByteOffset(){return this.byteOffset}readBits(it){if(it<1||it>32||it>this.available())throw new St(""+it);let ct=0,pt=this.bitOffset,Ct=this.byteOffset;const It=this.bytes;if(pt>0){const Dt=8-pt,qt=it<Dt?it:Dt,Jt=Dt-qt,ar=255>>8-qt<<Jt;ct=(It[Ct]&ar)>>Jt,it-=qt,pt+=qt,pt===8&&(pt=0,Ct++)}if(it>0){for(;it>=8;)ct=ct<<8|It[Ct]&255,Ct++,it-=8;if(it>0){const Dt=8-it,qt=255>>Dt<<Dt;ct=ct<<it|(It[Ct]&qt)>>Dt,pt+=it}}return this.bitOffset=pt,this.byteOffset=Ct,ct}available(){return 8*(this.bytes.length-this.byteOffset)-this.bitOffset}}var Vo;(function(wr){wr[wr.PAD_ENCODE=0]="PAD_ENCODE",wr[wr.ASCII_ENCODE=1]="ASCII_ENCODE",wr[wr.C40_ENCODE=2]="C40_ENCODE",wr[wr.TEXT_ENCODE=3]="TEXT_ENCODE",wr[wr.ANSIX12_ENCODE=4]="ANSIX12_ENCODE",wr[wr.EDIFACT_ENCODE=5]="EDIFACT_ENCODE",wr[wr.BASE256_ENCODE=6]="BASE256_ENCODE"})(Vo||(Vo={}));class Do{static decode(it){const ct=new du(it),pt=new Jr,Ct=new Jr,It=new Array;let Dt=Vo.ASCII_ENCODE;do if(Dt===Vo.ASCII_ENCODE)Dt=this.decodeAsciiSegment(ct,pt,Ct);else{switch(Dt){case Vo.C40_ENCODE:this.decodeC40Segment(ct,pt);break;case Vo.TEXT_ENCODE:this.decodeTextSegment(ct,pt);break;case Vo.ANSIX12_ENCODE:this.decodeAnsiX12Segment(ct,pt);break;case Vo.EDIFACT_ENCODE:this.decodeEdifactSegment(ct,pt);break;case Vo.BASE256_ENCODE:this.decodeBase256Segment(ct,pt,It);break;default:throw new or}Dt=Vo.ASCII_ENCODE}while(Dt!==Vo.PAD_ENCODE&&ct.available()>0);return Ct.length()>0&&pt.append(Ct.toString()),new ws(it,pt.toString(),It.length===0?null:It,null)}static decodeAsciiSegment(it,ct,pt){let Ct=!1;do{let It=it.readBits(8);if(It===0)throw new or;if(It<=128)return Ct&&(It+=128),ct.append(String.fromCharCode(It-1)),Vo.ASCII_ENCODE;if(It===129)return Vo.PAD_ENCODE;if(It<=229){const Dt=It-130;Dt<10&&ct.append("0"),ct.append(""+Dt)}else switch(It){case 230:return Vo.C40_ENCODE;case 231:return Vo.BASE256_ENCODE;case 232:ct.append("");break;case 233:case 234:break;case 235:Ct=!0;break;case 236:ct.append("[)>05"),pt.insert(0,"");break;case 237:ct.append("[)>06"),pt.insert(0,"");break;case 238:return Vo.ANSIX12_ENCODE;case 239:return Vo.TEXT_ENCODE;case 240:return Vo.EDIFACT_ENCODE;case 241:break;default:if(It!==254||it.available()!==0)throw new or;break}}while(it.available()>0);return Vo.ASCII_ENCODE}static decodeC40Segment(it,ct){let pt=!1;const Ct=[];let It=0;do{if(it.available()===8)return;const Dt=it.readBits(8);if(Dt===254)return;this.parseTwoBytes(Dt,it.readBits(8),Ct);for(let qt=0;qt<3;qt++){const Jt=Ct[qt];switch(It){case 0:if(Jt<3)It=Jt+1;else if(Jt<this.C40_BASIC_SET_CHARS.length){const ar=this.C40_BASIC_SET_CHARS[Jt];pt?(ct.append(String.fromCharCode(ar.charCodeAt(0)+128)),pt=!1):ct.append(ar)}else throw new or;break;case 1:pt?(ct.append(String.fromCharCode(Jt+128)),pt=!1):ct.append(String.fromCharCode(Jt)),It=0;break;case 2:if(Jt<this.C40_SHIFT2_SET_CHARS.length){const ar=this.C40_SHIFT2_SET_CHARS[Jt];pt?(ct.append(String.fromCharCode(ar.charCodeAt(0)+128)),pt=!1):ct.append(ar)}else switch(Jt){case 27:ct.append("");break;case 30:pt=!0;break;default:throw new or}It=0;break;case 3:pt?(ct.append(String.fromCharCode(Jt+224)),pt=!1):ct.append(String.fromCharCode(Jt+96)),It=0;break;default:throw new or}}}while(it.available()>0)}static decodeTextSegment(it,ct){let pt=!1,Ct=[],It=0;do{if(it.available()===8)return;const Dt=it.readBits(8);if(Dt===254)return;this.parseTwoBytes(Dt,it.readBits(8),Ct);for(let qt=0;qt<3;qt++){const Jt=Ct[qt];switch(It){case 0:if(Jt<3)It=Jt+1;else if(Jt<this.TEXT_BASIC_SET_CHARS.length){const ar=this.TEXT_BASIC_SET_CHARS[Jt];pt?(ct.append(String.fromCharCode(ar.charCodeAt(0)+128)),pt=!1):ct.append(ar)}else throw new or;break;case 1:pt?(ct.append(String.fromCharCode(Jt+128)),pt=!1):ct.append(String.fromCharCode(Jt)),It=0;break;case 2:if(Jt<this.TEXT_SHIFT2_SET_CHARS.length){const ar=this.TEXT_SHIFT2_SET_CHARS[Jt];pt?(ct.append(String.fromCharCode(ar.charCodeAt(0)+128)),pt=!1):ct.append(ar)}else switch(Jt){case 27:ct.append("");break;case 30:pt=!0;break;default:throw new or}It=0;break;case 3:if(Jt<this.TEXT_SHIFT3_SET_CHARS.length){const ar=this.TEXT_SHIFT3_SET_CHARS[Jt];pt?(ct.append(String.fromCharCode(ar.charCodeAt(0)+128)),pt=!1):ct.append(ar),It=0}else throw new or;break;default:throw new or}}}while(it.available()>0)}static decodeAnsiX12Segment(it,ct){const pt=[];do{if(it.available()===8)return;const Ct=it.readBits(8);if(Ct===254)return;this.parseTwoBytes(Ct,it.readBits(8),pt);for(let It=0;It<3;It++){const Dt=pt[It];switch(Dt){case 0:ct.append("\r");break;case 1:ct.append("*");break;case 2:ct.append(">");break;case 3:ct.append(" ");break;default:if(Dt<14)ct.append(String.fromCharCode(Dt+44));else if(Dt<40)ct.append(String.fromCharCode(Dt+51));else throw new or;break}}}while(it.available()>0)}static parseTwoBytes(it,ct,pt){let Ct=(it<<8)+ct-1,It=Math.floor(Ct/1600);pt[0]=It,Ct-=It*1600,It=Math.floor(Ct/40),pt[1]=It,pt[2]=Ct-It*40}static decodeEdifactSegment(it,ct){do{if(it.available()<=16)return;for(let pt=0;pt<4;pt++){let Ct=it.readBits(6);if(Ct===31){const It=8-it.getBitOffset();It!==8&&it.readBits(It);return}Ct&32||(Ct|=64),ct.append(String.fromCharCode(Ct))}}while(it.available()>0)}static decodeBase256Segment(it,ct,pt){let Ct=1+it.getByteOffset();const It=this.unrandomize255State(it.readBits(8),Ct++);let Dt;if(It===0?Dt=it.available()/8|0:It<250?Dt=It:Dt=250*(It-249)+this.unrandomize255State(it.readBits(8),Ct++),Dt<0)throw new or;const qt=new Uint8Array(Dt);for(let Jt=0;Jt<Dt;Jt++){if(it.available()<8)throw new or;qt[Jt]=this.unrandomize255State(it.readBits(8),Ct++)}pt.push(qt);try{ct.append(un.decode(qt,jr.ISO88591))}catch(Jt){throw new Es("Platform does not support required encoding: "+Jt.message)}}static unrandomize255State(it,ct){const pt=149*ct%255+1,Ct=it-pt;return Ct>=0?Ct:Ct+256}}Do.C40_BASIC_SET_CHARS=["*","*","*"," ","0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],Do.C40_SHIFT2_SET_CHARS=["!",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","@","[","\\","]","^","_"],Do.TEXT_BASIC_SET_CHARS=["*","*","*"," ","0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],Do.TEXT_SHIFT2_SET_CHARS=Do.C40_SHIFT2_SET_CHARS,Do.TEXT_SHIFT3_SET_CHARS=["`","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","{","|","}","~",""];class Iu{constructor(){this.rsDecoder=new po(ys.DATA_MATRIX_FIELD_256)}decode(it){const ct=new uu(it),pt=ct.getVersion(),Ct=ct.readCodewords(),It=na.getDataBlocks(Ct,pt);let Dt=0;for(let ar of It)Dt+=ar.getNumDataCodewords();const qt=new Uint8Array(Dt),Jt=It.length;for(let ar=0;ar<Jt;ar++){const Er=It[ar],Pr=Er.getCodewords(),Gr=Er.getNumDataCodewords();this.correctErrors(Pr,Gr);for(let pn=0;pn<Gr;pn++)qt[pn*Jt+ar]=Pr[pn]}return Do.decode(qt)}correctErrors(it,ct){const pt=new Int32Array(it);try{this.rsDecoder.decode(pt,it.length-ct)}catch{throw new Pt}for(let Ct=0;Ct<ct;Ct++)it[Ct]=pt[Ct]}}class Jl{constructor(it){this.image=it,this.rectangleDetector=new ga(this.image)}detect(){const it=this.rectangleDetector.detect();let ct=this.detectSolid1(it);if(ct=this.detectSolid2(ct),ct[3]=this.correctTopRight(ct),!ct[3])throw new Fr;ct=this.shiftToModuleCenter(ct);const pt=ct[0],Ct=ct[1],It=ct[2],Dt=ct[3];let qt=this.transitionsBetween(pt,Dt)+1,Jt=this.transitionsBetween(It,Dt)+1;(qt&1)===1&&(qt+=1),(Jt&1)===1&&(Jt+=1),4*qt<7*Jt&&4*Jt<7*qt&&(qt=Jt=Math.max(qt,Jt));let ar=Jl.sampleGrid(this.image,pt,Ct,It,Dt,qt,Jt);return new Ul(ar,[pt,Ct,It,Dt])}static shiftPoint(it,ct,pt){let Ct=(ct.getX()-it.getX())/(pt+1),It=(ct.getY()-it.getY())/(pt+1);return new Ss(it.getX()+Ct,it.getY()+It)}static moveAway(it,ct,pt){let Ct=it.getX(),It=it.getY();return Ct<ct?Ct-=1:Ct+=1,It<pt?It-=1:It+=1,new Ss(Ct,It)}detectSolid1(it){let ct=it[0],pt=it[1],Ct=it[3],It=it[2],Dt=this.transitionsBetween(ct,pt),qt=this.transitionsBetween(pt,Ct),Jt=this.transitionsBetween(Ct,It),ar=this.transitionsBetween(It,ct),Er=Dt,Pr=[It,ct,pt,Ct];return Er>qt&&(Er=qt,Pr[0]=ct,Pr[1]=pt,Pr[2]=Ct,Pr[3]=It),Er>Jt&&(Er=Jt,Pr[0]=pt,Pr[1]=Ct,Pr[2]=It,Pr[3]=ct),Er>ar&&(Pr[0]=Ct,Pr[1]=It,Pr[2]=ct,Pr[3]=pt),Pr}detectSolid2(it){let ct=it[0],pt=it[1],Ct=it[2],It=it[3],Dt=this.transitionsBetween(ct,It),qt=Jl.shiftPoint(pt,Ct,(Dt+1)*4),Jt=Jl.shiftPoint(Ct,pt,(Dt+1)*4),ar=this.transitionsBetween(qt,ct),Er=this.transitionsBetween(Jt,It);return ar<Er?(it[0]=ct,it[1]=pt,it[2]=Ct,it[3]=It):(it[0]=pt,it[1]=Ct,it[2]=It,it[3]=ct),it}correctTopRight(it){let ct=it[0],pt=it[1],Ct=it[2],It=it[3],Dt=this.transitionsBetween(ct,It),qt=this.transitionsBetween(pt,It),Jt=Jl.shiftPoint(ct,pt,(qt+1)*4),ar=Jl.shiftPoint(Ct,pt,(Dt+1)*4);Dt=this.transitionsBetween(Jt,It),qt=this.transitionsBetween(ar,It);let Er=new Ss(It.getX()+(Ct.getX()-pt.getX())/(Dt+1),It.getY()+(Ct.getY()-pt.getY())/(Dt+1)),Pr=new Ss(It.getX()+(ct.getX()-pt.getX())/(qt+1),It.getY()+(ct.getY()-pt.getY())/(qt+1));if(!this.isValid(Er))return this.isValid(Pr)?Pr:null;if(!this.isValid(Pr))return Er;let Gr=this.transitionsBetween(Jt,Er)+this.transitionsBetween(ar,Er),pn=this.transitionsBetween(Jt,Pr)+this.transitionsBetween(ar,Pr);return Gr>pn?Er:Pr}shiftToModuleCenter(it){let ct=it[0],pt=it[1],Ct=it[2],It=it[3],Dt=this.transitionsBetween(ct,It)+1,qt=this.transitionsBetween(Ct,It)+1,Jt=Jl.shiftPoint(ct,pt,qt*4),ar=Jl.shiftPoint(Ct,pt,Dt*4);Dt=this.transitionsBetween(Jt,It)+1,qt=this.transitionsBetween(ar,It)+1,(Dt&1)===1&&(Dt+=1),(qt&1)===1&&(qt+=1);let Er=(ct.getX()+pt.getX()+Ct.getX()+It.getX())/4,Pr=(ct.getY()+pt.getY()+Ct.getY()+It.getY())/4;ct=Jl.moveAway(ct,Er,Pr),pt=Jl.moveAway(pt,Er,Pr),Ct=Jl.moveAway(Ct,Er,Pr),It=Jl.moveAway(It,Er,Pr);let Gr,pn;return Jt=Jl.shiftPoint(ct,pt,qt*4),Jt=Jl.shiftPoint(Jt,It,Dt*4),Gr=Jl.shiftPoint(pt,ct,qt*4),Gr=Jl.shiftPoint(Gr,Ct,Dt*4),ar=Jl.shiftPoint(Ct,It,qt*4),ar=Jl.shiftPoint(ar,pt,Dt*4),pn=Jl.shiftPoint(It,Ct,qt*4),pn=Jl.shiftPoint(pn,ct,Dt*4),[Jt,Gr,ar,pn]}isValid(it){return it.getX()>=0&&it.getX()<this.image.getWidth()&&it.getY()>0&&it.getY()<this.image.getHeight()}static sampleGrid(it,ct,pt,Ct,It,Dt,qt){return Ds.getInstance().sampleGrid(it,Dt,qt,.5,.5,Dt-.5,.5,Dt-.5,qt-.5,.5,qt-.5,ct.getX(),ct.getY(),It.getX(),It.getY(),Ct.getX(),Ct.getY(),pt.getX(),pt.getY())}transitionsBetween(it,ct){let pt=Math.trunc(it.getX()),Ct=Math.trunc(it.getY()),It=Math.trunc(ct.getX()),Dt=Math.trunc(ct.getY()),qt=Math.abs(Dt-Ct)>Math.abs(It-pt);if(qt){let Pn=pt;pt=Ct,Ct=Pn,Pn=It,It=Dt,Dt=Pn}let Jt=Math.abs(It-pt),ar=Math.abs(Dt-Ct),Er=-Jt/2,Pr=Ct<Dt?1:-1,Gr=pt<It?1:-1,pn=0,An=this.image.get(qt?Ct:pt,qt?pt:Ct);for(let Pn=pt,Xn=Ct;Pn!==It;Pn+=Gr){let os=this.image.get(qt?Xn:Pn,qt?Pn:Xn);if(os!==An&&(pn++,An=os),Er+=ar,Er>0){if(Xn===Dt)break;Xn+=Pr,Er-=Jt}}return pn}}class qu{constructor(){this.decoder=new Iu}decode(it,ct=null){let pt,Ct;if(ct!=null&&ct.has(ir.PURE_BARCODE)){const ar=qu.extractPureBits(it.getBlackMatrix());pt=this.decoder.decode(ar),Ct=qu.NO_POINTS}else{const ar=new Jl(it.getBlackMatrix()).detect();pt=this.decoder.decode(ar.getBits()),Ct=ar.getPoints()}const It=pt.getRawBytes(),Dt=new Sn(pt.getText(),It,8*It.length,Ct,rs.DATA_MATRIX,Bt.currentTimeMillis()),qt=pt.getByteSegments();qt!=null&&Dt.putMetadata(On.BYTE_SEGMENTS,qt);const Jt=pt.getECLevel();return Jt!=null&&Dt.putMetadata(On.ERROR_CORRECTION_LEVEL,Jt),Dt}reset(){}static extractPureBits(it){const ct=it.getTopLeftOnBit(),pt=it.getBottomRightOnBit();if(ct==null||pt==null)throw new Fr;const Ct=this.moduleSize(ct,it);let It=ct[1];const Dt=pt[1];let qt=ct[0];const ar=(pt[0]-qt+1)/Ct,Er=(Dt-It+1)/Ct;if(ar<=0||Er<=0)throw new Fr;const Pr=Ct/2;It+=Pr,qt+=Pr;const Gr=new fn(ar,Er);for(let pn=0;pn<Er;pn++){const An=It+pn*Ct;for(let Pn=0;Pn<ar;Pn++)it.get(qt+Pn*Ct,An)&&Gr.set(Pn,pn)}return Gr}static moduleSize(it,ct){const pt=ct.getWidth();let Ct=it[0];const It=it[1];for(;Ct<pt&&ct.get(Ct,It);)Ct++;if(Ct===pt)throw new Fr;const Dt=Ct-it[0];if(Dt===0)throw new Fr;return Dt}}qu.NO_POINTS=[];class Ip extends gn{constructor(it=500){super(new qu,it)}}var Xp;(function(wr){wr[wr.L=0]="L",wr[wr.M=1]="M",wr[wr.Q=2]="Q",wr[wr.H=3]="H"})(Xp||(Xp={}));class Il{constructor(it,ct,pt){this.value=it,this.stringValue=ct,this.bits=pt,Il.FOR_BITS.set(pt,this),Il.FOR_VALUE.set(it,this)}getValue(){return this.value}getBits(){return this.bits}static fromString(it){switch(it){case"L":return Il.L;case"M":return Il.M;case"Q":return Il.Q;case"H":return Il.H;default:throw new Et(it+"not available")}}toString(){return this.stringValue}equals(it){if(!(it instanceof Il))return!1;const ct=it;return this.value===ct.value}static forBits(it){if(it<0||it>=Il.FOR_BITS.size)throw new St;return Il.FOR_BITS.get(it)}}Il.FOR_BITS=new Map,Il.FOR_VALUE=new Map,Il.L=new Il(Xp.L,"L",1),Il.M=new Il(Xp.M,"M",0),Il.Q=new Il(Xp.Q,"Q",3),Il.H=new Il(Xp.H,"H",2);class Mu{constructor(it){this.errorCorrectionLevel=Il.forBits(it>>3&3),this.dataMask=it&7}static numBitsDiffering(it,ct){return Nt.bitCount(it^ct)}static decodeFormatInformation(it,ct){const pt=Mu.doDecodeFormatInformation(it,ct);return pt!==null?pt:Mu.doDecodeFormatInformation(it^Mu.FORMAT_INFO_MASK_QR,ct^Mu.FORMAT_INFO_MASK_QR)}static doDecodeFormatInformation(it,ct){let pt=Number.MAX_SAFE_INTEGER,Ct=0;for(const It of Mu.FORMAT_INFO_DECODE_LOOKUP){const Dt=It[0];if(Dt===it||Dt===ct)return new Mu(It[1]);let qt=Mu.numBitsDiffering(it,Dt);qt<pt&&(Ct=It[1],pt=qt),it!==ct&&(qt=Mu.numBitsDiffering(ct,Dt),qt<pt&&(Ct=It[1],pt=qt))}return pt<=3?new Mu(Ct):null}getErrorCorrectionLevel(){return this.errorCorrectionLevel}getDataMask(){return this.dataMask}hashCode(){return this.errorCorrectionLevel.getBits()<<3|this.dataMask}equals(it){if(!(it instanceof Mu))return!1;const ct=it;return this.errorCorrectionLevel===ct.errorCorrectionLevel&&this.dataMask===ct.dataMask}}Mu.FORMAT_INFO_MASK_QR=21522,Mu.FORMAT_INFO_DECODE_LOOKUP=[Int32Array.from([21522,0]),Int32Array.from([20773,1]),Int32Array.from([24188,2]),Int32Array.from([23371,3]),Int32Array.from([17913,4]),Int32Array.from([16590,5]),Int32Array.from([20375,6]),Int32Array.from([19104,7]),Int32Array.from([30660,8]),Int32Array.from([29427,9]),Int32Array.from([32170,10]),Int32Array.from([30877,11]),Int32Array.from([26159,12]),Int32Array.from([25368,13]),Int32Array.from([27713,14]),Int32Array.from([26998,15]),Int32Array.from([5769,16]),Int32Array.from([5054,17]),Int32Array.from([7399,18]),Int32Array.from([6608,19]),Int32Array.from([1890,20]),Int32Array.from([597,21]),Int32Array.from([3340,22]),Int32Array.from([2107,23]),Int32Array.from([13663,24]),Int32Array.from([12392,25]),Int32Array.from([16177,26]),Int32Array.from([14854,27]),Int32Array.from([9396,28]),Int32Array.from([8579,29]),Int32Array.from([11994,30]),Int32Array.from([11245,31])];class Un{constructor(it,...ct){this.ecCodewordsPerBlock=it,this.ecBlocks=ct}getECCodewordsPerBlock(){return this.ecCodewordsPerBlock}getNumBlocks(){let it=0;const ct=this.ecBlocks;for(const pt of ct)it+=pt.getCount();return it}getTotalECCodewords(){return this.ecCodewordsPerBlock*this.getNumBlocks()}getECBlocks(){return this.ecBlocks}}class nn{constructor(it,ct){this.count=it,this.dataCodewords=ct}getCount(){return this.count}getDataCodewords(){return this.dataCodewords}}class uo{constructor(it,ct,...pt){this.versionNumber=it,this.alignmentPatternCenters=ct,this.ecBlocks=pt;let Ct=0;const It=pt[0].getECCodewordsPerBlock(),Dt=pt[0].getECBlocks();for(const qt of Dt)Ct+=qt.getCount()*(qt.getDataCodewords()+It);this.totalCodewords=Ct}getVersionNumber(){return this.versionNumber}getAlignmentPatternCenters(){return this.alignmentPatternCenters}getTotalCodewords(){return this.totalCodewords}getDimensionForVersion(){return 17+4*this.versionNumber}getECBlocksForLevel(it){return this.ecBlocks[it.getValue()]}static getProvisionalVersionForDimension(it){if(it%4!==1)throw new or;try{return this.getVersionForNumber((it-17)/4)}catch{throw new or}}static getVersionForNumber(it){if(it<1||it>40)throw new St;return uo.VERSIONS[it-1]}static decodeVersionInformation(it){let ct=Number.MAX_SAFE_INTEGER,pt=0;for(let Ct=0;Ct<uo.VERSION_DECODE_INFO.length;Ct++){const It=uo.VERSION_DECODE_INFO[Ct];if(It===it)return uo.getVersionForNumber(Ct+7);const Dt=Mu.numBitsDiffering(it,It);Dt<ct&&(pt=Ct+7,ct=Dt)}return ct<=3?uo.getVersionForNumber(pt):null}buildFunctionPattern(){const it=this.getDimensionForVersion(),ct=new fn(it);ct.setRegion(0,0,9,9),ct.setRegion(it-8,0,8,9),ct.setRegion(0,it-8,9,8);const pt=this.alignmentPatternCenters.length;for(let Ct=0;Ct<pt;Ct++){const It=this.alignmentPatternCenters[Ct]-2;for(let Dt=0;Dt<pt;Dt++)Ct===0&&(Dt===0||Dt===pt-1)||Ct===pt-1&&Dt===0||ct.setRegion(this.alignmentPatternCenters[Dt]-2,It,5,5)}return ct.setRegion(6,9,1,it-17),ct.setRegion(9,6,it-17,1),this.versionNumber>6&&(ct.setRegion(it-11,0,3,6),ct.setRegion(0,it-11,6,3)),ct}toString(){return""+this.versionNumber}}uo.VERSION_DECODE_INFO=Int32Array.from([31892,34236,39577,42195,48118,51042,55367,58893,63784,68472,70749,76311,79154,84390,87683,92361,96236,102084,102881,110507,110734,117786,119615,126325,127568,133589,136944,141498,145311,150283,152622,158308,161089,167017]),uo.VERSIONS=[new uo(1,new Int32Array(0),new Un(7,new nn(1,19)),new Un(10,new nn(1,16)),new Un(13,new nn(1,13)),new Un(17,new nn(1,9))),new uo(2,Int32Array.from([6,18]),new Un(10,new nn(1,34)),new Un(16,new nn(1,28)),new Un(22,new nn(1,22)),new Un(28,new nn(1,16))),new uo(3,Int32Array.from([6,22]),new Un(15,new nn(1,55)),new Un(26,new nn(1,44)),new Un(18,new nn(2,17)),new Un(22,new nn(2,13))),new uo(4,Int32Array.from([6,26]),new Un(20,new nn(1,80)),new Un(18,new nn(2,32)),new Un(26,new nn(2,24)),new Un(16,new nn(4,9))),new uo(5,Int32Array.from([6,30]),new Un(26,new nn(1,108)),new Un(24,new nn(2,43)),new Un(18,new nn(2,15),new nn(2,16)),new Un(22,new nn(2,11),new nn(2,12))),new uo(6,Int32Array.from([6,34]),new Un(18,new nn(2,68)),new Un(16,new nn(4,27)),new Un(24,new nn(4,19)),new Un(28,new nn(4,15))),new uo(7,Int32Array.from([6,22,38]),new Un(20,new nn(2,78)),new Un(18,new nn(4,31)),new Un(18,new nn(2,14),new nn(4,15)),new Un(26,new nn(4,13),new nn(1,14))),new uo(8,Int32Array.from([6,24,42]),new Un(24,new nn(2,97)),new Un(22,new nn(2,38),new nn(2,39)),new Un(22,new nn(4,18),new nn(2,19)),new Un(26,new nn(4,14),new nn(2,15))),new uo(9,Int32Array.from([6,26,46]),new Un(30,new nn(2,116)),new Un(22,new nn(3,36),new nn(2,37)),new Un(20,new nn(4,16),new nn(4,17)),new Un(24,new nn(4,12),new nn(4,13))),new uo(10,Int32Array.from([6,28,50]),new Un(18,new nn(2,68),new nn(2,69)),new Un(26,new nn(4,43),new nn(1,44)),new Un(24,new nn(6,19),new nn(2,20)),new Un(28,new nn(6,15),new nn(2,16))),new uo(11,Int32Array.from([6,30,54]),new Un(20,new nn(4,81)),new Un(30,new nn(1,50),new nn(4,51)),new Un(28,new nn(4,22),new nn(4,23)),new Un(24,new nn(3,12),new nn(8,13))),new uo(12,Int32Array.from([6,32,58]),new Un(24,new nn(2,92),new nn(2,93)),new Un(22,new nn(6,36),new nn(2,37)),new Un(26,new nn(4,20),new nn(6,21)),new Un(28,new nn(7,14),new nn(4,15))),new uo(13,Int32Array.from([6,34,62]),new Un(26,new nn(4,107)),new Un(22,new nn(8,37),new nn(1,38)),new Un(24,new nn(8,20),new nn(4,21)),new Un(22,new nn(12,11),new nn(4,12))),new uo(14,Int32Array.from([6,26,46,66]),new Un(30,new nn(3,115),new nn(1,116)),new Un(24,new nn(4,40),new nn(5,41)),new Un(20,new nn(11,16),new nn(5,17)),new Un(24,new nn(11,12),new nn(5,13))),new uo(15,Int32Array.from([6,26,48,70]),new Un(22,new nn(5,87),new nn(1,88)),new Un(24,new nn(5,41),new nn(5,42)),new Un(30,new nn(5,24),new nn(7,25)),new Un(24,new nn(11,12),new nn(7,13))),new uo(16,Int32Array.from([6,26,50,74]),new Un(24,new nn(5,98),new nn(1,99)),new Un(28,new nn(7,45),new nn(3,46)),new Un(24,new nn(15,19),new nn(2,20)),new Un(30,new nn(3,15),new nn(13,16))),new uo(17,Int32Array.from([6,30,54,78]),new Un(28,new nn(1,107),new nn(5,108)),new Un(28,new nn(10,46),new nn(1,47)),new Un(28,new nn(1,22),new nn(15,23)),new Un(28,new nn(2,14),new nn(17,15))),new uo(18,Int32Array.from([6,30,56,82]),new Un(30,new nn(5,120),new nn(1,121)),new Un(26,new nn(9,43),new nn(4,44)),new Un(28,new nn(17,22),new nn(1,23)),new Un(28,new nn(2,14),new nn(19,15))),new uo(19,Int32Array.from([6,30,58,86]),new Un(28,new nn(3,113),new nn(4,114)),new Un(26,new nn(3,44),new nn(11,45)),new Un(26,new nn(17,21),new nn(4,22)),new Un(26,new nn(9,13),new nn(16,14))),new uo(20,Int32Array.from([6,34,62,90]),new Un(28,new nn(3,107),new nn(5,108)),new Un(26,new nn(3,41),new nn(13,42)),new Un(30,new nn(15,24),new nn(5,25)),new Un(28,new nn(15,15),new nn(10,16))),new uo(21,Int32Array.from([6,28,50,72,94]),new Un(28,new nn(4,116),new nn(4,117)),new Un(26,new nn(17,42)),new Un(28,new nn(17,22),new nn(6,23)),new Un(30,new nn(19,16),new nn(6,17))),new uo(22,Int32Array.from([6,26,50,74,98]),new Un(28,new nn(2,111),new nn(7,112)),new Un(28,new nn(17,46)),new Un(30,new nn(7,24),new nn(16,25)),new Un(24,new nn(34,13))),new uo(23,Int32Array.from([6,30,54,78,102]),new Un(30,new nn(4,121),new nn(5,122)),new Un(28,new nn(4,47),new nn(14,48)),new Un(30,new nn(11,24),new nn(14,25)),new Un(30,new nn(16,15),new nn(14,16))),new uo(24,Int32Array.from([6,28,54,80,106]),new Un(30,new nn(6,117),new nn(4,118)),new Un(28,new nn(6,45),new nn(14,46)),new Un(30,new nn(11,24),new nn(16,25)),new Un(30,new nn(30,16),new nn(2,17))),new uo(25,Int32Array.from([6,32,58,84,110]),new Un(26,new nn(8,106),new nn(4,107)),new Un(28,new nn(8,47),new nn(13,48)),new Un(30,new nn(7,24),new nn(22,25)),new Un(30,new nn(22,15),new nn(13,16))),new uo(26,Int32Array.from([6,30,58,86,114]),new Un(28,new nn(10,114),new nn(2,115)),new Un(28,new nn(19,46),new nn(4,47)),new Un(28,new nn(28,22),new nn(6,23)),new Un(30,new nn(33,16),new nn(4,17))),new uo(27,Int32Array.from([6,34,62,90,118]),new Un(30,new nn(8,122),new nn(4,123)),new Un(28,new nn(22,45),new nn(3,46)),new Un(30,new nn(8,23),new nn(26,24)),new Un(30,new nn(12,15),new nn(28,16))),new uo(28,Int32Array.from([6,26,50,74,98,122]),new Un(30,new nn(3,117),new nn(10,118)),new Un(28,new nn(3,45),new nn(23,46)),new Un(30,new nn(4,24),new nn(31,25)),new Un(30,new nn(11,15),new nn(31,16))),new uo(29,Int32Array.from([6,30,54,78,102,126]),new Un(30,new nn(7,116),new nn(7,117)),new Un(28,new nn(21,45),new nn(7,46)),new Un(30,new nn(1,23),new nn(37,24)),new Un(30,new nn(19,15),new nn(26,16))),new uo(30,Int32Array.from([6,26,52,78,104,130]),new Un(30,new nn(5,115),new nn(10,116)),new Un(28,new nn(19,47),new nn(10,48)),new Un(30,new nn(15,24),new nn(25,25)),new Un(30,new nn(23,15),new nn(25,16))),new uo(31,Int32Array.from([6,30,56,82,108,134]),new Un(30,new nn(13,115),new nn(3,116)),new Un(28,new nn(2,46),new nn(29,47)),new Un(30,new nn(42,24),new nn(1,25)),new Un(30,new nn(23,15),new nn(28,16))),new uo(32,Int32Array.from([6,34,60,86,112,138]),new Un(30,new nn(17,115)),new Un(28,new nn(10,46),new nn(23,47)),new Un(30,new nn(10,24),new nn(35,25)),new Un(30,new nn(19,15),new nn(35,16))),new uo(33,Int32Array.from([6,30,58,86,114,142]),new Un(30,new nn(17,115),new nn(1,116)),new Un(28,new nn(14,46),new nn(21,47)),new Un(30,new nn(29,24),new nn(19,25)),new Un(30,new nn(11,15),new nn(46,16))),new uo(34,Int32Array.from([6,34,62,90,118,146]),new Un(30,new nn(13,115),new nn(6,116)),new Un(28,new nn(14,46),new nn(23,47)),new Un(30,new nn(44,24),new nn(7,25)),new Un(30,new nn(59,16),new nn(1,17))),new uo(35,Int32Array.from([6,30,54,78,102,126,150]),new Un(30,new nn(12,121),new nn(7,122)),new Un(28,new nn(12,47),new nn(26,48)),new Un(30,new nn(39,24),new nn(14,25)),new Un(30,new nn(22,15),new nn(41,16))),new uo(36,Int32Array.from([6,24,50,76,102,128,154]),new Un(30,new nn(6,121),new nn(14,122)),new Un(28,new nn(6,47),new nn(34,48)),new Un(30,new nn(46,24),new nn(10,25)),new Un(30,new nn(2,15),new nn(64,16))),new uo(37,Int32Array.from([6,28,54,80,106,132,158]),new Un(30,new nn(17,122),new nn(4,123)),new Un(28,new nn(29,46),new nn(14,47)),new Un(30,new nn(49,24),new nn(10,25)),new Un(30,new nn(24,15),new nn(46,16))),new uo(38,Int32Array.from([6,32,58,84,110,136,162]),new Un(30,new nn(4,122),new nn(18,123)),new Un(28,new nn(13,46),new nn(32,47)),new Un(30,new nn(48,24),new nn(14,25)),new Un(30,new nn(42,15),new nn(32,16))),new uo(39,Int32Array.from([6,26,54,82,110,138,166]),new Un(30,new nn(20,117),new nn(4,118)),new Un(28,new nn(40,47),new nn(7,48)),new Un(30,new nn(43,24),new nn(22,25)),new Un(30,new nn(10,15),new nn(67,16))),new uo(40,Int32Array.from([6,30,58,86,114,142,170]),new Un(30,new nn(19,118),new nn(6,119)),new Un(28,new nn(18,47),new nn(31,48)),new Un(30,new nn(34,24),new nn(34,25)),new Un(30,new nn(20,15),new nn(61,16)))];var Zu;(function(wr){wr[wr.DATA_MASK_000=0]="DATA_MASK_000",wr[wr.DATA_MASK_001=1]="DATA_MASK_001",wr[wr.DATA_MASK_010=2]="DATA_MASK_010",wr[wr.DATA_MASK_011=3]="DATA_MASK_011",wr[wr.DATA_MASK_100=4]="DATA_MASK_100",wr[wr.DATA_MASK_101=5]="DATA_MASK_101",wr[wr.DATA_MASK_110=6]="DATA_MASK_110",wr[wr.DATA_MASK_111=7]="DATA_MASK_111"})(Zu||(Zu={}));class yp{constructor(it,ct){this.value=it,this.isMasked=ct}unmaskBitMatrix(it,ct){for(let pt=0;pt<ct;pt++)for(let Ct=0;Ct<ct;Ct++)this.isMasked(pt,Ct)&&it.flip(Ct,pt)}}yp.values=new Map([[Zu.DATA_MASK_000,new yp(Zu.DATA_MASK_000,(wr,it)=>(wr+it&1)===0)],[Zu.DATA_MASK_001,new yp(Zu.DATA_MASK_001,(wr,it)=>(wr&1)===0)],[Zu.DATA_MASK_010,new yp(Zu.DATA_MASK_010,(wr,it)=>it%3===0)],[Zu.DATA_MASK_011,new yp(Zu.DATA_MASK_011,(wr,it)=>(wr+it)%3===0)],[Zu.DATA_MASK_100,new yp(Zu.DATA_MASK_100,(wr,it)=>(Math.floor(wr/2)+Math.floor(it/3)&1)===0)],[Zu.DATA_MASK_101,new yp(Zu.DATA_MASK_101,(wr,it)=>wr*it%6===0)],[Zu.DATA_MASK_110,new yp(Zu.DATA_MASK_110,(wr,it)=>wr*it%6<3)],[Zu.DATA_MASK_111,new yp(Zu.DATA_MASK_111,(wr,it)=>(wr+it+wr*it%3&1)===0)]]);class bx{constructor(it){const ct=it.getHeight();if(ct<21||(ct&3)!==1)throw new or;this.bitMatrix=it}readFormatInformation(){if(this.parsedFormatInfo!==null&&this.parsedFormatInfo!==void 0)return this.parsedFormatInfo;let it=0;for(let It=0;It<6;It++)it=this.copyBit(It,8,it);it=this.copyBit(7,8,it),it=this.copyBit(8,8,it),it=this.copyBit(8,7,it);for(let It=5;It>=0;It--)it=this.copyBit(8,It,it);const ct=this.bitMatrix.getHeight();let pt=0;const Ct=ct-7;for(let It=ct-1;It>=Ct;It--)pt=this.copyBit(8,It,pt);for(let It=ct-8;It<ct;It++)pt=this.copyBit(It,8,pt);if(this.parsedFormatInfo=Mu.decodeFormatInformation(it,pt),this.parsedFormatInfo!==null)return this.parsedFormatInfo;throw new or}readVersion(){if(this.parsedVersion!==null&&this.parsedVersion!==void 0)return this.parsedVersion;const it=this.bitMatrix.getHeight(),ct=Math.floor((it-17)/4);if(ct<=6)return uo.getVersionForNumber(ct);let pt=0;const Ct=it-11;for(let Dt=5;Dt>=0;Dt--)for(let qt=it-9;qt>=Ct;qt--)pt=this.copyBit(qt,Dt,pt);let It=uo.decodeVersionInformation(pt);if(It!==null&&It.getDimensionForVersion()===it)return this.parsedVersion=It,It;pt=0;for(let Dt=5;Dt>=0;Dt--)for(let qt=it-9;qt>=Ct;qt--)pt=this.copyBit(Dt,qt,pt);if(It=uo.decodeVersionInformation(pt),It!==null&&It.getDimensionForVersion()===it)return this.parsedVersion=It,It;throw new or}copyBit(it,ct,pt){return(this.isMirror?this.bitMatrix.get(ct,it):this.bitMatrix.get(it,ct))?pt<<1|1:pt<<1}readCodewords(){const it=this.readFormatInformation(),ct=this.readVersion(),pt=yp.values.get(it.getDataMask()),Ct=this.bitMatrix.getHeight();pt.unmaskBitMatrix(this.bitMatrix,Ct);const It=ct.buildFunctionPattern();let Dt=!0;const qt=new Uint8Array(ct.getTotalCodewords());let Jt=0,ar=0,Er=0;for(let Pr=Ct-1;Pr>0;Pr-=2){Pr===6&&Pr--;for(let Gr=0;Gr<Ct;Gr++){const pn=Dt?Ct-1-Gr:Gr;for(let An=0;An<2;An++)It.get(Pr-An,pn)||(Er++,ar<<=1,this.bitMatrix.get(Pr-An,pn)&&(ar|=1),Er===8&&(qt[Jt++]=ar,Er=0,ar=0))}Dt=!Dt}if(Jt!==ct.getTotalCodewords())throw new or;return qt}remask(){if(this.parsedFormatInfo===null)return;const it=yp.values[this.parsedFormatInfo.getDataMask()],ct=this.bitMatrix.getHeight();it.unmaskBitMatrix(this.bitMatrix,ct)}setMirror(it){this.parsedVersion=null,this.parsedFormatInfo=null,this.isMirror=it}mirror(){const it=this.bitMatrix;for(let ct=0,pt=it.getWidth();ct<pt;ct++)for(let Ct=ct+1,It=it.getHeight();Ct<It;Ct++)it.get(ct,Ct)!==it.get(Ct,ct)&&(it.flip(Ct,ct),it.flip(ct,Ct))}}class Am{constructor(it,ct){this.numDataCodewords=it,this.codewords=ct}static getDataBlocks(it,ct,pt){if(it.length!==ct.getTotalCodewords())throw new St;const Ct=ct.getECBlocksForLevel(pt);let It=0;const Dt=Ct.getECBlocks();for(const An of Dt)It+=An.getCount();const qt=new Array(It);let Jt=0;for(const An of Dt)for(let Pn=0;Pn<An.getCount();Pn++){const Xn=An.getDataCodewords(),os=Ct.getECCodewordsPerBlock()+Xn;qt[Jt++]=new Am(Xn,new Uint8Array(os))}const ar=qt[0].codewords.length;let Er=qt.length-1;for(;Er>=0&&qt[Er].codewords.length!==ar;)Er--;Er++;const Pr=ar-Ct.getECCodewordsPerBlock();let Gr=0;for(let An=0;An<Pr;An++)for(let Pn=0;Pn<Jt;Pn++)qt[Pn].codewords[An]=it[Gr++];for(let An=Er;An<Jt;An++)qt[An].codewords[Pr]=it[Gr++];const pn=qt[0].codewords.length;for(let An=Pr;An<pn;An++)for(let Pn=0;Pn<Jt;Pn++){const Xn=Pn<Er?An:An+1;qt[Pn].codewords[Xn]=it[Gr++]}return qt}getNumDataCodewords(){return this.numDataCodewords}getCodewords(){return this.codewords}}var Dp;(function(wr){wr[wr.TERMINATOR=0]="TERMINATOR",wr[wr.NUMERIC=1]="NUMERIC",wr[wr.ALPHANUMERIC=2]="ALPHANUMERIC",wr[wr.STRUCTURED_APPEND=3]="STRUCTURED_APPEND",wr[wr.BYTE=4]="BYTE",wr[wr.ECI=5]="ECI",wr[wr.KANJI=6]="KANJI",wr[wr.FNC1_FIRST_POSITION=7]="FNC1_FIRST_POSITION",wr[wr.FNC1_SECOND_POSITION=8]="FNC1_SECOND_POSITION",wr[wr.HANZI=9]="HANZI"})(Dp||(Dp={}));class Uo{constructor(it,ct,pt,Ct){this.value=it,this.stringValue=ct,this.characterCountBitsForVersions=pt,this.bits=Ct,Uo.FOR_BITS.set(Ct,this),Uo.FOR_VALUE.set(it,this)}static forBits(it){const ct=Uo.FOR_BITS.get(it);if(ct===void 0)throw new St;return ct}getCharacterCountBits(it){const ct=it.getVersionNumber();let pt;return ct<=9?pt=0:ct<=26?pt=1:pt=2,this.characterCountBitsForVersions[pt]}getValue(){return this.value}getBits(){return this.bits}equals(it){if(!(it instanceof Uo))return!1;const ct=it;return this.value===ct.value}toString(){return this.stringValue}}Uo.FOR_BITS=new Map,Uo.FOR_VALUE=new Map,Uo.TERMINATOR=new Uo(Dp.TERMINATOR,"TERMINATOR",Int32Array.from([0,0,0]),0),Uo.NUMERIC=new Uo(Dp.NUMERIC,"NUMERIC",Int32Array.from([10,12,14]),1),Uo.ALPHANUMERIC=new Uo(Dp.ALPHANUMERIC,"ALPHANUMERIC",Int32Array.from([9,11,13]),2),Uo.STRUCTURED_APPEND=new Uo(Dp.STRUCTURED_APPEND,"STRUCTURED_APPEND",Int32Array.from([0,0,0]),3),Uo.BYTE=new Uo(Dp.BYTE,"BYTE",Int32Array.from([8,16,16]),4),Uo.ECI=new Uo(Dp.ECI,"ECI",Int32Array.from([0,0,0]),7),Uo.KANJI=new Uo(Dp.KANJI,"KANJI",Int32Array.from([8,10,12]),8),Uo.FNC1_FIRST_POSITION=new Uo(Dp.FNC1_FIRST_POSITION,"FNC1_FIRST_POSITION",Int32Array.from([0,0,0]),5),Uo.FNC1_SECOND_POSITION=new Uo(Dp.FNC1_SECOND_POSITION,"FNC1_SECOND_POSITION",Int32Array.from([0,0,0]),9),Uo.HANZI=new Uo(Dp.HANZI,"HANZI",Int32Array.from([8,10,12]),13);class _u{static decode(it,ct,pt,Ct){const It=new du(it);let Dt=new Jr;const qt=new Array;let Jt=-1,ar=-1;try{let Er=null,Pr=!1,Gr;do{if(It.available()<4)Gr=Uo.TERMINATOR;else{const pn=It.readBits(4);Gr=Uo.forBits(pn)}switch(Gr){case Uo.TERMINATOR:break;case Uo.FNC1_FIRST_POSITION:case Uo.FNC1_SECOND_POSITION:Pr=!0;break;case Uo.STRUCTURED_APPEND:if(It.available()<16)throw new or;Jt=It.readBits(8),ar=It.readBits(8);break;case Uo.ECI:const pn=_u.parseECIValue(It);if(Er=Rr.getCharacterSetECIByValue(pn),Er===null)throw new or;break;case Uo.HANZI:const An=It.readBits(4),Pn=It.readBits(Gr.getCharacterCountBits(ct));An===_u.GB2312_SUBSET&&_u.decodeHanziSegment(It,Dt,Pn);break;default:const Xn=It.readBits(Gr.getCharacterCountBits(ct));switch(Gr){case Uo.NUMERIC:_u.decodeNumericSegment(It,Dt,Xn);break;case Uo.ALPHANUMERIC:_u.decodeAlphanumericSegment(It,Dt,Xn,Pr);break;case Uo.BYTE:_u.decodeByteSegment(It,Dt,Xn,Er,qt,Ct);break;case Uo.KANJI:_u.decodeKanjiSegment(It,Dt,Xn);break;default:throw new or}break}}while(Gr!==Uo.TERMINATOR)}catch{throw new or}return new ws(it,Dt.toString(),qt.length===0?null:qt,pt===null?null:pt.toString(),Jt,ar)}static decodeHanziSegment(it,ct,pt){if(pt*13>it.available())throw new or;const Ct=new Uint8Array(2*pt);let It=0;for(;pt>0;){const Dt=it.readBits(13);let qt=Dt/96<<8&4294967295|Dt%96;qt<959?qt+=41377:qt+=42657,Ct[It]=qt>>8&255,Ct[It+1]=qt&255,It+=2,pt--}try{ct.append(un.decode(Ct,jr.GB2312))}catch(Dt){throw new or(Dt)}}static decodeKanjiSegment(it,ct,pt){if(pt*13>it.available())throw new or;const Ct=new Uint8Array(2*pt);let It=0;for(;pt>0;){const Dt=it.readBits(13);let qt=Dt/192<<8&4294967295|Dt%192;qt<7936?qt+=33088:qt+=49472,Ct[It]=qt>>8,Ct[It+1]=qt,It+=2,pt--}try{ct.append(un.decode(Ct,jr.SHIFT_JIS))}catch(Dt){throw new or(Dt)}}static decodeByteSegment(it,ct,pt,Ct,It,Dt){if(8*pt>it.available())throw new or;const qt=new Uint8Array(pt);for(let ar=0;ar<pt;ar++)qt[ar]=it.readBits(8);let Jt;Ct===null?Jt=jr.guessEncoding(qt,Dt):Jt=Ct.getName();try{ct.append(un.decode(qt,Jt))}catch(ar){throw new or(ar)}It.push(qt)}static toAlphaNumericChar(it){if(it>=_u.ALPHANUMERIC_CHARS.length)throw new or;return _u.ALPHANUMERIC_CHARS[it]}static decodeAlphanumericSegment(it,ct,pt,Ct){const It=ct.length();for(;pt>1;){if(it.available()<11)throw new or;const Dt=it.readBits(11);ct.append(_u.toAlphaNumericChar(Math.floor(Dt/45))),ct.append(_u.toAlphaNumericChar(Dt%45)),pt-=2}if(pt===1){if(it.available()<6)throw new or;ct.append(_u.toAlphaNumericChar(it.readBits(6)))}if(Ct)for(let Dt=It;Dt<ct.length();Dt++)ct.charAt(Dt)==="%"&&(Dt<ct.length()-1&&ct.charAt(Dt+1)==="%"?ct.deleteCharAt(Dt+1):ct.setCharAt(Dt,""))}static decodeNumericSegment(it,ct,pt){for(;pt>=3;){if(it.available()<10)throw new or;const Ct=it.readBits(10);if(Ct>=1e3)throw new or;ct.append(_u.toAlphaNumericChar(Math.floor(Ct/100))),ct.append(_u.toAlphaNumericChar(Math.floor(Ct/10)%10)),ct.append(_u.toAlphaNumericChar(Ct%10)),pt-=3}if(pt===2){if(it.available()<7)throw new or;const Ct=it.readBits(7);if(Ct>=100)throw new or;ct.append(_u.toAlphaNumericChar(Math.floor(Ct/10))),ct.append(_u.toAlphaNumericChar(Ct%10))}else if(pt===1){if(it.available()<4)throw new or;const Ct=it.readBits(4);if(Ct>=10)throw new or;ct.append(_u.toAlphaNumericChar(Ct))}}static parseECIValue(it){const ct=it.readBits(8);if(!(ct&128))return ct&127;if((ct&192)===128){const pt=it.readBits(8);return(ct&63)<<8&4294967295|pt}if((ct&224)===192){const pt=it.readBits(16);return(ct&31)<<16&4294967295|pt}throw new or}}_u.ALPHANUMERIC_CHARS="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:",_u.GB2312_SUBSET=1;class Ep{constructor(it){this.mirrored=it}isMirrored(){return this.mirrored}applyMirroredCorrection(it){if(!this.mirrored||it===null||it.length<3)return;const ct=it[0];it[0]=it[2],it[2]=ct}}class r0{constructor(){this.rsDecoder=new po(ys.QR_CODE_FIELD_256)}decodeBooleanArray(it,ct){return this.decodeBitMatrix(fn.parseFromBooleanArray(it),ct)}decodeBitMatrix(it,ct){const pt=new bx(it);let Ct=null;try{return this.decodeBitMatrixParser(pt,ct)}catch(It){Ct=It}try{pt.remask(),pt.setMirror(!0),pt.readVersion(),pt.readFormatInformation(),pt.mirror();const It=this.decodeBitMatrixParser(pt,ct);return It.setOther(new Ep(!0)),It}catch(It){throw Ct!==null?Ct:It}}decodeBitMatrixParser(it,ct){const pt=it.readVersion(),Ct=it.readFormatInformation().getErrorCorrectionLevel(),It=it.readCodewords(),Dt=Am.getDataBlocks(It,pt,Ct);let qt=0;for(const Er of Dt)qt+=Er.getNumDataCodewords();const Jt=new Uint8Array(qt);let ar=0;for(const Er of Dt){const Pr=Er.getCodewords(),Gr=Er.getNumDataCodewords();this.correctErrors(Pr,Gr);for(let pn=0;pn<Gr;pn++)Jt[ar++]=Pr[pn]}return _u.decode(Jt,pt,Ct,ct)}correctErrors(it,ct){const pt=new Int32Array(it);try{this.rsDecoder.decode(pt,it.length-ct)}catch{throw new Pt}for(let Ct=0;Ct<ct;Ct++)it[Ct]=pt[Ct]}}class jp extends Ss{constructor(it,ct,pt){super(it,ct),this.estimatedModuleSize=pt}aboutEquals(it,ct,pt){if(Math.abs(ct-this.getY())<=it&&Math.abs(pt-this.getX())<=it){const Ct=Math.abs(it-this.estimatedModuleSize);return Ct<=1||Ct<=this.estimatedModuleSize}return!1}combineEstimate(it,ct,pt){const Ct=(this.getX()+ct)/2,It=(this.getY()+it)/2,Dt=(this.estimatedModuleSize+pt)/2;return new jp(Ct,It,Dt)}}class Pp{constructor(it,ct,pt,Ct,It,Dt,qt){this.image=it,this.startX=ct,this.startY=pt,this.width=Ct,this.height=It,this.moduleSize=Dt,this.resultPointCallback=qt,this.possibleCenters=[],this.crossCheckStateCount=new Int32Array(3)}find(){const it=this.startX,ct=this.height,pt=this.width,Ct=it+pt,It=this.startY+ct/2,Dt=new Int32Array(3),qt=this.image;for(let Jt=0;Jt<ct;Jt++){const ar=It+(Jt&1?-Math.floor((Jt+1)/2):Math.floor((Jt+1)/2));Dt[0]=0,Dt[1]=0,Dt[2]=0;let Er=it;for(;Er<Ct&&!qt.get(Er,ar);)Er++;let Pr=0;for(;Er<Ct;){if(qt.get(Er,ar))if(Pr===1)Dt[1]++;else if(Pr===2){if(this.foundPatternCross(Dt)){const Gr=this.handlePossibleCenter(Dt,ar,Er);if(Gr!==null)return Gr}Dt[0]=Dt[2],Dt[1]=1,Dt[2]=0,Pr=1}else Dt[++Pr]++;else Pr===1&&Pr++,Dt[Pr]++;Er++}if(this.foundPatternCross(Dt)){const Gr=this.handlePossibleCenter(Dt,ar,Ct);if(Gr!==null)return Gr}}if(this.possibleCenters.length!==0)return this.possibleCenters[0];throw new Fr}static centerFromEnd(it,ct){return ct-it[2]-it[1]/2}foundPatternCross(it){const ct=this.moduleSize,pt=ct/2;for(let Ct=0;Ct<3;Ct++)if(Math.abs(ct-it[Ct])>=pt)return!1;return!0}crossCheckVertical(it,ct,pt,Ct){const It=this.image,Dt=It.getHeight(),qt=this.crossCheckStateCount;qt[0]=0,qt[1]=0,qt[2]=0;let Jt=it;for(;Jt>=0&&It.get(ct,Jt)&&qt[1]<=pt;)qt[1]++,Jt--;if(Jt<0||qt[1]>pt)return NaN;for(;Jt>=0&&!It.get(ct,Jt)&&qt[0]<=pt;)qt[0]++,Jt--;if(qt[0]>pt)return NaN;for(Jt=it+1;Jt<Dt&&It.get(ct,Jt)&&qt[1]<=pt;)qt[1]++,Jt++;if(Jt===Dt||qt[1]>pt)return NaN;for(;Jt<Dt&&!It.get(ct,Jt)&&qt[2]<=pt;)qt[2]++,Jt++;if(qt[2]>pt)return NaN;const ar=qt[0]+qt[1]+qt[2];return 5*Math.abs(ar-Ct)>=2*Ct?NaN:this.foundPatternCross(qt)?Pp.centerFromEnd(qt,Jt):NaN}handlePossibleCenter(it,ct,pt){const Ct=it[0]+it[1]+it[2],It=Pp.centerFromEnd(it,pt),Dt=this.crossCheckVertical(ct,It,2*it[1],Ct);if(!isNaN(Dt)){const qt=(it[0]+it[1]+it[2])/3;for(const ar of this.possibleCenters)if(ar.aboutEquals(qt,Dt,It))return ar.combineEstimate(Dt,It,qt);const Jt=new jp(It,Dt,qt);this.possibleCenters.push(Jt),this.resultPointCallback!==null&&this.resultPointCallback!==void 0&&this.resultPointCallback.foundPossibleResultPoint(Jt)}return null}}class Kp extends Ss{constructor(it,ct,pt,Ct){super(it,ct),this.estimatedModuleSize=pt,this.count=Ct,Ct===void 0&&(this.count=1)}getEstimatedModuleSize(){return this.estimatedModuleSize}getCount(){return this.count}aboutEquals(it,ct,pt){if(Math.abs(ct-this.getY())<=it&&Math.abs(pt-this.getX())<=it){const Ct=Math.abs(it-this.estimatedModuleSize);return Ct<=1||Ct<=this.estimatedModuleSize}return!1}combineEstimate(it,ct,pt){const Ct=this.count+1,It=(this.count*this.getX()+ct)/Ct,Dt=(this.count*this.getY()+it)/Ct,qt=(this.count*this.estimatedModuleSize+pt)/Ct;return new Kp(It,Dt,qt,Ct)}}class L0{constructor(it){this.bottomLeft=it[0],this.topLeft=it[1],this.topRight=it[2]}getBottomLeft(){return this.bottomLeft}getTopLeft(){return this.topLeft}getTopRight(){return this.topRight}}class Yu{constructor(it,ct){this.image=it,this.resultPointCallback=ct,this.possibleCenters=[],this.crossCheckStateCount=new Int32Array(5),this.resultPointCallback=ct}getImage(){return this.image}getPossibleCenters(){return this.possibleCenters}find(it){const ct=it!=null&&it.get(ir.TRY_HARDER)!==void 0,pt=it!=null&&it.get(ir.PURE_BARCODE)!==void 0,Ct=this.image,It=Ct.getHeight(),Dt=Ct.getWidth();let qt=Math.floor(3*It/(4*Yu.MAX_MODULES));(qt<Yu.MIN_SKIP||ct)&&(qt=Yu.MIN_SKIP);let Jt=!1;const ar=new Int32Array(5);for(let Pr=qt-1;Pr<It&&!Jt;Pr+=qt){ar[0]=0,ar[1]=0,ar[2]=0,ar[3]=0,ar[4]=0;let Gr=0;for(let pn=0;pn<Dt;pn++)if(Ct.get(pn,Pr))(Gr&1)===1&&Gr++,ar[Gr]++;else if(Gr&1)ar[Gr]++;else if(Gr===4)if(Yu.foundPatternCross(ar)){if(this.handlePossibleCenter(ar,Pr,pn,pt)===!0)if(qt=2,this.hasSkipped===!0)Jt=this.haveMultiplyConfirmedCenters();else{const Pn=this.findRowSkip();Pn>ar[2]&&(Pr+=Pn-ar[2]-qt,pn=Dt-1)}else{ar[0]=ar[2],ar[1]=ar[3],ar[2]=ar[4],ar[3]=1,ar[4]=0,Gr=3;continue}Gr=0,ar[0]=0,ar[1]=0,ar[2]=0,ar[3]=0,ar[4]=0}else ar[0]=ar[2],ar[1]=ar[3],ar[2]=ar[4],ar[3]=1,ar[4]=0,Gr=3;else ar[++Gr]++;Yu.foundPatternCross(ar)&&this.handlePossibleCenter(ar,Pr,Dt,pt)===!0&&(qt=ar[0],this.hasSkipped&&(Jt=this.haveMultiplyConfirmedCenters()))}const Er=this.selectBestPatterns();return Ss.orderBestPatterns(Er),new L0(Er)}static centerFromEnd(it,ct){return ct-it[4]-it[3]-it[2]/2}static foundPatternCross(it){let ct=0;for(let It=0;It<5;It++){const Dt=it[It];if(Dt===0)return!1;ct+=Dt}if(ct<7)return!1;const pt=ct/7,Ct=pt/2;return Math.abs(pt-it[0])<Ct&&Math.abs(pt-it[1])<Ct&&Math.abs(3*pt-it[2])<3*Ct&&Math.abs(pt-it[3])<Ct&&Math.abs(pt-it[4])<Ct}getCrossCheckStateCount(){const it=this.crossCheckStateCount;return it[0]=0,it[1]=0,it[2]=0,it[3]=0,it[4]=0,it}crossCheckDiagonal(it,ct,pt,Ct){const It=this.getCrossCheckStateCount();let Dt=0;const qt=this.image;for(;it>=Dt&&ct>=Dt&&qt.get(ct-Dt,it-Dt);)It[2]++,Dt++;if(it<Dt||ct<Dt)return!1;for(;it>=Dt&&ct>=Dt&&!qt.get(ct-Dt,it-Dt)&&It[1]<=pt;)It[1]++,Dt++;if(it<Dt||ct<Dt||It[1]>pt)return!1;for(;it>=Dt&&ct>=Dt&&qt.get(ct-Dt,it-Dt)&&It[0]<=pt;)It[0]++,Dt++;if(It[0]>pt)return!1;const Jt=qt.getHeight(),ar=qt.getWidth();for(Dt=1;it+Dt<Jt&&ct+Dt<ar&&qt.get(ct+Dt,it+Dt);)It[2]++,Dt++;if(it+Dt>=Jt||ct+Dt>=ar)return!1;for(;it+Dt<Jt&&ct+Dt<ar&&!qt.get(ct+Dt,it+Dt)&&It[3]<pt;)It[3]++,Dt++;if(it+Dt>=Jt||ct+Dt>=ar||It[3]>=pt)return!1;for(;it+Dt<Jt&&ct+Dt<ar&&qt.get(ct+Dt,it+Dt)&&It[4]<pt;)It[4]++,Dt++;if(It[4]>=pt)return!1;const Er=It[0]+It[1]+It[2]+It[3]+It[4];return Math.abs(Er-Ct)<2*Ct&&Yu.foundPatternCross(It)}crossCheckVertical(it,ct,pt,Ct){const It=this.image,Dt=It.getHeight(),qt=this.getCrossCheckStateCount();let Jt=it;for(;Jt>=0&&It.get(ct,Jt);)qt[2]++,Jt--;if(Jt<0)return NaN;for(;Jt>=0&&!It.get(ct,Jt)&&qt[1]<=pt;)qt[1]++,Jt--;if(Jt<0||qt[1]>pt)return NaN;for(;Jt>=0&&It.get(ct,Jt)&&qt[0]<=pt;)qt[0]++,Jt--;if(qt[0]>pt)return NaN;for(Jt=it+1;Jt<Dt&&It.get(ct,Jt);)qt[2]++,Jt++;if(Jt===Dt)return NaN;for(;Jt<Dt&&!It.get(ct,Jt)&&qt[3]<pt;)qt[3]++,Jt++;if(Jt===Dt||qt[3]>=pt)return NaN;for(;Jt<Dt&&It.get(ct,Jt)&&qt[4]<pt;)qt[4]++,Jt++;if(qt[4]>=pt)return NaN;const ar=qt[0]+qt[1]+qt[2]+qt[3]+qt[4];return 5*Math.abs(ar-Ct)>=2*Ct?NaN:Yu.foundPatternCross(qt)?Yu.centerFromEnd(qt,Jt):NaN}crossCheckHorizontal(it,ct,pt,Ct){const It=this.image,Dt=It.getWidth(),qt=this.getCrossCheckStateCount();let Jt=it;for(;Jt>=0&&It.get(Jt,ct);)qt[2]++,Jt--;if(Jt<0)return NaN;for(;Jt>=0&&!It.get(Jt,ct)&&qt[1]<=pt;)qt[1]++,Jt--;if(Jt<0||qt[1]>pt)return NaN;for(;Jt>=0&&It.get(Jt,ct)&&qt[0]<=pt;)qt[0]++,Jt--;if(qt[0]>pt)return NaN;for(Jt=it+1;Jt<Dt&&It.get(Jt,ct);)qt[2]++,Jt++;if(Jt===Dt)return NaN;for(;Jt<Dt&&!It.get(Jt,ct)&&qt[3]<pt;)qt[3]++,Jt++;if(Jt===Dt||qt[3]>=pt)return NaN;for(;Jt<Dt&&It.get(Jt,ct)&&qt[4]<pt;)qt[4]++,Jt++;if(qt[4]>=pt)return NaN;const ar=qt[0]+qt[1]+qt[2]+qt[3]+qt[4];return 5*Math.abs(ar-Ct)>=Ct?NaN:Yu.foundPatternCross(qt)?Yu.centerFromEnd(qt,Jt):NaN}handlePossibleCenter(it,ct,pt,Ct){const It=it[0]+it[1]+it[2]+it[3]+it[4];let Dt=Yu.centerFromEnd(it,pt),qt=this.crossCheckVertical(ct,Math.floor(Dt),it[2],It);if(!isNaN(qt)&&(Dt=this.crossCheckHorizontal(Math.floor(Dt),Math.floor(qt),it[2],It),!isNaN(Dt)&&(!Ct||this.crossCheckDiagonal(Math.floor(qt),Math.floor(Dt),it[2],It)))){const Jt=It/7;let ar=!1;const Er=this.possibleCenters;for(let Pr=0,Gr=Er.length;Pr<Gr;Pr++){const pn=Er[Pr];if(pn.aboutEquals(Jt,qt,Dt)){Er[Pr]=pn.combineEstimate(qt,Dt,Jt),ar=!0;break}}if(!ar){const Pr=new Kp(Dt,qt,Jt);Er.push(Pr),this.resultPointCallback!==null&&this.resultPointCallback!==void 0&&this.resultPointCallback.foundPossibleResultPoint(Pr)}return!0}return!1}findRowSkip(){if(this.possibleCenters.length<=1)return 0;let ct=null;for(const pt of this.possibleCenters)if(pt.getCount()>=Yu.CENTER_QUORUM)if(ct==null)ct=pt;else return this.hasSkipped=!0,Math.floor((Math.abs(ct.getX()-pt.getX())-Math.abs(ct.getY()-pt.getY()))/2);return 0}haveMultiplyConfirmedCenters(){let it=0,ct=0;const pt=this.possibleCenters.length;for(const Dt of this.possibleCenters)Dt.getCount()>=Yu.CENTER_QUORUM&&(it++,ct+=Dt.getEstimatedModuleSize());if(it<3)return!1;const Ct=ct/pt;let It=0;for(const Dt of this.possibleCenters)It+=Math.abs(Dt.getEstimatedModuleSize()-Ct);return It<=.05*ct}selectBestPatterns(){const it=this.possibleCenters.length;if(it<3)throw new Fr;const ct=this.possibleCenters;let pt;if(it>3){let Ct=0,It=0;for(const Jt of this.possibleCenters){const ar=Jt.getEstimatedModuleSize();Ct+=ar,It+=ar*ar}pt=Ct/it;let Dt=Math.sqrt(It/it-pt*pt);ct.sort((Jt,ar)=>{const Er=Math.abs(ar.getEstimatedModuleSize()-pt),Pr=Math.abs(Jt.getEstimatedModuleSize()-pt);return Er<Pr?-1:Er>Pr?1:0});const qt=Math.max(.2*pt,Dt);for(let Jt=0;Jt<ct.length&&ct.length>3;Jt++){const ar=ct[Jt];Math.abs(ar.getEstimatedModuleSize()-pt)>qt&&(ct.splice(Jt,1),Jt--)}}if(ct.length>3){let Ct=0;for(const It of ct)Ct+=It.getEstimatedModuleSize();pt=Ct/ct.length,ct.sort((It,Dt)=>{if(Dt.getCount()===It.getCount()){const qt=Math.abs(Dt.getEstimatedModuleSize()-pt),Jt=Math.abs(It.getEstimatedModuleSize()-pt);return qt<Jt?1:qt>Jt?-1:0}else return Dt.getCount()-It.getCount()}),ct.splice(3)}return[ct[0],ct[1],ct[2]]}}Yu.CENTER_QUORUM=2,Yu.MIN_SKIP=3,Yu.MAX_MODULES=57;class j0{constructor(it){this.image=it}getImage(){return this.image}getResultPointCallback(){return this.resultPointCallback}detect(it){this.resultPointCallback=it==null?null:it.get(ir.NEED_RESULT_POINT_CALLBACK);const pt=new Yu(this.image,this.resultPointCallback).find(it);return this.processFinderPatternInfo(pt)}processFinderPatternInfo(it){const ct=it.getTopLeft(),pt=it.getTopRight(),Ct=it.getBottomLeft(),It=this.calculateModuleSize(ct,pt,Ct);if(It<1)throw new Fr("No pattern found in proccess finder.");const Dt=j0.computeDimension(ct,pt,Ct,It),qt=uo.getProvisionalVersionForDimension(Dt),Jt=qt.getDimensionForVersion()-7;let ar=null;if(qt.getAlignmentPatternCenters().length>0){const pn=pt.getX()-ct.getX()+Ct.getX(),An=pt.getY()-ct.getY()+Ct.getY(),Pn=1-3/Jt,Xn=Math.floor(ct.getX()+Pn*(pn-ct.getX())),os=Math.floor(ct.getY()+Pn*(An-ct.getY()));for(let Ks=4;Ks<=16;Ks<<=1)try{ar=this.findAlignmentInRegion(It,Xn,os,Ks);break}catch(Js){if(!(Js instanceof Fr))throw Js}}const Er=j0.createTransform(ct,pt,Ct,ar,Dt),Pr=j0.sampleGrid(this.image,Er,Dt);let Gr;return ar===null?Gr=[Ct,ct,pt]:Gr=[Ct,ct,pt,ar],new Ul(Pr,Gr)}static createTransform(it,ct,pt,Ct,It){const Dt=It-3.5;let qt,Jt,ar,Er;return Ct!==null?(qt=Ct.getX(),Jt=Ct.getY(),ar=Dt-3,Er=ar):(qt=ct.getX()-it.getX()+pt.getX(),Jt=ct.getY()-it.getY()+pt.getY(),ar=Dt,Er=Dt),Mn.quadrilateralToQuadrilateral(3.5,3.5,Dt,3.5,ar,Er,3.5,Dt,it.getX(),it.getY(),ct.getX(),ct.getY(),qt,Jt,pt.getX(),pt.getY())}static sampleGrid(it,ct,pt){return Ds.getInstance().sampleGridWithTransform(it,pt,pt,ct)}static computeDimension(it,ct,pt,Ct){const It=us.round(Ss.distance(it,ct)/Ct),Dt=us.round(Ss.distance(it,pt)/Ct);let qt=Math.floor((It+Dt)/2)+7;switch(qt&3){case 0:qt++;break;case 2:qt--;break;case 3:throw new Fr("Dimensions could be not found.")}return qt}calculateModuleSize(it,ct,pt){return(this.calculateModuleSizeOneWay(it,ct)+this.calculateModuleSizeOneWay(it,pt))/2}calculateModuleSizeOneWay(it,ct){const pt=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(it.getX()),Math.floor(it.getY()),Math.floor(ct.getX()),Math.floor(ct.getY())),Ct=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(ct.getX()),Math.floor(ct.getY()),Math.floor(it.getX()),Math.floor(it.getY()));return isNaN(pt)?Ct/7:isNaN(Ct)?pt/7:(pt+Ct)/14}sizeOfBlackWhiteBlackRunBothWays(it,ct,pt,Ct){let It=this.sizeOfBlackWhiteBlackRun(it,ct,pt,Ct),Dt=1,qt=it-(pt-it);qt<0?(Dt=it/(it-qt),qt=0):qt>=this.image.getWidth()&&(Dt=(this.image.getWidth()-1-it)/(qt-it),qt=this.image.getWidth()-1);let Jt=Math.floor(ct-(Ct-ct)*Dt);return Dt=1,Jt<0?(Dt=ct/(ct-Jt),Jt=0):Jt>=this.image.getHeight()&&(Dt=(this.image.getHeight()-1-ct)/(Jt-ct),Jt=this.image.getHeight()-1),qt=Math.floor(it+(qt-it)*Dt),It+=this.sizeOfBlackWhiteBlackRun(it,ct,qt,Jt),It-1}sizeOfBlackWhiteBlackRun(it,ct,pt,Ct){const It=Math.abs(Ct-ct)>Math.abs(pt-it);if(It){let pn=it;it=ct,ct=pn,pn=pt,pt=Ct,Ct=pn}const Dt=Math.abs(pt-it),qt=Math.abs(Ct-ct);let Jt=-Dt/2;const ar=it<pt?1:-1,Er=ct<Ct?1:-1;let Pr=0;const Gr=pt+ar;for(let pn=it,An=ct;pn!==Gr;pn+=ar){const Pn=It?An:pn,Xn=It?pn:An;if(Pr===1===this.image.get(Pn,Xn)){if(Pr===2)return us.distance(pn,An,it,ct);Pr++}if(Jt+=qt,Jt>0){if(An===Ct)break;An+=Er,Jt-=Dt}}return Pr===2?us.distance(pt+ar,Ct,it,ct):NaN}findAlignmentInRegion(it,ct,pt,Ct){const It=Math.floor(Ct*it),Dt=Math.max(0,ct-It),qt=Math.min(this.image.getWidth()-1,ct+It);if(qt-Dt<it*3)throw new Fr("Alignment top exceeds estimated module size.");const Jt=Math.max(0,pt-It),ar=Math.min(this.image.getHeight()-1,pt+It);if(ar-Jt<it*3)throw new Fr("Alignment bottom exceeds estimated module size.");return new Pp(this.image,Dt,Jt,qt-Dt,ar-Jt,it,this.resultPointCallback).find()}}class Fp{constructor(){this.decoder=new r0}getDecoder(){return this.decoder}decode(it,ct){let pt,Ct;if(ct!=null&&ct.get(ir.PURE_BARCODE)!==void 0){const Jt=Fp.extractPureBits(it.getBlackMatrix());pt=this.decoder.decodeBitMatrix(Jt,ct),Ct=Fp.NO_POINTS}else{const Jt=new j0(it.getBlackMatrix()).detect(ct);pt=this.decoder.decodeBitMatrix(Jt.getBits(),ct),Ct=Jt.getPoints()}pt.getOther()instanceof Ep&&pt.getOther().applyMirroredCorrection(Ct);const It=new Sn(pt.getText(),pt.getRawBytes(),void 0,Ct,rs.QR_CODE,void 0),Dt=pt.getByteSegments();Dt!==null&&It.putMetadata(On.BYTE_SEGMENTS,Dt);const qt=pt.getECLevel();return qt!==null&&It.putMetadata(On.ERROR_CORRECTION_LEVEL,qt),pt.hasStructuredAppend()&&(It.putMetadata(On.STRUCTURED_APPEND_SEQUENCE,pt.getStructuredAppendSequenceNumber()),It.putMetadata(On.STRUCTURED_APPEND_PARITY,pt.getStructuredAppendParity())),It}reset(){}static extractPureBits(it){const ct=it.getTopLeftOnBit(),pt=it.getBottomRightOnBit();if(ct===null||pt===null)throw new Fr;const Ct=this.moduleSize(ct,it);let It=ct[1],Dt=pt[1],qt=ct[0],Jt=pt[0];if(qt>=Jt||It>=Dt)throw new Fr;if(Dt-It!==Jt-qt&&(Jt=qt+(Dt-It),Jt>=it.getWidth()))throw new Fr;const ar=Math.round((Jt-qt+1)/Ct),Er=Math.round((Dt-It+1)/Ct);if(ar<=0||Er<=0)throw new Fr;if(Er!==ar)throw new Fr;const Pr=Math.floor(Ct/2);It+=Pr,qt+=Pr;const Gr=qt+Math.floor((ar-1)*Ct)-Jt;if(Gr>0){if(Gr>Pr)throw new Fr;qt-=Gr}const pn=It+Math.floor((Er-1)*Ct)-Dt;if(pn>0){if(pn>Pr)throw new Fr;It-=pn}const An=new fn(ar,Er);for(let Pn=0;Pn<Er;Pn++){const Xn=It+Math.floor(Pn*Ct);for(let os=0;os<ar;os++)it.get(qt+Math.floor(os*Ct),Xn)&&An.set(os,Pn)}return An}static moduleSize(it,ct){const pt=ct.getHeight(),Ct=ct.getWidth();let It=it[0],Dt=it[1],qt=!0,Jt=0;for(;It<Ct&&Dt<pt;){if(qt!==ct.get(It,Dt)){if(++Jt===5)break;qt=!qt}It++,Dt++}if(It===Ct||Dt===pt)throw new Fr;return(It-it[0])/7}}Fp.NO_POINTS=new Array;class _a{PDF417Common(){}static getBitCountSum(it){return us.sum(it)}static toIntArray(it){if(it==null||!it.length)return _a.EMPTY_INT_ARRAY;const ct=new Int32Array(it.length);let pt=0;for(const Ct of it)ct[pt++]=Ct;return ct}static getCodeword(it){const ct=Ut.binarySearch(_a.SYMBOL_TABLE,it&262143);return ct<0?-1:(_a.CODEWORD_TABLE[ct]-1)%_a.NUMBER_OF_CODEWORDS}}_a.NUMBER_OF_CODEWORDS=929,_a.MAX_CODEWORDS_IN_BARCODE=_a.NUMBER_OF_CODEWORDS-1,_a.MIN_ROWS_IN_BARCODE=3,_a.MAX_ROWS_IN_BARCODE=90,_a.MODULES_IN_CODEWORD=17,_a.MODULES_IN_STOP_PATTERN=18,_a.BARS_IN_MODULE=8,_a.EMPTY_INT_ARRAY=new Int32Array([]),_a.SYMBOL_TABLE=Int32Array.from([66142,66170,66206,66236,66290,66292,66350,66382,66396,66454,66470,66476,66594,66600,66614,66626,66628,66632,66640,66654,66662,66668,66682,66690,66718,66720,66748,66758,66776,66798,66802,66804,66820,66824,66832,66846,66848,66876,66880,66936,66950,66956,66968,66992,67006,67022,67036,67042,67044,67048,67062,67118,67150,67164,67214,67228,67256,67294,67322,67350,67366,67372,67398,67404,67416,67438,67474,67476,67490,67492,67496,67510,67618,67624,67650,67656,67664,67678,67686,67692,67706,67714,67716,67728,67742,67744,67772,67782,67788,67800,67822,67826,67828,67842,67848,67870,67872,67900,67904,67960,67974,67992,68016,68030,68046,68060,68066,68068,68072,68086,68104,68112,68126,68128,68156,68160,68216,68336,68358,68364,68376,68400,68414,68448,68476,68494,68508,68536,68546,68548,68552,68560,68574,68582,68588,68654,68686,68700,68706,68708,68712,68726,68750,68764,68792,68802,68804,68808,68816,68830,68838,68844,68858,68878,68892,68920,68976,68990,68994,68996,69e3,69008,69022,69024,69052,69062,69068,69080,69102,69106,69108,69142,69158,69164,69190,69208,69230,69254,69260,69272,69296,69310,69326,69340,69386,69394,69396,69410,69416,69430,69442,69444,69448,69456,69470,69478,69484,69554,69556,69666,69672,69698,69704,69712,69726,69754,69762,69764,69776,69790,69792,69820,69830,69836,69848,69870,69874,69876,69890,69918,69920,69948,69952,70008,70022,70040,70064,70078,70094,70108,70114,70116,70120,70134,70152,70174,70176,70264,70384,70412,70448,70462,70496,70524,70542,70556,70584,70594,70600,70608,70622,70630,70636,70664,70672,70686,70688,70716,70720,70776,70896,71136,71180,71192,71216,71230,71264,71292,71360,71416,71452,71480,71536,71550,71554,71556,71560,71568,71582,71584,71612,71622,71628,71640,71662,71726,71732,71758,71772,71778,71780,71784,71798,71822,71836,71864,71874,71880,71888,71902,71910,71916,71930,71950,71964,71992,72048,72062,72066,72068,72080,72094,72096,72124,72134,72140,72152,72174,72178,72180,72206,72220,72248,72304,72318,72416,72444,72456,72464,72478,72480,72508,72512,72568,72588,72600,72624,72638,72654,72668,72674,72676,72680,72694,72726,72742,72748,72774,72780,72792,72814,72838,72856,72880,72894,72910,72924,72930,72932,72936,72950,72966,72972,72984,73008,73022,73056,73084,73102,73116,73144,73156,73160,73168,73182,73190,73196,73210,73226,73234,73236,73250,73252,73256,73270,73282,73284,73296,73310,73318,73324,73346,73348,73352,73360,73374,73376,73404,73414,73420,73432,73454,73498,73518,73522,73524,73550,73564,73570,73572,73576,73590,73800,73822,73858,73860,73872,73886,73888,73916,73944,73970,73972,73992,74014,74016,74044,74048,74104,74118,74136,74160,74174,74210,74212,74216,74230,74244,74256,74270,74272,74360,74480,74502,74508,74544,74558,74592,74620,74638,74652,74680,74690,74696,74704,74726,74732,74782,74784,74812,74992,75232,75288,75326,75360,75388,75456,75512,75576,75632,75646,75650,75652,75664,75678,75680,75708,75718,75724,75736,75758,75808,75836,75840,75896,76016,76256,76736,76824,76848,76862,76896,76924,76992,77048,77296,77340,77368,77424,77438,77536,77564,77572,77576,77584,77600,77628,77632,77688,77702,77708,77720,77744,77758,77774,77788,77870,77902,77916,77922,77928,77966,77980,78008,78018,78024,78032,78046,78060,78074,78094,78136,78192,78206,78210,78212,78224,78238,78240,78268,78278,78284,78296,78322,78324,78350,78364,78448,78462,78560,78588,78600,78622,78624,78652,78656,78712,78726,78744,78768,78782,78798,78812,78818,78820,78824,78838,78862,78876,78904,78960,78974,79072,79100,79296,79352,79368,79376,79390,79392,79420,79424,79480,79600,79628,79640,79664,79678,79712,79740,79772,79800,79810,79812,79816,79824,79838,79846,79852,79894,79910,79916,79942,79948,79960,79982,79988,80006,80024,80048,80062,80078,80092,80098,80100,80104,80134,80140,80176,80190,80224,80252,80270,80284,80312,80328,80336,80350,80358,80364,80378,80390,80396,80408,80432,80446,80480,80508,80576,80632,80654,80668,80696,80752,80766,80776,80784,80798,80800,80828,80844,80856,80878,80882,80884,80914,80916,80930,80932,80936,80950,80962,80968,80976,80990,80998,81004,81026,81028,81040,81054,81056,81084,81094,81100,81112,81134,81154,81156,81160,81168,81182,81184,81212,81216,81272,81286,81292,81304,81328,81342,81358,81372,81380,81384,81398,81434,81454,81458,81460,81486,81500,81506,81508,81512,81526,81550,81564,81592,81602,81604,81608,81616,81630,81638,81644,81702,81708,81722,81734,81740,81752,81774,81778,81780,82050,82078,82080,82108,82180,82184,82192,82206,82208,82236,82240,82296,82316,82328,82352,82366,82402,82404,82408,82440,82448,82462,82464,82492,82496,82552,82672,82694,82700,82712,82736,82750,82784,82812,82830,82882,82884,82888,82896,82918,82924,82952,82960,82974,82976,83004,83008,83064,83184,83424,83468,83480,83504,83518,83552,83580,83648,83704,83740,83768,83824,83838,83842,83844,83848,83856,83872,83900,83910,83916,83928,83950,83984,84e3,84028,84032,84088,84208,84448,84928,85040,85054,85088,85116,85184,85240,85488,85560,85616,85630,85728,85756,85764,85768,85776,85790,85792,85820,85824,85880,85894,85900,85912,85936,85966,85980,86048,86080,86136,86256,86496,86976,88160,88188,88256,88312,88560,89056,89200,89214,89312,89340,89536,89592,89608,89616,89632,89664,89720,89840,89868,89880,89904,89952,89980,89998,90012,90040,90190,90204,90254,90268,90296,90306,90308,90312,90334,90382,90396,90424,90480,90494,90500,90504,90512,90526,90528,90556,90566,90572,90584,90610,90612,90638,90652,90680,90736,90750,90848,90876,90884,90888,90896,90910,90912,90940,90944,91e3,91014,91020,91032,91056,91070,91086,91100,91106,91108,91112,91126,91150,91164,91192,91248,91262,91360,91388,91584,91640,91664,91678,91680,91708,91712,91768,91888,91928,91952,91966,92e3,92028,92046,92060,92088,92098,92100,92104,92112,92126,92134,92140,92188,92216,92272,92384,92412,92608,92664,93168,93200,93214,93216,93244,93248,93304,93424,93664,93720,93744,93758,93792,93820,93888,93944,93980,94008,94064,94078,94084,94088,94096,94110,94112,94140,94150,94156,94168,94246,94252,94278,94284,94296,94318,94342,94348,94360,94384,94398,94414,94428,94440,94470,94476,94488,94512,94526,94560,94588,94606,94620,94648,94658,94660,94664,94672,94686,94694,94700,94714,94726,94732,94744,94768,94782,94816,94844,94912,94968,94990,95004,95032,95088,95102,95112,95120,95134,95136,95164,95180,95192,95214,95218,95220,95244,95256,95280,95294,95328,95356,95424,95480,95728,95758,95772,95800,95856,95870,95968,95996,96008,96016,96030,96032,96060,96064,96120,96152,96176,96190,96220,96226,96228,96232,96290,96292,96296,96310,96322,96324,96328,96336,96350,96358,96364,96386,96388,96392,96400,96414,96416,96444,96454,96460,96472,96494,96498,96500,96514,96516,96520,96528,96542,96544,96572,96576,96632,96646,96652,96664,96688,96702,96718,96732,96738,96740,96744,96758,96772,96776,96784,96798,96800,96828,96832,96888,97008,97030,97036,97048,97072,97086,97120,97148,97166,97180,97208,97220,97224,97232,97246,97254,97260,97326,97330,97332,97358,97372,97378,97380,97384,97398,97422,97436,97464,97474,97476,97480,97488,97502,97510,97516,97550,97564,97592,97648,97666,97668,97672,97680,97694,97696,97724,97734,97740,97752,97774,97830,97836,97850,97862,97868,97880,97902,97906,97908,97926,97932,97944,97968,97998,98012,98018,98020,98024,98038,98618,98674,98676,98838,98854,98874,98892,98904,98926,98930,98932,98968,99006,99042,99044,99048,99062,99166,99194,99246,99286,99350,99366,99372,99386,99398,99416,99438,99442,99444,99462,99504,99518,99534,99548,99554,99556,99560,99574,99590,99596,99608,99632,99646,99680,99708,99726,99740,99768,99778,99780,99784,99792,99806,99814,99820,99834,99858,99860,99874,99880,99894,99906,99920,99934,99962,99970,99972,99976,99984,99998,1e5,100028,100038,100044,100056,100078,100082,100084,100142,100174,100188,100246,100262,100268,100306,100308,100390,100396,100410,100422,100428,100440,100462,100466,100468,100486,100504,100528,100542,100558,100572,100578,100580,100584,100598,100620,100656,100670,100704,100732,100750,100792,100802,100808,100816,100830,100838,100844,100858,100888,100912,100926,100960,100988,101056,101112,101148,101176,101232,101246,101250,101252,101256,101264,101278,101280,101308,101318,101324,101336,101358,101362,101364,101410,101412,101416,101430,101442,101448,101456,101470,101478,101498,101506,101508,101520,101534,101536,101564,101580,101618,101620,101636,101640,101648,101662,101664,101692,101696,101752,101766,101784,101838,101858,101860,101864,101934,101938,101940,101966,101980,101986,101988,101992,102030,102044,102072,102082,102084,102088,102096,102138,102166,102182,102188,102214,102220,102232,102254,102282,102290,102292,102306,102308,102312,102326,102444,102458,102470,102476,102488,102514,102516,102534,102552,102576,102590,102606,102620,102626,102632,102646,102662,102668,102704,102718,102752,102780,102798,102812,102840,102850,102856,102864,102878,102886,102892,102906,102936,102974,103008,103036,103104,103160,103224,103280,103294,103298,103300,103312,103326,103328,103356,103366,103372,103384,103406,103410,103412,103472,103486,103520,103548,103616,103672,103920,103992,104048,104062,104160,104188,104194,104196,104200,104208,104224,104252,104256,104312,104326,104332,104344,104368,104382,104398,104412,104418,104420,104424,104482,104484,104514,104520,104528,104542,104550,104570,104578,104580,104592,104606,104608,104636,104652,104690,104692,104706,104712,104734,104736,104764,104768,104824,104838,104856,104910,104930,104932,104936,104968,104976,104990,104992,105020,105024,105080,105200,105240,105278,105312,105372,105410,105412,105416,105424,105446,105518,105524,105550,105564,105570,105572,105576,105614,105628,105656,105666,105672,105680,105702,105722,105742,105756,105784,105840,105854,105858,105860,105864,105872,105888,105932,105970,105972,106006,106022,106028,106054,106060,106072,106100,106118,106124,106136,106160,106174,106190,106210,106212,106216,106250,106258,106260,106274,106276,106280,106306,106308,106312,106320,106334,106348,106394,106414,106418,106420,106566,106572,106610,106612,106630,106636,106648,106672,106686,106722,106724,106728,106742,106758,106764,106776,106800,106814,106848,106876,106894,106908,106936,106946,106948,106952,106960,106974,106982,106988,107032,107056,107070,107104,107132,107200,107256,107292,107320,107376,107390,107394,107396,107400,107408,107422,107424,107452,107462,107468,107480,107502,107506,107508,107544,107568,107582,107616,107644,107712,107768,108016,108060,108088,108144,108158,108256,108284,108290,108292,108296,108304,108318,108320,108348,108352,108408,108422,108428,108440,108464,108478,108494,108508,108514,108516,108520,108592,108640,108668,108736,108792,109040,109536,109680,109694,109792,109820,110016,110072,110084,110088,110096,110112,110140,110144,110200,110320,110342,110348,110360,110384,110398,110432,110460,110478,110492,110520,110532,110536,110544,110558,110658,110686,110714,110722,110724,110728,110736,110750,110752,110780,110796,110834,110836,110850,110852,110856,110864,110878,110880,110908,110912,110968,110982,111e3,111054,111074,111076,111080,111108,111112,111120,111134,111136,111164,111168,111224,111344,111372,111422,111456,111516,111554,111556,111560,111568,111590,111632,111646,111648,111676,111680,111736,111856,112096,112152,112224,112252,112320,112440,112514,112516,112520,112528,112542,112544,112588,112686,112718,112732,112782,112796,112824,112834,112836,112840,112848,112870,112890,112910,112924,112952,113008,113022,113026,113028,113032,113040,113054,113056,113100,113138,113140,113166,113180,113208,113264,113278,113376,113404,113416,113424,113440,113468,113472,113560,113614,113634,113636,113640,113686,113702,113708,113734,113740,113752,113778,113780,113798,113804,113816,113840,113854,113870,113890,113892,113896,113926,113932,113944,113968,113982,114016,114044,114076,114114,114116,114120,114128,114150,114170,114194,114196,114210,114212,114216,114242,114244,114248,114256,114270,114278,114306,114308,114312,114320,114334,114336,114364,114380,114420,114458,114478,114482,114484,114510,114524,114530,114532,114536,114842,114866,114868,114970,114994,114996,115042,115044,115048,115062,115130,115226,115250,115252,115278,115292,115298,115300,115304,115318,115342,115394,115396,115400,115408,115422,115430,115436,115450,115478,115494,115514,115526,115532,115570,115572,115738,115758,115762,115764,115790,115804,115810,115812,115816,115830,115854,115868,115896,115906,115912,115920,115934,115942,115948,115962,115996,116024,116080,116094,116098,116100,116104,116112,116126,116128,116156,116166,116172,116184,116206,116210,116212,116246,116262,116268,116282,116294,116300,116312,116334,116338,116340,116358,116364,116376,116400,116414,116430,116444,116450,116452,116456,116498,116500,116514,116520,116534,116546,116548,116552,116560,116574,116582,116588,116602,116654,116694,116714,116762,116782,116786,116788,116814,116828,116834,116836,116840,116854,116878,116892,116920,116930,116936,116944,116958,116966,116972,116986,117006,117048,117104,117118,117122,117124,117136,117150,117152,117180,117190,117196,117208,117230,117234,117236,117304,117360,117374,117472,117500,117506,117508,117512,117520,117536,117564,117568,117624,117638,117644,117656,117680,117694,117710,117724,117730,117732,117736,117750,117782,117798,117804,117818,117830,117848,117874,117876,117894,117936,117950,117966,117986,117988,117992,118022,118028,118040,118064,118078,118112,118140,118172,118210,118212,118216,118224,118238,118246,118266,118306,118312,118338,118352,118366,118374,118394,118402,118404,118408,118416,118430,118432,118460,118476,118514,118516,118574,118578,118580,118606,118620,118626,118628,118632,118678,118694,118700,118730,118738,118740,118830,118834,118836,118862,118876,118882,118884,118888,118902,118926,118940,118968,118978,118980,118984,118992,119006,119014,119020,119034,119068,119096,119152,119166,119170,119172,119176,119184,119198,119200,119228,119238,119244,119256,119278,119282,119284,119324,119352,119408,119422,119520,119548,119554,119556,119560,119568,119582,119584,119612,119616,119672,119686,119692,119704,119728,119742,119758,119772,119778,119780,119784,119798,119920,119934,120032,120060,120256,120312,120324,120328,120336,120352,120384,120440,120560,120582,120588,120600,120624,120638,120672,120700,120718,120732,120760,120770,120772,120776,120784,120798,120806,120812,120870,120876,120890,120902,120908,120920,120946,120948,120966,120972,120984,121008,121022,121038,121058,121060,121064,121078,121100,121112,121136,121150,121184,121212,121244,121282,121284,121288,121296,121318,121338,121356,121368,121392,121406,121440,121468,121536,121592,121656,121730,121732,121736,121744,121758,121760,121804,121842,121844,121890,121922,121924,121928,121936,121950,121958,121978,121986,121988,121992,122e3,122014,122016,122044,122060,122098,122100,122116,122120,122128,122142,122144,122172,122176,122232,122246,122264,122318,122338,122340,122344,122414,122418,122420,122446,122460,122466,122468,122472,122510,122524,122552,122562,122564,122568,122576,122598,122618,122646,122662,122668,122694,122700,122712,122738,122740,122762,122770,122772,122786,122788,122792,123018,123026,123028,123042,123044,123048,123062,123098,123146,123154,123156,123170,123172,123176,123190,123202,123204,123208,123216,123238,123244,123258,123290,123314,123316,123402,123410,123412,123426,123428,123432,123446,123458,123464,123472,123486,123494,123500,123514,123522,123524,123528,123536,123552,123580,123590,123596,123608,123630,123634,123636,123674,123698,123700,123740,123746,123748,123752,123834,123914,123922,123924,123938,123944,123958,123970,123976,123984,123998,124006,124012,124026,124034,124036,124048,124062,124064,124092,124102,124108,124120,124142,124146,124148,124162,124164,124168,124176,124190,124192,124220,124224,124280,124294,124300,124312,124336,124350,124366,124380,124386,124388,124392,124406,124442,124462,124466,124468,124494,124508,124514,124520,124558,124572,124600,124610,124612,124616,124624,124646,124666,124694,124710,124716,124730,124742,124748,124760,124786,124788,124818,124820,124834,124836,124840,124854,124946,124948,124962,124964,124968,124982,124994,124996,125e3,125008,125022,125030,125036,125050,125058,125060,125064,125072,125086,125088,125116,125126,125132,125144,125166,125170,125172,125186,125188,125192,125200,125216,125244,125248,125304,125318,125324,125336,125360,125374,125390,125404,125410,125412,125416,125430,125444,125448,125456,125472,125504,125560,125680,125702,125708,125720,125744,125758,125792,125820,125838,125852,125880,125890,125892,125896,125904,125918,125926,125932,125978,125998,126002,126004,126030,126044,126050,126052,126056,126094,126108,126136,126146,126148,126152,126160,126182,126202,126222,126236,126264,126320,126334,126338,126340,126344,126352,126366,126368,126412,126450,126452,126486,126502,126508,126522,126534,126540,126552,126574,126578,126580,126598,126604,126616,126640,126654,126670,126684,126690,126692,126696,126738,126754,126756,126760,126774,126786,126788,126792,126800,126814,126822,126828,126842,126894,126898,126900,126934,127126,127142,127148,127162,127178,127186,127188,127254,127270,127276,127290,127302,127308,127320,127342,127346,127348,127370,127378,127380,127394,127396,127400,127450,127510,127526,127532,127546,127558,127576,127598,127602,127604,127622,127628,127640,127664,127678,127694,127708,127714,127716,127720,127734,127754,127762,127764,127778,127784,127810,127812,127816,127824,127838,127846,127866,127898,127918,127922,127924,128022,128038,128044,128058,128070,128076,128088,128110,128114,128116,128134,128140,128152,128176,128190,128206,128220,128226,128228,128232,128246,128262,128268,128280,128304,128318,128352,128380,128398,128412,128440,128450,128452,128456,128464,128478,128486,128492,128506,128522,128530,128532,128546,128548,128552,128566,128578,128580,128584,128592,128606,128614,128634,128642,128644,128648,128656,128670,128672,128700,128716,128754,128756,128794,128814,128818,128820,128846,128860,128866,128868,128872,128886,128918,128934,128940,128954,128978,128980,129178,129198,129202,129204,129238,129258,129306,129326,129330,129332,129358,129372,129378,129380,129384,129398,129430,129446,129452,129466,129482,129490,129492,129562,129582,129586,129588,129614,129628,129634,129636,129640,129654,129678,129692,129720,129730,129732,129736,129744,129758,129766,129772,129814,129830,129836,129850,129862,129868,129880,129902,129906,129908,129930,129938,129940,129954,129956,129960,129974,130010]),_a.CODEWORD_TABLE=Int32Array.from([2627,1819,2622,2621,1813,1812,2729,2724,2723,2779,2774,2773,902,896,908,868,865,861,859,2511,873,871,1780,835,2493,825,2491,842,837,844,1764,1762,811,810,809,2483,807,2482,806,2480,815,814,813,812,2484,817,816,1745,1744,1742,1746,2655,2637,2635,2626,2625,2623,2628,1820,2752,2739,2737,2728,2727,2725,2730,2785,2783,2778,2777,2775,2780,787,781,747,739,736,2413,754,752,1719,692,689,681,2371,678,2369,700,697,694,703,1688,1686,642,638,2343,631,2341,627,2338,651,646,643,2345,654,652,1652,1650,1647,1654,601,599,2322,596,2321,594,2319,2317,611,610,608,606,2324,603,2323,615,614,612,1617,1616,1614,1612,616,1619,1618,2575,2538,2536,905,901,898,909,2509,2507,2504,870,867,864,860,2512,875,872,1781,2490,2489,2487,2485,1748,836,834,832,830,2494,827,2492,843,841,839,845,1765,1763,2701,2676,2674,2653,2648,2656,2634,2633,2631,2629,1821,2638,2636,2770,2763,2761,2750,2745,2753,2736,2735,2733,2731,1848,2740,2738,2786,2784,591,588,576,569,566,2296,1590,537,534,526,2276,522,2274,545,542,539,548,1572,1570,481,2245,466,2242,462,2239,492,485,482,2249,496,494,1534,1531,1528,1538,413,2196,406,2191,2188,425,419,2202,415,2199,432,430,427,1472,1467,1464,433,1476,1474,368,367,2160,365,2159,362,2157,2155,2152,378,377,375,2166,372,2165,369,2162,383,381,379,2168,1419,1418,1416,1414,385,1411,384,1423,1422,1420,1424,2461,802,2441,2439,790,786,783,794,2409,2406,2403,750,742,738,2414,756,753,1720,2367,2365,2362,2359,1663,693,691,684,2373,680,2370,702,699,696,704,1690,1687,2337,2336,2334,2332,1624,2329,1622,640,637,2344,634,2342,630,2340,650,648,645,2346,655,653,1653,1651,1649,1655,2612,2597,2595,2571,2568,2565,2576,2534,2529,2526,1787,2540,2537,907,904,900,910,2503,2502,2500,2498,1768,2495,1767,2510,2508,2506,869,866,863,2513,876,874,1782,2720,2713,2711,2697,2694,2691,2702,2672,2670,2664,1828,2678,2675,2647,2646,2644,2642,1823,2639,1822,2654,2652,2650,2657,2771,1855,2765,2762,1850,1849,2751,2749,2747,2754,353,2148,344,342,336,2142,332,2140,345,1375,1373,306,2130,299,2128,295,2125,319,314,311,2132,1354,1352,1349,1356,262,257,2101,253,2096,2093,274,273,267,2107,263,2104,280,278,275,1316,1311,1308,1320,1318,2052,202,2050,2044,2040,219,2063,212,2060,208,2055,224,221,2066,1260,1258,1252,231,1248,229,1266,1264,1261,1268,155,1998,153,1996,1994,1991,1988,165,164,2007,162,2006,159,2003,2e3,172,171,169,2012,166,2010,1186,1184,1182,1179,175,1176,173,1192,1191,1189,1187,176,1194,1193,2313,2307,2305,592,589,2294,2292,2289,578,572,568,2297,580,1591,2272,2267,2264,1547,538,536,529,2278,525,2275,547,544,541,1574,1571,2237,2235,2229,1493,2225,1489,478,2247,470,2244,465,2241,493,488,484,2250,498,495,1536,1533,1530,1539,2187,2186,2184,2182,1432,2179,1430,2176,1427,414,412,2197,409,2195,405,2193,2190,426,424,421,2203,418,2201,431,429,1473,1471,1469,1466,434,1477,1475,2478,2472,2470,2459,2457,2454,2462,803,2437,2432,2429,1726,2443,2440,792,789,785,2401,2399,2393,1702,2389,1699,2411,2408,2405,745,741,2415,758,755,1721,2358,2357,2355,2353,1661,2350,1660,2347,1657,2368,2366,2364,2361,1666,690,687,2374,683,2372,701,698,705,1691,1689,2619,2617,2610,2608,2605,2613,2593,2588,2585,1803,2599,2596,2563,2561,2555,1797,2551,1795,2573,2570,2567,2577,2525,2524,2522,2520,1786,2517,1785,2514,1783,2535,2533,2531,2528,1788,2541,2539,906,903,911,2721,1844,2715,2712,1838,1836,2699,2696,2693,2703,1827,1826,1824,2673,2671,2669,2666,1829,2679,2677,1858,1857,2772,1854,1853,1851,1856,2766,2764,143,1987,139,1986,135,133,131,1984,128,1983,125,1981,138,137,136,1985,1133,1132,1130,112,110,1974,107,1973,104,1971,1969,122,121,119,117,1977,114,1976,124,1115,1114,1112,1110,1117,1116,84,83,1953,81,1952,78,1950,1948,1945,94,93,91,1959,88,1958,85,1955,99,97,95,1961,1086,1085,1083,1081,1078,100,1090,1089,1087,1091,49,47,1917,44,1915,1913,1910,1907,59,1926,56,1925,53,1922,1919,66,64,1931,61,1929,1042,1040,1038,71,1035,70,1032,68,1048,1047,1045,1043,1050,1049,12,10,1869,1867,1864,1861,21,1880,19,1877,1874,1871,28,1888,25,1886,22,1883,982,980,977,974,32,30,991,989,987,984,34,995,994,992,2151,2150,2147,2146,2144,356,355,354,2149,2139,2138,2136,2134,1359,343,341,338,2143,335,2141,348,347,346,1376,1374,2124,2123,2121,2119,1326,2116,1324,310,308,305,2131,302,2129,298,2127,320,318,316,313,2133,322,321,1355,1353,1351,1357,2092,2091,2089,2087,1276,2084,1274,2081,1271,259,2102,256,2100,252,2098,2095,272,269,2108,266,2106,281,279,277,1317,1315,1313,1310,282,1321,1319,2039,2037,2035,2032,1203,2029,1200,1197,207,2053,205,2051,201,2049,2046,2043,220,218,2064,215,2062,211,2059,228,226,223,2069,1259,1257,1254,232,1251,230,1267,1265,1263,2316,2315,2312,2311,2309,2314,2304,2303,2301,2299,1593,2308,2306,590,2288,2287,2285,2283,1578,2280,1577,2295,2293,2291,579,577,574,571,2298,582,581,1592,2263,2262,2260,2258,1545,2255,1544,2252,1541,2273,2271,2269,2266,1550,535,532,2279,528,2277,546,543,549,1575,1573,2224,2222,2220,1486,2217,1485,2214,1482,1479,2238,2236,2234,2231,1496,2228,1492,480,477,2248,473,2246,469,2243,490,487,2251,497,1537,1535,1532,2477,2476,2474,2479,2469,2468,2466,2464,1730,2473,2471,2453,2452,2450,2448,1729,2445,1728,2460,2458,2456,2463,805,804,2428,2427,2425,2423,1725,2420,1724,2417,1722,2438,2436,2434,2431,1727,2444,2442,793,791,788,795,2388,2386,2384,1697,2381,1696,2378,1694,1692,2402,2400,2398,2395,1703,2392,1701,2412,2410,2407,751,748,744,2416,759,757,1807,2620,2618,1806,1805,2611,2609,2607,2614,1802,1801,1799,2594,2592,2590,2587,1804,2600,2598,1794,1793,1791,1789,2564,2562,2560,2557,1798,2554,1796,2574,2572,2569,2578,1847,1846,2722,1843,1842,1840,1845,2716,2714,1835,1834,1832,1830,1839,1837,2700,2698,2695,2704,1817,1811,1810,897,862,1777,829,826,838,1760,1758,808,2481,1741,1740,1738,1743,2624,1818,2726,2776,782,740,737,1715,686,679,695,1682,1680,639,628,2339,647,644,1645,1643,1640,1648,602,600,597,595,2320,593,2318,609,607,604,1611,1610,1608,1606,613,1615,1613,2328,926,924,892,886,899,857,850,2505,1778,824,823,821,819,2488,818,2486,833,831,828,840,1761,1759,2649,2632,2630,2746,2734,2732,2782,2781,570,567,1587,531,527,523,540,1566,1564,476,467,463,2240,486,483,1524,1521,1518,1529,411,403,2192,399,2189,423,416,1462,1457,1454,428,1468,1465,2210,366,363,2158,360,2156,357,2153,376,373,370,2163,1410,1409,1407,1405,382,1402,380,1417,1415,1412,1421,2175,2174,777,774,771,784,732,725,722,2404,743,1716,676,674,668,2363,665,2360,685,1684,1681,626,624,622,2335,620,2333,617,2330,641,635,649,1646,1644,1642,2566,928,925,2530,2527,894,891,888,2501,2499,2496,858,856,854,851,1779,2692,2668,2665,2645,2643,2640,2651,2768,2759,2757,2744,2743,2741,2748,352,1382,340,337,333,1371,1369,307,300,296,2126,315,312,1347,1342,1350,261,258,250,2097,246,2094,271,268,264,1306,1301,1298,276,1312,1309,2115,203,2048,195,2045,191,2041,213,209,2056,1246,1244,1238,225,1234,222,1256,1253,1249,1262,2080,2079,154,1997,150,1995,147,1992,1989,163,160,2004,156,2001,1175,1174,1172,1170,1167,170,1164,167,1185,1183,1180,1177,174,1190,1188,2025,2024,2022,587,586,564,559,556,2290,573,1588,520,518,512,2268,508,2265,530,1568,1565,461,457,2233,450,2230,446,2226,479,471,489,1526,1523,1520,397,395,2185,392,2183,389,2180,2177,410,2194,402,422,1463,1461,1459,1456,1470,2455,799,2433,2430,779,776,773,2397,2394,2390,734,728,724,746,1717,2356,2354,2351,2348,1658,677,675,673,670,667,688,1685,1683,2606,2589,2586,2559,2556,2552,927,2523,2521,2518,2515,1784,2532,895,893,890,2718,2709,2707,2689,2687,2684,2663,2662,2660,2658,1825,2667,2769,1852,2760,2758,142,141,1139,1138,134,132,129,126,1982,1129,1128,1126,1131,113,111,108,105,1972,101,1970,120,118,115,1109,1108,1106,1104,123,1113,1111,82,79,1951,75,1949,72,1946,92,89,86,1956,1077,1076,1074,1072,98,1069,96,1084,1082,1079,1088,1968,1967,48,45,1916,42,1914,39,1911,1908,60,57,54,1923,50,1920,1031,1030,1028,1026,67,1023,65,1020,62,1041,1039,1036,1033,69,1046,1044,1944,1943,1941,11,9,1868,7,1865,1862,1859,20,1878,16,1875,13,1872,970,968,966,963,29,960,26,23,983,981,978,975,33,971,31,990,988,985,1906,1904,1902,993,351,2145,1383,331,330,328,326,2137,323,2135,339,1372,1370,294,293,291,289,2122,286,2120,283,2117,309,303,317,1348,1346,1344,245,244,242,2090,239,2088,236,2085,2082,260,2099,249,270,1307,1305,1303,1300,1314,189,2038,186,2036,183,2033,2030,2026,206,198,2047,194,216,1247,1245,1243,1240,227,1237,1255,2310,2302,2300,2286,2284,2281,565,563,561,558,575,1589,2261,2259,2256,2253,1542,521,519,517,514,2270,511,533,1569,1567,2223,2221,2218,2215,1483,2211,1480,459,456,453,2232,449,474,491,1527,1525,1522,2475,2467,2465,2451,2449,2446,801,800,2426,2424,2421,2418,1723,2435,780,778,775,2387,2385,2382,2379,1695,2375,1693,2396,735,733,730,727,749,1718,2616,2615,2604,2603,2601,2584,2583,2581,2579,1800,2591,2550,2549,2547,2545,1792,2542,1790,2558,929,2719,1841,2710,2708,1833,1831,2690,2688,2686,1815,1809,1808,1774,1756,1754,1737,1736,1734,1739,1816,1711,1676,1674,633,629,1638,1636,1633,1641,598,1605,1604,1602,1600,605,1609,1607,2327,887,853,1775,822,820,1757,1755,1584,524,1560,1558,468,464,1514,1511,1508,1519,408,404,400,1452,1447,1444,417,1458,1455,2208,364,361,358,2154,1401,1400,1398,1396,374,1393,371,1408,1406,1403,1413,2173,2172,772,726,723,1712,672,669,666,682,1678,1675,625,623,621,618,2331,636,632,1639,1637,1635,920,918,884,880,889,849,848,847,846,2497,855,852,1776,2641,2742,2787,1380,334,1367,1365,301,297,1340,1338,1335,1343,255,251,247,1296,1291,1288,265,1302,1299,2113,204,196,192,2042,1232,1230,1224,214,1220,210,1242,1239,1235,1250,2077,2075,151,148,1993,144,1990,1163,1162,1160,1158,1155,161,1152,157,1173,1171,1168,1165,168,1181,1178,2021,2020,2018,2023,585,560,557,1585,516,509,1562,1559,458,447,2227,472,1516,1513,1510,398,396,393,390,2181,386,2178,407,1453,1451,1449,1446,420,1460,2209,769,764,720,712,2391,729,1713,664,663,661,659,2352,656,2349,671,1679,1677,2553,922,919,2519,2516,885,883,881,2685,2661,2659,2767,2756,2755,140,1137,1136,130,127,1125,1124,1122,1127,109,106,102,1103,1102,1100,1098,116,1107,1105,1980,80,76,73,1947,1068,1067,1065,1063,90,1060,87,1075,1073,1070,1080,1966,1965,46,43,40,1912,36,1909,1019,1018,1016,1014,58,1011,55,1008,51,1029,1027,1024,1021,63,1037,1034,1940,1939,1937,1942,8,1866,4,1863,1,1860,956,954,952,949,946,17,14,969,967,964,961,27,957,24,979,976,972,1901,1900,1898,1896,986,1905,1903,350,349,1381,329,327,324,1368,1366,292,290,287,284,2118,304,1341,1339,1337,1345,243,240,237,2086,233,2083,254,1297,1295,1293,1290,1304,2114,190,187,184,2034,180,2031,177,2027,199,1233,1231,1229,1226,217,1223,1241,2078,2076,584,555,554,552,550,2282,562,1586,507,506,504,502,2257,499,2254,515,1563,1561,445,443,441,2219,438,2216,435,2212,460,454,475,1517,1515,1512,2447,798,797,2422,2419,770,768,766,2383,2380,2376,721,719,717,714,731,1714,2602,2582,2580,2548,2546,2543,923,921,2717,2706,2705,2683,2682,2680,1771,1752,1750,1733,1732,1731,1735,1814,1707,1670,1668,1631,1629,1626,1634,1599,1598,1596,1594,1603,1601,2326,1772,1753,1751,1581,1554,1552,1504,1501,1498,1509,1442,1437,1434,401,1448,1445,2206,1392,1391,1389,1387,1384,359,1399,1397,1394,1404,2171,2170,1708,1672,1669,619,1632,1630,1628,1773,1378,1363,1361,1333,1328,1336,1286,1281,1278,248,1292,1289,2111,1218,1216,1210,197,1206,193,1228,1225,1221,1236,2073,2071,1151,1150,1148,1146,152,1143,149,1140,145,1161,1159,1156,1153,158,1169,1166,2017,2016,2014,2019,1582,510,1556,1553,452,448,1506,1500,394,391,387,1443,1441,1439,1436,1450,2207,765,716,713,1709,662,660,657,1673,1671,916,914,879,878,877,882,1135,1134,1121,1120,1118,1123,1097,1096,1094,1092,103,1101,1099,1979,1059,1058,1056,1054,77,1051,74,1066,1064,1061,1071,1964,1963,1007,1006,1004,1002,999,41,996,37,1017,1015,1012,1009,52,1025,1022,1936,1935,1933,1938,942,940,938,935,932,5,2,955,953,950,947,18,943,15,965,962,958,1895,1894,1892,1890,973,1899,1897,1379,325,1364,1362,288,285,1334,1332,1330,241,238,234,1287,1285,1283,1280,1294,2112,188,185,181,178,2028,1219,1217,1215,1212,200,1209,1227,2074,2072,583,553,551,1583,505,503,500,513,1557,1555,444,442,439,436,2213,455,451,1507,1505,1502,796,763,762,760,767,711,710,708,706,2377,718,715,1710,2544,917,915,2681,1627,1597,1595,2325,1769,1749,1747,1499,1438,1435,2204,1390,1388,1385,1395,2169,2167,1704,1665,1662,1625,1623,1620,1770,1329,1282,1279,2109,1214,1207,1222,2068,2065,1149,1147,1144,1141,146,1157,1154,2013,2011,2008,2015,1579,1549,1546,1495,1487,1433,1431,1428,1425,388,1440,2205,1705,658,1667,1664,1119,1095,1093,1978,1057,1055,1052,1062,1962,1960,1005,1003,1e3,997,38,1013,1010,1932,1930,1927,1934,941,939,936,933,6,930,3,951,948,944,1889,1887,1884,1881,959,1893,1891,35,1377,1360,1358,1327,1325,1322,1331,1277,1275,1272,1269,235,1284,2110,1205,1204,1201,1198,182,1195,179,1213,2070,2067,1580,501,1551,1548,440,437,1497,1494,1490,1503,761,709,707,1706,913,912,2198,1386,2164,2161,1621,1766,2103,1208,2058,2054,1145,1142,2005,2002,1999,2009,1488,1429,1426,2200,1698,1659,1656,1975,1053,1957,1954,1001,998,1924,1921,1918,1928,937,934,931,1879,1876,1873,1870,945,1885,1882,1323,1273,1270,2105,1202,1199,1196,1211,2061,2057,1576,1543,1540,1484,1481,1478,1491,1700]);class Y1{constructor(it,ct){this.bits=it,this.points=ct}getBits(){return this.bits}getPoints(){return this.points}}class Bl{static detectMultiple(it,ct,pt){let Ct=it.getBlackMatrix(),It=Bl.detect(pt,Ct);return It.length||(Ct=Ct.clone(),Ct.rotate180(),It=Bl.detect(pt,Ct)),new Y1(Ct,It)}static detect(it,ct){const pt=new Array;let Ct=0,It=0,Dt=!1;for(;Ct<ct.getHeight();){const qt=Bl.findVertices(ct,Ct,It);if(qt[0]==null&&qt[3]==null){if(!Dt)break;Dt=!1,It=0;for(const Jt of pt)Jt[1]!=null&&(Ct=Math.trunc(Math.max(Ct,Jt[1].getY()))),Jt[3]!=null&&(Ct=Math.max(Ct,Math.trunc(Jt[3].getY())));Ct+=Bl.ROW_STEP;continue}if(Dt=!0,pt.push(qt),!it)break;qt[2]!=null?(It=Math.trunc(qt[2].getX()),Ct=Math.trunc(qt[2].getY())):(It=Math.trunc(qt[4].getX()),Ct=Math.trunc(qt[4].getY()))}return pt}static findVertices(it,ct,pt){const Ct=it.getHeight(),It=it.getWidth(),Dt=new Array(8);return Bl.copyToResult(Dt,Bl.findRowsWithPattern(it,Ct,It,ct,pt,Bl.START_PATTERN),Bl.INDEXES_START_PATTERN),Dt[4]!=null&&(pt=Math.trunc(Dt[4].getX()),ct=Math.trunc(Dt[4].getY())),Bl.copyToResult(Dt,Bl.findRowsWithPattern(it,Ct,It,ct,pt,Bl.STOP_PATTERN),Bl.INDEXES_STOP_PATTERN),Dt}static copyToResult(it,ct,pt){for(let Ct=0;Ct<pt.length;Ct++)it[pt[Ct]]=ct[Ct]}static findRowsWithPattern(it,ct,pt,Ct,It,Dt){const qt=new Array(4);let Jt=!1;const ar=new Int32Array(Dt.length);for(;Ct<ct;Ct+=Bl.ROW_STEP){let Pr=Bl.findGuardPattern(it,It,Ct,pt,!1,Dt,ar);if(Pr!=null){for(;Ct>0;){const Gr=Bl.findGuardPattern(it,It,--Ct,pt,!1,Dt,ar);if(Gr!=null)Pr=Gr;else{Ct++;break}}qt[0]=new Ss(Pr[0],Ct),qt[1]=new Ss(Pr[1],Ct),Jt=!0;break}}let Er=Ct+1;if(Jt){let Pr=0,Gr=Int32Array.from([Math.trunc(qt[0].getX()),Math.trunc(qt[1].getX())]);for(;Er<ct;Er++){const pn=Bl.findGuardPattern(it,Gr[0],Er,pt,!1,Dt,ar);if(pn!=null&&Math.abs(Gr[0]-pn[0])<Bl.MAX_PATTERN_DRIFT&&Math.abs(Gr[1]-pn[1])<Bl.MAX_PATTERN_DRIFT)Gr=pn,Pr=0;else{if(Pr>Bl.SKIPPED_ROW_COUNT_MAX)break;Pr++}}Er-=Pr+1,qt[2]=new Ss(Gr[0],Er),qt[3]=new Ss(Gr[1],Er)}return Er-Ct<Bl.BARCODE_MIN_HEIGHT&&Ut.fill(qt,null),qt}static findGuardPattern(it,ct,pt,Ct,It,Dt,qt){Ut.fillWithin(qt,0,qt.length,0);let Jt=ct,ar=0;for(;it.get(Jt,pt)&&Jt>0&&ar++<Bl.MAX_PIXEL_DRIFT;)Jt--;let Er=Jt,Pr=0,Gr=Dt.length;for(let pn=It;Er<Ct;Er++)if(it.get(Er,pt)!==pn)qt[Pr]++;else{if(Pr===Gr-1){if(Bl.patternMatchVariance(qt,Dt,Bl.MAX_INDIVIDUAL_VARIANCE)<Bl.MAX_AVG_VARIANCE)return new Int32Array([Jt,Er]);Jt+=qt[0]+qt[1],Bt.arraycopy(qt,2,qt,0,Pr-1),qt[Pr-1]=0,qt[Pr]=0,Pr--}else Pr++;qt[Pr]=1,pn=!pn}return Pr===Gr-1&&Bl.patternMatchVariance(qt,Dt,Bl.MAX_INDIVIDUAL_VARIANCE)<Bl.MAX_AVG_VARIANCE?new Int32Array([Jt,Er-1]):null}static patternMatchVariance(it,ct,pt){let Ct=it.length,It=0,Dt=0;for(let ar=0;ar<Ct;ar++)It+=it[ar],Dt+=ct[ar];if(It<Dt)return 1/0;let qt=It/Dt;pt*=qt;let Jt=0;for(let ar=0;ar<Ct;ar++){let Er=it[ar],Pr=ct[ar]*qt,Gr=Er>Pr?Er-Pr:Pr-Er;if(Gr>pt)return 1/0;Jt+=Gr}return Jt/It}}Bl.INDEXES_START_PATTERN=Int32Array.from([0,4,1,5]),Bl.INDEXES_STOP_PATTERN=Int32Array.from([6,2,7,3]),Bl.MAX_AVG_VARIANCE=.42,Bl.MAX_INDIVIDUAL_VARIANCE=.8,Bl.START_PATTERN=Int32Array.from([8,1,1,1,1,1,1,3]),Bl.STOP_PATTERN=Int32Array.from([7,1,1,3,1,1,1,2,1]),Bl.MAX_PIXEL_DRIFT=3,Bl.MAX_PATTERN_DRIFT=5,Bl.SKIPPED_ROW_COUNT_MAX=25,Bl.ROW_STEP=5,Bl.BARCODE_MIN_HEIGHT=10;class Du{constructor(it,ct){if(ct.length===0)throw new St;this.field=it;let pt=ct.length;if(pt>1&&ct[0]===0){let Ct=1;for(;Ct<pt&&ct[Ct]===0;)Ct++;Ct===pt?this.coefficients=new Int32Array([0]):(this.coefficients=new Int32Array(pt-Ct),Bt.arraycopy(ct,Ct,this.coefficients,0,this.coefficients.length))}else this.coefficients=ct}getCoefficients(){return this.coefficients}getDegree(){return this.coefficients.length-1}isZero(){return this.coefficients[0]===0}getCoefficient(it){return this.coefficients[this.coefficients.length-1-it]}evaluateAt(it){if(it===0)return this.getCoefficient(0);if(it===1){let Ct=0;for(let It of this.coefficients)Ct=this.field.add(Ct,It);return Ct}let ct=this.coefficients[0],pt=this.coefficients.length;for(let Ct=1;Ct<pt;Ct++)ct=this.field.add(this.field.multiply(it,ct),this.coefficients[Ct]);return ct}add(it){if(!this.field.equals(it.field))throw new St("ModulusPolys do not have same ModulusGF field");if(this.isZero())return it;if(it.isZero())return this;let ct=this.coefficients,pt=it.coefficients;if(ct.length>pt.length){let Dt=ct;ct=pt,pt=Dt}let Ct=new Int32Array(pt.length),It=pt.length-ct.length;Bt.arraycopy(pt,0,Ct,0,It);for(let Dt=It;Dt<pt.length;Dt++)Ct[Dt]=this.field.add(ct[Dt-It],pt[Dt]);return new Du(this.field,Ct)}subtract(it){if(!this.field.equals(it.field))throw new St("ModulusPolys do not have same ModulusGF field");return it.isZero()?this:this.add(it.negative())}multiply(it){return it instanceof Du?this.multiplyOther(it):this.multiplyScalar(it)}multiplyOther(it){if(!this.field.equals(it.field))throw new St("ModulusPolys do not have same ModulusGF field");if(this.isZero()||it.isZero())return new Du(this.field,new Int32Array([0]));let ct=this.coefficients,pt=ct.length,Ct=it.coefficients,It=Ct.length,Dt=new Int32Array(pt+It-1);for(let qt=0;qt<pt;qt++){let Jt=ct[qt];for(let ar=0;ar<It;ar++)Dt[qt+ar]=this.field.add(Dt[qt+ar],this.field.multiply(Jt,Ct[ar]))}return new Du(this.field,Dt)}negative(){let it=this.coefficients.length,ct=new Int32Array(it);for(let pt=0;pt<it;pt++)ct[pt]=this.field.subtract(0,this.coefficients[pt]);return new Du(this.field,ct)}multiplyScalar(it){if(it===0)return new Du(this.field,new Int32Array([0]));if(it===1)return this;let ct=this.coefficients.length,pt=new Int32Array(ct);for(let Ct=0;Ct<ct;Ct++)pt[Ct]=this.field.multiply(this.coefficients[Ct],it);return new Du(this.field,pt)}multiplyByMonomial(it,ct){if(it<0)throw new St;if(ct===0)return new Du(this.field,new Int32Array([0]));let pt=this.coefficients.length,Ct=new Int32Array(pt+it);for(let It=0;It<pt;It++)Ct[It]=this.field.multiply(this.coefficients[It],ct);return new Du(this.field,Ct)}toString(){let it=new Jr;for(let ct=this.getDegree();ct>=0;ct--){let pt=this.getCoefficient(ct);pt!==0&&(pt<0?(it.append(" - "),pt=-pt):it.length()>0&&it.append(" + "),(ct===0||pt!==1)&&it.append(pt),ct!==0&&(ct===1?it.append("x"):(it.append("x^"),it.append(ct))))}return it.toString()}}class wx{add(it,ct){return(it+ct)%this.modulus}subtract(it,ct){return(this.modulus+it-ct)%this.modulus}exp(it){return this.expTable[it]}log(it){if(it===0)throw new St;return this.logTable[it]}inverse(it){if(it===0)throw new lo;return this.expTable[this.modulus-this.logTable[it]-1]}multiply(it,ct){return it===0||ct===0?0:this.expTable[(this.logTable[it]+this.logTable[ct])%(this.modulus-1)]}getSize(){return this.modulus}equals(it){return it===this}}class R0 extends wx{constructor(it,ct){super(),this.modulus=it,this.expTable=new Int32Array(it),this.logTable=new Int32Array(it);let pt=1;for(let Ct=0;Ct<it;Ct++)this.expTable[Ct]=pt,pt=pt*ct%it;for(let Ct=0;Ct<it-1;Ct++)this.logTable[this.expTable[Ct]]=Ct;this.zero=new Du(this,new Int32Array([0])),this.one=new Du(this,new Int32Array([1]))}getZero(){return this.zero}getOne(){return this.one}buildMonomial(it,ct){if(it<0)throw new St;if(ct===0)return this.zero;let pt=new Int32Array(it+1);return pt[0]=ct,new Du(this,pt)}}R0.PDF417_GF=new R0(_a.NUMBER_OF_CODEWORDS,3);class p0{constructor(){this.field=R0.PDF417_GF}decode(it,ct,pt){let Ct=new Du(this.field,it),It=new Int32Array(ct),Dt=!1;for(let An=ct;An>0;An--){let Pn=Ct.evaluateAt(this.field.exp(An));It[ct-An]=Pn,Pn!==0&&(Dt=!0)}if(!Dt)return 0;let qt=this.field.getOne();if(pt!=null)for(const An of pt){let Pn=this.field.exp(it.length-1-An),Xn=new Du(this.field,new Int32Array([this.field.subtract(0,Pn),1]));qt=qt.multiply(Xn)}let Jt=new Du(this.field,It),ar=this.runEuclideanAlgorithm(this.field.buildMonomial(ct,1),Jt,ct),Er=ar[0],Pr=ar[1],Gr=this.findErrorLocations(Er),pn=this.findErrorMagnitudes(Pr,Er,Gr);for(let An=0;An<Gr.length;An++){let Pn=it.length-1-this.field.log(Gr[An]);if(Pn<0)throw Pt.getChecksumInstance();it[Pn]=this.field.subtract(it[Pn],pn[An])}return Gr.length}runEuclideanAlgorithm(it,ct,pt){if(it.getDegree()<ct.getDegree()){let Gr=it;it=ct,ct=Gr}let Ct=it,It=ct,Dt=this.field.getZero(),qt=this.field.getOne();for(;It.getDegree()>=Math.round(pt/2);){let Gr=Ct,pn=Dt;if(Ct=It,Dt=qt,Ct.isZero())throw Pt.getChecksumInstance();It=Gr;let An=this.field.getZero(),Pn=Ct.getCoefficient(Ct.getDegree()),Xn=this.field.inverse(Pn);for(;It.getDegree()>=Ct.getDegree()&&!It.isZero();){let os=It.getDegree()-Ct.getDegree(),Ks=this.field.multiply(It.getCoefficient(It.getDegree()),Xn);An=An.add(this.field.buildMonomial(os,Ks)),It=It.subtract(Ct.multiplyByMonomial(os,Ks))}qt=An.multiply(Dt).subtract(pn).negative()}let Jt=qt.getCoefficient(0);if(Jt===0)throw Pt.getChecksumInstance();let ar=this.field.inverse(Jt),Er=qt.multiply(ar),Pr=It.multiply(ar);return[Er,Pr]}findErrorLocations(it){let ct=it.getDegree(),pt=new Int32Array(ct),Ct=0;for(let It=1;It<this.field.getSize()&&Ct<ct;It++)it.evaluateAt(It)===0&&(pt[Ct]=this.field.inverse(It),Ct++);if(Ct!==ct)throw Pt.getChecksumInstance();return pt}findErrorMagnitudes(it,ct,pt){let Ct=ct.getDegree(),It=new Int32Array(Ct);for(let ar=1;ar<=Ct;ar++)It[Ct-ar]=this.field.multiply(ar,ct.getCoefficient(ar));let Dt=new Du(this.field,It),qt=pt.length,Jt=new Int32Array(qt);for(let ar=0;ar<qt;ar++){let Er=this.field.inverse(pt[ar]),Pr=this.field.subtract(0,it.evaluateAt(Er)),Gr=this.field.inverse(Dt.evaluateAt(Er));Jt[ar]=this.field.multiply(Pr,Gr)}return Jt}}class J0{constructor(it,ct,pt,Ct,It){it instanceof J0?this.constructor_2(it):this.constructor_1(it,ct,pt,Ct,It)}constructor_1(it,ct,pt,Ct,It){const Dt=ct==null||pt==null,qt=Ct==null||It==null;if(Dt&&qt)throw new Fr;Dt?(ct=new Ss(0,Ct.getY()),pt=new Ss(0,It.getY())):qt&&(Ct=new Ss(it.getWidth()-1,ct.getY()),It=new Ss(it.getWidth()-1,pt.getY())),this.image=it,this.topLeft=ct,this.bottomLeft=pt,this.topRight=Ct,this.bottomRight=It,this.minX=Math.trunc(Math.min(ct.getX(),pt.getX())),this.maxX=Math.trunc(Math.max(Ct.getX(),It.getX())),this.minY=Math.trunc(Math.min(ct.getY(),Ct.getY())),this.maxY=Math.trunc(Math.max(pt.getY(),It.getY()))}constructor_2(it){this.image=it.image,this.topLeft=it.getTopLeft(),this.bottomLeft=it.getBottomLeft(),this.topRight=it.getTopRight(),this.bottomRight=it.getBottomRight(),this.minX=it.getMinX(),this.maxX=it.getMaxX(),this.minY=it.getMinY(),this.maxY=it.getMaxY()}static merge(it,ct){return it==null?ct:ct==null?it:new J0(it.image,it.topLeft,it.bottomLeft,ct.topRight,ct.bottomRight)}addMissingRows(it,ct,pt){let Ct=this.topLeft,It=this.bottomLeft,Dt=this.topRight,qt=this.bottomRight;if(it>0){let Jt=pt?this.topLeft:this.topRight,ar=Math.trunc(Jt.getY()-it);ar<0&&(ar=0);let Er=new Ss(Jt.getX(),ar);pt?Ct=Er:Dt=Er}if(ct>0){let Jt=pt?this.bottomLeft:this.bottomRight,ar=Math.trunc(Jt.getY()+ct);ar>=this.image.getHeight()&&(ar=this.image.getHeight()-1);let Er=new Ss(Jt.getX(),ar);pt?It=Er:qt=Er}return new J0(this.image,Ct,It,Dt,qt)}getMinX(){return this.minX}getMaxX(){return this.maxX}getMinY(){return this.minY}getMaxY(){return this.maxY}getTopLeft(){return this.topLeft}getTopRight(){return this.topRight}getBottomLeft(){return this.bottomLeft}getBottomRight(){return this.bottomRight}}class Q1{constructor(it,ct,pt,Ct){this.columnCount=it,this.errorCorrectionLevel=Ct,this.rowCountUpperPart=ct,this.rowCountLowerPart=pt,this.rowCount=ct+pt}getColumnCount(){return this.columnCount}getErrorCorrectionLevel(){return this.errorCorrectionLevel}getRowCount(){return this.rowCount}getRowCountUpperPart(){return this.rowCountUpperPart}getRowCountLowerPart(){return this.rowCountLowerPart}}class I0{constructor(){this.buffer=""}static form(it,ct){let pt=-1;function Ct(Dt,qt,Jt,ar,Er,Pr){if(Dt==="%%")return"%";if(ct[++pt]===void 0)return;Dt=ar?parseInt(ar.substr(1)):void 0;let Gr=Er?parseInt(Er.substr(1)):void 0,pn;switch(Pr){case"s":pn=ct[pt];break;case"c":pn=ct[pt][0];break;case"f":pn=parseFloat(ct[pt]).toFixed(Dt);break;case"p":pn=parseFloat(ct[pt]).toPrecision(Dt);break;case"e":pn=parseFloat(ct[pt]).toExponential(Dt);break;case"x":pn=parseInt(ct[pt]).toString(Gr||16);break;case"d":pn=parseFloat(parseInt(ct[pt],Gr||10).toPrecision(Dt)).toFixed(0);break}pn=typeof pn=="object"?JSON.stringify(pn):(+pn).toString(Gr);let An=parseInt(Jt),Pn=Jt&&Jt[0]+""=="0"?"0":" ";for(;pn.length<An;)pn=qt!==void 0?pn+Pn:Pn+pn;return pn}let It=/%(-)?(0?[0-9]+)?([.][0-9]+)?([#][0-9]+)?([scfpexd%])/g;return it.replace(It,Ct)}format(it,...ct){this.buffer+=I0.form(it,ct)}toString(){return this.buffer}}class qo{constructor(it){this.boundingBox=new J0(it),this.codewords=new Array(it.getMaxY()-it.getMinY()+1)}getCodewordNearby(it){let ct=this.getCodeword(it);if(ct!=null)return ct;for(let pt=1;pt<qo.MAX_NEARBY_DISTANCE;pt++){let Ct=this.imageRowToCodewordIndex(it)-pt;if(Ct>=0&&(ct=this.codewords[Ct],ct!=null)||(Ct=this.imageRowToCodewordIndex(it)+pt,Ct<this.codewords.length&&(ct=this.codewords[Ct],ct!=null)))return ct}return null}imageRowToCodewordIndex(it){return it-this.boundingBox.getMinY()}setCodeword(it,ct){this.codewords[this.imageRowToCodewordIndex(it)]=ct}getCodeword(it){return this.codewords[this.imageRowToCodewordIndex(it)]}getBoundingBox(){return this.boundingBox}getCodewords(){return this.codewords}toString(){const it=new I0;let ct=0;for(const pt of this.codewords){if(pt==null){it.format("%3d:    |   %n",ct++);continue}it.format("%3d: %3d|%3d%n",ct++,pt.getRowNumber(),pt.getValue())}return it.toString()}}qo.MAX_NEARBY_DISTANCE=5;class z0{constructor(){this.values=new Map}setValue(it){it=Math.trunc(it);let ct=this.values.get(it);ct==null&&(ct=0),ct++,this.values.set(it,ct)}getValue(){let it=-1,ct=new Array;for(const[pt,Ct]of this.values.entries()){const It={getKey:()=>pt,getValue:()=>Ct};It.getValue()>it?(it=It.getValue(),ct=[],ct.push(It.getKey())):It.getValue()===it&&ct.push(It.getKey())}return _a.toIntArray(ct)}getConfidence(it){return this.values.get(it)}}class Cx extends qo{constructor(it,ct){super(it),this._isLeft=ct}setRowNumbers(){for(let it of this.getCodewords())it!=null&&it.setRowNumberAsRowIndicatorColumn()}adjustCompleteIndicatorColumnRowNumbers(it){let ct=this.getCodewords();this.setRowNumbers(),this.removeIncorrectCodewords(ct,it);let pt=this.getBoundingBox(),Ct=this._isLeft?pt.getTopLeft():pt.getTopRight(),It=this._isLeft?pt.getBottomLeft():pt.getBottomRight(),Dt=this.imageRowToCodewordIndex(Math.trunc(Ct.getY())),qt=this.imageRowToCodewordIndex(Math.trunc(It.getY())),Jt=-1,ar=1,Er=0;for(let Pr=Dt;Pr<qt;Pr++){if(ct[Pr]==null)continue;let Gr=ct[Pr],pn=Gr.getRowNumber()-Jt;if(pn===0)Er++;else if(pn===1)ar=Math.max(ar,Er),Er=1,Jt=Gr.getRowNumber();else if(pn<0||Gr.getRowNumber()>=it.getRowCount()||pn>Pr)ct[Pr]=null;else{let An;ar>2?An=(ar-2)*pn:An=pn;let Pn=An>=Pr;for(let Xn=1;Xn<=An&&!Pn;Xn++)Pn=ct[Pr-Xn]!=null;Pn?ct[Pr]=null:(Jt=Gr.getRowNumber(),Er=1)}}}getRowHeights(){let it=this.getBarcodeMetadata();if(it==null)return null;this.adjustIncompleteIndicatorColumnRowNumbers(it);let ct=new Int32Array(it.getRowCount());for(let pt of this.getCodewords())if(pt!=null){let Ct=pt.getRowNumber();if(Ct>=ct.length)continue;ct[Ct]++}return ct}adjustIncompleteIndicatorColumnRowNumbers(it){let ct=this.getBoundingBox(),pt=this._isLeft?ct.getTopLeft():ct.getTopRight(),Ct=this._isLeft?ct.getBottomLeft():ct.getBottomRight(),It=this.imageRowToCodewordIndex(Math.trunc(pt.getY())),Dt=this.imageRowToCodewordIndex(Math.trunc(Ct.getY())),qt=this.getCodewords(),Jt=-1;for(let ar=It;ar<Dt;ar++){if(qt[ar]==null)continue;let Er=qt[ar];Er.setRowNumberAsRowIndicatorColumn();let Pr=Er.getRowNumber()-Jt;Pr===0||(Pr===1?Jt=Er.getRowNumber():Er.getRowNumber()>=it.getRowCount()?qt[ar]=null:Jt=Er.getRowNumber())}}getBarcodeMetadata(){let it=this.getCodewords(),ct=new z0,pt=new z0,Ct=new z0,It=new z0;for(let qt of it){if(qt==null)continue;qt.setRowNumberAsRowIndicatorColumn();let Jt=qt.getValue()%30,ar=qt.getRowNumber();switch(this._isLeft||(ar+=2),ar%3){case 0:pt.setValue(Jt*3+1);break;case 1:It.setValue(Jt/3),Ct.setValue(Jt%3);break;case 2:ct.setValue(Jt+1);break}}if(ct.getValue().length===0||pt.getValue().length===0||Ct.getValue().length===0||It.getValue().length===0||ct.getValue()[0]<1||pt.getValue()[0]+Ct.getValue()[0]<_a.MIN_ROWS_IN_BARCODE||pt.getValue()[0]+Ct.getValue()[0]>_a.MAX_ROWS_IN_BARCODE)return null;let Dt=new Q1(ct.getValue()[0],pt.getValue()[0],Ct.getValue()[0],It.getValue()[0]);return this.removeIncorrectCodewords(it,Dt),Dt}removeIncorrectCodewords(it,ct){for(let pt=0;pt<it.length;pt++){let Ct=it[pt];if(it[pt]==null)continue;let It=Ct.getValue()%30,Dt=Ct.getRowNumber();if(Dt>ct.getRowCount()){it[pt]=null;continue}switch(this._isLeft||(Dt+=2),Dt%3){case 0:It*3+1!==ct.getRowCountUpperPart()&&(it[pt]=null);break;case 1:(Math.trunc(It/3)!==ct.getErrorCorrectionLevel()||It%3!==ct.getRowCountLowerPart())&&(it[pt]=null);break;case 2:It+1!==ct.getColumnCount()&&(it[pt]=null);break}}}isLeft(){return this._isLeft}toString(){return"IsLeft: "+this._isLeft+`
`+super.toString()}}class Sm{constructor(it,ct){this.ADJUST_ROW_NUMBER_SKIP=2,this.barcodeMetadata=it,this.barcodeColumnCount=it.getColumnCount(),this.boundingBox=ct,this.detectionResultColumns=new Array(this.barcodeColumnCount+2)}getDetectionResultColumns(){this.adjustIndicatorColumnRowNumbers(this.detectionResultColumns[0]),this.adjustIndicatorColumnRowNumbers(this.detectionResultColumns[this.barcodeColumnCount+1]);let it=_a.MAX_CODEWORDS_IN_BARCODE,ct;do ct=it,it=this.adjustRowNumbersAndGetCount();while(it>0&&it<ct);return this.detectionResultColumns}adjustIndicatorColumnRowNumbers(it){it!=null&&it.adjustCompleteIndicatorColumnRowNumbers(this.barcodeMetadata)}adjustRowNumbersAndGetCount(){let it=this.adjustRowNumbersByRow();if(it===0)return 0;for(let ct=1;ct<this.barcodeColumnCount+1;ct++){let pt=this.detectionResultColumns[ct].getCodewords();for(let Ct=0;Ct<pt.length;Ct++)pt[Ct]!=null&&(pt[Ct].hasValidRowNumber()||this.adjustRowNumbers(ct,Ct,pt))}return it}adjustRowNumbersByRow(){return this.adjustRowNumbersFromBothRI(),this.adjustRowNumbersFromLRI()+this.adjustRowNumbersFromRRI()}adjustRowNumbersFromBothRI(){if(this.detectionResultColumns[0]==null||this.detectionResultColumns[this.barcodeColumnCount+1]==null)return;let it=this.detectionResultColumns[0].getCodewords(),ct=this.detectionResultColumns[this.barcodeColumnCount+1].getCodewords();for(let pt=0;pt<it.length;pt++)if(it[pt]!=null&&ct[pt]!=null&&it[pt].getRowNumber()===ct[pt].getRowNumber())for(let Ct=1;Ct<=this.barcodeColumnCount;Ct++){let It=this.detectionResultColumns[Ct].getCodewords()[pt];It!=null&&(It.setRowNumber(it[pt].getRowNumber()),It.hasValidRowNumber()||(this.detectionResultColumns[Ct].getCodewords()[pt]=null))}}adjustRowNumbersFromRRI(){if(this.detectionResultColumns[this.barcodeColumnCount+1]==null)return 0;let it=0,ct=this.detectionResultColumns[this.barcodeColumnCount+1].getCodewords();for(let pt=0;pt<ct.length;pt++){if(ct[pt]==null)continue;let Ct=ct[pt].getRowNumber(),It=0;for(let Dt=this.barcodeColumnCount+1;Dt>0&&It<this.ADJUST_ROW_NUMBER_SKIP;Dt--){let qt=this.detectionResultColumns[Dt].getCodewords()[pt];qt!=null&&(It=Sm.adjustRowNumberIfValid(Ct,It,qt),qt.hasValidRowNumber()||it++)}}return it}adjustRowNumbersFromLRI(){if(this.detectionResultColumns[0]==null)return 0;let it=0,ct=this.detectionResultColumns[0].getCodewords();for(let pt=0;pt<ct.length;pt++){if(ct[pt]==null)continue;let Ct=ct[pt].getRowNumber(),It=0;for(let Dt=1;Dt<this.barcodeColumnCount+1&&It<this.ADJUST_ROW_NUMBER_SKIP;Dt++){let qt=this.detectionResultColumns[Dt].getCodewords()[pt];qt!=null&&(It=Sm.adjustRowNumberIfValid(Ct,It,qt),qt.hasValidRowNumber()||it++)}}return it}static adjustRowNumberIfValid(it,ct,pt){return pt==null||pt.hasValidRowNumber()||(pt.isValidRowNumber(it)?(pt.setRowNumber(it),ct=0):++ct),ct}adjustRowNumbers(it,ct,pt){if(!this.detectionResultColumns[it-1])return;let Ct=pt[ct],It=this.detectionResultColumns[it-1].getCodewords(),Dt=It;this.detectionResultColumns[it+1]!=null&&(Dt=this.detectionResultColumns[it+1].getCodewords());let qt=new Array(14);qt[2]=It[ct],qt[3]=Dt[ct],ct>0&&(qt[0]=pt[ct-1],qt[4]=It[ct-1],qt[5]=Dt[ct-1]),ct>1&&(qt[8]=pt[ct-2],qt[10]=It[ct-2],qt[11]=Dt[ct-2]),ct<pt.length-1&&(qt[1]=pt[ct+1],qt[6]=It[ct+1],qt[7]=Dt[ct+1]),ct<pt.length-2&&(qt[9]=pt[ct+2],qt[12]=It[ct+2],qt[13]=Dt[ct+2]);for(let Jt of qt)if(Sm.adjustRowNumber(Ct,Jt))return}static adjustRowNumber(it,ct){return ct==null?!1:ct.hasValidRowNumber()&&ct.getBucket()===it.getBucket()?(it.setRowNumber(ct.getRowNumber()),!0):!1}getBarcodeColumnCount(){return this.barcodeColumnCount}getBarcodeRowCount(){return this.barcodeMetadata.getRowCount()}getBarcodeECLevel(){return this.barcodeMetadata.getErrorCorrectionLevel()}setBoundingBox(it){this.boundingBox=it}getBoundingBox(){return this.boundingBox}setDetectionResultColumn(it,ct){this.detectionResultColumns[it]=ct}getDetectionResultColumn(it){return this.detectionResultColumns[it]}toString(){let it=this.detectionResultColumns[0];it==null&&(it=this.detectionResultColumns[this.barcodeColumnCount+1]);let ct=new I0;for(let pt=0;pt<it.getCodewords().length;pt++){ct.format("CW %3d:",pt);for(let Ct=0;Ct<this.barcodeColumnCount+2;Ct++){if(this.detectionResultColumns[Ct]==null){ct.format("    |   ");continue}let It=this.detectionResultColumns[Ct].getCodewords()[pt];if(It==null){ct.format("    |   ");continue}ct.format(" %3d|%3d",It.getRowNumber(),It.getValue())}ct.format("%n")}return ct.toString()}}class Tm{constructor(it,ct,pt,Ct){this.rowNumber=Tm.BARCODE_ROW_UNKNOWN,this.startX=Math.trunc(it),this.endX=Math.trunc(ct),this.bucket=Math.trunc(pt),this.value=Math.trunc(Ct)}hasValidRowNumber(){return this.isValidRowNumber(this.rowNumber)}isValidRowNumber(it){return it!==Tm.BARCODE_ROW_UNKNOWN&&this.bucket===it%3*3}setRowNumberAsRowIndicatorColumn(){this.rowNumber=Math.trunc(Math.trunc(this.value/30)*3+Math.trunc(this.bucket/3))}getWidth(){return this.endX-this.startX}getStartX(){return this.startX}getEndX(){return this.endX}getBucket(){return this.bucket}getValue(){return this.value}getRowNumber(){return this.rowNumber}setRowNumber(it){this.rowNumber=it}toString(){return this.rowNumber+"|"+this.value}}Tm.BARCODE_ROW_UNKNOWN=-1;class sp{static initialize(){for(let it=0;it<_a.SYMBOL_TABLE.length;it++){let ct=_a.SYMBOL_TABLE[it],pt=ct&1;for(let Ct=0;Ct<_a.BARS_IN_MODULE;Ct++){let It=0;for(;(ct&1)===pt;)It+=1,ct>>=1;pt=ct&1,sp.RATIOS_TABLE[it]||(sp.RATIOS_TABLE[it]=new Array(_a.BARS_IN_MODULE)),sp.RATIOS_TABLE[it][_a.BARS_IN_MODULE-Ct-1]=Math.fround(It/_a.MODULES_IN_CODEWORD)}}this.bSymbolTableReady=!0}static getDecodedValue(it){let ct=sp.getDecodedCodewordValue(sp.sampleBitCounts(it));return ct!==-1?ct:sp.getClosestDecodedValue(it)}static sampleBitCounts(it){let ct=us.sum(it),pt=new Int32Array(_a.BARS_IN_MODULE),Ct=0,It=0;for(let Dt=0;Dt<_a.MODULES_IN_CODEWORD;Dt++){let qt=ct/(2*_a.MODULES_IN_CODEWORD)+Dt*ct/_a.MODULES_IN_CODEWORD;It+it[Ct]<=qt&&(It+=it[Ct],Ct++),pt[Ct]++}return pt}static getDecodedCodewordValue(it){let ct=sp.getBitValue(it);return _a.getCodeword(ct)===-1?-1:ct}static getBitValue(it){let ct=0;for(let pt=0;pt<it.length;pt++)for(let Ct=0;Ct<it[pt];Ct++)ct=ct<<1|(pt%2===0?1:0);return Math.trunc(ct)}static getClosestDecodedValue(it){let ct=us.sum(it),pt=new Array(_a.BARS_IN_MODULE);if(ct>1)for(let Dt=0;Dt<pt.length;Dt++)pt[Dt]=Math.fround(it[Dt]/ct);let Ct=Co.MAX_VALUE,It=-1;this.bSymbolTableReady||sp.initialize();for(let Dt=0;Dt<sp.RATIOS_TABLE.length;Dt++){let qt=0,Jt=sp.RATIOS_TABLE[Dt];for(let ar=0;ar<_a.BARS_IN_MODULE;ar++){let Er=Math.fround(Jt[ar]-pt[ar]);if(qt+=Math.fround(Er*Er),qt>=Ct)break}qt<Ct&&(Ct=qt,It=_a.SYMBOL_TABLE[Dt])}return It}}sp.bSymbolTableReady=!1,sp.RATIOS_TABLE=new Array(_a.SYMBOL_TABLE.length).map(wr=>new Array(_a.BARS_IN_MODULE));class Rm{constructor(){this.segmentCount=-1,this.fileSize=-1,this.timestamp=-1,this.checksum=-1}getSegmentIndex(){return this.segmentIndex}setSegmentIndex(it){this.segmentIndex=it}getFileId(){return this.fileId}setFileId(it){this.fileId=it}getOptionalData(){return this.optionalData}setOptionalData(it){this.optionalData=it}isLastSegment(){return this.lastSegment}setLastSegment(it){this.lastSegment=it}getSegmentCount(){return this.segmentCount}setSegmentCount(it){this.segmentCount=it}getSender(){return this.sender||null}setSender(it){this.sender=it}getAddressee(){return this.addressee||null}setAddressee(it){this.addressee=it}getFileName(){return this.fileName}setFileName(it){this.fileName=it}getFileSize(){return this.fileSize}setFileSize(it){this.fileSize=it}getChecksum(){return this.checksum}setChecksum(it){this.checksum=it}getTimestamp(){return this.timestamp}setTimestamp(it){this.timestamp=it}}class Im{static parseLong(it,ct=void 0){return parseInt(it,ct)}}class Ax extends ht{}Ax.kind="NullPointerException";class Sx{writeBytes(it){this.writeBytesOffset(it,0,it.length)}writeBytesOffset(it,ct,pt){if(it==null)throw new Ax;if(ct<0||ct>it.length||pt<0||ct+pt>it.length||ct+pt<0)throw new Zt;if(pt===0)return;for(let Ct=0;Ct<pt;Ct++)this.write(it[ct+Ct])}flush(){}close(){}}class m0 extends ht{}class Zm extends Sx{constructor(it=32){if(super(),this.count=0,it<0)throw new St("Negative initial size: "+it);this.buf=new Uint8Array(it)}ensureCapacity(it){it-this.buf.length>0&&this.grow(it)}grow(it){let pt=this.buf.length<<1;if(pt-it<0&&(pt=it),pt<0){if(it<0)throw new m0;pt=Nt.MAX_VALUE}this.buf=Ut.copyOfUint8Array(this.buf,pt)}write(it){this.ensureCapacity(this.count+1),this.buf[this.count]=it,this.count+=1}writeBytesOffset(it,ct,pt){if(ct<0||ct>it.length||pt<0||ct+pt-it.length>0)throw new Zt;this.ensureCapacity(this.count+pt),Bt.arraycopy(it,ct,this.buf,this.count,pt),this.count+=pt}writeTo(it){it.writeBytesOffset(this.buf,0,this.count)}reset(){this.count=0}toByteArray(){return Ut.copyOfUint8Array(this.buf,this.count)}size(){return this.count}toString(it){return it?typeof it=="string"?this.toString_string(it):this.toString_number(it):this.toString_void()}toString_void(){return new String(this.buf).toString()}toString_string(it){return new String(this.buf).toString()}toString_number(it){return new String(this.buf).toString()}close(){}}var Pu;(function(wr){wr[wr.ALPHA=0]="ALPHA",wr[wr.LOWER=1]="LOWER",wr[wr.MIXED=2]="MIXED",wr[wr.PUNCT=3]="PUNCT",wr[wr.ALPHA_SHIFT=4]="ALPHA_SHIFT",wr[wr.PUNCT_SHIFT=5]="PUNCT_SHIFT"})(Pu||(Pu={}));function D0(){if(typeof window<"u")return window.BigInt||null;if(typeof commonjsGlobal<"u")return commonjsGlobal.BigInt||null;if(typeof self<"u")return self.BigInt||null;throw new Error("Can't search globals for BigInt!")}let x0;function Qu(wr){if(typeof x0>"u"&&(x0=D0()),x0===null)throw new Error("BigInt is not supported!");return x0(wr)}function Tx(){let wr=[];wr[0]=Qu(1);let it=Qu(900);wr[1]=it;for(let ct=2;ct<16;ct++)wr[ct]=wr[ct-1]*it;return wr}class cs{static decode(it,ct){let pt=new Jr(""),Ct=Rr.ISO8859_1;pt.enableDecoding(Ct);let It=1,Dt=it[It++],qt=new Rm;for(;It<it[0];){switch(Dt){case cs.TEXT_COMPACTION_MODE_LATCH:It=cs.textCompaction(it,It,pt);break;case cs.BYTE_COMPACTION_MODE_LATCH:case cs.BYTE_COMPACTION_MODE_LATCH_6:It=cs.byteCompaction(Dt,it,Ct,It,pt);break;case cs.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:pt.append(it[It++]);break;case cs.NUMERIC_COMPACTION_MODE_LATCH:It=cs.numericCompaction(it,It,pt);break;case cs.ECI_CHARSET:Rr.getCharacterSetECIByValue(it[It++]);break;case cs.ECI_GENERAL_PURPOSE:It+=2;break;case cs.ECI_USER_DEFINED:It++;break;case cs.BEGIN_MACRO_PDF417_CONTROL_BLOCK:It=cs.decodeMacroBlock(it,It,qt);break;case cs.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case cs.MACRO_PDF417_TERMINATOR:throw new or;default:It--,It=cs.textCompaction(it,It,pt);break}if(It<it.length)Dt=it[It++];else throw or.getFormatInstance()}if(pt.length()===0)throw or.getFormatInstance();let Jt=new ws(null,pt.toString(),null,ct);return Jt.setOther(qt),Jt}static decodeMacroBlock(it,ct,pt){if(ct+cs.NUMBER_OF_SEQUENCE_CODEWORDS>it[0])throw or.getFormatInstance();let Ct=new Int32Array(cs.NUMBER_OF_SEQUENCE_CODEWORDS);for(let qt=0;qt<cs.NUMBER_OF_SEQUENCE_CODEWORDS;qt++,ct++)Ct[qt]=it[ct];pt.setSegmentIndex(Nt.parseInt(cs.decodeBase900toBase10(Ct,cs.NUMBER_OF_SEQUENCE_CODEWORDS)));let It=new Jr;ct=cs.textCompaction(it,ct,It),pt.setFileId(It.toString());let Dt=-1;for(it[ct]===cs.BEGIN_MACRO_PDF417_OPTIONAL_FIELD&&(Dt=ct+1);ct<it[0];)switch(it[ct]){case cs.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:switch(ct++,it[ct]){case cs.MACRO_PDF417_OPTIONAL_FIELD_FILE_NAME:let qt=new Jr;ct=cs.textCompaction(it,ct+1,qt),pt.setFileName(qt.toString());break;case cs.MACRO_PDF417_OPTIONAL_FIELD_SENDER:let Jt=new Jr;ct=cs.textCompaction(it,ct+1,Jt),pt.setSender(Jt.toString());break;case cs.MACRO_PDF417_OPTIONAL_FIELD_ADDRESSEE:let ar=new Jr;ct=cs.textCompaction(it,ct+1,ar),pt.setAddressee(ar.toString());break;case cs.MACRO_PDF417_OPTIONAL_FIELD_SEGMENT_COUNT:let Er=new Jr;ct=cs.numericCompaction(it,ct+1,Er),pt.setSegmentCount(Nt.parseInt(Er.toString()));break;case cs.MACRO_PDF417_OPTIONAL_FIELD_TIME_STAMP:let Pr=new Jr;ct=cs.numericCompaction(it,ct+1,Pr),pt.setTimestamp(Im.parseLong(Pr.toString()));break;case cs.MACRO_PDF417_OPTIONAL_FIELD_CHECKSUM:let Gr=new Jr;ct=cs.numericCompaction(it,ct+1,Gr),pt.setChecksum(Nt.parseInt(Gr.toString()));break;case cs.MACRO_PDF417_OPTIONAL_FIELD_FILE_SIZE:let pn=new Jr;ct=cs.numericCompaction(it,ct+1,pn),pt.setFileSize(Im.parseLong(pn.toString()));break;default:throw or.getFormatInstance()}break;case cs.MACRO_PDF417_TERMINATOR:ct++,pt.setLastSegment(!0);break;default:throw or.getFormatInstance()}if(Dt!==-1){let qt=ct-Dt;pt.isLastSegment()&&qt--,pt.setOptionalData(Ut.copyOfRange(it,Dt,Dt+qt))}return ct}static textCompaction(it,ct,pt){let Ct=new Int32Array((it[0]-ct)*2),It=new Int32Array((it[0]-ct)*2),Dt=0,qt=!1;for(;ct<it[0]&&!qt;){let Jt=it[ct++];if(Jt<cs.TEXT_COMPACTION_MODE_LATCH)Ct[Dt]=Jt/30,Ct[Dt+1]=Jt%30,Dt+=2;else switch(Jt){case cs.TEXT_COMPACTION_MODE_LATCH:Ct[Dt++]=cs.TEXT_COMPACTION_MODE_LATCH;break;case cs.BYTE_COMPACTION_MODE_LATCH:case cs.BYTE_COMPACTION_MODE_LATCH_6:case cs.NUMERIC_COMPACTION_MODE_LATCH:case cs.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case cs.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case cs.MACRO_PDF417_TERMINATOR:ct--,qt=!0;break;case cs.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:Ct[Dt]=cs.MODE_SHIFT_TO_BYTE_COMPACTION_MODE,Jt=it[ct++],It[Dt]=Jt,Dt++;break}}return cs.decodeTextCompaction(Ct,It,Dt,pt),ct}static decodeTextCompaction(it,ct,pt,Ct){let It=Pu.ALPHA,Dt=Pu.ALPHA,qt=0;for(;qt<pt;){let Jt=it[qt],ar="";switch(It){case Pu.ALPHA:if(Jt<26)ar=String.fromCharCode(65+Jt);else switch(Jt){case 26:ar=" ";break;case cs.LL:It=Pu.LOWER;break;case cs.ML:It=Pu.MIXED;break;case cs.PS:Dt=It,It=Pu.PUNCT_SHIFT;break;case cs.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:Ct.append(ct[qt]);break;case cs.TEXT_COMPACTION_MODE_LATCH:It=Pu.ALPHA;break}break;case Pu.LOWER:if(Jt<26)ar=String.fromCharCode(97+Jt);else switch(Jt){case 26:ar=" ";break;case cs.AS:Dt=It,It=Pu.ALPHA_SHIFT;break;case cs.ML:It=Pu.MIXED;break;case cs.PS:Dt=It,It=Pu.PUNCT_SHIFT;break;case cs.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:Ct.append(ct[qt]);break;case cs.TEXT_COMPACTION_MODE_LATCH:It=Pu.ALPHA;break}break;case Pu.MIXED:if(Jt<cs.PL)ar=cs.MIXED_CHARS[Jt];else switch(Jt){case cs.PL:It=Pu.PUNCT;break;case 26:ar=" ";break;case cs.LL:It=Pu.LOWER;break;case cs.AL:It=Pu.ALPHA;break;case cs.PS:Dt=It,It=Pu.PUNCT_SHIFT;break;case cs.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:Ct.append(ct[qt]);break;case cs.TEXT_COMPACTION_MODE_LATCH:It=Pu.ALPHA;break}break;case Pu.PUNCT:if(Jt<cs.PAL)ar=cs.PUNCT_CHARS[Jt];else switch(Jt){case cs.PAL:It=Pu.ALPHA;break;case cs.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:Ct.append(ct[qt]);break;case cs.TEXT_COMPACTION_MODE_LATCH:It=Pu.ALPHA;break}break;case Pu.ALPHA_SHIFT:if(It=Dt,Jt<26)ar=String.fromCharCode(65+Jt);else switch(Jt){case 26:ar=" ";break;case cs.TEXT_COMPACTION_MODE_LATCH:It=Pu.ALPHA;break}break;case Pu.PUNCT_SHIFT:if(It=Dt,Jt<cs.PAL)ar=cs.PUNCT_CHARS[Jt];else switch(Jt){case cs.PAL:It=Pu.ALPHA;break;case cs.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:Ct.append(ct[qt]);break;case cs.TEXT_COMPACTION_MODE_LATCH:It=Pu.ALPHA;break}break}ar!==""&&Ct.append(ar),qt++}}static byteCompaction(it,ct,pt,Ct,It){let Dt=new Zm,qt=0,Jt=0,ar=!1;switch(it){case cs.BYTE_COMPACTION_MODE_LATCH:let Er=new Int32Array(6),Pr=ct[Ct++];for(;Ct<ct[0]&&!ar;)switch(Er[qt++]=Pr,Jt=900*Jt+Pr,Pr=ct[Ct++],Pr){case cs.TEXT_COMPACTION_MODE_LATCH:case cs.BYTE_COMPACTION_MODE_LATCH:case cs.NUMERIC_COMPACTION_MODE_LATCH:case cs.BYTE_COMPACTION_MODE_LATCH_6:case cs.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case cs.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case cs.MACRO_PDF417_TERMINATOR:Ct--,ar=!0;break;default:if(qt%5===0&&qt>0){for(let Gr=0;Gr<6;++Gr)Dt.write(Number(Qu(Jt)>>Qu(8*(5-Gr))));Jt=0,qt=0}break}Ct===ct[0]&&Pr<cs.TEXT_COMPACTION_MODE_LATCH&&(Er[qt++]=Pr);for(let Gr=0;Gr<qt;Gr++)Dt.write(Er[Gr]);break;case cs.BYTE_COMPACTION_MODE_LATCH_6:for(;Ct<ct[0]&&!ar;){let Gr=ct[Ct++];if(Gr<cs.TEXT_COMPACTION_MODE_LATCH)qt++,Jt=900*Jt+Gr;else switch(Gr){case cs.TEXT_COMPACTION_MODE_LATCH:case cs.BYTE_COMPACTION_MODE_LATCH:case cs.NUMERIC_COMPACTION_MODE_LATCH:case cs.BYTE_COMPACTION_MODE_LATCH_6:case cs.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case cs.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case cs.MACRO_PDF417_TERMINATOR:Ct--,ar=!0;break}if(qt%5===0&&qt>0){for(let pn=0;pn<6;++pn)Dt.write(Number(Qu(Jt)>>Qu(8*(5-pn))));Jt=0,qt=0}}break}return It.append(un.decode(Dt.toByteArray(),pt)),Ct}static numericCompaction(it,ct,pt){let Ct=0,It=!1,Dt=new Int32Array(cs.MAX_NUMERIC_CODEWORDS);for(;ct<it[0]&&!It;){let qt=it[ct++];if(ct===it[0]&&(It=!0),qt<cs.TEXT_COMPACTION_MODE_LATCH)Dt[Ct]=qt,Ct++;else switch(qt){case cs.TEXT_COMPACTION_MODE_LATCH:case cs.BYTE_COMPACTION_MODE_LATCH:case cs.BYTE_COMPACTION_MODE_LATCH_6:case cs.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case cs.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case cs.MACRO_PDF417_TERMINATOR:ct--,It=!0;break}(Ct%cs.MAX_NUMERIC_CODEWORDS===0||qt===cs.NUMERIC_COMPACTION_MODE_LATCH||It)&&Ct>0&&(pt.append(cs.decodeBase900toBase10(Dt,Ct)),Ct=0)}return ct}static decodeBase900toBase10(it,ct){let pt=Qu(0);for(let It=0;It<ct;It++)pt+=cs.EXP900[ct-It-1]*Qu(it[It]);let Ct=pt.toString();if(Ct.charAt(0)!=="1")throw new or;return Ct.substring(1)}}cs.TEXT_COMPACTION_MODE_LATCH=900,cs.BYTE_COMPACTION_MODE_LATCH=901,cs.NUMERIC_COMPACTION_MODE_LATCH=902,cs.BYTE_COMPACTION_MODE_LATCH_6=924,cs.ECI_USER_DEFINED=925,cs.ECI_GENERAL_PURPOSE=926,cs.ECI_CHARSET=927,cs.BEGIN_MACRO_PDF417_CONTROL_BLOCK=928,cs.BEGIN_MACRO_PDF417_OPTIONAL_FIELD=923,cs.MACRO_PDF417_TERMINATOR=922,cs.MODE_SHIFT_TO_BYTE_COMPACTION_MODE=913,cs.MAX_NUMERIC_CODEWORDS=15,cs.MACRO_PDF417_OPTIONAL_FIELD_FILE_NAME=0,cs.MACRO_PDF417_OPTIONAL_FIELD_SEGMENT_COUNT=1,cs.MACRO_PDF417_OPTIONAL_FIELD_TIME_STAMP=2,cs.MACRO_PDF417_OPTIONAL_FIELD_SENDER=3,cs.MACRO_PDF417_OPTIONAL_FIELD_ADDRESSEE=4,cs.MACRO_PDF417_OPTIONAL_FIELD_FILE_SIZE=5,cs.MACRO_PDF417_OPTIONAL_FIELD_CHECKSUM=6,cs.PL=25,cs.LL=27,cs.AS=27,cs.ML=28,cs.AL=28,cs.PS=29,cs.PAL=29,cs.PUNCT_CHARS=`;<>@[\\]_\`~!\r	,:
-.$/"|*()?{}'`,cs.MIXED_CHARS="0123456789&\r	,:#-.$/+%*=^",cs.EXP900=D0()?Tx():[],cs.NUMBER_OF_SEQUENCE_CODEWORDS=2;class yl{constructor(){}static decode(it,ct,pt,Ct,It,Dt,qt){let Jt=new J0(it,ct,pt,Ct,It),ar=null,Er=null,Pr;for(let An=!0;;An=!1){if(ct!=null&&(ar=yl.getRowIndicatorColumn(it,Jt,ct,!0,Dt,qt)),Ct!=null&&(Er=yl.getRowIndicatorColumn(it,Jt,Ct,!1,Dt,qt)),Pr=yl.merge(ar,Er),Pr==null)throw Fr.getNotFoundInstance();let Pn=Pr.getBoundingBox();if(An&&Pn!=null&&(Pn.getMinY()<Jt.getMinY()||Pn.getMaxY()>Jt.getMaxY()))Jt=Pn;else break}Pr.setBoundingBox(Jt);let Gr=Pr.getBarcodeColumnCount()+1;Pr.setDetectionResultColumn(0,ar),Pr.setDetectionResultColumn(Gr,Er);let pn=ar!=null;for(let An=1;An<=Gr;An++){let Pn=pn?An:Gr-An;if(Pr.getDetectionResultColumn(Pn)!==void 0)continue;let Xn;Pn===0||Pn===Gr?Xn=new Cx(Jt,Pn===0):Xn=new qo(Jt),Pr.setDetectionResultColumn(Pn,Xn);let os=-1,Ks=os;for(let Js=Jt.getMinY();Js<=Jt.getMaxY();Js++){if(os=yl.getStartColumn(Pr,Pn,Js,pn),os<0||os>Jt.getMaxX()){if(Ks===-1)continue;os=Ks}let Hs=yl.detectCodeword(it,Jt.getMinX(),Jt.getMaxX(),pn,os,Js,Dt,qt);Hs!=null&&(Xn.setCodeword(Js,Hs),Ks=os,Dt=Math.min(Dt,Hs.getWidth()),qt=Math.max(qt,Hs.getWidth()))}}return yl.createDecoderResult(Pr)}static merge(it,ct){if(it==null&&ct==null)return null;let pt=yl.getBarcodeMetadata(it,ct);if(pt==null)return null;let Ct=J0.merge(yl.adjustBoundingBox(it),yl.adjustBoundingBox(ct));return new Sm(pt,Ct)}static adjustBoundingBox(it){if(it==null)return null;let ct=it.getRowHeights();if(ct==null)return null;let pt=yl.getMax(ct),Ct=0;for(let qt of ct)if(Ct+=pt-qt,qt>0)break;let It=it.getCodewords();for(let qt=0;Ct>0&&It[qt]==null;qt++)Ct--;let Dt=0;for(let qt=ct.length-1;qt>=0&&(Dt+=pt-ct[qt],!(ct[qt]>0));qt--);for(let qt=It.length-1;Dt>0&&It[qt]==null;qt--)Dt--;return it.getBoundingBox().addMissingRows(Ct,Dt,it.isLeft())}static getMax(it){let ct=-1;for(let pt of it)ct=Math.max(ct,pt);return ct}static getBarcodeMetadata(it,ct){let pt;if(it==null||(pt=it.getBarcodeMetadata())==null)return ct==null?null:ct.getBarcodeMetadata();let Ct;return ct==null||(Ct=ct.getBarcodeMetadata())==null?pt:pt.getColumnCount()!==Ct.getColumnCount()&&pt.getErrorCorrectionLevel()!==Ct.getErrorCorrectionLevel()&&pt.getRowCount()!==Ct.getRowCount()?null:pt}static getRowIndicatorColumn(it,ct,pt,Ct,It,Dt){let qt=new Cx(ct,Ct);for(let Jt=0;Jt<2;Jt++){let ar=Jt===0?1:-1,Er=Math.trunc(Math.trunc(pt.getX()));for(let Pr=Math.trunc(Math.trunc(pt.getY()));Pr<=ct.getMaxY()&&Pr>=ct.getMinY();Pr+=ar){let Gr=yl.detectCodeword(it,0,it.getWidth(),Ct,Er,Pr,It,Dt);Gr!=null&&(qt.setCodeword(Pr,Gr),Ct?Er=Gr.getStartX():Er=Gr.getEndX())}}return qt}static adjustCodewordCount(it,ct){let pt=ct[0][1],Ct=pt.getValue(),It=it.getBarcodeColumnCount()*it.getBarcodeRowCount()-yl.getNumberOfECCodeWords(it.getBarcodeECLevel());if(Ct.length===0){if(It<1||It>_a.MAX_CODEWORDS_IN_BARCODE)throw Fr.getNotFoundInstance();pt.setValue(It)}else Ct[0]!==It&&pt.setValue(It)}static createDecoderResult(it){let ct=yl.createBarcodeMatrix(it);yl.adjustCodewordCount(it,ct);let pt=new Array,Ct=new Int32Array(it.getBarcodeRowCount()*it.getBarcodeColumnCount()),It=[],Dt=new Array;for(let Jt=0;Jt<it.getBarcodeRowCount();Jt++)for(let ar=0;ar<it.getBarcodeColumnCount();ar++){let Er=ct[Jt][ar+1].getValue(),Pr=Jt*it.getBarcodeColumnCount()+ar;Er.length===0?pt.push(Pr):Er.length===1?Ct[Pr]=Er[0]:(Dt.push(Pr),It.push(Er))}let qt=new Array(It.length);for(let Jt=0;Jt<qt.length;Jt++)qt[Jt]=It[Jt];return yl.createDecoderResultFromAmbiguousValues(it.getBarcodeECLevel(),Ct,_a.toIntArray(pt),_a.toIntArray(Dt),qt)}static createDecoderResultFromAmbiguousValues(it,ct,pt,Ct,It){let Dt=new Int32Array(Ct.length),qt=100;for(;qt-- >0;){for(let Jt=0;Jt<Dt.length;Jt++)ct[Ct[Jt]]=It[Jt][Dt[Jt]];try{return yl.decodeCodewords(ct,it,pt)}catch(Jt){if(!(Jt instanceof Pt))throw Jt}if(Dt.length===0)throw Pt.getChecksumInstance();for(let Jt=0;Jt<Dt.length;Jt++)if(Dt[Jt]<It[Jt].length-1){Dt[Jt]++;break}else if(Dt[Jt]=0,Jt===Dt.length-1)throw Pt.getChecksumInstance()}throw Pt.getChecksumInstance()}static createBarcodeMatrix(it){let ct=Array.from({length:it.getBarcodeRowCount()},()=>new Array(it.getBarcodeColumnCount()+2));for(let Ct=0;Ct<ct.length;Ct++)for(let It=0;It<ct[Ct].length;It++)ct[Ct][It]=new z0;let pt=0;for(let Ct of it.getDetectionResultColumns()){if(Ct!=null){for(let It of Ct.getCodewords())if(It!=null){let Dt=It.getRowNumber();if(Dt>=0){if(Dt>=ct.length)continue;ct[Dt][pt].setValue(It.getValue())}}}pt++}return ct}static isValidBarcodeColumn(it,ct){return ct>=0&&ct<=it.getBarcodeColumnCount()+1}static getStartColumn(it,ct,pt,Ct){let It=Ct?1:-1,Dt=null;if(yl.isValidBarcodeColumn(it,ct-It)&&(Dt=it.getDetectionResultColumn(ct-It).getCodeword(pt)),Dt!=null)return Ct?Dt.getEndX():Dt.getStartX();if(Dt=it.getDetectionResultColumn(ct).getCodewordNearby(pt),Dt!=null)return Ct?Dt.getStartX():Dt.getEndX();if(yl.isValidBarcodeColumn(it,ct-It)&&(Dt=it.getDetectionResultColumn(ct-It).getCodewordNearby(pt)),Dt!=null)return Ct?Dt.getEndX():Dt.getStartX();let qt=0;for(;yl.isValidBarcodeColumn(it,ct-It);){ct-=It;for(let Jt of it.getDetectionResultColumn(ct).getCodewords())if(Jt!=null)return(Ct?Jt.getEndX():Jt.getStartX())+It*qt*(Jt.getEndX()-Jt.getStartX());qt++}return Ct?it.getBoundingBox().getMinX():it.getBoundingBox().getMaxX()}static detectCodeword(it,ct,pt,Ct,It,Dt,qt,Jt){It=yl.adjustCodewordStartColumn(it,ct,pt,Ct,It,Dt);let ar=yl.getModuleBitCount(it,ct,pt,Ct,It,Dt);if(ar==null)return null;let Er,Pr=us.sum(ar);if(Ct)Er=It+Pr;else{for(let An=0;An<ar.length/2;An++){let Pn=ar[An];ar[An]=ar[ar.length-1-An],ar[ar.length-1-An]=Pn}Er=It,It=Er-Pr}if(!yl.checkCodewordSkew(Pr,qt,Jt))return null;let Gr=sp.getDecodedValue(ar),pn=_a.getCodeword(Gr);return pn===-1?null:new Tm(It,Er,yl.getCodewordBucketNumber(Gr),pn)}static getModuleBitCount(it,ct,pt,Ct,It,Dt){let qt=It,Jt=new Int32Array(8),ar=0,Er=Ct?1:-1,Pr=Ct;for(;(Ct?qt<pt:qt>=ct)&&ar<Jt.length;)it.get(qt,Dt)===Pr?(Jt[ar]++,qt+=Er):(ar++,Pr=!Pr);return ar===Jt.length||qt===(Ct?pt:ct)&&ar===Jt.length-1?Jt:null}static getNumberOfECCodeWords(it){return 2<<it}static adjustCodewordStartColumn(it,ct,pt,Ct,It,Dt){let qt=It,Jt=Ct?-1:1;for(let ar=0;ar<2;ar++){for(;(Ct?qt>=ct:qt<pt)&&Ct===it.get(qt,Dt);){if(Math.abs(It-qt)>yl.CODEWORD_SKEW_SIZE)return It;qt+=Jt}Jt=-Jt,Ct=!Ct}return qt}static checkCodewordSkew(it,ct,pt){return ct-yl.CODEWORD_SKEW_SIZE<=it&&it<=pt+yl.CODEWORD_SKEW_SIZE}static decodeCodewords(it,ct,pt){if(it.length===0)throw or.getFormatInstance();let Ct=1<<ct+1,It=yl.correctErrors(it,pt,Ct);yl.verifyCodewordCount(it,Ct);let Dt=cs.decode(it,""+ct);return Dt.setErrorsCorrected(It),Dt.setErasures(pt.length),Dt}static correctErrors(it,ct,pt){if(ct!=null&&ct.length>pt/2+yl.MAX_ERRORS||pt<0||pt>yl.MAX_EC_CODEWORDS)throw Pt.getChecksumInstance();return yl.errorCorrection.decode(it,pt,ct)}static verifyCodewordCount(it,ct){if(it.length<4)throw or.getFormatInstance();let pt=it[0];if(pt>it.length)throw or.getFormatInstance();if(pt===0)if(ct<it.length)it[0]=it.length-ct;else throw or.getFormatInstance()}static getBitCountForCodeword(it){let ct=new Int32Array(8),pt=0,Ct=ct.length-1;for(;!((it&1)!==pt&&(pt=it&1,Ct--,Ct<0));)ct[Ct]++,it>>=1;return ct}static getCodewordBucketNumber(it){return it instanceof Int32Array?this.getCodewordBucketNumber_Int32Array(it):this.getCodewordBucketNumber_number(it)}static getCodewordBucketNumber_number(it){return yl.getCodewordBucketNumber(yl.getBitCountForCodeword(it))}static getCodewordBucketNumber_Int32Array(it){return(it[0]-it[2]+it[4]-it[6]+9)%9}static toString(it){let ct=new I0;for(let pt=0;pt<it.length;pt++){ct.format("Row %2d: ",pt);for(let Ct=0;Ct<it[pt].length;Ct++){let It=it[pt][Ct];It.getValue().length===0?ct.format("        ",null):ct.format("%4d(%2d)",It.getValue()[0],It.getConfidence(It.getValue()[0]))}ct.format("%n")}return ct.toString()}}yl.CODEWORD_SKEW_SIZE=2,yl.MAX_ERRORS=3,yl.MAX_EC_CODEWORDS=512,yl.errorCorrection=new p0;class Mo{decode(it,ct=null){let pt=Mo.decode(it,ct,!1);if(pt==null||pt.length===0||pt[0]==null)throw Fr.getNotFoundInstance();return pt[0]}decodeMultiple(it,ct=null){try{return Mo.decode(it,ct,!0)}catch(pt){throw pt instanceof or||pt instanceof Pt?Fr.getNotFoundInstance():pt}}static decode(it,ct,pt){const Ct=new Array,It=Bl.detectMultiple(it,ct,pt);for(const Dt of It.getPoints()){const qt=yl.decode(It.getBits(),Dt[4],Dt[5],Dt[6],Dt[7],Mo.getMinCodewordWidth(Dt),Mo.getMaxCodewordWidth(Dt)),Jt=new Sn(qt.getText(),qt.getRawBytes(),void 0,Dt,rs.PDF_417);Jt.putMetadata(On.ERROR_CORRECTION_LEVEL,qt.getECLevel());const ar=qt.getOther();ar!=null&&Jt.putMetadata(On.PDF417_EXTRA_METADATA,ar),Ct.push(Jt)}return Ct.map(Dt=>Dt)}static getMaxWidth(it,ct){return it==null||ct==null?0:Math.trunc(Math.abs(it.getX()-ct.getX()))}static getMinWidth(it,ct){return it==null||ct==null?Nt.MAX_VALUE:Math.trunc(Math.abs(it.getX()-ct.getX()))}static getMaxCodewordWidth(it){return Math.floor(Math.max(Math.max(Mo.getMaxWidth(it[0],it[4]),Mo.getMaxWidth(it[6],it[2])*_a.MODULES_IN_CODEWORD/_a.MODULES_IN_STOP_PATTERN),Math.max(Mo.getMaxWidth(it[1],it[5]),Mo.getMaxWidth(it[7],it[3])*_a.MODULES_IN_CODEWORD/_a.MODULES_IN_STOP_PATTERN)))}static getMinCodewordWidth(it){return Math.floor(Math.min(Math.min(Mo.getMinWidth(it[0],it[4]),Mo.getMinWidth(it[6],it[2])*_a.MODULES_IN_CODEWORD/_a.MODULES_IN_STOP_PATTERN),Math.min(Mo.getMinWidth(it[1],it[5]),Mo.getMinWidth(it[7],it[3])*_a.MODULES_IN_CODEWORD/_a.MODULES_IN_STOP_PATTERN)))}reset(){}}class Ym extends ht{}Ym.kind="ReaderException";class u1{constructor(it,ct){this.verbose=it===!0,ct&&this.setHints(ct)}decode(it,ct){return ct&&this.setHints(ct),this.decodeInternal(it)}decodeWithState(it){return(this.readers===null||this.readers===void 0)&&this.setHints(null),this.decodeInternal(it)}setHints(it){this.hints=it;const ct=!a(it)&&it.get(ir.TRY_HARDER)===!0,pt=a(it)?null:it.get(ir.POSSIBLE_FORMATS),Ct=new Array;if(!a(pt)){const It=pt.some(Dt=>Dt===rs.UPC_A||Dt===rs.UPC_E||Dt===rs.EAN_13||Dt===rs.EAN_8||Dt===rs.CODABAR||Dt===rs.CODE_39||Dt===rs.CODE_93||Dt===rs.CODE_128||Dt===rs.ITF||Dt===rs.RSS_14||Dt===rs.RSS_EXPANDED);It&&!ct&&Ct.push(new jo(it,this.verbose)),pt.includes(rs.QR_CODE)&&Ct.push(new Fp),pt.includes(rs.DATA_MATRIX)&&Ct.push(new qu),pt.includes(rs.AZTEC)&&Ct.push(new Gl),pt.includes(rs.PDF_417)&&Ct.push(new Mo),It&&ct&&Ct.push(new jo(it,this.verbose))}Ct.length===0&&(ct||Ct.push(new jo(it,this.verbose)),Ct.push(new Fp),Ct.push(new qu),Ct.push(new Gl),Ct.push(new Mo),ct&&Ct.push(new jo(it,this.verbose))),this.readers=Ct}reset(){if(this.readers!==null)for(const it of this.readers)it.reset()}decodeInternal(it){if(this.readers===null)throw new Ym("No readers where selected, nothing can be read.");for(const ct of this.readers)try{return ct.decode(it,this.hints)}catch(pt){if(pt instanceof Ym)continue}throw new Fr("No MultiFormat Readers were able to detect the code.")}}class J1 extends gn{constructor(it=null,ct=500){const pt=new u1;pt.setHints(it),super(pt,ct)}decodeBitmap(it){return this.reader.decodeWithState(it)}}class so extends gn{constructor(it=500){super(new Mo,it)}}class d1 extends gn{constructor(it=500){super(new Fp,it)}}var em;(function(wr){wr[wr.ERROR_CORRECTION=0]="ERROR_CORRECTION",wr[wr.CHARACTER_SET=1]="CHARACTER_SET",wr[wr.DATA_MATRIX_SHAPE=2]="DATA_MATRIX_SHAPE",wr[wr.MIN_SIZE=3]="MIN_SIZE",wr[wr.MAX_SIZE=4]="MAX_SIZE",wr[wr.MARGIN=5]="MARGIN",wr[wr.PDF417_COMPACT=6]="PDF417_COMPACT",wr[wr.PDF417_COMPACTION=7]="PDF417_COMPACTION",wr[wr.PDF417_DIMENSIONS=8]="PDF417_DIMENSIONS",wr[wr.AZTEC_LAYERS=9]="AZTEC_LAYERS",wr[wr.QR_VERSION=10]="QR_VERSION"})(em||(em={}));var ku=em;class V0{constructor(it){this.field=it,this.cachedGenerators=[],this.cachedGenerators.push(new ks(it,Int32Array.from([1])))}buildGenerator(it){const ct=this.cachedGenerators;if(it>=ct.length){let pt=ct[ct.length-1];const Ct=this.field;for(let It=ct.length;It<=it;It++){const Dt=pt.multiply(new ks(Ct,Int32Array.from([1,Ct.exp(It-1+Ct.getGeneratorBase())])));ct.push(Dt),pt=Dt}}return ct[it]}encode(it,ct){if(ct===0)throw new St("No error correction bytes");const pt=it.length-ct;if(pt<=0)throw new St("No data bytes provided");const Ct=this.buildGenerator(ct),It=new Int32Array(pt);Bt.arraycopy(it,0,It,0,pt);let Dt=new ks(this.field,It);Dt=Dt.multiplyByMonomial(ct,1);const Jt=Dt.divide(Ct)[1].getCoefficients(),ar=ct-Jt.length;for(let Er=0;Er<ar;Er++)it[pt+Er]=0;Bt.arraycopy(Jt,0,it,pt+ar,Jt.length)}}class vu{constructor(){}static applyMaskPenaltyRule1(it){return vu.applyMaskPenaltyRule1Internal(it,!0)+vu.applyMaskPenaltyRule1Internal(it,!1)}static applyMaskPenaltyRule2(it){let ct=0;const pt=it.getArray(),Ct=it.getWidth(),It=it.getHeight();for(let Dt=0;Dt<It-1;Dt++){const qt=pt[Dt];for(let Jt=0;Jt<Ct-1;Jt++){const ar=qt[Jt];ar===qt[Jt+1]&&ar===pt[Dt+1][Jt]&&ar===pt[Dt+1][Jt+1]&&ct++}}return vu.N2*ct}static applyMaskPenaltyRule3(it){let ct=0;const pt=it.getArray(),Ct=it.getWidth(),It=it.getHeight();for(let Dt=0;Dt<It;Dt++)for(let qt=0;qt<Ct;qt++){const Jt=pt[Dt];qt+6<Ct&&Jt[qt]===1&&Jt[qt+1]===0&&Jt[qt+2]===1&&Jt[qt+3]===1&&Jt[qt+4]===1&&Jt[qt+5]===0&&Jt[qt+6]===1&&(vu.isWhiteHorizontal(Jt,qt-4,qt)||vu.isWhiteHorizontal(Jt,qt+7,qt+11))&&ct++,Dt+6<It&&pt[Dt][qt]===1&&pt[Dt+1][qt]===0&&pt[Dt+2][qt]===1&&pt[Dt+3][qt]===1&&pt[Dt+4][qt]===1&&pt[Dt+5][qt]===0&&pt[Dt+6][qt]===1&&(vu.isWhiteVertical(pt,qt,Dt-4,Dt)||vu.isWhiteVertical(pt,qt,Dt+7,Dt+11))&&ct++}return ct*vu.N3}static isWhiteHorizontal(it,ct,pt){ct=Math.max(ct,0),pt=Math.min(pt,it.length);for(let Ct=ct;Ct<pt;Ct++)if(it[Ct]===1)return!1;return!0}static isWhiteVertical(it,ct,pt,Ct){pt=Math.max(pt,0),Ct=Math.min(Ct,it.length);for(let It=pt;It<Ct;It++)if(it[It][ct]===1)return!1;return!0}static applyMaskPenaltyRule4(it){let ct=0;const pt=it.getArray(),Ct=it.getWidth(),It=it.getHeight();for(let Jt=0;Jt<It;Jt++){const ar=pt[Jt];for(let Er=0;Er<Ct;Er++)ar[Er]===1&&ct++}const Dt=it.getHeight()*it.getWidth();return Math.floor(Math.abs(ct*2-Dt)*10/Dt)*vu.N4}static getDataMaskBit(it,ct,pt){let Ct,It;switch(it){case 0:Ct=pt+ct&1;break;case 1:Ct=pt&1;break;case 2:Ct=ct%3;break;case 3:Ct=(pt+ct)%3;break;case 4:Ct=Math.floor(pt/2)+Math.floor(ct/3)&1;break;case 5:It=pt*ct,Ct=(It&1)+It%3;break;case 6:It=pt*ct,Ct=(It&1)+It%3&1;break;case 7:It=pt*ct,Ct=It%3+(pt+ct&1)&1;break;default:throw new St("Invalid mask pattern: "+it)}return Ct===0}static applyMaskPenaltyRule1Internal(it,ct){let pt=0;const Ct=ct?it.getHeight():it.getWidth(),It=ct?it.getWidth():it.getHeight(),Dt=it.getArray();for(let qt=0;qt<Ct;qt++){let Jt=0,ar=-1;for(let Er=0;Er<It;Er++){const Pr=ct?Dt[qt][Er]:Dt[Er][qt];Pr===ar?Jt++:(Jt>=5&&(pt+=vu.N1+(Jt-5)),Jt=1,ar=Pr)}Jt>=5&&(pt+=vu.N1+(Jt-5))}return pt}}vu.N1=3,vu.N2=3,vu.N3=40,vu.N4=10;class js{constructor(it,ct){this.width=it,this.height=ct;const pt=new Array(ct);for(let Ct=0;Ct!==ct;Ct++)pt[Ct]=new Uint8Array(it);this.bytes=pt}getHeight(){return this.height}getWidth(){return this.width}get(it,ct){return this.bytes[ct][it]}getArray(){return this.bytes}setNumber(it,ct,pt){this.bytes[ct][it]=pt}setBoolean(it,ct,pt){this.bytes[ct][it]=pt?1:0}clear(it){for(const ct of this.bytes)Ut.fill(ct,it)}equals(it){if(!(it instanceof js))return!1;const ct=it;if(this.width!==ct.width||this.height!==ct.height)return!1;for(let pt=0,Ct=this.height;pt<Ct;++pt){const It=this.bytes[pt],Dt=ct.bytes[pt];for(let qt=0,Jt=this.width;qt<Jt;++qt)if(It[qt]!==Dt[qt])return!1}return!0}toString(){const it=new Jr;for(let ct=0,pt=this.height;ct<pt;++ct){const Ct=this.bytes[ct];for(let It=0,Dt=this.width;It<Dt;++It)switch(Ct[It]){case 0:it.append(" 0");break;case 1:it.append(" 1");break;default:it.append("  ");break}it.append(`
`)}return it.toString()}}class No{constructor(){this.maskPattern=-1}getMode(){return this.mode}getECLevel(){return this.ecLevel}getVersion(){return this.version}getMaskPattern(){return this.maskPattern}getMatrix(){return this.matrix}toString(){const it=new Jr;return it.append(`<<
`),it.append(" mode: "),it.append(this.mode?this.mode.toString():"null"),it.append(`
 ecLevel: `),it.append(this.ecLevel?this.ecLevel.toString():"null"),it.append(`
 version: `),it.append(this.version?this.version.toString():"null"),it.append(`
 maskPattern: `),it.append(this.maskPattern.toString()),this.matrix?(it.append(`
 matrix:
`),it.append(this.matrix.toString())):it.append(`
 matrix: null
`),it.append(`>>
`),it.toString()}setMode(it){this.mode=it}setECLevel(it){this.ecLevel=it}setVersion(it){this.version=it}setMaskPattern(it){this.maskPattern=it}setMatrix(it){this.matrix=it}static isValidMaskPattern(it){return it>=0&&it<No.NUM_MASK_PATTERNS}}No.NUM_MASK_PATTERNS=8;class go extends ht{}go.kind="WriterException";class Po{constructor(){}static clearMatrix(it){it.clear(255)}static buildMatrix(it,ct,pt,Ct,It){Po.clearMatrix(It),Po.embedBasicPatterns(pt,It),Po.embedTypeInfo(ct,Ct,It),Po.maybeEmbedVersionInfo(pt,It),Po.embedDataBits(it,Ct,It)}static embedBasicPatterns(it,ct){Po.embedPositionDetectionPatternsAndSeparators(ct),Po.embedDarkDotAtLeftBottomCorner(ct),Po.maybeEmbedPositionAdjustmentPatterns(it,ct),Po.embedTimingPatterns(ct)}static embedTypeInfo(it,ct,pt){const Ct=new Gt;Po.makeTypeInfoBits(it,ct,Ct);for(let It=0,Dt=Ct.getSize();It<Dt;++It){const qt=Ct.get(Ct.getSize()-1-It),Jt=Po.TYPE_INFO_COORDINATES[It],ar=Jt[0],Er=Jt[1];if(pt.setBoolean(ar,Er,qt),It<8){const Pr=pt.getWidth()-It-1;pt.setBoolean(Pr,8,qt)}else{const Gr=pt.getHeight()-7+(It-8);pt.setBoolean(8,Gr,qt)}}}static maybeEmbedVersionInfo(it,ct){if(it.getVersionNumber()<7)return;const pt=new Gt;Po.makeVersionInfoBits(it,pt);let Ct=6*3-1;for(let It=0;It<6;++It)for(let Dt=0;Dt<3;++Dt){const qt=pt.get(Ct);Ct--,ct.setBoolean(It,ct.getHeight()-11+Dt,qt),ct.setBoolean(ct.getHeight()-11+Dt,It,qt)}}static embedDataBits(it,ct,pt){let Ct=0,It=-1,Dt=pt.getWidth()-1,qt=pt.getHeight()-1;for(;Dt>0;){for(Dt===6&&(Dt-=1);qt>=0&&qt<pt.getHeight();){for(let Jt=0;Jt<2;++Jt){const ar=Dt-Jt;if(!Po.isEmpty(pt.get(ar,qt)))continue;let Er;Ct<it.getSize()?(Er=it.get(Ct),++Ct):Er=!1,ct!==255&&vu.getDataMaskBit(ct,ar,qt)&&(Er=!Er),pt.setBoolean(ar,qt,Er)}qt+=It}It=-It,qt+=It,Dt-=2}if(Ct!==it.getSize())throw new go("Not all bits consumed: "+Ct+"/"+it.getSize())}static findMSBSet(it){return 32-Nt.numberOfLeadingZeros(it)}static calculateBCHCode(it,ct){if(ct===0)throw new St("0 polynomial");const pt=Po.findMSBSet(ct);for(it<<=pt-1;Po.findMSBSet(it)>=pt;)it^=ct<<Po.findMSBSet(it)-pt;return it}static makeTypeInfoBits(it,ct,pt){if(!No.isValidMaskPattern(ct))throw new go("Invalid mask pattern");const Ct=it.getBits()<<3|ct;pt.appendBits(Ct,5);const It=Po.calculateBCHCode(Ct,Po.TYPE_INFO_POLY);pt.appendBits(It,10);const Dt=new Gt;if(Dt.appendBits(Po.TYPE_INFO_MASK_PATTERN,15),pt.xor(Dt),pt.getSize()!==15)throw new go("should not happen but we got: "+pt.getSize())}static makeVersionInfoBits(it,ct){ct.appendBits(it.getVersionNumber(),6);const pt=Po.calculateBCHCode(it.getVersionNumber(),Po.VERSION_INFO_POLY);if(ct.appendBits(pt,12),ct.getSize()!==18)throw new go("should not happen but we got: "+ct.getSize())}static isEmpty(it){return it===255}static embedTimingPatterns(it){for(let ct=8;ct<it.getWidth()-8;++ct){const pt=(ct+1)%2;Po.isEmpty(it.get(ct,6))&&it.setNumber(ct,6,pt),Po.isEmpty(it.get(6,ct))&&it.setNumber(6,ct,pt)}}static embedDarkDotAtLeftBottomCorner(it){if(it.get(8,it.getHeight()-8)===0)throw new go;it.setNumber(8,it.getHeight()-8,1)}static embedHorizontalSeparationPattern(it,ct,pt){for(let Ct=0;Ct<8;++Ct){if(!Po.isEmpty(pt.get(it+Ct,ct)))throw new go;pt.setNumber(it+Ct,ct,0)}}static embedVerticalSeparationPattern(it,ct,pt){for(let Ct=0;Ct<7;++Ct){if(!Po.isEmpty(pt.get(it,ct+Ct)))throw new go;pt.setNumber(it,ct+Ct,0)}}static embedPositionAdjustmentPattern(it,ct,pt){for(let Ct=0;Ct<5;++Ct){const It=Po.POSITION_ADJUSTMENT_PATTERN[Ct];for(let Dt=0;Dt<5;++Dt)pt.setNumber(it+Dt,ct+Ct,It[Dt])}}static embedPositionDetectionPattern(it,ct,pt){for(let Ct=0;Ct<7;++Ct){const It=Po.POSITION_DETECTION_PATTERN[Ct];for(let Dt=0;Dt<7;++Dt)pt.setNumber(it+Dt,ct+Ct,It[Dt])}}static embedPositionDetectionPatternsAndSeparators(it){const ct=Po.POSITION_DETECTION_PATTERN[0].length;Po.embedPositionDetectionPattern(0,0,it),Po.embedPositionDetectionPattern(it.getWidth()-ct,0,it),Po.embedPositionDetectionPattern(0,it.getWidth()-ct,it);const pt=8;Po.embedHorizontalSeparationPattern(0,pt-1,it),Po.embedHorizontalSeparationPattern(it.getWidth()-pt,pt-1,it),Po.embedHorizontalSeparationPattern(0,it.getWidth()-pt,it);const Ct=7;Po.embedVerticalSeparationPattern(Ct,0,it),Po.embedVerticalSeparationPattern(it.getHeight()-Ct-1,0,it),Po.embedVerticalSeparationPattern(Ct,it.getHeight()-Ct,it)}static maybeEmbedPositionAdjustmentPatterns(it,ct){if(it.getVersionNumber()<2)return;const pt=it.getVersionNumber()-1,Ct=Po.POSITION_ADJUSTMENT_PATTERN_COORDINATE_TABLE[pt];for(let It=0,Dt=Ct.length;It!==Dt;It++){const qt=Ct[It];if(qt>=0)for(let Jt=0;Jt!==Dt;Jt++){const ar=Ct[Jt];ar>=0&&Po.isEmpty(ct.get(ar,qt))&&Po.embedPositionAdjustmentPattern(ar-2,qt-2,ct)}}}}Po.POSITION_DETECTION_PATTERN=Array.from([Int32Array.from([1,1,1,1,1,1,1]),Int32Array.from([1,0,0,0,0,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,0,0,0,0,1]),Int32Array.from([1,1,1,1,1,1,1])]),Po.POSITION_ADJUSTMENT_PATTERN=Array.from([Int32Array.from([1,1,1,1,1]),Int32Array.from([1,0,0,0,1]),Int32Array.from([1,0,1,0,1]),Int32Array.from([1,0,0,0,1]),Int32Array.from([1,1,1,1,1])]),Po.POSITION_ADJUSTMENT_PATTERN_COORDINATE_TABLE=Array.from([Int32Array.from([-1,-1,-1,-1,-1,-1,-1]),Int32Array.from([6,18,-1,-1,-1,-1,-1]),Int32Array.from([6,22,-1,-1,-1,-1,-1]),Int32Array.from([6,26,-1,-1,-1,-1,-1]),Int32Array.from([6,30,-1,-1,-1,-1,-1]),Int32Array.from([6,34,-1,-1,-1,-1,-1]),Int32Array.from([6,22,38,-1,-1,-1,-1]),Int32Array.from([6,24,42,-1,-1,-1,-1]),Int32Array.from([6,26,46,-1,-1,-1,-1]),Int32Array.from([6,28,50,-1,-1,-1,-1]),Int32Array.from([6,30,54,-1,-1,-1,-1]),Int32Array.from([6,32,58,-1,-1,-1,-1]),Int32Array.from([6,34,62,-1,-1,-1,-1]),Int32Array.from([6,26,46,66,-1,-1,-1]),Int32Array.from([6,26,48,70,-1,-1,-1]),Int32Array.from([6,26,50,74,-1,-1,-1]),Int32Array.from([6,30,54,78,-1,-1,-1]),Int32Array.from([6,30,56,82,-1,-1,-1]),Int32Array.from([6,30,58,86,-1,-1,-1]),Int32Array.from([6,34,62,90,-1,-1,-1]),Int32Array.from([6,28,50,72,94,-1,-1]),Int32Array.from([6,26,50,74,98,-1,-1]),Int32Array.from([6,30,54,78,102,-1,-1]),Int32Array.from([6,28,54,80,106,-1,-1]),Int32Array.from([6,32,58,84,110,-1,-1]),Int32Array.from([6,30,58,86,114,-1,-1]),Int32Array.from([6,34,62,90,118,-1,-1]),Int32Array.from([6,26,50,74,98,122,-1]),Int32Array.from([6,30,54,78,102,126,-1]),Int32Array.from([6,26,52,78,104,130,-1]),Int32Array.from([6,30,56,82,108,134,-1]),Int32Array.from([6,34,60,86,112,138,-1]),Int32Array.from([6,30,58,86,114,142,-1]),Int32Array.from([6,34,62,90,118,146,-1]),Int32Array.from([6,30,54,78,102,126,150]),Int32Array.from([6,24,50,76,102,128,154]),Int32Array.from([6,28,54,80,106,132,158]),Int32Array.from([6,32,58,84,110,136,162]),Int32Array.from([6,26,54,82,110,138,166]),Int32Array.from([6,30,58,86,114,142,170])]),Po.TYPE_INFO_COORDINATES=Array.from([Int32Array.from([8,0]),Int32Array.from([8,1]),Int32Array.from([8,2]),Int32Array.from([8,3]),Int32Array.from([8,4]),Int32Array.from([8,5]),Int32Array.from([8,7]),Int32Array.from([8,8]),Int32Array.from([7,8]),Int32Array.from([5,8]),Int32Array.from([4,8]),Int32Array.from([3,8]),Int32Array.from([2,8]),Int32Array.from([1,8]),Int32Array.from([0,8])]),Po.VERSION_INFO_POLY=7973,Po.TYPE_INFO_POLY=1335,Po.TYPE_INFO_MASK_PATTERN=21522;class g0{constructor(it,ct){this.dataBytes=it,this.errorCorrectionBytes=ct}getDataBytes(){return this.dataBytes}getErrorCorrectionBytes(){return this.errorCorrectionBytes}}class yo{constructor(){}static calculateMaskPenalty(it){return vu.applyMaskPenaltyRule1(it)+vu.applyMaskPenaltyRule2(it)+vu.applyMaskPenaltyRule3(it)+vu.applyMaskPenaltyRule4(it)}static encode(it,ct,pt=null){let Ct=yo.DEFAULT_BYTE_MODE_ENCODING;const It=pt!==null&&pt.get(ku.CHARACTER_SET)!==void 0;It&&(Ct=pt.get(ku.CHARACTER_SET).toString());const Dt=this.chooseMode(it,Ct),qt=new Gt;if(Dt===Uo.BYTE&&(It||yo.DEFAULT_BYTE_MODE_ENCODING!==Ct)){const Js=Rr.getCharacterSetECIByName(Ct);Js!==void 0&&this.appendECI(Js,qt)}this.appendModeInfo(Dt,qt);const Jt=new Gt;this.appendBytes(it,Dt,Jt,Ct);let ar;if(pt!==null&&pt.get(ku.QR_VERSION)!==void 0){const Js=Number.parseInt(pt.get(ku.QR_VERSION).toString(),10);ar=uo.getVersionForNumber(Js);const Hs=this.calculateBitsNeeded(Dt,qt,Jt,ar);if(!this.willFit(Hs,ar,ct))throw new go("Data too big for requested version")}else ar=this.recommendVersion(ct,Dt,qt,Jt);const Er=new Gt;Er.appendBitArray(qt);const Pr=Dt===Uo.BYTE?Jt.getSizeInBytes():it.length;this.appendLengthInfo(Pr,ar,Dt,Er),Er.appendBitArray(Jt);const Gr=ar.getECBlocksForLevel(ct),pn=ar.getTotalCodewords()-Gr.getTotalECCodewords();this.terminateBits(pn,Er);const An=this.interleaveWithECBytes(Er,ar.getTotalCodewords(),pn,Gr.getNumBlocks()),Pn=new No;Pn.setECLevel(ct),Pn.setMode(Dt),Pn.setVersion(ar);const Xn=ar.getDimensionForVersion(),os=new js(Xn,Xn),Ks=this.chooseMaskPattern(An,ct,ar,os);return Pn.setMaskPattern(Ks),Po.buildMatrix(An,ct,ar,Ks,os),Pn.setMatrix(os),Pn}static recommendVersion(it,ct,pt,Ct){const It=this.calculateBitsNeeded(ct,pt,Ct,uo.getVersionForNumber(1)),Dt=this.chooseVersion(It,it),qt=this.calculateBitsNeeded(ct,pt,Ct,Dt);return this.chooseVersion(qt,it)}static calculateBitsNeeded(it,ct,pt,Ct){return ct.getSize()+it.getCharacterCountBits(Ct)+pt.getSize()}static getAlphanumericCode(it){return it<yo.ALPHANUMERIC_TABLE.length?yo.ALPHANUMERIC_TABLE[it]:-1}static chooseMode(it,ct=null){if(Rr.SJIS.getName()===ct&&this.isOnlyDoubleByteKanji(it))return Uo.KANJI;let pt=!1,Ct=!1;for(let It=0,Dt=it.length;It<Dt;++It){const qt=it.charAt(It);if(yo.isDigit(qt))pt=!0;else if(this.getAlphanumericCode(qt.charCodeAt(0))!==-1)Ct=!0;else return Uo.BYTE}return Ct?Uo.ALPHANUMERIC:pt?Uo.NUMERIC:Uo.BYTE}static isOnlyDoubleByteKanji(it){let ct;try{ct=un.encode(it,Rr.SJIS)}catch{return!1}const pt=ct.length;if(pt%2!==0)return!1;for(let Ct=0;Ct<pt;Ct+=2){const It=ct[Ct]&255;if((It<129||It>159)&&(It<224||It>235))return!1}return!0}static chooseMaskPattern(it,ct,pt,Ct){let It=Number.MAX_SAFE_INTEGER,Dt=-1;for(let qt=0;qt<No.NUM_MASK_PATTERNS;qt++){Po.buildMatrix(it,ct,pt,qt,Ct);let Jt=this.calculateMaskPenalty(Ct);Jt<It&&(It=Jt,Dt=qt)}return Dt}static chooseVersion(it,ct){for(let pt=1;pt<=40;pt++){const Ct=uo.getVersionForNumber(pt);if(yo.willFit(it,Ct,ct))return Ct}throw new go("Data too big")}static willFit(it,ct,pt){const Ct=ct.getTotalCodewords(),Dt=ct.getECBlocksForLevel(pt).getTotalECCodewords(),qt=Ct-Dt,Jt=(it+7)/8;return qt>=Jt}static terminateBits(it,ct){const pt=it*8;if(ct.getSize()>pt)throw new go("data bits cannot fit in the QR Code"+ct.getSize()+" > "+pt);for(let Dt=0;Dt<4&&ct.getSize()<pt;++Dt)ct.appendBit(!1);const Ct=ct.getSize()&7;if(Ct>0)for(let Dt=Ct;Dt<8;Dt++)ct.appendBit(!1);const It=it-ct.getSizeInBytes();for(let Dt=0;Dt<It;++Dt)ct.appendBits(Dt&1?17:236,8);if(ct.getSize()!==pt)throw new go("Bits size does not equal capacity")}static getNumDataBytesAndNumECBytesForBlockID(it,ct,pt,Ct,It,Dt){if(Ct>=pt)throw new go("Block ID too large");const qt=it%pt,Jt=pt-qt,ar=Math.floor(it/pt),Er=ar+1,Pr=Math.floor(ct/pt),Gr=Pr+1,pn=ar-Pr,An=Er-Gr;if(pn!==An)throw new go("EC bytes mismatch");if(pt!==Jt+qt)throw new go("RS blocks mismatch");if(it!==(Pr+pn)*Jt+(Gr+An)*qt)throw new go("Total bytes mismatch");Ct<Jt?(It[0]=Pr,Dt[0]=pn):(It[0]=Gr,Dt[0]=An)}static interleaveWithECBytes(it,ct,pt,Ct){if(it.getSizeInBytes()!==pt)throw new go("Number of bits and data bytes does not match");let It=0,Dt=0,qt=0;const Jt=new Array;for(let Er=0;Er<Ct;++Er){const Pr=new Int32Array(1),Gr=new Int32Array(1);yo.getNumDataBytesAndNumECBytesForBlockID(ct,pt,Ct,Er,Pr,Gr);const pn=Pr[0],An=new Uint8Array(pn);it.toBytes(8*It,An,0,pn);const Pn=yo.generateECBytes(An,Gr[0]);Jt.push(new g0(An,Pn)),Dt=Math.max(Dt,pn),qt=Math.max(qt,Pn.length),It+=Pr[0]}if(pt!==It)throw new go("Data bytes does not match offset");const ar=new Gt;for(let Er=0;Er<Dt;++Er)for(const Pr of Jt){const Gr=Pr.getDataBytes();Er<Gr.length&&ar.appendBits(Gr[Er],8)}for(let Er=0;Er<qt;++Er)for(const Pr of Jt){const Gr=Pr.getErrorCorrectionBytes();Er<Gr.length&&ar.appendBits(Gr[Er],8)}if(ct!==ar.getSizeInBytes())throw new go("Interleaving error: "+ct+" and "+ar.getSizeInBytes()+" differ.");return ar}static generateECBytes(it,ct){const pt=it.length,Ct=new Int32Array(pt+ct);for(let Dt=0;Dt<pt;Dt++)Ct[Dt]=it[Dt]&255;new V0(ys.QR_CODE_FIELD_256).encode(Ct,ct);const It=new Uint8Array(ct);for(let Dt=0;Dt<ct;Dt++)It[Dt]=Ct[pt+Dt];return It}static appendModeInfo(it,ct){ct.appendBits(it.getBits(),4)}static appendLengthInfo(it,ct,pt,Ct){const It=pt.getCharacterCountBits(ct);if(it>=1<<It)throw new go(it+" is bigger than "+((1<<It)-1));Ct.appendBits(it,It)}static appendBytes(it,ct,pt,Ct){switch(ct){case Uo.NUMERIC:yo.appendNumericBytes(it,pt);break;case Uo.ALPHANUMERIC:yo.appendAlphanumericBytes(it,pt);break;case Uo.BYTE:yo.append8BitBytes(it,pt,Ct);break;case Uo.KANJI:yo.appendKanjiBytes(it,pt);break;default:throw new go("Invalid mode: "+ct)}}static getDigit(it){return it.charCodeAt(0)-48}static isDigit(it){const ct=yo.getDigit(it);return ct>=0&&ct<=9}static appendNumericBytes(it,ct){const pt=it.length;let Ct=0;for(;Ct<pt;){const It=yo.getDigit(it.charAt(Ct));if(Ct+2<pt){const Dt=yo.getDigit(it.charAt(Ct+1)),qt=yo.getDigit(it.charAt(Ct+2));ct.appendBits(It*100+Dt*10+qt,10),Ct+=3}else if(Ct+1<pt){const Dt=yo.getDigit(it.charAt(Ct+1));ct.appendBits(It*10+Dt,7),Ct+=2}else ct.appendBits(It,4),Ct++}}static appendAlphanumericBytes(it,ct){const pt=it.length;let Ct=0;for(;Ct<pt;){const It=yo.getAlphanumericCode(it.charCodeAt(Ct));if(It===-1)throw new go;if(Ct+1<pt){const Dt=yo.getAlphanumericCode(it.charCodeAt(Ct+1));if(Dt===-1)throw new go;ct.appendBits(It*45+Dt,11),Ct+=2}else ct.appendBits(It,6),Ct++}}static append8BitBytes(it,ct,pt){let Ct;try{Ct=un.encode(it,pt)}catch(It){throw new go(It)}for(let It=0,Dt=Ct.length;It!==Dt;It++){const qt=Ct[It];ct.appendBits(qt,8)}}static appendKanjiBytes(it,ct){let pt;try{pt=un.encode(it,Rr.SJIS)}catch(It){throw new go(It)}const Ct=pt.length;for(let It=0;It<Ct;It+=2){const Dt=pt[It]&255,qt=pt[It+1]&255,Jt=Dt<<8&4294967295|qt;let ar=-1;if(Jt>=33088&&Jt<=40956?ar=Jt-33088:Jt>=57408&&Jt<=60351&&(ar=Jt-49472),ar===-1)throw new go("Invalid byte sequence");const Er=(ar>>8)*192+(ar&255);ct.appendBits(Er,13)}}static appendECI(it,ct){ct.appendBits(Uo.ECI.getBits(),4),ct.appendBits(it.getValue(),8)}}yo.ALPHANUMERIC_TABLE=Int32Array.from([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,36,-1,-1,-1,37,38,-1,-1,-1,-1,39,40,-1,41,42,43,0,1,2,3,4,5,6,7,8,9,44,-1,-1,-1,-1,-1,-1,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,-1,-1,-1,-1,-1]),yo.DEFAULT_BYTE_MODE_ENCODING=Rr.UTF8.getName();class y0{write(it,ct,pt,Ct=null){if(it.length===0)throw new St("Found empty contents");if(ct<0||pt<0)throw new St("Requested dimensions are too small: "+ct+"x"+pt);let It=Il.L,Dt=y0.QUIET_ZONE_SIZE;Ct!==null&&(Ct.get(ku.ERROR_CORRECTION)!==void 0&&(It=Il.fromString(Ct.get(ku.ERROR_CORRECTION).toString())),Ct.get(ku.MARGIN)!==void 0&&(Dt=Number.parseInt(Ct.get(ku.MARGIN).toString(),10)));const qt=yo.encode(it,It,Ct);return this.renderResult(qt,ct,pt,Dt)}writeToDom(it,ct,pt,Ct,It=null){typeof it=="string"&&(it=document.querySelector(it));const Dt=this.write(ct,pt,Ct,It);it&&it.appendChild(Dt)}renderResult(it,ct,pt,Ct){const It=it.getMatrix();if(It===null)throw new Es;const Dt=It.getWidth(),qt=It.getHeight(),Jt=Dt+Ct*2,ar=qt+Ct*2,Er=Math.max(ct,Jt),Pr=Math.max(pt,ar),Gr=Math.min(Math.floor(Er/Jt),Math.floor(Pr/ar)),pn=Math.floor((Er-Dt*Gr)/2),An=Math.floor((Pr-qt*Gr)/2),Pn=this.createSVGElement(Er,Pr);for(let Xn=0,os=An;Xn<qt;Xn++,os+=Gr)for(let Ks=0,Js=pn;Ks<Dt;Ks++,Js+=Gr)if(It.get(Ks,Xn)===1){const Hs=this.createSvgRectElement(Js,os,Gr,Gr);Pn.appendChild(Hs)}return Pn}createSVGElement(it,ct){const pt=document.createElementNS(y0.SVG_NS,"svg");return pt.setAttributeNS(null,"height",it.toString()),pt.setAttributeNS(null,"width",ct.toString()),pt}createSvgRectElement(it,ct,pt,Ct){const It=document.createElementNS(y0.SVG_NS,"rect");return It.setAttributeNS(null,"x",it.toString()),It.setAttributeNS(null,"y",ct.toString()),It.setAttributeNS(null,"height",pt.toString()),It.setAttributeNS(null,"width",Ct.toString()),It.setAttributeNS(null,"fill","#000000"),It}}y0.QUIET_ZONE_SIZE=4,y0.SVG_NS="http://www.w3.org/2000/svg";class _0{encode(it,ct,pt,Ct,It){if(it.length===0)throw new St("Found empty contents");if(ct!==rs.QR_CODE)throw new St("Can only encode QR_CODE, but got "+ct);if(pt<0||Ct<0)throw new St(`Requested dimensions are too small: ${pt}x${Ct}`);let Dt=Il.L,qt=_0.QUIET_ZONE_SIZE;It!==null&&(It.get(ku.ERROR_CORRECTION)!==void 0&&(Dt=Il.fromString(It.get(ku.ERROR_CORRECTION).toString())),It.get(ku.MARGIN)!==void 0&&(qt=Number.parseInt(It.get(ku.MARGIN).toString(),10)));const Jt=yo.encode(it,Dt,It);return _0.renderResult(Jt,pt,Ct,qt)}static renderResult(it,ct,pt,Ct){const It=it.getMatrix();if(It===null)throw new Es;const Dt=It.getWidth(),qt=It.getHeight(),Jt=Dt+Ct*2,ar=qt+Ct*2,Er=Math.max(ct,Jt),Pr=Math.max(pt,ar),Gr=Math.min(Math.floor(Er/Jt),Math.floor(Pr/ar)),pn=Math.floor((Er-Dt*Gr)/2),An=Math.floor((Pr-qt*Gr)/2),Pn=new fn(Er,Pr);for(let Xn=0,os=An;Xn<qt;Xn++,os+=Gr)for(let Ks=0,Js=pn;Ks<Dt;Ks++,Js+=Gr)It.get(Ks,Xn)===1&&Pn.setRegion(Js,os,Gr,Gr);return Pn}}_0.QUIET_ZONE_SIZE=4;class Qm{encode(it,ct,pt,Ct,It){let Dt;switch(ct){case rs.QR_CODE:Dt=new _0;break;default:throw new St("No encoder available for format "+ct)}return Dt.encode(it,ct,pt,Ct,It)}}class Uu extends dr{constructor(it,ct,pt,Ct,It,Dt,qt,Jt){if(super(Dt,qt),this.yuvData=it,this.dataWidth=ct,this.dataHeight=pt,this.left=Ct,this.top=It,Ct+Dt>ct||It+qt>pt)throw new St("Crop rectangle does not fit within image data.");Jt&&this.reverseHorizontal(Dt,qt)}getRow(it,ct){if(it<0||it>=this.getHeight())throw new St("Requested row is outside the image: "+it);const pt=this.getWidth();(ct==null||ct.length<pt)&&(ct=new Uint8ClampedArray(pt));const Ct=(it+this.top)*this.dataWidth+this.left;return Bt.arraycopy(this.yuvData,Ct,ct,0,pt),ct}getMatrix(){const it=this.getWidth(),ct=this.getHeight();if(it===this.dataWidth&&ct===this.dataHeight)return this.yuvData;const pt=it*ct,Ct=new Uint8ClampedArray(pt);let It=this.top*this.dataWidth+this.left;if(it===this.dataWidth)return Bt.arraycopy(this.yuvData,It,Ct,0,pt),Ct;for(let Dt=0;Dt<ct;Dt++){const qt=Dt*it;Bt.arraycopy(this.yuvData,It,Ct,qt,it),It+=this.dataWidth}return Ct}isCropSupported(){return!0}crop(it,ct,pt,Ct){return new Uu(this.yuvData,this.dataWidth,this.dataHeight,this.left+it,this.top+ct,pt,Ct,!1)}renderThumbnail(){const it=this.getWidth()/Uu.THUMBNAIL_SCALE_FACTOR,ct=this.getHeight()/Uu.THUMBNAIL_SCALE_FACTOR,pt=new Int32Array(it*ct),Ct=this.yuvData;let It=this.top*this.dataWidth+this.left;for(let Dt=0;Dt<ct;Dt++){const qt=Dt*it;for(let Jt=0;Jt<it;Jt++){const ar=Ct[It+Jt*Uu.THUMBNAIL_SCALE_FACTOR]&255;pt[qt+Jt]=4278190080|ar*65793}It+=this.dataWidth*Uu.THUMBNAIL_SCALE_FACTOR}return pt}getThumbnailWidth(){return this.getWidth()/Uu.THUMBNAIL_SCALE_FACTOR}getThumbnailHeight(){return this.getHeight()/Uu.THUMBNAIL_SCALE_FACTOR}reverseHorizontal(it,ct){const pt=this.yuvData;for(let Ct=0,It=this.top*this.dataWidth+this.left;Ct<ct;Ct++,It+=this.dataWidth){const Dt=It+it/2;for(let qt=It,Jt=It+it-1;qt<Dt;qt++,Jt--){const ar=pt[qt];pt[qt]=pt[Jt],pt[Jt]=ar}}}invert(){return new gr(this)}}Uu.THUMBNAIL_SCALE_FACTOR=2;class Nu extends dr{constructor(it,ct,pt,Ct,It,Dt,qt){if(super(ct,pt),this.dataWidth=Ct,this.dataHeight=It,this.left=Dt,this.top=qt,it.BYTES_PER_ELEMENT===4){const Jt=ct*pt,ar=new Uint8ClampedArray(Jt);for(let Er=0;Er<Jt;Er++){const Pr=it[Er],Gr=Pr>>16&255,pn=Pr>>7&510,An=Pr&255;ar[Er]=(Gr+pn+An)/4&255}this.luminances=ar}else this.luminances=it;if(Ct===void 0&&(this.dataWidth=ct),It===void 0&&(this.dataHeight=pt),Dt===void 0&&(this.left=0),qt===void 0&&(this.top=0),this.left+ct>this.dataWidth||this.top+pt>this.dataHeight)throw new St("Crop rectangle does not fit within image data.")}getRow(it,ct){if(it<0||it>=this.getHeight())throw new St("Requested row is outside the image: "+it);const pt=this.getWidth();(ct==null||ct.length<pt)&&(ct=new Uint8ClampedArray(pt));const Ct=(it+this.top)*this.dataWidth+this.left;return Bt.arraycopy(this.luminances,Ct,ct,0,pt),ct}getMatrix(){const it=this.getWidth(),ct=this.getHeight();if(it===this.dataWidth&&ct===this.dataHeight)return this.luminances;const pt=it*ct,Ct=new Uint8ClampedArray(pt);let It=this.top*this.dataWidth+this.left;if(it===this.dataWidth)return Bt.arraycopy(this.luminances,It,Ct,0,pt),Ct;for(let Dt=0;Dt<ct;Dt++){const qt=Dt*it;Bt.arraycopy(this.luminances,It,Ct,qt,it),It+=this.dataWidth}return Ct}isCropSupported(){return!0}crop(it,ct,pt,Ct){return new Nu(this.luminances,pt,Ct,this.dataWidth,this.dataHeight,this.left+it,this.top+ct)}invert(){return new gr(this)}}class ey extends Rr{static forName(it){return this.getCharacterSetECIByName(it)}}class v0{}v0.ISO_8859_1=Rr.ISO8859_1;class Rx{isCompact(){return this.compact}setCompact(it){this.compact=it}getSize(){return this.size}setSize(it){this.size=it}getLayers(){return this.layers}setLayers(it){this.layers=it}getCodeWords(){return this.codeWords}setCodeWords(it){this.codeWords=it}getMatrix(){return this.matrix}setMatrix(it){this.matrix=it}}class Dm{static singletonList(it){return[it]}static min(it,ct){return it.sort(ct)[0]}}class Ix{constructor(it){this.previous=it}getPrevious(){return this.previous}}class U0 extends Ix{constructor(it,ct,pt){super(it),this.value=ct,this.bitCount=pt}appendTo(it,ct){it.appendBits(this.value,this.bitCount)}add(it,ct){return new U0(this,it,ct)}addBinaryShift(it,ct){return console.warn("addBinaryShift on SimpleToken, this simply returns a copy of this token"),new U0(this,it,ct)}toString(){let it=this.value&(1<<this.bitCount)-1;return it|=1<<this.bitCount,"<"+Nt.toBinaryString(it|1<<this.bitCount).substring(1)+">"}}class Pm extends U0{constructor(it,ct,pt){super(it,0,0),this.binaryShiftStart=ct,this.binaryShiftByteCount=pt}appendTo(it,ct){for(let pt=0;pt<this.binaryShiftByteCount;pt++)(pt===0||pt===31&&this.binaryShiftByteCount<=62)&&(it.appendBits(31,5),this.binaryShiftByteCount>62?it.appendBits(this.binaryShiftByteCount-31,16):pt===0?it.appendBits(Math.min(this.binaryShiftByteCount,31),5):it.appendBits(this.binaryShiftByteCount-31,5)),it.appendBits(ct[this.binaryShiftStart+pt],8)}addBinaryShift(it,ct){return new Pm(this,it,ct)}toString(){return"<"+this.binaryShiftStart+"::"+(this.binaryShiftStart+this.binaryShiftByteCount-1)+">"}}function bp(wr,it,ct){return new Pm(wr,it,ct)}function zp(wr,it,ct){return new U0(wr,it,ct)}const wp=["UPPER","LOWER","DIGIT","MIXED","PUNCT"],Bp=0,P0=1,mu=2,Vp=3,pp=4,_h=new U0(null,0,0),Jm=[Int32Array.from([0,(5<<16)+28,(5<<16)+30,(5<<16)+29,656318]),Int32Array.from([(9<<16)+480+14,0,(5<<16)+30,(5<<16)+29,656318]),Int32Array.from([(4<<16)+14,(9<<16)+448+28,0,(9<<16)+448+29,932798]),Int32Array.from([(5<<16)+29,(5<<16)+28,656318,0,(5<<16)+30]),Int32Array.from([(5<<16)+31,656380,656382,656381,0])];function n0(wr){for(let it of wr)Ut.fill(it,-1);return wr[Bp][pp]=0,wr[P0][pp]=0,wr[P0][Bp]=28,wr[Vp][pp]=0,wr[mu][pp]=0,wr[mu][Bp]=15,wr}const i0=n0(Ut.createInt32Array(6,6));class co{constructor(it,ct,pt,Ct){this.token=it,this.mode=ct,this.binaryShiftByteCount=pt,this.bitCount=Ct}getMode(){return this.mode}getToken(){return this.token}getBinaryShiftByteCount(){return this.binaryShiftByteCount}getBitCount(){return this.bitCount}latchAndAppend(it,ct){let pt=this.bitCount,Ct=this.token;if(it!==this.mode){let Dt=Jm[this.mode][it];Ct=zp(Ct,Dt&65535,Dt>>16),pt+=Dt>>16}let It=it===mu?4:5;return Ct=zp(Ct,ct,It),new co(Ct,it,0,pt+It)}shiftAndAppend(it,ct){let pt=this.token,Ct=this.mode===mu?4:5;return pt=zp(pt,i0[this.mode][it],Ct),pt=zp(pt,ct,5),new co(pt,this.mode,0,this.bitCount+Ct+5)}addBinaryShiftChar(it){let ct=this.token,pt=this.mode,Ct=this.bitCount;if(this.mode===pp||this.mode===mu){let qt=Jm[pt][Bp];ct=zp(ct,qt&65535,qt>>16),Ct+=qt>>16,pt=Bp}let It=this.binaryShiftByteCount===0||this.binaryShiftByteCount===31?18:this.binaryShiftByteCount===62?9:8,Dt=new co(ct,pt,this.binaryShiftByteCount+1,Ct+It);return Dt.binaryShiftByteCount===2078&&(Dt=Dt.endBinaryShift(it+1)),Dt}endBinaryShift(it){if(this.binaryShiftByteCount===0)return this;let ct=this.token;return ct=bp(ct,it-this.binaryShiftByteCount,this.binaryShiftByteCount),new co(ct,this.mode,0,this.bitCount)}isBetterThanOrEqualTo(it){let ct=this.bitCount+(Jm[this.mode][it.mode]>>16);return this.binaryShiftByteCount<it.binaryShiftByteCount?ct+=co.calculateBinaryShiftCost(it)-co.calculateBinaryShiftCost(this):this.binaryShiftByteCount>it.binaryShiftByteCount&&it.binaryShiftByteCount>0&&(ct+=10),ct<=it.bitCount}toBitArray(it){let ct=[];for(let Ct=this.endBinaryShift(it.length).token;Ct!==null;Ct=Ct.getPrevious())ct.unshift(Ct);let pt=new Gt;for(const Ct of ct)Ct.appendTo(pt,it);return pt}toString(){return jr.format("%s bits=%d bytes=%d",wp[this.mode],this.bitCount,this.binaryShiftByteCount)}static calculateBinaryShiftCost(it){return it.binaryShiftByteCount>62?21:it.binaryShiftByteCount>31?20:it.binaryShiftByteCount>0?10:0}}co.INITIAL_STATE=new co(_h,Bp,0,0);function Us(wr){const it=jr.getCharCode(" "),ct=jr.getCharCode("."),pt=jr.getCharCode(",");wr[Bp][it]=1;const Ct=jr.getCharCode("Z"),It=jr.getCharCode("A");for(let Gr=It;Gr<=Ct;Gr++)wr[Bp][Gr]=Gr-It+2;wr[P0][it]=1;const Dt=jr.getCharCode("z"),qt=jr.getCharCode("a");for(let Gr=qt;Gr<=Dt;Gr++)wr[P0][Gr]=Gr-qt+2;wr[mu][it]=1;const Jt=jr.getCharCode("9"),ar=jr.getCharCode("0");for(let Gr=ar;Gr<=Jt;Gr++)wr[mu][Gr]=Gr-ar+2;wr[mu][pt]=12,wr[mu][ct]=13;const Er=["\0"," ","","","","","","","\x07","\b","	",`
`,"\v","\f","\r","\x1B","","","","","@","\\","^","_","`","|","~",""];for(let Gr=0;Gr<Er.length;Gr++)wr[Vp][jr.getCharCode(Er[Gr])]=Gr;const Pr=["\0","\r","\0","\0","\0","\0","!","'","#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","[","]","{","}"];for(let Gr=0;Gr<Pr.length;Gr++)jr.getCharCode(Pr[Gr])>0&&(wr[pp][jr.getCharCode(Pr[Gr])]=Gr);return wr}const km=Us(Ut.createInt32Array(5,256));class oo{constructor(it){this.text=it}encode(){const it=jr.getCharCode(" "),ct=jr.getCharCode(`
`);let pt=Dm.singletonList(co.INITIAL_STATE);for(let It=0;It<this.text.length;It++){let Dt,qt=It+1<this.text.length?this.text[It+1]:0;switch(this.text[It]){case jr.getCharCode("\r"):Dt=qt===ct?2:0;break;case jr.getCharCode("."):Dt=qt===it?3:0;break;case jr.getCharCode(","):Dt=qt===it?4:0;break;case jr.getCharCode(":"):Dt=qt===it?5:0;break;default:Dt=0}Dt>0?(pt=oo.updateStateListForPair(pt,It,Dt),It++):pt=this.updateStateListForChar(pt,It)}return Dm.min(pt,(It,Dt)=>It.getBitCount()-Dt.getBitCount()).toBitArray(this.text)}updateStateListForChar(it,ct){const pt=[];for(let Ct of it)this.updateStateForChar(Ct,ct,pt);return oo.simplifyStates(pt)}updateStateForChar(it,ct,pt){let Ct=this.text[ct]&255,It=km[it.getMode()][Ct]>0,Dt=null;for(let qt=0;qt<=pp;qt++){let Jt=km[qt][Ct];if(Jt>0){if(Dt==null&&(Dt=it.endBinaryShift(ct)),!It||qt===it.getMode()||qt===mu){const ar=Dt.latchAndAppend(qt,Jt);pt.push(ar)}if(!It&&i0[it.getMode()][qt]>=0){const ar=Dt.shiftAndAppend(qt,Jt);pt.push(ar)}}}if(it.getBinaryShiftByteCount()>0||km[it.getMode()][Ct]===0){let qt=it.addBinaryShiftChar(ct);pt.push(qt)}}static updateStateListForPair(it,ct,pt){const Ct=[];for(let It of it)this.updateStateForPair(It,ct,pt,Ct);return this.simplifyStates(Ct)}static updateStateForPair(it,ct,pt,Ct){let It=it.endBinaryShift(ct);if(Ct.push(It.latchAndAppend(pp,pt)),it.getMode()!==pp&&Ct.push(It.shiftAndAppend(pp,pt)),pt===3||pt===4){let Dt=It.latchAndAppend(mu,16-pt).latchAndAppend(mu,1);Ct.push(Dt)}if(it.getBinaryShiftByteCount()>0){let Dt=it.addBinaryShiftChar(ct).addBinaryShiftChar(ct+1);Ct.push(Dt)}}static simplifyStates(it){let ct=[];for(const pt of it){let Ct=!0;for(const It of ct){if(It.isBetterThanOrEqualTo(pt)){Ct=!1;break}pt.isBetterThanOrEqualTo(It)&&(ct=ct.filter(Dt=>Dt!==It))}Ct&&ct.push(pt)}return ct}}class nu{constructor(){}static encodeBytes(it){return nu.encode(it,nu.DEFAULT_EC_PERCENT,nu.DEFAULT_AZTEC_LAYERS)}static encode(it,ct,pt){let Ct=new oo(it).encode(),It=Nt.truncDivision(Ct.getSize()*ct,100)+11,Dt=Ct.getSize()+It,qt,Jt,ar,Er,Pr;if(pt!==nu.DEFAULT_AZTEC_LAYERS){if(qt=pt<0,Jt=Math.abs(pt),Jt>(qt?nu.MAX_NB_BITS_COMPACT:nu.MAX_NB_BITS))throw new St(jr.format("Illegal value %s for layers",pt));ar=nu.totalBitsInLayer(Jt,qt),Er=nu.WORD_SIZE[Jt];let Hs=ar-ar%Er;if(Pr=nu.stuffBits(Ct,Er),Pr.getSize()+It>Hs)throw new St("Data to large for user specified layer");if(qt&&Pr.getSize()>Er*64)throw new St("Data to large for user specified layer")}else{Er=0,Pr=null;for(let Hs=0;;Hs++){if(Hs>nu.MAX_NB_BITS)throw new St("Data too large for an Aztec code");if(qt=Hs<=3,Jt=qt?Hs+1:Hs,ar=nu.totalBitsInLayer(Jt,qt),Dt>ar)continue;(Pr==null||Er!==nu.WORD_SIZE[Jt])&&(Er=nu.WORD_SIZE[Jt],Pr=nu.stuffBits(Ct,Er));let lu=ar-ar%Er;if(!(qt&&Pr.getSize()>Er*64)&&Pr.getSize()+It<=lu)break}}let Gr=nu.generateCheckWords(Pr,ar,Er),pn=Pr.getSize()/Er,An=nu.generateModeMessage(qt,Jt,pn),Pn=(qt?11:14)+Jt*4,Xn=new Int32Array(Pn),os;if(qt){os=Pn;for(let Hs=0;Hs<Xn.length;Hs++)Xn[Hs]=Hs}else{os=Pn+1+2*Nt.truncDivision(Nt.truncDivision(Pn,2)-1,15);let Hs=Nt.truncDivision(Pn,2),lu=Nt.truncDivision(os,2);for(let zl=0;zl<Hs;zl++){let kp=zl+Nt.truncDivision(zl,15);Xn[Hs-zl-1]=lu-kp-1,Xn[Hs+zl]=lu+kp+1}}let Ks=new fn(os);for(let Hs=0,lu=0;Hs<Jt;Hs++){let zl=(Jt-Hs)*4+(qt?9:12);for(let kp=0;kp<zl;kp++){let Up=kp*2;for(let ap=0;ap<2;ap++)Gr.get(lu+Up+ap)&&Ks.set(Xn[Hs*2+ap],Xn[Hs*2+kp]),Gr.get(lu+zl*2+Up+ap)&&Ks.set(Xn[Hs*2+kp],Xn[Pn-1-Hs*2-ap]),Gr.get(lu+zl*4+Up+ap)&&Ks.set(Xn[Pn-1-Hs*2-ap],Xn[Pn-1-Hs*2-kp]),Gr.get(lu+zl*6+Up+ap)&&Ks.set(Xn[Pn-1-Hs*2-kp],Xn[Hs*2+ap])}lu+=zl*8}if(nu.drawModeMessage(Ks,qt,os,An),qt)nu.drawBullsEye(Ks,Nt.truncDivision(os,2),5);else{nu.drawBullsEye(Ks,Nt.truncDivision(os,2),7);for(let Hs=0,lu=0;Hs<Nt.truncDivision(Pn,2)-1;Hs+=15,lu+=16)for(let zl=Nt.truncDivision(os,2)&1;zl<os;zl+=2)Ks.set(Nt.truncDivision(os,2)-lu,zl),Ks.set(Nt.truncDivision(os,2)+lu,zl),Ks.set(zl,Nt.truncDivision(os,2)-lu),Ks.set(zl,Nt.truncDivision(os,2)+lu)}let Js=new Rx;return Js.setCompact(qt),Js.setSize(os),Js.setLayers(Jt),Js.setCodeWords(pn),Js.setMatrix(Ks),Js}static drawBullsEye(it,ct,pt){for(let Ct=0;Ct<pt;Ct+=2)for(let It=ct-Ct;It<=ct+Ct;It++)it.set(It,ct-Ct),it.set(It,ct+Ct),it.set(ct-Ct,It),it.set(ct+Ct,It);it.set(ct-pt,ct-pt),it.set(ct-pt+1,ct-pt),it.set(ct-pt,ct-pt+1),it.set(ct+pt,ct-pt),it.set(ct+pt,ct-pt+1),it.set(ct+pt,ct+pt-1)}static generateModeMessage(it,ct,pt){let Ct=new Gt;return it?(Ct.appendBits(ct-1,2),Ct.appendBits(pt-1,6),Ct=nu.generateCheckWords(Ct,28,4)):(Ct.appendBits(ct-1,5),Ct.appendBits(pt-1,11),Ct=nu.generateCheckWords(Ct,40,4)),Ct}static drawModeMessage(it,ct,pt,Ct){let It=Nt.truncDivision(pt,2);if(ct)for(let Dt=0;Dt<7;Dt++){let qt=It-3+Dt;Ct.get(Dt)&&it.set(qt,It-5),Ct.get(Dt+7)&&it.set(It+5,qt),Ct.get(20-Dt)&&it.set(qt,It+5),Ct.get(27-Dt)&&it.set(It-5,qt)}else for(let Dt=0;Dt<10;Dt++){let qt=It-5+Dt+Nt.truncDivision(Dt,5);Ct.get(Dt)&&it.set(qt,It-7),Ct.get(Dt+10)&&it.set(It+7,qt),Ct.get(29-Dt)&&it.set(qt,It+7),Ct.get(39-Dt)&&it.set(It-7,qt)}}static generateCheckWords(it,ct,pt){let Ct=it.getSize()/pt,It=new V0(nu.getGF(pt)),Dt=Nt.truncDivision(ct,pt),qt=nu.bitsToWords(it,pt,Dt);It.encode(qt,Dt-Ct);let Jt=ct%pt,ar=new Gt;ar.appendBits(0,Jt);for(const Er of Array.from(qt))ar.appendBits(Er,pt);return ar}static bitsToWords(it,ct,pt){let Ct=new Int32Array(pt),It,Dt;for(It=0,Dt=it.getSize()/ct;It<Dt;It++){let qt=0;for(let Jt=0;Jt<ct;Jt++)qt|=it.get(It*ct+Jt)?1<<ct-Jt-1:0;Ct[It]=qt}return Ct}static getGF(it){switch(it){case 4:return ys.AZTEC_PARAM;case 6:return ys.AZTEC_DATA_6;case 8:return ys.AZTEC_DATA_8;case 10:return ys.AZTEC_DATA_10;case 12:return ys.AZTEC_DATA_12;default:throw new St("Unsupported word size "+it)}}static stuffBits(it,ct){let pt=new Gt,Ct=it.getSize(),It=(1<<ct)-2;for(let Dt=0;Dt<Ct;Dt+=ct){let qt=0;for(let Jt=0;Jt<ct;Jt++)(Dt+Jt>=Ct||it.get(Dt+Jt))&&(qt|=1<<ct-1-Jt);(qt&It)===It?(pt.appendBits(qt&It,ct),Dt--):qt&It?pt.appendBits(qt,ct):(pt.appendBits(qt|1,ct),Dt--)}return pt}static totalBitsInLayer(it,ct){return((ct?88:112)+16*it)*it}}nu.DEFAULT_EC_PERCENT=33,nu.DEFAULT_AZTEC_LAYERS=0,nu.MAX_NB_BITS=32,nu.MAX_NB_BITS_COMPACT=4,nu.WORD_SIZE=Int32Array.from([4,6,6,8,8,8,8,8,8,10,10,10,10,10,10,10,10,10,10,10,10,10,10,12,12,12,12,12,12,12,12,12,12]);class tm{encode(it,ct,pt,Ct){return this.encodeWithHints(it,ct,pt,Ct,null)}encodeWithHints(it,ct,pt,Ct,It){let Dt=v0.ISO_8859_1,qt=nu.DEFAULT_EC_PERCENT,Jt=nu.DEFAULT_AZTEC_LAYERS;return It!=null&&(It.has(ku.CHARACTER_SET)&&(Dt=ey.forName(It.get(ku.CHARACTER_SET).toString())),It.has(ku.ERROR_CORRECTION)&&(qt=Nt.parseInt(It.get(ku.ERROR_CORRECTION).toString())),It.has(ku.AZTEC_LAYERS)&&(Jt=Nt.parseInt(It.get(ku.AZTEC_LAYERS).toString()))),tm.encodeLayers(it,ct,pt,Ct,Dt,qt,Jt)}static encodeLayers(it,ct,pt,Ct,It,Dt,qt){if(ct!==rs.AZTEC)throw new St("Can only encode AZTEC, but got "+ct);let Jt=nu.encode(jr.getBytes(it,It),Dt,qt);return tm.renderResult(Jt,pt,Ct)}static renderResult(it,ct,pt){let Ct=it.getMatrix();if(Ct==null)throw new Es;let It=Ct.getWidth(),Dt=Ct.getHeight(),qt=Math.max(ct,It),Jt=Math.max(pt,Dt),ar=Math.min(qt/It,Jt/Dt),Er=(qt-It*ar)/2,Pr=(Jt-Dt*ar)/2,Gr=new fn(qt,Jt);for(let pn=0,An=Pr;pn<Dt;pn++,An+=ar)for(let Pn=0,Xn=Er;Pn<It;Pn++,Xn+=ar)Ct.get(Pn,pn)&&Gr.setRegion(Xn,An,ar,ar);return Gr}}s.AbstractExpandedDecoder=pr,s.ArgumentException=Et,s.ArithmeticException=lo,s.AztecCode=Rx,s.AztecCodeReader=Gl,s.AztecCodeWriter=tm,s.AztecDecoder=tn,s.AztecDetector=Wo,s.AztecDetectorResult=Tl,s.AztecEncoder=nu,s.AztecHighLevelEncoder=oo,s.AztecPoint=ao,s.BarcodeFormat=rs,s.Binarizer=Vt,s.BinaryBitmap=At,s.BitArray=Gt,s.BitMatrix=fn,s.BitSource=du,s.BrowserAztecCodeReader=fs,s.BrowserBarcodeReader=yu,s.BrowserCodeReader=gn,s.BrowserDatamatrixCodeReader=Ip,s.BrowserMultiFormatReader=J1,s.BrowserPDF417Reader=so,s.BrowserQRCodeReader=d1,s.BrowserQRCodeSvgWriter=y0,s.CharacterSetECI=Rr,s.ChecksumException=Pt,s.Code128Reader=qn,s.Code39Reader=qs,s.DataMatrixDecodedBitStreamParser=Do,s.DataMatrixReader=qu,s.DecodeHintType=ir,s.DecoderResult=ws,s.DefaultGridSampler=Cs,s.DetectorResult=Ul,s.EAN13Reader=ru,s.EncodeHintType=ku,s.Exception=ht,s.FormatException=or,s.GenericGF=ys,s.GenericGFPoly=ks,s.GlobalHistogramBinarizer=Cr,s.GridSampler=ds,s.GridSamplerInstance=Ds,s.HTMLCanvasElementLuminanceSource=qr,s.HybridBinarizer=Sr,s.ITFReader=Gs,s.IllegalArgumentException=St,s.IllegalStateException=Es,s.InvertedLuminanceSource=gr,s.LuminanceSource=dr,s.MathUtils=us,s.MultiFormatOneDReader=jo,s.MultiFormatReader=u1,s.MultiFormatWriter=Qm,s.NotFoundException=Fr,s.OneDReader=ps,s.PDF417DecodedBitStreamParser=cs,s.PDF417DecoderErrorCorrection=p0,s.PDF417Reader=Mo,s.PDF417ResultMetadata=Rm,s.PerspectiveTransform=Mn,s.PlanarYUVLuminanceSource=Uu,s.QRCodeByteMatrix=js,s.QRCodeDataMask=yp,s.QRCodeDecodedBitStreamParser=_u,s.QRCodeDecoderErrorCorrectionLevel=Il,s.QRCodeDecoderFormatInformation=Mu,s.QRCodeEncoder=yo,s.QRCodeEncoderQRCode=No,s.QRCodeMaskUtil=vu,s.QRCodeMatrixUtil=Po,s.QRCodeMode=Uo,s.QRCodeReader=Fp,s.QRCodeVersion=uo,s.QRCodeWriter=_0,s.RGBLuminanceSource=Nu,s.RSS14Reader=Ys,s.RSSExpandedReader=Gn,s.ReaderException=Ym,s.ReedSolomonDecoder=po,s.ReedSolomonEncoder=V0,s.ReedSolomonException=dn,s.Result=Sn,s.ResultMetadataType=On,s.ResultPoint=Ss,s.StringUtils=jr,s.UnsupportedOperationException=on,s.VideoInputDevice=Lr,s.WhiteRectangleDetector=ga,s.WriterException=go,s.ZXingArrays=Ut,s.ZXingCharset=ey,s.ZXingInteger=Nt,s.ZXingStandardCharsets=v0,s.ZXingStringBuilder=Jr,s.ZXingStringEncoding=un,s.ZXingSystem=Bt,s.createAbstractExpandedDecoder=Ts,Object.defineProperty(s,"__esModule",{value:!0})})})(zxingJs_umd$1,zxingJs_umd$1.exports);var zxingJs_umdExports=zxingJs_umd$1.exports;const zxingJs_umd=getDefaultExportFromCjs(zxingJs_umdExports),ZXing=_mergeNamespaces({__proto__:null,default:zxingJs_umd},[zxingJs_umdExports]);var ZXingHtml5QrcodeDecoder=function(){function e(i,s,a){if(this.formatMap=new Map([[Html5QrcodeSupportedFormats.QR_CODE,zxingJs_umdExports.BarcodeFormat.QR_CODE],[Html5QrcodeSupportedFormats.AZTEC,zxingJs_umdExports.BarcodeFormat.AZTEC],[Html5QrcodeSupportedFormats.CODABAR,zxingJs_umdExports.BarcodeFormat.CODABAR],[Html5QrcodeSupportedFormats.CODE_39,zxingJs_umdExports.BarcodeFormat.CODE_39],[Html5QrcodeSupportedFormats.CODE_93,zxingJs_umdExports.BarcodeFormat.CODE_93],[Html5QrcodeSupportedFormats.CODE_128,zxingJs_umdExports.BarcodeFormat.CODE_128],[Html5QrcodeSupportedFormats.DATA_MATRIX,zxingJs_umdExports.BarcodeFormat.DATA_MATRIX],[Html5QrcodeSupportedFormats.MAXICODE,zxingJs_umdExports.BarcodeFormat.MAXICODE],[Html5QrcodeSupportedFormats.ITF,zxingJs_umdExports.BarcodeFormat.ITF],[Html5QrcodeSupportedFormats.EAN_13,zxingJs_umdExports.BarcodeFormat.EAN_13],[Html5QrcodeSupportedFormats.EAN_8,zxingJs_umdExports.BarcodeFormat.EAN_8],[Html5QrcodeSupportedFormats.PDF_417,zxingJs_umdExports.BarcodeFormat.PDF_417],[Html5QrcodeSupportedFormats.RSS_14,zxingJs_umdExports.BarcodeFormat.RSS_14],[Html5QrcodeSupportedFormats.RSS_EXPANDED,zxingJs_umdExports.BarcodeFormat.RSS_EXPANDED],[Html5QrcodeSupportedFormats.UPC_A,zxingJs_umdExports.BarcodeFormat.UPC_A],[Html5QrcodeSupportedFormats.UPC_E,zxingJs_umdExports.BarcodeFormat.UPC_E],[Html5QrcodeSupportedFormats.UPC_EAN_EXTENSION,zxingJs_umdExports.BarcodeFormat.UPC_EAN_EXTENSION]]),this.reverseFormatMap=this.createReverseFormatMap(),!ZXing)throw"Use html5qrcode.min.js without edit, ZXing not found.";this.verbose=s,this.logger=a;var _=this.createZXingFormats(i),$=new Map;$.set(zxingJs_umdExports.DecodeHintType.POSSIBLE_FORMATS,_),$.set(zxingJs_umdExports.DecodeHintType.TRY_HARDER,!1),this.hints=$}return e.prototype.decodeAsync=function(i){var s=this;return new Promise(function(a,_){try{a(s.decode(i))}catch($){_($)}})},e.prototype.decode=function(i){var s=new zxingJs_umdExports.MultiFormatReader(this.verbose,this.hints),a=new zxingJs_umdExports.HTMLCanvasElementLuminanceSource(i),_=new zxingJs_umdExports.BinaryBitmap(new zxingJs_umdExports.HybridBinarizer(a)),$=s.decode(_);return{text:$.text,format:QrcodeResultFormat.create(this.toHtml5QrcodeSupportedFormats($.format)),debugData:this.createDebugData()}},e.prototype.createReverseFormatMap=function(){var i=new Map;return this.formatMap.forEach(function(s,a,_){i.set(s,a)}),i},e.prototype.toHtml5QrcodeSupportedFormats=function(i){if(!this.reverseFormatMap.has(i))throw"reverseFormatMap doesn't have ".concat(i);return this.reverseFormatMap.get(i)},e.prototype.createZXingFormats=function(i){for(var s=[],a=0,_=i;a<_.length;a++){var $=_[a];this.formatMap.has($)?s.push(this.formatMap.get($)):this.logger.logError("".concat($," is not supported by")+"ZXingHtml5QrcodeShim")}return s},e.prototype.createDebugData=function(){return{decoderName:"zxing-js"}},e}(),__awaiter$4=function(e,i,s,a){function _($){return $ instanceof s?$:new s(function(rt){rt($)})}return new(s||(s=Promise))(function($,rt){function c(Et){try{ht(a.next(Et))}catch(St){rt(St)}}function dt(Et){try{ht(a.throw(Et))}catch(St){rt(St)}}function ht(Et){Et.done?$(Et.value):_(Et.value).then(c,dt)}ht((a=a.apply(e,i||[])).next())})},__generator$4=function(e,i){var s={label:0,sent:function(){if($[0]&1)throw $[1];return $[1]},trys:[],ops:[]},a,_,$,rt;return rt={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(rt[Symbol.iterator]=function(){return this}),rt;function c(ht){return function(Et){return dt([ht,Et])}}function dt(ht){if(a)throw new TypeError("Generator is already executing.");for(;rt&&(rt=0,ht[0]&&(s=0)),s;)try{if(a=1,_&&($=ht[0]&2?_.return:ht[0]?_.throw||(($=_.return)&&$.call(_),0):_.next)&&!($=$.call(_,ht[1])).done)return $;switch(_=0,$&&(ht=[ht[0]&2,$.value]),ht[0]){case 0:case 1:$=ht;break;case 4:return s.label++,{value:ht[1],done:!1};case 5:s.label++,_=ht[1],ht=[0];continue;case 7:ht=s.ops.pop(),s.trys.pop();continue;default:if($=s.trys,!($=$.length>0&&$[$.length-1])&&(ht[0]===6||ht[0]===2)){s=0;continue}if(ht[0]===3&&(!$||ht[1]>$[0]&&ht[1]<$[3])){s.label=ht[1];break}if(ht[0]===6&&s.label<$[1]){s.label=$[1],$=ht;break}if($&&s.label<$[2]){s.label=$[2],s.ops.push(ht);break}$[2]&&s.ops.pop(),s.trys.pop();continue}ht=i.call(e,s)}catch(Et){ht=[6,Et],_=0}finally{a=$=0}if(ht[0]&5)throw ht[1];return{value:ht[0]?ht[1]:void 0,done:!0}}},BarcodeDetectorDelegate=function(){function e(i,s,a){if(this.formatMap=new Map([[Html5QrcodeSupportedFormats.QR_CODE,"qr_code"],[Html5QrcodeSupportedFormats.AZTEC,"aztec"],[Html5QrcodeSupportedFormats.CODABAR,"codabar"],[Html5QrcodeSupportedFormats.CODE_39,"code_39"],[Html5QrcodeSupportedFormats.CODE_93,"code_93"],[Html5QrcodeSupportedFormats.CODE_128,"code_128"],[Html5QrcodeSupportedFormats.DATA_MATRIX,"data_matrix"],[Html5QrcodeSupportedFormats.ITF,"itf"],[Html5QrcodeSupportedFormats.EAN_13,"ean_13"],[Html5QrcodeSupportedFormats.EAN_8,"ean_8"],[Html5QrcodeSupportedFormats.PDF_417,"pdf417"],[Html5QrcodeSupportedFormats.UPC_A,"upc_a"],[Html5QrcodeSupportedFormats.UPC_E,"upc_e"]]),this.reverseFormatMap=this.createReverseFormatMap(),!e.isSupported())throw"Use html5qrcode.min.js without edit, Use BarcodeDetectorDelegate only if it isSupported();";this.verbose=s,this.logger=a;var _=this.createBarcodeDetectorFormats(i);if(this.detector=new BarcodeDetector(_),!this.detector)throw"BarcodeDetector detector not supported"}return e.isSupported=function(){if(!("BarcodeDetector"in window))return!1;var i=new BarcodeDetector({formats:["qr_code"]});return typeof i<"u"},e.prototype.decodeAsync=function(i){return __awaiter$4(this,void 0,void 0,function(){var s,a;return __generator$4(this,function(_){switch(_.label){case 0:return[4,this.detector.detect(i)];case 1:if(s=_.sent(),!s||s.length===0)throw"No barcode or QR code detected.";return a=this.selectLargestBarcode(s),[2,{text:a.rawValue,format:QrcodeResultFormat.create(this.toHtml5QrcodeSupportedFormats(a.format)),debugData:this.createDebugData()}]}})})},e.prototype.selectLargestBarcode=function(i){for(var s=null,a=0,_=0,$=i;_<$.length;_++){var rt=$[_],c=rt.boundingBox.width*rt.boundingBox.height;c>a&&(a=c,s=rt)}if(!s)throw"No largest barcode found";return s},e.prototype.createBarcodeDetectorFormats=function(i){for(var s=[],a=0,_=i;a<_.length;a++){var $=_[a];this.formatMap.has($)?s.push(this.formatMap.get($)):this.logger.warn("".concat($," is not supported by")+"BarcodeDetectorDelegate")}return{formats:s}},e.prototype.toHtml5QrcodeSupportedFormats=function(i){if(!this.reverseFormatMap.has(i))throw"reverseFormatMap doesn't have ".concat(i);return this.reverseFormatMap.get(i)},e.prototype.createReverseFormatMap=function(){var i=new Map;return this.formatMap.forEach(function(s,a,_){i.set(s,a)}),i},e.prototype.createDebugData=function(){return{decoderName:"BarcodeDetector"}},e}(),__awaiter$3=function(e,i,s,a){function _($){return $ instanceof s?$:new s(function(rt){rt($)})}return new(s||(s=Promise))(function($,rt){function c(Et){try{ht(a.next(Et))}catch(St){rt(St)}}function dt(Et){try{ht(a.throw(Et))}catch(St){rt(St)}}function ht(Et){Et.done?$(Et.value):_(Et.value).then(c,dt)}ht((a=a.apply(e,i||[])).next())})},__generator$3=function(e,i){var s={label:0,sent:function(){if($[0]&1)throw $[1];return $[1]},trys:[],ops:[]},a,_,$,rt;return rt={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(rt[Symbol.iterator]=function(){return this}),rt;function c(ht){return function(Et){return dt([ht,Et])}}function dt(ht){if(a)throw new TypeError("Generator is already executing.");for(;rt&&(rt=0,ht[0]&&(s=0)),s;)try{if(a=1,_&&($=ht[0]&2?_.return:ht[0]?_.throw||(($=_.return)&&$.call(_),0):_.next)&&!($=$.call(_,ht[1])).done)return $;switch(_=0,$&&(ht=[ht[0]&2,$.value]),ht[0]){case 0:case 1:$=ht;break;case 4:return s.label++,{value:ht[1],done:!1};case 5:s.label++,_=ht[1],ht=[0];continue;case 7:ht=s.ops.pop(),s.trys.pop();continue;default:if($=s.trys,!($=$.length>0&&$[$.length-1])&&(ht[0]===6||ht[0]===2)){s=0;continue}if(ht[0]===3&&(!$||ht[1]>$[0]&&ht[1]<$[3])){s.label=ht[1];break}if(ht[0]===6&&s.label<$[1]){s.label=$[1],$=ht;break}if($&&s.label<$[2]){s.label=$[2],s.ops.push(ht);break}$[2]&&s.ops.pop(),s.trys.pop();continue}ht=i.call(e,s)}catch(Et){ht=[6,Et],_=0}finally{a=$=0}if(ht[0]&5)throw ht[1];return{value:ht[0]?ht[1]:void 0,done:!0}}},Html5QrcodeShim=function(){function e(i,s,a,_){this.EXECUTIONS_TO_REPORT_PERFORMANCE=100,this.executions=0,this.executionResults=[],this.wasPrimaryDecoderUsedInLastDecode=!1,this.verbose=a,s&&BarcodeDetectorDelegate.isSupported()?(this.primaryDecoder=new BarcodeDetectorDelegate(i,a,_),this.secondaryDecoder=new ZXingHtml5QrcodeDecoder(i,a,_)):this.primaryDecoder=new ZXingHtml5QrcodeDecoder(i,a,_)}return e.prototype.decodeAsync=function(i){return __awaiter$3(this,void 0,void 0,function(){var s;return __generator$3(this,function(a){switch(a.label){case 0:s=performance.now(),a.label=1;case 1:return a.trys.push([1,,3,4]),[4,this.getDecoder().decodeAsync(i)];case 2:return[2,a.sent()];case 3:return this.possiblyLogPerformance(s),[7];case 4:return[2]}})})},e.prototype.decodeRobustlyAsync=function(i){return __awaiter$3(this,void 0,void 0,function(){var s,a;return __generator$3(this,function(_){switch(_.label){case 0:s=performance.now(),_.label=1;case 1:return _.trys.push([1,3,4,5]),[4,this.primaryDecoder.decodeAsync(i)];case 2:return[2,_.sent()];case 3:if(a=_.sent(),this.secondaryDecoder)return[2,this.secondaryDecoder.decodeAsync(i)];throw a;case 4:return this.possiblyLogPerformance(s),[7];case 5:return[2]}})})},e.prototype.getDecoder=function(){return this.secondaryDecoder?this.wasPrimaryDecoderUsedInLastDecode===!1?(this.wasPrimaryDecoderUsedInLastDecode=!0,this.primaryDecoder):(this.wasPrimaryDecoderUsedInLastDecode=!1,this.secondaryDecoder):this.primaryDecoder},e.prototype.possiblyLogPerformance=function(i){if(this.verbose){var s=performance.now()-i;this.executionResults.push(s),this.executions++,this.possiblyFlushPerformanceReport()}},e.prototype.possiblyFlushPerformanceReport=function(){if(!(this.executions<this.EXECUTIONS_TO_REPORT_PERFORMANCE)){for(var i=0,s=0,a=this.executionResults;s<a.length;s++){var _=a[s];i+=_}var $=i/this.executionResults.length;console.log("".concat($," ms for ").concat(this.executionResults.length," last runs.")),this.executions=0,this.executionResults=[]}},e}(),__extends$1=function(){var e=function(i,s){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,_){a.__proto__=_}||function(a,_){for(var $ in _)Object.prototype.hasOwnProperty.call(_,$)&&(a[$]=_[$])},e(i,s)};return function(i,s){if(typeof s!="function"&&s!==null)throw new TypeError("Class extends value "+String(s)+" is not a constructor or null");e(i,s);function a(){this.constructor=i}i.prototype=s===null?Object.create(s):(a.prototype=s.prototype,new a)}}(),__awaiter$2=function(e,i,s,a){function _($){return $ instanceof s?$:new s(function(rt){rt($)})}return new(s||(s=Promise))(function($,rt){function c(Et){try{ht(a.next(Et))}catch(St){rt(St)}}function dt(Et){try{ht(a.throw(Et))}catch(St){rt(St)}}function ht(Et){Et.done?$(Et.value):_(Et.value).then(c,dt)}ht((a=a.apply(e,i||[])).next())})},__generator$2=function(e,i){var s={label:0,sent:function(){if($[0]&1)throw $[1];return $[1]},trys:[],ops:[]},a,_,$,rt;return rt={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(rt[Symbol.iterator]=function(){return this}),rt;function c(ht){return function(Et){return dt([ht,Et])}}function dt(ht){if(a)throw new TypeError("Generator is already executing.");for(;rt&&(rt=0,ht[0]&&(s=0)),s;)try{if(a=1,_&&($=ht[0]&2?_.return:ht[0]?_.throw||(($=_.return)&&$.call(_),0):_.next)&&!($=$.call(_,ht[1])).done)return $;switch(_=0,$&&(ht=[ht[0]&2,$.value]),ht[0]){case 0:case 1:$=ht;break;case 4:return s.label++,{value:ht[1],done:!1};case 5:s.label++,_=ht[1],ht=[0];continue;case 7:ht=s.ops.pop(),s.trys.pop();continue;default:if($=s.trys,!($=$.length>0&&$[$.length-1])&&(ht[0]===6||ht[0]===2)){s=0;continue}if(ht[0]===3&&(!$||ht[1]>$[0]&&ht[1]<$[3])){s.label=ht[1];break}if(ht[0]===6&&s.label<$[1]){s.label=$[1],$=ht;break}if($&&s.label<$[2]){s.label=$[2],s.ops.push(ht);break}$[2]&&s.ops.pop(),s.trys.pop();continue}ht=i.call(e,s)}catch(Et){ht=[6,Et],_=0}finally{a=$=0}if(ht[0]&5)throw ht[1];return{value:ht[0]?ht[1]:void 0,done:!0}}},AbstractCameraCapability=function(){function e(i,s){this.name=i,this.track=s}return e.prototype.isSupported=function(){return this.track.getCapabilities?this.name in this.track.getCapabilities():!1},e.prototype.apply=function(i){var s={};s[this.name]=i;var a={advanced:[s]};return this.track.applyConstraints(a)},e.prototype.value=function(){var i=this.track.getSettings();if(this.name in i){var s=i[this.name];return s}return null},e}(),AbstractRangeCameraCapability=function(e){__extends$1(i,e);function i(s,a){return e.call(this,s,a)||this}return i.prototype.min=function(){return this.getCapabilities().min},i.prototype.max=function(){return this.getCapabilities().max},i.prototype.step=function(){return this.getCapabilities().step},i.prototype.apply=function(s){var a={};a[this.name]=s;var _={advanced:[a]};return this.track.applyConstraints(_)},i.prototype.getCapabilities=function(){this.failIfNotSupported();var s=this.track.getCapabilities(),a=s[this.name];return{min:a.min,max:a.max,step:a.step}},i.prototype.failIfNotSupported=function(){if(!this.isSupported())throw new Error("".concat(this.name," capability not supported"))},i}(AbstractCameraCapability),ZoomFeatureImpl=function(e){__extends$1(i,e);function i(s){return e.call(this,"zoom",s)||this}return i}(AbstractRangeCameraCapability),TorchFeatureImpl=function(e){__extends$1(i,e);function i(s){return e.call(this,"torch",s)||this}return i}(AbstractCameraCapability),CameraCapabilitiesImpl=function(){function e(i){this.track=i}return e.prototype.zoomFeature=function(){return new ZoomFeatureImpl(this.track)},e.prototype.torchFeature=function(){return new TorchFeatureImpl(this.track)},e}(),RenderedCameraImpl=function(){function e(i,s,a){this.isClosed=!1,this.parentElement=i,this.mediaStream=s,this.callbacks=a,this.surface=this.createVideoElement(this.parentElement.clientWidth),i.append(this.surface)}return e.prototype.createVideoElement=function(i){var s=document.createElement("video");return s.style.width="".concat(i,"px"),s.style.display="block",s.muted=!0,s.setAttribute("muted","true"),s.playsInline=!0,s},e.prototype.setupSurface=function(){var i=this;this.surface.onabort=function(){throw"RenderedCameraImpl video surface onabort() called"},this.surface.onerror=function(){throw"RenderedCameraImpl video surface onerror() called"};var s=function(){var a=i.surface.clientWidth,_=i.surface.clientHeight;i.callbacks.onRenderSurfaceReady(a,_),i.surface.removeEventListener("playing",s)};this.surface.addEventListener("playing",s),this.surface.srcObject=this.mediaStream,this.surface.play()},e.create=function(i,s,a,_){return __awaiter$2(this,void 0,void 0,function(){var $,rt;return __generator$2(this,function(c){switch(c.label){case 0:return $=new e(i,s,_),a.aspectRatio?(rt={aspectRatio:a.aspectRatio},[4,$.getFirstTrackOrFail().applyConstraints(rt)]):[3,2];case 1:c.sent(),c.label=2;case 2:return $.setupSurface(),[2,$]}})})},e.prototype.failIfClosed=function(){if(this.isClosed)throw"The RenderedCamera has already been closed."},e.prototype.getFirstTrackOrFail=function(){if(this.failIfClosed(),this.mediaStream.getVideoTracks().length===0)throw"No video tracks found";return this.mediaStream.getVideoTracks()[0]},e.prototype.pause=function(){this.failIfClosed(),this.surface.pause()},e.prototype.resume=function(i){this.failIfClosed();var s=this,a=function(){setTimeout(i,200),s.surface.removeEventListener("playing",a)};this.surface.addEventListener("playing",a),this.surface.play()},e.prototype.isPaused=function(){return this.failIfClosed(),this.surface.paused},e.prototype.getSurface=function(){return this.failIfClosed(),this.surface},e.prototype.getRunningTrackCapabilities=function(){return this.getFirstTrackOrFail().getCapabilities()},e.prototype.getRunningTrackSettings=function(){return this.getFirstTrackOrFail().getSettings()},e.prototype.applyVideoConstraints=function(i){return __awaiter$2(this,void 0,void 0,function(){return __generator$2(this,function(s){if("aspectRatio"in i)throw"Changing 'aspectRatio' in run-time is not yet supported.";return[2,this.getFirstTrackOrFail().applyConstraints(i)]})})},e.prototype.close=function(){if(this.isClosed)return Promise.resolve();var i=this;return new Promise(function(s,a){var _=i.mediaStream.getVideoTracks(),$=_.length,rt=0;i.mediaStream.getVideoTracks().forEach(function(c){i.mediaStream.removeTrack(c),c.stop(),++rt,rt>=$&&(i.isClosed=!0,i.parentElement.removeChild(i.surface),s())})})},e.prototype.getCapabilities=function(){return new CameraCapabilitiesImpl(this.getFirstTrackOrFail())},e}(),CameraImpl=function(){function e(i){this.mediaStream=i}return e.prototype.render=function(i,s,a){return __awaiter$2(this,void 0,void 0,function(){return __generator$2(this,function(_){return[2,RenderedCameraImpl.create(i,this.mediaStream,s,a)]})})},e.create=function(i){return __awaiter$2(this,void 0,void 0,function(){var s,a;return __generator$2(this,function(_){switch(_.label){case 0:if(!navigator.mediaDevices)throw"navigator.mediaDevices not supported";return s={audio:!1,video:i},[4,navigator.mediaDevices.getUserMedia(s)];case 1:return a=_.sent(),[2,new e(a)]}})})},e}(),__awaiter$1=function(e,i,s,a){function _($){return $ instanceof s?$:new s(function(rt){rt($)})}return new(s||(s=Promise))(function($,rt){function c(Et){try{ht(a.next(Et))}catch(St){rt(St)}}function dt(Et){try{ht(a.throw(Et))}catch(St){rt(St)}}function ht(Et){Et.done?$(Et.value):_(Et.value).then(c,dt)}ht((a=a.apply(e,i||[])).next())})},__generator$1=function(e,i){var s={label:0,sent:function(){if($[0]&1)throw $[1];return $[1]},trys:[],ops:[]},a,_,$,rt;return rt={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(rt[Symbol.iterator]=function(){return this}),rt;function c(ht){return function(Et){return dt([ht,Et])}}function dt(ht){if(a)throw new TypeError("Generator is already executing.");for(;rt&&(rt=0,ht[0]&&(s=0)),s;)try{if(a=1,_&&($=ht[0]&2?_.return:ht[0]?_.throw||(($=_.return)&&$.call(_),0):_.next)&&!($=$.call(_,ht[1])).done)return $;switch(_=0,$&&(ht=[ht[0]&2,$.value]),ht[0]){case 0:case 1:$=ht;break;case 4:return s.label++,{value:ht[1],done:!1};case 5:s.label++,_=ht[1],ht=[0];continue;case 7:ht=s.ops.pop(),s.trys.pop();continue;default:if($=s.trys,!($=$.length>0&&$[$.length-1])&&(ht[0]===6||ht[0]===2)){s=0;continue}if(ht[0]===3&&(!$||ht[1]>$[0]&&ht[1]<$[3])){s.label=ht[1];break}if(ht[0]===6&&s.label<$[1]){s.label=$[1],$=ht;break}if($&&s.label<$[2]){s.label=$[2],s.ops.push(ht);break}$[2]&&s.ops.pop(),s.trys.pop();continue}ht=i.call(e,s)}catch(Et){ht=[6,Et],_=0}finally{a=$=0}if(ht[0]&5)throw ht[1];return{value:ht[0]?ht[1]:void 0,done:!0}}},CameraFactory=function(){function e(){}return e.failIfNotSupported=function(){return __awaiter$1(this,void 0,void 0,function(){return __generator$1(this,function(i){if(!navigator.mediaDevices)throw"navigator.mediaDevices not supported";return[2,new e]})})},e.prototype.create=function(i){return __awaiter$1(this,void 0,void 0,function(){return __generator$1(this,function(s){return[2,CameraImpl.create(i)]})})},e}(),__awaiter=function(e,i,s,a){function _($){return $ instanceof s?$:new s(function(rt){rt($)})}return new(s||(s=Promise))(function($,rt){function c(Et){try{ht(a.next(Et))}catch(St){rt(St)}}function dt(Et){try{ht(a.throw(Et))}catch(St){rt(St)}}function ht(Et){Et.done?$(Et.value):_(Et.value).then(c,dt)}ht((a=a.apply(e,i||[])).next())})},__generator=function(e,i){var s={label:0,sent:function(){if($[0]&1)throw $[1];return $[1]},trys:[],ops:[]},a,_,$,rt;return rt={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(rt[Symbol.iterator]=function(){return this}),rt;function c(ht){return function(Et){return dt([ht,Et])}}function dt(ht){if(a)throw new TypeError("Generator is already executing.");for(;rt&&(rt=0,ht[0]&&(s=0)),s;)try{if(a=1,_&&($=ht[0]&2?_.return:ht[0]?_.throw||(($=_.return)&&$.call(_),0):_.next)&&!($=$.call(_,ht[1])).done)return $;switch(_=0,$&&(ht=[ht[0]&2,$.value]),ht[0]){case 0:case 1:$=ht;break;case 4:return s.label++,{value:ht[1],done:!1};case 5:s.label++,_=ht[1],ht=[0];continue;case 7:ht=s.ops.pop(),s.trys.pop();continue;default:if($=s.trys,!($=$.length>0&&$[$.length-1])&&(ht[0]===6||ht[0]===2)){s=0;continue}if(ht[0]===3&&(!$||ht[1]>$[0]&&ht[1]<$[3])){s.label=ht[1];break}if(ht[0]===6&&s.label<$[1]){s.label=$[1],$=ht;break}if($&&s.label<$[2]){s.label=$[2],s.ops.push(ht);break}$[2]&&s.ops.pop(),s.trys.pop();continue}ht=i.call(e,s)}catch(Et){ht=[6,Et],_=0}finally{a=$=0}if(ht[0]&5)throw ht[1];return{value:ht[0]?ht[1]:void 0,done:!0}}},CameraRetriever=function(){function e(){}return e.retrieve=function(){if(navigator.mediaDevices)return e.getCamerasFromMediaDevices();var i=MediaStreamTrack;return MediaStreamTrack&&i.getSources?e.getCamerasFromMediaStreamTrack():e.rejectWithError()},e.rejectWithError=function(){var i=Html5QrcodeStrings.unableToQuerySupportedDevices();return e.isHttpsOrLocalhost()||(i=Html5QrcodeStrings.insecureContextCameraQueryError()),Promise.reject(i)},e.isHttpsOrLocalhost=function(){if(location.protocol==="https:")return!0;var i=location.host.split(":")[0];return i==="127.0.0.1"||i==="localhost"},e.getCamerasFromMediaDevices=function(){return __awaiter(this,void 0,void 0,function(){var i,s,a,_,$,rt,c;return __generator(this,function(dt){switch(dt.label){case 0:return i=function(ht){for(var Et=ht.getVideoTracks(),St=0,At=Et;St<At.length;St++){var Pt=At[St];Pt.enabled=!1,Pt.stop(),ht.removeTrack(Pt)}},[4,navigator.mediaDevices.getUserMedia({audio:!1,video:!0})];case 1:return s=dt.sent(),[4,navigator.mediaDevices.enumerateDevices()];case 2:for(a=dt.sent(),_=[],$=0,rt=a;$<rt.length;$++)c=rt[$],c.kind==="videoinput"&&_.push({id:c.deviceId,label:c.label});return i(s),[2,_]}})})},e.getCamerasFromMediaStreamTrack=function(){return new Promise(function(i,s){var a=function($){for(var rt=[],c=0,dt=$;c<dt.length;c++){var ht=dt[c];ht.kind==="video"&&rt.push({id:ht.id,label:ht.label})}i(rt)},_=MediaStreamTrack;_.getSources(a)})},e}(),Html5QrcodeScannerState;(function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.NOT_STARTED=1]="NOT_STARTED",e[e.SCANNING=2]="SCANNING",e[e.PAUSED=3]="PAUSED"})(Html5QrcodeScannerState||(Html5QrcodeScannerState={}));var StateManagerImpl=function(){function e(){this.state=Html5QrcodeScannerState.NOT_STARTED,this.onGoingTransactionNewState=Html5QrcodeScannerState.UNKNOWN}return e.prototype.directTransition=function(i){this.failIfTransitionOngoing(),this.validateTransition(i),this.state=i},e.prototype.startTransition=function(i){return this.failIfTransitionOngoing(),this.validateTransition(i),this.onGoingTransactionNewState=i,this},e.prototype.execute=function(){if(this.onGoingTransactionNewState===Html5QrcodeScannerState.UNKNOWN)throw"Transaction is already cancelled, cannot execute().";var i=this.onGoingTransactionNewState;this.onGoingTransactionNewState=Html5QrcodeScannerState.UNKNOWN,this.directTransition(i)},e.prototype.cancel=function(){if(this.onGoingTransactionNewState===Html5QrcodeScannerState.UNKNOWN)throw"Transaction is already cancelled, cannot cancel().";this.onGoingTransactionNewState=Html5QrcodeScannerState.UNKNOWN},e.prototype.getState=function(){return this.state},e.prototype.failIfTransitionOngoing=function(){if(this.onGoingTransactionNewState!==Html5QrcodeScannerState.UNKNOWN)throw"Cannot transition to a new state, already under transition"},e.prototype.validateTransition=function(i){switch(this.state){case Html5QrcodeScannerState.UNKNOWN:throw"Transition from unknown is not allowed";case Html5QrcodeScannerState.NOT_STARTED:this.failIfNewStateIs(i,[Html5QrcodeScannerState.PAUSED]);break;case Html5QrcodeScannerState.SCANNING:break;case Html5QrcodeScannerState.PAUSED:break}},e.prototype.failIfNewStateIs=function(i,s){for(var a=0,_=s;a<_.length;a++){var $=_[a];if(i===$)throw"Cannot transition from ".concat(this.state," to ").concat(i)}},e}(),StateManagerProxy=function(){function e(i){this.stateManager=i}return e.prototype.startTransition=function(i){return this.stateManager.startTransition(i)},e.prototype.directTransition=function(i){this.stateManager.directTransition(i)},e.prototype.getState=function(){return this.stateManager.getState()},e.prototype.canScanFile=function(){return this.stateManager.getState()===Html5QrcodeScannerState.NOT_STARTED},e.prototype.isScanning=function(){return this.stateManager.getState()!==Html5QrcodeScannerState.NOT_STARTED},e.prototype.isStrictlyScanning=function(){return this.stateManager.getState()===Html5QrcodeScannerState.SCANNING},e.prototype.isPaused=function(){return this.stateManager.getState()===Html5QrcodeScannerState.PAUSED},e}(),StateManagerFactory=function(){function e(){}return e.create=function(){return new StateManagerProxy(new StateManagerImpl)},e}(),__extends=function(){var e=function(i,s){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,_){a.__proto__=_}||function(a,_){for(var $ in _)Object.prototype.hasOwnProperty.call(_,$)&&(a[$]=_[$])},e(i,s)};return function(i,s){if(typeof s!="function"&&s!==null)throw new TypeError("Class extends value "+String(s)+" is not a constructor or null");e(i,s);function a(){this.constructor=i}i.prototype=s===null?Object.create(s):(a.prototype=s.prototype,new a)}}(),Constants$1=function(e){__extends(i,e);function i(){return e!==null&&e.apply(this,arguments)||this}return i.DEFAULT_WIDTH=300,i.DEFAULT_WIDTH_OFFSET=2,i.FILE_SCAN_MIN_HEIGHT=300,i.FILE_SCAN_HIDDEN_CANVAS_PADDING=100,i.MIN_QR_BOX_SIZE=50,i.SHADED_LEFT=1,i.SHADED_RIGHT=2,i.SHADED_TOP=3,i.SHADED_BOTTOM=4,i.SHADED_REGION_ELEMENT_ID="qr-shaded-region",i.VERBOSE=!1,i.BORDER_SHADER_DEFAULT_COLOR="#ffffff",i.BORDER_SHADER_MATCH_COLOR="rgb(90, 193, 56)",i}(Html5QrcodeConstants),InternalHtml5QrcodeConfig=function(){function e(i,s){this.logger=s,this.fps=Constants$1.SCAN_DEFAULT_FPS,i?(i.fps&&(this.fps=i.fps),this.disableFlip=i.disableFlip===!0,this.qrbox=i.qrbox,this.aspectRatio=i.aspectRatio,this.videoConstraints=i.videoConstraints):this.disableFlip=Constants$1.DEFAULT_DISABLE_FLIP}return e.prototype.isMediaStreamConstraintsValid=function(){return this.videoConstraints?VideoConstraintsUtil.isMediaStreamConstraintsValid(this.videoConstraints,this.logger):(this.logger.logError("Empty videoConstraints",!0),!1)},e.prototype.isShadedBoxEnabled=function(){return!isNullOrUndefined(this.qrbox)},e.create=function(i,s){return new e(i,s)},e}(),Html5Qrcode=function(){function e(i,s){if(this.element=null,this.canvasElement=null,this.scannerPausedUiElement=null,this.hasBorderShaders=null,this.borderShaders=null,this.qrMatch=null,this.renderedCamera=null,this.qrRegion=null,this.context=null,this.lastScanImageFile=null,this.isScanning=!1,!document.getElementById(i))throw"HTML Element with id=".concat(i," not found");this.elementId=i,this.verbose=!1;var a;typeof s=="boolean"?this.verbose=s===!0:s&&(a=s,this.verbose=a.verbose===!0,a.experimentalFeatures),this.logger=new BaseLoggger(this.verbose),this.qrcode=new Html5QrcodeShim(this.getSupportedFormats(s),this.getUseBarCodeDetectorIfSupported(a),this.verbose,this.logger),this.foreverScanTimeout,this.shouldScan=!0,this.stateManagerProxy=StateManagerFactory.create()}return e.prototype.start=function(i,s,a,_){var $=this;if(!i)throw"cameraIdOrConfig is required";if(!a||typeof a!="function")throw"qrCodeSuccessCallback is required and should be a function.";var rt;_?rt=_:rt=this.verbose?this.logger.log:function(){};var c=InternalHtml5QrcodeConfig.create(s,this.logger);this.clearElement();var dt=!1;c.videoConstraints&&(c.isMediaStreamConstraintsValid()?dt=!0:this.logger.logError("'videoConstraints' is not valid 'MediaStreamConstraints, it will be ignored.'",!0));var ht=dt,Et=document.getElementById(this.elementId);Et.clientWidth?Et.clientWidth:Constants$1.DEFAULT_WIDTH,Et.style.position="relative",this.shouldScan=!0,this.element=Et;var St=this,At=this.stateManagerProxy.startTransition(Html5QrcodeScannerState.SCANNING);return new Promise(function(Pt,Vt){var Bt=ht?c.videoConstraints:St.createVideoConstraints(i);if(!Bt){At.cancel(),Vt("videoConstraints should be defined");return}var Zt={};(!ht||c.aspectRatio)&&(Zt.aspectRatio=c.aspectRatio);var zt={onRenderSurfaceReady:function(Ut,Nt){St.setupUi(Ut,Nt,c),St.isScanning=!0,St.foreverScan(c,a,rt)}};CameraFactory.failIfNotSupported().then(function(Ut){Ut.create(Bt).then(function(Nt){return Nt.render($.element,Zt,zt).then(function(Gt){St.renderedCamera=Gt,At.execute(),Pt(null)}).catch(function(Gt){At.cancel(),Vt(Gt)})}).catch(function(Nt){At.cancel(),Vt(Html5QrcodeStrings.errorGettingUserMedia(Nt))})}).catch(function(Ut){At.cancel(),Vt(Html5QrcodeStrings.cameraStreamingNotSupported())})})},e.prototype.pause=function(i){if(!this.stateManagerProxy.isStrictlyScanning())throw"Cannot pause, scanner is not scanning.";this.stateManagerProxy.directTransition(Html5QrcodeScannerState.PAUSED),this.showPausedState(),(isNullOrUndefined(i)||i!==!0)&&(i=!1),i&&this.renderedCamera&&this.renderedCamera.pause()},e.prototype.resume=function(){if(!this.stateManagerProxy.isPaused())throw"Cannot result, scanner is not paused.";if(!this.renderedCamera)throw"renderedCamera doesn't exist while trying resume()";var i=this,s=function(){i.stateManagerProxy.directTransition(Html5QrcodeScannerState.SCANNING),i.hidePausedState()};if(!this.renderedCamera.isPaused()){s();return}this.renderedCamera.resume(function(){s()})},e.prototype.getState=function(){return this.stateManagerProxy.getState()},e.prototype.stop=function(){var i=this;if(!this.stateManagerProxy.isScanning())throw"Cannot stop, scanner is not running or paused.";var s=this.stateManagerProxy.startTransition(Html5QrcodeScannerState.NOT_STARTED);this.shouldScan=!1,this.foreverScanTimeout&&clearTimeout(this.foreverScanTimeout);var a=function(){if(i.element){var $=document.getElementById(Constants$1.SHADED_REGION_ELEMENT_ID);$&&i.element.removeChild($)}},_=this;return this.renderedCamera.close().then(function(){return _.renderedCamera=null,_.element&&(_.element.removeChild(_.canvasElement),_.canvasElement=null),a(),_.qrRegion&&(_.qrRegion=null),_.context&&(_.context=null),s.execute(),_.hidePausedState(),_.isScanning=!1,Promise.resolve()})},e.prototype.scanFile=function(i,s){return this.scanFileV2(i,s).then(function(a){return a.decodedText})},e.prototype.scanFileV2=function(i,s){var a=this;if(!i||!(i instanceof File))throw"imageFile argument is mandatory and should be instance of File. Use 'event.target.files[0]'.";if(isNullOrUndefined(s)&&(s=!0),!this.stateManagerProxy.canScanFile())throw"Cannot start file scan - ongoing camera scan";return new Promise(function(_,$){a.possiblyCloseLastScanImageFile(),a.clearElement(),a.lastScanImageFile=URL.createObjectURL(i);var rt=new Image;rt.onload=function(){var c=rt.width,dt=rt.height,ht=document.getElementById(a.elementId),Et=ht.clientWidth?ht.clientWidth:Constants$1.DEFAULT_WIDTH,St=Math.max(ht.clientHeight?ht.clientHeight:dt,Constants$1.FILE_SCAN_MIN_HEIGHT),At=a.computeCanvasDrawConfig(c,dt,Et,St);if(s){var Pt=a.createCanvasElement(Et,St,"qr-canvas-visible");Pt.style.display="inline-block",ht.appendChild(Pt);var Vt=Pt.getContext("2d");if(!Vt)throw"Unable to get 2d context from canvas";Vt.canvas.width=Et,Vt.canvas.height=St,Vt.drawImage(rt,0,0,c,dt,At.x,At.y,At.width,At.height)}var Bt=Constants$1.FILE_SCAN_HIDDEN_CANVAS_PADDING,Zt=Math.max(rt.width,At.width),zt=Math.max(rt.height,At.height),Ut=Zt+2*Bt,Nt=zt+2*Bt,Gt=a.createCanvasElement(Ut,Nt);ht.appendChild(Gt);var er=Gt.getContext("2d");if(!er)throw"Unable to get 2d context from canvas";er.canvas.width=Ut,er.canvas.height=Nt,er.drawImage(rt,0,0,c,dt,Bt,Bt,Zt,zt);try{a.qrcode.decodeRobustlyAsync(Gt).then(function(ir){_(Html5QrcodeResultFactory.createFromQrcodeResult(ir))}).catch($)}catch(ir){$("QR code parse error, error = ".concat(ir))}},rt.onerror=$,rt.onabort=$,rt.onstalled=$,rt.onsuspend=$,rt.src=URL.createObjectURL(i)})},e.prototype.clear=function(){this.clearElement()},e.getCameras=function(){return CameraRetriever.retrieve()},e.prototype.getRunningTrackCapabilities=function(){return this.getRenderedCameraOrFail().getRunningTrackCapabilities()},e.prototype.getRunningTrackSettings=function(){return this.getRenderedCameraOrFail().getRunningTrackSettings()},e.prototype.getRunningTrackCameraCapabilities=function(){return this.getRenderedCameraOrFail().getCapabilities()},e.prototype.applyVideoConstraints=function(i){if(i){if(!VideoConstraintsUtil.isMediaStreamConstraintsValid(i,this.logger))throw"invalid videoConstaints passed, check logs for more details"}else throw"videoConstaints is required argument.";return this.getRenderedCameraOrFail().applyVideoConstraints(i)},e.prototype.getRenderedCameraOrFail=function(){if(this.renderedCamera==null)throw"Scanning is not in running state, call this API only when QR code scanning using camera is in running state.";return this.renderedCamera},e.prototype.getSupportedFormats=function(i){var s=[Html5QrcodeSupportedFormats.QR_CODE,Html5QrcodeSupportedFormats.AZTEC,Html5QrcodeSupportedFormats.CODABAR,Html5QrcodeSupportedFormats.CODE_39,Html5QrcodeSupportedFormats.CODE_93,Html5QrcodeSupportedFormats.CODE_128,Html5QrcodeSupportedFormats.DATA_MATRIX,Html5QrcodeSupportedFormats.MAXICODE,Html5QrcodeSupportedFormats.ITF,Html5QrcodeSupportedFormats.EAN_13,Html5QrcodeSupportedFormats.EAN_8,Html5QrcodeSupportedFormats.PDF_417,Html5QrcodeSupportedFormats.RSS_14,Html5QrcodeSupportedFormats.RSS_EXPANDED,Html5QrcodeSupportedFormats.UPC_A,Html5QrcodeSupportedFormats.UPC_E,Html5QrcodeSupportedFormats.UPC_EAN_EXTENSION];if(!i||typeof i=="boolean"||!i.formatsToSupport)return s;if(!Array.isArray(i.formatsToSupport))throw"configOrVerbosityFlag.formatsToSupport should be undefined or an array.";if(i.formatsToSupport.length===0)throw"Atleast 1 formatsToSupport is needed.";for(var a=[],_=0,$=i.formatsToSupport;_<$.length;_++){var rt=$[_];isValidHtml5QrcodeSupportedFormats(rt)?a.push(rt):this.logger.warn("Invalid format: ".concat(rt," passed in config, ignoring."))}if(a.length===0)throw"None of formatsToSupport match supported values.";return a},e.prototype.getUseBarCodeDetectorIfSupported=function(i){if(isNullOrUndefined(i))return!0;if(!isNullOrUndefined(i.useBarCodeDetectorIfSupported))return i.useBarCodeDetectorIfSupported!==!1;if(isNullOrUndefined(i.experimentalFeatures))return!0;var s=i.experimentalFeatures;return isNullOrUndefined(s.useBarCodeDetectorIfSupported)?!0:s.useBarCodeDetectorIfSupported!==!1},e.prototype.validateQrboxSize=function(i,s,a){var _=this,$=a.qrbox;this.validateQrboxConfig($);var rt=this.toQrdimensions(i,s,$),c=function(ht){if(ht<Constants$1.MIN_QR_BOX_SIZE)throw"minimum size of 'config.qrbox' dimension value is"+" ".concat(Constants$1.MIN_QR_BOX_SIZE,"px.")},dt=function(ht){return ht>i&&(_.logger.warn("`qrbox.width` or `qrbox` is larger than the width of the root element. The width will be truncated to the width of root element."),ht=i),ht};c(rt.width),c(rt.height),rt.width=dt(rt.width)},e.prototype.validateQrboxConfig=function(i){if(typeof i!="number"&&typeof i!="function"&&(i.width===void 0||i.height===void 0))throw"Invalid instance of QrDimensions passed for 'config.qrbox'. Both 'width' and 'height' should be set."},e.prototype.toQrdimensions=function(i,s,a){if(typeof a=="number")return{width:a,height:a};if(typeof a=="function")try{return a(i,s)}catch(_){throw new Error("qrbox config was passed as a function but it failed with unknown error"+_)}return a},e.prototype.setupUi=function(i,s,a){a.isShadedBoxEnabled()&&this.validateQrboxSize(i,s,a);var _=isNullOrUndefined(a.qrbox)?{width:i,height:s}:a.qrbox;this.validateQrboxConfig(_);var $=this.toQrdimensions(i,s,_);$.height>s&&this.logger.warn("[Html5Qrcode] config.qrbox has height that isgreater than the height of the video stream. Shading will be ignored");var rt=a.isShadedBoxEnabled()&&$.height<=s,c={x:0,y:0,width:i,height:s},dt=rt?this.getShadedRegionBounds(i,s,$):c,ht=this.createCanvasElement(dt.width,dt.height),Et={willReadFrequently:!0},St=ht.getContext("2d",Et);St.canvas.width=dt.width,St.canvas.height=dt.height,this.element.append(ht),rt&&this.possiblyInsertShadingElement(this.element,i,s,$),this.createScannerPausedUiElement(this.element),this.qrRegion=dt,this.context=St,this.canvasElement=ht},e.prototype.createScannerPausedUiElement=function(i){var s=document.createElement("div");s.innerText=Html5QrcodeStrings.scannerPaused(),s.style.display="none",s.style.position="absolute",s.style.top="0px",s.style.zIndex="1",s.style.background="rgba(9, 9, 9, 0.46)",s.style.color="#FFECEC",s.style.textAlign="center",s.style.width="100%",i.appendChild(s),this.scannerPausedUiElement=s},e.prototype.scanContext=function(i,s){var a=this;return this.stateManagerProxy.isPaused()?Promise.resolve(!1):this.qrcode.decodeAsync(this.canvasElement).then(function(_){return i(_.text,Html5QrcodeResultFactory.createFromQrcodeResult(_)),a.possiblyUpdateShaders(!0),!0}).catch(function(_){a.possiblyUpdateShaders(!1);var $=Html5QrcodeStrings.codeParseError(_);return s($,Html5QrcodeErrorFactory.createFrom($)),!1})},e.prototype.foreverScan=function(i,s,a){var _=this;if(this.shouldScan&&this.renderedCamera){var $=this.renderedCamera.getSurface(),rt=$.videoWidth/$.clientWidth,c=$.videoHeight/$.clientHeight;if(!this.qrRegion)throw"qrRegion undefined when localMediaStream is ready.";var dt=this.qrRegion.width*rt,ht=this.qrRegion.height*c,Et=this.qrRegion.x*rt,St=this.qrRegion.y*c;this.context.drawImage($,Et,St,dt,ht,0,0,this.qrRegion.width,this.qrRegion.height);var At=function(){_.foreverScanTimeout=setTimeout(function(){_.foreverScan(i,s,a)},_.getTimeoutFps(i.fps))};this.scanContext(s,a).then(function(Pt){!Pt&&i.disableFlip!==!0?(_.context.translate(_.context.canvas.width,0),_.context.scale(-1,1),_.scanContext(s,a).finally(function(){At()})):At()}).catch(function(Pt){_.logger.logError("Error happend while scanning context",Pt),At()})}},e.prototype.createVideoConstraints=function(i){if(typeof i=="string")return{deviceId:{exact:i}};if(typeof i=="object"){var s="facingMode",a="deviceId",_={user:!0,environment:!0},$="exact",rt=function(Vt){if(Vt in _)return!0;throw"config has invalid 'facingMode' value = "+"'".concat(Vt,"'")},c=Object.keys(i);if(c.length!==1)throw"'cameraIdOrConfig' object should have exactly 1 key,"+" if passed as an object, found ".concat(c.length," keys");var dt=Object.keys(i)[0];if(dt!==s&&dt!==a)throw"Only '".concat(s,"' and '").concat(a,"' ")+" are supported for 'cameraIdOrConfig'";if(dt===s){var ht=i.facingMode;if(typeof ht=="string"){if(rt(ht))return{facingMode:ht}}else if(typeof ht=="object")if($ in ht){if(rt(ht["".concat($)]))return{facingMode:{exact:ht["".concat($)]}}}else throw"'facingMode' should be string or object with"+" ".concat($," as key.");else{var Et=typeof ht;throw"Invalid type of 'facingMode' = ".concat(Et)}}else{var St=i.deviceId;if(typeof St=="string")return{deviceId:St};if(typeof St=="object"){if($ in St)return{deviceId:{exact:St["".concat($)]}};throw"'deviceId' should be string or object with"+" ".concat($," as key.")}else{var At=typeof St;throw"Invalid type of 'deviceId' = ".concat(At)}}}var Pt=typeof i;throw"Invalid type of 'cameraIdOrConfig' = ".concat(Pt)},e.prototype.computeCanvasDrawConfig=function(i,s,a,_){if(i<=a&&s<=_){var $=(a-i)/2,rt=(_-s)/2;return{x:$,y:rt,width:i,height:s}}else{var c=i,dt=s;return i>a&&(s=a/i*s,i=a),s>_&&(i=_/s*i,s=_),this.logger.log("Image downsampled from "+"".concat(c,"X").concat(dt)+" to ".concat(i,"X").concat(s,".")),this.computeCanvasDrawConfig(i,s,a,_)}},e.prototype.clearElement=function(){if(this.stateManagerProxy.isScanning())throw"Cannot clear while scan is ongoing, close it first.";var i=document.getElementById(this.elementId);i&&(i.innerHTML="")},e.prototype.possiblyUpdateShaders=function(i){this.qrMatch!==i&&(this.hasBorderShaders&&this.borderShaders&&this.borderShaders.length&&this.borderShaders.forEach(function(s){s.style.backgroundColor=i?Constants$1.BORDER_SHADER_MATCH_COLOR:Constants$1.BORDER_SHADER_DEFAULT_COLOR}),this.qrMatch=i)},e.prototype.possiblyCloseLastScanImageFile=function(){this.lastScanImageFile&&(URL.revokeObjectURL(this.lastScanImageFile),this.lastScanImageFile=null)},e.prototype.createCanvasElement=function(i,s,a){var _=i,$=s,rt=document.createElement("canvas");return rt.style.width="".concat(_,"px"),rt.style.height="".concat($,"px"),rt.style.display="none",rt.id=isNullOrUndefined(a)?"qr-canvas":a,rt},e.prototype.getShadedRegionBounds=function(i,s,a){if(a.width>i||a.height>s)throw"'config.qrbox' dimensions should not be greater than the dimensions of the root HTML element.";return{x:(i-a.width)/2,y:(s-a.height)/2,width:a.width,height:a.height}},e.prototype.possiblyInsertShadingElement=function(i,s,a,_){if(!(s-_.width<1||a-_.height<1)){var $=document.createElement("div");$.style.position="absolute";var rt=(s-_.width)/2,c=(a-_.height)/2;if($.style.borderLeft="".concat(rt,"px solid rgba(0, 0, 0, 0.48)"),$.style.borderRight="".concat(rt,"px solid rgba(0, 0, 0, 0.48)"),$.style.borderTop="".concat(c,"px solid rgba(0, 0, 0, 0.48)"),$.style.borderBottom="".concat(c,"px solid rgba(0, 0, 0, 0.48)"),$.style.boxSizing="border-box",$.style.top="0px",$.style.bottom="0px",$.style.left="0px",$.style.right="0px",$.id="".concat(Constants$1.SHADED_REGION_ELEMENT_ID),s-_.width<11||a-_.height<11)this.hasBorderShaders=!1;else{var dt=5,ht=40;this.insertShaderBorders($,ht,dt,-dt,null,0,!0),this.insertShaderBorders($,ht,dt,-dt,null,0,!1),this.insertShaderBorders($,ht,dt,null,-dt,0,!0),this.insertShaderBorders($,ht,dt,null,-dt,0,!1),this.insertShaderBorders($,dt,ht+dt,-dt,null,-dt,!0),this.insertShaderBorders($,dt,ht+dt,null,-dt,-dt,!0),this.insertShaderBorders($,dt,ht+dt,-dt,null,-dt,!1),this.insertShaderBorders($,dt,ht+dt,null,-dt,-dt,!1),this.hasBorderShaders=!0}i.append($)}},e.prototype.insertShaderBorders=function(i,s,a,_,$,rt,c){var dt=document.createElement("div");dt.style.position="absolute",dt.style.backgroundColor=Constants$1.BORDER_SHADER_DEFAULT_COLOR,dt.style.width="".concat(s,"px"),dt.style.height="".concat(a,"px"),_!==null&&(dt.style.top="".concat(_,"px")),$!==null&&(dt.style.bottom="".concat($,"px")),c?dt.style.left="".concat(rt,"px"):dt.style.right="".concat(rt,"px"),this.borderShaders||(this.borderShaders=[]),this.borderShaders.push(dt),i.appendChild(dt)},e.prototype.showPausedState=function(){if(!this.scannerPausedUiElement)throw"[internal error] scanner paused UI element not found";this.scannerPausedUiElement.style.display="block"},e.prototype.hidePausedState=function(){if(!this.scannerPausedUiElement)throw"[internal error] scanner paused UI element not found";this.scannerPausedUiElement.style.display="none"},e.prototype.getTimeoutFps=function(i){return 1e3/i},e}(),Html5QrcodeScannerStatus;(function(e){e[e.STATUS_DEFAULT=0]="STATUS_DEFAULT",e[e.STATUS_SUCCESS=1]="STATUS_SUCCESS",e[e.STATUS_WARNING=2]="STATUS_WARNING",e[e.STATUS_REQUESTING_PERMISSION=3]="STATUS_REQUESTING_PERMISSION"})(Html5QrcodeScannerStatus||(Html5QrcodeScannerStatus={}));const IMGBB_API_KEY="271837f4240842ef12577a95dbae3e88",IMGBB_ENDPOINT="https://api.imgbb.com/1/upload";async function uploadImage(e){const i=new FormData;i.append("key",IMGBB_API_KEY),i.append("image",e);const s=await fetch(IMGBB_ENDPOINT,{method:"POST",body:i});if(!s.ok)throw new Error("Failed to upload image");return s.json()}async function uploadToImgBB(e){try{return(await uploadImage(e)).data}catch(i){return console.error("ImgBB upload error:",i),null}}function SlideAction({onSuccess:e,text:i="SLIDE TO CONFIRM",icon:s=Check,className:a,sliderColor:_="bg-primary",textColor:$="text-primary",resetOnSuccess:rt=!0}){const[c,dt]=reactExports.useState(0),ht=reactExports.useRef(null),Et=useAnimation(),[St,At]=reactExports.useState(0),[Pt,Vt]=reactExports.useState(!1);reactExports.useEffect(()=>{ht.current&&dt(ht.current.clientWidth)},[ht.current]);const Bt=(zt,Ut)=>{const Nt=Math.max(0,Ut.offset.x);At(Nt)},Zt=async(zt,Ut)=>{const Nt=c-48;Ut.offset.x>=Nt*.9?(await Et.start({x:Nt}),Vt(!0),e(),rt&&setTimeout(()=>{Vt(!1),Et.start({x:0}),At(0)},1e3)):(Et.start({x:0}),At(0))};return jsxRuntimeExports.jsxs("div",{ref:ht,className:cn("relative h-12 rounded-full overflow-hidden shadow-sm border select-none w-full",a),children:[jsxRuntimeExports.jsx("div",{className:"absolute inset-0 flex items-center justify-center z-0",children:jsxRuntimeExports.jsxs("div",{className:cn("flex items-center gap-1 animate-pulse-soft opacity-100 font-semibold text-xs tracking-widest",$),children:[jsxRuntimeExports.jsx("span",{children:Pt?"CONFIRMED":i}),!Pt&&jsxRuntimeExports.jsx(ChevronRight,{className:"w-4 h-4 ml-1"})]})}),jsxRuntimeExports.jsx(motion.div,{className:cn("absolute inset-y-0 left-0 opacity-20 z-0",_),style:{width:St+48}}),jsxRuntimeExports.jsx(motion.div,{drag:"x",dragConstraints:{left:0,right:c-48},dragElastic:.1,dragMomentum:!1,onDrag:Bt,onDragEnd:Zt,animate:Et,className:cn("absolute left-1 top-1 bottom-1 w-[40px] rounded-full flex items-center justify-center cursor-grab active:cursor-grabbing z-20 shadow-sm transition-colors",_),whileTap:{scale:1.05},children:Pt?jsxRuntimeExports.jsx(Check,{className:"w-5 h-5 text-white"}):jsxRuntimeExports.jsx(s,{className:"w-5 h-5 text-white"})})]})}const statusConfig={pending:{label:"New Order",color:"bg-gold text-foreground",nextStatus:"accepted"},accepted:{label:"Accepted",color:"bg-primary text-primary-foreground",nextStatus:"cooking"},cooking:{label:"Cooking",color:"bg-accent text-accent-foreground",nextStatus:"packed"},packed:{label:"Ready",color:"bg-veg text-primary-foreground"},out_for_delivery:{label:"Out for Delivery",color:"bg-accent text-accent-foreground",nextStatus:"delivered"},delivered:{label:"Delivered",color:"bg-muted text-muted-foreground"},cancelled:{label:"Cancelled",color:"bg-destructive text-destructive-foreground"}};function AmmaDashboard(){const{user:e,signOut:i}=useAuth(),s=useNavigate(),{kitchens:a,loading:_}=useAmmaKitchens(e==null?void 0:e.id),[$,rt]=reactExports.useState(null),{orders:c,loading:dt}=useKitchenOrders($||void 0),{dishes:ht}=useDishes($||void 0),{coupons:Et}=useCoupons($||void 0),{withdrawals:St,loading:At}=useKitchenWithdrawals($||void 0),[Pt,Vt]=reactExports.useState("orders"),[Bt,Zt]=reactExports.useState([]),[zt,Ut]=reactExports.useState(!1),[Nt,Gt]=reactExports.useState(!1),[er,ir]=reactExports.useState(""),[or,mr]=reactExports.useState(""),[Rr,on]=reactExports.useState(!1),[un,jr]=reactExports.useState(null),[Jr,fn]=reactExports.useState(null),[Fr,Cr]=reactExports.useState(!1),[Sr,dr]=reactExports.useState({code:"",discountType:"percentage",discountValue:10,minOrderAmount:0,maxDiscount:0}),[gr,qr]=reactExports.useState(!1);reactExports.useEffect(()=>{a.length>0&&!$&&rt(a[0].id)},[a,$]);const Lr=a.find(tn=>tn.id===$);reactExports.useEffect(()=>{Lr!=null&&Lr.upiId&&mr(Lr.upiId)},[Lr]);const _n=c.filter(tn=>!["delivered","cancelled"].includes(tn.status)),gn=c.filter(tn=>{const us=new Date;return new Date(tn.createdAt).toDateString()===us.toDateString()}),Sn=gn.reduce((tn,us)=>tn+us.totalAmount,0),Fs=c.filter(tn=>tn.status==="delivered").reduce((tn,us)=>tn+us.totalAmount,0),rs=St.filter(tn=>tn.status!=="rejected").reduce((tn,us)=>tn+us.amount,0),ms=Fs-rs,On=tn=>tn>=1e3?`${(tn/1e3).toFixed(1)}k`:`${tn}`,ws=async tn=>{var Co;const us=(Co=tn.target.files)==null?void 0:Co[0];if(us){fn(us);const Ss=new FileReader,Tl=await new Promise(ds=>{Ss.onloadend=()=>ds(Ss.result),Ss.readAsDataURL(us)});jr(Tl);const ga=ds=>{console.log("Decoded QR:",ds);const Mn=ds.match(/[?&]pa=([^&]+)/);return Mn?(mr(decodeURIComponent(Mn[1])),ue.success("UPI ID extracted successfully!"),!0):ds.includes("@")?(mr(ds),ue.success("UPI ID found!"),!0):!1};try{const Mn=await new Html5Qrcode("qr-reader-temp").scanFileV2(us,!1);if(Mn&&Mn.decodedText&&ga(Mn.decodedText))return}catch(ds){console.warn("html5-qrcode failed, trying fallback...",ds)}try{const ds=new Image;ds.src=Tl,await new Promise(Ds=>{ds.onload=Ds});const Mn=document.createElement("canvas"),Cs=Mn.getContext("2d");if(Cs){Mn.width=ds.width,Mn.height=ds.height,Cs.drawImage(ds,0,0);const Ds=Cs.getImageData(0,0,Mn.width,Mn.height),ao=jsQR(Ds.data,Ds.width,Ds.height);if(ao&&ao.data&&ga(ao.data))return}}catch(ds){console.error("jsQR failed:",ds)}ue.error("Could not detect a valid UPI QR code. Please try a clearer image or enter manually.")}},Vs=async()=>{if(!$)return;const tn=Number(er);if(!tn||tn<=0){ue.error("Please enter a valid amount");return}if(tn>ms){ue.error("Insufficient funds");return}if(!or){ue.error("Please provide a UPI ID or upload a QR Code");return}on(!0);try{let us="";if(Jr){const Co=await uploadToImgBB(Jr);Co&&(us=Co.display_url)}await createWithdrawalRequest({kitchenId:$,amount:tn,status:"pending",upiId:or,qrCodeImage:us,requestedAt:Date.now()}),ue.success("Withdrawal request submitted!"),Gt(!1),ir(""),mr(""),jr(null),fn(null),$&&or!==(Lr==null?void 0:Lr.upiId)&&updateKitchen($,{upiId:or})}catch(us){console.error(us),ue.error("Failed to submit request")}finally{on(!1)}},ks=async(tn,us)=>{try{await updateOrderStatus(tn,us),ue.success(`Order ${us==="cancelled"?"cancelled":"updated"}!`)}catch{ue.error("Failed to update order")}},lo=async()=>{if(!(!$||!Lr))try{await updateKitchen($,{isOpen:!Lr.isOpen}),ue.success(Lr.isOpen?"Kitchen closed":"Kitchen opened")}catch{ue.error("Failed to update kitchen status")}},ys=async()=>{if(!$||!Sr.code.trim()){ue.error("Please enter a coupon code");return}qr(!0);try{await createCoupon({code:Sr.code.toUpperCase(),kitchenId:$,discountType:Sr.discountType,discountValue:Sr.discountValue,minOrderAmount:Sr.minOrderAmount||void 0,maxDiscount:Sr.maxDiscount||void 0,usedCount:0,isActive:!0,createdAt:Date.now()}),ue.success("Coupon created!"),Cr(!1),dr({code:"",discountType:"percentage",discountValue:10,minOrderAmount:0,maxDiscount:0})}catch{ue.error("Failed to create coupon")}qr(!1)},dn=async tn=>{try{await deleteCoupon(tn),ue.success("Coupon deleted")}catch{ue.error("Failed to delete coupon")}},Es=async tn=>{try{await updateCoupon(tn.id,{isActive:!tn.isActive}),ue.success(tn.isActive?"Coupon deactivated":"Coupon activated")}catch{ue.error("Failed to update coupon")}},po=async()=>{if(Bt.length!==0&&window.confirm(`Are you sure you want to delete ${Bt.length} dishes?`))try{await Promise.all(Bt.map(tn=>deleteDish(tn))),ue.success(`Deleted ${Bt.length} dishes`),Zt([]),Ut(!1)}catch{ue.error("Failed to delete some dishes")}},no=tn=>{Zt(us=>us.includes(tn)?us.filter(Co=>Co!==tn):[...us,tn])};return!e||e.role!=="amma"?jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background flex flex-col items-center justify-center px-4",children:[jsxRuntimeExports.jsx(ChefHat,{className:"w-16 h-16 text-muted-foreground mb-4"}),jsxRuntimeExports.jsx("p",{className:"text-muted-foreground mb-4",children:"You need to be registered as an Amma to access this"}),jsxRuntimeExports.jsx(Link,{to:"/",children:jsxRuntimeExports.jsx(Button,{className:"gradient-primary text-primary-foreground",children:"Go Home"})})]}):_?jsxRuntimeExports.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:jsxRuntimeExports.jsx(LoaderCircle,{className:"w-8 h-8 animate-spin text-primary"})}):a.length===0?jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-24",children:[jsxRuntimeExports.jsx("header",{className:"sticky top-0 z-40 bg-card/95 backdrop-blur-lg border-b border-border",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between px-4 py-4",children:[jsxRuntimeExports.jsx("h1",{className:"font-semibold text-foreground",children:"My Kitchen"}),jsxRuntimeExports.jsx(Button,{variant:"ghost",size:"icon",onClick:async()=>{await i(),s("/auth")},className:"text-destructive",children:jsxRuntimeExports.jsx(LogOut,{className:"w-5 h-5"})})]})}),jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center px-4 py-16",children:[jsxRuntimeExports.jsx(ChefHat,{className:"w-20 h-20 text-muted-foreground mb-4"}),jsxRuntimeExports.jsx("h2",{className:"text-xl font-semibold text-foreground mb-2",children:"No Kitchen Yet"}),jsxRuntimeExports.jsx("p",{className:"text-muted-foreground text-center mb-6",children:"Start your home kitchen journey and share your delicious food with the community!"}),jsxRuntimeExports.jsx(Link,{to:"/amma/register",children:jsxRuntimeExports.jsxs(Button,{className:"gradient-primary text-primary-foreground",children:[jsxRuntimeExports.jsx(Plus,{className:"w-5 h-5 mr-2"})," Register Your Kitchen"]})})]})]}):jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-24",children:[jsxRuntimeExports.jsxs("header",{className:"sticky top-0 z-40 bg-card/95 backdrop-blur-lg border-b border-border",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between px-4 py-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h1",{className:"font-semibold text-foreground",children:Lr==null?void 0:Lr.name}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Kitchen Dashboard"})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx(Button,{onClick:lo,variant:"outline",size:"sm",className:cn("rounded-full",Lr!=null&&Lr.isOpen?"border-veg text-veg":"border-destructive text-destructive"),children:Lr!=null&&Lr.isOpen?" Open":" Closed"}),jsxRuntimeExports.jsx(Button,{variant:"ghost",size:"icon",onClick:()=>s(`/amma/edit-kitchen/${$}`),title:"Edit Kitchen",children:jsxRuntimeExports.jsx(Settings,{className:"w-5 h-5"})}),jsxRuntimeExports.jsx(Button,{variant:"ghost",size:"icon",onClick:async()=>{await i(),s("/auth")},className:"text-destructive",children:jsxRuntimeExports.jsx(LogOut,{className:"w-5 h-5"})})]})]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-3 gap-2 px-4 pb-4",children:[jsxRuntimeExports.jsxs("div",{className:"bg-secondary rounded-xl p-3 text-center",children:[jsxRuntimeExports.jsx("p",{className:"text-lg font-bold text-foreground",children:_n.length}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Active"})]}),jsxRuntimeExports.jsxs("div",{className:"bg-secondary rounded-xl p-3 text-center",children:[jsxRuntimeExports.jsx("p",{className:"text-lg font-bold text-foreground",children:gn.length}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Today"})]}),jsxRuntimeExports.jsxs("div",{className:"bg-secondary rounded-xl p-3 text-center",children:[jsxRuntimeExports.jsx("p",{className:"text-lg font-bold text-primary",children:On(Fs)}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Earnings"})]})]}),jsxRuntimeExports.jsx("div",{className:"flex bg-secondary mx-4 rounded-xl p-1 mb-4",children:["orders","menu","coupons","stats","wallet"].map(tn=>jsxRuntimeExports.jsx("button",{onClick:()=>Vt(tn),className:`flex-1 py-2 rounded-lg text-xs font-medium transition-all capitalize ${Pt===tn?"bg-card text-foreground shadow-soft":"text-muted-foreground"}`,children:tn},tn))})]}),jsxRuntimeExports.jsxs("div",{className:"px-4 py-4",children:[Pt==="orders"&&jsxRuntimeExports.jsx("div",{className:"space-y-4",children:dt?jsxRuntimeExports.jsx("div",{className:"flex justify-center py-8",children:jsxRuntimeExports.jsx(LoaderCircle,{className:"w-8 h-8 animate-spin text-primary"})}):_n.length===0?jsxRuntimeExports.jsxs("div",{className:"text-center py-12",children:[jsxRuntimeExports.jsx(Package,{className:"w-12 h-12 text-muted-foreground mx-auto mb-3"}),jsxRuntimeExports.jsx("p",{className:"text-muted-foreground",children:"No active orders"})]}):jsxRuntimeExports.jsx(AnimatePresence,{children:_n.map((tn,us)=>jsxRuntimeExports.jsx(OrderCard,{order:tn,index:us,onStatusUpdate:ks},tn.id))})}),Pt==="menu"&&jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center bg-card p-3 rounded-xl mb-4 shadow-sm",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsxs("h2",{className:"font-semibold text-foreground",children:["Your Dishes (",ht.length,")"]}),zt&&jsxRuntimeExports.jsxs("span",{className:"text-sm text-primary font-medium pl-2 border-l border-border",children:[Bt.length," selected"]})]}),jsxRuntimeExports.jsx("div",{className:"flex gap-2",children:zt?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs(Button,{size:"sm",variant:"destructive",onClick:po,disabled:Bt.length===0,children:[jsxRuntimeExports.jsx(Trash2,{className:"w-4 h-4 mr-1"})," Delete (",Bt.length,")"]}),jsxRuntimeExports.jsx(Button,{size:"sm",variant:"ghost",onClick:()=>{Ut(!1),Zt([])},children:"Cancel"})]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs(Button,{size:"sm",variant:"outline",onClick:()=>Ut(!0),children:[jsxRuntimeExports.jsx(Check,{className:"w-4 h-4 mr-1"})," Select"]}),jsxRuntimeExports.jsx(Link,{to:"/amma/add-dish",children:jsxRuntimeExports.jsxs(Button,{size:"sm",className:"gradient-primary text-primary-foreground",children:[jsxRuntimeExports.jsx(Plus,{className:"w-4 h-4 mr-1"})," Add"]})})]})})]}),ht.length===0?jsxRuntimeExports.jsx("div",{className:"text-center py-12",children:jsxRuntimeExports.jsx("p",{className:"text-muted-foreground",children:"No dishes yet. Add your first dish!"})}):ht.map(tn=>jsxRuntimeExports.jsxs(motion.div,{className:cn("bg-card rounded-xl p-4 shadow-card flex gap-4 transition-all",zt&&Bt.includes(tn.id)?"ring-2 ring-primary bg-primary/5":""),onClick:()=>{zt&&no(tn.id)},children:[zt&&jsxRuntimeExports.jsx("div",{className:"flex items-center justify-center",children:jsxRuntimeExports.jsx("div",{className:cn("w-5 h-5 rounded border flex items-center justify-center transition-colors",Bt.includes(tn.id)?"bg-primary border-primary text-primary-foreground":"border-muted-foreground bg-transparent"),children:Bt.includes(tn.id)&&jsxRuntimeExports.jsx(Check,{className:"w-3 h-3"})})}),jsxRuntimeExports.jsx("img",{src:tn.image,alt:tn.name,className:"w-20 h-20 rounded-lg object-cover"}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsx("h3",{className:"font-medium text-foreground",children:tn.name}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:tn.category}),jsxRuntimeExports.jsxs("p",{className:"text-primary font-semibold",children:["",tn.price]})]}),!zt&&jsxRuntimeExports.jsxs("div",{className:"flex flex-col gap-2",children:[jsxRuntimeExports.jsx(Button,{size:"icon",variant:"ghost",onClick:us=>{us.stopPropagation(),s(`/amma/edit-dish/${tn.id}`)},children:jsxRuntimeExports.jsx(SquarePen,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx(Button,{size:"icon",variant:"ghost",className:"text-destructive",onClick:us=>{us.stopPropagation(),deleteDish(tn.id),ue.success("Dish deleted")},children:jsxRuntimeExports.jsx(Trash2,{className:"w-4 h-4"})})]})]},tn.id))]}),Pt==="coupons"&&jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsxs("h2",{className:"font-semibold text-foreground",children:["Your Coupons (",Et.length,")"]}),jsxRuntimeExports.jsxs(Button,{size:"sm",className:"gradient-primary text-primary-foreground",onClick:()=>Cr(!Fr),children:[jsxRuntimeExports.jsx(Plus,{className:"w-4 h-4 mr-1"})," Create"]})]}),Fr&&jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},className:"bg-card rounded-xl p-4 shadow-card space-y-3",children:[jsxRuntimeExports.jsx("h3",{className:"font-medium text-foreground",children:"Create New Coupon"}),jsxRuntimeExports.jsx(Input,{placeholder:"Coupon Code (e.g., SAVE20)",value:Sr.code,onChange:tn=>dr({...Sr,code:tn.target.value.toUpperCase()}),className:"bg-secondary border-0 uppercase"}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[jsxRuntimeExports.jsxs("select",{value:Sr.discountType,onChange:tn=>dr({...Sr,discountType:tn.target.value}),className:"bg-secondary rounded-md px-3 py-2 text-sm text-foreground",children:[jsxRuntimeExports.jsx("option",{value:"percentage",children:"% Off"}),jsxRuntimeExports.jsx("option",{value:"fixed",children:" Fixed Off"}),jsxRuntimeExports.jsx("option",{value:"final_price",children:"Final Price"})]}),jsxRuntimeExports.jsx(Input,{type:"number",placeholder:Sr.discountType==="percentage"?"% value":" amount",value:Sr.discountValue,onChange:tn=>dr({...Sr,discountValue:Number(tn.target.value)}),className:"bg-secondary border-0"})]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[jsxRuntimeExports.jsx(Input,{type:"number",placeholder:"Min Order  (optional)",value:Sr.minOrderAmount||"",onChange:tn=>dr({...Sr,minOrderAmount:Number(tn.target.value)}),className:"bg-secondary border-0"}),Sr.discountType==="percentage"&&jsxRuntimeExports.jsx(Input,{type:"number",placeholder:"Max Discount  (optional)",value:Sr.maxDiscount||"",onChange:tn=>dr({...Sr,maxDiscount:Number(tn.target.value)}),className:"bg-secondary border-0"})]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsx(Button,{onClick:ys,disabled:gr,className:"flex-1 gradient-primary text-primary-foreground",children:gr?jsxRuntimeExports.jsx(LoaderCircle,{className:"w-4 h-4 animate-spin"}):"Create Coupon"}),jsxRuntimeExports.jsx(Button,{variant:"outline",onClick:()=>Cr(!1),children:"Cancel"})]})]}),Et.length===0&&!Fr?jsxRuntimeExports.jsxs("div",{className:"text-center py-12",children:[jsxRuntimeExports.jsx(Tag,{className:"w-12 h-12 text-muted-foreground mx-auto mb-3"}),jsxRuntimeExports.jsx("p",{className:"text-muted-foreground",children:"No coupons yet. Create your first coupon!"})]}):Et.map(tn=>jsxRuntimeExports.jsx(motion.div,{className:"bg-card rounded-xl p-4 shadow-card",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:cn("w-12 h-12 rounded-lg flex items-center justify-center",tn.isActive?"bg-veg/10":"bg-muted"),children:jsxRuntimeExports.jsx(Percent,{className:cn("w-6 h-6",tn.isActive?"text-veg":"text-muted-foreground")})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"font-bold text-foreground",children:tn.code}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-muted-foreground",children:[tn.discountType==="percentage"&&`${tn.discountValue}% off`,tn.discountType==="fixed"&&`${tn.discountValue} off`,tn.discountType==="final_price"&&`Final price: ${tn.discountValue}`,tn.minOrderAmount?`  Min ${tn.minOrderAmount}`:""]}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-muted-foreground",children:["Used: ",tn.usedCount," times"]})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsx(Button,{size:"icon",variant:"ghost",onClick:()=>Es(tn),className:tn.isActive?"text-veg":"text-muted-foreground",children:tn.isActive?jsxRuntimeExports.jsx(Check,{className:"w-4 h-4"}):jsxRuntimeExports.jsx(X,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx(Button,{size:"icon",variant:"ghost",className:"text-destructive",onClick:()=>dn(tn.id),children:jsxRuntimeExports.jsx(Trash2,{className:"w-4 h-4"})})]})]})},tn.id))]}),Pt==="stats"&&jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-2xl p-4 shadow-card",children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-foreground mb-4",children:"Today's Summary"}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[jsxRuntimeExports.jsxs("div",{className:"bg-secondary rounded-xl p-4",children:[jsxRuntimeExports.jsx(DollarSign,{className:"w-6 h-6 text-primary mb-2"}),jsxRuntimeExports.jsxs("p",{className:"text-2xl font-bold text-foreground",children:["",Sn]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Earnings"})]}),jsxRuntimeExports.jsxs("div",{className:"bg-secondary rounded-xl p-4",children:[jsxRuntimeExports.jsx(ShoppingBag,{className:"w-6 h-6 text-accent mb-2"}),jsxRuntimeExports.jsx("p",{className:"text-2xl font-bold text-foreground",children:gn.length}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Orders Completed"})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-2xl p-4 shadow-card",children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-foreground mb-4",children:"Daily Earnings (Last 7 Days)"}),jsxRuntimeExports.jsx("div",{className:"space-y-2",children:(()=>{const tn=[];for(let us=0;us<7;us++){const Co=new Date;Co.setDate(Co.getDate()-us);const Ss=Co.toDateString(),Ul=c.filter(Tl=>Tl.status==="delivered"&&new Date(Tl.createdAt).toDateString()===Ss).reduce((Tl,ga)=>Tl+ga.totalAmount,0);tn.push({date:Co,amount:Ul})}return tn.map((us,Co)=>jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between p-3 rounded-xl bg-secondary/30",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:cn("w-10 h-10 rounded-full flex items-center justify-center bg-card",us.amount>0?"text-primary":"text-muted-foreground"),children:jsxRuntimeExports.jsx(DollarSign,{className:"w-5 h-5"})}),jsxRuntimeExports.jsxs("div",{className:"flex flex-col",children:[jsxRuntimeExports.jsx("span",{className:"font-semibold text-foreground",children:Co===0?"Today":Co===1?"Yesterday":us.date.toLocaleDateString("en-US",{weekday:"short",day:"numeric"})}),jsxRuntimeExports.jsx("span",{className:"text-xs text-muted-foreground",children:us.date.toLocaleDateString("en-US",{month:"short",day:"numeric"})})]})]}),jsxRuntimeExports.jsxs("span",{className:cn("font-bold text-lg",us.amount>0?"text-primary":"text-muted-foreground"),children:["",us.amount]})]},Co))})()})]}),jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-2xl p-4 shadow-card",children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-foreground mb-4",children:"Kitchen Info"}),jsxRuntimeExports.jsxs("div",{className:"space-y-3 text-sm",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-muted-foreground",children:"Rating"}),jsxRuntimeExports.jsxs("span",{className:"text-foreground font-medium",children:[" ",Lr==null?void 0:Lr.rating]})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-muted-foreground",children:"Total Reviews"}),jsxRuntimeExports.jsx("span",{className:"text-foreground font-medium",children:Lr==null?void 0:Lr.totalRatings})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-muted-foreground",children:"Menu Items"}),jsxRuntimeExports.jsx("span",{className:"text-foreground font-medium",children:ht.length})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-2xl p-4 shadow-card",children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-foreground mb-4",children:"Kitchen Order Stats"}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[["pending","accepted","cooking","packed","out_for_delivery","delivered","cancelled"].map(tn=>{const us=c.filter(Co=>Co.status===tn).length;return us===0&&tn!=="pending"&&tn!=="delivered"?null:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between p-2 hover:bg-secondary/50 rounded-lg transition-colors",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:cn("w-3 h-3 rounded-full",tn==="pending"?"bg-gold":tn==="delivered"?"bg-veg":tn==="cancelled"?"bg-destructive":"bg-primary")}),jsxRuntimeExports.jsx("span",{className:"text-sm font-medium capitalize",children:tn.replace(/_/g," ")})]}),jsxRuntimeExports.jsx("span",{className:"font-bold text-foreground",children:us})]},tn)}),jsxRuntimeExports.jsxs("div",{className:"pt-3 border-t border-border mt-2 flex justify-between items-center",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-muted-foreground font-medium",children:"Total All Time"}),jsxRuntimeExports.jsx("span",{className:"text-lg font-bold text-primary",children:c.length})]})]})]})]}),Pt==="wallet"&&jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"bg-gradient-to-br from-primary via-primary/90 to-primary/80 rounded-2xl p-6 text-primary-foreground shadow-card relative overflow-hidden",children:[jsxRuntimeExports.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full blur-2xl transform translate-x-10 -translate-y-10"}),jsxRuntimeExports.jsxs("div",{className:"relative z-10",children:[jsxRuntimeExports.jsx("p",{className:"text-primary-foreground/80 text-sm mb-1",children:"Available Balance"}),jsxRuntimeExports.jsxs("h2",{className:"text-4xl font-bold mb-4",children:["",ms.toLocaleString()]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-4 text-sm text-primary-foreground/90",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-xs opacity-70",children:"Total Earned"}),jsxRuntimeExports.jsxs("p",{className:"font-semibold",children:["",Fs.toLocaleString()]})]}),jsxRuntimeExports.jsx("div",{className:"w-px bg-white/20"}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-xs opacity-70",children:"Withdrawn"}),jsxRuntimeExports.jsxs("p",{className:"font-semibold",children:["",rs.toLocaleString()]})]})]})]})]}),Nt?jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"bg-card rounded-2xl p-4 shadow-card space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center mb-2",children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-foreground",children:"New Withdrawal"}),jsxRuntimeExports.jsx(Button,{variant:"ghost",size:"sm",onClick:()=>Gt(!1),children:"Cancel"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Amount ()"}),jsxRuntimeExports.jsx(Input,{type:"number",placeholder:`Max: ${ms}`,value:er,onChange:tn=>ir(tn.target.value),className:"bg-secondary border-0 text-lg font-bold"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"text-sm font-medium mb-1 block",children:"UPI Details"}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3 mb-3",children:[jsxRuntimeExports.jsxs("label",{className:"flex-1 cursor-pointer",children:[jsxRuntimeExports.jsx("div",{className:"h-24 bg-secondary rounded-xl border-2 border-dashed border-muted-foreground/30 flex flex-col items-center justify-center hover:bg-secondary/80 transition-colors",children:un?jsxRuntimeExports.jsx("img",{src:un,alt:"QR",className:"h-full w-full object-contain rounded-lg"}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(QrCode,{className:"w-6 h-6 text-muted-foreground mb-1"}),jsxRuntimeExports.jsx("span",{className:"text-xs text-muted-foreground text-center px-2",children:"Tap to scan QR"})]})}),jsxRuntimeExports.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:ws})]}),jsxRuntimeExports.jsxs("div",{className:"flex-[2] flex flex-col justify-center",children:[jsxRuntimeExports.jsx(Input,{placeholder:"UPI ID (e.g. 9988...@opl)",value:or,onChange:tn=>mr(tn.target.value),className:"bg-secondary border-0 mb-1"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Upload QR or enter manually"})]})]})]}),jsxRuntimeExports.jsxs(Button,{className:"w-full",disabled:Rr,onClick:Vs,children:[Rr?jsxRuntimeExports.jsx(LoaderCircle,{className:"w-4 h-4 animate-spin mr-2"}):jsxRuntimeExports.jsx(ArrowUpRight,{className:"w-4 h-4 mr-2"}),"Submit Request"]})]}):jsxRuntimeExports.jsxs(Button,{className:"w-full h-12 text-lg shadow-lg",size:"lg",onClick:()=>Gt(!0),children:[jsxRuntimeExports.jsx(Wallet,{className:"w-5 h-5 mr-2"})," Request Withdrawal"]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-foreground mb-3 px-1",children:"Recent Transactions"}),St.length===0?jsxRuntimeExports.jsx("div",{className:"text-center py-8 text-muted-foreground bg-card rounded-2xl",children:"No transactions yet"}):jsxRuntimeExports.jsx("div",{className:"space-y-3",children:St.map(tn=>jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-xl p-4 shadow-sm flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:cn("w-10 h-10 rounded-full flex items-center justify-center",tn.status==="approved"?"bg-veg/10 text-veg":tn.status==="rejected"?"bg-destructive/10 text-destructive":"bg-gold/10 text-gold"),children:tn.status==="approved"?jsxRuntimeExports.jsx(Check,{className:"w-5 h-5"}):tn.status==="rejected"?jsxRuntimeExports.jsx(X,{className:"w-5 h-5"}):jsxRuntimeExports.jsx(Clock,{className:"w-5 h-5"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"font-medium text-foreground",children:"Withdrawal"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(tn.requestedAt).toLocaleDateString()})]})]}),jsxRuntimeExports.jsxs("div",{className:"text-right",children:[jsxRuntimeExports.jsxs("p",{className:"font-bold text-foreground",children:["- ",tn.amount]}),jsxRuntimeExports.jsx("p",{className:cn("text-xs capitalize",tn.status==="approved"?"text-veg":tn.status==="rejected"?"text-destructive":"text-gold"),children:tn.status})]})]},tn.id))})]})]})]}),jsxRuntimeExports.jsx("div",{id:"qr-reader-temp",className:"hidden"})]})}function OrderCard({order:e,index:i,onStatusUpdate:s}){const a=statusConfig[e.status];return jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,x:-100},transition:{delay:i*.05},className:"bg-card rounded-2xl p-4 shadow-card",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-start justify-between mb-3",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("p",{className:"text-xs text-muted-foreground",children:["#",e.id.slice(-8)]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(e.createdAt).toLocaleTimeString()})]}),jsxRuntimeExports.jsx("span",{className:cn("px-3 py-1 rounded-full text-xs font-medium",a.color),children:a.label})]}),jsxRuntimeExports.jsx("div",{className:"space-y-1 mb-3",children:e.items.map((_,$)=>jsxRuntimeExports.jsxs("div",{className:"flex justify-between text-sm",children:[jsxRuntimeExports.jsxs("span",{className:"text-foreground",children:[_.dish.name," x",_.quantity]}),jsxRuntimeExports.jsxs("span",{className:"text-muted-foreground",children:["",_.dish.price*_.quantity]})]},$))}),e.notes&&jsxRuntimeExports.jsx("div",{className:"bg-secondary rounded-lg p-2 mb-3",children:jsxRuntimeExports.jsxs("p",{className:"text-xs text-muted-foreground",children:["Note: ",e.notes]})}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground mb-3",children:[jsxRuntimeExports.jsx(MapPin,{className:"w-3 h-3"}),jsxRuntimeExports.jsxs("span",{children:[e.deliveryAddress.line1,", ",e.deliveryAddress.city]})]}),jsxRuntimeExports.jsxs("div",{className:"pt-3 border-t border-border space-y-3",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-muted-foreground",children:"Total Amount"}),jsxRuntimeExports.jsxs("span",{className:"font-bold text-foreground",children:["",e.totalAmount]})]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-2 w-full",children:[e.status!=="cancelled"&&a.nextStatus&&jsxRuntimeExports.jsx("div",{className:"flex-1 min-w-0",children:jsxRuntimeExports.jsx(SlideAction,{onSuccess:()=>s(e.id,a.nextStatus),text:`SLIDE TO ${a.nextStatus==="accepted"?"ACCEPT":a.nextStatus.toUpperCase().replace("_"," ")}`,icon:a.nextStatus==="accepted"?Check:ChevronRight,className:"h-12 bg-secondary/50 border-primary/20 w-full",sliderColor:"bg-primary",textColor:"text-primary"})}),e.status==="pending"&&jsxRuntimeExports.jsx(Button,{size:"icon",variant:"outline",className:"h-12 w-12 shrink-0 text-destructive border-destructive/30 hover:bg-destructive/10 rounded-full",onClick:()=>s(e.id,"cancelled"),children:jsxRuntimeExports.jsx(X,{className:"w-5 h-5"})})]})]})]})}var mapboxGl={exports:{}};(function(e,i){(function(s,a){e.exports=a()})(commonjsGlobal,function(){var s,a,_;function $(c,dt){if(!s)s=dt;else if(!a)a=dt;else{var ht="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+s+")(sharedChunk); ("+a+")(sharedChunk); self.onerror = null;",Et={};s(Et),_=dt(Et),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(_.workerUrl=window.URL.createObjectURL(new Blob([ht],{type:"text/javascript"})))}}$(["exports"],function(c){var dt=1e-6,ht=typeof Float32Array<"u"?Float32Array:Array;function Et(b,o){var g=o[0],et=o[1],nt=o[2],at=o[3],lt=g*at-nt*et;return lt?(b[0]=at*(lt=1/lt),b[1]=-et*lt,b[2]=-nt*lt,b[3]=g*lt,b):null}function St(){var b=new ht(9);return ht!=Float32Array&&(b[1]=0,b[2]=0,b[3]=0,b[5]=0,b[6]=0,b[7]=0),b[0]=1,b[4]=1,b[8]=1,b}function At(b,o){var g=o[0],et=o[1],nt=o[2],at=o[3],lt=o[4],ft=o[5],gt=o[6],Rt=o[7],Mt=o[8];return b[0]=lt*Mt-ft*Rt,b[1]=nt*Rt-et*Mt,b[2]=et*ft-nt*lt,b[3]=ft*gt-at*Mt,b[4]=g*Mt-nt*gt,b[5]=nt*at-g*ft,b[6]=at*Rt-lt*gt,b[7]=et*gt-g*Rt,b[8]=g*lt-et*at,b}function Pt(b,o,g){var et=o[0],nt=o[1],at=o[2],lt=o[3],ft=o[4],gt=o[5],Rt=o[6],Mt=o[7],Lt=o[8],Ht=g[0],Kt=g[1],Qt=g[2],sr=g[3],hr=g[4],ur=g[5],_r=g[6],br=g[7],Ir=g[8];return b[0]=Ht*et+Kt*lt+Qt*Rt,b[1]=Ht*nt+Kt*ft+Qt*Mt,b[2]=Ht*at+Kt*gt+Qt*Lt,b[3]=sr*et+hr*lt+ur*Rt,b[4]=sr*nt+hr*ft+ur*Mt,b[5]=sr*at+hr*gt+ur*Lt,b[6]=_r*et+br*lt+Ir*Rt,b[7]=_r*nt+br*ft+Ir*Mt,b[8]=_r*at+br*gt+Ir*Lt,b}function Vt(){var b=new ht(16);return ht!=Float32Array&&(b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[6]=0,b[7]=0,b[8]=0,b[9]=0,b[11]=0,b[12]=0,b[13]=0,b[14]=0),b[0]=1,b[5]=1,b[10]=1,b[15]=1,b}function Bt(b){var o=new ht(16);return o[0]=b[0],o[1]=b[1],o[2]=b[2],o[3]=b[3],o[4]=b[4],o[5]=b[5],o[6]=b[6],o[7]=b[7],o[8]=b[8],o[9]=b[9],o[10]=b[10],o[11]=b[11],o[12]=b[12],o[13]=b[13],o[14]=b[14],o[15]=b[15],o}function Zt(b){return b[0]=1,b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[5]=1,b[6]=0,b[7]=0,b[8]=0,b[9]=0,b[10]=1,b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,b}function zt(b,o){var g=o[0],et=o[1],nt=o[2],at=o[3],lt=o[4],ft=o[5],gt=o[6],Rt=o[7],Mt=o[8],Lt=o[9],Ht=o[10],Kt=o[11],Qt=o[12],sr=o[13],hr=o[14],ur=o[15],_r=g*ft-et*lt,br=g*gt-nt*lt,Ir=g*Rt-at*lt,Vr=et*gt-nt*ft,Mr=et*Rt-at*ft,Hr=nt*Rt-at*gt,Zr=Mt*sr-Lt*Qt,en=Mt*hr-Ht*Qt,Tn=Mt*ur-Kt*Qt,ln=Lt*hr-Ht*sr,Fn=Lt*ur-Kt*sr,Ln=Ht*ur-Kt*hr,jn=_r*Ln-br*Fn+Ir*ln+Vr*Tn-Mr*en+Hr*Zr;return jn?(b[0]=(ft*Ln-gt*Fn+Rt*ln)*(jn=1/jn),b[1]=(nt*Fn-et*Ln-at*ln)*jn,b[2]=(sr*Hr-hr*Mr+ur*Vr)*jn,b[3]=(Ht*Mr-Lt*Hr-Kt*Vr)*jn,b[4]=(gt*Tn-lt*Ln-Rt*en)*jn,b[5]=(g*Ln-nt*Tn+at*en)*jn,b[6]=(hr*Ir-Qt*Hr-ur*br)*jn,b[7]=(Mt*Hr-Ht*Ir+Kt*br)*jn,b[8]=(lt*Fn-ft*Tn+Rt*Zr)*jn,b[9]=(et*Tn-g*Fn-at*Zr)*jn,b[10]=(Qt*Mr-sr*Ir+ur*_r)*jn,b[11]=(Lt*Ir-Mt*Mr-Kt*_r)*jn,b[12]=(ft*en-lt*ln-gt*Zr)*jn,b[13]=(g*ln-et*en+nt*Zr)*jn,b[14]=(sr*br-Qt*Vr-hr*_r)*jn,b[15]=(Mt*Vr-Lt*br+Ht*_r)*jn,b):null}function Ut(b,o,g){var et=o[0],nt=o[1],at=o[2],lt=o[3],ft=o[4],gt=o[5],Rt=o[6],Mt=o[7],Lt=o[8],Ht=o[9],Kt=o[10],Qt=o[11],sr=o[12],hr=o[13],ur=o[14],_r=o[15],br=g[0],Ir=g[1],Vr=g[2],Mr=g[3];return b[0]=br*et+Ir*ft+Vr*Lt+Mr*sr,b[1]=br*nt+Ir*gt+Vr*Ht+Mr*hr,b[2]=br*at+Ir*Rt+Vr*Kt+Mr*ur,b[3]=br*lt+Ir*Mt+Vr*Qt+Mr*_r,b[4]=(br=g[4])*et+(Ir=g[5])*ft+(Vr=g[6])*Lt+(Mr=g[7])*sr,b[5]=br*nt+Ir*gt+Vr*Ht+Mr*hr,b[6]=br*at+Ir*Rt+Vr*Kt+Mr*ur,b[7]=br*lt+Ir*Mt+Vr*Qt+Mr*_r,b[8]=(br=g[8])*et+(Ir=g[9])*ft+(Vr=g[10])*Lt+(Mr=g[11])*sr,b[9]=br*nt+Ir*gt+Vr*Ht+Mr*hr,b[10]=br*at+Ir*Rt+Vr*Kt+Mr*ur,b[11]=br*lt+Ir*Mt+Vr*Qt+Mr*_r,b[12]=(br=g[12])*et+(Ir=g[13])*ft+(Vr=g[14])*Lt+(Mr=g[15])*sr,b[13]=br*nt+Ir*gt+Vr*Ht+Mr*hr,b[14]=br*at+Ir*Rt+Vr*Kt+Mr*ur,b[15]=br*lt+Ir*Mt+Vr*Qt+Mr*_r,b}function Nt(b,o,g){var et,nt,at,lt,ft,gt,Rt,Mt,Lt,Ht,Kt,Qt,sr=g[0],hr=g[1],ur=g[2];return o===b?(b[12]=o[0]*sr+o[4]*hr+o[8]*ur+o[12],b[13]=o[1]*sr+o[5]*hr+o[9]*ur+o[13],b[14]=o[2]*sr+o[6]*hr+o[10]*ur+o[14],b[15]=o[3]*sr+o[7]*hr+o[11]*ur+o[15]):(nt=o[1],at=o[2],lt=o[3],ft=o[4],gt=o[5],Rt=o[6],Mt=o[7],Lt=o[8],Ht=o[9],Kt=o[10],Qt=o[11],b[0]=et=o[0],b[1]=nt,b[2]=at,b[3]=lt,b[4]=ft,b[5]=gt,b[6]=Rt,b[7]=Mt,b[8]=Lt,b[9]=Ht,b[10]=Kt,b[11]=Qt,b[12]=et*sr+ft*hr+Lt*ur+o[12],b[13]=nt*sr+gt*hr+Ht*ur+o[13],b[14]=at*sr+Rt*hr+Kt*ur+o[14],b[15]=lt*sr+Mt*hr+Qt*ur+o[15]),b}function Gt(b,o,g){var et=g[0],nt=g[1],at=g[2];return b[0]=o[0]*et,b[1]=o[1]*et,b[2]=o[2]*et,b[3]=o[3]*et,b[4]=o[4]*nt,b[5]=o[5]*nt,b[6]=o[6]*nt,b[7]=o[7]*nt,b[8]=o[8]*at,b[9]=o[9]*at,b[10]=o[10]*at,b[11]=o[11]*at,b[12]=o[12],b[13]=o[13],b[14]=o[14],b[15]=o[15],b}function er(b,o,g){var et=Math.sin(g),nt=Math.cos(g),at=o[4],lt=o[5],ft=o[6],gt=o[7],Rt=o[8],Mt=o[9],Lt=o[10],Ht=o[11];return o!==b&&(b[0]=o[0],b[1]=o[1],b[2]=o[2],b[3]=o[3],b[12]=o[12],b[13]=o[13],b[14]=o[14],b[15]=o[15]),b[4]=at*nt+Rt*et,b[5]=lt*nt+Mt*et,b[6]=ft*nt+Lt*et,b[7]=gt*nt+Ht*et,b[8]=Rt*nt-at*et,b[9]=Mt*nt-lt*et,b[10]=Lt*nt-ft*et,b[11]=Ht*nt-gt*et,b}function ir(b,o,g){var et=Math.sin(g),nt=Math.cos(g),at=o[0],lt=o[1],ft=o[2],gt=o[3],Rt=o[8],Mt=o[9],Lt=o[10],Ht=o[11];return o!==b&&(b[4]=o[4],b[5]=o[5],b[6]=o[6],b[7]=o[7],b[12]=o[12],b[13]=o[13],b[14]=o[14],b[15]=o[15]),b[0]=at*nt-Rt*et,b[1]=lt*nt-Mt*et,b[2]=ft*nt-Lt*et,b[3]=gt*nt-Ht*et,b[8]=at*et+Rt*nt,b[9]=lt*et+Mt*nt,b[10]=ft*et+Lt*nt,b[11]=gt*et+Ht*nt,b}function or(b,o,g){var et=Math.sin(g),nt=Math.cos(g),at=o[0],lt=o[1],ft=o[2],gt=o[3],Rt=o[4],Mt=o[5],Lt=o[6],Ht=o[7];return o!==b&&(b[8]=o[8],b[9]=o[9],b[10]=o[10],b[11]=o[11],b[12]=o[12],b[13]=o[13],b[14]=o[14],b[15]=o[15]),b[0]=at*nt+Rt*et,b[1]=lt*nt+Mt*et,b[2]=ft*nt+Lt*et,b[3]=gt*nt+Ht*et,b[4]=Rt*nt-at*et,b[5]=Mt*nt-lt*et,b[6]=Lt*nt-ft*et,b[7]=Ht*nt-gt*et,b}function mr(b,o){return b[0]=o[0],b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[5]=o[1],b[6]=0,b[7]=0,b[8]=0,b[9]=0,b[10]=o[2],b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,b}function Rr(b,o,g){var et,nt,at,lt=g[0],ft=g[1],gt=g[2],Rt=Math.sqrt(lt*lt+ft*ft+gt*gt);return Rt<dt?null:(lt*=Rt=1/Rt,ft*=Rt,gt*=Rt,et=Math.sin(o),nt=Math.cos(o),b[0]=lt*lt*(at=1-nt)+nt,b[1]=ft*lt*at+gt*et,b[2]=gt*lt*at-ft*et,b[3]=0,b[4]=lt*ft*at-gt*et,b[5]=ft*ft*at+nt,b[6]=gt*ft*at+lt*et,b[7]=0,b[8]=lt*gt*at+ft*et,b[9]=ft*gt*at-lt*et,b[10]=gt*gt*at+nt,b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,b)}function on(b,o){var g=o[0],et=o[1],nt=o[2],at=o[4],lt=o[5],ft=o[6],gt=o[8],Rt=o[9],Mt=o[10];return b[0]=Math.sqrt(g*g+et*et+nt*nt),b[1]=Math.sqrt(at*at+lt*lt+ft*ft),b[2]=Math.sqrt(gt*gt+Rt*Rt+Mt*Mt),b}function un(b,o){var g=o[0],et=o[1],nt=o[2],at=o[3],lt=g+g,ft=et+et,gt=nt+nt,Rt=g*lt,Mt=et*lt,Lt=et*ft,Ht=nt*lt,Kt=nt*ft,Qt=nt*gt,sr=at*lt,hr=at*ft,ur=at*gt;return b[0]=1-Lt-Qt,b[1]=Mt+ur,b[2]=Ht-hr,b[3]=0,b[4]=Mt-ur,b[5]=1-Rt-Qt,b[6]=Kt+sr,b[7]=0,b[8]=Ht+hr,b[9]=Kt-sr,b[10]=1-Rt-Lt,b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,b}var jr=Ut;function Jr(){var b=new ht(3);return ht!=Float32Array&&(b[0]=0,b[1]=0,b[2]=0),b}function fn(b){var o=new ht(3);return o[0]=b[0],o[1]=b[1],o[2]=b[2],o}function Fr(b){var o=b[0],g=b[1],et=b[2];return Math.sqrt(o*o+g*g+et*et)}function Cr(b,o,g){var et=new ht(3);return et[0]=b,et[1]=o,et[2]=g,et}function Sr(b,o,g,et){return b[0]=o,b[1]=g,b[2]=et,b}function dr(b,o,g){return b[0]=o[0]+g[0],b[1]=o[1]+g[1],b[2]=o[2]+g[2],b}function gr(b,o,g){return b[0]=o[0]-g[0],b[1]=o[1]-g[1],b[2]=o[2]-g[2],b}function qr(b,o,g){return b[0]=o[0]*g[0],b[1]=o[1]*g[1],b[2]=o[2]*g[2],b}function Lr(b,o,g){return b[0]=Math.min(o[0],g[0]),b[1]=Math.min(o[1],g[1]),b[2]=Math.min(o[2],g[2]),b}function _n(b,o,g){return b[0]=Math.max(o[0],g[0]),b[1]=Math.max(o[1],g[1]),b[2]=Math.max(o[2],g[2]),b}function gn(b,o,g){return b[0]=o[0]*g,b[1]=o[1]*g,b[2]=o[2]*g,b}function Sn(b,o,g,et){return b[0]=o[0]+g[0]*et,b[1]=o[1]+g[1]*et,b[2]=o[2]+g[2]*et,b}function Fs(b,o){var g=o[0]-b[0],et=o[1]-b[1],nt=o[2]-b[2];return Math.sqrt(g*g+et*et+nt*nt)}function rs(b,o){var g=o[0]-b[0],et=o[1]-b[1],nt=o[2]-b[2];return g*g+et*et+nt*nt}function ms(b){var o=b[0],g=b[1],et=b[2];return o*o+g*g+et*et}function On(b,o){return b[0]=-o[0],b[1]=-o[1],b[2]=-o[2],b}function ws(b,o){var g=o[0],et=o[1],nt=o[2],at=g*g+et*et+nt*nt;return at>0&&(at=1/Math.sqrt(at)),b[0]=o[0]*at,b[1]=o[1]*at,b[2]=o[2]*at,b}function Vs(b,o){return b[0]*o[0]+b[1]*o[1]+b[2]*o[2]}function ks(b,o,g){var et=o[0],nt=o[1],at=o[2],lt=g[0],ft=g[1],gt=g[2];return b[0]=nt*gt-at*ft,b[1]=at*lt-et*gt,b[2]=et*ft-nt*lt,b}function lo(b,o,g,et){var nt=o[0],at=o[1],lt=o[2];return b[0]=nt+et*(g[0]-nt),b[1]=at+et*(g[1]-at),b[2]=lt+et*(g[2]-lt),b}function ys(b,o,g){var et=o[0],nt=o[1],at=o[2],lt=g[3]*et+g[7]*nt+g[11]*at+g[15];return b[0]=(g[0]*et+g[4]*nt+g[8]*at+g[12])/(lt=lt||1),b[1]=(g[1]*et+g[5]*nt+g[9]*at+g[13])/lt,b[2]=(g[2]*et+g[6]*nt+g[10]*at+g[14])/lt,b}function dn(b,o,g){var et=o[0],nt=o[1],at=o[2];return b[0]=et*g[0]+nt*g[3]+at*g[6],b[1]=et*g[1]+nt*g[4]+at*g[7],b[2]=et*g[2]+nt*g[5]+at*g[8],b}function Es(b,o,g){var et=g[0],nt=g[1],at=g[2],lt=g[3],ft=o[0],gt=o[1],Rt=o[2],Mt=nt*Rt-at*gt,Lt=at*ft-et*Rt,Ht=et*gt-nt*ft;return b[0]=ft+lt*(Mt+=Mt)+nt*(Ht+=Ht)-at*(Lt+=Lt),b[1]=gt+lt*Lt+at*Mt-et*Ht,b[2]=Rt+lt*Ht+et*Lt-nt*Mt,b}function po(b){return b[0]=0,b[1]=0,b[2]=0,b}function no(b,o){return b[0]===o[0]&&b[1]===o[1]&&b[2]===o[2]}var tn=gr,us=qr,Co=Fr;function Ss(){var b=new ht(4);return ht!=Float32Array&&(b[0]=0,b[1]=0,b[2]=0,b[3]=0),b}function Ul(b,o,g){return b[0]=o[0]*g,b[1]=o[1]*g,b[2]=o[2]*g,b[3]=o[3]*g,b}function Tl(b,o){var g=o[0],et=o[1],nt=o[2],at=o[3],lt=g*g+et*et+nt*nt+at*at;return lt>0&&(lt=1/Math.sqrt(lt)),b[0]=g*lt,b[1]=et*lt,b[2]=nt*lt,b[3]=at*lt,b}function ga(b,o,g){var et=o[0],nt=o[1],at=o[2],lt=o[3];return b[0]=g[0]*et+g[4]*nt+g[8]*at+g[12]*lt,b[1]=g[1]*et+g[5]*nt+g[9]*at+g[13]*lt,b[2]=g[2]*et+g[6]*nt+g[10]*at+g[14]*lt,b[3]=g[3]*et+g[7]*nt+g[11]*at+g[15]*lt,b}function ds(){var b=new ht(4);return ht!=Float32Array&&(b[0]=0,b[1]=0,b[2]=0),b[3]=1,b}function Mn(b){return b[0]=0,b[1]=0,b[2]=0,b[3]=1,b}function Cs(b,o,g){g*=.5;var et=o[0],nt=o[1],at=o[2],lt=o[3],ft=Math.sin(g),gt=Math.cos(g);return b[0]=et*gt+lt*ft,b[1]=nt*gt+at*ft,b[2]=at*gt-nt*ft,b[3]=lt*gt-et*ft,b}function Ds(b,o,g){g*=.5;var et=o[0],nt=o[1],at=o[2],lt=o[3],ft=Math.sin(g),gt=Math.cos(g);return b[0]=et*gt-at*ft,b[1]=nt*gt+lt*ft,b[2]=at*gt+et*ft,b[3]=lt*gt-nt*ft,b}Jr(),Ss();var ao,Wo,Gl,fs=Tl,ps=(ao=Jr(),Wo=Cr(1,0,0),Gl=Cr(0,1,0),function(b,o,g){var et=Vs(o,g);return et<-.999999?(ks(ao,Wo,o),Co(ao)<1e-6&&ks(ao,Gl,o),ws(ao,ao),function(nt,at,lt){lt*=.5;var ft=Math.sin(lt);nt[0]=ft*at[0],nt[1]=ft*at[1],nt[2]=ft*at[2],nt[3]=Math.cos(lt)}(b,ao,Math.PI),b):et>.999999?(b[0]=0,b[1]=0,b[2]=0,b[3]=1,b):(ks(ao,o,g),b[0]=ao[0],b[1]=ao[1],b[2]=ao[2],b[3]=1+et,fs(b,b))});function qn(){var b=new ht(2);return ht!=Float32Array&&(b[0]=0,b[1]=0),b}function qs(b,o){var g=new ht(2);return g[0]=b,g[1]=o,g}function Gs(b,o,g){return b[0]=o,b[1]=g,b}function Eo(b,o,g){return b[0]=o[0]+g[0],b[1]=o[1]+g[1],b}function Kl(b,o,g){return b[0]=o[0]-g[0],b[1]=o[1]-g[1],b}function tu(b,o,g){return b[0]=o[0]*g,b[1]=o[1]*g,b}function Wl(b){var o=b[0],g=b[1];return Math.sqrt(o*o+g*g)}function Zo(b,o){var g=o[0],et=o[1],nt=g*g+et*et;return nt>0&&(nt=1/Math.sqrt(nt)),b[0]=o[0]*nt,b[1]=o[1]*nt,b}function ru(b,o){return b[0]*o[0]+b[1]*o[1]}ds(),ds(),St();var Oo,Tu,Ao=Kl;function Ll(b){return b&&b.__esModule&&Object.prototype.hasOwnProperty.call(b,"default")?b.default:b}qn();var Jo=function(){if(Tu)return Oo;function b(o,g,et,nt){this.cx=3*o,this.bx=3*(et-o)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*g,this.by=3*(nt-g)-this.cy,this.ay=1-this.cy-this.by,this.p1x=o,this.p1y=g,this.p2x=et,this.p2y=nt}return Tu=1,Oo=b,b.prototype={sampleCurveX:function(o){return((this.ax*o+this.bx)*o+this.cx)*o},sampleCurveY:function(o){return((this.ay*o+this.by)*o+this.cy)*o},sampleCurveDerivativeX:function(o){return(3*this.ax*o+2*this.bx)*o+this.cx},solveCurveX:function(o,g){if(g===void 0&&(g=1e-6),o<0)return 0;if(o>1)return 1;for(var et=o,nt=0;nt<8;nt++){var at=this.sampleCurveX(et)-o;if(Math.abs(at)<g)return et;var lt=this.sampleCurveDerivativeX(et);if(Math.abs(lt)<1e-6)break;et-=at/lt}var ft=0,gt=1;for(et=o,nt=0;nt<20&&(at=this.sampleCurveX(et),!(Math.abs(at-o)<g));nt++)o>at?ft=et:gt=et,et=.5*(gt-ft)+ft;return et},solve:function(o,g){return this.sampleCurveY(this.solveCurveX(o,g))}},Oo}(),Ku=Ll(Jo);function zn(b,o){this.x=b,this.y=o}function Vu(b,o){if(Array.isArray(b)){if(!Array.isArray(o)||b.length!==o.length)return!1;for(let g=0;g<b.length;g++)if(!Vu(b[g],o[g]))return!1;return!0}if(typeof b=="object"&&b!==null&&o!==null){if(typeof o!="object"||Object.keys(b).length!==Object.keys(o).length)return!1;for(const g in b)if(!Vu(b[g],o[g]))return!1;return!0}return b===o}zn.prototype={clone(){return new zn(this.x,this.y)},add(b){return this.clone()._add(b)},sub(b){return this.clone()._sub(b)},multByPoint(b){return this.clone()._multByPoint(b)},divByPoint(b){return this.clone()._divByPoint(b)},mult(b){return this.clone()._mult(b)},div(b){return this.clone()._div(b)},rotate(b){return this.clone()._rotate(b)},rotateAround(b,o){return this.clone()._rotateAround(b,o)},matMult(b){return this.clone()._matMult(b)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(b){return this.x===b.x&&this.y===b.y},dist(b){return Math.sqrt(this.distSqr(b))},distSqr(b){const o=b.x-this.x,g=b.y-this.y;return o*o+g*g},angle(){return Math.atan2(this.y,this.x)},angleTo(b){return Math.atan2(this.y-b.y,this.x-b.x)},angleWith(b){return this.angleWithSep(b.x,b.y)},angleWithSep(b,o){return Math.atan2(this.x*o-this.y*b,this.x*b+this.y*o)},_matMult(b){const o=b[2]*this.x+b[3]*this.y;return this.x=b[0]*this.x+b[1]*this.y,this.y=o,this},_add(b){return this.x+=b.x,this.y+=b.y,this},_sub(b){return this.x-=b.x,this.y-=b.y,this},_mult(b){return this.x*=b,this.y*=b,this},_div(b){return this.x/=b,this.y/=b,this},_multByPoint(b){return this.x*=b.x,this.y*=b.y,this},_divByPoint(b){return this.x/=b.x,this.y/=b.y,this},_unit(){return this._div(this.mag()),this},_perp(){const b=this.y;return this.y=this.x,this.x=-b,this},_rotate(b){const o=Math.cos(b),g=Math.sin(b),et=g*this.x+o*this.y;return this.x=o*this.x-g*this.y,this.y=et,this},_rotateAround(b,o){const g=Math.cos(b),et=Math.sin(b),nt=o.y+et*(this.x-o.x)+g*(this.y-o.y);return this.x=o.x+g*(this.x-o.x)-et*(this.y-o.y),this.y=nt,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:zn},zn.convert=function(b){if(b instanceof zn)return b;if(Array.isArray(b))return new zn(+b[0],+b[1]);if(b.x!==void 0&&b.y!==void 0)return new zn(+b.x,+b.y);throw new Error("Expected [x, y] or {x, y} point format")};const t0=Math.PI/180,Wu=180/Math.PI;function Bo(b){return b*t0}function Ru(b){return b*Wu}const T0=[[0,0],[1,0],[1,1],[0,1]];function fp(b){if(b<=0)return 0;if(b>=1)return 1;const o=b*b,g=o*b;return 4*(b<.5?g:3*(b-o)+g-.75)}function xo(b,o,g,et){const nt=new Ku(b,o,g,et);return function(at){return nt.solve(at)}}const xn=xo(.25,.1,.25,1);function pr(b,o,g){return Math.min(g,Math.max(o,b))}function vr(b,o,g){return(g=pr((g-b)/(o-b),0,1))*g*(3-2*g)}function kr(b,o,g){const et=g-o,nt=((b-o)%et+et)%et+o;return nt===o?g:nt}function Yr(b,o,g){if(!b.length)return g(null,[]);let et=b.length;const nt=new Array(b.length);let at=null;b.forEach((lt,ft)=>{o(lt,(gt,Rt)=>{gt&&(at=gt),nt[ft]=Rt,--et==0&&g(at,nt)})})}let Kr=1;function rn(){return Kr++}function En(b){return b<=1?1:Math.pow(2,Math.ceil(Math.log2(b)))}function hn(b,o){b.forEach(g=>{o[g]&&(o[g]=o[g].bind(o))})}function vn(b,o,g){const et={};for(const nt in b)et[nt]=o.call(this,b[nt],nt,b);return et}function Vn(b,o,g){const et={};for(const nt in b)o.call(this,b[nt],nt,b)&&(et[nt]=b[nt]);return et}function Rn(b){return Array.isArray(b)?b.map(Rn):typeof b=="object"&&b?vn(b,Rn):b}function Ts(b,o){for(let g=0;g<b.length;g++)if(o.indexOf(b[g])>=0)return!0;return!1}const Xs={};function bs(b){Xs[b]||(typeof console<"u"&&console.warn(b),Xs[b]=!0)}function Gn(b,o,g){return(g.y-b.y)*(o.x-b.x)>(o.y-b.y)*(g.x-b.x)}function bo(b){let o=0;for(let g,et,nt=0,at=b.length,lt=at-1;nt<at;lt=nt++)g=b[nt],et=b[lt],o+=(et.x-g.x)*(g.y+et.y);return o}function Ys([b,o,g]){const et=Bo(o+90),nt=Bo(g);return{x:b*Math.cos(et)*Math.sin(nt),y:b*Math.sin(et)*Math.sin(nt),z:b*Math.cos(nt),azimuthal:o,polar:g}}function jo(b){return(typeof self<"u"||b!==void 0)&&typeof WorkerGlobalScope<"u"&&(b!==void 0?b:self)instanceof WorkerGlobalScope}function yu(b){const o={};if(b.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(g,et,nt,at)=>{const lt=nt||at;return o[et]=!lt||lt.toLowerCase(),""}),o["max-age"]){const g=parseInt(o["max-age"],10);isNaN(g)?delete o["max-age"]:o["max-age"]=g}return o}let Yo=null;function Lo(b,o){return[b[4*o],b[4*o+1],b[4*o+2],b[4*o+3]]}function zo(b,o,g,et){for(;o<g;){const nt=o+g>>1;b[nt]<et?o=nt+1:g=nt}return o}function uu(b,o,g,et){for(;o<g;){const nt=o+g>>1;b[nt]<=et?o=nt+1:g=nt}return o}function na(b){return b>0?1/(1.001-b):1+b}function du(b){return b>0?1-1/(1.001-b):-b}function Vo(b,o,g){return(b-o.min)*(g.max-g.min)/(o.max-o.min)+g.min}const Do={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Do.API_URL)return null;try{const b=new URL(Do.API_URL);return b.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":b.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.4.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function Iu(b){return Do.API_URL_REGEX.test(b)}function Jl(b){return Do.API_SPRITE_REGEX.test(b)}let qu,Ip,Xp,Il,Mu,Un;function nn(){return qu==null&&(qu=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),qu}const uo={now:()=>Il!==void 0?Il:performance.now(),setNow(b){Il=b},restoreNow(){Il=void 0},frame(b){const o=requestAnimationFrame(b);return{cancel:()=>cancelAnimationFrame(o)}},getImageData(b,o=0){const{width:g,height:et}=b;Mu||(Mu=document.createElement("canvas"));const nt=Mu.getContext("2d",{willReadFrequently:!0});if(!nt)throw new Error("failed to create canvas 2d context");return(g>Mu.width||et>Mu.height)&&(Mu.width=g,Mu.height=et),nt.clearRect(-o,-o,g+2*o,et+2*o),nt.drawImage(b,0,0,g,et),nt.getImageData(-o,-o,g+2*o,et+2*o)},resolveURL:b=>(Ip||(Ip=document.createElement("a")),Ip.href=b,Ip.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Xp==null&&(Xp=window.matchMedia("(prefers-reduced-motion: reduce)")),Xp.matches)},hasCanvasFingerprintNoise(){if(Un!==void 0)return Un;if(!nn())return Un=!1,!1;const b=new OffscreenCanvas(85,1),o=b.getContext("2d",{willReadFrequently:!0});let g=0;for(let nt=0;nt<b.width;++nt)o.fillStyle=`rgba(${g++},${g++},${g++}, 255)`,o.fillRect(nt,0,1,1);const et=o.getImageData(0,0,b.width,b.height);g=0;for(let nt=0;nt<et.data.length;++nt)if(nt%4!=3&&g++!==et.data[nt])return Un=!0,!0;return Un=!1,!1}};function Zu(b,o){const g=b.indexOf("?");if(g<0)return`${b}?${new URLSearchParams(o).toString()}`;const et=new URLSearchParams(b.slice(g));for(const nt in o)et.set(nt,o[nt]);return`${b.slice(0,g)}?${et.toString()}`}function yp(b,o={persistentParams:[]}){const g=b.indexOf("?");if(g<0)return b;const et=new URLSearchParams,nt=new URLSearchParams(b.slice(g));for(const lt of o.persistentParams){const ft=nt.get(lt);ft&&et.set(lt,ft)}const at=et.toString();return`${b.slice(0,g)}${at.length>0?`?${at}`:""}`}const bx="mapbox-tiles";let Am=500,Dp=50;const Uo=["language","worldview","jobid"];let _u,Ep;function r0(){try{return caches}catch{}}function jp(){const b=r0();b&&_u==null&&(_u=b.open(bx))}let Pp=1/0;const Kp={supported:!1,testSupport:function(b){!j0&&Yu&&(Fp?Y1(b):L0=b)}};let L0,Yu,j0=!1,Fp=!1;const _a=typeof self<"u"?self:{};function Y1(b){const o=b.createTexture();b.bindTexture(b.TEXTURE_2D,o);try{if(b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,Yu),b.isContextLost())return;Kp.supported=!0}catch{}b.deleteTexture(o),j0=!0}_a.document&&(Yu=_a.document.createElement("img"),Yu.onload=function(){L0&&Y1(L0),L0=null,Fp=!0},Yu.onerror=function(){j0=!0,L0=null},Yu.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Bl={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(Bl);class Du extends Error{constructor(o,g,et){g===401&&Iu(et)&&(o+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(o),this.status=g,this.url=et}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const wx=jo()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,R0=function(b,o){if(!(/^file:/.test(g=b.url)||/^file:/.test(wx())&&!/^\w+:/.test(g))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(et,nt){const at=new AbortController,lt=new Request(et.url,{method:et.method||"GET",body:et.body,credentials:et.credentials,headers:et.headers,referrer:wx(),referrerPolicy:et.referrerPolicy,signal:at.signal});let ft=!1,gt=!1;const Rt=(Mt=lt.url).indexOf("sku=")>0&&Iu(Mt);var Mt;et.type==="json"&&lt.headers.set("Accept","application/json");const Lt=(Kt,Qt,sr)=>{if(gt)return;if(Kt&&Kt.message!=="SecurityError"&&bs(Kt.toString()),Qt&&sr)return Ht(Qt);const hr=Date.now();fetch(lt).then(ur=>{if(ur.ok){const _r=Rt?ur.clone():null;return Ht(ur,_r,hr)}return nt(new Du(ur.statusText,ur.status,et.url))}).catch(ur=>{ur.name!=="AbortError"&&nt(new Error(`${ur.message} ${et.url}`))})},Ht=(Kt,Qt,sr)=>{(et.type==="arrayBuffer"?Kt.arrayBuffer():et.type==="json"?Kt.json():Kt.text()).then(hr=>{gt||(Qt&&sr&&function(ur,_r,br){if(jp(),_u==null)return;const Ir=yu(_r.headers.get("Cache-Control")||"");if(Ir["no-store"])return;const Vr={status:_r.status,statusText:_r.statusText,headers:new Headers};_r.headers.forEach((Zr,en)=>Vr.headers.set(en,Zr)),Ir["max-age"]&&Vr.headers.set("Expires",new Date(br+1e3*Ir["max-age"]).toUTCString());const Mr=Vr.headers.get("Expires");if(!Mr||new Date(Mr).getTime()-br<42e4)return;let Hr=yp(ur.url,{persistentParams:Uo});if(_r.status===206){const Zr=ur.headers.get("Range");if(!Zr)return;Vr.status=200,Hr=Zu(Hr,{range:Zr})}(function(Zr,en){if(Ep===void 0)try{new Response(new ReadableStream),Ep=!0}catch{Ep=!1}Ep?en(Zr.body):Zr.blob().then(en).catch(Tn=>bs(Tn.message))})(_r,Zr=>{const en=new Response((Tn=_r.status)!==200&&Tn!==404&&[101,103,204,205,304].includes(Tn)?null:Zr,Vr);var Tn;jp(),_u!=null&&_u.then(ln=>ln.put(Hr,en)).catch(ln=>bs(ln.message))})}(lt,Qt,sr),ft=!0,nt(null,hr,Kt.headers))}).catch(hr=>{gt||nt(new Error(hr.message))})};return Rt?function(Kt,Qt){if(jp(),_u==null)return Qt(null);_u.then(sr=>{let hr=yp(Kt.url,{persistentParams:Uo});const ur=Kt.headers.get("Range");ur&&(hr=Zu(hr,{range:ur})),sr.match(hr).then(_r=>{const br=function(Ir){if(!Ir)return!1;const Vr=new Date(Ir.headers.get("Expires")||0),Mr=yu(Ir.headers.get("Cache-Control")||"");return Number(Vr)>Date.now()&&!Mr["no-cache"]}(_r);sr.delete(hr).catch(Qt),br&&sr.put(hr,_r.clone()).catch(Qt),Qt(null,_r,br)}).catch(Qt)}).catch(Qt)}(lt,Lt):Lt(null,null),{cancel:()=>{gt=!0,ft||at.abort()}}}(b,o);if(jo(self)&&self.worker.actor)return self.worker.actor.send("getResource",b,o,void 0,!0)}var g;return function(et,nt){const at=new XMLHttpRequest;at.open(et.method||"GET",et.url,!0),et.type==="arrayBuffer"&&(at.responseType="arraybuffer");for(const lt in et.headers)at.setRequestHeader(lt,et.headers[lt]);return et.type==="json"&&(at.responseType="text",at.setRequestHeader("Accept","application/json")),at.withCredentials=et.credentials==="include",at.onerror=()=>{nt(new Error(at.statusText))},at.onload=()=>{if((at.status>=200&&at.status<300||at.status===0)&&at.response!==null){let lt=at.response;if(et.type==="json")try{lt=JSON.parse(at.response)}catch(gt){return nt(gt)}const ft=new Headers;at.getAllResponseHeaders().trim().split(/[\r\n]+/).forEach(gt=>{const Rt=gt.split(": "),Mt=Rt.shift(),Lt=Rt.join(": ");ft.append(Mt,Lt)}),nt(null,lt,ft)}else nt(new Du(at.statusText,at.status,et.url))},at.send(et.body),{cancel:()=>at.abort()}}(b,o)},p0=function(b,o){return R0(Object.assign(b,{type:"arrayBuffer"}),o)};function J0(b){const o=document.createElement("a");return o.href=b,o.protocol===location.protocol&&o.host===location.host}const Q1="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let I0,qo;I0=[],qo=0;const z0=function(b,o){if(Kp.supported&&(b.headers||(b.headers={}),b.headers.accept="image/webp,*/*"),qo>=Do.MAX_PARALLEL_IMAGE_REQUESTS){const at={requestParameters:b,callback:o,cancelled:!1,cancel(){this.cancelled=!0}};return I0.push(at),at}qo++;let g=!1;const et=()=>{if(!g)for(g=!0,qo--;I0.length&&qo<Do.MAX_PARALLEL_IMAGE_REQUESTS;){const at=I0.shift(),{requestParameters:lt,callback:ft,cancelled:gt}=at;gt||(at.cancel=z0(lt,ft).cancel)}},nt=p0(b,(at,lt,ft)=>{et(),at?o(at):lt&&(self.createImageBitmap?function(gt,Rt){const Mt=new Blob([new Uint8Array(gt)],{type:"image/png"});createImageBitmap(Mt).then(Lt=>{Rt(null,Lt)}).catch(Lt=>{Rt(new Error(`Could not load image because of ${Lt.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(lt,(gt,Rt)=>o(gt,Rt,ft)):function(gt,Rt){const Mt=new Image;Mt.onload=()=>{Rt(null,Mt),URL.revokeObjectURL(Mt.src),Mt.onload=null,requestAnimationFrame(()=>{Mt.src=Q1})},Mt.onerror=()=>Rt(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const Lt=new Blob([new Uint8Array(gt)],{type:"image/png"});Mt.src=gt.byteLength?URL.createObjectURL(Lt):Q1}(lt,(gt,Rt)=>o(gt,Rt,ft)))});return{cancel:()=>{nt.cancel(),et()}}};var Cx,Sm,Tm,sp={exports:{}},Rm={exports:{}},Im={exports:{}},Ax=function(){if(Tm)return sp.exports;Tm=1;var b=(Cx||(Cx=1,Rm.exports=function(g,et){var nt,at,lt,ft,gt,Rt,Mt,Lt;for(at=g.length-(nt=3&g.length),lt=et,gt=3432918353,Rt=461845907,Lt=0;Lt<at;)Mt=255&g.charCodeAt(Lt)|(255&g.charCodeAt(++Lt))<<8|(255&g.charCodeAt(++Lt))<<16|(255&g.charCodeAt(++Lt))<<24,++Lt,lt=27492+(65535&(ft=5*(65535&(lt=(lt^=Mt=(65535&(Mt=(Mt=(65535&Mt)*gt+(((Mt>>>16)*gt&65535)<<16)&4294967295)<<15|Mt>>>17))*Rt+(((Mt>>>16)*Rt&65535)<<16)&4294967295)<<13|lt>>>19))+((5*(lt>>>16)&65535)<<16)&4294967295))+((58964+(ft>>>16)&65535)<<16);switch(Mt=0,nt){case 3:Mt^=(255&g.charCodeAt(Lt+2))<<16;case 2:Mt^=(255&g.charCodeAt(Lt+1))<<8;case 1:lt^=Mt=(65535&(Mt=(Mt=(65535&(Mt^=255&g.charCodeAt(Lt)))*gt+(((Mt>>>16)*gt&65535)<<16)&4294967295)<<15|Mt>>>17))*Rt+(((Mt>>>16)*Rt&65535)<<16)&4294967295}return lt^=g.length,lt=2246822507*(65535&(lt^=lt>>>16))+((2246822507*(lt>>>16)&65535)<<16)&4294967295,lt=3266489909*(65535&(lt^=lt>>>13))+((3266489909*(lt>>>16)&65535)<<16)&4294967295,(lt^=lt>>>16)>>>0}),Rm.exports),o=(Sm||(Sm=1,Im.exports=function(g,et){for(var nt,at=g.length,lt=et^at,ft=0;at>=4;)nt=1540483477*(65535&(nt=255&g.charCodeAt(ft)|(255&g.charCodeAt(++ft))<<8|(255&g.charCodeAt(++ft))<<16|(255&g.charCodeAt(++ft))<<24))+((1540483477*(nt>>>16)&65535)<<16),lt=1540483477*(65535&lt)+((1540483477*(lt>>>16)&65535)<<16)^(nt=1540483477*(65535&(nt^=nt>>>24))+((1540483477*(nt>>>16)&65535)<<16)),at-=4,++ft;switch(at){case 3:lt^=(255&g.charCodeAt(ft+2))<<16;case 2:lt^=(255&g.charCodeAt(ft+1))<<8;case 1:lt=1540483477*(65535&(lt^=255&g.charCodeAt(ft)))+((1540483477*(lt>>>16)&65535)<<16)}return lt=1540483477*(65535&(lt^=lt>>>13))+((1540483477*(lt>>>16)&65535)<<16),(lt^=lt>>>15)>>>0}),Im.exports);return sp.exports=b,sp.exports.murmur3=b,sp.exports.murmur2=o,sp.exports}(),Sx=Ll(Ax);class m0{constructor(o,...g){Object.assign(this,g[0]||{}),this.type=o}}class Zm extends m0{constructor(o,g={}){super("error",Object.assign({error:o},g))}}function Pu(b,o,g){g[b]&&g[b].indexOf(o)!==-1||(g[b]=g[b]||[],g[b].push(o))}function D0(b,o,g){if(g&&g[b]){const et=g[b].indexOf(o);et!==-1&&g[b].splice(et,1)}}class x0{on(o,g){return this._listeners=this._listeners||{},Pu(o,g,this._listeners),this}off(o,g){return D0(o,g,this._listeners),D0(o,g,this._oneTimeListeners),this}once(o,g){return g?(this._oneTimeListeners=this._oneTimeListeners||{},Pu(o,g,this._oneTimeListeners),this):new Promise(et=>{this.once(o,et)})}fire(o,g){const et=typeof o=="string"?new m0(o,g):o,nt=et.type;if(this.listens(nt)){et.target=this;const at=this._listeners&&this._listeners[nt]?this._listeners[nt].slice():[];for(const gt of at)gt.call(this,et);const lt=this._oneTimeListeners&&this._oneTimeListeners[nt]?this._oneTimeListeners[nt].slice():[];for(const gt of lt)D0(nt,gt,this._oneTimeListeners),gt.call(this,et);const ft=this._eventedParent;if(ft){const gt=typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData;Object.assign(et,gt),ft.fire(et)}}else et instanceof Zm&&console.error(et.error);return this}listens(o){return!!(this._listeners&&this._listeners[o]&&this._listeners[o].length>0||this._oneTimeListeners&&this._oneTimeListeners[o]&&this._oneTimeListeners[o].length>0||this._eventedParent&&this._eventedParent.listens(o))}setEventedParent(o,g){return this._eventedParent=o,this._eventedParentData=g,this}}class Qu{constructor(o){typeof o=="string"?this.name=o:(this.name=o.name,this.iconsetId=o.iconsetId)}static from(o){return new Qu(o)}static toString(o){return o.iconsetId?`${o.name}${o.iconsetId}`:o.name}static parse(o){const[g,et]=o.split("");return new Qu({name:g,iconsetId:et})}static isEqual(o,g){return o.name===g.name&&o.iconsetId===g.iconsetId}toString(){return Qu.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var Tx,cs={},yl=function(){if(Tx)return cs;Tx=1;var b={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function o(at){return(at=Math.round(at))<0?0:at>255?255:at}function g(at){return o(at[at.length-1]==="%"?parseFloat(at)/100*255:parseInt(at))}function et(at){return(lt=at[at.length-1]==="%"?parseFloat(at)/100:parseFloat(at))<0?0:lt>1?1:lt;var lt}function nt(at,lt,ft){return ft<0?ft+=1:ft>1&&(ft-=1),6*ft<1?at+(lt-at)*ft*6:2*ft<1?lt:3*ft<2?at+(lt-at)*(2/3-ft)*6:at}try{cs.parseCSSColor=function(at){var lt,ft=at.replace(/ /g,"").toLowerCase();if(ft in b)return b[ft].slice();if(ft[0]==="#")return ft.length===4?(lt=parseInt(ft.substr(1),16))>=0&&lt<=4095?[(3840&lt)>>4|(3840&lt)>>8,240&lt|(240&lt)>>4,15&lt|(15&lt)<<4,1]:null:ft.length===7&&(lt=parseInt(ft.substr(1),16))>=0&&lt<=16777215?[(16711680&lt)>>16,(65280&lt)>>8,255&lt,1]:null;var gt=ft.indexOf("("),Rt=ft.indexOf(")");if(gt!==-1&&Rt+1===ft.length){var Mt=ft.substr(0,gt),Lt=ft.substr(gt+1,Rt-(gt+1)).split(","),Ht=1;switch(Mt){case"rgba":if(Lt.length!==4)return null;Ht=et(Lt.pop());case"rgb":return Lt.length!==3?null:[g(Lt[0]),g(Lt[1]),g(Lt[2]),Ht];case"hsla":if(Lt.length!==4)return null;Ht=et(Lt.pop());case"hsl":if(Lt.length!==3)return null;var Kt=(parseFloat(Lt[0])%360+360)%360/360,Qt=et(Lt[1]),sr=et(Lt[2]),hr=sr<=.5?sr*(Qt+1):sr+Qt-sr*Qt,ur=2*sr-hr;return[o(255*nt(ur,hr,Kt+1/3)),o(255*nt(ur,hr,Kt)),o(255*nt(ur,hr,Kt-1/3)),Ht];default:return null}}return null}}catch{}return cs}();class Mo{constructor(o,g,et,nt=1){this.r=o,this.g=g,this.b=et,this.a=nt}static parse(o){if(!o)return;if(o instanceof Mo)return o;if(typeof o!="string")return;const g=yl.parseCSSColor(o);return g?new Mo(g[0]/255,g[1]/255,g[2]/255,g[3]):void 0}toString(){const[o,g,et,nt]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*o)},${Math.round(255*g)},${Math.round(255*et)},${nt})`}toNonPremultipliedRenderColor(o){const{r:g,g:et,b:nt,a:at}=this;return new u1(o,g,et,nt,at)}toPremultipliedRenderColor(o){const{r:g,g:et,b:nt,a:at}=this;return new J1(o,g*at,et*at,nt*at,at)}clone(){return new Mo(this.r,this.g,this.b,this.a)}}class Ym{constructor(o,g,et,nt,at,lt=!1){if(this.premultiplied=!1,this.premultiplied=lt,o){const ft=o.image.height,gt=ft*ft;this.premultiplied?(g=at===0?0:g/at*(ft-1),et=at===0?0:et/at*(ft-1),nt=at===0?0:nt/at*(ft-1)):(g*=ft-1,et*=ft-1,nt*=ft-1);const Rt=Math.floor(g),Mt=Math.floor(et),Lt=Math.floor(nt),Ht=Math.ceil(g),Kt=Math.ceil(et),Qt=Math.ceil(nt),sr=g-Rt,hr=et-Mt,ur=nt-Lt,_r=o.image.data,br=4*(Rt+Mt*gt+Lt*ft),Ir=4*(Rt+Mt*gt+Qt*ft),Vr=4*(Rt+Kt*gt+Lt*ft),Mr=4*(Rt+Kt*gt+Qt*ft),Hr=4*(Ht+Mt*gt+Lt*ft),Zr=4*(Ht+Mt*gt+Qt*ft),en=4*(Ht+Kt*gt+Lt*ft),Tn=4*(Ht+Kt*gt+Qt*ft);if(br<0||Tn>=_r.length)throw new Error("out of range");this.r=so(so(so(_r[br],_r[Ir],ur),so(_r[Vr],_r[Mr],ur),hr),so(so(_r[Hr],_r[Zr],ur),so(_r[en],_r[Tn],ur),hr),sr)/255*(this.premultiplied?at:1),this.g=so(so(so(_r[br+1],_r[Ir+1],ur),so(_r[Vr+1],_r[Mr+1],ur),hr),so(so(_r[Hr+1],_r[Zr+1],ur),so(_r[en+1],_r[Tn+1],ur),hr),sr)/255*(this.premultiplied?at:1),this.b=so(so(so(_r[br+2],_r[Ir+2],ur),so(_r[Vr+2],_r[Mr+2],ur),hr),so(so(_r[Hr+2],_r[Zr+2],ur),so(_r[en+2],_r[Tn+2],ur),hr),sr)/255*(this.premultiplied?at:1),this.a=at}else this.r=g,this.g=et,this.b=nt,this.a=at}toArray(){const{r:o,g,b:et,a:nt}=this;return[255*o,255*g,255*et,nt]}toHslaArray(){let{r:o,g,b:et,a:nt}=this;if(this.premultiplied){if(nt===0)return[0,0,0,0];const Qt=1/nt;o*=Qt,g*=Qt,et*=Qt}const at=Math.min(Math.max(o,0),1),lt=Math.min(Math.max(g,0),1),ft=Math.min(Math.max(et,0),1),gt=Math.min(at,lt,ft),Rt=Math.max(at,lt,ft),Mt=Rt-gt,Lt=.5*(gt+Rt);if(Mt===0)return[0,0,100*Lt,nt];const Ht=Lt>.5?Mt/(2-Rt-gt):Mt/(Rt+gt);let Kt;switch(Rt){case at:Kt=60*((lt-ft)/Mt+(lt<ft?6:0));break;case lt:Kt=60*((ft-at)/Mt+2);break;default:Kt=60*((at-lt)/Mt+4)}return[Kt,100*Ht,100*Lt,nt]}toArray01(){const{r:o,g,b:et,a:nt}=this;return[o,g,et,nt]}toArray01Scaled(o){const{r:g,g:et,b:nt}=this;return[g*o,et*o,nt*o]}toArray01Linear(){const{r:o,g,b:et,a:nt}=this;return[Math.pow(o,2.2),Math.pow(g,2.2),Math.pow(et,2.2),nt]}}class u1 extends Ym{constructor(o,g,et,nt,at){super(o,g,et,nt,at,!1)}}class J1 extends Ym{constructor(o,g,et,nt,at){super(o,g,et,nt,at,!0)}}function so(b,o,g){return b*(1-g)+o*g}function d1(b,o,g){return b.map((et,nt)=>so(et,o[nt],g))}Mo.black=new Mo(0,0,0,1),Mo.white=new Mo(1,1,1,1),Mo.transparent=new Mo(0,0,0,0),Mo.red=new Mo(1,0,0,1),Mo.blue=new Mo(0,0,1,1);var em=Object.freeze({__proto__:null,array:d1,color:function(b,o,g){return new Mo(so(b.r,o.r,g),so(b.g,o.g,g),so(b.b,o.b,g),so(b.a,o.a,g))},number:so});class ku extends Error{constructor(o,g){super(g),this.message=g,this.key=o}}class V0{constructor(o,g=[]){this.parent=o,this.bindings={};for(const[et,nt]of g)this.bindings[et]=nt}concat(o){return new V0(this,o)}get(o){if(this.bindings[o])return this.bindings[o];if(this.parent)return this.parent.get(o);throw new Error(`${o} not found in scope.`)}has(o){return!!this.bindings[o]||!!this.parent&&this.parent.has(o)}}const vu={kind:"null"},js={kind:"number"},No={kind:"string"},go={kind:"boolean"},Po={kind:"color"},g0={kind:"object"},yo={kind:"value"},y0={kind:"collator"},_0={kind:"formatted"},Qm={kind:"resolvedImage"};function Uu(b,o){return{kind:"array",itemType:b,N:o}}function Nu(b){if(b.kind==="array"){const o=Nu(b.itemType);return typeof b.N=="number"?`array<${o}, ${b.N}>`:b.itemType.kind==="value"?"array":`array<${o}>`}return b.kind}const ey=[vu,js,No,go,Po,_0,g0,Uu(yo),Qm];function v0(b,o){if(o.kind==="error")return null;if(b.kind==="array"){if(o.kind==="array"&&(o.N===0&&o.itemType.kind==="value"||!v0(b.itemType,o.itemType))&&(typeof b.N!="number"||b.N===o.N))return null}else{if(b.kind===o.kind)return null;if(b.kind==="value"){for(const g of ey)if(!v0(g,o))return null}}return`Expected ${Nu(b)} but found ${Nu(o)} instead.`}function Rx(b,o){return o.some(g=>g.kind===b.kind)}function Dm(b,o){return o.some(g=>g==="null"?b===null:g==="array"?Array.isArray(b):g==="object"?b&&!Array.isArray(b)&&typeof b=="object":g===typeof b)}function Ix(b,o){return b.kind==="array"&&o.kind==="array"?b.N===o.N&&Ix(b.itemType,o.itemType):b.kind===o.kind}class U0{constructor(o,g,et){this.sensitivity=o?g?"variant":"case":g?"accent":"base",this.locale=et,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(o,g){return this.collator.compare(o,g)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Pm{constructor(o,g,et,nt,at){this.text=o.normalize?o.normalize():o,this.image=g,this.scale=et,this.fontStack=nt,this.textColor=at}}class bp{constructor(o){this.sections=o}static fromString(o){return new bp([new Pm(o,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(o=>o.text.length!==0||!!o.image&&o.image.hasPrimary())}static factory(o){return o instanceof bp?o:bp.fromString(o)}toString(){return this.sections.length===0?"":this.sections.map(o=>o.text).join("")}serialize(){const o=["format"];for(const g of this.sections){if(g.image){const nt=g.image.getPrimary().id.toString();o.push(["image",nt]);continue}o.push(g.text);const et={};g.fontStack&&(et["text-font"]=["literal",g.fontStack.split(",")]),g.scale&&(et["font-scale"]=g.scale),g.textColor&&(et["text-color"]=["rgba"].concat(g.textColor.toNonPremultipliedRenderColor(null).toArray())),o.push(et)}return o}}class zp{constructor(o,g={}){this.id=Qu.from(o),this.params=g.params,this.sx=g.sx||1,this.sy=g.sy||1}toString(){return JSON.stringify(this)}static parse(o){let g,et,nt,at;try{({id:g,params:et,sx:nt,sy:at}=JSON.parse(o)||{})}catch{return null}return g?new zp(g,{params:et,sx:nt,sy:at}):null}scaleSelf(o,g=o){return this.sx*=o,this.sy*=g,this}}class wp{constructor(o,g,et,nt,at=!1){this.primaryId=Qu.from(o),this.primaryOptions=g,et&&(this.secondaryId=Qu.from(et)),this.secondaryOptions=nt,this.available=at}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new zp(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new zp(this.secondaryId,this.secondaryOptions):null}static from(o){return typeof o=="string"?wp.build({name:o}):o}static build(o,g,et,nt){return!o||typeof o=="object"&&!("name"in o)?null:new wp(o,et,g,nt)}}function Bp(b,o,g,et){return typeof b=="number"&&b>=0&&b<=255&&typeof o=="number"&&o>=0&&o<=255&&typeof g=="number"&&g>=0&&g<=255?et===void 0||typeof et=="number"&&et>=0&&et<=1?null:`Invalid rgba value [${[b,o,g,et].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof et=="number"?[b,o,g,et]:[b,o,g]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function P0(b){if(b===null||typeof b=="string"||typeof b=="boolean"||typeof b=="number"||b instanceof Mo||b instanceof U0||b instanceof bp||b instanceof wp)return!0;if(Array.isArray(b)){for(const o of b)if(!P0(o))return!1;return!0}if(typeof b=="object"){for(const o in b)if(!P0(b[o]))return!1;return!0}return!1}function mu(b){if(b===null)return vu;if(typeof b=="string")return No;if(typeof b=="boolean")return go;if(typeof b=="number")return js;if(b instanceof Mo)return Po;if(b instanceof U0)return y0;if(b instanceof bp)return _0;if(b instanceof wp)return Qm;if(Array.isArray(b)){const o=b.length;let g;for(const et of b){const nt=mu(et);if(g){if(g===nt)continue;g=yo;break}g=nt}return Uu(g||yo,o)}return g0}function Vp(b){const o=typeof b;return b===null?"":o==="string"||o==="number"||o==="boolean"?String(b):b instanceof bp||b instanceof wp||b instanceof Mo?b.toString():JSON.stringify(b)}class pp{constructor(o,g){this.type=o,this.value=g}static parse(o,g){if(o.length!==2)return g.error(`'literal' expression requires exactly one argument, but found ${o.length-1} instead.`);if(!P0(o[1]))return g.error("invalid value");const et=o[1];let nt=mu(et);const at=g.expectedType;return nt.kind!=="array"||nt.N!==0||!at||at.kind!=="array"||typeof at.N=="number"&&at.N!==0||(nt=at),new pp(nt,et)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Mo?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof bp?this.value.serialize():this.value}}class _h{constructor(o){this.name="ExpressionEvaluationError",this.message=o}toJSON(){return this.message}}const Jm={string:No,number:js,boolean:go,object:g0};class n0{constructor(o,g){this.type=o,this.args=g}static parse(o,g){if(o.length<2)return g.error("Expected at least one argument.");let et,nt=1;const at=o[0];if(at==="array"){let ft,gt;if(o.length>2){const Rt=o[1];if(typeof Rt!="string"||!(Rt in Jm)||Rt==="object")return g.error('The item type argument of "array" must be one of string, number, boolean',1);ft=Jm[Rt],nt++}else ft=yo;if(o.length>3){if(o[2]!==null&&(typeof o[2]!="number"||o[2]<0||o[2]!==Math.floor(o[2])))return g.error('The length argument to "array" must be a positive integer literal',2);gt=o[2],nt++}et=Uu(ft,gt)}else et=Jm[at];const lt=[];for(;nt<o.length;nt++){const ft=g.parse(o[nt],nt,yo);if(!ft)return null;lt.push(ft)}return new n0(et,lt)}evaluate(o){for(let g=0;g<this.args.length;g++){const et=this.args[g].evaluate(o);if(!v0(this.type,mu(et)))return et;if(g===this.args.length-1)throw new _h(`The expression ${JSON.stringify(this.args[g].serialize())} evaluated to ${Nu(mu(et))} but was expected to be of type ${Nu(this.type)}.`)}return null}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}serialize(){const o=this.type,g=[o.kind];if(o.kind==="array"){const et=o.itemType;if(et.kind==="string"||et.kind==="number"||et.kind==="boolean"){g.push(et.kind);const nt=o.N;(typeof nt=="number"||this.args.length>1)&&g.push(nt)}}return g.concat(this.args.map(et=>et.serialize()))}}class i0{constructor(o){this.type=_0,this.sections=o}static parse(o,g){if(o.length<2)return g.error("Expected at least one argument.");const et=o[1];if(!Array.isArray(et)&&typeof et=="object")return g.error("First argument must be an image or text section.");const nt=[];let at=!1;for(let lt=1;lt<=o.length-1;++lt){const ft=o[lt];if(at&&typeof ft=="object"&&!Array.isArray(ft)){at=!1;let gt=null;if(ft["font-scale"]&&(gt=g.parseObjectValue(ft["font-scale"],lt,"font-scale",js),!gt))return null;let Rt=null;if(ft["text-font"]&&(Rt=g.parseObjectValue(ft["text-font"],lt,"text-font",Uu(No)),!Rt))return null;let Mt=null;if(ft["text-color"]&&(Mt=g.parseObjectValue(ft["text-color"],lt,"text-color",Po),!Mt))return null;const Lt=nt[nt.length-1];Lt.scale=gt,Lt.font=Rt,Lt.textColor=Mt}else{const gt=g.parse(o[lt],lt,yo);if(!gt)return null;const Rt=gt.type.kind;if(Rt!=="string"&&Rt!=="value"&&Rt!=="null"&&Rt!=="resolvedImage")return g.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");at=!0,nt.push({content:gt,scale:null,font:null,textColor:null})}}return new i0(nt)}evaluate(o){return new bp(this.sections.map(g=>{const et=g.content.evaluate(o);return Ix(mu(et),Qm)?new Pm("",et,null,null,null):new Pm(Vp(et),null,g.scale?g.scale.evaluate(o):null,g.font?g.font.evaluate(o).join(","):null,g.textColor?g.textColor.evaluate(o):null)}))}eachChild(o){for(const g of this.sections)o(g.content),g.scale&&o(g.scale),g.font&&o(g.font),g.textColor&&o(g.textColor)}outputDefined(){return!1}serialize(){const o=["format"];for(const g of this.sections){o.push(g.content.serialize());const et={};g.scale&&(et["font-scale"]=g.scale.serialize()),g.font&&(et["text-font"]=g.font.serialize()),g.textColor&&(et["text-color"]=g.textColor.serialize()),o.push(et)}return o}}class co{constructor(o,g,et,nt){this._imageWarnHistory={},this.type=Qm,this.namePrimary=o,this.nameSecondary=g,et&&(this.paramsPrimary=et.params,this.iconsetIdPrimary=et.iconset?et.iconset.id:void 0),nt&&(this.paramsSecondary=nt.params,this.iconsetIdSecondary=nt.iconset?nt.iconset.id:void 0)}static parse(o,g){if(o.length<2)return g.error("Expected two or more arguments.");let et=1;const nt=[];function at(){if(et<o.length){const ft=g.parse(o[et],et++,No);return ft?(nt.push({image:ft,options:{}}),!0):(g.error(nt.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function lt(){if(et<o.length){const gt=o[et];if((ft=gt)===null||typeof ft!="object"||Array.isArray(ft))return!0;const Rt=gt.params,Mt=gt.iconset,Lt=g.concat(et);if(!Rt&&!Mt)return et++,!0;if(Rt){if(typeof Rt!="object"||Rt.constructor!==Object)return Lt.error('Image options "params" should be an object'),!1;const Ht={},Kt=Lt.concat(void 0,"params");for(const Qt in Rt){if(!Qt)return Kt.error("Image parameter name should be non-empty"),!1;const sr=Kt.concat(void 0,Qt).parse(Rt[Qt],void 0,Po,void 0,{typeAnnotation:"coerce"});if(!sr)return!1;Ht[Qt]=sr}nt[nt.length-1].options.params=Ht}if(Mt){if(typeof Mt!="object"||Mt.constructor!==Object)return Lt.error('Image options "iconset" should be an object'),!1;if(!Mt.id)return Lt.error('Image options "iconset" should have an "id" property'),!1;nt[nt.length-1].options.iconset=Mt}return et++,!0}var ft;return!0}for(let ft=0;ft<2;ft++)if(!at()||!lt())return;return new co(nt[0].image,nt[1]?nt[1].image:void 0,nt[0].options,nt[1]?nt[1].options:void 0)}evaluateParams(o,g){const et={};if(g){for(const nt in g)if(g[nt])try{et[nt]=g[nt].evaluate(o)}catch{continue}if(Object.keys(et).length!==0)return{params:et}}}evaluate(o){const g={name:this.namePrimary.evaluate(o),iconsetId:this.iconsetIdPrimary},et=this.nameSecondary?{name:this.nameSecondary.evaluate(o),iconsetId:this.iconsetIdSecondary}:void 0,nt=wp.build(g,et,this.paramsPrimary?this.evaluateParams(o,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(o,this.paramsSecondary):void 0);if(nt&&o.availableImages){const at=nt.getPrimary().id;if(nt.available=o.availableImages.some(lt=>Qu.isEqual(lt,at)),nt.available){const lt=nt.getSecondary()?nt.getSecondary().id:null;lt&&(nt.available=o.availableImages.some(ft=>Qu.isEqual(ft,lt)))}}return nt}eachChild(o){if(o(this.namePrimary),this.paramsPrimary)for(const g in this.paramsPrimary)this.paramsPrimary[g]&&o(this.paramsPrimary[g]);if(this.nameSecondary&&(o(this.nameSecondary),this.paramsSecondary))for(const g in this.paramsSecondary)this.paramsSecondary[g]&&o(this.paramsSecondary[g])}outputDefined(){return!1}serializeOptions(o,g){const et={};if(g&&(et.iconset={id:g}),o){et.params={};for(const nt in o)o[nt]&&(et.params[nt]=o[nt].serialize())}return Object.keys(et).length>0?et:void 0}serialize(){const o=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const g=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);g&&o.push(g)}if(this.nameSecondary&&(o.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const g=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);g&&o.push(g)}return o}}function Us(b){return oo(b)?"string":nu(b)?"number":tm(b)?"boolean":Array.isArray(b)?"array":b===null?"null":km(b)?"object":typeof b}function km(b){return b!=null&&!Array.isArray(b)&&typeof b!="function"&&!(b instanceof String||b instanceof Number||b instanceof Boolean)&&typeof b=="object"}function oo(b){return typeof b=="string"||b instanceof String}function nu(b){return typeof b=="number"||b instanceof Number}function tm(b){return typeof b=="boolean"||b instanceof Boolean}const wr={"to-boolean":go,"to-color":Po,"to-number":js,"to-string":No};class it{constructor(o,g){this.type=o,this.args=g}static parse(o,g){if(o.length<2)return g.error("Expected at least one argument.");const et=o[0],nt=[];let at=vu;if(et==="to-array"){if(!Array.isArray(o[1]))return null;const lt=o[1].length;if(g.expectedType){if(g.expectedType.kind!=="array")return g.error(`Expected ${g.expectedType.kind} but found array.`);at=Uu(g.expectedType.itemType,lt)}else{if(!(lt>0&&P0(o[1][0])))return null;at=Uu(mu(o[1][0]),lt)}for(let ft=0;ft<lt;ft++){const gt=o[1][ft];let Rt;if(Array.isArray(gt))Rt=g.parse(gt,void 0,at.itemType);else{const Mt=Us(gt);if(Mt!==at.itemType.kind)return g.error(`Expected ${at.itemType.kind} but found ${Mt}.`);Rt=g.registry.literal.parse(["literal",gt===void 0?null:gt],g)}if(!Rt)return null;nt.push(Rt)}}else{if((et==="to-boolean"||et==="to-string")&&o.length!==2)return g.error("Expected one argument.");at=wr[et];for(let lt=1;lt<o.length;lt++){const ft=g.parse(o[lt],lt,yo);if(!ft)return null;nt.push(ft)}}return new it(at,nt)}evaluate(o){if(this.type.kind==="boolean")return!!this.args[0].evaluate(o);if(this.type.kind==="color"){let g,et;for(const nt of this.args){if(g=nt.evaluate(o),et=null,g instanceof Mo)return g;if(typeof g=="string"){const at=o.parseColor(g);if(at)return at}else if(Array.isArray(g)&&(et=g.length<3||g.length>4?`Invalid rbga value ${JSON.stringify(g)}: expected an array containing either three or four numeric values.`:Bp(g[0],g[1],g[2],g[3]),!et))return new Mo(g[0]/255,g[1]/255,g[2]/255,g[3])}throw new _h(et||`Could not parse color from value '${typeof g=="string"?g:String(JSON.stringify(g))}'`)}if(this.type.kind==="number"){let g=null;for(const et of this.args){if(g=et.evaluate(o),g===null)return 0;const nt=Number(g);if(!isNaN(nt))return nt}throw new _h(`Could not convert ${JSON.stringify(g)} to number.`)}return this.type.kind==="formatted"?bp.fromString(Vp(this.args[0].evaluate(o))):this.type.kind==="resolvedImage"?wp.build(Vp(this.args[0].evaluate(o))):this.type.kind==="array"?this.args.map(g=>g.evaluate(o)):Vp(this.args[0].evaluate(o))}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}serialize(){if(this.type.kind==="formatted")return new i0([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new co(this.args[0]).serialize();const o=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(g=>{o.push(g.serialize())}),o}}const ct=["Unknown","Point","LineString","Polygon"];class pt{constructor(o,g,et){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=o,this.options=g,this.iconImageUseTheme=et}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?ct[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(o){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const o=this.featureDistanceData.center,g=this.featureDistanceData.scale,{x:et,y:nt}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(et*g-o[0])+this.featureDistanceData.bearing[1]*(nt*g-o[1])}return 0}parseColor(o){let g=this._parseColorCache[o];return g||(g=this._parseColorCache[o]=Mo.parse(o)),g}getConfig(o){return this.options?this.options.get(o):null}}class Ct{constructor(o,g,et,nt,at){this.name=o,this.type=g,this._evaluate=et,this.args=nt,this._overloadIndex=at}evaluate(o){if(!this._evaluate){const g=Ct.definitions[this.name];this._evaluate=Array.isArray(g)?g[2]:g.overloads[this._overloadIndex][1]}return this._evaluate(o,this.args)}eachChild(o){this.args.forEach(o)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(o=>o.serialize()))}static parse(o,g){const et=o[0],nt=Ct.definitions[et];if(!nt)return g.error(`Unknown expression "${et}". If you wanted a literal array, use ["literal", [...]].`,0);const at=Array.isArray(nt)?nt[0]:nt.type,lt=Array.isArray(nt)?[[nt[1],nt[2]]]:nt.overloads,ft=[];let gt=null,Rt=-1;for(const[Mt,Lt]of lt){if(Array.isArray(Mt)&&Mt.length!==o.length-1)continue;ft.push(Mt),Rt++,gt=new uy(g.registry,g.path,null,g.scope,void 0,g._scope,g.options,g.iconImageUseTheme);const Ht=[];let Kt=!1;for(let Qt=1;Qt<o.length;Qt++){const sr=o[Qt],hr=Array.isArray(Mt)?Mt[Qt-1]:Mt.type,ur=gt.parse(sr,1+Ht.length,hr);if(!ur){Kt=!0;break}Ht.push(ur)}if(!Kt)if(Array.isArray(Mt)&&Mt.length!==Ht.length)gt.error(`Expected ${Mt.length} arguments, but found ${Ht.length} instead.`);else{for(let Qt=0;Qt<Ht.length;Qt++){const sr=Array.isArray(Mt)?Mt[Qt]:Mt.type,hr=Ht[Qt];gt.concat(Qt+1).checkSubtype(sr,hr.type)}if(gt.errors.length===0)return new Ct(et,at,Lt,Ht,Rt)}}if(ft.length===1)g.errors.push(...gt.errors);else{const Mt=(ft.length?ft:lt.map(([Ht])=>Ht)).map(It).join(" | "),Lt=[];for(let Ht=1;Ht<o.length;Ht++){const Kt=g.parse(o[Ht],1+Lt.length);if(!Kt)return null;Lt.push(Nu(Kt.type))}g.error(`Expected arguments of type ${Mt}, but found (${Lt.join(", ")}) instead.`)}return null}static register(o,g){Ct.definitions=g;for(const et in g)o[et]=Ct}}function It(b){return Array.isArray(b)?`(${b.map(Nu).join(", ")})`:`(${Nu(b.type)}...)`}class Dt{constructor(o,g,et){this.type=y0,this.locale=et,this.caseSensitive=o,this.diacriticSensitive=g}static parse(o,g){if(o.length!==2)return g.error("Expected one argument.");const et=o[1];if(typeof et!="object"||Array.isArray(et))return g.error("Collator options argument must be an object.");const nt=et["case-sensitive"]===void 0?g.parse(!1,1,go):g.parseObjectValue(et["case-sensitive"],1,"case-sensitive",go);if(!nt)return null;const at=et["diacritic-sensitive"]===void 0?g.parse(!1,1,go):g.parseObjectValue(et["diacritic-sensitive"],1,"diacritic-sensitive",go);if(!at)return null;let lt=null;return et.locale&&(lt=g.parseObjectValue(et.locale,1,"locale",No),!lt)?null:new Dt(nt,at,lt)}evaluate(o){return new U0(this.caseSensitive.evaluate(o),this.diacriticSensitive.evaluate(o),this.locale?this.locale.evaluate(o):null)}eachChild(o){o(this.caseSensitive),o(this.diacriticSensitive),this.locale&&o(this.locale)}outputDefined(){return!1}serialize(){const o={};return o["case-sensitive"]=this.caseSensitive.serialize(),o["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(o.locale=this.locale.serialize()),["collator",o]}}function qt(b,o,g=0,et=b.length-1,nt=ar){for(;et>g;){if(et-g>600){const gt=et-g+1,Rt=o-g+1,Mt=Math.log(gt),Lt=.5*Math.exp(2*Mt/3),Ht=.5*Math.sqrt(Mt*Lt*(gt-Lt)/gt)*(Rt-gt/2<0?-1:1);qt(b,o,Math.max(g,Math.floor(o-Rt*Lt/gt+Ht)),Math.min(et,Math.floor(o+(gt-Rt)*Lt/gt+Ht)),nt)}const at=b[o];let lt=g,ft=et;for(Jt(b,g,o),nt(b[et],at)>0&&Jt(b,g,et);lt<ft;){for(Jt(b,lt,ft),lt++,ft--;nt(b[lt],at)<0;)lt++;for(;nt(b[ft],at)>0;)ft--}nt(b[g],at)===0?Jt(b,g,ft):(ft++,Jt(b,ft,et)),ft<=o&&(g=ft+1),o<=ft&&(et=ft-1)}}function Jt(b,o,g){const et=b[o];b[o]=b[g],b[g]=et}function ar(b,o){return b<o?-1:b>o?1:0}function Er(b){let o=0;for(let g,et,nt=0,at=b.length,lt=at-1;nt<at;lt=nt++)g=b[nt],et=b[lt],o+=(et.x-g.x)*(g.y+et.y);return o}function Pr(b,o){b[0]=Math.min(b[0],o[0]),b[1]=Math.min(b[1],o[1]),b[2]=Math.max(b[2],o[0]),b[3]=Math.max(b[3],o[1])}function Gr(b,o){return!(b[0]<=o[0]||b[2]>=o[2]||b[1]<=o[1]||b[3]>=o[3])}function pn(b,o,g){const et=b[0]-o[0],nt=b[1]-o[1],at=b[0]-g[0],lt=b[1]-g[1];return et*lt-at*nt==0&&et*at<=0&&nt*lt<=0}function An(b,o,g=!1){let et=!1;for(let ft=0,gt=o.length;ft<gt;ft++){const Rt=o[ft];for(let Mt=0,Lt=Rt.length,Ht=Lt-1;Mt<Lt;Ht=Mt++){const Kt=Rt[Ht],Qt=Rt[Mt];if(pn(b,Kt,Qt))return g;(at=Kt)[1]>(nt=b)[1]!=(lt=Qt)[1]>nt[1]&&nt[0]<(lt[0]-at[0])*(nt[1]-at[1])/(lt[1]-at[1])+at[0]&&(et=!et)}}var nt,at,lt;return et}function Pn(b,o,g,et){const nt=et[0]-g[0],at=et[1]-g[1],lt=(b[0]-g[0])*at-nt*(b[1]-g[1]),ft=(o[0]-g[0])*at-nt*(o[1]-g[1]);return lt>0&&ft<0||lt<0&&ft>0}function Xn(b,o,g,et){return(nt=[et[0]-g[0],et[1]-g[1]])[0]*(at=[o[0]-b[0],o[1]-b[1]])[1]-nt[1]*at[0]!=0&&!(!Pn(b,o,g,et)||!Pn(g,et,b,o));var nt,at}function os(b){const o=new zn(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),g=new zn(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const et of b[0])o.x>et.x&&(o.x=et.x),o.y>et.y&&(o.y=et.y),g.x<et.x&&(g.x=et.x),g.y<et.y&&(g.y=et.y);return{min:o,max:g}}const Ks=8192;function Js(b,o){const g=(180+b[0])/360,et=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+b[1]*Math.PI/360)))/360,nt=Math.pow(2,o.z);return[Math.round(g*nt*Ks),Math.round(et*nt*Ks)]}function Hs(b,o){for(let g=0;g<o.length;g++)if(An(b,o[g]))return!0;return!1}function lu(b,o,g){for(const et of g)for(let nt=0,at=et.length,lt=at-1;nt<at;lt=nt++)if(Xn(b,o,et[lt],et[nt]))return!0;return!1}function zl(b,o){for(let g=0;g<b.length;++g)if(!An(b[g],o))return!1;for(let g=0;g<b.length-1;++g)if(lu(b[g],b[g+1],o))return!1;return!0}function kp(b,o){for(let g=0;g<o.length;g++)if(zl(b,o[g]))return!0;return!1}function Up(b,o,g){const et=[];for(let nt=0;nt<b.length;nt++){const at=[];for(let lt=0;lt<b[nt].length;lt++){const ft=Js(b[nt][lt],g);Pr(o,ft),at.push(ft)}et.push(at)}return et}function ap(b,o,g){const et=[];for(let nt=0;nt<b.length;nt++){const at=Up(b[nt],o,g);et.push(at)}return et}function Ou(b,o,g,et){if(b[0]<g[0]||b[0]>g[2]){const nt=.5*et;let at=b[0]-g[0]>nt?-et:g[0]-b[0]>nt?et:0;at===0&&(at=b[0]-g[2]>nt?-et:g[2]-b[0]>nt?et:0),b[0]+=at}Pr(o,b)}function mp(b,o,g,et){const nt=Math.pow(2,et.z)*Ks,at=[et.x*Ks,et.y*Ks],lt=[];if(!b)return lt;for(const ft of b)for(const gt of ft){const Rt=[gt.x+at[0],gt.y+at[1]];Ou(Rt,o,g,nt),lt.push(Rt)}return lt}function Cp(b,o,g,et){const nt=Math.pow(2,et.z)*Ks,at=[et.x*Ks,et.y*Ks],lt=[];if(!b)return lt;for(const gt of b){const Rt=[];for(const Mt of gt){const Lt=[Mt.x+at[0],Mt.y+at[1]];Pr(o,Lt),Rt.push(Lt)}lt.push(Rt)}if(o[2]-o[0]<=nt/2){(ft=o)[0]=ft[1]=1/0,ft[2]=ft[3]=-1/0;for(const gt of lt)for(const Rt of gt)Ou(Rt,o,g,nt)}var ft;return lt}class Gp{constructor(o,g){this.type=go,this.geojson=o,this.geometries=g}static parse(o,g){if(o.length!==2)return g.error(`'within' expression requires exactly one argument, but found ${o.length-1} instead.`);if(P0(o[1])){const et=o[1];if(et.type==="FeatureCollection")for(let nt=0;nt<et.features.length;++nt){const at=et.features[nt].geometry.type;if(at==="Polygon"||at==="MultiPolygon")return new Gp(et,et.features[nt].geometry)}else if(et.type==="Feature"){const nt=et.geometry.type;if(nt==="Polygon"||nt==="MultiPolygon")return new Gp(et,et.geometry)}else if(et.type==="Polygon"||et.type==="MultiPolygon")return new Gp(et,et)}return g.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(o){if(o.geometry()!=null&&o.canonicalID()!=null){if(o.geometryType()==="Point")return function(g,et){const nt=[1/0,1/0,-1/0,-1/0],at=[1/0,1/0,-1/0,-1/0],lt=g.canonicalID();if(!lt)return!1;if(et.type==="Polygon"){const ft=Up(et.coordinates,at,lt),gt=mp(g.geometry(),nt,at,lt);if(!Gr(nt,at))return!1;for(const Rt of gt)if(!An(Rt,ft))return!1}if(et.type==="MultiPolygon"){const ft=ap(et.coordinates,at,lt),gt=mp(g.geometry(),nt,at,lt);if(!Gr(nt,at))return!1;for(const Rt of gt)if(!Hs(Rt,ft))return!1}return!0}(o,this.geometries);if(o.geometryType()==="LineString")return function(g,et){const nt=[1/0,1/0,-1/0,-1/0],at=[1/0,1/0,-1/0,-1/0],lt=g.canonicalID();if(!lt)return!1;if(et.type==="Polygon"){const ft=Up(et.coordinates,at,lt),gt=Cp(g.geometry(),nt,at,lt);if(!Gr(nt,at))return!1;for(const Rt of gt)if(!zl(Rt,ft))return!1}if(et.type==="MultiPolygon"){const ft=ap(et.coordinates,at,lt),gt=Cp(g.geometry(),nt,at,lt);if(!Gr(nt,at))return!1;for(const Rt of gt)if(!kp(Rt,ft))return!1}return!0}(o,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const E0={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Zp=1/298.257223563,ty=Zp*(2-Zp),Dx=Math.PI/180;class Px{static fromTile(o,g,et){const nt=Math.PI*(1-2*(o+.5)/Math.pow(2,g)),at=Math.atan(.5*(Math.exp(nt)-Math.exp(-nt)))/Dx;return new Px(at,et)}static get units(){return E0}constructor(o,g){if(o===void 0)throw new Error("No latitude given.");if(g&&!E0[g])throw new Error(`Unknown unit ${g}. Use one of: ${Object.keys(E0).join(", ")}`);const et=6378.137*Dx*(g?E0[g]:1),nt=Math.cos(o*Dx),at=1/(1-ty*(1-nt*nt)),lt=Math.sqrt(at);this.kx=et*lt*nt,this.ky=et*lt*at*(1-ty)}distance(o,g){const et=s0(o[0]-g[0])*this.kx,nt=(o[1]-g[1])*this.ky;return Math.sqrt(et*et+nt*nt)}bearing(o,g){const et=s0(g[0]-o[0])*this.kx;return Math.atan2(et,(g[1]-o[1])*this.ky)/Dx}destination(o,g,et){const nt=et*Dx;return this.offset(o,Math.sin(nt)*g,Math.cos(nt)*g)}offset(o,g,et){return[o[0]+g/this.kx,o[1]+et/this.ky]}lineDistance(o){let g=0;for(let et=0;et<o.length-1;et++)g+=this.distance(o[et],o[et+1]);return g}area(o){let g=0;for(let et=0;et<o.length;et++){const nt=o[et];for(let at=0,lt=nt.length,ft=lt-1;at<lt;ft=at++)g+=s0(nt[at][0]-nt[ft][0])*(nt[at][1]+nt[ft][1])*(et?-1:1)}return Math.abs(g)/2*this.kx*this.ky}along(o,g){let et=0;if(g<=0)return o[0];for(let nt=0;nt<o.length-1;nt++){const at=o[nt],lt=o[nt+1],ft=this.distance(at,lt);if(et+=ft,et>g)return ry(at,lt,(g-(et-ft))/ft)}return o[o.length-1]}pointToSegmentDistance(o,g,et){let[nt,at]=g,lt=s0(et[0]-nt)*this.kx,ft=(et[1]-at)*this.ky;if(lt!==0||ft!==0){const gt=(s0(o[0]-nt)*this.kx*lt+(o[1]-at)*this.ky*ft)/(lt*lt+ft*ft);gt>1?(nt=et[0],at=et[1]):gt>0&&(nt+=lt/this.kx*gt,at+=ft/this.ky*gt)}return lt=s0(o[0]-nt)*this.kx,ft=(o[1]-at)*this.ky,Math.sqrt(lt*lt+ft*ft)}pointOnLine(o,g){let et=1/0,nt=o[0][0],at=o[0][1],lt=0,ft=0;for(let gt=0;gt<o.length-1;gt++){let Rt=o[gt][0],Mt=o[gt][1],Lt=s0(o[gt+1][0]-Rt)*this.kx,Ht=(o[gt+1][1]-Mt)*this.ky,Kt=0;Lt===0&&Ht===0||(Kt=(s0(g[0]-Rt)*this.kx*Lt+(g[1]-Mt)*this.ky*Ht)/(Lt*Lt+Ht*Ht),Kt>1?(Rt=o[gt+1][0],Mt=o[gt+1][1]):Kt>0&&(Rt+=Lt/this.kx*Kt,Mt+=Ht/this.ky*Kt)),Lt=s0(g[0]-Rt)*this.kx,Ht=(g[1]-Mt)*this.ky;const Qt=Lt*Lt+Ht*Ht;Qt<et&&(et=Qt,nt=Rt,at=Mt,lt=gt,ft=Kt)}return{point:[nt,at],index:lt,t:Math.max(0,Math.min(1,ft))}}lineSlice(o,g,et){let nt=this.pointOnLine(et,o),at=this.pointOnLine(et,g);if(nt.index>at.index||nt.index===at.index&&nt.t>at.t){const Rt=nt;nt=at,at=Rt}const lt=[nt.point],ft=nt.index+1,gt=at.index;!P_(et[ft],lt[0])&&ft<=gt&&lt.push(et[ft]);for(let Rt=ft+1;Rt<=gt;Rt++)lt.push(et[Rt]);return P_(et[gt],at.point)||lt.push(at.point),lt}lineSliceAlong(o,g,et){let nt=0;const at=[];for(let lt=0;lt<et.length-1;lt++){const ft=et[lt],gt=et[lt+1],Rt=this.distance(ft,gt);if(nt+=Rt,nt>o&&at.length===0&&at.push(ry(ft,gt,(o-(nt-Rt))/Rt)),nt>=g)return at.push(ry(ft,gt,(g-(nt-Rt))/Rt)),at;nt>o&&at.push(gt)}return at}bufferPoint(o,g){const et=g/this.ky,nt=g/this.kx;return[o[0]-nt,o[1]-et,o[0]+nt,o[1]+et]}bufferBBox(o,g){const et=g/this.ky,nt=g/this.kx;return[o[0]-nt,o[1]-et,o[2]+nt,o[3]+et]}insideBBox(o,g){return s0(o[0]-g[0])>=0&&s0(o[0]-g[2])<=0&&o[1]>=g[1]&&o[1]<=g[3]}}function P_(b,o){return b[0]===o[0]&&b[1]===o[1]}function ry(b,o,g){const et=s0(o[0]-b[0]);return[b[0]+et*g,b[1]+(o[1]-b[1])*g]}function s0(b){for(;b<-180;)b+=360;for(;b>180;)b-=360;return b}class ny{constructor(o=[],g=(et,nt)=>et<nt?-1:et>nt?1:0){if(this.data=o,this.length=this.data.length,this.compare=g,this.length>0)for(let et=(this.length>>1)-1;et>=0;et--)this._down(et)}push(o){this.data.push(o),this._up(this.length++)}pop(){if(this.length===0)return;const o=this.data[0],g=this.data.pop();return--this.length>0&&(this.data[0]=g,this._down(0)),o}peek(){return this.data[0]}_up(o){const{data:g,compare:et}=this,nt=g[o];for(;o>0;){const at=o-1>>1,lt=g[at];if(et(nt,lt)>=0)break;g[o]=lt,o=at}g[o]=nt}_down(o){const{data:g,compare:et}=this,nt=this.length>>1,at=g[o];for(;o<nt;){let lt=1+(o<<1);const ft=lt+1;if(ft<this.length&&et(g[ft],g[lt])<0&&(lt=ft),et(g[lt],at)>=0)break;g[o]=g[lt],o=lt}g[o]=at}}var ss=8192;function k_(b,o){return o.dist-b.dist}const iy=100,sy=50;function F_(b){const o=[1/0,1/0,-1/0,-1/0];if(o.length!==b.length)return!1;for(let g=0;g<o.length;g++)if(o[g]!==b[g])return!1;return!0}function h1(b){return b[1]-b[0]+1}function G0(b,o){const g=b[1]>=b[0]&&b[1]<o;return g||console.warn("Distance Expression: Index is out of range"),g}function B_(b,o){if(b[0]>b[1])return[null,null];const g=h1(b);if(o){if(g===2)return[b,null];const et=Math.floor(g/2);return[[b[0],b[0]+et],[b[0]+et,b[1]]]}{if(g===1)return[b,null];const et=Math.floor(g/2)-1;return[[b[0],b[0]+et],[b[0]+et+1,b[1]]]}}function ex(b,o){const g=[1/0,1/0,-1/0,-1/0];if(!G0(o,b.length))return g;for(let et=o[0];et<=o[1];++et)Pr(g,b[et]);return g}function tx(b){const o=[1/0,1/0,-1/0,-1/0];for(let g=0;g<b.length;++g)for(let et=0;et<b[g].length;++et)Pr(o,b[g][et]);return o}function Fm(b,o,g){if(F_(b)||F_(o))return NaN;let et=0,nt=0;return b[2]<o[0]&&(et=o[0]-b[2]),b[0]>o[2]&&(et=b[0]-o[2]),b[1]>o[3]&&(nt=b[1]-o[3]),b[3]<o[1]&&(nt=o[1]-b[3]),g.distance([0,0],[et,nt])}function oy(b){return 360*b-180}function xE(b){return 360/Math.PI*Math.atan(Math.exp((180-360*b)*Math.PI/180))-90}function ay(b,o){const g=Math.pow(2,o.z),et=(b.y/ss+o.y)/g;return[oy((b.x/ss+o.x)/g),xE(et)]}function r2(b,o){const g=[];for(let et=0;et<b.length;++et)g.push(ay(b[et],o));return g}function gE(b,o,g){const et=g.pointOnLine(o,b).point;return g.distance(b,et)}function M_(b,o,g,et,nt){const at=g.slice(et[0],et[1]+1);let lt=1/0;for(let ft=o[0];ft<=o[1];++ft)if((lt=Math.min(lt,gE(b[ft],at,nt)))===0)return 0;return lt}function Bm(b,o,g,et,nt){const at=Math.min(nt.pointToSegmentDistance(b,g,et),nt.pointToSegmentDistance(o,g,et)),lt=Math.min(nt.pointToSegmentDistance(g,b,o),nt.pointToSegmentDistance(et,b,o));return Math.min(at,lt)}function ba(b,o,g,et,nt){if(!G0(o,b.length)||!G0(et,g.length))return NaN;let at=1/0;for(let lt=o[0];lt<o[1];++lt)for(let ft=et[0];ft<et[1];++ft){if(Xn(b[lt],b[lt+1],g[ft],g[ft+1]))return 0;at=Math.min(at,Bm(b[lt],b[lt+1],g[ft],g[ft+1],nt))}return at}function n2(b,o,g,et,nt){if(!G0(o,b.length)||!G0(et,g.length))return NaN;let at=1/0;for(let lt=o[0];lt<=o[1];++lt)for(let ft=et[0];ft<=et[1];++ft)if((at=Math.min(at,nt.distance(b[lt],g[ft])))===0)return at;return at}function i2(b,o,g){if(An(b,o,!0))return 0;let et=1/0;for(const nt of o){const at=nt.length;if(at<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(nt[0]!==nt[at-1]&&(et=Math.min(et,g.pointToSegmentDistance(b,nt[at-1],nt[0])))===0||(et=Math.min(et,gE(b,nt,g)))===0)return et}return et}function s2(b,o,g,et){if(!G0(o,b.length))return NaN;for(let at=o[0];at<=o[1];++at)if(An(b[at],g,!0))return 0;let nt=1/0;for(let at=o[0];at<o[1];++at)for(const lt of g)for(let ft=0,gt=lt.length,Rt=gt-1;ft<gt;Rt=ft++){if(Xn(b[at],b[at+1],lt[Rt],lt[ft]))return 0;nt=Math.min(nt,Bm(b[at],b[at+1],lt[Rt],lt[ft],et))}return nt}function N_(b,o){for(const g of b)for(let et=0;et<=g.length-1;++et)if(An(g[et],o,!0))return!0;return!1}function o2(b,o,g,et=1/0){const nt=tx(b),at=tx(o);if(et!==1/0&&Fm(nt,at,g)>=et)return et;if(Gr(nt,at)){if(N_(b,o))return 0}else if(N_(o,b))return 0;let lt=et;for(const ft of b)for(let gt=0,Rt=ft.length,Mt=Rt-1;gt<Rt;Mt=gt++)for(const Lt of o)for(let Ht=0,Kt=Lt.length,Qt=Kt-1;Ht<Kt;Qt=Ht++){if(Xn(ft[Mt],ft[gt],Lt[Qt],Lt[Ht]))return 0;lt=Math.min(lt,Bm(ft[Mt],ft[gt],Lt[Qt],Lt[Ht],g))}return lt}function xu(b,o,g,et,nt,at,lt){if(at===null||lt===null)return;const ft=Fm(ex(et,at),ex(nt,lt),g);ft<o&&b.push({dist:ft,range1:at,range2:lt})}function a2(b,o,g,et,nt=1/0){let at=Math.min(et.distance(b[0],g[0][0]),nt);if(at===0)return at;const lt=new ny([{dist:0,range1:[0,b.length-1],range2:[0,0]}],k_),ft=o?sy:iy,gt=tx(g);for(;lt.length;){const Rt=lt.pop();if(Rt.dist>=at)continue;const Mt=Rt.range1;if(h1(Mt)<=ft){if(!G0(Mt,b.length))return NaN;if(o){const Lt=s2(b,Mt,g,et);if((at=Math.min(at,Lt))===0)return at}else for(let Lt=Mt[0];Lt<=Mt[1];++Lt){const Ht=i2(b[Lt],g,et);if((at=Math.min(at,Ht))===0)return at}}else{const Lt=B_(Mt,o);if(Lt[0]!==null){const Ht=Fm(ex(b,Lt[0]),gt,et);Ht<at&&lt.push({dist:Ht,range1:Lt[0],range2:[0,0]})}if(Lt[1]!==null){const Ht=Fm(ex(b,Lt[1]),gt,et);Ht<at&&lt.push({dist:Ht,range1:Lt[1],range2:[0,0]})}}}return at}function yE(b,o,g,et,nt,at=1/0){let lt=Math.min(at,nt.distance(b[0],g[0]));if(lt===0)return lt;const ft=new ny([{dist:0,range1:[0,b.length-1],range2:[0,g.length-1]}],k_),gt=o?sy:iy,Rt=et?sy:iy;for(;ft.length;){const Mt=ft.pop();if(Mt.dist>=lt)continue;const Lt=Mt.range1,Ht=Mt.range2;if(h1(Lt)<=gt&&h1(Ht)<=Rt){if(!G0(Lt,b.length)||!G0(Ht,g.length))return NaN;if(o&&et?lt=Math.min(lt,ba(b,Lt,g,Ht,nt)):o||et?o&&!et?lt=Math.min(lt,M_(g,Ht,b,Lt,nt)):!o&&et&&(lt=Math.min(lt,M_(b,Lt,g,Ht,nt))):lt=Math.min(lt,n2(b,Lt,g,Ht,nt)),lt===0)return lt}else{const Kt=B_(Lt,o),Qt=B_(Ht,et);xu(ft,lt,nt,b,g,Kt[0],Qt[0]),xu(ft,lt,nt,b,g,Kt[0],Qt[1]),xu(ft,lt,nt,b,g,Kt[1],Qt[0]),xu(ft,lt,nt,b,g,Kt[1],Qt[1])}}return lt}function O_(b,o,g,et,nt=1/0){let at=nt;const lt=ex(b,[0,b.length-1]);for(const ft of g)if(!(at!==1/0&&Fm(lt,ex(ft,[0,ft.length-1]),et)>=at)&&(at=Math.min(at,yE(b,o,ft,!0,et,at)),at===0))return at;return at}function ly(b,o,g,et,nt=1/0){let at=nt;const lt=ex(b,[0,b.length-1]);for(const ft of g){if(at!==1/0&&Fm(lt,tx(ft),et)>=at)continue;const gt=a2(b,o,ft,et,at);if(isNaN(gt))return gt;if((at=Math.min(at,gt))===0)return at}return at}function L_(b){return b==="Point"||b==="MultiPoint"||b==="LineString"||b==="MultiLineString"||b==="Polygon"||b==="MultiPolygon"}class rx{constructor(o,g){this.type=js,this.geojson=o,this.geometries=g}static parse(o,g){if(o.length!==2)return g.error(`'distance' expression requires either one argument, but found ' ${o.length-1} instead.`);if(P0(o[1])){const et=o[1];if(et.type==="FeatureCollection"){for(let nt=0;nt<et.features.length;++nt)if(L_(et.features[nt].geometry.type))return new rx(et,et.features[nt].geometry)}else if(et.type==="Feature"){if(L_(et.geometry.type))return new rx(et,et.geometry)}else if(L_(et.type))return new rx(et,et)}return g.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(o){const g=o.geometry(),et=o.canonicalID();if(g!=null&&et!=null){if(o.geometryType()==="Point")return function(nt,at,lt){const ft=[];for(const Rt of nt)for(const Mt of Rt)ft.push(ay(Mt,at));const gt=new Px(ft[0][1],"meters");return lt.type==="Point"||lt.type==="MultiPoint"||lt.type==="LineString"?yE(ft,!1,lt.type==="Point"?[lt.coordinates]:lt.coordinates,lt.type==="LineString",gt):lt.type==="MultiLineString"?O_(ft,!1,lt.coordinates,gt):lt.type==="Polygon"||lt.type==="MultiPolygon"?ly(ft,!1,lt.type==="Polygon"?[lt.coordinates]:lt.coordinates,gt):null}(g,et,this.geometries);if(o.geometryType()==="LineString")return function(nt,at,lt){const ft=[];for(const Rt of nt){const Mt=[];for(const Lt of Rt)Mt.push(ay(Lt,at));ft.push(Mt)}const gt=new Px(ft[0][0][1],"meters");if(lt.type==="Point"||lt.type==="MultiPoint"||lt.type==="LineString")return O_(lt.type==="Point"?[lt.coordinates]:lt.coordinates,lt.type==="LineString",ft,gt);if(lt.type==="MultiLineString"){let Rt=1/0;for(let Mt=0;Mt<lt.coordinates.length;Mt++){const Lt=O_(lt.coordinates[Mt],!0,ft,gt,Rt);if(isNaN(Lt))return Lt;if((Rt=Math.min(Rt,Lt))===0)return Rt}return Rt}if(lt.type==="Polygon"||lt.type==="MultiPolygon"){let Rt=1/0;for(let Mt=0;Mt<ft.length;Mt++){const Lt=ly(ft[Mt],!0,lt.type==="Polygon"?[lt.coordinates]:lt.coordinates,gt,Rt);if(isNaN(Lt))return Lt;if((Rt=Math.min(Rt,Lt))===0)return Rt}return Rt}return null}(g,et,this.geometries);if(o.geometryType()==="Polygon")return function(nt,at,lt){const ft=[];for(const Rt of function(Mt,Lt){const Ht=Mt.length;if(Ht<=1)return[Mt];const Kt=[];let Qt,sr;for(let hr=0;hr<Ht;hr++){const ur=Er(Mt[hr]);ur!==0&&(Mt[hr].area=Math.abs(ur),sr===void 0&&(sr=ur<0),sr===ur<0?(Qt&&Kt.push(Qt),Qt=[Mt[hr]]):Qt.push(Mt[hr]))}return Qt&&Kt.push(Qt),Kt}(nt)){const Mt=[];for(let Lt=0;Lt<Rt.length;++Lt)Mt.push(r2(Rt[Lt],at));ft.push(Mt)}const gt=new Px(ft[0][0][0][1],"meters");if(lt.type==="Point"||lt.type==="MultiPoint"||lt.type==="LineString")return ly(lt.type==="Point"?[lt.coordinates]:lt.coordinates,lt.type==="LineString",ft,gt);if(lt.type==="MultiLineString"){let Rt=1/0;for(let Mt=0;Mt<lt.coordinates.length;Mt++){const Lt=ly(lt.coordinates[Mt],!0,ft,gt,Rt);if(isNaN(Lt))return Lt;if((Rt=Math.min(Rt,Lt))===0)return Rt}return Rt}return lt.type==="Polygon"||lt.type==="MultiPolygon"?function(Rt,Mt,Lt){let Ht=1/0;for(const Kt of Rt)for(const Qt of Mt){const sr=o2(Kt,Qt,Lt,Ht);if(isNaN(sr))return sr;if((Ht=Math.min(Ht,sr))===0)return Ht}return Ht}(lt.type==="Polygon"?[lt.coordinates]:lt.coordinates,ft,gt):null}(g,et,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function kx(b){if(b instanceof Ct&&(b.name==="get"&&b.args.length===1||b.name==="feature-state"||b.name==="has"&&b.args.length===1||b.name==="properties"||b.name==="geometry-type"||b.name==="id"||/^filter-/.test(b.name))||b instanceof Gp||b instanceof rx)return!1;if(b instanceof Bx)return b.featureConstant;let o=!0;return b.eachChild(g=>{o&&!kx(g)&&(o=!1)}),o}function f1(b){if(b instanceof Ct&&b.name==="feature-state")return!1;let o=!0;return b.eachChild(g=>{o&&!f1(g)&&(o=!1)}),o}function Fx(b,o){if(b instanceof Ct&&o.indexOf(b.name)>=0)return!1;let g=!0;return b.eachChild(et=>{g&&!Fx(et,o)&&(g=!1)}),g}function _E(b,o,g){return[b,o,g].filter(Boolean).join("")}function j_(b,o){switch(b){case"string":return Vp(o);case"number":return+o;case"boolean":return!!o;case"color":return Mo.parse(o);case"formatted":return bp.fromString(Vp(o));case"resolvedImage":return wp.build(Vp(o))}return o}function vE(b,o,g,et){return et!==void 0&&(b=et*Math.round(b/et)),o!==void 0&&b<o&&(b=o),g!==void 0&&b>g&&(b=g),b}class Bx{constructor(o,g,et,nt=!1){this.type=o,this.key=g,this.scope=et,this.featureConstant=nt}static parse(o,g){let et=g.expectedType;if(et==null&&(et=yo),o.length<2||o.length>3)return g.error("Invalid number of arguments for 'config' expression.");const nt=g.parse(o[1],1);if(!(nt instanceof pp))return g.error("Key name of 'config' expression must be a string literal.");let at,lt=!0;const ft=Vp(nt.value);if(o.length>=3){const gt=g.parse(o[2],2);if(!(gt instanceof pp))return g.error("Scope of 'config' expression must be a string literal.");at=Vp(gt.value)}if(g.options){const gt=_E(ft,at,g._scope),Rt=g.options.get(gt);Rt&&(lt=kx(Rt.value||Rt.default))}return new Bx(et,ft,at,lt)}evaluate(o){const g=_E(this.key,this.scope,o.scope),et=o.getConfig(g);if(!et)return null;const{type:nt,value:at,values:lt,minValue:ft,maxValue:gt,stepValue:Rt}=et,Mt=et.default.evaluate(o);let Lt=Mt;if(at){const Ht=o.scope;o.scope=(Ht||"").split("").slice(1).join(""),Lt=at.evaluate(o),o.scope=Ht}return nt&&(Lt=j_(nt,Lt)),Lt===void 0||ft===void 0&&gt===void 0&&Rt===void 0||(typeof Lt=="number"?Lt=vE(Lt,ft,gt,Rt):Array.isArray(Lt)&&(Lt=Lt.map(Ht=>typeof Ht=="number"?vE(Ht,ft,gt,Rt):Ht))),at!==void 0&&Lt!==void 0&&lt&&!lt.includes(Lt)&&(Lt=Mt,nt&&(Lt=j_(nt,Lt))),(nt&&nt!==this.type||Lt!==void 0&&!Ix(mu(Lt),this.type))&&(Lt=j_(this.type.kind,Lt)),Lt}eachChild(){}outputDefined(){return!1}serialize(){const o=["config",this.key];return this.scope&&o.concat(this.scope),o}}class cy{constructor(o,g){this.type=g.type,this.name=o,this.boundExpression=g}static parse(o,g){if(o.length!==2||typeof o[1]!="string")return g.error("'var' expression requires exactly one string literal argument.");const et=o[1];return g.scope.has(et)?new cy(et,g.scope.get(et)):g.error(`Unknown variable "${et}". Make sure "${et}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(o){return this.boundExpression.evaluate(o)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class uy{constructor(o,g=[],et,nt=new V0,at=[],lt,ft,gt){this.registry=o,this.path=g,this.key=g.map(Rt=>typeof Rt=="string"?`['${Rt}']`:`[${Rt}]`).join(""),this.scope=nt,this.errors=at,this.expectedType=et,this._scope=lt,this.options=ft,this.iconImageUseTheme=gt}parse(o,g,et,nt,at={}){return g||et?this.concat(g,null,et,nt)._parse(o,at):this._parse(o,at)}parseObjectValue(o,g,et,nt,at,lt={}){return this.concat(g,et,nt,at)._parse(o,lt)}_parse(o,g){function et(nt,at,lt){return lt==="assert"?new n0(at,[nt]):lt==="coerce"?new it(at,[nt]):nt}if(o!==null&&typeof o!="string"&&typeof o!="boolean"&&typeof o!="number"||(o=["literal",o]),Array.isArray(o)){if(o.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const nt=typeof o[0]=="string"?this.registry[o[0]]:void 0;if(nt){let at=nt.parse(o,this);if(!at)return null;if(this.expectedType){const lt=this.expectedType,ft=at.type;if(lt.kind!=="string"&&lt.kind!=="number"&&lt.kind!=="boolean"&&lt.kind!=="object"&&lt.kind!=="array"||ft.kind!=="value")if(lt.kind!=="color"&&lt.kind!=="formatted"&&lt.kind!=="resolvedImage"||ft.kind!=="value"&&ft.kind!=="string"){if(this.checkSubtype(lt,ft))return null}else at=et(at,lt,g.typeAnnotation||"coerce");else at=et(at,lt,g.typeAnnotation||"assert")}if(!(at instanceof pp)&&at.type.kind!=="resolvedImage"&&z_(at)){const lt=new pt(this._scope,this.options,this.iconImageUseTheme);try{at=new pp(at.type,at.evaluate(lt))}catch(ft){return this.error(ft.message),null}}return at}return it.parse(["to-array",o],this)}return this.error(o===void 0?"'undefined' value invalid. Use null instead.":typeof o=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof o} instead.`)}concat(o,g,et,nt){let at=typeof o=="number"?this.path.concat(o):this.path;at=typeof g=="string"?at.concat(g):at;const lt=nt?this.scope.concat(nt):this.scope;return new uy(this.registry,at,et||null,lt,this.errors,this._scope,this.options,this.iconImageUseTheme)}error(o,...g){const et=`${this.key}${g.map(nt=>`[${nt}]`).join("")}`;this.errors.push(new ku(et,o))}checkSubtype(o,g){const et=v0(o,g);return et&&this.error(et),et}}function z_(b){if(b instanceof cy)return z_(b.boundExpression);if(b instanceof Ct&&b.name==="error"||b instanceof Dt||b instanceof Gp||b instanceof rx||b instanceof Bx)return!1;const o=b instanceof it||b instanceof n0;let g=!0;return b.eachChild(et=>{g=o?g&&z_(et):g&&et instanceof pp}),!!g&&kx(b)&&Fx(b,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function dy(b,o){const g=b.length-1;let et,nt,at=0,lt=g,ft=0;for(;at<=lt;)if(ft=Math.floor((at+lt)/2),et=b[ft],nt=b[ft+1],et<=o){if(ft===g||o<nt)return ft;at=ft+1}else{if(!(et>o))throw new _h("Input is not a number.");lt=ft-1}return 0}class p1{constructor(o,g,et){this.type=o,this.input=g,this.labels=[],this.outputs=[];for(const[nt,at]of et)this.labels.push(nt),this.outputs.push(at)}static parse(o,g){if(o.length-1<4)return g.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if((o.length-1)%2!=0)return g.error("Expected an even number of arguments.");const et=g.parse(o[1],1,js);if(!et)return null;const nt=[];let at=null;g.expectedType&&g.expectedType.kind!=="value"&&(at=g.expectedType);for(let lt=1;lt<o.length;lt+=2){const ft=lt===1?-1/0:o[lt],gt=o[lt+1],Rt=lt,Mt=lt+1;if(typeof ft!="number")return g.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',Rt);if(nt.length&&nt[nt.length-1][0]>=ft)return g.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',Rt);const Lt=g.parse(gt,Mt,at);if(!Lt)return null;at=at||Lt.type,nt.push([ft,Lt])}return new p1(at,et,nt)}evaluate(o){const g=this.labels,et=this.outputs;if(g.length===1)return et[0].evaluate(o);const nt=this.input.evaluate(o);if(nt<=g[0])return et[0].evaluate(o);const at=g.length;return nt>=g[at-1]?et[at-1].evaluate(o):et[dy(g,nt)].evaluate(o)}eachChild(o){o(this.input);for(const g of this.outputs)o(g)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}serialize(){const o=["step",this.input.serialize()];for(let g=0;g<this.labels.length;g++)g>0&&o.push(this.labels[g]),o.push(this.outputs[g].serialize());return o}}const EE=.95047,bE=1.08883,wE=4/29,Mx=6/29,CE=3*Mx*Mx,l2=Mx*Mx*Mx,c2=Math.PI/180,u2=180/Math.PI;function V_(b){return b>l2?Math.pow(b,1/3):b/CE+wE}function U_(b){return b>Mx?b*b*b:CE*(b-wE)}function G_(b){return 255*(b<=.0031308?12.92*b:1.055*Math.pow(b,1/2.4)-.055)}function $_(b){return(b/=255)<=.04045?b/12.92:Math.pow((b+.055)/1.055,2.4)}function AE(b){const o=$_(b.r),g=$_(b.g),et=$_(b.b),nt=V_((.4124564*o+.3575761*g+.1804375*et)/EE),at=V_((.2126729*o+.7151522*g+.072175*et)/1);return{l:116*at-16,a:500*(nt-at),b:200*(at-V_((.0193339*o+.119192*g+.9503041*et)/bE)),alpha:b.a}}function hy(b){let o=(b.l+16)/116,g=isNaN(b.a)?o:o+b.a/500,et=isNaN(b.b)?o:o-b.b/200;return o=1*U_(o),g=EE*U_(g),et=bE*U_(et),new Mo(G_(3.2404542*g-1.5371385*o-.4985314*et),G_(-.969266*g+1.8760108*o+.041556*et),G_(.0556434*g-.2040259*o+1.0572252*et),b.alpha)}function fy(b,o,g){const et=o-b;return b+g*(et>180||et<-180?et-360*Math.round(et/360):et)}const Nx={forward:AE,reverse:hy,interpolate:function(b,o,g){return{l:so(b.l,o.l,g),a:so(b.a,o.a,g),b:so(b.b,o.b,g),alpha:so(b.alpha,o.alpha,g)}}},m1={forward:function(b){const{l:o,a:g,b:et}=AE(b),nt=Math.atan2(et,g)*u2;return{h:nt<0?nt+360:nt,c:Math.sqrt(g*g+et*et),l:o,alpha:b.a}},reverse:function(b){const o=b.h*c2,g=b.c;return hy({l:b.l,a:Math.cos(o)*g,b:Math.sin(o)*g,alpha:b.alpha})},interpolate:function(b,o,g){return{h:fy(b.h,o.h,g),c:so(b.c,o.c,g),l:so(b.l,o.l,g),alpha:so(b.alpha,o.alpha,g)}}};var SE=Object.freeze({__proto__:null,hcl:m1,lab:Nx});class o0{constructor(o,g,et,nt,at){this.type=o,this.operator=g,this.interpolation=et,this.input=nt,this.labels=[],this.outputs=[];for(const[lt,ft]of at)this.labels.push(lt),this.outputs.push(ft)}static interpolationFactor(o,g,et,nt){let at=0;if(o.name==="exponential")at=py(g,o.base,et,nt);else if(o.name==="linear")at=py(g,1,et,nt);else if(o.name==="cubic-bezier"){const lt=o.controlPoints;at=new Ku(lt[0],lt[1],lt[2],lt[3]).solve(py(g,1,et,nt))}return at}static parse(o,g){let[et,nt,at,...lt]=o;if(!Array.isArray(nt)||nt.length===0)return g.error("Expected an interpolation type expression.",1);if(nt[0]==="linear")nt={name:"linear"};else if(nt[0]==="exponential"){const Rt=nt[1];if(typeof Rt!="number")return g.error("Exponential interpolation requires a numeric base.",1,1);nt={name:"exponential",base:Rt}}else{if(nt[0]!=="cubic-bezier")return g.error(`Unknown interpolation type ${String(nt[0])}`,1,0);{const Rt=nt.slice(1);if(Rt.length!==4||Rt.some(Mt=>typeof Mt!="number"||Mt<0||Mt>1))return g.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);nt={name:"cubic-bezier",controlPoints:Rt}}}if(o.length-1<4)return g.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if(o.length-1>3&&(o.length-1)%2!=0)return g.error("Expected an even number of arguments.");if(at=g.parse(at,2,js),!at)return null;const ft=[];let gt=null;et==="interpolate-hcl"||et==="interpolate-lab"?gt=Po:g.expectedType&&g.expectedType.kind!=="value"&&(gt=g.expectedType);for(let Rt=0;Rt<lt.length;Rt+=2){const Mt=lt[Rt],Lt=lt[Rt+1],Ht=Rt+3,Kt=Rt+4;if(typeof Mt!="number")return g.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',Ht);if(ft.length&&ft[ft.length-1][0]>=Mt)return g.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',Ht);const Qt=g.parse(Lt,Kt,gt);if(!Qt)return null;gt=gt||Qt.type,ft.push([Mt,Qt])}return gt.kind==="number"||gt.kind==="color"||gt.kind==="array"&&gt.itemType.kind==="number"&&typeof gt.N=="number"?new o0(gt,et,nt,at,ft):g.error(`Type ${Nu(gt)} is not interpolatable.`)}evaluate(o){const g=this.labels,et=this.outputs;if(g.length===1)return et[0].evaluate(o);const nt=this.input.evaluate(o);if(nt<=g[0])return et[0].evaluate(o);const at=g.length;if(nt>=g[at-1])return et[at-1].evaluate(o);const lt=dy(g,nt),ft=o0.interpolationFactor(this.interpolation,nt,g[lt],g[lt+1]),gt=et[lt].evaluate(o),Rt=et[lt+1].evaluate(o);return this.operator==="interpolate"?em[this.type.kind.toLowerCase()](gt,Rt,ft):this.operator==="interpolate-hcl"?m1.reverse(m1.interpolate(m1.forward(gt),m1.forward(Rt),ft)):Nx.reverse(Nx.interpolate(Nx.forward(gt),Nx.forward(Rt),ft))}eachChild(o){o(this.input);for(const g of this.outputs)o(g)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}serialize(){let o;o=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const g=[this.operator,o,this.input.serialize()];for(let et=0;et<this.labels.length;et++)g.push(this.labels[et],this.outputs[et].serialize());return g}}function py(b,o,g,et){const nt=et-g,at=b-g;return nt===0?0:o===1?at/nt:(Math.pow(o,at)-1)/(Math.pow(o,nt)-1)}class x1{constructor(o,g){this.type=o,this.args=g}static parse(o,g){if(o.length<2)return g.error("Expectected at least one argument.");let et=null;const nt=g.expectedType;nt&&nt.kind!=="value"&&(et=nt);const at=[];for(const ft of o.slice(1)){const gt=g.parse(ft,1+at.length,et,void 0,{typeAnnotation:"omit"});if(!gt)return null;et=et||gt.type,at.push(gt)}const lt=nt&&at.some(ft=>v0(nt,ft.type));return new x1(lt?yo:et,at)}evaluate(o){let g,et=null,nt=0;for(const at of this.args){if(nt++,et=at.evaluate(o),et&&et instanceof wp&&!et.available&&(g||(g=et),et=null,nt===this.args.length))return g;if(et!==null)break}return et}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}serialize(){const o=["coalesce"];return this.eachChild(g=>{o.push(g.serialize())}),o}}class rm{constructor(o,g){this.type=g.type,this.bindings=[].concat(o),this.result=g}evaluate(o){return this.result.evaluate(o)}eachChild(o){for(const g of this.bindings)o(g[1]);o(this.result)}static parse(o,g){if(o.length<4)return g.error(`Expected at least 3 arguments, but found ${o.length-1} instead.`);const et=[];for(let at=1;at<o.length-1;at+=2){const lt=o[at];if(typeof lt!="string")return g.error(`Expected string, but found ${typeof lt} instead.`,at);if(/[^a-zA-Z0-9_]/.test(lt))return g.error("Variable names must contain only alphanumeric characters or '_'.",at);const ft=g.parse(o[at+1],at+1);if(!ft)return null;et.push([lt,ft])}const nt=g.parse(o[o.length-1],o.length-1,g.expectedType,et);return nt?new rm(et,nt):null}outputDefined(){return this.result.outputDefined()}serialize(){const o=["let"];for(const[g,et]of this.bindings)o.push(g,et.serialize());return o.push(this.result.serialize()),o}}class my{constructor(o,g,et){this.type=o,this.index=g,this.input=et}static parse(o,g){if(o.length!==3)return g.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const et=g.parse(o[1],1,js),nt=g.parse(o[2],2,Uu(g.expectedType||yo));return et&&nt?new my(nt.type.itemType,et,nt):null}evaluate(o){const g=this.index.evaluate(o),et=this.input.evaluate(o);if(g<0)throw new _h("Array index out of bounds: negative index");if(g>=et.length)throw new _h("Array index out of bounds: index exceeds array size");if(g!==Math.floor(g))throw new _h("Array index must be an integer. Use at-interpolated for fractional indices");return et[g]}eachChild(o){o(this.index),o(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class xy{constructor(o,g,et){this.type=o,this.index=g,this.input=et}static parse(o,g){if(o.length!==3)return g.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const et=g.parse(o[1],1,js),nt=g.parse(o[2],2,Uu(g.expectedType||yo));return et&&nt?new xy(nt.type.itemType,et,nt):null}evaluate(o){const g=this.index.evaluate(o),et=this.input.evaluate(o);if(g<0)throw new _h(`Array index out of bounds: ${g} < 0.`);if(g>et.length-1)throw new _h(`Array index out of bounds: ${g} > ${et.length-1}.`);if(g===Math.floor(g))return et[g];const nt=Math.floor(g),at=Math.ceil(g),lt=et[nt],ft=et[at];if(typeof lt!="number"||typeof ft!="number")throw new _h(`Cannot interpolate between non-number values at index ${g}.`);const gt=g-nt;return lt*(1-gt)+ft*gt}eachChild(o){o(this.index),o(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class H_{constructor(o,g){this.type=go,this.needle=o,this.haystack=g}static parse(o,g){if(o.length!==3)return g.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const et=g.parse(o[1],1,yo),nt=g.parse(o[2],2,yo);return et&&nt?Rx(et.type,[go,No,js,vu,yo])?new H_(et,nt):g.error(`Expected first argument to be of type boolean, string, number or null, but found ${Nu(et.type)} instead`):null}evaluate(o){const g=this.needle.evaluate(o),et=this.haystack.evaluate(o);if(et==null)return!1;if(!Dm(g,["boolean","string","number","null"]))throw new _h(`Expected first argument to be of type boolean, string, number or null, but found ${Nu(mu(g))} instead.`);if(!Dm(et,["string","array"]))throw new _h(`Expected second argument to be of type array or string, but found ${Nu(mu(et))} instead.`);return et.indexOf(g)>=0}eachChild(o){o(this.needle),o(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Ox{constructor(o,g,et){this.type=js,this.needle=o,this.haystack=g,this.fromIndex=et}static parse(o,g){if(o.length<=2||o.length>=5)return g.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const et=g.parse(o[1],1,yo),nt=g.parse(o[2],2,yo);if(!et||!nt)return null;if(!Rx(et.type,[go,No,js,vu,yo]))return g.error(`Expected first argument to be of type boolean, string, number or null, but found ${Nu(et.type)} instead`);if(o.length===4){const at=g.parse(o[3],3,js);return at?new Ox(et,nt,at):null}return new Ox(et,nt)}evaluate(o){const g=this.needle.evaluate(o),et=this.haystack.evaluate(o);if(!Dm(g,["boolean","string","number","null"]))throw new _h(`Expected first argument to be of type boolean, string, number or null, but found ${Nu(mu(g))} instead.`);if(!Dm(et,["string","array"]))throw new _h(`Expected second argument to be of type array or string, but found ${Nu(mu(et))} instead.`);if(this.fromIndex){const nt=this.fromIndex.evaluate(o);return et.indexOf(g,nt)}return et.indexOf(g)}eachChild(o){o(this.needle),o(this.haystack),this.fromIndex&&o(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const o=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),o]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class g1{constructor(o,g,et,nt,at,lt){this.inputType=o,this.type=g,this.input=et,this.cases=nt,this.outputs=at,this.otherwise=lt}static parse(o,g){if(o.length<5)return g.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if(o.length%2!=1)return g.error("Expected an even number of arguments.");let et,nt;g.expectedType&&g.expectedType.kind!=="value"&&(nt=g.expectedType);const at={},lt=[];for(let Rt=2;Rt<o.length-1;Rt+=2){let Mt=o[Rt];const Lt=o[Rt+1];Array.isArray(Mt)||(Mt=[Mt]);const Ht=g.concat(Rt);if(Mt.length===0)return Ht.error("Expected at least one branch label.");for(const Qt of Mt){if(typeof Qt!="number"&&typeof Qt!="string")return Ht.error("Branch labels must be numbers or strings.");if(typeof Qt=="number"&&Math.abs(Qt)>Number.MAX_SAFE_INTEGER)return Ht.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof Qt=="number"&&Math.floor(Qt)!==Qt)return Ht.error("Numeric branch labels must be integer values.");if(et){if(Ht.checkSubtype(et,mu(Qt)))return null}else et=mu(Qt);if(at[String(Qt)]!==void 0)return Ht.error("Branch labels must be unique.");at[String(Qt)]=lt.length}const Kt=g.parse(Lt,Rt,nt);if(!Kt)return null;nt=nt||Kt.type,lt.push(Kt)}const ft=g.parse(o[1],1,yo);if(!ft)return null;const gt=g.parse(o[o.length-1],o.length-1,nt);return gt?ft.type.kind!=="value"&&g.concat(1).checkSubtype(et,ft.type)?null:new g1(et,nt,ft,at,lt,gt):null}evaluate(o){const g=this.input.evaluate(o);return(Ix(mu(g),this.inputType)&&this.outputs[this.cases[g]]||this.otherwise).evaluate(o)}eachChild(o){o(this.input),this.outputs.forEach(o),o(this.otherwise)}outputDefined(){return this.outputs.every(o=>o.outputDefined())&&this.otherwise.outputDefined()}serialize(){const o=["match",this.input.serialize()],g=Object.keys(this.cases).sort(),et=[],nt={};for(const lt of g){const ft=nt[this.cases[lt]];ft===void 0?(nt[this.cases[lt]]=et.length,et.push([this.cases[lt],[lt]])):et[ft][1].push(lt)}const at=lt=>this.inputType.kind==="number"?Number(lt):lt;for(const[lt,ft]of et)o.push(ft.length===1?at(ft[0]):ft.map(at)),o.push(this.outputs[lt].serialize());return o.push(this.otherwise.serialize()),o}}class y1{constructor(o,g,et){this.type=o,this.branches=g,this.otherwise=et}static parse(o,g){if(o.length<4)return g.error(`Expected at least 3 arguments, but found only ${o.length-1}.`);if(o.length%2!=0)return g.error("Expected an odd number of arguments.");let et;g.expectedType&&g.expectedType.kind!=="value"&&(et=g.expectedType);const nt=[];for(let lt=1;lt<o.length-1;lt+=2){const ft=g.parse(o[lt],lt,go);if(!ft)return null;const gt=g.parse(o[lt+1],lt+1,et);if(!gt)return null;nt.push([ft,gt]),et=et||gt.type}const at=g.parse(o[o.length-1],o.length-1,et);return at?new y1(et,nt,at):null}evaluate(o){for(const[g,et]of this.branches)if(g.evaluate(o))return et.evaluate(o);return this.otherwise.evaluate(o)}eachChild(o){for(const[g,et]of this.branches)o(g),o(et);o(this.otherwise)}outputDefined(){return this.branches.every(([o,g])=>g.outputDefined())&&this.otherwise.outputDefined()}serialize(){const o=["case"];return this.eachChild(g=>{o.push(g.serialize())}),o}}class gy{constructor(o,g,et,nt){this.type=o,this.input=g,this.beginIndex=et,this.endIndex=nt}static parse(o,g){if(o.length<=2||o.length>=5)return g.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const et=g.parse(o[1],1,yo),nt=g.parse(o[2],2,js);if(!et||!nt)return null;if(!Rx(et.type,[Uu(yo),No,yo]))return g.error(`Expected first argument to be of type array or string, but found ${Nu(et.type)} instead`);if(o.length===4){const at=g.parse(o[3],3,js);return at?new gy(et.type,et,nt,at):null}return new gy(et.type,et,nt)}evaluate(o){const g=this.input.evaluate(o),et=this.beginIndex.evaluate(o);if(!Dm(g,["string","array"]))throw new _h(`Expected first argument to be of type array or string, but found ${Nu(mu(g))} instead.`);if(this.endIndex){const nt=this.endIndex.evaluate(o);return g.slice(et,nt)}return g.slice(et)}eachChild(o){o(this.input),o(this.beginIndex),this.endIndex&&o(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const o=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),o]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}class W_{constructor(o,g){this.type=Uu(No),this.str=o,this.delimiter=g}static parse(o,g){if(o.length!==3)return g.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const et=g.parse(o[1],1,No),nt=g.parse(o[2],2,No);return et&&nt?new W_(et,nt):void 0}evaluate(o){const g=this.str.evaluate(o),et=this.delimiter.evaluate(o);return g.split(et)}eachChild(o){o(this.str),o(this.delimiter)}outputDefined(){return!1}serialize(){return["split",this.str.serialize(),this.delimiter.serialize()]}}function q_(b,o){return b==="=="||b==="!="?o.kind==="boolean"||o.kind==="string"||o.kind==="number"||o.kind==="null"||o.kind==="value":o.kind==="string"||o.kind==="number"||o.kind==="value"}function X_(b,o,g,et){return et.compare(o,g)===0}function Lx(b,o,g){const et=b!=="=="&&b!=="!=";return class rR{constructor(at,lt,ft){this.type=go,this.lhs=at,this.rhs=lt,this.collator=ft,this.hasUntypedArgument=at.type.kind==="value"||lt.type.kind==="value"}static parse(at,lt){if(at.length!==3&&at.length!==4)return lt.error("Expected two or three arguments.");const ft=at[0];let gt=lt.parse(at[1],1,yo);if(!gt)return null;if(!q_(ft,gt.type))return lt.concat(1).error(`"${ft}" comparisons are not supported for type '${Nu(gt.type)}'.`);let Rt=lt.parse(at[2],2,yo);if(!Rt)return null;if(!q_(ft,Rt.type))return lt.concat(2).error(`"${ft}" comparisons are not supported for type '${Nu(Rt.type)}'.`);if(gt.type.kind!==Rt.type.kind&&gt.type.kind!=="value"&&Rt.type.kind!=="value")return lt.error(`Cannot compare types '${Nu(gt.type)}' and '${Nu(Rt.type)}'.`);et&&(gt.type.kind==="value"&&Rt.type.kind!=="value"?gt=new n0(Rt.type,[gt]):gt.type.kind!=="value"&&Rt.type.kind==="value"&&(Rt=new n0(gt.type,[Rt])));let Mt=null;if(at.length===4){if(gt.type.kind!=="string"&&Rt.type.kind!=="string"&&gt.type.kind!=="value"&&Rt.type.kind!=="value")return lt.error("Cannot use collator to compare non-string types.");if(Mt=lt.parse(at[3],3,y0),!Mt)return null}return new rR(gt,Rt,Mt)}evaluate(at){const lt=this.lhs.evaluate(at),ft=this.rhs.evaluate(at);if(et&&this.hasUntypedArgument){const gt=mu(lt),Rt=mu(ft);if(gt.kind!==Rt.kind||gt.kind!=="string"&&gt.kind!=="number")throw new _h(`Expected arguments for "${b}" to be (string, string) or (number, number), but found (${gt.kind}, ${Rt.kind}) instead.`)}if(this.collator&&!et&&this.hasUntypedArgument){const gt=mu(lt),Rt=mu(ft);if(gt.kind!=="string"||Rt.kind!=="string")return o(at,lt,ft)}return this.collator?g(at,lt,ft,this.collator.evaluate(at)):o(at,lt,ft)}eachChild(at){at(this.lhs),at(this.rhs),this.collator&&at(this.collator)}outputDefined(){return!0}serialize(){const at=[b];return this.eachChild(lt=>{at.push(lt.serialize())}),at}}}const d2=Lx("==",function(b,o,g){return o===g},X_),h2=Lx("!=",function(b,o,g){return o!==g},function(b,o,g,et){return!X_(0,o,g,et)}),TE=Lx("<",function(b,o,g){return o<g},function(b,o,g,et){return et.compare(o,g)<0}),RE=Lx(">",function(b,o,g){return o>g},function(b,o,g,et){return et.compare(o,g)>0}),yy=Lx("<=",function(b,o,g){return o<=g},function(b,o,g,et){return et.compare(o,g)<=0}),f2=Lx(">=",function(b,o,g){return o>=g},function(b,o,g,et){return et.compare(o,g)>=0});class _y{constructor(o,g,et,nt,at,lt){this.type=No,this.number=o,this.locale=g,this.currency=et,this.unit=nt,this.minFractionDigits=at,this.maxFractionDigits=lt}static parse(o,g){if(o.length!==3)return g.error("Expected two arguments.");const et=g.parse(o[1],1,js);if(!et)return null;const nt=o[2];if(typeof nt!="object"||Array.isArray(nt))return g.error("NumberFormat options argument must be an object.");let at=null;if(nt.locale&&(at=g.parseObjectValue(nt.locale,2,"locale",No),!at))return null;let lt=null;if(nt.currency&&(lt=g.parseObjectValue(nt.currency,2,"currency",No),!lt))return null;let ft=null;if(nt.unit&&(ft=g.parseObjectValue(nt.unit,2,"unit",No),!ft))return null;let gt=null;if(nt["min-fraction-digits"]&&(gt=g.parseObjectValue(nt["min-fraction-digits"],2,"min-fraction-digits",js),!gt))return null;let Rt=null;return nt["max-fraction-digits"]&&(Rt=g.parseObjectValue(nt["max-fraction-digits"],2,"max-fraction-digits",js),!Rt)?null:new _y(et,at,lt,ft,gt,Rt)}evaluate(o){return new Intl.NumberFormat(this.locale?this.locale.evaluate(o):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(o):void 0,unit:this.unit?this.unit.evaluate(o):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(o):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(o):void 0}).format(this.number.evaluate(o))}eachChild(o){o(this.number),this.locale&&o(this.locale),this.currency&&o(this.currency),this.unit&&o(this.unit),this.minFractionDigits&&o(this.minFractionDigits),this.maxFractionDigits&&o(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const o={};return this.locale&&(o.locale=this.locale.serialize()),this.currency&&(o.currency=this.currency.serialize()),this.unit&&(o.unit=this.unit.serialize()),this.minFractionDigits&&(o["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(o["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),o]}}class K_{constructor(o){this.type=js,this.input=o}static parse(o,g){if(o.length!==2)return g.error(`Expected 1 argument, but found ${o.length-1} instead.`);const et=g.parse(o[1],1);return et?et.type.kind!=="array"&&et.type.kind!=="string"&&et.type.kind!=="value"?g.error(`Expected argument of type string or array, but found ${Nu(et.type)} instead.`):new K_(et):null}evaluate(o){const g=this.input.evaluate(o);if(typeof g=="string"||Array.isArray(g))return g.length;throw new _h(`Expected value to be of type string or array, but found ${Nu(mu(g))} instead.`)}eachChild(o){o(this.input)}outputDefined(){return!1}serialize(){const o=["length"];return this.eachChild(g=>{o.push(g.serialize())}),o}}function IE(b){return function(){b=1831565813+(b|=0)|0;let o=Math.imul(b^b>>>15,1|b);return o=o+Math.imul(o^o>>>7,61|o)^o,((o^o>>>14)>>>0)/4294967296}}const jx={"==":d2,"!=":h2,">":RE,"<":TE,">=":f2,"<=":yy,array:n0,at:my,"at-interpolated":xy,boolean:n0,case:y1,coalesce:x1,collator:Dt,format:i0,image:co,in:H_,"index-of":Ox,interpolate:o0,"interpolate-hcl":o0,"interpolate-lab":o0,length:K_,let:rm,literal:pp,match:g1,number:n0,"number-format":_y,object:n0,slice:gy,step:p1,string:n0,"to-boolean":it,"to-color":it,"to-number":it,"to-string":it,var:cy,within:Gp,distance:rx,config:Bx,split:W_};function Z_(b,[o,g,et,nt]){o=o.evaluate(b),g=g.evaluate(b),et=et.evaluate(b);const at=nt?nt.evaluate(b):1,lt=Bp(o,g,et,at);if(lt)throw new _h(lt);return new Mo(o/255,g/255,et/255,at)}function Y_(b,[o,g,et,nt]){o=o.evaluate(b),g=g.evaluate(b),et=et.evaluate(b);const at=nt?nt.evaluate(b):1,lt=function(Rt,Mt,Lt,Ht){return typeof Rt=="number"&&Rt>=0&&Rt<=360?typeof Mt=="number"&&Mt>=0&&Mt<=100&&typeof Lt=="number"&&Lt>=0&&Lt<=100?Ht===void 0||typeof Ht=="number"&&Ht>=0&&Ht<=1?null:`Invalid hsla value [${[Rt,Mt,Lt,Ht].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof Ht=="number"?[Rt,Mt,Lt,Ht]:[Rt,Mt,Lt]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof Ht=="number"?[Rt,Mt,Lt,Ht]:[Rt,Mt,Lt]).join(", ")}]: 'h' must be between 0 and 360.`}(o,g,et,at);if(lt)throw new _h(lt);const ft=`hsla(${o}, ${g}%, ${et}%, ${at})`,gt=Mo.parse(ft);if(!gt)throw new _h(`Failed to parse HSLA color: ${ft}`);return gt}function DE(b,o){return b in o}function Q_(b,o){const g=o[b];return g===void 0?null:g}function Mm(b){return{type:b}}function nx(b){if(b instanceof Bx)return new Set([b.key]);let o=new Set;return b.eachChild(g=>{o=new Set([...o,...nx(g)])}),o}function vy(b){if(b instanceof Ct&&b.name==="is-active-floor")return!0;let o=!1;return b.eachChild(g=>{!o&&vy(g)&&(o=!0)}),o}function PE(b){return{result:"success",value:b}}function Nm(b){return{result:"error",value:b}}function J_(b,o){return!!b&&!!b.parameters&&b.parameters.indexOf(o)>-1}function _1(b){return b["property-type"]==="data-driven"}function kE(b){return J_(b.expression,"measure-light")}function FE(b){return J_(b.expression,"zoom")}function Ey(b){return!!b.expression&&b.expression.interpolated}function by(b){return typeof b=="object"&&b!==null&&!Array.isArray(b)}function BE(b){return b}function ME(b,o){const g=o.type==="color",et=b.stops&&typeof b.stops[0][0]=="object",nt=et||!(et||b.property!==void 0),at=b.type||(Ey(o)?"exponential":"interval");if(g&&((b=Object.assign({},b)).stops&&(b.stops=b.stops.map(Rt=>[Rt[0],Mo.parse(Rt[1])])),b.default=Mo.parse(b.default?b.default:o.default)),b.colorSpace&&b.colorSpace!=="rgb"&&!SE[b.colorSpace])throw new Error(`Unknown color space: ${b.colorSpace}`);let lt,ft,gt;if(at==="exponential")lt=NE;else if(at==="interval")lt=m2;else if(at==="categorical"){lt=p2,ft=Object.create(null);for(const Rt of b.stops)ft[Rt[0]]=Rt[1];gt=typeof b.stops[0][0]}else{if(at!=="identity")throw new Error(`Unknown function type "${at}"`);lt=OE}if(et){const Rt={},Mt=[];for(let Kt=0;Kt<b.stops.length;Kt++){const Qt=b.stops[Kt],sr=Qt[0].zoom;Rt[sr]===void 0&&(Rt[sr]={zoom:sr,type:b.type,property:b.property,default:b.default,stops:[]},Mt.push(sr)),Rt[sr].stops.push([Qt[0].value,Qt[1]])}const Lt=[];for(const Kt of Mt)Lt.push([Rt[Kt].zoom,ME(Rt[Kt],o)]);const Ht={name:"linear"};return{kind:"composite",interpolationType:Ht,interpolationFactor:o0.interpolationFactor.bind(void 0,Ht),zoomStops:Lt.map(Kt=>Kt[0]),evaluate:({zoom:Kt},Qt)=>NE({stops:Lt,base:b.base},o,Kt).evaluate(Kt,Qt)}}if(nt){const Rt=at==="exponential"?{name:"exponential",base:b.base!==void 0?b.base:1}:null;return{kind:"camera",interpolationType:Rt,interpolationFactor:o0.interpolationFactor.bind(void 0,Rt),zoomStops:b.stops.map(Mt=>Mt[0]),evaluate:({zoom:Mt})=>lt(b,o,Mt,ft,gt)}}return{kind:"source",evaluate(Rt,Mt){const Lt=Mt&&Mt.properties?Mt.properties[b.property]:void 0;return Lt===void 0?$0(b.default,o.default):lt(b,o,Lt,ft,gt)}}}function $0(b,o,g){return b!==void 0?b:o!==void 0?o:g!==void 0?g:void 0}function p2(b,o,g,et,nt){return $0(typeof g===nt?et[g]:void 0,b.default,o.default)}function m2(b,o,g){if(!nu(g))return $0(b.default,o.default);const et=b.stops.length;if(et===1||g<=b.stops[0][0])return b.stops[0][1];if(g>=b.stops[et-1][0])return b.stops[et-1][1];const nt=dy(b.stops.map(at=>at[0]),g);return b.stops[nt][1]}function NE(b,o,g){const et=b.base!==void 0?b.base:1;if(!nu(g))return $0(b.default,o.default);const nt=b.stops.length;if(nt===1||g<=b.stops[0][0])return b.stops[0][1];if(g>=b.stops[nt-1][0])return b.stops[nt-1][1];const at=dy(b.stops.map(Mt=>Mt[0]),g),lt=function(Mt,Lt,Ht,Kt){const Qt=Kt-Ht,sr=Mt-Ht;return Qt===0?0:Lt===1?sr/Qt:(Math.pow(Lt,sr)-1)/(Math.pow(Lt,Qt)-1)}(g,et,b.stops[at][0],b.stops[at+1][0]),ft=b.stops[at][1],gt=b.stops[at+1][1];let Rt=em[o.type]||BE;if(b.colorSpace&&b.colorSpace!=="rgb"){const Mt=SE[b.colorSpace];Rt=(Lt,Ht)=>Mt.reverse(Mt.interpolate(Mt.forward(Lt),Mt.forward(Ht),lt))}return typeof ft.evaluate=="function"?{evaluate(...Mt){const Lt=ft.evaluate.apply(void 0,Mt),Ht=gt.evaluate.apply(void 0,Mt);if(Lt!==void 0&&Ht!==void 0)return Rt(Lt,Ht,lt)}}:Rt(ft,gt,lt)}function OE(b,o,g){return o.type==="color"?g=Mo.parse(g):o.type==="formatted"?g=bp.fromString(g.toString()):o.type==="resolvedImage"?g=wp.build(g.toString()):Us(g)===o.type||o.type==="enum"&&o.values[g]||(g=void 0),$0(g,b.default,o.default)}Ct.register(jx,{error:[{kind:"error"},[No],(b,[o])=>{throw new _h(o.evaluate(b))}],typeof:[No,[yo],(b,[o])=>Nu(mu(o.evaluate(b)))],"to-rgba":[Uu(js,4),[Po],(b,[o])=>o.evaluate(b).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[Uu(js,4),[Po],(b,[o])=>o.evaluate(b).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[Po,[js,js,js],Z_],rgba:[Po,[js,js,js,js],Z_],hsl:[Po,[js,js,js],Y_],hsla:[Po,[js,js,js,js],Y_],has:{type:go,overloads:[[[No],(b,[o])=>DE(o.evaluate(b),b.properties())],[[No,g0],(b,[o,g])=>DE(o.evaluate(b),g.evaluate(b))]]},get:{type:yo,overloads:[[[No],(b,[o])=>Q_(o.evaluate(b),b.properties())],[[No,g0],(b,[o,g])=>Q_(o.evaluate(b),g.evaluate(b))]]},"feature-state":[yo,[No],(b,[o])=>Q_(o.evaluate(b),b.featureState||{})],properties:[g0,[],b=>b.properties()],"geometry-type":[No,[],b=>b.geometryType()],worldview:[No,[],b=>b.globals.worldview||""],"is-active-floor":[go,Mm(No),(b,o)=>{if(!(b.globals.activeFloors&&b.globals.activeFloors.size>0))return!1;const g=b.globals.activeFloors;return o.some(et=>{const nt=et.evaluate(b);return g.has(nt)})}],id:[yo,[],b=>b.id()],zoom:[js,[],b=>b.globals.zoom],pitch:[js,[],b=>b.globals.pitch||0],"distance-from-center":[js,[],b=>b.distanceFromCenter()],"measure-light":[js,[No],(b,[o])=>b.measureLight(o.evaluate(b))],"heatmap-density":[js,[],b=>b.globals.heatmapDensity||0],"line-progress":[js,[],b=>b.globals.lineProgress||0],"raster-value":[js,[],b=>b.globals.rasterValue||0],"raster-particle-speed":[js,[],b=>b.globals.rasterParticleSpeed||0],"sky-radial-progress":[js,[],b=>b.globals.skyRadialProgress||0],accumulated:[yo,[],b=>b.globals.accumulated===void 0?null:b.globals.accumulated],"+":[js,Mm(js),(b,o)=>{let g=0;for(const et of o)g+=et.evaluate(b);return g}],"*":[js,Mm(js),(b,o)=>{let g=1;for(const et of o)g*=et.evaluate(b);return g}],"-":{type:js,overloads:[[[js,js],(b,[o,g])=>o.evaluate(b)-g.evaluate(b)],[[js],(b,[o])=>-o.evaluate(b)]]},"/":[js,[js,js],(b,[o,g])=>o.evaluate(b)/g.evaluate(b)],"%":[js,[js,js],(b,[o,g])=>o.evaluate(b)%g.evaluate(b)],ln2:[js,[],()=>Math.LN2],pi:[js,[],()=>Math.PI],e:[js,[],()=>Math.E],"^":[js,[js,js],(b,[o,g])=>Math.pow(o.evaluate(b),g.evaluate(b))],sqrt:[js,[js],(b,[o])=>Math.sqrt(o.evaluate(b))],log10:[js,[js],(b,[o])=>Math.log(o.evaluate(b))/Math.LN10],ln:[js,[js],(b,[o])=>Math.log(o.evaluate(b))],log2:[js,[js],(b,[o])=>Math.log2(o.evaluate(b))],sin:[js,[js],(b,[o])=>Math.sin(o.evaluate(b))],cos:[js,[js],(b,[o])=>Math.cos(o.evaluate(b))],tan:[js,[js],(b,[o])=>Math.tan(o.evaluate(b))],asin:[js,[js],(b,[o])=>Math.asin(o.evaluate(b))],acos:[js,[js],(b,[o])=>Math.acos(o.evaluate(b))],atan:[js,[js],(b,[o])=>Math.atan(o.evaluate(b))],min:[js,Mm(js),(b,o)=>Math.min(...o.map(g=>g.evaluate(b)))],max:[js,Mm(js),(b,o)=>Math.max(...o.map(g=>g.evaluate(b)))],abs:[js,[js],(b,[o])=>Math.abs(o.evaluate(b))],round:[js,[js],(b,[o])=>{const g=o.evaluate(b);return g<0?-Math.round(-g):Math.round(g)}],floor:[js,[js],(b,[o])=>Math.floor(o.evaluate(b))],ceil:[js,[js],(b,[o])=>Math.ceil(o.evaluate(b))],"filter-==":[go,[No,yo],(b,[o,g])=>b.properties()[o.value]===g.value],"filter-id-==":[go,[yo],(b,[o])=>b.id()===o.value],"filter-type-==":[go,[No],(b,[o])=>b.geometryType()===o.value],"filter-<":[go,[No,yo],(b,[o,g])=>{const et=b.properties()[o.value],nt=g.value;return typeof et==typeof nt&&et<nt}],"filter-id-<":[go,[yo],(b,[o])=>{const g=b.id(),et=o.value;return typeof g==typeof et&&g<et}],"filter->":[go,[No,yo],(b,[o,g])=>{const et=b.properties()[o.value],nt=g.value;return typeof et==typeof nt&&et>nt}],"filter-id->":[go,[yo],(b,[o])=>{const g=b.id(),et=o.value;return typeof g==typeof et&&g>et}],"filter-<=":[go,[No,yo],(b,[o,g])=>{const et=b.properties()[o.value],nt=g.value;return typeof et==typeof nt&&et<=nt}],"filter-id-<=":[go,[yo],(b,[o])=>{const g=b.id(),et=o.value;return typeof g==typeof et&&g<=et}],"filter->=":[go,[No,yo],(b,[o,g])=>{const et=b.properties()[o.value],nt=g.value;return typeof et==typeof nt&&et>=nt}],"filter-id->=":[go,[yo],(b,[o])=>{const g=b.id(),et=o.value;return typeof g==typeof et&&g>=et}],"filter-has":[go,[yo],(b,[o])=>o.value in b.properties()],"filter-has-id":[go,[],b=>b.id()!==null&&b.id()!==void 0],"filter-type-in":[go,[Uu(No)],(b,[o])=>o.value.indexOf(b.geometryType())>=0],"filter-id-in":[go,[Uu(yo)],(b,[o])=>o.value.indexOf(b.id())>=0],"filter-in-small":[go,[No,Uu(yo)],(b,[o,g])=>g.value.indexOf(b.properties()[o.value])>=0],"filter-in-large":[go,[No,Uu(yo)],(b,[o,g])=>function(et,nt,at,lt){for(;at<=lt;){const ft=at+lt>>1;if(nt[ft]===et)return!0;nt[ft]>et?lt=ft-1:at=ft+1}return!1}(b.properties()[o.value],g.value,0,g.value.length-1)],all:{type:go,overloads:[[[go,go],(b,[o,g])=>o.evaluate(b)&&g.evaluate(b)],[Mm(go),(b,o)=>{for(const g of o)if(!g.evaluate(b))return!1;return!0}]]},any:{type:go,overloads:[[[go,go],(b,[o,g])=>o.evaluate(b)||g.evaluate(b)],[Mm(go),(b,o)=>{for(const g of o)if(g.evaluate(b))return!0;return!1}]]},"!":[go,[go],(b,[o])=>!o.evaluate(b)],"is-supported-script":[go,[No],(b,[o])=>{const g=b.globals&&b.globals.isSupportedScript;return!g||g(o.evaluate(b))}],upcase:[No,[No],(b,[o])=>o.evaluate(b).toUpperCase()],downcase:[No,[No],(b,[o])=>o.evaluate(b).toLowerCase()],concat:[No,Mm(yo),(b,o)=>o.map(g=>Vp(g.evaluate(b))).join("")],"resolved-locale":[No,[y0],(b,[o])=>o.evaluate(b).resolvedLocale()],random:[js,[js,js,yo],(b,o)=>{const[g,et,nt]=o.map(lt=>lt.evaluate(b));if(g>et||g===et)return g;let at;if(typeof nt=="string")at=function(lt){let ft=0;if(lt.length===0)return ft;for(let gt=0;gt<lt.length;gt++)ft=(ft<<5)-ft+lt.charCodeAt(gt),ft|=0;return ft}(nt);else{if(typeof nt!="number")throw new _h(`Invalid seed input: ${nt}`);at=nt}return g+IE(at)()*(et-g)}]});class wy{constructor(o,g,et,nt,at){this.expression=o,this._warningHistory={},this._scope=et,this._options=nt,this._iconImageUseTheme=at,this._evaluator=new pt(et,nt,at),this._defaultValue=g?function(lt){return lt.type==="color"&&(by(lt.default)||Array.isArray(lt.default))?new Mo(0,0,0,0):lt.type==="color"?Mo.parse(lt.default)||null:lt.default===void 0?null:lt.default}(g):null,this._enumValues=g&&g.type==="enum"?g.values:null,this.configDependencies=nx(o),this.isIndoorDependent=vy(o)}evaluateWithoutErrorHandling(o,g,et,nt,at,lt,ft,gt){return this._evaluator.globals=o,this._evaluator.feature=g,this._evaluator.featureState=et,this._evaluator.canonical=nt||null,this._evaluator.availableImages=at||null,this._evaluator.formattedSection=lt,this._evaluator.featureTileCoord=ft||null,this._evaluator.featureDistanceData=gt||null,this.expression.evaluate(this._evaluator)}evaluate(o,g,et,nt,at,lt,ft,gt,Rt){this._evaluator||(this._evaluator=new pt(this._scope,this._options,this._iconImageUseTheme)),this._evaluator.globals=o,this._evaluator.feature=g||null,this._evaluator.featureState=et||null,this._evaluator.canonical=nt||null,this._evaluator.availableImages=at||null,this._evaluator.formattedSection=lt||null,this._evaluator.featureTileCoord=ft||null,this._evaluator.featureDistanceData=gt||null,this._evaluator.iconImageUseTheme=Rt||null;try{const Mt=this.expression.evaluate(this._evaluator);if(Mt==null||typeof Mt=="number"&&Mt!=Mt)return this._defaultValue;if(this._enumValues&&!(Mt in this._enumValues))throw new _h(`Expected value to be one of ${Object.keys(this._enumValues).map(Lt=>JSON.stringify(Lt)).join(", ")}, but found ${JSON.stringify(Mt)} instead.`);return Mt}catch(Mt){const Lt=Mt;return this._warningHistory[Lt.message]||(this._warningHistory[Lt.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${Lt.message}`)),this._defaultValue}}}function v1(b){return Array.isArray(b)&&b.length>0&&typeof b[0]=="string"&&b[0]in jx}function Om(b,o,g,et,nt){const at=new uy(jx,[],o?function(ft){const gt={color:Po,string:No,number:js,enum:No,boolean:go,formatted:_0,resolvedImage:Qm};return ft.type==="array"?Uu(gt[ft.value]||yo,ft.length):gt[ft.type]}(o):void 0,void 0,void 0,g,et,nt),lt=at.parse(b,void 0,void 0,void 0,o&&o.type==="string"?{typeAnnotation:"coerce"}:void 0);return lt?PE(new wy(lt,o,g,et,nt)):Nm(at.errors)}class zx{constructor(o,g,et,nt){this.kind=o,this._styleExpression=g,this.isLightConstant=et,this.isLineProgressConstant=nt,this.isStateDependent=o!=="constant"&&!f1(g.expression),this.configDependencies=nx(g.expression),this.isIndoorDependent=vy(g.expression)}evaluateWithoutErrorHandling(o,g,et,nt,at,lt){return this._styleExpression.evaluateWithoutErrorHandling(o,g,et,nt,at,lt)}evaluate(o,g,et,nt,at,lt,ft){return this._styleExpression.evaluate(o,g,et,nt,at,lt,void 0,void 0,ft)}}class ix{constructor(o,g,et,nt,at,lt){this.kind=o,this.zoomStops=et,this._styleExpression=g,this.isStateDependent=o!=="camera"&&!f1(g.expression),this.isIndoorDependent=vy(g.expression),this.isLightConstant=at,this.isLineProgressConstant=lt,this.configDependencies=nx(g.expression),this.interpolationType=nt}evaluateWithoutErrorHandling(o,g,et,nt,at,lt){return this._styleExpression.evaluateWithoutErrorHandling(o,g,et,nt,at,lt)}evaluate(o,g,et,nt,at,lt){return this._styleExpression.evaluate(o,g,et,nt,at,lt)}interpolationFactor(o,g,et){return this.interpolationType?o0.interpolationFactor(this.interpolationType,o,g,et):0}}function ev(b,o,g,et,nt){if((b=Om(b,o,g,et,nt)).result==="error")return b;const at=b.value.expression,lt=kx(at);if(!lt&&!_1(o))return Nm([new ku("","data expressions not supported")]);const ft=Fx(at,["zoom","pitch","distance-from-center"]);if(!ft&&!FE(o))return Nm([new ku("","zoom expressions not supported")]);const gt=Fx(at,["measure-light"]);if(!gt&&!kE(o))return Nm([new ku("","measure-light expression not supported")]);const Rt=Fx(at,["line-progress"]);if(!Rt&&!function(Ht){return J_(Ht.expression,"line-progress")}(o))return Nm([new ku("","line-progress expression not supported")]);const Mt=o.expression&&o.expression.relaxZoomRestriction,Lt=k0(at);return Lt||ft||Mt?Lt instanceof ku?Nm([Lt]):Lt instanceof o0&&!Ey(o)?Nm([new ku("",'"interpolate" expressions cannot be used with this property')]):PE(Lt?new ix(lt&&Rt?"camera":"composite",b.value,Lt.labels,Lt instanceof o0?Lt.interpolation:void 0,gt,Rt):new zx(lt&&Rt?"constant":"source",b.value,gt,Rt)):Nm([new ku("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Cy{constructor(o,g){this._parameters=o,this._specification=g,Object.assign(this,ME(this._parameters,this._specification))}static deserialize(o){return new Cy(o._parameters,o._specification)}static serialize(o){return{_parameters:o._parameters,_specification:o._specification}}}function k0(b){let o=null;if(b instanceof rm)o=k0(b.result);else if(b instanceof x1){for(const g of b.args)if(o=k0(g),o)break}else(b instanceof p1||b instanceof o0)&&b.input instanceof Ct&&b.input.name==="zoom"&&(o=b);return o instanceof ku||b.eachChild(g=>{const et=k0(g);et instanceof ku?o=et:o&&et&&o!==et&&(o=new ku("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),o}var tv,LE,jE=function(){if(LE)return tv;LE=1,tv=o;var b=3;function o(g,et,nt){var at=this.cells=[];if(g instanceof ArrayBuffer){this.arrayBuffer=g;var lt=new Int32Array(this.arrayBuffer);g=lt[0],this.d=(et=lt[1])+2*(nt=lt[2]);for(var ft=0;ft<this.d*this.d;ft++){var gt=lt[b+ft],Rt=lt[b+ft+1];at.push(gt===Rt?null:lt.subarray(gt,Rt))}var Mt=lt[b+at.length+1];this.keys=lt.subarray(lt[b+at.length],Mt),this.bboxes=lt.subarray(Mt),this.insert=this._insertReadonly}else{this.d=et+2*nt;for(var Lt=0;Lt<this.d*this.d;Lt++)at.push([]);this.keys=[],this.bboxes=[]}this.n=et,this.extent=g,this.padding=nt,this.scale=et/g,this.uid=0;var Ht=nt/et*g;this.min=-Ht,this.max=g+Ht}return o.prototype.insert=function(g,et,nt,at,lt){this._forEachCell(et,nt,at,lt,this._insertCell,this.uid++),this.keys.push(g),this.bboxes.push(et),this.bboxes.push(nt),this.bboxes.push(at),this.bboxes.push(lt)},o.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},o.prototype._insertCell=function(g,et,nt,at,lt,ft){this.cells[lt].push(ft)},o.prototype.query=function(g,et,nt,at,lt){var ft=this.min,gt=this.max;if(g<=ft&&et<=ft&&gt<=nt&&gt<=at&&!lt)return Array.prototype.slice.call(this.keys);var Rt=[];return this._forEachCell(g,et,nt,at,this._queryCell,Rt,{},lt),Rt},o.prototype._queryCell=function(g,et,nt,at,lt,ft,gt,Rt){var Mt=this.cells[lt];if(Mt!==null)for(var Lt=this.keys,Ht=this.bboxes,Kt=0;Kt<Mt.length;Kt++){var Qt=Mt[Kt];if(gt[Qt]===void 0){var sr=4*Qt;(Rt?Rt(Ht[sr+0],Ht[sr+1],Ht[sr+2],Ht[sr+3]):g<=Ht[sr+2]&&et<=Ht[sr+3]&&nt>=Ht[sr+0]&&at>=Ht[sr+1])?(gt[Qt]=!0,ft.push(Lt[Qt])):gt[Qt]=!1}}},o.prototype._forEachCell=function(g,et,nt,at,lt,ft,gt,Rt){for(var Mt=this._convertToCellCoord(g),Lt=this._convertToCellCoord(et),Ht=this._convertToCellCoord(nt),Kt=this._convertToCellCoord(at),Qt=Mt;Qt<=Ht;Qt++)for(var sr=Lt;sr<=Kt;sr++){var hr=this.d*sr+Qt;if((!Rt||Rt(this._convertFromCellCoord(Qt),this._convertFromCellCoord(sr),this._convertFromCellCoord(Qt+1),this._convertFromCellCoord(sr+1)))&&lt.call(this,g,et,nt,at,hr,ft,gt,Rt))return}},o.prototype._convertFromCellCoord=function(g){return(g-this.padding)/this.scale},o.prototype._convertToCellCoord=function(g){return Math.max(0,Math.min(this.d-1,Math.floor(g*this.scale)+this.padding))},o.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var g=this.cells,et=b+this.cells.length+1+1,nt=0,at=0;at<this.cells.length;at++)nt+=this.cells[at].length;var lt=new Int32Array(et+nt+this.keys.length+this.bboxes.length);lt[0]=this.extent,lt[1]=this.n,lt[2]=this.padding;for(var ft=et,gt=0;gt<g.length;gt++){var Rt=g[gt];lt[b+gt]=ft,lt.set(Rt,ft),ft+=Rt.length}return lt[b+g.length]=ft,lt.set(this.keys,ft),lt[b+g.length+1]=ft+=this.keys.length,lt.set(this.bboxes,ft),ft+=this.bboxes.length,lt.buffer},tv}(),Vx=Ll(jE);const sx={};function Ps(b,o,g={}){Object.defineProperty(b,"_classRegistryKey",{value:o,writable:!1}),sx[o]={klass:b,omit:g.omit||[]}}Ps(Object,"Object"),Vx.serialize=function(b,o){const g=b.toArrayBuffer();return o&&o.add(g),{buffer:g}},Vx.deserialize=function(b){return new Vx(b.buffer)},Object.defineProperty(Vx,"name",{value:"Grid"}),Ps(Vx,"Grid"),delete zn.prototype.constructor,Ps(Mo,"Color"),Ps(Error,"Error"),Ps(bp,"Formatted"),Ps(Pm,"FormattedSection"),Ps(Du,"AJAXError"),Ps(wp,"ResolvedImage"),Ps(Cy,"StylePropertyFunction"),Ps(wy,"StyleExpression",{omit:["_evaluator"]}),Ps(Qu,"ImageId"),Ps(zp,"ImageVariant"),Ps(ix,"ZoomDependentExpression"),Ps(zx,"ZoomConstantExpression"),Ps(Ct,"CompoundExpression",{omit:["_evaluate"]});for(const b in jx)sx[jx[b]._classRegistryKey]||Ps(jx[b],`Expression${b}`);function E1(b){return b&&(b instanceof ArrayBuffer||b.constructor&&b.constructor.name==="ArrayBuffer")}function im(b,o){if(b==null||typeof b=="boolean"||typeof b=="number"||typeof b=="string"||b instanceof Boolean||b instanceof Number||b instanceof String||b instanceof Date||b instanceof RegExp)return b;if(E1(b)||b instanceof ImageBitmap)return o&&o.add(b),b;if(ArrayBuffer.isView(b))return o&&o.add(b.buffer),b;if(b instanceof ImageData)return o&&o.add(b.data.buffer),b;if(Array.isArray(b)){const g=[];for(const et of b)g.push(im(et,o));return g}if(b instanceof Map){const g={$name:"Map",entries:[]};for(const[et,nt]of b.entries())g.entries.push(im(et),im(nt,o));return g}if(b instanceof Set){const g={$name:"Set"};let et=0;for(const nt of b.values())g[++et]=im(nt);return g}if(typeof b=="bigint")return{$name:"BigInt",value:b.toString()};if(typeof b=="object"){const g=b.constructor,et=g._classRegistryKey;if(!et)throw new Error(`Can't serialize object of unregistered class "${g.name}".`);const nt=g.serialize?g.serialize(b,o):{};if(!g.serialize){for(const at in b)b.hasOwnProperty(at)&&(sx[et].omit.indexOf(at)>=0||(nt[at]=im(b[at],o)));b instanceof Error&&(nt.message=b.message)}if(nt.$name)throw new Error("$name property is reserved for worker serialization logic.");return et!=="Object"&&(nt.$name=et),nt}throw new Error("can't serialize object of type "+typeof b)}function Lm(b){if(b==null||typeof b=="boolean"||typeof b=="number"||typeof b=="string"||b instanceof Boolean||b instanceof Number||b instanceof String||b instanceof Date||b instanceof RegExp||E1(b)||b instanceof ImageBitmap||ArrayBuffer.isView(b)||b instanceof ImageData)return b;if(Array.isArray(b))return b.map(Lm);if(typeof b=="object"){const o=b.$name||"Object";if(o==="Map"){const nt=b.entries||[],at=new Map;for(let lt=0;lt<nt.length;lt+=2)at.set(Lm(nt[lt]),Lm(nt[lt+1]));return at}if(o==="Set"){const nt=new Set;for(const at of Object.keys(b))at!=="$name"&&nt.add(Lm(b[at]));return nt}if(o==="BigInt")return BigInt(b.value);const{klass:g}=sx[o];if(!g)throw new Error(`Can't deserialize unregistered class "${o}".`);if(g.deserialize)return g.deserialize(b);const et=Object.create(g.prototype);for(const nt of Object.keys(b))nt!=="$name"&&(et[nt]=Lm(b[nt]));return et}throw new Error("can't deserialize object of type "+typeof b)}const eo={"Latin-1 Supplement":b=>b>=128&&b<=255,Arabic:b=>b>=1536&&b<=1791,"Arabic Supplement":b=>b>=1872&&b<=1919,"Arabic Extended-A":b=>b>=2208&&b<=2303,"Hangul Jamo":b=>b>=4352&&b<=4607,"Unified Canadian Aboriginal Syllabics":b=>b>=5120&&b<=5759,Khmer:b=>b>=6016&&b<=6143,"Unified Canadian Aboriginal Syllabics Extended":b=>b>=6320&&b<=6399,"General Punctuation":b=>b>=8192&&b<=8303,"Letterlike Symbols":b=>b>=8448&&b<=8527,"Number Forms":b=>b>=8528&&b<=8591,"Miscellaneous Technical":b=>b>=8960&&b<=9215,"Control Pictures":b=>b>=9216&&b<=9279,"Optical Character Recognition":b=>b>=9280&&b<=9311,"Enclosed Alphanumerics":b=>b>=9312&&b<=9471,"Geometric Shapes":b=>b>=9632&&b<=9727,"Miscellaneous Symbols":b=>b>=9728&&b<=9983,"Miscellaneous Symbols and Arrows":b=>b>=11008&&b<=11263,"CJK Radicals Supplement":b=>b>=11904&&b<=12031,"Kangxi Radicals":b=>b>=12032&&b<=12255,"Ideographic Description Characters":b=>b>=12272&&b<=12287,"CJK Symbols and Punctuation":b=>b>=12288&&b<=12351,Hiragana:b=>b>=12352&&b<=12447,Katakana:b=>b>=12448&&b<=12543,Bopomofo:b=>b>=12544&&b<=12591,"Hangul Compatibility Jamo":b=>b>=12592&&b<=12687,Kanbun:b=>b>=12688&&b<=12703,"Bopomofo Extended":b=>b>=12704&&b<=12735,"CJK Strokes":b=>b>=12736&&b<=12783,"Katakana Phonetic Extensions":b=>b>=12784&&b<=12799,"Enclosed CJK Letters and Months":b=>b>=12800&&b<=13055,"CJK Compatibility":b=>b>=13056&&b<=13311,"CJK Unified Ideographs Extension A":b=>b>=13312&&b<=19903,"Yijing Hexagram Symbols":b=>b>=19904&&b<=19967,"CJK Unified Ideographs":b=>b>=19968&&b<=40959,"Yi Syllables":b=>b>=40960&&b<=42127,"Yi Radicals":b=>b>=42128&&b<=42191,"Hangul Jamo Extended-A":b=>b>=43360&&b<=43391,"Hangul Syllables":b=>b>=44032&&b<=55215,"Hangul Jamo Extended-B":b=>b>=55216&&b<=55295,"Private Use Area":b=>b>=57344&&b<=63743,"CJK Compatibility Ideographs":b=>b>=63744&&b<=64255,"Arabic Presentation Forms-A":b=>b>=64336&&b<=65023,"Vertical Forms":b=>b>=65040&&b<=65055,"CJK Compatibility Forms":b=>b>=65072&&b<=65103,"Small Form Variants":b=>b>=65104&&b<=65135,"Arabic Presentation Forms-B":b=>b>=65136&&b<=65279,"Halfwidth and Fullwidth Forms":b=>b>=65280&&b<=65519,Osage:b=>b>=66736&&b<=66815,"CJK Unified Ideographs Extension B":b=>b>=131072&&b<=173791};function b1(b){for(const o of b)if(Ay(o.charCodeAt(0)))return!0;return!1}function rv(b){for(const o of b)if(!zE(o.charCodeAt(0)))return!1;return!0}function zE(b){return!(eo.Arabic(b)||eo["Arabic Supplement"](b)||eo["Arabic Extended-A"](b)||eo["Arabic Presentation Forms-A"](b)||eo["Arabic Presentation Forms-B"](b))}function Ay(b){return!(b!==746&&b!==747&&(b<4352||!(eo["Bopomofo Extended"](b)||eo.Bopomofo(b)||eo["CJK Compatibility Forms"](b)&&!(b>=65097&&b<=65103)||eo["CJK Compatibility Ideographs"](b)||eo["CJK Compatibility"](b)||eo["CJK Radicals Supplement"](b)||eo["CJK Strokes"](b)||!(!eo["CJK Symbols and Punctuation"](b)||b>=12296&&b<=12305||b>=12308&&b<=12319||b===12336)||eo["CJK Unified Ideographs Extension A"](b)||eo["CJK Unified Ideographs"](b)||eo["Enclosed CJK Letters and Months"](b)||eo["Hangul Compatibility Jamo"](b)||eo["Hangul Jamo Extended-A"](b)||eo["Hangul Jamo Extended-B"](b)||eo["Hangul Jamo"](b)||eo["Hangul Syllables"](b)||eo.Hiragana(b)||eo["Ideographic Description Characters"](b)||eo.Kanbun(b)||eo["Kangxi Radicals"](b)||eo["Katakana Phonetic Extensions"](b)||eo.Katakana(b)&&b!==12540||!(!eo["Halfwidth and Fullwidth Forms"](b)||b===65288||b===65289||b===65293||b>=65306&&b<=65310||b===65339||b===65341||b===65343||b>=65371&&b<=65503||b===65507||b>=65512&&b<=65519)||!(!eo["Small Form Variants"](b)||b>=65112&&b<=65118||b>=65123&&b<=65126)||eo["Unified Canadian Aboriginal Syllabics"](b)||eo["Unified Canadian Aboriginal Syllabics Extended"](b)||eo["Vertical Forms"](b)||eo["Yijing Hexagram Symbols"](b)||eo["Yi Syllables"](b)||eo["Yi Radicals"](b))))}function Sy(b){return!(Ay(b)||function(o){return!!(eo["Latin-1 Supplement"](o)&&(o===167||o===169||o===174||o===177||o===188||o===189||o===190||o===215||o===247)||eo["General Punctuation"](o)&&(o===8214||o===8224||o===8225||o===8240||o===8241||o===8251||o===8252||o===8258||o===8263||o===8264||o===8265||o===8273)||eo["Letterlike Symbols"](o)||eo["Number Forms"](o)||eo["Miscellaneous Technical"](o)&&(o>=8960&&o<=8967||o>=8972&&o<=8991||o>=8996&&o<=9e3||o===9003||o>=9085&&o<=9114||o>=9150&&o<=9165||o===9167||o>=9169&&o<=9179||o>=9186&&o<=9215)||eo["Control Pictures"](o)&&o!==9251||eo["Optical Character Recognition"](o)||eo["Enclosed Alphanumerics"](o)||eo["Geometric Shapes"](o)||eo["Miscellaneous Symbols"](o)&&!(o>=9754&&o<=9759)||eo["Miscellaneous Symbols and Arrows"](o)&&(o>=11026&&o<=11055||o>=11088&&o<=11097||o>=11192&&o<=11243)||eo["CJK Symbols and Punctuation"](o)||eo.Katakana(o)||eo["Private Use Area"](o)||eo["CJK Compatibility Forms"](o)||eo["Small Form Variants"](o)||eo["Halfwidth and Fullwidth Forms"](o)||o===8734||o===8756||o===8757||o>=9984&&o<=10087||o>=10102&&o<=10131||o===65532||o===65533)}(b))}function Ty(b){return eo.Arabic(b)||eo["Arabic Supplement"](b)||eo["Arabic Extended-A"](b)||eo["Arabic Presentation Forms-A"](b)||eo["Arabic Presentation Forms-B"](b)}function nv(b){return b>=1424&&b<=2303||eo["Arabic Presentation Forms-A"](b)||eo["Arabic Presentation Forms-B"](b)}function sm(b,o){return!(!o&&nv(b)||b>=2304&&b<=3583||b>=3840&&b<=4255||eo.Khmer(b))}function x2(b){for(const o of b)if(nv(o.charCodeAt(0)))return!0;return!1}const Yp={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let iv=null,Mp=Yp.unavailable,om=null;const w1=function(b){b&&typeof b=="string"&&b.indexOf("NetworkError")>-1&&(Mp=Yp.error),iv&&iv(b)};function Ry(){Iy.fire(new m0("pluginStateChange",{pluginStatus:Mp,pluginURL:om}))}const Iy=new x0,C1=function(){return Mp},VE=function(){if(Mp!==Yp.deferred||!om)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Mp=Yp.loading,Ry(),om&&p0({url:om},b=>{b?w1(b):(Mp=Yp.loaded,Ry())})},am={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Mp===Yp.loaded||am.applyArabicShaping!=null,isLoading:()=>Mp===Yp.loading,setState(b){Mp=b.pluginStatus,om=b.pluginURL},isParsing:()=>Mp===Yp.parsing,isParsed:()=>Mp===Yp.parsed,getPluginURL:()=>om};class ou{constructor(o,g){this.zoom=o,g?(this.now=g.now,this.fadeDuration=g.fadeDuration,this.transition=g.transition,this.pitch=g.pitch,this.brightness=g.brightness,this.worldview=g.worldview,this.activeFloors=g.activeFloors):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(o){return function(g,et){for(const nt of g)if(!sm(nt.charCodeAt(0),et))return!1;return!0}(o,am.isLoaded())}}class Dy{constructor(o,g,et,nt,at){this.property=o,this.value=g,this.expression=function(lt,ft,gt,Rt,Mt){if(by(lt))return new Cy(lt,ft);if(v1(lt)||Array.isArray(lt)&&lt.length>0){const Lt=ev(lt,ft,gt,Rt,Mt);if(Lt.result==="error")throw new Error(Lt.value.map(Ht=>`${Ht.key}: ${Ht.message}`).join(", "));return Lt.value}{let Lt=lt;return typeof lt=="string"&&ft.type==="color"&&(Lt=Mo.parse(lt)),{kind:"constant",configDependencies:new Set,isIndoorDependent:!1,evaluate:()=>Lt}}}(g===void 0?o.specification.default:g,o.specification,et,nt,at)}isIndoorDependent(){return this.expression.isIndoorDependent}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(o,g,et,nt){return this.property.possiblyEvaluate(this,o,g,et,nt)}}class sv{constructor(o,g,et,nt){this.property=o,this.value=new Dy(o,void 0,g,et,nt)}transitioned(o,g){return new GE(this.property,this.value,g,Object.assign({},o.transition,this.transition),o.now)}untransitioned(){return new GE(this.property,this.value,null,{},0)}}class UE{constructor(o,g,et,nt){this._properties=o,this._values=Object.create(o.defaultTransitionablePropertyValues),this._scope=g,this._options=et,this._iconImageUseTheme=nt,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(o){return Rn(this._values[o].value.value)}setValue(o,g){this._values.hasOwnProperty(o)||(this._values[o]=new sv(this._values[o].property,this._scope,this._options,this._iconImageUseTheme)),this._values[o].value=new Dy(this._values[o].property,g===null?void 0:Rn(g),this._scope,this._options,this._iconImageUseTheme),this._values[o].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[o].value.expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[o].value.isIndoorDependent())}setTransitionOrValue(o,g){g&&(this._options=g);const et=this._properties.properties;if(o)for(const nt in o){const at=o[nt];if(nt.endsWith("-transition")){const lt=nt.slice(0,-11);et[lt]&&this.setTransition(lt,at)}else et.hasOwnProperty(nt)&&this.setValue(nt,at)}}getTransition(o){return Rn(this._values[o].transition)}setTransition(o,g){this._values.hasOwnProperty(o)||(this._values[o]=new sv(this._values[o].property)),this._values[o].transition=Rn(g)||void 0}serialize(){const o={};for(const g of Object.keys(this._values)){const et=this.getValue(g);et!==void 0&&(o[g]=et);const nt=this.getTransition(g);nt!==void 0&&(o[`${g}-transition`]=nt)}return o}transitioned(o,g){const et=new $E(this._properties);for(const nt of Object.keys(this._values))et._values[nt]=this._values[nt].transitioned(o,g._values[nt]);return et}untransitioned(){const o=new $E(this._properties);for(const g of Object.keys(this._values))o._values[g]=this._values[g].untransitioned();return o}isIndoorDependent(){return this._isIndoorDependent}}class GE{constructor(o,g,et,nt,at){const lt=nt.delay||0,ft=nt.duration||0;at=at||0,this.property=o,this.value=g,this.begin=at+lt,this.end=this.begin+ft,o.specification.transition&&(nt.delay||nt.duration)&&(this.prior=et)}possiblyEvaluate(o,g,et){const nt=o.now||0,at=this.value.possiblyEvaluate(o,g,et),lt=this.prior;if(lt){if(nt>this.end)return this.prior=null,at;if(this.value.isDataDriven())return this.prior=null,at;if(nt<this.begin)return lt.possiblyEvaluate(o,g,et);{const ft=(nt-this.begin)/(this.end-this.begin);return this.property.interpolate(lt.possiblyEvaluate(o,g,et),at,fp(ft))}}return at}}class $E{constructor(o){this._properties=o,this._values=Object.create(o.defaultTransitioningPropertyValues)}possiblyEvaluate(o,g,et){const nt=new ax(this._properties);for(const at of Object.keys(this._values))nt._values[at]=this._values[at].possiblyEvaluate(o,g,et);return nt}hasTransition(){for(const o of Object.keys(this._values))if(this._values[o].prior)return!0;return!1}}class HE{constructor(o,g,et,nt){this._properties=o,this._values=Object.create(o.defaultPropertyValues),this._scope=g,this._options=et,this._iconImageUseTheme=nt,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(o){return Rn(this._values[o].value)}setValue(o,g){this._values[o]=new Dy(this._values[o].property,g===null?void 0:Rn(g),this._scope,this._options,this._iconImageUseTheme),this._values[o].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[o].expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[o].isIndoorDependent())}serialize(){const o={};for(const g of Object.keys(this._values)){const et=this.getValue(g);et!==void 0&&(o[g]=et)}return o}possiblyEvaluate(o,g,et,nt){const at=new ax(this._properties);for(const lt of Object.keys(this._values))at._values[lt]=this._values[lt].possiblyEvaluate(o,g,et,nt);return at}isIndoorDependent(){return this._isIndoorDependent}}class ox{constructor(o,g,et,nt){this.property=o,this.value=g,this.parameters=et,this.iconImageUseTheme=nt}isConstant(){return this.value.kind==="constant"}constantOr(o){return this.value.kind==="constant"?this.value.value:o}evaluate(o,g,et,nt){return this.property.evaluate(this.value,this.parameters,o,g,et,nt,this.iconImageUseTheme)}}class ax{constructor(o){this._properties=o,this._values=Object.create(o.defaultPossiblyEvaluatedValues)}get(o){return this._values[o]}}class ns{constructor(o){this.specification=o}possiblyEvaluate(o,g){return o.expression.evaluate(g)}interpolate(o,g,et){const nt=em[this.specification.type];return nt?nt(o,g,et):o}}class hs{constructor(o,g){this.specification=o,this.overrides=g}possiblyEvaluate(o,g,et,nt,at){return o.expression.kind==="constant"||o.expression.kind==="camera"?new ox(this,{kind:"constant",value:o.expression.evaluate(g,null,{},et,nt,void 0,at)},g):new ox(this,o.expression,g,at)}interpolate(o,g,et){if(o.value.kind!=="constant"||g.value.kind!=="constant")return o;if(o.value.value===void 0||g.value.value===void 0)return new ox(this,{kind:"constant",value:void 0},o.parameters);const nt=em[this.specification.type];return nt?new ox(this,{kind:"constant",value:nt(o.value.value,g.value.value,et)},o.parameters):o}evaluate(o,g,et,nt,at,lt,ft){return o.kind==="constant"?o.value:o.evaluate(g,et,nt,at,lt,void 0,ft)}}class lx{constructor(o){this.specification=o}possiblyEvaluate(o,g,et,nt){return!!o.expression.evaluate(g,null,{},et,nt)}interpolate(){return!1}}class Fu{constructor(o){this.properties=o,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const g=new ou(0,{});for(const et in o){const nt=o[et];nt.specification.overridable&&this.overridableProperties.push(et);const at=this.defaultPropertyValues[et]=new Dy(nt,void 0),lt=this.defaultTransitionablePropertyValues[et]=new sv(nt);this.defaultTransitioningPropertyValues[et]=lt.untransitioned(),this.defaultPossiblyEvaluatedValues[et]=at.possiblyEvaluate(g)}}}Ps(hs,"DataDrivenProperty"),Ps(ns,"DataConstantProperty"),Ps(lx,"ColorRampProperty");var mn=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"modelNodeOverride":{"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360}},"modelNodeOverrides":{"*":{"type":"modelNodeOverride"}},"modelMaterialOverride":{"model-color":{"type":"color"},"model-color-mix-intensity":{"type":"number"},"model-opacity":{"type":"number"},"model-emissive-strength":{"type":"number"}},"modelMaterialOverrides":{"*":{"type":"modelMaterialOverride"}},"modelSourceModel":{"uri":{"type":"string"},"position":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[-180,-90],"maximum":[180,90]},"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360},"nodeOverrides":{"type":"modelNodeOverrides"},"materialOverrides":{"type":"modelMaterialOverrides"},"nodeOverrideNames":{"type":"array","value":"string"},"materialOverrideNames":{"type":"array","value":"string"},"featureProperties":{"type":"*"}},"modelSourceModels":{"*":{"type":"modelSourceModel"}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"},"models":{"type":"modelSourceModels"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"boolean","expression":{"interpolated":true,"parameters":["zoom","pitch","feature","feature-state","measure-light","distance-from-center"]},"property-type":"data-driven"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-unit-width":{"type":"number","minimum":1,"maximum":20,"default":3.1,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flip-roof-orientation":{"property-type":"data-driven","type":"boolean","default":false,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"use-theme":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor_source":{"sourceId":{"type":"string"},"sourceLayers":{"type":"array","value":"string"}},"indoor":{"*":{"type":"indoor_source"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"building-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]},"model-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{}}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function WE(b){return b instanceof Number||b instanceof String||b instanceof Boolean?b.valueOf():b}function Py(b){if(Array.isArray(b))return b.map(Py);if(b instanceof Object&&!(b instanceof Number||b instanceof String||b instanceof Boolean)){const o={};for(const g in b)o[g]=Py(b[g]);return o}return WE(b)}function H0(b){if(b===!0||b===!1)return!0;if(!Array.isArray(b)||b.length===0)return!1;switch(b[0]){case"has":return b.length>=2&&b[1]!=="$id"&&b[1]!=="$type";case"in":return b.length>=3&&(typeof b[1]!="string"||Array.isArray(b[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return b.length!==3||Array.isArray(b[1])||Array.isArray(b[2]);case"any":case"all":for(const o of b.slice(1))if(!H0(o)&&typeof o!="boolean")return!1;return!0;default:return!0}}function ky(b,o="",g=null,et="fill"){if(b==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};H0(b)||(b=Fy(b));const nt=b;let at=!0;try{at=function(Mt){if(!Ux(Mt))return Mt;let Lt=Py(Mt);return qE(Lt),Lt=ux(Lt),Lt}(nt)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(nt,null,2)}
        `)}let lt=null,ft=null;if(et!=="background"&&et!=="sky"&&et!=="slot"){ft=mn[`filter_${et}`];const Mt=Om(at,ft,o,g);if(Mt.result==="error")throw new Error(Mt.value.map(Lt=>`${Lt.key}: ${Lt.message}`).join(", "));lt=(Lt,Ht,Kt)=>Mt.value.evaluate(Lt,Ht,{},Kt)}let gt=null,Rt=null;if(at!==nt){const Mt=Om(nt,ft,o,g);if(Mt.result==="error")throw new Error(Mt.value.map(Lt=>`${Lt.key}: ${Lt.message}`).join(", "));gt=(Lt,Ht,Kt,Qt,sr)=>Mt.value.evaluate(Lt,Ht,{},Kt,void 0,void 0,Qt,sr),Rt=!kx(Mt.value.expression)}return{filter:lt,dynamicFilter:gt||void 0,needGeometry:XE(at),needFeature:!!Rt}}function ux(b){if(!Array.isArray(b))return b;const o=function(g){if(g2.has(g[0])){for(let et=1;et<g.length;et++)if(Ux(g[et]))return!0}return g}(b);return o===!0?o:o.map(g=>ux(g))}function qE(b){let o=!1;const g=[];if(b[0]==="case"){for(let et=1;et<b.length-1;et+=2)o=o||Ux(b[et]),g.push(b[et+1]);g.push(b[b.length-1])}else if(b[0]==="match"){o=o||Ux(b[1]);for(let et=2;et<b.length-1;et+=2)g.push(b[et+1]);g.push(b[b.length-1])}else if(b[0]==="step"){o=o||Ux(b[1]);for(let et=1;et<b.length-1;et+=2)g.push(b[et+1])}o&&(b.length=0,b.push("any",...g));for(let et=1;et<b.length;et++)qE(b[et])}function Ux(b){if(!Array.isArray(b))return!1;if((o=b[0])==="pitch"||o==="distance-from-center")return!0;var o;for(let g=1;g<b.length;g++)if(Ux(b[g]))return!0;return!1}const g2=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function y2(b,o){return b<o?-1:b>o?1:0}function XE(b){if(!Array.isArray(b))return!1;if(b[0]==="within"||b[0]==="distance")return!0;for(let o=1;o<b.length;o++)if(XE(b[o]))return!0;return!1}function Fy(b){if(!b)return!0;const o=b[0];return b.length<=1?o!=="any":o==="=="?By(b[1],b[2],"=="):o==="!="?A1(By(b[1],b[2],"==")):o==="<"||o===">"||o==="<="||o===">="?By(b[1],b[2],o):o==="any"?(g=b.slice(1),["any"].concat(g.map(Fy))):o==="all"?["all"].concat(b.slice(1).map(Fy)):o==="none"?["all"].concat(b.slice(1).map(Fy).map(A1)):o==="in"?My(b[1],b.slice(2)):o==="!in"?A1(My(b[1],b.slice(2))):o==="has"?Ny(b[1]):o!=="!has"||A1(Ny(b[1]));var g}function By(b,o,g){switch(b){case"$type":return[`filter-type-${g}`,o];case"$id":return[`filter-id-${g}`,o];default:return[`filter-${g}`,b,o]}}function My(b,o){if(o.length===0)return!1;switch(b){case"$type":return["filter-type-in",["literal",o]];case"$id":return["filter-id-in",["literal",o]];default:return o.length>200&&!o.some(g=>typeof g!=typeof o[0])?["filter-in-large",b,["literal",o.sort(y2)]]:["filter-in-small",b,["literal",o]]}}function Ny(b){switch(b){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",b]}}function A1(b){return["!",b]}const dx="";function F0(b,o){return o?`${b}${dx}${o}`:b}let KE;const ZE=()=>KE||(KE=new Fu({"icon-size":new hs(mn.layout_symbol["icon-size"]),"icon-image":new hs(mn.layout_symbol["icon-image"]),"icon-rotate":new hs(mn.layout_symbol["icon-rotate"]),"icon-offset":new hs(mn.layout_symbol["icon-offset"]),"text-size":new hs(mn.layout_symbol["text-size"]),"text-rotate":new hs(mn.layout_symbol["text-rotate"]),"text-offset":new hs(mn.layout_symbol["text-offset"])}));class YE{constructor(o,g,et,nt,at,lt){const ft=Om(o,mn.appearance.condition);if(ft.result==="success"&&(this.condition=ft.value),this.name=g,et){this.properties=new ax(ZE()),this.unevaluatedLayout=new HE(ZE(),nt,at,lt);for(const gt in et)this.unevaluatedLayout.setValue(gt,et[gt])}}isActive(o){return!(this.condition||!o.isHidden||this.name!=="hidden")||this.condition.evaluate(o.globals,o.feature,o.featureState,o.canonical)}getCondition(){return this.condition}getName(){return this.name}getProperty(o){return this.properties.get(o)}getUnevaluatedProperties(){return this.unevaluatedLayout}getUnevaluatedProperty(o){return this.unevaluatedLayout._values[o]}recalculate(o,g,et){this.unevaluatedLayout&&(this.properties=this.unevaluatedLayout.possiblyEvaluate(o,void 0,g,et))}serialize(){const o={};return o.condition=this.condition.expression.serialize(),this.name&&(o.name=this.name),this.unevaluatedLayout&&(o.properties=this.unevaluatedLayout.serialize()),o}hasIconProperties(){const o=this.hasProperty("icon-image"),g=this.hasProperty("icon-size"),et=this.hasProperty("icon-offset"),nt=this.hasProperty("icon-rotate");return o||g||et||nt}hasTextProperties(){const o=this.hasProperty("text-size"),g=this.hasProperty("text-offset"),et=this.hasProperty("text-rotate");return o||g||et}hasProperty(o){return this.getUnevaluatedProperty(o).value!==void 0}}const QE="-transition",W0=new Set(["fill","line","background","hillshade","raster"]);class Np extends x0{constructor(o,g,et,nt,at,lt){if(super(),this.id=o.id,this.fqid=F0(this.id,et),this.type=o.type,this.scope=et,this.lut=nt,this.options=at,this.iconImageUseTheme=lt,this.appearances=new Array,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.expressionDependencies={isIndoorDependent:!1,configDependencies:new Set},o.type!=="custom"){if(this.metadata=o.metadata,this.minzoom=o.minzoom,this.maxzoom=o.maxzoom,o.type&&o.type!=="background"&&o.type!=="sky"&&o.type!=="slot"){this.source=o.source,this.sourceLayer=o["source-layer"],this.filter=o.filter;const ft=Om(this.filter,mn[`filter_${o.type}`]);ft.result!=="error"&&(this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...ft.value.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||ft.value.isIndoorDependent)}if(o.slot&&(this.slot=o.slot),o.appearances&&this.setAppearances(o.appearances),g.layout&&(this._unevaluatedLayout=new HE(g.layout,this.scope,at,this.iconImageUseTheme),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._unevaluatedLayout.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._unevaluatedLayout.isIndoorDependent()),g.paint){this._transitionablePaint=new UE(g.paint,this.scope,at);for(const ft in o.paint)this.setPaintProperty(ft,o.paint[ft]);for(const ft in o.layout)this.setLayoutProperty(ft,o.layout[ft]);this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._transitionablePaint.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._transitionablePaint.isIndoorDependent(),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ax(g.paint)}}}onAdd(o){}onRemove(o){}isDraped(o){return!this.is3D(!0)&&W0.has(this.type)}getLayoutProperty(o){return o==="visibility"?this.visibility:this._unevaluatedLayout.getValue(o)}setLayoutProperty(o,g){if(this.type==="custom"&&o==="visibility")return void(this.visibility=g);const et=this._unevaluatedLayout;et._properties.properties[o]&&(et.setValue(o,g),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...et.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||et.isIndoorDependent(),o==="visibility"&&this.possiblyEvaluateVisibility())}setAppearances(o){this.appearances=[],o.forEach(g=>{this.appearances.push(new YE(g.condition,g.name,g.properties,this.scope,this.options,this.iconImageUseTheme))})}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(o){return o.endsWith(QE)?this._transitionablePaint.getTransition(o.slice(0,-11)):this._transitionablePaint.getValue(o)}isPaintProperty(o){return!!this._transitionablePaint._properties.properties[o]}setPaintProperty(o,g){const et=this._transitionablePaint,nt=et._properties.properties;if(o.endsWith(QE)){const Lt=o.slice(0,-11);return nt[Lt]&&et.setTransition(Lt,g||void 0),!1}if(!nt[o])return!1;const at=et._values[o],lt=at.value.isDataDriven(),ft=at.value;et.setValue(o,g),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...et.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||et.isIndoorDependent(),this._handleSpecialPaintPropertyUpdate(o);const gt=et._values[o].value,Rt=gt.isDataDriven(),Mt=o.endsWith("pattern")||o==="line-dasharray";return Rt||lt||Mt||this._handleOverridablePaintPropertyUpdate(o,ft,gt)}_handleSpecialPaintPropertyUpdate(o){}getProgramIds(){return null}getDefaultProgramParams(o,g,et){return null}_handleOverridablePaintPropertyUpdate(o,g,et){return!1}isHidden(o){return!!(this.minzoom&&o<this.minzoom)||!!(this.maxzoom&&o>=this.maxzoom)||this.visibility==="none"}updateTransitions(o){this._transitioningPaint=this._transitionablePaint.transitioned(o,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(o,g){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(o,void 0,g,this.iconImageUseTheme)),this.paint=this._transitioningPaint.possiblyEvaluate(o,void 0,g)}serialize(){const o={id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.appearances.length!==0&&(o.appearances=this.appearances.map(g=>g.serialize())),Vn(o,(g,et)=>!(g===void 0||et==="layout"&&!Object.keys(g).length||et==="paint"&&!Object.keys(g).length))}is3D(o){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(const o in this.paint._values){const g=this.paint.get(o);if(g instanceof ox&&_1(g.property.specification)&&(g.value.kind==="source"||g.value.kind==="composite")&&g.value.isStateDependent)return!0}for(const o of this.appearances)if(!f1(o.condition.expression))return!0;return!1}compileFilter(o){this._filterCompiled||(this._featureFilter=ky(this.filter,this.scope,o),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(o){this._stats&&(o.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}getAppearances(){return this.appearances}queryRenderedFeatures(o,g,et){return{}}queryRadius(o){}queryIntersectsFeature(o,g,et,nt,at,lt,ft,gt,Rt){}}const JE={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class S1{constructor(o,g){this._structArray=o,this._pos1=g*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}const _2=new ArrayBuffer(0);class hu{constructor(){this._reallocCount=0,this.capacity=0,this.length=0}static serialize(o,g){return o._trim(),g&&o.arrayBuffer&&g.add(o.arrayBuffer),{length:o.length,arrayBuffer:o.arrayBuffer}}static deserialize(o){const g=Object.create(this.prototype);return g.arrayBuffer=o.arrayBuffer,g.length=o.length,o.arrayBuffer?g.capacity=o.arrayBuffer.byteLength/g.bytesPerElement:(g.capacity=0,g.arrayBuffer=_2),g._refreshViews(),g}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(o){this.reserve(o),this.length=o}reserve(o){if(o>this.capacity){this._reallocCount++,this.capacity=Math.max(o,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const g=this.uint8;this._refreshViews(),g&&this.uint8.set(g)}}reserveForAdditional(o){this.reserve(this.length+o)}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...o){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...o){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Go(b,o=1){let g=0,et=0;return{members:b.map(nt=>{const at=JE[nt.type].BYTES_PER_ELEMENT,lt=g=_b(g,Math.max(o,at)),ft=nt.components||1;return et=Math.max(et,at),g+=at*ft,{name:nt.name,type:nt.type,components:ft,offset:lt}}),size:_b(g,Math.max(et,o)),alignment:o}}function _b(b,o){return Math.ceil(b/o)*o}class jm extends hu{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,g){const et=this.length;return this.resize(et+1),this.emplace(et,o,g)}emplace(o,g,et){const nt=2*o;return this.int16[nt+0]=g,this.int16[nt+1]=et,o}}jm.prototype.bytesPerElement=4,Ps(jm,"StructArrayLayout2i4");class Gx extends hu{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,g,et){const nt=this.length;return this.resize(nt+1),this.emplace(nt,o,g,et)}emplace(o,g,et,nt){const at=3*o;return this.int16[at+0]=g,this.int16[at+1]=et,this.int16[at+2]=nt,o}}Gx.prototype.bytesPerElement=6,Ps(Gx,"StructArrayLayout3i6");class $x extends hu{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,g,et,nt){const at=this.length;return this.resize(at+1),this.emplace(at,o,g,et,nt)}emplace(o,g,et,nt,at){const lt=4*o;return this.int16[lt+0]=g,this.int16[lt+1]=et,this.int16[lt+2]=nt,this.int16[lt+3]=at,o}}$x.prototype.bytesPerElement=8,Ps($x,"StructArrayLayout4i8");class lm extends hu{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o){const g=this.length;return this.resize(g+1),this.emplace(g,o)}emplace(o,g){return this.float32[1*o+0]=g,o}}lm.prototype.bytesPerElement=4,Ps(lm,"StructArrayLayout1f4");class ov extends hu{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,g,et){const nt=this.length;return this.resize(nt+1),this.emplace(nt,o,g,et)}emplace(o,g,et,nt){const at=4*o,lt=2*o;return this.int16[at+0]=g,this.int16[at+1]=et,this.float32[lt+1]=nt,o}}ov.prototype.bytesPerElement=8,Ps(ov,"StructArrayLayout2i1f8");class av extends hu{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,g,et){const nt=this.length;return this.resize(nt+1),this.emplace(nt,o,g,et)}emplace(o,g,et,nt){const at=4*o;return this.int16[at+0]=g,this.int16[at+1]=et,this.int16[at+2]=nt,o}}av.prototype.bytesPerElement=8,Ps(av,"StructArrayLayout3i8");class lv extends hu{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,g,et,nt,at){const lt=this.length;return this.resize(lt+1),this.emplace(lt,o,g,et,nt,at)}emplace(o,g,et,nt,at,lt){const ft=5*o;return this.int16[ft+0]=g,this.int16[ft+1]=et,this.int16[ft+2]=nt,this.int16[ft+3]=at,this.int16[ft+4]=lt,o}}lv.prototype.bytesPerElement=10,Ps(lv,"StructArrayLayout5i10");class Oy extends hu{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,g,et,nt,at,lt,ft){const gt=this.length;return this.resize(gt+1),this.emplace(gt,o,g,et,nt,at,lt,ft)}emplace(o,g,et,nt,at,lt,ft,gt){const Rt=6*o,Mt=12*o,Lt=3*o;return this.int16[Rt+0]=g,this.int16[Rt+1]=et,this.uint8[Mt+4]=nt,this.uint8[Mt+5]=at,this.uint8[Mt+6]=lt,this.uint8[Mt+7]=ft,this.float32[Lt+2]=gt,o}}Oy.prototype.bytesPerElement=12,Ps(Oy,"StructArrayLayout2i4ub1f12");class a0 extends hu{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,g,et){const nt=this.length;return this.resize(nt+1),this.emplace(nt,o,g,et)}emplace(o,g,et,nt){const at=3*o;return this.float32[at+0]=g,this.float32[at+1]=et,this.float32[at+2]=nt,o}}a0.prototype.bytesPerElement=12,Ps(a0,"StructArrayLayout3f12");class $p extends hu{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,g,et,nt,at){const lt=this.length;return this.resize(lt+1),this.emplace(lt,o,g,et,nt,at)}emplace(o,g,et,nt,at,lt){const ft=6*o,gt=3*o;return this.uint16[ft+0]=g,this.uint16[ft+1]=et,this.uint16[ft+2]=nt,this.uint16[ft+3]=at,this.float32[gt+2]=lt,o}}$p.prototype.bytesPerElement=12,Ps($p,"StructArrayLayout4ui1f12");class hx extends hu{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,g,et,nt){const at=this.length;return this.resize(at+1),this.emplace(at,o,g,et,nt)}emplace(o,g,et,nt,at){const lt=4*o;return this.uint16[lt+0]=g,this.uint16[lt+1]=et,this.uint16[lt+2]=nt,this.uint16[lt+3]=at,o}}hx.prototype.bytesPerElement=8,Ps(hx,"StructArrayLayout4ui8");class Ly extends hu{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,g,et,nt,at,lt){const ft=this.length;return this.resize(ft+1),this.emplace(ft,o,g,et,nt,at,lt)}emplace(o,g,et,nt,at,lt,ft){const gt=6*o;return this.int16[gt+0]=g,this.int16[gt+1]=et,this.int16[gt+2]=nt,this.int16[gt+3]=at,this.int16[gt+4]=lt,this.int16[gt+5]=ft,o}}Ly.prototype.bytesPerElement=12,Ps(Ly,"StructArrayLayout6i12");class cv extends hu{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,g,et,nt,at,lt,ft,gt,Rt,Mt,Lt,Ht){const Kt=this.length;return this.resize(Kt+1),this.emplace(Kt,o,g,et,nt,at,lt,ft,gt,Rt,Mt,Lt,Ht)}emplace(o,g,et,nt,at,lt,ft,gt,Rt,Mt,Lt,Ht,Kt){const Qt=12*o;return this.int16[Qt+0]=g,this.int16[Qt+1]=et,this.int16[Qt+2]=nt,this.int16[Qt+3]=at,this.uint16[Qt+4]=lt,this.uint16[Qt+5]=ft,this.uint16[Qt+6]=gt,this.uint16[Qt+7]=Rt,this.int16[Qt+8]=Mt,this.int16[Qt+9]=Lt,this.int16[Qt+10]=Ht,this.int16[Qt+11]=Kt,o}}cv.prototype.bytesPerElement=24,Ps(cv,"StructArrayLayout4i4ui4i24");class uv extends hu{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,g,et,nt,at,lt){const ft=this.length;return this.resize(ft+1),this.emplace(ft,o,g,et,nt,at,lt)}emplace(o,g,et,nt,at,lt,ft){const gt=10*o,Rt=5*o;return this.int16[gt+0]=g,this.int16[gt+1]=et,this.int16[gt+2]=nt,this.float32[Rt+2]=at,this.float32[Rt+3]=lt,this.float32[Rt+4]=ft,o}}uv.prototype.bytesPerElement=20,Ps(uv,"StructArrayLayout3i3f20");class zm extends hu{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,g,et,nt){const at=this.length;return this.resize(at+1),this.emplace(at,o,g,et,nt)}emplace(o,g,et,nt,at){const lt=4*o;return this.float32[lt+0]=g,this.float32[lt+1]=et,this.float32[lt+2]=nt,this.float32[lt+3]=at,o}}zm.prototype.bytesPerElement=16,Ps(zm,"StructArrayLayout4f16");class jy extends hu{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o){const g=this.length;return this.resize(g+1),this.emplace(g,o)}emplace(o,g){return this.uint32[1*o+0]=g,o}}jy.prototype.bytesPerElement=4,Ps(jy,"StructArrayLayout1ul4");class l0 extends hu{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,g){const et=this.length;return this.resize(et+1),this.emplace(et,o,g)}emplace(o,g,et){const nt=2*o;return this.uint16[nt+0]=g,this.uint16[nt+1]=et,o}}l0.prototype.bytesPerElement=4,Ps(l0,"StructArrayLayout2ui4");class zy extends hu{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,g,et,nt,at,lt,ft,gt,Rt,Mt,Lt,Ht,Kt){const Qt=this.length;return this.resize(Qt+1),this.emplace(Qt,o,g,et,nt,at,lt,ft,gt,Rt,Mt,Lt,Ht,Kt)}emplace(o,g,et,nt,at,lt,ft,gt,Rt,Mt,Lt,Ht,Kt,Qt){const sr=20*o,hr=10*o;return this.int16[sr+0]=g,this.int16[sr+1]=et,this.int16[sr+2]=nt,this.int16[sr+3]=at,this.int16[sr+4]=lt,this.float32[hr+3]=ft,this.float32[hr+4]=gt,this.float32[hr+5]=Rt,this.float32[hr+6]=Mt,this.int16[sr+14]=Lt,this.uint32[hr+8]=Ht,this.uint16[sr+18]=Kt,this.uint16[sr+19]=Qt,o}}zy.prototype.bytesPerElement=40,Ps(zy,"StructArrayLayout5i4f1i1ul2ui40");class Vy extends hu{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,g,et,nt,at,lt,ft){const gt=this.length;return this.resize(gt+1),this.emplace(gt,o,g,et,nt,at,lt,ft)}emplace(o,g,et,nt,at,lt,ft,gt){const Rt=8*o;return this.int16[Rt+0]=g,this.int16[Rt+1]=et,this.int16[Rt+2]=nt,this.int16[Rt+4]=at,this.int16[Rt+5]=lt,this.int16[Rt+6]=ft,this.int16[Rt+7]=gt,o}}Vy.prototype.bytesPerElement=16,Ps(Vy,"StructArrayLayout3i2i2i16");class Uy extends hu{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,g,et,nt,at){const lt=this.length;return this.resize(lt+1),this.emplace(lt,o,g,et,nt,at)}emplace(o,g,et,nt,at,lt){const ft=4*o,gt=8*o;return this.float32[ft+0]=g,this.float32[ft+1]=et,this.float32[ft+2]=nt,this.int16[gt+6]=at,this.int16[gt+7]=lt,o}}Uy.prototype.bytesPerElement=16,Ps(Uy,"StructArrayLayout2f1f2i16");class dv extends hu{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,g,et,nt,at,lt){const ft=this.length;return this.resize(ft+1),this.emplace(ft,o,g,et,nt,at,lt)}emplace(o,g,et,nt,at,lt,ft){const gt=20*o,Rt=5*o;return this.uint8[gt+0]=g,this.uint8[gt+1]=et,this.float32[Rt+1]=nt,this.float32[Rt+2]=at,this.float32[Rt+3]=lt,this.float32[Rt+4]=ft,o}}dv.prototype.bytesPerElement=20,Ps(dv,"StructArrayLayout2ub4f20");class _f extends hu{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,g,et){const nt=this.length;return this.resize(nt+1),this.emplace(nt,o,g,et)}emplace(o,g,et,nt){const at=3*o;return this.uint16[at+0]=g,this.uint16[at+1]=et,this.uint16[at+2]=nt,o}}_f.prototype.bytesPerElement=6,Ps(_f,"StructArrayLayout3ui6");class Hx extends hu{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o,g,et,nt,at,lt,ft,gt,Rt,Mt,Lt,Ht,Kt,Qt,sr,hr,ur,_r,br,Ir,Vr){const Mr=this.length;return this.resize(Mr+1),this.emplace(Mr,o,g,et,nt,at,lt,ft,gt,Rt,Mt,Lt,Ht,Kt,Qt,sr,hr,ur,_r,br,Ir,Vr)}emplace(o,g,et,nt,at,lt,ft,gt,Rt,Mt,Lt,Ht,Kt,Qt,sr,hr,ur,_r,br,Ir,Vr,Mr){const Hr=30*o,Zr=15*o,en=60*o;return this.int16[Hr+0]=g,this.int16[Hr+1]=et,this.int16[Hr+2]=nt,this.float32[Zr+2]=at,this.float32[Zr+3]=lt,this.uint16[Hr+8]=ft,this.uint16[Hr+9]=gt,this.uint32[Zr+5]=Rt,this.uint32[Zr+6]=Mt,this.uint32[Zr+7]=Lt,this.uint16[Hr+16]=Ht,this.uint16[Hr+17]=Kt,this.uint16[Hr+18]=Qt,this.float32[Zr+10]=sr,this.float32[Zr+11]=hr,this.uint8[en+48]=ur,this.uint8[en+49]=_r,this.uint8[en+50]=br,this.uint32[Zr+13]=Ir,this.int16[Hr+28]=Vr,this.uint8[en+58]=Mr,o}}Hx.prototype.bytesPerElement=60,Ps(Hx,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class hv extends hu{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o,g,et,nt,at,lt,ft,gt,Rt,Mt,Lt,Ht,Kt,Qt,sr,hr,ur,_r,br,Ir,Vr,Mr,Hr,Zr,en,Tn,ln,Fn,Ln,jn,Zn,Qn,Hn){const Wn=this.length;return this.resize(Wn+1),this.emplace(Wn,o,g,et,nt,at,lt,ft,gt,Rt,Mt,Lt,Ht,Kt,Qt,sr,hr,ur,_r,br,Ir,Vr,Mr,Hr,Zr,en,Tn,ln,Fn,Ln,jn,Zn,Qn,Hn)}emplace(o,g,et,nt,at,lt,ft,gt,Rt,Mt,Lt,Ht,Kt,Qt,sr,hr,ur,_r,br,Ir,Vr,Mr,Hr,Zr,en,Tn,ln,Fn,Ln,jn,Zn,Qn,Hn,Wn){const kn=20*o,In=40*o,Kn=80*o;return this.float32[kn+0]=g,this.float32[kn+1]=et,this.int16[In+4]=nt,this.int16[In+5]=at,this.int16[In+6]=lt,this.int16[In+7]=ft,this.int16[In+8]=gt,this.int16[In+9]=Rt,this.int16[In+10]=Mt,this.int16[In+11]=Lt,this.int16[In+12]=Ht,this.uint16[In+13]=Kt,this.uint16[In+14]=Qt,this.uint16[In+15]=sr,this.uint16[In+16]=hr,this.uint16[In+17]=ur,this.uint16[In+18]=_r,this.uint16[In+19]=br,this.uint16[In+20]=Ir,this.uint16[In+21]=Vr,this.uint16[In+22]=Mr,this.uint16[In+23]=Hr,this.uint16[In+24]=Zr,this.uint16[In+25]=en,this.uint16[In+26]=Tn,this.uint16[In+27]=ln,this.uint32[kn+14]=Fn,this.float32[kn+15]=Ln,this.float32[kn+16]=jn,this.float32[kn+17]=Zn,this.float32[kn+18]=Qn,this.uint8[Kn+76]=Hn,this.uint16[In+39]=Wn,o}}hv.prototype.bytesPerElement=80,Ps(hv,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class fv extends hu{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,g,et,nt,at,lt){const ft=this.length;return this.resize(ft+1),this.emplace(ft,o,g,et,nt,at,lt)}emplace(o,g,et,nt,at,lt,ft){const gt=6*o;return this.float32[gt+0]=g,this.float32[gt+1]=et,this.float32[gt+2]=nt,this.float32[gt+3]=at,this.float32[gt+4]=lt,this.float32[gt+5]=ft,o}}fv.prototype.bytesPerElement=24,Ps(fv,"StructArrayLayout6f24");class fx extends hu{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,g,et,nt,at){const lt=this.length;return this.resize(lt+1),this.emplace(lt,o,g,et,nt,at)}emplace(o,g,et,nt,at,lt){const ft=5*o;return this.float32[ft+0]=g,this.float32[ft+1]=et,this.float32[ft+2]=nt,this.float32[ft+3]=at,this.float32[ft+4]=lt,o}}fx.prototype.bytesPerElement=20,Ps(fx,"StructArrayLayout5f20");class pv extends hu{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,g,et,nt,at,lt,ft){const gt=this.length;return this.resize(gt+1),this.emplace(gt,o,g,et,nt,at,lt,ft)}emplace(o,g,et,nt,at,lt,ft,gt){const Rt=7*o;return this.float32[Rt+0]=g,this.float32[Rt+1]=et,this.float32[Rt+2]=nt,this.float32[Rt+3]=at,this.float32[Rt+4]=lt,this.float32[Rt+5]=ft,this.float32[Rt+6]=gt,o}}pv.prototype.bytesPerElement=28,Ps(pv,"StructArrayLayout7f28");class mv extends hu{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,g,et,nt,at,lt,ft,gt,Rt,Mt,Lt){const Ht=this.length;return this.resize(Ht+1),this.emplace(Ht,o,g,et,nt,at,lt,ft,gt,Rt,Mt,Lt)}emplace(o,g,et,nt,at,lt,ft,gt,Rt,Mt,Lt,Ht){const Kt=11*o;return this.float32[Kt+0]=g,this.float32[Kt+1]=et,this.float32[Kt+2]=nt,this.float32[Kt+3]=at,this.float32[Kt+4]=lt,this.float32[Kt+5]=ft,this.float32[Kt+6]=gt,this.float32[Kt+7]=Rt,this.float32[Kt+8]=Mt,this.float32[Kt+9]=Lt,this.float32[Kt+10]=Ht,o}}mv.prototype.bytesPerElement=44,Ps(mv,"StructArrayLayout11f44");class Wx extends hu{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,g,et,nt,at,lt,ft,gt,Rt){const Mt=this.length;return this.resize(Mt+1),this.emplace(Mt,o,g,et,nt,at,lt,ft,gt,Rt)}emplace(o,g,et,nt,at,lt,ft,gt,Rt,Mt){const Lt=9*o;return this.float32[Lt+0]=g,this.float32[Lt+1]=et,this.float32[Lt+2]=nt,this.float32[Lt+3]=at,this.float32[Lt+4]=lt,this.float32[Lt+5]=ft,this.float32[Lt+6]=gt,this.float32[Lt+7]=Rt,this.float32[Lt+8]=Mt,o}}Wx.prototype.bytesPerElement=36,Ps(Wx,"StructArrayLayout9f36");class q0 extends hu{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,g){const et=this.length;return this.resize(et+1),this.emplace(et,o,g)}emplace(o,g,et){const nt=2*o;return this.float32[nt+0]=g,this.float32[nt+1]=et,o}}q0.prototype.bytesPerElement=8,Ps(q0,"StructArrayLayout2f8");class Hp extends hu{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,g,et,nt){const at=this.length;return this.resize(at+1),this.emplace(at,o,g,et,nt)}emplace(o,g,et,nt,at){const lt=6*o;return this.uint32[3*o+0]=g,this.uint16[lt+2]=et,this.uint16[lt+3]=nt,this.uint16[lt+4]=at,o}}Hp.prototype.bytesPerElement=12,Ps(Hp,"StructArrayLayout1ul3ui12");class Vm extends hu{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o){const g=this.length;return this.resize(g+1),this.emplace(g,o)}emplace(o,g){return this.uint16[1*o+0]=g,o}}Vm.prototype.bytesPerElement=2,Ps(Vm,"StructArrayLayout1ui2");class xv extends hu{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,g,et,nt,at,lt,ft,gt,Rt,Mt,Lt,Ht,Kt,Qt,sr,hr){const ur=this.length;return this.resize(ur+1),this.emplace(ur,o,g,et,nt,at,lt,ft,gt,Rt,Mt,Lt,Ht,Kt,Qt,sr,hr)}emplace(o,g,et,nt,at,lt,ft,gt,Rt,Mt,Lt,Ht,Kt,Qt,sr,hr,ur){const _r=16*o;return this.float32[_r+0]=g,this.float32[_r+1]=et,this.float32[_r+2]=nt,this.float32[_r+3]=at,this.float32[_r+4]=lt,this.float32[_r+5]=ft,this.float32[_r+6]=gt,this.float32[_r+7]=Rt,this.float32[_r+8]=Mt,this.float32[_r+9]=Lt,this.float32[_r+10]=Ht,this.float32[_r+11]=Kt,this.float32[_r+12]=Qt,this.float32[_r+13]=sr,this.float32[_r+14]=hr,this.float32[_r+15]=ur,o}}xv.prototype.bytesPerElement=64,Ps(xv,"StructArrayLayout16f64");class Gy extends hu{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,g,et,nt,at,lt,ft){const gt=this.length;return this.resize(gt+1),this.emplace(gt,o,g,et,nt,at,lt,ft)}emplace(o,g,et,nt,at,lt,ft,gt){const Rt=10*o,Mt=5*o;return this.uint16[Rt+0]=g,this.uint16[Rt+1]=et,this.uint16[Rt+2]=nt,this.uint16[Rt+3]=at,this.float32[Mt+2]=lt,this.float32[Mt+3]=ft,this.float32[Mt+4]=gt,o}}Gy.prototype.bytesPerElement=20,Ps(Gy,"StructArrayLayout4ui3f20");class gv extends hu{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o){const g=this.length;return this.resize(g+1),this.emplace(g,o)}emplace(o,g){return this.int16[1*o+0]=g,o}}gv.prototype.bytesPerElement=2,Ps(gv,"StructArrayLayout1i2");class $y extends hu{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(o){const g=this.length;return this.resize(g+1),this.emplace(g,o)}emplace(o,g){return this.uint8[1*o+0]=g,o}}$y.prototype.bytesPerElement=1,Ps($y,"StructArrayLayout1ub1");class Hy extends S1{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Hy.prototype.size=40;class ew extends zy{get(o){return new Hy(this,o)}}Ps(ew,"CollisionBoxArray");class Wy extends S1{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(o){this._structArray.uint8[this._pos1+49]=o}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(o){this._structArray.uint8[this._pos1+50]=o}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(o){this._structArray.uint32[this._pos4+13]=o}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(o){this._structArray.uint8[this._pos1+58]=o}}Wy.prototype.size=60;class tw extends Hx{get(o){return new Wy(this,o)}}Ps(tw,"PlacedSymbolArray");class rw extends S1{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(o){this._structArray.uint32[this._pos4+14]=o}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(o){this._structArray.float32[this._pos4+18]=o}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}rw.prototype.size=80;class yv extends hv{get(o){return new rw(this,o)}}Ps(yv,"SymbolInstanceArray");class qy extends lm{getoffsetX(o){return this.float32[1*o+0]}}Ps(qy,"GlyphOffsetArray");class nw extends jm{getx(o){return this.int16[2*o+0]}gety(o){return this.int16[2*o+1]}}Ps(nw,"SymbolLineVertexArray");class _v extends S1{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}_v.prototype.size=12;class vv extends Hp{get(o){return new _v(this,o)}}Ps(vv,"FeatureIndexArray");class iw extends l0{geta_centroid_pos0(o){return this.uint16[2*o+0]}geta_centroid_pos1(o){return this.uint16[2*o+1]}}Ps(iw,"FillExtrusionCentroidArray");class Xy extends S1{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}Xy.prototype.size=6;class T1 extends Gx{get(o){return new Xy(this,o)}}Ps(T1,"FillExtrusionWallArray");const sw=Go([{name:"a_pos",components:2,type:"Int16"}],4),v2=Go([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),ow=Go([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Eu{constructor(o=[]){this.segments=o}_prepareSegment(o,g,et,nt){let at=this.segments[this.segments.length-1];return o>Eu.MAX_VERTEX_ARRAY_LENGTH&&bs(`Max vertices per segment is ${Eu.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${o}`),(!at||at.vertexLength+o>Eu.MAX_VERTEX_ARRAY_LENGTH||at.sortKey!==nt)&&(at={vertexOffset:g,primitiveOffset:et,vertexLength:0,primitiveLength:0},nt!==void 0&&(at.sortKey=nt),this.segments.push(at)),at}prepareSegment(o,g,et,nt){return this._prepareSegment(o,g.length,et.length,nt)}get(){return this.segments}destroy(){for(const o of this.segments)for(const g in o.vaos)o.vaos[g].destroy()}static simpleSegment(o,g,et,nt){return new Eu([{vertexOffset:o,primitiveOffset:g,vertexLength:et,primitiveLength:nt,vaos:{},sortKey:0}])}}function Ky(b,o){return 256*(b=pr(Math.floor(b),0,255))+pr(Math.floor(o),0,255)}Eu.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ps(Eu,"SegmentVector");const E2=Go([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),b2=Go([{name:"a_pattern_b",components:4,type:"Uint16"}]),w2=Go([{name:"a_dash",components:4,type:"Uint16"}]);class R1{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(o,g,et,nt){this.ids.push(Ev(o)),this.positions.push(g,et,nt)}eachPosition(o,g){const et=Ev(o);let nt=0,at=this.ids.length-1;for(;nt<at;){const lt=nt+at>>1;this.ids[lt]>=et?at=lt:nt=lt+1}for(;this.ids[nt]===et;)g(this.positions[3*nt],this.positions[3*nt+1],this.positions[3*nt+2]),nt++}static serialize(o,g){const et=new Float64Array(o.ids),nt=new Uint32Array(o.positions);return bv(et,nt,0,et.length-1),g&&(g.add(et.buffer),g.add(nt.buffer)),{ids:et,positions:nt}}static deserialize(o){const g=new R1;let et;g.ids=o.ids,g.positions=o.positions;for(const nt of g.ids)nt!==et&&g.uniqueIds.push(nt),et=nt;return g.indexed=!0,g}}function Ev(b){const o=+b;return Number.isSafeInteger(o)?o:Sx(String(b))}function bv(b,o,g,et){for(;g<et;){const nt=b[g+et>>1];let at=g-1,lt=et+1;for(;;){do at++;while(b[at]<nt);do lt--;while(b[lt]>nt);if(at>=lt)break;Zy(b,at,lt),Zy(o,3*at,3*lt),Zy(o,3*at+1,3*lt+1),Zy(o,3*at+2,3*lt+2)}lt-g<et-lt?(bv(b,o,g,lt),g=lt+1):(bv(b,o,lt+1,et),et=lt)}}function Zy(b,o,g){const et=b[o];b[o]=b[g],b[g]=et}Ps(R1,"FeaturePositionMap");class cm{constructor(o){this.gl=o.gl,this.initialized=!1}fetchUniformLocation(o,g){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(o,g),this.initialized=!0),!!this.location}set(o,g,et){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Yy extends cm{constructor(o){super(o),this.current=0}set(o,g,et){this.fetchUniformLocation(o,g)&&this.current!==et&&(this.current=et,this.gl.uniform1i(this.location,et))}}class ep extends cm{constructor(o){super(o),this.current=0}set(o,g,et){this.fetchUniformLocation(o,g)&&this.current!==et&&(this.current=et,this.gl.uniform1f(this.location,et))}}class X0 extends cm{constructor(o){super(o),this.current=[0,0]}set(o,g,et){this.fetchUniformLocation(o,g)&&(et[0]===this.current[0]&&et[1]===this.current[1]||(this.current=et,this.gl.uniform2f(this.location,et[0],et[1])))}}class I1 extends cm{constructor(o){super(o),this.current=[0,0,0]}set(o,g,et){this.fetchUniformLocation(o,g)&&(et[0]===this.current[0]&&et[1]===this.current[1]&&et[2]===this.current[2]||(this.current=et,this.gl.uniform3f(this.location,et[0],et[1],et[2])))}}class Qy extends cm{constructor(o){super(o),this.current=[0,0,0,0]}set(o,g,et){this.fetchUniformLocation(o,g)&&(et[0]===this.current[0]&&et[1]===this.current[1]&&et[2]===this.current[2]&&et[3]===this.current[3]||(this.current=et,this.gl.uniform4f(this.location,et[0],et[1],et[2],et[3])))}}class D1 extends cm{constructor(o){super(o),this.current=Mo.transparent.toPremultipliedRenderColor(null)}set(o,g,et){this.fetchUniformLocation(o,g)&&(et.r===this.current.r&&et.g===this.current.g&&et.b===this.current.b&&et.a===this.current.a||(this.current=et,this.gl.uniform4f(this.location,et.r,et.g,et.b,et.a)))}}const C2=new Float32Array(16);class P1 extends cm{constructor(o){super(o),this.current=C2}set(o,g,et){if(this.fetchUniformLocation(o,g)){if(et[12]!==this.current[12]||et[0]!==this.current[0])return this.current=et,void this.gl.uniformMatrix4fv(this.location,!1,et);for(let nt=1;nt<16;nt++)if(et[nt]!==this.current[nt]){this.current=et,this.gl.uniformMatrix4fv(this.location,!1,et);break}}}}const Jy=new Float32Array(9),A2=new Float32Array(4);class e_ extends cm{constructor(o){super(o),this.current=A2}set(o,g,et){if(this.fetchUniformLocation(o,g)){for(let nt=0;nt<4;nt++)if(et[nt]!==this.current[nt]){this.current=et,this.gl.uniformMatrix2fv(this.location,!1,et);break}}}}function wv(b){return[Ky(255*b.r,255*b.g),Ky(255*b.b,255*b.a)]}function k1(b,o,g,et,nt,at,lt,ft){return!!b&&(b.kind==="composite"||b.kind==="source"?b.evaluate(new ou(0,{brightness:at,worldview:ft}),o,g,nt,et,lt)==="none":b.value==="none")}class F1{constructor(o,g,et,nt){this.value=o,this.uniformNames=g.map(at=>`u_${at}`),this.type=et,this.context=nt}setUniform(o,g,et,nt,at){const lt=nt.constantOr(this.value);g.set(o,at,lt instanceof Mo?lt.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.kind==="constant"&&this.lutExpression.value==="none"?null:this.context.lut):lt)}getBinding(o,g){return this.type==="color"?new D1(o):new ep(o)}}class qx{constructor(o,g){this.uniformNames=g.map(et=>`u_${et}`),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(o,g){this.pixelRatio=o.pixelRatio||1,this.pattern=o.tl.concat(o.br),this.patternTransition=g?g.tl.concat(g.br):this.pattern}setUniform(o,g,et,nt,at){let lt=null;at!=="u_pattern"&&at!=="u_dash"||(lt=this.pattern),at==="u_pattern_b"&&(lt=this.patternTransition),at==="u_pixel_ratio"&&(lt=this.pixelRatio),lt&&g.set(o,at,lt)}getBinding(o,g){return g==="u_pattern"||g==="u_pattern_b"||g==="u_dash"?new Qy(o):new ep(o)}}class um{constructor(o,g,et,nt){this.expression=o,this.type=et,this.maxValue=0,this.paintVertexAttributes=g.map(at=>({name:`a_${at}`,type:"Float32",components:et==="color"?2:1,offset:0})),this.paintVertexArray=new nt}populatePaintArray(o,g,et,nt,at,lt,ft,gt){const Rt=this.paintVertexArray.length,Mt=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new ou(0,{brightness:lt,worldview:gt}),g,{},at,nt,ft):this.expression.kind==="constant"&&this.expression.value,Lt=k1(this.lutExpression,g,{},nt,at,lt,ft,gt);this.paintVertexArray.resize(o),this._setPaintValue(Rt,o,Mt,Lt?null:this.context.lut)}updatePaintArray(o,g,et,nt,at,lt,ft,gt){const Rt=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:ft,worldview:gt},et,nt,void 0,at):this.expression.kind==="constant"&&this.expression.value,Mt=k1(this.lutExpression,et,nt,at,void 0,ft,void 0,gt);this._setPaintValue(o,g,Rt,Mt?null:this.context.lut)}_setPaintValue(o,g,et,nt){if(this.type==="color"){const at=wv(et.toPremultipliedRenderColor(nt));for(let lt=o;lt<g;lt++)this.paintVertexArray.emplace(lt,at[0],at[1])}else{for(let at=o;at<g;at++)this.paintVertexArray.emplace(at,et);this.maxValue=Math.max(this.maxValue,Math.abs(et))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class dm{constructor(o,g,et,nt,at,lt){this.expression=o,this.uniformNames=g.map(ft=>`u_${ft}_t`),this.type=et,this.useIntegerZoom=nt,this.context=at,this.maxValue=0,this.paintVertexAttributes=g.map(ft=>({name:`a_${ft}`,type:"Float32",components:et==="color"?4:2,offset:0})),this.paintVertexArray=new lt}populatePaintArray(o,g,et,nt,at,lt,ft,gt){const Rt=this.expression.evaluate(new ou(this.context.zoom,{brightness:lt,worldview:gt}),g,{},at,nt,ft),Mt=this.expression.evaluate(new ou(this.context.zoom+1,{brightness:lt,worldview:gt}),g,{},at,nt,ft),Lt=k1(this.lutExpression,g,{},nt,at,lt,ft,gt),Ht=this.paintVertexArray.length;this.paintVertexArray.resize(o),this._setPaintValue(Ht,o,Rt,Mt,Lt?null:this.context.lut)}updatePaintArray(o,g,et,nt,at,lt,ft,gt){const Rt=this.expression.evaluate({zoom:this.context.zoom,brightness:ft,worldview:gt},et,nt,void 0,at),Mt=this.expression.evaluate({zoom:this.context.zoom+1,brightness:ft,worldview:gt},et,nt,void 0,at),Lt=k1(this.lutExpression,et,nt,at,void 0,ft,void 0,gt);this._setPaintValue(o,g,Rt,Mt,Lt?null:this.context.lut)}_setPaintValue(o,g,et,nt,at){if(this.type==="color"){const lt=wv(et.toPremultipliedRenderColor(at)),ft=wv(et.toPremultipliedRenderColor(at));for(let gt=o;gt<g;gt++)this.paintVertexArray.emplace(gt,lt[0],lt[1],ft[0],ft[1])}else{for(let lt=o;lt<g;lt++)this.paintVertexArray.emplace(lt,et,nt);this.maxValue=Math.max(this.maxValue,Math.abs(et),Math.abs(nt))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(o,g,et,nt,at){const lt=this.useIntegerZoom?Math.floor(et.zoom):et.zoom,ft=pr(this.expression.interpolationFactor(lt,this.context.zoom,this.context.zoom+1),0,1);g.set(o,at,ft)}getBinding(o,g){return new ep(o)}}class hm{constructor(o,g,et,nt,at){this.expression=o,this.layerId=at,this.paintVertexAttributes=(et==="array"?w2:E2).members;for(let lt=0;lt<g.length;++lt);this.paintVertexArray=new nt,this.paintTransitionVertexArray=new hx}populatePaintArray(o,g,et,nt){const at=this.paintVertexArray.length;this.paintVertexArray.resize(o),this._setPaintValues(at,o,g.patterns&&g.patterns[this.layerId],et)}updatePaintArray(o,g,et,nt,at,lt,ft){this._setPaintValues(o,g,et.patterns&&et.patterns[this.layerId],lt)}_setPaintValues(o,g,et,nt){if(!nt||!et)return;const at=nt[et[0]],lt=nt[et[1]];if(at){if(at){const{tl:ft,br:gt,pixelRatio:Rt}=at;for(let Mt=o;Mt<g;Mt++)this.paintVertexArray.emplace(Mt,ft[0],ft[1],gt[0],gt[1],Rt)}if(lt){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:ft,br:gt}=lt;for(let Rt=o;Rt<g;Rt++)this.paintTransitionVertexArray.emplace(Rt,ft[0],ft[1],gt[0],gt[1])}}}upload(o){const g=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,g)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=o.createVertexBuffer(this.paintTransitionVertexArray,b2.members,g))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class Um{constructor(o,g,et=()=>!0){this.binders={},this._buffers=[],this.context=g;const nt=[];for(const at in o.paint._values){const lt=o.paint.get(at);if(at.endsWith("-use-theme")||!et(at)||!(lt instanceof ox&&_1(lt.property.specification)))continue;const ft=T2(at,o.type),gt=lt.value,Rt=lt.property.specification.type,Mt=!!lt.property.useIntegerZoom,Lt=at==="line-dasharray"||at.endsWith("pattern"),Ht=o.paint.get(`${at}-use-theme`),Kt=at==="line-dasharray"&&o.layout.get("line-cap").value.kind!=="constant"||Ht&&Ht.value.kind!=="constant";if(gt.kind!=="constant"||Kt)if(gt.kind==="source"||Kt||Lt){const Qt=Cv(at,Rt,"source");this.binders[at]=Lt?new hm(gt,ft,Rt,Qt,o.id):new um(gt,ft,Rt,Qt),nt.push(`/a_${at}`)}else{const Qt=Cv(at,Rt,"composite");this.binders[at]=new dm(gt,ft,Rt,Mt,g,Qt),nt.push(`/z_${at}`)}else this.binders[at]=Lt?new qx(gt.value,ft):new F1(gt.value,ft,Rt,g),nt.push(`/u_${at}`);Ht&&(this.binders[at].lutExpression=Ht.value)}this.cacheKey=nt.sort().join("")}getMaxValue(o){const g=this.binders[o];return g instanceof um||g instanceof dm?g.maxValue:0}populatePaintArrays(o,g,et,nt,at,lt,ft,gt){for(const Rt in this.binders){const Mt=this.binders[Rt];Mt.context=this.context,(Mt instanceof um||Mt instanceof dm||Mt instanceof hm)&&Mt.populatePaintArray(o,g,et,nt,at,lt,ft,gt)}}setConstantPatternPositions(o,g){for(const et in this.binders){const nt=this.binders[et];nt instanceof qx&&nt.setConstantPatternPositions(o,g)}}getPatternTransitionVertexBuffer(o){const g=this.binders[o];return g instanceof hm?g.paintTransitionVertexBuffer:null}updatePaintArrays(o,g,et,nt,at,lt,ft,gt,Rt,Mt){let Lt=!1;const Ht=Object.keys(o),Kt=Ht.length!==0&&!gt,Qt=Kt?Ht:g.uniqueIds;this.context.lut=at.lut;for(const sr in this.binders){const hr=this.binders[sr];if(hr.context=this.context,(hr instanceof um||hr instanceof dm||hr instanceof hm)&&hr.expression&&hr.expression.kind&&hr.expression.kind!=="constant"&&(hr.expression.isStateDependent===!0||hr.expression.isLightConstant===!1)){const ur=at.paint.get(sr);hr.expression=ur.value;for(const _r of Qt){const br=o[_r.toString()];g.eachPosition(_r,(Ir,Vr,Mr)=>{const Hr=nt.feature(Ir);hr.updatePaintArray(Vr,Mr,Hr,br,lt,ft,Rt,Mt)})}if(!Kt)for(const _r of et.uniqueIds){const br=o[_r.toString()];et.eachPosition(_r,(Ir,Vr,Mr)=>{const Hr=nt.feature(Ir);hr.updatePaintArray(Vr,Mr,Hr,br,lt,ft,Rt,Mt)})}Lt=!0}}return Lt}defines(){const o=[];for(const g in this.binders){const et=this.binders[g];(et instanceof F1||et instanceof qx)&&o.push(...et.uniformNames.map(nt=>`#define HAS_UNIFORM_${nt}`))}return o}getPaintVertexBuffers(){return this._buffers}getUniforms(o){const g=[];for(const et in this.binders){const nt=this.binders[et];if(nt instanceof F1||nt instanceof qx||nt instanceof dm)for(const at of nt.uniformNames)g.push({name:at,property:et,binding:nt.getBinding(o,at)})}return g}setUniforms(o,g,et,nt,at){for(const{name:lt,property:ft,binding:gt}of et)this.binders[ft].setUniform(o,gt,at,nt.get(ft),lt)}updatePaintBuffers(){this._buffers=[];for(const o in this.binders){const g=this.binders[o];(g instanceof um||g instanceof dm||g instanceof hm)&&g.paintVertexBuffer&&this._buffers.push(g.paintVertexBuffer),g instanceof hm&&g.paintTransitionVertexBuffer&&this._buffers.push(g.paintTransitionVertexBuffer)}}upload(o){for(const g in this.binders){const et=this.binders[g];(et instanceof um||et instanceof dm||et instanceof hm)&&et.upload(o)}this.updatePaintBuffers()}destroy(){for(const o in this.binders){const g=this.binders[o];(g instanceof um||g instanceof dm||g instanceof hm)&&g.destroy()}}}class B0{constructor(o,g,et=()=>!0){this.programConfigurations={};for(const nt of o)this.programConfigurations[nt.id]=new Um(nt,g,et);this.needsUpload=!1,this._featureMap=new R1,this._featureMapWithoutIds=new R1,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(o,g,et,nt,at,lt,ft,gt,Rt){for(const Mt in this.programConfigurations)this.programConfigurations[Mt].populatePaintArrays(o,g,nt,at,lt,ft,gt,Rt);g.id!==void 0?this._featureMap.add(g.id,et,this._bufferOffset,o):(this._featureMapWithoutIds.add(this._idlessCounter,et,this._bufferOffset,o),this._idlessCounter+=1),this._bufferOffset=o,this.needsUpload=!0}updatePaintArrays(o,g,et,nt,at,lt,ft,gt){for(const Rt of et)this.needsUpload=this.programConfigurations[Rt.id].updatePaintArrays(o,this._featureMap,this._featureMapWithoutIds,g,Rt,nt,at,lt,ft||0,gt)||this.needsUpload}get(o){return this.programConfigurations[o]}upload(o){if(this.needsUpload){for(const g in this.programConfigurations)this.programConfigurations[g].upload(o);this.needsUpload=!1}}destroy(){for(const o in this.programConfigurations)this.programConfigurations[o].destroy()}}const S2={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function T2(b,o){return S2[b]||[b.replace(`${o}-`,"").replace(/-/g,"_")]}const R2={"line-pattern":{source:$p,composite:$p},"fill-pattern":{source:$p,composite:$p},"fill-extrusion-pattern":{source:$p,composite:$p},"line-dasharray":{source:hx,composite:hx}},I2={color:{source:q0,composite:zm},number:{source:lm,composite:q0}};function Cv(b,o,g){const et=R2[b];return et&&et[g]||I2[o][g]}Ps(F1,"ConstantBinder"),Ps(qx,"PatternConstantBinder"),Ps(um,"SourceExpressionBinder"),Ps(hm,"PatternCompositeBinder"),Ps(dm,"CompositeExpressionBinder"),Ps(Um,"ProgramConfiguration",{omit:["_buffers"]}),Ps(B0,"ProgramConfigurationSet");const Ap=ss/Math.PI/2,b0=5,t_=6,D2=16383,Xx=64,Av=[Xx,32,16],w0=-Ap,C0=Ap;function mx(b,o,g,et=Ap){return g=Bo(g),[b*Math.sin(g)*et,-o*et,b*Math.cos(g)*et]}function Kx(b,o,g){return mx(Math.cos(Bo(b)),Math.sin(Bo(b)),o,g)}const st=63710088e-1,d=2*Math.PI*st;class _e{constructor(o,g){if(isNaN(o)||isNaN(g))throw new Error(`Invalid LngLat object: (${o}, ${g})`);if(this.lng=+o,this.lat=+g,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new _e(kr(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(o){const g=Math.PI/180,et=this.lat*g,nt=o.lat*g,at=Math.sin(et)*Math.sin(nt)+Math.cos(et)*Math.cos(nt)*Math.cos((o.lng-this.lng)*g);return st*Math.acos(Math.min(at,1))}toBounds(o=0){const g=360*o/40075017,et=g/Math.cos(Math.PI/180*this.lat);return new ot({lng:this.lng-et,lat:this.lat-g},{lng:this.lng+et,lat:this.lat+g})}toEcef(o){return Kx(this.lat,this.lng,Ap+o*Ap/st)}static convert(o){if(o instanceof _e)return o;if(Array.isArray(o)&&(o.length===2||o.length===3))return new _e(Number(o[0]),Number(o[1]));if(!Array.isArray(o)&&typeof o=="object"&&o!==null)return new _e(Number("lng"in o?o.lng:o.lon),Number(o.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class ot{constructor(o,g){o&&(g?this.setSouthWest(o).setNorthEast(g):Array.isArray(o)&&o.length===4?this.setSouthWest([o[0],o[1]]).setNorthEast([o[2],o[3]]):this.setSouthWest(o[0]).setNorthEast(o[1]))}setNorthEast(o){return this._ne=o instanceof _e?new _e(o.lng,o.lat):_e.convert(o),this}setSouthWest(o){return this._sw=o instanceof _e?new _e(o.lng,o.lat):_e.convert(o),this}extend(o){const g=this._sw,et=this._ne;let nt,at;if(o instanceof _e)nt=o,at=o;else{if(!(o instanceof ot))return Array.isArray(o)?o.length===4||o.every(Array.isArray)?this.extend(ot.convert(o)):this.extend(_e.convert(o)):typeof o=="object"&&o!==null&&o.hasOwnProperty("lat")&&(o.hasOwnProperty("lon")||o.hasOwnProperty("lng"))?this.extend(_e.convert(o)):this;if(nt=o._sw,at=o._ne,!nt||!at)return this}return g||et?(g.lng=Math.min(nt.lng,g.lng),g.lat=Math.min(nt.lat,g.lat),et.lng=Math.max(at.lng,et.lng),et.lat=Math.max(at.lat,et.lat)):(this._sw=new _e(nt.lng,nt.lat),this._ne=new _e(at.lng,at.lat)),this}getCenter(){return new _e((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new _e(this.getWest(),this.getNorth())}getSouthEast(){return new _e(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(o){const{lng:g,lat:et}=_e.convert(o);let nt=this._sw.lng<=g&&g<=this._ne.lng;return this._sw.lng>this._ne.lng&&(nt=this._sw.lng>=g&&g>=this._ne.lng),this._sw.lat<=et&&et<=this._ne.lat&&nt}static convert(o){if(o)return o instanceof ot?o:new ot(o)}}const ut=0,mt=25.5;function xt(b){return d*Math.cos(b*Math.PI/180)}function Tt(b){return(180+b)/360}function kt(b){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+b*Math.PI/360)))/360}function $t(b,o){return b/xt(o)}function Xt(b){return 360*b-180}function rr(b){return 360/Math.PI*Math.atan(Math.exp((180-360*b)*Math.PI/180))-90}function tr(b,o){return b*xt(rr(o))}const nr=85.051129;function cr(b){return Math.cos(Bo(pr(b,-nr,nr)))}function lr(b,o){const g=pr(o,ut,mt),et=Math.pow(2,g);return cr(b)*d/(512*et)}function yr(b){return 1/Math.cos(b*Math.PI/180)}function xr(b,o=0){const g=Math.exp(Math.PI*(1-(b.y+o/ss)/(1<<b.z)*2));return 80150034*g/(g*g+1)/ss/(1<<b.z)}class Ar{constructor(o,g,et=0){this.x=+o,this.y=+g,this.z=+et}static fromLngLat(o,g=0){const et=_e.convert(o);return new Ar(Tt(et.lng),kt(et.lat),$t(g,et.lat))}toLngLat(){return new _e(Xt(this.x),rr(this.y))}toAltitude(){return tr(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/d*yr(rr(this.y))}}function Dr(b,o,g,et,nt,at,lt,ft,gt){const Rt=(o+et)/2,Mt=(g+nt)/2,Lt=new zn(Rt,Mt);ft(Lt),function(Ht,Kt,Qt,sr,hr,ur){const _r=Qt-hr,br=sr-ur;return Math.abs((sr-Kt)*_r-(Qt-Ht)*br)/Math.hypot(_r,br)}(Lt.x,Lt.y,at.x,at.y,lt.x,lt.y)>=gt?(Dr(b,o,g,Rt,Mt,at,Lt,ft,gt),Dr(b,Rt,Mt,et,nt,Lt,lt,ft,gt)):b.push(lt)}function Tr(b,o,g){let et=b[0],nt=et.x,at=et.y;o(et);const lt=[et];for(let ft=1;ft<b.length;ft++){const gt=b[ft],{x:Rt,y:Mt}=gt;o(gt),Dr(lt,nt,at,Rt,Mt,et,gt,o,g),nt=Rt,at=Mt,et=gt}return lt}function Wr(b,o,g,et){if(et(o,g)){const nt=o.add(g)._mult(.5);Wr(b,o,nt,et),Wr(b,nt,g,et)}else b.push(g)}function zr(b,o){let g=b[0];const et=[g];for(let nt=1;nt<b.length;nt++){const at=b[nt];Wr(et,g,at,o),g=at}return et}const $r=Math.pow(2,14)-1,Or=-$r-1;function Br(b,o){const g=Math.round(b.x*o),et=Math.round(b.y*o);return b.x=pr(g,Or,$r),b.y=pr(et,Or,$r),(g<b.x||g>b.x+1||et<b.y||et>b.y+1)&&bs("Geometry exceeds allowed extent, reduce your vector tile buffer size"),b}function Xr(b,o,g){const et=b.loadGeometry(),nt=b.extent,at=ss/nt;if(o&&g&&g.projection.isReprojectedInTileSpace){const lt=1<<o.z,{scale:ft,x:gt,y:Rt,projection:Mt}=g,Lt=Ht=>{const Kt=Xt((o.x+Ht.x/nt)/lt),Qt=rr((o.y+Ht.y/nt)/lt),sr=Mt.project(Kt,Qt);Ht.x=(sr.x*ft-gt)*nt,Ht.y=(sr.y*ft-Rt)*nt};for(let Ht=0;Ht<et.length;Ht++)if(b.type!==1)et[Ht]=Tr(et[Ht],Lt,1);else{const Kt=[];for(const Qt of et[Ht])Qt.x<0||Qt.x>=nt||Qt.y<0||Qt.y>=nt||(Lt(Qt),Kt.push(Qt));et[Ht]=Kt}}for(const lt of et)for(const ft of lt)Br(ft,at);return et}function an(b,o){return{type:b.type,id:b.id,properties:b.properties,geometry:o?Xr(b):[]}}class sn{constructor(o,g,et,nt,at){this.properties={},this.extent=et,this.type=0,this.id=void 0,this._pbf=o,this._geometry=-1,this._keys=nt,this._values=at,o.readFields(wn,this,g)}loadGeometry(){const o=this._pbf;o.pos=this._geometry;const g=o.readVarint()+o.pos,et=[];let nt,at=1,lt=0,ft=0,gt=0;for(;o.pos<g;){if(lt<=0){const Rt=o.readVarint();at=7&Rt,lt=Rt>>3}if(lt--,at===1||at===2)ft+=o.readSVarint(),gt+=o.readSVarint(),at===1&&(nt&&et.push(nt),nt=[]),nt&&nt.push(new zn(ft,gt));else{if(at!==7)throw new Error(`unknown command ${at}`);nt&&nt.push(nt[0].clone())}}return nt&&et.push(nt),et}bbox(){const o=this._pbf;o.pos=this._geometry;const g=o.readVarint()+o.pos;let et=1,nt=0,at=0,lt=0,ft=1/0,gt=-1/0,Rt=1/0,Mt=-1/0;for(;o.pos<g;){if(nt<=0){const Lt=o.readVarint();et=7&Lt,nt=Lt>>3}if(nt--,et===1||et===2)at+=o.readSVarint(),lt+=o.readSVarint(),at<ft&&(ft=at),at>gt&&(gt=at),lt<Rt&&(Rt=lt),lt>Mt&&(Mt=lt);else if(et!==7)throw new Error(`unknown command ${et}`)}return[ft,Rt,gt,Mt]}toGeoJSON(o,g,et){const nt=this.extent*Math.pow(2,et),at=this.extent*o,lt=this.extent*g,ft=this.loadGeometry();function gt(Ht){return[360*(Ht.x+at)/nt-180,360/Math.PI*Math.atan(Math.exp((1-2*(Ht.y+lt)/nt)*Math.PI))-90]}function Rt(Ht){return Ht.map(gt)}let Mt;if(this.type===1){const Ht=[];for(const Qt of ft)Ht.push(Qt[0]);const Kt=Rt(Ht);Mt=Ht.length===1?{type:"Point",coordinates:Kt[0]}:{type:"MultiPoint",coordinates:Kt}}else if(this.type===2){const Ht=ft.map(Rt);Mt=Ht.length===1?{type:"LineString",coordinates:Ht[0]}:{type:"MultiLineString",coordinates:Ht}}else{if(this.type!==3)throw new Error("unknown feature type");{const Ht=function(Qt){const sr=Qt.length;if(sr<=1)return[Qt];const hr=[];let ur,_r;for(let br=0;br<sr;br++){const Ir=Cn(Qt[br]);Ir!==0&&(_r===void 0&&(_r=Ir<0),_r===Ir<0?(ur&&hr.push(ur),ur=[Qt[br]]):ur&&ur.push(Qt[br]))}return ur&&hr.push(ur),hr}(ft),Kt=[];for(const Qt of Ht)Kt.push(Qt.map(Rt));Mt=Kt.length===1?{type:"Polygon",coordinates:Kt[0]}:{type:"MultiPolygon",coordinates:Kt}}}const Lt={type:"Feature",geometry:Mt,properties:this.properties};return this.id!=null&&(Lt.id=this.id),Lt}}function wn(b,o,g){b===1?o.id=g.readVarint():b===2?function(et,nt){const at=et.readVarint()+et.pos;for(;et.pos<at;){const lt=nt._keys[et.readVarint()],ft=nt._values[et.readVarint()];nt.properties[lt]=ft}}(g,o):b===3?o.type=g.readVarint():b===4&&(o._geometry=g.pos)}function Cn(b){let o=0;for(let g,et,nt=0,at=b.length,lt=at-1;nt<at;lt=nt++)g=b[nt],et=b[lt],o+=(et.x-g.x)*(g.y+et.y);return o}sn.types=["Unknown","Point","LineString","Polygon"];class Nn{constructor(o,g){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=o,this._keys=[],this._values=[],this._features=[],o.readFields(Jn,this,g),this.length=this._features.length}feature(o){if(o<0||o>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[o];const g=this._pbf.readVarint()+this._pbf.pos;return new sn(this._pbf,g,this.extent,this._keys,this._values)}}function Jn(b,o,g){b===15?o.version=g.readVarint():b===1?o.name=g.readString():b===5?o.extent=g.readVarint():b===2?o._features.push(g.pos):b===3?o._keys.push(g.readString()):b===4&&o._values.push(function(et){let nt=null;const at=et.readVarint()+et.pos;for(;et.pos<at;){const lt=et.readVarint()>>3;nt=lt===1?et.readString():lt===2?et.readFloat():lt===3?et.readDouble():lt===4?et.readVarint64():lt===5?et.readVarint():lt===6?et.readSVarint():lt===7?et.readBoolean():null}if(nt==null)throw new Error("unknown feature value");return nt}(g))}class yn{constructor(o,g){this.layers=o.readFields(Qr,{},g)}}function Qr(b,o,g){if(b===3){const et=new Nn(g,g.readVarint()+g.pos);et.length&&(o[et.name]=et)}}const Dn="3d_elevation_id",bn="level";class $n{constructor(){this._valid=!1}reset(o){return this.feature=o,this._valid=!0,this._geometry=o.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(o,g){return this._valid&&o(g(this._geometry)),this}require(o,g,et){return this.get(o,!0,g,et)}optional(o,g,et){return this.get(o,!1,g,et)}success(){return this._valid}get(o,g,et,nt){const at=this.feature.properties.hasOwnProperty(o)?+this.feature.properties[o]:void 0;return this._valid&&at!==void 0&&!Number.isNaN(at)?et(nt?nt(at):at):g&&(this._valid=!1),this}}class ls{constructor(o,g){this.featureFunc=o,this.vertexFunc=g}parseFeature(o,g,et){return this.featureFunc(o,g,et)}parseVertex(o,g,et){return this.vertexFunc(o,g,et)}}const As=new ls((b,o,g)=>b.reset(o).require(Dn,et=>{g.id=et}).optional("fixed_height_relative",et=>{g.constantHeight=et},_i.decodeRelativeHeight).geometry(et=>{g.bounds=et},os).success(),(b,o,g)=>b.reset(o).require(Dn,et=>{g.id=et}).require("elevation_idx",et=>{g.idx=et}).require("extent",et=>{g.extent=et}).require("height_relative",et=>{g.height=et},_i.decodeRelativeHeight).geometry(et=>{g.position=et},_i.getPoint).success()),is=new ls((b,o,g)=>b.reset(o).require(Dn,et=>{g.id=et}).optional("fixed_height",et=>{g.constantHeight=et},_i.decodeMetricHeight).geometry(et=>{g.bounds=et},os).success(),(b,o,g)=>b.reset(o).require(Dn,et=>{g.id=et}).require("elevation_idx",et=>{g.idx=et}).require("extent",et=>{g.extent=et}).require("height",et=>{g.height=et},_i.decodeMetricHeight).geometry(et=>{g.position=et},_i.getPoint).success());class _i{static getPoint(o){return qs(o[0][0].x,o[0][0].y)}static decodeRelativeHeight(o){return 1e-4*o*5}static decodeMetricHeight(o){return 1e-4*o}static getVersionSchema(o){return o?o==="1.0.1"?is:void 0:As}static parse(o){const g=[],et=[],nt=o.length,at=new $n;for(let lt=0;lt<nt;lt++){const ft=o.feature(lt),gt=ft.properties.version,Rt=_i.getVersionSchema(gt);if(Rt===void 0){bs(`Unknown elevation feature version number ${gt||"(unknown)"}`);continue}const Mt=ft.properties.type;if(!Mt)continue;const Lt=sn.types[ft.type];if(Lt==="Point"&&Mt==="curve_point"){const Ht={};Rt.parseVertex(at,ft,Ht)&&g.push(Ht)}else if(Lt==="Polygon"&&Mt==="curve_meta"){const Ht={};Rt.parseFeature(at,ft,Ht)&&et.push(Ht)}}return{vertices:g,features:et}}}class Ls{constructor(o,g){this.pos=o,this.dir=g}intersectsPlane(o,g,et){const nt=ru(g,this.dir);if(Math.abs(nt)<1e-6)return!1;const at=((o[0]-this.pos[0])*g[0]+(o[1]-this.pos[1])*g[1])/nt;return et[0]=this.pos[0]+this.dir[0]*at,et[1]=this.pos[1]+this.dir[1]*at,!0}}class Bs{constructor(o,g){this.pos=o,this.dir=g}intersectsPlane(o,g,et){const nt=Vs(g,this.dir);if(Math.abs(nt)<1e-6)return!1;const at=((o[0]-this.pos[0])*g[0]+(o[1]-this.pos[1])*g[1]+(o[2]-this.pos[2])*g[2])/nt;return et[0]=this.pos[0]+this.dir[0]*at,et[1]=this.pos[1]+this.dir[1]*at,et[2]=this.pos[2]+this.dir[2]*at,!0}closestPointOnSphere(o,g,et){if(function(Kt,Qt){var sr=Kt[0],hr=Kt[1],ur=Kt[2],_r=Qt[0],br=Qt[1],Ir=Qt[2];return Math.abs(sr-_r)<=dt*Math.max(1,Math.abs(sr),Math.abs(_r))&&Math.abs(hr-br)<=dt*Math.max(1,Math.abs(hr),Math.abs(br))&&Math.abs(ur-Ir)<=dt*Math.max(1,Math.abs(ur),Math.abs(Ir))}(this.pos,o)||g===0)return et[0]=et[1]=et[2]=0,!1;const[nt,at,lt]=this.dir,ft=this.pos[0]-o[0],gt=this.pos[1]-o[1],Rt=this.pos[2]-o[2],Mt=nt*nt+at*at+lt*lt,Lt=2*(ft*nt+gt*at+Rt*lt),Ht=Lt*Lt-4*Mt*(ft*ft+gt*gt+Rt*Rt-g*g);if(Ht<0){const Kt=Math.max(-Lt/2,0),Qt=ft+nt*Kt,sr=gt+at*Kt,hr=Rt+lt*Kt,ur=Math.hypot(Qt,sr,hr);return et[0]=Qt*g/ur,et[1]=sr*g/ur,et[2]=hr*g/ur,!1}{const Kt=(-Lt-Math.sqrt(Ht))/(2*Mt);if(Kt<0){const Qt=Math.hypot(ft,gt,Rt);return et[0]=ft*g/Qt,et[1]=gt*g/Qt,et[2]=Rt*g/Qt,!1}return et[0]=ft+nt*Kt,et[1]=gt+at*Kt,et[2]=Rt+lt*Kt,!0}}}class _s{constructor(o,g,et,nt,at){this.TL=o,this.TR=g,this.BR=et,this.BL=nt,this.horizon=at}static fromInvProjectionMatrix(o,g,et){const nt=[-1,1,1],at=[1,1,1],lt=[1,-1,1],ft=[-1,-1,1],gt=ys(nt,nt,o),Rt=ys(at,at,o),Mt=ys(lt,lt,o),Lt=ys(ft,ft,o);return new _s(gt,Rt,Mt,Lt,g/et)}}function Rs(b,o,g){let et=1/0,nt=-1/0;const at=[];for(const lt of b){tn(at,lt,o);const ft=Vs(at,g);et=Math.min(et,ft),nt=Math.max(nt,ft)}return[et,nt]}function Qs(b,o){let g=!0;for(let et=0;et<b.planes.length;et++){const nt=b.planes[et];let at=0;for(let lt=0;lt<o.length;lt++)at+=+(Vs(nt,o[lt])+nt[3]>=0);if(at===0)return 0;at!==o.length&&(g=!1)}return g?2:1}function _o(b,o){for(const g of b.projections){const et=Rs(o,b.points[0],g.axis);if(g.projection[1]<et[0]||g.projection[0]>et[1])return 0}return 1}function Xo(b,o){let g=0;const et=[0,0,0,0];for(let lt=0;lt<b.length;lt++)et[0]=b[lt][0],et[1]=b[lt][1],et[2]=b[lt][2],et[3]=1,(nt=et)[0]*(at=o)[0]+nt[1]*at[1]+nt[2]*at[2]+nt[3]*at[3]>=0&&g++;var nt,at;return g}class Al{constructor(o,g){this.points=o||new Array(8).fill([0,0,0]),this.planes=g||new Array(6).fill([0,0,0,0]),this.bounds=zs.fromPoints(this.points),this.projections=[],this.frustumEdges=[tn([],this.points[2],this.points[3]),tn([],this.points[0],this.points[3]),tn([],this.points[4],this.points[0]),tn([],this.points[5],this.points[1]),tn([],this.points[6],this.points[2]),tn([],this.points[7],this.points[3])];for(const et of this.frustumEdges){const nt=[0,-et[2],et[1]],at=[et[2],0,-et[0]];this.projections.push({axis:nt,projection:Rs(this.points,this.points[0],nt)}),this.projections.push({axis:at,projection:Rs(this.points,this.points[0],at)})}}static fromInvProjectionMatrix(o,g,et,nt){const at=Math.pow(2,et),lt=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(Rt=>{const Mt=ga([],Rt,o),Lt=1/Mt[3]/g*at;return(Ht=Mt)[0]=(Kt=Mt)[0]*(Qt=[Lt,Lt,nt?1/Mt[3]:Lt,Lt])[0],Ht[1]=Kt[1]*Qt[1],Ht[2]=Kt[2]*Qt[2],Ht[3]=Kt[3]*Qt[3],Ht;var Ht,Kt,Qt}),ft=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(Rt=>{const Mt=ws([],ks([],tn([],lt[Rt[0]],lt[Rt[1]]),tn([],lt[Rt[2]],lt[Rt[1]]))),Lt=-Vs(Mt,lt[Rt[1]]);return Mt.concat(Lt)}),gt=[];for(let Rt=0;Rt<lt.length;Rt++)gt.push([lt[Rt][0],lt[Rt][1],lt[Rt][2]]);return new Al(gt,ft)}intersectsPrecise(o,g,et){for(let nt=0;nt<g.length;nt++)if(!Xo(o,g[nt]))return 0;for(let nt=0;nt<this.planes.length;nt++)if(!Xo(o,this.planes[nt]))return 0;for(const nt of et)for(const at of this.frustumEdges){const lt=ks([],nt,at),ft=Fr(lt);if(ft===0)continue;gn(lt,lt,1/ft);const gt=Rs(this.points,this.points[0],lt),Rt=Rs(o,this.points[0],lt);if(gt[0]>Rt[1]||Rt[0]>gt[1])return 0}return 1}containsPoint(o){for(const g of this.planes){const et=g[3];if(Vs([g[0],g[1],g[2]],o)+et<0)return!1}return!0}}class zs{static fromPoints(o){const g=[1/0,1/0,1/0],et=[-1/0,-1/0,-1/0];for(const nt of o)Lr(g,g,nt),_n(et,et,nt);return new zs(g,et)}static fromTileIdAndHeight(o,g,et){const nt=1<<o.canonical.z,at=o.canonical.x,lt=o.canonical.y;return new zs([at/nt,lt/nt,g],[(at+1)/nt,(lt+1)/nt,et])}static applyTransform(o,g){const et=o.getCorners();for(let nt=0;nt<et.length;++nt)ys(et[nt],et[nt],g);return zs.fromPoints(et)}static applyTransformFast(o,g){const et=[g[12],g[13],g[14]],nt=[...et];for(let at=0;at<3;at++)for(let lt=0;lt<3;lt++){const ft=g[4*lt+at],gt=ft*o.min[lt],Rt=ft*o.max[lt];et[at]+=Math.min(gt,Rt),nt[at]+=Math.max(gt,Rt)}return new zs(et,nt)}static projectAabbCorners(o,g){const et=o.getCorners();for(let nt=0;nt<et.length;++nt)ys(et[nt],et[nt],g);return et}constructor(o,g){this.min=o,this.max=g,this.center=gn([],dr([],this.min,this.max),.5)}quadrant(o){const g=[o%2==0,o<2],et=fn(this.min),nt=fn(this.max);for(let at=0;at<g.length;at++)et[at]=g[at]?this.min[at]:this.center[at],nt[at]=g[at]?this.center[at]:this.max[at];return nt[2]=this.max[2],new zs(et,nt)}distanceX(o){return Math.max(Math.min(this.max[0],o[0]),this.min[0])-o[0]}distanceY(o){return Math.max(Math.min(this.max[1],o[1]),this.min[1])-o[1]}distanceZ(o){return Math.max(Math.min(this.max[2],o[2]),this.min[2])-o[2]}getCorners(){const o=this.min,g=this.max;return[[o[0],o[1],o[2]],[g[0],o[1],o[2]],[g[0],g[1],o[2]],[o[0],g[1],o[2]],[o[0],o[1],g[2]],[g[0],o[1],g[2]],[g[0],g[1],g[2]],[o[0],g[1],g[2]]]}intersects(o){return this.intersectsAabb(o.bounds)?Qs(o,this.getCorners()):0}intersectsFlat(o){return this.intersectsAabb(o.bounds)?Qs(o,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(o,g){return g||this.intersects(o)?_o(o,this.getCorners()):0}intersectsPreciseFlat(o,g){return g||this.intersectsFlat(o)?_o(o,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(o){for(let g=0;g<3;++g)if(this.min[g]>o.max[g]||o.min[g]>this.max[g])return!1;return!0}intersectsAabbXY(o){return!(this.min[0]>o.max[0]||o.min[0]>this.max[0]||this.min[1]>o.max[1]||o.min[1]>this.max[1])}encapsulate(o){for(let g=0;g<3;g++)this.min[g]=Math.min(this.min[g],o.min[g]),this.max[g]=Math.max(this.max[g],o.max[g])}encapsulatePoint(o){for(let g=0;g<3;g++)this.min[g]=Math.min(this.min[g],o[g]),this.max[g]=Math.max(this.max[g],o[g])}closestPoint(o){return[Math.max(Math.min(this.max[0],o[0]),this.min[0]),Math.max(Math.min(this.max[1],o[1]),this.min[1]),Math.max(Math.min(this.max[2],o[2]),this.min[2])]}}Ps(zs,"Aabb");class El{constructor(o,g){this.feature=o,this.metersToTile=g,this.index=0}get(){const o=this.feature.vertices[this.index],g=this.feature.vertexProps[this.index].dir,et=g[1],nt=-g[0],at=(o.extent+1)*this.metersToTile;return[new zn(Math.trunc(o.position[0]+et*at),Math.trunc(o.position[1]+nt*at)),new zn(Math.trunc(o.position[0]-et*at),Math.trunc(o.position[1]-nt*at))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class mo{constructor(o,g,et,nt,at,lt){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this._tmpVec2=[qn(),qn(),qn(),qn(),qn(),qn(),qn()],this.id=o,this.heightRange={min:et,max:et},this.safeArea=g,this.constantHeight=et,this.constantHeight==null&&(this.constantHeight!=null||nt.length!==0)){this.vertices=nt,this.edges=at,this.edges=this.edges.filter(ft=>{return ft.a<this.vertices.length&&ft.b<this.vertices.length&&!((gt=this.vertices[ft.a].position)[0]===(Rt=this.vertices[ft.b].position)[0]&&gt[1]===Rt[1]);var gt,Rt}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const ft of this.vertices)this.vertexProps.push({dir:qs(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,ft.height),this.heightRange.max=Math.max(this.heightRange.max,ft.height);for(const ft of this.edges){const gt=this.vertices[ft.a].position,Rt=this.vertices[ft.b].position,Mt=Kl(qn(),Rt,gt),Lt=Wl(Mt),Ht=tu(qn(),Mt,1/Lt);this.edgeProps.push({vec:Mt,dir:Ht,len:Lt});const Kt=this.vertexProps[ft.a].dir,Qt=this.vertexProps[ft.b].dir;Eo(Kt,Kt,Ht),Eo(Qt,Qt,Ht)}for(const ft of this.vertexProps)ft.dir[0]===0&&ft.dir[1]===0||Zo(ft.dir,ft.dir);this.tessellate(lt)}}pointElevation(o){if(this.constantHeight!=null)return this.constantHeight;const g=this.getClosestEdge(o);if(g==null)return 0;const[et,nt]=g;return so(this.vertices[this.edges[et].a].height,this.vertices[this.edges[et].b].height,nt)}computeSlopeNormal(o,g){const et=this.getClosestEdge(o);if(!et)return Cr(0,0,1);const nt=et[0],at=this.edges[nt],lt=this.edgeProps[nt].vec,ft=Cr(lt[0],lt[1],(this.vertices[at.b].height-this.vertices[at.a].height)*g),gt=Cr(ft[1],-ft[0],0);ks(gt,gt,ft);const Rt=Fr(gt);return Rt>0?gn(gt,gt,1/Rt):Sr(gt,0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(o){if(this.edges.length===0)return;let g=0,et=Number.POSITIVE_INFINITY,nt=0;const[at,lt,ft,gt,Rt,Mt,Lt]=this._tmpVec2;Gs(Lt,o.x,o.y);const Ht=new Ls(Lt,null);for(let Kt=0;Kt<this.edges.length;Kt++){const Qt=this.edges[Kt],sr=this.edgeProps[Kt].dir;Ht.dir=sr;const hr=this.vertices[Qt.a].position,ur=this.vertices[Qt.b].position,_r=Ht.intersectsPlane(hr,this.vertexProps[Qt.a].dir,at),br=Ht.intersectsPlane(ur,this.vertexProps[Qt.b].dir,lt);if(!_r||!br)continue;Kl(ft,lt,at),Kl(gt,Lt,at);const Ir=ru(ft,ft),Vr=Ir>0?ru(gt,ft)/Ir:0,Mr=pr(Vr,0,1),Hr=Math.abs((Vr-Mr)*this.edgeProps[Kt].len);Kl(Rt,Lt,hr),Gs(Mt,sr[1],-sr[0]);const Zr=Hr+Math.abs(ru(Rt,Mt));Zr<et&&(g=Kt,et=Zr,nt=Mr)}return[g,nt]}tessellate(o){const g=Jr(),et=Jr(),nt=Jr(),at=Jr();for(let lt=this.edges.length-1;lt>=0;--lt){const ft=this.edges[lt].a,gt=this.edges[lt].b,{position:Rt,height:Mt,extent:Lt}=this.vertices[ft],{position:Ht,height:Kt,extent:Qt}=this.vertices[gt],sr=this.vertexProps[ft].dir,hr=this.vertexProps[gt].dir;if(Sr(g,Rt[0]/o,Rt[1]/o,Mt),Sr(et,Ht[0]/o,Ht[1]/o,Kt),Sr(nt,sr[1],-sr[0],0),gn(nt,nt,Lt),Sr(at,hr[1],-hr[0],0),gn(at,at,Qt),this.distSqLines(Cr(g[0]+.5*nt[0],g[1]+.5*nt[1],g[2]+.5*nt[2]),Cr(et[0]-.5*at[0],et[1]-.5*at[1],et[2]-.5*at[2]),Cr(g[0]-.5*nt[0],g[1]-.5*nt[1],g[2]-.5*nt[2]),Cr(et[0]+.5*at[0],et[1]+.5*at[1],et[2]+.5*at[2]))<=.0025000000000000005)continue;const ur=this.vertices.length,_r=Eo(qn(),Rt,Ht);this.vertices.push({position:tu(_r,_r,.5),height:.5*(Mt+Kt),extent:.5*(Lt+Qt)});const br=Eo(qn(),sr,hr);this.vertexProps.push({dir:Zo(br,br)}),this.edges.splice(lt,1),this.edgeProps.splice(lt,1),this.edges.push({a:ft,b:ur}),this.edges.push({a:ur,b:gt});const Ir=Kl(qn(),this.vertices[ur].position,Rt),Vr=Wl(Ir),Mr={vec:Ir,dir:tu(qn(),Ir,1/Vr),len:Vr};this.edgeProps.push(Mr),this.edgeProps.push(Mr)}}distSqLines(o,g,et,nt){const at=gr(Jr(),g,o),lt=gr(Jr(),nt,et),ft=gr(Jr(),o,et),gt=Vs(at,at),Rt=Vs(at,lt),Mt=Vs(at,ft),Lt=Vs(lt,lt),Ht=Vs(lt,ft),Kt=gt*Lt-Rt*Rt;if(Kt===0)return rs(lo(at,et,nt,Vs(ft,lt)/Vs(lt,lt)),o);const Qt=(gt*Ht-Rt*Mt)/Kt;return rs(lo(at,o,g,(Rt*Ht-Mt*Lt)/Kt),lo(lt,et,nt,Qt))}}class Dl{static parseFrom(o,g){const et=_i.parse(o);if(!et)return[];let{vertices:nt,features:at}=et;const lt=1/xr(g);at.sort((Mt,Lt)=>Mt.id-Lt.id),nt.sort((Mt,Lt)=>Mt.id-Lt.id||Mt.idx-Lt.idx),nt=nt.filter((Mt,Lt,Ht)=>Lt===Ht.findIndex(Kt=>Kt.id===Mt.id&&Kt.idx===Mt.idx));const ft=new Array;let gt=0;const Rt=nt.length;for(const Mt of at){if(Mt.constantHeight){ft.push(new mo(Mt.id,Mt.bounds,Mt.constantHeight));continue}for(;gt!==Rt&&nt[gt].id<Mt.id;)gt++;if(gt===Rt||nt[gt].id!==Mt.id)continue;const Lt=new Array,Ht=new Array,Kt=gt;for(;gt!==Rt&&nt[gt].id===Mt.id;){const Qt=nt[gt];if(Lt.push({position:Qt.position,height:Qt.height,extent:Qt.extent}),gt!==Kt&&nt[gt-1].idx===Qt.idx-1){const sr=gt-Kt;Ht.push({a:sr-1,b:sr})}gt++}ft.push(new mo(Mt.id,Mt.bounds,void 0,Lt,Ht,lt))}return ft}static getElevationFeature(o,g){if(!g)return;const et=+o.properties[Dn];return Number.isNaN(et)?void 0:g.find(nt=>nt.id===et)}}class Vl{constructor(o,g){this.zScale=1,this.xOffset=0,this.yOffset=0,o.equals(g)||(this.zScale=Math.pow(2,g.z-o.z),this.xOffset=(o.x*this.zScale-g.x)*ss,this.yOffset=(o.y*this.zScale-g.y)*ss)}constantElevation(o,g){if(o.constantHeight!=null)return this.computeBiasedHeight(o.constantHeight,g)}pointElevation(o,g,et){const nt=this.constantElevation(g,et);return nt??(o.x=o.x*this.zScale+this.xOffset,o.y=o.y*this.zScale+this.yOffset,this.computeBiasedHeight(g.pointElevation(o),et))}computeBiasedHeight(o,g){return g<=0?o:o+g*vr(0,g,o>=0?o:Math.abs(.5*o))}}Ps(mo,"ElevationFeature");class Ml{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(g=>g.fqid),this.index=o.index,this.hasPattern=!1,this.projection=o.projection,this.layoutVertexArray=new jm,this.indexArray=new _f,this.segments=new Eu,this.programConfigurations=new B0(o.layers,{zoom:o.zoom,lut:o.lut}),this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new lm),this.worldview=o.worldview,this.hasAppearances=null}updateFootprints(o,g){}updateAppearances(o,g,et,nt){}populate(o,g,et,nt){const at=this.layers[0],lt=[];let ft=null;at.type==="circle"&&(ft=at.layout.get("circle-sort-key"));for(const{feature:Rt,id:Mt,index:Lt,sourceLayerIndex:Ht}of o){const Kt=this.layers[0]._featureFilter.needGeometry,Qt=an(Rt,Kt);if(!this.layers[0]._featureFilter.filter(new ou(this.zoom,{worldview:this.worldview,activeFloors:g.activeFloors}),Qt,et))continue;const sr=ft?ft.evaluate(Qt,{},et):void 0,hr={id:Mt,properties:Rt.properties,type:Rt.type,sourceLayerIndex:Ht,index:Lt,geometry:Kt?Qt.geometry:Xr(Rt,et,nt),patterns:{},sortKey:sr};lt.push(hr)}ft&&lt.sort((Rt,Mt)=>Rt.sortKey-Mt.sortKey);let gt=null;nt.projection.name==="globe"&&(this.globeExtVertexArray=new Ly,gt=nt.projection);for(const Rt of lt){const{geometry:Mt,index:Lt,sourceLayerIndex:Ht}=Rt,Kt=o[Lt].feature;this.addFeature(Rt,Mt,Lt,g.availableImages,et,gt,g.brightness,g.elevationFeatures),g.featureIndex.insert(Kt,Mt,Lt,Ht,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(o,g,et,nt,at,lt,ft){this.programConfigurations.updatePaintArrays(o,g,at,et,nt,lt,ft,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,sw.members),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=o.createVertexBuffer(this.globeExtVertexArray,ow.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=o.createVertexBuffer(this.elevatedLayoutVertexArray,v2.members))),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(o,g,et,nt,at,lt,ft,gt){let Rt;this.elevationMode!=="none"&&(Rt=Dl.getElevationFeature(o,gt));for(const Mt of g)for(const Lt of Mt){const Ht=Lt.x,Kt=Lt.y;if(Ht<0||Ht>=ss||Kt<0||Kt>=ss)continue;if(lt){const hr=lt.projectTilePoint(Ht,Kt,at),ur=lt.upVector(at,Ht,Kt);this.addGlobeExtVertex(hr,ur),this.addGlobeExtVertex(hr,ur),this.addGlobeExtVertex(hr,ur),this.addGlobeExtVertex(hr,ur)}const Qt=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,o.sortKey),sr=Qt.vertexLength;if(this.addCircleVertex(Ht,Kt,-1,-1),this.addCircleVertex(Ht,Kt,1,-1),this.addCircleVertex(Ht,Kt,1,1),this.addCircleVertex(Ht,Kt,-1,1),this.elevationMode!=="none"){const hr=Rt?Rt.pointElevation(new zn(Ht,Kt)):0;this.hasElevation=this.hasElevation||hr!==0;for(let ur=0;ur<4;ur++)this.elevatedLayoutVertexArray.emplaceBack(hr)}this.indexArray.emplaceBack(sr,sr+1,sr+2),this.indexArray.emplaceBack(sr,sr+2,sr+3),Qt.vertexLength+=4,Qt.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,et,{},nt,at,ft,void 0,this.worldview)}addCircleVertex(o,g,et,nt){this.layoutVertexArray.emplaceBack(2*o+(et+1)/2,2*g+(nt+1)/2)}addGlobeExtVertex(o,g){this.globeExtVertexArray.emplaceBack(o.x,o.y,o.z,g[0]*16384,g[1]*16384,g[2]*16384)}}function _l(b,o){for(let g=0;g<b.length;g++)if(Zl(o,b[g]))return!0;for(let g=0;g<o.length;g++)if(Zl(b,o[g]))return!0;return!!fu(b,o)}function So(b,o,g){return!!Zl(b,o)||!!cu(o,b,g)}function Rl(b,o){if(b.length===1)return bu(o,b[0]);for(let g=0;g<o.length;g++){const et=o[g];for(let nt=0;nt<et.length;nt++)if(Zl(b,et[nt]))return!0}for(let g=0;g<b.length;g++)if(bu(o,b[g]))return!0;for(let g=0;g<o.length;g++)if(fu(b,o[g]))return!0;return!1}function Au(b,o,g){if(b.length>1){if(fu(b,o))return!0;for(let et=0;et<o.length;et++)if(cu(o[et],b,g))return!0}for(let et=0;et<b.length;et++)if(cu(b[et],o,g))return!0;return!1}function fu(b,o){if(b.length===0||o.length===0)return!1;for(let g=0;g<b.length-1;g++){const et=b[g],nt=b[g+1];for(let at=0;at<o.length-1;at++)if(Pl(et,nt,o[at],o[at+1]))return!0}return!1}function Pl(b,o,g,et){return Gn(b,g,et)!==Gn(o,g,et)&&Gn(b,o,g)!==Gn(b,o,et)}function $a(b,o,g){return(b.x-g.x)*(o.y-g.y)-(b.y-g.y)*(o.x-g.x)}function To(b,o,g,et){const nt=$a(b,o,et),at=$a(b,o,g);if(Math.sign(nt)===Math.sign(at))return;const lt=$a(g,et,b),ft=lt+at-nt;return Math.sign(lt)!==Math.sign(ft)?[lt/(lt-ft),at/(at-nt)]:void 0}function cu(b,o,g){const et=g*g;if(o.length===1)return b.distSqr(o[0])<et;for(let nt=1;nt<o.length;nt++)if(Lu(b,o[nt-1],o[nt])<et)return!0;return!1}function Lu(b,o,g){const et=o.distSqr(g);if(et===0)return b.distSqr(o);const nt=((b.x-o.x)*(g.x-o.x)+(b.y-o.y)*(g.y-o.y))/et;return b.distSqr(nt<0?o:nt>1?g:g.sub(o)._mult(nt)._add(o))}function bu(b,o){let g,et,nt,at=!1;for(let lt=0;lt<b.length;lt++){g=b[lt];for(let ft=0,gt=g.length-1;ft<g.length;gt=ft++)et=g[ft],nt=g[gt],et.y>o.y!=nt.y>o.y&&o.x<(nt.x-et.x)*(o.y-et.y)/(nt.y-et.y)+et.x&&(at=!at)}return at}function Zl(b,o){let g=!1;for(let et=0,nt=b.length-1;et<b.length;nt=et++){const at=b[et],lt=b[nt];at.y>o.y!=lt.y>o.y&&o.x<(lt.x-at.x)*(o.y-at.y)/(lt.y-at.y)+at.x&&(g=!g)}return g}function Op(b,o,g,et,nt){for(const lt of b)if(o<=lt.x&&g<=lt.y&&et>=lt.x&&nt>=lt.y)return!0;const at=[new zn(o,g),new zn(o,nt),new zn(et,nt),new zn(et,g)];if(b.length>2){for(const lt of at)if(Zl(b,lt))return!0}for(let lt=0;lt<b.length-1;lt++)if(_p(b[lt],b[lt+1],at))return!0;return!1}function _p(b,o,g){const et=g[0],nt=g[2];if(b.x<et.x&&o.x<et.x||b.x>nt.x&&o.x>nt.x||b.y<et.y&&o.y<et.y||b.y>nt.y&&o.y>nt.y)return!1;const at=Gn(b,o,g[0]);return at!==Gn(b,o,g[1])||at!==Gn(b,o,g[2])||at!==Gn(b,o,g[3])}function tp(b,o,g,et,nt,at){let lt=o.y-b.y,ft=b.x-o.x;if(at=at||0){const gt=lt*lt+ft*ft;if(gt===0)return!0;const Rt=Math.sqrt(gt);lt/=Rt,ft/=Rt}return!((g.x-b.x)*lt+(g.y-b.y)*ft-at<0||(et.x-b.x)*lt+(et.y-b.y)*ft-at<0||(nt.x-b.x)*lt+(nt.y-b.y)*ft-at<0)}function Sp(b,o,g,et,nt,at,lt){return!(tp(b,o,et,nt,at,lt)||tp(o,g,et,nt,at,lt)||tp(g,b,et,nt,at,lt)||tp(et,nt,b,o,g,lt)||tp(nt,at,b,o,g,lt)||tp(at,et,b,o,g,lt))}function Tp(b,o,g){const et=o.paint.get(b).value;return et.kind==="constant"?et.value:g.programConfigurations.get(o.id).getMaxValue(b)}function xp(b){return Math.sqrt(b[0]*b[0]+b[1]*b[1])}function c0(b,o,g,et,nt){if(!o[0]&&!o[1])return b;const at=zn.convert(o)._mult(nt);g==="viewport"&&at._rotate(-et);const lt=[];for(let ft=0;ft<b.length;ft++)lt.push(b[ft].sub(at));return lt}function A0(b,o,g,et){const nt=zn.convert(b)._mult(et);return o==="viewport"&&nt._rotate(-g),nt}let Wp,Bu;function Gu(b,o,g){var et=2*Math.PI*6378137/256/Math.pow(2,g);return[b*et-2*Math.PI*6378137/2,o*et-2*Math.PI*6378137/2]}Ps(Ml,"CircleBucket",{omit:["layers"]});class Yl{constructor(o,g,et){this.z=o,this.x=g,this.y=et,this.key=wu(0,o,o,g,et)}equals(o){return this.z===o.z&&this.x===o.x&&this.y===o.y}isChildOf(o){const g=this.z-o.z;return o.z===0||o.z<this.z&&o.x===this.x>>g&&o.y===this.y>>g}url(o,g){const et=function(at,lt,ft){var gt=Gu(256*at,256*(lt=Math.pow(2,ft)-lt-1),ft),Rt=Gu(256*(at+1),256*(lt+1),ft);return gt[0]+","+gt[1]+","+Rt[0]+","+Rt[1]}(this.x,this.y,this.z),nt=function(at,lt,ft){let gt,Rt="";for(let Mt=at;Mt>0;Mt--)gt=1<<Mt-1,Rt+=(lt&gt?1:0)+(ft&gt?2:0);return Rt}(this.z,this.x,this.y);return o[(this.x+this.y)%o.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(g==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",nt).replace("{bbox-epsg-3857}",et)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Xu{constructor(o,g){this.wrap=o,this.canonical=g,this.key=wu(o,g.z,g.z,g.x,g.y)}}class Su{constructor(o,g,et,nt,at){this.overscaledZ=o,this.wrap=g,this.canonical=new Yl(et,+nt,+at),this.key=g===0&&o===et?this.canonical.key:wu(g,o,et,nt,at)}equals(o){return this.overscaledZ===o.overscaledZ&&this.wrap===o.wrap&&this.canonical.equals(o.canonical)}scaledTo(o){const g=this.canonical.z-o;return o>this.canonical.z?new Su(o,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Su(o,this.wrap,o,this.canonical.x>>g,this.canonical.y>>g)}calculateScaledKey(o,g=!0){if(this.overscaledZ===o&&g)return this.key;if(o>this.canonical.z)return wu(this.wrap*+g,o,this.canonical.z,this.canonical.x,this.canonical.y);{const et=this.canonical.z-o;return wu(this.wrap*+g,o,o,this.canonical.x>>et,this.canonical.y>>et)}}isChildOf(o){if(o.wrap!==this.wrap)return!1;const g=this.canonical.z-o.canonical.z;return o.overscaledZ===0||o.overscaledZ<this.overscaledZ&&o.canonical.z<this.canonical.z&&o.canonical.x===this.canonical.x>>g&&o.canonical.y===this.canonical.y>>g}children(o){if(this.overscaledZ>=o)return[new Su(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const g=this.canonical.z+1,et=2*this.canonical.x,nt=2*this.canonical.y;return[new Su(g,this.wrap,g,et,nt),new Su(g,this.wrap,g,et+1,nt),new Su(g,this.wrap,g,et,nt+1),new Su(g,this.wrap,g,et+1,nt+1)]}isLessThan(o){return this.wrap<o.wrap||!(this.wrap>o.wrap)&&(this.overscaledZ<o.overscaledZ||!(this.overscaledZ>o.overscaledZ)&&(this.canonical.x<o.canonical.x||!(this.canonical.x>o.canonical.x)&&this.canonical.y<o.canonical.y))}wrapped(){return new Su(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(o){return new Su(this.overscaledZ,o,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Xu(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function wu(b,o,g,et,nt){const at=1<<Math.min(g,22);let lt=at*(nt%at)+et%at;return b&&g<22&&(lt+=at*at*((b<0?-2*b-1:2*b)%(1<<2*(22-g)))),16*(32*lt+g)+(o-g)}const S0=[b=>{let o=b.canonical.x-1,g=b.wrap;return o<0&&(o=(1<<b.canonical.z)-1,g--),new Su(b.overscaledZ,g,b.canonical.z,o,b.canonical.y)},b=>{let o=b.canonical.x+1,g=b.wrap;return o===1<<b.canonical.z&&(o=0,g++),new Su(b.overscaledZ,g,b.canonical.z,o,b.canonical.y)},b=>new Su(b.overscaledZ,b.wrap,b.canonical.z,b.canonical.x,(b.canonical.y===0?1<<b.canonical.z:b.canonical.y)-1),b=>new Su(b.overscaledZ,b.wrap,b.canonical.z,b.canonical.x,b.canonical.y===(1<<b.canonical.z)-1?0:b.canonical.y+1)];Ps(Yl,"CanonicalTileID"),Ps(Su,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const B1=Go([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:M0}=B1,M1=Go([{name:"a_pos_3",components:3,type:"Int16"}]);var Zx=Go([{name:"a_pos",type:"Int16",components:2}]);function K0(b){return b*Ap/st}const fm=[new zs([w0,w0,w0],[C0,C0,C0]),new zs([w0,w0,w0],[0,0,C0]),new zs([0,w0,w0],[C0,0,C0]),new zs([w0,0,w0],[0,C0,C0]),new zs([0,0,w0],[C0,C0,C0])];function Yx(b,o,g,et=!0){const nt=gn([],b._camera.position,b.worldSize),at=[o,g,1,1];ga(at,at,b.pixelMatrixInverse),Ul(at,at,1/at[3]);const lt=ws([],tn([],at,nt)),ft=b.globeMatrix,gt=[ft[12],ft[13],ft[14]],Rt=tn([],gt,nt),Mt=Fr(Rt),Lt=ws([],Rt),Ht=b.worldSize/(2*Math.PI),Kt=Vs(Lt,lt),Qt=Math.asin(Ht/Mt);if(Qt<Math.acos(Kt)){if(!et)return null;const Tn=[],ln=[];gn(Tn,lt,Mt/Kt),ws(ln,tn(ln,Tn,Rt)),ws(lt,dr(lt,Rt,gn(lt,ln,Math.tan(Qt)*Mt)))}const sr=[];new Bs(nt,lt).closestPointOnSphere(gt,Ht,sr);const hr=ws([],Lo(ft,0)),ur=ws([],Lo(ft,1)),_r=ws([],Lo(ft,2)),br=Vs(hr,sr),Ir=Vs(ur,sr),Vr=Vs(_r,sr),Mr=Ru(Math.asin(-Ir/Ht));let Hr=Ru(Math.atan2(br,Vr));Hr=b.center.lng+function(Tn,ln){const Fn=(ln-Tn+180)%360-180;return Fn<-180?Fn+360:Fn}(b.center.lng,Hr);const Zr=Tt(Hr),en=pr(kt(Mr),0,1);return new Ar(Zr,en)}class Gm{constructor(o,g,et){this.a=tn([],o,et),this.b=tn([],g,et),this.center=et;const nt=ws([],this.a),at=ws([],this.b);this.angle=Math.acos(Vs(nt,at))}}function pm(b,o){if(b.angle===0)return null;let g;return g=b.a[o]===0?1/b.angle*.5*Math.PI:1/b.angle*Math.atan(b.b[o]/b.a[o]/Math.sin(b.angle)-1/Math.tan(b.angle)),g<0||g>1?null:function(et,nt,at,lt){const ft=Math.sin(at);return et*(Math.sin((1-lt)*at)/ft)+nt*(Math.sin(lt*at)/ft)}(b.a[o],b.b[o],b.angle,pr(g,0,1))+b.center[o]}function N0(b){if(b.z<=1)return fm[b.z+2*b.y+b.x];const o=P2(aw(b));return zs.fromPoints(o)}function mm(b,o,g){return gn(b,b,1-g),Sn(b,b,o,g)}function YC(b,o,g){for(const et of b)ys(et,et,o),gn(et,et,g)}function QC(b,o,g,et){const nt=o/b.worldSize,at=b.globeMatrix;if(g.z<=1){const en=N0(g).getCorners();return YC(en,at,nt),zs.fromPoints(en)}const lt=aw(g,et),ft=P2(lt,Ap+K0(b._tileCoverLift));YC(ft,at,nt);const gt=Number.MAX_VALUE,Rt=[-gt,-gt,-gt],Mt=[gt,gt,gt];if(lt.contains(b.center)){for(const ln of ft)Lr(Mt,Mt,ln),_n(Rt,Rt,ln);Rt[2]=0;const en=b.point,Tn=[en.x*nt,en.y*nt,0];return Lr(Mt,Mt,Tn),_n(Rt,Rt,Tn),new zs(Mt,Rt)}if(b._tileCoverLift>0){for(const en of ft)Lr(Mt,Mt,en),_n(Rt,Rt,en);return new zs(Mt,Rt)}const Lt=[at[12]*nt,at[13]*nt,at[14]*nt],Ht=lt.getCenter(),Kt=pr(b.center.lat,-nr,nr),Qt=pr(Ht.lat,-nr,nr),sr=Tt(b.center.lng),hr=kt(Kt);let ur=sr-Tt(Ht.lng);const _r=hr-kt(Qt);ur>.5?ur-=1:ur<-.5&&(ur+=1);let br=0;Math.abs(ur)>Math.abs(_r)?br=ur>=0?1:3:(br=_r>=0?0:2,Sn(Lt,Lt,[at[4]*nt,at[5]*nt,at[6]*nt],-Math.sin(Bo(_r>=0?lt.getSouth():lt.getNorth()))*Ap));const Ir=ft[br],Vr=ft[(br+1)%4],Mr=new Gm(Ir,Vr,Lt),Hr=[pm(Mr,0)||Ir[0],pm(Mr,1)||Ir[1],pm(Mr,2)||Ir[2]],Zr=Qx(b.zoom);if(Zr>0){const en=function({x:ln,y:Fn,z:Ln},jn,Zn,Qn,Hn){const Wn=1/(1<<Ln);let kn=ln*Wn,In=kn+Wn,Kn=Fn*Wn,as=Kn+Wn,es=0;const $s=(kn+In)/2-Qn;return $s>.5?es=-1:$s<-.5&&(es=1),kn=((kn+es)*jn-(Qn*=jn))*Zn+Qn,In=((In+es)*jn-Qn)*Zn+Qn,Kn=(Kn*jn-(Hn*=jn))*Zn+Hn,as=(as*jn-Hn)*Zn+Hn,[[kn,as,0],[In,as,0],[In,Kn,0],[kn,Kn,0]]}(g,o,b._pixelsPerMercatorPixel,sr,hr);for(let ln=0;ln<ft.length;ln++)mm(ft[ln],en[ln],Zr);const Tn=dr([],en[br],en[(br+1)%4]);gn(Tn,Tn,.5),mm(Hr,Tn,Zr)}for(const en of ft)Lr(Mt,Mt,en),_n(Rt,Rt,en);return Mt[2]=Math.min(Ir[2],Vr[2]),Lr(Mt,Mt,Hr),_n(Rt,Rt,Hr),new zs(Mt,Rt)}function aw({x:b,y:o,z:g},et=!1){const nt=1/(1<<g),at=new _e(Xt(b*nt),o===(1<<g)-1&&et?-90:rr((o+1)*nt)),lt=new _e(Xt((b+1)*nt),o===0&&et?90:rr(o*nt));return new ot(at,lt)}function P2(b,o=Ap){const g=Bo(b.getNorth()),et=Bo(b.getSouth()),nt=Math.cos(g),at=Math.cos(et),lt=Math.sin(g),ft=Math.sin(et),gt=b.getWest(),Rt=b.getEast();return[mx(at,ft,gt,o),mx(at,ft,Rt,o),mx(nt,lt,Rt,o),mx(nt,lt,gt,o)]}function Sv(b,o,g,et){const nt=1<<g.z,at=(b/ss+g.x)/nt;return Kx(rr((o/ss+g.y)/nt),Xt(at),et)}function lw({min:b,max:o}){return D2/Math.max(o[0]-b[0],o[1]-b[1],o[2]-b[2])}const JC=new Float64Array(16);function cw(b){const o=lw(b),g=mr(JC,[o,o,o]);return Nt(g,g,On([],b.min))}function k2(b){const o=(et=b.min,(g=JC)[0]=1,g[1]=0,g[2]=0,g[3]=0,g[4]=0,g[5]=1,g[6]=0,g[7]=0,g[8]=0,g[9]=0,g[10]=1,g[11]=0,g[12]=et[0],g[13]=et[1],g[14]=et[2],g[15]=1,g);var g,et;const nt=1/lw(b);return Gt(o,o,[nt,nt,nt])}function F2(b){const o=ss/(2*Math.PI);return b/(2*Math.PI)/o}function eA(b,o){return ss/(512*Math.pow(2,b))*lw(N0(o))}function tA(b,o,g,et,nt){const at=F2(g),lt=[b,o,-g/(2*Math.PI)],ft=Zt(new Float64Array(16));return Nt(ft,ft,lt),Gt(ft,ft,[at,at,at]),er(ft,ft,Bo(-nt)),ir(ft,ft,Bo(-et)),ft}function Qx(b){return vr(b0,t_,b)}function rA(b,o){const g=Kx(o.lat,o.lng),et=function(Qt){const sr=Kx(Qt._center.lat,Qt._center.lng);let hr=ks([],Cr(0,1,0),sr);const ur=Rr([],-Qt.angle,sr);hr=ys(hr,hr,ur),Rr(ur,-Qt._pitch,hr);const _r=ws([],sr);return gn(_r,_r,K0(Qt.cameraToCenterDistance/Qt.pixelsPerMeter)),ys(_r,_r,ur),dr([],sr,_r)}(b);return lt=(nt=gr([],et,g))[0],ft=nt[1],gt=nt[2],Rt=(at=g)[0],Mt=at[1],Lt=at[2],Kt=(Ht=Math.sqrt((lt*lt+ft*ft+gt*gt)*(Rt*Rt+Mt*Mt+Lt*Lt)))&&Vs(nt,at)/Ht,Math.acos(Math.min(Math.max(Kt,-1),1));var nt,at,lt,ft,gt,Rt,Mt,Lt,Ht,Kt}function B2(b,o){return rA(b,o)>Math.PI/2*1.01}const nA=Bo(85),nR=Math.cos(nA),iR=Math.sin(nA),sR=Vt(),iA=b=>{const o=[];return b.paint.get("circle-pitch-alignment")==="map"&&o.push("PITCH_WITH_MAP"),b.paint.get("circle-pitch-scale")==="map"&&o.push("SCALE_WITH_MAP"),o};function sA(b,o,g,et,nt,at,lt,ft,gt){if(at&&b.queryGeometry.isAboveHorizon)return!1;at&&(gt*=b.pixelToTileUnitsFactor);const Rt=b.tileID.canonical,Mt=g.projection.upVectorScale(Rt,g.center.lat,g.worldSize).metersToTile;for(const Lt of o)for(const Ht of Lt){const Kt=Ht.add(ft),Qt=nt&&g.elevation?g.elevation.exaggeration()*nt.getElevationAt(Kt.x,Kt.y,!0):0,sr=g.projection.projectTilePoint(Kt.x,Kt.y,Rt);if(Qt>0){const br=g.projection.upVector(Rt,Kt.x,Kt.y);sr.x+=br[0]*Mt*Qt,sr.y+=br[1]*Mt*Qt,sr.z+=br[2]*Mt*Qt}const hr=at?Kt:oR(sr.x,sr.y,sr.z,et),ur=at?b.tilespaceRays.map(br=>lR(br,Qt)):b.queryGeometry.screenGeometry,_r=ga([],[sr.x,sr.y,sr.z,1],et);if(!lt&&at?gt*=_r[3]/g.cameraToCenterDistance:lt&&!at&&(gt*=g.cameraToCenterDistance/_r[3]),at){const br=rr((Ht.y/ss+Rt.y)/(1<<Rt.z));gt/=g.projection.pixelsPerMeter(br,1)/$t(1,br)}if(So(ur,hr,gt))return!0}return!1}function oR(b,o,g,et){const nt=ga([],[b,o,g,1],et);return new zn(nt[0]/nt[3],nt[1]/nt[3])}const oA=Cr(0,0,0),aR=Cr(0,0,1);function lR(b,o){const g=Jr();return oA[2]=o,b.intersectsPlane(oA,aR,g),new zn(g[0],g[1])}class aA extends Ml{}let lA,cA,uA,dA;function hA(b,{width:o,height:g},et,nt){if(nt){if(nt instanceof Uint8ClampedArray)nt=new Uint8Array(nt.buffer);else if(nt.length!==o*g*et)throw new RangeError("mismatched image size")}else nt=new Uint8Array(o*g*et);return b.width=o,b.height=g,b.data=nt,b}function fA(b,o,g){const{width:et,height:nt}=o;et===b.width&&nt===b.height||(M2(b,o,{x:0,y:0},{x:0,y:0},{width:Math.min(b.width,et),height:Math.min(b.height,nt)},g,null),b.width=et,b.height=nt,b.data=o.data)}function M2(b,o,g,et,nt,at,lt,ft){if(nt.width===0||nt.height===0)return o;if(nt.width>b.width||nt.height>b.height||g.x>b.width-nt.width||g.y>b.height-nt.height)throw new RangeError("out of range source coordinates for image copy");if(nt.width>o.width||nt.height>o.height||et.x>o.width-nt.width||et.y>o.height-nt.height)throw new RangeError("out of range destination coordinates for image copy");const gt=b.data,Rt=o.data,Mt=at===4&&ft;for(let Lt=0;Lt<nt.height;Lt++){const Ht=((g.y+Lt)*b.width+g.x)*at,Kt=((et.y+Lt)*o.width+et.x)*at;if(Mt)for(let Qt=0;Qt<nt.width;Qt++){const sr=Ht+Qt*at+3,hr=Kt+Qt*at;Rt[hr+0]=255,Rt[hr+1]=255,Rt[hr+2]=255,Rt[hr+3]=gt[sr]}else if(lt)for(let Qt=0;Qt<nt.width;Qt++){const sr=Ht+Qt*at,hr=Kt+Qt*at,ur=new Mo(gt[sr+0]/255,gt[sr+1]/255,gt[sr+2]/255,gt[sr+3]).toNonPremultipliedRenderColor(lt).toArray();Rt[hr+0]=ur[0],Rt[hr+1]=ur[1],Rt[hr+2]=ur[2],Rt[hr+3]=ur[3]}else for(let Qt=0;Qt<nt.width*at;Qt++)Rt[Kt+Qt]=gt[Ht+Qt]}return o}Ps(aA,"HeatmapBucket",{omit:["layers"]});class Jx{constructor(o,g){hA(this,o,1,g)}resize(o){fA(this,new Jx(o),1)}clone(){return new Jx({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,g,et,nt,at){M2(o,g,et,nt,at,1,null)}}class Rp{constructor(o,g){hA(this,o,4,g)}resize(o){fA(this,new Rp(o),4)}replace(o,g){g?this.data.set(o):this.data=o instanceof Uint8ClampedArray?new Uint8Array(o.buffer):o}clone(){return new Rp({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,g,et,nt,at,lt,ft){M2(o,g,et,nt,at,4,lt,ft)}}class pA{constructor(o,g){this.width=o.width,this.height=o.height,this.data=g instanceof Uint8Array?new Float32Array(g.buffer):g}}function Tv(b){const o={},g=b.resolution||256,et=b.clips?b.clips.length:1,nt=b.image||new Rp({width:g,height:et}),at=(lt,ft,gt)=>{o[b.evaluationKey]=gt;const Rt=b.expression.evaluate(o),Mt=Rt?Rt.toNonPremultipliedRenderColor(null):null;Mt&&(nt.data[lt+ft+0]=Math.floor(255*Mt.r),nt.data[lt+ft+1]=Math.floor(255*Mt.g),nt.data[lt+ft+2]=Math.floor(255*Mt.b),nt.data[lt+ft+3]=Math.floor(255*Mt.a))};if(b.clips)for(let lt=0,ft=0;lt<et;++lt,ft+=4*g)for(let gt=0,Rt=0;gt<g;gt++,Rt+=4){const Mt=gt/(g-1),{start:Lt,end:Ht}=b.clips[lt];at(ft,Rt,Lt*(1-Mt)+Ht*Mt)}else for(let lt=0,ft=0;lt<g;lt++,ft+=4)at(0,ft,lt/(g-1));return nt}Ps(Jx,"AlphaImage"),Ps(Rp,"RGBAImage");const cR=Go([{name:"a_pos",components:2,type:"Int16"}],4),uR=Go([{name:"a_road_z_offset",components:1,type:"Float32"}],4),dR=Go([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),hR=Go([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function r_(b,o,g=2){const et=o&&o.length,nt=et?o[0]*g:b.length;let at=mA(b,0,nt,g,!0);const lt=[];if(!at||at.next===at.prev)return lt;let ft,gt,Rt;if(et&&(at=function(Mt,Lt,Ht,Kt){const Qt=[];for(let sr=0,hr=Lt.length;sr<hr;sr++){const ur=mA(Mt,Lt[sr]*Kt,sr<hr-1?Lt[sr+1]*Kt:Mt.length,Kt,!1);ur===ur.next&&(ur.steiner=!0),Qt.push(vR(ur))}Qt.sort(gR);for(let sr=0;sr<Qt.length;sr++)Ht=yR(Qt[sr],Ht);return Ht}(b,o,at,g)),b.length>80*g){ft=b[0],gt=b[1];let Mt=ft,Lt=gt;for(let Ht=g;Ht<nt;Ht+=g){const Kt=b[Ht],Qt=b[Ht+1];Kt<ft&&(ft=Kt),Qt<gt&&(gt=Qt),Kt>Mt&&(Mt=Kt),Qt>Lt&&(Lt=Qt)}Rt=Math.max(Mt-ft,Lt-gt),Rt=Rt!==0?32767/Rt:0}return Rv(at,lt,g,ft,gt,Rt,0),lt}function mA(b,o,g,et,nt){let at;if(nt===function(lt,ft,gt,Rt){let Mt=0;for(let Lt=ft,Ht=gt-Rt;Lt<gt;Lt+=Rt)Mt+=(lt[Ht]-lt[Lt])*(lt[Lt+1]+lt[Ht+1]),Ht=Lt;return Mt}(b,o,g,et)>0)for(let lt=o;lt<g;lt+=et)at=_A(lt/et|0,b[lt],b[lt+1],at);else for(let lt=g-et;lt>=o;lt-=et)at=_A(lt/et|0,b[lt],b[lt+1],at);return at&&n_(at,at.next)&&(Pv(at),at=at.next),at}function N1(b,o){if(!b)return b;o||(o=b);let g,et=b;do if(g=!1,et.steiner||!n_(et,et.next)&&hp(et.prev,et,et.next)!==0)et=et.next;else{if(Pv(et),et=o=et.prev,et===et.next)break;g=!0}while(g||et!==o);return o}function Rv(b,o,g,et,nt,at,lt){if(!b)return;!lt&&at&&function(gt,Rt,Mt,Lt){let Ht=gt;do Ht.z===0&&(Ht.z=N2(Ht.x,Ht.y,Rt,Mt,Lt)),Ht.prevZ=Ht.prev,Ht.nextZ=Ht.next,Ht=Ht.next;while(Ht!==gt);Ht.prevZ.nextZ=null,Ht.prevZ=null,function(Kt){let Qt,sr=1;do{let hr,ur=Kt;Kt=null;let _r=null;for(Qt=0;ur;){Qt++;let br=ur,Ir=0;for(let Mr=0;Mr<sr&&(Ir++,br=br.nextZ,br);Mr++);let Vr=sr;for(;Ir>0||Vr>0&&br;)Ir!==0&&(Vr===0||!br||ur.z<=br.z)?(hr=ur,ur=ur.nextZ,Ir--):(hr=br,br=br.nextZ,Vr--),_r?_r.nextZ=hr:Kt=hr,hr.prevZ=_r,_r=hr;ur=br}_r.nextZ=null,sr*=2}while(Qt>1)}(Ht)}(b,et,nt,at);let ft=b;for(;b.prev!==b.next;){const gt=b.prev,Rt=b.next;if(at?pR(b,et,nt,at):fR(b))o.push(gt.i,b.i,Rt.i),Pv(b),b=Rt.next,ft=Rt.next;else if((b=Rt)===ft){lt?lt===1?Rv(b=mR(N1(b),o),o,g,et,nt,at,2):lt===2&&xR(b,o,g,et,nt,at):Rv(N1(b),o,g,et,nt,at,1);break}}}function fR(b){const o=b.prev,g=b,et=b.next;if(hp(o,g,et)>=0)return!1;const nt=o.x,at=g.x,lt=et.x,ft=o.y,gt=g.y,Rt=et.y,Mt=Math.min(nt,at,lt),Lt=Math.min(ft,gt,Rt),Ht=Math.max(nt,at,lt),Kt=Math.max(ft,gt,Rt);let Qt=et.next;for(;Qt!==o;){if(Qt.x>=Mt&&Qt.x<=Ht&&Qt.y>=Lt&&Qt.y<=Kt&&Iv(nt,ft,at,gt,lt,Rt,Qt.x,Qt.y)&&hp(Qt.prev,Qt,Qt.next)>=0)return!1;Qt=Qt.next}return!0}function pR(b,o,g,et){const nt=b.prev,at=b,lt=b.next;if(hp(nt,at,lt)>=0)return!1;const ft=nt.x,gt=at.x,Rt=lt.x,Mt=nt.y,Lt=at.y,Ht=lt.y,Kt=Math.min(ft,gt,Rt),Qt=Math.min(Mt,Lt,Ht),sr=Math.max(ft,gt,Rt),hr=Math.max(Mt,Lt,Ht),ur=N2(Kt,Qt,o,g,et),_r=N2(sr,hr,o,g,et);let br=b.prevZ,Ir=b.nextZ;for(;br&&br.z>=ur&&Ir&&Ir.z<=_r;){if(br.x>=Kt&&br.x<=sr&&br.y>=Qt&&br.y<=hr&&br!==nt&&br!==lt&&Iv(ft,Mt,gt,Lt,Rt,Ht,br.x,br.y)&&hp(br.prev,br,br.next)>=0||(br=br.prevZ,Ir.x>=Kt&&Ir.x<=sr&&Ir.y>=Qt&&Ir.y<=hr&&Ir!==nt&&Ir!==lt&&Iv(ft,Mt,gt,Lt,Rt,Ht,Ir.x,Ir.y)&&hp(Ir.prev,Ir,Ir.next)>=0))return!1;Ir=Ir.nextZ}for(;br&&br.z>=ur;){if(br.x>=Kt&&br.x<=sr&&br.y>=Qt&&br.y<=hr&&br!==nt&&br!==lt&&Iv(ft,Mt,gt,Lt,Rt,Ht,br.x,br.y)&&hp(br.prev,br,br.next)>=0)return!1;br=br.prevZ}for(;Ir&&Ir.z<=_r;){if(Ir.x>=Kt&&Ir.x<=sr&&Ir.y>=Qt&&Ir.y<=hr&&Ir!==nt&&Ir!==lt&&Iv(ft,Mt,gt,Lt,Rt,Ht,Ir.x,Ir.y)&&hp(Ir.prev,Ir,Ir.next)>=0)return!1;Ir=Ir.nextZ}return!0}function mR(b,o){let g=b;do{const et=g.prev,nt=g.next.next;!n_(et,nt)&&gA(et,g,g.next,nt)&&Dv(et,nt)&&Dv(nt,et)&&(o.push(et.i,g.i,nt.i),Pv(g),Pv(g.next),g=b=nt),g=g.next}while(g!==b);return N1(g)}function xR(b,o,g,et,nt,at){let lt=b;do{let ft=lt.next.next;for(;ft!==lt.prev;){if(lt.i!==ft.i&&ER(lt,ft)){let gt=yA(lt,ft);return lt=N1(lt,lt.next),gt=N1(gt,gt.next),Rv(lt,o,g,et,nt,at,0),void Rv(gt,o,g,et,nt,at,0)}ft=ft.next}lt=lt.next}while(lt!==b)}function gR(b,o){let g=b.x-o.x;return g===0&&(g=b.y-o.y,g===0)&&(g=(b.next.y-b.y)/(b.next.x-b.x)-(o.next.y-o.y)/(o.next.x-o.x)),g}function yR(b,o){const g=function(nt,at){let lt=at;const ft=nt.x,gt=nt.y;let Rt,Mt=-1/0;if(n_(nt,lt))return lt;do{if(n_(nt,lt.next))return lt.next;if(gt<=lt.y&&gt>=lt.next.y&&lt.next.y!==lt.y){const sr=lt.x+(gt-lt.y)*(lt.next.x-lt.x)/(lt.next.y-lt.y);if(sr<=ft&&sr>Mt&&(Mt=sr,Rt=lt.x<lt.next.x?lt:lt.next,sr===ft))return Rt}lt=lt.next}while(lt!==at);if(!Rt)return null;const Lt=Rt,Ht=Rt.x,Kt=Rt.y;let Qt=1/0;lt=Rt;do{if(ft>=lt.x&&lt.x>=Ht&&ft!==lt.x&&xA(gt<Kt?ft:Mt,gt,Ht,Kt,gt<Kt?Mt:ft,gt,lt.x,lt.y)){const sr=Math.abs(gt-lt.y)/(ft-lt.x);Dv(lt,nt)&&(sr<Qt||sr===Qt&&(lt.x>Rt.x||lt.x===Rt.x&&_R(Rt,lt)))&&(Rt=lt,Qt=sr)}lt=lt.next}while(lt!==Lt);return Rt}(b,o);if(!g)return o;const et=yA(g,b);return N1(et,et.next),N1(g,g.next)}function _R(b,o){return hp(b.prev,b,o.prev)<0&&hp(o.next,b,b.next)<0}function N2(b,o,g,et,nt){return(b=1431655765&((b=858993459&((b=252645135&((b=16711935&((b=(b-g)*nt|0)|b<<8))|b<<4))|b<<2))|b<<1))|(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-et)*nt|0)|o<<8))|o<<4))|o<<2))|o<<1))<<1}function vR(b){let o=b,g=b;do(o.x<g.x||o.x===g.x&&o.y<g.y)&&(g=o),o=o.next;while(o!==b);return g}function xA(b,o,g,et,nt,at,lt,ft){return(nt-lt)*(o-ft)>=(b-lt)*(at-ft)&&(b-lt)*(et-ft)>=(g-lt)*(o-ft)&&(g-lt)*(at-ft)>=(nt-lt)*(et-ft)}function Iv(b,o,g,et,nt,at,lt,ft){return!(b===lt&&o===ft)&&xA(b,o,g,et,nt,at,lt,ft)}function ER(b,o){return b.next.i!==o.i&&b.prev.i!==o.i&&!function(g,et){let nt=g;do{if(nt.i!==g.i&&nt.next.i!==g.i&&nt.i!==et.i&&nt.next.i!==et.i&&gA(nt,nt.next,g,et))return!0;nt=nt.next}while(nt!==g);return!1}(b,o)&&(Dv(b,o)&&Dv(o,b)&&function(g,et){let nt=g,at=!1;const lt=(g.x+et.x)/2,ft=(g.y+et.y)/2;do nt.y>ft!=nt.next.y>ft&&nt.next.y!==nt.y&&lt<(nt.next.x-nt.x)*(ft-nt.y)/(nt.next.y-nt.y)+nt.x&&(at=!at),nt=nt.next;while(nt!==g);return at}(b,o)&&(hp(b.prev,b,o.prev)||hp(b,o.prev,o))||n_(b,o)&&hp(b.prev,b,b.next)>0&&hp(o.prev,o,o.next)>0)}function hp(b,o,g){return(o.y-b.y)*(g.x-o.x)-(o.x-b.x)*(g.y-o.y)}function n_(b,o){return b.x===o.x&&b.y===o.y}function gA(b,o,g,et){const nt=dw(hp(b,o,g)),at=dw(hp(b,o,et)),lt=dw(hp(g,et,b)),ft=dw(hp(g,et,o));return nt!==at&&lt!==ft||!(nt!==0||!uw(b,g,o))||!(at!==0||!uw(b,et,o))||!(lt!==0||!uw(g,b,et))||!(ft!==0||!uw(g,o,et))}function uw(b,o,g){return o.x<=Math.max(b.x,g.x)&&o.x>=Math.min(b.x,g.x)&&o.y<=Math.max(b.y,g.y)&&o.y>=Math.min(b.y,g.y)}function dw(b){return b>0?1:b<0?-1:0}function Dv(b,o){return hp(b.prev,b,b.next)<0?hp(b,o,b.next)>=0&&hp(b,b.prev,o)>=0:hp(b,o,b.prev)<0||hp(b,b.next,o)<0}function yA(b,o){const g=O2(b.i,b.x,b.y),et=O2(o.i,o.x,o.y),nt=b.next,at=o.prev;return b.next=o,o.prev=b,g.next=nt,nt.prev=g,et.next=g,g.prev=et,at.next=et,et.prev=at,et}function _A(b,o,g,et){const nt=O2(b,o,g);return et?(nt.next=et.next,nt.prev=et,et.next.prev=nt,et.next=nt):(nt.prev=nt,nt.next=nt),nt}function Pv(b){b.next.prev=b.prev,b.prev.next=b.next,b.prevZ&&(b.prevZ.nextZ=b.nextZ),b.nextZ&&(b.nextZ.prevZ=b.prevZ)}function O2(b,o,g){return{i:b,x:o,y:g,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function kv(b,o){const g=b.length;if(g<=1)return[b];const et=[];let nt,at;for(let lt=0;lt<g;lt++){const ft=bo(b[lt]);ft!==0&&(b[lt].area=Math.abs(ft),at===void 0&&(at=ft<0),at===ft<0?(nt&&et.push(nt),nt=[b[lt]]):nt.push(b[lt]))}if(nt&&et.push(nt),o>1)for(let lt=0;lt<et.length;lt++)et[lt].length<=o||(qt(et[lt],o,1,et[lt].length-1,bR),et[lt]=et[lt].slice(0,o));return et}function bR(b,o){return o.area-b.area}function vA(b,o,g=1){if(!b)return null;const et=typeof b=="string"?wp.from(b).getPrimary():b.getPrimary(),nt=typeof b=="string"?null:b.getSecondary();for(const at of[et,nt]){if(!at)continue;const lt=at.id.toString();o.has(lt)||o.set(lt,[]),at.scaleSelf(g),o.get(lt).push(at)}return{primary:et.toString(),secondary:nt?nt.toString():null}}function L2(b,o,g,et){const nt=et.patternDependencies;let at=!1;for(const lt of o){const ft=lt.paint.get(`${b}-pattern`);ft.isConstant()||(at=!0),vA(ft.constantOr(null),nt,g)&&(at=!0)}return at}function j2(b,o,g,et,nt,at){const lt=at.patternDependencies;for(const ft of o){const gt=ft.paint.get(`${b}-pattern`).value;if(gt.kind!=="constant"){let Rt=gt.evaluate({zoom:et},g,{},at.availableImages);Rt=Rt&&Rt.name?Rt.name:Rt;const Mt=vA(Rt,lt,nt);if(!Mt)continue;const{primary:Lt,secondary:Ht}=Mt;Lt&&(g.patterns[ft.id]=[Lt,Ht].filter(Boolean))}}return g}class EA{constructor(){this.polygons=new Map}add(o,...g){const et=this.polygons.get(o);et?et.push(...g):this.polygons.set(o,g)}merge(o){for(const[g,et]of o.polygons)this.add(g,...et)}}class xx{constructor(){this.portals=[]}static isOnBorder(o,g){return o<=0&&g<=0||o>=ss&&g>=ss}static evaluate(o){if(o.length===0)return new xx;let g=[];for(const gt of o)g.push(...gt.portals);if(g.length===0)return new xx;for(const gt of g){const Rt=gt.va,Mt=gt.vb;(xx.isOnBorder(Rt.x,Mt.x)||xx.isOnBorder(Rt.y,Mt.y))&&(gt.type="border")}const et=g.filter(gt=>gt.type!=="unevaluated"),nt=g.filter(gt=>gt.type==="unevaluated");if(nt.length===0)return new xx;nt.sort((gt,Rt)=>gt.hash===Rt.hash?gt.isTunnel===Rt.isTunnel?0:gt.isTunnel?-1:1:gt.hash<Rt.hash?1:-1),g=et.concat(nt);let at=et.length,lt=at,ft=at;do if(lt++,lt===g.length||g[at].hash!==g[lt].hash){if(lt-at==2){ft<at&&(g[ft]=g[at],g[at]=null);const gt=g[ft],Rt=g[lt-1];gt.type=gt.isTunnel!==Rt.isTunnel?"tunnel":"polygon",gt.connection={a:gt.connection.a,b:Rt.connection.a},ft++}at=lt}while(at!==g.length);return g.splice(ft),g.sort((gt,Rt)=>gt.hash<Rt.hash?1:-1),{portals:g}}}Ps(xx,"ElevationPortalGraph"),Ps(EA,"ElevationPolygons");class wR{constructor(o,g,et){this.outPositions=o,this.outNormals=g,this.outIndices=et,this.vertexLookup=new Map}addVertex(o,g,et){let nt=o[2];et!=null&&(nt*=et);const at=`${o[0]},${o[1]},${o[2]},${g[0]},${g[1]},${g[2]}`,lt=this.vertexLookup.get(at);if(lt!=null)return lt;const ft=this.outPositions.length;this.vertexLookup.set(at,ft);const gt=Math.trunc(16384*g[0]),Rt=Math.trunc(16384*g[1]),Mt=Math.trunc(16384*g[2]);return this.outPositions.emplaceBack(o[0],o[1],nt),this.outNormals.emplaceBack(gt,Rt,Mt),ft}addTriangle(o,g,et){this.outIndices.emplaceBack(o,g,et)}addTriangles(o,g,et){if(o.length===0)return;const nt=et.length===1,at=Jr(),lt=Jr();for(let ft=0;ft<o.length;ft+=3){const gt=g[o[ft+0]],Rt=g[o[ft+1]],Mt=g[o[ft+2]],Lt=nt?et[0]:et[o[ft+1]],Ht=nt?et[0]:et[o[ft+2]];Sr(at,gt.x,gt.y,nt?et[0]:et[o[ft+0]]);const Kt=this.addVertex(at,lt);Sr(at,Rt.x,Rt.y,Lt);const Qt=this.addVertex(at,lt);Sr(at,Mt.x,Mt.y,Ht);const sr=this.addVertex(at,lt);this.outIndices.emplaceBack(Kt,Qt,sr)}}addQuad(o,g,et,nt,at,lt){const ft=this.addVertex(o,at,lt),gt=this.addVertex(g,at,lt),Rt=this.addVertex(et,at,lt),Mt=this.addVertex(nt,at,lt);this.addTriangle(ft,gt,Rt),this.addTriangle(Rt,Mt,ft)}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}}class u0{constructor(o,g,et,nt){this.unevaluatedPortals=new xx,this.portalPolygons=new EA,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new ov,this.vertexNormals=new av,this.indexArray=new _f,this.tileToMeters=xr(o),this.bridgeProgramConfigurations=new B0(g,{zoom:et,lut:nt},at=>at!=="fill-tunnel-structure-color"),this.tunnelProgramConfigurations=new B0(g,{zoom:et,lut:nt},at=>at!=="fill-bridge-guard-rail-color")}addVertices(o,g){const et=this.unevalVertices.length;for(let nt=0;nt<o.length;nt++)this.unevalVertices.push(o[nt]),this.unevalHeights.push(g[nt]);return et}addTriangles(o,g,et){const nt=et?this.unevalTunnelTriangles:this.unevalTriangles;for(const at of o)nt.push(at+g)}addRenderableRing(o,g,et,nt,at,lt){const ft=[new zn(at.min.x,at.min.y),new zn(at.max.x,at.min.y),new zn(at.max.x,at.max.y),new zn(at.min.x,at.max.y)];for(let gt=0;gt<et-1;gt++){const Rt=g+gt,Mt=Rt+1,Lt=this.unevalVertices[Rt],Ht=this.unevalVertices[Mt];if(!(Lt.x>=at.min.x&&Lt.x<=at.max.x&&Lt.y>=at.min.y&&Lt.y<=at.max.y||Ht.x>=at.min.x&&Ht.x<=at.max.x&&Ht.y>=at.min.y&&Ht.y<=at.max.y||_p(Lt,Ht,ft))||this.isOnBorder(Lt.x,Ht.x)||this.isOnBorder(Lt.y,Ht.y))continue;const Kt=u0.computeEdgeHash(this.unevalVertices[Rt],this.unevalVertices[Mt]);let Qt,sr=this.vertexHashLookup.get(u0.computePosHash(Lt));sr!=null?Qt=sr.next:(sr=this.vertexHashLookup.get(u0.computePosHash(Ht)),Qt=sr!=null?sr.prev:Kt),this.unevalEdges.push({polygonIdx:o,a:Rt,b:Mt,hash:Kt,portalHash:Qt,isTunnel:nt,type:"unevaluated",featureInfo:lt})}}addPortalCandidates(o,g,et,nt,at){if(g.length===0)return;this.portalPolygons.add(o,{geometry:g,zLevel:at});const lt=g[0];this.vertexHashLookup.clear();let ft=u0.computeEdgeHash(lt[lt.length-2],lt[lt.length-1]);for(let gt=0;gt<lt.length-1;gt++){const Rt=lt[gt+0],Mt=lt[gt+1],Lt=qs(Mt.x-Rt.x,Mt.y-Rt.y),Ht=Wl(Lt);if(Ht===0)continue;let Kt="unevaluated";const Qt=nt.pointElevation(Rt),sr=nt.pointElevation(Mt);Math.abs(Qt)<.01&&Math.abs(sr)<.01?Kt="entrance":(this.isOnBorder(Rt.x,Mt.x)||this.isOnBorder(Rt.y,Mt.y))&&(Kt="border");const hr=u0.computeEdgeHash(Rt,Mt);this.unevaluatedPortals.portals.push({connection:{a:o,b:void 0},va:Rt,vb:Mt,vab:Lt,length:Ht,hash:hr,isTunnel:et,type:Kt});const ur=u0.computePosHash(Rt);this.vertexHashLookup.set(ur,{prev:ft,next:hr}),ft=hr}}construct(o){if(this.unevalVertices.length===0)return;const g=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),et=Ht=>{Ht.primitiveLength=this.indexArray.length-Ht.primitiveOffset},nt=new wR(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(o.portals,this.unevalEdges);const at=g(),lt=g(),ft=g(),gt=(Ht,Kt)=>{Ht.sort((sr,hr)=>sr.type===Kt&&hr.type!==Kt?-1:sr.type!==Kt&&hr.type===Kt?1:0);const Qt=Ht.findIndex(sr=>sr.type!==Kt);return Qt>=0?Qt:Ht.length};let Rt=0;this.unevalEdges.length>0&&(Rt=gt(this.unevalEdges,"none"),this.constructBridgeStructures(nt,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:Rt},this.tileToMeters)),et(ft);const Mt=g(),Lt=g();if(this.unevalEdges.length>0){const Ht=this.unevalEdges.splice(Rt),Kt=gt(Ht,"tunnel")+Rt;this.unevalEdges.push(...Ht),this.constructTunnelStructures(nt,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:Rt},{min:Rt,max:Kt})}et(Mt),nt.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),et(Lt),nt.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),et(lt),nt.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),et(at),this.maskSegments=Eu.simpleSegment(0,Lt.primitiveOffset,0,Lt.primitiveLength),this.depthSegments=Eu.simpleSegment(0,lt.primitiveOffset,0,lt.primitiveLength),this.renderableBridgeSegments=Eu.simpleSegment(0,ft.primitiveOffset,0,ft.primitiveLength),this.renderableTunnelSegments=Eu.simpleSegment(0,Mt.primitiveOffset,0,Mt.primitiveLength),this.shadowCasterSegments=Eu.simpleSegment(0,at.primitiveOffset,0,at.primitiveLength)}update(o,g,et,nt,at,lt,ft,gt){this.bridgeProgramConfigurations.updatePaintArrays(o,g,at,et,nt,lt,ft,gt),this.tunnelProgramConfigurations.updatePaintArrays(o,g,at,et,nt,lt,ft,gt)}upload(o){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=o.createVertexBuffer(this.vertexPositions,dR.members),this.vertexBufferNormal=o.createVertexBuffer(this.vertexNormals,hR.members),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(o),this.tunnelProgramConfigurations.upload(o))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(o,g,et,nt,at){const lt=(ft,gt)=>{for(let Rt=0;Rt<gt.length-1;Rt++){const Mt=gt[Rt].featureIndex,Lt=gt[Rt+1].vertexStart,Ht=o.feature(Mt);ft.populatePaintArrays(Lt,Ht,Mt,{},et,g,nt,void 0,at)}};lt(this.bridgeProgramConfigurations,this.bridgeFeatureSections),lt(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(o,g,et,nt,at){const lt=new Map;for(let ft=nt;ft<at;ft++){const gt=et[ft],Rt=gt.a,Mt=gt.b,Lt=u0.computePosHash(o[Rt]),Ht=u0.computePosHash(o[Mt]);let Kt=lt.get(Lt);Kt||(Kt={},lt.set(Lt,Kt));let Qt=lt.get(Ht);Qt||(Qt={},lt.set(Ht,Qt)),g[Rt]<=0&&g[Mt]<=0||(Kt.to=Mt,Qt.from=Rt)}return lt}isTerminalVertex(o,g){const et=u0.computePosHash(this.unevalVertices[o]),nt=g.get(et);return!nt||!nt.from||!nt.to}constructBridgeStructures(o,g,et,nt,at,lt){o.clearVertexLookup();const ft=this.computeVertexConnections(g,et,nt,at.min,at.max),gt=1/lt,Rt=.5*gt,Mt=(Zn,Qn)=>Sr(Zn,g[Qn].x,g[Qn].y,et[Qn]*gt),Lt=Jr(),Ht=Jr(),Kt=Jr(),Qt=Jr(),sr=Jr(),hr=(Zn,Qn)=>{const Hn=ft.get(u0.computePosHash(g[Qn])),Wn=Hn.from,kn=Hn.to;if(!Wn||!kn)return;Mt(Lt,Wn),Mt(Ht,Qn),Mt(Kt,kn),po(Qt),no(Lt,Ht)||(tn(sr,Ht,Lt),ws(Qt,sr)),no(Kt,Ht)||(tn(sr,Kt,Ht),dr(Qt,Qt,ws(sr,sr)));const In=Co(Qt);return In>0?gn(Zn,Qt,1/In):void 0};let ur=Number.POSITIVE_INFINITY;this.sortSubarray(nt,at.min,at.max,(Zn,Qn)=>Zn.featureInfo.featureIndex-Qn.featureInfo.featureIndex);const _r=Jr(),br=Jr(),Ir=Jr(),Vr=Jr(),Mr=Jr(),Hr=Jr(),Zr=Jr(),en=Jr(),Tn=Jr(),ln=[Jr(),Jr(),Jr(),Jr()],Fn=[Jr(),Jr(),Jr(),Jr()],Ln=[{coord:new zn(0,0),height:0},{coord:new zn(0,0),height:0}],jn=(Zn,Qn)=>Zn>Qn;for(let Zn=at.min;Zn<at.max;Zn++){const Qn=nt[Zn];if(!Qn.featureInfo.guardRailEnabled||!this.prepareEdgePoints(Ln,g,et,Qn,jn))continue;const[Hn,Wn]=Ln;if(Sr(_r,Hn.coord.x,Hn.coord.y,gt*Hn.height),Sr(br,Wn.coord.x,Wn.coord.y,gt*Wn.height),no(_r,br))continue;tn(Ir,br,_r),ws(Ir,Ir);const kn=hr(en,Qn.a)||Ir,In=hr(Tn,Qn.b)||Ir;Sr(Vr,kn[1],-kn[0],0),ws(Vr,Vr),Sr(Mr,In[1],-In[0],0),ws(Mr,Mr),ks(en,Vr,kn),ws(Hr,en),ks(en,Mr,In),ws(Zr,en),dr(ln[0],_r,gn(en,tn(en,Vr,Hr),Rt)),dr(ln[1],_r,gn(en,dr(en,Vr,Hr),Rt)),dr(ln[2],_r,gn(en,Hr,Rt)),ln[3]=_r,dr(Fn[0],br,gn(en,tn(en,Mr,Zr),Rt)),dr(Fn[1],br,gn(en,dr(en,Mr,Zr),Rt)),dr(Fn[2],br,gn(en,Zr,Rt)),Fn[3]=br,ur=this.addFeatureSection(Qn.featureInfo.featureIndex,ur,this.bridgeFeatureSections,o);const Kn=o.addVertex(ln[0],Vr,lt),as=o.addVertex(ln[1],Vr,lt),es=o.addVertex(Fn[0],Mr,lt),$s=o.addVertex(Fn[1],Mr,lt);o.addTriangle(Kn,as,es),o.addTriangle(as,$s,es);const vs=o.addVertex(ln[1],Hr,lt),Is=o.addVertex(ln[2],Hr,lt),Ns=o.addVertex(Fn[1],Zr,lt),Fo=o.addVertex(Fn[2],Zr,lt);o.addTriangle(vs,Is,Ns),o.addTriangle(Is,Fo,Ns),On(Vr,Vr),On(Mr,Mr);const ts=o.addVertex(ln[2],Vr,lt),Os=o.addVertex(ln[3],Vr,lt),fo=o.addVertex(Fn[2],Mr,lt),Ko=o.addVertex(Fn[3],Mr,lt);o.addTriangle(ts,Os,fo),o.addTriangle(Os,Ko,fo);const xa=this.isTerminalVertex(Qn.a,ft),wo=this.isTerminalVertex(Qn.b,ft);Hn.height<.01&&xa&&o.addQuad(ln[3],ln[2],ln[1],ln[0],On(kn,kn),lt),Wn.height<.01&&wo&&o.addQuad(Fn[0],Fn[1],Fn[2],Fn[3],In,lt)}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:o.getVertexCount()})}constructTunnelStructures(o,g,et,nt,at,lt){o.clearVertexLookup();let ft=Number.POSITIVE_INFINITY;const gt=(ur,_r)=>ur.featureInfo.featureIndex-_r.featureInfo.featureIndex;this.sortSubarray(nt,at.min,at.max,gt),this.sortSubarray(nt,lt.min,lt.max,gt);const Rt=ur=>ws(ur,ur),Mt=[{coord:new zn(0,0),height:0},{coord:new zn(0,0),height:0}],Lt=(ur,_r)=>ur<_r,Ht=Jr(),Kt=Jr(),Qt=Jr(),sr=Jr(),hr=Jr();for(let ur=at.min;ur<at.max;ur++){if(!this.prepareEdgePoints(Mt,g,et,nt[ur],Lt))continue;const[_r,br]=Mt,Ir=Rt(Sr(hr,-(br.coord.y-_r.coord.y),br.coord.x-_r.coord.x,0));ft=this.addFeatureSection(nt[ur].featureInfo.featureIndex,ft,this.tunnelFeatureSections,o),o.addQuad(Sr(Ht,_r.coord.x,_r.coord.y,_r.height),Sr(Kt,br.coord.x,br.coord.y,br.height),Sr(Qt,br.coord.x,br.coord.y,nt[ur].isTunnel?-.1:0),Sr(sr,_r.coord.x,_r.coord.y,nt[ur].isTunnel?-.1:0),Ir)}for(let ur=lt.min;ur<lt.max;ur++){const _r=nt[ur];_r.isTunnel&&([_r.a,_r.b]=[_r.b,_r.a]);const br=g[_r.a],Ir=g[_r.b],Vr=Rt(Sr(hr,-(Ir.y-br.y),Ir.x-br.x,0));ft=this.addFeatureSection(_r.featureInfo.featureIndex,ft,this.tunnelFeatureSections,o),o.addQuad(Sr(Ht,Ir.x,Ir.y,0),Sr(Kt,br.x,br.y,0),Sr(Qt,br.x,br.y,et[_r.a]+4),Sr(sr,Ir.x,Ir.y,et[_r.b]+4),Vr),o.addQuad(Sr(Ht,br.x,br.y,0),Sr(Kt,Ir.x,Ir.y,0),Sr(Qt,Ir.x,Ir.y,et[_r.b]+4),Sr(sr,br.x,br.y,et[_r.a]+4),Vr)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:o.getVertexCount()})}setElevatedPoint(o,g,et,nt){o.coord.x=g,o.coord.y=et,o.height=nt}prepareEdgePoints(o,g,et,nt,at){let lt=g[nt.a].x,ft=g[nt.a].y,gt=g[nt.b].x,Rt=g[nt.b].y,Mt=et[nt.a],Lt=et[nt.b];const Ht=at(Mt,0),Kt=at(Lt,0);if(Ht&&Kt)return this.setElevatedPoint(o[0],lt,ft,Mt),this.setElevatedPoint(o[1],gt,Rt,Lt),!0;if(!Ht&&!Kt)return!1;if(Ht){if(!Kt){const Qt=Lt/(Lt-Mt);gt=so(gt,lt,Qt),Rt=so(Rt,ft,Qt),Lt=so(Lt,Mt,Qt)}}else{const Qt=Mt/(Mt-Lt);lt=so(lt,gt,Qt),ft=so(ft,Rt,Qt),Mt=so(Mt,Lt,Qt)}return this.setElevatedPoint(o[0],lt,ft,Mt),this.setElevatedPoint(o[1],gt,Rt,Lt),!0}prepareEdges(o,g){if(g.length===0)return;g.sort((ft,gt)=>ft.hash===gt.hash?gt.polygonIdx-ft.polygonIdx:gt.hash>ft.hash?1:-1);let et=0,nt=0,at=0,lt=g[et].polygonIdx;do nt++,(nt===g.length||g[et].hash!==g[nt].hash)&&((nt-et==1||g[nt-1].polygonIdx!==lt)&&(at<et&&(g[at]=g[et],g[et]=null),g[at].type="none",at++),et=nt,et!==g.length&&(lt=g[et].polygonIdx));while(et!==g.length);if(g.splice(at),g.length!==0&&o.length!==0){g.sort((Rt,Mt)=>Rt.portalHash<Mt.portalHash?1:-1);let ft=0,gt=0;for(;ft!==g.length&&gt!==o.length;){const Rt=g[ft],Mt=o[gt];Rt.portalHash>Mt.hash?ft++:Mt.hash>Rt.portalHash?gt++:(Rt.type=Mt.type,ft++)}}}isOnBorder(o,g){return o<=0&&g<=0||o>=ss&&g>=ss}addFeatureSection(o,g,et,nt){return o!==g&&(g=o,et.push({featureIndex:o,vertexStart:nt.getVertexCount()}),nt.clearVertexLookup()),g}sortSubarray(o,g,et,nt){const at=o.slice(g,et);at.sort(nt),o.splice(g,at.length,...at)}static computeEdgeHash(o,g){return(o.y===g.y&&o.x>g.x||o.y>g.y)&&([o,g]=[g,o]),BigInt(u0.computePosHash(o))<<32n|BigInt(u0.computePosHash(g))}static computePosHash(o){return((65535&o.x)<<16|65535&o.y)>>>0}}var bA,wA={exports:{}},CA=(bA||(bA=1,function(b){function o(Nr,Ur){return Nr>Ur?1:Nr<Ur?-1:0}var g=function(Nr,Ur){Nr===void 0&&(Nr=o),Ur===void 0&&(Ur=!1),this._compare=Nr,this._root=null,this._size=0,this._noDuplicates=!!Ur},et={size:{configurable:!0}};function nt(Nr,Ur,Bn,Yn,xs){var gs=xs-Yn;if(gs>0){var Ws=Yn+Math.floor(gs/2),Zs={key:Ur[Ws],data:Bn[Ws],parent:Nr};return Zs.left=nt(Zs,Ur,Bn,Yn,Ws),Zs.right=nt(Zs,Ur,Bn,Ws+1,xs),Zs}return null}function at(Nr,Ur,Bn,Yn,xs){if(!(Bn>=Yn)){for(var gs=Nr[Bn+Yn>>1],Ws=Bn-1,Zs=Yn+1;;){do Ws++;while(xs(Nr[Ws],gs)<0);do Zs--;while(xs(Nr[Zs],gs)>0);if(Ws>=Zs)break;var vo=Nr[Ws];Nr[Ws]=Nr[Zs],Nr[Zs]=vo,vo=Ur[Ws],Ur[Ws]=Ur[Zs],Ur[Zs]=vo}at(Nr,Ur,Bn,Zs,xs),at(Nr,Ur,Zs+1,Yn,xs)}}g.prototype.rotateLeft=function(Nr){var Ur=Nr.right;Ur&&(Nr.right=Ur.left,Ur.left&&(Ur.left.parent=Nr),Ur.parent=Nr.parent),Nr.parent?Nr===Nr.parent.left?Nr.parent.left=Ur:Nr.parent.right=Ur:this._root=Ur,Ur&&(Ur.left=Nr),Nr.parent=Ur},g.prototype.rotateRight=function(Nr){var Ur=Nr.left;Ur&&(Nr.left=Ur.right,Ur.right&&(Ur.right.parent=Nr),Ur.parent=Nr.parent),Nr.parent?Nr===Nr.parent.left?Nr.parent.left=Ur:Nr.parent.right=Ur:this._root=Ur,Ur&&(Ur.right=Nr),Nr.parent=Ur},g.prototype._splay=function(Nr){for(;Nr.parent;){var Ur=Nr.parent;Ur.parent?Ur.left===Nr&&Ur.parent.left===Ur?(this.rotateRight(Ur.parent),this.rotateRight(Ur)):Ur.right===Nr&&Ur.parent.right===Ur?(this.rotateLeft(Ur.parent),this.rotateLeft(Ur)):Ur.left===Nr&&Ur.parent.right===Ur?(this.rotateRight(Ur),this.rotateLeft(Ur)):(this.rotateLeft(Ur),this.rotateRight(Ur)):Ur.left===Nr?this.rotateRight(Ur):this.rotateLeft(Ur)}},g.prototype.splay=function(Nr){for(var Ur,Bn,Yn,xs,gs;Nr.parent;)(Bn=(Ur=Nr.parent).parent)&&Bn.parent?((Yn=Bn.parent).left===Bn?Yn.left=Nr:Yn.right=Nr,Nr.parent=Yn):(Nr.parent=null,this._root=Nr),xs=Nr.left,gs=Nr.right,Nr===Ur.left?(Bn&&(Bn.left===Ur?(Ur.right?(Bn.left=Ur.right,Bn.left.parent=Bn):Bn.left=null,Ur.right=Bn,Bn.parent=Ur):(xs?(Bn.right=xs,xs.parent=Bn):Bn.right=null,Nr.left=Bn,Bn.parent=Nr)),gs?(Ur.left=gs,gs.parent=Ur):Ur.left=null,Nr.right=Ur,Ur.parent=Nr):(Bn&&(Bn.right===Ur?(Ur.left?(Bn.right=Ur.left,Bn.right.parent=Bn):Bn.right=null,Ur.left=Bn,Bn.parent=Ur):(gs?(Bn.left=gs,gs.parent=Bn):Bn.left=null,Nr.right=Bn,Bn.parent=Nr)),xs?(Ur.right=xs,xs.parent=Ur):Ur.right=null,Nr.left=Ur,Ur.parent=Nr)},g.prototype.replace=function(Nr,Ur){Nr.parent?Nr===Nr.parent.left?Nr.parent.left=Ur:Nr.parent.right=Ur:this._root=Ur,Ur&&(Ur.parent=Nr.parent)},g.prototype.minNode=function(Nr){if(Nr===void 0&&(Nr=this._root),Nr)for(;Nr.left;)Nr=Nr.left;return Nr},g.prototype.maxNode=function(Nr){if(Nr===void 0&&(Nr=this._root),Nr)for(;Nr.right;)Nr=Nr.right;return Nr},g.prototype.insert=function(Nr,Ur){var Bn=this._root,Yn=null,xs=this._compare;if(this._noDuplicates)for(;Bn;){if(Yn=Bn,xs(Bn.key,Nr)===0)return;Bn=xs(Bn.key,Nr)<0?Bn.right:Bn.left}else for(;Bn;)Yn=Bn,Bn=xs(Bn.key,Nr)<0?Bn.right:Bn.left;return Bn={key:Nr,data:Ur,left:null,right:null,parent:Yn},Yn?xs(Yn.key,Bn.key)<0?Yn.right=Bn:Yn.left=Bn:this._root=Bn,this.splay(Bn),this._size++,Bn},g.prototype.find=function(Nr){for(var Ur=this._root,Bn=this._compare;Ur;){var Yn=Bn(Ur.key,Nr);if(Yn<0)Ur=Ur.right;else{if(!(Yn>0))return Ur;Ur=Ur.left}}return null},g.prototype.contains=function(Nr){for(var Ur=this._root,Bn=this._compare;Ur;){var Yn=Bn(Nr,Ur.key);if(Yn===0)return!0;Ur=Yn<0?Ur.left:Ur.right}return!1},g.prototype.remove=function(Nr){var Ur=this.find(Nr);if(!Ur)return!1;if(this.splay(Ur),Ur.left)if(Ur.right){var Bn=this.minNode(Ur.right);Bn.parent!==Ur&&(this.replace(Bn,Bn.right),Bn.right=Ur.right,Bn.right.parent=Bn),this.replace(Ur,Bn),Bn.left=Ur.left,Bn.left.parent=Bn}else this.replace(Ur,Ur.left);else this.replace(Ur,Ur.right);return this._size--,!0},g.prototype.removeNode=function(Nr){if(!Nr)return!1;if(this.splay(Nr),Nr.left)if(Nr.right){var Ur=this.minNode(Nr.right);Ur.parent!==Nr&&(this.replace(Ur,Ur.right),Ur.right=Nr.right,Ur.right.parent=Ur),this.replace(Nr,Ur),Ur.left=Nr.left,Ur.left.parent=Ur}else this.replace(Nr,Nr.left);else this.replace(Nr,Nr.right);return this._size--,!0},g.prototype.erase=function(Nr){var Ur=this.find(Nr);if(Ur){this.splay(Ur);var Bn=Ur.left,Yn=Ur.right,xs=null;Bn&&(Bn.parent=null,xs=this.maxNode(Bn),this.splay(xs),this._root=xs),Yn&&(Bn?xs.right=Yn:this._root=Yn,Yn.parent=xs),this._size--}},g.prototype.pop=function(){var Nr=this._root,Ur=null;if(Nr){for(;Nr.left;)Nr=Nr.left;Ur={key:Nr.key,data:Nr.data},this.remove(Nr.key)}return Ur},g.prototype.next=function(Nr){var Ur=Nr;if(Ur)if(Ur.right)for(Ur=Ur.right;Ur&&Ur.left;)Ur=Ur.left;else for(Ur=Nr.parent;Ur&&Ur.right===Nr;)Nr=Ur,Ur=Ur.parent;return Ur},g.prototype.prev=function(Nr){var Ur=Nr;if(Ur)if(Ur.left)for(Ur=Ur.left;Ur&&Ur.right;)Ur=Ur.right;else for(Ur=Nr.parent;Ur&&Ur.left===Nr;)Nr=Ur,Ur=Ur.parent;return Ur},g.prototype.forEach=function(Nr){for(var Ur=this._root,Bn=[],Yn=!1,xs=0;!Yn;)Ur?(Bn.push(Ur),Ur=Ur.left):Bn.length>0?(Nr(Ur=Bn.pop(),xs++),Ur=Ur.right):Yn=!0;return this},g.prototype.range=function(Nr,Ur,Bn,Yn){for(var xs=[],gs=this._compare,Ws=this._root;xs.length!==0||Ws;)if(Ws)xs.push(Ws),Ws=Ws.left;else{if(gs((Ws=xs.pop()).key,Ur)>0)break;if(gs(Ws.key,Nr)>=0&&Bn.call(Yn,Ws))return this;Ws=Ws.right}return this},g.prototype.keys=function(){for(var Nr=this._root,Ur=[],Bn=[],Yn=!1;!Yn;)Nr?(Ur.push(Nr),Nr=Nr.left):Ur.length>0?(Nr=Ur.pop(),Bn.push(Nr.key),Nr=Nr.right):Yn=!0;return Bn},g.prototype.values=function(){for(var Nr=this._root,Ur=[],Bn=[],Yn=!1;!Yn;)Nr?(Ur.push(Nr),Nr=Nr.left):Ur.length>0?(Nr=Ur.pop(),Bn.push(Nr.data),Nr=Nr.right):Yn=!0;return Bn},g.prototype.at=function(Nr){for(var Ur=this._root,Bn=[],Yn=!1,xs=0;!Yn;)if(Ur)Bn.push(Ur),Ur=Ur.left;else if(Bn.length>0){if(Ur=Bn.pop(),xs===Nr)return Ur;xs++,Ur=Ur.right}else Yn=!0;return null},g.prototype.load=function(Nr,Ur,Bn){if(Nr===void 0&&(Nr=[]),Ur===void 0&&(Ur=[]),Bn===void 0&&(Bn=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var Yn=Nr.length;return Bn&&at(Nr,Ur,0,Yn-1,this._compare),this._root=nt(null,Nr,Ur,0,Yn),this._size=Yn,this},g.prototype.min=function(){var Nr=this.minNode(this._root);return Nr?Nr.key:null},g.prototype.max=function(){var Nr=this.maxNode(this._root);return Nr?Nr.key:null},g.prototype.isEmpty=function(){return this._root===null},et.size.get=function(){return this._size},g.createTree=function(Nr,Ur,Bn,Yn,xs){return new g(Bn,xs).load(Nr,Ur,Yn)},Object.defineProperties(g.prototype,et);var lt=0,ft=1,gt=2,Rt=3,Mt=0,Lt=1,Ht=2,Kt=3;function Qt(Nr,Ur,Bn){Ur===null?(Nr.inOut=!1,Nr.otherInOut=!0):(Nr.isSubject===Ur.isSubject?(Nr.inOut=!Ur.inOut,Nr.otherInOut=Ur.otherInOut):(Nr.inOut=!Ur.otherInOut,Nr.otherInOut=Ur.isVertical()?!Ur.inOut:Ur.inOut),Ur&&(Nr.prevInResult=!sr(Ur,Bn)||Ur.isVertical()?Ur.prevInResult:Ur));var Yn=sr(Nr,Bn);Nr.resultTransition=Yn?function(xs,gs){var Ws,Zs=!xs.inOut,vo=!xs.otherInOut;switch(gs){case Mt:Ws=Zs&&vo;break;case Lt:Ws=Zs||vo;break;case Kt:Ws=Zs^vo;break;case Ht:Ws=xs.isSubject?Zs&&!vo:vo&&!Zs}return Ws?1:-1}(Nr,Bn):0}function sr(Nr,Ur){switch(Nr.type){case lt:switch(Ur){case Mt:return!Nr.otherInOut;case Lt:return Nr.otherInOut;case Ht:return Nr.isSubject&&Nr.otherInOut||!Nr.isSubject&&!Nr.otherInOut;case Kt:return!0}break;case gt:return Ur===Mt||Ur===Lt;case Rt:return Ur===Ht;case ft:return!1}return!1}var hr=function(Nr,Ur,Bn,Yn,xs){this.left=Ur,this.point=Nr,this.otherEvent=Bn,this.isSubject=Yn,this.type=xs||lt,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},ur={inResult:{configurable:!0}};function _r(Nr,Ur){return Nr[0]===Ur[0]&&Nr[1]===Ur[1]}hr.prototype.isBelow=function(Nr){var Ur=this.point,Bn=this.otherEvent.point;return this.left?(Ur[0]-Nr[0])*(Bn[1]-Nr[1])-(Bn[0]-Nr[0])*(Ur[1]-Nr[1])>0:(Bn[0]-Nr[0])*(Ur[1]-Nr[1])-(Ur[0]-Nr[0])*(Bn[1]-Nr[1])>0},hr.prototype.isAbove=function(Nr){return!this.isBelow(Nr)},hr.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},ur.inResult.get=function(){return this.resultTransition!==0},hr.prototype.clone=function(){var Nr=new hr(this.point,this.left,this.otherEvent,this.isSubject,this.type);return Nr.contourId=this.contourId,Nr.resultTransition=this.resultTransition,Nr.prevInResult=this.prevInResult,Nr.isExteriorRing=this.isExteriorRing,Nr.inOut=this.inOut,Nr.otherInOut=this.otherInOut,Nr},Object.defineProperties(hr.prototype,ur);var br=11102230246251565e-32,Ir=134217729,Vr=(3+8*br)*br;function Mr(Nr,Ur,Bn,Yn,xs){var gs,Ws,Zs,vo,Ro=Ur[0],ko=Yn[0],$o=0,io=0;ko>Ro==ko>-Ro?(gs=Ro,Ro=Ur[++$o]):(gs=ko,ko=Yn[++io]);var ho=0;if($o<Nr&&io<Bn)for(ko>Ro==ko>-Ro?(Zs=gs-((Ws=Ro+gs)-Ro),Ro=Ur[++$o]):(Zs=gs-((Ws=ko+gs)-ko),ko=Yn[++io]),gs=Ws,Zs!==0&&(xs[ho++]=Zs);$o<Nr&&io<Bn;)ko>Ro==ko>-Ro?(Zs=gs-((Ws=gs+Ro)-(vo=Ws-gs))+(Ro-vo),Ro=Ur[++$o]):(Zs=gs-((Ws=gs+ko)-(vo=Ws-gs))+(ko-vo),ko=Yn[++io]),gs=Ws,Zs!==0&&(xs[ho++]=Zs);for(;$o<Nr;)Zs=gs-((Ws=gs+Ro)-(vo=Ws-gs))+(Ro-vo),Ro=Ur[++$o],gs=Ws,Zs!==0&&(xs[ho++]=Zs);for(;io<Bn;)Zs=gs-((Ws=gs+ko)-(vo=Ws-gs))+(ko-vo),ko=Yn[++io],gs=Ws,Zs!==0&&(xs[ho++]=Zs);return gs===0&&ho!==0||(xs[ho++]=gs),ho}function Hr(Nr){return new Float64Array(Nr)}var Zr=33306690738754716e-32,en=22204460492503146e-32,Tn=11093356479670487e-47,ln=Hr(4),Fn=Hr(8),Ln=Hr(12),jn=Hr(16),Zn=Hr(4);function Qn(Nr,Ur,Bn){var Yn=function(xs,gs,Ws,Zs,vo,Ro){var ko=(gs-Ro)*(Ws-vo),$o=(xs-vo)*(Zs-Ro),io=ko-$o;if(ko===0||$o===0||ko>0!=$o>0)return io;var ho=Math.abs(ko+$o);return Math.abs(io)>=Zr*ho?io:-function(xl,wl,Cl,Nl,Ql,Hl,Sl){var Fl,Io,Qo,gu,to,Ho,Xl,_c,au,$u,iu,ro,Cu,Ol,pu,rp,dp,Ju,_d=xl-Ql,cp=Cl-Ql,qp=wl-Hl,su=Nl-Hl;ln[0]=(pu=(_c=_d-(Xl=(Ho=Ir*_d)-(Ho-_d)))*($u=su-(au=(Ho=Ir*su)-(Ho-su)))-((Ol=_d*su)-Xl*au-_c*au-Xl*$u))-((iu=pu-(dp=(_c=qp-(Xl=(Ho=Ir*qp)-(Ho-qp)))*($u=cp-(au=(Ho=Ir*cp)-(Ho-cp)))-((rp=qp*cp)-Xl*au-_c*au-Xl*$u)))+(to=pu-iu))+(to-dp),ln[1]=(Cu=Ol-((ro=Ol+iu)-(to=ro-Ol))+(iu-to))-((iu=Cu-rp)+(to=Cu-iu))+(to-rp),ln[2]=ro-((Ju=ro+iu)-(to=Ju-ro))+(iu-to),ln[3]=Ju;var ju=function(Wm,vp){for(var Lp=vp[0],h0=1;h0<4;h0++)Lp+=vp[h0];return Lp}(0,ln),Hu=en*Sl;if(ju>=Hu||-ju>=Hu||(Fl=xl-(_d+(to=xl-_d))+(to-Ql),Qo=Cl-(cp+(to=Cl-cp))+(to-Ql),Io=wl-(qp+(to=wl-qp))+(to-Hl),gu=Nl-(su+(to=Nl-su))+(to-Hl),Fl===0&&Io===0&&Qo===0&&gu===0)||(Hu=Tn*Sl+Vr*Math.abs(ju),(ju+=_d*gu+su*Fl-(qp*Qo+cp*Io))>=Hu||-ju>=Hu))return ju;Zn[0]=(pu=(_c=Fl-(Xl=(Ho=Ir*Fl)-(Ho-Fl)))*($u=su-(au=(Ho=Ir*su)-(Ho-su)))-((Ol=Fl*su)-Xl*au-_c*au-Xl*$u))-((iu=pu-(dp=(_c=Io-(Xl=(Ho=Ir*Io)-(Ho-Io)))*($u=cp-(au=(Ho=Ir*cp)-(Ho-cp)))-((rp=Io*cp)-Xl*au-_c*au-Xl*$u)))+(to=pu-iu))+(to-dp),Zn[1]=(Cu=Ol-((ro=Ol+iu)-(to=ro-Ol))+(iu-to))-((iu=Cu-rp)+(to=Cu-iu))+(to-rp),Zn[2]=ro-((Ju=ro+iu)-(to=Ju-ro))+(iu-to),Zn[3]=Ju;var Qp=Mr(4,ln,4,Zn,Fn);Zn[0]=(pu=(_c=_d-(Xl=(Ho=Ir*_d)-(Ho-_d)))*($u=gu-(au=(Ho=Ir*gu)-(Ho-gu)))-((Ol=_d*gu)-Xl*au-_c*au-Xl*$u))-((iu=pu-(dp=(_c=qp-(Xl=(Ho=Ir*qp)-(Ho-qp)))*($u=Qo-(au=(Ho=Ir*Qo)-(Ho-Qo)))-((rp=qp*Qo)-Xl*au-_c*au-Xl*$u)))+(to=pu-iu))+(to-dp),Zn[1]=(Cu=Ol-((ro=Ol+iu)-(to=ro-Ol))+(iu-to))-((iu=Cu-rp)+(to=Cu-iu))+(to-rp),Zn[2]=ro-((Ju=ro+iu)-(to=Ju-ro))+(iu-to),Zn[3]=Ju;var np=Mr(Qp,Fn,4,Zn,Ln);Zn[0]=(pu=(_c=Fl-(Xl=(Ho=Ir*Fl)-(Ho-Fl)))*($u=gu-(au=(Ho=Ir*gu)-(Ho-gu)))-((Ol=Fl*gu)-Xl*au-_c*au-Xl*$u))-((iu=pu-(dp=(_c=Io-(Xl=(Ho=Ir*Io)-(Ho-Io)))*($u=Qo-(au=(Ho=Ir*Qo)-(Ho-Qo)))-((rp=Io*Qo)-Xl*au-_c*au-Xl*$u)))+(to=pu-iu))+(to-dp),Zn[1]=(Cu=Ol-((ro=Ol+iu)-(to=ro-Ol))+(iu-to))-((iu=Cu-rp)+(to=Cu-iu))+(to-rp),Zn[2]=ro-((Ju=ro+iu)-(to=Ju-ro))+(iu-to),Zn[3]=Ju;var Y0=Mr(np,Ln,4,Zn,jn);return jn[Y0-1]}(xs,gs,Ws,Zs,vo,Ro,ho)}(Nr[0],Nr[1],Ur[0],Ur[1],Bn[0],Bn[1]);return Yn>0?-1:Yn<0?1:0}function Hn(Nr,Ur){var Bn=Nr.point,Yn=Ur.point;return Bn[0]>Yn[0]?1:Bn[0]<Yn[0]?-1:Bn[1]!==Yn[1]?Bn[1]>Yn[1]?1:-1:function(xs,gs,Ws,Zs){return xs.left!==gs.left?xs.left?1:-1:Qn(Ws,xs.otherEvent.point,gs.otherEvent.point)!==0?xs.isBelow(gs.otherEvent.point)?-1:1:!xs.isSubject&&gs.isSubject?1:-1}(Nr,Ur,Bn)}function Wn(Nr,Ur,Bn){var Yn=new hr(Ur,!1,Nr,Nr.isSubject),xs=new hr(Ur,!0,Nr.otherEvent,Nr.isSubject);return _r(Nr.point,Nr.otherEvent.point)&&console.warn("what is that, a collapsed segment?",Nr),Yn.contourId=xs.contourId=Nr.contourId,Hn(xs,Nr.otherEvent)>0&&(Nr.otherEvent.left=!0,xs.left=!1),Nr.otherEvent.otherEvent=xs,Nr.otherEvent=Yn,Bn.push(xs),Bn.push(Yn),Bn}function kn(Nr,Ur){return Nr[0]*Ur[1]-Nr[1]*Ur[0]}function In(Nr,Ur){return Nr[0]*Ur[0]+Nr[1]*Ur[1]}function Kn(Nr,Ur,Bn){var Yn=function(vo,Ro,ko,$o,io){var ho=[Ro[0]-vo[0],Ro[1]-vo[1]],xl=[$o[0]-ko[0],$o[1]-ko[1]];function wl(Ho,Xl,_c){return[Ho[0]+Xl*_c[0],Ho[1]+Xl*_c[1]]}var Cl=[ko[0]-vo[0],ko[1]-vo[1]],Nl=kn(ho,xl),Ql=Nl*Nl,Hl=In(ho,ho);if(Ql>0){var Sl=kn(Cl,xl)/Nl;if(Sl<0||Sl>1)return null;var Fl=kn(Cl,ho)/Nl;return Fl<0||Fl>1?null:Sl===0||Sl===1?[wl(vo,Sl,ho)]:Fl===0||Fl===1?[wl(ko,Fl,xl)]:[wl(vo,Sl,ho)]}if((Ql=(Nl=kn(Cl,ho))*Nl)>0)return null;var Io=In(ho,Cl)/Hl,Qo=Io+In(ho,xl)/Hl,gu=Math.min(Io,Qo),to=Math.max(Io,Qo);return gu<=1&&to>=0?gu===1?[wl(vo,gu>0?gu:0,ho)]:to===0?[wl(vo,to<1?to:1,ho)]:[wl(vo,gu>0?gu:0,ho),wl(vo,to<1?to:1,ho)]:null}(Nr.point,Nr.otherEvent.point,Ur.point,Ur.otherEvent.point),xs=Yn?Yn.length:0;if(xs===0||xs===1&&(_r(Nr.point,Ur.point)||_r(Nr.otherEvent.point,Ur.otherEvent.point))||xs===2&&Nr.isSubject===Ur.isSubject)return 0;if(xs===1)return _r(Nr.point,Yn[0])||_r(Nr.otherEvent.point,Yn[0])||Wn(Nr,Yn[0],Bn),_r(Ur.point,Yn[0])||_r(Ur.otherEvent.point,Yn[0])||Wn(Ur,Yn[0],Bn),1;var gs=[],Ws=!1,Zs=!1;return _r(Nr.point,Ur.point)?Ws=!0:Hn(Nr,Ur)===1?gs.push(Ur,Nr):gs.push(Nr,Ur),_r(Nr.otherEvent.point,Ur.otherEvent.point)?Zs=!0:Hn(Nr.otherEvent,Ur.otherEvent)===1?gs.push(Ur.otherEvent,Nr.otherEvent):gs.push(Nr.otherEvent,Ur.otherEvent),Ws&&Zs||Ws?(Ur.type=ft,Nr.type=Ur.inOut===Nr.inOut?gt:Rt,Ws&&!Zs&&Wn(gs[1].otherEvent,gs[0].point,Bn),2):Zs?(Wn(gs[0],gs[1].point,Bn),3):gs[0]!==gs[3].otherEvent?(Wn(gs[0],gs[1].point,Bn),Wn(gs[1],gs[2].point,Bn),3):(Wn(gs[0],gs[1].point,Bn),Wn(gs[3].otherEvent,gs[2].point,Bn),3)}function as(Nr,Ur){if(Nr===Ur)return 0;if(Qn(Nr.point,Nr.otherEvent.point,Ur.point)!==0||Qn(Nr.point,Nr.otherEvent.point,Ur.otherEvent.point)!==0)return _r(Nr.point,Ur.point)?Nr.isBelow(Ur.otherEvent.point)?-1:1:Nr.point[0]===Ur.point[0]?Nr.point[1]<Ur.point[1]?-1:1:Hn(Nr,Ur)===1?Ur.isAbove(Nr.point)?-1:1:Nr.isBelow(Ur.point)?-1:1;if(Nr.isSubject!==Ur.isSubject)return Nr.isSubject?-1:1;var Bn=Nr.point,Yn=Ur.point;return Bn[0]===Yn[0]&&Bn[1]===Yn[1]?(Bn=Nr.otherEvent.point)[0]===(Yn=Ur.otherEvent.point)[0]&&Bn[1]===Yn[1]?0:Nr.contourId>Ur.contourId?1:-1:Hn(Nr,Ur)===1?1:-1}var es=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function $s(Nr,Ur,Bn,Yn){var xs,gs=Nr+1,Ws=Ur[Nr].point,Zs=Ur.length;for(gs<Zs&&(xs=Ur[gs].point);gs<Zs&&xs[0]===Ws[0]&&xs[1]===Ws[1];){if(!Bn[gs])return gs;++gs<Zs&&(xs=Ur[gs].point)}for(gs=Nr-1;Bn[gs]&&gs>Yn;)gs--;return gs}es.prototype.isExterior=function(){return this.holeOf==null};var vs=Ns,Is=Ns;function Ns(Nr,Ur){if(!(this instanceof Ns))return new Ns(Nr,Ur);if(this.data=Nr||[],this.length=this.data.length,this.compare=Ur||Fo,this.length>0)for(var Bn=(this.length>>1)-1;Bn>=0;Bn--)this._down(Bn)}function Fo(Nr,Ur){return Nr<Ur?-1:Nr>Ur?1:0}Ns.prototype={push:function(Nr){this.data.push(Nr),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var Nr=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),Nr}},peek:function(){return this.data[0]},_up:function(Nr){for(var Ur=this.data,Bn=this.compare,Yn=Ur[Nr];Nr>0;){var xs=Nr-1>>1,gs=Ur[xs];if(Bn(Yn,gs)>=0)break;Ur[Nr]=gs,Nr=xs}Ur[Nr]=Yn},_down:function(Nr){for(var Ur=this.data,Bn=this.compare,Yn=this.length>>1,xs=Ur[Nr];Nr<Yn;){var gs=1+(Nr<<1),Ws=gs+1,Zs=Ur[gs];if(Ws<this.length&&Bn(Ur[Ws],Zs)<0&&(gs=Ws,Zs=Ur[Ws]),Bn(Zs,xs)>=0)break;Ur[Nr]=Zs,Nr=gs}Ur[Nr]=xs}},vs.default=Is;var ts=Math.max,Os=Math.min,fo=0;function Ko(Nr,Ur,Bn,Yn,xs,gs){var Ws,Zs,vo,Ro,ko,$o;for(Ws=0,Zs=Nr.length-1;Ws<Zs;Ws++)if(Ro=Nr[Ws+1],ko=new hr(vo=Nr[Ws],!1,void 0,Ur),$o=new hr(Ro,!1,ko,Ur),ko.otherEvent=$o,vo[0]!==Ro[0]||vo[1]!==Ro[1]){ko.contourId=$o.contourId=Bn,gs||(ko.isExteriorRing=!1,$o.isExteriorRing=!1),Hn(ko,$o)>0?$o.left=!0:ko.left=!0;var io=vo[0],ho=vo[1];xs[0]=Os(xs[0],io),xs[1]=Os(xs[1],ho),xs[2]=ts(xs[2],io),xs[3]=ts(xs[3],ho),Yn.push(ko),Yn.push($o)}}var xa=[];function wo(Nr,Ur,Bn){typeof Nr[0][0][0]=="number"&&(Nr=[Nr]),typeof Ur[0][0][0]=="number"&&(Ur=[Ur]);var Yn=function(ho,xl,wl){var Cl=null;return ho.length*xl.length==0&&(wl===Mt?Cl=xa:wl===Ht?Cl=ho:wl!==Lt&&wl!==Kt||(Cl=ho.length===0?xl:ho)),Cl}(Nr,Ur,Bn);if(Yn)return Yn===xa?null:Yn;var xs=[1/0,1/0,-1/0,-1/0],gs=[1/0,1/0,-1/0,-1/0],Ws=function(ho,xl,wl,Cl,Nl){var Ql,Hl,Sl,Fl,Io,Qo,gu=new vs(null,Hn);for(Sl=0,Fl=ho.length;Sl<Fl;Sl++)for(Io=0,Qo=(Ql=ho[Sl]).length;Io<Qo;Io++)(Hl=Io===0)&&fo++,Ko(Ql[Io],!0,fo,gu,wl,Hl);for(Sl=0,Fl=xl.length;Sl<Fl;Sl++)for(Io=0,Qo=(Ql=xl[Sl]).length;Io<Qo;Io++)Hl=Io===0,Nl===Ht&&(Hl=!1),Hl&&fo++,Ko(Ql[Io],!1,fo,gu,Cl,Hl);return gu}(Nr,Ur,xs,gs,Bn);if(Yn=function(ho,xl,wl,Cl,Nl){var Ql=null;return(wl[0]>Cl[2]||Cl[0]>wl[2]||wl[1]>Cl[3]||Cl[1]>wl[3])&&(Nl===Mt?Ql=xa:Nl===Ht?Ql=ho:Nl!==Lt&&Nl!==Kt||(Ql=ho.concat(xl))),Ql}(Nr,Ur,xs,gs,Bn))return Yn===xa?null:Yn;for(var Zs=function(ho){var xl,wl,Cl=function(Sl){var Fl,Io,Qo,gu,to=[];for(Io=0,Qo=Sl.length;Io<Qo;Io++)((Fl=Sl[Io]).left&&Fl.inResult||!Fl.left&&Fl.otherEvent.inResult)&&to.push(Fl);for(var Ho=!1;!Ho;)for(Ho=!0,Io=0,Qo=to.length;Io<Qo;Io++)Io+1<Qo&&Hn(to[Io],to[Io+1])===1&&(gu=to[Io],to[Io]=to[Io+1],to[Io+1]=gu,Ho=!1);for(Io=0,Qo=to.length;Io<Qo;Io++)(Fl=to[Io]).otherPos=Io;for(Io=0,Qo=to.length;Io<Qo;Io++)(Fl=to[Io]).left||(gu=Fl.otherPos,Fl.otherPos=Fl.otherEvent.otherPos,Fl.otherEvent.otherPos=gu);return to}(ho),Nl={},Ql=[],Hl=function(){if(!Nl[xl]){var Sl=Ql.length,Fl=function(to,Ho,Xl){var _c=new es;if(to.prevInResult!=null){var au=to.prevInResult,$u=au.outputContourId;if(au.resultTransition>0){var iu=Ho[$u];if(iu.holeOf!=null){var ro=iu.holeOf;Ho[ro].holeIds.push(Xl),_c.holeOf=ro,_c.depth=Ho[$u].depth}else Ho[$u].holeIds.push(Xl),_c.holeOf=$u,_c.depth=Ho[$u].depth+1}else _c.holeOf=null,_c.depth=Ho[$u].depth}else _c.holeOf=null,_c.depth=0;return _c}(Cl[xl],Ql,Sl),Io=function(to){Nl[to]=!0,to<Cl.length&&Cl[to]&&(Cl[to].outputContourId=Sl)},Qo=xl,gu=xl;for(Fl.points.push(Cl[xl].point);Io(Qo),Io(Qo=Cl[Qo].otherPos),Fl.points.push(Cl[Qo].point),!((Qo=$s(Qo,Cl,Nl,gu))==gu||Qo>=Cl.length)&&Cl[Qo];);Ql.push(Fl)}};for(xl=0,wl=Cl.length;xl<wl;xl++)Hl();return Ql}(function(ho,xl,wl,Cl,Nl,Ql){for(var Hl,Sl,Fl,Io=new g(as),Qo=[],gu=Math.min(Cl[2],Nl[2]);ho.length!==0;){var to=ho.pop();if(Qo.push(to),Ql===Mt&&to.point[0]>gu||Ql===Ht&&to.point[0]>Cl[2])break;if(to.left){Sl=Hl=Io.insert(to),Hl=Hl!==(Fl=Io.minNode())?Io.prev(Hl):null,Sl=Io.next(Sl);var Ho=Hl?Hl.key:null;if(Qt(to,Ho,Ql),Sl&&Kn(to,Sl.key,ho)===2&&(Qt(to,Ho,Ql),Qt(Sl.key,to,Ql)),Hl&&Kn(Hl.key,to,ho)===2){var Xl=Hl;Qt(Ho,(Xl=Xl!==Fl?Io.prev(Xl):null)?Xl.key:null,Ql),Qt(to,Ho,Ql)}}else Sl=Hl=Io.find(to=to.otherEvent),Hl&&Sl&&(Hl=Hl!==Fl?Io.prev(Hl):null,Sl=Io.next(Sl),Io.remove(to),Sl&&Hl&&Kn(Hl.key,Sl.key,ho))}return Qo}(Ws,0,0,xs,gs,Bn)),vo=[],Ro=0;Ro<Zs.length;Ro++){var ko=Zs[Ro];if(ko.isExterior()){for(var $o=[ko.points],io=0;io<ko.holeIds.length;io++)$o.push(Zs[ko.holeIds[io]].points);vo.push($o)}}return vo}var $l={UNION:Lt,DIFFERENCE:Ht,INTERSECTION:Mt,XOR:Kt};b.diff=function(Nr,Ur){return wo(Nr,Ur,Ht)},b.intersection=function(Nr,Ur){return wo(Nr,Ur,Mt)},b.operations=$l,b.union=function(Nr,Ur){return wo(Nr,Ur,Lt)},b.xor=function(Nr,Ur){return wo(Nr,Ur,Kt)},Object.defineProperty(b,"__esModule",{value:!0})}(wA.exports)),wA.exports);/**
 * martinez v0.7.4
 * Martinez polygon clipping algorithm, does boolean operation on polygons (multipolygons, polygons with holes etc): intersection, union, difference, xor
 *
 * @author Alex Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */function hw(b,o,g,et){const nt=[],at=et===0?(lt,ft,gt,Rt,Mt,Lt)=>{lt.push(new zn(Lt,gt+(Lt-ft)/(Rt-ft)*(Mt-gt)))}:(lt,ft,gt,Rt,Mt,Lt)=>{lt.push(new zn(ft+(Lt-gt)/(Mt-gt)*(Rt-ft),Lt))};for(const lt of b){const ft=[];for(const gt of lt){if(gt.length<=2)continue;const Rt=[];for(let Ht=0;Ht<gt.length-1;Ht++){const Kt=gt[Ht].x,Qt=gt[Ht].y,sr=gt[Ht+1].x,hr=gt[Ht+1].y,ur=et===0?Kt:Qt,_r=et===0?sr:hr;ur<o?_r>o&&at(Rt,Kt,Qt,sr,hr,o):ur>g?_r<g&&at(Rt,Kt,Qt,sr,hr,g):Rt.push(gt[Ht]),_r<o&&ur>=o&&at(Rt,Kt,Qt,sr,hr,o),_r>g&&ur<=g&&at(Rt,Kt,Qt,sr,hr,g)}let Mt=gt[gt.length-1];const Lt=et===0?Mt.x:Mt.y;Lt>=o&&Lt<=g&&Rt.push(Mt),Rt.length&&(Mt=Rt[Rt.length-1],Rt[0].x===Mt.x&&Rt[0].y===Mt.y||Rt.push(Rt[0]),ft.push(Rt))}ft.length&&nt.push(ft)}return nt}function CR(b,o){const g=z2(b),et=z2([o]),nt=CA.intersection(g,et);return nt==null?[]:AA(nt)}function AR(b,o){let et=z2(b,65536);const nt=[];for(;o.valid();o.next()){const[at,lt]=o.get(),ft=at.x*65536,gt=at.y*65536,Rt=lt.x*65536,Mt=lt.y*65536,Lt=Rt-ft,Ht=Mt-gt,Kt=Math.hypot(Lt,Ht);if(Kt===0)continue;const Qt=Math.trunc(Ht/Kt*3),sr=-Math.trunc(Lt/Kt*3);nt.push([[[ft,gt],[Rt,Mt],[Rt+Qt,Mt+sr],[ft+Qt,gt+sr],[ft,gt]]])}return nt.length>0&&(et=CA.diff(et,nt)),AA(et,1/65536)}function z2(b,o=1){return[b.map(g=>g.map(et=>[et.x*o,et.y*o]))]}function AA(b,o=1){return b.map(g=>g.map((et,nt)=>{const at=et.map(lt=>new zn(lt[0]*o,lt[1]*o).round());return nt>0&&at.reverse(),at}))}class V2{constructor(o,g){this.layoutVertexArray=new jm,this.indexArray=new _f,this.lineIndexArray=new l0,this.triangleSegments=new Eu,this.lineSegments=new Eu,this.programConfigurations=new B0(o.layers,{zoom:o.zoom,lut:o.lut}),this.uploaded=!1,g&&(this.elevatedLayoutVertexArray=new lm)}update(o,g,et,nt,at,lt,ft,gt){this.programConfigurations.updatePaintArrays(o,g,at,et,nt,lt,ft,gt)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,cR.members),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.lineIndexBuffer=o.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=o.createVertexBuffer(this.elevatedLayoutVertexArray,uR.members))),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(o,g,et,nt,at,lt,ft){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,g,et,nt,at,lt,void 0,ft)}}class U2{constructor(o){this.zoom=o.zoom,this.pixelRatio=o.pixelRatio,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(g=>g.fqid),this.index=o.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=o.lut,this.bufferData=new V2(o,!1),this.elevationBufferData=new V2(o,!0),this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.projection=o.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=o.sourceLayerIndex,this.worldview=o.worldview,this.hasAppearances=null}updateFootprints(o,g){}updateAppearances(o,g,et,nt){}populate(o,g,et,nt){this.hasPattern=L2("fill",this.layers,this.pixelRatio,g);const at=this.layers[0].layout.get("fill-sort-key"),lt=[];for(const{feature:ft,id:gt,index:Rt,sourceLayerIndex:Mt}of o){const Lt=this.layers[0]._featureFilter.needGeometry,Ht=an(ft,Lt);if(!this.layers[0]._featureFilter.filter(new ou(this.zoom,{worldview:this.worldview,activeFloors:g.activeFloors}),Ht,et))continue;const Kt=at?at.evaluate(Ht,{},et,g.availableImages):void 0,Qt={id:gt,properties:ft.properties,type:ft.type,sourceLayerIndex:Mt,index:Rt,geometry:Lt?Ht.geometry:Xr(ft,et,nt),patterns:{},sortKey:Kt};lt.push(Qt)}at&&lt.sort((ft,gt)=>ft.sortKey-gt.sortKey);for(const ft of lt){const{geometry:gt,index:Rt,sourceLayerIndex:Mt}=ft;if(this.hasPattern){const Lt=j2("fill",this.layers,ft,this.zoom,this.pixelRatio,g);this.patternFeatures.push(Lt)}else this.addFeature(ft,gt,Rt,et,{},g.availableImages,g.brightness,g.elevationFeatures);g.featureIndex.insert(o[Rt].feature,gt,Rt,Mt,this.index)}}update(o,g,et,nt,at,lt,ft){this.bufferData.update(o,g,et,nt,at,lt,ft,this.worldview),this.elevationBufferData.update(o,g,et,nt,at,lt,ft,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(o,g,et,nt,at,lt,ft,this.worldview)}addFeatures(o,g,et,nt,at,lt){for(const ft of this.patternFeatures)this.addFeature(ft,ft.geometry,ft.index,g,et,nt,lt,o.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(o){this.bufferData.upload(o),this.elevationBufferData.upload(o),this.elevatedStructures&&this.elevatedStructures.upload(o)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(o,g,et,nt,at,lt=[],ft,gt){const Rt=kv(g,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(o,Rt,nt,et,gt):this.addGeometry(Rt,this.bufferData),this.bufferData.populatePaintArrays(o,et,at,lt,nt,ft,this.worldview),this.elevationBufferData.populatePaintArrays(o,et,at,lt,nt,ft,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(o,g,et,nt,at){this.elevatedStructures&&(this.elevatedStructures.construct(o),this.elevatedStructures.populatePaintArrays(g,et,nt,at,this.worldview))}addElevatedRoadFeature(o,g,et,nt,at){const lt=new Array,ft=Dl.getElevationFeature(o,at);if(!ft)return void this.addGeometry(g,this.bufferData);{const Rt=this.clipPolygonsToTile(g,1);Rt.length>0&&lt.push({polygons:Rt,elevationFeature:ft,elevationTileID:et})}const gt={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(o,{},et),featureIndex:nt};for(const Rt of lt)if(Rt.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new u0(Rt.elevationTileID,this.layers,this.zoom,this.lut));const Lt=Rt.elevationFeature.isTunnel();let Ht=0;o.properties.hasOwnProperty(bn)&&(Ht=+o.properties[bn]);for(const Kt of Rt.polygons)this.elevatedStructures.addPortalCandidates(Rt.elevationFeature.id,Kt,Lt,Rt.elevationFeature,Ht)}Rt.elevationFeature.constantHeight==null&&(Rt.polygons=this.prepareElevatedPolygons(Rt.polygons,Rt.elevationFeature,Rt.elevationTileID));const Mt=new Vl(et,Rt.elevationTileID);this.addElevatedGeometry(Rt.polygons,Mt,Rt.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,nt,gt)}}addElevatedGeometry(o,g,et,nt,at,lt){const ft={elevation:et,elevationSampler:g,bias:nt,index:at,featureInfo:lt},[gt,Rt]=this.addGeometry(o,this.elevationBufferData,ft);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:gt,max:Rt}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,gt),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,Rt))}addGeometry(o,g,et){let nt=Number.POSITIVE_INFINITY,at=Number.NEGATIVE_INFINITY,lt=null;et&&(lt=et.elevationSampler.constantElevation(et.elevation,et.bias),lt!=null&&(nt=lt,at=lt));const ft=(gt,Rt,Mt)=>{if(et!=null)if(Rt.push(gt),lt!=null)g.elevatedLayoutVertexArray.emplaceBack(lt),Mt.push(lt);else{const Lt=et.elevationSampler.pointElevation(gt,et.elevation,et.bias);g.elevatedLayoutVertexArray.emplaceBack(Lt),Mt.push(Lt),nt=Math.min(nt,Lt),at=Math.max(at,Lt)}};for(const gt of o){let Rt=0;for(const br of gt)Rt+=br.length;const Mt=g.triangleSegments.prepareSegment(Rt,g.layoutVertexArray,g.indexArray),Lt=Mt.vertexLength,Ht=[],Kt=[],Qt=[],sr=[],hr=[],ur=g.layoutVertexArray.length;for(const br of gt){if(br.length===0)continue;br!==gt[0]&&Kt.push(Ht.length/2);const Ir=g.lineSegments.prepareSegment(br.length,g.layoutVertexArray,g.lineIndexArray),Vr=Ir.vertexLength;et&&hr.push(g.layoutVertexArray.length-ur),ft(br[0],Qt,sr),g.layoutVertexArray.emplaceBack(br[0].x,br[0].y),g.lineIndexArray.emplaceBack(Vr+br.length-1,Vr),Ht.push(br[0].x),Ht.push(br[0].y);for(let Mr=1;Mr<br.length;Mr++)ft(br[Mr],Qt,sr),g.layoutVertexArray.emplaceBack(br[Mr].x,br[Mr].y),g.lineIndexArray.emplaceBack(Vr+Mr-1,Vr+Mr),Ht.push(br[Mr].x),Ht.push(br[Mr].y);Ir.vertexLength+=br.length,Ir.primitiveLength+=br.length}const _r=r_(Ht,Kt);for(let br=0;br<_r.length;br+=3)g.indexArray.emplaceBack(Lt+_r[br],Lt+_r[br+1],Lt+_r[br+2]);if(_r.length>0&&et&&this.elevationMode==="hd-road-base"){const br=et.elevation.isTunnel(),Ir=et.elevation.safeArea,Vr=this.elevatedStructures.addVertices(Qt,sr);this.elevatedStructures.addTriangles(_r,Vr,br);const Mr=hr.length;if(Mr>0){for(let Hr=0;Hr<Mr-1;Hr++)this.elevatedStructures.addRenderableRing(et.index,hr[Hr]+Vr,hr[Hr+1]-hr[Hr],br,Ir,et.featureInfo);this.elevatedStructures.addRenderableRing(et.index,hr[Mr-1]+Vr,Qt.length-hr[Mr-1],br,Ir,et.featureInfo)}}Mt.vertexLength+=Rt,Mt.primitiveLength+=_r.length/3}return[nt,at]}prepareElevatedPolygons(o,g,et){const nt=1/xr(et),at=[];for(const lt of o){const ft=AR(lt,new El(g,nt));at.push(...ft)}return at}clipPolygonsToTile(o,g){const et=-g,nt=-g,at=ss+g,lt=ss+g;let ft=0;const gt=[],Rt=[];for(;ft<o.length;ft++){const Ht=o[ft],Kt=os(Ht);(Kt.min.x>=et&&Kt.max.x<=at&&Kt.min.y>=nt&&Kt.max.y<=lt?gt:Rt).push(Ht)}if(gt.length===o.length)return o;const Mt=[new zn(et,nt),new zn(at,nt),new zn(at,lt),new zn(et,lt),new zn(et,nt)],Lt=gt;for(const Ht of Rt)Lt.push(...CR(Ht,Mt));return Lt}}let SA,TA,RA,IA;Ps(U2,"FillBucket",{omit:["layers","patternFeatures"]}),Ps(V2,"FillBufferData"),Ps(u0,"ElevatedStructures");class fw{constructor(o,g,et,nt){if(this.triangleCount=g.length/3,this.min=new zn(0,0),this.max=new zn(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||o.length===0)return;const[at,lt]=[o[0].clone(),o[0].clone()];for(let Lt=1;Lt<o.length;++Lt){const Ht=o[Lt];at.x=Math.min(at.x,Ht.x),at.y=Math.min(at.y,Ht.y),lt.x=Math.max(lt.x,Ht.x),lt.y=Math.max(lt.y,Ht.y)}if(nt){const Lt=Math.ceil(Math.max(lt.x-at.x,lt.y-at.y)/nt);et=Math.max(et,Lt)}if(et===0)return;this.min=at,this.max=lt;const ft=this.max.sub(this.min);ft.x=Math.max(ft.x,1),ft.y=Math.max(ft.y,1);const gt=Math.max(ft.x,ft.y)/et;this.cellsX=Math.max(1,Math.ceil(ft.x/gt)),this.cellsY=Math.max(1,Math.ceil(ft.y/gt)),this.xScale=1/gt,this.yScale=1/gt;const Rt=[];for(let Lt=0;Lt<this.triangleCount;Lt++){const Ht=o[g[3*Lt+0]].sub(this.min),Kt=o[g[3*Lt+1]].sub(this.min),Qt=o[g[3*Lt+2]].sub(this.min),sr=$m(Math.floor(Math.min(Ht.x,Kt.x,Qt.x)),this.xScale,this.cellsX),hr=$m(Math.floor(Math.max(Ht.x,Kt.x,Qt.x)),this.xScale,this.cellsX),ur=$m(Math.floor(Math.min(Ht.y,Kt.y,Qt.y)),this.yScale,this.cellsY),_r=$m(Math.floor(Math.max(Ht.y,Kt.y,Qt.y)),this.yScale,this.cellsY),br=new zn(0,0),Ir=new zn(0,0),Vr=new zn(0,0),Mr=new zn(0,0);for(let Hr=ur;Hr<=_r;++Hr){br.y=Ir.y=Hr*gt,Vr.y=Mr.y=(Hr+1)*gt;for(let Zr=sr;Zr<=hr;++Zr)br.x=Vr.x=Zr*gt,Ir.x=Mr.x=(Zr+1)*gt,(Sp(Ht,Kt,Qt,br,Ir,Mr)||Sp(Ht,Kt,Qt,br,Mr,Vr))&&Rt.push({cellIdx:Hr*this.cellsX+Zr,triIdx:Lt})}}if(Rt.length===0)return;Rt.sort((Lt,Ht)=>Lt.cellIdx-Ht.cellIdx||Lt.triIdx-Ht.triIdx);let Mt=0;for(;Mt<Rt.length;){const Lt=Rt[Mt].cellIdx,Ht={start:this.payload.length,len:0};for(;Mt<Rt.length&&Rt[Mt].cellIdx===Lt;)++Ht.len,this.payload.push(Rt[Mt++].triIdx);this.cells[Lt]=Ht}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(o,g){if(this.triangleCount===0||this.cells.length===0||o.x>this.max.x||this.min.x>o.x||o.y>this.max.y||this.min.y>o.y)return;const et=$m(o.x-this.min.x,this.xScale,this.cellsX),nt=$m(o.y-this.min.y,this.yScale,this.cellsY),at=this.cells[nt*this.cellsX+et];if(at){this._lazyInitLookup();for(let lt=0;lt<at.len;lt++){const ft=this.payload[at.start+lt],gt=Math.floor(ft/8),Rt=1<<ft%8;if(!(this.lookup[gt]&Rt)&&(this.lookup[gt]|=Rt,g.push(ft),g.length===this.triangleCount))return}}}query(o,g,et){if(this.triangleCount===0||this.cells.length===0||o.x>this.max.x||this.min.x>g.x||o.y>this.max.y||this.min.y>g.y)return;this._lazyInitLookup();const nt=$m(o.x-this.min.x,this.xScale,this.cellsX),at=$m(g.x-this.min.x,this.xScale,this.cellsX),lt=$m(o.y-this.min.y,this.yScale,this.cellsY),ft=$m(g.y-this.min.y,this.yScale,this.cellsY);for(let gt=lt;gt<=ft;gt++)for(let Rt=nt;Rt<=at;Rt++){const Mt=this.cells[gt*this.cellsX+Rt];if(Mt)for(let Lt=0;Lt<Mt.len;Lt++){const Ht=this.payload[Mt.start+Lt],Kt=Math.floor(Ht/8),Qt=1<<Ht%8;if(!(this.lookup[Kt]&Qt)&&(this.lookup[Kt]|=Qt,et.push(Ht),et.length===this.triangleCount))return}}}}function $m(b,o,g){return Math.max(0,Math.min(g-1,Math.floor(b*o)))}Ps(fw,"TriangleGridIndex");class DA{constructor(o){this.zoom=o.zoom,this.layers=o.layers,this.layerIds=this.layers.map(g=>g.fqid),this.index=o.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.footprints=[],this.worldview=o.worldview,this.hasAppearances=null}updateFootprints(o,g){for(const et of this.footprints)g.push({footprint:et,id:o})}updateAppearances(o,g,et,nt){}populate(o,g,et,nt){const at=[];for(const{feature:lt,id:ft,index:gt,sourceLayerIndex:Rt}of o){const Mt=this.layers[0]._featureFilter.needGeometry,Lt=an(lt,Mt);if(!this.layers[0]._featureFilter.filter(new ou(this.zoom,{worldview:this.worldview,activeFloors:g.activeFloors}),Lt,et))continue;const Ht={id:ft,properties:lt.properties,type:lt.type,sourceLayerIndex:Rt,index:gt,geometry:Mt?Lt.geometry:Xr(lt,et,nt),patterns:{}};at.push(Ht)}for(const lt of at){const{geometry:ft,index:gt,sourceLayerIndex:Rt}=lt;this.addFeature(lt,ft,gt,et,{},g.availableImages,g.brightness),g.featureIndex.insert(o[gt].feature,ft,gt,Rt,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(o){}update(o,g,et,nt,at,lt,ft){}destroy(){}addFeature(o,g,et,nt,at,lt=[],ft){for(const gt of kv(g,2)){const Rt=[],Mt=[],Lt=[],Ht=new zn(1/0,1/0),Kt=new zn(-1/0,-1/0);for(const hr of gt)if(hr.length!==0){hr!==gt[0]&&Lt.push(Mt.length/2);for(let ur=0;ur<hr.length;ur++)Mt.push(hr[ur].x),Mt.push(hr[ur].y),Rt.push(hr[ur]),Ht.x=Math.min(Ht.x,hr[ur].x),Ht.y=Math.min(Ht.y,hr[ur].y),Kt.x=Math.max(Kt.x,hr[ur].x),Kt.y=Math.max(Kt.y,hr[ur].y)}const Qt=r_(Mt,Lt),sr=new fw(Rt,Qt,8,256);this.footprints.push({vertices:Rt,indices:Qt,grid:sr,min:Ht,max:Kt})}}}Ps(DA,"ClipBucket",{omit:["layers"]});const SR=Go([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),TR=Go([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),RR=Go([{name:"a_flood_light_ground_radius",components:1,type:"Float32"}]),IR=Go([{name:"a_centroid_pos",components:2,type:"Uint16"}]),DR=Go([{name:"a_join_normal_inside",components:3,type:"Int16"}]),PR=Go([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),kR=Go([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:FR}=SR,Fv=Number.MAX_SAFE_INTEGER,PA=Fv-1;function kA(b,o,g,et){return b.order<o||b.order===Fv||!(b.clipMask&g)||function(nt,at){return at.length!==0&&at.find(lt=>lt===nt)===void 0}(et,b.clipScope)}function pw(b,o){return b.x-o.x||b.y-o.y}function FA(b,o){return pw(b.min,o.min)===0&&pw(b.max,o.max)===0}function G2(b,o){return!(b.min.x>o.max.x||b.max.x<o.min.x||b.min.y>o.max.y||b.max.y<o.min.y)}function mw(b,o){if(b.length!==o.length)return!1;for(let g=0;g<b.length;g++)if(b[g].sourceId!==o[g].sourceId||!FA(b[g],o[g])||b[g].order!==o[g].order||b[g].clipMask!==o[g].clipMask||!Vu(b[g].clipScope,o[g].clipScope))return!1;return!0}function BA(b,o,g){const et=1/ss,nt=1/(1<<g.canonical.z),at=(o.x*et+g.canonical.x)*nt+g.wrap,lt=(o.y*et+g.canonical.y)*nt;return{min:new zn((b.x*et+g.canonical.x)*nt+g.wrap,(b.y*et+g.canonical.y)*nt),max:new zn(at,lt)}}function BR(b,o,g){const et=1<<g.canonical.z,nt=((o.x-g.wrap)*et-g.canonical.x)*ss,at=(o.y*et-g.canonical.y)*ss;return{min:new zn(((b.x-g.wrap)*et-g.canonical.x)*ss,(b.y*et-g.canonical.y)*ss),max:new zn(nt,at)}}function $2(b,o,g,et,nt,at,lt){const ft=b.indices,gt=b.vertices,Rt=[];for(let Mt=et;Mt<et+nt;Mt+=3){const Lt=o[g[Mt+0]+at],Ht=o[g[Mt+1]+at],Kt=o[g[Mt+2]+at],Qt=Math.min(Lt.x,Ht.x,Kt.x),sr=Math.max(Lt.x,Ht.x,Kt.x),hr=Math.min(Lt.y,Ht.y,Kt.y),ur=Math.max(Lt.y,Ht.y,Kt.y);Rt.length=0,b.grid.query(new zn(Qt,hr),new zn(sr,ur),Rt);for(let _r=0;_r<Rt.length;_r++){const br=Rt[_r];if(Sp(gt[ft[3*br+0]],gt[ft[3*br+1]],gt[ft[3*br+2]],Lt,Ht,Kt,lt))return!0}}return!1}function MA(b,o,g,et){if(!b||!g)return!1;let nt=b.vertices;if(!o.canonical.equals(et.canonical)||o.wrap!==et.wrap){if(g.vertices.length<b.vertices.length)return MA(g,et,b,o);const at=o.canonical,lt=et.canonical,ft=Math.pow(2,lt.z-at.z);nt=b.vertices.map(gt=>new zn((gt.x+at.x*ss)*ft-lt.x*ss,(gt.y+at.y*ss)*ft-lt.y*ss))}return $2(g,nt,b.indices,0,b.indices.length,0,0)}function NA(b,o,g,et){const nt=Math.pow(2,et.z-g.z);return new zn((b+g.x*ss)*nt-et.x*ss,(o+g.y*ss)*nt-et.y*ss)}function OA(b,o){const g=[];o.grid.queryPoint(b,g);const et=o.indices,nt=o.vertices;for(let at=0;at<g.length;at++){const lt=g[at];if(Zl([nt[et[3*lt+0]],nt[et[3*lt+1]],nt[et[3*lt+2]]],b))return!0}return!1}const H2=[new zn(0,0),new zn(ss,0),new zn(ss,ss),new zn(0,ss)];function LA(b,o){const g=[];let et=[];if(!o||b.length<2)return[b];if(b.length===2)return _p(b[0],b[1],H2)?[b]:[];for(let nt=0;nt<b.length+2;nt++){const at=b[nt%b.length],lt=b[(nt+1)%b.length],ft=_p(nt===0?b[b.length-1]:b[(nt-1)%b.length],at,H2),gt=_p(at,lt,H2),Rt=ft||gt;Rt&&et.push(at),Rt&&gt||et.length>0&&(et.length>1&&g.push(et),et=[])}return et.length>1&&g.push(et),g}const W2=sn.types,MR=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],NR=["fill-extrusion-flood-light-ground-radius"],OR=Math.pow(2,13),LR=Math.pow(2,15)-1,jA=new zn(0,1),gx=2147483648,zA=7,VA=450;function Bv(b,o,g,et,nt,at,lt,ft){b.emplaceBack((o<<1)+lt,(g<<1)+at,(Math.floor(et*OR)<<1)+nt,Math.round(ft))}function Mv(b,o,g){b.emplaceBack(o.x*ss,o.y*ss,g?1:0)}function xw(b,o,g,et,nt,at){b.emplaceBack(o.x,o.y,(g.x<<1)+et,(g.y<<1)+nt,at)}function Nv(b,o,g){b.emplaceBack(o.x,o.y,o.z,g[0]*16384,g[1]*16384,g[2]*16384)}class UA{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class GA{constructor(){this.centroidXY=new zn(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new zn(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new zn(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0}span(){return new zn(this.max.x-this.min.x,this.max.y-this.min.y)}}class $A{constructor(){this.acc=new zn(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(o,g){o.min.x===Number.MAX_VALUE&&(o.min.x=o.max.x=g.x,o.min.y=o.max.y=g.y)}appendEdge(o,g,et){this.accCount++,this.acc._add(g);let nt=!!this.borders;g.x<o.min.x?(o.min.x=g.x,nt=!0):g.x>o.max.x&&(o.max.x=g.x,nt=!0),g.y<o.min.y?(o.min.y=g.y,nt=!0):g.y>o.max.y&&(o.max.y=g.y,nt=!0),((g.x===0||g.x===ss)&&g.x===et.x)!=((g.y===0||g.y===ss)&&g.y===et.y)&&this.processBorderOverlap(g,et),nt&&this.checkBorderIntersection(g,et)}checkBorderIntersection(o,g){g.x<0!=o.x<0&&this.addBorderIntersection(0,so(g.y,o.y,(0-g.x)/(o.x-g.x))),g.x>ss!=o.x>ss&&this.addBorderIntersection(1,so(g.y,o.y,(ss-g.x)/(o.x-g.x))),g.y<0!=o.y<0&&this.addBorderIntersection(2,so(g.x,o.x,(0-g.y)/(o.y-g.y))),g.y>ss!=o.y>ss&&this.addBorderIntersection(3,so(g.x,o.x,(ss-g.y)/(o.y-g.y)))}addBorderIntersection(o,g){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const et=this.borders[o];g<et[0]&&(et[0]=g),g>et[1]&&(et[1]=g)}processBorderOverlap(o,g){if(o.x===g.x){if(o.y===g.y)return;const et=o.x===0?0:1;this.addBorderIntersection(et,g.y),this.addBorderIntersection(et,o.y)}else{const et=o.y===0?2:3;this.addBorderIntersection(et,g.x),this.addBorderIntersection(et,o.x)}}centroid(){return this.accCount===0?new zn(0,0):new zn(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((o,g)=>o+ +(g[0]!==Number.MAX_VALUE),0):0}}function HA(b,o){const g=b.add(o)._unit(),et=pr(b.x*g.x+b.y*g.y,-1,1);var nt,at,lt;return nt=Math.acos(et),Math.min(4,Math.max(-4,Math.tan(nt)))/4*LR*((at=b).x*(lt=o).y-at.y*lt.x<0?-1:1)}const jR=[b=>b.x<0,b=>b.x>ss,b=>b.y<0,b=>b.y>ss];function zR(b,o,g,et){const nt=[4];if(et===0)return nt;g._mult(et);const at=b.sub(g),lt=o.sub(g),ft=[b,o,at,lt];for(let gt=0;gt<4;gt++)for(const Rt of ft)if(jR[gt](Rt)){nt.push(gt);break}return nt}class q2{constructor(o){this.groundRadiusArray=null,this.groundRadiusBuffer=null,this.vertexArray=new lv,this.indexArray=new _f,this.programConfigurations=new B0(o.layers,{zoom:o.zoom,lut:o.lut},g=>NR.includes(g)),this._segments=new Eu,this.hiddenByLandmarkVertexArray=new $y,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Eu}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(o,g,et,nt=!1){const at=o.length;if(at>2){let lt=Math.max(0,this._segments.get().length-1);const ft=this._segments._prepareSegment(4*at,this.vertexArray.length,2*this._segmentToGroundQuads[lt].length);let gt;lt!==this._segments.get().length-1&&(lt++,this._segmentToGroundQuads[lt]=[],this._segmentToRegionTriCounts[lt]=[0,0,0,0,0]);{const Rt=o[0],Mt=o[1];gt=HA(Rt.sub(o[at-1])._perp()._unit(),Mt.sub(Rt)._perp()._unit())}for(let Rt=0;Rt<at;Rt++){const Mt=Rt===at-1?0:Rt+1,Lt=o[Rt],Ht=o[Mt],Kt=o[Mt===at-1?0:Mt+1],Qt=Ht.sub(Lt)._perp()._unit(),sr=HA(Qt,Kt.sub(Ht)._perp()._unit()),hr=gt,ur=sr;if(X2(Lt,Ht,g)||nt&&XA(Lt,g)&&XA(Ht,g)){gt=sr;continue}const _r=ft.vertexLength;xw(this.vertexArray,Lt,Ht,1,1,hr),xw(this.vertexArray,Lt,Ht,1,0,hr),xw(this.vertexArray,Lt,Ht,0,1,ur),xw(this.vertexArray,Lt,Ht,0,0,ur),ft.vertexLength+=4;const br=zR(Lt,Ht,Qt,et);for(const Ir of br)this._segmentToGroundQuads[lt].push({id:_r,region:Ir}),this._segmentToRegionTriCounts[lt][Ir]+=2,ft.primitiveLength+=2;gt=sr}}}prepareBorderSegments(){if(!this.hasData())return;const o=this._segments.get(),g=o.length;for(let et=0;et<g;et++)this._segmentToGroundQuads[et].sort((nt,at)=>nt.region-at.region);for(let et=0;et<g;et++){const nt=this._segmentToGroundQuads[et],at=o[et],lt=this._segmentToRegionTriCounts[et];lt.reduce((gt,Rt)=>gt+Rt,0);let ft=0;for(let gt=0;gt<=4;gt++){const Rt=lt[gt];if(Rt!==0){let Mt=this.regionSegments[gt];Mt||(Mt=this.regionSegments[gt]=new Eu);const Lt={vertexOffset:at.vertexOffset,primitiveOffset:at.primitiveOffset+ft,vertexLength:at.vertexLength,primitiveLength:Rt};Mt.get().push(Lt)}ft+=Rt}for(let gt=0;gt<nt.length;gt++){const Rt=nt[gt].id;this.indexArray.emplaceBack(Rt,Rt+1,Rt+3),this.indexArray.emplaceBack(Rt,Rt+3,Rt+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(o,g,et,nt,at,lt,ft){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,o,g,et,nt,at,lt,void 0,ft)}upload(o){this.hasData()&&(this.vertexBuffer=o.createVertexBuffer(this.vertexArray,TR.members),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.groundRadiusArray!=null&&(this.groundRadiusBuffer=o.createVertexBuffer(this.groundRadiusArray,RR.members)))}uploadPaintProperties(o){this.hasData()&&this.programConfigurations.upload(o)}update(o,g,et,nt,at,lt,ft,gt){this.hasData()&&this.programConfigurations.updatePaintArrays(o,g,et,nt,at,lt,ft,gt)}updateHiddenByLandmark(o){this.updateHiddenByLandmarkRange(o.groundVertexArrayOffset,o.groundVertexCount,!!(o.flags&gx))}updateHiddenByLandmarkRange(o,g,et){if(!this.hasData())return;const nt=g+o;if(g!==0){for(let at=o;at<nt;++at)this.hiddenByLandmarkVertexArray.emplace(at,et?1:0);this._needsHiddenByLandmarkUpdate=!0}}uploadHiddenByLandmark(o){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=o.createVertexBuffer(this.hiddenByLandmarkVertexArray,PR.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this.groundRadiusBuffer&&this.groundRadiusBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let o=0;o<=4;o++){const g=this.regionSegments[o];g&&g.destroy()}}}}class gw{constructor(o){this.zoom=o.zoom,this.canonical=o.canonical,this.overscaling=o.overscaling,this.layers=o.layers,this.pixelRatio=o.pixelRatio,this.layerIds=this.layers.map(g=>g.fqid),this.index=o.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=o.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new _f,this.footprintVertices=new jm,this.footprintSegments=[],this.layoutVertexArray=new $x,this.centroidVertexArray=new iw,this.wallVertexArray=new T1,this.indexArray=new _f,this.programConfigurations=new B0(o.layers,{zoom:o.zoom,lut:o.lut},g=>MR.includes(g)),this.segments=new Eu,this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.groundEffect=new q2(o),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=o.worldview,this.hasAppearances=null}updateFootprints(o,g){}updateAppearances(o,g,et,nt){}populate(o,g,et,nt){this.features=[],this.hasPattern=L2("fill-extrusion",this.layers,this.pixelRatio,g),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=xr(et),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:at,id:lt,index:ft,sourceLayerIndex:gt}of o){const Rt=this.layers[0]._featureFilter.needGeometry,Mt=an(at,Rt);if(!this.layers[0]._featureFilter.filter(new ou(this.zoom,{worldview:this.worldview,activeFloors:g.activeFloors}),Mt,et))continue;const Lt={id:lt,sourceLayerIndex:gt,index:ft,geometry:Rt?Mt.geometry:Xr(at,et,nt),properties:at.properties,type:at.type,patterns:{}},Ht=this.layoutVertexArray.length,Kt=W2[Lt.type]==="Polygon";if(this.hasPattern)this.features.push({featureId:at.id,feature:j2("fill-extrusion",this.layers,Lt,this.zoom,this.pixelRatio,g)});else if(this.wallMode)for(const Qt of Lt.geometry)for(const sr of LA(Qt,Kt))this.addFeature(at.id,Lt,[sr],ft,et,{},g.availableImages,nt,g.brightness);else this.addFeature(at.id,Lt,Lt.geometry,ft,et,{},g.availableImages,nt,g.brightness);g.featureIndex.insert(at,Lt.geometry,ft,gt,this.index,Ht)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(o,g,et,nt,at,lt){for(const{featureId:ft,feature:gt}of this.features){const Rt=W2[gt.type]==="Polygon",{geometry:Mt}=gt;if(this.wallMode)for(const Lt of Mt)for(const Ht of LA(Lt,Rt))this.addFeature(ft,gt,[Ht],gt.index,g,et,nt,at,lt);else this.addFeature(ft,gt,Mt,gt.index,g,et,nt,at,lt)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(o,g,et,nt,at,lt,ft){this.programConfigurations.updatePaintArrays(o,g,at,et,nt,lt,ft,this.worldview),this.groundEffect.update(o,g,at,et,nt,lt,ft,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,FR),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.wallVertexBuffer=o.createVertexBuffer(this.wallVertexArray,DR.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=o.createVertexBuffer(this.layoutVertexExtArray,kR.members,!0)),this.groundEffect.upload(o)),this.groundEffect.uploadPaintProperties(o),this.programConfigurations.upload(o),this.uploaded=!0}uploadCentroid(o){this.groundEffect.uploadHiddenByLandmark(o),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=o.createVertexBuffer(this.centroidVertexArray,IR.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(o,g,et,nt,at,lt,ft,gt,Rt){const Mt=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(g,{})/this.tileToMeter,Lt=[new zn(0,0),new zn(ss,ss)],Ht=gt.projection,Kt=Ht.name==="globe",Qt=this.wallMode||W2[g.type]==="Polygon",sr=new $A;sr.centroidDataIndex=this.centroidData.length;const hr=new GA;hr.buildingId=o,g.properties&&g.properties.hasOwnProperty("building_id")&&(hr.buildingId=g.properties.building_id);const ur=this.layers[0].paint.get("fill-extrusion-base").evaluate(g,{},at)<=0,_r=this.layers[0].paint.get("fill-extrusion-height").evaluate(g,{},at);let br;if(hr.height=_r,hr.vertexArrayOffset=this.layoutVertexArray.length,hr.groundVertexArrayOffset=this.groundEffect.vertexArray.length,Kt&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Ly),this.wallMode){if(Kt)return void bs("Non zero fill-extrusion-line-width is not yet supported on globe.");if(et.length!==1)return;br=function(ln){const Fn=ln[0].x===ln[ln.length-1].x&&ln[0].y===ln[ln.length-1].y;(function(Is){let Ns=0;const Fo=Is.length;for(let ts=0;ts<Fo;ts++)Ns+=(Is[(ts+1)%Fo].x-Is[ts].x)*(Is[(ts+1)%Fo].y+Is[ts].y);return Ns>=0})(ln)||(ln=ln.reverse());const jn={geometry:[],joinNormals:[],indices:[]},Zn=[],Qn=[],Hn=[];let Wn=ln.length;for(;Wn>=2&&ln[Wn-1].equals(ln[Wn-2]);)Wn--;if(Wn<(Fn?3:2))return jn;let kn,In,Kn,as,es,$s=0;for(;$s<Wn-1&&ln[$s].equals(ln[$s+1]);)$s++;Fn&&(kn=ln[Wn-2],es=ln[$s].sub(kn)._unit()._perp());for(let Is=$s;Is<Wn;Is++){if(Kn=Is===Wn-1?Fn?ln[$s+1]:void 0:ln[Is+1],Kn&&ln[Is].equals(Kn))continue;es&&(as=es),kn&&(In=kn),kn=ln[Is],es=Kn?Kn.sub(kn)._unit()._perp():as,as=as||es;let Ns=as.add(es);Ns.x===0&&Ns.y===0||Ns._unit();const Fo=Ns.x*es.x+Ns.y*es.y,ts=Fo!==0?1/Fo:1/0,Os=as.x*es.y-as.y*es.x>0;let fo="miter";const Ko=2;fo==="miter"&&ts>Ko&&(fo="bevel"),fo==="bevel"&&(ts>100&&(fo="flipbevel"),ts<Ko&&(fo="miter"));const xa=(wo,$l,Nr,Ur)=>{const Bn=new zn(wo.x,wo.y),Yn=new zn(wo.x,wo.y);Bn.x+=$l.x*Ur,Bn.y+=$l.y*Ur,Yn.x-=$l.x*Math.max(Nr,1),Yn.y-=$l.y*Math.max(Nr,1),Hn.push($l),Zn.push(Bn),Qn.push(Yn)};if(fo==="miter")Ns._mult(ts),xa(kn,Ns,0,0);else if(fo==="flipbevel")Ns=es.mult(-1),xa(kn,Ns,0,0),xa(kn,Ns.mult(-1),0,0);else{const wo=-Math.sqrt(ts*ts-1),$l=Os?wo:0,Nr=Os?0:wo;In&&xa(kn,as,$l,Nr),Kn&&xa(kn,es,$l,Nr)}}jn.geometry=[...Zn,...Qn.reverse(),Zn[0]],jn.joinNormals=[...Hn,...Hn.reverse(),Hn[Hn.length-1]];const vs=jn.geometry.length-1;for(let Is=0;Is<vs/2;Is++)if(Is+1<vs/2){let Ns=Is,Fo=Is+1,ts=vs-1-Is,Os=vs-2-Is;Ns=Ns===0?vs-1:Ns-1,Fo=Fo===0?vs-1:Fo-1,ts=ts===0?vs-1:ts-1,Os=Os===0?vs-1:Os-1,jn.indices.push(ts),jn.indices.push(Fo),jn.indices.push(Ns),jn.indices.push(ts),jn.indices.push(Os),jn.indices.push(Fo)}return jn}(et[0]),et=[br.geometry]}const Ir=(ln,Fn)=>ln<(Fn.length-1)/2||ln===Fn.length-1,Vr=this.wallMode?[et]:kv(et,500);for(let ln=Vr.length-1;ln>=0;ln--){const Fn=Vr[ln];(Fn.length===0||(Mr=Fn[0]).every(Ln=>Ln.x<=0)||Mr.every(Ln=>Ln.x>=ss)||Mr.every(Ln=>Ln.y<=0)||Mr.every(Ln=>Ln.y>=ss))&&Vr.splice(ln,1)}var Mr;let Hr;if(Kt)Hr=QA(Vr,Lt,at);else{Hr=[];for(const ln of Vr)Hr.push({polygon:ln,bounds:Lt})}const Zr=Qt?this.edgeRadius:0,en=Zr>0&&this.zoom<17,Tn=(ln,Fn)=>{if(ln.length===0)return!1;const Ln=ln[ln.length-1];return Fn.x===Ln.x&&Fn.y===Ln.y};for(const{polygon:ln,bounds:Fn}of Hr){let Ln=0,jn=0;for(const Wn of ln)Qt&&!Wn[0].equals(Wn[Wn.length-1])&&Wn.push(Wn[0]),jn+=Qt?Wn.length-1:Wn.length;const Zn=this.segments.prepareSegment((Qt?5:4)*jn,this.layoutVertexArray,this.indexArray);hr.footprintSegIdx<0&&(hr.footprintSegIdx=this.footprintSegments.length),hr.polygonSegIdx<0&&(hr.polygonSegIdx=this.polygonSegments.length);const Qn={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Hn=new UA;if(Hn.vertexOffset=this.footprintVertices.length,Hn.indexOffset=3*this.footprintIndices.length,Hn.ringIndices=[],Qt){const Wn=[],kn=[];Ln=Zn.vertexLength;for(let Kn=0;Kn<ln.length;Kn++){const as=ln[Kn];as.length&&Kn!==0&&kn.push(Wn.length/2);const es=[];let $s,vs;$s=as[1].sub(as[0])._perp()._unit(),Hn.ringIndices.push(as.length-1);for(let Is=1;Is<as.length;Is++){const Ns=as[Is],Fo=as[Is===as.length-1?1:Is+1],ts=Ns.clone();if(Zr){vs=Fo.sub(Ns)._perp()._unit();const Os=$s.add(vs)._unit(),fo=Zr*Math.min(4,1/($s.x*Os.x+$s.y*Os.y));ts.x+=fo*Os.x,ts.y+=fo*Os.y,ts.x=Math.round(ts.x),ts.y=Math.round(ts.y),$s=vs}if(!ur||Zr!==0&&!en||Tn(es,ts)||es.push(ts),Bv(this.layoutVertexArray,ts.x,ts.y,0,0,1,1,0),this.wallMode){const Os=Ir(Is,as);Mv(this.wallVertexArray,br.joinNormals[Is],!Os)}Zn.vertexLength++,this.footprintVertices.emplaceBack(Ns.x,Ns.y),Wn.push(Ns.x,Ns.y),Kt&&Nv(this.layoutVertexExtArray,Ht.projectTilePoint(ts.x,ts.y,at),Ht.upVector(at,ts.x,ts.y))}ur&&(Zr===0||en)&&(es.length!==0&&Tn(es,es[0])&&es.pop(),this.groundEffect.addData(es,Fn,Mt))}const In=this.wallMode?br.indices:r_(Wn,kn);for(let Kn=0;Kn<In.length;Kn+=3)this.footprintIndices.emplaceBack(Hn.vertexOffset+In[Kn+0],Hn.vertexOffset+In[Kn+1],Hn.vertexOffset+In[Kn+2]),this.indexArray.emplaceBack(Ln+In[Kn],Ln+In[Kn+2],Ln+In[Kn+1]),Zn.primitiveLength++;Hn.indexCount+=In.length,Hn.vertexCount+=this.footprintVertices.length-Hn.vertexOffset}for(let Wn=0;Wn<ln.length;Wn++){const kn=ln[Wn];sr.startRing(hr,kn[0]);let In=kn.length>4&&KA(kn[kn.length-2],kn[0],kn[1]),Kn=Zr?VR(kn[kn.length-2],kn[0],kn[1],Zr):0;const as=[];let es,$s,vs;$s=kn[1].sub(kn[0])._perp()._unit();let Is=!0;for(let Ns=1,Fo=0;Ns<kn.length;Ns++){let ts=kn[Ns-1],Os=kn[Ns];const fo=kn[Ns===kn.length-1?1:Ns+1];if(sr.appendEdge(hr,Os,ts),X2(Os,ts,Fn)){Zr&&($s=fo.sub(Os)._perp()._unit(),Is=!Is);continue}const Ko=Os.sub(ts)._perp(),xa=Ko.x/(Math.abs(Ko.x)+Math.abs(Ko.y)),wo=Ko.y>0?1:0,$l=ts.dist(Os);if(Fo+$l>32768&&(Fo=0),Zr){vs=fo.sub(Os)._perp()._unit();let Yn=qA(ts,Os,fo,WA($s,vs),Zr);isNaN(Yn)&&(Yn=0);const xs=Os.sub(ts)._unit();ts=ts.add(xs.mult(Kn))._round(),Os=Os.add(xs.mult(-Yn))._round(),Kn=Yn,$s=vs,ur&&this.zoom>=17&&(Tn(as,ts)||as.push(ts),Tn(as,Os)||as.push(Os))}const Nr=Zn.vertexLength,Ur=kn.length>4&&KA(ts,Os,fo);let Bn=ZA(Fo,In,Is);if(Bv(this.layoutVertexArray,ts.x,ts.y,xa,wo,0,0,Bn),Bv(this.layoutVertexArray,ts.x,ts.y,xa,wo,0,1,Bn),this.wallMode){const Yn=Ir(Ns-1,kn),xs=br.joinNormals[Ns-1];Mv(this.wallVertexArray,xs,Yn),Mv(this.wallVertexArray,xs,Yn)}if(Fo+=$l,Bn=ZA(Fo,Ur,!Is),In=Ur,Bv(this.layoutVertexArray,Os.x,Os.y,xa,wo,0,0,Bn),Bv(this.layoutVertexArray,Os.x,Os.y,xa,wo,0,1,Bn),this.wallMode){const Yn=Ir(Ns,kn),xs=br.joinNormals[Ns];Mv(this.wallVertexArray,xs,Yn),Mv(this.wallVertexArray,xs,Yn)}if(Zn.vertexLength+=4,this.indexArray.emplaceBack(Nr+0,Nr+1,Nr+2),this.indexArray.emplaceBack(Nr+1,Nr+3,Nr+2),Zn.primitiveLength+=2,Zr){const Yn=Ln+(Ns===1?kn.length-2:Ns-2),xs=Ns===1?Ln:Yn+1;if(this.indexArray.emplaceBack(Nr+1,Yn,Nr+3),this.indexArray.emplaceBack(Yn,xs,Nr+3),Zn.primitiveLength+=2,es===void 0&&(es=Nr),!X2(fo,kn[Ns],Fn)){const gs=Ns===kn.length-1?es:Zn.vertexLength;this.indexArray.emplaceBack(Nr+2,Nr+3,gs),this.indexArray.emplaceBack(Nr+3,gs+1,gs),this.indexArray.emplaceBack(Nr+3,xs,gs+1),Zn.primitiveLength+=3}Is=!Is}if(Kt){const Yn=this.layoutVertexExtArray,xs=Ht.projectTilePoint(ts.x,ts.y,at),gs=Ht.projectTilePoint(Os.x,Os.y,at),Ws=Ht.upVector(at,ts.x,ts.y),Zs=Ht.upVector(at,Os.x,Os.y);Nv(Yn,xs,Ws),Nv(Yn,xs,Ws),Nv(Yn,gs,Zs),Nv(Yn,gs,Zs)}}Qt&&(Ln+=kn.length-1),ur&&Zr&&this.zoom>=17&&(as.length!==0&&Tn(as,as[0])&&as.pop(),this.groundEffect.addData(as,Fn,Mt,Zr>0))}this.footprintSegments.push(Hn),Qn.triangleCount=this.indexArray.length-Qn.triangleArrayOffset,this.polygonSegments.push(Qn),++hr.footprintSegLen,++hr.polygonSegLen}if(hr.vertexCount=this.layoutVertexArray.length-hr.vertexArrayOffset,hr.groundVertexCount=this.groundEffect.vertexArray.length-hr.groundVertexArrayOffset,hr.vertexCount!==0){if(hr.centroidXY=sr.borders?jA:this.encodeCentroid(sr,hr),this.centroidData.push(hr),sr.borders){this.featuresOnBorder.push(sr);const ln=this.featuresOnBorder.length-1;for(let Fn=0;Fn<sr.borders.length;Fn++)sr.borders[Fn][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Fn].push(ln)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,g,nt,lt,ft,at,Rt,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(g,nt,lt,ft,at,Rt,this.worldview),this.maxHeight=Math.max(this.maxHeight,_r)}}sortBorders(){for(let o=0;o<this.borderFeatureIndices.length;o++)this.borderFeatureIndices[o].sort((g,et)=>this.featuresOnBorder[g].borders[o][0]-this.featuresOnBorder[et].borders[o][0])}splitToSubtiles(){const o=[];for(let ft=0;ft<this.centroidData.length;ft++){const gt=this.centroidData[ft],Rt=+(gt.min.y+gt.max.y>ss),Mt=2*Rt+(+(gt.min.x+gt.max.x>ss)^Rt);for(let Lt=0;Lt<gt.polygonSegLen;Lt++){const Ht=gt.polygonSegIdx+Lt;o.push({centroidIdx:ft,subtile:Mt,polygonSegmentIdx:Ht,triangleSegmentIdx:this.polygonSegments[Ht].triangleSegIdx})}}const g=new _f;o.sort((ft,gt)=>ft.triangleSegmentIdx===gt.triangleSegmentIdx?ft.subtile-gt.subtile:ft.triangleSegmentIdx-gt.triangleSegmentIdx);let et=0,nt=0,at=0;for(const ft of o){if(ft.triangleSegmentIdx!==et)break;at++}const lt=o.length;for(;nt!==o.length;){et=o[nt].triangleSegmentIdx;let ft=0,gt=nt,Rt=nt;for(let Mt=gt;Mt<at&&o[Mt].subtile===ft;Mt++)Rt++;for(;gt!==at;){const Mt=o[gt];ft=Mt.subtile;const Lt=this.centroidData[Mt.centroidIdx].min.clone(),Ht=this.centroidData[Mt.centroidIdx].max.clone(),Kt={vertexOffset:this.segments.segments[et].vertexOffset,primitiveOffset:g.length,vertexLength:this.segments.segments[et].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let Qt=gt;Qt<Rt;Qt++){const sr=o[Qt],hr=this.polygonSegments[sr.polygonSegmentIdx],ur=this.centroidData[sr.centroidIdx].min,_r=this.centroidData[sr.centroidIdx].max,br=this.indexArray.uint16;for(let Ir=hr.triangleArrayOffset;Ir<hr.triangleArrayOffset+hr.triangleCount;Ir++)g.emplaceBack(br[3*Ir],br[3*Ir+1],br[3*Ir+2]);Kt.primitiveLength+=hr.triangleCount,Lt.x=Math.min(Lt.x,ur.x),Lt.y=Math.min(Lt.y,ur.y),Ht.x=Math.max(Ht.x,_r.x),Ht.y=Math.max(Ht.y,_r.y)}Kt.primitiveLength>0&&this.triangleSubSegments.push({segment:Kt,min:Lt,max:Ht}),gt=Rt;for(let Qt=gt;Qt<at&&o[Qt].subtile===o[gt].subtile;Qt++)Rt++}nt=at;for(let Mt=nt;Mt<lt&&o[Mt].triangleSegmentIdx===o[nt].triangleSegmentIdx;Mt++)at++}g._trim(),this.indexArray=g}getVisibleSegments(o,g,et){const nt=new Eu;if(this.wallMode){for(const sr of this.triangleSubSegments)nt.segments.push(sr.segment);return nt}let at=0,lt=0;const ft=1<<o.canonical.z;if(g){const sr=g.getMinMaxForTile(o);sr&&(at=sr.min,lt=sr.max)}lt+=this.maxHeight;const gt=o.toUnwrapped();let Rt;const Mt=[gt.canonical.x/ft+gt.wrap,gt.canonical.y/ft],Lt=[(gt.canonical.x+1)/ft+gt.wrap,(gt.canonical.y+1)/ft],Ht=(sr,hr,ur)=>[sr[0]*(1-ur[0])+hr[0]*ur[0],sr[1]*(1-ur[1])+hr[1]*ur[1]],Kt=[],Qt=[];for(const sr of this.triangleSubSegments){Kt[0]=sr.min.x/ss,Kt[1]=sr.min.y/ss,Qt[0]=sr.max.x/ss,Qt[1]=sr.max.y/ss;const hr=Ht(Mt,Lt,Kt),ur=Ht(Mt,Lt,Qt);if(new zs([hr[0],hr[1],at],[ur[0],ur[1],lt]).intersectsPrecise(et)===0){Rt&&(nt.segments.push(Rt),Rt=void 0);continue}const _r=sr.segment;Rt&&Rt.vertexOffset!==_r.vertexOffset&&(nt.segments.push(Rt),Rt=void 0),Rt?(Rt.vertexLength+=_r.vertexLength,Rt.primitiveLength+=_r.primitiveLength):Rt={vertexOffset:_r.vertexOffset,primitiveLength:_r.primitiveLength,vertexLength:_r.vertexLength,primitiveOffset:_r.primitiveOffset,sortKey:void 0,vaos:{}}}return Rt&&nt.segments.push(Rt),nt}encodeCentroid(o,g){const et=o.centroid(),nt=g.span(),at=Math.min(7,Math.round(nt.x*this.tileToMeter/10)),lt=Math.min(7,Math.round(nt.y*this.tileToMeter/10));return new zn(pr(et.x,1,ss-1)<<3|at,pr(et.y,1,ss-1)<<3|lt)}encodeBorderCentroid(o){if(!o.borders)return new zn(0,0);const g=o.borders,et=Number.MAX_VALUE;if(g[0][0]!==et||g[1][0]!==et){const nt=g[0][0]!==et?0:1;return new zn(6|(g[0][0]!==et?0:65528),(g[nt][0]+g[nt][1])/2<<3|6)}{const nt=g[2][0]!==et?2:3;return new zn((g[nt][0]+g[nt][1])/2<<3|6,6|(g[2][0]!==et?0:65528))}}showCentroid(o){const g=this.centroidData[o.centroidDataIndex];g.flags&=2147483647,g.centroidXY.x=0,g.centroidXY.y=0,this.writeCentroidToBuffer(g)}writeCentroidToBuffer(o){this.groundEffect.updateHiddenByLandmark(o);const g=o.vertexArrayOffset,et=o.vertexCount+o.vertexArrayOffset,nt=o.flags&gx?jA:o.centroidXY,at=this.centroidVertexArray.geta_centroid_pos0(g);if(this.centroidVertexArray.geta_centroid_pos1(g)!==nt.y||at!==nt.x){for(let lt=g;lt<et;++lt)this.centroidVertexArray.emplace(lt,nt.x,nt.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const o of this.centroidData)this.writeCentroidToBuffer(o)}updateReplacement(o,g,et){if(g.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=g.updateTime;const nt=g.getReplacementRegionsForTile(o.toUnwrapped());if(mw(this.activeReplacements,nt))return;if(this.activeReplacements=nt,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const lt of this.centroidData)lt.flags&=2147483647;const at=[];for(const lt of this.activeReplacements){if(lt.order<et)continue;const ft=Math.max(1,Math.pow(2,lt.footprintTileId.canonical.z-o.canonical.z));if(lt.footprint.buildingIds)for(const gt of this.centroidData)gt.flags&gx||lt.min.x>gt.max.x||gt.min.x>lt.max.x||lt.min.y>gt.max.y||gt.min.y>lt.max.y||lt.footprint.buildingIds.has(gt.buildingId)&&(gt.flags|=gx);else for(const gt of this.centroidData)if(!(gt.flags&gx||lt.min.x>gt.max.x||gt.min.x>lt.max.x||lt.min.y>gt.max.y||gt.min.y>lt.max.y))for(let Rt=0;Rt<gt.footprintSegLen;Rt++){const Mt=this.footprintSegments[gt.footprintSegIdx+Rt];if(at.length=0,UR(this.footprintVertices,Mt.vertexOffset,Mt.vertexCount,lt.footprintTileId.canonical,o.canonical,at),$2(lt.footprint,at,this.footprintIndices.uint16,Mt.indexOffset,Mt.indexCount,-Mt.vertexOffset,-ft)){gt.flags|=gx;break}}}for(const lt of this.centroidData)this.writeCentroidToBuffer(lt);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(o,g,et){let nt=!1;for(let at=0;at<et.footprintSegLen;at++){const lt=this.footprintSegments[et.footprintSegIdx+at];let ft=0;for(const gt of lt.ringIndices){for(let Rt=ft,Mt=gt+ft-1;Rt<gt+ft;Mt=Rt++){const Lt=this.footprintVertices.int16[2*(Rt+lt.vertexOffset)+0],Ht=this.footprintVertices.int16[2*(Rt+lt.vertexOffset)+1],Kt=this.footprintVertices.int16[2*(Mt+lt.vertexOffset)+1];Ht>g!=Kt>g&&o<(this.footprintVertices.int16[2*(Mt+lt.vertexOffset)+0]-Lt)*(g-Ht)/(Kt-Ht)+Lt&&(nt=!nt)}ft=gt}}return nt}getHeightAtTileCoord(o,g){let et=Number.NEGATIVE_INFINITY,nt=!0;const at=4*(o+ss)*ss+(g+ss);if(this.partLookup.hasOwnProperty(at)){const lt=this.partLookup[at];return lt?{height:lt.height,hidden:!!(lt.flags&gx)}:void 0}for(const lt of this.centroidData)o>lt.max.x||lt.min.x>o||g>lt.max.y||lt.min.y>g||lt.height<=et||this.footprintContainsPoint(o,g,lt)&&(et=lt.height,this.partLookup[at]=lt,nt=!!(lt.flags&gx));if(et!==Number.NEGATIVE_INFINITY)return{height:et,hidden:nt};this.partLookup[at]=void 0}}function WA(b,o){const g=b.add(o)._unit();return b.x*g.x+b.y*g.y}function VR(b,o,g,et){const nt=o.sub(b)._perp()._unit(),at=g.sub(o)._perp()._unit();return qA(b,o,g,WA(nt,at),et)}function qA(b,o,g,et,nt){const at=Math.sqrt(1-et*et);return Math.min(b.dist(o)/3,o.dist(g)/3,nt*at/et)}function X2(b,o,g){return b.x<g[0].x&&o.x<g[0].x||b.x>g[1].x&&o.x>g[1].x||b.y<g[0].y&&o.y<g[0].y||b.y>g[1].y&&o.y>g[1].y}function XA(b,o){return b.x<o[0].x||b.x>o[1].x||b.y<o[0].y||b.y>o[1].y}function KA(b,o,g){if(b.x<0||b.x>=ss||o.x<0||o.x>=ss||g.x<0||g.x>=ss)return!1;const et=g.sub(o),nt=et.perp(),at=b.sub(o);return(et.x*at.x+et.y*at.y)/Math.sqrt((et.x*et.x+et.y*et.y)*(at.x*at.x+at.y*at.y))>-.866&&nt.x*at.x+nt.y*at.y<0}function ZA(b,o,g){const et=o?2|b:-3&b;return g?1|et:-2&et}function YA(){const b=Math.PI/32,o=Math.tan(b),g=st;return g*Math.sqrt(1+2*o*o)-g}function QA(b,o,g){const et=1<<g.z,nt=Xt(g.x/et),at=Xt((g.x+1)/et),lt=rr(g.y/et),ft=rr((g.y+1)/et);return function(gt,Rt,Mt,Lt,Ht=0,Kt){const Qt=[];if(!gt.length||!Mt||!Lt)return Qt;const sr=(Mr,Hr)=>{for(const Zr of Mr)Qt.push({polygon:Zr,bounds:Hr})},hr=Math.ceil(Math.log2(Mt)),ur=Math.ceil(Math.log2(Lt)),_r=hr-ur,br=[];for(let Mr=0;Mr<Math.abs(_r);Mr++)br.push(_r>0?0:1);for(let Mr=0;Mr<Math.min(hr,ur);Mr++)br.push(0),br.push(1);let Ir=gt;if(Ir=hw(Ir,Rt[0].y-Ht,Rt[1].y+Ht,1),Ir=hw(Ir,Rt[0].x-Ht,Rt[1].x+Ht,0),!Ir.length)return Qt;const Vr=[];for(br.length?Vr.push({polygons:Ir,bounds:Rt,depth:0}):sr(Ir,Rt);Vr.length;){const Mr=Vr.pop(),Hr=Mr.depth,Zr=br[Hr],en=Mr.bounds[0],Tn=Mr.bounds[1],ln=Zr===0?en.x:en.y,Fn=Zr===0?Tn.x:Tn.y,Ln=Kt?Kt(Zr,ln,Fn):.5*(ln+Fn),jn=hw(Mr.polygons,ln-Ht,Ln+Ht,Zr),Zn=hw(Mr.polygons,Ln-Ht,Fn+Ht,Zr);if(jn.length){const Qn=[en,new zn(Zr===0?Ln:Tn.x,Zr===1?Ln:Tn.y)];br.length>Hr+1?Vr.push({polygons:jn,bounds:Qn,depth:Hr+1}):sr(jn,Qn)}if(Zn.length){const Qn=[new zn(Zr===0?Ln:en.x,Zr===1?Ln:en.y),Tn];br.length>Hr+1?Vr.push({polygons:Zn,bounds:Qn,depth:Hr+1}):sr(Zn,Qn)}}return Qt}(b,o,Math.ceil((at-nt)/11.25),Math.ceil((lt-ft)/11.25),1,(gt,Rt,Mt)=>{if(gt===0)return .5*(Rt+Mt);{const Lt=rr((g.y+Rt/ss)/et);return(kt(.5*(rr((g.y+Mt/ss)/et)+Lt))*et-g.y)*ss}})}function UR(b,o,g,et,nt,at){const lt=Math.pow(2,et.z-nt.z);for(let ft=0;ft<g;ft++){let gt=b.int16[2*(ft+o)+0],Rt=b.int16[2*(ft+o)+1];gt=(gt+nt.x*ss)*lt-et.x*ss,Rt=(Rt+nt.y*ss)*lt-et.y*ss,at.push(new zn(gt,Rt))}}let JA,eS;Ps(gw,"FillExtrusionBucket",{omit:["layers","features"]}),Ps(GA,"PartData"),Ps(UA,"FootprintSegment"),Ps($A,"BorderCentroidData"),Ps(q2,"GroundEffect");class O1 extends zn{constructor(o,g,et){super(o,g),this.z=et}}class tS extends O1{constructor(o,g,et,nt){super(o,g,et),this.w=nt}}function rS(b,o,g,et){const nt=g==="x"?"y":"x",at=(et-b[g])/(o[g]-b[g]);b[nt]=Math.round(b[nt]+(o[nt]-b[nt])*at),b[g]=et,b.hasOwnProperty("z")&&(b.z=so(b.z,o.z,at)),b.hasOwnProperty("w")&&(b.w=so(b.w,o.w,at))}function nS(b,o,g,et){const nt=g,at=et;for(const lt of["x","y"]){let ft=b,gt=o;ft[lt]>=gt[lt]&&(ft=o,gt=b),ft[lt]<nt&&gt[lt]>nt&&rS(ft,gt,lt,nt),ft[lt]<at&&gt[lt]>at&&rS(gt,ft,lt,at)}}function yw(b,o,g,et,nt,at){const lt=[];for(let ft=0;ft<b.length;ft++){const gt=b[ft];let Rt;const Mt=lt.length;let Lt=0;for(let Ht=0;Ht<gt.length-1;Ht++){let Kt=gt[Ht],Qt=gt[Ht+1],sr=0;const hr=Lt;let ur,_r;at&&(sr=Math.hypot(Qt.x-Kt.x,Qt.y-Kt.y),Lt+=sr,ur=Kt,_r=Qt),Kt.x<o&&Qt.x<o||(Kt.x<o?Kt=new zn(o,Kt.y+(o-Kt.x)/(Qt.x-Kt.x)*(Qt.y-Kt.y))._round():Qt.x<o&&(Qt=new zn(o,Kt.y+(o-Kt.x)/(Qt.x-Kt.x)*(Qt.y-Kt.y))._round()),Kt.y<g&&Qt.y<g||(Kt.y<g?Kt=new zn(Kt.x+(g-Kt.y)/(Qt.y-Kt.y)*(Qt.x-Kt.x),g)._round():Qt.y<g&&(Qt=new zn(Kt.x+(g-Kt.y)/(Qt.y-Kt.y)*(Qt.x-Kt.x),g)._round()),Kt.x>=et&&Qt.x>=et||(Kt.x>=et?Kt=new zn(et,Kt.y+(et-Kt.x)/(Qt.x-Kt.x)*(Qt.y-Kt.y))._round():Qt.x>=et&&(Qt=new zn(et,Kt.y+(et-Kt.x)/(Qt.x-Kt.x)*(Qt.y-Kt.y))._round()),Kt.y>=nt&&Qt.y>=nt||(Kt.y>=nt?Kt=new zn(Kt.x+(nt-Kt.y)/(Qt.y-Kt.y)*(Qt.x-Kt.x),nt)._round():Qt.y>=nt&&(Qt=new zn(Kt.x+(nt-Kt.y)/(Qt.y-Kt.y)*(Qt.x-Kt.x),nt)._round()),Rt&&Kt.equals(Rt[Rt.length-1])||(Rt=[Kt],lt.push(Rt),at&&at.push({progress:{min:hr+iS(ur,_r,Kt)*sr,max:1},parentIndex:ft,prevPoint:ur,nextPoint:_r})),Rt.push(Qt),at&&(at[at.length-1].progress.max=hr+iS(ur,_r,Qt)*sr,at[at.length-1].nextPoint=_r)))))}if(at&&Lt>0)for(let Ht=Mt;Ht<lt.length;Ht++)at[Ht].progress.min/=Lt,at[Ht].progress.max/=Lt}return lt}function GR(b,o,g,et,nt){if(b.length<2)return void et.push(b);const at=[];for(;o.valid();){const[Rt,Mt]=o.get();for(let Lt=0;Lt<b.length-1;Lt++){const Ht=b[Lt],Kt=b[Lt+1],Qt=To(Ht,Kt,Rt,Mt);if(Qt){const[sr]=Qt,hr=new zn(so(Ht.x,Kt.x,sr),so(Ht.y,Kt.y,sr));at.push({t:Lt+sr,distance:0,point:hr})}}o.next()}if(at.length===0)return void et.push(b);at.sort((Rt,Mt)=>Rt.t-Mt.t);let lt=0,ft=0,gt=[];for(et.push(gt);lt!==b.length;){if(ft===at.length){for(;lt!==b.length;)gt.length!==0&&gt[gt.length-1].equals(b[lt])||gt.push(b[lt]),lt++;break}at[ft].t<=lt?(gt.length!==0&&gt[gt.length-1].equals(at[ft].point)||gt.push(at[ft].point),Math.trunc(at[ft].t),ft++):(gt.length!==0&&gt[gt.length-1].equals(b[lt])||gt.push(b[lt]),lt++)}}function iS(b,o,g){return b.x!==o.x?(g.x-b.x)/(o.x-b.x):b.y!==o.y?(g.y-b.y)/(o.y-b.y):0}function Ov(b,o){return b.x*o.x+b.y*o.y}function sS(b,o){if(b.length===1){let g=0;const et=o[g++];let nt;for(;!nt||et.equals(nt);)if(nt=o[g++],!nt)return 1/0;for(;g<o.length;g++){const at=o[g],lt=b[0],ft=nt.sub(et),gt=at.sub(et),Rt=lt.sub(et),Mt=Ov(ft,ft),Lt=Ov(ft,gt),Ht=Ov(gt,gt),Kt=Ov(Rt,ft),Qt=Ov(Rt,gt),sr=Mt*Ht-Lt*Lt,hr=(Ht*Kt-Lt*Qt)/sr,ur=(Mt*Qt-Lt*Kt)/sr,_r=et.z*(1-hr-ur)+nt.z*hr+at.z*ur;if(isFinite(_r))return _r}return 1/0}{let g=1/0;for(const et of o)g=Math.min(g,et.z);return g}}function oS(b,o,g){let et=1/0;Rl(g,o)&&(et=sS(g,o[0]));for(let nt=0;nt<o.length;nt++){const at=o[nt],lt=b[nt];for(let ft=0;ft<at.length-1;ft++){const gt=at[ft],Rt=[gt,at[ft+1],lt[ft+1],lt[ft],gt];_l(g,Rt)&&(et=Math.min(et,sS(g,Rt)))}}return et!==1/0&&et}function aS(b,o,g,et,nt,at,lt,ft,gt,Rt,Mt){return b.projection.name==="globe"?function(Lt,Ht,Kt,Qt,sr,hr,ur,_r,br,Ir,Vr){const Mr=[],Hr=[],Zr=Lt.projection.upVectorScale(Vr,Lt.center.lat,Lt.worldSize).metersToTile,en=[0,0,0,1],Tn=[0,0,0,1],ln=(Ln,jn,Zn,Qn)=>{Ln[0]=jn,Ln[1]=Zn,Ln[2]=Qn,Ln[3]=1},Fn=YA();Kt>0&&(Kt+=Fn),Qt+=Fn;for(const Ln of Ht){const jn=[],Zn=[];for(const Qn of Ln){const Hn=Qn.x+sr.x,Wn=Qn.y+sr.y,kn=Lt.projection.projectTilePoint(Hn,Wn,Vr),In=Lt.projection.upVector(Vr,Qn.x,Qn.y);let Kn=Kt,as=Qt;if(ur){const es=lS(Hn,Wn,Kt,Qt,ur,_r,br,Ir);Kn+=es.base,as+=es.top}Kt!==0?ln(en,kn.x+In[0]*Zr*Kn,kn.y+In[1]*Zr*Kn,kn.z+In[2]*Zr*Kn):ln(en,kn.x,kn.y,kn.z),ln(Tn,kn.x+In[0]*Zr*as,kn.y+In[1]*Zr*as,kn.z+In[2]*Zr*as),ys(en,en,hr),ys(Tn,Tn,hr),jn.push(new O1(en[0],en[1],en[2])),Zn.push(new O1(Tn[0],Tn[1],Tn[2]))}Mr.push(jn),Hr.push(Zn)}return[Mr,Hr]}(b,o,g,et,nt,at,lt,ft,gt,Rt,Mt):lt?function(Lt,Ht,Kt,Qt,sr,hr,ur,_r,br){const Ir=[],Vr=[],Mr=[0,0,0,1];for(const Hr of Lt){const Zr=[],en=[];for(const Tn of Hr){const ln=Tn.x+Qt.x,Fn=Tn.y+Qt.y,Ln=lS(ln,Fn,Ht,Kt,hr,ur,_r,br);Mr[0]=ln,Mr[1]=Fn,Mr[2]=Ln.base,Mr[3]=1,ga(Mr,Mr,sr),Mr[3]=Math.max(Mr[3],1e-5);const jn=new O1(Mr[0]/Mr[3],Mr[1]/Mr[3],Mr[2]/Mr[3]);Mr[0]=ln,Mr[1]=Fn,Mr[2]=Ln.top,Mr[3]=1,ga(Mr,Mr,sr),Mr[3]=Math.max(Mr[3],1e-5);const Zn=new O1(Mr[0]/Mr[3],Mr[1]/Mr[3],Mr[2]/Mr[3]);Zr.push(jn),en.push(Zn)}Ir.push(Zr),Vr.push(en)}return[Ir,Vr]}(o,g,et,nt,at,lt,ft,gt,Rt):function(Lt,Ht,Kt,Qt,sr){const hr=[],ur=[],_r=sr[8]*Ht,br=sr[9]*Ht,Ir=sr[10]*Ht,Vr=sr[11]*Ht,Mr=sr[8]*Kt,Hr=sr[9]*Kt,Zr=sr[10]*Kt,en=sr[11]*Kt;for(const Tn of Lt){const ln=[],Fn=[];for(const Ln of Tn){const jn=Ln.x+Qt.x,Zn=Ln.y+Qt.y,Qn=sr[0]*jn+sr[4]*Zn+sr[12],Hn=sr[1]*jn+sr[5]*Zn+sr[13],Wn=sr[2]*jn+sr[6]*Zn+sr[14],kn=sr[3]*jn+sr[7]*Zn+sr[15],In=Qn+_r,Kn=Hn+br,as=Wn+Ir,es=Math.max(kn+Vr,1e-5),$s=Qn+Mr,vs=Hn+Hr,Is=Wn+Zr,Ns=Math.max(kn+en,1e-5);ln.push(new O1(In/es,Kn/es,as/es)),Fn.push(new O1($s/Ns,vs/Ns,Is/Ns))}hr.push(ln),ur.push(Fn)}return[hr,ur]}(o,g,et,nt,at)}function lS(b,o,g,et,nt,at,lt,ft){const gt=lt*nt.getElevationAt(b,o,!0,!0),Rt=at[0]!==0,Mt=Rt?at[1]===0?lt*(at[0]/zA-VA):lt*function(Lt,Ht,Kt){const Qt=Math.floor(Ht[0]/8),sr=Math.floor(Ht[1]/8),hr=10*(Ht[0]-8*Qt),ur=10*(Ht[1]-8*sr),_r=Lt.getElevationAt(Qt,sr,!0,!0),br=Lt.getMeterToDEM(Kt),Ir=Math.floor(.5*(hr*br-1)),Vr=Math.floor(.5*(ur*br-1)),Mr=Lt.tileCoordToPixel(Qt,sr),Hr=2*Ir+1,Zr=2*Vr+1,en=function(Zn,Qn,Hn,Wn,kn){return[Zn.getElevationAtPixel(Qn,Hn,!0),Zn.getElevationAtPixel(Qn+kn,Hn,!0),Zn.getElevationAtPixel(Qn,Hn+kn,!0),Zn.getElevationAtPixel(Qn+Wn,Hn+kn,!0)]}(Lt,Mr.x-Ir,Mr.y-Vr,Hr,Zr),Tn=Math.abs(en[0]-en[1]),ln=Math.abs(en[2]-en[3]),Fn=Math.abs(en[0]-en[2])+Math.abs(en[1]-en[3]),Ln=Math.min(.25,.5*br*(Tn+ln)/Hr),jn=Math.min(.25,.5*br*Fn/Zr);return _r+Math.max(Ln*hr,jn*ur)}(nt,at,ft):gt;return{base:gt+(g===0?-1:g),top:Rt?Math.max(Mt+et,gt+g+2):gt+et}}class $R{constructor(o){this._callback=o,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class HR{constructor(){this.tasks={},this.taskQueue=[],hn(["process"],this),this.invoker=new $R(this.process),this.nextId=0}add(o,g){const et=this.nextId++,nt=function({type:at,isSymbolTile:lt,zoom:ft}){return ft=ft||0,at==="message"?0:at!=="maybePrepare"||lt?at!=="parseTile"||lt?at==="parseTile"&&lt?300-ft:at==="maybePrepare"&&lt?400-ft:500:200-ft:100-ft}(g);if(nt===0){try{o()}finally{}return null}return this.tasks[et]={fn:o,metadata:g,priority:nt,id:et},this.taskQueue.push(et),this.invoker.trigger(),{cancel:()=>{delete this.tasks[et]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(et=>!!this.tasks[et]),!this.taskQueue.length)return;const o=this.pick();if(o===null)return;const g=this.tasks[o];if(delete this.tasks[o],this.taskQueue.length&&this.invoker.trigger(),!g)return;g.fn()}finally{}}pick(){let o=null,g=1/0;for(let nt=0;nt<this.taskQueue.length;nt++){const at=this.tasks[this.taskQueue[nt]];at.priority<g&&(g=at.priority,o=nt)}if(o===null)return null;const et=this.taskQueue[o];return this.taskQueue.splice(o,1),et}remove(){this.invoker.remove()}}class cS{constructor(o,g,et){this.target=o,this.parent=g,this.mapId=et,this.callbacks={},this.cancelCallbacks={},hn(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new HR}send(o,g,et,nt,at=!1,lt){const ft=Math.round(1e18*Math.random()).toString(36).substring(0,10);et&&(et.metadata=lt,this.callbacks[ft]=et);const gt=new Set;return this.target.postMessage({id:ft,type:o,hasCallback:!!et,targetMapId:nt,mustQueue:at,sourceMapId:this.mapId,data:im(g,gt)},gt),{cancel:()=>{et&&delete this.callbacks[ft],this.target.postMessage({id:ft,type:"<cancel>",targetMapId:nt,sourceMapId:this.mapId})}}}receive(o){const g=o.data;if(!g)return;const et=g.id;if(et&&(!g.targetMapId||this.mapId===g.targetMapId))if(g.type==="<cancel>"){const nt=this.cancelCallbacks[et];delete this.cancelCallbacks[et],nt&&nt.cancel()}else if(g.mustQueue||jo(self)){const nt=this.callbacks[et],at=this.scheduler.add(()=>this.processTask(et,g),nt&&nt.metadata||{type:"message"});at&&(this.cancelCallbacks[et]=at)}else this.processTask(et,g)}processTask(o,g){if(delete this.cancelCallbacks[o],g.type==="<response>"){const et=this.callbacks[o];delete this.callbacks[o],et&&(g.error?et(Lm(g.error)):et(null,Lm(g.data)))}else{const et=new Set,nt=g.hasCallback?(lt,ft)=>{this.target.postMessage({id:o,type:"<response>",sourceMapId:this.mapId,error:lt?im(lt):null,data:im(ft,et)},et)}:()=>{},at=Lm(g.data);if(this.parent[g.type])this.parent[g.type](g.sourceMapId,at,nt);else if(this.parent.getWorkerSource){const lt=g.type.split("."),{source:ft,scope:gt}=at;this.parent.getWorkerSource(g.sourceMapId,lt[0],ft,gt)[lt[1]](at,nt)}else nt(new Error(`Could not find function ${g.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var Lv={workerUrl:"",workerClass:null,workerParams:void 0};const K2="mapboxgl_preloaded_worker_pool";class L1{constructor(o){this.active={},this.name=o}acquire(o,g=L1.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<g;){const nt=(et=`${this.name||""}WorkerPool: ${o}-${this.workers.length}`,Lv.workerClass!=null?new Lv.workerClass:new self.Worker(Lv.workerUrl,Object.assign({name:et},Lv.workerParams)));this.workers.push(nt)}var et;return this.active[o]=!0,this.workers.slice()}release(o){delete this.active[o],this.workers&&this.numActive()===0&&(this.workers.forEach(g=>{g.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[K2]}numActive(){return Object.keys(this.active).length}}L1.workerCount=2;class i_{constructor(o,g,et="Worker",nt=L1.workerCount){this.workerPool=o,this.actors=[],this.currentActor=0,this.id=rn();const at=this.workerPool.acquire(this.id,nt);for(let lt=0;lt<at.length;lt++){const ft=new i_.Actor(at[lt],g,this.id);ft.name=`${et} ${lt}`,this.actors.push(ft)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(o,g,et){Yr(this.actors,(nt,at)=>{nt.send(o,g,at)},et=et||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(o=>{o.remove()}),this.actors=[],this.workerPool.release(this.id)}}let jv,Z2;function _w(){return jv||(jv=new L1),jv}i_.Actor=cS;const Y2=4096;class WR{constructor(o){this.module=o,this.memoryStack=this.module.malloc(Y2),this.memoryStackNextFree=this.memoryStack}createIntArray(o){const g=this.memoryStackNextFree;return this.memoryStackNextFree+=o.length*Int32Array.BYTES_PER_ELEMENT,this.memoryStackNextFree-this.memoryStack>Y2?-1:(new Int32Array(this.module.heap32.buffer,g,o.length).set(o),g)}createFloatArray(o){const g=this.memoryStackNextFree;return this.memoryStackNextFree+=o.length*Float32Array.BYTES_PER_ELEMENT,this.memoryStackNextFree-this.memoryStack>Y2?-1:(new Float32Array(this.module.heapF32.buffer,g,o.length).set(o),g)}readStringBuffer(o){let g="";for(;this.module.heapU8[o]!==0;)g+=String.fromCharCode(this.module.heapU8[o]),++o;return g}setStyle(o){const g=o.normalScale;this.module.setStyle(g[0],g[1],g[2],o.tileToMeters)}setAOOptions(o,g){this.module.setAOOptions(o?1:0,g)}setMetricOptions(o,g){this.module.setMetricOptions(o?1:0,g)}setStructuralOptions(o){this.module.setStructuralOptions(o?1:0)}setFacadeOptions(o,g){this.module.setFacadeOptions(o,g?1:0)}setFauxFacadeOptions(o,g,et){this.module.setFauxFacadeOptions(o?1:0,g?1:0,et)}setFacadeClassifierOptions(o){this.module.setFacadeClassifierOptions(o)}generateMesh(o,g){this.memoryStackNextFree=this.memoryStack;for(const ft of o){const gt=this.createIntArray(ft.ringIndices),Rt=this.createFloatArray(ft.coordinates);if(gt===-1||Rt===-1)return`building_gen: Out of stack memory: ${this.memoryStackNextFree-this.memoryStack}/4096`;this.module.addFeature(ft.id,ft.sourceId,ft.minHeight,ft.height,ft.roofType,Rt,gt,ft.ringIndices.length-1)}for(const ft of g){let gt;gt=ft.entrances?JSON.parse(ft.entrances):[];const Rt=this.createFloatArray(gt),Mt=this.createFloatArray(ft.coordinates);if(Rt===-1||Mt===-1)return`building_gen: Out of stack memory: ${this.memoryStackNextFree-this.memoryStack}/4096`;this.module.addFacade(ft.sourceId,ft.crossPerc,ft.distanceToRoad,Rt,gt.length,Mt,ft.coordinates.length)}if(!this.module.generateMesh()){const ft=this.module.getLastError();return this.readStringBuffer(ft)}const et=this.module.getMeshCount(),nt=new Array(et);for(let ft=0;ft<et;ft++){const gt=this.module.getPositionsPtr(ft),Rt=this.module.getPositionsLength(ft),Mt=new Float32Array(this.module.heapF32.buffer,gt,Rt),Lt=this.module.getNormalsPtr(ft),Ht=this.module.getNormalsLength(ft),Kt=new Float32Array(this.module.heapF32.buffer,Lt,Ht),Qt=this.module.getAOPtr(ft),sr=this.module.getAOLength(ft),hr=new Float32Array(this.module.heapF32.buffer,Qt,sr),ur=this.module.getUVPtr(ft),_r=this.module.getUVLength(ft),br=new Float32Array(this.module.heapF32.buffer,ur,_r),Ir=this.module.getFauxFacadePtr(ft),Vr=this.module.getFauxFacadeLength(ft),Mr=new Uint8Array(this.module.heapU8.buffer,Ir,Vr),Hr=this.module.getIndicesPtr(ft),Zr=this.module.getIndicesLength(ft),en=new Int16Array(this.module.heap16.buffer,Hr,Zr),Tn=this.module.getBuildingPart(ft);nt[ft]={positions:Mt,normals:Kt,ao:hr,uv:br,isFauxFacade:Mr,indices:en,buildingPart:Tn}}const at=this.module.getRingCount(),lt=[];for(let ft=0;ft<at;ft++){const gt=this.module.getRingPtr(ft),Rt=this.module.getRingLength(ft),Mt=new Float32Array(this.module.heapF32.buffer,gt,Rt);lt.push(Mt)}return{meshes:nt,outerRingLength:this.module.getOuterRingLength(),modifiedPolygonRings:lt}}}let zv,Q2,xm,s_,J2,o_=null,a_=null,uS=null,Ew=null;function dS(){return jo(self)&&self.worker.dracoUrl?self.worker.dracoUrl:Q2||Do.DRACO_URL}function hS(){if(jo(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(s_)return s_;const b=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return s_=WebAssembly.validate(b)?Do.MESHOPT_SIMD_URL:Do.MESHOPT_URL,s_}function qR(){return Ew}const bw={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},XR={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},Vv={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function fS(b,o,g){const et=g.json.bufferViews.length,nt=g.buffers.length;o.bufferView=et,g.json.bufferViews[et]={buffer:nt,byteLength:b.byteLength},g.buffers[nt]=b}const eC="KHR_draco_mesh_compression";function KR(b,o){const g=b.extensions&&b.extensions[eC];if(!g)return;const et=new xm.Decoder,nt=gS(o,g.bufferView),at=new xm.Mesh;if(!et.DecodeArrayToMesh(nt,nt.byteLength,at))throw new Error("Failed to decode Draco mesh");const lt=o.json.accessors[b.indices],ft=bw[lt.componentType],gt=lt.count*ft.BYTES_PER_ELEMENT,Rt=xm._malloc(gt);ft===Uint16Array?et.GetTrianglesUInt16Array(at,gt,Rt):et.GetTrianglesUInt32Array(at,gt,Rt),fS(xm.memory.buffer.slice(Rt,Rt+gt),lt,o),xm._free(Rt);for(const Mt of Object.keys(g.attributes)){const Lt=et.GetAttributeByUniqueId(at,g.attributes[Mt]),Ht=o.json.accessors[b.attributes[Mt]],Kt=XR[Ht.componentType],Qt=Ht.count*Vv[Ht.type]*bw[Ht.componentType].BYTES_PER_ELEMENT,sr=xm._malloc(Qt);et.GetAttributeDataArrayForAllPoints(at,Lt,xm[Kt],Qt,sr),fS(xm.memory.buffer.slice(sr,sr+Qt),Ht,o),xm._free(sr)}et.destroy(),at.destroy(),delete b.extensions[eC]}const ww="EXT_meshopt_compression";function ZR(b,o){if(!b.extensions||!b.extensions[ww])return;const g=b.extensions[ww],et=new Uint8Array(o.buffers[g.buffer],g.byteOffset||0,g.byteLength||0),nt=new Uint8Array(g.count*g.byteStride);J2.decodeGltfBuffer(nt,g.count,g.byteStride,et,g.mode,g.filter),b.buffer=o.buffers.length,b.byteOffset=0,o.buffers[b.buffer]=nt.buffer,delete b.extensions[ww]}const pS=1179937895,mS=new TextDecoder("utf8");function xS(b,o){return new URL(b,o).href}function YR(b,o,g,et){return fetch(xS(b.uri,et)).then(nt=>nt.arrayBuffer()).then(nt=>{o.buffers[g]=nt})}function gS(b,o){const g=b.json.bufferViews[o];return new Uint8Array(b.buffers[g.buffer],g.byteOffset||0,g.byteLength)}function QR(b,o,g,et){if(b.uri){const nt=xS(b.uri,et);return fetch(nt).then(at=>at.blob()).then(at=>createImageBitmap(at)).then(at=>{o.images[g]=at})}if(b.bufferView!==void 0){const nt=gS(o,b.bufferView),at=new Blob([nt],{type:b.mimeType});return createImageBitmap(at).then(lt=>{o.images[g]=lt})}}function yS(b,o=0,g){const et={json:null,images:[],buffers:[]};if(new Uint32Array(b,o,1)[0]===pS){const Mt=new Uint32Array(b,o);let Lt=2;const Ht=(Mt[Lt++]>>2)-3,Kt=Mt[Lt++]>>2;if(Lt++,et.json=JSON.parse(mS.decode(Mt.subarray(Lt,Lt+Kt))),Lt+=Kt,Lt<Ht){const Qt=Mt[Lt++];Lt++;const sr=o+(Lt<<2);et.buffers[0]=b.slice(sr,sr+Qt)}}else et.json=JSON.parse(mS.decode(new Uint8Array(b,o)));const{buffers:nt,images:at,meshes:lt,extensionsUsed:ft,bufferViews:gt}=et.json;let Rt=Promise.resolve();if(nt){const Mt=[];for(let Lt=0;Lt<nt.length;Lt++){const Ht=nt[Lt];Ht.uri?Mt.push(YR(Ht,et,Lt,g)):et.buffers[Lt]||(et.buffers[Lt]=null)}Rt=Promise.all(Mt)}return Rt.then(()=>{const Mt=[],Lt=ft&&ft.includes(eC),Ht=ft&&ft.includes(ww);if(Lt&&Mt.push(function(){if(!xm)return zv??(zv=function(Kt){let Qt,sr=null;function hr(){Qt=new Uint8Array(sr.buffer)}function ur(){throw new Error("Unexpected Draco error.")}const _r={a:{a:ur,d:function(br,Ir,Vr){return Qt.copyWithin(br,Ir,Ir+Vr)},c:function(br){const Ir=Qt.length,Vr=Math.max(br>>>0,Math.ceil(1.2*Ir)),Mr=Math.ceil((Vr-Ir)/65536);try{return sr.grow(Mr),hr(),!0}catch{return!1}},b:ur}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(Kt,_r):Kt.then(br=>br.arrayBuffer()).then(br=>WebAssembly.instantiate(br,_r))).then(br=>{const{Rb:Ir,Qb:Vr,P:Mr,T:Hr,X:Zr,Ja:en,La:Tn,Qa:ln,Va:Fn,Wa:Ln,eb:jn,jb:Zn,f:Qn,e:Hn,yb:Wn,zb:kn,Ab:In,Bb:Kn,Db:as,Gb:es}=br.instance.exports;sr=Hn;const $s=(()=>{let vs=0,Is=0,Ns=0,Fo=0;return ts=>{Ns&&(Ir(Fo),Ir(vs),Is+=Ns,Ns=vs=0),vs||(Is+=128,vs=Vr(Is));const Os=ts.length+7&-8;let fo=vs;Os>=Is&&(Ns=Os,fo=Fo=Vr(Os));for(let Ko=0;Ko<ts.length;Ko++)Qt[fo+Ko]=ts[Ko];return fo}})();return hr(),Qn(),{memory:Hn,_free:Ir,_malloc:Vr,Mesh:class{constructor(){this.ptr=Mr()}destroy(){Hr(this.ptr)}},Decoder:class{constructor(){this.ptr=en()}destroy(){Zn(this.ptr)}DecodeArrayToMesh(vs,Is,Ns){const Fo=$s(vs),ts=Tn(this.ptr,Fo,Is,Ns.ptr);return!!Zr(ts)}GetAttributeByUniqueId(vs,Is){return{ptr:ln(this.ptr,vs.ptr,Is)}}GetTrianglesUInt16Array(vs,Is,Ns){Fn(this.ptr,vs.ptr,Is,Ns)}GetTrianglesUInt32Array(vs,Is,Ns){Ln(this.ptr,vs.ptr,Is,Ns)}GetAttributeDataArrayForAllPoints(vs,Is,Ns,Fo,ts){jn(this.ptr,vs.ptr,Is.ptr,Ns,Fo,ts)}},DT_INT8:Wn(),DT_UINT8:kn(),DT_INT16:In(),DT_UINT16:Kn(),DT_UINT32:as(),DT_FLOAT32:es()}})}(fetch(dS())),zv.then(Kt=>{xm=Kt,zv=void 0}))}()),Ht&&Mt.push(function(){if(J2)return;const Kt=function(Qt){let sr;const hr=WebAssembly.instantiateStreaming(Qt,{}).then(br=>{sr=br.instance,sr.exports.__wasm_call_ctors()}),ur={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},_r={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:hr,supported:!0,decodeGltfBuffer(br,Ir,Vr,Mr,Hr,Zr){(function(en,Tn,ln,Fn,Ln,jn,Zn){const Qn=en.exports.sbrk,Hn=Fn+3&-4,Wn=Qn(Hn*Ln),kn=Qn(jn.length),In=new Uint8Array(en.exports.memory.buffer);In.set(jn,kn);const Kn=Tn(Wn,Fn,Ln,kn,jn.length);if(Kn===0&&Zn&&Zn(Wn,Hn,Ln),ln.set(In.subarray(Wn,Wn+Fn*Ln)),Qn(Wn-Qn(0)),Kn!==0)throw new Error(`Malformed buffer data: ${Kn}`)})(sr,sr.exports[_r[Hr]],br,Ir,Vr,Mr,sr.exports[ur[Zr]])}}}(fetch(hS()));return Kt.ready.then(()=>{J2=Kt})}()),at)for(let Kt=0;Kt<at.length;Kt++)Mt.push(QR(at[Kt],et,Kt,g));return(Mt.length?Promise.all(Mt):Promise.resolve()).then(()=>{if(Lt&&lt)for(const{primitives:Kt}of lt)for(const Qt of Kt)KR(Qt,et);if(Ht&&lt&&gt)for(const Kt of gt)ZR(Kt,et);return et})})}function _S(b){return fetch(b).then(o=>o.arrayBuffer()).then(o=>yS(o,0,b))}function tC(b){switch(b){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function rC(b){switch(b){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class nC{constructor(o,g,et,nt){this.context=o,this.format=et,this.useMipmap=nt&&nt.useMipmap,this.texture=o.gl.createTexture(),this.update(g,{premultiply:nt&&nt.premultiply})}update(o,g){const et=o&&o instanceof HTMLVideoElement&&o.width===0?o.videoWidth:o.width,nt=o&&o instanceof HTMLVideoElement&&o.height===0?o.videoHeight:o.height,{context:at}=this,{gl:lt}=at,{x:ft,y:gt}=g&&g.position?g.position:{x:0,y:0},Rt=ft+et,Mt=gt+nt;!this.size||this.size[0]===Rt&&this.size[1]===Mt||(lt.bindTexture(lt.TEXTURE_2D,null),lt.deleteTexture(this.texture),this.texture=lt.createTexture(),this.size=null),lt.bindTexture(lt.TEXTURE_2D,this.texture),at.pixelStoreUnpackFlipY.set(!1),at.pixelStoreUnpack.set(1),at.pixelStoreUnpackPremultiplyAlpha.set(this.format===lt.RGBA8&&(!g||g.premultiply!==!1));const Lt=o instanceof HTMLImageElement||o instanceof HTMLCanvasElement||o instanceof HTMLVideoElement||o instanceof ImageData||ImageBitmap&&o instanceof ImageBitmap;if(!this.size&&Rt>0&&Mt>0){const Ht=this.useMipmap?Math.floor(Math.log2(Math.max(Rt,Mt)))+1:1;lt.texStorage2D(lt.TEXTURE_2D,Ht,this.format,Rt,Mt),this.size=[Rt,Mt]}this.size&&(Lt?lt.texSubImage2D(lt.TEXTURE_2D,0,ft,gt,tC(this.format),rC(this.format),o):"data"in o&&o.data&&lt.texSubImage2D(lt.TEXTURE_2D,0,ft,gt,et,nt,tC(this.format),rC(this.format),o.data)),this.useMipmap&&lt.generateMipmap(lt.TEXTURE_2D)}bind(o,g,et=!1){const{context:nt}=this,{gl:at}=nt;at.bindTexture(at.TEXTURE_2D,this.texture),o!==this.minFilter&&(at.texParameteri(at.TEXTURE_2D,at.TEXTURE_MAG_FILTER,o),at.texParameteri(at.TEXTURE_2D,at.TEXTURE_MIN_FILTER,this.useMipmap&&!et?o===at.NEAREST?at.NEAREST_MIPMAP_NEAREST:at.LINEAR_MIPMAP_LINEAR:o),this.minFilter=o),g!==this.wrapS&&(at.texParameteri(at.TEXTURE_2D,at.TEXTURE_WRAP_S,g),at.texParameteri(at.TEXTURE_2D,at.TEXTURE_WRAP_T,g),this.wrapS=g)}bindExtraParam(o,g,et,nt,at){const{context:lt}=this,{gl:ft}=lt;ft.bindTexture(ft.TEXTURE_2D,this.texture),g!==this.magFilter&&(ft.texParameteri(ft.TEXTURE_2D,ft.TEXTURE_MAG_FILTER,g),this.magFilter=g),o!==this.minFilter&&(ft.texParameteri(ft.TEXTURE_2D,ft.TEXTURE_MIN_FILTER,this.useMipmap?o===ft.NEAREST?ft.NEAREST_MIPMAP_NEAREST:ft.LINEAR_MIPMAP_LINEAR:o),this.minFilter=o),et!==this.wrapS&&(ft.texParameteri(ft.TEXTURE_2D,ft.TEXTURE_WRAP_S,et),this.wrapS=et),nt!==this.wrapT&&(ft.texParameteri(ft.TEXTURE_2D,ft.TEXTURE_WRAP_T,nt),this.wrapT=nt),at!==this.compareMode&&(at?(ft.texParameteri(ft.TEXTURE_2D,ft.TEXTURE_COMPARE_MODE,ft.COMPARE_REF_TO_TEXTURE),ft.texParameteri(ft.TEXTURE_2D,ft.TEXTURE_COMPARE_FUNC,at)):ft.texParameteri(ft.TEXTURE_2D,ft.TEXTURE_COMPARE_MODE,ft.NONE),this.compareMode=at)}destroy(){const{gl:o}=this.context;o.deleteTexture(this.texture),this.texture=null}}class Uv{constructor(o,g){this.context=o,this.texture=g}bind(o,g){const{context:et}=this,{gl:nt}=et;nt.bindTexture(nt.TEXTURE_2D,this.texture),o!==this.minFilter&&(nt.texParameteri(nt.TEXTURE_2D,nt.TEXTURE_MAG_FILTER,o),nt.texParameteri(nt.TEXTURE_2D,nt.TEXTURE_MIN_FILTER,o),this.minFilter=o),g!==this.wrapS&&(nt.texParameteri(nt.TEXTURE_2D,nt.TEXTURE_WRAP_S,g),nt.texParameteri(nt.TEXTURE_2D,nt.TEXTURE_WRAP_T,g),this.wrapS=g)}}const JR=Go([{name:"a_pos_3f",components:3,type:"Float32"}]),e8=Go([{name:"a_color_3f",components:3,type:"Float32"}]),t8=Go([{name:"a_color_4f",components:4,type:"Float32"}]),r8=Go([{name:"a_uv_2f",components:2,type:"Float32"}]),n8=Go([{name:"a_normal_3f",components:3,type:"Float32"}]),i8=Go([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),s8=Go([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function vS(b,o){const g=Cw(b.projection,b.zoom,b.width,b.height),et=function(at,lt,ft,gt,Rt){const Mt=new _e(ft.lng-180*_g,ft.lat),Lt=new _e(ft.lng+180*_g,ft.lat),Ht=at.project(Mt.lng,Mt.lat),Kt=at.project(Lt.lng,Lt.lat),Qt=-Math.atan2(Kt.y-Ht.y,Kt.x-Ht.x),sr=Ar.fromLngLat(ft);sr.y=pr(sr.y,-1+_g,1-_g);const hr=sr.toLngLat(),ur=at.project(hr.lng,hr.lat),_r=Ar.fromLngLat(hr);_r.x+=_g;const br=_r.toLngLat(),Ir=at.project(br.lng,br.lat),Vr=bS(Ir.x-ur.x,Ir.y-ur.y,Qt),Mr=Ar.fromLngLat(hr);Mr.y+=_g;const Hr=Mr.toLngLat(),Zr=at.project(Hr.lng,Hr.lat),en=bS(Zr.x-ur.x,Zr.y-ur.y,Qt),Tn=Math.abs(Vr.x)/Math.abs(en.y),ln=Zt([]);or(ln,ln,-Qt*(1-(Rt?0:gt)));const Fn=Zt([]);return Gt(Fn,Fn,[1,1-(1-Tn)*gt,1]),Fn[4]=-en.x/en.y*gt,or(Fn,Fn,Qt),Ut(Fn,ln,Fn),Fn}(b.projection,0,b.center,g,o),nt=ES(b);return Gt(et,et,[nt,nt,1]),et}function ES(b){const o=b.projection,g=Cw(b.projection,b.zoom,b.width,b.height),et=iC(o,b.center),nt=iC(o,_e.convert(o.center));return Math.pow(2,et*g+(1-g)*nt)}function Cw(b,o,g,et,nt=1/0){const at=b.range;if(!at)return 0;const lt=Math.min(nt,Math.max(g,et)),ft=Math.log2(lt/1024);return vr(at[0]+ft,at[1]+ft,o)}const _g=1/4e4;function iC(b,o){const g=pr(o.lat,-nr,nr),et=new _e(o.lng-180*_g,g),nt=new _e(o.lng+180*_g,g),at=b.project(et.lng,g),lt=b.project(nt.lng,g),ft=Ar.fromLngLat(et),gt=Ar.fromLngLat(nt),Rt=lt.x-at.x,Mt=lt.y-at.y,Lt=gt.x-ft.x,Ht=gt.y-ft.y,Kt=Math.sqrt((Lt*Lt+Ht*Ht)/(Rt*Rt+Mt*Mt));return Math.log2(Kt)}function bS(b,o,g){const et=Math.cos(g),nt=Math.sin(g);return{x:b*et-o*nt,y:b*nt+o*et}}function wS(b,o,g){Zt(b),or(b,b,Bo(o[2])),er(b,b,Bo(o[0])),ir(b,b,Bo(o[1])),Gt(b,b,g),Ut(b,b,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function Aw(b,o,g,et,nt,at,lt,ft){const gt=[g[0]-o[0],g[1]-o[1],0],Rt=[et[0]-o[0],et[1]-o[1],0];if(Fr(gt)<1e-12||Fr(Rt)<1e-12)return Mn(b);const Mt=ks([],gt,Rt);ws(Mt,Mt),gr(Rt,et,o),gt[2]=(at-nt)*ft,Rt[2]=(lt-nt)*ft;const Lt=gt;return ks(Lt,gt,Rt),ws(Lt,Lt),ps(b,Mt,Lt)}function Sw(b,o,g=!1){const et=Qx(o.zoom),nt=function(at,lt,ft){const gt=lt.worldSize,Rt=[at[12],at[13],at[14]],Mt=rr(Rt[1]/gt),Lt=Xt(Rt[0]/gt),Ht=Zt([]),Kt=$t(1,Mt)*gt,Qt=$t(1,0)*gt*lr(Mt,lt.zoom),sr=1/F2(gt);let hr=Qt*sr;if(ft){const Ir=Cw(lt.projection,lt.zoom,lt.width,lt.height,1024);hr=sr*lt.projection.pixelSpaceConversion(lt.center.lat,gt,Ir)}const ur=Kx(Mt,Lt);dr(ur,ur,gn([],ws([],ur),Kt*hr*Rt[2]));const _r=function(Ir){const Vr=[Ir[0],Ir[1],Ir[2]];let Mr=[0,1,0];const Hr=ks([],Mr,Vr);return ks(Mr,Vr,Hr),ms(Mr)===0&&(Mr=[0,1,0],ks(Hr,Vr,Mr)),ws(Hr,Hr),ws(Mr,Mr),ws(Vr,Vr),[Hr[0],Hr[1],Hr[2],0,Mr[0],Mr[1],Mr[2],0,Vr[0],Vr[1],Vr[2],0,Ir[0],Ir[1],Ir[2],1]}(ur);Gt(Ht,Ht,[hr,hr,hr*Kt]),Nt(Ht,Ht,[-Rt[0],-Rt[1],-Rt[2]]);const br=Ut([],lt.globeMatrix,_r);return Ut(br,br,Ht),Ut(br,br,at),br}(b,o,g);if(et>0){const at=function(lt,ft){const gt=ft.worldSize,Rt=$t(1,0)*gt*lr(ft.center.lat,ft.zoom)/F2(gt),Mt=$t(1,ft.center.lat)*gt,Lt=Zt([]);ir(Lt,Lt,Bo(ft.center.lng)),er(Lt,Lt,Bo(ft.center.lat)),Nt(Lt,Lt,[0,0,Ap]),Gt(Lt,Lt,[Rt,Rt,Rt*Mt]);const Ht=ft.point;return Nt(Lt,Lt,[-Ht.x,-Ht.y,0]),Ut(Lt,Lt,lt),Ut(Lt,ft.globeMatrix,Lt)}(b,o);return function(lt,ft,gt){const Rt=(Qt,sr,hr)=>{const ur=Fr(Qt),_r=Fr(sr),br=mm(Qt,sr,hr);return gn(br,br,1/Fr(br)*so(ur,_r,hr))},Mt=Rt([lt[0],lt[1],lt[2]],[ft[0],ft[1],ft[2]],gt),Lt=Rt([lt[4],lt[5],lt[6]],[ft[4],ft[5],ft[6]],gt),Ht=Rt([lt[8],lt[9],lt[10]],[ft[8],ft[9],ft[10]],gt),Kt=mm([lt[12],lt[13],lt[14]],[ft[12],ft[13],ft[14]],gt);return[Mt[0],Mt[1],Mt[2],0,Lt[0],Lt[1],Lt[2],0,Ht[0],Ht[1],Ht[2],0,Kt[0],Kt[1],Kt[2],1]}(nt,at,et)}return nt}function sC(b,o,g,et){const nt=zs.projectAabbCorners(et,g);let at=Number.MAX_VALUE;for(let ft=0;ft<nt.length;++ft){const gt=nt[ft];gt[0]=(.5*gt[0]+.5)*o.width,gt[1]=(.5-.5*gt[1])*o.height,gt[2]<at&&(at=gt[2])}const lt=function(ft){const gt=[];let Rt=0;for(let Kt=1;Kt<ft.length;Kt++)(ft[Kt][0]<ft[Rt][0]||ft[Kt][0]===ft[Rt][0]&&ft[Kt][1]<ft[Rt][1])&&(Rt=Kt);let Mt,Lt=Rt;const Ht=new Uint8Array(ft.length);do{if(Ht[Lt])break;gt.push(new zn(ft[Lt][0],ft[Lt][1])),Ht[Lt]=1,Mt=(Lt+1)%ft.length;for(let Kt=0;Kt<ft.length;Kt++){if(ft[Kt][0]===ft[Mt][0]&&ft[Kt][1]===ft[Mt][1]||ft[Kt][0]===ft[Lt][0]&&ft[Kt][1]===ft[Lt][1])continue;const Qt=[ft[Kt][0]-ft[Lt][0],ft[Kt][1]-ft[Lt][1]],sr=[ft[Mt][0]-ft[Lt][0],ft[Mt][1]-ft[Lt][1]],hr=Qt[0]*sr[1]-Qt[1]*sr[0];(hr>0||hr===0&&Qt[0]*sr[0]+Qt[1]*sr[1]>=0&&Qt[0]*Qt[0]+Qt[1]*Qt[1]>sr[0]*sr[0]+sr[1]*sr[1])&&(Mt=Kt)}Lt=Mt}while(Lt!==Rt);return gt.length>0&&gt.push(gt[0]),gt}(nt);if(_l(b,lt))return at}const j1=64,l_={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function Tw(b,o,g,et,nt,at,lt,ft,gt,Rt=!1){const Mt=g.zoom,Lt=g.project(et),Ht=lr(et.lat,Mt),Kt=1/Ht;Zt(b),Nt(b,b,[Lt.x+lt[0]*Kt,Lt.y+lt[1]*Kt,lt[2]]);let Qt=1,sr=1;const hr=g.worldSize;if(Rt){if(g.projection.name==="mercator"){let Ir=0;g.elevation&&(Ir=g.elevation.getAtPointOrZero(new Ar(Lt.x/hr,Lt.y/hr),0));const Vr=ga([],[Lt.x,Lt.y,Ir,1],g.projMatrix)[3]/g.cameraToCenterDistance;Qt=Vr,sr=Vr*lr(g.center.lat,Mt)}else if(g.projection.name==="globe"){const Ir=Sw(b,g),Vr=[0,0,0,1];ga(Vr,Vr,Ut([],g.projMatrix,Ir));const Mr=Vr[3]/g.cameraToCenterDistance,Hr=Qx(Mt),Zr=g.projection.pixelsPerMeter(et.lat,hr)*lr(et.lat,Mt),en=g.projection.pixelsPerMeter(g.center.lat,hr)*lr(g.center.lat,Mt);Qt=Mr/so(Zr,cr(g.center.lat),Hr),sr=Mr*Ht/Zr,Qt*=en,sr*=en}}else Qt=Kt;Gt(b,b,[Qt,Qt,sr]);const ur=[...b],_r=o.orientation,br=[];if(wS(br,[_r[0]+(nt?nt[0]:0),_r[1]+(nt?nt[1]:0),_r[2]+(nt?nt[2]:0)],at),Ut(b,ur,br),ft&&g.elevation){let Ir=0;const Vr=[];if(gt&&g.elevation){Ir=function(Hr,Zr,en,Tn,ln){const Fn=Zr.elevation;if(!Fn)return 0;const Ln=zs.projectAabbCorners(en,Tn),jn=$t(1,ln.lat)*Zr.worldSize,Zn=function(Is,Ns){const Fo=[0,0,1],ts=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const Os of ts){const fo=Is[Os.corners[0]],Ko=Is[Os.corners[1]],xa=Is[Os.corners[2]],wo=[Ko[0]-fo[0],Ko[1]-fo[1],Ns*(Ko[2]-fo[2])],$l=ks(wo,wo,[xa[0]-fo[0],xa[1]-fo[1],Ns*(xa[2]-fo[2])]);ws($l,$l),Os.dotProductWithUp=Vs($l,Fo)}return ts.sort((Os,fo)=>Os.dotProductWithUp-fo.dotProductWithUp),ts[0].corners}(Ln,jn),Qn=Ln[Zn[0]],Hn=Ln[Zn[1]],Wn=Ln[Zn[2]],kn=Ln[Zn[3]],In=Fn.getAtPointOrZero(new Ar(Qn[0]/Zr.worldSize,Qn[1]/Zr.worldSize),0),Kn=Fn.getAtPointOrZero(new Ar(Hn[0]/Zr.worldSize,Hn[1]/Zr.worldSize),0),as=Fn.getAtPointOrZero(new Ar(Wn[0]/Zr.worldSize,Wn[1]/Zr.worldSize),0),es=Fn.getAtPointOrZero(new Ar(kn[0]/Zr.worldSize,kn[1]/Zr.worldSize),0),$s=(In+es)/2,vs=(Kn+as)/2;return $s>vs?Kn<as?Aw(Hr,Hn,kn,Qn,Kn,es,In,jn):Aw(Hr,Wn,Qn,kn,as,In,es,jn):In<es?Aw(Hr,Qn,Hn,Wn,In,Kn,as,jn):Aw(Hr,kn,Wn,Hn,es,as,Kn,jn),Math.max($s,vs)}(Vr,g,o.aabb,b,et);const Mr=Ut([],un([],Vr),br);Ut(b,ur,Mr)}else Ir=g.elevation.getAtPointOrZero(new Ar(Lt.x/hr,Lt.y/hr),0);Ir!==0&&(b[14]+=Ir)}}class CS{constructor(o,g,et,nt,at){this.materialOverrides=new Map,this.nodeOverrides=new Map,this.materialOverrideNames=[],this.nodeOverrideNames=[],this.featureProperties={},this.id=o,this.uri=g,this.position=et!=null?new _e(et[0],et[1]):new _e(0,0),this.orientation=nt??[0,0,0],this.nodes=at,this.uploaded=!1,this.aabb=new zs([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(o,g){Ut(o.globalMatrix,g,o.localMatrix);const et=this.nodeOverrides.get(o.name);if(et!==void 0){const lt=[];at=et.orientation,Zt(nt=lt),ir(nt,nt,Bo(at[1])),or(nt,nt,Bo(at[2])),er(nt,nt,Bo(at[0])),Ut(o.globalMatrix,o.globalMatrix,lt)}var nt,at;if(o.meshes)for(const lt of o.meshes){const ft=zs.applyTransformFast(lt.aabb,o.globalMatrix);this.aabb.encapsulate(ft)}if(o.children)for(const lt of o.children)this._applyTransformations(lt,o.globalMatrix)}computeBoundsAndApplyParent(){const o=Zt([]);this.aabb=new zs([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const g of this.nodes)this._applyTransformations(g,o)}computeModelMatrix(o,g,et,nt,at,lt,ft=!1){Tw(this.matrix,this,o.transform,this.position,g,et,nt,at,lt,ft)}upload(o){if(!this.uploaded){for(const g of this.nodes)oC(g,o);for(const g of this.nodes)Rw(g);this.uploaded=!0}}destroy(){for(const o of this.nodes)aC(o)}}function Gv(b,o,g=!1){b.uploaded||(b.gfxTexture=new nC(o,b.image,g?o.gl.R8:o.gl.RGBA8,{useMipmap:b.sampler.minFilter>=o.gl.NEAREST_MIPMAP_NEAREST}),b.uploaded=!0,b.image=null)}function o8(b,o,g){b.indexBuffer=o.createIndexBuffer(b.indexArray,!1,!0),b.vertexBuffer=o.createVertexBuffer(b.vertexArray,JR.members,!1,!0),b.normalArray&&(b.normalBuffer=o.createVertexBuffer(b.normalArray,n8.members,!1,!0)),b.texcoordArray&&(b.texcoordBuffer=o.createVertexBuffer(b.texcoordArray,r8.members,!1,!0)),b.colorArray&&(b.colorBuffer=o.createVertexBuffer(b.colorArray,(b.colorArray.bytesPerElement===12?e8:t8).members,!1,!0)),b.featureArray&&(b.pbrBuffer=o.createVertexBuffer(b.featureArray,s8.members,!0)),b.segments=Eu.simpleSegment(0,0,b.vertexArray.length,b.indexArray.length);const et=b.material;et.pbrMetallicRoughness.baseColorTexture&&Gv(et.pbrMetallicRoughness.baseColorTexture,o),et.pbrMetallicRoughness.metallicRoughnessTexture&&Gv(et.pbrMetallicRoughness.metallicRoughnessTexture,o),et.normalTexture&&Gv(et.normalTexture,o),et.occlusionTexture&&Gv(et.occlusionTexture,o,g),et.emissionTexture&&Gv(et.emissionTexture,o)}function oC(b,o,g){if(b.meshes)for(const et of b.meshes)o8(et,o,g);if(b.children)for(const et of b.children)oC(et,o,g)}function Rw(b){if(b.meshes)for(const o of b.meshes)o.indexArray.destroy(),o.vertexArray.destroy(),o.colorArray&&o.colorArray.destroy(),o.normalArray&&o.normalArray.destroy(),o.texcoordArray&&o.texcoordArray.destroy(),o.featureArray&&o.featureArray.destroy();if(b.children)for(const o of b.children)Rw(o)}function aC(b){if(b.meshes)for(const g of b.meshes)g.vertexBuffer&&(g.vertexBuffer.destroy(),g.indexBuffer.destroy(),g.normalBuffer&&g.normalBuffer.destroy(),g.texcoordBuffer&&g.texcoordBuffer.destroy(),g.colorBuffer&&g.colorBuffer.destroy(),g.pbrBuffer&&g.pbrBuffer.destroy(),g.segments.destroy(),g.material&&((o=g.material).pbrMetallicRoughness.baseColorTexture&&o.pbrMetallicRoughness.baseColorTexture.gfxTexture&&o.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),o.pbrMetallicRoughness.metallicRoughnessTexture&&o.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&o.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),o.normalTexture&&o.normalTexture.gfxTexture&&o.normalTexture.gfxTexture.destroy(),o.emissionTexture&&o.emissionTexture.gfxTexture&&o.emissionTexture.gfxTexture.destroy(),o.occlusionTexture&&o.occlusionTexture.gfxTexture&&o.occlusionTexture.gfxTexture.destroy()));var o;if(b.children)for(const g of b.children)aC(g)}function z1(b,o){const g=b.json.bufferViews[o.bufferView],et=bw[o.componentType];return new et(b.buffers[g.buffer],(o.byteOffset||0)+(g.byteOffset||0),o.count*(g.byteStride&&g.byteStride!==Vv[o.type]*et.BYTES_PER_ELEMENT?g.byteStride/et.BYTES_PER_ELEMENT:Vv[o.type]))}function lC(b,o,g,et){const nt=bw[o.componentType],at=function(Mt){switch(Mt){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(nt),lt=b.json.bufferViews[o.bufferView],ft=lt.byteStride?lt.byteStride/nt.BYTES_PER_ELEMENT:Vv[o.type],gt=g.float32,Rt=gt.length/g.capacity;for(let Mt=0,Lt=0;Mt<o.count*ft;Mt+=ft,Lt+=Rt)for(let Ht=0;Ht<Rt;Ht++)gt[Lt+Ht]=et[Mt+Ht]*at;g._trim()}function a8(b,o,g){const et=b.indices,nt=b.attributes,at={};at.indexArray=new _f;const lt=o.json.accessors[et],ft=lt.count/3;at.indexArray.reserve(ft);const gt=z1(o,lt);for(let Ht=0;Ht<ft;Ht++)at.indexArray.emplaceBack(gt[3*Ht],gt[3*Ht+1],gt[3*Ht+2]);at.indexArray._trim(),at.vertexArray=new a0;const Rt=o.json.accessors[nt.POSITION];at.vertexArray.reserve(Rt.count);const Mt=z1(o,Rt);for(let Ht=0;Ht<Rt.count;Ht++)at.vertexArray.emplaceBack(Mt[3*Ht],Mt[3*Ht+1],Mt[3*Ht+2]);if(at.vertexArray._trim(),at.aabb=new zs(Rt.min,Rt.max),at.centroid=function(Ht,Kt){const Qt=[0,0,0],sr=Ht.length;if(sr>0){for(let hr=0;hr<sr;hr++){const ur=3*Ht[hr];Qt[0]+=Kt[ur],Qt[1]+=Kt[ur+1],Qt[2]+=Kt[ur+2]}Qt[0]/=sr,Qt[1]/=sr,Qt[2]/=sr}return Qt}(gt,Mt),nt.COLOR_0!==void 0){const Ht=o.json.accessors[nt.COLOR_0],Kt=Vv[Ht.type],Qt=z1(o,Ht);at.colorArray=Kt===3?new a0:new zm,at.colorArray.resize(Ht.count),lC(o,Ht,at.colorArray,Qt)}if(nt.NORMAL!==void 0){at.normalArray=new a0;const Ht=o.json.accessors[nt.NORMAL];at.normalArray.resize(Ht.count);const Kt=z1(o,Ht);lC(o,Ht,at.normalArray,Kt)}if(nt.TEXCOORD_0!==void 0&&g.length>0){at.texcoordArray=new q0;const Ht=o.json.accessors[nt.TEXCOORD_0];at.texcoordArray.resize(Ht.count);const Kt=z1(o,Ht);lC(o,Ht,at.texcoordArray,Kt)}if(nt._FEATURE_ID_RGBA4444!==void 0){const Ht=o.json.accessors[nt._FEATURE_ID_RGBA4444];o.json.extensionsUsed&&o.json.extensionsUsed.includes("EXT_meshopt_compression")&&(at.featureData=z1(o,Ht))}nt._FEATURE_RGBA4444!==void 0&&(at.featureData=new Uint32Array(z1(o,o.json.accessors[nt._FEATURE_RGBA4444]).buffer));const Lt=b.material;return at.material=function(Ht,Kt){const{emissiveFactor:Qt=[0,0,0],alphaMode:sr="OPAQUE",alphaCutoff:hr=.5,normalTexture:ur,occlusionTexture:_r,emissiveTexture:br,doubleSided:Ir,name:Vr}=Ht,{baseColorFactor:Mr=[1,1,1,1],metallicFactor:Hr=1,roughnessFactor:Zr=1,baseColorTexture:en,metallicRoughnessTexture:Tn}=Ht.pbrMetallicRoughness||{},ln=_r?Kt[_r.index]:void 0;if(_r&&_r.extensions&&_r.extensions.KHR_texture_transform&&ln){const Fn=_r.extensions.KHR_texture_transform;ln.offsetScale=[Fn.offset[0],Fn.offset[1],Fn.scale[0],Fn.scale[1]]}return{name:Vr,pbrMetallicRoughness:{baseColorFactor:new Mo(...Mr),metallicFactor:Hr,roughnessFactor:Zr,baseColorTexture:en?Kt[en.index]:void 0,metallicRoughnessTexture:Tn?Kt[Tn.index]:void 0},doubleSided:Ir,emissiveFactor:new Mo(...Qt),alphaMode:sr,alphaCutoff:hr,normalTexture:ur?Kt[ur.index]:void 0,occlusionTexture:ln,emissionTexture:br?Kt[br.index]:void 0,defined:Ht.defined===void 0}}(Lt!==void 0?o.json.materials[Lt]:{defined:!1},g),at}function AS(b,o,g){const{matrix:et,rotation:nt,translation:at,scale:lt,mesh:ft,extras:gt,children:Rt,name:Mt}=b,Lt={};if(Lt.name=Mt,Lt.localMatrix=et||function(Ht,Kt,Qt,sr){var hr=Kt[0],ur=Kt[1],_r=Kt[2],br=Kt[3],Ir=hr+hr,Vr=ur+ur,Mr=_r+_r,Hr=hr*Ir,Zr=hr*Vr,en=hr*Mr,Tn=ur*Vr,ln=ur*Mr,Fn=_r*Mr,Ln=br*Ir,jn=br*Vr,Zn=br*Mr,Qn=sr[0],Hn=sr[1],Wn=sr[2];return Ht[0]=(1-(Tn+Fn))*Qn,Ht[1]=(Zr+Zn)*Qn,Ht[2]=(en-jn)*Qn,Ht[3]=0,Ht[4]=(Zr-Zn)*Hn,Ht[5]=(1-(Hr+Fn))*Hn,Ht[6]=(ln+Ln)*Hn,Ht[7]=0,Ht[8]=(en+jn)*Wn,Ht[9]=(ln-Ln)*Wn,Ht[10]=(1-(Hr+Tn))*Wn,Ht[11]=0,Ht[12]=Qt[0],Ht[13]=Qt[1],Ht[14]=Qt[2],Ht[15]=1,Ht}([],nt||[0,0,0,1],at||[0,0,0],lt||[1,1,1]),Lt.globalMatrix=Bt(Lt.localMatrix),ft!==void 0){Lt.meshes=g[ft];const Ht=Lt.anchor=[0,0];for(const Kt of Lt.meshes){const{min:Qt,max:sr}=Kt.aabb;Ht[0]+=Qt[0]+sr[0],Ht[1]+=Qt[1]+sr[1]}Ht[0]=Math.floor(Ht[0]/Lt.meshes.length/2),Ht[1]=Math.floor(Ht[1]/Lt.meshes.length/2)}if(gt&&(gt.id&&(Lt.id=gt.id),gt.lights&&(Lt.lights=function(Ht){if(!Ht.length)return[];const Kt=function(_r){const br=atob(_r),Ir=new Uint8Array(br.length);for(let Vr=0;Vr<br.length;Vr++)Ir[Vr]=br.codePointAt(Vr);return Ir}(Ht),Qt=[],sr=Kt.length/24,hr=new Uint16Array(Kt.buffer),ur=new Float32Array(Kt.buffer);for(let _r=0;_r<sr;_r++){const br=hr[2*_r*6]/30,Ir=hr[2*_r*6+1]/30,Vr=hr[2*_r*6+10]/100,Mr=ur[6*_r+1],Hr=ur[6*_r+2],Zr=ur[6*_r+3],en=ur[6*_r+4],Tn=Zr-Mr,ln=en-Hr,Fn=Math.hypot(Tn,ln);Qt.push({pos:[Mr+.5*Tn,Hr+.5*ln,Ir],normal:[ln/Fn,-Tn/Fn,0],width:Fn,height:br,depth:Vr,points:[Mr,Hr,Zr,en]})}return Qt}(gt.lights)),gt.MAPBOX_geometry_bloom&&(Lt.isGeometryBloom=gt.MAPBOX_geometry_bloom)),Rt){const Ht=[];for(const Kt of Rt)Ht.push(AS(o.json.nodes[Kt],o,g));Lt.children=Ht}return Lt}function l8(b){if(b.vertices.length===0||b.indices.length===0)return null;const o=new fw(b.vertices,b.indices,8,256),[g,et]=[o.min.clone(),o.max.clone()];return{vertices:b.vertices,indices:b.indices,grid:o,min:g,max:et}}function c8(b){if(!b.extras||!b.extras.ground)return null;const o=b.extras.ground;if(!o||!Array.isArray(o)||o.length===0)return null;const g=o[0];if(!g||!Array.isArray(g)||g.length===0)return null;const et=[];for(const lt of g){if(!Array.isArray(lt)||lt.length!==2)continue;const ft=lt[0],gt=lt[1];typeof ft=="number"&&typeof gt=="number"&&et.push(new zn(ft,gt))}if(et.length<3)return null;et.length>1&&et[et.length-1].equals(et[0])&&et.pop();let nt=0;for(let lt=0;lt<et.length;lt++){const ft=et[lt],gt=et[(lt+1)%et.length],Rt=et[(lt+2)%et.length];nt+=(ft.x-gt.x)*(Rt.y-gt.y)-(Rt.x-gt.x)*(ft.y-gt.y)}nt>0&&et.reverse();const at=r_(et.flatMap(lt=>[lt.x,lt.y]),[]);return at.length===0?null:{vertices:et,indices:at}}function u8(b,o){const g=[],et=[];let nt=0;const at=[];for(const lt of b){nt=g.length;const ft=lt.vertexArray.float32,gt=lt.indexArray.uint16;for(let Rt=0;Rt<lt.vertexArray.length;Rt++)at[0]=ft[3*Rt+0],at[1]=ft[3*Rt+1],at[2]=ft[3*Rt+2],ys(at,at,o),g.push(new zn(at[0],at[1]));for(let Rt=0;Rt<3*lt.indexArray.length;Rt++)et.push(gt[Rt]+nt)}if(et.length%3!=0)return null;for(let lt=0;lt<et.length;lt+=3){const ft=g[et[lt+0]],gt=g[et[lt+1]],Rt=g[et[lt+2]];(ft.x-gt.x)*(Rt.y-gt.y)-(Rt.x-gt.x)*(ft.y-gt.y)>0&&([et[lt+1],et[lt+2]]=[et[lt+2],et[lt+1]])}return{vertices:g,indices:et}}function cC(b){const o=function(gt,Rt){const Mt=[],Lt=WebGL2RenderingContext;if(gt.json.textures)for(const Ht of gt.json.textures){const Kt={magFilter:Lt.LINEAR,minFilter:Lt.NEAREST,wrapS:Lt.REPEAT,wrapT:Lt.REPEAT};Ht.sampler!==void 0&&Object.assign(Kt,gt.json.samplers[Ht.sampler]),Mt.push({image:Rt[Ht.source],sampler:Kt,uploaded:!1})}return Mt}(b,b.images),g=function(gt,Rt){const Mt=[];for(const Lt of gt.json.meshes){const Ht=[];for(const Kt of Lt.primitives)Ht.push(a8(Kt,gt,Rt));Mt.push(Ht)}return Mt}(b,o),{scenes:et,scene:nt,nodes:at}=b.json,lt=et?et[nt||0].nodes:[...at.keys()],ft=[];for(const gt of lt)ft.push(AS(at[gt],b,g));return function(gt,Rt,Mt){const Lt={},Ht=new Set;for(let Kt=0;Kt<gt.length;Kt++){const Qt=Mt[Rt[Kt]];if(!Qt.extras)continue;const sr=Qt.extras["mapbox:footprint:version"],hr=Qt.extras["mapbox:footprint:id"];(sr||hr)&&Ht.add(Kt),sr==="1.0.0"&&hr&&(Lt[hr]=Kt)}for(let Kt=0;Kt<gt.length;Kt++){if(Ht.has(Kt))continue;const Qt=gt[Kt],sr=Mt[Rt[Kt]];if(!sr.extras)continue;let hr=null;Qt.id in Lt&&(hr=u8(gt[Lt[Qt.id]].meshes,Qt.localMatrix)),hr||(hr=c8(sr)),hr&&(Qt.footprint=l8(hr))}if(Ht.size>0){const Kt=Array.from(Ht.values()).sort((Qt,sr)=>Qt-sr);for(let Qt=Kt.length-1;Qt>=0;Qt--)gt.splice(Kt[Qt],1)}}(ft,lt,b.json.nodes),ft}function d8(b){b.heightmap=new Float32Array(4096),b.heightmap.fill(-1);const o=b.vertexArray.float32,g=b.aabb.min[0]-1,et=b.aabb.min[1]-1,nt=j1/(b.aabb.max[0]-g+2),at=j1/(b.aabb.max[1]-et+2);for(let lt=0;lt<o.length;lt+=3){const ft=o[lt+2],gt=(o[lt+0]-g)*nt|0,Rt=(o[lt+1]-et)*at|0;ft>b.heightmap[Rt*j1+gt]&&(b.heightmap[Rt*j1+gt]=ft)}}function SS(b,o,g,et,nt){g.reserve(g.length+4*b.length),et.reserve(et.length+10*b.length),nt.reserve(nt.length+10*b.length);let at=et.length;for(const lt of b){const ft=Math.min(10,Math.max(4,1.3*lt.height))*o,gt=[-lt.normal[1],lt.normal[0],0],Rt=Math.min(.29,.1*lt.width/lt.depth),Mt=lt.width-2*lt.depth*o*(Rt+.01),Lt=Sn([],lt.pos,gt,Mt/2),Ht=Sn([],lt.pos,gt,-Mt/2),Kt=[Lt[0],Lt[1],Lt[2]+lt.height],Qt=[Ht[0],Ht[1],Ht[2]+lt.height],sr=Sn([],lt.normal,gt,Rt);gn(sr,sr,ft);const hr=Sn([],lt.normal,gt,-Rt);gn(hr,hr,ft),dr(sr,Lt,sr),dr(hr,Ht,hr),Lt[2]+=.1,Ht[2]+=.1,et.emplaceBack(sr[0],sr[1],sr[2]),et.emplaceBack(hr[0],hr[1],hr[2]),et.emplaceBack(Lt[0],Lt[1],Lt[2]),et.emplaceBack(Ht[0],Ht[1],Ht[2]),et.emplaceBack(Kt[0],Kt[1],Kt[2]),et.emplaceBack(Qt[0],Qt[1],Qt[2]),et.emplaceBack(Lt[0],Lt[1],Lt[2]),et.emplaceBack(Ht[0],Ht[1],Ht[2]),et.emplaceBack(sr[0],sr[1],sr[2]),et.emplaceBack(hr[0],hr[1],hr[2]);const ur=Mt/ft/2;nt.emplaceBack(-ur-Rt,-1,ur,.8),nt.emplaceBack(ur+Rt,-1,ur,.8),nt.emplaceBack(-ur,0,ur,1.3),nt.emplaceBack(ur,0,ur,1.3),nt.emplaceBack(ur+Rt,-.8,ur,.7),nt.emplaceBack(ur+Rt,-.8,ur,.7),nt.emplaceBack(0,0,ur,1.3),nt.emplaceBack(0,0,ur,1.3),nt.emplaceBack(ur+Rt,-1.2,ur,.8),nt.emplaceBack(ur+Rt,-1.2,ur,.8),g.emplaceBack(6+at,4+at,8+at),g.emplaceBack(7+at,9+at,5+at),g.emplaceBack(0+at,1+at,2+at),g.emplaceBack(1+at,3+at,2+at),at+=10}}function h8(b,o){const g={};g.indexArray=new _f,g.vertexArray=new a0,g.colorArray=new zm,SS(b,o,g.indexArray,g.vertexArray,g.colorArray);const et={defined:!0};et.emissiveFactor=Mo.black;const nt={};return nt.baseColorFactor=Mo.white,et.pbrMetallicRoughness=nt,g.material=et,g.aabb=new zs([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),g}const TS=Go([{name:"a_pos_3f",components:3,type:"Float32"}]),f8=Go([{name:"a_normal_3",components:3,type:"Int16"}]),p8=Go([{name:"a_centroid_3",components:3,type:"Int16"}]),RS=Go([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),m8=Go([{name:"a_faux_facade_color_emissive",components:2,type:"Uint16"}]),x8=Go([{name:"a_faux_facade_data",components:4,type:"Uint16"}]),g8=Go([{name:"a_faux_facade_vertical_range",components:2,type:"Uint16"}]),y8=Go([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),_8=Go([{name:"a_flood_light_wall_radius_1i16",components:1,type:"Uint16"}]),IS=sn.types,Iw=32767;function v8(b,o){const g=ss+o;for(const et of b)for(const nt of et)if(nt.x<-o||nt.x>g||nt.y<-o||nt.y>g)return!1;return!0}function E8(b){switch(b){case"flat":return 3;case"hipped":return 1;case"gabled":return 2;case"parapet":return 0;case"mansard":return 4;case"skillion":return 5;case"pyramidal":return 6;default:throw new Error(`Unknown roof shape: ${b}`)}}class uC{constructor(){this.layoutVertexArray=new a0,this.layoutAttenuationArray=new zm,this.layoutColorArray=new l0,this.indexArray=new _f,this.indexArrayForConflation=new _f,this.segmentsBucket=new Eu}}class dC{constructor(o){this.layoutFacadePaintArray=null,this.layoutFacadeDataArray=null,this.layoutFacadeVerticalRangeArray=null,this.segmentsBucket=new Eu,this.entranceBloom=new uC;const g=66560;this.layoutVertexArray=new a0,this.layoutVertexArray.reserve(g),this.layoutNormalArray=new Gx,this.layoutNormalArray.reserve(g),this.layoutCentroidArray=new Gx,this.layoutCentroidArray.reserve(g),this.layoutColorArray=new l0,this.layoutColorArray.reserve(g),this.layoutFloodLightDataArray=new Vm,this.layoutFloodLightDataArray.reserve(g),this.layoutAOArray=new $y,this.layoutAOArray.reserve(g),this.indexArray=new _f,this.indexArray.reserve(66560),this.indexArrayForConflation=new _f,this.segmentsBucket=new Eu,this.entranceBloom=new uC,o&&(this.layoutFacadePaintArray=new l0,this.layoutFacadeDataArray=new hx,this.layoutFacadeVerticalRangeArray=new l0)}reserve(o,g,et){this.layoutVertexArray.reserveForAdditional(o),this.layoutCentroidArray.reserveForAdditional(o),this.layoutFloodLightDataArray.reserveForAdditional(o),this.layoutNormalArray.reserveForAdditional(o),this.layoutAOArray.reserveForAdditional(o),this.layoutColorArray.reserveForAdditional(o),this.indexArray.reserveForAdditional(g),et&&(this.layoutFacadePaintArray.reserveForAdditional(o),this.layoutFacadeDataArray.reserveForAdditional(o),this.layoutFacadeVerticalRangeArray.reserveForAdditional(o))}}class DS{constructor(o){this.colorBufferUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.footprintsVertices=new q0,this.footprintsIndices=new Vm,this.footprintsMin=new zn(1/0,1/0),this.footprintsMax=new zn(-1/0,-1/0),this.featuresOnBorder=[],this.buildingWithoutFacade=new dC(!1),this.buildingWithFacade=new dC(!0),this.indexArrayForConflationUploaded=!1,this.featureFootprintLookup=new Map,this.buildingIds=new Set,this.footprintLookup={},this.zoom=o.zoom,this.canonical=o.canonical,this.layers=o.layers,this.layerIds=this.layers.map(g=>g.fqid),this.index=o.index,this.hasPattern=!1,this.worldview=o.worldview,this.lut=o.lut,this.programConfigurations=new B0(o.layers,{zoom:o.zoom,lut:o.lut}),this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.projection=o.projection,this.groundEffect=new q2(o),this.groundEffect.groundRadiusArray=new lm,this.hasAppearances=null}updateFootprints(o,g){const et=new fw([],[],1),nt={vertices:[],indices:new Uint32Array(0),grid:et,min:this.footprintsMin,max:this.footprintsMax,buildingIds:this.buildingIds};g.push({footprint:nt,id:o})}updateAppearances(o,g,et,nt){}prepare(){return function(){if(Ew!=null||uS!=null)return null;if(a_!=null)return a_;const o=fetch(Do.BUILDING_GEN_URL);return a_=function(g){let et,nt,at,lt,ft;function gt(){et=new Uint8Array(ft.buffer),nt=new Int16Array(ft.buffer),at=new Int32Array(ft.buffer),lt=new Float32Array(ft.buffer)}function Rt(){throw new Error("Unexpected BuildingGen error.")}const Mt=()=>{},Lt={a:{a:Rt,f:function(Ht){const Kt=et.length,Qt=Math.max(Ht>>>0,Math.ceil(1.2*Kt)),sr=Math.ceil((Qt-Kt)/65536);try{return ft.grow(sr),gt(),!0}catch{return!1}},g:Rt,b:Mt,c:Mt,d:Mt,e:Mt}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(g,Lt):g.then(Ht=>Ht.arrayBuffer()).then(Ht=>WebAssembly.instantiate(Ht,Lt))).then(Ht=>{const Kt=Ht.instance.exports;return(0,Kt.g)(),ft=Kt.f,gt(),new WR({setStyle:Kt.h,setAOOptions:Kt.i,setMetricOptions:Kt.j,setStructuralOptions:Kt.k,setFacadeOptions:Kt.l,setFauxFacadeOptions:Kt.m,setFacadeClassifierOptions:Kt.n,addFeature:Kt.o,addFacade:Kt.p,generateMesh:Kt.q,getLastError:Kt.r,getOuterRingLength:Kt.s,getMeshCount:Kt.t,getPositionsPtr:Kt.u,getPositionsLength:Kt.v,getNormalsPtr:Kt.w,getNormalsLength:Kt.x,getAOPtr:Kt.y,getAOLength:Kt.z,getUVPtr:Kt.A,getUVLength:Kt.B,getFauxFacadePtr:Kt.C,getFauxFacadeLength:Kt.D,getIndicesPtr:Kt.E,getIndicesLength:Kt.F,getBuildingPart:Kt.G,getRingCount:Kt.H,getRingPtr:Kt.I,getRingLength:Kt.J,malloc:Kt.K,free:Kt.L,heapU8:et,heap16:nt,heap32:at,heapF32:lt})})}(o).then(g=>(a_=null,Ew=g,Ew)).catch(g=>{bs("Could not load building-gen"),a_=null,uS=g}),a_}()}populate(o,g,et,nt){const at=qR();if(!at)return;const lt=xr(et);this.tileToMeter=lt,this.brightness=g.brightness,at.setStyle({normalScale:[1,-1,lt],tileToMeters:lt}),at.setAOOptions(!1,.3),at.setMetricOptions(!1,16),at.setStructuralOptions(!0),at.setFacadeClassifierOptions(3);const ft=new Map,gt=new Map;let Rt=0;for(const{feature:ur}of o){if(IS[ur.type]!=="LineString"){ft.set(ur.id,ur.properties.source_id);continue}const _r=this.layers[0]._featureFilter.needGeometry;if(_r&&!this.layers[0]._featureFilter.filter(new ou(this.zoom),ur,et))continue;const br=an(ur,_r);if(!_r&&!this.layers[0]._featureFilter.filter(new ou(this.zoom),br,et))continue;const Ir=_r?br.geometry:Xr(ur,et,nt),Vr=[];for(const en of Ir)for(const Tn of en)Vr.push(Tn.x),Vr.push(Tn.y);const Mr={coordinates:Vr,crossPerc:ur.properties.cross_perc,distanceToRoad:ur.properties.distance_to_road,entrances:ur.properties.entrances,sourceId:0},Hr=ur.properties.source_id;let Zr=gt.get(Hr);Zr||(Zr=[],gt.set(Hr,Zr)),Zr.push(Mr),++Rt}this.maxHeight=0;const Mt=new Array,Lt=new Set,Ht=ur=>{ur!=null&&Lt.add(ur)},Kt=(ur,_r)=>{ur!=null&&Mt.push({buildingId:ur,footprintIndex:_r})},Qt=64*(o.length-Rt),sr=Qt/2;this.buildingWithFacade.reserve(Qt,sr,!0),this.buildingWithoutFacade.reserve(2*Qt,2*sr,!1),this.footprintsIndices.reserve(16*(o.length-Rt)),this.footprintsVertices.reserve(8*(o.length-Rt));for(const{feature:ur,id:_r,index:br,sourceLayerIndex:Ir}of o){if(IS[ur.type]==="LineString")continue;const Vr=this.layers[0]._featureFilter.needGeometry;if(Vr&&!this.layers[0]._featureFilter.filter(new ou(this.zoom),ur,et))continue;let Mr=null;if(ur.properties&&ur.properties.hasOwnProperty("building_id")&&(Mr=ur.properties.building_id,Lt.has(Mr)))continue;const Hr=an(ur,Vr);if(!Vr&&!this.layers[0]._featureFilter.filter(new ou(this.zoom),Hr,et))continue;const Zr=Vr?Hr.geometry:Xr(ur,et,nt),en=kv(Zr,500);let Tn=!1;for(const ro of en)if(ro.length!==1){Tn=!0;break}if(Tn){Ht(Mr);continue}if(!v8(Zr,163)){Ht(Mr);continue}const ln=this.layers[0],Fn=E8(ln.layout.get("building-roof-shape").evaluate(ur,{},et)),Ln=ln.layout.get("building-base").evaluate(ur,{},et),jn=ln.layout.get("building-height").evaluate(ur,{},et),Zn=ln.layout.get("building-flood-light-ground-radius").evaluate(ur,{},et),Qn=ln.paint.get("building-ambient-occlusion-intensity"),Hn=Zn/this.tileToMeter;ur.properties["building-part"]="roof";const Wn=ln.paint.get("building-color").evaluate(ur,{},this.canonical).toPremultipliedRenderColor(this.lut),kn=ln.paint.get("building-emissive-strength").evaluate(ur,{},this.canonical);ur.properties["building-part"]="wall";const In=ln.paint.get("building-color").evaluate(ur,{},this.canonical).toPremultipliedRenderColor(this.lut),Kn=ln.paint.get("building-emissive-strength").evaluate(ur,{},this.canonical);ur.properties["building-part"]="window";const as=ln.paint.get("building-color").evaluate(ur,{},this.canonical).toPremultipliedRenderColor(this.lut),es=ln.paint.get("building-emissive-strength").evaluate(ur,{},this.canonical);ur.properties["building-part"]="door";const $s=ln.paint.get("building-color").evaluate(ur,{},this.canonical).toPremultipliedRenderColor(this.lut),vs=ln.paint.get("building-emissive-strength").evaluate(ur,{},this.canonical);let Is=ln.layout.get("building-flood-light-wall-radius").evaluate(ur,{},et);Is=pr(Is,0,2048);const Ns=Is/2048*Iw,Fo=ft.get(_r),ts=gt.get(Fo)||[],Os=ts.length!==0&&ln.layout.get("building-facade").evaluate(ur,{},et);at.setFacadeOptions(4,!0),at.setFauxFacadeOptions(Os,!1,1);let fo=0,Ko=0,xa=0,wo=0,$l=0,Nr=0,Ur=0,Bn=0,Yn=0,xs=0,gs=0;if(Os){let ro=Math.round(ln.layout.get("building-facade-floors").evaluate(ur,{},et));if(Ln===0){ro=Math.max(1,ro-(ts.length>0?1:0));let Ol=4;if(jn>100){const pu=[10,13,15];Ol=pu[ur.id?ur.id%pu.length:0]}else jn<=10&&(Ol=3);at.setFacadeOptions(Ol,!0),$l=(jn<15?1.3:1.61803)*Ol/lt}else $l=Ln/lt;Nr=jn/lt,$l=Math.min($l,Nr),xa=ln.layout.get("building-facade-unit-width").evaluate(ur,{},et)/lt,wo=(Nr-$l)/ro,at.setFauxFacadeOptions(!0,!0,xa);const Cu=ln.layout.get("building-facade-window").evaluate(ur,{},et);fo=Cu[0],Ko=Cu[1],Ur=Math.floor(65535*Math.min(1,$l/ss)),Bn=Math.floor(65535*Math.min(1,Nr/ss)),Yn=Math.floor(255*fo)<<8|Math.floor(255*Ko),xs=Math.floor(65535*Math.min(1,xa/ss)),gs=Math.floor(65535*Math.min(1,wo/ss))}const Ws=Array(en.length),Zs={x:1/0,y:1/0},vo={x:-1/0,y:-1/0},Ro={x:0,y:0};let ko=0;for(let ro=0;ro<en.length;ro++){const Cu=en[ro];if(Cu.length>0){const Ol=[],pu=Array(Cu.length+1);pu[0]=0;for(let rp=0;rp<Cu.length;rp++){const dp=Cu[rp];for(let Ju=0;Ju<dp.length;Ju++){const _d=dp[dp.length-Ju-1];Zs.x=Math.min(Zs.x,_d.x),Zs.y=Math.min(Zs.y,_d.y),vo.x=Math.max(vo.x,_d.x),vo.y=Math.max(vo.y,_d.y),Ro.x+=_d.x,Ro.y+=_d.y,ko++,Ol.push(_d.x),Ol.push(_d.y)}pu[rp+1]=Ol.length}Ws[ro]={id:ur.id?ur.id:0,height:jn,minHeight:Ln,sourceId:0,roofType:Fn,coordinates:Ol,ringIndices:pu}}}Ro.x/=ko||1,Ro.y/=ko||1;const $o=at.generateMesh(Ws,ts);if(typeof $o=="string"){bs(`Unable to generate building ${ur.id}: ${$o}`),Ht(Mr);continue}if($o.meshes.length===0||$o.modifiedPolygonRings.length===0){Ht(Mr);continue}const io=Os?this.buildingWithFacade:this.buildingWithoutFacade;let ho=0;for(const ro of $o.meshes)ho+=ro.positions.length/3;const xl=io.segmentsBucket.prepareSegment(ho,io.layoutVertexArray,io.indexArray),wl=[];let Cl=null,Nl=0,Ql=-1;const Hl=io.layoutVertexArray.length,Sl=Hl+ho;io.layoutVertexArray.resize(Sl),io.layoutCentroidArray.resize(Sl),io.layoutNormalArray.resize(Sl),io.layoutAOArray.resize(Sl),io.layoutColorArray.resize(Sl),io.layoutFloodLightDataArray.resize(Sl),Os&&(io.layoutFacadePaintArray.resize(Sl),io.layoutFacadeDataArray.resize(Sl),io.layoutFacadeVerticalRangeArray.resize(Sl));const Fl=io.indexArray.length;let Io=0,Qo=Hl;for(const ro of $o.meshes){let Cu,Ol;if(ro.buildingPart===1)Cu=Wn,Ol=kn;else if(ro.buildingPart===0)Cu=In,Ol=Kn;else if(ro.buildingPart===2)Cu=as,Ol=es;else{if(ro.buildingPart!==3)continue;Cu=$s,Ol=vs}if(Ol=pr(Ol,0,1),ro.buildingPart===3){const su=new Array;for(let np=0;np<ro.positions.length;np+=12){const Y0=ro.positions[np+0],Wm=ro.positions[np+1],vp=ro.positions[np+3],Lp=ro.positions[np+4],h0=ro.positions[np+2],n1=ro.positions[np+8]-h0,E_=1,Em=vp-Y0,bm=Lp-Wm,fE=Math.hypot(Em,bm);su.push({pos:[Y0+.5*Em,Wm+.5*bm,h0],normal:[bm/fE,-Em/fE,0],width:fE,height:n1,depth:E_,points:[Y0,Wm,vp,Lp]})}const ju=io.entranceBloom.segmentsBucket.prepareSegment(10*su.length,io.entranceBloom.layoutVertexArray,io.entranceBloom.indexArray),Hu=io.entranceBloom.layoutVertexArray.length;Nl=io.entranceBloom.indexArray.length,SS(su,.5/this.tileToMeter,io.entranceBloom.indexArray,io.entranceBloom.layoutVertexArray,io.entranceBloom.layoutAttenuationArray);const Qp=io.entranceBloom.layoutVertexArray.length-Hu;Ql=io.entranceBloom.indexArray.length-Nl;for(let np=0;np<Qp;np++)io.entranceBloom.layoutColorArray.emplaceBack(255*$s.r<<8|255*$s.g,255*$s.b<<8|51*vs);ju.vertexLength+=Qp,ju.primitiveLength+=Ql,Cl={part:ro.buildingPart,vertexOffset:Hu,vertexLength:Qp}}io.layoutVertexArray.float32.set(ro.positions,3*Qo);const pu=ro.positions.length/3;for(let su=0;su<pu;++su){const ju=3*su;Io=Math.max(Io,ro.positions[ju+2]);const Hu=ro.normals[ju+1]*Iw,Qp=ro.normals[ju+2]*Iw,np=3*(Qo+su);io.layoutNormalArray.int16[np]=ro.normals[ju]*Iw,io.layoutNormalArray.int16[np+1]=Hu,io.layoutNormalArray.int16[np+2]=Qp;const Y0=ro.ao[su];io.layoutAOArray.uint8[Qo+su]=255*Y0;const Wm=1+(Y0-1)*Qn,vp=255*Cu.b*Wm<<8|255*Ol;io.layoutColorArray.uint16[2*(Qo+su)]=255*Cu.r*Wm<<8|255*Cu.g*Wm,io.layoutColorArray.uint16[2*(Qo+su)+1]=vp}const rp=Math.floor(Ro.x),dp=Math.floor(Ro.y),Ju=Math.floor(jn);for(let su=0;su<pu;++su){const ju=3*(Qo+su);io.layoutCentroidArray.int16[ju]=rp,io.layoutCentroidArray.int16[ju+1]=dp,io.layoutCentroidArray.int16[ju+2]=Ju}if(io.layoutFloodLightDataArray.uint16.fill(ro.buildingPart===0?Ns:0,Qo,Qo+pu),Os){const su=255*as.r<<8|255*as.g,ju=255*as.b<<8|255*es;for(let Hu=0;Hu<pu;++Hu){const Qp=2*(Qo+Hu);io.layoutFacadePaintArray.uint16[Qp]=su,io.layoutFacadePaintArray.uint16[Qp+1]=ju}for(let Hu=0;Hu<pu;++Hu)if(ro.isFauxFacade[Hu]){const Qp=Math.min(65535,Math.floor(ro.uv[2*Hu]*$o.outerRingLength));io.layoutFacadeDataArray.emplace(Qo+Hu,1|Qp,Yn,xs,gs),io.layoutFacadeVerticalRangeArray.emplace(Qo+Hu,Ur,Bn)}else io.layoutFacadeDataArray.emplace(Qo+Hu,0,0,0,0),io.layoutFacadeVerticalRangeArray.emplace(Qo+Hu,0,0)}const _d=xl.vertexLength,cp=ro.indices.length/3,qp=io.indexArray.length;io.indexArray.resize(qp+cp);for(let su=0;su<cp;++su){const ju=3*su,Hu=3*qp+ju;io.indexArray.uint16[Hu]=_d+ro.indices[ju],io.indexArray.uint16[Hu+1]=_d+ro.indices[ju+1],io.indexArray.uint16[Hu+2]=_d+ro.indices[ju+2]}ro.buildingPart!==1&&ro.buildingPart!==0&&ro.buildingPart!==2&&ro.buildingPart!==3||wl.push({part:ro.buildingPart,vertexOffset:Qo,vertexLength:ro.positions.length/3}),Qo+=pu,xl.vertexLength+=pu,xl.primitiveLength+=ro.indices.length/3}this.maxHeight=Math.max(this.maxHeight,Io);const gu=io.indexArray.length-Fl,to=this.footprintsIndices.length,Ho=this.footprintsVertices.length,Xl=[],_c=new zn(1/0,1/0),au=new zn(-1/0,-1/0),$u=this.groundEffect.vertexArray.length;for(const ro of $o.modifiedPolygonRings){const Cu=[],Ol=new zn(1/0,1/0),pu=new zn(-1/0,-1/0);for(let rp=0;rp<ro.length;rp+=2){const dp=ro.length-rp-2;Ol.x=Math.min(Ol.x,ro[dp]),Ol.y=Math.min(Ol.y,ro[dp+1]),pu.x=Math.max(pu.x,ro[dp]),pu.y=Math.max(pu.y,ro[dp+1]);const Ju=new zn(ro[dp],ro[dp+1]);Cu.push(Ju),Xl.push(Ju.x,Ju.y),this.footprintsVertices.emplaceBack(Ju.x,Ju.y)}_c.x=Math.min(_c.x,Ol.x),_c.y=Math.min(_c.y,Ol.y),au.x=Math.max(au.x,pu.x),au.y=Math.max(au.y,pu.y),this.groundEffect.addData(Cu,[Ol,pu],Hn)}const iu=this.groundEffect.vertexArray.length-$u;this.groundEffect.groundRadiusArray.reserveForAdditional(iu);for(let ro=0;ro<iu;ro++)this.groundEffect.groundRadiusArray.emplaceBack(Zn);(Zs.x<0||vo.x>ss||Zs.y<0||vo.y>ss)&&this.featuresOnBorder.push({featureId:ur.id,footprintIndex:this.footprints.length});{const ro=r_(Xl,null,2);this.footprintsIndices.resize(this.footprintsIndices.length+ro.length),this.footprintsIndices.uint16.set(ro,to),this.buildingIds.add(Mr??ur.id),this.footprintsMin.x=Math.min(this.footprintsMin.x,_c.x),this.footprintsMin.y=Math.min(this.footprintsMin.y,_c.y),this.footprintsMax.x=Math.max(this.footprintsMax.x,au.x),this.footprintsMax.y=Math.max(this.footprintsMax.y,au.y);const Cu={footprintVertexOffset:Ho,footprintVertexLength:this.footprintsVertices.length-Ho,footprintIndexOffset:to,footprintIndexLength:this.footprintsIndices.length-to,min:_c,max:au,hiddenFlags:0,indicesOffset:Fl,indicesLength:gu,bloomIndicesOffset:Nl,bloomIndicesLength:Ql,groundEffectVertexOffset:$u,groundEffectVertexLength:iu,hasFauxFacade:Os,height:Io,promoteId:_r,feature:Hr,parts:wl,buildingBloom:Cl},Ol=this.footprints.length;ur.id!==void 0&&this.featureFootprintLookup.set(ur.id,Ol),Kt(Mr,Ol),this.footprints.push(Cu)}this.programConfigurations.populatePaintArrays(io.layoutVertexArray.length,ur,br,{},g.availableImages,et,g.brightness),this.groundEffect.addPaintPropertiesData(ur,br,{},g.availableImages,et,g.brightness),g.featureIndex.insert(ur,Zr,br,Ir,this.index,Hl)}Mt.forEach(({buildingId:ur,footprintIndex:_r})=>{Lt.has(ur)&&(this.footprints[_r].hiddenFlags|=4)});const hr=new Set;this.buildingIds.forEach((ur,_r,br)=>{Lt.has(ur)||hr.add(ur)}),this.buildingIds=hr,this.groundEffect.prepareBorderSegments()}update(o,g,et,nt,at,lt,ft){this.programConfigurations.updatePaintArrays(o,g,at,et,nt,lt,ft),this.groundEffect.update(o,g,at,et,nt,lt,ft),this.evaluate(this.layers[0],o),this.colorBufferUploaded=!1}isEmpty(){return this.buildingWithoutFacade.layoutVertexArray.length===0&&this.buildingWithFacade.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(o){const g=et=>{et.layoutVertexBuffer=o.createVertexBuffer(et.layoutVertexArray,TS.members),et.layoutNormalBuffer=o.createVertexBuffer(et.layoutNormalArray,f8.members),et.layoutCentroidBuffer=o.createVertexBuffer(et.layoutCentroidArray,p8.members),et.layoutFloodLightDataBuffer=o.createVertexBuffer(et.layoutFloodLightDataArray,_8.members),et.layoutFacadeDataArray&&et.layoutFacadeDataArray.length&&(et.layoutFacadeDataBuffer=o.createVertexBuffer(et.layoutFacadeDataArray,x8.members)),et.layoutFacadeVerticalRangeArray&&et.layoutFacadeVerticalRangeArray.length&&(et.layoutFacadeVerticalRangeBuffer=o.createVertexBuffer(et.layoutFacadeVerticalRangeArray,g8.members)),et.entranceBloom.layoutVertexArray.length&&(et.entranceBloom.layoutVertexBuffer=o.createVertexBuffer(et.entranceBloom.layoutVertexArray,TS.members),et.entranceBloom.layoutAttenuationBuffer=o.createVertexBuffer(et.entranceBloom.layoutAttenuationArray,y8.members)),this.uploadUpdatedColorBuffer(o),this.uploadUpdatedIndexBuffer(o)};this.uploaded||(g(this.buildingWithoutFacade),g(this.buildingWithFacade),this.groundEffect.upload(o)),this.groundEffect.uploadPaintProperties(o),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){const o=g=>{g.layoutVertexBuffer&&(g.layoutVertexBuffer.destroy(),g.layoutNormalBuffer.destroy(),g.layoutColorBuffer.destroy(),g.segmentsBucket.destroy(),g.indexBuffer&&g.indexBuffer.destroy(),g.entranceBloom.layoutVertexBuffer&&(g.entranceBloom.layoutVertexBuffer.destroy(),g.entranceBloom.layoutColorBuffer.destroy(),g.entranceBloom.layoutAttenuationBuffer.destroy(),g.entranceBloom.indexBuffer.destroy(),g.entranceBloom.segmentsBucket.destroy()))};o(this.buildingWithoutFacade),o(this.buildingWithFacade),this.groundEffect.destroy(),this.programConfigurations.destroy()}updateFootprintHiddenFlags(o,g,et=!0){let nt=!1;const at=et?g:0,lt=0|(et?-1:~g);this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const ft of o){const gt=this.footprints[ft],Rt=gt.hiddenFlags&lt|at;gt.hiddenFlags!==Rt&&(gt.hiddenFlags=Rt,nt=!0,this.groundEffect.updateHiddenByLandmarkRange(gt.groundEffectVertexOffset,gt.groundEffectVertexLength,gt.hiddenFlags!==0))}return nt&&(this.indexArrayForConflationUploaded=!1),nt}uploadUpdatedIndexBuffer(o){if(this.groundEffect.uploadHiddenByLandmark(o),this.indexArrayForConflationUploaded)return;const g=nt=>{nt.indexArray.length!==0&&(nt.indexArrayForConflation.resize(nt.indexArray.length),nt.indexArrayForConflation.uint16.set(nt.indexArray.uint16),nt.entranceBloom.indexArrayForConflation.resize(nt.entranceBloom.indexArray.length),nt.entranceBloom.indexArrayForConflation.uint16.set(nt.entranceBloom.indexArray.uint16))};g(this.buildingWithoutFacade),g(this.buildingWithFacade);for(const nt of this.footprints){const at=nt.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade,lt=nt.indicesOffset+nt.indicesLength;if(nt.hiddenFlags!==0){for(let gt=nt.indicesOffset;gt<lt;gt++)at.indexArrayForConflation.uint16[3*gt+0]=0,at.indexArrayForConflation.uint16[3*gt+1]=0,at.indexArrayForConflation.uint16[3*gt+2]=0;const ft=nt.bloomIndicesOffset+nt.bloomIndicesLength;for(let gt=nt.bloomIndicesOffset;gt<ft;gt++)at.entranceBloom.indexArrayForConflation.uint16[3*gt+0]=0,at.entranceBloom.indexArrayForConflation.uint16[3*gt+1]=0,at.entranceBloom.indexArrayForConflation.uint16[3*gt+2]=0}}const et=nt=>{nt.indexArray.length!==0&&(nt.indexBuffer?nt.indexBuffer.updateData(nt.indexArrayForConflation):nt.indexBuffer=o.createIndexBuffer(nt.indexArrayForConflation,!0),nt.entranceBloom.indexBuffer?nt.entranceBloom.indexBuffer.updateData(nt.entranceBloom.indexArrayForConflation):nt.entranceBloom.indexBuffer=o.createIndexBuffer(nt.entranceBloom.indexArrayForConflation,!0))};et(this.buildingWithoutFacade),et(this.buildingWithFacade),this.indexArrayForConflationUploaded=!0}uploadUpdatedColorBuffer(o){const g=et=>{et.layoutColorBuffer?et.layoutColorBuffer.updateData(et.layoutColorArray):et.layoutColorBuffer=o.createVertexBuffer(et.layoutColorArray,RS.members,!0),et.layoutFacadePaintArray&&(et.layoutFacadePaintBuffer?et.layoutFacadePaintBuffer.updateData(et.layoutFacadePaintArray):et.layoutFacadePaintBuffer=o.createVertexBuffer(et.layoutFacadePaintArray,m8.members,!0)),et.entranceBloom.layoutColorBuffer?et.entranceBloom.layoutColorBuffer.updateData(et.entranceBloom.layoutColorArray):et.entranceBloom.layoutColorBuffer=o.createVertexBuffer(et.entranceBloom.layoutColorArray,RS.members,!0)};g(this.buildingWithoutFacade),g(this.buildingWithFacade),this.colorBufferUploaded=!0}evaluate(o,g){const et=o.paint.get("building-ambient-occlusion-intensity");for(const nt of this.footprints){if(4&nt.hiddenFlags)continue;const at=g[nt.promoteId],lt=nt.feature;lt.properties["building-part"]="roof";const ft=o.paint.get("building-color").evaluate(lt,at,this.canonical).toPremultipliedRenderColor(this.lut),gt=o.paint.get("building-emissive-strength").evaluate(lt,at,this.canonical);lt.properties["building-part"]="wall";const Rt=o.paint.get("building-color").evaluate(lt,at,this.canonical).toPremultipliedRenderColor(this.lut),Mt=o.paint.get("building-emissive-strength").evaluate(lt,at,this.canonical);lt.properties["building-part"]="window";const Lt=o.paint.get("building-color").evaluate(lt,at,this.canonical).toPremultipliedRenderColor(this.lut),Ht=o.paint.get("building-emissive-strength").evaluate(lt,at,this.canonical);lt.properties["building-part"]="door";const Kt=o.paint.get("building-color").evaluate(lt,at,this.canonical).toPremultipliedRenderColor(this.lut),Qt=o.paint.get("building-emissive-strength").evaluate(lt,at,this.canonical),sr=nt.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade;for(const ur of nt.parts){let _r,br=ft;ur.part===1?(br=ft,_r=gt):ur.part===0?(br=Rt,_r=Mt):ur.part===2?(br=Lt,_r=Ht):ur.part===3&&(br=Kt,_r=Qt),_r=pr(_r,0,1);for(let Ir=0;Ir<ur.vertexLength;Ir++){const Vr=ur.vertexOffset+Ir,Mr=1+(sr.layoutAOArray.uint8[Vr]/255-1)*et;sr.layoutColorArray.emplace(Vr,br.r*Mr*255<<8|br.g*Mr*255,br.b*Mr*255<<8|255*_r),nt.hasFauxFacade&&sr.layoutFacadePaintArray.emplace(Vr,255*Lt.r<<8|255*Lt.g,255*Lt.b<<8|255*Ht)}}const hr=nt.buildingBloom;if(hr)for(let ur=0;ur<hr.vertexLength;ur++)sr.entranceBloom.layoutColorArray.emplace(hr.vertexOffset+ur,255*Kt.r<<8|255*Kt.g,255*Kt.b<<8|51*Qt)}}needsEvaluation(){return!this.colorBufferUploaded}updateReplacement(o,g,et){if(g.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=g.updateTime;const nt=g.getReplacementRegionsForTile(o.toUnwrapped());if(mw(this.activeReplacements,nt))return;this.activeReplacements=nt;for(const lt of this.footprints)lt.hiddenFlags&=-2;const at=[];for(const lt of this.activeReplacements){if(lt.order<=PA)continue;const ft=Math.max(1,Math.pow(2,lt.footprintTileId.canonical.z-o.canonical.z));for(const gt of this.footprints)gt.min.x>lt.max.x||gt.max.x<lt.min.x||gt.min.y>lt.max.y||gt.max.y<lt.min.y||(at.length=0,w8(this.footprintsVertices,gt.footprintVertexOffset,gt.footprintVertexLength,lt.footprintTileId.canonical,o.canonical,at),$2(lt.footprint,at,this.footprintsIndices.uint16,gt.footprintIndexOffset,gt.footprintIndexLength,0,-ft)&&(gt.hiddenFlags|=1))}this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const lt of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(lt.groundEffectVertexOffset,lt.groundEffectVertexLength,lt.hiddenFlags!==0);this.indexArrayForConflationUploaded=!1}getFootprint(o){if(o.id!==void 0){const g=this.featureFootprintLookup.get(o.id);return this.footprints[g]}return null}getHeightAtTileCoord(o,g){let et=Number.NEGATIVE_INFINITY,nt=!0;const at=4*(o+ss)*ss+(g+ss);if(this.footprintLookup.hasOwnProperty(at)){const ft=this.footprintLookup[at];return ft?{height:ft.height,hidden:ft.hiddenFlags!==0}:void 0}const lt=new zn(o,g);for(const ft of this.footprints)o>ft.max.x||ft.min.x>o||g>ft.max.y||ft.min.y>g||ft.height<=et||b8(lt,this.footprintsVertices.float32.subarray(2*ft.footprintVertexOffset,2*(ft.footprintVertexOffset+ft.footprintVertexLength)),this.footprintsIndices.uint16.subarray(ft.footprintIndexOffset,ft.footprintIndexOffset+ft.footprintIndexLength))&&(et=ft.height,this.footprintLookup[at]=ft,nt=ft.hiddenFlags!==0);if(et!==Number.NEGATIVE_INFINITY)return{height:et,hidden:nt};this.footprintLookup[at]=void 0}}function b8(b,o,g){for(let et=0;et<g.length;et+=3){const nt=g[et],at=g[et+1],lt=g[et+2],ft=o[2*nt+0],gt=o[2*nt+1],Rt=o[2*at+0],Mt=o[2*at+1],Lt=o[2*lt+0],Ht=o[2*lt+1],Kt=(ft-Lt)*(b.y-Ht)-(gt-Ht)*(b.x-Lt),Qt=(Rt-ft)*(b.y-gt)-(Mt-gt)*(b.x-ft);if(Kt<0!=Qt<0&&Kt!==0&&Qt!==0)continue;const sr=(Lt-Rt)*(b.y-Mt)-(Ht-Mt)*(b.x-Rt);if(sr===0||sr<0==Kt+Qt<=0)return!0}return!1}function w8(b,o,g,et,nt,at){const lt=Math.pow(2,et.z-nt.z);for(let ft=0;ft<g;ft++){let gt=b.float32[2*(ft+o)+0],Rt=b.float32[2*(ft+o)+1];gt=(gt+nt.x*ss)*lt-et.x*ss,Rt=(Rt+nt.y*ss)*lt-et.y*ss,at.push(new zn(gt,Rt))}}let PS,kS;Ps(DS,"BuildingBucket",{omit:["layers"]}),Ps(dC,"BuildingGeometry"),Ps(uC,"BuildingBloomGeometry");const C8=Go([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),A8=Go([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:S8}=C8,T8=Go([{name:"a_packed",components:3,type:"Float32"}]),{members:R8}=T8,I8=Go([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:D8}=I8;class FS{constructor(o,g){this.width=o,this.height=g,this.nextRow=0,this.image=new Jx({width:o,height:g}),this.positions={},this.uploaded=!1}getDash(o,g){const et=this.getKey(o,g);return this.positions[et]}trim(){const o=this.width,g=this.height=En(this.nextRow);this.image.resize({width:o,height:g})}getKey(o,g){return o.join(",")+g}getDashRanges(o,g,et){const nt=[];let at=o.length%2==1?-o[o.length-1]*et:0,lt=o[0]*et,ft=!0;nt.push({left:at,right:lt,isDash:ft,zeroLength:o[0]===0});let gt=o[0];for(let Rt=1;Rt<o.length;Rt++){ft=!ft;const Mt=o[Rt];at=gt*et,gt+=Mt,lt=gt*et,nt.push({left:at,right:lt,isDash:ft,zeroLength:Mt===0})}return nt}addRoundDash(o,g,et){const nt=g/2;for(let at=-et;at<=et;at++){const lt=this.width*(this.nextRow+et+at);let ft=0,gt=o[ft];for(let Rt=0;Rt<this.width;Rt++){Rt/gt.right>1&&(gt=o[++ft]);const Mt=Math.abs(Rt-gt.left),Lt=Math.abs(Rt-gt.right),Ht=Math.min(Mt,Lt);let Kt;const Qt=at/et*(nt+1);if(gt.isDash){const sr=nt-Math.abs(Qt);Kt=Math.sqrt(Ht*Ht+sr*sr)}else Kt=nt-Math.sqrt(Ht*Ht+Qt*Qt);this.image.data[lt+Rt]=Math.max(0,Math.min(255,Kt+128))}}}addRegularDash(o,g){for(let gt=o.length-1;gt>=0;--gt){const Rt=o[gt],Mt=o[gt+1];Rt.zeroLength?o.splice(gt,1):Mt&&Mt.isDash===Rt.isDash&&(Mt.left=Rt.left,o.splice(gt,1))}const et=o[0],nt=o[o.length-1];et.isDash===nt.isDash&&(et.left=nt.left-this.width,nt.right=et.right+this.width);const at=this.width*this.nextRow;let lt=0,ft=o[lt];for(let gt=0;gt<this.width;gt++){gt/ft.right>1&&(ft=o[++lt]);const Rt=Math.abs(gt-ft.left),Mt=Math.abs(gt-ft.right),Lt=Math.min(Rt,Mt);this.image.data[at+gt]=Math.max(0,Math.min(255,(ft.isDash?Lt:-Lt)+g+128))}}addDash(o,g){const et=this.getKey(o,g);if(this.positions[et])return this.positions[et];const nt=g==="round",at=nt?7:0,lt=2*at+1;if(this.nextRow+lt>this.height)return bs("LineAtlas out of space"),null;o.length===0&&o.push(1);let ft=0;for(let Mt=0;Mt<o.length;Mt++)o[Mt]<0&&(bs("Negative value is found in line dasharray, replacing values with 0"),o[Mt]=0),ft+=o[Mt];if(ft!==0){const Mt=this.width/ft,Lt=this.getDashRanges(o,this.width,Mt);nt?this.addRoundDash(Lt,Mt,at):this.addRegularDash(Lt,g==="square"?.5*Mt:0)}const gt=this.nextRow+at;this.nextRow+=lt;const Rt={tl:[gt,at],br:[ft,0]};return this.positions[et]=Rt,Rt}}Ps(FS,"LineAtlas");const P8=sn.types,k8=Math.cos(Math.PI/180*37.5),F8=Math.cos(Math.PI/180*5);class hC{constructor(o){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=o.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=o.overscaling,this.pixelRatio=o.pixelRatio,this.layers=o.layers,this.layerIds=this.layers.map(g=>g.fqid),this.index=o.index,this.projection=o.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(g=>{this.gradients[g.id]={}}),this.layoutVertexArray=new Oy,this.layoutVertexArray2=new a0,this.patternVertexArray=new a0,this.indexArray=new _f,this.programConfigurations=new B0(o.layers,{zoom:o.zoom,lut:o.lut}),this.segments=new Eu,this.maxLineLength=0,this.zOffsetVertexArray=new a0,this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.tessellationStep=o.tessellationStep?o.tessellationStep:ss/64,this.worldview=o.worldview,this.hasAppearances=null}updateFootprints(o,g){}updateAppearances(o,g,et,nt){}populate(o,g,et,nt){this.hasPattern=L2("line",this.layers,this.pixelRatio,g);const at=this.layers[0].layout.get("line-sort-key");this.tileToMeter=xr(et);const lt=this.layers[0].layout.get("line-elevation-reference");if(lt==="hd-road-markup")this.elevationType="road";else{const Ht=this.layers[0].layout.get("line-z-offset"),Kt=Ht.isConstant()&&!Ht.constantOr(0);this.elevationType=lt!=="sea"&&lt!=="ground"&&Kt?"none":"offset",this.elevationType==="offset"&&lt==="none"&&bs(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const ft=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&ft!==void 0;const gt=[];for(const{feature:Ht,id:Kt,index:Qt,sourceLayerIndex:sr}of o){const hr=this.layers[0]._featureFilter.needGeometry,ur=an(Ht,hr);if(!this.layers[0]._featureFilter.filter(new ou(this.zoom,{worldview:this.worldview,activeFloors:g.activeFloors}),ur,et))continue;const _r=at?at.evaluate(ur,{},et):void 0,br={id:Kt,properties:Ht.properties,type:Ht.type,sourceLayerIndex:sr,index:Qt,geometry:hr?ur.geometry:Xr(Ht,et,nt),patterns:{},sortKey:_r};gt.push(br)}at&&gt.sort((Ht,Kt)=>Ht.sortKey-Kt.sortKey);const{lineAtlas:Rt,featureIndex:Mt}=g,Lt=this.addConstantDashes(Rt);for(const Ht of gt){const{geometry:Kt,index:Qt,sourceLayerIndex:sr}=Ht;if(Lt&&this.addFeatureDashes(Ht,Rt),this.hasPattern){const hr=j2("line",this.layers,Ht,this.zoom,this.pixelRatio,g);this.patternFeatures.push(hr)}else this.addFeature(Ht,Kt,Qt,et,Rt.positions,g.availableImages,g.brightness,g.elevationFeatures);Mt.insert(o[Qt].feature,Kt,Qt,sr,this.index)}}addConstantDashes(o){let g=!1;for(const et of this.layers){const nt=et.paint.get("line-dasharray").value,at=et.layout.get("line-cap").value;if(nt.kind!=="constant"||at.kind!=="constant")g=!0;else{const lt=at.value,ft=nt.value;if(!ft)continue;o.addDash(ft,lt)}}return g}addFeatureDashes(o,g){const et=this.zoom;for(const nt of this.layers){const at=nt.paint.get("line-dasharray").value,lt=nt.layout.get("line-cap").value;if(at.kind==="constant"&&lt.kind==="constant")continue;let ft,gt;if(at.kind==="constant"){if(ft=at.value,!ft)continue}else ft=at.evaluate({zoom:et},o);gt=lt.kind==="constant"?lt.value:lt.evaluate({zoom:et},o),g.addDash(ft,gt),o.patterns[nt.id]=[g.getKey(ft,gt)]}}update(o,g,et,nt,at,lt,ft,gt){this.programConfigurations.updatePaintArrays(o,g,at,et,nt,lt,ft,gt)}addFeatures(o,g,et,nt,at,lt){for(const ft of this.patternFeatures)this.addFeature(ft,ft.geometry,ft.index,g,et,nt,lt,o.elevationFeatures)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=o.createVertexBuffer(this.layoutVertexArray2,R8)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=o.createVertexBuffer(this.patternVertexArray,D8)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=o.createVertexBuffer(this.zOffsetVertexArray,A8.members,!0)),this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,S8),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(o,g){let et,nt;if(g&&g>0?(et=`mapbox_clip_start_${g}`,nt=`mapbox_clip_end_${g}`):(et="mapbox_clip_start",nt="mapbox_clip_end"),o.properties&&o.properties.hasOwnProperty(et)&&o.properties.hasOwnProperty(nt))return{start:+o.properties[et],end:+o.properties[nt]}}addFeature(o,g,et,nt,at,lt,ft,gt){const Rt=this.layers[0].layout,Mt=Rt.get("line-join").evaluate(o,{}),Lt=Rt.get("line-cap").evaluate(o,{}),Ht=Rt.get("line-miter-limit"),Kt=Rt.get("line-round-limit");this.lineClips=this.lineFeatureClips(o),this.lineFeature=o;const Qt=!(!o.properties||!o.properties.hasOwnProperty("mapbox_line_metrics"))&&o.properties.mapbox_line_metrics;this.zOffsetValue=Rt.get("line-z-offset").value;const sr=this.layers[0].paint.get("line-width").value;if(sr.kind!=="constant"&&sr.isLineProgressConstant===!1&&(this.variableWidthValue=sr),this.elevationType==="road"){const hr=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(o,g,nt,gt,Mt,Lt,Ht,Kt)){const[ur,_r]=this.clipRuntimeLinesToTile(g,1);for(let br=0;br<ur.length;br++){const Ir=ur[br],Vr=_r[br],Mr={progress:{min:Vr.progress.min,max:Vr.progress.max},nextDir:this.computeSegNextDir(Vr,Ir),prevDir:this.computeSegPrevDir(Vr,Ir)};this.addLine(Ir,o,nt,Mt,Lt,Ht,Kt,Mr,Qt&&Vr.parentIndex>0?Vr.parentIndex:null)}this.fillNonElevatedRoadSegment(hr)}}else for(let hr=0;hr<g.length;hr++)this.addLine(g[hr],o,nt,Mt,Lt,Ht,Kt,void 0,Qt&&hr>0?hr:null);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,et,at,lt,nt,ft,void 0,this.worldview)}computeSegNextDir(o,g){return o.nextPoint.sub(g.at(-2)).unit()}computeSegPrevDir(o,g){return g[1].sub(o.prevPoint).unit()}clipLinesToTile(o,g){return yw(o,-g,-g,ss+g,ss+g)}clipRuntimeLinesToTile(o,g){const et=[];return[yw(o,-g,-g,ss+g,ss+g,et),et]}addElevatedRoadFeature(o,g,et,nt,at,lt,ft,gt){const Rt=[],Mt=Dl.getElevationFeature(o,nt);if(Mt){const Lt=this.clipLinesToTile(g,1),Ht=this.prepareElevatedLines(Lt,Mt,et);for(const Kt of Ht)Rt.push({geometry:Kt,elevation:Mt,elevationTileID:et,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(Rt.length===0)return!1;for(const Lt of Rt){const Ht=this.layoutVertexArray.length;this.addLine(Lt.geometry,o,et,at,lt,ft,gt);const Kt=new Vl(et,Lt.elevationTileID);if(Lt.elevation)for(let Qt=Ht;Qt<this.layoutVertexArray.length;Qt++){const sr=new zn(this.layoutVertexArray.int16[6*Qt]>>1,this.layoutVertexArray.int16[6*Qt+1]>>1),hr=Kt.pointElevation(sr,Lt.elevation,.05);this.updateHeightRange(hr),this.zOffsetVertexArray.emplaceBack(hr,0,0)}else this.fillNonElevatedRoadSegment(Ht)}return!0}prepareElevatedLines(o,g,et){if(g.constantHeight!=null)return o;const nt=[],at=1/xr(et);for(const lt of o)GR(lt,new El(g,at),0,nt);return nt}fillNonElevatedRoadSegment(o){for(let g=o;g<this.layoutVertexArray.length;g++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(o){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,o),this.heightRange.max=Math.max(this.heightRange.max,o)):this.heightRange={min:o,max:o}}addLine(o,g,et,nt,at,lt,ft,gt,Rt){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0,this.lineClips=Rt?this.lineFeatureClips(g,Rt):this.lineClips;const Mt=nt==="none";this.patternJoinNone=this.hasPattern&&Mt,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const Lt=gt&&gt.progress.min>0,Ht=gt&&gt.progress.max<1;if(this.lineClips){let en={min:this.lineClips.start,max:this.lineClips.end},Tn=1;if(gt){const Ln=this.lineClips.end-this.lineClips.start;en=function(jn,Zn,Qn){return{min:Vo(jn.min,Zn,Qn),max:Vo(jn.max,Zn,Qn)}}(gt.progress,{min:0,max:1},en),Ln>0&&(Tn=(en.max-en.min)/Ln)}const ln=+g.properties.mapbox_clip_feature_len,Fn=+g.properties.mapbox_clip_seg_len;if(Number.isNaN(ln)||Number.isNaN(Fn)){for(let jn=0;jn<o.length-1;jn++)this.totalDistance+=o[jn].dist(o[jn+1]);const Ln=this.totalDistance/(en.max-en.min);this.totalFeatureLength=Number.isFinite(Ln)?Ln:0,this.lineClips.start=en.min,this.lineClips.end=en.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=ln,this.distance=Fn*Tn,this.lineClips.start=en.min,this.lineClips.end=en.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const Kt=P8[g.type]==="Polygon";let Qt=o.length;for(;Qt>=2&&o[Qt-1].equals(o[Qt-2]);)Qt--;let sr=0;for(;sr<Qt-1&&o[sr].equals(o[sr+1]);)sr++;if(Qt<(Kt?3:2))return;nt==="bevel"&&(lt=1.05);const hr=this.segments.prepareSegment(10*Qt,this.layoutVertexArray,this.indexArray);let ur,_r,br,Ir,Vr,Mr,Hr,Zr;gt&&gt.prevDir&&(Mr=gt.prevDir.perp()),gt&&gt.nextDir&&(Hr=gt.nextDir.perp()),this.e1=this.e2=-1,Kt&&(ur=o[Qt-2],Vr=o[sr].sub(ur)._unit()._perp());for(let en=sr;en<Qt;en++){if(br=en===Qt-1?Kt?o[sr+1]:void 0:o[en+1],br&&o[en].equals(br))continue;Vr&&(Ir=Vr),ur&&(_r=ur),ur=o[en],Zr=this.evaluateLineProgressFeatures(_r?_r.dist(ur):0),Vr=br?br.sub(ur)._unit()._perp():Ir,Ir=Ir||Vr;const Tn=_r&&br;let ln=Tn?nt:Kt||Mt?"butt":at;const Fn=Ir.x*Vr.x+Ir.y*Vr.y;if(Mt){const In=function(Kn){if(Kn.patternJoinNone){const as=Kn.segmentPoints.length/2,es=Kn.lineSoFar-Kn.segmentStart;for(let $s=0;$s<as;++$s){const vs=Kn.segmentPoints[2*$s+1],Is=Math.round(Kn.segmentPoints[2*$s])+.5+.25*vs;Kn.patternVertexArray.emplaceBack(Is,es,Kn.segmentStart),Kn.patternVertexArray.emplaceBack(Is,es,Kn.segmentStart)}Kn.segmentPoints.length=0}Kn.e1=Kn.e2=-1};if(Tn&&Fn<F8){this.updateDistance(_r,ur),this.addCurrentVertex(ur,Ir,1,1,hr,Zr),In(this),this.addCurrentVertex(ur,Vr,-1,-1,hr,Zr);continue}if(_r){if(!br){this.updateDistance(_r,ur),this.addCurrentVertex(ur,Ir,1,1,hr,Zr),In(this);continue}ln="miter"}}let Ln=Ir.add(Vr);Ln.x===0&&Ln.y===0||Ln._unit();const jn=Ln.x*Vr.x+Ln.y*Vr.y,Zn=jn!==0?1/jn:1/0,Qn=2*Math.sqrt(2-2*jn),Hn=jn<k8&&_r&&br,Wn=Ir.x*Vr.y-Ir.y*Vr.x>0,kn=this.overscaling<=16?15*ss/(512*this.overscaling):0;if(Tn&&ln==="round"){if(Zn<ft)ln="miter";else if(Zn<=2){const In=fC(ur,-10,ss+10);ln=this.elevationType==="offset"&&(In||this.hasCrossSlope)?"miter":"fakeround"}}if(ln==="miter"&&Zn>lt&&(ln="bevel"),ln==="bevel"&&(Zn>2&&(ln="flipbevel"),Zn<lt&&(ln="miter")),_r&&!(ln==="miter"&&Hn)&&this.updateDistance(_r,ur),ln==="miter")if(Hn){const In=ur.dist(_r);if(In>2*kn){const as=ur.sub(ur.sub(_r)._mult(kn/In)._round());this.updateDistance(_r,as),this.addCurrentVertex(as,Ir,0,0,hr,Zr),_r=as}this.updateDistance(_r,ur),Ln._mult(Zn),this.addCurrentVertex(ur,Ln,0,0,hr,Zr);const Kn=ur.dist(br);if(Kn>2*kn){const as=ur.add(br.sub(ur)._mult(kn/Kn)._round());this.updateDistance(ur,as),this.addCurrentVertex(as,Vr,0,0,hr,Zr),ur=as}}else Ln._mult(Zn),this.addCurrentVertex(ur,Ln,0,0,hr,Zr);else if(ln==="flipbevel"){if(Zn>100)Ln=Vr.mult(-1);else{const In=Zn*Ir.add(Vr).mag()/Ir.sub(Vr).mag();Ln._perp()._mult(In*(Wn?-1:1))}this.addCurrentVertex(ur,Ln,0,0,hr,Zr),this.addCurrentVertex(ur,Ln.mult(-1),0,0,hr,Zr)}else if(ln==="bevel"||ln==="fakeround"){Zr!=null&&_r&&this.addCurrentVertex(ur,Hr||Ir,-1,-1,hr,Zr);const In=ur.dist(_r)<=2*kn&&ln!=="bevel",Kn=Ln.mult(Wn?1:-1);Kn._mult(Zn);const as=Vr.mult(Wn?-1:1),es=Ir.mult(Wn?-1:1),$s=this.evaluateLineProgressFeatures(this.distance);if(Zr==null&&(this.addHalfVertex(ur,Kn.x,Kn.y,!1,!Wn,0,hr,$s),In||this.addHalfVertex(ur,Kn.x+2*es.x,Kn.y+2*es.y,!1,Wn,0,hr,$s)),ln==="fakeround"){const vs=Math.round(180*Qn/Math.PI/20);this.addHalfVertex(ur,es.x,es.y,!1,Wn,0,hr,$s);for(let Is=0;Is<vs;Is++){let Ns=Is/vs;if(Ns!==.5){const ts=Ns-.5;Ns+=Ns*ts*(Ns-1)*((1.0904+Fn*(Fn*(3.55645-1.43519*Fn)-3.2452))*ts*ts+(.848013+Fn*(.215638*Fn-1.06021)))}const Fo=as.sub(es)._mult(Ns)._add(es)._unit();this.addHalfVertex(ur,Fo.x,Fo.y,!1,Wn,0,hr,$s)}this.addHalfVertex(ur,as.x,as.y,!1,Wn,0,hr,$s)}In||Zr!=null||this.addHalfVertex(ur,Kn.x+2*as.x,Kn.y+2*as.y,!1,Wn,0,hr,$s),Zr!=null&&br&&this.addCurrentVertex(ur,Mr||Vr,1,1,hr,Zr)}else if(ln==="butt")this.addCurrentVertex(ur,Ln,0,0,hr,Zr);else if(ln==="square"){if(!_r){const In=Lt?0:-1;this.addCurrentVertex(ur,Ln,In,In,hr,Zr)}if(this.addCurrentVertex(ur,Ln,0,0,hr,Zr),_r){const In=Ht?0:1;this.addCurrentVertex(ur,Ln,In,In,hr,Zr)}}else if(ln==="round"){if(_r){const In=!Tn&&Hr?Hr:Ir;this.addCurrentVertex(ur,In,0,0,hr,Zr),!Tn&&Ht||this.addCurrentVertex(ur,In,1,1,hr,Zr,!0)}if(br){const In=!Tn&&Mr?Mr:Vr;!Tn&&Lt||this.addCurrentVertex(ur,In,-1,-1,hr,Zr,!0),this.addCurrentVertex(ur,In,0,0,hr,Zr)}}}}addVerticesTo(o,g,et,nt,at,lt,ft,gt,Rt,Mt){const Lt=(g.w-o.w)/this.tessellationStep|0;let Ht=0;const Kt=this.scaledDistance;if(Lt>1){this.lineSoFar=o.w;const sr=(g.x-o.x)/Lt,hr=(g.y-o.y)/Lt,ur=(g.z-o.z)/Lt,_r=(g.w-o.w)/Lt;for(let br=1;br<Lt;++br){o.x+=sr,o.y+=hr,o.z+=ur,this.lineSoFar+=_r,Ht+=_r;const Ir=this.evaluateLineProgressFeatures(this.prevDistance+Ht);this.scaledDistance=(this.prevDistance+Ht)/this.totalDistance,this.addHalfVertex(o,et,nt,Mt,!1,ft,Rt,Ir),this.addHalfVertex(o,at,lt,Mt,!0,-gt,Rt,Ir)}}this.lineSoFar=g.w,this.scaledDistance=Kt;const Qt=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(g,et,nt,Mt,!1,ft,Rt,Qt),this.addHalfVertex(g,at,lt,Mt,!0,-gt,Rt,Qt)}evaluateLineProgressFeatures(o){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+o)/this.totalFeatureLength):bs(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let g=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(g=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:g}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:g}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:g}}addCurrentVertex(o,g,et,nt,at,lt,ft=!1){const gt=g.x+g.y*et,Rt=g.y-g.x*et,Mt=g.y*nt-g.x,Lt=-g.y-g.x*nt;if(lt!=null){const Ht=this.elevationType==="offset",Kt=-10,Qt=ss+10,sr=lt.zOffset,hr=new tS(o.x,o.y,sr,this.lineSoFar),ur=!!Ht&&fC(o,Kt,Qt),_r=this.lineSoFar,br=this.distance;if(this.currentVertex)if(ur){const Ir=this.currentVertexIsOutside,Vr=this.currentVertex,Mr=new tS(o.x,o.y,sr,this.lineSoFar);if(nS(Vr,Mr,Kt,Qt),!fC(Mr,Kt,Qt)){if(Ir){this.e1=this.e2=-1,this.distance-=Vr.dist(hr),this.lineSoFar=Vr.w;const Hr=this.evaluateLineProgressFeatures(Vr.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(Vr,gt,Rt,ft,!1,et,at,Hr),this.addHalfVertex(Vr,Mt,Lt,ft,!0,-nt,at,Hr),this.prevDistance=this.distance}this.distance=this.prevDistance+Vr.dist(Mr),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(Vr,Mr,gt,Rt,Mt,Lt,et,nt,at,ft),this.distance=br,this.scaledDistance=this.distance/this.totalDistance}}else{const Ir=this.currentVertex;if(this.currentVertexIsOutside){nS(Ir,hr,Kt,Qt),this.e1=this.e2=-1,this.distance-=Ir.dist(hr),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=Ir.w;const Vr=this.evaluateLineProgressFeatures(Ir.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(Ir,gt,Rt,ft,!1,et,at,Vr),this.addHalfVertex(Ir,Mt,Lt,ft,!0,-nt,at,Vr),this.prevDistance=this.distance,this.distance=br,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(Ir,hr,gt,Rt,Mt,Lt,et,nt,at,ft)}else ur||(this.addHalfVertex(o,gt,Rt,ft,!1,et,at,lt),this.addHalfVertex(o,Mt,Lt,ft,!0,-nt,at,lt));this.currentVertex=hr,this.currentVertexIsOutside=ur,this.lineSoFar=_r}else this.addHalfVertex(o,gt,Rt,ft,!1,et,at,lt),this.addHalfVertex(o,Mt,Lt,ft,!0,-nt,at,lt)}addHalfVertex({x:o,y:g},et,nt,at,lt,ft,gt,Rt){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),lt||this.segmentPoints.push(this.lineSoFar-this.segmentStart,ft)),this.layoutVertexArray.emplaceBack((o<<1)+(at?1:0),(g<<1)+(lt?1:0),Math.round(63*et)+128,Math.round(63*nt)+128,1+(ft===0?0:ft<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const Lt=so(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,Lt)}const Mt=gt.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,Mt),gt.primitiveLength++),lt?this.e2=Mt:this.e1=Mt,Rt!=null&&this.zOffsetVertexArray.emplaceBack(Rt.zOffset,Rt.variableWidth,Rt.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(o,g){this.prevDistance=this.distance,this.distance+=o.dist(g),this.updateScaledDistance()}}function fC(b,o,g){return b.x<o||b.x>g||b.y<o||b.y>g}let BS,MS;function NS(b,o,g){return o*(ss/(b.tileSize*Math.pow(2,g-b.tileID.overscaledZ)))}Ps(hC,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const OS=(b,o,g)=>(1-g)*b+g*o;function LS(b,o){return 1/NS(b,1,o.tileZoom)}function jS(b,o,g,et){return b.translatePosMatrix(et||o.tileID.projMatrix,o,g.paint.get("line-translate"),g.paint.get("line-translate-anchor"))}const zS=b=>{const o=[];VS(b)&&o.push("RENDER_LINE_DASH"),b.paint.get("line-gradient")&&o.push("RENDER_LINE_GRADIENT");const g=b.paint.get("line-trim-offset");g[0]===0&&g[1]===0||o.push("RENDER_LINE_TRIM_OFFSET"),b.paint.get("line-border-width").constantOr(1)!==0&&o.push("RENDER_LINE_BORDER");const et=b.layout.get("line-join").constantOr("miter")==="none",nt=!!b.paint.get("line-pattern").constantOr(1);return et&&nt&&o.push("LINE_JOIN_NONE"),o};function VS(b){const o=b.paint.get("line-dasharray").value;return o.kind!=="constant"||o.value}let pC;const US=()=>pC||(pC={layout:BS||(BS=new Fu({"line-cap":new hs(mn.layout_line["line-cap"]),"line-join":new hs(mn.layout_line["line-join"]),"line-miter-limit":new ns(mn.layout_line["line-miter-limit"]),"line-round-limit":new ns(mn.layout_line["line-round-limit"]),"line-sort-key":new hs(mn.layout_line["line-sort-key"]),"line-z-offset":new hs(mn.layout_line["line-z-offset"]),"line-elevation-reference":new ns(mn.layout_line["line-elevation-reference"]),"line-cross-slope":new ns(mn.layout_line["line-cross-slope"]),visibility:new ns(mn.layout_line.visibility),"line-width-unit":new ns(mn.layout_line["line-width-unit"])})),paint:MS||(MS=new Fu({"line-opacity":new hs(mn.paint_line["line-opacity"]),"line-color":new hs(mn.paint_line["line-color"]),"line-translate":new ns(mn.paint_line["line-translate"]),"line-translate-anchor":new ns(mn.paint_line["line-translate-anchor"]),"line-width":new hs(mn.paint_line["line-width"]),"line-gap-width":new hs(mn.paint_line["line-gap-width"]),"line-offset":new hs(mn.paint_line["line-offset"]),"line-blur":new hs(mn.paint_line["line-blur"]),"line-dasharray":new hs(mn.paint_line["line-dasharray"]),"line-pattern":new hs(mn.paint_line["line-pattern"]),"line-pattern-cross-fade":new ns(mn.paint_line["line-pattern-cross-fade"]),"line-gradient":new lx(mn.paint_line["line-gradient"]),"line-trim-offset":new ns(mn.paint_line["line-trim-offset"]),"line-trim-fade-range":new ns(mn.paint_line["line-trim-fade-range"]),"line-trim-color":new ns(mn.paint_line["line-trim-color"]),"line-emissive-strength":new hs(mn.paint_line["line-emissive-strength"]),"line-border-width":new hs(mn.paint_line["line-border-width"]),"line-border-color":new hs(mn.paint_line["line-border-color"]),"line-occlusion-opacity":new ns(mn.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new hs({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new hs({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new hs({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new hs({type:"string",default:"default","property-type":"data-driven"})}))},pC);class B8 extends hs{possiblyEvaluate(o,g){return g=new ou(Math.floor(g.zoom),{now:g.now,fadeDuration:g.fadeDuration,transition:g.transition,worldview:g.worldview}),super.possiblyEvaluate(o,g)}evaluate(o,g,et,nt){return g=Object.assign({},g,{zoom:Math.floor(g.zoom)}),super.evaluate(o,g,et,nt)}}let $v;function GS(b,o){return o>0?o+2*b:b}const M8=Go([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),N8=Go([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),O8=Go([{name:"a_projected_pos",components:4,type:"Float32"}],4);Go([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const L8=Go([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),j8=Go([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),z8=Go([{name:"a_texb",components:2,type:"Uint16"}]),V8=Go([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),U8=Go([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);Go([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const $S=Go([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),G8=Go([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Go([{name:"triangle",components:3,type:"Uint16"}]),Go([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Go([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),Go([{type:"Float32",name:"offsetX"}]),Go([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var up=24;function $8(b,o,g){return b.sections.forEach(et=>{et.text=function(nt,at,lt){const ft=at.layout.get("text-transform").evaluate(lt,{});return ft==="uppercase"?nt=nt.toLocaleUpperCase():ft==="lowercase"&&(nt=nt.toLocaleLowerCase()),am.applyArabicShaping&&(nt=am.applyArabicShaping(nt)),nt}(et.text,o,g)}),b}const Hv={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function H8(b){return b===""||b===""||b===""||b===""||b===""||b===""||b===""||b===""||b===""||b===""||b===""||b===""||b===""||b===""||b===""||b===""||b===""}function W8(b){return b===""||b===""||b===""||b===""||b===""||b===""||b===""||b===""||b===""||b===""}const mC=4294967296,HS=1/mC,WS=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");let Dw=class{constructor(b=new Uint8Array(16)){this.buf=ArrayBuffer.isView(b)?b:new Uint8Array(b),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(b,o,g=this.length){for(;this.pos<g;){const et=this.readVarint(),nt=et>>3,at=this.pos;this.type=7&et,b(nt,o,this),this.pos===at&&this.skip(et)}return o}readMessage(b,o){return this.readFields(b,o,this.readVarint()+this.pos)}readFixed32(){const b=this.dataView.getUint32(this.pos,!0);return this.pos+=4,b}readSFixed32(){const b=this.dataView.getInt32(this.pos,!0);return this.pos+=4,b}readFixed64(){const b=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*mC;return this.pos+=8,b}readSFixed64(){const b=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*mC;return this.pos+=8,b}readFloat(){const b=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,b}readDouble(){const b=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,b}readVarint(b){const o=this.buf;let g,et;return et=o[this.pos++],g=127&et,et<128?g:(et=o[this.pos++],g|=(127&et)<<7,et<128?g:(et=o[this.pos++],g|=(127&et)<<14,et<128?g:(et=o[this.pos++],g|=(127&et)<<21,et<128?g:(et=o[this.pos],g|=(15&et)<<28,function(nt,at,lt){const ft=lt.buf;let gt,Rt;if(Rt=ft[lt.pos++],gt=(112&Rt)>>4,Rt<128||(Rt=ft[lt.pos++],gt|=(127&Rt)<<3,Rt<128)||(Rt=ft[lt.pos++],gt|=(127&Rt)<<10,Rt<128)||(Rt=ft[lt.pos++],gt|=(127&Rt)<<17,Rt<128)||(Rt=ft[lt.pos++],gt|=(127&Rt)<<24,Rt<128)||(Rt=ft[lt.pos++],gt|=(1&Rt)<<31,Rt<128))return c_(nt,gt,at);throw new Error("Expected varint not more than 10 bytes")}(g,b,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const b=this.readVarint();return b%2==1?(b+1)/-2:b/2}readBoolean(){return!!this.readVarint()}readString(){const b=this.readVarint()+this.pos,o=this.pos;return this.pos=b,b-o>=12&&WS?WS.decode(this.buf.subarray(o,b)):function(g,et,nt){let at="",lt=et;for(;lt<nt;){const ft=g[lt];let gt,Rt,Mt,Lt=null,Ht=ft>239?4:ft>223?3:ft>191?2:1;if(lt+Ht>nt)break;Ht===1?ft<128&&(Lt=ft):Ht===2?(gt=g[lt+1],(192&gt)==128&&(Lt=(31&ft)<<6|63&gt,Lt<=127&&(Lt=null))):Ht===3?(gt=g[lt+1],Rt=g[lt+2],(192&gt)==128&&(192&Rt)==128&&(Lt=(15&ft)<<12|(63&gt)<<6|63&Rt,(Lt<=2047||Lt>=55296&&Lt<=57343)&&(Lt=null))):Ht===4&&(gt=g[lt+1],Rt=g[lt+2],Mt=g[lt+3],(192&gt)==128&&(192&Rt)==128&&(192&Mt)==128&&(Lt=(15&ft)<<18|(63&gt)<<12|(63&Rt)<<6|63&Mt,(Lt<=65535||Lt>=1114112)&&(Lt=null))),Lt===null?(Lt=65533,Ht=1):Lt>65535&&(Lt-=65536,at+=String.fromCharCode(Lt>>>10&1023|55296),Lt=56320|1023&Lt),at+=String.fromCharCode(Lt),lt+=Ht}return at}(this.buf,o,b)}readBytes(){const b=this.readVarint()+this.pos,o=this.buf.subarray(this.pos,b);return this.pos=b,o}readPackedVarint(b=[],o){const g=this.readPackedEnd();for(;this.pos<g;)b.push(this.readVarint(o));return b}readPackedSVarint(b=[]){const o=this.readPackedEnd();for(;this.pos<o;)b.push(this.readSVarint());return b}readPackedBoolean(b=[]){const o=this.readPackedEnd();for(;this.pos<o;)b.push(this.readBoolean());return b}readPackedFloat(b=[]){const o=this.readPackedEnd();for(;this.pos<o;)b.push(this.readFloat());return b}readPackedDouble(b=[]){const o=this.readPackedEnd();for(;this.pos<o;)b.push(this.readDouble());return b}readPackedFixed32(b=[]){const o=this.readPackedEnd();for(;this.pos<o;)b.push(this.readFixed32());return b}readPackedSFixed32(b=[]){const o=this.readPackedEnd();for(;this.pos<o;)b.push(this.readSFixed32());return b}readPackedFixed64(b=[]){const o=this.readPackedEnd();for(;this.pos<o;)b.push(this.readFixed64());return b}readPackedSFixed64(b=[]){const o=this.readPackedEnd();for(;this.pos<o;)b.push(this.readSFixed64());return b}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(b){const o=7&b;if(o===0)for(;this.buf[this.pos++]>127;);else if(o===2)this.pos=this.readVarint()+this.pos;else if(o===5)this.pos+=4;else{if(o!==1)throw new Error(`Unimplemented type: ${o}`);this.pos+=8}}writeTag(b,o){this.writeVarint(b<<3|o)}realloc(b){let o=this.length||16;for(;o<this.pos+b;)o*=2;if(o!==this.length){const g=new Uint8Array(o);g.set(this.buf),this.buf=g,this.dataView=new DataView(g.buffer),this.length=o}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(b){this.realloc(4),this.dataView.setInt32(this.pos,b,!0),this.pos+=4}writeSFixed32(b){this.realloc(4),this.dataView.setInt32(this.pos,b,!0),this.pos+=4}writeFixed64(b){this.realloc(8),this.dataView.setInt32(this.pos,-1&b,!0),this.dataView.setInt32(this.pos+4,Math.floor(b*HS),!0),this.pos+=8}writeSFixed64(b){this.realloc(8),this.dataView.setInt32(this.pos,-1&b,!0),this.dataView.setInt32(this.pos+4,Math.floor(b*HS),!0),this.pos+=8}writeVarint(b){(b=+b||0)>268435455||b<0?function(o,g){let et,nt;if(o>=0?(et=o%4294967296|0,nt=o/4294967296|0):(et=~(-o%4294967296),nt=~(-o/4294967296),4294967295^et?et=et+1|0:(et=0,nt=nt+1|0)),o>=18446744073709552e3||o<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");g.realloc(10),function(at,lt,ft){ft.buf[ft.pos++]=127&at|128,at>>>=7,ft.buf[ft.pos++]=127&at|128,at>>>=7,ft.buf[ft.pos++]=127&at|128,at>>>=7,ft.buf[ft.pos++]=127&at|128,ft.buf[ft.pos]=127&(at>>>=7)}(et,0,g),function(at,lt){const ft=(7&at)<<4;lt.buf[lt.pos++]|=ft|((at>>>=3)?128:0),at&&(lt.buf[lt.pos++]=127&at|((at>>>=7)?128:0),at&&(lt.buf[lt.pos++]=127&at|((at>>>=7)?128:0),at&&(lt.buf[lt.pos++]=127&at|((at>>>=7)?128:0),at&&(lt.buf[lt.pos++]=127&at|((at>>>=7)?128:0),at&&(lt.buf[lt.pos++]=127&at)))))}(nt,g)}(b,this):(this.realloc(4),this.buf[this.pos++]=127&b|(b>127?128:0),b<=127||(this.buf[this.pos++]=127&(b>>>=7)|(b>127?128:0),b<=127||(this.buf[this.pos++]=127&(b>>>=7)|(b>127?128:0),b<=127||(this.buf[this.pos++]=b>>>7&127))))}writeSVarint(b){this.writeVarint(b<0?2*-b-1:2*b)}writeBoolean(b){this.writeVarint(+b)}writeString(b){b=String(b),this.realloc(4*b.length),this.pos++;const o=this.pos;this.pos=function(et,nt,at){for(let lt,ft,gt=0;gt<nt.length;gt++){if(lt=nt.charCodeAt(gt),lt>55295&&lt<57344){if(!ft){lt>56319||gt+1===nt.length?(et[at++]=239,et[at++]=191,et[at++]=189):ft=lt;continue}if(lt<56320){et[at++]=239,et[at++]=191,et[at++]=189,ft=lt;continue}lt=ft-55296<<10|lt-56320|65536,ft=null}else ft&&(et[at++]=239,et[at++]=191,et[at++]=189,ft=null);lt<128?et[at++]=lt:(lt<2048?et[at++]=lt>>6|192:(lt<65536?et[at++]=lt>>12|224:(et[at++]=lt>>18|240,et[at++]=lt>>12&63|128),et[at++]=lt>>6&63|128),et[at++]=63&lt|128)}return at}(this.buf,b,this.pos);const g=this.pos-o;g>=128&&qS(o,g,this),this.pos=o-1,this.writeVarint(g),this.pos+=g}writeFloat(b){this.realloc(4),this.dataView.setFloat32(this.pos,b,!0),this.pos+=4}writeDouble(b){this.realloc(8),this.dataView.setFloat64(this.pos,b,!0),this.pos+=8}writeBytes(b){const o=b.length;this.writeVarint(o),this.realloc(o);for(let g=0;g<o;g++)this.buf[this.pos++]=b[g]}writeRawMessage(b,o){this.pos++;const g=this.pos;b(o,this);const et=this.pos-g;et>=128&&qS(g,et,this),this.pos=g-1,this.writeVarint(et),this.pos+=et}writeMessage(b,o,g){this.writeTag(b,2),this.writeRawMessage(o,g)}writePackedVarint(b,o){o.length&&this.writeMessage(b,q8,o)}writePackedSVarint(b,o){o.length&&this.writeMessage(b,X8,o)}writePackedBoolean(b,o){o.length&&this.writeMessage(b,Y8,o)}writePackedFloat(b,o){o.length&&this.writeMessage(b,K8,o)}writePackedDouble(b,o){o.length&&this.writeMessage(b,Z8,o)}writePackedFixed32(b,o){o.length&&this.writeMessage(b,Q8,o)}writePackedSFixed32(b,o){o.length&&this.writeMessage(b,J8,o)}writePackedFixed64(b,o){o.length&&this.writeMessage(b,eI,o)}writePackedSFixed64(b,o){o.length&&this.writeMessage(b,tI,o)}writeBytesField(b,o){this.writeTag(b,2),this.writeBytes(o)}writeFixed32Field(b,o){this.writeTag(b,5),this.writeFixed32(o)}writeSFixed32Field(b,o){this.writeTag(b,5),this.writeSFixed32(o)}writeFixed64Field(b,o){this.writeTag(b,1),this.writeFixed64(o)}writeSFixed64Field(b,o){this.writeTag(b,1),this.writeSFixed64(o)}writeVarintField(b,o){this.writeTag(b,0),this.writeVarint(o)}writeSVarintField(b,o){this.writeTag(b,0),this.writeSVarint(o)}writeStringField(b,o){this.writeTag(b,2),this.writeString(o)}writeFloatField(b,o){this.writeTag(b,5),this.writeFloat(o)}writeDoubleField(b,o){this.writeTag(b,1),this.writeDouble(o)}writeBooleanField(b,o){this.writeVarintField(b,+o)}};function c_(b,o,g){return g?4294967296*o+(b>>>0):4294967296*(o>>>0)+(b>>>0)}function qS(b,o,g){const et=o<=16383?1:o<=2097151?2:o<=268435455?3:Math.floor(Math.log(o)/(7*Math.LN2));g.realloc(et);for(let nt=g.pos-1;nt>=b;nt--)g.buf[nt+et]=g.buf[nt]}function q8(b,o){for(let g=0;g<b.length;g++)o.writeVarint(b[g])}function X8(b,o){for(let g=0;g<b.length;g++)o.writeSVarint(b[g])}function K8(b,o){for(let g=0;g<b.length;g++)o.writeFloat(b[g])}function Z8(b,o){for(let g=0;g<b.length;g++)o.writeDouble(b[g])}function Y8(b,o){for(let g=0;g<b.length;g++)o.writeBoolean(b[g])}function Q8(b,o){for(let g=0;g<b.length;g++)o.writeFixed32(b[g])}function J8(b,o){for(let g=0;g<b.length;g++)o.writeSFixed32(b[g])}function eI(b,o){for(let g=0;g<b.length;g++)o.writeFixed64(b[g])}function tI(b,o){for(let g=0;g<b.length;g++)o.writeSFixed64(b[g])}const xC=3;function rI(b,o,g){o.glyphs=[],b===1&&g.readMessage(nI,o)}function nI(b,o,g){if(b===3){const{id:et,bitmap:nt,width:at,height:lt,left:ft,top:gt,advance:Rt}=g.readMessage(iI,{});o.glyphs.push({id:et,bitmap:new Jx({width:at+2*xC,height:lt+2*xC},nt),metrics:{width:at,height:lt,left:ft,top:gt,advance:Rt}})}else b===4?o.ascender=g.readSVarint():b===5&&(o.descender=g.readSVarint())}function iI(b,o,g){b===1?o.id=g.readVarint():b===2?o.bitmap=g.readBytes():b===3?o.width=g.readVarint():b===4?o.height=g.readVarint():b===5?o.left=g.readSVarint():b===6?o.top=g.readSVarint():b===7&&(o.advance=g.readVarint())}const XS=xC,d0={horizontal:1,vertical:2,horizontalOnly:3};class Wv{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(o,g){const et=new Wv;return et.scale=o||1,et.fontStack=g,et}static forImage(o){const g=new Wv;return g.image=o,g}}class u_{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(o,g,et){const nt=new u_;for(let at=0;at<o.sections.length;at++){const lt=o.sections[at];lt.image?nt.addImageSection(lt,et):nt.addTextSection(lt,g)}return nt}length(){return this.text.length}getSection(o){return this.sections[this.sectionIndex[o]]}getSections(){return this.sections}getSectionIndex(o){return this.sectionIndex[o]}getCodePoint(o){return this.text.codePointAt(o)}verticalizePunctuation(o){this.text=function(g,et){let nt="";for(let at=0;at<g.length;at++){const lt=g.charCodeAt(at+1)||null,ft=g.charCodeAt(at-1)||null;nt+=!et&&(lt&&Sy(lt)&&!Hv[g[at+1]]||ft&&Sy(ft)&&!Hv[g[at-1]])||!Hv[g[at]]?g[at]:Hv[g[at]]}return nt}(this.text,o)}trim(){let o=0;for(let et=0;et<this.text.length&&Pw[this.text.charCodeAt(et)];et++)o++;let g=this.text.length;for(let et=this.text.length-1;et>=0&&et>=o&&Pw[this.text.charCodeAt(et)];et--)g--;this.text=this.text.substring(o,g),this.sectionIndex=this.sectionIndex.slice(o,g)}substring(o,g){const et=new u_;return et.text=this.text.substring(o,g),et.sectionIndex=this.sectionIndex.slice(o,g),et.sections=this.sections,et}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((o,g)=>Math.max(o,this.sections[g].scale),0)}addTextSection(o,g){this.text+=o.text,this.sections.push(Wv.forText(o.scale,o.fontStack||g));const et=this.sections.length-1;for(let nt=0;nt<o.text.length;++nt)this.sectionIndex.push(et)}addImageSection(o,g){const et=o.image?o.image.getPrimary():null;if(!et)return void bs("Can't add FormattedSection with an empty image.");et.scaleSelf(g);const nt=this.getNextImageSectionCharCode();nt?(this.text+=String.fromCodePoint(nt),this.sections.push(Wv.forImage(et)),this.sectionIndex.push(this.sections.length-1)):bs("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function gC(b,o,g,et,nt,at,lt,ft,gt,Rt,Mt,Lt,Ht,Kt,Qt,sr=1){const hr=u_.fromFeature(b,nt,sr);Lt===d0.vertical&&hr.verticalizePunctuation(Ht);let ur=[];const _r=function(Hr,Zr,en,Tn,ln,Fn){if(!Hr)return[];const Ln=[],jn=function(Wn,kn,In,Kn,as,es){let $s=0;for(let vs=0;vs<Wn.length();vs++){const Is=Wn.getSection(vs);$s+=KS(Wn.getCodePoint(vs),Is,Kn,as,kn,es)}return $s/Math.max(1,Math.ceil($s/In))}(Hr,Zr,en,Tn,ln,Fn),Zn=Hr.text.indexOf("")>=0;let Qn=0;for(let Wn=0;Wn<Hr.length();Wn++){const kn=Hr.getSection(Wn),In=Hr.getCodePoint(Wn);if(Pw[In]||(Qn+=KS(In,kn,Tn,ln,Zr,Fn)),Wn<Hr.length()-1){const Kn=!((Hn=In)<11904||!(eo["Bopomofo Extended"](Hn)||eo.Bopomofo(Hn)||eo["CJK Compatibility Forms"](Hn)||eo["CJK Compatibility Ideographs"](Hn)||eo["CJK Compatibility"](Hn)||eo["CJK Radicals Supplement"](Hn)||eo["CJK Strokes"](Hn)||eo["CJK Symbols and Punctuation"](Hn)||eo["CJK Unified Ideographs Extension A"](Hn)||eo["CJK Unified Ideographs"](Hn)||eo["Enclosed CJK Letters and Months"](Hn)||eo["Halfwidth and Fullwidth Forms"](Hn)||eo.Hiragana(Hn)||eo["Ideographic Description Characters"](Hn)||eo["Kangxi Radicals"](Hn)||eo["Katakana Phonetic Extensions"](Hn)||eo.Katakana(Hn)||eo["Vertical Forms"](Hn)||eo["Yi Radicals"](Hn)||eo["Yi Syllables"](Hn)));(sI[In]||Kn||kn.image)&&Ln.push(YS(Wn+1,Qn,jn,Ln,oI(In,Hr.getCodePoint(Wn+1),Kn&&Zn),!1))}}var Hn;return QS(YS(Hr.length(),Qn,jn,Ln,0,!0))}(hr,Rt,at,o,et,Kt),{processBidirectionalText:br,processStyledBidirectionalText:Ir}=am;if(br&&hr.sections.length===1){const Hr=br(hr.toString(),_r);for(const Zr of Hr){const en=new u_;en.text=Zr,en.sections=hr.sections;for(let Tn=0;Tn<Zr.length;Tn++)en.sectionIndex.push(0);ur.push(en)}}else if(Ir){const Hr=Ir(hr.text,hr.sectionIndex,_r);for(const Zr of Hr){const en=new u_;en.text=Zr[0],en.sectionIndex=Zr[1],en.sections=hr.sections,ur.push(en)}}else ur=function(Hr,Zr){const en=[],Tn=Hr.text;let ln=0;for(const Fn of Zr)en.push(Hr.substring(ln,Fn)),ln=Fn;return ln<Tn.length&&en.push(Hr.substring(ln,Tn.length)),en}(hr,_r);const Vr=[],Mr={positionedLines:Vr,text:hr.toString(),top:Mt[1],bottom:Mt[1],left:Mt[0],right:Mt[0],writingMode:Lt,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(Hr,Zr,en,Tn,ln,Fn,Ln,jn,Zn,Qn,Hn,Wn){let kn=0,In=0,Kn=0;const as=jn==="right"?1:jn==="left"?0:.5;let es=!1;for(const ts of ln){const Os=ts.getSections();for(const fo of Os){if(fo.image)continue;const Ko=Zr[fo.fontStack];if(Ko&&(es=Ko.ascender!==void 0&&Ko.descender!==void 0,!es))break}if(!es)break}let $s=0;for(const ts of ln){ts.trim();const Os=ts.getMaxScale(),fo=(Os-1)*up,Ko={positionedGlyphs:[],lineOffset:0};Hr.positionedLines[$s]=Ko;const xa=Ko.positionedGlyphs;let wo=0;if(!ts.length()){In+=Fn,++$s;continue}let $l=0,Nr=0;for(let Bn=0;Bn<ts.length();Bn++){const Yn=ts.getSection(Bn),xs=ts.getSectionIndex(Bn),gs=ts.getCodePoint(Bn);let Ws=Yn.scale,Zs=null,vo=null,Ro=null,ko=up,$o=0,io=Zn;io===d0.vertical&&((vs=gs)===12312||vs===12313||vs===12316||vs===12540||vs===12448)&&(io=d0.horizontal);const ho=!(io===d0.horizontal||!Hn&&!Ay(gs)||Hn&&(Pw[gs]||Ty(gs)));if(Yn.image){const xl=Tn.get(Yn.image.toString());if(!xl)continue;Ro=Yn.image,Hr.iconsInText=Hr.iconsInText||!0,vo=xl.paddedRect;const wl=xl.displaySize;Ws=Ws*up/Wn,Zs={width:wl[0],height:wl[1],left:0,top:-XS,advance:ho?wl[1]:wl[0],localGlyph:!1},$o=es?-Zs.height*Ws:Os*up-17-wl[1]*Ws,ko=Zs.advance;const Cl=(ho?wl[0]:wl[1])*Ws-up*Os;Cl>0&&Cl>wo&&(wo=Cl)}else{const xl=en[Yn.fontStack];if(!xl)continue;xl[gs]&&(vo=xl[gs]);const wl=Zr[Yn.fontStack];if(!wl)continue;const Cl=wl.glyphs[gs];if(!Cl)continue;if(Zs=Cl.metrics,ko=gs!==8203?up:0,es){const Nl=wl.ascender!==void 0?Math.abs(wl.ascender):0,Ql=wl.descender!==void 0?Math.abs(wl.descender):0,Hl=(Nl+Ql)*Ws;$l<Hl&&($l=Hl,Nr=(Nl-Ql)/2*Ws),$o=-Nl*Ws}else $o=(Os-Ws)*up-17}ho?(Hr.verticalizable=!0,xa.push({glyph:gs,image:Ro,x:kn,y:In+$o,vertical:ho,scale:Ws,localGlyph:Zs.localGlyph,fontStack:Yn.fontStack,sectionIndex:xs,metrics:Zs,rect:vo}),kn+=ko*Ws+Qn):(xa.push({glyph:gs,image:Ro,x:kn,y:In+$o,vertical:ho,scale:Ws,localGlyph:Zs.localGlyph,fontStack:Yn.fontStack,sectionIndex:xs,metrics:Zs,rect:vo}),kn+=Zs.advance*Ws+Qn)}xa.length!==0&&(Kn=Math.max(kn-Qn,Kn),es?JS(xa,as,wo,Nr,Fn*Os/2):JS(xa,as,wo,0,Fn/2)),kn=0;const Ur=Fn*Os+wo;Ko.lineOffset=Math.max(wo,fo),In+=Ur,++$s}var vs;const Is=In,{horizontalAlign:Ns,verticalAlign:Fo}=yC(Ln);(function(ts,Os,fo,Ko,xa,wo){const $l=(Os-fo)*xa,Nr=-wo*Ko;for(const Ur of ts)for(const Bn of Ur.positionedGlyphs)Bn.x+=$l,Bn.y+=Nr})(Hr.positionedLines,as,Ns,Fo,Kn,Is),Hr.top+=-Fo*Is,Hr.bottom=Hr.top+Is,Hr.left+=-Ns*Kn,Hr.right=Hr.left+Kn,Hr.hasBaseline=es}(Mr,o,g,et,ur,lt,ft,gt,Lt,Rt,Ht,Qt),!function(Hr){for(const Zr of Hr)if(Zr.positionedGlyphs.length!==0)return!1;return!0}(Vr))return Mr}const Pw={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},sI={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function KS(b,o,g,et,nt,at){if(o.image){const lt=et.get(o.image.toString());return lt?lt.displaySize[0]*o.scale*up/at+nt:0}{const lt=g[o.fontStack],ft=lt&&lt.glyphs[b];return ft?ft.metrics.advance*o.scale+nt:0}}function ZS(b,o,g,et){const nt=Math.pow(b-o,2);return et?b<o?nt/2:2*nt:nt+Math.abs(g)*g}function oI(b,o,g){let et=0;return b===10&&(et-=1e4),g&&(et+=150),b!==40&&b!==65288||(et+=50),o!==41&&o!==65289||(et+=50),et}function YS(b,o,g,et,nt,at){let lt=null,ft=ZS(o,g,nt,at);for(const gt of et){const Rt=ZS(o-gt.x,g,nt,at)+gt.badness;Rt<=ft&&(lt=gt,ft=Rt)}return{index:b,x:o,priorBreak:lt,badness:ft}}function QS(b){return b?QS(b.priorBreak).concat(b.index):[]}function yC(b){let o=.5,g=.5;switch(b){case"right":case"top-right":case"bottom-right":o=1;break;case"left":case"top-left":case"bottom-left":o=0}switch(b){case"bottom":case"bottom-right":case"bottom-left":g=1;break;case"top":case"top-right":case"top-left":g=0}return{horizontalAlign:o,verticalAlign:g}}function JS(b,o,g,et,nt){if(!(o||g||et||nt))return;const at=b.length-1,lt=b[at],ft=(lt.x+lt.metrics.advance*lt.scale)*o;for(let gt=0;gt<=at;gt++)b[gt].x-=ft,b[gt].y+=g+et+nt}function _C(b){return b.imagePrimary!==void 0&&b.top!==void 0&&b.bottom!==void 0&&b.left!==void 0&&b.right!==void 0}function kw(b,o,g,et){const{horizontalAlign:nt,verticalAlign:at}=yC(et),lt=g[0]-b.displaySize[0]*nt,ft=g[1]-b.displaySize[1]*at;return{imagePrimary:b,imageSecondary:o,top:ft,bottom:ft+b.displaySize[1],left:lt,right:lt+b.displaySize[0]}}function vC(b,o,g,et,nt,at){const lt=b.imagePrimary;let ft;if(lt.content){const hr=lt.content,ur=lt.pixelRatio||1;ft=[hr[0]/ur,hr[1]/ur,lt.displaySize[0]-hr[2]/ur,lt.displaySize[1]-hr[3]/ur]}const gt=o.left*at,Rt=o.right*at;let Mt,Lt,Ht,Kt;g==="width"||g==="both"?(Kt=nt[0]+gt-et[3],Lt=nt[0]+Rt+et[1]):(Kt=nt[0]+(gt+Rt-lt.displaySize[0])/2,Lt=Kt+lt.displaySize[0]);const Qt=o.top*at,sr=o.bottom*at;return g==="height"||g==="both"?(Mt=nt[1]+Qt-et[0],Ht=nt[1]+sr+et[2]):(Mt=nt[1]+(Qt+sr-lt.displaySize[1])/2,Ht=Mt+lt.displaySize[1]),{imagePrimary:lt,imageSecondary:void 0,top:Mt,right:Lt,bottom:Ht,left:Kt,collisionPadding:ft}}function eT(b){return!b.imagePrimary.stretchX}function tT(b){return!b.imagePrimary.stretchY}function rT(b){return{width:b.right-b.left,height:b.bottom-b.top}}const gm=128;function d_(b,o,g){const{expression:et}=o;if(et.kind==="constant")return{kind:"constant",layoutSize:et.evaluate(new ou(b+1,{worldview:g}))};if(et.kind==="source")return{kind:"source"};{const{zoomStops:nt,interpolationType:at}=et;let lt=0;for(;lt<nt.length&&nt[lt]<=b;)lt++;lt=Math.max(0,lt-1);let ft=lt;for(;ft<nt.length&&nt[ft]<b+1;)ft++;ft=Math.min(nt.length-1,ft);const gt=nt[lt],Rt=nt[ft];return et.kind==="composite"?{kind:"composite",minZoom:gt,maxZoom:Rt,interpolationType:at}:{kind:"camera",minZoom:gt,maxZoom:Rt,minSize:et.evaluate(new ou(gt,{worldview:g})),maxSize:et.evaluate(new ou(Rt,{worldview:g})),interpolationType:at}}}function EC(b,{uSize:o,uSizeT:g},{lowerSize:et,upperSize:nt}){return b.kind==="source"?et/gm:b.kind==="composite"?so(et/gm,nt/gm,g):o}function h_(b,o,g=1){let et=0,nt=0;if(b.kind==="constant")nt=b.layoutSize*g;else if(b.kind!=="source"){const{interpolationType:at,minZoom:lt,maxZoom:ft}=b,gt=at?pr(o0.interpolationFactor(at,o,lt,ft),0,1):0;b.kind==="camera"?nt=so(b.minSize,b.maxSize,gt)*g:et=gt*g}return{uSizeT:et,uSize:nt}}class yx extends zn{constructor(o,g,et,nt,at){super(o,g),this.angle=nt,this.z=et,at!==void 0&&(this.segment=at)}clone(){return new yx(this.x,this.y,this.z,this.angle,this.segment)}}function nT(b,o,g,et,nt){if(o.segment===void 0)return!0;let at=o,lt=o.segment+1,ft=0;for(;ft>-g/2;){if(lt--,lt<0)return!1;ft-=b[lt].dist(at),at=b[lt]}ft+=b[lt].dist(b[lt+1]),lt++;const gt=[];let Rt=0;for(;ft<g/2;){const Mt=b[lt],Lt=b[lt+1];if(!Lt)return!1;let Ht=b[lt-1].angleTo(Mt)-Mt.angleTo(Lt);for(Ht=Math.abs((Ht+3*Math.PI)%(2*Math.PI)-Math.PI),gt.push({distance:ft,angleDelta:Ht}),Rt+=Ht;ft-gt[0].distance>et;)Rt-=gt.shift().angleDelta;if(Rt>nt)return!1;lt++,ft+=Mt.dist(Lt)}return!0}function iT(b){let o=0;for(let g=0;g<b.length-1;g++)o+=b[g].dist(b[g+1]);return o}function sT(b,o,g){return b?.6*o*g:0}function oT(b,o){return Math.max(b?b.right-b.left:0,o?o.right-o.left:0)}function aI(b,o,g,et,nt,at){const lt=sT(g,nt,at),ft=oT(g,et)*at;let gt=0;const Rt=iT(b)/2;for(let Mt=0;Mt<b.length-1;Mt++){const Lt=b[Mt],Ht=b[Mt+1],Kt=Lt.dist(Ht);if(gt+Kt>Rt){const Qt=(Rt-gt)/Kt,sr=so(Lt.x,Ht.x,Qt),hr=so(Lt.y,Ht.y,Qt),ur=new yx(sr,hr,0,Ht.angleTo(Lt),Mt);return!lt||nT(b,ur,ft,lt,o)?ur:void 0}gt+=Kt}}function lI(b,o,g,et,nt,at,lt,ft,gt){const Rt=sT(et,at,lt),Mt=oT(et,nt),Lt=Mt*lt,Ht=b[0].x===0||b[0].x===gt||b[0].y===0||b[0].y===gt;return o-Lt<o/4&&(o=Lt+o/4),aT(b,Ht?o/2*ft%o:(Mt/2+2*at)*lt*ft%o,o,Rt,g,Lt,Ht,!1,gt)}function aT(b,o,g,et,nt,at,lt,ft,gt){const Rt=at/2,Mt=iT(b);let Lt=0,Ht=o-g,Kt=[];for(let Qt=0;Qt<b.length-1;Qt++){const sr=b[Qt],hr=b[Qt+1],ur=sr.dist(hr),_r=hr.angleTo(sr);for(;Ht+g<Lt+ur;){Ht+=g;const br=(Ht-Lt)/ur,Ir=so(sr.x,hr.x,br),Vr=so(sr.y,hr.y,br);if(Ir>=0&&Ir<gt&&Vr>=0&&Vr<gt&&Ht-Rt>=0&&Ht+Rt<=Mt){const Mr=new yx(Ir,Vr,0,_r,Qt);et&&!nT(b,Mr,at,et,nt)||Kt.push(Mr)}}Lt+=ur}return ft||Kt.length||lt||(Kt=aT(b,Lt/2,g,et,nt,at,lt,!0,gt)),Kt}function lT(b){let o=0,g=0;for(const lt of b)o+=lt.w*lt.h,g=Math.max(g,lt.w);b.sort((lt,ft)=>ft.h-lt.h);const et=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(o/.95)),g),h:1/0}];let nt=0,at=0;for(const lt of b)for(let ft=et.length-1;ft>=0;ft--){const gt=et[ft];if(!(lt.w>gt.w||lt.h>gt.h)){if(lt.x=gt.x,lt.y=gt.y,at=Math.max(at,lt.y+lt.h),nt=Math.max(nt,lt.x+lt.w),lt.w===gt.w&&lt.h===gt.h){const Rt=et.pop();Rt&&ft<et.length&&(et[ft]=Rt)}else lt.h===gt.h?(gt.x+=lt.w,gt.w-=lt.w):lt.w===gt.w?(gt.y+=lt.h,gt.h-=lt.h):(et.push({x:gt.x+lt.w,y:gt.y,w:gt.w-lt.w,h:lt.h}),gt.y+=lt.h,gt.h-=lt.h);break}}return{w:nt,h:at,fill:o/(nt*at)||0}}Ps(yx,"Anchor");const V1=1;class qv{static getImagePositionScale(o,g,et){if(g&&o){const{sx:nt,sy:at}=o;return{x:nt,y:at}}return{x:et,y:et}}constructor(o,g,et,nt){this.paddedRect=o;const{pixelRatio:at,version:lt,stretchX:ft,stretchY:gt,content:Rt,sdf:Mt,usvg:Lt}=g;this.pixelRatio=at,this.stretchX=ft,this.stretchY=gt,this.content=Rt,this.version=lt,this.padding=et,this.sdf=Mt,this.usvg=Lt,this.scale=qv.getImagePositionScale(nt,Lt,at)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function bC(b,o,g){const et=zp.parse(b),nt=function(at,lt,ft=[1,1]){return{x:0,y:0,w:(at.data?at.data.width:at.width*ft[0])+2*lt,h:(at.data?at.data.height:at.height*ft[1])+2*lt}}(o,g,[et.sx,et.sy]);return{bin:nt,imagePosition:new qv(nt,o,g,et),imageVariant:et}}class cT{constructor(o,g,et){const nt=new Map,at=new Map;this.haveRenderCallbacks=[];const lt=[];this.addImages(o,nt,V1,lt),this.addImages(g,at,2,lt);const{w:ft,h:gt}=lT(lt),Rt=new Rp({width:ft||1,height:gt||1});for(const[Mt,Lt]of o.entries()){const Ht=nt.get(Mt).paddedRect;Rp.copy(Lt.data,Rt,{x:0,y:0},{x:Ht.x+V1,y:Ht.y+V1},Lt.data,null,Lt.sdf)}for(const[Mt,Lt]of g.entries()){const Ht=at.get(Mt),Kt=Ht.paddedRect;let Qt=Ht.padding;const sr=Kt.x+Qt,hr=Kt.y+Qt,ur=Lt.data.width,_r=Lt.data.height;Qt=Qt>1?Qt-1:Qt,Rp.copy(Lt.data,Rt,{x:0,y:0},{x:sr,y:hr},Lt.data,et),Rp.copy(Lt.data,Rt,{x:0,y:_r-Qt},{x:sr,y:hr-Qt},{width:ur,height:Qt},et),Rp.copy(Lt.data,Rt,{x:0,y:0},{x:sr,y:hr+_r},{width:ur,height:Qt},et),Rp.copy(Lt.data,Rt,{x:ur-Qt,y:0},{x:sr-Qt,y:hr},{width:Qt,height:_r},et),Rp.copy(Lt.data,Rt,{x:0,y:0},{x:sr+ur,y:hr},{width:Qt,height:_r},et),Rp.copy(Lt.data,Rt,{x:ur-Qt,y:_r-Qt},{x:sr-Qt,y:hr-Qt},{width:Qt,height:Qt},et),Rp.copy(Lt.data,Rt,{x:0,y:_r-Qt},{x:sr+ur,y:hr-Qt},{width:Qt,height:Qt},et),Rp.copy(Lt.data,Rt,{x:0,y:0},{x:sr+ur,y:hr+_r},{width:Qt,height:Qt},et),Rp.copy(Lt.data,Rt,{x:ur-Qt,y:0},{x:sr-Qt,y:hr+_r},{width:Qt,height:Qt},et)}this.lut=et,this.image=Rt,this.iconPositions=nt,this.patternPositions=at}addImages(o,g,et,nt){for(const[at,lt]of o.entries()){const{bin:ft,imagePosition:gt,imageVariant:Rt}=bC(at,lt,et);g.set(at,gt),nt.push(ft),lt.hasRenderCallback&&this.haveRenderCallbacks.push(Rt.id)}}patchUpdatedImages(o,g,et){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(nt=>o.hasImage(nt,et)),o.dispatchRenderCallbacks(this.haveRenderCallbacks,et);for(const nt of o.getUpdatedImages(et)){for(const at of this.iconPositions.keys()){const lt=zp.parse(at);if(Qu.isEqual(lt.id,nt)){const ft=o.getImage(nt,et);this.patchUpdatedImage(this.iconPositions.get(at),ft,g,null)}}for(const at of this.patternPositions.keys()){const lt=zp.parse(at);if(Qu.isEqual(lt.id,nt)){const ft=o.getImage(nt,et);this.patchUpdatedImage(this.patternPositions.get(at),ft,g,this.lut)}}}}patchUpdatedImage(o,g,et,nt=null){if(!o||!g||o.version===g.version)return;o.version=g.version;const[at,lt]=o.tl,ft=o.sdf;if(this.lut||ft){const gt={width:g.data.width,height:g.data.height},Rt=new Rp(gt);Rp.copy(g.data,Rt,{x:0,y:0},{x:0,y:0},gt,nt,ft),et.update(Rt,{position:{x:at,y:lt}})}else et.update(g.data,{position:{x:at,y:lt}})}}Ps(qv,"ImagePosition"),Ps(cT,"ImageAtlas");const Xv=1e20;function uT(b,o,g,et,nt,at,lt,ft,gt){for(let Rt=o;Rt<o+et;Rt++)dT(b,g*at+Rt,at,nt,lt,ft,gt);for(let Rt=g;Rt<g+nt;Rt++)dT(b,Rt*at+o,1,et,lt,ft,gt)}function dT(b,o,g,et,nt,at,lt){at[0]=0,lt[0]=-Xv,lt[1]=Xv,nt[0]=b[o];for(let ft=1,gt=0,Rt=0;ft<et;ft++){nt[ft]=b[o+ft*g];const Mt=ft*ft;do{const Lt=at[gt];Rt=(nt[ft]-nt[Lt]+Mt-Lt*Lt)/(ft-Lt)/2}while(Rt<=lt[gt]&&--gt>-1);gt++,at[gt]=ft,lt[gt]=Rt,lt[gt+1]=Xv}for(let ft=0,gt=0;ft<et;ft++){for(;lt[gt+1]<ft;)gt++;const Rt=at[gt],Mt=ft-Rt;b[o+ft*g]=nt[Rt]+Mt*Mt}}const ym=2,wC={none:0,ideographs:1,all:2};class f_{constructor(o,g,et){this.requestManager=o,this.localGlyphMode=g,this.localFontFamily=et,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(o){this.url=o}getGlyphs(o,g){const et=[],nt=this.url||Do.GLYPHS_URL;for(const at in o)for(const lt of o[at])et.push({stack:at,id:lt});Yr(et,({stack:at,id:lt},ft)=>{let gt=this.entries[at];gt||(gt=this.entries[at]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let Rt=gt.glyphs[lt];if(Rt!==void 0)return void ft(null,{stack:at,id:lt,glyph:Rt});if(Rt=this._tinySDF(gt,at,lt),Rt)return gt.glyphs[lt]=Rt,void ft(null,{stack:at,id:lt,glyph:Rt});const Mt=Math.floor(lt/256);if(256*Mt>65535)return bs("glyphs > 65535 not supported"),void ft(null,{stack:at,id:lt,glyph:Rt});if(gt.ranges[Mt])return void ft(null,{stack:at,id:lt,glyph:Rt});let Lt=gt.requests[Mt];Lt||(Lt=gt.requests[Mt]=[],f_.loadGlyphRange(at,Mt,nt,this.requestManager,(Ht,Kt)=>{if(Kt){gt.ascender=Kt.ascender,gt.descender=Kt.descender;for(const Qt in Kt.glyphs)this._doesCharSupportLocalGlyph(+Qt)||(gt.glyphs[+Qt]=Kt.glyphs[+Qt]);gt.ranges[Mt]=!0}for(const Qt of Lt)Qt(Ht,Kt);delete gt.requests[Mt]})),Lt.push((Ht,Kt)=>{Ht?ft(Ht):Kt&&ft(null,{stack:at,id:lt,glyph:Kt.glyphs[lt]||null})})},(at,lt)=>{if(at)g(at);else if(lt){const ft={};for(const{stack:gt,id:Rt,glyph:Mt}of lt)ft[gt]===void 0&&(ft[gt]={}),ft[gt].glyphs===void 0&&(ft[gt].glyphs={}),ft[gt].glyphs[Rt]=Mt&&{id:Mt.id,bitmap:Mt.bitmap.clone(),metrics:Mt.metrics},ft[gt].ascender=this.entries[gt].ascender,ft[gt].descender=this.entries[gt].descender;g(null,ft)}})}_doesCharSupportLocalGlyph(o){return this.localGlyphMode!==wC.none&&(this.localGlyphMode===wC.all?!!this.localFontFamily:!!this.localFontFamily&&(eo["CJK Unified Ideographs"](o)||eo["Hangul Syllables"](o)||eo.Hiragana(o)||eo.Katakana(o)||eo["CJK Symbols and Punctuation"](o)||eo["CJK Unified Ideographs Extension A"](o)||eo["CJK Unified Ideographs Extension B"](o)||eo.Osage(o)))}_tinySDF(o,g,et){const nt=this.localFontFamily;if(!nt||!this._doesCharSupportLocalGlyph(et))return;let at=o.tinySDF;if(!at){let sr="400";/bold/i.test(g)?sr="900":/medium/i.test(g)?sr="500":/light/i.test(g)&&(sr="200"),at=o.tinySDF=new f_.TinySDF({fontFamily:nt,fontWeight:sr,fontSize:24*ym,buffer:3*ym,radius:8*ym}),at.fontWeight=sr}if(this.localGlyphs[at.fontWeight][et])return this.localGlyphs[at.fontWeight][et];const lt=String.fromCodePoint(et),{data:ft,width:gt,height:Rt,glyphWidth:Mt,glyphHeight:Lt,glyphLeft:Ht,glyphTop:Kt,glyphAdvance:Qt}=at.draw(lt);return this.localGlyphs[at.fontWeight][et]={id:et,bitmap:new Jx({width:gt,height:Rt},ft),metrics:{width:Mt/ym,height:Lt/ym,left:Ht/ym,top:Kt/ym-27,advance:Qt/ym,localGlyph:!0}}}}f_.loadGlyphRange=function(b,o,g,et,nt){const at=256*o,lt=at+255,ft=et.transformRequest(et.normalizeGlyphsURL(g).replace("{fontstack}",b).replace("{range}",`${at}-${lt}`),Bl.Glyphs);p0(ft,(gt,Rt)=>{if(gt)nt(gt);else if(Rt){const Mt={},Lt=function(Ht){return new Dw(Ht).readFields(rI,{})}(Rt);for(const Ht of Lt.glyphs)Mt[Ht.id]=Ht;nt(null,{glyphs:Mt,ascender:Lt.ascender,descender:Lt.descender})}})},f_.TinySDF=class{constructor({fontSize:b=24,buffer:o=3,radius:g=8,cutoff:et=.25,fontFamily:nt="sans-serif",fontWeight:at="normal",fontStyle:lt="normal",lang:ft=null}={}){this.buffer=o,this.cutoff=et,this.radius=g,this.lang=ft;const gt=this.size=b+4*o,Rt=this._createCanvas(gt),Mt=this.ctx=Rt.getContext("2d",{willReadFrequently:!0});Mt.font=`${lt} ${at} ${b}px ${nt}`,Mt.textBaseline="alphabetic",Mt.textAlign="left",Mt.fillStyle="black",this.gridOuter=new Float64Array(gt*gt),this.gridInner=new Float64Array(gt*gt),this.f=new Float64Array(gt),this.z=new Float64Array(gt+1),this.v=new Uint16Array(gt)}_createCanvas(b){const o=document.createElement("canvas");return o.width=o.height=b,o}draw(b){const{width:o,actualBoundingBoxAscent:g,actualBoundingBoxDescent:et,actualBoundingBoxLeft:nt,actualBoundingBoxRight:at}=this.ctx.measureText(b),lt=Math.ceil(g),ft=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(at-nt))),gt=Math.min(this.size-this.buffer,lt+Math.ceil(et)),Rt=ft+2*this.buffer,Mt=gt+2*this.buffer,Lt=Math.max(Rt*Mt,0),Ht=new Uint8ClampedArray(Lt),Kt={data:Ht,width:Rt,height:Mt,glyphWidth:ft,glyphHeight:gt,glyphTop:lt,glyphLeft:0,glyphAdvance:o};if(ft===0||gt===0)return Kt;const{ctx:Qt,buffer:sr,gridInner:hr,gridOuter:ur}=this;this.lang&&(Qt.lang=this.lang),Qt.clearRect(sr,sr,ft,gt),Qt.fillText(b,sr,sr+lt);const _r=Qt.getImageData(sr,sr,ft,gt);ur.fill(Xv,0,Lt),hr.fill(0,0,Lt);for(let br=0;br<gt;br++)for(let Ir=0;Ir<ft;Ir++){const Vr=_r.data[4*(br*ft+Ir)+3]/255;if(Vr===0)continue;const Mr=(br+sr)*Rt+Ir+sr;if(Vr===1)ur[Mr]=0,hr[Mr]=Xv;else{const Hr=.5-Vr;ur[Mr]=Hr>0?Hr*Hr:0,hr[Mr]=Hr<0?Hr*Hr:0}}uT(ur,0,0,Rt,Mt,Rt,this.f,this.v,this.z),uT(hr,sr,sr,ft,gt,Rt,this.f,this.v,this.z);for(let br=0;br<Lt;br++){const Ir=Math.sqrt(ur[br])-Math.sqrt(hr[br]);Ht[br]=Math.round(255-255*(Ir/this.radius+this.cutoff))}return Kt}};const Hm=V1;function hT(b,o){return b+o[1]-o[0]}function CC(b,o,g,et,nt=1){const at=[],lt=b.imagePrimary,ft=lt.pixelRatio,gt=lt.paddedRect.w-2*Hm,Rt=lt.paddedRect.h-2*Hm,Mt=(b.right-b.left)*nt,Lt=(b.bottom-b.top)*nt,Ht=lt.stretchX||[[0,gt]],Kt=lt.stretchY||[[0,Rt]],Qt=Ht.reduce(hT,0),sr=Kt.reduce(hT,0),hr=gt-Qt,ur=Rt-sr;let _r=0,br=Qt,Ir=0,Vr=sr,Mr=0,Hr=hr,Zr=0,en=ur;if(lt.content&&et){const ln=lt.content;_r=Fw(Ht,0,ln[0]),Ir=Fw(Kt,0,ln[1]),br=Fw(Ht,ln[0],ln[2]),Vr=Fw(Kt,ln[1],ln[3]),Mr=ln[0]-_r,Zr=ln[1]-Ir,Hr=ln[2]-ln[0]-br,en=ln[3]-ln[1]-Vr}const Tn=(ln,Fn,Ln,jn)=>{const Zn=Bw(ln.stretch-_r,br,Mt,b.left*nt),Qn=Mw(ln.fixed-Mr,Hr,ln.stretch,Qt),Hn=Bw(Fn.stretch-Ir,Vr,Lt,b.top*nt),Wn=Mw(Fn.fixed-Zr,en,Fn.stretch,sr),kn=Bw(Ln.stretch-_r,br,Mt,b.left*nt),In=Mw(Ln.fixed-Mr,Hr,Ln.stretch,Qt),Kn=Bw(jn.stretch-Ir,Vr,Lt,b.top*nt),as=Mw(jn.fixed-Zr,en,jn.stretch,sr),es=new zn(Zn,Hn),$s=new zn(kn,Hn),vs=new zn(kn,Kn),Is=new zn(Zn,Kn),Ns=new zn(Qn/ft,Wn/ft),Fo=new zn(In/ft,as/ft),ts=o*Math.PI/180;if(ts){const $l=Math.sin(ts),Nr=Math.cos(ts),Ur=[Nr,-$l,$l,Nr];es._matMult(Ur),$s._matMult(Ur),Is._matMult(Ur),vs._matMult(Ur)}const Os=ln.stretch+ln.fixed,fo=Ln.stretch+Ln.fixed,Ko=Fn.stretch+Fn.fixed,xa=jn.stretch+jn.fixed,wo=b.imageSecondary;return{tl:es,tr:$s,bl:Is,br:vs,texPrimary:{x:lt.paddedRect.x+Hm+Os,y:lt.paddedRect.y+Hm+Ko,w:fo-Os,h:xa-Ko},texSecondary:wo?{x:wo.paddedRect.x+Hm+Os,y:wo.paddedRect.y+Hm+Ko,w:fo-Os,h:xa-Ko}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ns,pixelOffsetBR:Fo,minFontScaleX:Hr/ft/Mt,minFontScaleY:en/ft/Lt,isSDF:g}};if(et&&(lt.stretchX||lt.stretchY)){const ln=fT(Ht,hr,Qt),Fn=fT(Kt,ur,sr);for(let Ln=0;Ln<ln.length-1;Ln++){const jn=ln[Ln],Zn=ln[Ln+1];for(let Qn=0;Qn<Fn.length-1;Qn++)at.push(Tn(jn,Fn[Qn],Zn,Fn[Qn+1]))}}else at.push(Tn({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:gt+1},{fixed:0,stretch:Rt+1}));return at}function cI(b,o){const g=b.stretchY||[[0,b.paddedRect.h-2*Hm]];return o&&(b.stretchX||b.stretchY)?pT(b.stretchX||[[0,b.paddedRect.w-2*Hm]])*pT(g):1}function Fw(b,o,g){let et=0;for(const nt of b)et+=Math.max(o,Math.min(g,nt[1]))-Math.max(o,Math.min(g,nt[0]));return et}function fT(b,o,g){const et=[{fixed:-Hm,stretch:0}];for(const[nt,at]of b){const lt=et[et.length-1];et.push({fixed:nt-lt.stretch,stretch:lt.stretch}),et.push({fixed:nt-lt.stretch,stretch:lt.stretch+(at-nt)})}return et.push({fixed:o+Hm,stretch:g}),et}function pT(b){return 2*b.length+1}function Bw(b,o,g,et){return b/o*g+et}function Mw(b,o,g,et){return b-o*g/et}function uI(b,o,g,et){const nt=o+b.positionedLines[et].lineOffset;return et===0?g+nt/2:g+(nt+(o+b.positionedLines[et-1].lineOffset))/2}function dI(b,o=1,g=!1){let et=1/0,nt=1/0,at=-1/0,lt=-1/0;const ft=b[0];for(let Kt=0;Kt<ft.length;Kt++){const Qt=ft[Kt];(!Kt||Qt.x<et)&&(et=Qt.x),(!Kt||Qt.y<nt)&&(nt=Qt.y),(!Kt||Qt.x>at)&&(at=Qt.x),(!Kt||Qt.y>lt)&&(lt=Qt.y)}const gt=Math.min(at-et,lt-nt);let Rt=gt/2;const Mt=new ny([],hI);if(gt===0)return new zn(et,nt);for(let Kt=et;Kt<at;Kt+=gt)for(let Qt=nt;Qt<lt;Qt+=gt)Mt.push(new p_(Kt+Rt,Qt+Rt,Rt,b));let Lt=function(Kt){let Qt=0,sr=0,hr=0;const ur=Kt[0];for(let _r=0,br=ur.length,Ir=br-1;_r<br;Ir=_r++){const Vr=ur[_r],Mr=ur[Ir],Hr=Vr.x*Mr.y-Mr.x*Vr.y;sr+=(Vr.x+Mr.x)*Hr,hr+=(Vr.y+Mr.y)*Hr,Qt+=3*Hr}return new p_(sr/Qt,hr/Qt,0,Kt)}(b),Ht=Mt.length;for(;Mt.length;){const Kt=Mt.pop();(Kt.d>Lt.d||!Lt.d)&&(Lt=Kt,g&&console.log("found best %d after %d probes",Math.round(1e4*Kt.d)/1e4,Ht)),Kt.max-Lt.d<=o||(Rt=Kt.h/2,Mt.push(new p_(Kt.p.x-Rt,Kt.p.y-Rt,Rt,b)),Mt.push(new p_(Kt.p.x+Rt,Kt.p.y-Rt,Rt,b)),Mt.push(new p_(Kt.p.x-Rt,Kt.p.y+Rt,Rt,b)),Mt.push(new p_(Kt.p.x+Rt,Kt.p.y+Rt,Rt,b)),Ht+=4)}return g&&(console.log(`num probes: ${Ht}`),console.log(`best distance: ${Lt.d}`)),Lt.p}function hI(b,o){return o.max-b.max}class p_{constructor(o,g,et,nt){this.p=new zn(o,g),this.h=et,this.d=function(at,lt){let ft=!1,gt=1/0;for(let Rt=0;Rt<lt.length;Rt++){const Mt=lt[Rt];for(let Lt=0,Ht=Mt.length,Kt=Ht-1;Lt<Ht;Kt=Lt++){const Qt=Mt[Lt],sr=Mt[Kt];Qt.y>at.y!=sr.y>at.y&&at.x<(sr.x-Qt.x)*(at.y-Qt.y)/(sr.y-Qt.y)+Qt.x&&(ft=!ft),gt=Math.min(gt,Lu(at,Qt,sr))}}return(ft?1:-1)*Math.sqrt(gt)}(this.p,nt),this.max=this.d+this.h*Math.SQRT2}}const fI=Object.keys,AC=Number.POSITIVE_INFINITY,pI=Math.sqrt(2);function e1(b,o,g,et,nt){const at=_C(b)&&b.collisionPadding?b.collisionPadding:[0,0,0,0],lt={top:b.top-at[1],bottom:b.bottom+at[3],left:b.left-at[0],right:b.right+at[2],scaled:!1};return et!==void 0&&function(ft,gt){ft.top*=gt,ft.bottom*=gt,ft.left*=gt,ft.right*=gt,ft.scaled=!0}(lt,et),g&&function(ft,gt){if(!gt)return;const Rt=Bo(gt),Mt=new zn(ft.left,ft.top),Lt=new zn(ft.right,ft.top),Ht=new zn(ft.left,ft.bottom),Kt=new zn(ft.right,ft.bottom),Qt=new zn(0,0);Mt._rotateAround(Rt,Qt),Lt._rotateAround(Rt,Qt),Ht._rotateAround(Rt,Qt),Kt._rotateAround(Rt,Qt),ft.left=Math.min(Mt.x,Lt.x,Ht.x,Kt.x),ft.right=Math.max(Mt.x,Lt.x,Ht.x,Kt.x),ft.top=Math.min(Mt.y,Lt.y,Ht.y,Kt.y),ft.bottom=Math.max(Mt.y,Lt.y,Ht.y,Kt.y)}(lt,g),nt&&(lt.left+=nt[0],lt.right+=nt[0],lt.top+=nt[1],lt.bottom+=nt[1]),o?{top:Math.min(o.top,lt.top),bottom:Math.max(o.bottom,lt.bottom),left:Math.min(o.left,lt.left),right:Math.max(o.right,lt.right),scaled:o.scaled||lt.scaled}:lt}function mT(b,[o,g]){let et=0,nt=0;if(g===AC){o<0&&(o=0);const at=o/pI;switch(b){case"top-right":case"top-left":nt=at-7;break;case"bottom-right":case"bottom-left":nt=7-at;break;case"bottom":nt=7-o;break;case"top":nt=o-7}switch(b){case"top-right":case"bottom-right":et=-at;break;case"top-left":case"bottom-left":et=at;break;case"left":et=o;break;case"right":et=-o}}else{switch(o=Math.abs(o),g=Math.abs(g),b){case"top-right":case"top-left":case"top":nt=g-7;break;case"bottom-right":case"bottom-left":case"bottom":nt=7-g}switch(b){case"top-right":case"bottom-right":case"right":et=-o;break;case"top-left":case"bottom-left":case"left":et=o}}return[et,nt]}function mI(b,o,g,et,nt,at,lt,ft,gt,Rt,Mt,Lt,Ht,Kt){const Qt=b.layers[0],sr=Qt.appearances;if(sr.length===0)return{iconBBox:null,iconVerticalBBox:null,textBBox:null,textVerticalBBox:null};const hr={iconBBox:null,iconVerticalBBox:null},ur={textBBox:null,textVerticalBBox:null},{baseIconRotate:_r,baseTextRotate:br,iconScaleFactor:Ir}=function(Mr,Hr,Zr){const en=Mr.get("icon-rotate").evaluate(Hr,{},Zr),Tn=Mr.get("text-rotate").evaluate(Hr,{},Zr),[ln,Fn]=Mr.get("icon-size-scale-range");return{baseIconRotate:en,baseTextRotate:Tn,iconScaleFactor:pr(1,ln,Fn)}}(et,nt,at);o&&(hr.iconBBox=e1(o,hr.iconBBox,_r,lt),g)&&(hr.iconVerticalBBox=e1(g,hr.iconVerticalBBox,_r+90,lt));const Vr=Ow(Lt.horizontal);Vr&&(ur.textBBox=e1(Vr,ur.textBBox,br,1,Kt)),Lt.vertical&&(ur.textVerticalBBox=e1(Lt.vertical,ur.textVerticalBBox,br+90,1,Kt));for(const Mr of sr)Mr.hasIconProperties()&&xI(hr,b,Qt,Mr,nt,at,ft,_r,lt,gt,o,Rt,Ir,Mt),Mr.hasTextProperties()&&gI(ur,Qt,Mr,nt,at,Kt,br,Ht,Vr,Lt.vertical);return{iconBBox:hr.iconBBox,iconVerticalBBox:hr.iconVerticalBBox,textBBox:ur.textBBox,textVerticalBBox:ur.textVerticalBBox}}function xI(b,o,g,et,nt,at,lt,ft,gt,Rt,Mt,Lt,Ht,Kt){const{appearanceIconOffset:Qt,appearanceIconRotate:sr,appearanceIconSize:hr}=function(Ir,Vr,Mr,Hr,Zr,en,Tn,ln){const Fn=Ir.hasProperty("icon-offset")?Vr.getAppearanceValueAndResolveTokens(Ir,"icon-offset",Mr,Hr,[]):null,Ln=Fn&&Array.isArray(Fn)?Fn:Zr,jn=Ir.hasProperty("icon-rotate")?Vr.getAppearanceValueAndResolveTokens(Ir,"icon-rotate",Mr,Hr,[]):null,Zn=typeof jn=="number"?jn:en,Qn=Ir.hasProperty("icon-size")?Vr.getAppearanceValueAndResolveTokens(Ir,"icon-size",Mr,Hr,[]):null;return{appearanceIconOffset:Ln,appearanceIconRotate:Zn,appearanceIconSize:typeof Qn=="number"?Qn*ln.iconScaleFactor:Tn}}(et,g,nt,at,lt,ft,gt,Rt);let ur=null,_r=null,br=null;et.hasProperty("icon-image")?br=function(Ir,Vr,Mr,Hr,Zr,en,Tn){let ln=null;const Fn=Vr.getAppearanceValueAndResolveTokens(Mr,"icon-image",Hr,Zr,[]);if(Fn){const Ln=Ir.getResolvedImageFromTokens(Fn),jn=Mr.getUnevaluatedProperty("icon-size"),Zn=Kv(Ln,d_(Ir.zoom,jn,Ir.worldview),jn,Zr,Ir.zoom,Hr,Ir.pixelRatio,Tn,Ir.worldview);ln=en.get(Zn.iconPrimary.toString())}return ln}(o,g,et,nt,at,Lt,Ht):Mt&&(br=Mt.imagePrimary),br&&(ur=kw(br,null,Qt,Kt),o.allowVerticalPlacement&&(_r=kw(br,null,Qt,Kt))),ur&&(b.iconBBox=e1(ur,b.iconBBox,sr,hr)),_r&&(b.iconVerticalBBox=e1(_r,b.iconVerticalBBox,sr+90,hr))}function gI(b,o,g,et,nt,at,lt,ft,gt,Rt){const{appearanceTextOffset:Mt,appearanceTextRotate:Lt,appearanceTextSize:Ht}=function(Qt,sr,hr,ur,_r,br,Ir){const Vr=Qt.hasProperty("text-offset")?sr.getAppearanceValueAndResolveTokens(Qt,"text-offset",hr,ur,[]):null,Mr=Vr&&Array.isArray(Vr)?[Vr[0]*up,Vr[1]*up]:_r,Hr=Qt.hasProperty("text-rotate")?sr.getAppearanceValueAndResolveTokens(Qt,"text-rotate",hr,ur,[]):null,Zr=typeof Hr=="number"?Hr:br,en=Qt.hasProperty("text-size")?sr.getAppearanceValueAndResolveTokens(Qt,"text-size",hr,ur,[]):null;return{appearanceTextOffset:Mr,appearanceTextRotate:Zr,appearanceTextSize:typeof en=="number"?en:Ir}}(g,o,et,nt,at,lt,ft),Kt=Ht/ft;gt&&(b.textBBox=e1(gt,b.textBBox,Lt,Kt,Mt)),Rt&&(b.textVerticalBBox=e1(Rt,b.textVerticalBBox,Lt+90,Kt,Mt))}function Nw(b,o,g,et,nt,at,lt,ft,gt){if(!o||!o.usvg)return;const Rt=rT(et),Mt=rT(nt),Lt=at!=="both"&&at!=="width"||!eT(et)?1:Mt.width/Rt.width,Ht=at!=="both"&&at!=="height"||!tT(et)?1:Mt.height/Rt.height;g.scaleSelf(Lt,Ht);const Kt=g.toString();lt.set(Kt,g),ft.set(Kt,o);const{imagePosition:Qt}=bC(Kt,o,V1);gt.set(Kt,Qt)}function xT(b,o,g,et,nt,at,lt,ft,gt){if(!b)return;const Rt=function(Mt,Lt,Ht,Kt,Qt,sr){if(Mt.kind==="camera")return Mt.maxSize;if(Mt.kind==="composite"){const hr=Lt.possiblyEvaluate(new ou(Mt.maxZoom,{worldview:sr}),Ht).evaluate(Qt,{},Ht),ur=Lt.possiblyEvaluate(new ou(Mt.minZoom,{worldview:sr}),Ht).evaluate(Qt,{},Ht);return Math.max(hr,ur)}return Lt.possiblyEvaluate(new ou(Kt,{worldview:sr})).evaluate(Qt,{},Ht)}(o,g,et,nt,at,gt);return b.scaleSelf(Rt*ft*lt)}function Kv(b,o,g,et,nt,at,lt,ft,gt){return{iconPrimary:xT(b.getPrimary(),o,g,et,nt,at,lt,ft,gt),iconSecondary:xT(b.getSecondary(),o,g,et,nt,at,lt,ft,gt)}}function yI(b,o,g){if(!o)return;const et=g.get(b.toString()),nt=g.get(o.toString());et&&nt&&(et.paddedRect.w===nt.paddedRect.w&&et.paddedRect.h===nt.paddedRect.h||bs(`Mismatch in icon variant sizes: ${b.toString()} and ${o.toString()}`),et.usvg!==nt.usvg&&bs(`Mismatch in icon variant image types: ${b.id} and ${o.id}`))}function gT(b,o,g,et){if(!b)return;const nt=o.get(g.toString());if(b.imagePrimary=nt,et){const at=o.get(et.toString());b.imageSecondary=at}}function _I(b,o){for(const g in b.horizontal)yT(b.horizontal[g],o);yT(b.vertical,o)}function yT(b,o){if(b){for(const g of b.positionedLines)for(const et of g.positionedGlyphs)if(et.image!==null){const nt=et.image.toString();et.rect=o.get(nt).paddedRect}}}function SC(b){switch(b){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function vI(b,o,g,et,nt,at,lt,ft,gt){const Rt=Ow(at.horizontal)||at.vertical,Mt=g.get("icon-text-fit-padding").evaluate(et,{},nt);let Lt,Ht=o;return o&&gt!=="none"&&(b.allowVerticalPlacement&&at.vertical&&(Lt=vC(o,at.vertical,gt,Mt,ft,lt)),Rt&&(Ht=vC(o,Rt,gt,Mt,ft,lt))),{defaultShapedIcon:Ht,verticallyShapedIcon:Lt}}function EI(b,o,g,et,nt,at,lt,ft,gt,Rt,Mt,Lt,Ht,Kt,Qt,sr,hr,ur,_r,br,Ir,Vr,Mr,Hr){let Zr=lt.textMaxSize.evaluate(o,{},Ht);Zr===void 0?Zr=ft*lt.textScaleFactor:Zr*=lt.textScaleFactor;const en=b.layers[0].layout,Tn=up,ln=ft*lt.textScaleFactor/Tn,Fn=Ow(g.horizontal)||g.vertical;if(hr!=="none"&&b.appearanceFeatureData&&o.index<b.appearanceFeatureData.length){const vs=b.appearanceFeatureData[o.index];vs&&(vs.textShaping=Fn,vs.iconTextFitPadding=en.get("icon-text-fit-padding").evaluate(o,{},Ht),vs.fontScale=ln)}const Ln=Kt.name==="globe",jn=b.tilePixelRatio*Zr/Tn,Zn=(Kn=b.overscaling,b.zoom>18&&Kn>2&&(Kn>>=1),Math.max(ss/(512*Kn),1)*en.get("symbol-spacing")),Qn=en.get("text-padding")*b.tilePixelRatio,Hn=en.get("icon-padding")*b.tilePixelRatio,Wn=Bo(en.get("text-max-angle")),kn=en.get("icon-rotation-alignment")==="map"&&br!=="point",In=Zn/2;var Kn;b.hasAnyIconTextFit===!1&&hr!=="none"&&(b.hasAnyIconTextFit=!0);const as=o.properties?+o.properties[Dn]:null,es=as&&b.elevationFeatureIdToIndex?b.elevationFeatureIdToIndex.get(as):65535,$s=(vs,Is,Ns)=>{if(Is.x<0||Is.x>=ss||Is.y<0||Is.y>=ss)return;let Fo=null;if(Ln){const{x:ts,y:Os,z:fo}=Kt.projectTilePoint(Is.x,Is.y,Ns);Fo={anchor:new yx(ts,Os,fo,0,void 0),up:Kt.upVector(Ns,Is.x,Is.y)}}(function(ts,Os,fo,Ko,xa,wo,$l,Nr,Ur,Bn,Yn,xs,gs,Ws,Zs,vo,Ro,ko,$o,io,ho,xl,wl,Cl,Nl,Ql,Hl,Sl,Fl,Io,Qo,gu,to){const Ho=ts.addToLineVertexArray(Os,Ko);let Xl,_c,au,$u,iu,ro,Cu,Ol=0,pu=0,rp=0,dp=0,Ju=-1,_d=-1;const cp={};let qp=Sx("");const su=fo?fo.anchor:Os,ju=Sl!=="none";let Hu=0,Qp=0;if(Ur._unevaluatedLayout.getValue("text-radial-offset")===void 0){const vp=Ur.layout.get("text-offset").evaluate(ho,{},Nl);Hu=vp[0]*up,Qp=vp[1]*up}else Hu=Ur.layout.get("text-radial-offset").evaluate(ho,{},Nl)*up,Qp=AC;if(ts.allowVerticalPlacement&&xa.vertical){const vp=xa.vertical;if(Zs)ro=TC(vp),Nr&&(Cu=TC(Nr));else{const Lp=Ur.layout.get("text-rotate").evaluate(ho,{},Nl)+90;au=Lw(Bn,su,Os,Yn,xs,gs,vp,Ws,Lp,vo,gu),Nr&&($u=Lw(Bn,su,Os,Yn,xs,gs,Nr,ko,Lp,null,Qo))}}if(wo){const vp=ts.iconSizeData,Lp=Ur.layout.get("icon-rotate").evaluate(ho,{},Nl),h0=CC(wo,Lp,wl,ju,xl.iconScaleFactor),n1=Nr?CC(Nr,Lp,wl,ju,xl.iconScaleFactor):void 0;_c=Lw(Bn,su,Os,Yn,xs,gs,wo,ko,Lp,null,Io);const E_=function(bm,fE,O3,F5,L3,j3,B5,M5){const z3=bm.layers[0],V3=z3.appearances;let b_=fE.length;if(O3&&(b_=Math.max(b_,O3.length)),V3.length===0)return b_;const[N5,O5]=F5.get("icon-size-scale-range"),L5=pr(1,N5,O5);for(const U3 of V3){const G3=U3.getUnevaluatedProperties();if(G3._values["icon-image"].value!==void 0){const $3=z3.getAppearanceValueAndResolveTokens(U3,"icon-image",L3,j3,[]);if($3){const H3=bm.getResolvedImageFromTokens($3);if(H3){const W3=G3._values["icon-size"],j5=Kv(H3,d_(bm.zoom,W3,bm.worldview),W3,j3,bm.zoom,L3,bm.pixelRatio,L5,bm.worldview),z5=B5.get(j5.iconPrimary.toString());b_=Math.max(b_,cI(z5,M5))}}}}return b_}(ts,h0,n1,Ur.layout,ho,Nl,ts.iconAtlasPositions,ju);Ol=4*E_;let Em=null;vp.kind==="source"?(Em=[gm*Ur.layout.get("icon-size").evaluate(ho,{},Nl)*xl.iconScaleFactor],Em[0]>_x&&bs(`${ts.layerIds[0]}: Value for "icon-size" is >= ${Zv}. Reduce your "icon-size".`)):vp.kind==="composite"&&(Em=[gm*xl.compositeIconSizes[0].evaluate(ho,{},Nl)*xl.iconScaleFactor,gm*xl.compositeIconSizes[1].evaluate(ho,{},Nl)*xl.iconScaleFactor],(Em[0]>_x||Em[1]>_x)&&bs(`${ts.layerIds[0]}: Value for "icon-size" is >= ${Zv}. Reduce your "icon-size".`)),ts.addSymbols(ts.icon,h0,Em,io,$o,ho,void 0,fo,Os,Ho.lineStartIndex,Ho.lineLength,-1,Cl,Nl,Ql,Hl,ts.symbolInstances.length,E_),Ju=ts.icon.placedSymbolArray.length-1,n1&&(pu=4*E_,ts.addSymbols(ts.icon,n1,Em,io,$o,ho,d0.vertical,fo,Os,Ho.lineStartIndex,Ho.lineLength,-1,Cl,Nl,Ql,Hl,ts.symbolInstances.length,E_),_d=ts.icon.placedSymbolArray.length-1)}for(const vp in xa.horizontal){const Lp=vp,h0=xa.horizontal[Lp];Xl||(qp=Sx(h0.text),Zs?iu=TC(h0):Xl=Lw(Bn,su,Os,Yn,xs,gs,h0,Ws,Ur.layout.get("text-rotate").evaluate(ho,{},Nl),vo,gu));const n1=h0.positionedLines.length===1;if(rp+=_T(ts,fo,Os,h0,$l,Ur,Zs,ho,vo,Ho,xa.vertical?d0.horizontal:d0.horizontalOnly,n1?fI(xa.horizontal):[Lp],cp,Ju,xl,Cl,Nl,ts.symbolInstances.length,Ql),n1)break}xa.vertical&&(dp+=_T(ts,fo,Os,xa.vertical,$l,Ur,Zs,ho,vo,Ho,d0.vertical,["vertical"],cp,_d,xl,Cl,Nl,ts.symbolInstances.length,Ql));let np=-1;const Y0=(vp,Lp)=>vp?Math.max(vp,Lp):Lp;np=Y0(iu,np),np=Y0(ro,np),np=Y0(Cu,np);const Wm=np>-1?1:0;ts.glyphOffsetArray.length>=65535&&bs("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),ho.sortKey!==void 0&&ts.addToSortKeyRanges(ts.symbolInstances.length,ho.sortKey),ts.symbolInstances.emplaceBack(Os.x,Os.y,su.x,su.y,su.z,cp.right>=0?cp.right:-1,cp.center>=0?cp.center:-1,cp.left>=0?cp.left:-1,cp.vertical>=0?cp.vertical:-1,Ju,_d,qp,Xl!==void 0?Xl:ts.collisionBoxArray.length,Xl!==void 0?Xl+1:ts.collisionBoxArray.length,au!==void 0?au:ts.collisionBoxArray.length,au!==void 0?au+1:ts.collisionBoxArray.length,_c!==void 0?_c:ts.collisionBoxArray.length,_c!==void 0?_c+1:ts.collisionBoxArray.length,$u||ts.collisionBoxArray.length,$u?$u+1:ts.collisionBoxArray.length,Yn,rp,dp,Ol,pu,Wm,0,Hu,Qp,np,0,ju?1:0,Fl)})(b,Is,Fo,vs,g,et,at,nt,b.layers[0],b.collisionBoxArray,o.index,o.sourceLayerIndex,b.index,Qn,_r,Rt,0,Hn,kn,ur,o,lt,Mt,Lt,Ht,Qt,sr,hr,es,Ir,Vr,Mr)};if(br==="line")for(const vs of yw(o.geometry,0,0,ss,ss)){const Is=lI(vs,Zn,Wn,g.vertical||Fn,et,Tn,jn,b.overscaling,ss);for(const Ns of Is)Fn&&bI(b,Fn.text,In,Ns)||$s(vs,Ns,Ht)}else if(br==="line-center"){for(const vs of o.geometry)if(vs.length>1){const Is=aI(vs,Wn,g.vertical||Fn,et,Tn,jn);Is&&$s(vs,Is,Ht)}}else if(o.type==="Polygon")for(const vs of kv(o.geometry,0)){const Is=dI(vs,16);$s(vs[0],new yx(Is.x,Is.y,0,0,void 0),Ht)}else if(o.type==="LineString")for(const vs of o.geometry)$s(vs,new yx(vs[0].x,vs[0].y,0,0,void 0),Ht);else if(o.type==="Point")for(const vs of o.geometry)for(const Is of vs)$s([Is],new yx(Is.x,Is.y,0,0,void 0),Ht)}const Zv=255,_x=Zv*gm;function _T(b,o,g,et,nt,at,lt,ft,gt,Rt,Mt,Lt,Ht,Kt,Qt,sr,hr,ur,_r){const br=function(Mr,Hr,Zr,en,Tn,ln,Fn,Ln){const jn=[];if(Hr.positionedLines.length===0)return jn;const Zn=en.layout.get("text-rotate").evaluate(ln,{})*Math.PI/180,Qn=function(Kn){const as=Kn[0],es=Kn[1],$s=as*es;return $s>0?[as,-es]:$s<0?[-as,es]:as===0?[es,as]:[es,-as]}(Zr);let Hn=Math.abs(Hr.top-Hr.bottom);for(const Kn of Hr.positionedLines)Hn-=Kn.lineOffset;const Wn=Hr.positionedLines.length,kn=Hn/Wn;let In=Hr.top-Zr[1];for(let Kn=0;Kn<Wn;++Kn){const as=Hr.positionedLines[Kn];In=uI(Hr,kn,In,Kn);for(const es of as.positionedGlyphs){if(!es.rect)continue;const $s=es.rect||{};let vs=XS+1,Is=!0,Ns=1,Fo=0;if(es.image){const Ro=Fn.get(es.image.toString());if(!Ro)continue;if(Ro.sdf){bs("SDF images are not supported in formatted text and will be ignored.");continue}Is=!1,Ns=Ro.pixelRatio,vs=V1/Ns}const ts=(Tn||Ln)&&es.vertical,Os=es.metrics.advance*es.scale/2,fo=es.metrics,Ko=es.rect;if(Ko===null)continue;Ln&&Hr.verticalizable&&(Fo=es.image?Os-es.metrics.width*es.scale/2:0);const xa=Tn?[es.x+Os,es.y]:[0,0];let wo=[0,0],$l=[0,0],Nr=!1;Tn||(ts?($l=[es.x+Os+Qn[0],es.y+Qn[1]-Fo],Nr=!0):wo=[es.x+Os+Zr[0],es.y+Zr[1]-Fo]);const Ur=Ko.w*es.scale/(Ns*(es.localGlyph?ym:1)),Bn=Ko.h*es.scale/(Ns*(es.localGlyph?ym:1));let Yn,xs,gs,Ws;if(ts){const Ro=es.y-In,ko=new zn(-Os,Os-Ro),$o=-Math.PI/2,io=new zn(...$l);Yn=new zn(-Os+wo[0],wo[1]),Yn._rotateAround($o,ko)._add(io),Yn.x+=-Ro+Os,Yn.y-=(fo.left-vs)*es.scale;const ho=es.image?fo.advance*es.scale:up*es.scale,xl=String.fromCodePoint(es.glyph);H8(xl)?Yn.x+=(1-vs)*es.scale:W8(xl)?Yn.x+=ho-fo.height*es.scale+(-vs-1)*es.scale:Yn.x+=es.image||fo.width+2*vs===Ko.w&&fo.height+2*vs===Ko.h?(ho-Bn)/2:(ho-(fo.height+2*vs)*es.scale)/2,xs=new zn(Yn.x,Yn.y-Ur),gs=new zn(Yn.x+Bn,Yn.y),Ws=new zn(Yn.x+Bn,Yn.y-Ur)}else{const Ro=(fo.left-vs)*es.scale-Os+wo[0],ko=(-fo.top-vs)*es.scale+wo[1],$o=Ro+Ur,io=ko+Bn;Yn=new zn(Ro,ko),xs=new zn($o,ko),gs=new zn(Ro,io),Ws=new zn($o,io)}if(Zn){let Ro;Ro=Tn?new zn(0,0):Nr?new zn(Qn[0],Qn[1]):new zn(Zr[0],Zr[1]),Yn._rotateAround(Zn,Ro),xs._rotateAround(Zn,Ro),gs._rotateAround(Zn,Ro),Ws._rotateAround(Zn,Ro)}const Zs=new zn(0,0),vo=new zn(0,0);jn.push({tl:Yn,tr:xs,bl:gs,br:Ws,texPrimary:$s,texSecondary:void 0,writingMode:Hr.writingMode,glyphOffset:xa,sectionIndex:es.sectionIndex,isSDF:Is,pixelOffsetTL:Zs,pixelOffsetBR:vo,minFontScaleX:0,minFontScaleY:0})}}return jn}(0,et,gt,at,lt,ft,nt,b.allowVerticalPlacement),Ir=b.textSizeData;let Vr=null;Ir.kind==="source"?(Vr=[gm*at.layout.get("text-size").evaluate(ft,{},hr)*Qt.textScaleFactor],Vr[0]>_x&&bs(`${b.layerIds[0]}: Value for "text-size" is >= ${Zv}. Reduce your "text-size".`)):Ir.kind==="composite"&&(Vr=[gm*Qt.compositeTextSizes[0].evaluate(ft,{},hr)*Qt.textScaleFactor,gm*Qt.compositeTextSizes[1].evaluate(ft,{},hr)*Qt.textScaleFactor],(Vr[0]>_x||Vr[1]>_x)&&bs(`${b.layerIds[0]}: Value for "text-size" is >= ${Zv}. Reduce your "text-size".`)),b.addSymbols(b.text,br,Vr,gt,lt,ft,Mt,o,g,Rt.lineStartIndex,Rt.lineLength,Kt,sr,hr,_r,!1,ur,br.length);for(const Mr of Lt)Ht[Mr]=b.text.placedSymbolArray.length-1;return 4*br.length}function Ow(b){for(const o in b)return b[o];return null}function Lw(b,o,g,et,nt,at,lt,ft,gt,Rt,Mt){let Lt,Ht,Kt,Qt;if(Lt=Mt?Mt.top:lt.top,Ht=Mt?Mt.bottom:lt.bottom,Kt=Mt?Mt.left:lt.left,Qt=Mt?Mt.right:lt.right,_C(lt)&&lt.collisionPadding){const sr=lt.collisionPadding;Kt-=sr[0],Lt-=sr[1],Qt+=sr[2],Ht+=sr[3]}if(gt){const sr=new zn(Kt,Lt),hr=new zn(Qt,Lt),ur=new zn(Kt,Ht),_r=new zn(Qt,Ht),br=Bo(gt);let Ir=new zn(0,0);Rt&&(Ir=new zn(Rt[0],Rt[1])),sr._rotateAround(br,Ir),hr._rotateAround(br,Ir),ur._rotateAround(br,Ir),_r._rotateAround(br,Ir),Kt=Math.min(sr.x,hr.x,ur.x,_r.x),Qt=Math.max(sr.x,hr.x,ur.x,_r.x),Lt=Math.min(sr.y,hr.y,ur.y,_r.y),Ht=Math.max(sr.y,hr.y,ur.y,_r.y)}return b.emplaceBack(o.x,o.y,o.z,g.x,g.y,Kt,Lt,Qt,Ht,ft,et,nt,at),b.length-1}function TC(b){_C(b)&&b.collisionPadding&&(b.top-=b.collisionPadding[1],b.bottom+=b.collisionPadding[3]);const o=b.bottom-b.top;return o>0?Math.max(10,o):null}function bI(b,o,g,et){const nt=b.compareText;if(o in nt){const at=nt[o];for(let lt=at.length-1;lt>=0;lt--)if(et.dist(at[lt])<g)return!0}else nt[o]=[];return nt[o].push(et),!1}function vT(b,o){const g=b.fovAboveCenter,et=b.elevation?b.elevation.getMinElevationBelowMSL()*o:0,nt=(b._camera.position[2]*b.worldSize-et)/Math.cos(b._pitch),at=Math.sin(g)*nt/Math.sin(Math.max(Math.PI/2-b._pitch-g,.01));let lt=Math.sin(b._pitch)*at+nt;const ft=nt*(1/b._horizonShift);if(!b.elevation||b.elevation.exaggeration()===0){let gt=Math.max(b.zoom-17,0);b.isOrthographic&&(gt/=10),lt*=1+gt}return Math.min(1.01*lt,ft)}function Yv(b,o){if(!o.isReprojectedInTileSpace)return{scale:1<<b.z,x:b.x,y:b.y,x2:b.x+1,y2:b.y+1,projection:o};const g=Math.pow(2,-b.z),et=b.x*g,nt=(b.x+1)*g,at=b.y*g,lt=(b.y+1)*g,ft=Xt(et),gt=Xt(nt),Rt=rr(at),Mt=rr(lt),Lt=o.project(ft,Rt),Ht=o.project(gt,Rt),Kt=o.project(gt,Mt),Qt=o.project(ft,Mt);let sr=Math.min(Lt.x,Ht.x,Kt.x,Qt.x),hr=Math.min(Lt.y,Ht.y,Kt.y,Qt.y),ur=Math.max(Lt.x,Ht.x,Kt.x,Qt.x),_r=Math.max(Lt.y,Ht.y,Kt.y,Qt.y);const br=g/16;function Ir(Mr,Hr,Zr,en,Tn,ln){const Fn=(Zr+Tn)/2,Ln=(en+ln)/2,jn=o.project(Xt(Fn),rr(Ln)),Zn=Math.max(0,sr-jn.x,hr-jn.y,jn.x-ur,jn.y-_r);sr=Math.min(sr,jn.x),ur=Math.max(ur,jn.x),hr=Math.min(hr,jn.y),_r=Math.max(_r,jn.y),Zn>br&&(Ir(Mr,jn,Zr,en,Fn,Ln),Ir(jn,Hr,Fn,Ln,Tn,ln))}Ir(Lt,Ht,et,at,nt,at),Ir(Ht,Kt,nt,at,nt,lt),Ir(Kt,Qt,nt,lt,et,lt),Ir(Qt,Lt,et,lt,et,at),sr-=br,hr-=br,ur+=br,_r+=br;const Vr=1/Math.max(ur-sr,_r-hr);return{scale:Vr,x:sr*Vr,y:hr*Vr,x2:ur*Vr,y2:_r*Vr,projection:o}}function ET(b,{x:o,y:g},et=0){return new zn(((o-et)*b.scale-b.x)*ss,(g*b.scale-b.y)*ss)}const wI=Zt(new Float32Array(16));class t1{constructor(o){this.spec=o,this.name=o.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(o,g){return{x:0,y:0,z:0}}unproject(o,g){return new _e(0,0)}projectTilePoint(o,g,et){return{x:o,y:g,z:0}}locationPoint(o,g,et,nt=!0){return o._coordinatePoint(o.locationCoordinate(g,et),nt)}pixelsPerMeter(o,g){return $t(1,o)*g}pixelSpaceConversion(o,g,et){return 1}farthestPixelDistance(o){return vT(o,o.pixelsPerMeter)}pointCoordinate(o,g,et,nt){const at=o.horizonLineFromTop(!1),lt=new zn(g,Math.max(at,et));return o.rayIntersectionCoordinate(o.pointRayIntersection(lt,nt))}pointCoordinate3D(o,g,et){const nt=new zn(g,et);if(o.elevation)return o.elevation.pointCoordinate(nt);{const at=this.pointCoordinate(o,nt.x,nt.y,0);return[at.x,at.y,at.z]}}isPointAboveHorizon(o,g){if(o.elevation&&o.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(o,g.x,g.y);const et=o.horizonLineFromTop();return g.y<et}createInversionMatrix(o,g){return wI}createTileMatrix(o,g,et){let nt,at,lt;const ft=et.canonical,gt=Zt(new Float64Array(16));if(this.isReprojectedInTileSpace){const Rt=Yv(ft,this);nt=1,at=Rt.x+et.wrap*Rt.scale,lt=Rt.y,Gt(gt,gt,[nt/Rt.scale,nt/Rt.scale,o.pixelsPerMeter/g])}else nt=g/o.zoomScale(ft.z),at=(ft.x+Math.pow(2,ft.z)*et.wrap)*nt,lt=ft.y*nt;return Nt(gt,gt,[at,lt,0]),Gt(gt,gt,[nt/ss,nt/ss,1]),gt}upVector(o,g,et){return[0,0,1]}upVectorScale(o,g,et){return{metersToTile:1}}}class CI extends t1{constructor(o){super(o),this.range=[4,7],this.center=o.center||[-96,37.5];const[g,et]=this.parallels=o.parallels||[29.5,45.5],nt=Math.sin(Bo(g));this.n=(nt+Math.sin(Bo(et)))/2,this.c=1+nt*(2*this.n-nt),this.r0=Math.sqrt(this.c)/this.n}project(o,g){const{n:et,c:nt,r0:at}=this,lt=Bo(o-this.center[0]),ft=Bo(g),gt=Math.sqrt(nt-2*et*Math.sin(ft))/et;return{x:gt*Math.sin(lt*et),y:gt*Math.cos(lt*et)-at,z:0}}unproject(o,g){const{n:et,c:nt,r0:at}=this,lt=at+g;let ft=Math.atan2(o,Math.abs(lt))*Math.sign(lt);lt*et<0&&(ft-=Math.PI*Math.sign(o)*Math.sign(lt));const gt=Bo(this.center[0])*et;ft=kr(ft,-Math.PI-gt,Math.PI-gt);const Rt=pr(Ru(ft/et)+this.center[0],-180,180),Mt=Math.asin(pr((nt-(o*o+lt*lt)*et*et)/(2*et),-1,1)),Lt=pr(Ru(Mt),-nr,nr);return new _e(Rt,Lt)}}const Qv=1.340264,Jv=-.081106,eE=893e-6,tE=.003796,jw=Math.sqrt(3)/2;class AI extends t1{project(o,g){g=g/180*Math.PI,o=o/180*Math.PI;const et=Math.asin(jw*Math.sin(g)),nt=et*et,at=nt*nt*nt;return{x:.5*(o*Math.cos(et)/(jw*(Qv+3*Jv*nt+at*(7*eE+9*tE*nt)))/Math.PI+.5),y:1-.5*(et*(Qv+Jv*nt+at*(eE+tE*nt))/Math.PI+1),z:0}}unproject(o,g){o=(2*o-.5)*Math.PI;let et=g=(2*(1-g)-1)*Math.PI,nt=et*et,at=nt*nt*nt;for(let Mt,Lt,Ht,Kt=0;Kt<12&&(Lt=et*(Qv+Jv*nt+at*(eE+tE*nt))-g,Ht=Qv+3*Jv*nt+at*(7*eE+9*tE*nt),Mt=Lt/Ht,et=pr(et-Mt,-Math.PI/3,Math.PI/3),nt=et*et,at=nt*nt*nt,!(Math.abs(Mt)<1e-12));++Kt);const lt=jw*o*(Qv+3*Jv*nt+at*(7*eE+9*tE*nt))/Math.cos(et),ft=Math.asin(Math.sin(et)/jw),gt=pr(180*lt/Math.PI,-180,180),Rt=pr(180*ft/Math.PI,-nr,nr);return new _e(gt,Rt)}}class SI extends t1{constructor(o){super(o),this.wrap=!0,this.supportsWorldCopies=!0}project(o,g){return{x:.5+o/360,y:.5-g/360,z:0}}unproject(o,g){const et=360*(o-.5),nt=pr(360*(.5-g),-nr,nr);return new _e(et,nt)}}const m_=Math.PI/2;function zw(b){return Math.tan((m_+b)/2)}class TI extends t1{constructor(o){super(o),this.center=o.center||[0,30];const[g,et]=this.parallels=o.parallels||[30,30];let nt=Bo(g),at=Bo(et);this.southernCenter=nt+at<0,this.southernCenter&&(nt=-nt,at=-at);const lt=Math.cos(nt),ft=zw(nt);this.n=nt===at?Math.sin(nt):Math.log(lt/Math.cos(at))/Math.log(zw(at)/ft),this.f=lt*Math.pow(zw(nt),this.n)/this.n}project(o,g){g=Bo(g),this.southernCenter&&(g=-g),o=Bo(o-this.center[0]);const et=1e-6,{n:nt,f:at}=this;at>0?g<-m_+et&&(g=-m_+et):g>m_-et&&(g=m_-et);const lt=at/Math.pow(zw(g),nt);let ft=lt*Math.sin(nt*o),gt=at-lt*Math.cos(nt*o);return ft=.5*(ft/Math.PI+.5),gt=.5*(gt/Math.PI+.5),{x:ft,y:this.southernCenter?gt:1-gt,z:0}}unproject(o,g){o=(2*o-.5)*Math.PI,this.southernCenter&&(g=1-g),g=(2*(1-g)-.5)*Math.PI;const{n:et,f:nt}=this,at=nt-g,lt=Math.sign(at),ft=Math.sign(et)*Math.sqrt(o*o+at*at);let gt=Math.atan2(o,Math.abs(at))*lt;at*et<0&&(gt-=Math.PI*Math.sign(o)*lt);const Rt=pr(Ru(gt/et)+this.center[0],-180,180),Mt=pr(Ru(2*Math.atan(Math.pow(nt/ft,1/et))-m_),-nr,nr);return new _e(Rt,this.southernCenter?-Mt:Mt)}}class bT extends t1{constructor(o){super(o),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(o,g){return{x:Tt(o),y:kt(g),z:0}}unproject(o,g){const et=Xt(o),nt=rr(g);return new _e(et,nt)}}const wT=Bo(nr);class RI extends t1{project(o,g){const et=(g=Bo(g))*g,nt=et*et;return{x:.5*((o=Bo(o))*(.8707-.131979*et+nt*(nt*(.003971*et-.001529*nt)-.013791))/Math.PI+.5),y:1-.5*(g*(1.007226+et*(.015085+nt*(.028874*et-.044475-.005916*nt)))/Math.PI+1),z:0}}unproject(o,g){o=(2*o-.5)*Math.PI;let et=g=(2*(1-g)-1)*Math.PI,nt=25,at=0,lt=et*et;do{lt=et*et;const Rt=lt*lt;at=(et*(1.007226+lt*(.015085+Rt*(.028874*lt-.044475-.005916*Rt)))-g)/(1.007226+lt*(.045255+Rt*(.259866*lt-.311325-.005916*11*Rt))),et=pr(et-at,-wT,wT)}while(Math.abs(at)>1e-6&&--nt>0);lt=et*et;const ft=pr(Ru(o/(.8707+lt*(lt*(lt*lt*lt*(.003971-.001529*lt)-.013791)-.131979))),-180,180),gt=Ru(et);return new _e(ft,gt)}}const CT=Bo(nr);class II extends t1{project(o,g){g=Bo(g),o=Bo(o);const et=Math.cos(g),nt=2/Math.PI,at=Math.acos(et*Math.cos(o/2)),lt=Math.sin(at)/at,ft=.5*(o*nt+2*et*Math.sin(o/2)/lt)||0,gt=.5*(g+Math.sin(g)/lt)||0;return{x:.5*(ft/Math.PI+.5),y:1-.5*(gt/Math.PI+1),z:0}}unproject(o,g){let et=o=(2*o-.5)*Math.PI,nt=g=(2*(1-g)-1)*Math.PI,at=25;const lt=1e-6;let ft=0,gt=0;do{const Rt=Math.cos(nt),Mt=Math.sin(nt),Lt=2*Mt*Rt,Ht=Mt*Mt,Kt=Rt*Rt,Qt=Math.cos(et/2),sr=Math.sin(et/2),hr=2*Qt*sr,ur=sr*sr,_r=1-Kt*Qt*Qt,br=_r?1/_r:0,Ir=_r?Math.acos(Rt*Qt)*Math.sqrt(1/_r):0,Vr=.5*(2*Ir*Rt*sr+2*et/Math.PI)-o,Mr=.5*(Ir*Mt+nt)-g,Hr=.5*br*(Kt*ur+Ir*Rt*Qt*Ht)+1/Math.PI,Zr=br*(hr*Lt/4-Ir*Mt*sr),en=.125*br*(Lt*sr-Ir*Mt*Kt*hr),Tn=.5*br*(Ht*Qt+Ir*ur*Rt)+.5,ln=Zr*en-Tn*Hr;ft=(Mr*Zr-Vr*Tn)/ln,gt=(Vr*en-Mr*Hr)/ln,et=pr(et-ft,-Math.PI,Math.PI),nt=pr(nt-gt,-CT,CT)}while((Math.abs(ft)>lt||Math.abs(gt)>lt)&&--at>0);return new _e(Ru(et),Ru(nt))}}class AT extends t1{constructor(o){super(o),this.center=o.center||[0,0],this.parallels=o.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Bo(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(o,g){const{scale:et,cosPhi:nt}=this;return{x:Bo(o)*nt*et+.5,y:-Math.sin(Bo(g))/nt*et+.5,z:0}}unproject(o,g){const{scale:et,cosPhi:nt}=this,at=-(g-.5)/et,lt=pr(Ru((o-.5)/et)/nt,-180,180),ft=Math.asin(pr(at*nt,-1,1)),gt=pr(Ru(ft),-nr,nr);return new _e(lt,gt)}}class DI extends bT{constructor(o){super(o),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(o,g,et){const nt=Sv(o,g,et);return ys(nt,nt,cw(N0(et))),{x:nt[0],y:nt[1],z:nt[2]}}locationPoint(o,g,et){const nt=Kx(g.lat,g.lng),at=ws([],nt),lt=et?o._centerAltitude+et:o.elevation?o.elevation.getAtPointOrZero(o.locationCoordinate(g),o._centerAltitude):o._centerAltitude;Sn(nt,nt,at,$t(1,0)*ss*lt);const ft=Zt(new Float64Array(16));return Ut(ft,o.pixelMatrix,o.globeMatrix),ys(nt,nt,ft),new zn(nt[0],nt[1])}pixelsPerMeter(o,g){return $t(1,0)*g}pixelSpaceConversion(o,g,et){const nt=$t(1,o)*g,at=so($t(1,45)*g,nt,et);return this.pixelsPerMeter(o,g)/at}createTileMatrix(o,g,et){const nt=k2(N0(et.canonical));return Ut(new Float64Array(16),o.globeMatrix,nt)}createInversionMatrix(o,g){const{center:et}=o,nt=cw(N0(g));return ir(nt,nt,Bo(et.lng)),er(nt,nt,Bo(et.lat)),Gt(nt,nt,[o._pixelsPerMercatorPixel,o._pixelsPerMercatorPixel,1]),Float32Array.from(nt)}pointCoordinate(o,g,et,nt){return Yx(o,g,et,!0)||new Ar(0,0)}pointCoordinate3D(o,g,et){const nt=this.pointCoordinate(o,g,et,0);return[nt.x,nt.y,nt.z]}isPointAboveHorizon(o,g){return!Yx(o,g.x,g.y,!1)}farthestPixelDistance(o){const g=function(nt,at){const lt=nt.cameraToCenterDistance,ft=nt._centerAltitude*at,gt=nt._camera,Rt=nt._camera.forward(),Mt=dr([],gn([],Rt,-lt),[0,0,ft]),Lt=nt.worldSize/(2*Math.PI),Ht=[0,0,-Lt],Kt=nt.width/nt.height,Qt=Math.tan(nt.fovAboveCenter),sr=gn([],gt.up(),Qt),hr=gn([],gt.right(),Qt*Kt),ur=ws([],dr([],dr([],Rt,sr),hr)),_r=[];let br;if(new Bs(Mt,ur).closestPointOnSphere(Ht,Lt,_r)){const Ir=dr([],_r,Ht),Vr=tn([],Ir,Mt);br=Math.cos(nt.fovAboveCenter)*Fr(Vr)}else{const Ir=tn([],Mt,Ht),Vr=tn([],Ht,Mt);ws(Vr,Vr);const Mr=Fr(Ir)-Lt;br=Math.sqrt(Mr*(Mr+2*Lt));const Hr=Math.acos(br/(Lt+Mr))-Math.acos(Vs(Rt,Vr));br*=Math.cos(Hr)}return 1.01*br}(o,this.pixelsPerMeter(o.center.lat,o.worldSize)),et=Qx(o.zoom);if(et>0){const nt=vT(o,$t(1,o.center.lat)*o.worldSize),at=o.worldSize/(2*Math.PI),lt=Math.max(o.width,o.height)/o.worldSize*Math.PI;return so(g,nt+at*(1-Math.cos(lt)),Math.pow(et,10))}return g}upVector(o,g,et){return Sv(g,et,o,1)}upVectorScale(o){return{metersToTile:K0(lw(N0(o)))}}}function ST(b){const o=b.parallels,g=!!o&&Math.abs(o[0]+o[1])<.01;switch(b.name){case"mercator":return new bT(b);case"equirectangular":return new SI(b);case"naturalEarth":return new RI(b);case"equalEarth":return new AI(b);case"winkelTripel":return new II(b);case"albers":return g?new AT(b):new CI(b);case"lambertConformalConic":return g?new AT(b):new TI(b);case"globe":return new DI(b)}throw new Error(`Invalid projection name: ${b.name}`)}const PI=sn.types,kI=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function rE(b,o,g,et,nt,at,lt,ft,gt,Rt,Mt,Lt,Ht){const Kt=ft?Math.min(_x,Math.round(ft[0])):0,Qt=ft?Math.min(_x,Math.round(ft[1])):0;b.emplaceBack(o,g,Math.round(32*et),Math.round(32*nt),at,lt,(Kt<<1)+(gt?1:0),0+(Qt<<1),16*Rt,16*Mt,256*Lt,256*Ht)}function nE(b,o,g){b.emplaceBack(o,g)}function iE(b,o,g,et,nt,at,lt){b.emplaceBack(o,g,et,nt,at,lt)}const Vw=(b,o,g,et)=>{for(let nt=0;nt<o;nt++)b.emplaceBack(g[0],g[1],g[2],et[0],et[1],et[2])};function x_(b,o,g,et,nt){b.emplaceBack(o,g,et,nt),b.emplaceBack(o,g,et,nt),b.emplaceBack(o,g,et,nt),b.emplaceBack(o,g,et,nt)}function FI(b){for(const o of b.sections)if(x2(o.text))return!0;return!1}class RC{constructor(o){this.layoutVertexArray=new cv,this.indexArray=new _f,this.programConfigurations=o,this.segments=new Eu,this.dynamicLayoutVertexArray=new zm,this.opacityVertexArray=new jy,this.placedSymbolArray=new tw,this.iconTransitioningVertexArray=new l0,this.globeExtVertexArray=new uv,this.zOffsetVertexArray=new lm,this.orientationVertexArray=new fv,this.symbolInstanceIndices=[]}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}getIconVertexData(o,g){const et=[],nt=this.layoutVertexArray.uint16;for(let at=0;at<g;++at){const lt=12*(o+at);et.push(...nt.slice(lt,lt+12))}return et}updateIconVertexData(o,g,et,nt,at,lt,ft,gt,Rt,Mt,Lt,Ht,Kt){const Qt=this.layoutVertexArray.uint16,sr=12*o;Qt[sr]=g,Qt[sr+1]=et,Qt[sr+2]=nt,Qt[sr+3]=at,Qt[sr+4]=lt,Qt[sr+5]=ft,Qt[sr+6]=gt,Qt[sr+7]=Rt,Qt[sr+8]=Mt,Qt[sr+9]=Lt,Qt[sr+10]=Ht,Qt[sr+11]=Kt}upload(o,g,et,nt,at,lt){this.isEmpty()||(et&&(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,M8.members,!!lt),this.indexBuffer=o.createIndexBuffer(this.indexArray,g),this.dynamicLayoutVertexBuffer=o.createVertexBuffer(this.dynamicLayoutVertexArray,O8.members,!0),this.opacityVertexBuffer=o.createVertexBuffer(this.opacityVertexArray,kI,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=o.createVertexBuffer(this.iconTransitioningVertexArray,z8.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=o.createVertexBuffer(this.globeExtVertexArray,N8.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||at)&&(this.zOffsetVertexBuffer=o.createVertexBuffer(this.zOffsetVertexArray,L8.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=o.createVertexBuffer(this.orientationVertexArray,j8.members,!0)),this.opacityVertexBuffer.itemSize=1),(et||nt)&&this.programConfigurations.upload(o))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}Ps(RC,"SymbolBuffers");class IC{constructor(o,g,et){this.layoutVertexArray=new o,this.layoutAttributes=g,this.indexArray=new et,this.segments=new Eu,this.collisionVertexArray=new dv,this.collisionVertexArrayExt=new zm}upload(o){this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=o.createVertexBuffer(this.collisionVertexArray,V8.members,!0),this.collisionVertexBufferExt=o.createVertexBuffer(this.collisionVertexArrayExt,U8.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Ps(IC,"CollisionBuffers");class Uw{constructor(o){this.collisionBoxArray=o.collisionBoxArray,this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(lt=>lt.fqid),this.index=o.index,this.pixelRatio=o.pixelRatio,this.sourceLayerIndex=o.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Zt([]),this.placementViewportMatrix=Zt([]);const g=this.layers[0]._unevaluatedLayout._values;this.worldview=o.worldview,this.localizable=o.localizable,this.textSizeData=d_(this.zoom,g["text-size"],this.worldview),this.iconSizeData=d_(this.zoom,g["icon-size"],this.worldview);const et=this.layers[0].layout,nt=et.get("symbol-sort-key"),at=et.get("symbol-z-order");this.lut=o.lut,this.canOverlap=et.get("text-allow-overlap")||et.get("icon-allow-overlap")||et.get("text-ignore-placement")||et.get("icon-ignore-placement"),this.sortFeaturesByKey=at!=="viewport-y"&&nt.constantOr(1)!==void 0,this.sortFeaturesByY=(at==="viewport-y"||at==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=et.get("text-writing-mode").map(lt=>d0[lt]),this.stateDependentLayerIds=this.layers.filter(lt=>lt.isStateDependent()).map(lt=>lt.id),this.sourceID=o.sourceID,this.projection=o.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1,this.hasAppearances=null,this.lastActiveApperance=null,this.featureToAppearanceIndex={}}hasAnyAppearanceProperty(o){const g=this.layers[0].getAppearances();return!(!g||g.length===0)&&g.some(et=>et.getProperty(o)!=null)}createArrays(){this.text=new RC(new B0(this.layers,{zoom:this.zoom,lut:this.lut},o=>o.startsWith("text")||o.startsWith("symbol"))),this.icon=new RC(new B0(this.layers,{zoom:this.zoom,lut:this.lut},o=>o.startsWith("icon")||o.startsWith("symbol"))),this.glyphOffsetArray=new qy,this.lineVertexArray=new nw,this.symbolInstances=new yv}calculateGlyphDependencies(o,g,et,nt,at){for(const lt of o){const ft=lt.codePointAt(0);if(ft===void 0)break;if(g[ft]=!0,nt&&at&&ft<=65535){const gt=Hv[lt];gt&&(g[gt.charCodeAt(0)]=!0)}}}calculateEffectiveAppearanceIconSize(o,g,et,nt,at,lt){let ft=1;const gt=o.getUnevaluatedProperties()._values["icon-size"],Rt=d_(this.zoom,gt,this.worldview),Mt=h_(Rt,g);if(Rt.kind!=="constant"&&Rt.kind!=="camera"||(ft=Mt.uSize),Rt.kind==="composite"){const{minZoom:Lt,maxZoom:Ht}=Rt,Kt=gt.possiblyEvaluate(new ou(Lt,{worldview:this.worldview}),nt),Qt=gt.possiblyEvaluate(new ou(Ht,{worldview:this.worldview}),nt),sr=Kt.evaluate(et,{},nt,at);ft=sr+(Qt.evaluate(et,{},nt,at)-sr)*Mt.uSizeT}return Rt.kind==="source"&&(ft=gt.possiblyEvaluate(new ou(this.zoom,{worldview:this.worldview}),nt).evaluate(et,{},nt,at)),ft*lt}updateFootprints(o,g){}updateReplacement(o,g){if(g.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=g.updateTime;const et=g.getReplacementRegionsForTile(o.toUnwrapped(),!0);return!mw(this.activeReplacements,et)&&(this.activeReplacements=et,!0)}getResolvedImageFromTokens(o){return typeof o=="string"?wp.build(o):o}populate(o,g,et,nt){const at=this.layers[0],lt=at.layout,ft=this.projection.name==="globe",gt=lt.get("text-font"),Rt=lt.get("text-field"),Mt=lt.get("icon-image"),[Lt,Ht]=lt.get("icon-size-scale-range"),Kt=pr(g.scaleFactor||1,Lt,Ht),Qt=(Rt.value.kind!=="constant"||Rt.value.value instanceof bp&&!Rt.value.value.isEmpty()||Rt.value.value.toString().length>0)&&(gt.value.kind!=="constant"||gt.value.value.length>0),sr=Mt.value.kind!=="constant"||!!Mt.value.value||Object.keys(Mt.parameters).length>0,hr=this.hasAnyAppearanceProperty("icon-image"),ur=lt.get("symbol-sort-key");if(this.features=[],this.appearanceFeatureData=[],!Qt&&!sr&&!hr)return;const _r=g.iconDependencies,br=g.glyphDependencies,Ir=g.availableImages,Vr=new ou(this.zoom,{worldview:this.worldview,activeFloors:g.activeFloors}),Mr=Hr=>{const Zr=Hr.id.toString();_r.has(Zr)?_r.get(Zr).push(Hr):_r.set(Zr,[Hr])};for(const Hr of o){const{feature:Zr,id:en,index:Tn,sourceLayerIndex:ln}=Hr,Fn=at._featureFilter.needGeometry,Ln=an(Zr,Fn);if(!at._featureFilter.filter(Vr,Ln,et))continue;if(Fn||(Ln.geometry=Xr(Zr,et,nt)),ft&&Zr.type!==1&&et.z<=5){const Kn=Ln.geometry,as=.98078528056,es=($s,vs)=>Vs(Sv($s.x,$s.y,et,1),Sv(vs.x,vs.y,et,1))<as;for(let $s=0;$s<Kn.length;$s++)Kn[$s]=zr(Kn[$s],es)}let jn,Zn;if(Qt){const Kn=at.getValueAndResolveTokens("text-field",Ln,et,Ir),as=bp.factory(Kn);FI(as)&&(this.hasRTLText=!0),(!this.hasRTLText||C1()==="unavailable"||this.hasRTLText&&am.isParsed())&&(jn=$8(as,at,Ln))}if(sr){const Kn=at.getValueAndResolveTokens("icon-image",Ln,et,Ir);Zn=this.getResolvedImageFromTokens(Kn)}const Qn=this.layers[0];let Hn=!1;if(!Zn&&hr){const Kn=Qn.getAppearances();for(const as of Kn)if(as.getProperty("icon-image")){const es=Qn.getAppearanceValueAndResolveTokens(as,"icon-image",Ln,et,Ir);if(es){Zn=this.getResolvedImageFromTokens(es),Hn=!0;break}}}if(!jn&&!Zn)continue;const Wn=this.sortFeaturesByKey?ur.evaluate(Ln,{},et):void 0,kn={id:en,text:jn,icon:Zn,index:Tn,sourceLayerIndex:ln,geometry:Ln.geometry,properties:Zr.properties,type:PI[Zr.type],sortKey:Wn};if(this.features.push(kn),this.featureToAppearanceIndex[Tn]=this.appearanceFeatureData.length,this.appearanceFeatureData.push({id:en,properties:Zr.properties,usesAppearanceIconAsPlaceholder:Hn,isUsingAppearanceVertexData:!1,layoutBasedVertexData:[],activeAppearance:null}),Zn){const Kn=Qn._unevaluatedLayout._values,{iconPrimary:as,iconSecondary:es}=Kv(Zn,this.iconSizeData,Kn["icon-size"],et,this.zoom,kn,this.pixelRatio,Kt,this.worldview);Mr(as),es&&(this.hasAnySecondaryIcon=!0,Mr(es))}const In=Qn.getAppearances();if(In.length!==0&&In.forEach(Kn=>{if(!Kn.getProperty("icon-image"))return;const as=this.getCombinedIconPrimary(Kn,Qn,Ln,et,Ir,kn,Kt);as&&Mr(as)}),jn){const Kn=gt.evaluate(Ln,{},et).join(","),as=lt.get("text-rotation-alignment")==="map"&&lt.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(d0.vertical)>=0;for(const es of jn.sections)if(es.image){const $s=es.image.getPrimary().scaleSelf(this.pixelRatio),vs=$s.id.toString(),Is=_r.get(vs)||[];Is.push($s),_r.set(vs,Is)}else{const $s=b1(jn.toString()),vs=es.fontStack||Kn,Is=br[vs]=br[vs]||{};this.calculateGlyphDependencies(es.text,Is,as,this.allowVerticalPlacement,$s)}}}if(lt.get("symbol-placement")==="line"&&(this.features=function(Hr){const Zr={},en={},Tn=[];let ln=0;function Fn(Qn){Tn.push(Hr[Qn]),ln++}function Ln(Qn,Hn,Wn){const kn=en[Qn];return delete en[Qn],en[Hn]=kn,Tn[kn].geometry[0].pop(),Tn[kn].geometry[0]=Tn[kn].geometry[0].concat(Wn[0]),kn}function jn(Qn,Hn,Wn){const kn=Zr[Hn];return delete Zr[Hn],Zr[Qn]=kn,Tn[kn].geometry[0].shift(),Tn[kn].geometry[0]=Wn[0].concat(Tn[kn].geometry[0]),kn}function Zn(Qn,Hn,Wn){const kn=Wn?Hn[0][Hn[0].length-1]:Hn[0][0];return`${Qn}:${kn.x}:${kn.y}`}for(let Qn=0;Qn<Hr.length;Qn++){const Hn=Hr[Qn],Wn=Hn.geometry,kn=Hn.text?Hn.text.toString():null;if(!kn){Fn(Qn);continue}const In=Zn(kn,Wn),Kn=Zn(kn,Wn,!0);if(In in en&&Kn in Zr&&en[In]!==Zr[Kn]){const as=jn(In,Kn,Wn),es=Ln(In,Kn,Tn[as].geometry);delete Zr[In],delete en[Kn],en[Zn(kn,Tn[es].geometry,!0)]=es,Tn[as].geometry=null}else In in en?Ln(In,Kn,Wn):Kn in Zr?jn(In,Kn,Wn):(Fn(Qn),Zr[In]=ln-1,en[Kn]=ln-1)}return Tn.filter(Qn=>Qn.geometry)}(this.features)),lt.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",g.elevationFeatures){!this.elevationFeatures&&g.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const Hr of g.elevationFeatures)this.elevationFeatureIdToIndex.set(Hr.id,this.elevationFeatures.length),this.elevationFeatures.push(Hr)}}else lt.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((Hr,Zr)=>Hr.sortKey-Zr.sortKey)}getCombinedIconPrimary(o,g,et,nt,at,lt,ft){let gt,Rt;const Mt=o.getUnevaluatedProperties();if(Mt._values["icon-image"].value!==void 0){const Lt=g.getAppearanceValueAndResolveTokens(o,"icon-image",et,nt,at);gt=this.getResolvedImageFromTokens(Lt)}else{const Lt=g.getValueAndResolveTokens("icon-image",et,nt,at);gt=this.getResolvedImageFromTokens(Lt)}if(gt){const Lt=Mt._values["icon-size"]||g._unevaluatedLayout._values["icon-size"];Rt=Kv(gt,d_(this.zoom,Lt,this.worldview),Lt,nt,this.zoom,lt,this.pixelRatio,ft,this.worldview).iconPrimary}return Rt}updateAppearanceBasedIconTextures(o,g,et,nt){if(!this.appearanceFeatureData||!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)return!1;const at=this.layers[0];let lt=!1,ft=0;const gt=at.layout,[Rt,Mt]=gt.get("icon-size-scale-range"),Lt=pr(1,Rt,Mt);for(let Ht=0;Ht<this.symbolInstances.length;Ht++){const Kt=this.symbolInstances.get(Ht),Qt=this.featureToAppearanceIndex[Kt.featureIndex],sr=Qt!==void 0?this.appearanceFeatureData[Qt]:void 0;if(sr&&Kt.placedIconSymbolIndex>=0){const hr=sr.id,ur=g&&hr!==void 0?g[String(hr)]:void 0,_r={type:"Point",id:sr.id,properties:sr.properties,geometry:[]},br=this.layers[0].appearances&&this.layers[0].appearances.find(Ir=>Ir.isActive({globals:nt,feature:_r,canonical:o,featureState:ur}));if(sr.activeAppearance===br){ft+=Kt.numIconVertices;continue}if(br){sr.activeAppearance=br;const Ir=this.getCombinedIconPrimary(br,at,_r,o,et,{sortKey:void 0,text:void 0,icon:null,index:Kt.featureIndex,sourceLayerIndex:Kt.featureIndex,geometry:[],properties:sr.properties,type:"Point",id:sr.id},Lt);if(!Ir)continue;const Vr=Ir.toString(),Mr=this.iconAtlasPositions&&this.iconAtlasPositions.get(Vr);if(Mr){const Hr=at.getAppearanceValueAndResolveTokens(br,"icon-offset",_r,o,et),Zr=Hr&&Array.isArray(Hr)?Hr:[0,0];let en=kw(Mr,void 0,Zr,at.layout.get("icon-anchor").evaluate(_r,{},o));const Tn=at.getAppearanceValueAndResolveTokens(br,"icon-rotate",_r,o,et),ln=typeof Tn=="number"?Tn:0,Fn=Mr.sdf,Ln=at.layout.get("icon-text-fit").constantOr("none");Ln!=="none"&&sr.textShaping&&sr.iconTextFitPadding&&sr.fontScale&&(en=vC(en,sr.textShaping,Ln,sr.iconTextFitPadding,Zr,sr.fontScale));const jn=this.calculateEffectiveAppearanceIconSize(br,nt.zoom,_r,o,et,Lt),Zn=0,Qn=1+(Math.min(_x,Math.round(jn*gm))<<1),Hn=CC(en,ln,Fn,Ln!=="none",Lt);sr.isUsingAppearanceVertexData||(sr.isUsingAppearanceVertexData=!0,sr.layoutBasedVertexData=this.icon.getIconVertexData(ft,Kt.numIconVertices));for(let kn=0;kn<Hn.length;++kn){const In=Hn[kn],Kn=sr.layoutBasedVertexData[0]||Kt.tileAnchorX,as=sr.layoutBasedVertexData[1]||Kt.tileAnchorY,es=16*In.pixelOffsetTL.x,$s=16*In.pixelOffsetTL.y,vs=16*In.pixelOffsetBR.x,Is=16*In.pixelOffsetBR.y,Ns=16*In.minFontScaleX,Fo=16*In.minFontScaleY;this.icon.updateIconVertexData(ft,Kn,as,Math.round(32*In.tl.x),Math.round(32*In.tl.y),In.texPrimary.x,In.texPrimary.y,Zn,Qn,es,$s,Ns,Fo),this.icon.updateIconVertexData(ft+1,Kn,as,Math.round(32*In.tr.x),Math.round(32*In.tr.y),In.texPrimary.x+In.texPrimary.w,In.texPrimary.y,Zn,Qn,vs,$s,Ns,Fo),this.icon.updateIconVertexData(ft+2,Kn,as,Math.round(32*In.bl.x),Math.round(32*In.bl.y),In.texPrimary.x,In.texPrimary.y+In.texPrimary.h,Zn,Qn,es,Is,Ns,Fo),this.icon.updateIconVertexData(ft+3,Kn,as,Math.round(32*In.br.x),Math.round(32*In.br.y),In.texPrimary.x+In.texPrimary.w,In.texPrimary.y+In.texPrimary.h,Zn,Qn,vs,Is,Ns,Fo),ft+=4}const Wn=Kt.numIconVertices-4*Hn.length;for(let kn=0;kn<Wn;++kn)this.icon.updateIconVertexData(ft+kn,0,0,0,0,0,0,0,0,0,0,0,0);lt=!0}else ft+=Kt.numIconVertices}else if(sr.usesAppearanceIconAsPlaceholder)this.layers[0].appearances&&this.layers[0].appearances.length>0&&(this.icon.updateIconVertexData(ft,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(ft+1,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(ft+2,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(ft+3,0,0,0,0,0,0,0,0,0,0,0,0),lt=!0),ft+=Kt.numIconVertices,sr.activeAppearance=null;else if(sr.isUsingAppearanceVertexData){const Vr=sr.layoutBasedVertexData.length/12;for(let Mr=0;Mr<Vr;++Mr){const Hr=Mr*12;this.icon.updateIconVertexData(ft+Mr,sr.layoutBasedVertexData[Hr+0],sr.layoutBasedVertexData[Hr+1],sr.layoutBasedVertexData[Hr+2],sr.layoutBasedVertexData[Hr+3],sr.layoutBasedVertexData[Hr+4],sr.layoutBasedVertexData[Hr+5],sr.layoutBasedVertexData[Hr+6],sr.layoutBasedVertexData[Hr+7],sr.layoutBasedVertexData[Hr+8],sr.layoutBasedVertexData[Hr+9],sr.layoutBasedVertexData[Hr+10],sr.layoutBasedVertexData[Hr+11])}ft+=Vr,sr.isUsingAppearanceVertexData=!1,sr.activeAppearance=null,lt=!0}else ft+=Kt.numIconVertices,sr.activeAppearance=null}}return lt}update(o,g,et,nt,at,lt,ft){this.text.programConfigurations.updatePaintArrays(o,g,at,et,nt,lt,ft,this.worldview),this.icon.programConfigurations.updatePaintArrays(o,g,at,et,nt,lt,ft,this.worldview)}updateRoadElevation(o){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let g=!1;const et=xr(o),nt=1/et;let at=!1,lt=!1;for(let ft=0;ft<this.symbolInstances.length;ft++){const gt=this.symbolInstances.get(ft),Rt=Cr(1,0,0),Mt=Cr(0,1,0),{numHorizontalGlyphVertices:Lt,numVerticalGlyphVertices:Ht,numIconVertices:Kt,numVerticalIconVertices:Qt}=gt,sr=Lt>0||Ht>0,hr=Kt>0,ur=this.elevationFeatures[gt.elevationFeatureIndex];if(ur){const _r=new zn(gt.tileAnchorX,gt.tileAnchorY),br=.075+ur.pointElevation(_r);gt.zOffset!==br&&(g=!0,gt.zOffset=br),br!==0&&(this.hasAnyZOffset=!0);const Ir=ur.computeSlopeNormal(_r,nt),Vr=ps(ds(),Cr(0,0,1),Ir);Es(Rt,Rt,Vr),Es(Mt,Mt,Vr),Rt[2]*=et,Mt[2]*=et,Rt[0]===1&&Rt[1]===0&&Rt[2]===0&&Mt[0]===0&&Mt[1]===1&&Mt[2]===0||(at=at||sr,lt=lt||hr)}if(sr&&(Vw(this.text.orientationVertexArray,Lt,Rt,Mt),Vw(this.text.orientationVertexArray,Ht,Rt,Mt)),hr){const{placedIconSymbolIndex:_r,verticalPlacedIconSymbolIndex:br}=gt;_r>=0&&Vw(this.icon.orientationVertexArray,Kt,Rt,Mt),br>=0&&Vw(this.icon.orientationVertexArray,Qt,Rt,Mt)}}at||(this.text.orientationVertexArray=void 0),lt||(this.icon.orientationVertexArray=void 0),g&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const o=(at,lt,ft)=>{et+=lt,et>at.length&&at.resize(et);for(let gt=-lt;gt<0;gt++)at.emplace(gt+et,ft)},g=(at,lt,ft)=>{nt+=lt,nt>at.length&&at.resize(nt);for(let gt=-lt;gt<0;gt++)at.emplace(gt+nt,ft)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let et=0,nt=0;for(let at=0;at<this.symbolInstances.length;at++){const lt=this.symbolInstances.get(at),{numHorizontalGlyphVertices:ft,numVerticalGlyphVertices:gt,numIconVertices:Rt}=lt,Mt=lt.zOffset,Lt=Rt>0;if((ft>0||gt>0)&&(o(this.text.zOffsetVertexArray,ft,Mt),o(this.text.zOffsetVertexArray,gt,Mt)),Lt){const{placedIconSymbolIndex:Ht,verticalPlacedIconSymbolIndex:Kt}=lt;Ht>=0&&g(this.icon.zOffsetVertexArray,Rt,Mt),Kt>=0&&g(this.icon.zOffsetVertexArray,lt.numVerticalIconVertices,Mt)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(o,g,et,nt,at){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(o),this.iconCollisionBox.upload(o)),this.text.upload(o,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,!1),this.hasAppearances===null&&(this.hasAppearances=this.layers.some(lt=>lt.appearances&&lt.appearances.length>0)),this.icon.upload(o,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,this.hasAppearances),this.uploaded=!0}updateAppearances(o,g,et,nt){return!!(o&&g&&et)&&!(!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)&&!!this.icon.layoutVertexArray.arrayBuffer&&void(this.updateAppearanceBasedIconTextures(o,g,et,nt)&&this.icon.layoutVertexBuffer&&this.icon.layoutVertexArray.arrayBuffer!==null&&this.icon.layoutVertexArray.length===this.icon.layoutVertexBuffer.length&&this.icon.layoutVertexBuffer.updateData(this.icon.layoutVertexArray))}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=ST(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(o,g){const et=this.lineVertexArray.length;if(o.segment!==void 0)for(const{x:nt,y:at}of g)this.lineVertexArray.emplaceBack(nt,at);return{lineStartIndex:et,lineLength:this.lineVertexArray.length-et}}addSymbols(o,g,et,nt,at,lt,ft,gt,Rt,Mt,Lt,Ht,Kt,Qt,sr,hr,ur,_r){const br=o.indexArray,Ir=o.layoutVertexArray,Vr=o.globeExtVertexArray,Mr=o.segments.prepareSegment(4*_r,Ir,br,this.canOverlap?lt.sortKey:void 0),Hr=this.glyphOffsetArray.length,Zr=Mr.vertexLength,en=this.allowVerticalPlacement&&ft===d0.vertical?Math.PI/2:0,Tn=lt.text&&lt.text.sections;for(let Ln=0;Ln<g.length;Ln++){const{tl:jn,tr:Zn,bl:Qn,br:Hn,texPrimary:Wn,texSecondary:kn,pixelOffsetTL:In,pixelOffsetBR:Kn,minFontScaleX:as,minFontScaleY:es,glyphOffset:$s,isSDF:vs,sectionIndex:Is}=g[Ln],Ns=Mr.vertexLength,Fo=$s[1];if(rE(Ir,Rt.x,Rt.y,jn.x,Fo+jn.y,Wn.x,Wn.y,et,vs,In.x,In.y,as,es),rE(Ir,Rt.x,Rt.y,Zn.x,Fo+Zn.y,Wn.x+Wn.w,Wn.y,et,vs,Kn.x,In.y,as,es),rE(Ir,Rt.x,Rt.y,Qn.x,Fo+Qn.y,Wn.x,Wn.y+Wn.h,et,vs,In.x,Kn.y,as,es),rE(Ir,Rt.x,Rt.y,Hn.x,Fo+Hn.y,Wn.x+Wn.w,Wn.y+Wn.h,et,vs,Kn.x,Kn.y,as,es),gt){const{x:ts,y:Os,z:fo}=gt.anchor,[Ko,xa,wo]=gt.up;iE(Vr,ts,Os,fo,Ko,xa,wo),iE(Vr,ts,Os,fo,Ko,xa,wo),iE(Vr,ts,Os,fo,Ko,xa,wo),iE(Vr,ts,Os,fo,Ko,xa,wo),x_(o.dynamicLayoutVertexArray,ts,Os,fo,en)}else x_(o.dynamicLayoutVertexArray,Rt.x,Rt.y,Rt.z,en);if(hr){const ts=kn||Wn;nE(o.iconTransitioningVertexArray,ts.x,ts.y),nE(o.iconTransitioningVertexArray,ts.x+ts.w,ts.y),nE(o.iconTransitioningVertexArray,ts.x,ts.y+ts.h),nE(o.iconTransitioningVertexArray,ts.x+ts.w,ts.y+ts.h)}br.emplaceBack(Ns,Ns+1,Ns+2),br.emplaceBack(Ns+1,Ns+2,Ns+3),Mr.vertexLength+=4,Mr.primitiveLength+=2,this.glyphOffsetArray.emplaceBack($s[0]),Ln!==g.length-1&&Is===g[Ln+1].sectionIndex||o.programConfigurations.populatePaintArrays(Ir.length,lt,lt.index,{},Kt,Qt,sr,Tn&&Tn[Is],this.worldview)}const ln=_r-g.length;ln!==0&&this._addNullVertices(ln,Ir,et,gt,Vr,o,hr,Mr,br);const Fn=gt?gt.anchor:Rt;o.placedSymbolArray.emplaceBack(Fn.x,Fn.y,Fn.z,Rt.x,Rt.y,Hr,this.glyphOffsetArray.length-Hr,Zr,Mt,Lt,Rt.segment,et?et[0]:0,et?et[1]:0,nt[0],nt[1],ft,0,0,0,Ht,0),o.symbolInstanceIndices.push(ur)}_addNullVertices(o,g,et,nt,at,lt,ft,gt,Rt){for(let Mt=0;Mt<o;Mt++){for(let Ht=0;Ht<4;Ht++)rE(g,0,0,0,0,0,0,et,!1,0,0,0,0),nt&&iE(at,0,0,0,0,0,0),x_(lt.dynamicLayoutVertexArray,0,0,0,0),ft&&nE(lt.iconTransitioningVertexArray,0,0);const Lt=gt.vertexLength;Rt.emplaceBack(Lt,Lt+1,Lt+2),Rt.emplaceBack(Lt+1,Lt+2,Lt+3),gt.vertexLength+=4,gt.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(0)}}_commitLayoutVertex(o,g,et,nt,at,lt,ft){o.emplaceBack(g,et,nt,at,lt,Math.round(ft.x),Math.round(ft.y))}_addCollisionDebugVertices(o,g,et,nt,at,lt,ft){const gt=et.segments.prepareSegment(4,et.layoutVertexArray,et.indexArray),Rt=gt.vertexLength,Mt=ft.tileAnchorX,Lt=ft.tileAnchorY;for(let Kt=0;Kt<4;Kt++)et.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(et.collisionVertexArrayExt,g,o.padding,ft.zOffset),this._commitLayoutVertex(et.layoutVertexArray,nt,at,lt,Mt,Lt,new zn(o.x1,o.y1)),this._commitLayoutVertex(et.layoutVertexArray,nt,at,lt,Mt,Lt,new zn(o.x2,o.y1)),this._commitLayoutVertex(et.layoutVertexArray,nt,at,lt,Mt,Lt,new zn(o.x2,o.y2)),this._commitLayoutVertex(et.layoutVertexArray,nt,at,lt,Mt,Lt,new zn(o.x1,o.y2)),gt.vertexLength+=4;const Ht=et.indexArray;Ht.emplaceBack(Rt,Rt+1),Ht.emplaceBack(Rt+1,Rt+2),Ht.emplaceBack(Rt+2,Rt+3),Ht.emplaceBack(Rt+3,Rt),gt.primitiveLength+=4}_addTextDebugCollisionBoxes(o,g,et,nt,at,lt){for(let ft=nt;ft<at;ft++){const gt=et.get(ft),Rt=this.getSymbolInstanceTextSize(o,lt,g,ft);this._addCollisionDebugVertices(gt,Rt,this.textCollisionBox,gt.projectedAnchorX,gt.projectedAnchorY,gt.projectedAnchorZ,lt)}}_addIconDebugCollisionBoxes(o,g,et,nt,at,lt){for(let ft=nt;ft<at;ft++){const gt=et.get(ft),Rt=this.getSymbolInstanceIconSize(o,g,lt.placedIconSymbolIndex);this._addCollisionDebugVertices(gt,Rt,this.iconCollisionBox,gt.projectedAnchorX,gt.projectedAnchorY,gt.projectedAnchorZ,lt)}}generateCollisionDebugBuffers(o,g,et){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new IC(Vy,$S.members,l0),this.iconCollisionBox=new IC(Vy,$S.members,l0);const nt=h_(this.iconSizeData,o),at=h_(this.textSizeData,o,et);for(let lt=0;lt<this.symbolInstances.length;lt++){const ft=this.symbolInstances.get(lt);this._addTextDebugCollisionBoxes(at,o,g,ft.textBoxStartIndex,ft.textBoxEndIndex,ft),this._addTextDebugCollisionBoxes(at,o,g,ft.verticalTextBoxStartIndex,ft.verticalTextBoxEndIndex,ft),this._addIconDebugCollisionBoxes(nt,o,g,ft.iconBoxStartIndex,ft.iconBoxEndIndex,ft),this._addIconDebugCollisionBoxes(nt,o,g,ft.verticalIconBoxStartIndex,ft.verticalIconBoxEndIndex,ft)}}getSymbolInstanceTextSize(o,g,et,nt){const at=this.text.placedSymbolArray.get(g.rightJustifiedTextSymbolIndex>=0?g.rightJustifiedTextSymbolIndex:g.centerJustifiedTextSymbolIndex>=0?g.centerJustifiedTextSymbolIndex:g.leftJustifiedTextSymbolIndex>=0?g.leftJustifiedTextSymbolIndex:g.verticalPlacedTextSymbolIndex>=0?g.verticalPlacedTextSymbolIndex:nt),lt=EC(this.textSizeData,o,at)/up;return this.tilePixelRatio*lt}getSymbolInstanceIconSize(o,g,et){const nt=this.icon.placedSymbolArray.get(et),at=EC(this.iconSizeData,o,nt);return this.tilePixelRatio*at}_commitDebugCollisionVertexUpdate(o,g,et,nt){o.emplaceBack(g,-et,-et,nt),o.emplaceBack(g,et,-et,nt),o.emplaceBack(g,et,et,nt),o.emplaceBack(g,-et,et,nt)}_updateTextDebugCollisionBoxes(o,g,et,nt,at,lt,ft){for(let gt=nt;gt<at;gt++){const Rt=et.get(gt),Mt=this.getSymbolInstanceTextSize(o,lt,g,gt);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,Mt,Rt.padding,lt.zOffset)}}_updateIconDebugCollisionBoxes(o,g,et,nt,at,lt,ft){for(let gt=nt;gt<at;gt++){const Rt=et.get(gt),Mt=this.getSymbolInstanceIconSize(o,g,lt.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,Mt,Rt.padding,lt.zOffset)}}updateCollisionDebugBuffers(o,g,et,nt){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const at=h_(this.iconSizeData,o,nt),lt=h_(this.textSizeData,o,et);for(let ft=0;ft<this.symbolInstances.length;ft++){const gt=this.symbolInstances.get(ft);this._updateTextDebugCollisionBoxes(lt,o,g,gt.textBoxStartIndex,gt.textBoxEndIndex,gt,et),this._updateTextDebugCollisionBoxes(lt,o,g,gt.verticalTextBoxStartIndex,gt.verticalTextBoxEndIndex,gt,et),this._updateIconDebugCollisionBoxes(at,o,g,gt.iconBoxStartIndex,gt.iconBoxEndIndex,gt,nt),this._updateIconDebugCollisionBoxes(at,o,g,gt.verticalIconBoxStartIndex,gt.verticalIconBoxEndIndex,gt,nt)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(o,g,et,nt,at,lt,ft,gt,Rt){const Mt={};if(g<et){const{x1:Lt,y1:Ht,x2:Kt,y2:Qt,padding:sr,projectedAnchorX:hr,projectedAnchorY:ur,projectedAnchorZ:_r,tileAnchorX:br,tileAnchorY:Ir,featureIndex:Vr}=o.get(g);Mt.textBox={x1:Lt,y1:Ht,x2:Kt,y2:Qt,padding:sr,projectedAnchorX:hr,projectedAnchorY:ur,projectedAnchorZ:_r,tileAnchorX:br,tileAnchorY:Ir},Mt.textFeatureIndex=Vr}if(nt<at){const{x1:Lt,y1:Ht,x2:Kt,y2:Qt,padding:sr,projectedAnchorX:hr,projectedAnchorY:ur,projectedAnchorZ:_r,tileAnchorX:br,tileAnchorY:Ir,featureIndex:Vr}=o.get(nt);Mt.verticalTextBox={x1:Lt,y1:Ht,x2:Kt,y2:Qt,padding:sr,projectedAnchorX:hr,projectedAnchorY:ur,projectedAnchorZ:_r,tileAnchorX:br,tileAnchorY:Ir},Mt.verticalTextFeatureIndex=Vr}if(lt<ft){const{x1:Lt,y1:Ht,x2:Kt,y2:Qt,padding:sr,projectedAnchorX:hr,projectedAnchorY:ur,projectedAnchorZ:_r,tileAnchorX:br,tileAnchorY:Ir,featureIndex:Vr}=o.get(lt);Mt.iconBox={x1:Lt,y1:Ht,x2:Kt,y2:Qt,padding:sr,projectedAnchorX:hr,projectedAnchorY:ur,projectedAnchorZ:_r,tileAnchorX:br,tileAnchorY:Ir},Mt.iconFeatureIndex=Vr}if(gt<Rt){const{x1:Lt,y1:Ht,x2:Kt,y2:Qt,padding:sr,projectedAnchorX:hr,projectedAnchorY:ur,projectedAnchorZ:_r,tileAnchorX:br,tileAnchorY:Ir,featureIndex:Vr}=o.get(gt);Mt.verticalIconBox={x1:Lt,y1:Ht,x2:Kt,y2:Qt,padding:sr,projectedAnchorX:hr,projectedAnchorY:ur,projectedAnchorZ:_r,tileAnchorX:br,tileAnchorY:Ir},Mt.verticalIconFeatureIndex=Vr}return Mt}deserializeCollisionBoxes(o){this.collisionArrays=[];for(let g=0;g<this.symbolInstances.length;g++){const et=this.symbolInstances.get(g);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(o,et.textBoxStartIndex,et.textBoxEndIndex,et.verticalTextBoxStartIndex,et.verticalTextBoxEndIndex,et.iconBoxStartIndex,et.iconBoxEndIndex,et.verticalIconBoxStartIndex,et.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(o,g){const et=o.placedSymbolArray.get(g),nt=et.vertexStartIndex+4*et.numGlyphs;for(let at=et.vertexStartIndex;at<nt;at+=4)o.indexArray.emplaceBack(at,at+1,at+2),o.indexArray.emplaceBack(at+1,at+2,at+3)}getSortedSymbolIndexes(o){if(this.sortedAngle===o&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const g=Math.sin(o),et=Math.cos(o),nt=[],at=[],lt=[];for(let ft=0;ft<this.symbolInstances.length;++ft){lt.push(ft);const gt=this.symbolInstances.get(ft);nt.push(0|Math.round(g*gt.tileAnchorX+et*gt.tileAnchorY)),at.push(gt.featureIndex)}return lt.sort((ft,gt)=>nt[ft]-nt[gt]||at[gt]-at[ft]),lt}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let o=0;o<this.symbolInstances.length;++o)this.symbolInstanceIndexesSortedZOffset.push(o)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((o,g)=>this.symbolInstances.get(g).zOffset-this.symbolInstances.get(o).zOffset)}addToSortKeyRanges(o,g){const et=this.sortKeyRanges[this.sortKeyRanges.length-1];et&&et.sortKey===g?et.symbolInstanceEnd=o+1:this.sortKeyRanges.push({sortKey:g,symbolInstanceStart:o,symbolInstanceEnd:o+1})}sortFeatures(o){if(this.sortFeaturesByY&&this.sortedAngle!==o&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(o),this.sortedAngle=o,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const g of this.symbolInstanceIndexes){const et=this.symbolInstances.get(g);this.featureSortOrder.push(et.featureIndex);const{rightJustifiedTextSymbolIndex:nt,centerJustifiedTextSymbolIndex:at,leftJustifiedTextSymbolIndex:lt,verticalPlacedTextSymbolIndex:ft,placedIconSymbolIndex:gt,verticalPlacedIconSymbolIndex:Rt}=et;nt>=0&&this.addIndicesForPlacedSymbol(this.text,nt),at>=0&&at!==nt&&this.addIndicesForPlacedSymbol(this.text,at),lt>=0&&lt!==at&&lt!==nt&&this.addIndicesForPlacedSymbol(this.text,lt),ft>=0&&this.addIndicesForPlacedSymbol(this.text,ft),gt>=0&&this.addIndicesForPlacedSymbol(this.icon,gt),Rt>=0&&this.addIndicesForPlacedSymbol(this.icon,Rt)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}getElevationFeatureForText(o){const g=this.symbolInstances.get(this.text.symbolInstanceIndices[o]).elevationFeatureIndex;let et;return this.elevationFeatures&&g<this.elevationFeatures.length&&(et=this.elevationFeatures[g]),et}}function TT(b,o){return o.replace(/{([^{}]+)}/g,(g,et)=>et in b?String(b[et]):"")}let RT,IT,DC;Ps(Uw,"SymbolBucket",{omit:["layers","collisionBoxArray","compareText","features"]}),Uw.addDynamicAttributes=x_;class DT{constructor(o){this.type=o.property.overrides?o.property.overrides.runtimeType:vu,this.defaultValue=o}evaluate(o){if(o.formattedSection){const g=this.defaultValue.property.overrides;if(g&&g.hasOverride(o.formattedSection))return g.getOverride(o.formattedSection)}return o.feature&&o.featureState?this.defaultValue.evaluate(o.feature,o.featureState):this.defaultValue.property.specification.default}eachChild(o){this.defaultValue.isConstant()||o(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ps(DT,"FormatSectionOverride",{omit:["defaultValue"]});const PC=()=>DC||(DC={layout:RT||(RT=new Fu({"symbol-placement":new ns(mn.layout_symbol["symbol-placement"]),"symbol-spacing":new ns(mn.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ns(mn.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new hs(mn.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ns(mn.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new ns(mn.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new ns(mn.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new ns(mn.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new ns(mn.layout_symbol["icon-ignore-placement"]),"icon-optional":new ns(mn.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ns(mn.layout_symbol["icon-rotation-alignment"]),"icon-size":new hs(mn.layout_symbol["icon-size"]),"icon-size-scale-range":new ns(mn.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new hs(mn.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new hs(mn.layout_symbol["icon-text-fit-padding"]),"icon-image":new hs(mn.layout_symbol["icon-image"]),"icon-image-use-theme":new ns({type:"string",default:"default","property-type":"data-constant"}),"icon-rotate":new hs(mn.layout_symbol["icon-rotate"]),"icon-padding":new ns(mn.layout_symbol["icon-padding"]),"icon-keep-upright":new ns(mn.layout_symbol["icon-keep-upright"]),"icon-offset":new hs(mn.layout_symbol["icon-offset"]),"icon-anchor":new hs(mn.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ns(mn.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ns(mn.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ns(mn.layout_symbol["text-rotation-alignment"]),"text-field":new hs(mn.layout_symbol["text-field"]),"text-font":new hs(mn.layout_symbol["text-font"]),"text-size":new hs(mn.layout_symbol["text-size"]),"text-size-scale-range":new ns(mn.layout_symbol["text-size-scale-range"]),"text-max-width":new hs(mn.layout_symbol["text-max-width"]),"text-line-height":new hs(mn.layout_symbol["text-line-height"]),"text-letter-spacing":new hs(mn.layout_symbol["text-letter-spacing"]),"text-justify":new hs(mn.layout_symbol["text-justify"]),"text-radial-offset":new hs(mn.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ns(mn.layout_symbol["text-variable-anchor"]),"text-anchor":new hs(mn.layout_symbol["text-anchor"]),"text-max-angle":new ns(mn.layout_symbol["text-max-angle"]),"text-writing-mode":new ns(mn.layout_symbol["text-writing-mode"]),"text-rotate":new hs(mn.layout_symbol["text-rotate"]),"text-padding":new ns(mn.layout_symbol["text-padding"]),"text-keep-upright":new ns(mn.layout_symbol["text-keep-upright"]),"text-transform":new hs(mn.layout_symbol["text-transform"]),"text-offset":new hs(mn.layout_symbol["text-offset"]),"text-allow-overlap":new ns(mn.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new ns(mn.layout_symbol["text-ignore-placement"]),"text-optional":new ns(mn.layout_symbol["text-optional"]),visibility:new ns(mn.layout_symbol.visibility)})),paint:IT||(IT=new Fu({"icon-opacity":new hs(mn.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new hs(mn.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new hs(mn.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new hs(mn.paint_symbol["text-emissive-strength"]),"icon-color":new hs(mn.paint_symbol["icon-color"]),"icon-halo-color":new hs(mn.paint_symbol["icon-halo-color"]),"icon-halo-width":new hs(mn.paint_symbol["icon-halo-width"]),"icon-halo-blur":new hs(mn.paint_symbol["icon-halo-blur"]),"icon-translate":new ns(mn.paint_symbol["icon-translate"]),"icon-translate-anchor":new ns(mn.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new ns(mn.paint_symbol["icon-image-cross-fade"]),"text-opacity":new hs(mn.paint_symbol["text-opacity"]),"text-occlusion-opacity":new hs(mn.paint_symbol["text-occlusion-opacity"]),"text-color":new hs(mn.paint_symbol["text-color"],{runtimeType:Po,getOverride:b=>b.textColor,hasOverride:b=>!!b.textColor}),"text-halo-color":new hs(mn.paint_symbol["text-halo-color"]),"text-halo-width":new hs(mn.paint_symbol["text-halo-width"]),"text-halo-blur":new hs(mn.paint_symbol["text-halo-blur"]),"text-translate":new ns(mn.paint_symbol["text-translate"]),"text-translate-anchor":new ns(mn.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new ns(mn.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new ns(mn.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new ns(mn.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new ns(mn.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new hs(mn.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new hs({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new hs({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new hs({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new hs({type:"string",default:"default","property-type":"data-driven"})}))},DC);class Gw extends Np{constructor(o,g,et,nt){super(o,PC(),g,et,nt,o.layout?o.layout["icon-image-use-theme"]:null),this._colorAdjustmentMatrix=Zt([]),this.hasOcclusionOpacityProperties=o.paint!==void 0&&("icon-occlusion-opacity"in o.paint||"text-occlusion-opacity"in o.paint)}_handleSpecialPaintPropertyUpdate(o){o!=="icon-occlusion-opacity"&&o!=="text-occlusion-opacity"||(this.hasOcclusionOpacityProperties=!0)}recalculate(o,g){super.recalculate(o,g),this.appearances&&this.appearances.forEach(nt=>{nt.recalculate(o,g,this.iconImageUseTheme)}),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const et=this.layout.get("text-writing-mode");if(et){const nt=[];for(const at of et)nt.indexOf(at)<0&&nt.push(at);this.layout._values["text-writing-mode"]=nt}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(o,g,et,nt){return this._saturation===o&&this._contrast===g&&this._brightnessMin===et&&this._brightnessMax===nt||(this._colorAdjustmentMatrix=function(at,lt,ft,gt){at=du(at),lt=na(lt);const Rt=Vt(),Mt=at/3,Lt=1-2*Mt,Ht=[Lt,Mt,Mt,0,Mt,Lt,Mt,0,Mt,Mt,Lt,0,0,0,0,1],Kt=.5-.5*lt,Qt=gt-ft;return Ut(Rt,[Qt,0,0,0,0,Qt,0,0,0,0,Qt,0,ft,ft,ft,1],[lt,0,0,0,0,lt,0,0,0,0,lt,0,Kt,Kt,Kt,1]),Ut(Rt,Rt,Ht),Rt}(o,g,et,nt),this._saturation=o,this._contrast=g,this._brightnessMin=et,this._brightnessMax=nt),this._colorAdjustmentMatrix}getValueAndResolveTokens(o,g,et,nt){const at=this.layout.get(o).evaluate(g,{},et,nt),lt=this._unevaluatedLayout._values[o];return lt.isDataDriven()||v1(lt.value)||!at?at:TT(g.properties,at)}getAppearanceValueAndResolveTokens(o,g,et,nt,at){const lt=o.getProperty(g);if(!lt)return;const ft=lt.evaluate(et,{},nt,at),gt=o.getUnevaluatedProperties()._values[g];return gt.isDataDriven()||v1(gt.value)||!ft||typeof ft!="string"?ft:TT(et.properties,ft)}createBucket(o){return new Uw(o)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const o of PC().paint.overridableProperties){if(!Gw.hasPaintOverride(this.layout,o))continue;const g=this.paint.get(o),et=new DT(g),nt=new wy(et,g.property.specification,this.scope,this.options,this.layout.get("icon-image-use-theme"));let at=null;at=g.value.kind==="constant"||g.value.kind==="source"?new zx("source",nt):new ix("composite",nt,g.value.zoomStops,g.value.interpolationType),this.paint._values[o]=new ox(g.property,at,g.parameters)}}_handleOverridablePaintPropertyUpdate(o,g,et){return!(!this.layout||g.isDataDriven()||et.isDataDriven())&&Gw.hasPaintOverride(this.layout,o)}static hasPaintOverride(o,g){const et=o.get("text-field"),nt=PC().paint.properties[g];let at=!1;const lt=ft=>{for(const gt of ft)if(nt.overrides&&nt.overrides.hasOverride(gt))return void(at=!0)};if(et.value.kind==="constant"&&et.value.value instanceof bp)lt(et.value.value.sections);else if(et.value.kind==="source"){const ft=Rt=>{at||(Rt instanceof pp&&mu(Rt.value)===_0?lt(Rt.value.sections):Rt instanceof i0?lt(Rt.sections):Rt.eachChild(ft))},gt=et.value;gt._styleExpression&&ft(gt._styleExpression.expression)}return at}getProgramIds(){return["symbol"]}getDefaultProgramParams(o,g,et){return{config:new Um(this,{zoom:g,lut:et}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let PT,kT,FT,BT;var kC=Go([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function $w(b,o,g,et,nt,at,lt,ft){const gt=[b,o,1,g,et,1,nt,at,1],Rt=[lt,ft,1],Mt=At([],gt),[Lt,Ht,Kt]=dn(Rt,Rt,Mt);return Pt(gt,gt,[Lt,0,0,0,Ht,0,0,0,Kt])}function MT(b,o,g,et,nt,at,lt,ft){const gt=function(Rt,Mt,Lt,Ht,Kt,Qt,sr,hr){const ur=$w(0,0,1,0,1,1,0,1),_r=$w(Rt,Mt,Lt,Ht,Kt,Qt,sr,hr);return Pt(_r,_r,At([],ur))}(b,o,g,et,nt,at,lt,ft);return[gt[2]/gt[8]/ss,gt[5]/gt[8]/ss]}function Hw(b){return[b[0],Math.min(Math.max(b[1],-nr),nr)]}class NT extends x0{constructor(o,g,et,nt){super(),this.id=o,this.dispatcher=et,this.coordinates=g.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(nt),this.options=g,this._dirty=!1}load(o,g){if(this._loaded=g||!1,this.fire(new m0("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return o&&(this.coordinates=o),this._loaded=!0,void this._finishLoading();this._imageRequest=z0(this.map._requestManager.transformRequest(this.url,Bl.Image),(et,nt)=>{this._imageRequest=null,this._loaded=!0,et?this.fire(new Zm(et)):nt&&(this.image=nt instanceof HTMLImageElement?uo.getImageData(nt):nt,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,o&&(this.coordinates=o),this._finishLoading())})}loaded(){return this._loaded}updateImage(o){return o.url?(this._imageRequest&&o.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=o.url,this.load(o.coordinates,this._loaded),this):this}setTexture(o){if(!(o.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new Uv(this.map.painter.context,o.handle),this.width=o.dimensions[0],this.height=o.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new m0("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(o){this.map=o,this.load()}onRemove(o){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof Uv||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(o){if(this.coordinates=o,this._boundsArray=void 0,this._unsupportedCoords=!1,!o.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let g=o[0][1],et=o[0][1];for(const at of o)at[1]>et&&(et=at[1]),at[1]<g&&(g=at[1]);const nt=(et+g)/2;if(nt>nr?this.onNorthPole=!0:nt<-nr&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const at=o.map(Ar.fromLngLat);this.tileID=function(lt){let ft=1/0,gt=1/0,Rt=-1/0,Mt=-1/0;for(const sr of lt)ft=Math.min(ft,sr.x),gt=Math.min(gt,sr.y),Rt=Math.max(Rt,sr.x),Mt=Math.max(Mt,sr.y);const Lt=Math.max(Rt-ft,Mt-gt),Ht=Math.max(0,Math.floor(-Math.log2(Lt))),Kt=Math.pow(2,Ht);let Qt=Math.floor((ft+Rt)/2*Kt);return Qt>1&&(Qt-=1),new Yl(Ht,Qt,Math.floor((gt+Mt)/2*Kt))}(at),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new m0("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof Uv||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(o){for(const ur in this.tiles){const _r=this.tiles[ur];_r.state!=="loaded"&&(_r.state="loaded",_r.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const g=Yv(new Yl(0,0,0),this.map.transform.projection),et=[g.projection.project(this.coordinates[0][0],this.coordinates[0][1]),g.projection.project(this.coordinates[1][0],this.coordinates[1][1]),g.projection.project(this.coordinates[2][0],this.coordinates[2][1]),g.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(ur){const _r=ur[1].x-ur[0].x,br=ur[1].y-ur[0].y,Ir=ur[2].x-ur[1].x,Vr=ur[2].y-ur[1].y,Mr=ur[3].x-ur[2].x,Hr=ur[3].y-ur[2].y,Zr=ur[0].x-ur[3].x,en=ur[0].y-ur[3].y,Tn=_r*Vr-Ir*br,ln=Ir*Hr-Mr*Vr,Fn=Mr*en-Zr*Hr,Ln=Zr*br-_r*en;return Tn>0&&ln>0&&Fn>0&&Ln>0||Tn<0&&ln<0&&Fn<0&&Ln<0}(et))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const nt=Yv(this.tileID,this.map.transform.projection),[at,lt,ft,gt]=this.coordinates.map(ur=>{const _r=nt.projection.project(ur[0],ur[1]);return ET(nt,_r)._round()});this.perspectiveTransform=MT(at.x,at.y,lt.x,lt.y,ft.x,ft.y,gt.x,gt.y);const Rt=this._boundsArray=new $x;Rt.emplaceBack(at.x,at.y,0,0),Rt.emplaceBack(lt.x,lt.y,ss,0),Rt.emplaceBack(gt.x,gt.y,0,ss),Rt.emplaceBack(ft.x,ft.y,ss,ss),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=o.createVertexBuffer(Rt,kC.members),this.boundsSegments=Eu.simpleSegment(0,0,4,2);const Mt=[],Lt=[Hw((Ht=this.coordinates)[0]),Hw(Ht[1]),Hw(Ht[2]),Hw(Ht[3])];var Ht;const[Kt,Qt,sr,hr]=function(ur){let _r=ur[0][0],br=_r,Ir=ur[0][1],Vr=Ir;for(let Mr=1;Mr<ur.length;Mr++)ur[Mr][0]<_r?_r=ur[Mr][0]:ur[Mr][0]>br&&(br=ur[Mr][0]),ur[Mr][1]<Ir?Ir=ur[Mr][1]:ur[Mr][1]>Vr&&(Vr=ur[Mr][1]);return[_r,Ir,br-_r,Vr-Ir]}(Lt);{const ur=new $x,[_r,br,Ir,Vr]=function(Hn){let Wn=Hn[0].x,kn=Wn,In=Hn[0].y,Kn=In;for(let as=1;as<Hn.length;as++)Hn[as].x<Wn?Wn=Hn[as].x:Hn[as].x>kn&&(kn=Hn[as].x),Hn[as].y<In?In=Hn[as].y:Hn[as].y>Kn&&(Kn=Hn[as].y);return[Wn,In,kn-Wn,Kn-In]}(et),Mr=Hn=>[(Hn.x-_r)/Ir,(Hn.y-br)/Vr],[Hr,Zr,en,Tn]=et.map(Mr),ln=function(Hn,Wn,kn,In,Kn,as,es,$s){const vs=$w(0,0,1,0,1,1,0,1);return Pt(vs,vs,At([],$w(Hn,Wn,kn,In,Kn,as,es,$s)))}(Hr[0],Hr[1],Zr[0],Zr[1],en[0],en[1],Tn[0],Tn[1]);this.elevatedGlobePerspectiveTransform=MT(Hr[0],Hr[1],Zr[0],Zr[1],en[0],en[1],Tn[0],Tn[1]);const Fn=(Hn,Wn)=>{Mt.push(Hn.lng);const kn=Math.round((Hn.lng-Kt)/sr*ss),In=Math.round((Hn.lat-Qt)/hr*ss),Kn=Mr(Wn),as=dn([],[Kn[0],Kn[1],1],ln),es=Math.round(as[0]/as[2]*ss),$s=Math.round(as[1]/as[2]*ss);ur.emplaceBack(kn,In,es,$s)},Ln=et[3].x-et[0].x,jn=et[3].y-et[0].y,Zn=et[2].x-et[1].x,Qn=et[2].y-et[1].y;for(let Hn=0;Hn<65;Hn++){const Wn=Hn/64,kn=[et[0].x+Wn*Ln,et[0].y+Wn*jn],In=[et[1].x+Wn*Zn,et[1].y+Wn*Qn],Kn=In[0]-kn[0],as=In[1]-kn[1];for(let es=0;es<65;es++){const $s=es/64,vs={x:kn[0]+Kn*$s,y:kn[1]+as*$s};Fn(g.projection.unproject(vs.x,vs.y),vs)}}this.elevatedGlobeVertexBuffer=o.createVertexBuffer(ur,kC.members)}{this.maxLongitudeTriangleSize=0;let ur=[],_r=new _f;const br=(Ir,Vr,Mr)=>{_r.emplaceBack(Ir,Vr,Mr);const Hr=Mt[Ir],Zr=Mt[Vr],en=Mt[Mr],Tn=Math.min(Math.min(Hr,Zr),en),ln=Math.max(Math.max(Hr,Zr),en)-Tn;ln>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=ln),ur.push(Tn+ln/2)};for(let Ir=0;Ir<64;Ir++)for(let Vr=0;Vr<64;Vr++){const Mr=65*Ir+Vr,Hr=Mr+1,Zr=Mr+65,en=Zr+1;br(Mr,Zr,Hr),br(Hr,Zr,en)}[ur,_r]=function(Ir,Vr){const Mr=Array.from({length:Ir.length},(en,Tn)=>Tn);Mr.sort((en,Tn)=>Ir[en]-Ir[Tn]);const Hr=[],Zr=new _f;for(let en=0;en<Mr.length;en++){const Tn=Mr[en];Hr.push(Ir[Tn]);const ln=3*Tn,Fn=ln+1;Zr.emplaceBack(Vr.uint16[ln],Vr.uint16[Fn],Vr.uint16[Fn+1])}return[Hr,Zr]}(ur,_r),this.elevatedGlobeTrianglesCenterLongitudes=ur,this.elevatedGlobeIndexBuffer=o.createIndexBuffer(_r)}this.elevatedGlobeSegments=Eu.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,sr/ss,0,hr/ss,0,0,Qt,Kt,0])}prepare(){const o=Object.keys(this.tiles).length!==0;if(this.tileID&&!o)return;const g=this.map.painter.context,et=g.gl;!this._dirty||this.texture instanceof Uv||(this.texture?this.texture.update(this.image):(this.texture=new nC(g,this.image,et.RGBA8),this.texture.bind(et.LINEAR,et.CLAMP_TO_EDGE)),this._dirty=!1),o&&this._prepareData(g)}loadTile(o,g){this.tileID&&this.tileID.equals(o.tileID.canonical)?(this.tiles[String(o.tileID.wrap)]=o,o.buckets={},g(null)):(o.state="errored",g(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(o){const g=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!g)return null;const et=this.elevatedGlobeTrianglesCenterLongitudes;let nt=(at=o+180)+360*Math.round((et[0]-at)/360);var at;const lt=new Eu,ft=(Lt,Ht)=>{lt.segments.push({vertexOffset:0,primitiveOffset:Lt,vertexLength:g.segments[0].vertexLength,primitiveLength:Ht,sortKey:void 0,vaos:{}})},gt=.51*this.maxLongitudeTriangleSize;if(Math.abs(et[0]-nt)<=gt){const Lt=uu(et,0,et.length,nt+gt);return Lt===et.length||ft(Lt,zo(et,Lt+1,et.length,nt+360-gt)-Lt),lt}nt<et[0]&&(nt+=360);const Rt=zo(et,0,et.length,nt-gt);if(Rt===et.length)return ft(0,et.length),lt;ft(0,Rt-0);const Mt=uu(et,Rt+1,et.length,nt+gt);return Mt!==et.length&&ft(Mt,et.length-Mt),lt}}const BI=(Math.pow(256,2)-1)/16907520;class OT extends Np{constructor(o,g,et,nt){super(o,{layout:FT||(FT=new Fu({visibility:new ns(mn.layout_raster.visibility)})),paint:BT||(BT=new Fu({"raster-opacity":new ns(mn.paint_raster["raster-opacity"]),"raster-color":new lx(mn.paint_raster["raster-color"]),"raster-color-mix":new ns(mn.paint_raster["raster-color-mix"]),"raster-color-range":new ns(mn.paint_raster["raster-color-range"]),"raster-hue-rotate":new ns(mn.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ns(mn.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ns(mn.paint_raster["raster-brightness-max"]),"raster-saturation":new ns(mn.paint_raster["raster-saturation"]),"raster-contrast":new ns(mn.paint_raster["raster-contrast"]),"raster-resampling":new ns(mn.paint_raster["raster-resampling"]),"raster-fade-duration":new ns(mn.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new ns(mn.paint_raster["raster-emissive-strength"]),"raster-array-band":new ns(mn.paint_raster["raster-array-band"]),"raster-elevation":new ns(mn.paint_raster["raster-elevation"]),"raster-color-use-theme":new hs({type:"string",default:"default","property-type":"data-driven"})}))},g,et,nt),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(o){return!(o&&o._source instanceof NT&&(o._source.onNorthPole||o._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(o){o!=="raster-color"&&o!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}updateColorRamp(o){if(!this.hasColorMap()||!this._curRampRange)return;const g=this._transitionablePaint._values["raster-color"].value.expression,[et,nt]=o||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(et)&&isNaN(nt)||et===this._curRampRange[0]&&nt===this._curRampRange[1]||(this.colorRamp=Tv({expression:g,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:et,end:nt}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[et,nt])}}let LT,jT,zT,VT,UT;class GT extends Np{constructor(o,g,et,nt){super(o,{layout:LT||(LT=new Fu({visibility:new ns(mn["layout_raster-particle"].visibility)})),paint:jT||(jT=new Fu({"raster-particle-array-band":new ns(mn["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new ns(mn["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new lx(mn["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new ns(mn["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new ns(mn["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new ns(mn["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new ns(mn["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new ns(mn["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new hs({type:"string",default:"default","property-type":"data-driven"})}))},g,et,nt),this._updateColorRamp(),this.lastInvalidatedAt=uo.now()}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null)}onRemove(o){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(o){return!1}_handleSpecialPaintPropertyUpdate(o){o!=="raster-particle-color"&&o!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),o==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const o=this._transitionablePaint._values["raster-particle-color"].value.expression,g=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Tv({expression:o,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:g}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=uo.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class MI extends Np{constructor(o,g){super(o,{},g,null),this.implementation=o,o.slot&&(this.slot=o.slot)}is3D(o){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(o){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(o){this.implementation.onAdd&&this.implementation.onAdd(o,o.painter.context.gl)}onRemove(o){this.implementation.onRemove&&this.implementation.onRemove(o,o.painter.context.gl)}}function FC(b,o,g){const et=[0,0,1],nt=Mn([]);return Ds(nt,nt,g?-Bo(b)+Math.PI:Bo(b)),Cs(nt,nt,-Bo(o)),Es(et,et,nt),ws(et,et)}const $T={None:0,Model:1,Symbol:2,FillExtrusion:4};class Ww{constructor(o,g,et,nt){this.message=(o?`${o}: `:"")+et,nt&&(this.identifier=nt),g!=null&&g.__line__&&(this.line=g.__line__)}}function BC(b,o){const g=b.indexOf("://")===-1;try{return new URL(b,g&&o?"http://example.com":void 0),!0}catch{return!1}}class HT{constructor(o,g){this.feature=o,this.instancedDataOffset=g,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class WT{constructor(){this.maxScale=1,this.maxXYTranslationDistance=0,this.instancedDataArray=new xv,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}colorForInstance(o){const g=16*o,et=this.instancedDataArray.float32;let nt=Math.floor(et[g+2]);const at=1.05*(et[g+2]-nt);return nt/=100,[et[g]%1*1.05,et[g+1]%1*1.05,at,nt]}tileCoordinatesForInstance(o){const g=16*o,et=this.instancedDataArray.float32;let nt=et[g+0];return nt=nt>ss?nt-ss:nt,new zn(Math.trunc(nt),Math.trunc(et[g+1]))}translationForInstance(o){const g=16*o,et=this.instancedDataArray.float32;return[et[g+4],et[g+5],et[g+6]]}rotationScaleForInstance(o){const g=16*o,et=this.instancedDataArray.float32;return[et[g+7],et[g+8],et[g+9],et[g+10],et[g+11],et[g+12],et[g+13],et[g+14],et[g+15]]}transformForInstance(o){const g=16*o,et=this.instancedDataArray.float32;return[et[g+7],et[g+8],et[g+9],et[g+4],et[g+10],et[g+11],et[g+12],et[g+5],et[g+13],et[g+14],et[g+15],et[g+6],0,0,0,1]}}class MC{constructor(o){this.zoom=o.zoom,this.canonical=o.canonical,this.overscaledZ=this.canonical.z+Math.log2(o.overscaling),this.layers=o.layers,this.layerIds=this.layers.map(g=>g.fqid),this.projection=o.projection,this.index=o.index,this.worldview=o.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z+1?0:this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=o.styleDefinedModelURLs,this.hasAppearances=null}updateFootprints(o,g){}updateAppearances(o,g,et,nt){}populate(o,g,et,nt){this.tileToMeter=xr(et);const at=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:lt,id:ft,index:gt,sourceLayerIndex:Rt}of o){const Mt=ft??(lt.properties&&lt.properties.hasOwnProperty("id")?lt.properties.id:void 0),Lt=an(lt,at);if(!this.layers[0]._featureFilter.filter(new ou(this.zoom,{worldview:this.worldview,activeFloors:g.activeFloors}),Lt,et))continue;const Ht={id:Mt,sourceLayerIndex:Rt,index:gt,geometry:at?Lt.geometry:Xr(lt,et,nt),properties:lt.properties,type:lt.type,patterns:{}},Kt=this.addFeature(Ht,Ht.geometry,Lt);Kt&&g.featureIndex.insert(lt,Ht.geometry,gt,Rt,this.index,this.instancesPerModel[Kt].instancedDataArray.length,ss/32)}this.lookup=null}evaluateQueryRenderedFeaturePadding(){const o=this.layers[0].modelManager,g=this.layers[0].scope;let et=0;for(const nt of this.modelUris){const at=o.getModel(nt,g);if(!at)continue;const lt=this.instancesPerModel[nt];if(lt){const ft=.5*Fs(at.aabb.max,at.aabb.min)*lt.maxScale+lt.maxXYTranslationDistance,gt=Math.min(ss,Math.max(ft/this.tileToMeter,ss/32));et=Math.max(gt,et)}}return et}update(o,g,et,nt){for(const at in this.instancesPerModel){const lt=this.instancesPerModel[at];for(const ft in o)lt.idToFeaturesIndex.hasOwnProperty(ft)&&(this.evaluate(lt.features[lt.idToFeaturesIndex[ft]],o[ft],lt,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let o=!1;for(const g in this.instancesPerModel){const et=this.instancesPerModel[g];for(const nt of et.features){const at=this.layers[0],lt=nt.feature,ft=this.canonical,gt=at.paint.get("model-rotation").evaluate(lt,{},ft),Rt=at.paint.get("model-scale").evaluate(lt,{},ft),Mt=at.paint.get("model-translation").evaluate(lt,{},ft);no(nt.rotation,gt)&&no(nt.scale,Rt)&&no(nt.translation,Mt)||(this.evaluate(nt,nt.featureStates,et,!0),o=!0)}}return o}updateReplacement(o,g,et,nt){if(g.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=g.updateTime;const at=g.getReplacementRegionsForTile(o.toUnwrapped(),!0);if(mw(this.activeReplacements,at))return!1;this.activeReplacements=at;let lt=!1;for(const ft in this.instancesPerModel){const gt=this.instancesPerModel[ft],Rt=gt.instancedDataArray;for(const Mt of gt.features){const Lt=Mt.instancedDataOffset,Ht=Mt.instancedDataCount;for(let Kt=0;Kt<Ht;Kt++){const Qt=16*(Kt+Lt);let sr=Rt.float32[Qt+0];const hr=sr>ss;sr=hr?sr-ss:sr;const ur=Math.floor(sr),_r=Math.floor(Rt.float32[Qt+1]);let br=!1;for(const Ir of this.activeReplacements)if(!kA(Ir,et,$T.Model,nt)&&!(Ir.min.x>ur||ur>Ir.max.x||Ir.min.y>_r||_r>Ir.max.y)&&(br=OA(NA(ur,_r,o.canonical,Ir.footprintTileId.canonical),Ir.footprint),br))break;Rt.float32[Qt]=br?sr+ss:sr,lt=lt||br!==hr}}}return lt}isEmpty(){for(const o in this.instancesPerModel)if(this.instancesPerModel[o].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(o){if(!this.uploaded)for(const g in this.instancesPerModel){const et=this.instancesPerModel[g];et.instancedDataArray.length<0||et.instancedDataArray.length===0||(et.instancedDataBuffer?et.instancedDataBuffer.updateData(et.instancedDataArray):et.instancedDataBuffer=o.createVertexBuffer(et.instancedDataArray,i8.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(o){for(const et in this.instancesPerModel){const nt=this.instancesPerModel[et];nt.instancedDataArray.length!==0&&nt.instancedDataBuffer&&nt.instancedDataBuffer.destroy()}const g=this.layers[0].modelManager;if(o&&g&&this.modelUris&&this.modelsRequested)for(const et of this.modelUris)g.removeModel(et,"",!0)}addFeature(o,g,et){const nt=this.layers[0],at=nt.layout.get("model-id").evaluate(et,{},this.canonical);if(!at)return bs(`modelId is not evaluated for layer ${nt.id} and it is not going to get rendered.`),at;(BC(at,!1)||this.styleDefinedModelURLs[at]!==void 0)&&(this.modelUris.includes(at)||this.modelUris.push(at)),this.instancesPerModel[at]||(this.instancesPerModel[at]=new WT);const lt=this.instancesPerModel[at],ft=lt.instancedDataArray,gt=new HT(et,ft.length);for(const Rt of g)for(const Mt of Rt){if(Mt.x<0||Mt.x>=ss||Mt.y<0||Mt.y>=ss)continue;if(this.lookupDim!==0){const Ht=(this.lookupDim-1)/ss,Kt=this.lookupDim*(Mt.y*Ht|0)+Mt.x*Ht|0;if(this.lookup){if(this.lookup[Kt]!==0)continue;this.lookup[Kt]=1}}this.instanceCount++;const Lt=ft.length;ft.resize(Lt+1),lt.instancesEvaluatedElevation.push(0),ft.float32[16*Lt]=Mt.x,ft.float32[16*Lt+1]=Mt.y}return gt.instancedDataCount=lt.instancedDataArray.length-gt.instancedDataOffset,gt.instancedDataCount>0&&(o.id&&(lt.idToFeaturesIndex[o.id]=lt.features.length),lt.features.push(gt),this.evaluate(gt,{},lt,!1)),at}getModelUris(){return this.modelUris}evaluate(o,g,et,nt){const at=this.layers[0],lt=o.feature,ft=this.canonical,gt=o.rotation=at.paint.get("model-rotation").evaluate(lt,g,ft),Rt=o.scale=at.paint.get("model-scale").evaluate(lt,g,ft),Mt=o.translation=at.paint.get("model-translation").evaluate(lt,g,ft),Lt=Object.assign({},at.paint.get("model-color").evaluate(lt,g,ft));Lt.a=at.paint.get("model-color-mix-intensity").evaluate(lt,g,ft);const Ht=[];this.maxVerticalOffset<Mt[2]&&(this.maxVerticalOffset=Mt[2]);const Kt=Mt[0]*Mt[0]+Mt[1]*Mt[1],Qt=Kt>0?Math.sqrt(Kt):0;et.maxScale=Math.max(Math.max(et.maxScale,Rt[0]),Math.max(Rt[1],Rt[2])),et.maxXYTranslationDistance=Math.max(et.maxXYTranslationDistance,Qt),this.maxScale=Math.max(Math.max(this.maxScale,Rt[0]),Math.max(Rt[1],Rt[2])),wS(Ht,gt,Rt);const sr=Math.round(100*Lt.a)+Lt.b/1.05;for(let hr=0;hr<o.instancedDataCount;++hr){const ur=o.instancedDataOffset+hr,_r=16*ur,br=et.instancedDataArray.float32;let Ir=0;nt&&(Ir=br[_r+6]-et.instancesEvaluatedElevation[ur]);const Vr=0|br[_r+1];br[_r]=(0|br[_r])+Lt.r/1.05,br[_r+1]=Vr+Lt.g/1.05,br[_r+2]=sr,br[_r+3]=1/(ft.z>10?this.tileToMeter:xr(ft,Vr)),br[_r+4]=Mt[0],br[_r+5]=Mt[1],br[_r+6]=Mt[2]+Ir,br[_r+7]=Ht[0],br[_r+8]=Ht[1],br[_r+9]=Ht[2],br[_r+10]=Ht[4],br[_r+11]=Ht[5],br[_r+12]=Ht[6],br[_r+13]=Ht[8],br[_r+14]=Ht[9],br[_r+15]=Ht[10],et.instancesEvaluatedElevation[ur]=Mt[2]}}}let qT,XT;Ps(MC,"ModelBucket",{omit:["layers"]}),Ps(WT,"PerModelAttributes"),Ps(HT,"ModelFeature");class g_{constructor(o,g,et){this._demTile=o,this._dem=this._demTile.dem,this._scale=g,this._offset=et}static create(o,g,et){const nt=et||o.findDEMTileFor(g);if(!nt||!nt.dem)return;const at=nt.dem,lt=nt.tileID,ft=1<<g.canonical.z-lt.canonical.z;return new g_(nt,at.dim/ss/ft,[(g.canonical.x/ft-lt.canonical.x)*at.dim,(g.canonical.y/ft-lt.canonical.y)*at.dim])}tileCoordToPixel(o,g){const et=g*this._scale+this._offset[1];return new zn(Math.floor(o*this._scale+this._offset[0]),Math.floor(et))}getElevationAt(o,g,et,nt){const at=o*this._scale+this._offset[0],lt=g*this._scale+this._offset[1],ft=Math.floor(at),gt=Math.floor(lt),Rt=this._dem;return nt=!!nt,et?so(so(Rt.get(ft,gt,nt),Rt.get(ft,gt+1,nt),lt-gt),so(Rt.get(ft+1,gt,nt),Rt.get(ft+1,gt+1,nt),lt-gt),at-ft):Rt.get(ft,gt,nt)}getElevationAtPixel(o,g,et){return this._dem.get(o,g,!!et)}getMeterToDEM(o){return(1<<this._demTile.tileID.canonical.z)*$t(1,o)*this._dem.stride}}const NC=new Float32Array(262144),U1=new Uint8Array(262144);function KT(b){let o=0;if(b.meshes)for(const g of b.meshes)o=Math.max(o,g.aabb.max[2]);if(b.children)for(const g of b.children)o=Math.max(o,KT(g));return o}function ZT(b,o,g){if(b.meshes)for(const et of b.meshes){if(et.aabb.min[0]===1/0)continue;const nt=zs.applyTransform(et.aabb,b.globalMatrix);g.insert(o,nt.min[0],nt.min[1],nt.max[0],nt.max[1])}if(b.children)for(const et of b.children)ZT(et,o,g)}const YT=["","wall","door","roof","window","lamp","logo"];class QT{constructor(o){this.node=o,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:o.id,geometry:[],properties:{height:KT(o)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new zs([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let o=0;const g=new zs([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const et of this.node.meshes)this.node.lightMeshIndex!==o&&(et.transformedAabb=zs.applyTransformFast(et.aabb,this.node.globalMatrix),g.encapsulate(et.transformedAabb)),o++;this.aabb=g}return this.aabb}}class qw{constructor(o,g,et,nt,at,lt,ft,gt){this.id=et,this.layers=o,this.layerIds=this.layers.map(Rt=>Rt.fqid),this.stateDependentLayerIds=this.layers.filter(Rt=>Rt.isStateDependent()).map(Rt=>Rt.id),this.modelTraits|=l_.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,nt&&(this.modelTraits|=l_.HasMapboxMeshFeatures),at&&(this.modelTraits|=l_.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=lt,this.worldview=gt,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const Rt of g)this.nodesInfo.push(new QT(Rt)),ZT(Rt,ft.featureIndexArray.length,ft.grid),ft.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,ft.bucketLayerIDs.length-1,0);this.states={},this.hasAppearances=null}updateFootprints(o,g){for(const et of this.getNodesInfo()){const nt=et.node;nt.footprint&&g.push({footprint:nt.footprint,id:o})}}updateAppearances(o,g,et,nt){}update(o){const g=Object.keys(o).length!==0;if(g&&!this.stateDependentLayers.length)return;const et=g?this.stateDependentLayers:this.layers;if(!Vu(o,this.states))for(const nt of et)this.evaluate(nt,o);this.states=structuredClone(o)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(o){if(!this.needsUpload)return;const g=this.getNodesInfo();for(const et of g){const nt=et.node;this.uploaded?this.updatePbrBuffer(nt):oC(nt,o,!0)}for(const et of g)Rw(et.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(o){let g=!1;if(!o.meshes)return g;for(const et of o.meshes)et.pbrBuffer&&(et.pbrBuffer.updateData(et.featureArray),g=!0);return g}needsReEvaluation(o,g,et){const nt=o.transform.projectionOptions,at=o.style.getBrightness(),lt=this.brightness!==at;if(!this.uploaded||this.dirty||nt.name!==this.projection.name||sE(et.paint.get("model-color").value,lt)||sE(et.paint.get("model-color-mix-intensity").value,lt)||sE(et.paint.get("model-roughness").value,lt)||sE(et.paint.get("model-emissive-strength").value,lt)||sE(et.paint.get("model-height-based-emissive-strength-multiplier").value,lt)){this.projection=nt,this.brightness=at;const ft=this.getNodesInfo();for(const gt of ft)gt.state=null;return!0}return!1}evaluateTransform(o,g){if(o.transform.zoom===this.zoom)return;this.zoom=o.transform.zoom;const et=this.getNodesInfo(),nt=this.id.canonical;for(const at of et){const lt=at.feature;at.evaluatedTranslation=g.paint.get("model-translation").evaluate(lt,{},nt),at.evaluatedScale=g.paint.get("model-scale").evaluate(lt,{},nt)}}evaluate(o,g){const et=this.getNodesInfo();for(const nt of et){if(!nt.node.meshes)continue;const at=nt.feature,lt=g&&g[at.id];if(Vu(lt,nt.state))continue;nt.state=structuredClone(lt);const ft=nt.node.meshes&&nt.node.meshes[0].featureData,gt=nt.evaluatedColor[2],Rt=nt.evaluatedRMEA[2],Mt=this.id.canonical;if(nt.hasTranslucentParts=!1,ft){for(let Lt=0;Lt<YT.length;Lt++){const Ht=YT[Lt];Ht.length&&(at.properties.part=Ht);const Kt=o.paint.get("model-color").evaluate(at,lt,Mt).toPremultipliedRenderColor(null),Qt=o.paint.get("model-color-mix-intensity").evaluate(at,lt,Mt);nt.evaluatedColor[Lt]=[Kt.r,Kt.g,Kt.b,Qt],nt.evaluatedRMEA[Lt][0]=o.paint.get("model-roughness").evaluate(at,lt,Mt),nt.evaluatedRMEA[Lt][2]=o.paint.get("model-emissive-strength").evaluate(at,lt,Mt),nt.evaluatedRMEA[Lt][3]=Kt.a,nt.emissionHeightBasedParams[Lt]=o.paint.get("model-height-based-emissive-strength-multiplier").evaluate(at,lt,Mt),!nt.hasTranslucentParts&&Kt.a<1&&(nt.hasTranslucentParts=!0)}delete at.properties.part,OI(nt,gt!==nt.evaluatedColor[2]||Rt!==nt.evaluatedRMEA[2],this.modelTraits)}else nt.evaluatedRMEA[0][2]=o.paint.get("model-emissive-strength").evaluate(at,lt,Mt);nt.evaluatedTranslation=o.paint.get("model-translation").evaluate(at,lt,Mt),nt.evaluatedScale=o.paint.get("model-scale").evaluate(at,lt,Mt),this.updatePbrBuffer(nt.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(o,g,et,nt){const at=o.findDEMTileFor(et);if(at&&(at.tileID.canonical!==this.terrainTile||g!==this.terrainExaggeration)){if(at.dem&&at.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=at.tileID.overscaledZ;const lt=g_.create(o,et,at);if(!lt)return;this.modelTraits&l_.HasMapboxMeshFeatures&&this.updateDEM(o,lt,et,nt);for(const ft of this.getNodesInfo()){const gt=ft.node;if(!gt.footprint||!gt.footprint.vertices||!gt.footprint.vertices.length)continue;const Rt=gt.footprint.vertices;let Mt=lt.getElevationAt(Rt[0].x,Rt[0].y,!0,!0);for(let Lt=1;Lt<Rt.length;Lt++)Mt=Math.min(Mt,lt.getElevationAt(Rt[Lt].x,Rt[Lt].y,!0,!0));gt.elevation=Mt}}this.terrainTile=at.tileID.canonical,this.terrainExaggeration=g}}updateDEM(o,g,et,nt){let at=g._dem._modifiedForSources[nt];if(at===void 0&&(g._dem._modifiedForSources[nt]=[],at=g._dem._modifiedForSources[nt]),at.includes(et.canonical))return;const lt=g._dem.dim;at.push(et.canonical);let ft=!1;for(const gt of this.getNodesInfo()){const Rt=gt.node;if(!Rt.footprint||!Rt.footprint.grid)continue;const Mt=Rt.footprint.grid,Lt=g.tileCoordToPixel(Mt.min.x,Mt.min.y),Ht=g.tileCoordToPixel(Mt.max.x,Mt.max.y),Kt=Math.min(Math.min(lt-Ht.y,Lt.x),Math.min(Lt.y,lt-Ht.x));if(Kt<0)continue;const Qt=pr(Kt,2,5);let sr=Math.max(0,Lt.x-Qt),hr=Math.max(0,Lt.y-Qt),ur=Math.min(Ht.x+Qt,lt-1),_r=Math.min(Ht.y+Qt,lt-1);for(let Mr=hr;Mr<=_r;++Mr)for(let Hr=sr;Hr<=ur;++Hr)U1[Mr*lt+Hr]=255;let br=0,Ir=0;for(let Mr=0;Mr<Mt.cellsY;++Mr)for(let Hr=0;Hr<Mt.cellsX;++Hr){if(!Mt.cells[Mr*Mt.cellsX+Hr])continue;const Zr=g.tileCoordToPixel(Mt.min.x+Hr/Mt.xScale,Mt.min.y+Mr/Mt.yScale),en=g.tileCoordToPixel(Mt.min.x+(Hr+1)/Mt.xScale,Mt.min.y+(Mr+1)/Mt.yScale);for(let Tn=Zr.y;Tn<=Math.min(en.y+1,lt-1);++Tn)for(let ln=Zr.x;ln<=Math.min(en.x+1,lt-1);++ln)U1[Tn*lt+ln]===255&&(U1[Tn*lt+ln]=0,br+=g.getElevationAtPixel(ln,Tn),Ir++)}const Vr=br/Ir;sr=Math.max(1,Lt.x-Qt),hr=Math.max(1,Lt.y-Qt),ur=Math.min(Ht.x+Qt,lt-2),_r=Math.min(Ht.y+Qt,lt-2),ft=!0;for(let Mr=hr;Mr<=_r;++Mr)for(let Hr=sr;Hr<=ur;++Hr)U1[Mr*lt+Hr]===0&&(NC[Mr*lt+Hr]=g._dem.set(Hr,Mr,Vr));for(let Mr=1;Mr<Qt;++Mr){sr=Math.max(1,Lt.x-Mr),hr=Math.max(1,Lt.y-Mr),ur=Math.min(Ht.x+Mr,lt-2),_r=Math.min(Ht.y+Mr,lt-2);for(let Hr=hr;Hr<=_r;++Hr)for(let Zr=sr;Zr<=ur;++Zr){const en=Hr*lt+Zr;if(U1[en]===255){let Tn=0,ln=0,Fn=-1,Ln=-1;for(let jn=-1;jn<=1;++jn)for(let Zn=-1;Zn<=1;++Zn){const Qn=(Hr+jn)*lt+Zr+Zn;if(U1[Qn]>=Mr)continue;const Hn=NC[Qn],Wn=Math.abs(Hn);Wn>ln&&(Tn=Hn,ln=Wn,Fn=Zn,Ln=jn)}if(ln>.1){const jn=1-(Mr+.5*Math.abs(Fn*Ln))/Qt;let Zn=g._dem.get(Zr,Hr)+Tn*jn;const Qn=g._dem.get(Zr+Fn,Hr+Ln),Hn=g._dem.get(Zr-Fn,Hr-Ln,!0);(Zn-Qn)*(Zn-Hn)>0&&(Zn=(Qn+Hn)/2),NC[en]=g._dem.set(Zr,Hr,Zn),U1[en]=Mr}}}}}ft&&(g._demTile.needsDEMTextureUpload=!0,g._dem._timestamp=uo.now())}setFilter(o){this.filter=o?ky(o):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(o=>this.filter.filter(new ou(this.id.overscaledZ,{worldview:this.worldview}),o.feature,this.id.canonical)):this.nodesInfo}destroy(){const o=this.getNodesInfo();for(const g of o)Rw(g.node),aC(g.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(o,g){if(g.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=g.updateTime;const et=g.getReplacementRegionsForTile(o.toUnwrapped());for(const nt of this.getNodesInfo()){const at=nt.node.footprint;nt.hiddenByReplacement=!!at&&!et.find(lt=>lt.footprint===at)}}getHeightAtTileCoord(o,g){const et=[],nt=[0,0,0],at=Zt([]);for(const lt of this.getNodesInfo()){const ft=lt.node.meshes[0],gt=ft.transformedAabb;if(o<gt.min[0]||g<gt.min[1]||o>gt.max[0]||g>gt.max[1])continue;if(lt.node.hidden===!0)return{height:1/0,maxHeight:lt.feature.properties.height,hidden:!1,verticalScale:lt.evaluatedScale[2]};zt(at,lt.node.globalMatrix),nt[0]=o,nt[1]=g,ys(nt,nt,at);const Rt=(nt[0]-ft.aabb.min[0])/(ft.aabb.max[0]-ft.aabb.min[0])*j1|0,Mt=Math.min(63,(nt[1]-ft.aabb.min[1])/(ft.aabb.max[1]-ft.aabb.min[1])*j1|0)*j1+Math.min(63,Rt),Lt=ft.heightmap[Mt];if(!(Lt<0&&lt.node.footprint))return lt.hiddenByReplacement?void 0:{height:Lt,maxHeight:lt.feature.properties.height,hidden:!1,verticalScale:lt.evaluatedScale[2]};if(lt.node.footprint.grid.query(new zn(o,g),new zn(o,g),et),et.length>0)return{height:void 0,maxHeight:lt.feature.properties.height,hidden:lt.hiddenByReplacement,verticalScale:lt.evaluatedScale[2]}}}}function sE(b,o){return b instanceof zx&&!b.isLightConstant&&o}function NI(b,o,g,et,nt,at,lt,ft){let gt=(61440&o|(61440&o)>>4)>>8,Rt=(3840&o|(3840&o)>>4)>>4,Mt=240&o|(240&o)>>4;g[3]>0&&(gt=so(gt,255*g[0],g[3]),Rt=so(Rt,255*g[1],g[3]),Mt=so(Mt,255*g[2],g[3]));const Lt=gt<<8|Rt,Ht=Mt<<8|Math.floor(255*et[3]),Kt=function(Mr){const Hr=pr(Mr,0,2);return Math.min(Math.round(.5*Hr*255),255)}(et[2])<<8|15*et[0]<<4|15*et[1],Qt=pr(nt[0],0,1),sr=pr(nt[1],0,1),hr=pr(nt[2],0,1),ur=pr(nt[3],0,1);let _r,br,Ir,Vr;if(Qt!==sr&&lt!==at&&sr!==Qt){const Mr=lt-at;br=1/(Mr*(sr-Qt)),Ir=-(at+Mr*Qt)/(Mr*(sr-Qt));const Hr=pr(nt[4],-1,1);Vr=Math.pow(10,Hr),_r=255*hr<<8|255*ur}else _r=65535,br=0,Ir=1,Vr=1;if(b.emplaceBack(Lt,Ht,Kt,_r,br,Ir,Vr),ft){const Mr=ft.length;ft.clear();for(let Hr=0;Hr<Mr;Hr++)ft.emplaceBack(Lt,Ht,Kt,_r,br,Ir,Vr)}}function OI(b,o,g){const et=b.node;let nt=0;const at=g&l_.HasMeshoptCompression;for(const lt of et.meshes){if(et.lights&&et.lightMeshIndex===nt||!lt.featureData)continue;lt.featureArray=new Gy,lt.featureArray.reserve(lt.featureData.length);let ft=o;for(const gt of lt.featureData){const Rt=at?65535&gt:gt>>16&65535,Mt=at?gt>>16&65535:65535&gt,Lt=(15&Mt)<8?15&Mt:0,Ht=b.evaluatedRMEA[Lt],Kt=b.evaluatedColor[Lt],Qt=b.emissionHeightBasedParams[Lt];let sr;if(ft&&Lt===2&&et.lights&&(sr=new Gy,sr.resize(10*et.lights.length)),NI(lt.featureArray,Rt,Kt,Ht,Qt,lt.aabb.min[2],lt.aabb.max[2],sr),sr&&ft){ft=!1;const hr=et.meshes[et.lightMeshIndex];hr.featureArray=sr,hr.featureArray._trim()}}lt.featureArray._trim(),nt++}}Ps(qw,"Tiled3dModelBucket",{omit:["layers"]}),Ps(QT,"Tiled3dModelFeature");const LI=["id","tile","layer","source","sourceLayer","state"];class G1{constructor(o,g,et,nt,at){this.type="Feature",this._vectorTileFeature=o,this._z=g,this._x=et,this._y=nt,this.properties=o?o.properties:{},this.id=at}clone(){const o=new G1(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(o.state=Object.assign({},this.state)),this.layer&&(o.layer=Object.assign({},this.layer)),this.source&&(o.source=this.source),this.sourceLayer&&(o.sourceLayer=this.sourceLayer),o}get geometry(){return this._geometry===void 0&&this._vectorTileFeature&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(o){this._geometry=o}toJSON(){const o={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const g of LI)this[g]!==void 0&&(o[g]=this[g]);return o}}class $1 extends x0{constructor(o,g,et,nt){super(),this.id=o,this.type="model",this.models=[],this._loaded=!1,this._options=g,this._modelsInfo=new Map}load(){const o=[];for(const g in this._options.models){const et=this._options.models[g],nt=this._modelsInfo.get(g);if(nt){const at=nt.model;at.position=et.position!=null?new _e(et.position[0],et.position[1]):new _e(0,0),at.orientation=et.orientation!=null?et.orientation:[0,0,0],nt.modelSpec=et,$1.applyModelSpecification(at,et),at.computeBoundsAndApplyParent(),this.models.push(at)}else{const at=_S(this.map._requestManager.transformRequest(et.uri,Bl.Model).url).then(lt=>{if(!lt)return;const ft=cC(lt),gt=new CS(g,et.uri,et.position,et.orientation,ft);$1.applyModelSpecification(gt,et),gt.computeBoundsAndApplyParent(),this.models.push(gt),this._modelsInfo.set(g,{modelSpec:et,model:gt})}).catch(lt=>{this.fire(new Zm(new Error(`Could not load model ${g} from ${et.uri}: ${lt.message}`)))});o.push(at)}}Promise.allSettled(o).then(()=>{this._loaded=!0,this.fire(new m0("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(g=>{this._loaded=!0,this.fire(new Zm(new Error(`Could not load models: ${g.message}`)))})}static applyModelSpecification(o,g){g.nodeOverrides&&$1.convertNodeOverrides(o,g.nodeOverrides),g.materialOverrides&&$1.convertMaterialOverrides(o,g.materialOverrides),g.nodeOverrideNames&&(o.nodeOverrideNames=[...g.nodeOverrideNames]),g.materialOverrideNames&&(o.materialOverrideNames=[...g.materialOverrideNames]),g.featureProperties&&(o.featureProperties=g.featureProperties)}static convertNodeOverrides(o,g){if(Array.isArray(g)&&g.every(et=>typeof et=="string")){o.nodeOverrideNames=[];for(const et of g)o.nodeOverrideNames.push(et)}else Object.entries(g).forEach(([et,nt])=>{const at={orientation:[0,0,0]};if(nt.hasOwnProperty("orientation")){const lt=nt.orientation;lt&&(at.orientation=lt)}o.nodeOverrides.set(et,at)})}static convertMaterialOverrides(o,g){if(Array.isArray(g)&&g.every(et=>typeof et=="string")){o.materialOverrideNames=[];for(const et of g)o.materialOverrideNames.push(et)}else Object.entries(g).forEach(([et,nt])=>{const at={color:new Mo(1,1,1),colorMix:0,emissionStrength:0,opacity:1},lt=nt["model-color"];lt!==void 0&&(at.color.r=lt[0],at.color.g=lt[1],at.color.b=lt[2]);const ft=nt["model-color-mix-intensity"];ft!==void 0&&(at.colorMix=ft);const gt=nt["model-emissive-strength"];gt!==void 0&&(at.emissionStrength=gt);const Rt=nt["model-opacity"];Rt!==void 0&&(at.opacity=Rt),o.materialOverrides.set(et,at)})}onAdd(o){this.map=o,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(o,g){}serialize(){return this._options}setProperty(o,g){return!1}reload(){const o=F0(this.id,this.scope);this.map.style.clearSource(o),this.models=[],this._modelsInfo.clear(),this._loaded=!1,this.load()}setModels(o){this.models=[];const g=new Map;for(const et in o){const nt=o[et];if(this._modelsInfo.has(et)){const at=this._modelsInfo.get(et);at&&at.modelSpec.uri===nt.uri&&g.set(et,at)}}this._modelsInfo=g,this._options.models=o,this._loaded=!1,this.load()}}function OC(b,o,g,et){const nt=1<<b.z;o.lat=rr((et/ss+b.y)/nt),o.lng=Xt((g/ss+b.x)/nt)}function jI(b,o,g,et){const nt=b.getNodesInfo()[o];if(!nt||nt.hiddenByReplacement||!nt.node.meshes)return;let at=Number.MAX_VALUE;const lt=nt.node,ft=g.tile,gt=et.calculatePosMatrix(ft.tileID.toUnwrapped(),et.worldSize),Rt=nt.evaluatedScale;let Mt=0;et.elevation&&lt.elevation&&(Mt=lt.elevation*et.elevation.exaggeration()),Nt(gt,gt,[(lt.anchor?lt.anchor[0]:0)*(Rt[0]-1),(lt.anchor?lt.anchor[1]:0)*(Rt[1]-1),Mt]),Gt(gt,gt,Rt);const Lt=g.queryGeometry,Ht=Lt.isPointQuery()?Lt.screenBounds:Lt.screenGeometry,Kt=function(sr){const hr=Ut([],gt,sr.globalMatrix);Ut(hr,et.expandedFarZProjMatrix,hr);for(let ur=0;ur<sr.meshes.length;++ur){const _r=sr.meshes[ur];if(ur===sr.lightMeshIndex)continue;const br=sC(Ht,et,hr,_r.aabb);br!=null&&(at=Math.min(br,at))}if(sr.children)for(const ur of sr.children)Kt(ur)};if(Kt(lt),at===Number.MAX_VALUE)return;const Qt=new _e(0,0);return OC(ft.tileID.canonical,Qt,nt.node.anchor[0],nt.node.anchor[1]),{intersectionZ:at,position:Qt,feature:nt.feature}}const zI={circle:class extends Np{constructor(b,o,g,et){super(b,{layout:Wp||(Wp=new Fu({"circle-sort-key":new hs(mn.layout_circle["circle-sort-key"]),"circle-elevation-reference":new ns(mn.layout_circle["circle-elevation-reference"]),visibility:new ns(mn.layout_circle.visibility)})),paint:Bu||(Bu=new Fu({"circle-radius":new hs(mn.paint_circle["circle-radius"]),"circle-color":new hs(mn.paint_circle["circle-color"]),"circle-blur":new hs(mn.paint_circle["circle-blur"]),"circle-opacity":new hs(mn.paint_circle["circle-opacity"]),"circle-translate":new ns(mn.paint_circle["circle-translate"]),"circle-translate-anchor":new ns(mn.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ns(mn.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ns(mn.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new hs(mn.paint_circle["circle-stroke-width"]),"circle-stroke-color":new hs(mn.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new hs(mn.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new ns(mn.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new hs({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new hs({type:"string",default:"default","property-type":"data-driven"})}))},o,g,et)}createBucket(b){return new Ml(b)}queryRadius(b){const o=b;return Tp("circle-radius",this,o)+Tp("circle-stroke-width",this,o)+xp(this.paint.get("circle-translate"))}queryIntersectsFeature(b,o,g,et,nt,at,lt,ft){const gt=A0(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),at.angle,b.pixelToTileUnitsFactor),Rt=this.paint.get("circle-radius").evaluate(o,g)+this.paint.get("circle-stroke-width").evaluate(o,g);return sA(b,et,at,lt,ft,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",gt,Rt)}getProgramIds(){return["circle"]}getDefaultProgramParams(b,o,g){const et=iA(this);return{config:new Um(this,{zoom:o,lut:g}),defines:et,overrideFog:!1}}is3D(b){return!b&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends Np{createBucket(b){return new aA(b)}constructor(b,o,g,et){super(b,{layout:lA||(lA=new Fu({visibility:new ns(mn.layout_heatmap.visibility)})),paint:cA||(cA=new Fu({"heatmap-radius":new hs(mn.paint_heatmap["heatmap-radius"]),"heatmap-weight":new hs(mn.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ns(mn.paint_heatmap["heatmap-intensity"]),"heatmap-color":new lx(mn.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ns(mn.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new hs({type:"string",default:"default","property-type":"data-driven"})}))},o,g,et),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(b){b==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Tv({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}queryRadius(b){return Tp("heatmap-radius",this,b)}queryIntersectsFeature(b,o,g,et,nt,at,lt,ft){const gt=this.paint.get("heatmap-radius").evaluate(o,g);return sA(b,et,at,lt,ft,!0,!0,new zn(0,0),gt)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(b,o,g){return b==="heatmap"?{config:new Um(this,{zoom:o,lut:g}),overrideFog:!1}:{}}},hillshade:class extends Np{constructor(b,o,g,et){super(b,{layout:uA||(uA=new Fu({visibility:new ns(mn.layout_hillshade.visibility)})),paint:dA||(dA=new Fu({"hillshade-illumination-direction":new ns(mn.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ns(mn.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ns(mn.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ns(mn.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ns(mn.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ns(mn.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new ns(mn.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new hs({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new hs({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new hs({type:"string",default:"default","property-type":"data-driven"})}))},o,g,et)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(b,o,g){return{overrideFog:!1}}},fill:class extends Np{constructor(b,o,g,et){super(b,{layout:SA||(SA=new Fu({"fill-sort-key":new hs(mn.layout_fill["fill-sort-key"]),visibility:new ns(mn.layout_fill.visibility),"fill-elevation-reference":new ns(mn.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new hs(mn.layout_fill["fill-construct-bridge-guard-rail"])})),paint:TA||(TA=new Fu({"fill-antialias":new ns(mn.paint_fill["fill-antialias"]),"fill-opacity":new hs(mn.paint_fill["fill-opacity"]),"fill-color":new hs(mn.paint_fill["fill-color"]),"fill-outline-color":new hs(mn.paint_fill["fill-outline-color"]),"fill-translate":new ns(mn.paint_fill["fill-translate"]),"fill-translate-anchor":new ns(mn.paint_fill["fill-translate-anchor"]),"fill-pattern":new hs(mn.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new ns(mn.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new ns(mn.paint_fill["fill-emissive-strength"]),"fill-z-offset":new hs(mn.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new hs(mn.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new hs(mn.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new hs({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new hs({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new hs({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new hs({type:"string",default:"default","property-type":"data-driven"})}))},o,g,et)}getProgramIds(){const b=this.paint.get("fill-pattern"),o=b&&b.constantOr(1),g=[o?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&g.push(o&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),g}getDefaultProgramParams(b,o,g){return{config:new Um(this,{zoom:o,lut:g}),overrideFog:!1}}recalculate(b,o){super.recalculate(b,o);const g=this.paint._values["fill-outline-color"];g.value.kind==="constant"&&g.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(b){return new U2(b)}queryRadius(){return xp(this.paint.get("fill-translate"))}queryIntersectsFeature(b,o,g,et,nt,at){return!b.queryGeometry.isAboveHorizon&&Rl(c0(b.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),at.angle,b.pixelToTileUnitsFactor),et)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(b){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const o=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return b!=null?o&&!b:o}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends Np{constructor(b,o,g,et){super(b,{layout:JA||(JA=new Fu({visibility:new ns(mn["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new ns(mn["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:eS||(eS=new Fu({"fill-extrusion-opacity":new ns(mn["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new hs(mn["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ns(mn["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ns(mn["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new hs(mn["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new ns(mn["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new hs(mn["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new hs(mn["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new ns(mn["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new ns(mn["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new ns(mn["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new ns(mn["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new ns(mn["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new ns(mn["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new ns(mn["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new ns(mn["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new ns(mn["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new ns(mn["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new hs(mn["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new hs(mn["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new ns(mn["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new ns(mn["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new ns(mn["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new ns(mn["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new hs(mn["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new hs(mn["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new ns(mn["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new hs({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new hs({type:"string",default:"default","property-type":"data-driven"})}))},o,g,et),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(b){return new gw(b)}queryRadius(){return xp(this.paint.get("fill-extrusion-translate"))}is3D(b){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(b,o,g,et,nt,at,lt,ft,gt){const Rt=A0(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),at.angle,b.pixelToTileUnitsFactor),Mt=this.paint.get("fill-extrusion-height").evaluate(o,g),Lt=this.paint.get("fill-extrusion-base").evaluate(o,g),Ht=[0,0],Kt=ft&&at.elevation,Qt=at.elevation?at.elevation.exaggeration():1,sr=b.tile.getBucket(this);if(Kt&&sr instanceof gw){const Ir=sr.centroidVertexArray,Vr=gt+1;Vr<Ir.length&&(Ht[0]=Ir.geta_centroid_pos0(Vr),Ht[1]=Ir.geta_centroid_pos1(Vr))}if(Ht[0]===0&&Ht[1]===1)return!1;at.projection.name==="globe"&&(et=QA([et],[new zn(0,0),new zn(ss,ss)],b.tileID.canonical).map(Ir=>Ir.polygon).flat());const hr=Kt?ft:null,[ur,_r]=aS(at,et,Lt,Mt,Rt,lt,hr,Ht,Qt,at.center.lat,b.tileID.canonical),br=b.queryGeometry;return oS(ur,_r,br.isPointQuery()?br.screenBounds:br.screenGeometry)}},building:class extends Np{constructor(b,o,g,et){super(b,{layout:PS||(PS=new Fu({visibility:new ns(mn.layout_building.visibility),"building-facade":new hs(mn.layout_building["building-facade"]),"building-facade-floors":new hs(mn.layout_building["building-facade-floors"]),"building-facade-unit-width":new hs(mn.layout_building["building-facade-unit-width"]),"building-facade-window":new hs(mn.layout_building["building-facade-window"]),"building-roof-shape":new hs(mn.layout_building["building-roof-shape"]),"building-height":new hs(mn.layout_building["building-height"]),"building-base":new hs(mn.layout_building["building-base"]),"building-flood-light-wall-radius":new hs(mn.layout_building["building-flood-light-wall-radius"]),"building-flood-light-ground-radius":new hs(mn.layout_building["building-flood-light-ground-radius"]),"building-flip-roof-orientation":new hs(mn.layout_building["building-flip-roof-orientation"])})),paint:kS||(kS=new Fu({"building-opacity":new ns(mn.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new ns(mn.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new ns(mn.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new ns(mn.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new ns(mn.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new ns(mn.paint_building["building-vertical-scale"]),"building-cast-shadows":new ns(mn.paint_building["building-cast-shadows"]),"building-color":new hs(mn.paint_building["building-color"]),"building-emissive-strength":new hs(mn.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new ns(mn.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new ns(mn.paint_building["building-cutoff-fade-range"]),"building-flood-light-color":new ns(mn.paint_building["building-flood-light-color"]),"building-flood-light-intensity":new ns(mn.paint_building["building-flood-light-intensity"]),"building-flood-light-ground-attenuation":new ns(mn.paint_building["building-flood-light-ground-attenuation"]),"building-color-use-theme":new hs({type:"string",default:"default","property-type":"data-driven"}),"building-flood-light-color-use-theme":new hs({type:"string",default:"default","property-type":"data-driven"})}))},o,g,et),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(b){return new DS(b)}cutoffRange(){return this.paint.get("building-cutoff-fade-range")}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return!0}canCastShadows(){return!0}is3D(b){return!0}queryRadius(b){return 0}queryIntersectsFeature(b,o,g,et,nt,at,lt,ft,gt){let Rt=this.layout.get("building-height").evaluate(o,g);const Mt=this.layout.get("building-base").evaluate(o,g),Lt=b.tile.getBucket(this).getFootprint(o);if(Lt){if(Lt.hiddenFlags!==0)return!1;Rt=Lt.height}const[Ht,Kt]=aS(at,et,Mt,Rt,new zn(0,0),lt,null,[0,0],1,at.center.lat,b.tileID.canonical),Qt=b.queryGeometry;return oS(Ht,Kt,Qt.isPointQuery()?Qt.screenBounds:Qt.screenGeometry)}},line:class extends Np{constructor(b,o,g,et){const nt=US();super(b,nt,o,g,et),nt.layout&&(this.layout=new ax(nt.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(b){if(b==="line-gradient"){const o=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=o._styleExpression&&o._styleExpression.expression instanceof p1,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}emissiveStrengthExpression(){return this._transitionablePaint._values["line-emissive-strength"].value.expression}recalculate(b,o){super.recalculate(b,o),this.paint._values["line-floorwidth"]=(()=>{if($v)return $v;const g=US();return $v=new B8(g.paint.properties["line-width"].specification),$v.useIntegerZoom=!0,$v})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,b)}createBucket(b){return new hC(b)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(b,o,g){const et=zS(this);return{config:new Um(this,{zoom:o,lut:g}),defines:et,overrideFog:!1}}queryRadius(b){const o=b,g=GS(Tp("line-width",this,o),Tp("line-gap-width",this,o)),et=Tp("line-offset",this,o);return g/2+Math.abs(et)+xp(this.paint.get("line-translate"))}queryIntersectsFeature(b,o,g,et,nt,at){if(b.queryGeometry.isAboveHorizon)return!1;const lt=c0(b.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),at.angle,b.pixelToTileUnitsFactor),ft=b.pixelToTileUnitsFactor/2*GS(this.paint.get("line-width").evaluate(o,g),this.paint.get("line-gap-width").evaluate(o,g)),gt=this.paint.get("line-offset").evaluate(o,g);return gt&&(et=function(Rt,Mt){const Lt=[],Ht=new zn(0,0);for(let Kt=0;Kt<Rt.length;Kt++){const Qt=Rt[Kt],sr=[];for(let hr=0;hr<Qt.length;hr++){const ur=Qt[hr],_r=Qt[hr+1],br=hr===0?Ht:ur.sub(Qt[hr-1])._unit()._perp(),Ir=hr===Qt.length-1?Ht:_r.sub(ur)._unit()._perp(),Vr=br._add(Ir)._unit();Vr._mult(1/(Vr.x*Ir.x+Vr.y*Ir.y)),sr.push(Vr._mult(Mt)._add(ur))}Lt.push(sr)}return Lt}(et,gt*b.pixelToTileUnitsFactor)),function(Rt,Mt,Lt){for(let Ht=0;Ht<Mt.length;Ht++){const Kt=Mt[Ht];if(Rt.length>=3){for(let Qt=0;Qt<Kt.length;Qt++)if(Zl(Rt,Kt[Qt]))return!0}if(Au(Rt,Kt,Lt))return!0}return!1}(lt,et,ft)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(b){return!this.hasElevatedBuckets||this.layout&&this.layout.get("line-elevation-reference")==="hd-road-markup"}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:Gw,background:class extends Np{constructor(b,o,g,et){super(b,{layout:PT||(PT=new Fu({visibility:new ns(mn.layout_background.visibility)})),paint:kT||(kT=new Fu({"background-pitch-alignment":new ns(mn.paint_background["background-pitch-alignment"]),"background-color":new ns(mn.paint_background["background-color"]),"background-pattern":new ns(mn.paint_background["background-pattern"]),"background-opacity":new ns(mn.paint_background["background-opacity"]),"background-emissive-strength":new ns(mn.paint_background["background-emissive-strength"]),"background-color-use-theme":new hs({type:"string",default:"default","property-type":"data-driven"})}))},o,g,et)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(b,o,g){return{overrideFog:!1}}is3D(b){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:OT,"raster-particle":GT,sky:class extends Np{constructor(b,o,g,et){super(b,{layout:zT||(zT=new Fu({visibility:new ns(mn.layout_sky.visibility)})),paint:VT||(VT=new Fu({"sky-type":new ns(mn.paint_sky["sky-type"]),"sky-atmosphere-sun":new ns(mn.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new ns(mn.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new ns(mn.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new ns(mn.paint_sky["sky-gradient-radius"]),"sky-gradient":new lx(mn.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new ns(mn.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new ns(mn.paint_sky["sky-atmosphere-color"]),"sky-opacity":new ns(mn.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new hs({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new hs({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new hs({type:"string",default:"default","property-type":"data-driven"})}))},o,g,et),this._updateColorRamp()}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0}_handleSpecialPaintPropertyUpdate(b){b==="sky-gradient"?this._updateColorRamp():b!=="sky-atmosphere-sun"&&b!=="sky-atmosphere-halo-color"&&b!=="sky-atmosphere-color"&&b!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Tv({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(b){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const o=b.style.light.properties.get("position");return this._lightPosition.azimuthal!==o.azimuthal||this._lightPosition.polar!==o.polar}return!1}getCenter(b,o){if(this.paint.get("sky-type")==="atmosphere"){const et=this.paint.get("sky-atmosphere-sun"),nt=!et,at=b.style.light,lt=at.properties.get("position");return nt&&at.properties.get("anchor")==="viewport"&&bs("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),nt?FC(lt.azimuthal,90-lt.polar,o):FC(et[0],90-et[1],o)}const g=this.paint.get("sky-gradient-center");return FC(g[0],90-g[1],o)}isSky(){return!0}markSkyboxValid(b){this._skyboxInvalidated=!1,this._lightPosition=b.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const b=this.paint.get("sky-type");return b==="atmosphere"?["skyboxCapture","skybox"]:b==="gradient"?["skyboxGradient"]:null}},slot:class extends Np{constructor(b,o,g,et){super(b,{paint:UT||(UT=new Fu({}))},o,null)}},model:class extends Np{constructor(b,o,g,et){super(b,{layout:qT||(qT=new Fu({visibility:new ns(mn.layout_model.visibility),"model-id":new hs(mn.layout_model["model-id"])})),paint:XT||(XT=new Fu({"model-opacity":new hs(mn.paint_model["model-opacity"]),"model-rotation":new hs(mn.paint_model["model-rotation"]),"model-scale":new hs(mn.paint_model["model-scale"]),"model-translation":new hs(mn.paint_model["model-translation"]),"model-color":new hs(mn.paint_model["model-color"]),"model-color-mix-intensity":new hs(mn.paint_model["model-color-mix-intensity"]),"model-type":new ns(mn.paint_model["model-type"]),"model-cast-shadows":new ns(mn.paint_model["model-cast-shadows"]),"model-receive-shadows":new ns(mn.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new ns(mn.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new hs(mn.paint_model["model-emissive-strength"]),"model-roughness":new hs(mn.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new hs(mn.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new ns(mn.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new ns(mn.paint_model["model-front-cutoff"]),"model-elevation-reference":new ns(mn.paint_model["model-elevation-reference"]),"model-color-use-theme":new hs({type:"string",default:"default","property-type":"data-driven"})}))},o,g,et),this.layer=b,this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(b){return new MC(b)}getProgramIds(){return["model"]}is3D(b){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(b){return b instanceof qw?ss-1:0}queryRenderedFeatures(b,o,g){const et=o.getSource();if(!(et&&et instanceof $1))return{};const nt=et,at={};at[this.id]=[];const lt=at[this.id];let ft=0;for(const gt of nt.models){const Rt=o.getFeatureState(this.sourceLayer,gt.id),Mt={type:"Unknown",id:gt.id,properties:gt.featureProperties},Lt=this.paint.get("model-rotation").evaluate(Mt,Rt),Ht=this.paint.get("model-scale").evaluate(Mt,Rt),Kt=this.paint.get("model-translation").evaluate(Mt,Rt),Qt=this.paint.get("model-elevation-reference");let sr=[];Tw(sr,gt,g,gt.position,Lt,Ht,Kt,Qt==="ground",Qt==="ground",!1),g.projection.name==="globe"&&(sr=Sw(sr,g));const hr=Ut([],g.projMatrix,sr),ur=sC(b.isPointQuery()?b.screenBounds:b.screenGeometry,g,hr,gt.aabb);if(ur!=null){const _r=new G1(void 0,0,0,0,gt.id);_r.layer=this.layer,_r.properties=structuredClone(gt.featureProperties),_r.properties.layer=this.id,_r.properties.uri=gt.uri,_r.properties.orientation=gt.orientation,_r.sourceLayer=this.sourceLayer,_r.geometry={type:"Point",coordinates:[gt.position.lng,gt.position.lat]},_r.state=Rt,_r.source=this.source,lt.push({featureIndex:ft,feature:_r,intersectionZ:ur})}++ft}return at}queryIntersectsFeature(b,o,g,et,nt,at){if(!this.modelManager)return!1;const lt=this.modelManager,ft=b.tile.getBucket(this);if(!(ft&&ft instanceof MC))return!1;for(const gt in ft.instancesPerModel){const Rt=ft.instancesPerModel[gt],Mt=o.id!==void 0?o.id:o.properties&&o.properties.hasOwnProperty("id")?o.properties.id:void 0;if(Rt.idToFeaturesIndex.hasOwnProperty(Mt)){const Lt=Rt.features[Rt.idToFeaturesIndex[Mt]],Ht=lt.getModel(gt,this.scope);if(!Ht)return!1;let Kt=[];const Qt=new _e(0,0),sr=ft.canonical;let hr=Number.MAX_VALUE;for(let ur=0;ur<Lt.instancedDataCount;++ur){const _r=16*(Lt.instancedDataOffset+ur),br=Rt.instancedDataArray.float32,Ir=[br[_r+4],br[_r+5],br[_r+6]];OC(sr,Qt,Math.floor(br[_r]),Math.floor(br[_r+1])),Tw(Kt,Ht,at,Qt,Lt.rotation,Lt.scale,Ir,!1,!1,!1),at.projection.name==="globe"&&(Kt=Sw(Kt,at));const Vr=Ut([],at.projMatrix,Kt),Mr=b.queryGeometry,Hr=sC(Mr.isPointQuery()?Mr.screenBounds:Mr.screenGeometry,at,Vr,Ht.aabb);Hr!=null&&(hr=Math.min(Hr,hr))}return hr!==Number.MAX_VALUE&&hr}}return!1}_handleOverridablePaintPropertyUpdate(b,o,g){return!(!this.layout||o.isDataDriven()||g.isDataDriven()||b!=="model-color"&&b!=="model-color-mix-intensity"&&b!=="model-rotation"&&b!=="model-scale"&&b!=="model-translation"&&b!=="model-emissive-strength")}_isPropertyZoomDependent(b){const o=this._transitionablePaint._values[b];return o!=null&&o.value!=null&&o.value.expression!=null&&o.value.expression instanceof ix}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends Np{constructor(b,o,g,et){super(b,{layout:RA||(RA=new Fu({"clip-layer-types":new ns(mn.layout_clip["clip-layer-types"]),"clip-layer-scope":new ns(mn.layout_clip["clip-layer-scope"])})),paint:IA||(IA=new Fu({}))},o,g,et)}recalculate(b,o){super.recalculate(b,o)}createBucket(b){return new DA(b)}is3D(b){return!0}}},LC=new Mo(0,0,0),jC={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},zC={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},Xw={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},VI={PAINT_ORDER_FILL_AND_STROKE:1},oE={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},JT={MASK_TYPE_LUMINANCE:1};function UI(b,o,g){b===1&&o.icons.push(function(et,nt){return function(at){if(at.usvg_tree.height||(at.usvg_tree.height=at.usvg_tree.width),!at.metadata)return at;const{metadata:lt}=at;if(lt.content_area){const{content_area:ft}=lt;ft.left==null&&(ft.left=0),ft.top==null&&(ft.top=ft.left),ft.width==null&&(ft.width=at.usvg_tree.width),ft.height==null&&(ft.height=ft.width)}if(lt.text_placeholder){const{text_placeholder:ft}=lt;ft.top==null&&(ft.top=ft.left),ft.height==null&&(ft.height=ft.width)}return lt.stretch_x&&lt.stretch_x.length&&e3(lt,"x"),lt.stretch_y&&lt.stretch_y.length&&e3(lt,"y"),at}(et.readFields(GI,{name:void 0},nt))}(g,g.readVarint()+g.pos))}function e3(b,o){const g=[],et=b[`stretch_${o}`];let nt=null;for(let at=0;at<et.length;at++)nt===null?nt=g.length===0?et[0]:g[g.length-1][1]+et[at]:(g.push([nt,nt+et[at]]),nt=null);b[`stretch_${o}_areas`]=g}function GI(b,o,g){b===1?o.name=g.readString():b===2?o.metadata=function(et,nt){return et.readFields($I,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},nt)}(g,g.readVarint()+g.pos):b===3&&(o.usvg_tree=function(et,nt){return et.readFields(qI,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},nt)}(g,g.readVarint()+g.pos),o.data="usvg_tree")}function $I(b,o,g){b===1?o.stretch_x=g.readPackedVarint():b===2?o.stretch_y=g.readPackedVarint():b===3?o.content_area=t3(g,g.readVarint()+g.pos):b===4?o.variables.push(function(et,nt){return et.readFields(WI,{name:void 0},nt)}(g,g.readVarint()+g.pos)):b===5&&(o.text_placeholder=t3(g,g.readVarint()+g.pos))}function t3(b,o){return b.readFields(HI,{},o)}function HI(b,o,g){b===1?o.left=g.readVarint():b===2?o.width=g.readVarint():b===3?o.top=g.readVarint():b===4&&(o.height=g.readVarint())}function WI(b,o,g){b===1?o.name=g.readString():b===2&&(o.rgb_color=Yw(g.readVarint()),o.value="rgb_color")}function qI(b,o,g){b===1?o.width=o.height=g.readVarint():b===2?o.height=g.readVarint():b===3?o.children.push(Kw(g,g.readVarint()+g.pos)):b===4?o.linear_gradients.push(function(et,nt){return et.readFields(e5,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},nt)}(g,g.readVarint()+g.pos)):b===5?o.radial_gradients.push(function(et,nt){return et.readFields(r5,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},nt)}(g,g.readVarint()+g.pos)):b===7?o.clip_paths.push(function(et,nt){return et.readFields(n5,{children:[]},nt)}(g,g.readVarint()+g.pos)):b===8&&o.masks.push(function(et,nt){const at=et.readFields(i5,{left:0,width:20,mask_type:JT.MASK_TYPE_LUMINANCE,children:[]},nt);return at.height==null&&(at.height=at.width),at.top==null&&(at.top=at.left),at}(g,g.readVarint()+g.pos))}function Kw(b,o){return b.readFields(XI,{},o)}function XI(b,o,g){b===1?(o.group=function(et,nt){return et.readFields(KI,{opacity:255,children:[]},nt)}(g,g.readVarint()+g.pos),o.node="group"):b===2&&(o.path=function(et,nt){return et.readFields(YI,{paint_order:1,commands:[],step:1,diffs:[],rule:jC.PATH_RULE_NON_ZERO},nt)}(g,g.readVarint()+g.pos),o.node="path")}function KI(b,o,g){b===1?o.transform=Zw(g,g.readVarint()+g.pos):b===2?o.opacity=g.readVarint():b===5?o.clip_path_idx=g.readVarint():b===6?o.mask_idx=g.readVarint():b===7&&o.children.push(Kw(g,g.readVarint()+g.pos))}function Zw(b,o){return b.readFields(ZI,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},o)}function ZI(b,o,g){b===1?o.sx=g.readFloat():b===2?o.ky=g.readFloat():b===3?o.kx=g.readFloat():b===4?o.sy=g.readFloat():b===5?o.tx=g.readFloat():b===6&&(o.ty=g.readFloat())}function YI(b,o,g){b===1?o.fill=function(et,nt){return et.readFields(QI,{rgb_color:LC,paint:"rgb_color",opacity:255},nt)}(g,g.readVarint()+g.pos):b===2?o.stroke=function(et,nt){return et.readFields(JI,{rgb_color:LC,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},nt)}(g,g.readVarint()+g.pos):b===3?o.paint_order=g.readVarint():b===5?g.readPackedVarint(o.commands):b===6?o.step=g.readFloat():b===7?g.readPackedSVarint(o.diffs):b===8&&(o.rule=g.readVarint())}function QI(b,o,g){b===1?(o.rgb_color=Yw(g.readVarint()),o.paint="rgb_color"):b===2?(o.linear_gradient_idx=g.readVarint(),o.paint="linear_gradient_idx"):b===3?(o.radial_gradient_idx=g.readVarint(),o.paint="radial_gradient_idx"):b===5&&(o.opacity=g.readVarint())}function Yw(b){return new Mo((b>>16&255)/255,(b>>8&255)/255,(255&b)/255,1)}function JI(b,o,g){b===1?(o.rgb_color=Yw(g.readVarint()),o.paint="rgb_color"):b===2?(o.linear_gradient_idx=g.readVarint(),o.paint="linear_gradient_idx"):b===3?(o.radial_gradient_idx=g.readVarint(),o.paint="radial_gradient_idx"):b===5?g.readPackedFloat(o.dasharray):b===6?o.dashoffset=g.readFloat():b===7?o.miterlimit=g.readFloat():b===8?o.opacity=g.readVarint():b===9?o.width=g.readFloat():b===10?o.linecap=g.readVarint():b===11&&(o.linejoin=g.readVarint())}function e5(b,o,g){b===1?o.transform=Zw(g,g.readVarint()+g.pos):b===2?o.spread_method=g.readVarint():b===3?o.stops.push(r3(g,g.readVarint()+g.pos)):b===4?o.x1=g.readFloat():b===5?o.y1=g.readFloat():b===6?o.x2=g.readFloat():b===7&&(o.y2=g.readFloat())}function r3(b,o){return b.readFields(t5,{offset:0,opacity:255,rgb_color:LC},o)}function t5(b,o,g){b===1?o.offset=g.readFloat():b===2?o.opacity=g.readVarint():b===3&&(o.rgb_color=Yw(g.readVarint()))}function r5(b,o,g){b===1?o.transform=Zw(g,g.readVarint()+g.pos):b===2?o.spread_method=g.readVarint():b===3?o.stops.push(r3(g,g.readVarint()+g.pos)):b===4?o.cx=g.readFloat():b===5?o.cy=g.readFloat():b===6?o.r=g.readFloat():b===7?o.fx=g.readFloat():b===8?o.fy=g.readFloat():b===9&&(o.fr=g.readFloat())}function n5(b,o,g){b===1?o.transform=Zw(g,g.readVarint()+g.pos):b===2?o.clip_path_idx=g.readVarint():b===3&&o.children.push(Kw(g,g.readVarint()+g.pos))}function i5(b,o,g){b===1?o.left=o.top=g.readFloat():b===2?o.width=o.height=g.readFloat():b===3?o.top=g.readFloat():b===4?o.height=g.readFloat():b===5?o.mask_type=g.readVarint():b===6?o.mask_idx=g.readVarint():b===7&&o.children.push(Kw(g,g.readVarint()+g.pos))}class s5{static calculate(o={},g=[]){const et=new Map,nt=new Map;if(Object.keys(o).length===0)return et;g.forEach(at=>{nt.set(at.name,at.rgb_color||new Mo(0,0,0))});for(const[at,lt]of Object.entries(o))nt.has(at)?et.set(nt.get(at).toString(),lt):console.warn(`Ignoring unknown image variable "${at}"`);return et}}function y_(b,o=255,g){const et=o/255,nt=b.toString(),at=g.has(nt)?g.get(nt).clone():b.clone();return at.a*=et,at.toString()}function aE(b,o){if(!nn()){const g=document.createElement("canvas");return g.width=b,g.height=o,g}return new OffscreenCanvas(b,o)}let VC,lE=null;function UC(b,o,g,et,nt){for(const at of et.children)n3(b,o,g,at,nt)}function n3(b,o,g,et,nt){et.group?(b.save(),function(at,lt,ft,gt,Rt){const Mt=gt.mask_idx!=null?ft.masks[gt.mask_idx]:null,Lt=gt.clip_path_idx!=null?ft.clip_paths[gt.clip_path_idx]:null;if(gt.transform&&(lt=__(gt.transform).preMultiplySelf(lt)),!function(Qt,sr,hr){return Qt.opacity!==255||sr||hr}(gt,Lt!=null,Mt!=null))return void UC(at,lt,ft,gt,Rt);const Ht=aE(at.canvas.width,at.canvas.height),Kt=Ht.getContext("2d");UC(Kt,lt,ft,gt,Rt),Lt&&u3(Kt,lt,ft,Lt),Mt&&d3(Kt,lt,ft,Mt,Rt),at.globalAlpha=gt.opacity/255,at.drawImage(Ht,0,0)}(b,o,g,et.group,nt),b.restore()):et.path&&(b.save(),function(at,lt,ft,gt,Rt){at.setTransform(lt),gt.paint_order===VI.PAINT_ORDER_FILL_AND_STROKE?(i3(at,ft,gt,Rt),o3(at,ft,gt,Rt)):(o3(at,ft,gt,Rt),i3(at,ft,gt,Rt))}(b,o,g,et.path,nt),b.restore())}function i3(b,o,g,et){const nt=g.fill;if(!nt)return;const at=nt.opacity/255;switch(b.save(),b.beginPath(),h3(g,b),nt.paint){case"rgb_color":b.fillStyle=y_(nt.rgb_color,nt.opacity,et);break;case"linear_gradient_idx":{const lt=o.linear_gradients[nt.linear_gradient_idx];lt.transform&&b.setTransform(__(lt.transform).preMultiplySelf(b.getTransform())),b.fillStyle=a3(b,lt,at,et);break}case"radial_gradient_idx":{const lt=o.radial_gradients[nt.radial_gradient_idx];lt.transform&&b.setTransform(__(lt.transform).preMultiplySelf(b.getTransform())),b.fillStyle=l3(b,lt,at,et)}}b.fill(s3(g)),b.restore()}function s3(b){return b.rule===jC.PATH_RULE_NON_ZERO?"nonzero":b.rule===jC.PATH_RULE_EVEN_ODD?"evenodd":void 0}function o3(b,o,g,et){const nt=g.stroke;if(!nt)return;const at=f3(g);b.lineWidth=nt.width,b.miterLimit=nt.miterlimit,b.setLineDash(nt.dasharray),b.lineDashOffset=nt.dashoffset;const lt=nt.opacity/255;switch(nt.paint){case"rgb_color":b.strokeStyle=y_(nt.rgb_color,nt.opacity,et);break;case"linear_gradient_idx":b.strokeStyle=a3(b,o.linear_gradients[nt.linear_gradient_idx],lt,et,!0);break;case"radial_gradient_idx":b.strokeStyle=l3(b,o.radial_gradients[nt.radial_gradient_idx],lt,et,!0)}switch(nt.linejoin){case Xw.LINE_JOIN_MITER_CLIP:case Xw.LINE_JOIN_MITER:b.lineJoin="miter";break;case Xw.LINE_JOIN_ROUND:b.lineJoin="round";break;case Xw.LINE_JOIN_BEVEL:b.lineJoin="bevel"}switch(nt.linecap){case zC.LINE_CAP_BUTT:b.lineCap="butt";break;case zC.LINE_CAP_ROUND:b.lineCap="round";break;case zC.LINE_CAP_SQUARE:b.lineCap="square"}b.stroke(at)}function a3(b,o,g,et,nt=!1){if(o.stops.length===1){const Ht=o.stops[0];return y_(Ht.rgb_color,Ht.opacity*g,et)}const{x1:at,y1:lt,x2:ft,y2:gt}=o;let Rt=new DOMPoint(at,lt),Mt=new DOMPoint(ft,gt);if(nt){const Ht=__(o.transform);Rt=Ht.transformPoint(Rt),Mt=Ht.transformPoint(Mt)}const Lt=b.createLinearGradient(Rt.x,Rt.y,Mt.x,Mt.y);for(const Ht of o.stops)Lt.addColorStop(Ht.offset,y_(Ht.rgb_color,Ht.opacity*g,et));return Lt}function l3(b,o,g,et,nt=!1){if(o.stops.length===1){const ur=o.stops[0];return y_(ur.rgb_color,ur.opacity*g,et)}const at=__(o.transform),{fx:lt,fy:ft,fr:gt,cx:Rt,cy:Mt,r:Lt}=o;let Ht=new DOMPoint(lt,ft),Kt=new DOMPoint(Rt,Mt),Qt=gt,sr=Lt;if(nt){Ht=at.transformPoint(Ht),Kt=at.transformPoint(Kt);const ur=(at.a+at.d)/2;Qt=gt*ur,sr=o.r*ur}const hr=b.createRadialGradient(Ht.x,Ht.y,Qt,Kt.x,Kt.y,sr);for(const ur of o.stops)hr.addColorStop(ur.offset,y_(ur.rgb_color,ur.opacity*g,et));return hr}function c3(b,o,g,et){const nt=et.transform?__(et.transform).preMultiplySelf(o):o,at=aE(b.canvas.width,b.canvas.height),lt=at.getContext("2d");for(const gt of et.children)if(gt.group)c3(lt,nt,g,gt.group);else if(gt.path){const Rt=gt.path,Mt=new Path2D;Mt.addPath(f3(Rt),nt),lt.fill(Mt,s3(Rt))}const ft=et.clip_path_idx!=null?g.clip_paths[et.clip_path_idx]:null;ft&&u3(lt,nt,g,ft),b.globalCompositeOperation="source-over",b.drawImage(at,0,0)}function u3(b,o,g,et){const nt=aE(b.canvas.width,b.canvas.height);c3(nt.getContext("2d"),o,g,et),b.globalCompositeOperation="destination-in",b.drawImage(nt,0,0)}function d3(b,o,g,et,nt){if(et.children.length===0)return;const at=et.mask_idx!=null?g.masks[et.mask_idx]:null;at&&d3(b,o,g,at,nt);const lt=b.canvas.width,ft=b.canvas.height,gt=aE(lt,ft),Rt=gt.getContext("2d"),Mt=et.width,Lt=et.height,Ht=et.left,Kt=et.top,Qt=new Path2D,sr=new Path2D;sr.rect(Ht,Kt,Mt,Lt),Qt.addPath(sr,o),Rt.clip(Qt);for(const _r of et.children)n3(Rt,o,g,_r,nt);const hr=Rt.getImageData(0,0,lt,ft),ur=hr.data;if(et.mask_type===JT.MASK_TYPE_LUMINANCE)for(let _r=0;_r<ur.length;_r+=4)ur[_r+3]=ur[_r+3]/255*(.2126*ur[_r]+.7152*ur[_r+1]+.0722*ur[_r+2]);Rt.putImageData(hr,0,0),b.globalCompositeOperation="destination-in",b.drawImage(gt,0,0)}function __(b){return b?new DOMMatrix([b.sx,b.ky,b.kx,b.sy,b.tx,b.ty]):new DOMMatrix}function h3(b,o){const g=b.step;let et=b.diffs[0]*g,nt=b.diffs[1]*g;o.moveTo(et,nt);for(let at=0,lt=2;at<b.commands.length;at++)switch(b.commands[at]){case oE.PATH_COMMAND_MOVE:et+=b.diffs[lt++]*g,nt+=b.diffs[lt++]*g,o.moveTo(et,nt);break;case oE.PATH_COMMAND_LINE:et+=b.diffs[lt++]*g,nt+=b.diffs[lt++]*g,o.lineTo(et,nt);break;case oE.PATH_COMMAND_QUAD:{const ft=et+b.diffs[lt++]*g,gt=nt+b.diffs[lt++]*g;et=ft+b.diffs[lt++]*g,nt=gt+b.diffs[lt++]*g,o.quadraticCurveTo(ft,gt,et,nt);break}case oE.PATH_COMMAND_CUBIC:{const ft=et+b.diffs[lt++]*g,gt=nt+b.diffs[lt++]*g,Rt=ft+b.diffs[lt++]*g,Mt=gt+b.diffs[lt++]*g;et=Rt+b.diffs[lt++]*g,nt=Mt+b.diffs[lt++]*g,o.bezierCurveTo(ft,gt,Rt,Mt,et,nt);break}case oE.PATH_COMMAND_CLOSE:o.closePath()}return o}function f3(b){return h3(b,new Path2D)}class Qw{constructor(o){this.capacity=o,this.cache=new Map}get(o){if(!this.cache.has(o))return;const g=this.cache.get(o);return this.cache.delete(o),this.cache.set(o,g),g}put(o,g){this.cache.has(o)?this.cache.delete(o):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(o,g)}delete(o){this.cache.delete(o)}}Ps(Qw,"LRUCache");class GC{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(o){return new Rp(o,o.data)}getFromCache(o,g,et){return this.cacheMap.has(et)||this.cacheMap.set(et,new Qw(150)),this.cacheMap.get(et).get(F0(o.toString(),g))}setInCache(o,g,et,nt){this.cacheDependenciesMap.has(nt)||this.cacheDependenciesMap.set(nt,new Map),this.cacheMap.has(nt)||this.cacheMap.set(nt,new Qw(150));const at=this.cacheDependenciesMap.get(nt),lt=F0(o.id.toString(),et);at.get(lt)||at.set(lt,new Set);const ft=this.cacheMap.get(nt),gt=o.toString();at.get(lt).add(gt),ft.put(F0(o.toString(),et),g)}removeImagesFromCacheByIds(o,g,et=0){if(!this.cacheMap.has(et)||!this.cacheDependenciesMap.has(et))return;const nt=this.cacheMap.get(et),at=this.cacheDependenciesMap.get(et);for(const lt of o){const ft=F0(lt.toString(),g);if(at.has(ft)){for(const gt of at.get(ft))nt.delete(gt);at.delete(ft)}}}rasterize(o,g,et,nt){const at=this.getFromCache(o,et,nt);if(at)return at.clone();const lt=function(gt,Rt){const Mt=s5.calculate(Rt.params,gt.metadata?gt.metadata.variables:[]),Lt=gt.usvg_tree,Ht=Lt.width,Kt=Lt.height,Qt=Math.max(1,Math.round(Ht*Rt.sx)),sr=Math.max(1,Math.round(Kt*Rt.sy)),hr=new DOMMatrix([Qt/Ht,0,0,sr/Kt,0,0]);return lE===null&&(lE=aE(10,10),VC=lE.getContext("2d",{willReadFrequently:!0})),lE.width=Qt,lE.height=sr,UC(VC,hr,Lt,Lt,Mt),VC.getImageData(0,0,Qt,sr)}(g.icon,o),ft=GC._getImage(lt);return this.setInCache(o,ft,et,nt),ft.clone()}}class p3{constructor(o){this.size=o,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(o,g){const et=this.toIdx(o,g);return{min:this.minimums[et],max:this.maximums[et]}}isLeaf(o,g){return this.leaves[this.toIdx(o,g)]}toIdx(o,g){return g*this.size+o}}function m3(b,o,g,et){let nt=0,at=Number.MAX_VALUE;for(let lt=0;lt<3;lt++)if(Math.abs(et[lt])<1e-15){if(g[lt]<b[lt]||g[lt]>o[lt])return null}else{const ft=1/et[lt];let gt=(b[lt]-g[lt])*ft,Rt=(o[lt]-g[lt])*ft;if(gt>Rt){const Mt=gt;gt=Rt,Rt=Mt}if(gt>nt&&(nt=gt),Rt<at&&(at=Rt),nt>at)return null}return nt}function x3(b,o,g,et,nt,at,lt,ft,gt,Rt,Mt){const Lt=et-b,Ht=nt-o,Kt=at-g,Qt=lt-b,sr=ft-o,hr=gt-g,ur=Mt[1]*hr-Mt[2]*sr,_r=Mt[2]*Qt-Mt[0]*hr,br=Mt[0]*sr-Mt[1]*Qt,Ir=Lt*ur+Ht*_r+Kt*br;if(Math.abs(Ir)<1e-15)return null;const Vr=1/Ir,Mr=Rt[0]-b,Hr=Rt[1]-o,Zr=Rt[2]-g,en=(Mr*ur+Hr*_r+Zr*br)*Vr;if(en<0||en>1)return null;const Tn=Hr*Kt-Zr*Ht,ln=Zr*Lt-Mr*Kt,Fn=Mr*Ht-Hr*Lt,Ln=(Mt[0]*Tn+Mt[1]*ln+Mt[2]*Fn)*Vr;return Ln<0||en+Ln>1?null:(Qt*Tn+sr*ln+hr*Fn)*Vr}function g3(b,o,g){return(b-o)/(g-o)}function y3(b,o,g,et,nt,at,lt,ft,gt){const Rt=1<<g,Mt=at-et,Lt=lt-nt,Ht=(b+1)/Rt*Mt+et,Kt=(o+0)/Rt*Lt+nt,Qt=(o+1)/Rt*Lt+nt;ft[0]=(b+0)/Rt*Mt+et,ft[1]=Kt,gt[0]=Ht,gt[1]=Qt}class _3{constructor(o){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=o,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const g=function(at){const lt=Math.ceil(Math.log2(at.dim/8)),ft=[];let gt=Math.ceil(Math.pow(2,lt));const Rt=1/gt,Mt=(Kt,Qt,sr,hr,ur)=>{const _r=hr?1:0,br=(Kt+1)*sr-_r,Ir=Qt*sr,Vr=(Qt+1)*sr-_r;ur[0]=Kt*sr,ur[1]=Ir,ur[2]=br,ur[3]=Vr};let Lt=new p3(gt);const Ht=[];for(let Kt=0;Kt<gt*gt;Kt++){Mt(Kt%gt,Math.floor(Kt/gt),Rt,!1,Ht);const Qt=r1(Ht[0],Ht[1],at),sr=r1(Ht[2],Ht[1],at),hr=r1(Ht[2],Ht[3],at),ur=r1(Ht[0],Ht[3],at);Lt.minimums.push(Math.min(Qt,sr,hr,ur)),Lt.maximums.push(Math.max(Qt,sr,hr,ur)),Lt.leaves.push(1)}for(ft.push(Lt),gt/=2;gt>=1;gt/=2){const Kt=ft[ft.length-1];Lt=new p3(gt);for(let Qt=0;Qt<gt*gt;Qt++){Mt(Qt%gt,Math.floor(Qt/gt),2,!0,Ht);const sr=Kt.getElevation(Ht[0],Ht[1]),hr=Kt.getElevation(Ht[2],Ht[1]),ur=Kt.getElevation(Ht[2],Ht[3]),_r=Kt.getElevation(Ht[0],Ht[3]),br=Kt.isLeaf(Ht[0],Ht[1]),Ir=Kt.isLeaf(Ht[2],Ht[1]),Vr=Kt.isLeaf(Ht[2],Ht[3]),Mr=Kt.isLeaf(Ht[0],Ht[3]),Hr=Math.min(sr.min,hr.min,ur.min,_r.min),Zr=Math.max(sr.max,hr.max,ur.max,_r.max),en=br&&Ir&&Vr&&Mr;Lt.maximums.push(Zr),Lt.minimums.push(Hr),Lt.leaves.push(Zr-Hr<=5&&en?1:0)}ft.push(Lt)}return ft}(this.dem),et=g.length-1,nt=g[et];this._addNode(nt.minimums[0],nt.maximums[0],nt.leaves[0]),this._construct(g,0,0,et,0)}raycastRoot(o,g,et,nt,at,lt,ft=1){return m3([o,g,-100],[et,nt,this.maximums[0]*ft],at,lt)}raycast(o,g,et,nt,at,lt,ft=1){if(!this.nodeCount)return null;const gt=this.raycastRoot(o,g,et,nt,at,lt,ft);if(gt==null)return null;const Rt=[],Mt=[],Lt=[],Ht=[],Kt=[{idx:0,t:gt,nodex:0,nodey:0,depth:0}];for(;Kt.length>0;){const{idx:Qt,t:sr,nodex:hr,nodey:ur,depth:_r}=Kt.pop();if(this.leaves[Qt]){y3(hr,ur,_r,o,g,et,nt,Lt,Ht);const Ir=1<<_r,Vr=(hr+0)/Ir,Mr=(hr+1)/Ir,Hr=(ur+0)/Ir,Zr=(ur+1)/Ir,en=r1(Vr,Hr,this.dem)*ft,Tn=r1(Mr,Hr,this.dem)*ft,ln=r1(Mr,Zr,this.dem)*ft,Fn=r1(Vr,Zr,this.dem)*ft,Ln=x3(Lt[0],Lt[1],en,Ht[0],Lt[1],Tn,Ht[0],Ht[1],ln,at,lt),jn=x3(Ht[0],Ht[1],ln,Lt[0],Ht[1],Fn,Lt[0],Lt[1],en,at,lt),Zn=Math.min(Ln!==null?Ln:Number.MAX_VALUE,jn!==null?jn:Number.MAX_VALUE);if(Zn!==Number.MAX_VALUE)return Zn;{const Qn=Sn([],at,lt,sr);if(v3(en,Tn,Fn,ln,g3(Qn[0],Lt[0],Ht[0]),g3(Qn[1],Lt[1],Ht[1]))>=Qn[2])return sr}continue}let br=0;for(let Ir=0;Ir<this._siblingOffset.length;Ir++){y3((hr<<1)+this._siblingOffset[Ir][0],(ur<<1)+this._siblingOffset[Ir][1],_r+1,o,g,et,nt,Lt,Ht),Lt[2]=-100,Ht[2]=this.maximums[this.childOffsets[Qt]+Ir]*ft;const Vr=m3(Lt,Ht,at,lt);if(Vr!=null){const Mr=Vr;Rt[Ir]=Mr;let Hr=!1;for(let Zr=0;Zr<br&&!Hr;Zr++)Mr>=Rt[Mt[Zr]]&&(Mt.splice(Zr,0,Ir),Hr=!0);Hr||(Mt[br]=Ir),br++}}for(let Ir=0;Ir<br;Ir++){const Vr=Mt[Ir];Kt.push({idx:this.childOffsets[Qt]+Vr,t:Rt[Vr],nodex:(hr<<1)+this._siblingOffset[Vr][0],nodey:(ur<<1)+this._siblingOffset[Vr][1],depth:_r+1})}}return null}_addNode(o,g,et){return this.minimums.push(o),this.maximums.push(g),this.leaves.push(et),this.childOffsets.push(0),this.nodeCount++}_construct(o,g,et,nt,at){if(o[nt].isLeaf(g,et)===1)return;this.childOffsets[at]||(this.childOffsets[at]=this.nodeCount);const lt=nt-1,ft=o[lt];let gt=0,Rt=0;for(let Mt=0;Mt<this._siblingOffset.length;Mt++){const Lt=2*g+this._siblingOffset[Mt][0],Ht=2*et+this._siblingOffset[Mt][1],Kt=ft.getElevation(Lt,Ht),Qt=ft.isLeaf(Lt,Ht),sr=this._addNode(Kt.min,Kt.max,Qt);Qt&&(gt|=1<<Mt),Rt||(Rt=sr)}for(let Mt=0;Mt<this._siblingOffset.length;Mt++)gt&1<<Mt||this._construct(o,2*g+this._siblingOffset[Mt][0],2*et+this._siblingOffset[Mt][1],lt,Rt+Mt)}}function v3(b,o,g,et,nt,at){return so(so(b,g,at),so(o,et,at),nt)}function r1(b,o,g){const et=g.dim,nt=pr(b*et-.5,0,et-1),at=pr(o*et-.5,0,et-1),lt=Math.floor(nt),ft=Math.floor(at),gt=Math.min(lt+1,et-1),Rt=Math.min(ft+1,et-1);return v3(g.get(lt,ft),g.get(gt,ft),g.get(lt,Rt),g.get(gt,Rt),nt-lt,at-ft)}const o5={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function a5(b,o,g){return(256*b*256+256*o+g)/10-1e4}function l5(b,o,g){return 256*b+o+g/256-32768}class Jw{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(o,g,et,nt=!1){if(this.uid=o,g.height!==g.width)throw new RangeError("DEM tiles must be square");if(et&&et!=="mapbox"&&et!=="terrarium")return void bs(`"${et}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=g.height;const at=this.dim=g.height-2,lt=new Uint32Array(g.data.buffer);if(this.pixels=new Uint8Array(g.data.buffer),this.floatView=new Float32Array(g.data.buffer),this.borderReady=nt,this._modifiedForSources={},!nt){for(let gt=0;gt<at;gt++)lt[this._idx(-1,gt)]=lt[this._idx(0,gt)],lt[this._idx(at,gt)]=lt[this._idx(at-1,gt)],lt[this._idx(gt,-1)]=lt[this._idx(gt,0)],lt[this._idx(gt,at)]=lt[this._idx(gt,at-1)];lt[this._idx(-1,-1)]=lt[this._idx(0,0)],lt[this._idx(at,-1)]=lt[this._idx(at-1,0)],lt[this._idx(-1,at)]=lt[this._idx(0,at-1)],lt[this._idx(at,at)]=lt[this._idx(at-1,at-1)]}const ft=et==="terrarium"?l5:a5;for(let gt=0;gt<lt.length;++gt){const Rt=4*gt;this.floatView[gt]=ft(this.pixels[Rt],this.pixels[Rt+1],this.pixels[Rt+2])}this._timestamp=uo.now()}_buildQuadTree(){this._tree=new _3(this)}get(o,g,et=!1){et&&(o=pr(o,-1,this.dim),g=pr(g,-1,this.dim));const nt=this._idx(o,g);return this.floatView[nt]}set(o,g,et){const nt=this._idx(o,g),at=this.floatView[nt];return this.floatView[nt]=et,et-at}static getUnpackVector(o){return o5[o]}_idx(o,g){if(o<-1||o>=this.dim+1||g<-1||g>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(g+1)*this.stride+(o+1)}static pack(o,g){const et=[0,0,0,0],nt=Jw.getUnpackVector(g);let at=Math.floor((o+nt[3])/nt[2]);return et[2]=at%256,at=Math.floor(at/256),et[1]=at%256,at=Math.floor(at/256),et[0]=at,et}getPixels(){return new pA({width:this.stride,height:this.stride},this.pixels)}backfillBorder(o,g,et){if(this.dim!==o.dim)throw new Error("dem dimension mismatch");let nt=g*this.dim,at=g*this.dim+this.dim,lt=et*this.dim,ft=et*this.dim+this.dim;switch(g){case-1:nt=at-1;break;case 1:at=nt+1}switch(et){case-1:lt=ft-1;break;case 1:ft=lt+1}const gt=-g*this.dim,Rt=-et*this.dim;for(let Mt=lt;Mt<ft;Mt++)for(let Lt=nt;Lt<at;Lt++){const Ht=4*this._idx(Lt,Mt),Kt=4*this._idx(Lt+gt,Mt+Rt);this.pixels[Ht+0]=o.pixels[Kt+0],this.pixels[Ht+1]=o.pixels[Kt+1],this.pixels[Ht+2]=o.pixels[Kt+2],this.pixels[Ht+3]=o.pixels[Kt+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function c5(b,o,g){b===1?o.headerLength=g.readFixed32():b===2?o.x=g.readVarint():b===3?o.y=g.readVarint():b===4?o.z=g.readVarint():b===5&&o.layers.push(function(et,nt){return et.readFields(p5,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},nt)}(g,g.readVarint()+g.pos))}function u5(b,o,g){b===1?(o.delta_filter=function(et,nt){return et.readFields(d5,{blockSize:0},nt)}(g,g.readVarint()+g.pos),o.filter="delta_filter"):b===2?(g.readVarint(),o.filter="zigzag_filter"):b===3?(g.readVarint(),o.filter="bitshuffle_filter"):b===4&&(g.readVarint(),o.filter="byteshuffle_filter")}function d5(b,o,g){b===1&&(o.blockSize=g.readVarint())}function h5(b,o,g){b===1?(g.readVarint(),o.codec="gzip_data"):b===2?(g.readVarint(),o.codec="jpeg_image"):b===3?(g.readVarint(),o.codec="webp_image"):b===4&&(g.readVarint(),o.codec="png_image")}function f5(b,o,g){let et=0,nt=0;b===1?o.firstByte=g.readFixed64():b===2?o.lastByte=g.readFixed64():b===3?o.filters.push(function(at,lt){return at.readFields(u5,{},lt)}(g,g.readVarint()+g.pos)):b===4?o.codec=function(at,lt){return at.readFields(h5,{},lt)}(g,g.readVarint()+g.pos):b===5?nt=g.readFloat():b===6?et=g.readFloat():b===7?o.bands.push(g.readString()):b===8?o.offset=g.readDouble():b===9&&(o.scale=g.readDouble()),o.offset===0&&(o.offset=nt),o.scale===0&&(o.scale=et)}function p5(b,o,g){b===1?o.version=g.readVarint():b===2?o.name=g.readString():b===3?o.units=g.readString():b===4?o.tileSize=g.readVarint():b===5?o.buffer=g.readVarint():b===6?o.pixelFormat=g.readVarint():b===7&&o.dataIndex.push(function(et,nt){return et.readFields(f5,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},nt)}(g,g.readVarint()+g.pos))}function m5(b,o,g){if(b===2)(function(et,nt,at){et.readFields(x5,at,nt)})(g,g.readVarint()+g.pos,o);else if(b===3)throw new Error("Not implemented")}function x5(b,o,g){if(b===1){let et=0;const nt=g.readVarint()+g.pos;for(;g.pos<nt;)o[et++]=g.readVarint()}}function g5(b,o){if(o.length!==4)throw new Error(`Expected data of dimension 4 but got ${o.length}.`);let g=o[3];for(let et=2;et>=1;et--){const nt=et===1?1:0,at=et===2?1:0;for(let lt=0;lt<o[0];lt++){const ft=o[1]*lt;for(let gt=nt;gt<o[1];gt++){const Rt=o[2]*(gt+ft);for(let Mt=at;Mt<o[2];Mt++){const Lt=o[3]*(Mt+Rt);for(let Ht=0;Ht<o[3];Ht++){const Kt=Lt+Ht;b[Kt]+=b[Kt-g]}}}}g*=o[et]}return b}function y5(b){for(let o=0,g=b.length;o<g;o++)b[o]=b[o]>>>1^-(1&b[o]);return b}function _5(b,o){switch(o){case"uint32":return b;case"uint16":for(let g=0;g<b.length;g+=2){const et=b[g],nt=b[g+1];b[g]=(240&et)>>4|(61440&et)>>8|(240&nt)<<4|61440&nt,b[g+1]=15&et|(3840&et)>>4|(15&nt)<<8|(3840&nt)<<4}return b;case"uint8":for(let g=0;g<b.length;g+=4){const et=b[g],nt=b[g+1],at=b[g+2],lt=b[g+3];b[g+0]=(192&et)>>6|(192&nt)>>4|(192&at)>>2|192&lt,b[g+1]=(48&et)>>4|(48&nt)>>2|48&at|(48&lt)<<2,b[g+2]=(12&et)>>2|12&nt|(12&at)<<2|(12&lt)<<4,b[g+3]=3&et|(3&nt)<<2|(3&at)<<4|(3&lt)<<6}return b;default:throw new Error(`Invalid pixel format, "${o}"`)}}Ps(Jw,"DEMData"),Ps(_3,"DemMinMaxQuadTree",{omit:["dem"]});var O0=Uint8Array,cE=Uint16Array,v5=Int32Array,E3=new O0([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),b3=new O0([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),E5=new O0([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),w3=function(b,o){for(var g=new cE(31),et=0;et<31;++et)g[et]=o+=1<<b[et-1];var nt=new v5(g[30]);for(et=1;et<30;++et)for(var at=g[et];at<g[et+1];++at)nt[at]=at-g[et]<<5|et;return{b:g,r:nt}},C3=w3(E3,2),A3=C3.b,b5=C3.r;A3[28]=258,b5[258]=28;for(var w5=w3(b3,0).b,S3=new cE(32768),lp=0;lp<32768;++lp){var v_=(43690&lp)>>1|(21845&lp)<<1;S3[lp]=((65280&(v_=(61680&(v_=(52428&v_)>>2|(13107&v_)<<2))>>4|(3855&v_)<<4))>>8|(255&v_)<<8)>>1}var uE=function(b,o,g){for(var et=b.length,nt=0,at=new cE(o);nt<et;++nt)b[nt]&&++at[b[nt]-1];var lt,ft=new cE(o);for(nt=1;nt<o;++nt)ft[nt]=ft[nt-1]+at[nt-1]<<1;lt=new cE(1<<o);var gt=15-o;for(nt=0;nt<et;++nt)if(b[nt])for(var Rt=nt<<4|b[nt],Mt=o-b[nt],Lt=ft[b[nt]-1]++<<Mt,Ht=Lt|(1<<Mt)-1;Lt<=Ht;++Lt)lt[S3[Lt]>>gt]=Rt;return lt},dE=new O0(288);for(lp=0;lp<144;++lp)dE[lp]=8;for(lp=144;lp<256;++lp)dE[lp]=9;for(lp=256;lp<280;++lp)dE[lp]=7;for(lp=280;lp<288;++lp)dE[lp]=8;var T3=new O0(32);for(lp=0;lp<32;++lp)T3[lp]=5;var C5=uE(dE,9),A5=uE(T3,5),$C=function(b){for(var o=b[0],g=1;g<b.length;++g)b[g]>o&&(o=b[g]);return o},_m=function(b,o,g){var et=o/8|0;return(b[et]|b[et+1]<<8)>>(7&o)&g},HC=function(b,o){var g=o/8|0;return(b[g]|b[g+1]<<8|b[g+2]<<16)>>(7&o)},S5=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],vm=function(b,o,g){var et=new Error(o||S5[b]);if(et.code=b,Error.captureStackTrace&&Error.captureStackTrace(et,vm),!g)throw et;return et},T5=new O0(0),R5=typeof TextDecoder<"u"&&new TextDecoder;try{R5.decode(T5,{stream:!0})}catch{}const I5={gzip_data:"gzip"};class Z0 extends Error{constructor(o){super(o),this.name="MRTError"}}const D5={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},R3={uint32:1,uint16:2,uint8:4},P5={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let WC;class e2{constructor(o=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=o}getLayer(o){const g=this.layers[o];if(!g)throw new Z0(`Layer '${o}' not found`);return g}getHeaderLength(o){const g=new Uint8Array(o),et=new DataView(o);if(g[0]!==13)throw new Z0("File is not a valid MRT.");return et.getUint32(1,!0)}parseHeader(o){const g=new Uint8Array(o),et=this.getHeaderLength(o);if(g.length<et)throw new Z0(`Expected header with length >= ${et} but got buffer of length ${g.length}`);const nt=new WC(g.subarray(0,et)).readFields(c5,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==nt.x||this.y!==nt.y||this.z!==nt.z))throw new Z0(`Invalid attempt to parse header ${nt.z}/${nt.x}/${nt.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=nt.x,this.y=nt.y,this.z=nt.z;for(const at of nt.layers)this.layers[at.name]=new I3(at,{cacheSize:this._cacheSize});return this}createDecodingTask(o){const g=[],et=this.getLayer(o.layerName);for(let nt of o.blockIndices){const at=et.dataIndex[nt],lt=at.firstByte-o.firstByte,ft=at.lastByte-o.firstByte;if(et._blocksInProgress.has(nt))continue;const gt={layerName:et.name,firstByte:lt,lastByte:ft,pixelFormat:et.pixelFormat,blockIndex:nt,blockShape:[at.bands.length].concat(et.bandShape),buffer:et.buffer,codec:at.codec.codec,filters:at.filters.map(Rt=>Rt.filter)};et._blocksInProgress.add(nt),g.push(gt)}return new D3(g,()=>{g.forEach(nt=>et._blocksInProgress.delete(nt.blockIndex))},(nt,at)=>{if(g.forEach(lt=>et._blocksInProgress.delete(lt.blockIndex)),nt)throw nt;at.forEach(lt=>{this.getLayer(lt.layerName).processDecodedData(lt)})})}}class I3{constructor({version:o,name:g,units:et,tileSize:nt,pixelFormat:at,buffer:lt,dataIndex:ft},gt){if(this.version=o,this.version!==1)throw new Z0(`Cannot parse raster layer encoded with MRT version ${o}`);this.name=g,this.units=et,this.tileSize=nt,this.buffer=lt,this.pixelFormat=D5[at],this.dataIndex=ft,this.bandShape=[nt+2*lt,nt+2*lt,R3[this.pixelFormat]],this._decodedBlocks=new Qw(gt?gt.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return R3[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:o})=>o).flat()}processDecodedData(o){const g=o.blockIndex.toString();this._decodedBlocks.get(g)||this._decodedBlocks.put(g,o.data)}getBlockForBand(o){let g=0;switch(typeof o){case"string":for(const[et,nt]of this.dataIndex.entries()){for(const[at,lt]of nt.bands.entries())if(lt===o)return{bandIndex:g+at,blockIndex:et,blockBandIndex:at};g+=nt.bands.length}break;case"number":for(const[et,nt]of this.dataIndex.entries()){if(o>=g&&o<g+nt.bands.length)return{bandIndex:o,blockIndex:et,blockBandIndex:o-g};g+=nt.bands.length}break;default:throw new Z0(`Invalid band \`${JSON.stringify(o)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(o){let g=1/0,et=-1/0;const nt=[],at=new Set;for(const lt of o){const{blockIndex:ft}=this.getBlockForBand(lt);if(ft<0)throw new Z0(`Invalid band: ${JSON.stringify(lt)}`);const gt=this.dataIndex[ft];nt.includes(ft)||nt.push(ft),at.add(ft),g=Math.min(g,gt.firstByte),et=Math.max(et,gt.lastByte)}if(at.size>this.cacheSize)throw new Z0(`Number of blocks to decode (${at.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:g,lastByte:et,blockIndices:nt}}hasBand(o){const{blockIndex:g}=this.getBlockForBand(o);return g>=0}hasDataForBand(o){const{blockIndex:g}=this.getBlockForBand(o);return g>=0&&!!this._decodedBlocks.get(g.toString())}getBandView(o){const{blockIndex:g,blockBandIndex:et}=this.getBlockForBand(o);if(g<0)throw new Z0(`Band not found: ${JSON.stringify(o)}`);const nt=this._decodedBlocks.get(g.toString());if(!nt)throw new Z0(`Data for band ${JSON.stringify(o)} of layer "${this.name}" not decoded.`);const at=this.dataIndex[g],lt=this.bandShape.reduce((Rt,Mt)=>Rt*Mt,1),ft=et*lt,gt=nt.subarray(ft,ft+lt);return{data:gt,bytes:new Uint8Array(gt.buffer).subarray(gt.byteOffset,gt.byteOffset+gt.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:at.offset,scale:at.scale}}}e2.setPbf=function(b){WC=b};class D3{constructor(o,g,et){this.tasks=o,this._onCancel=g,this._onComplete=et,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(o,g){this._finalized||(this._onComplete(o,g),this._finalized=!0)}}e2.performDecoding=function(b,o){const g=new Uint8Array(b);return Promise.all(o.tasks.map(et=>{const{layerName:nt,firstByte:at,lastByte:lt,pixelFormat:ft,blockShape:gt,blockIndex:Rt,filters:Mt,codec:Lt}=et,Ht=g.subarray(at,lt+1),Kt=new Uint32Array(gt[0]*gt[1]*gt[2]);let Qt;if(Lt!=="gzip_data")throw new Z0(`Unhandled codec: ${Lt}`);return Qt=function(sr,hr){if(!globalThis.DecompressionStream&&hr==="gzip_data")return Promise.resolve(((Ir=function(Hr){Hr[0]==31&&Hr[1]==139&&Hr[2]==8||vm(6,"invalid gzip data");var Zr=Hr[3],en=10;4&Zr&&(en+=2+(Hr[10]|Hr[11]<<8));for(var Tn=(Zr>>3&1)+(Zr>>4&1);Tn>0;Tn-=!Hr[en++]);return en+(2&Zr)}(br=sr))+8>br.length&&vm(6,"invalid gzip data"),function(Hr,Zr,en,Tn){var ln=Hr.length;if(!ln||Zr.f&&!Zr.l)return en||new O0(0);var Fn=!en,Ln=Fn||Zr.i!=2,jn=Zr.i;Fn&&(en=new O0(3*ln));var Zn,Qn,Hn=function(Hl){var Sl=en.length;if(Hl>Sl){var Fl=new O0(Math.max(2*Sl,Hl));Fl.set(en),en=Fl}},Wn=Zr.f||0,kn=Zr.p||0,In=Zr.b||0,Kn=Zr.l,as=Zr.d,es=Zr.m,$s=Zr.n,vs=8*ln;do{if(!Kn){Wn=_m(Hr,kn,1);var Is=_m(Hr,kn+1,3);if(kn+=3,!Is){var Ns=Hr[(Bn=4+((kn+7)/8|0))-4]|Hr[Bn-3]<<8,Fo=Bn+Ns;if(Fo>ln){jn&&vm(0);break}Ln&&Hn(In+Ns),en.set(Hr.subarray(Bn,Fo),In),Zr.b=In+=Ns,Zr.p=kn=8*Fo,Zr.f=Wn;continue}if(Is==1)Kn=C5,as=A5,es=9,$s=5;else if(Is==2){var ts=_m(Hr,kn,31)+257,Os=_m(Hr,kn+10,15)+4,fo=ts+_m(Hr,kn+5,31)+1;kn+=14;for(var Ko=new O0(fo),xa=new O0(19),wo=0;wo<Os;++wo)xa[E5[wo]]=_m(Hr,kn+3*wo,7);kn+=3*Os;var $l=$C(xa),Nr=(1<<$l)-1,Ur=uE(xa,$l);for(wo=0;wo<fo;){var Bn,Yn=Ur[_m(Hr,kn,Nr)];if(kn+=15&Yn,(Bn=Yn>>4)<16)Ko[wo++]=Bn;else{var xs=0,gs=0;for(Bn==16?(gs=3+_m(Hr,kn,3),kn+=2,xs=Ko[wo-1]):Bn==17?(gs=3+_m(Hr,kn,7),kn+=3):Bn==18&&(gs=11+_m(Hr,kn,127),kn+=7);gs--;)Ko[wo++]=xs}}var Ws=Ko.subarray(0,ts),Zs=Ko.subarray(ts);es=$C(Ws),$s=$C(Zs),Kn=uE(Ws,es),as=uE(Zs,$s)}else vm(1);if(kn>vs){jn&&vm(0);break}}Ln&&Hn(In+131072);for(var vo=(1<<es)-1,Ro=(1<<$s)-1,ko=kn;;ko=kn){var $o=(xs=Kn[HC(Hr,kn)&vo])>>4;if((kn+=15&xs)>vs){jn&&vm(0);break}if(xs||vm(2),$o<256)en[In++]=$o;else{if($o==256){ko=kn,Kn=null;break}var io=$o-254;$o>264&&(io=_m(Hr,kn,(1<<(wl=E3[wo=$o-257]))-1)+A3[wo],kn+=wl);var ho=as[HC(Hr,kn)&Ro],xl=ho>>4;if(ho||vm(3),kn+=15&ho,Zs=w5[xl],xl>3){var wl=b3[xl];Zs+=HC(Hr,kn)&(1<<wl)-1,kn+=wl}if(kn>vs){jn&&vm(0);break}Ln&&Hn(In+131072);var Cl=In+io;if(In<Zs){var Nl=0-Zs,Ql=Math.min(Zs,Cl);for(Nl+In<0&&vm(3);In<Ql;++In)en[In]=(void 0)[Nl+In]}for(;In<Cl;++In)en[In]=en[In-Zs]}}Zr.l=Kn,Zr.p=ko,Zr.b=In,Zr.f=Wn,Kn&&(Wn=1,Zr.m=es,Zr.d=as,Zr.n=$s)}while(!Wn);return In!=en.length&&Fn?(Zn=en,((Qn=In)==null||Qn>Zn.length)&&(Qn=Zn.length),new O0(Zn.subarray(0,Qn))):en.subarray(0,In)}(br.subarray(Ir,-8),{i:2},new O0(((ur=br)[(_r=ur.length)-4]|ur[_r-3]<<8|ur[_r-2]<<16|ur[_r-1]<<24)>>>0))));var ur,_r,br,Ir;const Vr=I5[hr];if(!Vr)throw new Error(`Unhandled codec: ${hr}`);const Mr=new globalThis.DecompressionStream(Vr);return new Response(new Blob([sr]).stream().pipeThrough(Mr)).arrayBuffer().then(Hr=>new Uint8Array(Hr))}(Ht,Lt).then(sr=>(function(hr,ur){hr.readFields(m5,ur)}(new WC(sr),Kt),new P5[ft](Kt.buffer))),Qt.then(sr=>{for(let hr=Mt.length-1;hr>=0;hr--)switch(Mt[hr]){case"delta_filter":g5(sr,gt);break;case"zigzag_filter":y5(sr);break;case"bitshuffle_filter":_5(sr,ft);break;default:throw new Z0(`Unhandled filter "${Mt[hr]}"`)}return{layerName:nt,blockIndex:Rt,data:sr}}).catch(sr=>{throw sr})}))},Ps(D3,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),Ps(e2,"MapboxRasterTile"),Ps(I3,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class P3{constructor(o){this._stringToNumber={},this._numberToString=[];for(let g=0;g<o.length;g++){const et=o[g];this._stringToNumber[et]=g,this._numberToString[g]=et}}encode(o){return this._stringToNumber[o]}decode(o){return this._numberToString[o]}}class k3{constructor(o,g){this.tileID=o,this.x=o.canonical.x,this.y=o.canonical.y,this.z=o.canonical.z,this.grid=new Vx(ss,16,0),this.featureIndexArray=new vv,this.promoteId=g,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(o,g,et,nt,at,lt=0,ft=0){const gt=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(et,nt,at,lt);const Rt=this.grid;for(let Mt=0;Mt<g.length;Mt++){const Lt=g[Mt],Ht=[1/0,1/0,-1/0,-1/0];for(let Kt=0;Kt<Lt.length;Kt++){const Qt=Lt[Kt];Ht[0]=Math.min(Ht[0],Qt.x),Ht[1]=Math.min(Ht[1],Qt.y),Ht[2]=Math.max(Ht[2],Qt.x),Ht[3]=Math.max(Ht[3],Qt.y)}ft!==0&&(Ht[0]-=ft,Ht[1]-=ft,Ht[2]+=ft,Ht[3]+=ft),Ht[0]<ss&&Ht[1]<ss&&Ht[2]>=0&&Ht[3]>=0&&Rt.insert(gt,Ht[0],Ht[1],Ht[2],Ht[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new yn(new Dw(this.rawTileData)).layers,this.sourceLayerCoder=new P3(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const o in this.vtLayers)this.vtFeatures[o]=[]}return this.vtLayers}query(o,g){const{tilespaceGeometry:et,transform:nt,tileTransform:at,pixelPosMatrix:lt,availableImages:ft,worldview:gt}=g;this.loadVTLayers(),this.serializedLayersCache.clear();const Rt=g.queryRadius?g.queryRadius:0,Mt=et.bufferedTilespaceBounds,Lt=this.grid.query(Mt.min.x,Mt.min.y,Mt.max.x,Mt.max.y,(sr,hr,ur,_r)=>Op(et.bufferedTilespaceGeometry,sr-Rt,hr-Rt,ur+Rt,_r+Rt));Lt.sort(k5);let Ht=null;nt.elevation&&Lt.length>0&&(Ht=g_.create(nt.elevation,this.tileID));const Kt={};let Qt;for(let sr=0;sr<Lt.length;sr++){const hr=Lt[sr];if(hr===Qt)continue;Qt=hr;const ur=this.featureIndexArray.get(hr);let _r=null;this.is3DTile?this.loadMatchingModelFeature(Kt,ur,o,et,nt,gt):this.loadMatchingFeature(Kt,ur,o,ft,gt,(br,Ir,Vr,Mr=0)=>(_r||(_r=Xr(br,this.tileID.canonical,at)),Ir.queryIntersectsFeature(et,br,Vr,_r,this.z,nt,lt,Ht,Mr)))}return Kt}loadMatchingFeature(o,g,et,nt,at,lt){const{featureIndex:ft,bucketIndex:gt,sourceLayerIndex:Rt,layoutVertexArrayOffset:Mt}=g,Lt=this.bucketLayerIDs[gt],Ht=et.layers,Kt=Object.keys(Ht);if(Kt.length&&!Ts(Kt,Lt))return;const Qt=et.sourceCache,sr=this.sourceLayerCoder.decode(Rt),hr=this.vtLayers[sr].feature(ft),ur=this.getId(hr,sr);for(let _r=0;_r<Lt.length;_r++){const br=Lt[_r];if(!Ht[br])continue;const{styleLayer:Ir,targets:Vr}=Ht[br];let Mr={};ur!==void 0&&(Mr=Qt.getFeatureState(Ir.sourceLayer,ur));const Hr=!lt||lt(hr,Ir,Mr,Mt);if(!Hr)continue;const Zr=new G1(hr,this.z,this.x,this.y,ur);Zr.tile=this.tileID.canonical,Zr.state=Mr;let en=this.serializedLayersCache.get(br);en||(en=Ir.serialize(),en.id=br,this.serializedLayersCache.set(br,en)),Zr.source=en.source,Zr.sourceLayer=en["source-layer"],Zr.layer=Object.assign({},en),Zr.layer.paint=F3(en.paint,Ir.paint,hr,Mr,nt),Zr.layer.layout=F3(en.layout,Ir.layout,hr,Mr,nt);let Tn=!1;for(const ln of Vr){this.updateFeatureProperties(Zr,ln);const{filter:Fn}=ln;if(Fn){if(hr.properties=Zr.properties,Fn.needGeometry){const Ln=an(hr,!0);if(!Fn.filter(new ou(this.tileID.overscaledZ,{worldview:at}),Ln,this.tileID.canonical))continue}else if(!Fn.filter(new ou(this.tileID.overscaledZ,{worldview:at}),hr))continue}Tn=!0,ln.targetId&&this.addFeatureVariant(Zr,ln)}Tn&&this.appendToResult(o,br,ft,Zr,Hr)}}loadMatchingModelFeature(o,g,et,nt,at,lt){const{featureIndex:ft,bucketIndex:gt}=g,Rt=this.bucketLayerIDs[gt],Mt=et.layers,Lt=Object.keys(Mt);if(!Lt.length||Ts(Lt,Rt))for(let Ht=0;Ht<Rt.length;Ht++){const Kt=Rt[Ht],{styleLayer:Qt,targets:sr}=Mt[Kt];if(Qt.type!=="model")continue;const hr=nt.tile,ur=hr.getBucket(Qt);if(!(ur&&ur instanceof qw))continue;const _r=jI(ur,ft,nt,at);if(!_r)continue;const{z:br,x:Ir,y:Vr}=hr.tileID.canonical,{feature:Mr,intersectionZ:Hr,position:Zr}=_r;let en={};Mr.id!==void 0&&(en=et.sourceCache.getFeatureState(Qt.sourceLayer,Mr.id));const Tn=new G1({},br,Ir,Vr,Mr.id);Tn.tile=this.tileID.canonical,Tn.state=en,Tn.properties=Mr.properties,Tn.geometry={type:"Point",coordinates:[Zr.lng,Zr.lat]};let ln=this.serializedLayersCache.get(Kt);ln||(ln=Qt.serialize(),ln.id=Kt,this.serializedLayersCache.set(Kt,ln)),Tn.source=ln.source,Tn.sourceLayer=ln["source-layer"],Tn.layer=Object.assign({},ln);let Fn=!1;for(const Ln of sr){this.updateFeatureProperties(Tn,Ln);const{filter:jn}=Ln;if(jn){if(Mr.properties=Tn.properties,jn.needGeometry){if(!jn.filter(new ou(this.tileID.overscaledZ,{worldview:lt}),Mr,this.tileID.canonical))continue}else if(!jn.filter(new ou(this.tileID.overscaledZ,{worldview:lt}),Mr))continue}Fn=!0,Ln.targetId&&this.addFeatureVariant(Tn,Ln)}Fn&&this.appendToResult(o,Kt,ft,Tn,Hr)}}updateFeatureProperties(o,g,et){if(g.properties){const nt={};for(const at in g.properties){const lt=g.properties[at].evaluate({zoom:this.z},o._vectorTileFeature,o.state,o.tile,et);lt!=null&&(nt[at]=lt)}o.properties=nt}}addFeatureVariant(o,g,et){const nt={target:g.target,namespace:g.namespace,uniqueFeatureID:g.uniqueFeatureID};g.properties&&(nt.properties=o.properties),o.variants=o.variants||{},o.variants[g.targetId]=o.variants[g.targetId]||[],o.variants[g.targetId].push(nt)}appendToResult(o,g,et,nt,at){let lt=o[g];lt===void 0&&(lt=o[g]=[]),lt.push({featureIndex:et,feature:nt,intersectionZ:at})}lookupSymbolFeatures(o,g,et,nt,at,lt){const ft={};this.loadVTLayers();for(const gt of o)this.loadMatchingFeature(ft,{bucketIndex:g,sourceLayerIndex:et,featureIndex:gt,layoutVertexArrayOffset:0},nt,at,lt);return ft}loadFeature(o){const{featureIndex:g,sourceLayerIndex:et}=o;this.loadVTLayers();const nt=this.sourceLayerCoder.decode(et),at=this.vtFeatures[nt];if(at[g])return at[g];const lt=this.vtLayers[nt].feature(g);return at[g]=lt,lt}hasLayer(o){for(const g of this.bucketLayerIDs)for(const et of g)if(o===et)return!0;return!1}getId(o,g){let et=o.id;if(this.promoteId){const nt=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[g];if(nt!=null)if(Array.isArray(nt)){if(!this.promoteIdExpression){const at=Om(nt);if(at.result!=="success"){const lt=at.value.map(ft=>`${ft.key}: ${ft.message}`).join(", ");return void bs(`Failed to create expression for promoteId: ${lt}`)}this.promoteIdExpression=at.value}et=this.promoteIdExpression.evaluate({zoom:0},o)}else et=o.properties[nt];typeof et=="boolean"&&(et=Number(et))}return et}}function F3(b,o,g,et,nt){return vn(b,(at,lt)=>{const ft=o instanceof ax?o.get(lt):null;return ft&&ft.evaluate?ft.evaluate(g,et,void 0,nt):ft})}function k5(b,o){return o-b}Ps(k3,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const B3=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class qC{static from(o){if(!(o instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[g,et]=new Uint8Array(o,0,2);if(g!==219)throw new Error("Data does not appear to be in a KDBush format.");const nt=et>>4;if(nt!==1)throw new Error(`Got v${nt} data when expected v1.`);const at=B3[15&et];if(!at)throw new Error("Unrecognized array type.");const[lt]=new Uint16Array(o,2,1),[ft]=new Uint32Array(o,4,1);return new qC(ft,lt,at,o)}constructor(o,g=64,et=Float64Array,nt){if(isNaN(o)||o<0)throw new Error(`Unpexpected numItems value: ${o}.`);this.numItems=+o,this.nodeSize=Math.min(Math.max(+g,2),65535),this.ArrayType=et,this.IndexArrayType=o<65536?Uint16Array:Uint32Array;const at=B3.indexOf(this.ArrayType),lt=2*o*this.ArrayType.BYTES_PER_ELEMENT,ft=o*this.IndexArrayType.BYTES_PER_ELEMENT,gt=(8-ft%8)%8;if(at<0)throw new Error(`Unexpected typed array class: ${et}.`);nt&&nt instanceof ArrayBuffer?(this.data=nt,this.ids=new this.IndexArrayType(this.data,8,o),this.coords=new this.ArrayType(this.data,8+ft+gt,2*o),this._pos=2*o,this._finished=!0):(this.data=new ArrayBuffer(8+lt+ft+gt),this.ids=new this.IndexArrayType(this.data,8,o),this.coords=new this.ArrayType(this.data,8+ft+gt,2*o),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+at]),new Uint16Array(this.data,2,1)[0]=g,new Uint32Array(this.data,4,1)[0]=o)}add(o,g){const et=this._pos>>1;return this.ids[et]=et,this.coords[this._pos++]=o,this.coords[this._pos++]=g,et}finish(){const o=this._pos>>1;if(o!==this.numItems)throw new Error(`Added ${o} items when expected ${this.numItems}.`);return XC(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(o,g,et,nt){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:at,coords:lt,nodeSize:ft}=this,gt=[0,at.length-1,0],Rt=[];for(;gt.length;){const Mt=gt.pop()||0,Lt=gt.pop()||0,Ht=gt.pop()||0;if(Lt-Ht<=ft){for(let hr=Ht;hr<=Lt;hr++){const ur=lt[2*hr],_r=lt[2*hr+1];ur>=o&&ur<=et&&_r>=g&&_r<=nt&&Rt.push(at[hr])}continue}const Kt=Ht+Lt>>1,Qt=lt[2*Kt],sr=lt[2*Kt+1];Qt>=o&&Qt<=et&&sr>=g&&sr<=nt&&Rt.push(at[Kt]),(Mt===0?o<=Qt:g<=sr)&&(gt.push(Ht),gt.push(Kt-1),gt.push(1-Mt)),(Mt===0?et>=Qt:nt>=sr)&&(gt.push(Kt+1),gt.push(Lt),gt.push(1-Mt))}return Rt}within(o,g,et){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:nt,coords:at,nodeSize:lt}=this,ft=[0,nt.length-1,0],gt=[],Rt=et*et;for(;ft.length;){const Mt=ft.pop()||0,Lt=ft.pop()||0,Ht=ft.pop()||0;if(Lt-Ht<=lt){for(let hr=Ht;hr<=Lt;hr++)N3(at[2*hr],at[2*hr+1],o,g)<=Rt&&gt.push(nt[hr]);continue}const Kt=Ht+Lt>>1,Qt=at[2*Kt],sr=at[2*Kt+1];N3(Qt,sr,o,g)<=Rt&&gt.push(nt[Kt]),(Mt===0?o-et<=Qt:g-et<=sr)&&(ft.push(Ht),ft.push(Kt-1),ft.push(1-Mt)),(Mt===0?o+et>=Qt:g+et>=sr)&&(ft.push(Kt+1),ft.push(Lt),ft.push(1-Mt))}return gt}}function XC(b,o,g,et,nt,at){if(nt-et<=g)return;const lt=et+nt>>1;M3(b,o,lt,et,nt,at),XC(b,o,g,et,lt-1,1-at),XC(b,o,g,lt+1,nt,1-at)}function M3(b,o,g,et,nt,at){for(;nt>et;){if(nt-et>600){const Rt=nt-et+1,Mt=g-et+1,Lt=Math.log(Rt),Ht=.5*Math.exp(2*Lt/3),Kt=.5*Math.sqrt(Lt*Ht*(Rt-Ht)/Rt)*(Mt-Rt/2<0?-1:1);M3(b,o,g,Math.max(et,Math.floor(g-Mt*Ht/Rt+Kt)),Math.min(nt,Math.floor(g+(Rt-Mt)*Ht/Rt+Kt)),at)}const lt=o[2*g+at];let ft=et,gt=nt;for(hE(b,o,et,g),o[2*nt+at]>lt&&hE(b,o,et,nt);ft<gt;){for(hE(b,o,ft,gt),ft++,gt--;o[2*ft+at]<lt;)ft++;for(;o[2*gt+at]>lt;)gt--}o[2*et+at]===lt?hE(b,o,et,gt):(gt++,hE(b,o,gt,nt)),gt<=g&&(et=gt+1),g<=gt&&(nt=gt-1)}}function hE(b,o,g,et){KC(b,g,et),KC(o,2*g,2*et),KC(o,2*g+1,2*et+1)}function KC(b,o,g){const et=b[o];b[o]=b[g],b[g]=et}function N3(b,o,g,et){const nt=b-g,at=o-et;return nt*nt+at*at}c.$=tm,c.A=zp,c.B=F0,c.C=2,c.D=i_,c.E=x0,c.F=qv,c.G=lT,c.H=km,c.I=Qu,c.J=WE,c.K=Us,c.L=nu,c.M=Ey,c.N=_1,c.O=FE,c.P=zn,c.Q=v1,c.R=Bl,c.S=Py,c.T=nC,c.U=Om,c.V=Ww,c.W=ev,c.X=Fx,c.Y=kx,c.Z=f1,c._=Ct,c.a=function(b){return Do.API_CDN_URL_REGEX.test(b)},c.a$=rr,c.a0=oo,c.a1=yl,c.a2=H0,c.a3=class extends Ww{},c.a4=by,c.a5=kE,c.a6=mn,c.a7=function(b){const o=b.value;return o?oo(o)?BC(o,!0)?[]:[new Ww(b.key,o,`invalid url "${o}"`)]:[new Ww(b.key,o,`string expected, "${Us(o)}" found`)]:[]},c.a8=UE,c.a9=Fu,c.aA=pr,c.aB=Ut,c.aC=ga,c.aD=Ap,c.aE=Zl,c.aF=Tt,c.aG=Tr,c.aH=function(b,o){const g={};for(let et=0;et<o.length;et++){const nt=o[et];nt in b&&(g[nt]=b[nt])}return g},c.aI=ot,c.aJ=kt,c.aK=class{constructor(b){this.entries={},this.scheduler=b}request(b,o,g,et){const nt=this.entries[b]=this.entries[b]||{callbacks:[]};if(nt.result){const[at,lt]=nt.result;return this.scheduler?this.scheduler.add(()=>{et(at,lt)},o):et(at,lt),()=>{}}return nt.callbacks.push(et),nt.cancel||(nt.cancel=g((at,lt)=>{nt.result=[at,lt];for(const ft of nt.callbacks)this.scheduler?this.scheduler.add(()=>{ft(at,lt)},o):ft(at,lt);setTimeout(()=>delete this.entries[b],3e3)})),()=>{nt.result||(nt.callbacks=nt.callbacks.filter(at=>at!==et),nt.callbacks.length||(nt.cancel(),delete this.entries[b]))}}},c.aL=function(b,o,g){const et=JSON.stringify(b.request);return b.data&&(this.deduped.entries[et]={result:[null,b.data]}),this.deduped.request(et,{type:"parseTile",isSymbolTile:b.isSymbolTile,zoom:b.tileZoom},nt=>{const at=p0(b.request,(lt,ft,gt)=>{lt?nt(lt):ft&&nt(null,{rawData:ft,vectorTile:g?void 0:new yn(new Dw(ft)),responseHeaders:new Map(gt.entries())})});return()=>{at.cancel(),nt()}},o)},c.aM=function(b){return b?{cacheControl:b.get("Cache-Control"),expires:b.get("Expires")}:{cacheControl:void 0,expires:void 0}},c.aN=Du,c.aO=function(b){Pp++,Pp>Dp&&(b.getActor().send("enforceCacheSizeLimit",Am),Pp=0)},c.aP=function(b){return b<=1?1:Math.pow(2,Math.floor(Math.log2(b)))},c.aQ=Su,c.aR=OT,c.aS=GT,c.aT=_e,c.aU=NT,c.aV=function(b,o){const g=document.createElement("video");g.muted=!0,g.onloadstart=function(){o(null,g)};for(let et=0;et<b.length;et++){const nt=document.createElement("source");J0(b[et])||(g.crossOrigin="Anonymous"),nt.src=b[et],g.appendChild(nt)}return{cancel:()=>{}}},c.aW=Uv,c.aX=$1,c.aY=hn,c.aZ=Yv,c.a_=Xt,c.aa=ns,c.ab=class{constructor(b){this.specification=b}possiblyEvaluate(b,o){return Ys(b.expression.evaluate(o))}interpolate(b,o,g){return{x:so(b.x,o.x,g),y:so(b.y,o.y,g),z:so(b.z,o.z,g),azimuthal:so(b.azimuthal,o.azimuthal,g),polar:so(b.polar,o.polar,g)}}},c.ac=ou,c.ad=ix,c.ae=Ar,c.af=ys,c.ag=Fr,c.ah=vr,c.ai=ax,c.aj=Qx,c.ak=so,c.al=ss,c.am=d1,c.an=Bo,c.ao=Mo,c.ap=class{constructor(b){this.specification=b}possiblyEvaluate(b,o){return function([g,et]){const nt=Ys([1,g,et]);return{x:nt.x,y:nt.y,z:nt.z}}(b.expression.evaluate(o))}interpolate(b,o,g){return{x:so(b.x,o.x,g),y:so(b.y,o.y,g),z:so(b.z,o.z,g)}}},c.aq=function(b,o,g=0,et=!0){const nt=new zn(g,g),at=b.sub(nt),lt=o.add(nt),ft=[at,new zn(lt.x,at.y),lt,new zn(at.x,lt.y)];return et&&ft.push(at.clone()),ft},c.ar=function(b,o){const g=[];for(let et=0;et<b.length;et++){const nt=kr(et-1,-1,b.length-1),at=kr(et+1,-1,b.length-1),lt=b[et],ft=b[at],gt=b[nt].sub(lt).unit(),Rt=ft.sub(lt).unit(),Mt=Rt.angleWithSep(gt.x,gt.y),Lt=gt.add(Rt).unit().mult(-1*o/Math.sin(Mt/2));g.push(lt.add(Lt))}return g},c.as=ET,c.at=Op,c.au=function(b,o,g=0){return Cr(((o.x-g)*b.scale-b.x)*ss,(o.y*b.scale-b.y)*ss,tr(o.z,o.y))},c.av=tn,c.aw=ws,c.ax=Bs,c.ay=NS,c.az=function(b){let o=1/0,g=1/0,et=-1/0,nt=-1/0;for(const at of b)o=Math.min(o,at.x),g=Math.min(g,at.y),et=Math.max(et,at.x),nt=Math.max(nt,at.y);return{min:new zn(o,g),max:new zn(et,nt)}},c.b=function(b){return Do.API_FONTS_REGEX.test(b)},c.b$=NA,c.b0=_f,c.b1=$x,c.b2=rn,c.b3=ew,c.b4=Uw,c.b5=function(){am.isLoading()||am.isLoaded()||C1()!=="deferred"||VE()},c.b6=ky,c.b7=an,c.b8=G1,c.b9=yu,c.bA=Zt,c.bB=or,c.bC=Vt,c.bD=function(b,o){const{x:g,y:et}=b.point,nt=tA(g,et,b.worldSize/b._pixelsPerMercatorPixel,0,0);return Ut(nt,nt,k2(N0(o)))},c.bE=Et,c.bF=po,c.bG=Fs,c.bH=Sn,c.bI=ks,c.bJ=Vs,c.bK=h_,c.bL=d0,c.bM=EC,c.bN=function(b,o,g,et,nt){const at=5*o+2;b.float32[at+0]=g,b.float32[at+1]=et,b.float32[at+2]=nt},c.bO=x_,c.bP=qs,c.bQ=tu,c.bR=Eo,c.bS=Ao,c.bT=kr,c.bU=function(b,o,g,et){var nt=new ht(4);return nt[0]=b,nt[1]=o,nt[2]=g,nt[3]=et,nt},c.bV=class{isDataAvailableAtPoint(b){const o=this._source();if(this.isUsingMockSource()||!o||b.y<0||b.y>1)return!1;const g=o.getSource().maxzoom,et=1<<g,nt=Math.floor(b.x),at=Math.floor((b.x-nt)*et),lt=Math.floor(b.y*et),ft=this.findDEMTileFor(new Su(g,nt,g,at,lt));return!(!ft||!ft.dem)}getAtPointOrZero(b,o=0){return this.getAtPoint(b,o)||0}getAtPoint(b,o,g=!0){if(this.isUsingMockSource())return null;o==null&&(o=null);const et=this._source();if(!et||b.y<0||b.y>1)return o;const nt=et.getSource().maxzoom,at=1<<nt,lt=Math.floor(b.x),ft=b.x-lt,gt=new Su(nt,lt,nt,Math.floor(ft*at),Math.floor(b.y*at)),Rt=this.findDEMTileFor(gt);if(!Rt||!Rt.dem)return o;const Mt=Rt.dem,Lt=1<<Rt.tileID.canonical.z,Ht=(ft*Lt-Rt.tileID.canonical.x)*Mt.dim,Kt=(b.y*Lt-Rt.tileID.canonical.y)*Mt.dim,Qt=Math.floor(Ht),sr=Math.floor(Kt);return(g?this.exaggeration():1)*so(so(Mt.get(Qt,sr),Mt.get(Qt,sr+1),Kt-sr),so(Mt.get(Qt+1,sr),Mt.get(Qt+1,sr+1),Kt-sr),Ht-Qt)}static getAtTileOffset(b,o,g,et){const nt=1<<b.canonical.z;return et?et.pointElevation(o):g?g.getAtPointOrZero(new Ar(b.wrap+(b.canonical.x+o.x/ss)/nt,(b.canonical.y+o.y/ss)/nt)):0}static getAtTileOffsetFunc(b,o,g,et){return(nt,at,lt)=>{const ft=this.getAtTileOffset(b,nt,at,lt),gt=et.upVector(b.canonical,nt.x,nt.y);return gn(gt,gt,ft*et.upVectorScale(b.canonical,o,g).metersToTile),gt}}getForTilePoints(b,o,g,et){if(this.isUsingMockSource())return!1;const nt=g_.create(this,b,et);return!!nt&&(o.forEach(at=>{at[2]=this.exaggeration()*nt.getElevationAt(at[0],at[1],g)}),!0)}getMinMaxForTile(b){if(this.isUsingMockSource())return null;const o=this.findDEMTileFor(b);if(!o||!o.dem)return null;const g=o.dem.tree,et=o.tileID,nt=1<<b.canonical.z-et.canonical.z;let at=b.canonical.x/nt-et.canonical.x,lt=b.canonical.y/nt-et.canonical.y,ft=0;for(let gt=0;gt<b.canonical.z-et.canonical.z&&!g.leaves[ft];gt++){at*=2,lt*=2;const Rt=2*Math.floor(lt)+Math.floor(at);ft=g.childOffsets[ft]+Rt,at%=1,lt%=1}return{min:this.exaggeration()*g.minimums[ft],max:this.exaggeration()*g.maximums[ft]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(b,o,g){throw new Error("Pure virtual method called.")}pointCoordinate(b){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(b){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const b=this.visibleDemTiles;if(b.length===0)return null;let o=!1,g=Number.MAX_VALUE,et=Number.MIN_VALUE;for(const nt of b){const at=this.getMinMaxForTile(nt.tileID);at&&(g=Math.min(g,at.min),et=Math.max(et,at.max),o=!0)}return o?{min:g,max:et}:null}},c.bW=yw,c.bX=_l,c.bY=up,c.bZ=kA,c.b_=$T,c.ba=hC,c.bb=U2,c.bc=Xr,c.bd=jm,c.be=Vm,c.bf=Zx,c.bg=Eu,c.bh=r_,c.bi=kC,c.bj=function(b,o){const g=Qx(o.zoom);if(g===0)return N0(b);const et=aw(b),nt=P2(et),at=Tt(et.getWest())*o.worldSize,lt=Tt(et.getEast())*o.worldSize,ft=kt(et.getNorth())*o.worldSize,gt=kt(et.getSouth())*o.worldSize,Rt=[at,ft,0],Mt=[lt,ft,0],Lt=[at,gt,0],Ht=[lt,gt,0],Kt=zt([],o.globeMatrix);return ys(Rt,Rt,Kt),ys(Mt,Mt,Kt),ys(Lt,Lt,Kt),ys(Ht,Ht,Kt),nt[0]=mm(nt[0],Lt,g),nt[1]=mm(nt[1],Ht,g),nt[2]=mm(nt[2],Mt,g),nt[3]=mm(nt[3],Rt,g),zs.fromPoints(nt)},c.bk=cw,c.bl=zt,c.bm=Sv,c.bn=mm,c.bo=Gx,c.bp=M1,c.bq=mr,c.br=Nt,c.bs=e2,c.bt=Dw,c.bu=p0,c.bv=function(b,o){const g=[];for(const et in b)et in o||g.push(et);return g},c.bw=Yr,c.bx=["type","source","source-layer","minzoom","maxzoom","filter","layout"],c.by=Vu,c.bz=Bt,c.c=Jl,c.c$=function(b,o,g){let et=0;for(let nt=0;nt<2;++nt)b[nt]>0&&(et+=(b[nt]-0)*(b[nt]-0)),o[nt]<0&&(et+=(0-o[nt])*(0-o[nt]));return et},c.c0=OA,c.c1=yC,c.c2=mT,c.c3=SC,c.c4=qC,c.c5=gn,c.c6=Co,c.c7=Mn,c.c8=function(b,o,g){g*=.5;var et=o[0],nt=o[1],at=o[2],lt=o[3],ft=Math.sin(g),gt=Math.cos(g);return b[0]=et*gt+nt*ft,b[1]=nt*gt-et*ft,b[2]=at*gt+lt*ft,b[3]=lt*gt-at*ft,b},c.c9=Cs,c.cA=Jr,c.cB=Al,c.cC=ES,c.cD=Yl,c.cE=QC,c.cF=function(b,o,g,et,nt,at,lt,ft,gt){if(gt.name==="globe")return QC(b,o,new Yl(g,et,nt),!1);const Rt=Yv({z:g,x:et,y:nt},gt);return new zs([(at+Rt.x/Rt.scale)*o,o*(Rt.y/Rt.scale),lt],[(at+Rt.x2/Rt.scale)*o,o*(Rt.y2/Rt.scale),ft])},c.cG=function(b,o,g){return b[0]=Math.min(o[0],g[0]),b[1]=Math.min(o[1],g[1]),b[2]=Math.min(o[2],g[2]),b[3]=Math.min(o[3],g[3]),b},c.cH=function(b,o,g){return b[0]=Math.max(o[0],g[0]),b[1]=Math.max(o[1],g[1]),b[2]=Math.max(o[2],g[2]),b[3]=Math.max(o[3],g[3]),b},c.cI=function(b){const o=Math.round((b+45+360)%360/90)%4;return T0[o]},c.cJ=nr,c.cK=Ul,c.cL=t_,c.cM=function(b){const o=Zt(new Float64Array(16));Ut(o,b.pixelMatrix,b.globeMatrix);const g=[0,w0,0],et=[0,C0,0];return ys(g,g,o),ys(et,et,o),[g[0]>0&&g[0]<=b.width&&g[1]>0&&g[1]<=b.height&&!B2(b,new _e(b.center.lat,90)),et[0]>0&&et[0]<=b.width&&et[1]>0&&et[1]<=b.height&&!B2(b,new _e(b.center.lat,-90))]},c.cN=function(b,o){const{scale:g}=b.tileTransform,et=g*ss/(b.tileSize*Math.pow(2,o.zoom-b.tileID.overscaledZ+b.tileID.canonical.z));return function(nt,at,lt){var ft=at[1],gt=at[2],Rt=at[3],Mt=lt[0],Lt=lt[1];return nt[0]=at[0]*Mt,nt[1]=ft*Mt,nt[2]=gt*Lt,nt[3]=Rt*Lt,nt}(new Float32Array(4),o.inverseAdjustmentMatrix,[et,et])},c.cO=Cw,c.cP=jr,c.cQ=vS,c.cR=function(b){const o=vS(b,!0);return Et([],[o[0],o[1],o[4],o[5]])},c.cS=Gt,c.cT=_s,c.cU=er,c.cV=function(b){const{x:o,y:g}=b.point,{lng:et,lat:nt}=b._center;return tA(o,g,b.worldSize,et,nt)},c.cW=qr,c.cX=Ru,c.cY=wu,c.cZ=_p,c.c_=b0,c.ca=Lo,c.cb=function(b,o){return b[0]=-o[0],b[1]=-o[1],b[2]=-o[2],b[3]=o[3],b},c.cc=un,c.cd=function(b,o,g,et,nt){var at=1/Math.tan(o/2);if(b[0]=at/g,b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[5]=at,b[6]=0,b[7]=0,b[8]=0,b[9]=0,b[11]=-1,b[12]=0,b[13]=0,b[15]=0,nt!=null&&nt!==1/0){var lt=1/(et-nt);b[10]=(nt+et)*lt,b[14]=2*nt*et*lt}else b[10]=-1,b[14]=-2*et;return b},c.ce=function(b,o,g,et,nt,at,lt){var ft=1/(o-g),gt=1/(et-nt),Rt=1/(at-lt);return b[0]=-2*ft,b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[5]=-2*gt,b[6]=0,b[7]=0,b[8]=0,b[9]=0,b[10]=2*Rt,b[11]=0,b[12]=(o+g)*ft,b[13]=(nt+et)*gt,b[14]=(lt+at)*Rt,b[15]=1,b},c.cf=$t,c.cg=function(b,o,g){b[4*o+0]=g[0],b[4*o+1]=g[1],b[4*o+2]=g[2],b[4*o+3]=g[3]},c.ch=Yy,c.ci=I1,c.cj=ep,c.ck=X0,c.cl=P1,c.cm=ST,c.cn=function(){var b=new ht(4);return ht!=Float32Array&&(b[1]=0,b[2]=0),b[0]=1,b[3]=1,b},c.co=function(b,o,g){var et=o[0],nt=o[1],at=o[2],lt=o[3],ft=Math.sin(g),gt=Math.cos(g);return b[0]=et*gt+at*ft,b[1]=nt*gt+lt*ft,b[2]=et*-ft+at*gt,b[3]=nt*-ft+lt*gt,b},c.cp=function(b,o){return b[0]===o[0]&&b[1]===o[1]&&b[2]===o[2]&&b[3]===o[3]},c.cq=no,c.cr=function(b){var o=b[0],g=b[1],et=b[2],nt=b[3];return Math.sqrt(o*o+g*g+et*et+nt*nt)},c.cs=fs,c.ct=Es,c.cu=Xu,c.cv=3,c.cw=2,c.cx=7,c.cy=6,c.cz=lo,c.d=function(b){return Do.API_TILEJSON_REGEX.test(b)},c.d$=class{constructor(b,o,g,et){this.context=b,this.format=et,this.size=g,this.texture=b.gl.createTexture();const[nt,at,lt]=this.size,{gl:ft}=b;ft.bindTexture(ft.TEXTURE_3D,this.texture),b.pixelStoreUnpackFlipY.set(!1),b.pixelStoreUnpack.set(1),b.pixelStoreUnpackPremultiplyAlpha.set(!1),"data"in o&&o.data&&ft.texImage3D(ft.TEXTURE_3D,0,this.format,nt,at,lt,0,tC(this.format),rC(this.format),o.data)}bind(b,o){const{context:g}=this,{gl:et}=g;et.bindTexture(et.TEXTURE_3D,this.texture),b!==this.minFilter&&(et.texParameteri(et.TEXTURE_3D,et.TEXTURE_MAG_FILTER,b),et.texParameteri(et.TEXTURE_3D,et.TEXTURE_MIN_FILTER,b),this.minFilter=b),o!==this.wrapS&&(et.texParameteri(et.TEXTURE_3D,et.TEXTURE_WRAP_S,o),et.texParameteri(et.TEXTURE_3D,et.TEXTURE_WRAP_T,o),this.wrapS=o)}destroy(){const{gl:b}=this.context;b.deleteTexture(this.texture),this.texture=null}},c.d0=function(b){return b*b*b*b*b},c.d1=xt,c.d2=45,c.d3=Qy,c.d4=function(b,o,g){const et=Math.sqrt(b*b+o*o+g*g),nt=et>0?Math.acos(g/et)*Wu:0;let at=b!==0||o!==0?Math.atan2(-o,-b)*Wu+90:0;return at<0&&(at+=360),[et,at,nt]},c.d5=Cr,c.d6=Ys,c.d7=xr,c.d8=dr,c.d9=zs,c.dA=function(b){return b({pluginStatus:Mp,pluginURL:om}),Iy.on("pluginStateChange",b),b},c.dB=D1,c.dC=class extends cm{constructor(b){super(b),this.current=Jy}set(b,o,g){if(this.fetchUniformLocation(b,o)){for(let et=0;et<9;et++)if(g[et]!==this.current[et]){this.current=g,this.gl.uniformMatrix3fv(this.location,!1,g);break}}}},c.dD=fp,c.dE=function(b,o,g){const et=Qx(g.zoom),nt=b.style.map._antialias,at=b.terrain&&b.terrain.exaggeration()>0;return et===0&&!nt&&!at},c.dF=function(b){const o=b.pixelsPerMeter,g=o/$t(1,b.center.lat),et=Zt(new Float64Array(16));return Nt(et,et,[b.point.x,b.point.y,0]),Gt(et,et,[g,g,o]),Float32Array.from(et)},c.dG=aw,c.dH=function(b){const o=nr-5;b=pr(b,-o,o)/o*90;const g=Math.pow(Math.abs(Math.sin(Bo(b))),3);return Math.round(g*(Av.length-1))},c.dI=function(b,o,g,et){const nt=o.getNorth(),at=o.getSouth(),lt=o.getWest(),ft=o.getEast(),gt=1<<b.z,Rt=ft-lt,Mt=nt-at,Lt=Rt/Xx,Ht=-Mt/Av[g],Kt=[0,Lt,0,Ht,0,0,nt,lt,0];if(b.z>0){const Qt=180/et;Pt(Kt,Kt,[Qt/Rt+1,0,0,0,Qt/Mt+1,0,-.5*Qt/Lt,.5*Qt/Ht,1])}return Kt[2]=gt,Kt[5]=b.x,Kt[8]=b.y,Kt},c.dJ=N0,c.dK=function(b,o,g){const et=Zt(new Float64Array(16)),nt=(o/(1<<b)-.5)*Math.PI*2;return ir(et,g.globeMatrix,nt),Float32Array.from(et)},c.dL=pA,c.dM=K0,c.dN=function(b,o){return[Math.pow(b[0],2.2)*o,Math.pow(b[1],2.2)*o,Math.pow(b[2],2.2)*o]},c.dO=St,c.dP=function(b,o){var g=Math.sin(o),et=Math.cos(o);return b[0]=et,b[1]=g,b[2]=0,b[3]=-g,b[4]=et,b[5]=0,b[6]=0,b[7]=0,b[8]=1,b},c.dQ=dn,c.dR=eA,c.dS=na,c.dT=du,c.dU=256,c.dV=function(b,o){const g=[0,0,0];return ys(g,g,cw(N0(o.canonical))),ys(g,g,b),g},c.dW=b=>({u_matrix:new P1(b),u_texsize:new X0(b),u_pixels_to_tile_units:new e_(b),u_device_pixel_ratio:new ep(b),u_width_scale:new ep(b),u_floor_width_scale:new ep(b),u_image:new Yy(b),u_units_to_pixels:new X0(b),u_tile_units_to_pixels:new ep(b),u_alpha_discard_threshold:new ep(b),u_trim_offset:new X0(b),u_trim_fade_range:new X0(b),u_trim_color:new Qy(b),u_zbias_factor:new ep(b),u_tile_to_meter:new ep(b),u_ground_shadow_factor:new I1(b),u_pattern_transition:new ep(b)}),c.dX=b=>({u_matrix:new P1(b),u_pixels_to_tile_units:new e_(b),u_device_pixel_ratio:new ep(b),u_width_scale:new ep(b),u_floor_width_scale:new ep(b),u_units_to_pixels:new X0(b),u_dash_image:new Yy(b),u_gradient_image:new Yy(b),u_image_height:new ep(b),u_texsize:new X0(b),u_tile_units_to_pixels:new ep(b),u_alpha_discard_threshold:new ep(b),u_trim_offset:new X0(b),u_trim_fade_range:new X0(b),u_trim_color:new Qy(b),u_zbias_factor:new ep(b),u_tile_to_meter:new ep(b),u_ground_shadow_factor:new I1(b)}),c.dY=b=>({u_camera_to_center_distance:new ep(b),u_extrude_scale:new e_(b),u_device_pixel_ratio:new ep(b),u_matrix:new P1(b),u_inv_rot_matrix:new P1(b),u_merc_center:new X0(b),u_tile_id:new I1(b),u_zoom_transition:new ep(b),u_up_dir:new I1(b),u_emissive_strength:new ep(b)}),c.dZ=Uy,c.d_=G8,c.da=gr,c.db=function(b){return[Math.pow(b[0],1/2.2),Math.pow(b[1],1/2.2),Math.pow(b[2],1/2.2)]},c.dc=_S,c.dd=cC,c.de=CS,c.df=BC,c.dg=function(b,o){return b.readFields(UI,{icons:[]},o)},c.dh=_w,c.di=f_,c.dj=wC,c.dk=wx,c.dl=w1,c.dm=yp,c.dn=Sx,c.dp=Rn,c.dq=function(b){const o=b.indexOf(dx);return o>=0?b.slice(0,o):b},c.dr=function(b){return b.indexOf(dx)>=0},c.ds=function(b){const o=b.lastIndexOf(dx);return o>=0?b.slice(o+1):""},c.dt=function(b){const o=[],g=b.id;return g===void 0&&o.push({message:`layers.${g}: missing required property "id"`}),b.render===void 0&&o.push({message:`layers.${g}: missing required method "render"`}),b.renderingMode&&b.renderingMode!=="2d"&&b.renderingMode!=="3d"&&o.push({message:`layers.${g}: property "renderingMode" must be either "2d" or "3d"`}),o},c.du=function(b,o,g,et){return b.type==="custom"?new MI(b,o):new zI[b.type](b,o,g,et)},c.dv=Vn,c.dw=function(b){const o=b.indexOf(dx);return o>=0?b.slice(o+1):""},c.dx=class extends G1{constructor(b,o){super(b._vectorTileFeature,b._z,b._x,b._y,b.id),b.state&&(this.state=Object.assign({},b.state)),this.target=o.target,this.namespace=o.namespace,o.properties&&(this.properties=o.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=b.source,this.sourceLayer=b.sourceLayer,this.layer=b.layer)}toJSON(){const b=super.toJSON();return b.target=this.target,b.namespace=this.namespace,b}},c.dy=Iy,c.dz=R0,c.e=Do,c.e$=Sr,c.e0=iA,c.e1=(b,o,g,et,nt,at)=>{const lt=b.transform,ft=lt.projection.name==="globe";let gt;if(at.paint.get("circle-pitch-alignment")==="map")if(ft){const Mt=eA(lt.zoom,o.canonical)*lt._pixelsPerMercatorPixel;gt=Float32Array.from([Mt,0,0,Mt])}else gt=lt.calculatePixelsToTileUnitsMatrix(g);else gt=new Float32Array([lt.pixelsToGLUnits[0],0,0,lt.pixelsToGLUnits[1]]);const Rt={u_camera_to_center_distance:b.transform.getCameraToCenterDistance(lt.projection),u_matrix:b.translatePosMatrix(o.projMatrix,g,at.paint.get("circle-translate"),at.paint.get("circle-translate-anchor")),u_device_pixel_ratio:uo.devicePixelRatio,u_extrude_scale:gt,u_inv_rot_matrix:sR,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:at.paint.get("circle-emissive-strength")};if(ft){Rt.u_inv_rot_matrix=et,Rt.u_merc_center=nt,Rt.u_tile_id=[o.canonical.x,o.canonical.y,1<<o.canonical.z],Rt.u_zoom_transition=Qx(lt.zoom);const Mt=nt[0]*ss,Lt=nt[1]*ss;Rt.u_up_dir=lt.projection.upVector(new Yl(0,0,0),Mt,Lt)}return Rt},c.e2=zS,c.e3=wp,c.e4=(b,o,g,et,nt,at,lt,ft,gt,Rt)=>{const Mt=b.transform,Lt=Mt.pitch<15?OS(.07,.7,pr((14-Mt.zoom)/5,0,1)):.07,Ht=g.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:jS(b,o,g,et),u_texsize:o.imageAtlasTexture?o.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:Mt.calculatePixelsToTileUnitsMatrix(o),u_device_pixel_ratio:nt,u_width_scale:at,u_floor_width_scale:lt,u_image:0,u_tile_units_to_pixels:LS(o,Mt),u_units_to_pixels:[1/Mt.pixelsToGLUnits[0],1/Mt.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:ft,u_trim_fade_range:g.paint.get("line-trim-fade-range"),u_trim_color:g.paint.get("line-trim-color").toPremultipliedRenderColor(Ht?null:g.lut).toArray01(),u_zbias_factor:Lt,u_tile_to_meter:xr(o.tileID.canonical,0),u_ground_shadow_factor:gt,u_pattern_transition:Rt}},c.e5=(b,o,g,et,nt,at,lt,ft,gt,Rt)=>{const Mt=b.transform,Lt=Mt.calculatePixelsToTileUnitsMatrix(o),Ht=g.paint.get("line-trim-color-use-theme").constantOr("default")==="none",Kt=Mt.pitch<15?OS(.07,.7,pr((14-Mt.zoom)/5,0,1)):.07;return{u_matrix:jS(b,o,g,et),u_pixels_to_tile_units:Lt,u_device_pixel_ratio:at,u_width_scale:lt,u_floor_width_scale:ft,u_units_to_pixels:[1/Mt.pixelsToGLUnits[0],1/Mt.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:nt,u_texsize:VS(g)&&o.lineAtlasTexture?o.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:LS(o,b.transform),u_alpha_discard_threshold:0,u_trim_offset:gt,u_trim_fade_range:g.paint.get("line-trim-fade-range"),u_trim_color:g.paint.get("line-trim-color").toPremultipliedRenderColor(Ht?null:g.lut).toArray01(),u_zbias_factor:Kt,u_tile_to_meter:xr(o.tileID.canonical,0),u_ground_shadow_factor:Rt}},c.e6=En,c.e7=Tv,c.e8=tr,c.e9=S0,c.eA=function(b,o){var g=2*Math.acos(o[3]),et=Math.sin(g/2);return et>dt?(b[0]=o[0]/et,b[1]=o[1]/et,b[2]=o[2]/et):(b[0]=1,b[1]=0,b[2]=0),g},c.eB=OC,c.eC=Tw,c.eD=Sw,c.eE=[1,1,1],c.eF=g_,c.eG=Ss,c.eH=function(b,o,g,et){var nt=o[0],at=o[1],lt=o[2],ft=o[3];return b[0]=nt+et*(g[0]-nt),b[1]=at+et*(g[1]-at),b[2]=lt+et*(g[2]-lt),b[3]=ft+et*(g[3]-ft),b},c.eI=l_,c.eJ=l0,c.eK=q0,c.eL=function(b,o,g,et,nt,at,lt,ft,gt,Rt,Mt,Lt,Ht,Kt,Qt,sr){var hr=new ht(16);return hr[0]=b,hr[1]=o,hr[2]=g,hr[3]=et,hr[4]=nt,hr[5]=at,hr[6]=lt,hr[7]=ft,hr[8]=gt,hr[9]=Rt,hr[10]=Mt,hr[11]=Lt,hr[12]=Ht,hr[13]=Kt,hr[14]=Qt,hr[15]=sr,hr},c.eM=st,c.eN=Wx,c.eO=mv,c.eP=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new zn(1/0,1/0),max:new zn(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(b,o=!1){const g=BA(new zn(0,0),new zn(ss,ss),b),et=[];if(o&&!G2(g,this._globalClipBounds))return et;for(const nt of this._activeRegions){if(nt.hiddenByOverlap||!G2(g,nt))continue;const at=BR(nt.min,nt.max,b);et.push({min:at.min,max:at.max,sourceId:this._sourceIds[nt.priority],footprint:nt.footprint,footprintTileId:nt.tileId,order:nt.order,clipMask:nt.clipMask,clipScope:nt.clipScope})}return et}setSources(b){this._setSources(b.map(o=>({getSourceId:()=>o.cache.id,getFootprints:()=>{const g=[];for(const et of o.cache.getVisibleCoordinates()){const nt=o.cache.getTile(et).buckets[o.layer];nt&&nt.updateFootprints(et.toUnwrapped(),g)}return g},getOrder:()=>o.order,getClipMask:()=>o.clipMask,getClipScope:()=>o.clipScope})))}_addSource(b){const o=b.getFootprints();if(o.length===0)return;const g=b.getOrder(),et=b.getClipMask(),nt=b.getClipScope();for(const at of o){if(!at.footprint)continue;const lt=BA(at.footprint.min,at.footprint.max,at.id);this._activeRegions.push({min:lt.min,max:lt.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:at.id,footprint:at.footprint,order:g,clipMask:et,clipScope:nt})}this._sourceIds.push(b.getSourceId())}_computeReplacement(){this._activeRegions.sort((o,g)=>o.priority-g.priority||pw(o.min,g.min)||pw(o.max,g.max)||o.order-g.order||o.clipMask-g.clipMask||function(et,nt){const at=(lt,ft)=>lt+ft;return et.length-nt.length||et.reduce(at,"").localeCompare(nt.reduce(at,""))}(o.clipScope,g.clipScope));let b=this._activeRegions.length!==this._prevRegions.length;if(!b){let o=0;for(;!b&&o!==this._activeRegions.length;){const g=this._activeRegions[o],et=this._prevRegions[o];b=g.priority!==et.priority||!FA(g,et)||g.order!==et.order||g.clipMask!==et.clipMask||!Vu(g.clipScope,et.clipScope),this._activeRegions[o].hiddenByOverlap=et.hiddenByOverlap,++o}}if(b){++this._updateTime;for(const g of this._activeRegions)g.order!==Fv&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,g.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,g.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,g.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,g.max.y));const o=g=>{const et=this._activeRegions;if(g>=et.length)return g;const nt=et[g].priority;for(;g<et.length&&et[g].priority===nt;)++g;return g};if(this._sourceIds.length>1){let g=0,et=o(g);for(;g!==et;){let nt=g;const at=g;for(;nt!==et;){const lt=this._activeRegions[nt];lt.hiddenByOverlap=!1;for(let ft=0;ft<at;ft++){const gt=this._activeRegions[ft];if(!gt.hiddenByOverlap&&lt.order===Fv&&G2(lt,gt)&&(lt.hiddenByOverlap=MA(lt.footprint,lt.tileId,gt.footprint,gt.tileId),lt.hiddenByOverlap))break}++nt}g=et,et=o(g)}}}}_setSources(b){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let o=b.length-1;o>=0;o--)this._addSource(b[o]);this._computeReplacement()}},c.eQ=Fv,c.eR=class{constructor(b){this._createGrid(b),this._createPoles(b)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const b of this._poleSegments)b.destroy();for(const b of this._gridSegments)b.withSkirts.destroy(),b.withoutSkirts.destroy()}_fillGridMeshWithLods(b,o){const g=new jm,et=new _f,nt=[],at=b+1+2,lt=o[0]+1,ft=o[0]+1+(1+o.length),gt=(Rt,Mt,Lt)=>{let Ht=Rt===at-1?Rt-2:Rt===0?Rt:Rt-1;return Ht+=Lt?24575:0,[Ht,Mt]};for(let Rt=0;Rt<at;++Rt)g.emplaceBack(...gt(Rt,0,!0));for(let Rt=0;Rt<lt;++Rt)for(let Mt=0;Mt<at;++Mt)g.emplaceBack(...gt(Mt,Rt,(Mt===0||Mt===at-1)&&!0));for(let Rt=0;Rt<o.length;++Rt){const Mt=o[Rt];for(let Lt=0;Lt<at;++Lt)g.emplaceBack(...gt(Lt,Mt,!0))}for(let Rt=0;Rt<o.length;++Rt){const Mt=et.length,Lt=o[Rt]+1+2,Ht=new _f;for(let sr=0;sr<Lt-1;sr++){const hr=sr===Lt-2,ur=hr?at*(ft-o.length+Rt-sr):at;for(let _r=0;_r<at-1;_r++){const br=sr*at+_r;sr===0||hr||_r===0||_r===at-2?(Ht.emplaceBack(br+1,br,br+ur),Ht.emplaceBack(br+ur,br+ur+1,br+1)):(et.emplaceBack(br+1,br,br+ur),et.emplaceBack(br+ur,br+ur+1,br+1))}}const Kt=Eu.simpleSegment(0,Mt,g.length,et.length-Mt);for(let sr=0;sr<Ht.uint16.length;sr+=3)et.emplaceBack(Ht.uint16[sr],Ht.uint16[sr+1],Ht.uint16[sr+2]);const Qt=Eu.simpleSegment(0,Mt,g.length,et.length-Mt);nt.push({withoutSkirts:Kt,withSkirts:Qt})}return{vertices:g,indices:et,segments:nt}}_createGrid(b){const o=this._fillGridMeshWithLods(Xx,Av);this._gridSegments=o.segments,this._gridBuffer=b.createVertexBuffer(o.vertices,Zx.members),this._gridIndexBuffer=b.createIndexBuffer(o.indices,!0)}_createPoles(b){const o=new _f;for(let lt=0;lt<=Xx;lt++)o.emplaceBack(0,lt+1,lt+2);this._poleIndexBuffer=b.createIndexBuffer(o,!0);const g=new fx,et=new fx,nt=new fx,at=new fx;this._poleSegments=[];for(let lt=0,ft=0;lt<b0;lt++){const gt=360/(1<<lt);g.emplaceBack(0,-Ap,0,.5,0),et.emplaceBack(0,-Ap,0,.5,1),nt.emplaceBack(0,-Ap,0,.5,.5),at.emplaceBack(0,-Ap,0,.5,.5);for(let Rt=0;Rt<=Xx;Rt++){let Mt=Rt/Xx,Lt=0;const Ht=so(0,gt,Mt),[Kt,Qt,sr]=mx(nR,iR,Ht,Ap);g.emplaceBack(Kt,Qt,sr,Mt,Lt),et.emplaceBack(Kt,Qt,sr,Mt,1-Lt);const hr=Bo(Ht);Mt=.5+.5*Math.sin(hr),Lt=.5+.5*Math.cos(hr),nt.emplaceBack(Kt,Qt,sr,Mt,Lt),at.emplaceBack(Kt,Qt,sr,Mt,1-Lt)}this._poleSegments.push(Eu.simpleSegment(ft,0,66,64)),ft+=66}this._poleNorthVertexBuffer=b.createVertexBuffer(g,M0,!1),this._poleSouthVertexBuffer=b.createVertexBuffer(et,M0,!1),this._texturedPoleNorthVertexBuffer=b.createVertexBuffer(nt,M0,!1),this._texturedPoleSouthVertexBuffer=b.createVertexBuffer(at,M0,!1)}getGridBuffers(b,o){return[this._gridBuffer,this._gridIndexBuffer,o?this._gridSegments[b].withSkirts:this._gridSegments[b].withoutSkirts]}getPoleBuffers(b,o){return[o?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,o?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[b]]}},c.eS=PA,c.eT=xo,c.eU=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},c.eV=xn,c.eW=yr,c.eX=function(b,o,g){return b[0]=o[0]/g[0],b[1]=o[1]/g[1],b[2]=o[2]/g[2],b},c.eY=us,c.eZ=Kx,c.e_=ms,c.ea=gw,c.eb=YA,c.ec=gx,c.ed=VA,c.ee=zA,c.ef=lr,c.eg=function(b,o){if(b===o){var g=o[1],et=o[2],nt=o[3],at=o[6],lt=o[7],ft=o[11];b[1]=o[4],b[2]=o[8],b[3]=o[12],b[4]=g,b[6]=o[9],b[7]=o[13],b[8]=et,b[9]=at,b[11]=o[14],b[12]=nt,b[13]=lt,b[14]=ft}else b[0]=o[0],b[1]=o[4],b[2]=o[8],b[3]=o[12],b[4]=o[1],b[5]=o[5],b[6]=o[9],b[7]=o[13],b[8]=o[2],b[9]=o[6],b[10]=o[10],b[11]=o[14],b[12]=o[3],b[13]=o[7],b[14]=o[11],b[15]=o[15];return b},c.eh=BI,c.ei=Go,c.ej=gv,c.ek=256,c.el=k2,c.em=a0,c.en=ir,c.eo=function(b,o){return b[0]=o[0],b[1]=o[1],b[2]=o[2],b[3]=o[4],b[4]=o[5],b[5]=o[6],b[6]=o[8],b[7]=o[9],b[8]=o[10],b},c.ep=fx,c.eq=IE,c.er=pv,c.es=function(b,o,g,et,nt){return pr((b-o)/(g-o)*(nt-et)+et,et,nt)},c.et=Ds,c.eu=function(b,o){var g=o[0],et=o[1],nt=o[2],at=o[3],lt=o[4],ft=o[5],gt=o[6],Rt=o[7],Mt=o[8],Lt=Mt*lt-ft*Rt,Ht=-Mt*at+ft*gt,Kt=Rt*at-lt*gt,Qt=g*Lt+et*Ht+nt*Kt;return Qt?(b[0]=Lt*(Qt=1/Qt),b[1]=(-Mt*et+nt*Rt)*Qt,b[2]=(ft*et-nt*lt)*Qt,b[3]=Ht*Qt,b[4]=(Mt*g-nt*gt)*Qt,b[5]=(-ft*g+nt*at)*Qt,b[6]=Kt*Qt,b[7]=(-Rt*g+et*gt)*Qt,b[8]=(lt*g-et*at)*Qt,b):null},c.ev=2,c.ew=On,c.ex=ds,c.ey=on,c.ez=function(b,o){var g=new ht(3);on(g,o);var et=1/g[0],nt=1/g[1],at=1/g[2],lt=o[0]*et,ft=o[1]*nt,gt=o[2]*at,Rt=o[4]*et,Mt=o[5]*nt,Lt=o[6]*at,Ht=o[8]*et,Kt=o[9]*nt,Qt=o[10]*at,sr=lt+Mt+Qt,hr=0;return sr>0?(hr=2*Math.sqrt(sr+1),b[3]=.25*hr,b[0]=(Lt-Kt)/hr,b[1]=(Ht-gt)/hr,b[2]=(ft-Rt)/hr):lt>Mt&&lt>Qt?(hr=2*Math.sqrt(1+lt-Mt-Qt),b[3]=(Lt-Kt)/hr,b[0]=.25*hr,b[1]=(ft+Rt)/hr,b[2]=(Ht+gt)/hr):Mt>Qt?(hr=2*Math.sqrt(1+Mt-lt-Qt),b[3]=(Ht-gt)/hr,b[0]=(ft+Rt)/hr,b[1]=.25*hr,b[2]=(Lt+Kt)/hr):(hr=2*Math.sqrt(1+Qt-lt-Mt),b[3]=(ft-Rt)/hr,b[0]=(Ht+gt)/hr,b[1]=(Lt+Kt)/hr,b[2]=.25*hr),b},c.f=function(b){return btoa(encodeURIComponent(b).replace(/%([0-9A-F]{2})/g,(o,g)=>String.fromCharCode(+("0x"+g))))},c.f0=function([b,o,g]){const et=Math.hypot(b,o,g),nt=Math.atan2(b,g),at=.5*Math.PI-Math.acos(-o/et);return new _e(Ru(nt),Ru(at))},c.f1=Tl,c.f2=iC,c.f3=function(b){const o=b.navigator?b.navigator.userAgent:null;return!!function(g){if(Yo==null){const et=g.navigator?g.navigator.userAgent:null;Yo=!!g.safari||!(!et||!(/\b(iPad|iPhone|iPod)\b/.test(et)||et.match("Safari")&&!et.match("Chrome")))}return Yo}(b)&&!(!o||!(o.match("Version/15.4")||o.match("Version/15.5")||o.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},c.f4=function(b,o){Am=b,Dp=o},c.f5=B2,c.f6=rA,c.f7=function(b){const o=[0,0,0],g=Zt(new Float64Array(16));return Ut(g,b.pixelMatrix,b.globeMatrix),ys(o,o,g),new zn(o[0],o[1])},c.f8=function(){const b=jv;b&&(b.isPreloaded()&&b.numActive()===1?(b.release(K2),jv=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},c.f9=function(){_w().acquire(K2)},c.fA=Jw,c.fB=sn,c.fC=function(b){let o=0;if(new Uint32Array(b,0,1)[0]!==pS){const g=new Uint32Array(b,0,7),[,,et,nt,at,lt]=g;o=g.byteLength+nt+at+lt+at,(et!==b.byteLength||o>=b.byteLength)&&bs("Invalid b3dm header information.")}return yS(b,o)},c.fD=function(b,o){const g=cC(b);for(const et of g){for(const nt of et.meshes)d8(nt);et.lights&&(et.lightMeshIndex=et.meshes.length,et.meshes.push(h8(et.lights,o)))}return g},c.fE=qw,c.fF=jo,c.fG=cS,c.fH=am,c.fI=Yp,c.fJ=function(b){jp(),_u!=null&&_u.then(o=>{o.keys().then(g=>{for(let et=0;et<g.length-b;et++)o.delete(g[et]).catch(nt=>bs(nt.message))}).catch(g=>bs(g.message))}).catch(o=>bs(o.message))},c.fa=C1,c.fb=function(b,o,g=!1){if(Mp===Yp.deferred||Mp===Yp.loading||Mp===Yp.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");om=uo.resolveURL(b),Mp=Yp.deferred,iv=o,Ry(),g||VE()},c.fc=function(b){s_=uo.resolveURL(b),o_||(o_=new i_(_w(),new x0)),o_.broadcast("setMeshoptUrl",s_)},c.fd=hS,c.fe=function(b){Q2=uo.resolveURL(b),o_||(o_=new i_(_w(),new x0)),o_.broadcast("setDracoUrl",Q2)},c.ff=dS,c.fg=Lv,c.fh=function(b){const o=r0();if(!o)return;const g=o.delete(bx);b&&g.then(()=>b()).catch(b)},c.fi=L1,c.fj=Ps,c.fk=Jx,c.fl=ym,c.fm=P3,c.fn=k3,c.fo=FS,c.fp=Dn,c.fq="hd_road_elevation",c.fr=Dl,c.fs=vn,c.ft=xx,c.fu=bC,c.fv=V1,c.fw=function(b,o,g,et,nt,at,lt,ft=1,gt,Rt,Mt){b.createArrays(),b.tilePixelRatio=ss/(512*b.overscaling),b.compareText={},b.iconsNeedLinear=!1;const Lt=b.layers[0].layout,Ht=b.layers[0]._unevaluatedLayout._values,Kt={};Kt.scaleFactor=ft,Kt.textSizeScaleRange=Lt.get("text-size-scale-range"),Kt.iconSizeScaleRange=Lt.get("icon-size-scale-range");const[Qt,sr]=Kt.textSizeScaleRange,[hr,ur]=Kt.iconSizeScaleRange;Kt.textScaleFactor=pr(Kt.scaleFactor,Qt,sr),Kt.iconScaleFactor=pr(Kt.scaleFactor,hr,ur);const _r=Ht["text-size"],br=Ht["icon-size"];if(b.textSizeData.kind==="composite"){const{minZoom:en,maxZoom:Tn}=b.textSizeData;Kt.compositeTextSizes=[_r.possiblyEvaluate(new ou(en,{worldview:Mt}),at),_r.possiblyEvaluate(new ou(Tn,{worldview:Mt}),at)]}if(b.iconSizeData.kind==="composite"){const{minZoom:en,maxZoom:Tn}=b.iconSizeData;Kt.compositeIconSizes=[br.possiblyEvaluate(new ou(en,{worldview:Mt}),at),br.possiblyEvaluate(new ou(Tn,{worldview:Mt}),at)]}Kt.layoutTextSize=_r.possiblyEvaluate(new ou(lt+1,{worldview:Mt}),at),Kt.layoutIconSize=br.possiblyEvaluate(new ou(lt+1,{worldview:Mt}),at),Kt.textMaxSize=_r.possiblyEvaluate(new ou(18,{worldview:Mt}),at);const Ir=Lt.get("symbol-placement"),Vr=Lt.get("text-rotation-alignment")==="map"&&Ir!=="point",Mr=Lt.get("text-size");let Hr=!1;const Zr=[];for(const en of b.features){const Tn=Lt.get("text-font").evaluate(en,{},at).join(","),ln=Mr.evaluate(en,{},at)*Kt.textScaleFactor,Fn=Kt.layoutTextSize.evaluate(en,{},at)*Kt.textScaleFactor,Ln=Kt.layoutIconSize.evaluate(en,{},at)*Kt.iconScaleFactor,jn={horizontal:{},vertical:void 0},Zn=en.text;let Qn,Hn=[0,0];if(Zn){const wo=Zn.toString(),$l=Lt.get("text-letter-spacing").evaluate(en,{},at)*up,Nr=Lt.get("text-line-height").evaluate(en,{},at)*up,Ur=rv(wo)?$l:0,Bn=Lt.get("text-anchor").evaluate(en,{},at),Yn=Lt.get("text-variable-anchor");if(!Yn){const vo=Lt.get("text-radial-offset").evaluate(en,{},at);if(vo)Hn=mT(Bn,[vo*up,AC]);else{const Ro=Lt.get("text-offset").evaluate(en,{},at);Hn=[Ro[0]*up,Ro[1]*up]}}let xs=Vr?"center":Lt.get("text-justify").evaluate(en,{},at);const gs=Ir==="point",Ws=gs?Lt.get("text-max-width").evaluate(en,{},at)*up:1/0,Zs=vo=>{b.allowVerticalPlacement&&b1(wo)&&(jn.vertical=gC(Zn,o,g,nt,Tn,Ws,Nr,Bn,vo,Ur,Hn,d0.vertical,!0,Fn,ln,gt))};if(!Vr&&Yn){const vo=xs==="auto"?Yn.map(ko=>SC(ko)):[xs];let Ro=!1;for(let ko=0;ko<vo.length;ko++){const $o=vo[ko];if(!jn.horizontal[$o])if(Ro)jn.horizontal[$o]=jn.horizontal[0];else{const io=gC(Zn,o,g,nt,Tn,Ws,Nr,"center",$o,Ur,Hn,d0.horizontal,!1,Fn,ln,gt);io&&(jn.horizontal[$o]=io,Ro=io.positionedLines.length===1)}}Zs("left")}else{if(xs==="auto"&&(xs=SC(Bn)),gs||Lt.get("text-writing-mode").indexOf("horizontal")>=0||!b1(wo)){const vo=gC(Zn,o,g,nt,Tn,Ws,Nr,Bn,xs,Ur,Hn,d0.horizontal,!1,Fn,ln,gt);vo&&(jn.horizontal[xs]=vo)}Zs(gs?"left":xs)}}let Wn,kn,In,Kn,as,es,$s=!1;const vs=Lt.get("icon-text-fit").evaluate(en,{},at);if(en.icon&&en.icon.hasPrimary()){const wo=Kv(en.icon,b.iconSizeData,Ht["icon-size"],at,b.zoom,en,gt,Kt.iconScaleFactor,Mt);Wn=wo.iconPrimary,In=wo.iconSecondary;const $l=Wn.toString();if(kn=et.get($l),kn&&(as=Lt.get("icon-offset").evaluate(en,{},at),es=Lt.get("icon-anchor").evaluate(en,{},at),Qn=kw(nt.get($l),In?nt.get(In.toString()):void 0,as,es),$s=kn.sdf,b.sdfIcons===void 0?b.sdfIcons=kn.sdf:b.sdfIcons!==kn.sdf&&bs("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(kn.pixelRatio!==b.pixelRatio||Lt.get("icon-rotate").constantOr(1)!==0)&&(b.iconsNeedLinear=!0)),In){const Nr=In.toString();Kn=et.get(Nr)}}Hr=Hr||!(!en.icon||!en.icon.hasSecondary());const Is=Ow(jn.horizontal)||jn.vertical;b.iconsInText||(b.iconsInText=!!Is&&Is.iconsInText);const Ns=Fn*Kt.textScaleFactor/up,{defaultShapedIcon:Fo,verticallyShapedIcon:ts}=vI(b,Qn,Lt,en,at,jn,Ns,as,vs);vs!=="none"&&Qn&&(eT(Qn)||tT(Qn))&&(Nw(0,kn,Wn,Qn,Fo,vs,Rt,et,nt),Nw(0,Kn,In,Qn,Fo,vs,Rt,et,nt),ts&&(Nw(0,kn,Wn,Qn,ts,vs,Rt,et,nt),Nw(0,Kn,In,Qn,ts,vs,Rt,et,nt))),Qn=Fo;const{iconBBox:Os,iconVerticalBBox:fo,textBBox:Ko,textVerticalBBox:xa}=mI(b,Qn,ts,Lt,en,at,Ln,as,Kt,nt,es,jn,Fn,Hn);Zr.push({feature:en,shapedTextOrientations:jn,shapedText:Is,shapedIcon:Qn,iconPrimary:Wn,iconSecondary:In,iconOffset:as,iconAnchor:es,verticallyShapedIcon:ts,layoutTextSize:Fn,layoutIconSize:Ln,textOffset:Hn,isSDFIcon:$s,iconTextFit:vs,iconCollisionBounds:Os,iconVerticalCollisionBounds:fo,textCollisionBounds:Ko,textVerticalCollisionBounds:xa})}return{featureData:Zr,sizes:Kt,hasAnySecondaryIcon:Hr,textAlongLine:Vr,symbolPlacement:Ir}},c.fx=cT,c.fy=function(b,o,g,et,nt,at,lt,ft,gt,Rt){b.iconAtlasPositions=Rt.iconPositions;const{featureData:Mt,hasAnySecondaryIcon:Lt,sizes:Ht,textAlongLine:Kt,symbolPlacement:Qt}=o;for(const sr of Mt){const{shapedIcon:hr,verticallyShapedIcon:ur,feature:_r,shapedTextOrientations:br,shapedText:Ir,layoutTextSize:Vr,textOffset:Mr,isSDFIcon:Hr,iconPrimary:Zr,iconSecondary:en,iconTextFit:Tn,iconOffset:ln,iconCollisionBounds:Fn,iconVerticalCollisionBounds:Ln,textCollisionBounds:jn}=sr;gT(hr,Rt.iconPositions,Zr,en),gT(ur,Rt.iconPositions,Zr,en),_I(br,Rt.iconPositions),yI(Zr,en,Rt.iconPositions),(Ir||hr)&&EI(b,_r,br,hr,ur,gt,Ht,Vr,0,Mr,Hr,et,nt,lt,ft,Lt,Tn,ln,Kt,Qt,Fn,Ln,jn)}g&&b.generateCollisionDebugBuffers(at,b.collisionBoxArray,Ht.textScaleFactor)},c.fz=yn,c.g=function(b,o){return R0(Object.assign(b,{method:"GET"}),o)},c.h=function(b){return b.indexOf("mapbox:")===0},c.i=function(b){return Do.API_STYLE_REGEX.test(b)&&!Jl(b)},c.j=Iu,c.k=Kp,c.l=function(b){return decodeURIComponent(atob(b).split("").map(o=>"%"+("00"+o.charCodeAt(0).toString(16)).slice(-2)).join(""))},c.m=function(b,o){return R0(Object.assign(b,{type:"json"}),o)},c.n=z0,c.o=uo,c.p=function(b,o){return R0(Object.assign(b,{method:"POST"}),o)},c.q=Rp,c.r=nn,c.s=function(b){try{const o=self[b];return o.setItem("_mapbox_test_",1),o.removeItem("_mapbox_test_"),!0}catch{return!1}},c.t=function(){return Z2||(Z2=new L1("ImageRasterizer")),Z2},c.u=function(){return function b(o){return o?(o^Math.random()*(16>>o/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,b)}()},c.v=function(b){return!!b&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(b)},c.w=bs,c.x=GC,c.y=Zm,c.z=m0}),$(["./shared"],function(c){function dt(xn){const pr=xn?xn.url.toString():void 0;return pr?performance.getEntriesByName(pr):[]}function ht(xn){if(typeof xn=="number"||typeof xn=="boolean"||typeof xn=="string"||xn==null)return JSON.stringify(xn);if(Array.isArray(xn)){let vr="[";for(const kr of xn)vr+=`${ht(kr)},`;return`${vr}]`}let pr="{";for(const vr of Object.keys(xn).sort())pr+=`${vr}:${ht(xn[vr])},`;return`${pr}}`}function Et(xn){let pr="";for(const vr of c.bx)pr+=`/${ht(xn[vr])}`;return pr}class St{constructor(pr){this.keyCache={},this._layers={},this._layerConfigs={},pr&&this.replace(pr)}replace(pr,vr){this._layerConfigs={},this._layers={},this.update(pr,[],vr)}update(pr,vr,kr){this._options=kr;for(const Kr of pr)this._layerConfigs[Kr.id]=Kr,(this._layers[Kr.id]=c.du(Kr,this.scope,null,this._options)).compileFilter(kr),this.keyCache[Kr.id]&&delete this.keyCache[Kr.id];for(const Kr of vr)delete this.keyCache[Kr],delete this._layerConfigs[Kr],delete this._layers[Kr];this.familiesBySource={};const Yr=function(Kr,rn){const En={};for(let vn=0;vn<Kr.length;vn++){const Vn=Kr[vn];let Rn=rn&&rn[Vn.id];Rn||(Vn.type==="symbol"?Rn=Vn.id:(Rn=Et(Vn),Vn.type==="line"&&Vn.paint&&function Xs(bs){return typeof bs=="string"&&bs==="line-progress"||(Array.isArray(bs)?bs.some(Xs):!(!bs||typeof bs!="object")&&Object.values(bs).some(Xs))}(Vn.paint["line-width"])&&(Rn+=`/${ht(Vn.paint["line-width"])}`))),rn&&(rn[Vn.id]=Rn);let Ts=En[Rn];Ts||(Ts=En[Rn]=[]),Ts.push(Vn)}const hn=[];for(const vn in En)hn.push(En[vn]);return hn}(Object.values(this._layerConfigs),this.keyCache);for(const Kr of Yr){const rn=Kr.map(Ts=>this._layers[Ts.id]),En=rn[0];if(En.visibility==="none")continue;const hn=En.source||"";let vn=this.familiesBySource[hn];vn||(vn=this.familiesBySource[hn]={});const Vn=En.sourceLayer||"_geojsonTileLayer";let Rn=vn[Vn];Rn||(Rn=vn[Vn]=[]),Rn.push(rn)}}}const At=1*c.fl;class Pt{constructor(pr){const vr={},kr=[];for(const En in pr){const hn=pr[En],vn=vr[En]={};for(const Vn in hn.glyphs){const Rn=hn.glyphs[+Vn];if(!Rn||Rn.bitmap.width===0||Rn.bitmap.height===0)continue;const Ts=Rn.metrics.localGlyph?At:1,Xs={x:0,y:0,w:Rn.bitmap.width+2*Ts,h:Rn.bitmap.height+2*Ts};kr.push(Xs),vn[Vn]=Xs}}const{w:Yr,h:Kr}=c.G(kr),rn=new c.fk({width:Yr||1,height:Kr||1});for(const En in pr){const hn=pr[En];for(const vn in hn.glyphs){const Vn=hn.glyphs[+vn];if(!Vn||Vn.bitmap.width===0||Vn.bitmap.height===0)continue;const Rn=vr[En][vn],Ts=Vn.metrics.localGlyph?At:1;c.fk.copy(Vn.bitmap,rn,{x:0,y:0},{x:Rn.x+Ts,y:Rn.y+Ts},Vn.bitmap)}}this.image=rn,this.positions=vr}}function Vt(xn,pr,vr){xn[pr]?vr&&(xn[pr].center=vr):xn[pr]={floorIds:new Set,center:vr||[0,0],floors:{}}}function Bt(xn,pr,vr,kr){for(const Yr of pr)Vt(xn,Yr),xn[Yr].floors[vr]=kr,xn[Yr].floorIds.add(vr)}function Zt(xn){return{id:xn.properties.id.toString(),center:xn.properties.center.toString().split(";").map(Number)}}function zt(xn){return{id:xn.properties.id.toString(),isDefault:!!xn.properties.is_default&&xn.properties.is_default,connections:xn.properties.connected_floor_ids?new Set(xn.properties.connected_floor_ids.toString().split(";")):new Set,conflicts:xn.properties.conflicted_floor_ids?new Set(xn.properties.conflicted_floor_ids.toString().split(";")):new Set,buildings:xn.properties.building_ids?new Set(xn.properties.building_ids.toString().split(";")):new Set,name:xn.properties.name.toString(),zIndex:xn.properties.z_index}}function Ut(xn,pr){return pr.every(vr=>xn.properties&&xn.properties[vr]!=null)}function Nt(xn){return Ut(xn,["type","id","name"])&&xn.properties.type==="building"}function Gt(xn){return Ut(xn,["type","id","name","z_index"])&&xn.properties.type==="floor"}c.fj(Pt,"GlyphAtlas");class er{constructor(pr){this.tileID=new c.aQ(pr.tileID.overscaledZ,pr.tileID.wrap,pr.tileID.canonical.z,pr.tileID.canonical.x,pr.tileID.canonical.y),this.tileZoom=pr.tileZoom,this.uid=pr.uid,this.zoom=pr.zoom,this.lut=pr.lut,this.canonical=pr.tileID.canonical,this.pixelRatio=pr.pixelRatio,this.tileSize=pr.tileSize,this.source=pr.source,this.scope=pr.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=pr.showCollisionBoxes,this.collectResourceTiming=!!pr.request&&pr.request.collectResourceTiming,this.promoteId=pr.promoteId,this.isSymbolTile=pr.isSymbolTile,this.tileTransform=c.aZ(pr.tileID.canonical,pr.projection),this.projection=pr.projection,this.worldview=pr.worldview,this.localizableLayerIds=pr.localizableLayerIds,this.brightness=pr.brightness,this.extraShadowCaster=!!pr.extraShadowCaster,this.tessellationStep=pr.tessellationStep,this.scaleFactor=pr.scaleFactor,this.worldview=pr.worldview,this.indoor=pr.indoor}parse(pr,vr,kr,Yr,Kr,rn){this.status="parsing",this.data=pr,this.collisionBoxArray=new c.b3;const En=new c.fm(Object.keys(pr.layers).sort()),hn=new c.fn(this.tileID,this.promoteId);hn.bucketLayerIDs=[];const vn={},Vn=new c.fo(256,256),Rn={featureIndex:hn,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:Vn,availableImages:kr,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0,activeFloors:void 0};if(this.indoor){const Gn=this.indoor.indoorState.activeFloorsVisible,bo=function(Ys,jo,yu){const Yo=function(uu,na){if(!uu)return c.w("No source layers defined in indoor specification"),na;if(uu.size===0)return na;const du=uu.difference(na);for(const Vo of du)c.w(`Missing source layer required in indoor specification: ${Vo}`);return na.intersection(na)}(jo.sourceLayers,new Set(Object.keys(Ys.layers))),Lo=jo.indoorState,zo=function(uu,na,du,Vo){const Do=new Set,Iu=new Set,Jl=new Set,qu=new Map,Ip={},Xp=Il=>{const Mu=qu.get(Il)||new Set;for(const Un of Do)if((qu.get(Un)||new Set).has(Il)||Mu.has(Un))return!0;return!1};for(const Il of na){const Mu=uu.layers[Il];if(Mu)for(let Un=0;Un<Mu.length;Un++){const nn=Mu.feature(Un);if(Nt(nn)){const{id:uo,center:Zu}=Zt(nn);Vt(Ip,uo,Zu),Do.add(uo)}else if(Gt(nn)){const{id:uo,isDefault:Zu,connections:yp,conflicts:bx,buildings:Am,name:Dp,zIndex:Uo}=zt(nn);Bt(Ip,Am,uo,{name:Dp,zIndex:Uo}),qu.set(uo,bx),(uo===Vo||yp.has(Vo))&&Do.add(uo),Iu.add(uo),Zu&&Jl.add(uo)}}else c.w(`indoor source layer not found: ${Il}`)}if(du)for(const Il of du)Iu.has(Il)&&(Xp(Il)||Do.add(Il));for(const Il of Jl)Do.has(Il)||Xp(Il)||Do.add(Il);return{buildings:Ip,activeFloors:Do}}(Ys,Yo,Lo.lastActiveFloors,Lo.selectedFloorId);return yu.send("setIndoorData",zo),zo}(pr,this.indoor,Kr);Rn.activeFloors=Gn?bo.activeFloors:void 0}const Ts=[],Xs=vr.familiesBySource[this.source];for(const Gn in Xs){const bo=pr.layers[Gn];if(!bo)continue;let Ys=!1,jo=!1,yu=!1;for(const na of Xs[Gn])na[0].type==="symbol"?Ys=!0:jo=!0,na[0].is3D()&&na[0].type!=="model"&&(yu=!0);if(this.extraShadowCaster&&!yu||this.isSymbolTile===!0&&!Ys||this.isSymbolTile===!1&&!jo)continue;bo.version===1&&c.w(`Vector tile source "${this.source}" layer "${Gn}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Yo=En.encode(Gn),Lo=[],zo=this.localizableLayerIds&&this.localizableLayerIds.has(Gn);let uu=!1;for(let na=0,du=0;na<bo.length;na++){const Vo=bo.feature(na),Do=hn.getId(Vo,Gn),Iu=Vo.properties?Vo.properties.worldview:null;if(zo&&this.worldview&&typeof Iu=="string")if(Iu==="all")Vo.properties.$localized=!0;else{if(!Iu.split(",").includes(this.worldview))continue;Vo.properties.$localized=!0,Vo.properties.worldview=this.worldview}!uu&&Vo.properties&&Vo.properties.hasOwnProperty(c.fp)&&(uu=!0),Lo.push({feature:Vo,id:Do,index:du,sourceLayerIndex:Yo}),du++}uu&&!Rn.elevationFeatures&&pr.layers.hasOwnProperty(c.fq)&&(Rn.elevationFeatures=c.fr.parseFrom(pr.layers[c.fq],this.canonical));for(const na of Xs[Gn]){const du=na[0];if(this.extraShadowCaster&&(!du.is3D()||du.type==="model")||this.isSymbolTile!==void 0&&du.type==="symbol"!==this.isSymbolTile||du.minzoom&&this.zoom<Math.floor(du.minzoom)||du.maxzoom&&this.zoom>=du.maxzoom||du.visibility==="none")continue;ir(na,this.zoom,Rn.brightness,kr,this.worldview);const Vo=vn[du.id]=du.createBucket({index:hn.bucketLayerIDs.length,layers:na,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Yo,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:Yr,worldview:this.worldview,localizable:zo});hn.bucketLayerIDs.push(na.map(Iu=>c.B(Iu.id,Iu.scope)));let Do=Vo.prepare?Vo.prepare():null;Do!=null?(Do=Do.then(()=>Vo.populate(Lo,Rn,this.tileID.canonical,this.tileTransform)),Ts.push(Do)):Vo.populate(Lo,Rn,this.tileID.canonical,this.tileTransform)}}const bs=()=>{let Gn,bo,Ys,jo,yu,Yo;Vn.trim();const Lo={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},zo=()=>{if(Gn)return this.status="done",rn(Gn);if(this.extraShadowCaster)this.status="done",rn(null,{buckets:Object.values(vn).filter(na=>!na.isEmpty()),featureIndex:hn,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:Rn.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(bo&&Ys&&jo){const na=new Pt(bo),du=new Map;for(const[Iu,Jl]of Ys.entries()){const{imagePosition:qu}=c.fu(Iu,Jl,c.fv);du.set(Iu,qu)}const Vo={};for(const Iu in vn){const Jl=vn[Iu];Jl instanceof c.b4&&(ir(Jl.layers,this.zoom,Rn.brightness,kr,this.worldview),Vo[Iu]=c.fw(Jl,bo,na.positions,Ys,du,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,yu,this.worldview))}const Do={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(Kr,Ys,yu,()=>{Do.iconsPending=!1,uu(Vo,na,Do)}),this.rasterizeIfNeeded(Kr,jo,Yo,()=>{Do.patternsPending=!1,uu(Vo,na,Do)})}},uu=(na,du,Vo,Do)=>{if(Vo.iconsPending||Vo.patternsPending)return;const Iu=new c.fx(Ys,jo,this.lut);for(const Jl in vn){const qu=vn[Jl];if(Jl in na)c.fy(qu,na[Jl],this.showCollisionBoxes,kr,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,Ys,Iu);else if(qu.hasPattern&&(qu instanceof c.ba||qu instanceof c.bb||qu instanceof c.ea)){ir(qu.layers,this.zoom,Rn.brightness,kr,this.worldview);const Ip=Object.fromEntries(Iu.patternPositions);qu.addFeatures(Rn,this.tileID.canonical,Ip,kr,this.tileTransform,this.brightness)}}this.status="done",rn(null,{buckets:Object.values(vn).filter(Jl=>!Jl.isEmpty()),featureIndex:hn,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:du.image,lineAtlas:Vn,imageAtlas:Iu,brightness:Rn.brightness})};if(!this.extraShadowCaster){const na=c.fs(Rn.glyphDependencies,Do=>Object.keys(Do).map(Number));Object.keys(na).length?Kr.send("getGlyphs",{uid:this.uid,stacks:na},(Do,Iu)=>{Gn||(Gn=Do,bo=Iu,zo())},void 0,!1,Lo):bo={};const du=Array.from(Rn.iconDependencies.keys()).map(Do=>c.I.parse(Do));du.length?Kr.send("getImages",{images:du,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(Do,Iu)=>{Gn||(Gn=Do,Ys=new Map,yu=this.updateImageMapAndGetImageTaskQueue(Ys,Iu,Rn.iconDependencies),zo())},void 0,!1,Lo):(Ys=new Map,yu=new Map);const Vo=Array.from(Rn.patternDependencies.keys()).map(Do=>c.I.parse(Do));Vo.length?Kr.send("getImages",{images:Vo,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(Do,Iu)=>{Gn||(Gn=Do,jo=new Map,Yo=this.updateImageMapAndGetImageTaskQueue(jo,Iu,Rn.patternDependencies),zo())},void 0,!1,Lo):(jo=new Map,Yo=new Map)}if(Rn.elevationFeatures&&Rn.elevationFeatures.length>0){const na=[];for(const Vo of Object.values(vn))if(Vo instanceof c.bb){const Do=Vo.getUnevaluatedPortalGraph();Do&&na.push(Do)}const du=c.ft.evaluate(na);for(const Vo of Object.values(vn))if(Vo instanceof c.bb){const Do=pr.layers[En.decode(Vo.sourceLayerIndex)];Vo.setEvaluatedPortalGraph(du,Do,this.tileID.canonical,Rn.availableImages,Rn.brightness)}}zo()};Ts.length>0?Promise.allSettled(Ts).then(bs).catch(rn):bs()}updateParameters(pr){this.scaleFactor=pr.scaleFactor,this.showCollisionBoxes=pr.showCollisionBoxes,this.projection=pr.projection,this.brightness=pr.brightness,this.tileTransform=c.aZ(pr.tileID.canonical,pr.projection),this.extraShadowCaster=pr.extraShadowCaster,this.lut=pr.lut,this.worldview=pr.worldview,this.indoor=pr.indoor}rasterizeIfNeeded(pr,vr,kr,Yr){Array.from(vr.values()).some(Kr=>Kr.usvg)?this.rasterize(pr,vr,kr,Yr):Yr()}updateImageMapAndGetImageTaskQueue(pr,vr,kr){const Yr=new Map;for(const Kr of vr.keys()){const rn=kr.get(Kr)||[];for(const En of rn){const hn=En.toString(),vn=vr.get(En.id.toString());vn.usvg?Yr.has(hn)||(Yr.set(hn,En),pr.set(hn,Object.assign({},vn))):pr.set(hn,vn)}}return Yr}rasterize(pr,vr,kr,Yr){this.rasterizeTask=pr.send("rasterizeImages",{scope:this.scope,tasks:kr},(Kr,rn)=>{if(!Kr)for(const[En,hn]of rn.entries()){const vn=Object.assign(vr.get(En),{data:hn});vr.set(En,vn)}Yr()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function ir(xn,pr,vr,kr,Yr){const Kr=new c.ac(pr,{brightness:vr,worldview:Yr});for(const rn of xn)rn.recalculate(Kr,kr)}class or extends c.E{constructor(pr,vr,kr,Yr,Kr,rn,En){super(),this.actor=pr,this.layerIndex=vr,this.availableImages=kr,this.availableModels=Yr,this.loadVectorData=rn||c.aL,this.loading={},this.loaded={},this.deduped=new c.aK(pr.scheduler),this.isSpriteLoaded=Kr,this.scheduler=pr.scheduler,this.brightness=En}loadTile(pr,vr){const kr=pr.uid,Yr=pr&&pr.request,Kr=Yr&&Yr.collectResourceTiming,rn=this.loading[kr]=new er(pr);rn.abort=this.loadVectorData(pr,(En,hn)=>{const vn=!this.loading[kr];if(delete this.loading[kr],rn.cancelRasterize(),vn||En||!hn)return rn.status="done",vn||(this.loaded[kr]=rn),vr(En);const Vn=hn.rawData,Rn={},Ts=c.aM(hn.responseHeaders);Ts&&Ts.expires&&(Rn.expires=Ts.expires),Ts&&Ts.cacheControl&&(Rn.cacheControl=Ts.cacheControl),rn.vectorTile=hn.vectorTile||new c.fz(new c.bt(Vn));const Xs=()=>{rn.parse(rn.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,(bs,Gn)=>{if(bs||!Gn)return vr(bs);const bo={};if(Kr){const Ys=dt(Yr);Ys.length>0&&(bo.resourceTiming=JSON.parse(JSON.stringify(Ys)))}vr(null,Object.assign({rawTileData:Vn.slice(0),responseHeaders:hn.responseHeaders},Gn,Rn,bo))})};this.isSpriteLoaded?Xs():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Xs,{type:"parseTile",isSymbolTile:pr.isSymbolTile,zoom:pr.tileZoom}):Xs()}),this.loaded=this.loaded||{},this.loaded[kr]=rn})}reloadTile(pr,vr){const kr=this.loaded,Yr=pr.uid;if(kr&&kr[Yr]){const Kr=kr[Yr];Kr.updateParameters(pr);const rn=(En,hn)=>{const vn=Kr.reloadCallback;vn&&(delete Kr.reloadCallback,Kr.parse(Kr.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,vn)),vr(En,hn)};Kr.status==="parsing"?Kr.reloadCallback=rn:Kr.status==="done"&&(Kr.vectorTile?Kr.parse(Kr.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,rn):rn())}else vr(null,void 0)}abortTile(pr,vr){const kr=pr.uid,Yr=this.loading[kr];Yr&&(Yr.abort&&Yr.abort(),delete this.loading[kr]),vr()}removeTile(pr,vr){const kr=this.loaded,Yr=pr.uid;kr&&kr[Yr]&&delete kr[Yr],vr()}}class mr{loadTile(pr,vr){const{uid:kr,encoding:Yr,rawImageData:Kr,padding:rn}=pr,En=ImageBitmap&&Kr instanceof ImageBitmap?this.getImageData(Kr,rn):Kr;vr(null,new c.fA(kr,En,Yr,rn<1))}reloadTile(pr,vr){vr(null,null)}abortTile(pr,vr){vr()}removeTile(pr,vr){vr()}getImageData(pr,vr){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(pr.width,pr.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=pr.width,this.offscreenCanvas.height=pr.height,this.offscreenCanvasContext.drawImage(pr,0,0,pr.width,pr.height);const kr=this.offscreenCanvasContext.getImageData(-vr,-vr,pr.width+2*vr,pr.height+2*vr);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),kr}}c.bs.setPbf(c.bt);class Rr{constructor(pr){this._mrt=new c.bs(pr.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=pr.uid,this.tileID=pr.tileID,this.source=pr.source}parse(pr,vr){const kr=this._mrt;this.status="parsing",this._entireBuffer=pr;try{kr.parseHeader(pr),this._isHeaderLoaded=!0;const Yr=[];for(const Kr in kr.layers){const rn=kr.getLayer(Kr),En=rn.getDataRange(rn.getBandList()),hn=kr.createDecodingTask(En),vn=pr.slice(En.firstByte,En.lastByte+1),Vn=c.bs.performDecoding(vn,hn).then(Rn=>hn.complete(null,Rn)).catch(Rn=>hn.complete(Rn,null));Yr.push(Vn)}Promise.allSettled(Yr).then(()=>vr(null,kr)).catch(Kr=>vr(Kr))}catch(Yr){vr(Yr)}}}class on{constructor(pr){this.actor=pr,this.loading={},this.loaded={}}loadTile(pr,vr){const kr=pr.uid,Yr=pr.request,Kr=this.loading[kr]=new Rr(pr),{cancel:rn}=c.bu(Yr,(En,hn,vn)=>{const Vn=!this.loading[kr];if(delete this.loading[kr],Vn||En||!hn)return Kr.status="done",Vn||(this.loaded[kr]=Kr),vr(En);Kr.parse(hn,(Rn,Ts)=>{if(Rn||!Ts)return vr(Rn);vr(null,Ts,vn)}),this.loaded[kr]=Kr});Kr.abort=rn}reloadTile(pr,vr){vr(null,void 0)}abortTile(pr,vr){const kr=pr.uid,Yr=this.loading[kr];Yr&&(Yr.abort&&Yr.abort(),delete this.loading[kr]),vr()}removeTile(pr,vr){const kr=pr.uid;this.loaded[kr]&&delete this.loaded[kr],vr()}decodeRasterArray(pr,vr){c.bs.performDecoding(pr.buffer,pr.task).then(kr=>vr(null,kr)).catch(kr=>vr(kr))}}const un=c.fB.prototype.toGeoJSON;class jr{constructor(pr){this._feature=pr,this.extent=c.al,this.type=pr.type,this.properties=pr.tags,"id"in pr&&!isNaN(pr.id)&&(this.id=parseInt(pr.id,10))}loadGeometry(){if(this._feature.type===1){const pr=[];for(const vr of this._feature.geometry)pr.push([new c.P(vr[0],vr[1])]);return pr}{const pr=[];for(const vr of this._feature.geometry){const kr=[];for(const Yr of vr)kr.push(new c.P(Yr[0],Yr[1]));pr.push(kr)}return pr}}toGeoJSON(pr,vr,kr){return un.call(this,pr,vr,kr)}}class Jr{constructor(pr,vr){this.name=pr,this.extent=c.al,this.length=vr.length,this._jsonFeatures=vr}feature(pr){return new jr(this._jsonFeatures[pr])}}class fn{constructor(pr){this.layers={},this.extent=c.al;for(const vr of Object.keys(pr))this.layers[vr]=new Jr(vr,pr[vr])}}const Fr=64/4096,Cr=128;class Sr{constructor(){this.features=new Map}clear(){this.features.clear()}load(pr=[],vr){for(const kr of pr){const Yr=kr.id;if(Yr==null)continue;let Kr=this.features.get(Yr);Kr&&this.updateCache(Kr,vr),kr.geometry?(Kr=gr(kr),this.updateCache(Kr,vr),this.features.set(Yr,Kr)):this.features.delete(Yr),this.updateCache(Kr,vr)}}updateCache(pr,vr){for(const{canonical:kr,uid:Yr}of Object.values(vr)){const{z:Kr,x:rn,y:En}=kr;dr(pr,Math.pow(2,Kr),rn,En)&&delete vr[Yr]}}getTile(pr,vr,kr){const Yr=Math.pow(2,pr),Kr=[];for(const rn of this.features.values())dr(rn,Yr,vr,kr)&&Kr.push(gn(rn,Yr,vr,kr));return{features:Kr}}getFeatures(){return[...this.features.values()]}}function dr({minX:xn,minY:pr,maxX:vr,maxY:kr},Yr,Kr,rn){return xn<(Kr+1+Fr)/Yr&&pr<(rn+1+Fr)/Yr&&vr>(Kr-Fr)/Yr&&kr>(rn-Fr)/Yr}function gr(xn){const{id:pr,geometry:vr,properties:kr}=xn;if(!vr)return;if(vr.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Yr,coordinates:Kr}=vr,rn={id:pr,type:1,geometry:[],tags:kr,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},En=rn.geometry;if(Yr==="Point")qr(Kr,En,rn);else if(Yr==="MultiPoint")for(const hn of Kr)qr(hn,En,rn);else if(Yr==="LineString")rn.type=2,Lr(Kr,En,rn);else if(Yr==="MultiLineString")rn.type=2,_n(Kr,En,rn);else if(Yr==="Polygon")rn.type=3,_n(Kr,En,rn,!0);else{if(Yr!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");rn.type=3;for(const hn of Kr)_n(hn,En,rn,!0)}return rn}function qr([xn,pr],vr,kr){const Yr=c.aF(xn);let Kr=c.aJ(pr);Kr=Kr<0?0:Kr>1?1:Kr,vr.push(Yr,Kr),kr.minX=Math.min(kr.minX,Yr),kr.minY=Math.min(kr.minY,Kr),kr.maxX=Math.max(kr.maxX,Yr),kr.maxY=Math.max(kr.maxY,Kr)}function Lr(xn,pr,vr,kr=!1,Yr=!1){const Kr=[];for(const rn of xn)qr(rn,Kr,vr);pr.push(Kr),kr&&function(rn,En){let hn=0;for(let vn=0,Vn=rn.length,Rn=Vn-2;vn<Vn;Rn=vn,vn+=2)hn+=(rn[vn]-rn[Rn])*(rn[vn+1]+rn[Rn+1]);if(hn>0===En)for(let vn=0,Vn=rn.length;vn<Vn/2;vn+=2){const Rn=rn[vn],Ts=rn[vn+1];rn[vn]=rn[Vn-2-vn],rn[vn+1]=rn[Vn-1-vn],rn[Vn-2-vn]=Rn,rn[Vn-1-vn]=Ts}}(Kr,Yr)}function _n(xn,pr,vr,kr=!1){for(let Yr=0;Yr<xn.length;Yr++)Lr(xn[Yr],pr,vr,kr,Yr===0)}function gn(xn,pr,vr,kr){const{id:Yr,type:Kr,geometry:rn,tags:En}=xn,hn=[];if(Kr===1)(function(vn,Vn,Rn,Ts,Xs){for(let bs=0;bs<vn.length;bs+=2){const Gn=Math.round(c.al*(vn[bs+0]*Vn-Rn)),bo=Math.round(c.al*(vn[bs+1]*Vn-Ts));Xs.push([Gn,bo])}})(rn,pr,vr,kr,hn);else if(Kr===2)for(const vn of rn)Sn(vn,pr,vr,kr,hn);else if(Kr===3)for(const vn of rn)Fs(vn,pr,vr,kr,hn);return{id:Yr,type:Kr,geometry:hn,tags:En}}function Sn(xn,pr,vr,kr,Yr){const Kr=-Cr,rn=c.al+Cr;let En;for(let hn=0;hn<xn.length-2;hn+=2){let vn=Math.round(c.al*(xn[hn+0]*pr-vr)),Vn=Math.round(c.al*(xn[hn+1]*pr-kr)),Rn=Math.round(c.al*(xn[hn+2]*pr-vr)),Ts=Math.round(c.al*(xn[hn+3]*pr-kr));const Xs=Rn-vn,bs=Ts-Vn;vn<Kr&&Rn<Kr||(vn<Kr?(Vn+=Math.round(bs*((Kr-vn)/Xs)),vn=Kr):Rn<Kr&&(Ts=Vn+Math.round(bs*((Kr-vn)/Xs)),Rn=Kr),Vn<Kr&&Ts<Kr||(Vn<Kr?(vn+=Math.round(Xs*((Kr-Vn)/bs)),Vn=Kr):Ts<Kr&&(Rn=vn+Math.round(Xs*((Kr-Vn)/bs)),Ts=Kr),vn>=rn&&Rn>=rn||(vn>=rn?(Vn+=Math.round(bs*((rn-vn)/Xs)),vn=rn):Rn>=rn&&(Ts=Vn+Math.round(bs*((rn-vn)/Xs)),Rn=rn),Vn>=rn&&Ts>=rn||(Vn>=rn?(vn+=Math.round(Xs*((rn-Vn)/bs)),Vn=rn):Ts>=rn&&(Rn=vn+Math.round(Xs*((rn-Vn)/bs)),Ts=rn),En&&vn===En[En.length-1][0]&&Vn===En[En.length-1][1]||(En=[[vn,Vn]],Yr.push(En)),En.push([Rn,Ts])))))}}function Fs(xn,pr,vr,kr,Yr){const Kr=(vr-Fr)/pr,rn=(kr-Fr)/pr,En=(vr+1+Fr)/pr,hn=(kr+1+Fr)/pr;function vn(Ts,Xs){let bs=0;return Ts<Kr?bs|=1:Ts>En&&(bs|=2),Xs<rn?bs|=4:Xs>hn&&(bs|=8),bs}let Vn=[];for(let Ts=1;Ts<=8;Ts*=2){let Xs=xn[xn.length-2],bs=xn[xn.length-1],Gn=!(vn(Xs,bs)&Ts);for(let bo=0;bo<xn.length;bo+=2){const Ys=xn[bo],jo=xn[bo+1],yu=!(vn(Ys,jo)&Ts);yu!==Gn&&(8&Ts?Vn.push(Xs+(Ys-Xs)*(hn-bs)/(jo-bs),hn):4&Ts?Vn.push(Xs+(Ys-Xs)*(rn-bs)/(jo-bs),rn):2&Ts?Vn.push(En,bs+(jo-bs)*(En-Xs)/(Ys-Xs)):1&Ts&&Vn.push(Kr,bs+(jo-bs)*(Kr-Xs)/(Ys-Xs))),yu&&Vn.push(Ys,jo),Xs=Ys,bs=jo,Gn=yu}if(!(xn=Vn).length||Ts===8)break;Vn=[]}const Rn=[];for(let Ts=0;Ts<Vn.length;Ts+=2)Rn.push([Math.round(c.al*(Vn[Ts]*pr-vr)),Math.round(c.al*(Vn[Ts+1]*pr-kr))]);Yr.push(Rn)}function rs({name:xn,features:pr},vr){vr.writeStringField(1,xn),vr.writeVarintField(5,c.al);const kr=new Map,Yr=new Map,Kr={keys:kr,values:Yr,feature:null};for(const rn of pr)Kr.feature=rn,vr.writeMessage(2,ms,Kr);for(const rn of kr.keys())vr.writeStringField(3,rn);for(const rn of Yr.keys())vr.writeMessage(4,lo,rn)}function ms(xn,pr){const vr=xn.feature;vr.id!==void 0&&Number.isSafeInteger(+vr.id)&&pr.writeVarintField(1,+vr.id),vr.tags&&pr.writeMessage(2,On,xn),pr.writeVarintField(3,vr.type),pr.writeMessage(4,ks,vr)}function On({keys:xn,values:pr,feature:vr},kr){for(const Yr of Object.keys(vr.tags)){let Kr=vr.tags[Yr];if(Kr===null)continue;let rn=xn.get(Yr);rn===void 0&&(rn=xn.size,xn.set(Yr,rn)),kr.writeVarint(rn);const En=typeof Kr;En!=="string"&&En!=="boolean"&&En!=="number"&&(Kr=JSON.stringify(Kr));let hn=pr.get(Kr);hn===void 0&&(hn=pr.size,pr.set(Kr,hn)),kr.writeVarint(hn)}}function ws(xn,pr){return(pr<<3)+(7&xn)}function Vs(xn){return xn<<1^xn>>31}function ks(xn,pr){const{geometry:vr,type:kr}=xn;let Yr=0,Kr=0;if(kr===1){pr.writeVarint(ws(1,vr.length));for(const rn of vr){const En=rn[0]-Yr,hn=rn[1]-Kr;pr.writeVarint(Vs(En)),pr.writeVarint(Vs(hn)),Yr+=En,Kr+=hn}}else for(const rn of vr){pr.writeVarint(ws(1,1));const En=rn.length-(kr===3?1:0);for(let hn=0;hn<En;hn++){hn===1&&pr.writeVarint(ws(2,En-1));const vn=rn[hn][0]-Yr,Vn=rn[hn][1]-Kr;pr.writeVarint(Vs(vn)),pr.writeVarint(Vs(Vn)),Yr+=vn,Kr+=Vn}kr===3&&pr.writeVarint(ws(7,1))}}function lo(xn,pr){const vr=typeof xn;vr==="string"?pr.writeStringField(1,xn):vr==="boolean"?pr.writeBooleanField(7,xn):vr==="number"&&(xn%1!=0?pr.writeDoubleField(3,xn):xn<0?pr.writeSVarintField(6,xn):pr.writeVarintField(5,xn))}const ys={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:xn=>xn},dn=Math.fround||(Es=new Float32Array(1),xn=>(Es[0]=+xn,Es[0]));var Es;const po=3,no=5,tn=6;class us{constructor(pr){this.options=Object.assign(Object.create(ys),pr),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(pr){const{log:vr,minZoom:kr,maxZoom:Yr}=this.options;vr&&console.time("total time");const Kr=`prepare ${pr.length} points`;vr&&console.time(Kr),this.points=pr;const rn=[];for(let hn=0;hn<pr.length;hn++){const vn=pr[hn];if(!vn.geometry)continue;const[Vn,Rn]=vn.geometry.coordinates,Ts=dn(Ul(Vn)),Xs=dn(Tl(Rn));rn.push(Ts,Xs,1/0,hn,-1,1),this.options.reduce&&rn.push(0)}let En=this.trees[Yr+1]=this._createTree(rn);vr&&console.timeEnd(Kr);for(let hn=Yr;hn>=kr;hn--){const vn=+Date.now();En=this.trees[hn]=this._createTree(this._cluster(En,hn)),vr&&console.log("z%d: %d clusters in %dms",hn,En.numItems,+Date.now()-vn)}return vr&&console.timeEnd("total time"),this}getClusters(pr,vr){let kr=((pr[0]+180)%360+360)%360-180;const Yr=Math.max(-90,Math.min(90,pr[1]));let Kr=pr[2]===180?180:((pr[2]+180)%360+360)%360-180;const rn=Math.max(-90,Math.min(90,pr[3]));if(pr[2]-pr[0]>=360)kr=-180,Kr=180;else if(kr>Kr){const Rn=this.getClusters([kr,Yr,180,rn],vr),Ts=this.getClusters([-180,Yr,Kr,rn],vr);return Rn.concat(Ts)}const En=this.trees[this._limitZoom(vr)],hn=En.range(Ul(kr),Tl(rn),Ul(Kr),Tl(Yr)),vn=En.data,Vn=[];for(const Rn of hn){const Ts=this.stride*Rn;Vn.push(vn[Ts+no]>1?Co(vn,Ts,this.clusterProps):this.points[vn[Ts+po]])}return Vn}getChildren(pr){const vr=this._getOriginId(pr),kr=this._getOriginZoom(pr),Yr="No cluster with the specified id.",Kr=this.trees[kr];if(!Kr)throw new Error(Yr);const rn=Kr.data;if(vr*this.stride>=rn.length)throw new Error(Yr);const En=this.options.radius/(this.options.extent*Math.pow(2,kr-1)),hn=Kr.within(rn[vr*this.stride],rn[vr*this.stride+1],En),vn=[];for(const Vn of hn){const Rn=Vn*this.stride;rn[Rn+4]===pr&&vn.push(rn[Rn+no]>1?Co(rn,Rn,this.clusterProps):this.points[rn[Rn+po]])}if(vn.length===0)throw new Error(Yr);return vn}getLeaves(pr,vr,kr){const Yr=[];return this._appendLeaves(Yr,pr,vr=vr||10,kr=kr||0,0),Yr}getTile(pr,vr,kr){const Yr=this.trees[this._limitZoom(pr)],Kr=Math.pow(2,pr),{extent:rn,radius:En}=this.options,hn=En/rn,vn=(kr-hn)/Kr,Vn=(kr+1+hn)/Kr,Rn={features:[]};return this._addTileFeatures(Yr.range((vr-hn)/Kr,vn,(vr+1+hn)/Kr,Vn),Yr.data,vr,kr,Kr,Rn),vr===0&&this._addTileFeatures(Yr.range(1-hn/Kr,vn,1,Vn),Yr.data,Kr,kr,Kr,Rn),vr===Kr-1&&this._addTileFeatures(Yr.range(0,vn,hn/Kr,Vn),Yr.data,-1,kr,Kr,Rn),Rn.features.length?Rn:null}getClusterExpansionZoom(pr){let vr=this._getOriginZoom(pr)-1;for(;vr<=this.options.maxZoom;){const kr=this.getChildren(pr);if(vr++,kr.length!==1)break;pr=kr[0].properties.cluster_id}return vr}_appendLeaves(pr,vr,kr,Yr,Kr){const rn=this.getChildren(vr);for(const En of rn){const hn=En.properties;if(hn&&hn.cluster?Kr+hn.point_count<=Yr?Kr+=hn.point_count:Kr=this._appendLeaves(pr,hn.cluster_id,kr,Yr,Kr):Kr<Yr?Kr++:pr.push(En),pr.length===kr)break}return Kr}_createTree(pr){const vr=new c.c4(pr.length/this.stride|0,this.options.nodeSize,Float32Array);for(let kr=0;kr<pr.length;kr+=this.stride)vr.add(pr[kr],pr[kr+1]);return vr.finish(),vr.data=pr,vr}_addTileFeatures(pr,vr,kr,Yr,Kr,rn){for(const En of pr){const hn=En*this.stride,vn=vr[hn+no]>1;let Vn,Rn,Ts;if(vn)Vn=Ss(vr,hn,this.clusterProps),Rn=vr[hn],Ts=vr[hn+1];else{const Gn=this.points[vr[hn+po]];Vn=Gn.properties;const[bo,Ys]=Gn.geometry.coordinates;Rn=Ul(bo),Ts=Tl(Ys)}const Xs={type:1,geometry:[[Math.round(this.options.extent*(Rn*Kr-kr)),Math.round(this.options.extent*(Ts*Kr-Yr))]],tags:Vn};let bs;bs=vn||this.options.generateId?vr[hn+po]:this.points[vr[hn+po]].id,bs!==void 0&&(Xs.id=bs),rn.features.push(Xs)}}_limitZoom(pr){return Math.max(this.options.minZoom,Math.min(Math.floor(+pr),this.options.maxZoom+1))}_cluster(pr,vr){const{radius:kr,extent:Yr,reduce:Kr,minPoints:rn}=this.options,En=kr/(Yr*Math.pow(2,vr)),hn=pr.data,vn=[],Vn=this.stride;for(let Rn=0;Rn<hn.length;Rn+=Vn){if(hn[Rn+2]<=vr)continue;hn[Rn+2]=vr;const Ts=hn[Rn],Xs=hn[Rn+1],bs=pr.within(hn[Rn],hn[Rn+1],En),Gn=hn[Rn+no];let bo=Gn;for(const Ys of bs){const jo=Ys*Vn;hn[jo+2]>vr&&(bo+=hn[jo+no])}if(bo>Gn&&bo>=rn){let Ys,jo=Ts*Gn,yu=Xs*Gn,Yo=-1;const Lo=(Rn/Vn<<5)+(vr+1)+this.points.length;for(const zo of bs){const uu=zo*Vn;if(hn[uu+2]<=vr)continue;hn[uu+2]=vr;const na=hn[uu+no];jo+=hn[uu]*na,yu+=hn[uu+1]*na,hn[uu+4]=Lo,Kr&&(Ys||(Ys=this._map(hn,Rn,!0),Yo=this.clusterProps.length,this.clusterProps.push(Ys)),Kr(Ys,this._map(hn,uu)))}hn[Rn+4]=Lo,vn.push(jo/bo,yu/bo,1/0,Lo,-1,bo),Kr&&vn.push(Yo)}else{for(let Ys=0;Ys<Vn;Ys++)vn.push(hn[Rn+Ys]);if(bo>1)for(const Ys of bs){const jo=Ys*Vn;if(!(hn[jo+2]<=vr)){hn[jo+2]=vr;for(let yu=0;yu<Vn;yu++)vn.push(hn[jo+yu])}}}}return vn}_getOriginId(pr){return pr-this.points.length>>5}_getOriginZoom(pr){return(pr-this.points.length)%32}_map(pr,vr,kr){if(pr[vr+no]>1){const rn=this.clusterProps[pr[vr+tn]];return kr?Object.assign({},rn):rn}const Yr=this.points[pr[vr+po]].properties,Kr=this.options.map(Yr);return kr&&Kr===Yr?Object.assign({},Kr):Kr}}function Co(xn,pr,vr){return{type:"Feature",id:xn[pr+po],properties:Ss(xn,pr,vr),geometry:{type:"Point",coordinates:[(kr=xn[pr],360*(kr-.5)),ga(xn[pr+1])]}};var kr}function Ss(xn,pr,vr){const kr=xn[pr+no],Yr=kr>=1e4?`${Math.round(kr/1e3)}k`:kr>=1e3?Math.round(kr/100)/10+"k":kr,Kr=xn[pr+tn],rn=Kr===-1?{}:Object.assign({},vr[Kr]);return Object.assign(rn,{cluster:!0,cluster_id:xn[pr+po],point_count:kr,point_count_abbreviated:Yr})}function Ul(xn){return xn/360+.5}function Tl(xn){const pr=Math.sin(xn*Math.PI/180),vr=.5-.25*Math.log((1+pr)/(1-pr))/Math.PI;return vr<0?0:vr>1?1:vr}function ga(xn){const pr=(180-360*xn)*Math.PI/180;return 360*Math.atan(Math.exp(pr))/Math.PI-90}function ds(xn,pr,vr,kr){let Yr=kr;const Kr=pr+(vr-pr>>1);let rn,En=vr-pr;const hn=xn[pr],vn=xn[pr+1],Vn=xn[vr],Rn=xn[vr+1];for(let Ts=pr+3;Ts<vr;Ts+=3){const Xs=Mn(xn[Ts],xn[Ts+1],hn,vn,Vn,Rn);if(Xs>Yr)rn=Ts,Yr=Xs;else if(Xs===Yr){const bs=Math.abs(Ts-Kr);bs<En&&(rn=Ts,En=bs)}}Yr>kr&&(rn-pr>3&&ds(xn,pr,rn,kr),xn[rn+2]=Yr,vr-rn>3&&ds(xn,rn,vr,kr))}function Mn(xn,pr,vr,kr,Yr,Kr){let rn=Yr-vr,En=Kr-kr;if(rn!==0||En!==0){const hn=((xn-vr)*rn+(pr-kr)*En)/(rn*rn+En*En);hn>1?(vr=Yr,kr=Kr):hn>0&&(vr+=rn*hn,kr+=En*hn)}return rn=xn-vr,En=pr-kr,rn*rn+En*En}function Cs(xn,pr,vr,kr){const Yr={id:xn??null,type:pr,geometry:vr,tags:kr,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(pr==="Point"||pr==="MultiPoint"||pr==="LineString")Ds(Yr,vr);else if(pr==="Polygon")Ds(Yr,vr[0]);else if(pr==="MultiLineString")for(const Kr of vr)Ds(Yr,Kr);else if(pr==="MultiPolygon")for(const Kr of vr)Ds(Yr,Kr[0]);return Yr}function Ds(xn,pr){for(let vr=0;vr<pr.length;vr+=3)xn.minX=Math.min(xn.minX,pr[vr]),xn.minY=Math.min(xn.minY,pr[vr+1]),xn.maxX=Math.max(xn.maxX,pr[vr]),xn.maxY=Math.max(xn.maxY,pr[vr+1])}function ao(xn,pr,vr,kr){if(!pr.geometry)return;const Yr=pr.geometry.coordinates;if(Yr&&Yr.length===0)return;const Kr=pr.geometry.type,rn=Math.pow(vr.tolerance/((1<<vr.maxZoom)*vr.extent),2);let En=[],hn=pr.id;if(vr.promoteId?hn=pr.properties[vr.promoteId]:vr.generateId&&(hn=kr||0),Kr==="Point")Wo(Yr,En);else if(Kr==="MultiPoint")for(const vn of Yr)Wo(vn,En);else if(Kr==="LineString")Gl(Yr,En,rn,!1);else if(Kr==="MultiLineString"){if(vr.lineMetrics){for(const vn of Yr)En=[],Gl(vn,En,rn,!1),xn.push(Cs(hn,"LineString",En,pr.properties));return}fs(Yr,En,rn,!1)}else if(Kr==="Polygon")fs(Yr,En,rn,!0);else{if(Kr!=="MultiPolygon"){if(Kr==="GeometryCollection"){for(const vn of pr.geometry.geometries)ao(xn,{id:hn,geometry:vn,properties:pr.properties},vr,kr);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const vn of Yr){const Vn=[];fs(vn,Vn,rn,!0),En.push(Vn)}}xn.push(Cs(hn,Kr,En,pr.properties))}function Wo(xn,pr){pr.push(ps(xn[0]),qn(xn[1]),0)}function Gl(xn,pr,vr,kr){let Yr,Kr,rn=0;for(let hn=0;hn<xn.length;hn++){const vn=ps(xn[hn][0]),Vn=qn(xn[hn][1]);pr.push(vn,Vn,0),hn>0&&(rn+=kr?(Yr*Vn-vn*Kr)/2:Math.sqrt(Math.pow(vn-Yr,2)+Math.pow(Vn-Kr,2))),Yr=vn,Kr=Vn}const En=pr.length-3;pr[2]=1,ds(pr,0,En,vr),pr[En+2]=1,pr.size=Math.abs(rn),pr.start=0,pr.end=pr.size}function fs(xn,pr,vr,kr){for(let Yr=0;Yr<xn.length;Yr++){const Kr=[];Gl(xn[Yr],Kr,vr,kr),pr.push(Kr)}}function ps(xn){return xn/360+.5}function qn(xn){const pr=Math.sin(xn*Math.PI/180),vr=.5-.25*Math.log((1+pr)/(1-pr))/Math.PI;return vr<0?0:vr>1?1:vr}function qs(xn,pr,vr,kr,Yr,Kr,rn,En){if(kr/=pr,Kr>=(vr/=pr)&&rn<kr)return xn;if(rn<vr||Kr>=kr)return null;const hn=[];for(const vn of xn){const Vn=vn.geometry;let Rn=vn.type;const Ts=Yr===0?vn.minX:vn.minY,Xs=Yr===0?vn.maxX:vn.maxY;if(Ts>=vr&&Xs<kr){hn.push(vn);continue}if(Xs<vr||Ts>=kr)continue;let bs=[];if(Rn==="Point"||Rn==="MultiPoint")Gs(Vn,bs,vr,kr,Yr);else if(Rn==="LineString")Eo(Vn,bs,vr,kr,Yr,!1,En.lineMetrics);else if(Rn==="MultiLineString")tu(Vn,bs,vr,kr,Yr,!1);else if(Rn==="Polygon")tu(Vn,bs,vr,kr,Yr,!0);else if(Rn==="MultiPolygon")for(const Gn of Vn){const bo=[];tu(Gn,bo,vr,kr,Yr,!0),bo.length&&bs.push(bo)}if(bs.length){if(En.lineMetrics&&Rn==="LineString"){for(const Gn of bs)hn.push(Cs(vn.id,Rn,Gn,vn.tags));continue}Rn!=="LineString"&&Rn!=="MultiLineString"||(bs.length===1?(Rn="LineString",bs=bs[0]):Rn="MultiLineString"),Rn!=="Point"&&Rn!=="MultiPoint"||(Rn=bs.length===3?"Point":"MultiPoint"),hn.push(Cs(vn.id,Rn,bs,vn.tags))}}return hn.length?hn:null}function Gs(xn,pr,vr,kr,Yr){for(let Kr=0;Kr<xn.length;Kr+=3){const rn=xn[Kr+Yr];rn>=vr&&rn<=kr&&Wl(pr,xn[Kr],xn[Kr+1],xn[Kr+2])}}function Eo(xn,pr,vr,kr,Yr,Kr,rn){let En=Kl(xn);const hn=Yr===0?Zo:ru;let vn,Vn,Rn=xn.start;for(let bo=0;bo<xn.length-3;bo+=3){const Ys=xn[bo],jo=xn[bo+1],yu=xn[bo+2],Yo=xn[bo+3],Lo=xn[bo+4],zo=Yr===0?Ys:jo,uu=Yr===0?Yo:Lo;let na=!1;rn&&(vn=Math.sqrt(Math.pow(Ys-Yo,2)+Math.pow(jo-Lo,2))),zo<vr?uu>vr&&(Vn=hn(En,Ys,jo,Yo,Lo,vr),rn&&(En.start=Rn+vn*Vn)):zo>kr?uu<kr&&(Vn=hn(En,Ys,jo,Yo,Lo,kr),rn&&(En.start=Rn+vn*Vn)):Wl(En,Ys,jo,yu),uu<vr&&zo>=vr&&(Vn=hn(En,Ys,jo,Yo,Lo,vr),na=!0),uu>kr&&zo<=kr&&(Vn=hn(En,Ys,jo,Yo,Lo,kr),na=!0),!Kr&&na&&(rn&&(En.end=Rn+vn*Vn),pr.push(En),En=Kl(xn)),rn&&(Rn+=vn)}let Ts=xn.length-3;const Xs=xn[Ts],bs=xn[Ts+1],Gn=Yr===0?Xs:bs;Gn>=vr&&Gn<=kr&&Wl(En,Xs,bs,xn[Ts+2]),Ts=En.length-3,Kr&&Ts>=3&&(En[Ts]!==En[0]||En[Ts+1]!==En[1])&&Wl(En,En[0],En[1],En[2]),En.length&&pr.push(En)}function Kl(xn){const pr=[];return pr.size=xn.size,pr.start=xn.start,pr.end=xn.end,pr}function tu(xn,pr,vr,kr,Yr,Kr){for(const rn of xn)Eo(rn,pr,vr,kr,Yr,Kr,!1)}function Wl(xn,pr,vr,kr){xn.push(pr,vr,kr)}function Zo(xn,pr,vr,kr,Yr,Kr){const rn=(Kr-pr)/(kr-pr);return Wl(xn,Kr,vr+(Yr-vr)*rn,1),rn}function ru(xn,pr,vr,kr,Yr,Kr){const rn=(Kr-vr)/(Yr-vr);return Wl(xn,pr+(kr-pr)*rn,Kr,1),rn}function Oo(xn,pr){const vr=[];for(let kr=0;kr<xn.length;kr++){const Yr=xn[kr],Kr=Yr.type;let rn;if(Kr==="Point"||Kr==="MultiPoint"||Kr==="LineString")rn=Tu(Yr.geometry,pr);else if(Kr==="MultiLineString"||Kr==="Polygon"){rn=[];for(const En of Yr.geometry)rn.push(Tu(En,pr))}else if(Kr==="MultiPolygon"){rn=[];for(const En of Yr.geometry){const hn=[];for(const vn of En)hn.push(Tu(vn,pr));rn.push(hn)}}vr.push(Cs(Yr.id,Kr,rn,Yr.tags))}return vr}function Tu(xn,pr){const vr=[];vr.size=xn.size,xn.start!==void 0&&(vr.start=xn.start,vr.end=xn.end);for(let kr=0;kr<xn.length;kr+=3)vr.push(xn[kr]+pr,xn[kr+1],xn[kr+2]);return vr}function Ao(xn,pr){if(xn.transformed)return xn;const vr=1<<xn.z,kr=xn.x,Yr=xn.y;for(const Kr of xn.features){const rn=Kr.geometry,En=Kr.type;if(Kr.geometry=[],En===1)for(let hn=0;hn<rn.length;hn+=2)Kr.geometry.push(Ll(rn[hn],rn[hn+1],pr,vr,kr,Yr));else for(let hn=0;hn<rn.length;hn++){const vn=[];for(let Vn=0;Vn<rn[hn].length;Vn+=2)vn.push(Ll(rn[hn][Vn],rn[hn][Vn+1],pr,vr,kr,Yr));Kr.geometry.push(vn)}}return xn.transformed=!0,xn}function Ll(xn,pr,vr,kr,Yr,Kr){return[Math.round(vr*(xn*kr-Yr)),Math.round(vr*(pr*kr-Kr))]}function Jo(xn,pr,vr,kr,Yr){const Kr=pr===Yr.maxZoom?0:Yr.tolerance/((1<<pr)*Yr.extent),rn={features:[],numPoints:0,numSimplified:0,numFeatures:xn.length,source:null,x:vr,y:kr,z:pr,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const En of xn)Ku(rn,En,Kr,Yr);return rn}function Ku(xn,pr,vr,kr){const Yr=pr.geometry,Kr=pr.type,rn=[];if(xn.minX=Math.min(xn.minX,pr.minX),xn.minY=Math.min(xn.minY,pr.minY),xn.maxX=Math.max(xn.maxX,pr.maxX),xn.maxY=Math.max(xn.maxY,pr.maxY),Kr==="Point"||Kr==="MultiPoint")for(let En=0;En<Yr.length;En+=3)rn.push(Yr[En],Yr[En+1]),xn.numPoints++,xn.numSimplified++;else if(Kr==="LineString")zn(rn,Yr,xn,vr,!1,!1);else if(Kr==="MultiLineString"||Kr==="Polygon")for(let En=0;En<Yr.length;En++)zn(rn,Yr[En],xn,vr,Kr==="Polygon",En===0);else if(Kr==="MultiPolygon")for(let En=0;En<Yr.length;En++){const hn=Yr[En];for(let vn=0;vn<hn.length;vn++)zn(rn,hn[vn],xn,vr,!0,vn===0)}if(rn.length){let En=pr.tags||null;if(Kr==="LineString"&&kr.lineMetrics){En={};for(const vn in pr.tags)En[vn]=pr.tags[vn];En.mapbox_clip_start=Yr.start/Yr.size,En.mapbox_clip_end=Yr.end/Yr.size}const hn={geometry:rn,type:Kr==="Polygon"||Kr==="MultiPolygon"?3:Kr==="LineString"||Kr==="MultiLineString"?2:1,tags:En};pr.id!==null&&(hn.id=pr.id),xn.features.push(hn)}}function zn(xn,pr,vr,kr,Yr,Kr){const rn=kr*kr;if(kr>0&&pr.size<(Yr?rn:kr))return void(vr.numPoints+=pr.length/3);const En=[];for(let hn=0;hn<pr.length;hn+=3)(kr===0||pr[hn+2]>rn)&&(vr.numSimplified++,En.push(pr[hn],pr[hn+1])),vr.numPoints++;Yr&&function(hn,vn){let Vn=0;for(let Rn=0,Ts=hn.length,Xs=Ts-2;Rn<Ts;Xs=Rn,Rn+=2)Vn+=(hn[Rn]-hn[Xs])*(hn[Rn+1]+hn[Xs+1]);if(Vn>0===vn)for(let Rn=0,Ts=hn.length;Rn<Ts/2;Rn+=2){const Xs=hn[Rn],bs=hn[Rn+1];hn[Rn]=hn[Ts-2-Rn],hn[Rn+1]=hn[Ts-1-Rn],hn[Ts-2-Rn]=Xs,hn[Ts-1-Rn]=bs}}(En,Kr),xn.push(En)}const Vu={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class t0{constructor(pr,vr){const kr=(vr=this.options=function(Kr,rn){for(const En in rn)Kr[En]=rn[En];return Kr}(Object.create(Vu),vr)).debug;if(kr&&console.time("preprocess data"),vr.maxZoom<0||vr.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(vr.promoteId&&vr.generateId)throw new Error("promoteId and generateId cannot be used together.");let Yr=function(Kr,rn){const En=[];if(Kr.type==="FeatureCollection")for(let hn=0;hn<Kr.features.length;hn++)ao(En,Kr.features[hn],rn,hn);else ao(En,Kr.type==="Feature"?Kr:{geometry:Kr},rn);return En}(pr,vr);this.tiles={},this.tileCoords=[],kr&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",vr.indexMaxZoom,vr.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Yr=function(Kr,rn){const En=rn.buffer/rn.extent;let hn=Kr;const vn=qs(Kr,1,-1-En,En,0,-1,2,rn),Vn=qs(Kr,1,1-En,2+En,0,-1,2,rn);return(vn||Vn)&&(hn=qs(Kr,1,-En,1+En,0,-1,2,rn)||[],vn&&(hn=Oo(vn,1).concat(hn)),Vn&&(hn=hn.concat(Oo(Vn,-1)))),hn}(Yr,vr),Yr.length&&this.splitTile(Yr,0,0,0),kr&&(Yr.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(pr,vr,kr,Yr,Kr,rn,En){const hn=[pr,vr,kr,Yr],vn=this.options,Vn=vn.debug;for(;hn.length;){Yr=hn.pop(),kr=hn.pop(),vr=hn.pop(),pr=hn.pop();const Rn=1<<vr,Ts=Wu(vr,kr,Yr);let Xs=this.tiles[Ts];if(!Xs&&(Vn>1&&console.time("creation"),Xs=this.tiles[Ts]=Jo(pr,vr,kr,Yr,vn),this.tileCoords.push({z:vr,x:kr,y:Yr}),Vn)){Vn>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",vr,kr,Yr,Xs.numFeatures,Xs.numPoints,Xs.numSimplified),console.timeEnd("creation"));const na=`z${vr}`;this.stats[na]=(this.stats[na]||0)+1,this.total++}if(Xs.source=pr,Kr==null){if(vr===vn.indexMaxZoom||Xs.numPoints<=vn.indexMaxPoints)continue}else{if(vr===vn.maxZoom||vr===Kr)continue;if(Kr!=null){const na=Kr-vr;if(kr!==rn>>na||Yr!==En>>na)continue}}if(Xs.source=null,pr.length===0)continue;Vn>1&&console.time("clipping");const bs=.5*vn.buffer/vn.extent,Gn=.5-bs,bo=.5+bs,Ys=1+bs;let jo=null,yu=null,Yo=null,Lo=null,zo=qs(pr,Rn,kr-bs,kr+bo,0,Xs.minX,Xs.maxX,vn),uu=qs(pr,Rn,kr+Gn,kr+Ys,0,Xs.minX,Xs.maxX,vn);pr=null,zo&&(jo=qs(zo,Rn,Yr-bs,Yr+bo,1,Xs.minY,Xs.maxY,vn),yu=qs(zo,Rn,Yr+Gn,Yr+Ys,1,Xs.minY,Xs.maxY,vn),zo=null),uu&&(Yo=qs(uu,Rn,Yr-bs,Yr+bo,1,Xs.minY,Xs.maxY,vn),Lo=qs(uu,Rn,Yr+Gn,Yr+Ys,1,Xs.minY,Xs.maxY,vn),uu=null),Vn>1&&console.timeEnd("clipping"),hn.push(jo||[],vr+1,2*kr,2*Yr),hn.push(yu||[],vr+1,2*kr,2*Yr+1),hn.push(Yo||[],vr+1,2*kr+1,2*Yr),hn.push(Lo||[],vr+1,2*kr+1,2*Yr+1)}}getTile(pr,vr,kr){pr=+pr,vr=+vr,kr=+kr;const Yr=this.options,{extent:Kr,debug:rn}=Yr;if(pr<0||pr>24)return null;const En=1<<pr,hn=Wu(pr,vr=vr+En&En-1,kr);if(this.tiles[hn])return Ao(this.tiles[hn],Kr);rn>1&&console.log("drilling down to z%d-%d-%d",pr,vr,kr);let vn,Vn=pr,Rn=vr,Ts=kr;for(;!vn&&Vn>0;)Vn--,Rn>>=1,Ts>>=1,vn=this.tiles[Wu(Vn,Rn,Ts)];return vn&&vn.source?(rn>1&&(console.log("found parent tile z%d-%d-%d",Vn,Rn,Ts),console.time("drilling down")),this.splitTile(vn.source,Vn,Rn,Ts,pr,vr,kr),rn>1&&console.timeEnd("drilling down"),this.tiles[hn]?Ao(this.tiles[hn],Kr):null):null}}function Wu(xn,pr,vr){return 32*((1<<xn)*vr+pr)+xn}function Bo(xn,pr){const vr=xn.tileID.canonical;if(!this._geoJSONIndex)return void pr(null,null);const kr=this._geoJSONIndex.getTile(vr.z,vr.x,vr.y);if(!kr)return void pr(null,null);const Yr=vn=>vn.tags&&"3d_elevation_id"in vn.tags&&"source"in vn.tags&&vn.tags.source==="elevation",Kr=kr.features.filter(vn=>Yr(vn));let rn={_geojsonTileLayer:kr.features};Kr.length>0&&(rn={_geojsonTileLayer:kr.features.filter(vn=>!Yr(vn)),hd_road_elevation:Kr});const En=new fn(rn),hn=function(vn){const Vn=new c.bt;for(const Rn of Object.keys(vn))Vn.writeMessage(3,rs,{name:Rn,features:vn[Rn]});return Vn.finish()}(rn).buffer;pr(null,{vectorTile:En,rawData:hn})}class Ru extends or{constructor(pr,vr,kr,Yr,Kr,rn,En){super(pr,vr,kr,Yr,Kr,Bo,En),rn&&(this.loadGeoJSON=rn),this._dynamicIndex=new Sr}loadData(pr,vr){const kr=pr&&pr.request,Yr=kr&&kr.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(pr,(Kr,rn)=>{if(Kr||!rn)return vr(Kr);if(typeof rn!="object")return vr(new Error(`Input data given to '${pr.source}' is not a valid GeoJSON object.`));{try{if(pr.filter){const hn=c.U(pr.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(hn.result==="error")throw new Error(hn.value.map(vn=>`${vn.key}: ${vn.message}`).join(", "));rn.features=rn.features.filter(vn=>hn.value.evaluate({zoom:0},vn))}pr.dynamic?(rn.type==="Feature"&&(rn={type:"FeatureCollection",features:[rn]}),pr.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(rn.features,this.loaded),pr.cluster&&(rn.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=pr.cluster?new us(function({superclusterOptions:hn,clusterProperties:vn}){if(!vn||!hn)return hn;const Vn={},Rn={},Ts={accumulated:null,zoom:0},Xs={properties:null},bs=Object.keys(vn);for(const Gn of bs){const[bo,Ys]=vn[Gn],jo=c.U(Ys),yu=c.U(typeof bo=="string"?[bo,["accumulated"],["get",Gn]]:bo);Vn[Gn]=jo.value,Rn[Gn]=yu.value}return hn.map=Gn=>{Xs.properties=Gn;const bo={};for(const Ys of bs)bo[Ys]=Vn[Ys].evaluate(Ts,Xs);return bo},hn.reduce=(Gn,bo)=>{Xs.properties=bo;for(const Ys of bs)Ts.accumulated=Gn[Ys],Gn[Ys]=Rn[Ys].evaluate(Ts,Xs)},hn}(pr)).load(rn.features):pr.dynamic?this._dynamicIndex:function(hn,vn){return new t0(hn,vn)}(rn,pr.geojsonVtOptions)}catch(hn){return vr(hn)}const En={};if(Yr){const hn=dt(kr);hn&&(En.resourceTiming={},En.resourceTiming[pr.source]=JSON.parse(JSON.stringify(hn)))}vr(null,En)}})}reloadTile(pr,vr){const kr=this.loaded;return kr&&kr[pr.uid]?pr.partial?vr(null,void 0):super.reloadTile(pr,vr):this.loadTile(pr,vr)}loadGeoJSON(pr,vr){if(pr.request)c.m(pr.request,vr);else{if(typeof pr.data!="string")return vr(new Error(`Input data given to '${pr.source}' is not a valid GeoJSON object.`));setTimeout(()=>{try{return vr(null,JSON.parse(pr.data))}catch{return vr(new Error(`Input data given to '${pr.source}' is not a valid GeoJSON object.`))}},0)}}getClusterExpansionZoom(pr,vr){try{vr(null,this._geoJSONIndex.getClusterExpansionZoom(pr.clusterId))}catch(kr){vr(kr)}}getClusterChildren(pr,vr){try{vr(null,this._geoJSONIndex.getChildren(pr.clusterId))}catch(kr){vr(kr)}}getClusterLeaves(pr,vr){try{vr(null,this._geoJSONIndex.getLeaves(pr.clusterId,pr.limit,pr.offset))}catch(kr){vr(kr)}}}class T0{constructor(pr,vr,kr){this.tileID=new c.aQ(pr.tileID.overscaledZ,pr.tileID.wrap,pr.tileID.canonical.z,pr.tileID.canonical.x,pr.tileID.canonical.y),this.tileZoom=pr.tileZoom,this.uid=pr.uid,this.zoom=pr.zoom,this.canonical=pr.tileID.canonical,this.pixelRatio=pr.pixelRatio,this.tileSize=pr.tileSize,this.source=pr.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=pr.projection,this.brightness=vr,this.worldview=kr}parse(pr,vr,kr,Yr){this.status="parsing";const Kr=new c.aQ(kr.tileID.overscaledZ,kr.tileID.wrap,kr.tileID.canonical.z,kr.tileID.canonical.x,kr.tileID.canonical.y),rn=[],En=vr.familiesBySource[kr.source],hn=new c.fn(Kr,kr.promoteId);hn.bucketLayerIDs=[],hn.is3DTile=!0,c.fC(pr).then(vn=>{if(!vn)return Yr(new Error("Could not parse tile"));const Vn=vn.json.extensionsUsed&&vn.json.extensionsUsed.includes("MAPBOX_mesh_features")||vn.json.asset.extras&&vn.json.asset.extras.MAPBOX_mesh_features,Rn=vn.json.extensionsUsed&&vn.json.extensionsUsed.includes("EXT_meshopt_compression"),Ts=new c.ac(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const Xs in En)for(const bs of En[Xs]){const Gn=bs[0];hn.bucketLayerIDs.push(bs.map(jo=>c.B(jo.id,jo.scope))),Gn.recalculate(Ts,[]);const bo=c.fD(vn,1/c.d7(kr.tileID.canonical)),Ys=new c.fE(bs,bo,Kr,Vn,Rn,this.brightness,hn,this.worldview);Vn||(Ys.needsUpload=!0),rn.push(Ys),Ys.evaluate(Gn)}this.status="done",Yr(null,{buckets:rn,featureIndex:hn,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(vn=>Yr(new Error(vn.message)))}}class fp{constructor(pr,vr,kr,Yr,Kr,rn,En,hn){this.actor=pr,this.layerIndex=vr,this.availableImages=kr,this.availableModels=Yr,this.brightness=En,this.loading={},this.loaded={},this.worldview=hn}loadTile(pr,vr){const kr=pr.uid,Yr=this.loading[kr]=new T0(pr,this.brightness,this.worldview);c.bu(pr.request,(Kr,rn)=>{const En=!this.loading[kr];return delete this.loading[kr],En||Kr?(Yr.status="done",En||(this.loaded[kr]=Yr),vr(Kr)):rn&&rn.byteLength!==0?void Yr.parse(rn,this.layerIndex,pr,(hn,vn)=>{Yr.status="done",this.loaded=this.loaded||{},this.loaded[kr]=Yr,hn||!vn?vr(hn):vr(null,vn)}):(Yr.status="done",this.loaded[kr]=Yr,vr())})}reloadTile(pr,vr){const kr=this.loaded,Yr=pr.uid;if(kr&&kr[Yr]){const Kr=kr[Yr];Kr.projection=pr.projection,Kr.brightness=pr.brightness;const rn=(En,hn)=>{Kr.reloadCallback&&(delete Kr.reloadCallback,this.loadTile(pr,vr)),vr(En,hn)};Kr.status==="parsing"?Kr.reloadCallback=rn:Kr.status==="done"&&this.loadTile(pr,vr)}}abortTile(pr,vr){const kr=pr.uid;this.loading[kr]&&delete this.loading[kr],vr()}removeTile(pr,vr){const kr=this.loaded,Yr=pr.uid;kr&&kr[Yr]&&delete kr[Yr],vr()}}class xo{constructor(pr){this.self=pr,this.actor=new c.fG(pr,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new c.x,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=c.cm({name:"mercator"}),this.workerSourceTypes={vector:or,geojson:Ru,"raster-dem":mr,"raster-array":on,"batched-model":fp},this.workerSources={},this.self.registerWorkerSource=(vr,kr)=>{if(this.workerSourceTypes[vr])throw new Error(`Worker source with name "${vr}" already registered.`);this.workerSourceTypes[vr]=kr},this.self.registerRTLTextPlugin=vr=>{if(c.fH.isParsed())throw new Error("RTL text plugin already registered.");c.fH.setState({pluginStatus:c.fI.parsed,pluginURL:c.fH.getPluginURL()}),c.fH.applyArabicShaping=vr.applyArabicShaping,c.fH.processBidirectionalText=vr.processBidirectionalText,c.fH.processStyledBidirectionalText=vr.processStyledBidirectionalText;for(const kr of this.rtlPluginParsingListeners)kr(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(pr,vr,kr){delete this.layerIndexes[pr],delete this.availableImages[pr],delete this.availableModels[pr],delete this.workerSources[pr],kr()}checkIfReady(pr,vr,kr){kr()}setReferrer(pr,vr){this.referrer=vr}spriteLoaded(pr,vr){this.isSpriteLoaded[pr]||(this.isSpriteLoaded[pr]={});const{scope:kr,isLoaded:Yr}=vr;if(this.isSpriteLoaded[pr][kr]=Yr,this.workerSources[pr]&&this.workerSources[pr][kr])for(const Kr in this.workerSources[pr][kr]){const rn=this.workerSources[pr][kr][Kr];for(const En in rn){const hn=rn[En];hn instanceof or&&(hn.isSpriteLoaded=Yr,hn.fire(new c.z("isSpriteLoaded")))}}}setImages(pr,vr,kr){this.availableImages[pr]||(this.availableImages[pr]={});const{scope:Yr,images:Kr}=vr;if(this.availableImages[pr][Yr]=Kr,this.workerSources[pr]&&this.workerSources[pr][Yr]){for(const rn in this.workerSources[pr][Yr]){const En=this.workerSources[pr][Yr][rn];for(const hn in En)En[hn].availableImages=Kr}kr()}else kr()}setModels(pr,{scope:vr,models:kr},Yr){if(this.availableModels[pr]||(this.availableModels[pr]={}),this.availableModels[pr][vr]=kr,this.workerSources[pr]&&this.workerSources[pr][vr]){for(const Kr in this.workerSources[pr][vr]){const rn=this.workerSources[pr][vr][Kr];for(const En in rn)rn[En].availableModels=kr}Yr()}else Yr()}setProjection(pr,vr){this.projections[pr]=c.cm(vr)}setBrightness(pr,vr,kr){this.brightness=vr,kr()}setWorldview(pr,vr,kr){this.worldview=vr,kr()}setLayers(pr,vr,kr){this.getLayerIndex(pr,vr.scope).replace(vr.layers,vr.options),kr()}updateLayers(pr,vr,kr){this.getLayerIndex(pr,vr.scope).update(vr.layers,vr.removedIds,vr.options),kr()}loadTile(pr,vr,kr){vr.projection=this.projections[pr]||this.defaultProjection,this.getWorkerSource(pr,vr.type,vr.source,vr.scope).loadTile(vr,kr)}decodeRasterArray(pr,vr,kr){this.getWorkerSource(pr,vr.type,vr.source,vr.scope).decodeRasterArray(vr,kr)}reloadTile(pr,vr,kr){vr.projection=this.projections[pr]||this.defaultProjection,this.getWorkerSource(pr,vr.type,vr.source,vr.scope).reloadTile(vr,kr)}abortTile(pr,vr,kr){this.getWorkerSource(pr,vr.type,vr.source,vr.scope).abortTile(vr,kr)}removeTile(pr,vr,kr){this.getWorkerSource(pr,vr.type,vr.source,vr.scope).removeTile(vr,kr)}removeSource(pr,vr,kr){if(!(this.workerSources[pr]&&this.workerSources[pr][vr.scope]&&this.workerSources[pr][vr.scope][vr.type]&&this.workerSources[pr][vr.scope][vr.type][vr.source]))return;const Yr=this.workerSources[pr][vr.scope][vr.type][vr.source];delete this.workerSources[pr][vr.scope][vr.type][vr.source],Yr.removeSource!==void 0?Yr.removeSource(vr,kr):kr()}loadWorkerSource(pr,vr,kr){try{this.self.importScripts(vr.url),kr()}catch(Yr){kr(Yr)}}syncRTLPluginState(pr,vr,kr){if(c.fH.isParsed())kr(null,!0);else if(c.fH.isParsing())this.rtlPluginParsingListeners.push(kr);else try{c.fH.setState(vr);const Yr=c.fH.getPluginURL();!c.fH.isLoaded()||c.fH.isParsed()||c.fH.isParsing()||Yr==null||(c.fH.setState({pluginStatus:c.fI.parsing,pluginURL:c.fH.getPluginURL()}),this.self.importScripts(Yr),c.fH.isParsed()?kr(null,!0):this.rtlPluginParsingListeners.push(kr))}catch(Yr){kr(Yr)}}setDracoUrl(pr,vr){this.dracoUrl=vr}getAvailableImages(pr,vr){this.availableImages[pr]||(this.availableImages[pr]={});let kr=this.availableImages[pr][vr];return kr||(kr=[]),kr}getAvailableModels(pr,vr){this.availableModels[pr]||(this.availableModels[pr]={});let kr=this.availableModels[pr][vr];return kr||(kr={}),kr}getLayerIndex(pr,vr){this.layerIndexes[pr]||(this.layerIndexes[pr]={});let kr=this.layerIndexes[pr][vr];return kr||(kr=this.layerIndexes[pr][vr]=new St,kr.scope=vr),kr}getWorkerSource(pr,vr,kr,Yr){const Kr=this.workerSources;return Kr[pr]||(Kr[pr]={}),Kr[pr][Yr]||(Kr[pr][Yr]={}),Kr[pr][Yr][vr]||(Kr[pr][Yr][vr]={}),this.isSpriteLoaded[pr]||(this.isSpriteLoaded[pr]={}),Kr[pr][Yr][vr][kr]||(Kr[pr][Yr][vr][kr]=new this.workerSourceTypes[vr]({send:(rn,En,hn,vn,Vn,Rn)=>this.actor.send(rn,En,hn,pr,Vn,Rn),scheduler:this.actor.scheduler},this.getLayerIndex(pr,Yr),this.getAvailableImages(pr,Yr),this.getAvailableModels(pr,Yr),this.isSpriteLoaded[pr][Yr],void 0,this.brightness,this.worldview)),Kr[pr][Yr][vr][kr]}rasterizeImagesWorker(pr,vr,kr){const Yr=new Map;for(const[Kr,{image:rn,imageVariant:En}]of vr.tasks.entries()){const hn=this.imageRasterizer.rasterize(En,rn,vr.scope,pr);Yr.set(Kr,hn)}kr(void 0,Yr)}removeRasterizedImages(pr,vr,kr){this.imageRasterizer.removeImagesFromCacheByIds(vr.imageIds,vr.scope,pr),kr()}enforceCacheSizeLimit(pr,vr){c.fJ(vr)}getWorkerPerformanceMetrics(pr,vr,kr){kr(void 0,void 0)}}return c.fF(self)&&(self.worker=new xo(self)),xo}),$(["./shared"],function(c){var dt="3.17.0";const ht={create:"create",load:"load",fullLoad:"fullLoad"},Et={mark(st){performance.mark(st)},measure(st,d,_e){performance.measure(st,d,_e)}};function St(st){const d=st.name.split("?")[0];return c.a(d)&&d.includes("mapbox-gl.js")?"javascript":c.a(d)&&d.includes("mapbox-gl.css")?"css":c.b(d)?"fontRange":c.c(d)?"sprite":c.i(d)?"style":c.d(d)?"tilejson":"other"}var At,Pt={},Vt=function(){if(At)return Pt;function st(ot){return!d(ot)}function d(ot){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var mt,xt,Tt=new Blob([""],{type:"text/javascript"}),kt=URL.createObjectURL(Tt);try{xt=new Worker(kt),mt=!0}catch{mt=!1}return xt&&xt.terminate(),URL.revokeObjectURL(kt),mt}()?function(){var mt=document.createElement("canvas");mt.width=mt.height=1;var xt=mt.getContext("2d");if(!xt)return!1;var Tt=xt.getImageData(0,0,1,1);return Tt&&Tt.width===mt.width}()?(_e[ut=ot&&ot.failIfMajorPerformanceCaveat]===void 0&&(_e[ut]=function(mt){var xt,Tt=function(kt){var $t=document.createElement("canvas"),Xt=Object.create(st.webGLContextAttributes);return Xt.failIfMajorPerformanceCaveat=kt,$t.getContext("webgl2",Xt)}(mt);if(!Tt)return!1;try{xt=Tt.createShader(Tt.VERTEX_SHADER)}catch{return!1}return!(!xt||Tt.isContextLost())&&(Tt.shaderSource(xt,"void main() {}"),Tt.compileShader(xt),Tt.getShaderParameter(xt,Tt.COMPILE_STATUS)===!0)}(ut)),_e[ut]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var ut}At=1,Pt.supported=st,Pt.notSupportedReason=d;var _e={};return st.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},Pt}();function Bt(st,d,_e){const ot=document.createElement(st);return d!=null&&(ot.className=d),_e&&_e.appendChild(ot),ot}function Zt(st,d,_e){const ot=document.createElementNS("http://www.w3.org/2000/svg",st);for(const ut of Object.keys(d))ot.setAttributeNS(null,ut,String(d[ut]));return _e&&_e.appendChild(ot),ot}const zt=typeof document<"u"?document.documentElement&&document.documentElement.style:null,Ut=zt&&zt.userSelect!==void 0?"userSelect":"WebkitUserSelect";let Nt;function Gt(){zt&&Ut&&(Nt=zt[Ut],zt[Ut]="none")}function er(){zt&&Ut&&(zt[Ut]=Nt)}function ir(st){st.preventDefault(),st.stopPropagation(),window.removeEventListener("click",ir,!0)}function or(){window.addEventListener("click",ir,!0),window.setTimeout(()=>{window.removeEventListener("click",ir,!0)},0)}function mr(st,d){const _e=st.getBoundingClientRect();return un(st,_e,d)}function Rr(st,d){const _e=st.getBoundingClientRect(),ot=[];for(let ut=0;ut<d.length;ut++)ot.push(un(st,_e,d[ut]));return ot}function on(st){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&st.button===2&&st.ctrlKey?0:st.button}function un(st,d,_e){const ot=st.offsetWidth===d.width?1:st.offsetWidth/d.width;return new c.P((_e.clientX-d.left)*ot,(_e.clientY-d.top)*ot)}const jr="01",Jr="NO_ACCESS_TOKEN";class fn{constructor(d,_e,ot){this._transformRequestFn=d,this._customAccessToken=_e,this._silenceAuthErrors=!!ot,this._createSkuToken()}_createSkuToken(){const d=function(){let _e="";for(let ot=0;ot<10;ot++)_e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",jr,_e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=d.token,this._skuTokenExpiresAt=d.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(d,_e){return this._transformRequestFn&&this._transformRequestFn(d,_e)||{url:d}}normalizeStyleURL(d,_e){if(!c.h(d))return d;const ot=Cr(d);return ot.params.push(`sdk=js-${dt}`),ot.path=`/styles/v1${ot.path}`,this._makeAPIURL(ot,this._customAccessToken||_e)}normalizeGlyphsURL(d,_e){if(!c.h(d))return d;const ot=Cr(d);return ot.path=`/fonts/v1${ot.path}`,this._makeAPIURL(ot,this._customAccessToken||_e)}normalizeModelURL(d,_e){if(!c.h(d))return d;const ot=Cr(d);return ot.path=`/models/v1${ot.path}`,this._makeAPIURL(ot,this._customAccessToken||_e)}normalizeSourceURL(d,_e,ot,ut){if(!c.h(d))return d;const mt=Cr(d);return mt.path=`/v4/${mt.authority}.json`,mt.params.push("secure"),ot&&mt.params.push(`language=${ot}`),ut&&mt.params.push(`worldview=${ut}`),this._makeAPIURL(mt,this._customAccessToken||_e)}normalizeIconsetURL(d,_e){const ot=Cr(d);return c.h(d)?(ot.path=`/styles/v1${ot.path}/iconset.pbf`,this._makeAPIURL(ot,this._customAccessToken||_e)):Sr(ot)}normalizeSpriteURL(d,_e,ot,ut){const mt=Cr(d);return c.h(d)?(mt.path=`/styles/v1${mt.path}/sprite${_e}${ot}`,this._makeAPIURL(mt,this._customAccessToken||ut)):(mt.path+=`${_e}${ot}`,Sr(mt))}normalizeTileURL(d,_e,ot){if(this._isSkuTokenExpired()&&this._createSkuToken(),d&&!c.h(d))return d;const ut=Cr(d);ut.path=ut.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${_e||ot&&ut.authority!=="raster"&&ot===512?"@2x":""}${c.k.supported?".webp":"$1"}`),ut.authority==="raster"?ut.path=`/${c.e.RASTER_URL_PREFIX}${ut.path}`:ut.authority==="rasterarrays"?ut.path=`/${c.e.RASTERARRAYS_URL_PREFIX}${ut.path}`:ut.authority==="3dtiles"?ut.path=`/${c.e.TILES3D_URL_PREFIX}${ut.path}`:(ut.path=ut.path.replace(/^.+\/v4\//,"/"),ut.path=`/${c.e.TILE_URL_VERSION}${ut.path}`);const mt=this._customAccessToken||function(xt){for(const Tt of xt){const kt=Tt.match(/^access_token=(.*)$/);if(kt)return kt[1]}return null}(ut.params)||c.e.ACCESS_TOKEN;return c.e.REQUIRE_ACCESS_TOKEN&&mt&&this._skuToken&&ut.params.push(`sku=${this._skuToken}`),this._makeAPIURL(ut,mt)}canonicalizeTileURL(d,_e){const ot=Cr(d);if(!ot.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!ot.path.match(/\.[\w]+$/))return d;let ut="mapbox://";ot.path.match(/^\/raster\/v1\//)?ut+=`raster/${ot.path.replace(`/${c.e.RASTER_URL_PREFIX}/`,"")}`:ot.path.match(/^\/rasterarrays\/v1\//)?ut+=`rasterarrays/${ot.path.replace(`/${c.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:ut+=`tiles/${ot.path.replace(`/${c.e.TILE_URL_VERSION}/`,"")}`;let mt=ot.params;return _e&&(mt=mt.filter(xt=>!xt.match(/^access_token=/))),mt.length&&(ut+=`?${mt.join("&")}`),ut}canonicalizeTileset(d,_e){const ot=!!_e&&c.h(_e),ut=[];for(const mt of d.tiles||[])c.j(mt)?ut.push(this.canonicalizeTileURL(mt,ot)):ut.push(mt);return ut}_makeAPIURL(d,_e){const ot="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",ut=Cr(c.e.API_URL);if(d.protocol=ut.protocol,d.authority=ut.authority,d.protocol==="http"){const mt=d.params.indexOf("secure");mt>=0&&d.params.splice(mt,1)}if(ut.path!=="/"&&(d.path=`${ut.path}${d.path}`),!c.e.REQUIRE_ACCESS_TOKEN)return Sr(d);if(_e=_e||c.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!_e)throw new Error(`An API access token is required to use Mapbox GL. ${ot}`);if(_e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${ot}`)}return d.params=d.params.filter(mt=>mt.indexOf("access_token")===-1),d.params.push(`access_token=${_e||""}`),Sr(d)}}const Fr=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Cr(st){const d=st.match(Fr);if(!d)throw new Error("Unable to parse URL object");return{protocol:d[1],authority:d[2],path:d[3]||"/",params:d[4]?d[4].split("&"):[]}}function Sr(st){const d=st.params.length?`?${st.params.join("&")}`:"";return`${st.protocol}://${st.authority}${st.path}${d}`}const dr="mapbox.eventData";function gr(st){if(!st)return null;const d=st.split(".");if(!d||d.length!==3)return null;try{return JSON.parse(c.l(d[1]))}catch{return null}}class qr{constructor(d){this.type=d,this.anonId=null,this.anonIdTimestamp=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(d){const _e=gr(c.e.ACCESS_TOKEN);let ot="";return ot=_e&&_e.u?c.f(_e.u):c.e.ACCESS_TOKEN||"",d?`${dr}.${d}:${ot}`:`${dr}:${ot}`}fetchEventData(){const d=c.s("localStorage"),_e=this.getStorageKey(),ot=this.getStorageKey("uuid"),ut=this.getStorageKey("uuidTimestamp");if(d)try{const mt=localStorage.getItem(_e);mt&&(this.eventData=JSON.parse(mt));const xt=localStorage.getItem(ot);xt&&(this.anonId=xt);const Tt=localStorage.getItem(ut);Tt&&(this.anonIdTimestamp=Number(Tt));const kt=Date.now()-864e5;(!this.anonIdTimestamp||this.anonIdTimestamp<kt)&&this.refreshUUID()}catch{c.w("Unable to read from LocalStorage")}}refreshUUID(){this.anonId=c.u(),this.anonIdTimestamp=Date.now()}saveEventData(){const d=c.s("localStorage"),_e=this.getStorageKey(),ot=this.getStorageKey("uuid"),ut=this.getStorageKey("uuidTimestamp"),mt=this.anonId,xt=this.anonIdTimestamp;if(d&&mt)try{localStorage.setItem(ot,mt),Object.keys(this.eventData).length>=1&&localStorage.setItem(_e,JSON.stringify(this.eventData)),xt&&localStorage.setItem(ut,xt.toString())}catch{c.w("Unable to write to LocalStorage")}}processRequests(d){}postEvent(d,_e,ot,ut){if(!c.e.EVENTS_URL)return;const mt=Cr(c.e.EVENTS_URL);mt.params.push(`access_token=${ut||c.e.ACCESS_TOKEN||""}`);const xt={event:this.type,created:new Date(d).toISOString()},Tt=_e?Object.assign(xt,_e):xt,kt={url:Sr(mt),headers:{"Content-Type":"text/plain"},body:JSON.stringify([Tt])};this.pendingRequest=c.p(kt,$t=>{this.pendingRequest=null,ot($t),this.saveEventData(),this.processRequests(ut)})}queueRequest(d,_e){this.queue.push(d),this.processRequests(_e)}}class Lr extends qr{constructor(d){super("metrics"),d&&(this.data=d)}postMetricsEvent(d){if(!c.e.EVENTS_URL||!d&&!c.e.ACCESS_TOKEN)return;this.anonId||this.fetchEventData(),c.v(this.anonId)||this.refreshUUID();const _e=Object.assign({},this.data,{sessionId:this.anonId});this.queueRequest({timestamp:Date.now(),payload:_e},d)}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:_e,payload:ot}=this.queue.shift();this.postEvent(_e,ot,()=>{},d)}}const _n=new class extends qr{constructor(st){super("appUserTurnstile"),this._customAccessToken=st}postTurnstileEvent(st,d){c.e.EVENTS_URL&&c.e.ACCESS_TOKEN&&Array.isArray(st)&&st.some(_e=>c.h(_e)||c.j(_e))&&this.queueRequest(Date.now(),d)}processRequests(st){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.anonIdTimestamp&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const d=gr(c.e.ACCESS_TOKEN),_e=d?d.u:c.e.ACCESS_TOKEN;let ot=_e!==this.eventData.tokenU;c.v(this.anonId)||(this.refreshUUID(),ot=!0);const ut=this.queue.shift();if(this.eventData.lastSuccess){const mt=new Date(this.eventData.lastSuccess),xt=new Date(ut),Tt=(ut-this.eventData.lastSuccess)/864e5;ot=ot||Tt>=1||Tt<-1||mt.getDate()!==xt.getDate()}else ot=!0;ot?this.postEvent(ut,{sdkIdentifier:"mapbox-gl-js",sdkVersion:dt,skuId:jr,"enabled.telemetry":!1,userId:this.anonId},mt=>{mt||(this.eventData.lastSuccess=ut,this.eventData.tokenU=_e)},st):this.processRequests()}},gn=_n.postTurnstileEvent.bind(_n),Sn=new class extends qr{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(st,d,_e,ot){this.skuToken=d,this.errorCb=ot,c.e.EVENTS_URL&&(_e||c.e.ACCESS_TOKEN?this.queueRequest({id:st,timestamp:Date.now()},_e):this.errorCb(new Error(Jr)))}processRequests(st){if(this.pendingRequest||this.queue.length===0)return;const{id:d,timestamp:_e}=this.queue.shift();d&&this.success[d]||(this.anonId&&this.anonIdTimestamp||this.fetchEventData(),c.v(this.anonId)||this.refreshUUID(),this.postEvent(_e,{sdkIdentifier:"mapbox-gl-js",sdkVersion:dt,skuId:jr,skuToken:this.skuToken,userId:this.anonId},ot=>{ot?this.errorCb(ot):d&&(this.success[d]=!0)},st))}remove(){this.errorCb=null}},Fs=Sn.postMapLoadEvent.bind(Sn),rs=new class extends qr{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(st){let d=this.mapInstanceIdMap.get(st);return d||(d=c.u(),this.mapInstanceIdMap.set(st,d)),d}getEventId(st){const d=this.eventIdPerMapInstanceMap.get(st)||0;return this.eventIdPerMapInstanceMap.set(st,d+1),d}postStyleLoadEvent(st,d){const{map:_e,style:ot,importedStyles:ut}=d;if(!c.e.EVENTS_URL||!st&&!c.e.ACCESS_TOKEN)return;const mt=this.getMapInstanceId(_e),xt={mapInstanceId:mt,eventId:this.getEventId(mt),style:ot};ut.length&&(xt.importedStyles=ut),this.queueRequest({timestamp:Date.now(),payload:xt},st)}processRequests(st){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:d,payload:_e}=this.queue.shift();this.postEvent(d,_e,()=>{},st)}},ms=rs.postStyleLoadEvent.bind(rs),On=new Lr({attributes:[{name:"maps/js/layer-animations/style-with-appearances"}]}),ws=On.postMetricsEvent.bind(On),Vs=new Lr({attributes:[{name:"maps/js/layer-animations/runtime-appearances"}]}),ks=Vs.postMetricsEvent.bind(Vs),lo=new class extends qr{constructor(){super("gljs.performance")}postPerformanceEvent(st,d){c.e.EVENTS_URL&&(st||c.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:d},st)}processRequests(st){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:d,performanceData:_e}=this.queue.shift(),ot=function(ut){const mt=performance.getEntriesByType("resource"),xt=performance.getEntriesByType("mark"),Tt=function(nr){const cr={};if(nr){for(const lr in nr)if(lr!=="other")for(const yr of nr[lr]){const xr=`${lr}ResolveRangeMin`,Ar=`${lr}ResolveRangeMax`,Dr=`${lr}RequestCount`,Tr=`${lr}RequestCachedCount`;cr[xr]=Math.min(cr[xr]||1/0,yr.startTime),cr[Ar]=Math.max(cr[Ar]||-1/0,yr.responseEnd);const Wr=zr=>{cr[zr]===void 0&&(cr[zr]=0),++cr[zr]};yr.transferSize!==void 0&&yr.transferSize===0&&Wr(Tr),Wr(Dr)}}return cr}(function(nr,cr){const lr={};if(nr)for(const yr of nr){const xr=cr(yr);lr[xr]===void 0&&(lr[xr]=[]),lr[xr].push(yr)}return lr}(mt,St)),kt=window.devicePixelRatio,$t=navigator.connection||navigator.mozConnection||navigator.webkitConnection,Xt=$t?$t.effectiveType:void 0,rr={counters:[],metadata:[],attributes:[]},tr=(nr,cr,lr)=>{lr!=null&&nr.push({name:cr,value:lr.toString()})};for(const nr in Tt)tr(rr.counters,nr,Tt[nr]);if(ut.interactionRange[0]!==1/0&&ut.interactionRange[1]!==-1/0&&(tr(rr.counters,"interactionRangeMin",ut.interactionRange[0]),tr(rr.counters,"interactionRangeMax",ut.interactionRange[1])),xt)for(const nr of Object.values(ht)){const cr=xt.find(lr=>lr.name===nr);cr&&tr(rr.counters,nr,cr.startTime)}return tr(rr.counters,"visibilityHidden",ut.visibilityHidden),tr(rr.attributes,"style",function(nr){if(nr)for(const cr of nr){const lr=cr.name.split("?")[0];if(c.i(lr)){const yr=lr.split("/").slice(-2);if(yr.length===2)return`mapbox://styles/${yr[0]}/${yr[1]}`}}}(mt)),tr(rr.attributes,"terrainEnabled",ut.terrainEnabled?"true":"false"),tr(rr.attributes,"fogEnabled",ut.fogEnabled?"true":"false"),tr(rr.attributes,"projection",ut.projection),tr(rr.attributes,"zoom",ut.zoom),tr(rr.metadata,"devicePixelRatio",kt),tr(rr.metadata,"connectionEffectiveType",Xt),tr(rr.metadata,"navigatorUserAgent",navigator.userAgent),tr(rr.metadata,"screenWidth",window.screen.width),tr(rr.metadata,"screenHeight",window.screen.height),tr(rr.metadata,"windowWidth",window.innerWidth),tr(rr.metadata,"windowHeight",window.innerHeight),tr(rr.metadata,"mapWidth",ut.width/kt),tr(rr.metadata,"mapHeight",ut.height/kt),tr(rr.metadata,"webglRenderer",ut.renderer),tr(rr.metadata,"webglVendor",ut.vendor),tr(rr.metadata,"sdkVersion",dt),tr(rr.metadata,"sdkIdentifier","mapbox-gl-js"),rr}(_e);for(const ut of ot.metadata);for(const ut of ot.counters);for(const ut of ot.attributes);this.postEvent(d,ot,()=>{},st)}},ys=lo.postPerformanceEvent.bind(lo),dn=new class extends qr{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(st,d,_e,ot){if(!c.e.API_URL||!c.e.SESSION_PATH)return;const ut=Cr(c.e.API_URL+c.e.SESSION_PATH);ut.params.push(`sku=${d||""}`),ut.params.push(`access_token=${ot||c.e.ACCESS_TOKEN||""}`);const mt={url:Sr(ut),headers:{"Content-Type":"text/plain"}};this.pendingRequest=c.g(mt,xt=>{this.pendingRequest=null,_e(xt),this.saveEventData(),this.processRequests(ot)})}getSessionAPI(st,d,_e,ot){this.skuToken=d,this.errorCb=ot,c.e.SESSION_PATH&&c.e.API_URL&&(_e||c.e.ACCESS_TOKEN?this.queueRequest({id:st,timestamp:Date.now()},_e):this.errorCb(new Error(Jr)))}processRequests(st){if(this.pendingRequest||this.queue.length===0)return;const{id:d,timestamp:_e}=this.queue.shift();d&&this.success[d]||this.getSession(_e,this.skuToken,ot=>{ot?this.errorCb(ot):d&&(this.success[d]=!0)},st)}remove(){this.errorCb=null}},Es=dn.getSessionAPI.bind(dn),po=new Set;function no(st,d){d?po.add(st):po.delete(st)}class tn{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(d,_e){this._updatedSourceCaches[d]=_e,this.setDirty()}discardSourceCacheUpdate(d){delete this._updatedSourceCaches[d]}updateLayer(d){const _e=d.scope;this._updatedLayers[_e]=this._updatedLayers[_e]||new Set,this._updatedLayers[_e].add(d.id),this.setDirty()}removeLayer(d){const _e=d.scope;this._removedLayers[_e]=this._removedLayers[_e]||{},this._updatedLayers[_e]=this._updatedLayers[_e]||new Set,this._removedLayers[_e][d.id]=d,this._updatedLayers[_e].delete(d.id),this._updatedPaintProps.delete(d.fqid),this.setDirty()}getRemovedLayer(d){return this._removedLayers[d.scope]?this._removedLayers[d.scope][d.id]:null}discardLayerRemoval(d){this._removedLayers[d.scope]&&delete this._removedLayers[d.scope][d.id]}getLayerUpdatesByScope(){const d={};for(const _e in this._updatedLayers)d[_e]=d[_e]||{},d[_e].updatedIds=Array.from(this._updatedLayers[_e].values());for(const _e in this._removedLayers)d[_e]=d[_e]||{},d[_e].removedIds=Object.keys(this._removedLayers[_e]);return d}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(d){this._updatedPaintProps.add(d.fqid),this.setDirty()}getUpdatedImages(d){return this._updatedImages[d]?Array.from(this._updatedImages[d].values()):[]}updateImage(d,_e){this._updatedImages[_e]=this._updatedImages[_e]||new Set,this._updatedImages[_e].add(c.I.toString(d)),this.setDirty()}resetUpdatedImages(d){this._updatedImages[d]&&this._updatedImages[d].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function us(st){const{userImage:d}=st;return!!(d&&d.render&&d.render())&&(st.data.replace(new Uint8Array(d.data.buffer)),!0)}class Co extends c.E{constructor(d){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=d,d!=="raster"&&c.r()&&(this.imageRasterizerDispatcher=new c.D(c.t(),this,"Image Rasterizer Worker",1))}addScope(d){this.loaded.set(d,!1),this.imageProviders.set(d,new Map),this.images.set(d,new Map),this.updatedImages.set(d,new Set),this.callbackDispatchedThisFrame.set(d,new Set),this.patterns.set(d,new Map),this.atlasImage.set(d,new c.q({width:1,height:1}))}removeScope(d){this.loaded.delete(d),this.imageProviders.delete(d),this.images.delete(d),this.updatedImages.delete(d),this.callbackDispatchedThisFrame.delete(d),this.patterns.delete(d),this.atlasImage.delete(d);const _e=this.atlasTexture.get(d);_e&&(_e.destroy(),this.atlasTexture.delete(d))}addImageProvider(d,_e){this.imageProviders.has(_e)||this.imageProviders.set(_e,new Map),this.imageProviders.get(_e).set(d.id,d)}removeImageProvider(d,_e){this.imageProviders.has(_e)&&this.imageProviders.get(_e).delete(d)}getPendingImageProviders(){const d=[];for(const _e of this.imageProviders.values())for(const ot of _e.values())ot.hasPendingRequests()&&d.push(ot);return d}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new c.x),this._imageRasterizer}isLoaded(){for(const d of this.loaded.keys())if(!this.loaded.get(d))return!1;return!0}setLoaded(d,_e){if(this.loaded.get(_e)!==d&&(this.loaded.set(_e,d),d)){for(const{ids:ot,callback:ut}of this.requestors)this._notify(ot,_e,ut);this.requestors=[]}}hasImage(d,_e){return!!this.getImage(d,_e)}getImage(d,_e){return this.images.get(_e).get(d.toString())}addImage(d,_e,ot){this._validate(d,ot)&&this.images.get(_e).set(d.toString(),ot)}_validate(d,_e){let ot=!0;return this._validateStretch(_e.stretchX,_e.data&&_e.data.width)||(this.fire(new c.y(new Error(`Image "${d.name}" has invalid "stretchX" value`))),ot=!1),this._validateStretch(_e.stretchY,_e.data&&_e.data.height)||(this.fire(new c.y(new Error(`Image "${d.name}" has invalid "stretchY" value`))),ot=!1),this._validateContent(_e.content,_e)||(this.fire(new c.y(new Error(`Image "${d.name}" has invalid "content" value`))),ot=!1),ot}_validateStretch(d,_e){if(!d)return!0;let ot=0;for(const ut of d){if(ut[0]<ot||ut[1]<ut[0]||_e<ut[1])return!1;ot=ut[1]}return!0}_validateContent(d,_e){return d?d.length!==4||!_e.usvg&&(d[0]<0||_e.data.width<d[0]||d[1]<0||_e.data.height<d[1]||d[2]<0||_e.data.width<d[2]||d[3]<0||_e.data.height<d[3])?!1:!(d[2]<d[0]||d[3]<d[1]):!0}updateImage(d,_e,ot){const ut=this.images.get(_e).get(d.toString());ot.version=ut.version+1,this.images.get(_e).set(d.toString(),ot),this.updatedImages.get(_e).add(d),this.removeFromImageRasterizerCache(d,_e)}clearUpdatedImages(d){this.updatedImages.get(d).clear()}removeFromImageRasterizerCache(d,_e){this.spriteFormat!=="raster"&&(c.r()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[d],scope:_e}):this.imageRasterizer.removeImagesFromCacheByIds([d],_e))}removeImage(d,_e){const ot=this.images.get(_e),ut=ot.get(d.toString());ot.delete(d.toString()),this.patterns.get(_e).delete(d.toString()),this.removeFromImageRasterizerCache(d,_e),ut.userImage&&ut.userImage.onRemove&&ut.userImage.onRemove()}listImages(d){return Array.from(this.images.get(d).keys()).map(_e=>c.I.from(_e))}getImages(d,_e,ot){const ut=[],mt=[],xt=this.imageProviders.get(_e);for(const Xt of d){if(!Xt.iconsetId){ut.push(Xt);continue}const rr=xt.get(Xt.iconsetId);rr&&(this.getImage(Xt,_e)?mt.push(Xt):rr.addPendingRequest(Xt))}if(ut.length===0)return void this._notify(mt,_e,ot);let Tt=!0;const kt=!!this.loaded.get(_e),$t=this.images.get(_e);if(!kt)for(const Xt of ut)$t.has(Xt.toString())||(Tt=!1);kt||Tt?this._notify(ut,_e,ot):this.requestors.push({ids:ut,scope:_e,callback:ot})}rasterizeImages(d,_e){const ot=new Map,{tasks:ut,scope:mt}=d;for(const[xt,Tt]of ut.entries()){const kt=this.getImage(Tt.id,mt);kt&&ot.set(xt,{image:kt,imageVariant:Tt})}this._rasterizeImages(mt,ot,_e)}_rasterizeImages(d,_e,ot){if(c.r())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:_e,scope:d},ot);else{const ut=new Map;for(const[mt,{image:xt,imageVariant:Tt}]of _e.entries())ut.set(mt,this.imageRasterizer.rasterize(Tt,xt,d,0));ot(void 0,ut)}}getUpdatedImages(d){return this.updatedImages.get(d)||new Set}_notify(d,_e,ot){const ut=this.images.get(_e),mt=new Map;for(const xt of d){if(!ut.get(xt.toString())){if(xt.iconsetId)continue;this.fire(new c.z("styleimagemissing",{id:xt.name}))}const Tt=ut.get(xt.toString());if(!Tt){c.w(`Image "${xt.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const kt={data:Tt.usvg?null:Tt.data.clone(),pixelRatio:Tt.pixelRatio,sdf:Tt.sdf,usvg:Tt.usvg,version:Tt.version,stretchX:Tt.stretchX,stretchY:Tt.stretchY,content:Tt.content,hasRenderCallback:!!(Tt.userImage&&Tt.userImage.render)};Tt.usvg&&Object.assign(kt,{width:Tt.icon.usvg_tree.width,height:Tt.icon.usvg_tree.height}),mt.set(c.I.toString(xt),kt)}ot(null,mt)}getPixelSize(d){const{width:_e,height:ot}=this.atlasImage.get(d);return{width:_e,height:ot}}getPattern(d,_e,ot){const ut=d.toString(),mt=this.patterns.get(_e),xt=mt.get(ut),Tt=this.getImage(d,_e);if(!Tt)return null;if(xt){if(xt.position.version===Tt.version)return xt.position;xt.position.version=Tt.version}else{if(Tt.usvg&&!Tt.data){const kt=this.getPatternInFlightId(ut,_e);if(this.patternsInFlight.has(kt))return null;this.patternsInFlight.add(kt);const $t=new c.A(d).scaleSelf(c.o.devicePixelRatio),Xt=new Map([[$t.toString(),{image:Tt,imageVariant:$t}]]);return this._rasterizeImages(_e,Xt,(rr,tr)=>this.storePatternImage($t,_e,Tt,ot,tr)),null}this.storePattern(d,_e,Tt)}return this._updatePatternAtlas(_e,ot),mt.get(ut).position}getPatternInFlightId(d,_e){return c.B(d,_e)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(d,_e,ot,ut,mt){const xt=d.toString(),Tt=mt?mt.get(xt):void 0;Tt&&(ot.data=Tt,this.storePattern(d.id,_e,ot),this._updatePatternAtlas(_e,ut),this.patternsInFlight.delete(this.getPatternInFlightId(d.id.toString(),_e)))}storePattern(d,_e,ot){const ut={w:ot.data.width+2*c.C,h:ot.data.height+2*c.C,x:0,y:0},mt=new c.F(ut,ot,c.C);this.patterns.get(_e).set(d.toString(),{bin:ut,position:mt})}destroyAtlasTextures(){for(const d of this.atlasTexture.values())d&&d.destroy();this.atlasTexture.clear()}bind(d,_e){const ot=d.gl;let ut=this.atlasTexture.get(_e);ut?this.dirty&&(ut.update(this.atlasImage.get(_e)),this.dirty=!1):(ut=new c.T(d,this.atlasImage.get(_e),ot.RGBA8),this.atlasTexture.set(_e,ut)),ut.bind(ot.LINEAR,ot.CLAMP_TO_EDGE)}_updatePatternAtlas(d,_e){const ot=this.patterns.get(d),ut=Array.from(ot.values()).map(({bin:$t})=>$t),{w:mt,h:xt}=c.G(ut),Tt=this.atlasImage.get(d);Tt.resize({width:mt||1,height:xt||1});const kt=this.images.get(d);for(const[$t,{bin:Xt,position:rr}]of ot.entries()){let tr=rr.padding;const nr=Xt.x+tr,cr=Xt.y+tr,lr=kt.get($t).data,yr=lr.width,xr=lr.height;tr=tr>1?tr-1:tr,c.q.copy(lr,Tt,{x:0,y:0},{x:nr,y:cr},{width:yr,height:xr},_e),c.q.copy(lr,Tt,{x:0,y:xr-tr},{x:nr,y:cr-tr},{width:yr,height:tr},_e),c.q.copy(lr,Tt,{x:0,y:0},{x:nr,y:cr+xr},{width:yr,height:tr},_e),c.q.copy(lr,Tt,{x:yr-tr,y:0},{x:nr-tr,y:cr},{width:tr,height:xr},_e),c.q.copy(lr,Tt,{x:0,y:0},{x:nr+yr,y:cr},{width:tr,height:xr},_e),c.q.copy(lr,Tt,{x:yr-tr,y:xr-tr},{x:nr-tr,y:cr-tr},{width:tr,height:tr},_e),c.q.copy(lr,Tt,{x:0,y:xr-tr},{x:nr+yr,y:cr-tr},{width:tr,height:tr},_e),c.q.copy(lr,Tt,{x:0,y:0},{x:nr+yr,y:cr+xr},{width:tr,height:tr},_e),c.q.copy(lr,Tt,{x:yr-tr,y:0},{x:nr-tr,y:cr+xr},{width:tr,height:tr},_e)}this.dirty=!0}beginFrame(){for(const d of this.images.keys())this.callbackDispatchedThisFrame.set(d,new Set)}dispatchRenderCallbacks(d,_e){const ot=this.images.get(_e);for(const ut of d){if(this.callbackDispatchedThisFrame.get(_e).has(ut.toString()))continue;this.callbackDispatchedThisFrame.get(_e).add(ut.toString());const mt=ot.get(ut.toString());us(mt)&&this.updateImage(ut,_e,mt)}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove()}}function Ss(st){const d=st.value,_e=st.valueSpec,ot=st.style,ut=st.styleSpec,mt=st.key,xt=st.arrayElementValidator||Oo;if(!Array.isArray(d))return[new c.V(mt,d,`array expected, ${c.K(d)} found`)];if(_e.length&&d.length!==_e.length)return[new c.V(mt,d,`array length ${_e.length} expected, length ${d.length} found`)];if(_e["min-length"]&&d.length<_e["min-length"])return[new c.V(mt,d,`array length at least ${_e["min-length"]} expected, length ${d.length} found`)];let Tt={type:_e.value,values:_e.values,minimum:_e.minimum,maximum:_e.maximum,function:void 0};ut.$version<7&&(Tt.function=_e.function),c.H(_e.value)&&(Tt=_e.value);let kt=[];for(let $t=0;$t<d.length;$t++)kt=kt.concat(xt({array:d,arrayIndex:$t,value:d[$t],valueSpec:Tt,style:ot,styleSpec:ut,key:`${mt}[${$t}]`},!0));return kt}function Ul(st){const d=st.key,_e=st.value,ot=st.valueSpec;if(!c.L(_e))return[new c.V(d,_e,`number expected, ${c.K(_e)} found`)];if(_e!=_e)return[new c.V(d,_e,"number expected, NaN found")];if("minimum"in ot){let ut=ot.minimum;if(Array.isArray(ot.minimum)&&(ut=ot.minimum[st.arrayIndex]),_e<ut)return[new c.V(d,_e,`${_e} is less than the minimum value ${ut}`)]}if("maximum"in ot){let ut=ot.maximum;if(Array.isArray(ot.maximum)&&(ut=ot.maximum[st.arrayIndex]),_e>ut)return[new c.V(d,_e,`${_e} is greater than the maximum value ${ut}`)]}return[]}function Tl(st){const d=st.key,_e=st.value;if(!c.H(_e))return[new c.V(d,_e,`object expected, ${c.K(_e)} found`)];const ot=st.valueSpec,ut=c.J(_e.type);let mt,xt,Tt,kt={};const $t=ut!=="categorical"&&_e.property===void 0,Xt=!$t,rr=function(lr){const yr=lr.stops;return Array.isArray(yr)&&Array.isArray(yr[0])&&c.H(yr[0][0])}(_e),tr=Tu({key:st.key,value:st.value,valueSpec:st.styleSpec.function,style:st.style,styleSpec:st.styleSpec,objectElementValidators:{stops:function(lr){if(ut==="identity")return[new c.V(lr.key,lr.value,'identity function may not have a "stops" property')];let yr=[];const xr=lr.value;return yr=yr.concat(Ss({key:lr.key,value:xr,valueSpec:lr.valueSpec,style:lr.style,styleSpec:lr.styleSpec,arrayElementValidator:nr})),Array.isArray(xr)&&xr.length===0&&yr.push(new c.V(lr.key,xr,"array must have at least one stop")),yr},default:function(lr){return Oo({key:lr.key,value:lr.value,valueSpec:ot,style:lr.style,styleSpec:lr.styleSpec})}}});return ut==="identity"&&$t&&tr.push(new c.V(st.key,st.value,'missing required property "property"')),ut==="identity"||_e.stops||tr.push(new c.V(st.key,st.value,'missing required property "stops"')),ut==="exponential"&&ot.expression&&!c.M(ot)&&tr.push(new c.V(st.key,st.value,"exponential functions not supported")),st.styleSpec.$version>=8&&(Xt&&!c.N(ot)?tr.push(new c.V(st.key,st.value,"property functions not supported")):$t&&!c.O(ot)&&tr.push(new c.V(st.key,st.value,"zoom functions not supported"))),ut!=="categorical"&&!rr||_e.property!==void 0||tr.push(new c.V(st.key,st.value,'"property" property is required')),tr;function nr(lr){let yr=[];const xr=lr.value,Ar=lr.key;if(!Array.isArray(xr))return[new c.V(Ar,xr,`array expected, ${c.K(xr)} found`)];if(xr.length!==2)return[new c.V(Ar,xr,`array length 2 expected, length ${xr.length} found`)];if(rr){if(!c.H(xr[0]))return[new c.V(Ar,xr,`object expected, ${c.K(xr[0])} found`)];const Dr=xr[0];if(Dr.zoom===void 0)return[new c.V(Ar,xr,"object stop key must have zoom")];if(Dr.value===void 0)return[new c.V(Ar,xr,"object stop key must have value")];const Tr=c.J(Dr.zoom);if(typeof Tr!="number")return[new c.V(Ar,Dr.zoom,"stop zoom values must be numbers")];if(Tt&&Tt>Tr)return[new c.V(Ar,Dr.zoom,"stop zoom values must appear in ascending order")];Tr!==Tt&&(Tt=Tr,xt=void 0,kt={}),yr=yr.concat(Tu({key:`${Ar}[0]`,value:xr[0],valueSpec:{zoom:{}},style:lr.style,styleSpec:lr.styleSpec,objectElementValidators:{zoom:Ul,value:cr}}))}else yr=yr.concat(cr({key:`${Ar}[0]`,value:xr[0],style:lr.style,styleSpec:lr.styleSpec},xr));return c.Q(c.S(xr[1]))?yr.concat([new c.V(`${Ar}[1]`,xr[1],"expressions are not allowed in function stops.")]):yr.concat(Oo({key:`${Ar}[1]`,value:xr[1],valueSpec:ot,style:lr.style,styleSpec:lr.styleSpec}))}function cr(lr,yr){const xr=c.K(lr.value),Ar=c.J(lr.value),Dr=lr.value!==null?lr.value:yr;if(mt){if(xr!==mt)return[new c.V(lr.key,Dr,`${xr} stop domain type must match previous stop domain type ${mt}`)]}else mt=xr;if(xr!=="number"&&xr!=="string"&&xr!=="boolean"&&typeof Ar!="number"&&typeof Ar!="string"&&typeof Ar!="boolean")return[new c.V(lr.key,Dr,"stop domain value must be a number, string, or boolean")];if(xr!=="number"&&ut!=="categorical"){let Tr=`number expected, ${xr} found`;return c.N(ot)&&ut===void 0&&(Tr+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new c.V(lr.key,Dr,Tr)]}return ut!=="categorical"||xr!=="number"||typeof Ar=="number"&&isFinite(Ar)&&Math.floor(Ar)===Ar?ut!=="categorical"&&xr==="number"&&typeof Ar=="number"&&typeof xt=="number"&&xt!==void 0&&Ar<xt?[new c.V(lr.key,Dr,"stop domain values must appear in ascending order")]:(xt=Ar,ut==="categorical"&&Ar in kt?[new c.V(lr.key,Dr,"stop domain values must be unique")]:(kt[Ar]=!0,[])):[new c.V(lr.key,Dr,`integer expected, found ${String(Ar)}`)]}}function ga(st){const d=(st.expressionContext==="property"?c.W:c.U)(c.S(st.value),st.valueSpec);if(d.result==="error")return d.value.map(ot=>new c.V(`${st.key}${ot.key}`,st.value,ot.message));const _e=d.value.expression||d.value._styleExpression.expression;if(st.expressionContext==="property"&&st.propertyKey==="text-font"&&!_e.outputDefined())return[new c.V(st.key,st.value,`Invalid data expression for "${st.propertyKey}". Output values must be contained as literals within the expression.`)];if(st.expressionContext==="property"&&st.propertyType==="layout"&&!c.Z(_e))return[new c.V(st.key,st.value,'"feature-state" data expressions are not supported with layout properties.')];if(st.expressionContext==="filter")return ds(_e,st);if(st.expressionContext==="appearance")return Mn(_e,st);if(st.expressionContext&&st.expressionContext.indexOf("cluster")===0){if(!c.X(_e,["zoom","feature-state"]))return[new c.V(st.key,st.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(st.expressionContext==="cluster-initial"&&!c.Y(_e))return[new c.V(st.key,st.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ds(st,d){const _e=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(d.valueSpec&&d.valueSpec.expression)for(const ut of d.valueSpec.expression.parameters)_e.delete(ut);if(_e.size===0)return[];const ot=[];return st instanceof c._&&_e.has(st.name)?[new c.V(d.key,d.value,`["${st.name}"] expression is not supported in a filter for a ${d.object.type} layer with id: ${d.object.id}`)]:(st.eachChild(ut=>{ot.push(...ds(ut,d))}),ot)}function Mn(st,d){const _e=new Set;if(d.valueSpec&&d.valueSpec.expression)for(const ut of d.valueSpec.expression.parameters)_e.add(ut);if(_e.size===0)return[];const ot=[];return st instanceof c._&&!_e.has(st.name)?[new c.V(d.key,d.value,`["${st.name}"] is not an allowed parameter`)]:(st.eachChild(ut=>{ot.push(...Mn(ut,d))}),ot)}function Cs(st){const d=st.key,_e=st.value,ot=st.valueSpec,ut=[];return Array.isArray(ot.values)?ot.values.indexOf(c.J(_e))===-1&&ut.push(new c.V(d,_e,`expected one of [${ot.values.join(", ")}], ${JSON.stringify(_e)} found`)):Object.keys(ot.values).indexOf(c.J(_e))===-1&&ut.push(new c.V(d,_e,`expected one of [${Object.keys(ot.values).join(", ")}], ${JSON.stringify(_e)} found`)),ut}function Ds(st){return c.a2(c.S(st.value))?ga(Object.assign({},st,{expressionContext:"filter",valueSpec:st.styleSpec[`filter_${st.layerType||"fill"}`]})):ao(st)}function ao(st){const d=st.value,_e=st.key;if(!Array.isArray(d))return[new c.V(_e,d,`array expected, ${c.K(d)} found`)];if(d.length<1)return[new c.V(_e,d,"filter array must have at least 1 element")];const ot=st.styleSpec;let ut=Cs({key:`${_e}[0]`,value:d[0],valueSpec:ot.filter_operator});const mt=()=>{d.length>=2&&(c.a0(d[1])||ut.push(new c.V(`${_e}[1]`,d[1],`string expected, ${c.K(d[1])} found`)));for(let xt=2;xt<d.length;xt++)c.J(d[1])==="$type"?ut=ut.concat(Cs({key:`${_e}[${xt}]`,value:d[xt],valueSpec:ot.geometry_type})):c.a0(d[xt])||c.L(d[xt])||c.$(d[xt])||ut.push(new c.V(`${_e}[${xt}]`,d[xt],`string, number, or boolean expected, ${c.K(d[xt])} found.`))};switch(c.J(d[0])){case"<":case"<=":case">":case">=":d.length>=2&&c.J(d[1])==="$type"&&ut.push(new c.V(_e,d,`"$type" cannot be use with operator "${d[0]}"`)),d.length!==3&&ut.push(new c.V(_e,d,`filter array for operator "${d[0]}" must have 3 elements`)),mt();break;case"==":case"!=":d.length!==3&&ut.push(new c.V(_e,d,`filter array for operator "${d[0]}" must have 3 elements`)),mt();break;case"in":case"!in":mt();break;case"any":case"all":case"none":for(let xt=1;xt<d.length;xt++)ut=ut.concat(ao({key:`${_e}[${xt}]`,value:d[xt],style:st.style,styleSpec:st.styleSpec}));break;case"has":case"!has":d.length!==2?ut.push(new c.V(_e,d,`filter array for "${d[0]}" operator must have 2 elements`)):c.a0(d[1])||ut.push(new c.V(`${_e}[1]`,d[1],`string expected, ${c.K(d[1])} found`))}return ut}function Wo(st,d){const _e=st.key,ot=st.style,ut=st.layer,mt=st.styleSpec,xt=st.value,Tt=st.objectKey,kt=mt[`${d}_${st.layerType}`];if(!kt)return[];const $t=Tt.match(/^(.*)-use-theme$/);if($t&&kt[$t[1]])return c.Q(c.S(xt))?[].concat(Oo({key:_e,value:xt,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:ot,styleSpec:mt,expressionContext:"property",propertyType:d,propertyKey:Tt})):Oo({key:_e,value:xt,valueSpec:{type:"string"},style:ot,styleSpec:mt});const Xt=Tt.match(/^(.*)-transition$/);if(d==="paint"&&Xt&&kt[Xt[1]]&&kt[Xt[1]].transition)return Oo({key:_e,value:xt,valueSpec:mt.transition,style:ot,styleSpec:mt});const rr=st.valueSpec||kt[Tt];if(!rr)return[new c.a3(_e,xt,`unknown property "${Tt}"`)];let tr;if(c.a0(xt)&&c.N(rr)&&!rr.tokens&&(tr=/^{([^}]+)}$/.exec(xt))){const cr=`\`{ "type": "identity", "property": ${tr?JSON.stringify(tr[1]):'"_"'} }\``;return[new c.V(_e,xt,`"${Tt}" does not support interpolation syntax
Use an identity property function instead: ${cr}.`)]}const nr=[];if(st.layerType==="symbol")Tt!=="text-field"||!ot||ot.glyphs||ot.imports||nr.push(new c.V(_e,xt,'use of "text-field" requires a style "glyphs" property')),Tt==="text-font"&&c.a4(c.S(xt))&&c.J(xt.type)==="identity"&&nr.push(new c.V(_e,xt,'"text-font" does not support identity functions'));else if(st.layerType==="model"&&d==="paint"&&ut&&ut.layout&&ut.layout.hasOwnProperty("model-id")&&c.N(rr)&&(c.a5(rr)||c.O(rr))){const cr=c.W(c.S(xt),rr).value,lr="expression"in cr&&cr.expression||"_styleExpression"in cr&&cr._styleExpression&&cr._styleExpression.expression;lr&&!c.X(lr,["measure-light"])&&(Tt==="model-emissive-strength"&&c.Y(lr)&&c.Z(lr)||nr.push(new c.V(_e,xt,`${Tt} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return nr.concat(Oo({key:st.key,value:xt,valueSpec:rr,style:ot,styleSpec:mt,expressionContext:"property",propertyType:d,propertyKey:Tt}))}function Gl(st){return Wo(st,"paint")}function fs(st){return Wo(st,"layout")}function ps(st){let d=[];const _e=st.value,ot=st.key,ut=st.style,mt=st.styleSpec;if(!c.H(_e))return[new c.V(ot,_e,"object expected")];_e.type||_e.ref||d.push(new c.V(ot,_e,'either "type" or "ref" is required'));let xt=c.J(_e.type);const Tt=c.J(_e.ref);if(_e.id){const kt=c.J(_e.id);for(let $t=0;$t<st.arrayIndex;$t++){const Xt=ut.layers[$t];c.J(Xt.id)===kt&&d.push(new c.V(ot,_e.id,`duplicate layer id "${kt}", previously used at line ${Xt.id.__line__}`))}}if("ref"in _e){let kt;["type","source","source-layer","filter","layout"].forEach($t=>{$t in _e&&d.push(new c.V(ot,_e[$t],`"${$t}" is prohibited for ref layers`))}),ut.layers.forEach($t=>{c.J($t.id)===Tt&&(kt=$t)}),kt?kt.ref?d.push(new c.V(ot,_e.ref,"ref cannot reference another ref layer")):xt=c.J(kt.type):typeof Tt=="string"&&d.push(new c.V(ot,_e.ref,`ref layer "${Tt}" not found`))}else if(xt!=="background"&&xt!=="sky"&&xt!=="slot")if(_e.source)if(c.a0(_e.source)){const kt=ut.sources&&ut.sources[_e.source],$t=kt&&c.J(kt.type);kt?$t==="vector"&&xt==="raster"?d.push(new c.V(ot,_e.source,`layer "${_e.id}" requires a raster source`)):$t==="raster"&&xt!=="raster"?d.push(new c.V(ot,_e.source,`layer "${_e.id}" requires a vector source`)):$t!=="vector"||_e["source-layer"]?$t==="raster-dem"&&xt!=="hillshade"?d.push(new c.V(ot,_e.source,"raster-dem source can only be used with layer type 'hillshade'.")):$t!=="raster-array"||["raster","raster-particle"].includes(xt)?xt==="line"&&_e.paint&&(_e.paint["line-gradient"]||_e.paint["line-trim-offset"])&&$t==="geojson"&&!kt.lineMetrics?d.push(new c.V(ot,_e,`layer "${_e.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):xt==="raster-particle"&&$t!=="raster-array"&&d.push(new c.V(ot,_e.source,`layer "${_e.id}" requires a 'raster-array' source.`)):d.push(new c.V(ot,_e.source,"raster-array source can only be used with layer type 'raster'.")):d.push(new c.V(ot,_e,`layer "${_e.id}" must specify a "source-layer"`)):d.push(new c.V(ot,_e.source,`source "${_e.source}" not found`))}else d.push(new c.V(`${ot}.source`,_e.source,'"source" must be a string'));else d.push(new c.V(ot,_e,'missing required property "source"'));return d=d.concat(Tu({key:ot,value:_e,valueSpec:mt.layer,style:st.style,styleSpec:st.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Oo({key:`${ot}.type`,value:_e.type,valueSpec:mt.layer.type,style:st.style,styleSpec:st.styleSpec,object:_e,objectKey:"type"}),filter:kt=>Ds(Object.assign({layerType:xt},kt)),layout:kt=>Tu({layer:_e,key:kt.key,value:kt.value,valueSpec:{},style:kt.style,styleSpec:kt.styleSpec,objectElementValidators:{"*":$t=>fs(Object.assign({layerType:xt},$t))}}),paint:kt=>Tu({layer:_e,key:kt.key,value:kt.value,valueSpec:{},style:kt.style,styleSpec:kt.styleSpec,objectElementValidators:{"*":$t=>Gl(Object.assign({layerType:xt,layer:_e},$t))}}),appearances(kt){const $t=Ss({key:kt.key,value:kt.value,valueSpec:kt.valueSpec,style:kt.style,styleSpec:kt.styleSpec,arrayElementValidator:tr=>function(nr){const{key:cr,layer:lr,layerType:yr}=nr,xr=c.J(nr.value),Ar=c.J(xr.name),Dr=c.J(xr.condition),Tr=Tu({key:cr,value:xr,valueSpec:nr.styleSpec.appearance,style:nr.style,styleSpec:nr.styleSpec,objectElementValidators:{condition:Wr=>function(zr){const $r=[];return $r.push(...ga({key:zr.key,value:zr.object.condition,valueSpec:c.a6.appearance.condition,expressionContext:"appearance"})),$r}(Object.assign({layer:lr,layerType:yr},Wr)),properties:Wr=>function(zr){const $r=[],{styleSpec:Or,layer:Br,layerType:Xr}=zr,an=Or[`paint_${Xr}`],sn=Or[`layout_${Xr}`],wn=zr.object[zr.objectKey];for(const Cn in wn){const Nn=Cn in an?"paint":Cn in sn?"layout":void 0;if(!Nn){$r.push(new c.V(zr.key,Cn,`unknown property "${Cn}" for layer type "${Xr}"`));continue}const Jn=Object.assign({},zr,{key:`${zr.key}.${Cn}`,object:wn,objectKey:Cn,layer:Br,layerType:Xr,value:wn[Cn],valueSpec:Nn==="paint"?an[Cn]:sn[Cn]});$r.push(...Wo(Jn,Nn))}return $r}(Object.assign({layer:lr,layerType:yr},Wr))}});return Ar!=="hidden"&&Dr===void 0&&Tr.push(new c.V(nr.key,"name",'Appearance with name different than "hidden" must have a condition')),Tr}(Object.assign({layerType:xt,layer:_e},tr))}),Xt=Array.isArray(kt.value)?kt.value:[],rr=new Set;return Xt.forEach((tr,nr)=>{const cr=c.J(tr.name);if(cr)if(rr.has(cr)){const lr=c.J(_e.id);$t.push(new c.V(kt.key,cr,`Duplicated appearance name "${cr}" for layer "${lr}"`))}else rr.add(cr)}),$t}}})),d}function qn({key:st,value:d}){return c.a0(d)?[]:[new c.V(st,d,`string expected, ${c.K(d)} found`)]}const qs={promoteId:function st({key:d,value:_e}){if(c.a0(_e))return qn({key:d,value:_e});if(Array.isArray(_e)){const ut=[],mt=c.S(_e),xt=c.U(mt);return xt.result==="error"&&xt.value.forEach(Tt=>{ut.push(new c.V(`${d}${Tt.key}`,null,`${Tt.message}`))}),c.X(xt.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||ut.push(new c.V(`${d}`,null,"promoteId expression should be only feature dependent")),ut}if(!c.H(_e))return[new c.V(d,_e,`string, expression or object expected, "${c.K(_e)}" found`)];const ot=[];for(const ut in _e)ot.push(...st({key:`${d}.${ut}`,value:_e[ut]}));return ot}};function Gs(st){const d=st.value,_e=st.key,ot=st.styleSpec,ut=st.style;if(!c.H(d))return[new c.V(_e,d,`object expected, ${c.K(d)} found`)];if(!("type"in d))return[new c.V(_e,d,'"type" is required')];const mt=c.J(d.type);let xt=[];switch(["vector","raster","raster-dem","raster-array"].includes(mt)&&("url"in d||"tiles"in d||xt.push(new c.a3(_e,d,'Either "url" or "tiles" is required.'))),mt){case"vector":case"raster":case"raster-dem":case"raster-array":return xt=xt.concat(Tu({key:_e,value:d,valueSpec:ot[`source_${mt.replace("-","_")}`],style:st.style,styleSpec:ot,objectElementValidators:qs})),xt;case"geojson":if(xt=Tu({key:_e,value:d,valueSpec:ot.source_geojson,style:ut,styleSpec:ot,objectElementValidators:qs}),"cluster"in d&&"clusterProperties"in d){if(!c.H(d.clusterProperties))return[new c.V(`${_e}.clusterProperties`,d,`object expected, ${c.K(d)} found`)];for(const Tt in d.clusterProperties){const kt=d.clusterProperties[Tt];if(!Array.isArray(kt))return[new c.V(`${_e}.clusterProperties.${Tt}`,kt,"array expected")];const[$t,Xt]=kt,rr=typeof $t=="string"?[$t,["accumulated"],["get",Tt]]:$t;xt.push(...ga({key:`${_e}.${Tt}.map`,value:Xt,expressionContext:"cluster-map"})),xt.push(...ga({key:`${_e}.${Tt}.reduce`,value:rr,expressionContext:"cluster-reduce"}))}}return xt;case"video":return Tu({key:_e,value:d,valueSpec:ot.source_video,style:ut,styleSpec:ot});case"image":return Tu({key:_e,value:d,valueSpec:ot.source_image,style:ut,styleSpec:ot});case"canvas":return[new c.V(_e,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Cs({key:`${_e}.type`,value:d.type,valueSpec:{values:Eo(ot)}})}}function Eo(st){return st.source.reduce((d,_e)=>{const ot=st[_e];return ot.type.type==="enum"&&(d=d.concat(Object.keys(ot.type.values||{}))),d},[])}function Kl(st){const d=st.value,_e=st.styleSpec,ot=_e.light,ut=st.style;if(d===void 0)return[];if(!c.H(d))return[new c.V("light",d,`object expected, ${c.K(d)} found`)];let mt=[];for(const xt in d){const Tt=xt.match(/^(.*)-transition$/),kt=xt.match(/^(.*)-use-theme$/);mt=mt.concat(kt&&ot[kt[1]]?Oo({key:xt,value:d[xt],valueSpec:{type:"string"},style:ut,styleSpec:_e}):Tt&&ot[Tt[1]]&&ot[Tt[1]].transition?Oo({key:xt,value:d[xt],valueSpec:_e.transition,style:ut,styleSpec:_e}):ot[xt]?Oo({key:xt,value:d[xt],valueSpec:ot[xt],style:ut,styleSpec:_e}):[new c.V(xt,d[xt],`unknown property "${xt}"`)])}return mt}function tu(st){const d=st.value;if(!d)return[];const _e=st.key;if(!c.H(d))return[new c.V(_e,d,`object expected, ${c.K(d)} found`)];let ot=[];const ut=st.styleSpec,mt=ut["light-3d"],xt=st.style,Tt=st.style.lights;for(const Xt of["type","id"])if(!(Xt in d))return ot=ot.concat([new c.V(_e,d,`missing property "${Xt}"`)]),ot;if(!c.a0(d.type))return ot=ot.concat([new c.V(`${_e}.type`,d.type,"string expected")]),ot;if(Tt)for(let Xt=0;Xt<st.arrayIndex;Xt++){const rr=c.J(d.type),tr=Tt[Xt];c.J(tr.type)===rr&&ot.push(new c.V(_e,d.id,`duplicate light type "${d.type}", previously defined at line ${tr.id.__line__}`))}const kt=`properties_light_${d.type}`;if(!(kt in ut))return ot=ot.concat([new c.V(`${_e}.type`,d,`Invalid light type ${d.type}`)]),ot;const $t=ut[kt];for(const Xt in d)if(Xt==="properties"){const rr=d[Xt];if(!c.H(rr))return ot=ot.concat([new c.V("properties",rr,`object expected, ${c.K(rr)} found`)]),ot;for(const tr in rr){const nr=tr.match(/^(.*)-transition$/),cr=tr.match(/^(.*)-use-theme$/);ot=ot.concat(cr&&$t[cr[1]]?Oo({key:Xt,value:rr[tr],valueSpec:{type:"string"},style:xt,styleSpec:ut}):nr&&$t[nr[1]]&&$t[nr[1]].transition?Oo({key:Xt,value:d[Xt],valueSpec:ut.transition,style:xt,styleSpec:ut}):$t[tr]?Oo({key:tr,value:rr[tr],valueSpec:$t[tr],style:xt,styleSpec:ut}):[new c.a3(st.key,rr[tr],`unknown property "${tr}"`)])}}else ot=ot.concat(mt[Xt]?Oo({key:Xt,value:d[Xt],valueSpec:mt[Xt],style:xt,styleSpec:ut}):[new c.a3(Xt,d[Xt],`unknown property "${Xt}"`)]);return ot}function Wl(st){const d=st.value,_e=st.key,ot=st.style,ut=st.styleSpec,mt=ut.terrain;if(d==null)return[];if(!c.H(d))return[new c.V("terrain",d,`object expected, ${c.K(d)} found`)];let xt=[];for(const Tt in d){const kt=Tt.match(/^(.*)-transition$/),$t=Tt.match(/^(.*)-use-theme$/);xt=xt.concat($t&&mt[$t[1]]?Oo({key:Tt,value:d[Tt],valueSpec:{type:"string"},style:ot,styleSpec:ut}):kt&&mt[kt[1]]&&mt[kt[1]].transition?Oo({key:Tt,value:d[Tt],valueSpec:ut.transition,style:ot,styleSpec:ut}):mt[Tt]?Oo({key:Tt,value:d[Tt],valueSpec:mt[Tt],style:ot,styleSpec:ut}):[new c.a3(Tt,d[Tt],`unknown property "${Tt}"`)])}if(d.source)if(c.a0(d.source)){const Tt=ot.sources&&ot.sources[d.source],kt=Tt&&c.J(Tt.type);Tt?kt!=="raster-dem"&&xt.push(new c.V(`${_e}.source`,d.source,`terrain cannot be used with a source of type ${kt}, it only be used with a "raster-dem" source type`)):xt.push(new c.V(`${_e}.source`,d.source,`source "${d.source}" not found`))}else xt.push(new c.V(`${_e}.source`,d.source,"source must be a string"));else xt.push(new c.V(_e,d,'terrain is missing required property "source"'));return xt}function Zo(st){const d=st.value,_e=st.style,ot=st.styleSpec,ut=ot.fog;if(d===void 0)return[];if(!c.H(d))return[new c.V("fog",d,`object expected, ${c.K(d)} found`)];let mt=[];for(const xt in d){const Tt=xt.match(/^(.*)-transition$/),kt=xt.match(/^(.*)-use-theme$/);mt=mt.concat(kt&&ut[kt[1]]?Oo({key:xt,value:d[xt],valueSpec:{type:"string"},style:_e,styleSpec:ot}):Tt&&ut[Tt[1]]&&ut[Tt[1]].transition?Oo({key:xt,value:d[xt],valueSpec:ot.transition,style:_e,styleSpec:ot}):ut[xt]?Oo({key:xt,value:d[xt],valueSpec:ut[xt],style:_e,styleSpec:ot}):[new c.a3(xt,d[xt],`unknown property "${xt}"`)])}return mt}const ru={"*":()=>[],array:Ss,boolean:function(st){const d=st.value,_e=st.key;return c.$(d)?[]:[new c.V(_e,d,`boolean expected, ${c.K(d)} found`)]},number:Ul,color:function({key:st,value:d}){return c.a0(d)?c.a1.parseCSSColor(d)===null?[new c.V(st,d,`color expected, "${d}" found`)]:[]:[new c.V(st,d,`color expected, ${c.K(d)} found`)]},enum:Cs,filter:Ds,function:Tl,layer:ps,object:Tu,source:Gs,model:c.a7,light:Kl,"light-3d":tu,terrain:Wl,fog:Zo,string:qn,formatted:function(st){return qn(st).length===0?[]:ga(st)},resolvedImage:function(st){return qn(st).length===0?[]:ga(st)},projection:function(st){const d=st.value,_e=st.styleSpec,ot=_e.projection,ut=st.style;if(c.H(d)){let mt=[];for(const xt in d)mt=mt.concat(Oo({key:xt,value:d[xt],valueSpec:ot[xt],style:ut,styleSpec:_e}));return mt}return c.a0(d)?[]:[new c.V("projection",d,`object or string expected, ${c.K(d)} found`)]},import:function(st){const d=st.key,{value:_e,styleSpec:ot}=st;if(!c.H(_e))return[new c.V(d,_e,"import must be an object")];const{data:ut,...mt}=_e;Object.defineProperty(mt,"__line__",{value:_e.__line__,enumerable:!1});let xt=Tu(Object.assign({},st,{value:mt,valueSpec:ot.import}));return c.J(mt.id)===""&&xt.push(new c.V(`${st.key}.id`,mt,"import id can't be an empty string")),ut&&(xt=xt.concat(Ll(ut,ot,{key:`${st.key}.data`}))),xt},iconset:function(st){const d=st.value,_e=st.key,ot=st.styleSpec,ut=st.style;if(!c.H(d))return[new c.V(_e,d,"object expected")];if(!d.type)return[new c.V(_e,d,'"type" is required')];const mt=c.J(d.type);let xt=[];if(xt=xt.concat(Tu({key:_e,value:d,valueSpec:ot[`iconset_${mt}`],style:ut,styleSpec:ot})),function(Tt,kt){return!(Tt!=="source"||!kt.source)}(mt,d)){const Tt=ut.sources&&ut.sources[d.source],kt=Tt&&c.J(Tt.type);Tt?kt!=="raster-array"&&xt.push(new c.V(_e,d.source,`iconset cannot be used with a source of type ${String(kt)}, it only be used with a "raster-array" source type`)):xt.push(new c.V(_e,d.source,`source "${d.source}" not found`))}return xt}};function Oo(st,d=!1){const _e=st.value,ot=st.valueSpec,ut=st.styleSpec;if(ot.expression){if(c.a4(c.J(_e)))return Tl(st);if(c.Q(c.S(_e)))return ga(st)}if(ot.type&&ru[ot.type]){const mt=ru[ot.type](st);return d===!0&&mt.length>0&&Array.isArray(st.value)?ga(st):mt}return Tu(Object.assign({},st,{valueSpec:ot.type?ut[ot.type]:ot}))}function Tu(st){const d=st.key,_e=st.value,ot=st.valueSpec||{},ut=st.objectElementValidators||{},mt=st.style,xt=st.styleSpec;if(!c.H(_e))return[new c.V(d,_e,`object expected, ${c.K(_e)} found`)];let Tt=[];for(const kt in _e){const $t=kt.split(".")[0];let Xt;ut[$t]?Xt=ut[$t]:ot[$t]?Xt=Oo:ut["*"]?Xt=ut["*"]:ot["*"]&&(Xt=Oo),Xt?Tt=Tt.concat(Xt({key:(d&&`${d}.`)+kt,value:_e[kt],valueSpec:ot[$t]||ot["*"],style:mt,styleSpec:xt,object:_e,objectKey:kt},_e)):Tt.push(new c.a3(d,_e[kt],`unknown property "${kt}"`))}for(const kt in ot){if(ut[kt])continue;const $t=ot[kt];$t.required&&$t.default===void 0&&_e[kt]===void 0&&Tt.push(new c.V(d,_e,`missing required property "${kt}"`))}return Tt}function Ao({key:st,value:d}){const _e=qn({key:st,value:d});if(_e.length)return _e;const ot=d;return ot.indexOf("{fontstack}")===-1&&_e.push(new c.V(st,d,'"glyphs" url must include a "{fontstack}" token')),ot.indexOf("{range}")===-1&&_e.push(new c.V(st,d,'"glyphs" url must include a "{range}" token')),_e}function Ll(st,d=c.a6,_e={}){return Tu({key:_e.key||"",value:st,valueSpec:Object.assign(d.$root,{"*":{type:"*"}}),styleSpec:d,style:st,objectElementValidators:{glyphs:Ao}})}function Jo(st,d=c.a6){return vr(Ll(st,d))}const Ku=st=>vr(Gs(st)),zn=st=>vr(Kl(st)),Vu=st=>vr(tu(st)),t0=st=>vr(Wl(st)),Wu=st=>vr(Zo(st)),Bo=st=>vr(function(d){const _e=d.value,ot=d.style,ut=d.styleSpec,mt=ut.snow;if(_e===void 0)return[];if(!c.H(_e))return[new c.V("snow",_e,`object expected, ${c.K(_e)} found`)];let xt=[];for(const Tt in _e){const kt=Tt.match(/^(.*)-transition$/);xt=xt.concat(kt&&mt[kt[1]]&&mt[kt[1]].transition?Oo({key:Tt,value:_e[Tt],valueSpec:ut.transition,style:ot,styleSpec:ut}):mt[Tt]?Oo({key:Tt,value:_e[Tt],valueSpec:mt[Tt],style:ot,styleSpec:ut}):[new c.a3(Tt,_e[Tt],`unknown property "${Tt}"`)])}return xt}(st)),Ru=st=>vr(function(d){const _e=d.value,ot=d.style,ut=d.styleSpec,mt=ut.rain;if(_e===void 0)return[];if(!c.H(_e))return[new c.V("rain",_e,`object expected, ${c.K(_e)} found`)];let xt=[];for(const Tt in _e){const kt=Tt.match(/^(.*)-transition$/);xt=xt.concat(kt&&mt[kt[1]]&&mt[kt[1]].transition?Oo({key:Tt,value:_e[Tt],valueSpec:ut.transition,style:ot,styleSpec:ut}):mt[Tt]?Oo({key:Tt,value:_e[Tt],valueSpec:mt[Tt],style:ot,styleSpec:ut}):[new c.a3(Tt,_e[Tt],`unknown property "${Tt}"`)])}return xt}(st)),T0=st=>vr(ps(st)),fp=st=>vr(Ds(st)),xo=st=>vr(Gl(st)),xn=st=>vr(fs(st)),pr=st=>vr(c.a7(st));function vr(st){return st.slice().sort((d,_e)=>d.line&&_e.line?d.line-_e.line:0)}function kr(st,d){let _e=!1;if(d&&d.length)for(const ot of d)ot instanceof c.a3?c.w(ot.message):(st.fire(new c.y(new Error(ot.message))),_e=!0);return _e}const Yr=c.a6.light;let Kr;class rn extends c.E{constructor(d,_e="flat"){super(),this._transitionable=new c.a8(Kr||(Kr=new c.a9({anchor:new c.aa(Yr.anchor),position:new c.ab(Yr.position),color:new c.aa(Yr.color),intensity:new c.aa(Yr.intensity)}))),this.setLight(d,_e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(d,_e,ot={}){this._validate(zn,d,ot)||(this._transitionable.setTransitionOrValue(d),this.id=_e)}updateTransitions(d){this._transitioning=this._transitionable.transitioned(d,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(d){this.properties=this._transitioning.possiblyEvaluate(d)}_validate(d,_e,ot){return(!ot||ot.validate!==!1)&&kr(this,d.call(Jo,Object.assign({value:_e,style:{glyphs:!0,sprite:!0},styleSpec:c.a6})))}}const En=c.a6.terrain;let hn=class extends c.E{constructor(st,d,_e,ot,ut){super(),this.scope=_e,this._transitionable=new c.a8(new c.a9({source:new c.aa(En.source),exaggeration:new c.aa(En.exaggeration)}),_e,ot),this._transitionable.setTransitionOrValue(st,ot),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=d,this.worldview=ut}get(){return this._transitionable.serialize()}set(st,d){this._transitionable.setTransitionOrValue(st,d)}updateTransitions(st){this._transitioning=this._transitionable.transitioned(st,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(st){this.properties=this._transitioning.possiblyEvaluate(st)}getExaggeration(st){return this._transitioning.possiblyEvaluate(new c.ac(st,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const st=this._transitionable._values.exaggeration;if(!st)return null;const d=st.value.expression;if(!d)return null;let _e=-1,ot=-1,ut=1;for(const mt of d.zoomStops)ut=d.evaluate(new c.ac(mt,{worldview:this.worldview})),ut>.01?(_e=mt,ot=-1):ot=mt;return ut<.01&&_e>0&&ot>_e?[_e,ot]:null}isZoomDependent(){const st=this._transitionable._values.exaggeration;return st!=null&&st.value!=null&&st.value.expression!=null&&st.value.expression instanceof c.ad}};const vn=45,Vn=65,Rn=.05;function Ts(st,d,_e,ot){const ut=c.ah(vn,Vn,_e),[mt,xt]=Xs(st,ot);let Tt=1-Math.min(1,Math.exp((d-mt)/(xt-mt)*-6));return Tt*=Tt*Tt,Tt=Math.min(1,1.00747*Tt),Tt*ut*st.alpha}function Xs(st,d){const _e=.5/Math.tan(.5*d);return[st.range[0]+_e,st.range[1]+_e]}function bs(st,d,_e,ot,ut){const mt=c.af([],[d,_e,ot],ut.mercatorFogMatrix);return Ts(st,c.ag(mt),ut.pitch,ut._fov)}function Gn(st,d,_e,ot,ut,mt,xt){const Tt=[[_e,ot,0],[ut,ot,0],[ut,mt,0],[_e,mt,0]];let kt=Number.MAX_VALUE,$t=-Number.MAX_VALUE;for(const Xt of Tt){const rr=c.af([],Xt,d),tr=c.ag(rr);kt=Math.min(kt,tr),$t=Math.max($t,tr)}return[Ts(st,kt,xt.pitch,xt._fov),Ts(st,$t,xt.pitch,xt._fov)]}const bo=c.a6.fog;class Ys extends c.E{constructor(d,_e,ot,ut){super();const mt=new c.a9({range:new c.aa(bo.range),color:new c.aa(bo.color),"color-use-theme":new c.aa({type:"string","property-type":"data-constant",default:"default"}),"high-color":new c.aa(bo["high-color"]),"high-color-use-theme":new c.aa({type:"string","property-type":"data-constant",default:"default"}),"space-color":new c.aa(bo["space-color"]),"space-color-use-theme":new c.aa({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new c.aa(bo["horizon-blend"]),"star-intensity":new c.aa(bo["star-intensity"]),"vertical-range":new c.aa(bo["vertical-range"])});this._transitionable=new c.a8(mt,ot,new Map(ut)),this.set(d,ut),this._transitioning=this._transitionable.untransitioned(),this._transform=_e,this.properties=new c.ai(mt),this.scope=ot}get state(){const d=this._transform,_e=d.projection.name==="globe",ot=c.aj(d.zoom),ut=this.properties.get("range"),mt=[.5,3];return{range:_e?[c.ak(mt[0],ut[0],ot),c.ak(mt[1],ut[1],ot)]:ut,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(d,_e,ot={}){if(this._validate(Wu,d,ot))return;const ut=Object.assign({},d);for(const mt of Object.keys(bo))ut[mt]===void 0&&(ut[mt]=bo[mt].default);this._options=ut,this._transitionable.setTransitionOrValue(this._options,_e)}getOpacity(d){if(!this._transform.projection.supportsFog)return 0;const _e=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:c.ah(vn,Vn,d))*_e.a}getOpacityAtLatLng(d,_e){return this._transform.projection.supportsFog?function(ot,ut,mt){const xt=c.ae.fromLngLat(ut),Tt=mt.elevation?mt.elevation.getAtPointOrZero(xt):0;return bs(ot,xt.x,xt.y,Tt,mt)}(this.state,d,_e):0}getOpacityForTile(d){if(!this._transform.projection.supportsFog)return[1,1];const _e=this._transform.calculateFogTileMatrix(d.toUnwrapped());return Gn(this.state,_e,0,0,c.al,c.al,this._transform)}getOpacityForBounds(d,_e,ot,ut,mt){return this._transform.projection.supportsFog?Gn(this.state,d,_e,ot,ut,mt,this._transform):[1,1]}getFovAdjustedRange(d){return this._transform.projection.supportsFog?Xs(this.state,d):[0,1]}isVisibleOnFrustum(d){if(!this._transform.projection.supportsFog)return!1;const _e=[4,5,6,7];for(const ot of _e){const ut=d.points[ot];let mt;if(ut[2]>=0)mt=ut;else{const xt=d.points[ot-4];mt=c.am(xt,ut,xt[2]/(xt[2]-ut[2]))}if(bs(this.state,mt[0],mt[1],0,this._transform)>=Rn)return!0}return!1}updateConfig(d){this._transitionable.setTransitionOrValue(this._options,new Map(d))}updateTransitions(d){this._transitioning=this._transitionable.transitioned(d,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(d){this.properties=this._transitioning.possiblyEvaluate(d)}_validate(d,_e,ot){return(!ot||ot.validate!==!1)&&kr(this,d.call(Jo,Object.assign({value:_e,style:{glyphs:!0,sprite:!0},styleSpec:c.a6})))}}let jo,yu,Yo,Lo,zo=class extends c.E{constructor(st,d,_e,ot){super();const ut=jo||(jo=new c.a9({density:new c.aa(c.a6.snow.density),intensity:new c.aa(c.a6.snow.intensity),color:new c.aa(c.a6.snow.color),opacity:new c.aa(c.a6.snow.opacity),vignette:new c.aa(c.a6.snow.vignette),"vignette-color":new c.aa(c.a6.snow["vignette-color"]),"center-thinning":new c.aa(c.a6.snow["center-thinning"]),direction:new c.aa(c.a6.snow.direction),"flake-size":new c.aa(c.a6.snow["flake-size"])}));this._transitionable=new c.a8(ut,_e,new Map(ot)),this.set(st,ot),this._transitioning=this._transitionable.untransitioned(),this.properties=new c.ai(ut),this.scope=_e}get state(){const st=this.properties.get("opacity"),d=this.properties.get("color"),_e=this.properties.get("direction"),ot=c.an(_e[0]),ut=-Math.max(c.an(_e[1]),.01),mt=[Math.cos(ot)*Math.cos(ut),Math.sin(ot)*Math.cos(ut),Math.sin(ut)],xt=this.properties.get("vignette"),Tt=this.properties.get("vignette-color");return Tt.a=xt,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new c.ao(d.r,d.g,d.b,d.a*st),direction:mt,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:Tt}}get(){return this._transitionable.serialize()}set(st,d,_e={}){if(this._validate(Bo,st,_e))return;const ot=Object.assign({},st),ut=c.a6.snow;for(const mt of Object.keys(ut))ot[mt]===void 0&&(ot[mt]=ut[mt].default);this._options=ot,this._transitionable.setTransitionOrValue(this._options,d)}updateConfig(st){this._transitionable.setTransitionOrValue(this._options,new Map(st))}updateTransitions(st){this._transitioning=this._transitionable.transitioned(st,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(st){this.properties=this._transitioning.possiblyEvaluate(st)}_validate(st,d,_e){return(!_e||_e.validate!==!1)&&kr(this,st.call(Jo,Object.assign({value:d,style:{glyphs:!0,sprite:!0},styleSpec:c.a6})))}},uu=class extends c.E{constructor(st,d,_e,ot){super();const ut=yu||(yu=new c.a9({density:new c.aa(c.a6.rain.density),intensity:new c.aa(c.a6.rain.intensity),color:new c.aa(c.a6.rain.color),opacity:new c.aa(c.a6.rain.opacity),vignette:new c.aa(c.a6.rain.vignette),"vignette-color":new c.aa(c.a6.rain["vignette-color"]),"center-thinning":new c.aa(c.a6.rain["center-thinning"]),direction:new c.aa(c.a6.rain.direction),"droplet-size":new c.aa(c.a6.rain["droplet-size"]),"distortion-strength":new c.aa(c.a6.rain["distortion-strength"])}));this._transitionable=new c.a8(ut,_e,new Map(ot)),this.set(st,ot),this._transitioning=this._transitionable.untransitioned(),this.properties=new c.ai(ut),this.scope=_e}get state(){const st=this.properties.get("opacity"),d=this.properties.get("color"),_e=this.properties.get("direction"),ot=c.an(_e[0]),ut=-Math.max(c.an(_e[1]),.01),mt=[Math.cos(ot)*Math.cos(ut),Math.sin(ot)*Math.cos(ut),Math.sin(ut)],xt=this.properties.get("vignette-color");return xt.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new c.ao(d.r,d.g,d.b,d.a*st),direction:mt,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:xt}}get(){return this._transitionable.serialize()}set(st,d,_e={}){if(this._validate(Ru,st,_e))return;const ot=Object.assign({},st),ut=c.a6.rain;for(const mt of Object.keys(ut))ot[mt]===void 0&&(ot[mt]=ut[mt].default);this._options=ot,this._transitionable.setTransitionOrValue(this._options,d)}updateConfig(st){this._transitionable.setTransitionOrValue(this._options,new Map(st))}updateTransitions(st){this._transitioning=this._transitionable.transitioned(st,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(st){this.properties=this._transitioning.possiblyEvaluate(st)}_validate(st,d,_e){return(!_e||_e.validate!==!1)&&kr(this,st.call(Jo,Object.assign({value:d,style:{glyphs:!0,sprite:!0},styleSpec:c.a6})))}};class na extends c.E{constructor(d,_e,ot,ut){super(),this.scope=ot,this._options=d,this.properties=new c.ai(_e),this._transitionable=new c.a8(_e,ot,new Map(ut)),this._transitionable.setTransitionOrValue(d.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(d){this._transitionable.setTransitionOrValue(this._options.properties,new Map(d))}updateTransitions(d){this._transitioning=this._transitionable.transitioned(d,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(d){this.properties=this._transitioning.possiblyEvaluate(d)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(d,_e){this._options=d,this._transitionable.setTransitionOrValue(d.properties,_e)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class du{constructor(d,_e,ot){this.screenBounds=d,this.cameraPoint=ot.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=_e,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,ot)}static createFromScreenPoints(d,_e){let ot,ut;if(d instanceof c.P||typeof d[0]=="number"){const mt=c.P.convert(d);ot=[mt],ut=_e.isPointAboveHorizon(mt)}else{const mt=c.P.convert(d[0]),xt=c.P.convert(d[1]),Tt=mt.add(xt)._div(2);ot=[mt,xt],ut=c.aq(mt,xt).every(kt=>_e.isPointAboveHorizon(kt))&&_e.isPointAboveHorizon(Tt)}return new du(ot,ut,_e)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(d){return c.aq(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],d)}bufferedCameraGeometry(d){const _e=this.screenBounds[0],ot=this.screenBounds.length===1?this.screenBounds[0].add(new c.P(1,1)):this.screenBounds[1],ut=c.aq(_e,ot,0,!1);return this.cameraPoint.y>ot.y&&(this.cameraPoint.x>_e.x&&this.cameraPoint.x<ot.x?ut.splice(3,0,this.cameraPoint):this.cameraPoint.x>=ot.x?ut[2]=this.cameraPoint:this.cameraPoint.x<=_e.x&&(ut[3]=this.cameraPoint)),c.ar(ut,d)}bufferedCameraGeometryGlobe(d){const _e=this.screenBounds[0],ot=this.screenBounds.length===1?this.screenBounds[0].add(new c.P(1,1)):this.screenBounds[1],ut=c.aq(_e,ot,d),mt=this.cameraPoint.clone();switch(3*((mt.y>_e.y)+(mt.y>ot.y))+((mt.x>_e.x)+(mt.x>ot.x))){case 0:ut[0]=mt,ut[4]=mt.clone();break;case 1:ut.splice(1,0,mt);break;case 2:ut[1]=mt;break;case 3:ut.splice(4,0,mt);break;case 5:ut.splice(2,0,mt);break;case 6:ut[3]=mt;break;case 7:ut.splice(3,0,mt);break;case 8:ut[2]=mt}return ut}containsTile(d,_e,ot,ut=0){const mt=Math.max(d.queryPadding,d.evaluateQueryRenderedFeaturePadding())/_e._pixelsPerMercatorPixel+1,xt=ot?this._bufferedCameraMercator(mt,_e):this._bufferedScreenMercator(mt,_e);let Tt=d.tileID.wrap+(xt.unwrapped?ut:0);const kt=xt.polygon.map(yr=>c.as(d.tileTransform,yr,Tt));if(!c.at(kt,0,0,c.al,c.al))return;Tt=d.tileID.wrap+(this.screenGeometryMercator.unwrapped?ut:0);const $t=this.screenGeometryMercator.polygon.map(yr=>c.au(d.tileTransform,yr,Tt)),Xt=$t.map(yr=>new c.P(yr[0],yr[1])),rr=_e.getFreeCameraOptions().position||new c.ae(0,0,0),tr=c.au(d.tileTransform,rr,Tt),nr=$t.map(yr=>{const xr=c.av(yr,yr,tr);return c.aw(xr,xr),new c.ax(tr,xr)}),cr=c.ay(d,1,_e.zoom)*_e._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:Xt,tilespaceRays:nr,bufferedTilespaceGeometry:kt,bufferedTilespaceBounds:(lr=c.az(kt),lr.min.x=c.aA(lr.min.x,0,c.al),lr.min.y=c.aA(lr.min.y,0,c.al),lr.max.x=c.aA(lr.max.x,0,c.al),lr.max.y=c.aA(lr.max.y,0,c.al),lr),tile:d,tileID:d.tileID,pixelToTileUnitsFactor:cr};var lr}_bufferedScreenMercator(d,_e){const ot=Iu(d);if(this._screenRaycastCache[ot])return this._screenRaycastCache[ot];{let ut;return ut=_e.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(d),_e):{polygon:this.bufferedScreenGeometry(d).map(mt=>_e.pointCoordinate3D(mt)),unwrapped:!0},this._screenRaycastCache[ot]=ut,ut}}_bufferedCameraMercator(d,_e){const ot=Iu(d);if(this._cameraRaycastCache[ot])return this._cameraRaycastCache[ot];{let ut;return ut=_e.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(d),_e):{polygon:this.bufferedCameraGeometry(d).map(mt=>_e.pointCoordinate3D(mt)),unwrapped:!0},this._cameraRaycastCache[ot]=ut,ut}}_projectAndResample(d,_e){const ot=function(mt,xt){const Tt=c.aB([],xt.pixelMatrix,xt.globeMatrix),kt=[0,-c.aD,0,1],$t=[0,c.aD,0,1],Xt=[0,0,0,1];c.aC(kt,kt,Tt),c.aC($t,$t,Tt),c.aC(Xt,Xt,Tt);const rr=new c.P(kt[0]/kt[3],kt[1]/kt[3]),tr=new c.P($t[0]/$t[3],$t[1]/$t[3]),nr=c.aE(mt,rr)&&kt[3]<Xt[3],cr=c.aE(mt,tr)&&$t[3]<Xt[3];if(!nr&&!cr)return null;const lr=function($r,Or,Br){for(let Xr=1;Xr<$r.length;Xr++){const an=Do(Or.pointCoordinate3D($r[Xr-1]).x),sn=Do(Or.pointCoordinate3D($r[Xr]).x);if(Br<0){if(an<sn)return{idx:Xr,t:-an/(sn-1-an)}}else if(sn<an)return{idx:Xr,t:(1-an)/(sn+1-an)}}return null}(mt,xt,nr?-1:1);if(!lr)return null;const{idx:yr,t:xr}=lr;let Ar=yr>1?Vo(mt.slice(0,yr),xt):[],Dr=yr<mt.length?Vo(mt.slice(yr),xt):[];Ar=Ar.map($r=>new c.P(Do($r.x),$r.y)),Dr=Dr.map($r=>new c.P(Do($r.x),$r.y));const Tr=[...Ar];Tr.length===0&&Tr.push(Dr[Dr.length-1]);const Wr=c.ak(Tr[Tr.length-1].y,(Dr.length===0?Ar[0]:Dr[0]).y,xr);let zr;return zr=nr?[new c.P(0,Wr),new c.P(0,0),new c.P(1,0),new c.P(1,Wr)]:[new c.P(1,Wr),new c.P(1,1),new c.P(0,1),new c.P(0,Wr)],Tr.push(...zr),Dr.length===0?Tr.push(Ar[0]):Tr.push(...Dr),{polygon:Tr.map($r=>new c.ae($r.x,$r.y)),unwrapped:!1}}(d,_e);if(ot)return ot;const ut=function(mt,xt){let Tt=!1,kt=-1/0,$t=0;for(let rr=0;rr<mt.length-1;rr++)mt[rr].x>kt&&(kt=mt[rr].x,$t=rr);for(let rr=0;rr<mt.length-1;rr++){const tr=($t+rr)%(mt.length-1),nr=mt[tr],cr=mt[tr+1];Math.abs(nr.x-cr.x)>.5&&(nr.x<cr.x?(nr.x+=1,tr===0&&(mt[mt.length-1].x+=1)):(cr.x+=1,tr+1===mt.length-1&&(mt[0].x+=1)),Tt=!0)}const Xt=c.aF(xt.center.lng);return Tt&&Xt<Math.abs(Xt-1)&&mt.forEach(rr=>{rr.x-=1}),{polygon:mt,unwrapped:Tt}}(Vo(d,_e).map(mt=>new c.P(Do(mt.x),mt.y)),_e);return{polygon:ut.polygon.map(mt=>new c.ae(mt.x,mt.y)),unwrapped:ut.unwrapped}}}function Vo(st,d){return c.aG(st,_e=>{const ot=d.pointCoordinate3D(_e);_e.x=ot.x,_e.y=ot.y},1/256)}function Do(st){return st<0?1+st%1:st%1}function Iu(st){return 100*st|0}function Jl(st,d,_e,ot,ut){const mt=function(Tt,kt){if(Tt)return ut(Tt);if(kt){if(st.url&&kt.tiles&&st.tiles&&delete st.tiles,kt.variants){if(!Array.isArray(kt.variants))return ut(new Error("variants must be an array"));for(const Xt of kt.variants){if(Xt==null||typeof Xt!="object"||Xt.constructor!==Object)return ut(new Error("variant must be an object"));if(!Array.isArray(Xt.capabilities))return ut(new Error("capabilities must be an array"));if(Xt.capabilities.length===1&&Xt.capabilities[0]==="meshopt"){kt=Object.assign(kt,Xt);break}}}const $t=c.aH(Object.assign({},kt,st),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);$t.tiles=d.canonicalizeTileset($t,st.url),ut(null,$t)}},xt=function(Tt,kt,$t){if(!Tt)return null;if(!kt&&!$t)return Tt;$t=$t||Tt.worldview_default;const Xt=Object.values(Tt.language||{});if(Xt.length===0)return null;const rr=Object.values(Tt.worldview||{});if(rr.length===0)return null;const tr=Xt.every(cr=>cr===kt),nr=rr.every(cr=>cr===$t);return tr&&nr?Tt:kt in(Tt.language_options||{})||$t in(Tt.worldview_options||{})?null:Tt.language_options&&Tt.worldview_options?Tt:null}(st.data,_e,ot);return xt?c.o.frame(()=>mt(null,xt)):st.url?c.m(d.transformRequest(d.normalizeSourceURL(st.url,null,_e,ot),c.R.Source),mt):c.o.frame(()=>{const{data:Tt,...kt}=st;mt(null,kt)})}function qu(st,d){const _e=Math.pow(2,d.z),ot=Math.floor(c.aF(st.getWest())*_e),ut=Math.floor(c.aJ(st.getNorth())*_e),mt=Math.ceil(c.aF(st.getEast())*_e),xt=Math.ceil(c.aJ(st.getSouth())*_e);return d.x>=ot&&d.x<mt&&d.y>=ut&&d.y<xt}class Ip{constructor(d,_e,ot){this.bounds=d?c.aI.convert(this.validateBounds(d)):null,this.minzoom=_e||0,this.maxzoom=ot||24}validateBounds(d){return Array.isArray(d)&&d.length===4?[Math.max(-180,d[0]),Math.max(-90,d[1]),Math.min(180,d[2]),Math.min(90,d[3])]:[-180,-90,180,90]}addExtraBounds(d){if(d){this.extraBounds||(this.extraBounds=[]);for(const _e of d)this.extraBounds.push(c.aI.convert(this.validateBounds(_e)))}}contains(d){if(d.z>this.maxzoom||d.z<this.minzoom||this.bounds&&!qu(this.bounds,d))return!1;if(!this.extraBounds)return!0;for(const _e of this.extraBounds)if(qu(_e,d))return!0;return!1}static fromTileJSON(d){if(!d.bounds&&!d.extra_bounds)return null;const _e=new Ip(d.bounds,d.minzoom,d.maxzoom);return _e.addExtraBounds(d.extra_bounds),_e}}class Xp extends c.E{constructor(d,_e,ot,ut){if(super(),this.id=d,this.dispatcher=ot,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,Object.assign(this,c.aH(_e,["url","scheme","tileSize","promoteId"])),this._options=Object.assign({type:"vector"},_e),this._collectResourceTiming=!!_e.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(ut),this._tileWorkers={},this._deduped=new c.aK}load(d){this._loaded=!1,this.fire(new c.z("dataloading",{dataType:"source"}));const _e=Array.isArray(this.map._language)?this.map._language.join():this.map._language,ot=this.map.getWorldview();this._tileJSONRequest=Jl(this._options,this.map._requestManager,_e,ot,(ut,mt)=>{if(this._tileJSONRequest=null,this._loaded=!0,ut)_e&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${_e}`),ot&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${ot}`),this.fire(new c.y(ut));else if(mt){if(Object.assign(this,mt),this.hasWorldviews=!!mt.worldview_options,mt.worldview_default&&(this.worldviewDefault=mt.worldview_default),mt.vector_layers){this.vectorLayers=mt.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const xt of mt.vector_layers)this.vectorLayerIds.push(xt.id),mt.worldview&&mt.worldview[xt.source]&&this.localizableLayerIds.add(xt.id)}this.tileBounds=Ip.fromTileJSON(mt),gn(mt.tiles,this.map._requestManager._customAccessToken),this.fire(new c.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.z("data",{dataType:"source",sourceDataType:"content"}))}d&&d(ut)})}loaded(){return this._loaded}hasTile(d){return!this.tileBounds||this.tileBounds.contains(d.canonical)}onAdd(d){this.map=d,this.load()}reload(){this.cancelTileJSONRequest();const d=c.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(d))}setTiles(d){return this._options.tiles=d,this.reload(),this}setUrl(d){return this.url=d,this._options.url=d,this.reload(),this}onRemove(d){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}loadTile(d,_e){const ot=d.tileID.canonical.url(this.tiles,this.scheme),ut=this.map._requestManager.normalizeTileURL(ot),mt=this.map._requestManager.transformRequest(ut,c.R.Tile),xt=this.map.style?this.map.style.getLut(this.scope):null,Tt=xt?{image:xt.image.clone()}:null,kt={request:mt,data:void 0,uid:d.uid,tileID:d.tileID,tileZoom:d.tileZoom,zoom:d.tileID.overscaledZ,maxZoom:this.maxzoom,lut:Tt,tileSize:this.tileSize*d.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:c.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:d.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:d.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault,indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};if(this.hasWorldviews&&c.h(ot)&&(kt.localizableLayerIds=this.localizableLayerIds),kt.request.collectResourceTiming=this._collectResourceTiming,d.actor&&d.state!=="expired")d.state==="loading"?d.reloadCallback=_e:d.request=d.actor.send("reloadTile",kt,$t.bind(this));else if(d.actor=this._tileWorkers[ut]=this._tileWorkers[ut]||this.dispatcher.getActor(),this.dispatcher.ready)d.request=d.actor.send("loadTile",kt,$t.bind(this),void 0,!0);else{const Xt=c.aL.call({deduped:this._deduped},kt,(rr,tr)=>{if(rr||!tr)$t.call(this,rr);else{const nr=c.aM(tr.responseHeaders);kt.data={rawData:tr.rawData.slice(0),expires:nr.expires,cacheControl:nr.cacheControl},d.actor&&d.actor.send("loadTile",kt,$t.bind(this),void 0,!0)}},!0);d.request={cancel:Xt}}function $t(Xt,rr){return delete d.request,d.aborted?_e(null):Xt&&Xt instanceof c.aN&&Xt.status!==404?_e(Xt):(rr&&rr.resourceTiming&&(d.resourceTiming=rr.resourceTiming),this.map._refreshExpiredTiles&&rr&&d.setExpiryData(rr),d.loadVectorData(rr,this.map.painter),c.aO(this.dispatcher),_e(null,rr),void(d.reloadCallback&&(this.loadTile(d,d.reloadCallback),d.reloadCallback=null)))}}abortTile(d){d.request&&(d.request.cancel(),delete d.request),d.actor&&d.actor.send("abortTile",{uid:d.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(d,_e){d.actor&&d.actor.send("removeTile",{uid:d.uid,type:this.type,source:this.id,scope:this.scope}),d.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Il extends c.E{constructor(d,_e,ot,ut){super(),this.id=d,this.dispatcher=ot,this.setEventedParent(ut),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=Object.assign({type:"raster"},_e),Object.assign(this,c.aH(_e,["url","scheme","tileSize"]))}load(d){this._loaded=!1,this.fire(new c.z("dataloading",{dataType:"source"}));const _e=this.map.getWorldview();this._tileJSONRequest=Jl(this._options,this.map._requestManager,null,_e,(ot,ut)=>{this._tileJSONRequest=null,this._loaded=!0,ot?this.fire(new c.y(ot)):ut&&(Object.assign(this,ut),ut.raster_layers&&(this.rasterLayers=ut.raster_layers,this.rasterLayerIds=this.rasterLayers.map(mt=>mt.id)),this.tileBounds=Ip.fromTileJSON(ut),gn(ut.tiles),this.fire(new c.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.z("data",{dataType:"source",sourceDataType:"content"}))),d&&d(ot)})}loaded(){return this._loaded}onAdd(d){this.map=d,this.load()}reload(){this.cancelTileJSONRequest();const d=c.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(d))}setTiles(d){return this._options.tiles=d,this.reload(),this}setUrl(d){return this.url=d,this._options.url=d,this.reload(),this}onRemove(d){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}hasTile(d){return!this.tileBounds||this.tileBounds.contains(d.canonical)}loadTile(d,_e){const ot=c.o.devicePixelRatio>=2,ut=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme),ot,this.tileSize);d.request=c.n(this.map._requestManager.transformRequest(ut,c.R.Tile),(mt,xt,Tt)=>{if(delete d.request,d.aborted)return d.state="unloaded",_e(null);if(mt)return d.state="errored",_e(mt);if(!xt)return _e(null);const kt=c.aM(Tt);this.map._refreshExpiredTiles&&d.setExpiryData(kt),d.setTexture(xt,this.map.painter),d.state="loaded",c.aO(this.dispatcher),_e(null)})}abortTile(d,_e){d.request&&(d.request.cancel(),delete d.request),_e&&_e()}unloadTile(d,_e){d.texture&&d.texture instanceof c.T?(d.destroy(!1),d.texture&&d.texture instanceof c.T&&this.map.painter.saveTileTexture(d.texture)):d.destroy(),_e&&_e()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function Mu([st,d],_e,ot,{scaled:ut=!0}={}){const{tileSize:mt,buffer:xt}=ot,{x:Tt,y:kt,z:$t}=_e;if(!isFinite(Tt)||!isFinite(kt)||!isFinite($t))throw new Error("Invalid MRT header");const Xt=2**$t,rr=Xt*c.aF(st),tr=Xt*c.aJ(d);return function([nr,cr],lr,{scaled:yr=!0}={}){if(!lr)throw new Error("bandView is undefined");const{data:xr,tileSize:Ar,buffer:Dr,offset:Tr,scale:Wr,dimension:zr}=lr;if(nr<-Dr||nr>Ar+Dr||cr<-Dr||cr>Ar+Dr)throw new Error(`Point (${nr}, ${cr}) out of bounds for tileSize=${Ar}, buffer=${Dr}`);const $r=(cr+Dr)*(Ar+2*Dr)+(nr+Dr);if(new Uint32Array(xr.buffer)[$r]===4294967295)return null;let Or=[];Or=yr?[]:new lr.data.constructor(zr);for(let Br=0;Br<zr;Br++)Or[Br]=Math.round(1e12*(xr[zr*$r+Br]*Wr+Tr))/1e12;return Or}([Math.min(Math.max(-xt,Math.floor((rr-Tt)*mt)),mt-1+xt),Math.min(Math.max(-xt,Math.floor((tr-kt)*mt)),mt-1+xt)],ot,{scaled:ut})}class Un extends Il{constructor(d,_e,ot,ut){super(d,_e,ot,ut),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._loadTilePending={},this._loadTileLoaded={},this._options=Object.assign({type:"raster-array"},_e)}triggerRepaint(d){const _e=this.map.painter._terrain,ot=this.map.style.getSourceCache(this.id);_e&&_e.enabled&&ot&&_e._clearRenderCacheForTile(ot.id,d.tileID),this.map.triggerRepaint()}loadTile(d,_e){const ot=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),ut=this.map._requestManager.transformRequest(ot,c.R.Tile),mt={request:ut,uid:d.uid,tileID:d.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};d.source=this.id,d.scope=this.scope,d.requestParams=ut,d.actor||(d.actor=this.dispatcher.getActor());const xt=(Tt,kt,$t)=>{if(delete d.request,d.aborted)return d.state="unloaded",_e(null);if(Tt)return Tt.name==="AbortError"?void 0:(d.state="errored",_e(Tt));if(this.map._refreshExpiredTiles&&kt){const Xt=c.aM($t);d.setExpiryData(Xt)}if(this.partial&&d.state!=="expired")d.state="empty";else if(!this.partial){if(!kt)return _e(null);d.state="loaded",d._isHeaderLoaded=!0,d._mrt=kt}_e(null)};d.request=this.partial?d.fetchHeader(void 0,xt.bind(this)):d.actor.send("loadTile",mt,xt.bind(this),void 0,!0)}abortTile(d){d.request&&(d.request.cancel(),delete d.request),d.actor&&d.actor.send("abortTile",{uid:d.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(d,_e){const ot=d.texturePerLayer;if(d.flushAllQueues(),ot.size){d.destroy(!1);for(const ut of ot.values())this.map.painter.saveTileTexture(ut)}else d.destroy()}prepareTile(d,_e,ot,ut){d._isHeaderLoaded&&(d.state!=="empty"&&(d.state="reloading"),d.fetchBandForRender(_e,ot,ut,(mt,xt)=>{if(mt)return d.state="errored",this.fire(new c.y(mt)),void this.triggerRepaint(d);xt&&(d._isHeaderLoaded=!0,d.setTexturePerLayer(ot,xt,this.map.painter),d.state="loaded",this.triggerRepaint(d))}))}getInitialBand(d){if(!this.rasterLayers)return 0;const _e=this.rasterLayers.find(({id:mt})=>mt===d),ot=_e&&_e.fields,ut=ot&&ot.bands&&ot.bands;return ut?ut[0]:0}getTextureDescriptor(d,_e,ot){if(!d)return;const ut=_e.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!ut)return;let mt=null;_e instanceof c.aR?mt=_e.paint.get("raster-array-band"):_e instanceof c.aS&&(mt=_e.paint.get("raster-particle-array-band"));const xt=mt||this.getInitialBand(ut);if(xt==null)return;if(!d.textureDescriptorPerLayer.get(_e.id))return void this.prepareTile(d,ut,_e.id,xt);if(d.updateNeeded(_e.id,xt)&&!ot)return;const Tt=d.textureDescriptorPerLayer.get(_e.id);return Object.assign({},Tt,{texture:d.texturePerLayer.get(_e.id)})}getImages(d,_e){const ot=new Map;for(const ut of d)for(const mt of _e){const[xt,Tt]=mt.split("/"),kt=ut.getLayer(xt);if(!kt||!kt.hasBand(Tt)||!kt.hasDataForBand(Tt))continue;const{bytes:$t,tileSize:Xt,buffer:rr}=kt.getBandView(Tt),tr=Xt+2*rr,nr={data:new c.q({width:tr,height:tr},$t),pixelRatio:2,sdf:!1,usvg:!1,version:0};ot.set(mt,nr)}return ot}queryRasterArrayValueByBandId(d,_e,ot){const ut=_e._mrt;return new Promise(mt=>{const xt={},Tt=new Set;for(const[kt,$t]of Object.entries(ut.layers)){if(ot.layerName&&kt!==ot.layerName)continue;const Xt={};xt[kt]=Xt;for(const{bands:rr}of $t.dataIndex)for(const tr of rr)ot.bands&&!ot.bands.includes(tr)||(Tt.add(c.B(kt,tr)),_e.fetchBand(kt,null,tr,nr=>{c.o.frame(()=>{Xt[tr]=nr?null:Mu([d.lng,d.lat],ut,$t.getBandView(tr)),Tt.delete(c.B(kt,tr)),Tt.size===0&&mt(xt)})},!1))}Tt.size===0&&mt(xt)})}_loadTileForQuery(d,_e){if(this._loadTileLoaded[d.uid])return void _e(null,d._mrt);if(this._loadTilePending[d.uid])return void this._loadTilePending[d.uid].push(_e);this._loadTilePending[d.uid]=[_e];const ot=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),ut=this.map._requestManager.transformRequest(ot,c.R.Tile);d.actor.send("loadTile",{request:ut,uid:d.uid,tileID:d.tileID,type:this.type,source:this.id,scope:this.scope,partial:!1},(mt,xt,Tt)=>{if(mt)return this._loadTilePending[d.uid].forEach(kt=>kt(mt,null)),void delete this._loadTilePending[d.uid];if(!xt)return this._loadTilePending[d.uid].forEach(kt=>kt(null,null)),void delete this._loadTilePending[d.uid];if(this.map._refreshExpiredTiles&&xt){const kt=c.aM(Tt);d.setExpiryData(kt)}d._mrt=xt,d._isHeaderLoaded=!0,d.state="loaded",this._loadTilePending[d.uid].forEach(kt=>kt(null,xt)),this._loadTileLoaded[d.uid]=!0,delete this._loadTilePending[d.uid]},void 0,!0)}queryRasterArrayValueByAllBands(d,_e,ot){return new Promise((ut,mt)=>{this._loadTileForQuery(_e,(xt,Tt)=>{xt?mt(xt):ut(Tt?this.queryRasterArrayValueByBandId(d,_e,ot):null)})})}queryRasterArrayValue(d,_e){const ot=c.aT.convert(d),ut=this.findLoadedParent(ot);return ut&&ut._mrt?_e.bands||!this.partial?this.queryRasterArrayValueByBandId(ot,ut,_e):this.queryRasterArrayValueByAllBands(ot,ut,_e):Promise.resolve(null)}findLoadedParent(d){const _e=c.ae.fromLngLat(d,this.map.transform.tileSize),ot=this.maxzoom+1,ut=1<<ot,mt=Math.floor(_e.x),xt=Math.floor((_e.x-mt)*ut),Tt=Math.floor(_e.y*ut),kt=this.map.style.getSourceCache(this.id),$t=new c.aQ(ot,mt,ot,xt,Tt);return kt.findLoadedParent($t,this.minzoom)}}const nn={vector:Xp,raster:Il,"raster-dem":class extends Il{constructor(st,d,_e,ot){super(st,d,_e,ot),this.type="raster-dem",this.maxzoom=22,this._options=Object.assign({type:"raster-dem"},d),this.encoding=d.encoding||"mapbox"}loadTile(st,d){const _e=this.map._requestManager.normalizeTileURL(st.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function ot(ut,mt){ut&&(st.state="errored",d(ut)),mt&&(st.dem=mt,st.dem.onDeserialize(),st.needsHillshadePrepare=!0,st.needsDEMTextureUpload=!0,st.state="loaded",d(null))}st.request=c.n(this.map._requestManager.transformRequest(_e,c.R.Tile),(function(ut,mt,xt){if(delete st.request,st.aborted)st.state="unloaded",d(null);else if(ut)st.state="errored",d(ut);else if(mt){const Tt=c.aM(xt);this.map._refreshExpiredTiles&&st.setExpiryData(Tt);const kt=ImageBitmap&&mt instanceof ImageBitmap&&c.r(),$t=1-(mt.width-c.aP(mt.width))/2;$t<1||st.neighboringTiles||(st.neighboringTiles=this._getNeighboringTiles(st.tileID));const Xt=kt?mt:c.o.getImageData(mt,$t),rr={uid:st.uid,tileID:st.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:Xt,encoding:this.encoding,padding:$t};st.actor&&st.state!=="expired"||(st.actor=this.dispatcher.getActor(),st.actor.send("loadTile",rr,ot.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(st){const d=st.canonical,_e=Math.pow(2,d.z),ot=(d.x-1+_e)%_e,ut=d.x===0?st.wrap-1:st.wrap,mt=(d.x+1+_e)%_e,xt=d.x+1===_e?st.wrap+1:st.wrap,Tt={};return Tt[new c.aQ(st.overscaledZ,ut,d.z,ot,d.y).key]={backfilled:!1},Tt[new c.aQ(st.overscaledZ,xt,d.z,mt,d.y).key]={backfilled:!1},d.y>0&&(Tt[new c.aQ(st.overscaledZ,ut,d.z,ot,d.y-1).key]={backfilled:!1},Tt[new c.aQ(st.overscaledZ,st.wrap,d.z,d.x,d.y-1).key]={backfilled:!1},Tt[new c.aQ(st.overscaledZ,xt,d.z,mt,d.y-1).key]={backfilled:!1}),d.y+1<_e&&(Tt[new c.aQ(st.overscaledZ,ut,d.z,ot,d.y+1).key]={backfilled:!1},Tt[new c.aQ(st.overscaledZ,st.wrap,d.z,d.x,d.y+1).key]={backfilled:!1},Tt[new c.aQ(st.overscaledZ,xt,d.z,mt,d.y+1).key]={backfilled:!1}),Tt}},"raster-array":Un,geojson:class extends c.E{constructor(st,d,_e,ot){super(),this.id=st,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=_e.getActor(),this.setEventedParent(ot),this._data=d.data,this._options=Object.assign({},d),this._collectResourceTiming=d.collectResourceTiming,d.maxzoom!==void 0&&(this.maxzoom=d.maxzoom),d.minzoom!==void 0&&(this.minzoom=d.minzoom),d.type&&(this.type=d.type),d.attribution&&(this.attribution=d.attribution),this.promoteId=d.promoteId;const ut=c.al/this.tileSize;this.workerOptions=Object.assign({source:this.id,scope:this.scope,cluster:d.cluster||!1,geojsonVtOptions:{buffer:(d.buffer!==void 0?d.buffer:128)*ut,tolerance:(d.tolerance!==void 0?d.tolerance:.375)*ut,extent:c.al,maxZoom:this.maxzoom,lineMetrics:d.lineMetrics||!1,generateId:d.generateId||!1},superclusterOptions:{maxZoom:d.clusterMaxZoom!==void 0?d.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,d.clusterMinPoints||2),extent:c.al,radius:(d.clusterRadius!==void 0?d.clusterRadius:50)*ut,log:!1,generateId:d.generateId||!1},clusterProperties:d.clusterProperties,filter:d.filter,dynamic:d.dynamic},d.workerOptions)}onAdd(st){this.map=st,this.setData(this._data)}setData(st){return this._data=st,this._updateWorkerData(),this}updateData(st){if(!this._options.dynamic)return this.fire(new c.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof st!="string"&&(st.type==="Feature"&&(st={type:"FeatureCollection",features:[st]}),st.type!=="FeatureCollection"))return this.fire(new c.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof st!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const d=new Map;for(const _e of this._data.features)d.set(_e.id,_e);for(const _e of st.features)d.set(_e.id,_e);this._data.features=[...d.values()]}else this._data=st;return this._updateWorkerData(!0),this}getClusterExpansionZoom(st,d){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:st,source:this.id,scope:this.scope},d),this}getClusterChildren(st,d){return this.actor.send("geojson.getClusterChildren",{clusterId:st,source:this.id,scope:this.scope},d),this}getClusterLeaves(st,d,_e,ot){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:st,limit:d,offset:_e},ot),this}_updateWorkerData(st=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new c.z("dataloading",{dataType:"source"})),this._loaded=!1;const d=Object.assign({append:st},this.workerOptions);d.scope=this.scope;const _e=this._data;typeof _e=="string"?(d.request=this.map._requestManager.transformRequest(c.o.resolveURL(_e),c.R.Source),d.request.collectResourceTiming=this._collectResourceTiming):d.data=JSON.stringify(_e),this._pendingLoad=this.actor.send(`${this.type}.loadData`,d,(ot,ut)=>{if(this._loaded=!0,this._pendingLoad=null,ot)this.fire(new c.y(ot));else{const mt={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&ut&&ut.resourceTiming&&ut.resourceTiming[this.id]&&(mt.resourceTiming=ut.resourceTiming[this.id]),st&&(this._partialReload=!0),this.fire(new c.z("data",mt)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(st),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const st=c.B(this.id,this.scope);this.map.style.clearSource(st),this._updateWorkerData()}loadTile(st,d){const _e=st.actor?"reloadTile":"loadTile";st.actor=this.actor;const ot=this.map.style?this.map.style.getLut(this.scope):null,ut=ot?{image:ot.image.clone()}:null,mt=this._partialReload,xt={type:this.type,uid:st.uid,tileID:st.tileID,tileZoom:st.tileZoom,zoom:st.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:ut,scope:this.scope,pixelRatio:c.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:st.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:mt,worldview:this.map.getWorldview(),indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};st.request=this.actor.send(_e,xt,(Tt,kt)=>mt&&!kt?(st.state="loaded",d(null)):(delete st.request,st.destroy(!1),st.aborted?d(null):Tt?d(Tt):(st.loadVectorData(kt,this.map.painter,_e==="reloadTile"),d(null))),void 0,_e==="loadTile")}abortTile(st){st.request&&(st.request.cancel(),delete st.request),st.aborted=!0}unloadTile(st,d){this.actor.send("removeTile",{uid:st.uid,type:this.type,source:this.id,scope:this.scope}),st.destroy()}onRemove(st){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return Object.assign({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends c.aU{constructor(st,d,_e,ot){super(st,d,_e,ot),this.roundZoom=!0,this.type="video",this.options=d}load(){this._loaded=!1;const st=this.options;this.urls=[];for(const d of st.urls)this.urls.push(this.map._requestManager.transformRequest(d,c.R.Source).url);c.aV(this.urls,(d,_e)=>{this._loaded=!0,d?this.fire(new c.y(d)):_e&&(this.video=_e,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(st){if(this.video){const d=this.video.seekable;st<d.start(0)||st>d.end(0)?this.fire(new c.y(new c.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${d.start(0)} and ${d.end(0)}-second mark.`))):this.video.currentTime=st}}getVideo(){return this.video}onAdd(st){this.map||(this.map=st,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const st=this.map.painter.context,d=st.gl;this.texture?this.video.paused||(this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE),d.texSubImage2D(d.TEXTURE_2D,0,0,0,d.RGBA,d.UNSIGNED_BYTE,this.video)):(this.texture=new c.T(st,this.video,d.RGBA8),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(st)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:c.aU,model:c.aX,"batched-model":class extends c.E{constructor(st,d,_e,ot){super(),this.type="batched-model",this.id=st,this.tileSize=512,this._options=d,this.tiles=this._options.tiles,this.maxzoom=d.maxzoom||19,this.minzoom=d.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=_e,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(ot)}onAdd(st){this.map=st,this.load()}reload(){this.cancelTileJSONRequest();const st=c.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(st))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(st){this._loaded=!1,this.fire(new c.z("dataloading",{dataType:"source"}));const d=Array.isArray(this.map._language)?this.map._language.join():this.map._language,_e=this.map.getWorldview();this._tileJSONRequest=Jl(this._options,this.map._requestManager,d,_e,(ot,ut)=>{this._tileJSONRequest=null,this._loaded=!0,ot?(d&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${d}`),_e&&_e.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${_e}`),this.fire(new c.y(ot))):ut&&(Object.assign(this,ut),ut.bounds&&(this.tileBounds=new Ip(ut.bounds,this.minzoom,this.maxzoom)),gn(ut.tiles,this.map._requestManager._customAccessToken),this.fire(new c.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.z("data",{dataType:"source",sourceDataType:"content"}))),st&&st(ot)})}hasTransition(){return!1}hasTile(st){return!this.tileBounds||this.tileBounds.contains(st.canonical)}loaded(){return this._loaded}loadTile(st,d){const _e=this.map._requestManager.normalizeTileURL(st.tileID.canonical.url(this.tiles,this.scheme)),ot={request:this.map._requestManager.transformRequest(_e,c.R.Tile),data:void 0,uid:st.uid,tileID:st.tileID,tileZoom:st.tileZoom,zoom:st.tileID.overscaledZ,tileSize:this.tileSize*st.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:st.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:c.o.devicePixelRatio,promoteId:this.promoteId};if(st.actor&&st.state!=="expired")if(st.state==="loading")st.reloadCallback=d;else{if(st.buckets){const mt=Object.values(st.buckets);for(const xt of mt)xt.dirty=!0;return void(st.state="loaded")}st.request=st.actor.send("reloadTile",ot,ut.bind(this))}else st.actor=this.dispatcher.getActor(),st.request=st.actor.send("loadTile",ot,ut.bind(this),void 0,!0);function ut(mt,xt){return st.aborted?d(null):mt&&mt.status!==404?d(mt):(this.map._refreshExpiredTiles&&xt&&st.setExpiryData(xt),st.loadModelData(xt,this.map.painter),st.state="loaded",void d(null))}}serialize(){return Object.assign({},this._options)}},canvas:class extends c.aU{constructor(st,d,_e,ot){super(st,d,_e,ot),d.coordinates?Array.isArray(d.coordinates)&&d.coordinates.length===4&&!d.coordinates.some(ut=>!Array.isArray(ut)||ut.length!==2||ut.some(mt=>typeof mt!="number"))||this.fire(new c.y(new c.V(`sources.${st}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new c.y(new c.V(`sources.${st}`,null,'missing required property "coordinates"'))),d.animate&&typeof d.animate!="boolean"&&this.fire(new c.y(new c.V(`sources.${st}`,null,'optional "animate" property must be a boolean value'))),d.canvas?typeof d.canvas=="string"||d.canvas instanceof HTMLCanvasElement||this.fire(new c.y(new c.V(`sources.${st}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new c.y(new c.V(`sources.${st}`,null,'missing required property "canvas"'))),this.options=d,this.animate=d.animate===void 0||d.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new c.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(st){this.map=st,this.load(),this.canvas&&this.animate&&this.play()}onRemove(st){this.pause()}prepare(){let st=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,st=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,st=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const d=this.map.painter.context;this.texture?!st&&!this._playing||this.texture instanceof c.aW||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new c.T(d,this.canvas,d.gl.RGBA8,{premultiply:!0}),this._prepareData(d)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const st of[this.canvas.width,this.canvas.height])if(isNaN(st)||st<=0)return!0;return!1}},custom:class extends c.E{constructor(st,d,_e,ot){super(),this.id=st,this.type="custom",this._dataType="raster",this._dispatcher=_e,this._implementation=d,this.setEventedParent(ot),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new c.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new c.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Ip(this._implementation.bounds,this.minzoom,this.maxzoom)),d.update=this._update.bind(this),d.clearTiles=this._clearTiles.bind(this),d.coveringTiles=this._coveringTiles.bind(this),Object.assign(this,c.aH(d,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return c.aH(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new c.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(st){this.map=st,this._loaded=!1,this.fire(new c.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(st),this.load()}onRemove(st){this._implementation.onRemove&&this._implementation.onRemove(st)}hasTile(st){if(this._implementation.hasTile){const{x:d,y:_e,z:ot}=st.canonical;return this._implementation.hasTile({x:d,y:_e,z:ot})}return!this.tileBounds||this.tileBounds.contains(st.canonical)}loadTile(st,d){const{x:_e,y:ot,z:ut}=st.tileID.canonical,mt=new AbortController;st.request=Promise.resolve(this._implementation.loadTile({x:_e,y:ot,z:ut},{signal:mt.signal})).then((function(xt){return delete st.request,st.aborted?(st.state="unloaded",d(null)):xt===void 0?(st.state="errored",d(null)):xt===null?(this.loadTileData(st,{width:this.tileSize,height:this.tileSize,data:null}),st.state="loaded",d(null)):function(Tt){return Tt instanceof ImageData||Tt instanceof HTMLCanvasElement||Tt instanceof ImageBitmap||Tt instanceof HTMLImageElement}(xt)?(this.loadTileData(st,xt),st.state="loaded",void d(null)):(st.state="errored",d(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(xt=>{xt.name!=="AbortError"&&(st.state="errored",d(xt))}),st.request.cancel=()=>mt.abort()}loadTileData(st,d){st.setTexture(d,this.map.painter)}unloadTile(st,d){if(st.texture&&st.texture instanceof c.T?(st.destroy(!1),st.texture&&st.texture instanceof c.T&&this.map.painter.saveTileTexture(st.texture)):st.destroy(),this._implementation.unloadTile){const{x:_e,y:ot,z:ut}=st.tileID.canonical;this._implementation.unloadTile({x:_e,y:ot,z:ut})}d&&d()}abortTile(st,d){st.request&&st.request.cancel&&(st.request.cancel(),delete st.request),d&&d()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(st=>({x:st.canonical.x,y:st.canonical.y,z:st.canonical.z}))}_clearTiles(){const st=c.B(this.id,this.scope);this.map.style.clearSource(st)}_update(){this.fire(new c.z("data",{dataType:"source",sourceDataType:"content"}))}}},uo=function(st,d,_e,ot){const ut=new nn[d.type](st,d,_e,ot);if(ut.id!==st)throw new Error(`Expected Source id to be ${st} instead of ${ut.id}`);return c.aY(["load","abort","unload","serialize","prepare"],ut),ut};function Zu(st,d,_e=""){return`${_e}:${d.id||""}:${d.layer.id}:${function(ot){if("layerId"in ot)return`layer:${ot.layerId}`;{const{featuresetId:ut,importId:mt}=ot;return`featureset:${ut}${mt?`:import:${mt}`:""}`}}(st.target)}`}function yp(st,d,_e,ot=""){if(st.uniqueFeatureID){const ut=Zu(st,d,ot);if(_e.has(ut))return!0;_e.add(ut)}return!1}function bx(st,d,_e,ot,ut=!1){const mt=d.sourceCache.transform,xt=d.sourceCache.tilesIn(st,d.has3DLayers,ut);xt.sort(Uo);const Tt=[];for(const kt of xt){const $t=kt.tile.queryRenderedFeatures(d,kt,_e,ot,mt,ut);Object.keys($t).length&&Tt.push({wrappedTileID:kt.tile.tileID.wrapped().key,queryResults:$t})}for(const kt in d.layers){const $t=d.layers[kt];if($t.styleLayer){const Xt=$t.styleLayer.queryRenderedFeatures(st,d.sourceCache,ot);Object.keys(Xt).length&&Tt.push({wrappedTileID:0,queryResults:Xt})}}return Tt.length===0?{}:function(kt){const $t={},Xt={};for(const rr of kt){const tr=rr.queryResults,nr=rr.wrappedTileID,cr=Xt[nr]=Xt[nr]||{};for(const lr in tr){const yr=tr[lr],xr=cr[lr]=cr[lr]||{},Ar=$t[lr]=$t[lr]||[];for(const Dr of yr)xr[Dr.featureIndex]||(xr[Dr.featureIndex]=!0,Ar.push(Dr))}}return $t}(Tt)}function Am(st,d,_e,ot,ut,mt){const xt={},Tt=ot.queryRenderedSymbols(st),kt=[];for(const $t of Object.keys(Tt).map(Number))kt.push(ut[$t]);kt.sort(Uo);for(const $t of kt){const Xt=$t.featureIndex.lookupSymbolFeatures(Tt[$t.bucketInstanceId],$t.bucketIndex,$t.sourceLayerIndex,d,_e,mt);for(const rr in Xt){const tr=xt[rr]=xt[rr]||[],nr=Xt[rr];nr.sort((cr,lr)=>{const yr=$t.featureSortOrder;if(yr){const xr=yr.indexOf(cr.featureIndex);return yr.indexOf(lr.featureIndex)-xr}return lr.featureIndex-cr.featureIndex});for(const cr of nr)tr.push(cr)}}return xt}function Dp(st,d){const _e=st.getRenderableIds().map(mt=>st.getTileByID(mt)),ot=[],ut={};for(let mt=0;mt<_e.length;mt++){const xt=_e[mt],Tt=xt.tileID.canonical.key;ut[Tt]||(ut[Tt]=!0,xt.querySourceFeatures(ot,d))}return ot}function Uo(st,d){const _e=st.tileID,ot=d.tileID;return _e.overscaledZ-ot.overscaledZ||_e.canonical.y-ot.canonical.y||_e.wrap-ot.wrap||_e.canonical.x-ot.canonical.x}function _u(st,d){const _e={};if(!d)return _e;for(const ot of st){const ut=ot.layerIds.map(mt=>d.getLayer(mt)).filter(Boolean);if(ut.length!==0){ot.layers=ut,ot.stateDependentLayerIds&&(ot.stateDependentLayers=ot.stateDependentLayerIds.map(mt=>ut.filter(xt=>xt.id===mt)[0]));for(const mt of ut)_e[mt.fqid]=ot}}return _e}const Ep=32,r0=33,jp=new Uint16Array(8184);for(let st=0;st<2046;st++){let d=st+2,_e=0,ot=0,ut=0,mt=0,xt=0,Tt=0;for(1&d?ut=mt=xt=Ep:_e=ot=Tt=Ep;(d>>=1)>1;){const $t=_e+ut>>1,Xt=ot+mt>>1;1&d?(ut=_e,mt=ot,_e=xt,ot=Tt):(_e=ut,ot=mt,ut=xt,mt=Tt),xt=$t,Tt=Xt}const kt=4*st;jp[kt+0]=_e,jp[kt+1]=ot,jp[kt+2]=ut,jp[kt+3]=mt}const Pp=new Uint16Array(2178),Kp=new Uint8Array(1089),L0=new Uint16Array(1089);function Yu(st){return st===0?-.03125:st===32?.03125:0}const j0={type:2,extent:c.al,loadGeometry:()=>[[new c.P(0,0),new c.P(c.al+1,0),new c.P(c.al+1,c.al+1),new c.P(0,c.al+1),new c.P(0,0)]]};class Fp{constructor(d,_e,ot,ut,mt,xt){this.tileID=d,this.uid=c.b2(),this.uses=0,this.tileSize=_e,this.tileZoom=ot,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=mt,ut&&ut.style&&(this._lastUpdatedBrightness=ut.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",ut&&ut.transform&&(this.projection=ut.transform.projection),this.worldview=xt,this._hasAppearances=null}registerFadeDuration(d){const _e=d+this.timeAdded;_e<c.o.now()||this.fadeEndTime&&_e<this.fadeEndTime||(this.fadeEndTime=_e)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=c.aZ(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(d,_e,ot){if(this.unloadVectorData(),this.state="loaded",d){d.featureIndex&&(this.latestFeatureIndex=d.featureIndex,d.rawTileData?(this.latestRawTileData=d.rawTileData,this.latestFeatureIndex.rawTileData=d.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=d.collisionBoxArray,this.buckets=_u(d.buckets,_e.style),this.hasSymbolBuckets=!1;for(const ut in this.buckets){const mt=this.buckets[ut];if(mt instanceof c.b4){if(this.hasSymbolBuckets=!0,!ot)break;mt.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const ut in this.buckets){const mt=this.buckets[ut];if(mt instanceof c.b4&&mt.hasRTLText){this.hasRTLText=!0,c.b5();break}}this.queryPadding=0;for(const ut in this.buckets){const mt=this.buckets[ut],xt=_e.style.getOwnLayer(ut);if(!xt)continue;const Tt=xt.queryRadius(mt);this.queryPadding=Math.max(this.queryPadding,Tt)}d.imageAtlas&&(this.imageAtlas=d.imageAtlas),d.glyphAtlasImage&&(this.glyphAtlasImage=d.glyphAtlasImage),d.lineAtlas&&(this.lineAtlas=d.lineAtlas),this._lastUpdatedBrightness=d.brightness}else this.collisionBoxArray=new c.b3}unloadVectorData(){if(this.hasData()){for(const d in this.buckets)this.buckets[d].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(d,_e,ot){d&&(d.resourceTiming&&(this.resourceTiming=d.resourceTiming),this.buckets=Object.assign({},this.buckets,_u(d.buckets,_e.style)),d.featureIndex&&(this.latestFeatureIndex=d.featureIndex))}getBucket(d){return this.buckets[d.fqid]}upload(d,_e){for(const mt in this.buckets){const xt=this.buckets[mt];if(xt.uploadPending()){let Tt={},kt=[],$t={zoom:0,pitch:0,brightness:0,worldview:""};if(_e){if(_e.style){kt=_e.style.listImages();const Xt=xt.layers[0],rr=Xt.sourceLayer||"_geojsonTileLayer",tr=_e.style.getLayerSourceCache(Xt);tr&&(Tt=tr._state.getState(rr,void 0))}$t={zoom:_e.transform.zoom||0,pitch:_e.transform.pitch||0,brightness:_e.style.getBrightness()||0,worldview:_e.worldview||""}}xt.upload(d,this.tileID.canonical,Tt,kt,$t)}}const ot=d.gl,ut=this.imageAtlas;ut&&!ut.uploaded&&(this.imageAtlasTexture=new c.T(d,ut.image,ot.RGBA8,{useMipmap:!!ut.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new c.T(d,this.glyphAtlasImage,ot.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new c.T(d,this.lineAtlas.image,ot.R8),this.lineAtlas.uploaded=!0)}prepare(d,_e,ot){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(d,this.imageAtlasTexture,ot),!_e||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const ut=_e.style.getBrightness();this._hasAppearances===null&&(this._hasAppearances=this.hasAppearances(_e)),(this._lastUpdatedBrightness||ut||this._hasAppearances)&&(!this._hasAppearances&&this._lastUpdatedBrightness&&ut&&Math.abs(this._lastUpdatedBrightness-ut)<.001||(this.updateBuckets(_e,this._lastUpdatedBrightness!==ut),this._lastUpdatedBrightness=ut))}evaluateQueryRenderedFeaturePadding(){let d=0;for(const _e in this.buckets){const ot=this.buckets[_e];ot.evaluateQueryRenderedFeaturePadding&&(d=Math.max(d,ot.evaluateQueryRenderedFeaturePadding()))}return d}queryRenderedFeatures(d,_e,ot,ut,mt,xt){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const Tt=this.evaluateQueryRenderedFeaturePadding(),kt=function($t,Xt){const rr=c.bq([],[.5*$t.width,.5*-$t.height,1]);return c.br(rr,rr,[1,-1,0]),c.aB(rr,rr,$t.calculateProjMatrix(Xt.toUnwrapped())),Float32Array.from(rr)}(mt,this.tileID);return this.latestFeatureIndex.query(d,{tilespaceGeometry:_e,pixelPosMatrix:kt,transform:ut,availableImages:ot,tileTransform:this.tileTransform,worldview:this.worldview,queryRadius:Tt})}querySourceFeatures(d,_e){const ot=this.latestFeatureIndex;if(!ot||!ot.rawTileData)return;const ut=ot.loadVTLayers(),mt=_e?_e.sourceLayer:"",xt=ut._geojsonTileLayer||ut[mt];if(!xt)return;const Tt=c.b6(_e&&_e.filter),{z:kt,x:$t,y:Xt}=this.tileID.canonical,rr={z:kt,x:$t,y:Xt};for(let tr=0;tr<xt.length;tr++){const nr=xt.feature(tr);if(Tt.needGeometry){const yr=c.b7(nr,!0);if(!Tt.filter(new c.ac(this.tileID.overscaledZ,{worldview:this.worldview}),yr,this.tileID.canonical))continue}else if(!Tt.filter(new c.ac(this.tileID.overscaledZ,{worldview:this.worldview}),nr))continue;const cr=ot.getId(nr,mt),lr=new c.b8(nr,kt,$t,Xt,cr);lr.tile=rr,d.push(lr)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(d){const _e=this.expirationTime;if(d.cacheControl){const ot=c.b9(d.cacheControl);ot["max-age"]&&(this.expirationTime=Date.now()+1e3*ot["max-age"])}else d.expires&&(this.expirationTime=new Date(d.expires).getTime());if(this.expirationTime){const ot=Date.now();let ut=!1;if(this.expirationTime>ot)ut=!1;else if(_e)if(this.expirationTime<_e)ut=!0;else{const mt=this.expirationTime-_e;mt?this.expirationTime=ot+Math.max(mt,3e4):ut=!0}else ut=!0;ut?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(d){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&d&&this.updateBuckets(d)}hasAppearances(d){for(const _e in this.buckets)if(d.style.hasLayer(_e)&&this.buckets[_e].layers.some(ot=>ot.appearances&&ot.appearances.length>0))return!0;return!1}updateBuckets(d,_e){if(!this.latestFeatureIndex||!d.style)return;const ot=d.style.listImages(),ut=d.style.getBrightness();for(const mt in this.buckets){if(!d.style.hasLayer(mt))continue;const xt=this.buckets[mt],Tt=xt.layers[0],kt=Tt.sourceLayer||"_geojsonTileLayer",$t=d.style.getLayerSourceCache(Tt);let Xt={};$t&&(Xt=$t._state.getState(kt,void 0));const rr=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},tr=Object.keys(Xt).length>0&&!_e;xt.hasAppearances=xt.layers.some(lr=>lr.appearances&&lr.appearances.length>0);const nr=tr?xt.stateDependentLayers:xt.layers;if(tr&&xt.stateDependentLayers.length!==0||_e){const lr=this.latestFeatureIndex.loadVTLayers();xt.update(Xt,lr[kt],ot,rr,nr,_e,ut)}if(tr&&xt.stateDependentLayers.length!==0||_e||xt.hasAppearances){const lr={zoom:d.transform.zoom,pitch:d.transform.pitch,brightness:d.style.getBrightness()||0,worldview:d.worldview};xt.updateAppearances(this.tileID.canonical,Xt,ot,lr)}(xt instanceof c.ba||xt instanceof c.bb)&&d._terrain&&d._terrain.enabled&&$t&&xt.uploadPending()&&d._terrain._clearRenderCacheForTile($t.id,this.tileID);const cr=d&&d.style&&d.style.getOwnLayer(mt);cr&&(this.queryPadding=Math.max(this.queryPadding,cr.queryRadius(xt)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<c.o.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(d){this.symbolFadeHoldUntil=c.o.now()+d}setTexture(d,_e){const ot=_e.context,ut=ot.gl;this.texture=this.texture||_e.getTileTexture(d.width),this.texture&&this.texture instanceof c.T?this.texture.update(d):(this.texture=new c.T(ot,d,ut.RGBA8,{useMipmap:!0}),this.texture.bind(ut.LINEAR,ut.CLAMP_TO_EDGE))}setDependencies(d,_e){const ot={};for(const ut of _e)ot[ut]=!0;this.dependencies[d]=ot}hasDependency(d,_e){for(const ot of d){const ut=this.dependencies[ot];if(ut){for(const mt of _e)if(ut[mt])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(d,_e){if(!_e||_e.name==="mercator"||this._tileDebugBuffer)return;const ot=c.bc(j0,this.tileID.canonical,this.tileTransform)[0],ut=new c.bd,mt=new c.be;for(let xt=0;xt<ot.length;xt++){const{x:Tt,y:kt}=ot[xt];ut.emplaceBack(Tt,kt),mt.emplaceBack(xt)}mt.emplaceBack(0),this._tileDebugIndexBuffer=d.createIndexBuffer(mt),this._tileDebugBuffer=d.createVertexBuffer(ut,c.bf.members),this._tileDebugSegments=c.bg.simpleSegment(0,0,ut.length,mt.length)}_makeTileBoundsBuffers(d,_e){if(this._tileBoundsBuffer||!_e||_e.name==="mercator")return;const ot=c.bc(j0,this.tileID.canonical,this.tileTransform)[0];let ut,mt;if(this.isRaster){const xt=function(Tt,kt){const $t=c.aZ(Tt,kt),Xt=Math.pow(2,Tt.z);for(let yr=0;yr<r0;yr++)for(let xr=0;xr<r0;xr++){const Ar=c.a_((Tt.x+(xr+Yu(xr))/Ep)/Xt),Dr=c.a$((Tt.y+(yr+Yu(yr))/Ep)/Xt),Tr=kt.project(Ar,Dr),Wr=yr*r0+xr;Pp[2*Wr+0]=Math.round((Tr.x*$t.scale-$t.x)*c.al),Pp[2*Wr+1]=Math.round((Tr.y*$t.scale-$t.y)*c.al)}Kp.fill(0),L0.fill(0);for(let yr=2045;yr>=0;yr--){const xr=4*yr,Ar=jp[xr+0],Dr=jp[xr+1],Tr=jp[xr+2],Wr=jp[xr+3],zr=Ar+Tr>>1,$r=Dr+Wr>>1,Or=zr+$r-Dr,Br=$r+Ar-zr,Xr=Dr*r0+Ar,an=Wr*r0+Tr,sn=$r*r0+zr,wn=Math.hypot((Pp[2*Xr+0]+Pp[2*an+0])/2-Pp[2*sn+0],(Pp[2*Xr+1]+Pp[2*an+1])/2-Pp[2*sn+1])>=16;Kp[sn]=Kp[sn]||(wn?1:0),yr<1022&&(Kp[sn]=Kp[sn]||Kp[(Dr+Br>>1)*r0+(Ar+Or>>1)]||Kp[(Wr+Br>>1)*r0+(Tr+Or>>1)])}const rr=new c.b1,tr=new c.b0;let nr=0;function cr(yr,xr){const Ar=xr*r0+yr;return L0[Ar]===0&&(rr.emplaceBack(Pp[2*Ar+0],Pp[2*Ar+1],yr*c.al/Ep,xr*c.al/Ep),L0[Ar]=++nr),L0[Ar]-1}function lr(yr,xr,Ar,Dr,Tr,Wr){const zr=yr+Ar>>1,$r=xr+Dr>>1;if(Math.abs(yr-Tr)+Math.abs(xr-Wr)>1&&Kp[$r*r0+zr])lr(Tr,Wr,yr,xr,zr,$r),lr(Ar,Dr,Tr,Wr,zr,$r);else{const Or=cr(yr,xr),Br=cr(Ar,Dr),Xr=cr(Tr,Wr);tr.emplaceBack(Or,Br,Xr)}}return lr(0,0,Ep,Ep,Ep,0),lr(Ep,Ep,0,0,0,Ep),{vertices:rr,indices:tr}}(this.tileID.canonical,_e);ut=xt.vertices,mt=xt.indices}else{ut=new c.b1,mt=new c.b0;for(const{x:Tt,y:kt}of ot)ut.emplaceBack(Tt,kt,0,0);const xt=c.bh(ut.int16.subarray(0,4*ut.length),void 0,4);for(let Tt=0;Tt<xt.length;Tt+=3)mt.emplaceBack(xt[Tt],xt[Tt+1],xt[Tt+2])}this._tileBoundsBuffer=d.createVertexBuffer(ut,c.bi.members),this._tileBoundsIndexBuffer=d.createIndexBuffer(mt),this._tileBoundsSegments=c.bg.simpleSegment(0,0,ut.length,mt.length)}_makeGlobeTileDebugBuffers(d,_e){const ot=_e.projection;if(!ot||ot.name!=="globe"||_e.freezeTileCoverage)return;const ut=this.tileID.canonical,mt=c.bj(ut,_e),xt=c.bk(mt),Tt=c.aj(_e.zoom);let kt;Tt>0&&(kt=c.bl(new Float64Array(16),_e.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(d,ut,_e,xt,kt,Tt),this._makeGlobeTileDebugTextBuffer(d,ut,_e,xt,kt,Tt)}_globePoint(d,_e,ot,ut,mt,xt,Tt){let kt=c.bm(d,_e,ot);if(xt){const $t=1<<ot.z,Xt=c.aF(ut.center.lng),rr=c.aJ(ut.center.lat),tr=(ot.x+.5)/$t-Xt;let nr=0;tr>.5?nr=-1:tr<-.5&&(nr=1);let cr=(d/c.al+ot.x)/$t+nr,lr=(_e/c.al+ot.y)/$t;cr=(cr-Xt)*ut._pixelsPerMercatorPixel+Xt,lr=(lr-rr)*ut._pixelsPerMercatorPixel+rr;const yr=[cr*ut.worldSize,lr*ut.worldSize,0];c.af(yr,yr,xt),kt=c.bn(kt,yr,Tt)}return c.af(kt,kt,mt)}_makeGlobeTileDebugBorderBuffer(d,_e,ot,ut,mt,xt){const Tt=new c.bd,kt=new c.be,$t=new c.bo,Xt=(tr,nr,cr,lr,yr)=>{const xr=(cr-tr)/(yr-1),Ar=(lr-nr)/(yr-1),Dr=Tt.length;for(let Tr=0;Tr<yr;Tr++){const Wr=tr+Tr*xr,zr=nr+Tr*Ar;Tt.emplaceBack(Wr,zr);const $r=this._globePoint(Wr,zr,_e,ot,ut,mt,xt);$t.emplaceBack($r[0],$r[1],$r[2]),kt.emplaceBack(Dr+Tr)}},rr=c.al;Xt(0,0,rr,0,16),Xt(rr,0,rr,rr,16),Xt(rr,rr,0,rr,16),Xt(0,rr,0,0,16),this._tileDebugIndexBuffer=d.createIndexBuffer(kt),this._tileDebugBuffer=d.createVertexBuffer(Tt,c.bf.members),this._globeTileDebugBorderBuffer=d.createVertexBuffer($t,c.bp.members),this._tileDebugSegments=c.bg.simpleSegment(0,0,Tt.length,kt.length)}_makeGlobeTileDebugTextBuffer(d,_e,ot,ut,mt,xt){const Tt=c.al/4,kt=new c.bd,$t=new c.b0,Xt=new c.bo,rr=25;$t.reserve(32),kt.reserve(rr),Xt.reserve(rr);const tr=(nr,cr)=>rr*nr+cr;for(let nr=0;nr<rr;nr++){const cr=nr*Tt;for(let lr=0;lr<rr;lr++){const yr=lr*Tt;kt.emplaceBack(yr,cr);const xr=this._globePoint(yr,cr,_e,ot,ut,mt,xt);Xt.emplaceBack(xr[0],xr[1],xr[2])}}for(let nr=0;nr<4;nr++)for(let cr=0;cr<4;cr++){const lr=tr(nr,cr),yr=tr(nr,cr+1),xr=tr(nr+1,cr),Ar=tr(nr+1,cr+1);$t.emplaceBack(lr,yr,xr),$t.emplaceBack(xr,yr,Ar)}this._tileDebugTextIndexBuffer=d.createIndexBuffer($t),this._tileDebugTextBuffer=d.createVertexBuffer(kt,c.bf.members),this._globeTileDebugTextBuffer=d.createVertexBuffer(Xt,c.bp.members),this._tileDebugTextSegments=c.bg.simpleSegment(0,0,rr,32)}destroy(d=!0){for(const _e in this.buckets)this.buckets[_e].destroy(d);this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),d&&this.texture&&this.texture instanceof c.T&&(this.texture.destroy(),delete this.texture),this.emissiveTexture&&this.emissiveTexture instanceof c.T&&(this.emissiveTexture.destroy(),delete this.emissiveTexture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}c.bs.setPbf(c.bt);class _a extends Fp{constructor(d,_e,ot,ut,mt){super(d,_e,ot,ut,mt),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._taskQueue=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(d){return this._mrt&&this._mrt.getLayer(d)}setTexturePerLayer(d,_e,ot){const ut=ot.context,mt=ut.gl;let xt=this.texturePerLayer.get(d)||ot.getTileTexture(_e.width);xt&&xt instanceof c.T?xt.update(_e,{premultiply:!1}):xt=new c.T(ut,_e,mt.RGBA8,{premultiply:!1}),this.texturePerLayer.has(d)||this.texturePerLayer.set(d,xt)}flushQueues(d){const _e=this._workQueuePerLayer.get(d)||[],ot=this._fetchQueuePerLayer.get(d)||[];for(;_e.length;)_e.pop()();for(;ot.length;)ot.pop()()}flushAllQueues(){for(const d of this._workQueuePerLayer.keys()){const _e=this._workQueuePerLayer.get(d)||[];for(;_e.length;)_e.pop()()}for(const d of this._fetchQueuePerLayer.keys()){const _e=this._fetchQueuePerLayer.get(d)||[];for(;_e.length;)_e.pop()()}}fetchHeader(d=16384,_e){const ot=this._mrt=new c.bs(30),ut=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(d-1)}});return this.entireBuffer=null,this.request=c.bu(ut,(mt,xt,Tt)=>{if(mt)_e(mt);else try{const kt=ot.getHeaderLength(xt);if(kt>d)return void(this.request=this.fetchHeader(kt,_e));ot.parseHeader(xt),this._isHeaderLoaded=!0;let $t=0;for(const Xt of Object.values(ot.layers))$t=Math.max($t,Xt.dataIndex[Xt.dataIndex.length-1].lastByte);xt.byteLength>=$t&&(this.entireBuffer=xt),_e(null,this.entireBuffer||xt,Tt)}catch(kt){_e(kt)}}),this.request}fetchBandForRender(d,_e,ot,ut){this.fetchBand(d,_e,ot,mt=>{if(mt)return void ut(mt);this.updateTextureDescriptor(d,_e,ot);const xt=this.textureDescriptorPerLayer.get(_e);ut(null,xt?xt.img:null)})}fetchBand(d,_e,ot,ut,mt=!0){const xt=this._mrt;if(!this._isHeaderLoaded||!xt)return void ut(new Error("Tile header is not ready"));const Tt=this.actor;if(!Tt)return void ut(new Error("Can't fetch tile band without an actor"));let kt;const $t=c.B(String(ot),c.B(this.tileID.key,d));let Xt=this._taskQueue.get($t);Xt?Xt.add(ut):(Xt=new Set,Xt.add(ut),this._taskQueue.set($t,Xt));const rr=(lr,yr)=>{kt.complete(lr,yr),lr?ut(lr):(Xt.forEach(xr=>xr(null,yr)),this._taskQueue.delete($t))},tr=(lr,yr)=>{if(lr)return ut(lr);const xr=Tt.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:yr,task:kt},rr,void 0,!0);if(_e!==null){const Ar=this._workQueuePerLayer.get(_e)||[];Ar.push(()=>{xr&&xr.cancel(),kt.cancel()}),this._workQueuePerLayer.has(_e)||this._workQueuePerLayer.set(_e,Ar)}};let nr;try{nr=xt.getLayer(d)}catch(lr){if(this.state==="reloading")return;throw lr}if(!nr)return void ut(new Error(`Unknown sourceLayer "${d}"`));if(nr.hasDataForBand(ot))return Xt.forEach(lr=>lr(null,null)),void this._taskQueue.delete($t);const cr=nr.getDataRange([ot]);if(kt=xt.createDecodingTask(cr),!kt||kt.tasks.length)if(_e!==null&&this.flushQueues(_e),this.entireBuffer)tr(null,this.entireBuffer.slice(cr.firstByte,cr.lastByte+1));else{const lr=Object.assign({},this.requestParams,{headers:{Range:`bytes=${cr.firstByte}-${cr.lastByte}`}}),yr=c.bu(lr,tr);if(_e!==null){const xr=this._fetchQueuePerLayer.get(_e)||[];xr.push(()=>{yr.cancel(),kt.cancel()}),this._fetchQueuePerLayer.has(_e)||this._fetchQueuePerLayer.set(_e,xr)}}}updateNeeded(d,_e){return(!this.textureDescriptorPerLayer.get(d)||this.textureDescriptorPerLayer.get(d).band!==_e||this.refreshedUponExpiration)&&this.state!=="errored"}updateTextureDescriptor(d,_e,ot){if(!this._mrt)return;const ut=this._mrt.getLayer(d);if(!ut||!ut.hasBand(ot)||!ut.hasDataForBand(ot))return;const{bytes:mt,tileSize:xt,buffer:Tt,offset:kt,scale:$t}=ut.getBandView(ot),Xt=xt+2*Tt,rr=new c.q({width:Xt,height:Xt},mt),tr=this.texturePerLayer.get(_e);tr&&tr instanceof c.T&&tr.update(rr,{premultiply:!1}),this.textureDescriptorPerLayer.set(_e,{layer:d,band:ot,img:rr,buffer:Tt,offset:kt,tileSize:xt,format:ut.pixelFormat,mix:[$t,256*$t,65536*$t,16777216*$t]})}destroy(d=!1){if(super.destroy(d),delete this._mrt,!d)for(const _e of this.texturePerLayer.values())_e&&_e instanceof c.T&&_e.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1}}class Y1{constructor(d,_e){this.max=d,this.onRemove=_e,this.reset()}reset(){for(const d in this.data)for(const _e of this.data[d])_e.timeout&&clearTimeout(_e.timeout),this.onRemove(_e.value);return this.data={},this.order=[],this}add(d,_e,ot){const ut=d.wrapped().key;this.data[ut]===void 0&&(this.data[ut]=[]);const mt={value:_e,timeout:void 0};if(ot!==void 0&&(mt.timeout=setTimeout(()=>{this.remove(d,mt)},ot)),this.data[ut].push(mt),this.order.push(ut),this.order.length>this.max){const xt=this._getAndRemoveByKey(this.order[0]);xt&&this.onRemove(xt)}return this}has(d){return d.wrapped().key in this.data}getAndRemove(d){return this.has(d)?this._getAndRemoveByKey(d.wrapped().key):null}_getAndRemoveByKey(d){const _e=this.data[d].shift();return _e.timeout&&clearTimeout(_e.timeout),this.data[d].length===0&&delete this.data[d],this.order.splice(this.order.indexOf(d),1),_e.value}getByKey(d){const _e=this.data[d];return _e?_e[0].value:null}get(d){return this.has(d)?this.data[d.wrapped().key][0].value:null}remove(d,_e){if(!this.has(d))return this;const ot=d.wrapped().key,ut=_e===void 0?0:this.data[ot].indexOf(_e),mt=this.data[ot][ut];return this.data[ot].splice(ut,1),mt.timeout&&clearTimeout(mt.timeout),this.data[ot].length===0&&delete this.data[ot],this.onRemove(mt.value),this.order.splice(this.order.indexOf(ot),1),this}setMaxSize(d){for(this.max=d;this.order.length>this.max;){const _e=this._getAndRemoveByKey(this.order[0]);_e&&this.onRemove(_e)}return this}filter(d){const _e=[];for(const ot in this.data)for(const ut of this.data[ot])d(ut.value)||_e.push(ut);for(const ot of _e)this.remove(ot.value.tileID,ot)}}class Bl{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(d,_e,ot){const ut=String(_e);if(this.stateChanges[d]=this.stateChanges[d]||{},this.stateChanges[d][ut]=this.stateChanges[d][ut]||{},Object.assign(this.stateChanges[d][ut],ot),this.deletedStates[d]===null){this.deletedStates[d]={};for(const mt in this.state[d])mt!==ut&&(this.deletedStates[d][mt]=null)}else if(this.deletedStates[d]&&this.deletedStates[d][ut]===null){this.deletedStates[d][ut]={};for(const mt in this.state[d][ut])ot[mt]||(this.deletedStates[d][ut][mt]=null)}else for(const mt in ot)this.deletedStates[d]&&this.deletedStates[d][ut]&&this.deletedStates[d][ut][mt]===null&&delete this.deletedStates[d][ut][mt]}removeFeatureState(d,_e,ot){if(this.deletedStates[d]===null)return;const ut=String(_e);if(this.deletedStates[d]=this.deletedStates[d]||{},ot&&_e!==void 0)this.deletedStates[d][ut]!==null&&(this.deletedStates[d][ut]=this.deletedStates[d][ut]||{},this.deletedStates[d][ut][ot]=null);else if(_e!==void 0)if(this.stateChanges[d]&&this.stateChanges[d][ut])for(ot in this.deletedStates[d][ut]={},this.stateChanges[d][ut])this.deletedStates[d][ut][ot]=null;else this.deletedStates[d][ut]=null;else this.deletedStates[d]=null}getState(d,_e){const ot=this.state[d]||{},ut=this.stateChanges[d]||{},mt=this.deletedStates[d];if(mt===null)return{};if(_e!==void 0){const Tt=String(_e),kt=Object.assign({},ot[Tt],ut[Tt]);if(mt){const $t=mt[_e];if($t===null)return{};for(const Xt in $t)delete kt[Xt]}return kt}const xt=Object.assign({},ot,ut);if(mt)for(const Tt in mt)delete xt[Tt];return xt}initializeTileState(d,_e){d.refreshFeatureState(_e)}coalesceChanges(d,_e){const ot={};for(const ut in this.stateChanges){this.state[ut]=this.state[ut]||{};const mt={};for(const xt in this.stateChanges[ut])this.state[ut][xt]||(this.state[ut][xt]={}),Object.assign(this.state[ut][xt],this.stateChanges[ut][xt]),mt[xt]=this.state[ut][xt];ot[ut]=mt}for(const ut in this.deletedStates){this.state[ut]=this.state[ut]||{};const mt={};if(this.deletedStates[ut]===null)for(const xt in this.state[ut])mt[xt]={},this.state[ut][xt]={};else for(const xt in this.deletedStates[ut]){if(this.deletedStates[ut][xt]===null)this.state[ut][xt]={};else if(this.state[ut][xt])for(const Tt of Object.keys(this.deletedStates[ut][xt]))delete this.state[ut][xt][Tt];mt[xt]=this.state[ut][xt]}ot[ut]=ot[ut]||{},Object.assign(ot[ut],mt)}if(this.stateChanges={},this.deletedStates={},Object.keys(ot).length!==0)for(const ut in d)d[ut].refreshFeatureState(_e)}}class Du extends c.E{constructor(d,_e,ot){super(),this.id=d,this._onlySymbols=ot,_e.on("data",ut=>{ut.dataType==="source"&&ut.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&ut.dataType==="source"&&ut.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),_e.on("error",()=>{this._sourceErrored=!0}),this._source=_e,this._tiles={},this._cache=new Y1(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=_e.minTileCacheSize,this._maxTileCacheSize=_e.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Bl,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(d){this.map=d,this._minTileCacheSize=this._minTileCacheSize===void 0&&d?d._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&d?d._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const d in this._tiles)if(!this._tiles[d].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const d=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,d&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(d,_e){return d.isSymbolTile=this._onlySymbols,d.isExtraShadowCaster=this._shadowCasterTiles[d.tileID.key],this._source.loadTile(d,_e)}_unloadTile(d){if(this._source.unloadTile)return this._source.unloadTile(d)}_abortTile(d){if(this._source.abortTile)return this._source.abortTile(d)}serialize(){return this._source.serialize()}prepare(d){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const _e in this._tiles){const ot=this._tiles[_e];ot.upload(d,this.map?this.map.painter:void 0),ot.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(d=>d.tileID).sort(wx).map(d=>d.key)}getRenderableIds(d,_e){const ot=[];for(const ut in this._tiles)this._isIdRenderable(+ut,d,_e)&&ot.push(this._tiles[ut]);return d?ot.sort((ut,mt)=>{const xt=ut.tileID,Tt=mt.tileID,kt=new c.P(xt.canonical.x,xt.canonical.y)._rotate(this.transform.angle),$t=new c.P(Tt.canonical.x,Tt.canonical.y)._rotate(this.transform.angle);return xt.overscaledZ-Tt.overscaledZ||$t.y-kt.y||$t.x-kt.x}).map(ut=>ut.tileID.key):ot.map(ut=>ut.tileID).sort(wx).map(ut=>ut.key)}hasRenderableParent(d){const _e=this.findLoadedParent(d,0);return!!_e&&this._isIdRenderable(_e.tileID.key)}_isIdRenderable(d,_e,ot){return this._tiles[d]&&this._tiles[d].hasData()&&!this._coveredTiles[d]&&(_e||!this._tiles[d].holdingForFade())&&(ot||!this._shadowCasterTiles[d])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const d in this._tiles)this._tiles[d].state!=="errored"&&this._reloadTile(+d,"reloading")}}_reloadTile(d,_e){const ot=this._tiles[d];ot&&(ot.state!=="loading"&&(ot.state=_e),this._loadTile(ot,this._tileLoaded.bind(this,ot,d,_e)))}_tileLoaded(d,_e,ot,ut,mt){if(ut){if(d.state="errored",ut.status!==404)this._source.fire(new c.y(ut,{tile:d}));else{if(this._source.fire(new c.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:d})),!(d.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const Tt=this.map.painter.terrain;this.update(this.transform,Tt.getScaledDemTileSize(),!0),Tt.resetTileLookupCache(this.id)}else this.update(this.transform)}return}d.timeAdded=c.o.now(),ot==="expired"&&(d.refreshedUponExpiration=!0),this._setTileReloadTimer(_e,d),this._source.type==="raster-dem"&&d.dem&&this._backfillDEM(d),this._state.initializeTileState(d,this.map?this.map.painter:null);let xt=new Map;mt&&mt.responseHeaders&&(xt=mt.responseHeaders),this._source.fire(new c.z("data",{dataType:"source",tile:d,coord:d.tileID,sourceCacheId:this.id,responseHeaders:xt}))}_backfillDEM(d){const _e=this.getRenderableIds();for(let ut=0;ut<_e.length;ut++){const mt=_e[ut];if(d.neighboringTiles&&d.neighboringTiles[mt]){const xt=this.getTileByID(mt);ot(d,xt),ot(xt,d)}}function ot(ut,mt){if(!ut.dem||ut.dem.borderReady)return;ut.needsHillshadePrepare=!0,ut.needsDEMTextureUpload=!0;let xt=mt.tileID.canonical.x-ut.tileID.canonical.x;const Tt=mt.tileID.canonical.y-ut.tileID.canonical.y,kt=Math.pow(2,ut.tileID.canonical.z),$t=mt.tileID.key;xt===0&&Tt===0||Math.abs(Tt)>1||(Math.abs(xt)>1&&(Math.abs(xt+kt)===1?xt+=kt:Math.abs(xt-kt)===1&&(xt-=kt)),mt.dem&&ut.dem&&(ut.dem.backfillBorder(mt.dem,xt,Tt),ut.neighboringTiles&&ut.neighboringTiles[$t]&&(ut.neighboringTiles[$t].backfilled=!0)))}}getTile(d){return this.getTileByID(d.key)}getTileByID(d){return this._tiles[d]}_retainLoadedChildren(d,_e,ot,ut){for(const mt in this._tiles){let xt=this._tiles[mt];if(ut[mt]||!xt.hasData()||xt.tileID.overscaledZ<=_e||xt.tileID.overscaledZ>ot)continue;let Tt=xt.tileID;for(;xt&&xt.tileID.overscaledZ>_e+1;){const $t=xt.tileID.scaledTo(xt.tileID.overscaledZ-1);xt=this._tiles[$t.key],xt&&xt.hasData()&&(Tt=$t)}let kt=Tt;for(;kt.overscaledZ>_e;)if(kt=kt.scaledTo(kt.overscaledZ-1),d[kt.key]){ut[Tt.key]=Tt;break}}}findLoadedParent(d,_e){if(d.key in this._loadedParentTiles){const ot=this._loadedParentTiles[d.key];return ot&&ot.tileID.overscaledZ>=_e?ot:null}for(let ot=d.overscaledZ-1;ot>=_e;ot--){const ut=d.scaledTo(ot),mt=this._getLoadedTile(ut);if(mt)return mt}}_getLoadedTile(d){const _e=this._tiles[d.key];return _e&&_e.hasData()?_e:this._cache.getByKey(this._source.reparseOverscaled?d.wrapped().key:d.canonical.key)}updateCacheSize(d,_e){_e=_e||this._source.tileSize;const ot=Math.ceil(d.width/_e)+1,ut=Math.ceil(d.height/_e)+1,mt=Math.floor(ot*ut*5),xt=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,mt):mt,Tt=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,xt):xt;this._cache.setMaxSize(Tt)}handleWrapJump(d){const _e=Math.round((d-(this._prevLng===void 0?d:this._prevLng))/360);if(this._prevLng=d,_e){const ot={};for(const ut in this._tiles){const mt=this._tiles[ut];mt.tileID=mt.tileID.unwrapTo(mt.tileID.wrap+_e),ot[mt.tileID.key]=mt}this._tiles=ot;for(const ut in this._timers)clearTimeout(this._timers[ut]),delete this._timers[ut];for(const ut in this._tiles)this._setTileReloadTimer(+ut,this._tiles[ut])}}update(d,_e,ot,ut,mt){if(this.transform=d,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!ot)return;this.updateCacheSize(d,_e),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const xt=this._source.type==="batched-model";let Tt,kt=this._source.maxzoom;const $t=this.map&&this.map.painter?this.map.painter._terrain:null;if($t&&$t.sourceCache===this&&$t.attenuationRange()){const tr=$t.attenuationRange()[0],nr=Math.floor(tr)-Math.log2($t.getDemUpscale());kt>nr&&(kt=nr)}if(this.used||this.usedForTerrain){if(this._source.tileID)Tt=d.getVisibleUnwrappedCoordinates(this._source.tileID).map(tr=>new c.aQ(tr.canonical.z,tr.wrap,tr.canonical.z,tr.canonical.x,tr.canonical.y));else if(this.tileCoverLift!==0){const tr=d.clone();tr.tileCoverLift=this.tileCoverLift,Tt=tr.coveringTiles({tileSize:_e||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:kt,roundZoom:this._source.roundZoom&&!ot,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:xt}),this._source.minzoom<=1&&d.projection.name==="globe"&&(Tt.push(new c.aQ(1,0,1,0,0)),Tt.push(new c.aQ(1,0,1,1,0)),Tt.push(new c.aQ(1,0,1,0,1)),Tt.push(new c.aQ(1,0,1,1,1)))}else if(Tt=d.coveringTiles({tileSize:_e||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:kt,roundZoom:this._source.roundZoom&&!ot,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:xt}),this._source.hasTile){const tr=this._source.hasTile.bind(this._source);Tt=Tt.filter(nr=>tr(nr))}}else Tt=[];if(Tt.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!R0(this._source.type)){const tr=d.coveringZoomLevel({tileSize:_e||this._source.tileSize,roundZoom:this._source.roundZoom&&!ot}),nr=Math.min(tr,this._source.maxzoom);if(xt){const cr=d.extendTileCover(Tt,nr);for(const lr of cr)Tt.push(lr)}else if(mt){const cr=d.extendTileCoverToNearPlane(Tt,this.transform.getFrustum(nr),nr);for(const lr of cr)Tt.push(lr)}else if(this.castsShadows&&ut){const cr=d.extendTileCover(Tt,nr,ut,16);for(const lr of cr)this._shadowCasterTiles[lr.key]=!0,Tt.push(lr)}}const Xt=this._updateRetainedTiles(Tt);if(R0(this._source.type)&&Tt.length!==0){const tr={},nr={},cr=Object.keys(Xt);for(const yr of cr){const xr=Xt[yr],Ar=this._tiles[yr];if(!Ar||Ar.fadeEndTime&&Ar.fadeEndTime<=c.o.now())continue;const Dr=this.findLoadedParent(xr,Math.max(xr.overscaledZ-Du.maxOverzooming,this._source.minzoom));Dr&&(this._addTile(Dr.tileID),tr[Dr.tileID.key]=Dr.tileID),nr[yr]=xr}const lr=Tt[Tt.length-1].overscaledZ;for(const yr in this._tiles){const xr=this._tiles[yr];if(Xt[yr]||!xr.hasData())continue;let Ar=xr.tileID;for(;Ar.overscaledZ>lr;){Ar=Ar.scaledTo(Ar.overscaledZ-1);const Dr=this._tiles[Ar.key];if(Dr&&Dr.hasData()&&nr[Ar.key]){Xt[yr]=xr.tileID;break}}}for(const yr in tr)Xt[yr]||(this._coveredTiles[yr]=!0,Xt[yr]=tr[yr])}for(const tr in Xt)this._tiles[tr].clearFadeHold();const rr=c.bv(this._tiles,Xt);for(const tr of rr){const nr=this._tiles[tr];nr.hasSymbolBuckets&&!nr.holdingForFade()?nr.setHoldDuration(this.map._fadeDuration):nr.hasSymbolBuckets&&!nr.symbolFadeFinished()||this._removeTile(+tr)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const d in this._tiles)this._tiles[d].holdingForFade()&&this._removeTile(+d)}_updateRetainedTiles(d){const _e={};if(d.length===0)return _e;const ot={},ut=d.reduce(($t,Xt)=>Math.min($t,Xt.overscaledZ),1/0),mt=d[0].overscaledZ,xt=Math.max(mt-Du.maxOverzooming,this._source.minzoom),Tt=Math.max(mt+Du.maxUnderzooming,this._source.minzoom),kt={};for(const $t of d){const Xt=this._addTile($t);_e[$t.key]=$t,Xt.hasData()||ut<this._source.maxzoom&&(kt[$t.key]=$t)}this._retainLoadedChildren(kt,ut,Tt,_e);for(const $t of d){let Xt=this._tiles[$t.key];if(Xt.hasData())continue;if($t.canonical.z>=this._source.maxzoom){const tr=$t.children(this._source.maxzoom)[0],nr=this.getTile(tr);if(nr&&nr.hasData()){_e[tr.key]=tr;continue}}else{const tr=$t.children(this._source.maxzoom);if(_e[tr[0].key]&&_e[tr[1].key]&&_e[tr[2].key]&&_e[tr[3].key])continue}let rr=Xt.wasRequested();for(let tr=$t.overscaledZ-1;tr>=xt;--tr){const nr=$t.scaledTo(tr);if(ot[nr.key]||(ot[nr.key]=!0,Xt=this.getTile(nr),!Xt&&rr&&(Xt=this._addTile(nr)),Xt&&(_e[nr.key]=nr,rr=Xt.wasRequested(),Xt.hasData())))break}}return _e}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const d in this._tiles){const _e=[];let ot,ut=this._tiles[d].tileID;for(;ut.overscaledZ>0;){if(ut.key in this._loadedParentTiles){ot=this._loadedParentTiles[ut.key];break}_e.push(ut.key);const mt=ut.scaledTo(ut.overscaledZ-1);if(ot=this._getLoadedTile(mt),ot)break;ut=mt}for(const mt of _e)this._loadedParentTiles[mt]=ot}}_addTile(d){let _e=this._tiles[d.key];if(_e)return _e.isExtraShadowCaster!==!0||this._shadowCasterTiles[d.key]||this._reloadTile(d.key,"reloading"),_e;_e=this._cache.getAndRemove(d),_e&&(this._setTileReloadTimer(d.key,_e),_e.tileID=d,this._state.initializeTileState(_e,this.map?this.map.painter:null),this._cacheTimers[d.key]&&(clearTimeout(this._cacheTimers[d.key]),delete this._cacheTimers[d.key],this._setTileReloadTimer(d.key,_e)));const ot=!!_e;if(!ot){const ut=this.map?this.map.painter:null,mt=this._source.tileSize*d.overscaleFactor();_e=this._source.type==="raster-array"?new _a(d,mt,this.transform.tileZoom,ut,this._isRaster):new Fp(d,mt,this.transform.tileZoom,ut,this._isRaster,this._source.worldview),this._loadTile(_e,this._tileLoaded.bind(this,_e,d.key,_e.state))}return _e.uses++,this._tiles[d.key]=_e,ot||this._source.fire(new c.z("dataloading",{tile:_e,coord:_e.tileID,dataType:"source"})),_e}_setTileReloadTimer(d,_e){d in this._timers&&(clearTimeout(this._timers[d]),delete this._timers[d]);const ot=_e.getExpiryTimeout();ot&&(this._timers[d]=setTimeout(()=>{this._reloadTile(d,"expired"),delete this._timers[d]},ot))}_removeTile(d){const _e=this._tiles[d];_e&&(_e.uses--,delete this._tiles[d],this._timers[d]&&(clearTimeout(this._timers[d]),delete this._timers[d]),_e.uses>0||(_e.hasData()&&_e.state!=="reloading"||_e.state==="empty"?this._cache.add(_e.tileID,_e,_e.getExpiryTimeout()):(_e.aborted=!0,this._abortTile(_e),this._unloadTile(_e))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const d in this._tiles)this._removeTile(+d);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(d,_e,ot){const ut=[],mt=this.transform;if(!mt)return ut;const xt=mt.projection.name==="globe",Tt=c.aF(mt.center.lng);for(const kt in this._tiles){const $t=this._tiles[kt];if(ot&&$t.clearQueryDebugViz(),$t.holdingForFade())continue;let Xt;if(xt){const rr=$t.tileID.canonical;if(rr.z===0){const tr=[Math.abs(c.aA(Tt,...p0(rr,-1))-Tt),Math.abs(c.aA(Tt,...p0(rr,1))-Tt)];Xt=[0,2*tr.indexOf(Math.min(...tr))-1]}else{const tr=[Math.abs(c.aA(Tt,...p0(rr,-1))-Tt),Math.abs(c.aA(Tt,...p0(rr,0))-Tt),Math.abs(c.aA(Tt,...p0(rr,1))-Tt)];Xt=[tr.indexOf(Math.min(...tr))-1]}}else Xt=[0];for(const rr of Xt){const tr=d.containsTile($t,mt,_e,rr);tr&&ut.push(tr)}}return ut}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(d){return this._getRenderableCoordinates(d)}_getRenderableCoordinates(d,_e){const ot=this.getRenderableIds(d,_e).map(mt=>this._tiles[mt].tileID),ut=this.transform.projection.name==="globe";for(const mt of ot)mt.projMatrix=this.transform.calculateProjMatrix(mt.toUnwrapped()),mt.expandedProjMatrix=ut?this.transform.calculateProjMatrix(mt.toUnwrapped(),!1,!0):mt.projMatrix;return ot}sortCoordinatesByDistance(d){const _e=d.slice(),ot=this.transform._camera.position,ut=this.transform._camera.forward(),mt={};for(const xt of _e){const Tt=1/(1<<xt.canonical.z);mt[xt.key]=((xt.canonical.x+.5)*Tt+xt.wrap-ot[0])*ut[0]+((xt.canonical.y+.5)*Tt-ot[1])*ut[1]-ot[2]*ut[2]}return _e.sort((xt,Tt)=>mt[xt.key]-mt[Tt.key]),_e}hasTransition(){if(this._source.hasTransition())return!0;if(R0(this._source.type))for(const d in this._tiles){const _e=this._tiles[d];if(_e.fadeEndTime!==void 0&&_e.fadeEndTime>=c.o.now())return!0}return!1}setFeatureState(d,_e,ot){this._state.updateState(d=d||"_geojsonTileLayer",_e,ot)}removeFeatureState(d,_e,ot){this._state.removeFeatureState(d=d||"_geojsonTileLayer",_e,ot)}getFeatureState(d,_e){return this._state.getState(d=d||"_geojsonTileLayer",_e)}setDependencies(d,_e,ot){const ut=this._tiles[d];ut&&ut.setDependencies(_e,ot)}reloadTilesForDependencies(d,_e){for(const ot in this._tiles)this._tiles[ot].hasDependency(d,_e)&&this._reloadTile(+ot,"reloading");this._cache.filter(ot=>!ot.hasDependency(d,_e))}_preloadTiles(d,_e){if(!this._sourceLoaded){const kt=()=>{this._sourceLoaded&&(this._source.off("data",kt),this._preloadTiles(d,_e))};return void this._source.on("data",kt)}const ot=new Map,ut=Array.isArray(d)?d:[d],mt=this.map.painter.terrain,xt=this.usedForTerrain&&mt?mt.getScaledDemTileSize():this._source.tileSize;for(const kt of ut){const $t=kt.coveringTiles({tileSize:xt,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const Xt of $t)ot.set(Xt.key,Xt);this.usedForTerrain&&kt.updateElevation(!1)}const Tt=Array.from(ot.values());c.bw(Tt,(kt,$t)=>{const Xt=new Fp(kt,this._source.tileSize*kt.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(Xt,rr=>{this._source.type==="raster-dem"&&Xt.dem&&this._backfillDEM(Xt),$t(rr,Xt)})},_e)}}function wx(st,d){const _e=Math.abs(2*st.wrap)-+(st.wrap<0),ot=Math.abs(2*d.wrap)-+(d.wrap<0);return st.overscaledZ-d.overscaledZ||ot-_e||d.canonical.y-st.canonical.y||d.canonical.x-st.canonical.x}function R0(st){return st==="raster"||st==="image"||st==="video"||st==="custom"}function p0(st,d){const _e=1<<st.z;return[st.x/_e+d,(st.x+1)/_e+d]}Du.maxOverzooming=10,Du.maxUnderzooming=3;class J0{constructor(d){this.style=d,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const d=!1,_e=!1;for(const ot in this.style._mergedLayers){const ut=this.style._mergedLayers[ot];if(ut.type==="fill-extrusion"||ut.type==="building")this.layers.push({layer:ut,visible:d,visibilityChanged:_e});else if(ut.type==="model"){const mt=this.style.getLayerSource(ut);mt&&mt.type==="batched-model"&&this.layers.push({layer:ut,visible:d,visibilityChanged:_e})}}}onNewFrame(d){this.layersGotHidden=!1;for(const _e of this.layers){const ot=_e.layer;let ut=!1;ot.type==="fill-extrusion"?ut=!ot.isHidden(d)&&ot.paint.get("fill-extrusion-opacity")>0:ot.type==="building"?ut=!ot.isHidden(d)&&ot.paint.get("building-opacity")>0:ot.type==="model"&&(ut=!ot.isHidden(d)&&ot.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!ut&&_e.visible,_e.visible=ut}}updateZOffset(d,_e){this.currentBuildingBuckets=[];for(const ut of this.layers){const mt=ut.layer,xt=this.style.getLayerSourceCache(mt);let Tt=1;mt.type==="fill-extrusion"?Tt=ut.visible?mt.paint.get("fill-extrusion-vertical-scale"):0:mt.type==="building"&&(Tt=ut.visible?mt.paint.get("building-vertical-scale"):0);let kt=xt?xt.getTile(_e):null;if(!kt&&xt)for(const $t in xt._tiles){const Xt=xt._tiles[$t];if(_e.canonical.isChildOf(Xt.tileID.canonical)){kt=Xt;break}}this.currentBuildingBuckets.push({bucket:kt?kt.getBucket(mt):null,tileID:kt?kt.tileID:_e,verticalScale:Tt})}d.hasAnyZOffset=!1;let ot=!1;for(let ut=0;ut<d.symbolInstances.length;ut++){const mt=d.symbolInstances.get(ut),xt=mt.zOffset,Tt=this._getHeightAtTileOffset(_e,mt.tileAnchorX,mt.tileAnchorY);mt.zOffset=Tt!==Number.NEGATIVE_INFINITY?Tt:xt,ot||xt===mt.zOffset||(ot=!0),d.hasAnyZOffset||mt.zOffset===0||(d.hasAnyZOffset=!0)}ot&&(d.zOffsetBuffersNeedUpload=!0,d.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(d,_e,ot,ut){let mt=_e,xt=ot;if(d.canonical.z!==ut.canonical.z){const Tt=ut.canonical,kt=1/(1<<d.canonical.z-Tt.z);mt=(_e+d.canonical.x*c.al)*kt-Tt.x*c.al|0,xt=(ot+d.canonical.y*c.al)*kt-Tt.y*c.al|0}return{tileX:mt,tileY:xt}}_getHeightAtTileOffset(d,_e,ot){let ut,mt;for(let xt=0;xt<this.layers.length;++xt){const Tt=this.layers[xt].layer;if(Tt.type!=="fill-extrusion"&&Tt.type!=="building")continue;const{bucket:kt,tileID:$t,verticalScale:Xt}=this.currentBuildingBuckets[xt];if(!kt)continue;const{tileX:rr,tileY:tr}=this._mapCoordToOverlappingTile(d,_e,ot,$t),nr=kt.getHeightAtTileCoord(rr,tr);nr&&nr.height!==void 0&&(nr.hidden?ut=nr.height:mt=Math.max(nr.height*Xt,mt||0))}if(mt!==void 0)return mt;for(let xt=0;xt<this.layers.length;++xt){const Tt=this.layers[xt];if(Tt.layer.type!=="model"||!Tt.visible)continue;const{bucket:kt,tileID:$t}=this.currentBuildingBuckets[xt];if(!kt)continue;const{tileX:Xt,tileY:rr}=this._mapCoordToOverlappingTile(d,_e,ot,$t),tr=kt.getHeightAtTileCoord(Xt,rr);if(tr&&!tr.hidden)return tr.height===void 0&&ut!==void 0?Math.min(tr.maxHeight,ut)*tr.verticalScale:tr.height?tr.height*tr.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Q1(st,d){const _e={};for(const ot in st)ot!=="ref"&&(_e[ot]=st[ot]);return c.bx.forEach(ot=>{ot in d&&(_e[ot]=d[ot])}),_e}function I0(st){st=st.slice();const d=Object.create(null);for(let _e=0;_e<st.length;_e++)d[st[_e].id]=st[_e];for(let _e=0;_e<st.length;_e++)"ref"in st[_e]&&(st[_e]=Q1(st[_e],d[st[_e].ref]));return st}const qo={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function z0(st,d,_e){_e.push({command:qo.addSource,args:[st,d[st]]})}function Cx(st,d,_e){d.push({command:qo.removeSource,args:[st]}),_e[st]=!0}function Sm(st,d,_e,ot){Cx(st,_e,ot),z0(st,d,_e)}function Tm(st,d,_e){let ot;for(ot in st[_e])if(st[_e].hasOwnProperty(ot)&&ot!=="data"&&!c.by(st[_e][ot],d[_e][ot]))return!1;for(ot in d[_e])if(d[_e].hasOwnProperty(ot)&&ot!=="data"&&!c.by(st[_e][ot],d[_e][ot]))return!1;return!0}function sp(st,d,_e,ot,ut,mt){let xt;for(xt in d=d||{},st=st||{})st.hasOwnProperty(xt)&&(c.by(st[xt],d[xt])||_e.push({command:mt,args:[ot,xt,d[xt],ut]}));for(xt in d)d.hasOwnProperty(xt)&&!st.hasOwnProperty(xt)&&(c.by(st[xt],d[xt])||_e.push({command:mt,args:[ot,xt,d[xt],ut]}))}function Rm(st){return st.id}function Im(st,d){return st[d.id]=d,st}function Ax(st,d,_e){const ot=d.createTileMatrix(st,st.worldSize,_e.toUnwrapped());return c.aB(new Float32Array(16),st.projMatrix,ot)}function Sx(st,d,_e){if(d.projection.name===_e.projection.name)return st.projMatrix;const ot=_e.clone();return ot.setProjection(d.projection),Ax(ot,d.getProjection(),st)}function m0(st,d,_e){return d.name===_e.projection.name?st.projMatrix:Ax(_e,d,st)}class Zm{constructor(d,_e){this.reset(d,_e)}reset(d,_e){this.points=d||[],this._distances=[0];for(let ot=1;ot<this.points.length;ot++)this._distances[ot]=this._distances[ot-1]+this.points[ot].dist(this.points[ot-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(_e||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(d){if(this.points.length===1)return this.points[0];d=c.aA(d,0,1);let _e=1,ot=this._distances[_e];const ut=d*this.paddedLength+this.padding;for(;ot<ut&&_e<this._distances.length;)ot=this._distances[++_e];const mt=_e-1,xt=this._distances[mt],Tt=ot-xt,kt=Tt>0?(ut-xt)/Tt:0;return this.points[mt].mult(1-kt).add(this.points[_e].mult(kt))}}class Pu{constructor(d,_e,ot){const ut=this.boxCells=[],mt=this.circleCells=[];this.xCellCount=Math.ceil(d/ot),this.yCellCount=Math.ceil(_e/ot);for(let xt=0;xt<this.xCellCount*this.yCellCount;xt++)ut.push([]),mt.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=d,this.height=_e,this.xScale=this.xCellCount/d,this.yScale=this.yCellCount/_e,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(d,_e,ot,ut,mt){this._forEachCell(_e,ot,ut,mt,this._insertBoxCell,this.boxUid++),this.boxKeys.push(d),this.bboxes.push(_e),this.bboxes.push(ot),this.bboxes.push(ut),this.bboxes.push(mt)}insertCircle(d,_e,ot,ut){this._forEachCell(_e-ut,ot-ut,_e+ut,ot+ut,this._insertCircleCell,this.circleUid++),this.circleKeys.push(d),this.circles.push(_e),this.circles.push(ot),this.circles.push(ut)}_insertBoxCell(d,_e,ot,ut,mt,xt){this.boxCells[mt].push(xt)}_insertCircleCell(d,_e,ot,ut,mt,xt){this.circleCells[mt].push(xt)}_query(d,_e,ot,ut,mt,xt){if(ot<0||d>this.width||ut<0||_e>this.height)return!mt&&[];const Tt=[];if(d<=0&&_e<=0&&this.width<=ot&&this.height<=ut){if(mt)return!0;for(let kt=0;kt<this.boxKeys.length;kt++)Tt.push({key:this.boxKeys[kt],x1:this.bboxes[4*kt],y1:this.bboxes[4*kt+1],x2:this.bboxes[4*kt+2],y2:this.bboxes[4*kt+3]});for(let kt=0;kt<this.circleKeys.length;kt++){const $t=this.circles[3*kt],Xt=this.circles[3*kt+1],rr=this.circles[3*kt+2];Tt.push({key:this.circleKeys[kt],x1:$t-rr,y1:Xt-rr,x2:$t+rr,y2:Xt+rr})}return xt?Tt.filter(xt):Tt}return this._forEachCell(d,_e,ot,ut,this._queryCell,Tt,{hitTest:mt,seenUids:{box:{},circle:{}}},xt),mt?Tt.length>0:Tt}_queryCircle(d,_e,ot,ut,mt){const xt=d-ot,Tt=d+ot,kt=_e-ot,$t=_e+ot;if(Tt<0||xt>this.width||$t<0||kt>this.height)return!ut&&[];const Xt=[];return this._forEachCell(xt,kt,Tt,$t,this._queryCellCircle,Xt,{hitTest:ut,circle:{x:d,y:_e,radius:ot},seenUids:{box:{},circle:{}}},mt),ut?Xt.length>0:Xt}query(d,_e,ot,ut,mt){return this._query(d,_e,ot,ut,!1,mt)}hitTest(d,_e,ot,ut,mt){return this._query(d,_e,ot,ut,!0,mt)}hitTestCircle(d,_e,ot,ut){return this._queryCircle(d,_e,ot,!0,ut)}_queryCell(d,_e,ot,ut,mt,xt,Tt,kt){const $t=Tt.seenUids,Xt=this.boxCells[mt];if(Xt!==null){const tr=this.bboxes;for(const nr of Xt)if(!$t.box[nr]){$t.box[nr]=!0;const cr=4*nr;if(d<=tr[cr+2]&&_e<=tr[cr+3]&&ot>=tr[cr+0]&&ut>=tr[cr+1]&&(!kt||kt(this.boxKeys[nr]))){if(Tt.hitTest)return xt.push(!0),!0;xt.push({key:this.boxKeys[nr],x1:tr[cr],y1:tr[cr+1],x2:tr[cr+2],y2:tr[cr+3]})}}}const rr=this.circleCells[mt];if(rr!==null){const tr=this.circles;for(const nr of rr)if(!$t.circle[nr]){$t.circle[nr]=!0;const cr=3*nr;if(this._circleAndRectCollide(tr[cr],tr[cr+1],tr[cr+2],d,_e,ot,ut)&&(!kt||kt(this.circleKeys[nr]))){if(Tt.hitTest)return xt.push(!0),!0;{const lr=tr[cr],yr=tr[cr+1],xr=tr[cr+2];xt.push({key:this.circleKeys[nr],x1:lr-xr,y1:yr-xr,x2:lr+xr,y2:yr+xr})}}}}}_queryCellCircle(d,_e,ot,ut,mt,xt,Tt,kt){const $t=Tt.circle,Xt=Tt.seenUids,rr=this.boxCells[mt];if(rr!==null){const nr=this.bboxes;for(const cr of rr)if(!Xt.box[cr]){Xt.box[cr]=!0;const lr=4*cr;if(this._circleAndRectCollide($t.x,$t.y,$t.radius,nr[lr+0],nr[lr+1],nr[lr+2],nr[lr+3])&&(!kt||kt(this.boxKeys[cr])))return xt.push(!0),!0}}const tr=this.circleCells[mt];if(tr!==null){const nr=this.circles;for(const cr of tr)if(!Xt.circle[cr]){Xt.circle[cr]=!0;const lr=3*cr;if(this._circlesCollide(nr[lr],nr[lr+1],nr[lr+2],$t.x,$t.y,$t.radius)&&(!kt||kt(this.circleKeys[cr])))return xt.push(!0),!0}}}_forEachCell(d,_e,ot,ut,mt,xt,Tt,kt){const $t=this._convertToXCellCoord(d),Xt=this._convertToYCellCoord(_e),rr=this._convertToXCellCoord(ot),tr=this._convertToYCellCoord(ut);for(let nr=$t;nr<=rr;nr++)for(let cr=Xt;cr<=tr;cr++)if(mt.call(this,d,_e,ot,ut,this.xCellCount*cr+nr,xt,Tt,kt))return}_convertToXCellCoord(d){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(d*this.xScale)))}_convertToYCellCoord(d){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(d*this.yScale)))}_circlesCollide(d,_e,ot,ut,mt,xt){const Tt=ut-d,kt=mt-_e,$t=ot+xt;return $t*$t>Tt*Tt+kt*kt}_circleAndRectCollide(d,_e,ot,ut,mt,xt,Tt){const kt=(xt-ut)/2,$t=Math.abs(d-(ut+kt));if($t>kt+ot)return!1;const Xt=(Tt-mt)/2,rr=Math.abs(_e-(mt+Xt));if(rr>Xt+ot)return!1;if($t<=kt||rr<=Xt)return!0;const tr=$t-kt,nr=rr-Xt;return tr*tr+nr*nr<=ot*ot}}const D0={unknown:0,flipRequired:1,flipNotRequired:2},x0=Math.tan(85*Math.PI/180);function Qu(st,d,_e,ot,ut,mt,xt){const Tt=c.bC();if(_e)if(mt.name==="globe"){const kt=c.bD(ut,d);c.aB(Tt,Tt,kt)}else{const kt=c.bE([],xt);Tt[0]=kt[0],Tt[1]=kt[1],Tt[4]=kt[2],Tt[5]=kt[3],ot||c.bB(Tt,Tt,ut.angle)}else c.aB(Tt,ut.labelPlaneMatrix,st);return Tt}function Tx(st,d,_e,ot,ut,mt,xt){const Tt=Qu(st,d,_e,ot,ut,mt,xt);return mt.name==="globe"&&_e||(Tt[2]=Tt[6]=Tt[10]=Tt[14]=0),Tt}function cs(st,d,_e,ot,ut,mt,xt){if(_e){if(mt.name==="globe"){const Tt=Qu(st,d,_e,ot,ut,mt,xt);return c.bl(Tt,Tt),c.aB(Tt,st,Tt),Tt}{const Tt=c.bz(st),kt=c.bA([]);return kt[0]=xt[0],kt[1]=xt[1],kt[4]=xt[2],kt[5]=xt[3],c.aB(Tt,Tt,kt),ot||c.bB(Tt,Tt,-ut.angle),Tt}}return ut.glCoordMatrix}function yl(st,d,_e,ot){const ut=[st,d,_e,1];_e?c.aC(ut,ut,ot):js(ut,ut,ot);const mt=ut[3];return ut[0]/=mt,ut[1]/=mt,ut[2]/=mt,ut}function Mo(st,d){return Math.min(.5+st/d*.5,1.5)}function Ym(st,d){const _e=st[0]/st[3],ot=st[1]/st[3];return _e>=-d[0]&&_e<=d[0]&&ot>=-d[1]&&ot<=d[1]}function u1(st,d,_e,ot,ut,mt,xt,Tt,kt,$t,Xt=1){const rr=_e.transform,tr=ot?st.textSizeData:st.iconSizeData,nr=c.bK(tr,_e.transform.zoom,Xt),cr=rr.projection.name==="globe",lr=[256/_e.width*2+1,256/_e.height*2+1],yr=ot?st.text.dynamicLayoutVertexArray:st.icon.dynamicLayoutVertexArray;yr.clear();let xr=null;cr&&(xr=ot?st.text.globeExtVertexArray:st.icon.globeExtVertexArray);const Ar=st.lineVertexArray,Dr=ot?st.text.placedSymbolArray:st.icon.placedSymbolArray,Tr=_e.transform.width/_e.transform.height;let Wr,zr=!1;for(let $r=0;$r<Dr.length;$r++){const Or=Dr.get($r),{numGlyphs:Br,writingMode:Xr}=Or;if(Xr!==c.bL.vertical||zr||Wr===c.bL.horizontal||(zr=!0),Wr=Xr,(Or.hidden||Xr===c.bL.vertical)&&!zr){vu(Br,yr);continue}zr=!1;const an=new c.P(Or.tileAnchorX,Or.tileAnchorY),sn=st.elevationType==="road",wn=!!rr.elevation||sn;let{x:Cn,y:Nn,z:Jn}=rr.projection.projectTilePoint(an.x,an.y,$t.canonical),yn=null;if(wn){const Rs=sn?st.getElevationFeatureForText($r):null;yn={getElevation:kt,elevation:rr.elevation,elevationFeature:Rs};const[Qs,_o,Xo]=kt(an,rr.elevation,Rs);Cn+=Qs,Nn+=_o,Jn+=Xo}const Qr=[Cn,Nn,Jn,1];if(c.aC(Qr,Qr,d),!Ym(Qr,lr)){vu(Br,yr);continue}const Dn=Qr[3],bn=Mo(_e.transform.getCameraToCenterDistance(rr.projection),Dn),$n=c.bM(tr,nr,Or),ls=xt?$n/bn:$n*bn,As=yl(Cn,Nn,Jn,ut);if(As[3]<=0){vu(Br,yr);continue}let is={};const _i=c.an(st.layers[0].layout.get("text-max-angle")),Ls=Math.cos(_i),Bs=xt?null:yn,_s=d1(Or,ls,!1,Tt,d,ut,mt,st.glyphOffsetArray,Ar,yr,xr,As,an,is,Tr,Bs,rr.projection,$t,xt,Ls);zr=_s.useVertical,Bs&&_s.needsFlipping&&(is={}),(_s.notEnoughRoom||zr||_s.needsFlipping&&d1(Or,ls,!0,Tt,d,ut,mt,st.glyphOffsetArray,Ar,yr,xr,As,an,is,Tr,Bs,rr.projection,$t,xt,Ls).notEnoughRoom)&&vu(Br,yr)}ot?(st.text.dynamicLayoutVertexBuffer.updateData(yr),xr&&st.text.globeExtVertexBuffer&&st.text.globeExtVertexBuffer.updateData(xr)):(st.icon.dynamicLayoutVertexBuffer.updateData(yr),xr&&st.icon.globeExtVertexBuffer&&st.icon.globeExtVertexBuffer.updateData(xr))}function J1(st,d,_e,ot,ut,mt,xt,Tt,kt,$t,Xt,rr,tr,nr,cr,lr,yr){const{lineStartIndex:xr,glyphStartIndex:Ar,segment:Dr}=Tt,Tr=Ar+Tt.numGlyphs,Wr=xr+Tt.lineLength,zr=d.getoffsetX(Ar),$r=d.getoffsetX(Tr-1),Or=V0(st*zr,_e,ot,ut,mt,xt,Dr,xr,Wr,kt,$t,Xt,rr,tr,!0,nr,cr,lr,yr);if(!Or)return null;const Br=V0(st*$r,_e,ot,ut,mt,xt,Dr,xr,Wr,kt,$t,Xt,rr,tr,!0,nr,cr,lr,yr);return Br?{first:Or,last:Br}:null}function so(st,d,_e,ot){return st===c.bL.horizontal&&Math.abs(ot)>Math.abs(_e)?{useVertical:!0}:st===c.bL.vertical?ot>0?{needsFlipping:!0}:null:d!==D0.unknown&&function(ut,mt){return ut===0||Math.abs(mt/ut)>x0}(_e,ot)?d===D0.flipRequired?{needsFlipping:!0}:null:_e<0?{needsFlipping:!0}:null}function d1(st,d,_e,ot,ut,mt,xt,Tt,kt,$t,Xt,rr,tr,nr,cr,lr,yr,xr,Ar,Dr){const Tr=d/24,Wr=st.lineOffsetX*Tr,zr=st.lineOffsetY*Tr,{lineStartIndex:$r,glyphStartIndex:Or,numGlyphs:Br,segment:Xr,writingMode:an,flipState:sn}=st,wn=$r+st.lineLength,Cn=Nn=>{if(Xt){const[Dn,bn,$n]=Nn.up,ls=$t.length;c.bN(Xt,ls+0,Dn,bn,$n),c.bN(Xt,ls+1,Dn,bn,$n),c.bN(Xt,ls+2,Dn,bn,$n),c.bN(Xt,ls+3,Dn,bn,$n)}const[Jn,yn,Qr]=Nn.point;c.bO($t,Jn,yn,Qr,Nn.angle)};if(Br>1){const Nn=J1(Tr,Tt,Wr,zr,_e,rr,tr,st,kt,mt,nr,lr,!1,yr,xr,Ar,Dr);if(!Nn)return{notEnoughRoom:!0};if(ot&&!_e){let[Jn,yn,Qr]=Nn.first.point,[Dn,bn,$n]=Nn.last.point;[Jn,yn]=yl(Jn,yn,Qr,xt),[Dn,bn]=yl(Dn,bn,$n,xt);const ls=so(an,sn,(Dn-Jn)*cr,bn-yn);if(st.flipState=ls&&ls.needsFlipping?D0.flipRequired:D0.flipNotRequired,ls)return ls}Cn(Nn.first);for(let Jn=Or+1;Jn<Or+Br-1;Jn++){const yn=V0(Tr*Tt.getoffsetX(Jn),Wr,zr,_e,rr,tr,Xr,$r,wn,kt,mt,nr,lr,!1,!1,yr,xr,Ar,Dr);if(!yn)return $t.length-=4*(Jn-Or),{notEnoughRoom:!0};Cn(yn)}Cn(Nn.last)}else{if(ot&&!_e){const Jn=yl(tr.x,tr.y,0,ut),yn=$r+Xr+1,Qr=new c.P(kt.getx(yn),kt.gety(yn)),Dn=yl(Qr.x,Qr.y,0,ut),bn=Dn[3]>0?Dn:ku(tr,Qr,Jn,1,ut,void 0,yr,xr.canonical),$n=so(an,sn,(bn[0]-Jn[0])*cr,bn[1]-Jn[1]);if(st.flipState=$n&&$n.needsFlipping?D0.flipRequired:D0.flipNotRequired,$n)return $n}const Nn=V0(Tr*Tt.getoffsetX(Or),Wr,zr,_e,rr,tr,Xr,$r,wn,kt,mt,nr,lr,!1,!1,yr,xr,Ar,Dr);if(!Nn)return{notEnoughRoom:!0};Cn(Nn)}return{}}function em(st,d,_e,ot,ut){const{x:mt,y:xt,z:Tt}=ot.projectTilePoint(st.x,st.y,d);if(!ut)return yl(mt,xt,Tt,_e);const[kt,$t,Xt]=ut.getElevation(st,ut.elevation,ut.elevationFeature);return yl(mt+kt,xt+$t,Tt+Xt,_e)}function ku(st,d,_e,ot,ut,mt,xt,Tt){const kt=em(st.sub(d)._unit()._add(st),Tt,ut,xt,mt);return c.av(kt,_e,kt),c.aw(kt,kt),c.bH(kt,_e,kt,ot)}function V0(st,d,_e,ot,ut,mt,xt,Tt,kt,$t,Xt,rr,tr,nr,cr,lr,yr,xr,Ar){const Dr=ot?st-d:st+d;let Tr=Dr>0?1:-1,Wr=0;ot&&(Tr*=-1,Wr=Math.PI),Tr<0&&(Wr+=Math.PI);let zr=Tt+xt+(Tr>0?0:1)|0,$r=ut,Or=ut,Br=0,Xr=0;const an=Math.abs(Dr),sn=[],wn=[];let Cn=mt,Nn=Cn,Jn=c.bF([]);const yn=()=>ku(Nn,Cn,Or,an-Br+1,Xt,tr,lr,yr.canonical);for(;Br+Xr<=an;){if(zr+=Tr,zr<Tt||zr>=kt)return null;if(Or=$r,Nn=Cn,sn.push(Or),nr&&wn.push(Nn),Cn=new c.P($t.getx(zr),$t.gety(zr)),$r=rr[zr],!$r){const Bs=em(Cn,yr.canonical,Xt,lr,tr);$r=Bs[3]>0?rr[zr]=Bs:yn()}Br+=Xr;const _i=c.av([],$r,Or),Ls=c.bG(Or,$r);if(_e&&Ls>0&&Xr>0&&c.bJ(Jn,_i)/(Xr*Ls)<Ar)return null;Xr=Ls,Jn=_i}cr&&tr&&(rr[zr]&&($r=yn(),Xr=c.bG(Or,$r),Jn=c.av([],$r,Or)),rr[zr]=$r);const Qr=(an-Br)/Xr,Dn=Cn.sub(Nn)._mult(Qr)._add(Nn),bn=c.bH([],Or,Jn,Qr);let $n=[0,0,1],ls=Jn[0],As=Jn[1];if(xr&&($n=lr.upVector(yr.canonical,Dn.x,Dn.y),$n[0]!==0||$n[1]!==0||$n[2]!==1)){const _i=[$n[2],0,-$n[0]],Ls=c.bI([],$n,_i);c.aw(_i,_i),c.aw(Ls,Ls),ls=c.bJ(Jn,_i),As=c.bJ(Jn,Ls)}if(_e){const _i=c.bI([],$n,Jn);c.aw(_i,_i),c.bH(bn,bn,_i,_e*Tr)}const is=Wr+Math.atan2(As,ls);return sn.push(bn),nr&&wn.push(Dn),{point:bn,angle:is,path:sn,tilePath:wn,up:$n}}function vu(st,d){const _e=d.length,ot=_e+4*st;d.resize(ot),d.float32.fill(-1/0,4*_e,4*ot)}function js(st,d,_e){const ot=d[0],ut=d[1];return st[0]=_e[0]*ot+_e[4]*ut+_e[12],st[1]=_e[1]*ot+_e[5]*ut+_e[13],st[3]=_e[3]*ot+_e[7]*ut+_e[15],st}const No=100;class go{constructor(d,_e,ot=new Pu(d.width+200,d.height+200,25),ut=new Pu(d.width+200,d.height+200,25)){this.transform=d,this.grid=ot,this.ignoredGrid=ut,this.pitchfactor=Math.cos(d._pitch)*d.cameraToCenterDistance,this.screenRightBoundary=d.width+No,this.screenBottomBoundary=d.height+No,this.gridRightBoundary=d.width+200,this.gridBottomBoundary=d.height+200,this.fogState=_e}placeCollisionBox(d,_e,ot,ut,mt,xt,Tt,kt,$t,Xt,rr){let tr=ot.projectedAnchorX,nr=ot.projectedAnchorY,cr=ot.projectedAnchorZ;const lr=ot.tileAnchorX,yr=ot.tileAnchorY,xr=ot.elevation,Ar=ot.tileID,Dr=d.getProjection();if(xr&&Ar){const[wn,Cn,Nn]=Dr.upVector(Ar.canonical,ot.tileAnchorX,ot.tileAnchorY),Jn=Dr.upVectorScale(Ar.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;tr+=wn*xr*Jn,nr+=Cn*xr*Jn,cr+=Nn*xr*Jn}const Tr=d.projection.name==="globe",Wr=d.projection.name==="globe"?c.aj(this.transform.zoom):0;if(Ar&&Tr&&Wr<1&&!xt){const wn=1<<Ar.canonical.z,Cn=c.bP(lr,yr);c.bQ(Cn,Cn,1/c.al),c.bR(Cn,Cn,c.bP(Ar.canonical.x,Ar.canonical.y)),c.bQ(Cn,Cn,1/wn),c.bS(Cn,Cn,c.bP(ut[0],ut[1])),Cn[0]=c.bT(Cn[0],-.5,.5),c.bQ(Cn,Cn,c.al);const Nn=c.bU(Cn[0],Cn[1],c.al/(2*Math.PI),1);c.aC(Nn,Nn,mt),tr=c.ak(tr,Nn[0],Wr),nr=c.ak(nr,Nn[1],Wr),cr=c.ak(cr,Nn[2],Wr)}const zr=this.projectAndGetPerspectiveRatio(Xt,tr,nr,cr,ot.tileID,Dr.name==="globe"||!!xr||this.transform.pitch>0,Dr),$r=$t*zr.perspectiveRatio,Or=(ot.x1*_e+Tt.x-ot.padding)*$r+zr.point.x,Br=(ot.y1*_e+Tt.y-ot.padding)*$r+zr.point.y,Xr=(ot.x2*_e+Tt.x+ot.padding)*$r+zr.point.x,an=(ot.y2*_e+Tt.y+ot.padding)*$r+zr.point.y,sn=zr.perspectiveRatio<=.55||zr.occluded;return!this.isInsideGrid(Or,Br,Xr,an)||!kt&&this.grid.hitTest(Or,Br,Xr,an,rr)||sn?{box:[],offscreen:!1,occluded:zr.occluded}:{box:[Or,Br,Xr,an],offscreen:this.isOffscreen(Or,Br,Xr,an),occluded:!1}}placeCollisionCircles(d,_e,ot,ut,mt,xt,Tt,kt,$t,Xt,rr,tr,nr,cr,lr,yr){const xr=[],Ar=this.transform.elevation,Dr=d.getProjection(),Tr=d.elevationType==="road",Wr=!!Ar||Tr,zr=c.bV.getAtTileOffsetFunc(yr,this.transform.center.lat,this.transform.worldSize,Dr),$r=new c.P(ot.tileAnchorX,ot.tileAnchorY),Or=new c.P(ot.tileAnchorX,ot.tileAnchorY);let{x:Br,y:Xr,z:an}=Dr.projectTilePoint(Or.x,Or.y,yr.canonical),sn=null;if(Wr){const Ls=Tr?d.getElevationFeatureForText(ut):null;sn={getElevation:zr,elevation:Ar,elevationFeature:Ls};const[Bs,_s,Rs]=zr($r,Ar,Ls);Br+=Bs,Xr+=_s,an+=Rs}const wn=Dr.name==="globe",Cn=this.projectAndGetPerspectiveRatio(kt,Br,Xr,an,yr,wn||!!Ar||this.transform.pitch>0,Dr),{perspectiveRatio:Nn}=Cn,Jn=(tr?Tt/Nn:Tt*Nn)/c.bY,yn=yl(Br,Xr,an,$t),Qr=ot.lineOffsetX*Jn,Dn=ot.lineOffsetY*Jn,bn=c.an(d.layers[0].layout.get("text-max-angle")),$n=Math.cos(bn),ls=Cn.signedDistanceFromCamera>0?J1(Jn,xt,Qr,Dn,Tr&&ot.flipState===1,yn,Or,ot,mt,$t,{},Wr&&!tr?sn:null,tr&&Wr,Dr,yr,tr,$n):null;let As=!1,is=!1,_i=!0;if(ls&&!Cn.occluded){const Ls=.5*cr*Nn+lr,Bs=new c.P(-100,-100),_s=new c.P(this.screenRightBoundary,this.screenBottomBoundary),Rs=new Zm,{first:Qs,last:_o}=ls,Xo=Qs.path.length;let Al=[];for(let mo=Xo-1;mo>=1;mo--)Al.push(Qs.path[mo]);for(let mo=1;mo<_o.path.length;mo++)Al.push(_o.path[mo]);const zs=2.5*Ls;Xt&&(Al=Al.map(([mo,Dl,Vl],Ml)=>(Wr&&!wn&&(Vl=zr(Ml<Xo-1?Qs.tilePath[Xo-1-Ml]:_o.tilePath[Ml-Xo+2],Ar,sn.elevationFeature)[2]),yl(mo,Dl,Vl,Xt))),Al.some(mo=>mo[3]<=0)&&(Al=[]));let El=[];if(Al.length>0){let mo=1/0,Dl=-1/0,Vl=1/0,Ml=-1/0;for(const _l of Al)mo=Math.min(mo,_l[0]),Vl=Math.min(Vl,_l[1]),Dl=Math.max(Dl,_l[0]),Ml=Math.max(Ml,_l[1]);Dl>=Bs.x&&mo<=_s.x&&Ml>=Bs.y&&Vl<=_s.y&&(El=[Al.map(_l=>new c.P(_l[0],_l[1]))],(mo<Bs.x||Dl>_s.x||Vl<Bs.y||Ml>_s.y)&&(El=c.bW(El,Bs.x,Bs.y,_s.x,_s.y)))}for(const mo of El){Rs.reset(mo,.25*Ls);let Dl=0;Dl=Rs.length<=.5*Ls?1:Math.ceil(Rs.paddedLength/zs)+1;for(let Vl=0;Vl<Dl;Vl++){const Ml=Vl/Math.max(Dl-1,1),_l=Rs.lerp(Ml),So=_l.x+No,Rl=_l.y+No;xr.push(So,Rl,Ls,0);const Au=So-Ls,fu=Rl-Ls,Pl=So+Ls,$a=Rl+Ls;if(_i=_i&&this.isOffscreen(Au,fu,Pl,$a),is=is||this.isInsideGrid(Au,fu,Pl,$a),!_e&&this.grid.hitTestCircle(So,Rl,Ls,nr)&&(As=!0,!rr))return{circles:[],offscreen:!1,collisionDetected:As,occluded:!1}}}}return{circles:!rr&&As||!is?[]:xr,offscreen:_i,collisionDetected:As,occluded:Cn.occluded}}queryRenderedSymbols(d){if(d.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const _e=[];let ot=1/0,ut=1/0,mt=-1/0,xt=-1/0;for(const Xt of d){const rr=new c.P(Xt.x+No,Xt.y+No);ot=Math.min(ot,rr.x),ut=Math.min(ut,rr.y),mt=Math.max(mt,rr.x),xt=Math.max(xt,rr.y),_e.push(rr)}const Tt=this.grid.query(ot,ut,mt,xt).concat(this.ignoredGrid.query(ot,ut,mt,xt)),kt={},$t={};for(const Xt of Tt){const rr=Xt.key;if(kt[rr.bucketInstanceId]===void 0&&(kt[rr.bucketInstanceId]={}),kt[rr.bucketInstanceId][rr.featureIndex])continue;const tr=[new c.P(Xt.x1,Xt.y1),new c.P(Xt.x2,Xt.y1),new c.P(Xt.x2,Xt.y2),new c.P(Xt.x1,Xt.y2)];c.bX(_e,tr)&&(kt[rr.bucketInstanceId][rr.featureIndex]=!0,$t[rr.bucketInstanceId]===void 0&&($t[rr.bucketInstanceId]=[]),$t[rr.bucketInstanceId].push(rr.featureIndex))}return $t}insertCollisionBox(d,_e,ot,ut,mt){(_e?this.ignoredGrid:this.grid).insert({bucketInstanceId:ot,featureIndex:ut,collisionGroupID:mt},d[0],d[1],d[2],d[3])}insertCollisionCircles(d,_e,ot,ut,mt){const xt=_e?this.ignoredGrid:this.grid,Tt={bucketInstanceId:ot,featureIndex:ut,collisionGroupID:mt};for(let kt=0;kt<d.length;kt+=4)xt.insertCircle(Tt,d[kt],d[kt+1],d[kt+2])}projectAndGetPerspectiveRatio(d,_e,ot,ut,mt,xt,Tt){const kt=[_e,ot,ut,1];let $t=!1;ut||this.transform.pitch>0?(c.aC(kt,kt,d),this.fogState&&mt&&Tt.name!=="globe"&&($t=function(tr,nr,cr,lr,yr,xr){const Ar=xr.calculateFogTileMatrix(yr),Dr=[nr,cr,lr];return c.af(Dr,Dr,Ar),Ts(tr,c.ag(Dr),xr.pitch,xr._fov)}(this.fogState,_e,ot,ut,mt.toUnwrapped(),this.transform)>.9)):js(kt,kt,d);const Xt=kt[3];return{point:new c.P((kt[0]/Xt+1)/2*this.transform.width+No,(-kt[1]/Xt+1)/2*this.transform.height+No),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(Tt)/Xt*.5,1.5),signedDistanceFromCamera:Xt,occluded:xt&&kt[2]>Xt||$t}}isOffscreen(d,_e,ot,ut){return ot<No||d>=this.screenRightBoundary||ut<No||_e>this.screenBottomBoundary}isInsideGrid(d,_e,ot,ut){return ot>=0&&d<this.gridRightBoundary&&ut>=0&&_e<this.gridBottomBoundary}getViewportMatrix(){const d=c.bA([]);return c.br(d,d,[-100,-100,0]),d}}class Po{constructor(d,_e,ot,ut){this.opacity=d?Math.max(0,Math.min(1,d.opacity+(d.placed?_e:-_e))):ut&&ot?1:0,this.placed=ot}isHidden(){return this.opacity===0&&!this.placed}}class g0{constructor(d,_e,ot,ut,mt,xt=!1){this.text=new Po(d?d.text:null,_e,ot,mt),this.icon=new Po(d?d.icon:null,_e,ut,mt),this.clipped=xt}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class yo{constructor(d,_e,ot,ut=!1){this.text=d,this.icon=_e,this.skipFade=ot,this.clipped=ut}}class y0{constructor(){this.invProjMatrix=c.bC(),this.viewportMatrix=c.bC(),this.circles=[]}}class _0{constructor(d,_e,ot,ut,mt){this.bucketInstanceId=d,this.featureIndex=_e,this.sourceLayerIndex=ot,this.bucketIndex=ut,this.tileID=mt}}class Qm{constructor(d){this.crossSourceCollisions=d,this.maxGroupID=0,this.collisionGroups={}}get(d){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[d]){const _e=++this.maxGroupID;this.collisionGroups[d]={ID:_e,predicate:ot=>ot.collisionGroupID===_e}}return this.collisionGroups[d]}}function Uu(st,d,_e,ot,ut){const{horizontalAlign:mt,verticalAlign:xt}=c.c1(st),Tt=-(mt-.5)*d,kt=-(xt-.5)*_e,$t=c.c2(st,ot);return new c.P(Tt+$t[0]*ut,kt+$t[1]*ut)}function Nu(st,d,_e,ot,ut){const mt=new c.P(st,d);return _e&&mt._rotate(ot?ut:-ut),mt}class ey{constructor(d,_e,ot,ut,mt,xt){this.transform=d.clone(),this.projection=d.projection.name,this.collisionIndex=new go(this.transform,mt),this.buildingIndex=xt,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=_e,this.retainedQueryData={},this.collisionGroups=new Qm(ot),this.collisionCircleArrays={},this.prevPlacement=ut,ut&&(ut.prevPlacement=void 0),this.placedOrientations={},this.lastReplacementSourceUpdateTime=0}getBucketParts(d,_e,ot,ut,mt=1){const xt=ot.getBucket(_e),Tt=ot.latestFeatureIndex;if(!xt||!Tt||_e.fqid!==xt.layerIds[0])return;const kt=xt.layers[0].layout,$t=xt.layers[0].paint,Xt=ot.collisionBoxArray,rr=Math.pow(2,this.transform.zoom-ot.tileID.overscaledZ),tr=ot.tileSize/c.al,nr=ot.tileID.toUnwrapped();this.transform.setProjection(xt.projection);const cr=(lr=ot.tileID,yr=xt.getProjection(),xr=this.transform,yr.name===this.projection?xr.calculateProjMatrix(lr.toUnwrapped()):Ax(xr,yr,lr));var lr,yr,xr;const Ar=kt.get("text-pitch-alignment")==="map",Dr=kt.get("text-rotation-alignment")==="map";_e.compileFilter(_e.options);const Tr=_e.dynamicFilter(),Wr=_e.dynamicFilterNeedsFeature(),zr=this.transform.calculatePixelsToTileUnitsMatrix(ot),$r=Tx(cr,ot.tileID.canonical,Ar,Dr,this.transform,xt.getProjection(),zr);let Or=null;const Br=xt.getProjection().createInversionMatrix(this.transform,ot.tileID.canonical);if(Ar){const Qr=cs(cr,ot.tileID.canonical,Ar,Dr,this.transform,xt.getProjection(),zr);Or=c.aB([],this.transform.labelPlaneMatrix,Qr)}let Xr=null;Tr&&ot.latestFeatureIndex&&(Xr={unwrappedTileID:nr,dynamicFilter:Tr,dynamicFilterNeedsFeature:Wr}),this.retainedQueryData[xt.bucketInstanceId]=new _0(xt.bucketInstanceId,Tt,xt.sourceLayerIndex,xt.index,ot.tileID);const[an,sn]=xt.layers[0].layout.get("text-size-scale-range"),wn=c.aA(mt,an,sn),[Cn,Nn]=kt.get("icon-size-scale-range"),Jn=c.aA(mt,Cn,Nn),yn={bucket:xt,layout:kt,paint:$t,posMatrix:cr,invMatrix:Br,mercatorCenter:[c.aF(this.transform.center.lng),c.aJ(this.transform.center.lat)],textLabelPlaneMatrix:$r,labelToScreenMatrix:Or,clippingData:Xr,scale:rr,textPixelRatio:tr,holdingForFade:ot.holdingForFade(),collisionBoxArray:Xt,partiallyEvaluatedTextSize:c.bK(xt.textSizeData,this.transform.zoom,wn),partiallyEvaluatedIconSize:c.bK(xt.iconSizeData,this.transform.zoom,Jn),collisionGroup:this.collisionGroups.get(xt.sourceID),latestFeatureIndex:ot.latestFeatureIndex};if(ut)for(const Qr of xt.sortKeyRanges){const{sortKey:Dn,symbolInstanceStart:bn,symbolInstanceEnd:$n}=Qr;d.push({sortKey:Dn,symbolInstanceStart:bn,symbolInstanceEnd:$n,parameters:yn})}else d.push({symbolInstanceStart:0,symbolInstanceEnd:xt.symbolInstances.length,parameters:yn})}attemptAnchorPlacement(d,_e,ot,ut,mt,xt,Tt,kt,$t,Xt,rr,tr,nr,cr,lr,yr,xr,Ar,Dr,Tr,Wr){const{textOffset0:zr,textOffset1:$r,crossTileID:Or}=lr,Br=[zr,$r],Xr=Uu(d,xt,Tt,Br,kt),an=this.collisionIndex.placeCollisionBox(xr,kt,_e,ot,ut,mt,Nu(Xr.x,Xr.y,$t,Xt,this.transform.angle),cr,rr,tr,nr.predicate);if(Dr){const sn=xr.getSymbolInstanceIconSize(Wr,this.transform.zoom,lr.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(xr,sn,Dr,ot,ut,mt,Nu(Xr.x,Xr.y,$t,Xt,this.transform.angle),cr,rr,tr,nr.predicate).box.length===0)return}if(an.box.length>0){let sn;return this.prevPlacement&&this.prevPlacement.variableOffsets[Or]&&this.prevPlacement.placements[Or]&&this.prevPlacement.placements[Or].text&&(sn=this.prevPlacement.variableOffsets[Or].anchor),this.variableOffsets[Or]={textOffset:Br,width:xt,height:Tt,anchor:d,textScale:kt,prevAnchor:sn},this.markUsedJustification(xr,d,lr,Ar),xr.allowVerticalPlacement&&(this.markUsedOrientation(xr,Ar,lr),this.placedOrientations[Or]=Ar),{shift:Xr,placedGlyphBoxes:an}}}placeLayerBucketPart(d,_e,ot,ut,mt=1){const{bucket:xt,layout:Tt,paint:kt,posMatrix:$t,textLabelPlaneMatrix:Xt,labelToScreenMatrix:rr,clippingData:tr,textPixelRatio:nr,mercatorCenter:cr,invMatrix:lr,holdingForFade:yr,collisionBoxArray:xr,partiallyEvaluatedTextSize:Ar,partiallyEvaluatedIconSize:Dr,collisionGroup:Tr,latestFeatureIndex:Wr}=d.parameters,zr=Tt.get("text-optional"),$r=Tt.get("icon-optional"),Or=Tt.get("text-allow-overlap"),Br=Tt.get("icon-allow-overlap"),Xr=Tt.get("text-rotation-alignment")==="map",an=Tt.get("icon-rotation-alignment")==="map",sn=Tt.get("text-pitch-alignment")==="map",wn=kt.get("symbol-z-offset"),Cn=Tt.get("symbol-elevation-reference")==="sea",Nn=Tt.get("symbol-placement"),[Jn,yn]=Tt.get("text-size-scale-range"),[Qr,Dn]=Tt.get("icon-size-scale-range"),bn=c.aA(mt,Jn,yn),$n=c.aA(mt,Qr,Dn),ls=Tt.get("text-variable-anchor"),As=Xr&&Nn!=="point",is=an&&Nn!=="point",_i=ls&&xt.hasTextData(),Ls=xt.hasIconTextFit()&&_i&&xt.hasIconData();this.transform.setProjection(xt.projection);const Bs=_i||As,_s=is||Ls;let Rs=Or&&(Br||!xt.hasIconData()||$r),Qs=Br&&(Or||!xt.hasTextData()||zr);const _o=!wn.isConstant();!xt.collisionArrays&&xr&&xt.deserializeCollisionBoxes(xr),ot&&ut&&xt.updateCollisionDebugBuffers(this.transform.zoom,xr,bn,$n);const Xo=(zs,El,mo)=>{const{crossTileID:Dl,numVerticalGlyphVertices:Vl}=zs;let Ml=null;if(tr&&tr.dynamicFilterNeedsFeature||_o){const Bu=this.retainedQueryData[xt.bucketInstanceId];Ml=Wr.loadFeature({featureIndex:zs.featureIndex,bucketIndex:Bu.bucketIndex,sourceLayerIndex:Bu.sourceLayerIndex,layoutVertexArrayOffset:0});const Gu=Ml.properties?Ml.properties.worldview:null;if(xt.localizable&&xt.worldview&&typeof Gu=="string")if(Gu==="all")Ml.properties.$localized=!0;else{if(!Gu.split(",").includes(xt.worldview))return;Ml.properties.$localized=!0,Ml.properties.worldview=xt.worldview}}if(tr&&!(0,tr.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch,worldview:xt.worldview},Ml,this.retainedQueryData[xt.bucketInstanceId].tileID.canonical,new c.P(zs.tileAnchorX,zs.tileAnchorY),this.transform.calculateDistanceTileData(tr.unwrappedTileID)))return this.placements[Dl]=new yo(!1,!1,!1,!0),void _e.add(Dl);const _l=wn.evaluate(Ml,{});if(_e.has(Dl))return;if(yr)return void(this.placements[Dl]=new yo(!1,!1,!1));let So=!1,Rl=!1,Au=!0,fu=!1,Pl=!1,$a=null,To={box:null,offscreen:null,occluded:null},cu={box:null},Lu=null,bu=null,Zl=null,Op=0,_p=0,tp=0;mo.textFeatureIndex?Op=mo.textFeatureIndex:zs.useRuntimeCollisionCircles&&(Op=zs.featureIndex),mo.verticalTextFeatureIndex&&(_p=mo.verticalTextFeatureIndex);const Sp=xt.elevationFeatures?xt.elevationFeatures[zs.elevationFeatureIndex]:void 0,Tp=Bu=>{Bu.tileID=this.retainedQueryData[xt.bucketInstanceId].tileID;const Gu=this.transform.elevation;Bu.elevation=Cn?_l:_l+c.bV.getAtTileOffset(Bu.tileID,new c.P(Bu.tileAnchorX,Bu.tileAnchorY),Gu,Sp),Bu.elevation+=zs.zOffset},xp=mo.textBox;if(xp){Tp(xp);const Bu=Yl=>{let Xu=c.bL.horizontal;if(xt.allowVerticalPlacement&&!Yl&&this.prevPlacement){const Su=this.prevPlacement.placedOrientations[Dl];Su&&(this.placedOrientations[Dl]=Su,Xu=Su,this.markUsedOrientation(xt,Xu,zs))}return Xu},Gu=(Yl,Xu)=>{if(xt.allowVerticalPlacement&&Vl>0&&mo.verticalTextBox){for(const Su of xt.writingModes)if(Su===c.bL.vertical?(To=Xu(),cu=To):To=Yl(),To&&To.box&&To.box.length)break}else To=Yl()};if(ls){let Yl=ls;if(this.prevPlacement&&this.prevPlacement.variableOffsets[Dl]){const wu=this.prevPlacement.variableOffsets[Dl];Yl.indexOf(wu.anchor)>0&&(Yl=Yl.filter(S0=>S0!==wu.anchor),Yl.unshift(wu.anchor))}const Xu=(wu,S0,B1)=>{const M0=xt.getSymbolInstanceTextSize(Ar,zs,this.transform.zoom,El),M1=(wu.x2-wu.x1)*M0+2*wu.padding,Zx=(wu.y2-wu.y1)*M0+2*wu.padding,K0=zs.hasIconTextFit&&!Br?S0:null;K0&&Tp(K0);let fm={box:[],offscreen:!1,occluded:!1};const Yx=Or?2*Yl.length:Yl.length;for(let Gm=0;Gm<Yx;++Gm){const pm=this.attemptAnchorPlacement(Yl[Gm%Yl.length],wu,cr,lr,Bs,M1,Zx,M0,Xr,sn,nr,$t,Tr,Gm>=Yl.length,zs,El,xt,B1,K0,Ar,Dr);if(pm&&(fm=pm.placedGlyphBoxes,fm&&fm.box&&fm.box.length)){So=!0,$a=pm.shift;break}}return fm};Gu(()=>Xu(xp,mo.iconBox,c.bL.horizontal),()=>{const wu=mo.verticalTextBox;return wu&&Tp(wu),xt.allowVerticalPlacement&&!(To&&To.box&&To.box.length)&&Vl>0&&wu?Xu(wu,mo.verticalIconBox,c.bL.vertical):{box:null,offscreen:null,occluded:null}}),To&&(So=To.box,Au=To.offscreen,fu=To.occluded);const Su=Bu(!(!To||!To.box));if(!So&&this.prevPlacement){const wu=this.prevPlacement.variableOffsets[Dl];wu&&(this.variableOffsets[Dl]=wu,this.markUsedJustification(xt,wu.anchor,zs,Su))}}else{const Yl=(Xu,Su)=>{const wu=xt.getSymbolInstanceTextSize(Ar,zs,this.transform.zoom,El),S0=this.collisionIndex.placeCollisionBox(xt,wu,Xu,cr,lr,Bs,new c.P(0,0),Or,nr,$t,Tr.predicate);return S0&&S0.box&&S0.box.length&&(this.markUsedOrientation(xt,Su,zs),this.placedOrientations[Dl]=Su),S0};Gu(()=>Yl(xp,c.bL.horizontal),()=>{const Xu=mo.verticalTextBox;return xt.allowVerticalPlacement&&Vl>0&&Xu?(Tp(Xu),Yl(Xu,c.bL.vertical)):{box:null,offscreen:null,occluded:null}}),Bu(!!(To&&To.box&&To.box.length))}}if(Lu=To,So=Lu&&Lu.box&&Lu.box.length>0,Au=Lu&&Lu.offscreen,fu=Lu&&Lu.occluded,zs.useRuntimeCollisionCircles){const Bu=zs.centerJustifiedTextSymbolIndex>=0?zs.centerJustifiedTextSymbolIndex:zs.verticalPlacedTextSymbolIndex,Gu=xt.text.placedSymbolArray.get(Bu),Yl=c.bM(xt.textSizeData,Ar,Gu),Xu=Tt.get("text-padding");bu=this.collisionIndex.placeCollisionCircles(xt,Or,Gu,Bu,xt.lineVertexArray,xt.glyphOffsetArray,Yl,$t,Xt,rr,ot,sn,Tr.predicate,zs.collisionCircleDiameter*Yl/c.bY,Xu,this.retainedQueryData[xt.bucketInstanceId].tileID),So=Or||bu.circles.length>0&&!bu.collisionDetected,Au=Au&&bu.offscreen,fu=bu.occluded}if(mo.iconFeatureIndex&&(tp=mo.iconFeatureIndex),mo.iconBox){const Bu=Gu=>{Tp(Gu);const Yl=zs.hasIconTextFit&&$a?Nu($a.x,$a.y,Xr,sn,this.transform.angle):new c.P(0,0),Xu=xt.getSymbolInstanceIconSize(Dr,this.transform.zoom,zs.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(xt,Xu,Gu,cr,lr,_s,Yl,Br,nr,$t,Tr.predicate)};cu&&cu.box&&cu.box.length&&mo.verticalIconBox?(Zl=Bu(mo.verticalIconBox),Rl=Zl.box.length>0):(Zl=Bu(mo.iconBox),Rl=Zl.box.length>0),Au=Au&&Zl.offscreen,Pl=Zl.occluded}const c0=zr||zs.numHorizontalGlyphVertices===0&&Vl===0,A0=$r||zs.numIconVertices===0;if(c0||A0?A0?c0||(Rl=Rl&&So):So=Rl&&So:Rl=So=Rl&&So,So&&Lu&&Lu.box&&this.collisionIndex.insertCollisionBox(Lu.box,Tt.get("text-ignore-placement"),xt.bucketInstanceId,cu&&cu.box&&_p?_p:Op,Tr.ID),Rl&&Zl&&this.collisionIndex.insertCollisionBox(Zl.box,Tt.get("icon-ignore-placement"),xt.bucketInstanceId,tp,Tr.ID),bu&&(So&&this.collisionIndex.insertCollisionCircles(bu.circles,Tt.get("text-ignore-placement"),xt.bucketInstanceId,Op,Tr.ID),ot)){const Bu=xt.bucketInstanceId;let Gu=this.collisionCircleArrays[Bu];Gu===void 0&&(Gu=this.collisionCircleArrays[Bu]=new y0);for(let Yl=0;Yl<bu.circles.length;Yl+=4)Gu.circles.push(bu.circles[Yl+0]),Gu.circles.push(bu.circles[Yl+1]),Gu.circles.push(bu.circles[Yl+2]),Gu.circles.push(bu.collisionDetected?1:0)}const Wp=xt.projection.name!=="globe";Rs=Rs&&(Wp||!fu),Qs=Qs&&(Wp||!Pl),this.placements[Dl]=new yo(So||Rs,Rl||Qs,Au||xt.justReloaded),_e.add(Dl)},Al=this.retainedQueryData[xt.bucketInstanceId].tileID;if(xt.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(xt,Al),xt.elevationType==="road"&&xt.updateRoadElevation(Al.canonical),xt.updateZOffset(),xt.sortFeaturesByY){const zs=xt.getSortedSymbolIndexes(this.transform.angle);for(let El=zs.length-1;El>=0;--El){const mo=zs[El];Xo(xt.symbolInstances.get(mo),mo,xt.collisionArrays[mo])}xt.hasAnyZOffset&&c.w(`${xt.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(xt.hasAnyZOffset){const zs=xt.getSortedIndexesByZOffset();for(let El=0;El<zs.length;++El){const mo=zs[El];Xo(xt.symbolInstances.get(mo),mo,xt.collisionArrays[mo])}}else for(let zs=d.symbolInstanceStart;zs<d.symbolInstanceEnd;zs++)Xo(xt.symbolInstances.get(zs),zs,xt.collisionArrays[zs]);if(ot&&xt.bucketInstanceId in this.collisionCircleArrays){const zs=this.collisionCircleArrays[xt.bucketInstanceId];c.bl(zs.invProjMatrix,$t),zs.viewportMatrix=this.collisionIndex.getViewportMatrix()}xt.justReloaded=!1}markUsedJustification(d,_e,ot,ut){const{leftJustifiedTextSymbolIndex:mt,centerJustifiedTextSymbolIndex:xt,rightJustifiedTextSymbolIndex:Tt,verticalPlacedTextSymbolIndex:kt,crossTileID:$t}=ot,Xt=c.c3(_e),rr=ut===c.bL.vertical?kt:Xt==="left"?mt:Xt==="center"?xt:Xt==="right"?Tt:-1;mt>=0&&(d.text.placedSymbolArray.get(mt).crossTileID=rr>=0&&mt!==rr?0:$t),xt>=0&&(d.text.placedSymbolArray.get(xt).crossTileID=rr>=0&&xt!==rr?0:$t),Tt>=0&&(d.text.placedSymbolArray.get(Tt).crossTileID=rr>=0&&Tt!==rr?0:$t),kt>=0&&(d.text.placedSymbolArray.get(kt).crossTileID=rr>=0&&kt!==rr?0:$t)}markUsedOrientation(d,_e,ot){const ut=_e===c.bL.horizontal||_e===c.bL.horizontalOnly?_e:0,mt=_e===c.bL.vertical?_e:0,{leftJustifiedTextSymbolIndex:xt,centerJustifiedTextSymbolIndex:Tt,rightJustifiedTextSymbolIndex:kt,verticalPlacedTextSymbolIndex:$t}=ot,Xt=d.text.placedSymbolArray;xt>=0&&(Xt.get(xt).placedOrientation=ut),Tt>=0&&(Xt.get(Tt).placedOrientation=ut),kt>=0&&(Xt.get(kt).placedOrientation=ut),$t>=0&&(Xt.get($t).placedOrientation=mt)}commit(d){this.commitTime=d,this.zoomAtLastRecencyCheck=this.transform.zoom;const _e=this.prevPlacement;let ot=!1;this.prevZoomAdjustment=_e?_e.zoomAdjustment(this.transform.zoom):0;const ut=_e?_e.symbolFadeChange(d):1,mt=_e?_e.opacities:{},xt=_e?_e.variableOffsets:{},Tt=_e?_e.placedOrientations:{};for(const kt in this.placements){const $t=this.placements[kt],Xt=mt[kt];Xt?(this.opacities[kt]=new g0(Xt,ut,$t.text,$t.icon,null,$t.clipped),ot=ot||$t.text!==Xt.text.placed||$t.icon!==Xt.icon.placed):(this.opacities[kt]=new g0(null,ut,$t.text,$t.icon,$t.skipFade,$t.clipped),ot=ot||$t.text||$t.icon)}for(const kt in mt){const $t=mt[kt];if(!this.opacities[kt]){const Xt=new g0($t,ut,!1,!1);Xt.isHidden()||(this.opacities[kt]=Xt,ot=ot||$t.text.placed||$t.icon.placed)}}for(const kt in xt)this.variableOffsets[kt]||!this.opacities[kt]||this.opacities[kt].isHidden()||(this.variableOffsets[kt]=xt[kt]);for(const kt in Tt)this.placedOrientations[kt]||!this.opacities[kt]||this.opacities[kt].isHidden()||(this.placedOrientations[kt]=Tt[kt]);ot?this.lastPlacementChangeTime=d:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=_e?_e.lastPlacementChangeTime:d)}updateLayerOpacities(d,_e,ot,ut){ut&&(this.lastReplacementSourceUpdateTime=ut.updateTime);const mt=new Set;for(const xt of _e){const Tt=xt.getBucket(d);Tt&&xt.latestFeatureIndex&&d.fqid===Tt.layerIds[0]&&(this.updateBucketOpacities(Tt,mt,xt,xt.collisionBoxArray,ot,ut,xt.tileID,d.scope),Tt.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(Tt,xt.tileID),Tt.elevationType==="road"&&Tt.updateRoadElevation(xt.tileID.canonical),Tt.updateZOffset())}}updateBucketOpacities(d,_e,ot,ut,mt,xt,Tt,kt){d.hasTextData()&&d.text.opacityVertexArray.clear(),d.hasIconData()&&d.icon.opacityVertexArray.clear(),d.hasIconCollisionBoxData()&&d.iconCollisionBox.collisionVertexArray.clear(),d.hasTextCollisionBoxData()&&d.textCollisionBox.collisionVertexArray.clear();const $t=d.layers[0].layout,Xt=d.layers[0].paint,rr=!!d.layers[0].dynamicFilter(),tr=new g0(null,0,!1,!1,!0),nr=$t.get("text-allow-overlap"),cr=$t.get("icon-allow-overlap"),lr=$t.get("text-variable-anchor"),yr=$t.get("text-rotation-alignment")==="map",xr=$t.get("text-pitch-alignment")==="map",Ar=Xt.get("symbol-z-offset"),Dr=$t.get("symbol-elevation-reference")==="sea",Tr=!Ar.isConstant(),Wr=new g0(null,0,nr&&(cr||!d.hasIconData()||$t.get("icon-optional")),cr&&(nr||!d.hasTextData()||$t.get("text-optional")),!0);!d.collisionArrays&&ut&&(d.hasIconCollisionBoxData()||d.hasTextCollisionBoxData())&&d.deserializeCollisionBoxes(ut);const zr=(Or,Br,Xr)=>{for(let an=0;an<Br/4;an++)Or.opacityVertexArray.emplaceBack(Xr)};let $r=0;xt&&d.updateReplacement(Tt,xt);for(let Or=0;Or<d.symbolInstances.length;Or++){const Br=d.symbolInstances.get(Or),{numHorizontalGlyphVertices:Xr,numVerticalGlyphVertices:an,crossTileID:sn,numIconVertices:wn,tileAnchorX:Cn,tileAnchorY:Nn}=Br;let Jn=null;const yn=this.retainedQueryData[d.bucketInstanceId];Tr&&Br&&yn&&(Jn=ot.latestFeatureIndex.loadFeature({featureIndex:Br.featureIndex,bucketIndex:yn.bucketIndex,sourceLayerIndex:yn.sourceLayerIndex,layoutVertexArrayOffset:0}));const Qr=Ar.evaluate(Jn,{}),Dn=_e.has(sn);let bn=this.opacities[sn];Dn?bn=tr:bn||(bn=Wr,this.opacities[sn]=bn),_e.add(sn);const $n=Xr>0||an>0,ls=wn>0,As=this.placedOrientations[sn],is=As===c.bL.vertical,_i=As===c.bL.horizontal||As===c.bL.horizontalOnly;!$n&&!ls||bn.isHidden()||$r++;let Ls=!1;if(($n||ls)&&xt)for(const Bs of d.activeReplacements){if(c.bZ(Bs,mt,c.b_.Symbol,kt)||Bs.min.x>Cn||Cn>Bs.max.x||Bs.min.y>Nn||Nn>Bs.max.y)continue;const _s=c.b$(Cn,Nn,Tt.canonical,Bs.footprintTileId.canonical);if(Ls=c.c0(_s,Bs.footprint),Ls)break}if($n){const Bs=Ls?Bp:wp(bn.text);zr(d.text,Xr,is?Bp:Bs),zr(d.text,an,_i?Bp:Bs);const _s=bn.text.isHidden(),{leftJustifiedTextSymbolIndex:Rs,centerJustifiedTextSymbolIndex:Qs,rightJustifiedTextSymbolIndex:_o,verticalPlacedTextSymbolIndex:Xo}=Br,Al=d.text.placedSymbolArray,zs=_s||is?1:0;Rs>=0&&(Al.get(Rs).hidden=zs),Qs>=0&&(Al.get(Qs).hidden=zs),_o>=0&&(Al.get(_o).hidden=zs),Xo>=0&&(Al.get(Xo).hidden=_s||_i?1:0);const El=this.variableOffsets[sn];El&&this.markUsedJustification(d,El.anchor,Br,As);const mo=this.placedOrientations[sn];mo&&(this.markUsedJustification(d,"left",Br,mo),this.markUsedOrientation(d,mo,Br))}if(ls){const Bs=Ls?Bp:wp(bn.icon),{placedIconSymbolIndex:_s,verticalPlacedIconSymbolIndex:Rs}=Br,Qs=d.icon.placedSymbolArray,_o=bn.icon.isHidden()?1:0;_s>=0&&(zr(d.icon,wn,is?Bp:Bs),Qs.get(_s).hidden=_o),Rs>=0&&(zr(d.icon,Br.numVerticalIconVertices,_i?Bp:Bs),Qs.get(Rs).hidden=_o)}if(d.hasIconCollisionBoxData()||d.hasTextCollisionBoxData()){const Bs=d.collisionArrays[Or];if(Bs){let _s=new c.P(0,0),Rs=!0;if(Bs.textBox||Bs.verticalTextBox){if(lr){const _o=this.variableOffsets[sn];_o?(_s=Uu(_o.anchor,_o.width,_o.height,_o.textOffset,_o.textScale),yr&&_s._rotate(xr?this.transform.angle:-this.transform.angle)):Rs=!1}rr&&(Rs=!bn.clipped),Bs.textBox&&v0(d.textCollisionBox.collisionVertexArray,bn.text.placed,!Rs||is,Qr,Dr,_s.x,_s.y),Bs.verticalTextBox&&v0(d.textCollisionBox.collisionVertexArray,bn.text.placed,!Rs||_i,Qr,Dr,_s.x,_s.y)}const Qs=Rs&&!!(!_i&&Bs.verticalIconBox);Bs.iconBox&&v0(d.iconCollisionBox.collisionVertexArray,bn.icon.placed,Qs,Qr,Dr,Br.hasIconTextFit?_s.x:0,Br.hasIconTextFit?_s.y:0),Bs.verticalIconBox&&v0(d.iconCollisionBox.collisionVertexArray,bn.icon.placed,!Qs,Qr,Dr,Br.hasIconTextFit?_s.x:0,Br.hasIconTextFit?_s.y:0)}}}if(d.fullyClipped=$r===0,d.sortFeatures(this.transform.angle),this.retainedQueryData[d.bucketInstanceId]&&(this.retainedQueryData[d.bucketInstanceId].featureSortOrder=d.featureSortOrder),d.hasTextData()&&d.text.opacityVertexBuffer&&d.text.opacityVertexBuffer.updateData(d.text.opacityVertexArray),d.hasIconData()&&d.icon.opacityVertexBuffer&&d.icon.opacityVertexBuffer.updateData(d.icon.opacityVertexArray),d.hasIconCollisionBoxData()&&d.iconCollisionBox.collisionVertexBuffer&&d.iconCollisionBox.collisionVertexBuffer.updateData(d.iconCollisionBox.collisionVertexArray),d.hasTextCollisionBoxData()&&d.textCollisionBox.collisionVertexBuffer&&d.textCollisionBox.collisionVertexBuffer.updateData(d.textCollisionBox.collisionVertexArray),d.bucketInstanceId in this.collisionCircleArrays){const Or=this.collisionCircleArrays[d.bucketInstanceId];d.placementInvProjMatrix=Or.invProjMatrix,d.placementViewportMatrix=Or.viewportMatrix,d.collisionCircleArray=Or.circles,delete this.collisionCircleArrays[d.bucketInstanceId]}}symbolFadeChange(d){return this.fadeDuration===0?1:(d-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(d){return Math.max(0,(this.transform.zoom-d)/1.5)}hasTransitions(d){return this.stale||d-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(d,_e){const ot=this.zoomAtLastRecencyCheck===_e?1-this.zoomAdjustment(_e):1;return this.zoomAtLastRecencyCheck=_e,this.commitTime+this.fadeDuration*ot>d}isStale(){return this.stale}setStale(){this.stale=!0}}function v0(st,d,_e,ot,ut,mt,xt){st.emplaceBack(d?1:0,_e?1:0,mt||0,xt||0,ot,ut?1:0),st.emplaceBack(d?1:0,_e?1:0,mt||0,xt||0,ot,ut?1:0),st.emplaceBack(d?1:0,_e?1:0,mt||0,xt||0,ot,ut?1:0),st.emplaceBack(d?1:0,_e?1:0,mt||0,xt||0,ot,ut?1:0)}const Rx=Math.pow(2,25),Dm=Math.pow(2,24),Ix=Math.pow(2,17),U0=Math.pow(2,16),Pm=Math.pow(2,9),bp=Math.pow(2,8),zp=Math.pow(2,1);function wp(st){if(st.opacity===0&&!st.placed)return 0;if(st.opacity===1&&st.placed)return 4294967295;const d=st.placed?1:0,_e=Math.floor(127*st.opacity);return _e*Rx+d*Dm+_e*Ix+d*U0+_e*Pm+d*bp+_e*zp+d}const Bp=0;class P0{constructor(d){this._sortAcrossTiles=d.layout.get("symbol-z-order")!=="viewport-y"&&d.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(d,_e,ot,ut,mt,xt){const Tt=this._bucketParts;for(;this._currentTileIndex<d.length;)if(_e.getBucketParts(Tt,ut,d[this._currentTileIndex],this._sortAcrossTiles,xt),this._currentTileIndex++,mt())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,Tt.sort((kt,$t)=>kt.sortKey-$t.sortKey));this._currentPartIndex<Tt.length;){const kt=Tt[this._currentPartIndex];if(_e.placeLayerBucketPart(kt,this._seenCrossTileIDs,ot,kt.symbolInstanceStart===0,xt),this._currentPartIndex++,mt())return!0}return!1}}class mu{constructor(d,_e,ot,ut,mt,xt,Tt,kt,$t){this.placement=new ey(d,mt,xt,Tt,kt,$t),this._currentPlacementIndex=_e.length-1,this._forceFullPlacement=ot,this._showCollisionBoxes=ut,this._done=!1}isDone(){return this._done}continuePlacement(d,_e,ot,ut,mt){const xt=c.o.now(),Tt=()=>{const kt=c.o.now()-xt;return!this._forceFullPlacement&&kt>2};for(;this._currentPlacementIndex>=0;){const kt=_e[d[this._currentPlacementIndex]],$t=this.placement.collisionIndex.transform.zoom;if(kt.type==="symbol"&&kt.visibility!=="none"&&(!kt.minzoom||kt.minzoom<=$t)&&(!kt.maxzoom||kt.maxzoom>$t)){const Xt=kt,rr=Xt.layout.get("symbol-z-elevate"),tr=Xt.layout.get("symbol-sort-key").constantOr(1)!==void 0,nr=Xt.layout.get("symbol-z-order"),cr=nr==="viewport-y"||nr==="auto"&&!(nr!=="viewport-y"&&tr),lr=Xt.layout.get("text-allow-overlap")||Xt.layout.get("icon-allow-overlap")||Xt.layout.get("text-ignore-placement")||Xt.layout.get("icon-ignore-placement"),yr=cr&&lr,xr=this._inProgressLayer=this._inProgressLayer||new P0(Xt),Ar=c.B(kt.source,kt.scope);if(xr.continuePlacement(rr||yr?ut[Ar]:ot[Ar],this.placement,this._showCollisionBoxes,kt,Tt,mt))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(d){return this.placement.commit(d),this.placement}}const Vp=512/c.al/2;class pp{constructor(d,_e,ot){this.tileID=d,this.bucketInstanceId=ot,this.index=new c.c4(_e.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const ut=d.canonical.x*c.al,mt=d.canonical.y*c.al;for(let xt=0;xt<_e.length;xt++){const{key:Tt,crossTileID:kt,tileAnchorX:$t,tileAnchorY:Xt}=_e.get(xt),rr=Math.floor((ut+$t)*Vp),tr=Math.floor((mt+Xt)*Vp);this.index.add(rr,tr),this.keys.push(Tt),this.crossTileIDs.push(kt)}this.index.finish()}findMatches(d,_e,ot){const ut=this.tileID.canonical.z<_e.canonical.z?1:Math.pow(2,this.tileID.canonical.z-_e.canonical.z),mt=Vp/Math.pow(2,_e.canonical.z-this.tileID.canonical.z),xt=_e.canonical.x*c.al,Tt=_e.canonical.y*c.al;for(let kt=0;kt<d.length;kt++){const $t=d.get(kt);if($t.crossTileID)continue;const{key:Xt,tileAnchorX:rr,tileAnchorY:tr}=$t,nr=Math.floor((xt+rr)*mt),cr=Math.floor((Tt+tr)*mt),lr=this.index.range(nr-ut,cr-ut,nr+ut,cr+ut).sort((yr,xr)=>yr-xr);for(const yr of lr){const xr=this.crossTileIDs[yr];if(this.keys[yr]===Xt&&!ot.has(xr)){ot.add(xr),$t.crossTileID=xr;break}}}}}class _h{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Jm{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(d){const _e=Math.round((d-this.lng)/360);if(_e!==0)for(const ot in this.indexes){const ut=this.indexes[ot],mt={};for(const xt in ut){const Tt=ut[xt];Tt.tileID=Tt.tileID.unwrapTo(Tt.tileID.wrap+_e),mt[Tt.tileID.key]=Tt}this.indexes[ot]=mt}this.lng=d}addBucket(d,_e,ot){if(this.indexes[d.overscaledZ]&&this.indexes[d.overscaledZ][d.key]){if(this.indexes[d.overscaledZ][d.key].bucketInstanceId===_e.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(d.overscaledZ,this.indexes[d.overscaledZ][d.key])}for(let mt=0;mt<_e.symbolInstances.length;mt++)_e.symbolInstances.get(mt).crossTileID=0;this.usedCrossTileIDs[d.overscaledZ]||(this.usedCrossTileIDs[d.overscaledZ]=new Set);const ut=this.usedCrossTileIDs[d.overscaledZ];for(const mt in this.indexes){const xt=this.indexes[mt];if(Number(mt)>d.overscaledZ)for(const Tt in xt){const kt=xt[Tt];kt.tileID.isChildOf(d)&&kt.findMatches(_e.symbolInstances,d,ut)}else{const Tt=xt[d.scaledTo(Number(mt)).key];Tt&&Tt.findMatches(_e.symbolInstances,d,ut)}}for(let mt=0;mt<_e.symbolInstances.length;mt++){const xt=_e.symbolInstances.get(mt);xt.crossTileID||(xt.crossTileID=ot.generate(),ut.add(xt.crossTileID))}return this.indexes[d.overscaledZ]===void 0&&(this.indexes[d.overscaledZ]={}),this.indexes[d.overscaledZ][d.key]=new pp(d,_e.symbolInstances,_e.bucketInstanceId),!0}removeBucketCrossTileIDs(d,_e){for(const ot of _e.crossTileIDs)this.usedCrossTileIDs[d].delete(ot)}removeStaleBuckets(d){let _e=!1;for(const ot in this.indexes){const ut=this.indexes[ot];for(const mt in ut)d[ut[mt].bucketInstanceId]||(this.removeBucketCrossTileIDs(ot,ut[mt]),delete ut[mt],_e=!0)}return _e}}class n0{constructor(){this.layerIndexes={},this.crossTileIDs=new _h,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(d,_e,ot,ut){let mt=this.layerIndexes[d.fqid];mt===void 0&&(mt=this.layerIndexes[d.fqid]=new Jm);let xt=!1;const Tt={};ut.name!=="globe"&&mt.handleWrapJump(ot);for(const kt of _e){const $t=kt.getBucket(d);$t&&d.fqid===$t.layerIds[0]&&($t.bucketInstanceId||($t.bucketInstanceId=++this.maxBucketInstanceId),mt.addBucket(kt.tileID,$t,this.crossTileIDs)&&(xt=!0),Tt[$t.bucketInstanceId]=!0)}return mt.removeStaleBuckets(Tt)&&(xt=!0),xt}pruneUnusedLayers(d){const _e={};d.forEach(ot=>{_e[ot]=!0});for(const ot in this.layerIndexes)_e[ot]||delete this.layerIndexes[ot]}}const i0=771;class co{constructor(d,_e,ot,ut){this.blendFunction=d,this.blendColor=_e.toNonPremultipliedRenderColor(null),this.mask=ot,this.blendEquation=ut}}co.Replace=[1,0,1,0],co.disabled=new co(co.Replace,c.ao.transparent,[!1,!1,!1,!1]),co.unblended=new co(co.Replace,c.ao.transparent,[!0,!0,!0,!0]),co.alphaBlended=new co([1,i0,1,i0],c.ao.transparent,[!0,!0,!0,!0]),co.alphaBlendedNonPremultiplied=new co([770,i0,770,i0],c.ao.transparent,[!0,!0,!0,!0]),co.multiply=new co([774,0,774,0],c.ao.transparent,[!0,!0,!0,!0]),co.additive=new co([1,1,1,1],c.ao.transparent,[!0,!0,!0,!0]);class Us{constructor(d,_e,ot){this.func=d,this.mask=_e,this.range=ot}}Us.ReadOnly=!1,Us.ReadWrite=!0,Us.disabled=new Us(519,Us.ReadOnly,[0,1]);const km=7680;class oo{constructor(d,_e,ot,ut,mt,xt){this.test=d,this.ref=_e,this.mask=ot,this.fail=ut,this.depthFail=mt,this.pass=xt}}oo.disabled=new oo({func:519,mask:0},0,0,km,km,km);const nu=1029,tm=2305;class wr{constructor(d,_e,ot){this.enable=d,this.mode=_e,this.frontFace=ot}}function it(st,d){const _e=c.ca(st,3);c.cc(st,d),c.cg(st,3,_e)}function ct(st,d){const _e=c.c7([]);return c.c8(_e,_e,-d),c.c9(_e,_e,-st),_e}function pt(st,d){const _e=[st[0],st[1],0],ot=[d[0],d[1],0];if(c.ag(_e)>=1e-15){const xt=c.aw([],_e);c.c5(ot,xt,c.bJ(ot,xt)),d[0]=ot[0],d[1]=ot[1]}const ut=c.bI([],d,st);if(c.c6(ut)<1e-15)return null;const mt=Math.atan2(-ut[1],ut[0]);return ct(Math.atan2(Math.sqrt(st[0]*st[0]+st[1]*st[1]),-st[2]),mt)}wr.disabled=new wr(!1,nu,tm),wr.backCCW=new wr(!0,nu,tm),wr.backCW=new wr(!0,nu,2304),wr.frontCW=new wr(!0,1028,2304),wr.frontCCW=new wr(!0,1028,tm);class Ct{constructor(d,_e){this.position=d,this.orientation=_e}get position(){return this._position}set position(d){if(d){const _e=d instanceof c.ae?d:new c.ae(d[0],d[1],d[2]);this._renderWorldCopies&&(_e.x=c.bT(_e.x,0,1)),this._position=_e}else this._position=null}lookAtPoint(d,_e,ot){if(this.orientation=null,!this.position)return;const ut=this.position,mt=ot||(this._elevation?this._elevation.getAtPointOrZero(c.ae.fromLngLat(d)):0),xt=c.ae.fromLngLat(d,mt),Tt=[xt.x-ut.x,xt.y-ut.y,xt.z-ut.z];_e||(_e=[0,0,1]),_e[2]=Math.abs(_e[2]),this.orientation=pt(Tt,_e)}setPitchBearing(d,_e){this.orientation=ct(c.an(d),c.an(-_e))}}class It{constructor(d,_e){this._transform=c.bA([]),this.orientation=_e,this.position=d}get mercatorPosition(){const d=this.position;return new c.ae(d[0],d[1],d[2])}get position(){const d=c.ca(this._transform,3);return[d[0],d[1],d[2]]}set position(d){var _e;d&&c.cg(this._transform,3,[(_e=d)[0],_e[1],_e[2],1])}get orientation(){return this._orientation}set orientation(d){this._orientation=d||c.c7([]),d&&it(this._transform,this._orientation)}getPitchBearing(){const d=this.forward(),_e=this.right();return{bearing:Math.atan2(-_e[1],_e[0]),pitch:Math.atan2(Math.sqrt(d[0]*d[0]+d[1]*d[1]),-d[2])}}setPitchBearing(d,_e){this._orientation=ct(d,_e),it(this._transform,this._orientation)}forward(){const d=c.ca(this._transform,2);return[-d[0],-d[1],-d[2]]}up(){const d=c.ca(this._transform,1);return[-d[0],-d[1],-d[2]]}right(){const d=c.ca(this._transform,0);return[d[0],d[1],d[2]]}getCameraToWorld(d,_e){const ot=new Float64Array(16);return c.bl(ot,this.getWorldToCamera(d,_e)),ot}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(d,_e,ot){const ut=this.position;c.c5(ut,ut,-d);const mt=new Float64Array(16);return c.bq(mt,[ot,ot,ot]),c.br(mt,mt,ut),mt[10]*=_e,mt}getWorldToCamera(d,_e){const ot=new Float64Array(16),ut=new Float64Array(4),mt=this.position;return c.cb(ut,this._orientation),c.c5(mt,mt,-d),c.cc(ot,ut),c.br(ot,ot,mt),ot[1]*=-1,ot[5]*=-1,ot[9]*=-1,ot[13]*=-1,ot[8]*=_e,ot[9]*=_e,ot[10]*=_e,ot[11]*=_e,ot}getCameraToClipPerspective(d,_e,ot,ut){const mt=new Float64Array(16);return c.cd(mt,d,_e,ot,ut),mt}getCameraToClipOrthographic(d,_e,ot,ut,mt,xt){const Tt=new Float64Array(16);return c.ce(Tt,d,_e,ot,ut,mt,xt),Tt}getDistanceToElevation(d,_e=!1){const ot=d===0?0:c.cf(d,_e?c.a$(this.position[1]):this.position[1]),ut=this.forward();return(ot-this.position[2])/ut[2]}clone(){return new It([...this.position],[...this.orientation])}}const Dt={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class qt{constructor(d=0,_e=0,ot=0,ut=0){if(isNaN(d)||d<0||isNaN(_e)||_e<0||isNaN(ot)||ot<0||isNaN(ut)||ut<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=d,this.bottom=_e,this.left=ot,this.right=ut}interpolate(d,_e,ot){return _e.top!=null&&d.top!=null&&(this.top=c.ak(d.top,_e.top,ot)),_e.bottom!=null&&d.bottom!=null&&(this.bottom=c.ak(d.bottom,_e.bottom,ot)),_e.left!=null&&d.left!=null&&(this.left=c.ak(d.left,_e.left,ot)),_e.right!=null&&d.right!=null&&(this.right=c.ak(d.right,_e.right,ot)),this}getCenter(d,_e){const ot=c.aA((this.left+d-this.right)/2,0,d),ut=c.aA((this.top+_e-this.bottom)/2,0,_e);return new c.P(ot,ut)}equals(d){return this.top===d.top&&this.bottom===d.bottom&&this.left===d.left&&this.right===d.right}clone(){return new qt(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Jt=15;class ar{constructor(d,_e,ot,ut,mt,xt,Tt){this.tileSize=512,this._renderWorldCopies=mt===void 0||mt,this._minZoom=d||0,this._maxZoom=_e||22,this._minPitch=ot??0,this._maxPitch=ut??60,this.setProjection(xt),this.setMaxBounds(Tt),this.width=0,this.height=0,this._center=new c.aT(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new qt,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new It,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const d=new ar(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return d._elevation=this._elevation,d._centerAltitude=this._centerAltitude,d._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,d.tileSize=this.tileSize,d.mercatorFromTransition=this.mercatorFromTransition,d.width=this.width,d.height=this.height,d.cameraElevationReference=this.cameraElevationReference,d._center=this._center,d._setZoom(this.zoom),d._seaLevelZoom=this._seaLevelZoom,d.angle=this.angle,d._fov=this._fov,d._pitch=this._pitch,d._nearZ=this._nearZ,d._farZ=this._farZ,d._averageElevation=this._averageElevation,d._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,d._unmodified=this._unmodified,d._edgeInsets=this._edgeInsets.clone(),d._camera=this._camera.clone(),d._calcMatrices(),d.freezeTileCoverage=this.freezeTileCoverage,d.frustumCorners=this.frustumCorners,d._allowWorldUnderZoom=this._allowWorldUnderZoom,d}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<Jt}get elevation(){return this._elevation}set elevation(d){this._elevation!==d&&(this._elevation=d,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(d,_e=!1){const ot=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||ot)&&this._updateCameraOnTerrain(),(d||ot)&&this._constrainCamera(_e),this._calcMatrices()}getProjection(){return c.aH(this.projection,["name","center","parallels"])}setProjection(d){this.projectionOptions=d||{name:"mercator"};const _e=this.projection?this.getProjection():void 0;this.projection=c.cm(this.projectionOptions);const ot=this.getProjection(),ut=!c.by(_e,ot);return ut&&this._calcMatrices(),this.mercatorFromTransition=!1,ut}setOrthographicProjectionAtLowPitch(d){return this._orthographicProjectionAtLowPitch!==d&&(this._orthographicProjectionAtLowPitch=d,this._calcMatrices(),!0)}setMercatorFromTransition(){const d=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=c.cm({name:"mercator"});const _e=d!==this.projection.name;return _e&&this._calcMatrices(),_e}get minZoom(){return this._minZoom}set minZoom(d){this._minZoom!==d&&(this._minZoom=d,this.zoom=Math.max(this.zoom,d))}get maxZoom(){return this._maxZoom}set maxZoom(d){this._maxZoom!==d&&(this._maxZoom=d,this.zoom=Math.min(this.zoom,d))}get minPitch(){return this._minPitch}set minPitch(d){this._minPitch!==d&&(this._minPitch=d,this.pitch=Math.max(this.pitch,d))}get maxPitch(){return this._maxPitch}set maxPitch(d){this._maxPitch!==d&&(this._maxPitch=d,this.pitch=Math.min(this.pitch,d))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(d){d===void 0?d=!0:d===null&&(d=!1),this._renderWorldCopies=d}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const d=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(d))}get cameraWorldSize(){const d=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(d))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return c.cf(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new c.P(this.width,this.height)}get bearing(){return c.bT(this.rotation,-180,180)}set bearing(d){this.rotation=d}get rotation(){return-this.angle/Math.PI*180}set rotation(d){const _e=-d*Math.PI/180;this.angle!==_e&&(this._unmodified=!1,this.angle=_e,this._calcMatrices(),this.rotationMatrix=c.cn(),c.co(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(d){const _e=c.aA(d,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==_e&&(this._unmodified=!1,this._pitch=_e,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(d){d=Math.max(.01,Math.min(60,d)),this._fov!==d&&(this._unmodified=!1,this._fov=c.an(d),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const d=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/d)}get averageElevation(){return this._averageElevation}set averageElevation(d){this._averageElevation=d,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(d){const _e=Math.min(Math.max(d,this.minZoom),this.maxZoom);this._zoom!==_e&&(this._unmodified=!1,this._setZoom(_e),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(d){this._zoom=d,this.scale=this.zoomScale(d),this.tileZoom=Math.floor(d),this.zoomFraction=d-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(d){this._tileCoverLift!==d&&(this._tileCoverLift=d)}_updateCameraOnTerrain(){const d=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,_e=this.elevation&&d===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||d===Number.NEGATIVE_INFINITY&&(!_e||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const ot=this._elevation;_e||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&ot.exaggeration()&&this._centerAltitudeValidForExaggeration!==ot.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*ot.exaggeration(),this._centerAltitudeValidForExaggeration=ot.exaggeration()):(this._centerAltitude=d||0,this._centerAltitudeValidForExaggeration=ot.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const d=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(d)}sampleAverageElevation(){if(!this._elevation)return 0;const d=this._elevation,_e=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],ot=this.horizonLineFromTop();let ut=0,mt=0;for(let xt=0;xt<_e.length;xt++){const Tt=new c.P(_e[xt][0]*this.width,ot+_e[xt][1]*(this.height-ot)),kt=d.pointCoordinate(Tt);if(!kt)continue;const $t=1/Math.hypot(kt[0]-this._camera.position[0],kt[1]-this._camera.position[1]);ut+=kt[3]*$t,mt+=$t}return mt===0?NaN:ut/mt}get center(){return this._center}set center(d){d.lat===this._center.lat&&d.lng===this._center.lng||(this._unmodified=!1,this._center=d,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const d=this._seaLevelZoom,_e=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),ot=this.pixelsPerMeter/this.worldSize*_e,ut=this._mercatorZfromZoom(d),mt=this._mercatorZfromZoom(this._maxZoom),xt=Math.max(ut-ot,mt);this._setZoom(this._zoomFromMercatorZ(xt))}get padding(){return this._edgeInsets.toJSON()}set padding(d){this._edgeInsets.equals(d)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,d,1),this._calcMatrices())}equals(d){const _e=this.elevation,ot=d.elevation,ut=_e!=null!=(ot!=null)||_e&&ot&&_e.exaggeration()!==ot.exaggeration();return this.width===d.width&&this.height===d.height&&this.center.lng===d.center.lng&&this.center.lat===d.center.lat&&this.zoom===d.zoom&&this.bearing===d.bearing&&this.pitch===d.pitch&&this.fov===d.fov&&this.projection.name===d.projection.name&&this._edgeInsets.equals(d.padding)&&!ut}computeZoomRelativeTo(d){const _e=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,d.toAltitude()));let ot;ot=d.z<this._camera.position[2]?[_e.x,_e.y,_e.z]:[d.x,d.y,d.z];const ut=c.ag(c.av([],this._camera.position,ot));return c.aA(this._zoomFromMercatorZ(ut),this._minZoom,this._maxZoom)}setFreeCameraOptions(d){if(!this.height||!d.position&&!d.orientation)return;this._updateCameraState();let _e=!1;if(d.orientation&&!c.cp(d.orientation,this._camera.orientation)&&(_e=this._setCameraOrientation(d.orientation)),d.position){const ot=[d.position.x,d.position.y,d.position.z];c.cq(ot,this._camera.position)||(this._setCameraPosition(ot),_e=!0)}_e&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const d=this._camera.position,_e=new Ct;return _e.position=new c.ae(d[0],d[1],d[2]),_e.orientation=this._camera.orientation,_e._elevation=this.elevation,_e._renderWorldCopies=this.renderWorldCopies,_e}_setCameraOrientation(d){if(!c.cr(d))return!1;c.cs(d,d);const _e=c.ct([],[0,0,-1],d),ot=c.ct([],[0,-1,0],d);if(ot[2]<0)return!1;const ut=pt(_e,ot);return!!ut&&(this._camera.orientation=ut,!0)}_setCameraPosition(d){const _e=this.zoomScale(this.minZoom)*this.tileSize,ot=this.zoomScale(this.maxZoom)*this.tileSize,ut=this.cameraToCenterDistance;d[2]=c.aA(d[2],ut/ot,ut/_e),this._camera.position=d}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(d){return this._edgeInsets.equals(d)}interpolatePadding(d,_e,ot){this._unmodified=!1,this._edgeInsets.interpolate(d,_e,ot),this._constrain(),this._calcMatrices()}coveringZoomLevel(d){const _e=(d.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/d.tileSize));return Math.max(0,_e)}getVisibleUnwrappedCoordinates(d){const _e=[new c.cu(0,d)];if(this.renderWorldCopies){const ot=this.pointCoordinate(new c.P(0,0)),ut=this.pointCoordinate(new c.P(this.width,0)),mt=this.pointCoordinate(new c.P(this.width,this.height)),xt=this.pointCoordinate(new c.P(0,this.height)),Tt=Math.floor(Math.min(ot.x,ut.x,mt.x,xt.x)),kt=Math.floor(Math.max(ot.x,ut.x,mt.x,xt.x)),$t=1;for(let Xt=Tt-$t;Xt<=kt+$t;Xt++)Xt!==0&&_e.push(new c.cu(Xt,d))}return _e}isLODDisabled(d){return(!d||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(d,_e,ot,ut){let mt=[];const xt=ot!=null,Tt=!xt;if(Tt&&this.zoom<_e||xt&&ot[0]===0&&ot[1]===0)return mt;const kt=new Set,$t=(rr,tr,nr,cr,lr)=>{const yr=c.cY(tr,rr,nr,cr,lr);kt.has(yr)||(mt.push(new c.aQ(rr,tr,nr,cr,lr)),kt.add(yr))};for(let rr=0;rr<d.length;rr++){const tr=d[rr];if(Tt&&tr.canonical.z!==_e||xt&&ut!==void 0&&ut>tr.canonical.z)continue;const nr=tr.canonical,cr=tr.overscaledZ,lr=tr.wrap,yr=1<<nr.z,xr=nr.x+1<yr,Ar=nr.x>0,Dr=nr.y+1<yr,Tr=nr.y>0,Wr=tr.wrap-(Ar?0:1),zr=tr.wrap+(xr?0:1),$r=Ar?nr.x-1:yr-1,Or=xr?nr.x+1:0;if(xt)ot[0]<0?($t(cr,zr,nr.z,Or,nr.y),ot[1]<0&&Dr&&($t(cr,lr,nr.z,nr.x,nr.y+1),$t(cr,zr,nr.z,Or,nr.y+1)),ot[1]>0&&Tr&&($t(cr,lr,nr.z,nr.x,nr.y-1),$t(cr,zr,nr.z,Or,nr.y-1))):ot[0]>0?($t(cr,Wr,nr.z,$r,nr.y),ot[1]<0&&Dr&&($t(cr,lr,nr.z,nr.x,nr.y+1),$t(cr,Wr,nr.z,$r,nr.y+1)),ot[1]>0&&Tr&&($t(cr,lr,nr.z,nr.x,nr.y-1),$t(cr,Wr,nr.z,$r,nr.y-1))):ot[1]<0&&Dr?$t(cr,lr,nr.z,nr.x,nr.y+1):Tr&&$t(cr,lr,nr.z,nr.x,nr.y-1);else{const Br=tr.visibleQuadrants;1&Br&&($t(cr,Wr,nr.z,$r,nr.y),Tr&&($t(cr,lr,nr.z,nr.x,nr.y-1),$t(cr,Wr,nr.z,$r,nr.y-1))),2&Br&&($t(cr,zr,nr.z,Or,nr.y),Tr&&($t(cr,lr,nr.z,nr.x,nr.y-1),$t(cr,zr,nr.z,Or,nr.y-1))),4&Br&&($t(cr,Wr,nr.z,$r,nr.y),Dr&&($t(cr,lr,nr.z,nr.x,nr.y+1),$t(cr,Wr,nr.z,$r,nr.y+1))),8&Br&&($t(cr,zr,nr.z,Or,nr.y),Dr&&($t(cr,lr,nr.z,nr.x,nr.y+1),$t(cr,zr,nr.z,Or,nr.y+1)))}}const Xt=[];for(const rr of mt)mt.some(tr=>rr.isChildOf(tr))||Xt.push(rr);if(mt=Xt.filter(rr=>!d.some(tr=>!!(rr.overscaledZ<_e&&tr.isChildOf(rr))||rr.equals(tr)||rr.isChildOf(tr))),Tt){const rr=1<<_e,tr=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),nr=[rr*tr.x,rr*tr.y],cr=4,lr=cr*cr;mt=mt.filter(yr=>{const xr=yr.canonical.x+.5-nr[0],Ar=yr.canonical.y+.5-nr[1];return xr*xr+Ar*Ar<lr})}return mt}extendTileCoverToNearPlane(d,_e,ot){const ut=[],mt=new Set;for(const Ar of d)mt.add(Ar.key);const xt=(Ar,Dr,Tr,Wr,zr)=>{const $r=c.cY(Dr,Ar,Tr,Wr,zr);mt.has($r)||(ut.push(new c.aQ(Ar,Dr,Tr,Wr,zr)),mt.add($r))},Tt=d.reduce((Ar,Dr)=>Math.max(Ar,Dr.overscaledZ),ot),kt=1<<ot,$t=[new c.P(0,0),new c.P(c.al,0),new c.P(c.al,c.al),new c.P(0,c.al)],Xt=new c.P(0,0),rr=new c.P(0,0),tr=(Ar,Dr)=>{const Tr=Math.floor(Ar[0]),Wr=Math.floor(Ar[1]),zr=(Ar[0]-Tr)*c.al,$r=(Ar[1]-Wr)*c.al,Or=Math.floor(Dr[0]),Br=Math.floor(Dr[1]),Xr=(Dr[0]-Or)*c.al,an=(Dr[1]-Br)*c.al;for(let sn=-1;sn<=1;sn++){const wn=Tr+sn;if(!(wn<0||wn>=kt)){Xt.x=zr-sn*c.al,rr.x=Xr-(wn-Or)*c.al;for(let Cn=-1;Cn<=1;Cn++){const Nn=Wr+Cn;Xt.y=$r-Cn*c.al,rr.y=an-(Nn-Br)*c.al,c.cZ(Xt,rr,$t)&&xt(Tt,0,ot,wn,Nn)}}}},nr=_e.points,cr=nr[c.cv],lr=nr[c.cw],yr=this._projectToGround(cr,nr[c.cx]),xr=this._projectToGround(lr,nr[c.cy]);return tr(cr,yr),tr(lr,xr),ut}_projectToGround(d,_e){return c.cz(c.cA(),d,_e,d[2]/(d[2]-_e[2]))}coveringTiles(d){let _e=this.coveringZoomLevel(d);const ot=_e,ut=this.elevation&&this.elevation.exaggeration(),mt=ut&&!d.isTerrainDEM,xt=this.projection.name==="mercator";if(d.minzoom!==void 0&&_e<d.minzoom)return[];d.maxzoom!==void 0&&_e>d.maxzoom&&(_e=d.maxzoom);const Tt=this.locationCoordinate(this.center),kt=this.center.lat,$t=1<<_e,Xt=[$t*Tt.x,$t*Tt.y,0],rr=this.projection.name==="globe",tr=!rr,nr=c.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,_e,tr),cr=rr?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),lr=$t*c.cf(1,this.center.lat),yr=this._camera.position[2]/c.cf(1,this.center.lat),xr=[$t*cr.x,$t*cr.y,yr*(tr?1:lr)],Ar=rr||ut,Dr=this.cameraToCenterDistance/d.tileSize*(d.roundZoom?1:.502),Tr=this.isLODDisabled(!0)?_e:0;let Wr;if(this._elevation&&d.isTerrainDEM)Wr=1e4*this._elevation.exaggeration();else if(this._elevation){const Qr=this._elevation.getMinMaxForVisibleTiles();Wr=Qr?Qr.max:this._centerAltitude}else Wr=this._centerAltitude;const zr=d.isTerrainDEM?-Wr:this._elevation?this._elevation.getMinElevationBelowMSL():0,$r=this.projection.isReprojectedInTileSpace?c.cC(this):1,Or=Qr=>{const bn=new c.ae(Qr.x+25e-6,Qr.y,Qr.z),$n=new c.ae(Qr.x,Qr.y+25e-6,Qr.z),ls=Qr.toLngLat(),As=bn.toLngLat(),is=$n.toLngLat(),_i=this.locationCoordinate(ls),Ls=this.locationCoordinate(As),Bs=this.locationCoordinate(is),_s=Math.hypot(Ls.x-_i.x,Ls.y-_i.y),Rs=Math.hypot(Bs.x-_i.x,Bs.y-_i.y);return Math.sqrt(_s*Rs)*$r/25e-6},Br=Qr=>{const Dn=Wr,bn=zr;return{aabb:c.cF(this,$t,0,0,0,Qr,bn,Dn,this.projection),zoom:0,x:0,y:0,minZ:bn,maxZ:Dn,wrap:Qr,fullyVisible:!1}},Xr=[];let an=[];const sn=_e,wn=d.reparseOverscaled?ot:_e,Cn=(yr-this._centerAltitude)*lr,Nn=Qr=>{if(!this._elevation||!Qr.tileID||!xt)return;const Dn=this._elevation.getMinMaxForTile(Qr.tileID),bn=Qr.aabb;Dn?(bn.min[2]=Dn.min,bn.max[2]=Dn.max,bn.center[2]=(bn.min[2]+bn.max[2])/2):(Qr.shouldSplit=yn(Qr),Qr.shouldSplit||(bn.min[2]=bn.max[2]=bn.center[2]=this._centerAltitude))},Jn=(Qr,Dn)=>{if(.707*Dn<Qr)return 1;const bn=Dn/Qr;return bn/(1.4144271570014144+(Math.pow(1.1,bn-1.4144271570014144+1)-1)/(1.1-1)-1)},yn=Qr=>{if(Qr.zoom<Tr)return!0;if(Qr.zoom===sn)return!1;if(Qr.shouldSplit!=null)return Qr.shouldSplit;const Dn=Qr.aabb.distanceX(xr),bn=Qr.aabb.distanceY(xr);let $n=Cn,ls=1;if(rr){$n=Qr.aabb.distanceZ(xr);const Rs=Math.pow(2,Qr.zoom),Qs=c.a$((Qr.y+1)/Rs),_o=c.a$(Qr.y/Rs),Xo=Math.min(Math.max(kt,Qs),_o),Al=c.d1(Xo)/c.d1(kt);if(ls=Xo===kt?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Al/this._mercatorScaleRatio),this.zoom<=c.c_&&Qr.zoom===sn-1&&Al>=.9)return!0}else if(mt&&($n=Qr.aabb.distanceZ(xr)*lr),this.projection.isReprojectedInTileSpace&&ot<=5){const Rs=Math.pow(2,Qr.zoom),Qs=Or(new c.ae((Qr.x+.5)/Rs,(Qr.y+.5)/Rs));ls=Qs>.85?1:Qs}if(!xt&&!rr){const Rs=Math.sqrt(Dn*Dn+bn*bn+$n*$n);let Qs=(1<<sn-Qr.zoom)*Dr*ls;return Qs*=Jn(Math.max($n,Cn),Rs),Rs<Qs}let As=Number.MAX_VALUE,is=0;const _i=Qr.aabb.getCorners(),Ls=[];for(const Rs of _i){c.av(Ls,Rs,xr),rr||(mt?Ls[2]*=lr:Ls[2]=Cn);const Qs=c.bJ(Ls,this._camera.forward());Qs<As&&(As=Qs,is=Math.abs(Ls[2]))}let Bs=(1<<sn-Qr.zoom)*Dr*ls;if(Bs*=Jn(Math.max(is,Cn),As),As<Bs)return!0;const _s=Qr.aabb.closestPoint(Xt);return _s[0]===Xt[0]&&_s[1]===Xt[1]};if(this.renderWorldCopies)for(let Qr=1;Qr<=3;Qr++)Xr.push(Br(-Qr)),Xr.push(Br(Qr));for(Xr.push(Br(0));Xr.length>0;){const Qr=Xr.pop(),Dn=Qr.x,bn=Qr.y;let $n=Qr.fullyVisible;const ls=()=>this.projection.name==="globe"&&(Qr.y===0||Qr.y===(1<<Qr.zoom)-1);if(!$n){let As=Ar?Qr.aabb.intersects(nr):Qr.aabb.intersectsFlat(nr);if(As===0&&ls()){const is=new c.cD(Qr.zoom,Dn,bn);As=c.cE(this,$t,is,!0).intersects(nr)}if(As===0)continue;$n=As===2}if(Qr.zoom!==sn&&yn(Qr))for(let As=0;As<4;As++){const is=(Dn<<1)+As%2,_i=(bn<<1)+(As>>1),Ls={aabb:xt?Qr.aabb.quadrant(As):c.cF(this,$t,Qr.zoom+1,is,_i,Qr.wrap,Qr.minZ,Qr.maxZ,this.projection),zoom:Qr.zoom+1,x:is,y:_i,wrap:Qr.wrap,fullyVisible:$n,tileID:void 0,shouldSplit:void 0,minZ:Qr.minZ,maxZ:Qr.maxZ};mt&&!rr&&(Ls.tileID=new c.aQ(Qr.zoom+1===sn?wn:Qr.zoom+1,Qr.wrap,Qr.zoom+1,is,_i),Nn(Ls)),Xr.push(Ls)}else{const As=Qr.zoom===sn?wn:Qr.zoom;if(d.minzoom&&d.minzoom>As)continue;let is=0;if(!$n){let _s=Ar?Qr.aabb.intersectsPrecise(nr):Qr.aabb.intersectsPreciseFlat(nr);if(_s===0&&ls()){const Rs=new c.cD(Qr.zoom,Dn,bn);_s=c.cE(this,$t,Rs,!0).intersectsPrecise(nr)}if(_s===0)continue;if(d.calculateQuadrantVisibility)if(nr.containsPoint(Qr.aabb.center))is=15;else for(let Rs=0;Rs<4;Rs++)Qr.aabb.quadrant(Rs).intersects(nr)!==0&&(is|=1<<Rs)}const _i=Xt[0]-(.5+Dn+(Qr.wrap<<Qr.zoom))*(1<<_e-Qr.zoom),Ls=Xt[1]-.5-bn,Bs=Qr.tileID?Qr.tileID:new c.aQ(As,Qr.wrap,Qr.zoom,Dn,bn);d.calculateQuadrantVisibility&&(Bs.visibleQuadrants=is),an.push({tileID:Bs,distanceSq:_i*_i+Ls*Ls})}}if(this.fogCullDistSq){const Qr=this.fogCullDistSq,Dn=this.horizonLineFromTop();an=an.filter(bn=>{const $n=[0,0,0,1],ls=[c.al,c.al,0,1],As=this.calculateFogTileMatrix(bn.tileID.toUnwrapped());c.aC($n,$n,As),c.aC(ls,ls,As);const is=c.cG([],$n,ls),_i=c.cH([],$n,ls),Ls=c.c$(is,_i);if(Ls===0)return!0;let Bs=!1;const _s=this._elevation;if(_s&&Ls>Qr&&Dn!==0){const Rs=this.calculateProjMatrix(bn.tileID.toUnwrapped());let Qs;d.isTerrainDEM||(Qs=_s.getMinMaxForTile(bn.tileID)),Qs||(Qs={min:zr,max:Wr});const _o=c.cI(this.rotation),Xo=[_o[0]*c.al,_o[1]*c.al,Qs.max];c.af(Xo,Xo,Rs),Bs=(1-Xo[1])*this.height*.5<Dn}return Ls<Qr||Bs})}return an.sort((Qr,Dn)=>Qr.distanceSq-Dn.distanceSq).map(Qr=>Qr.tileID)}resize(d,_e){this.width=d,this.height=_e,this.pixelsToGLUnits=[2/d,-2/_e],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(d){return Math.pow(2,d)}scaleZoom(d){return Math.log2(d)}project(d){const _e=c.aA(d.lat,-c.cJ,c.cJ),ot=this.projection.project(d.lng,_e);return new c.P(ot.x*this.worldSize,ot.y*this.worldSize)}unproject(d){return this.projection.unproject(d.x/this.worldSize,d.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/c.cf(1,this.center.lat)/this.worldSize}setLocationAtPoint(d,_e){let ot,ut;const mt=this.centerPoint;if(this.projection.name==="globe"){const Tt=this.worldSize;ot=(_e.x-mt.x)/Tt,ut=(_e.y-mt.y)/Tt}else{const Tt=this.pointCoordinate(_e),kt=this.pointCoordinate(mt);ot=Tt.x-kt.x,ut=Tt.y-kt.y}const xt=this.locationCoordinate(d);this.setLocation(new c.ae(xt.x-ot,xt.y-ut))}setLocation(d){this.center=this.coordinateLocation(d),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(d,_e){return this.projection.locationPoint(this,d,_e)}locationPoint3D(d,_e){return this.projection.locationPoint(this,d,_e,!0)}pointLocation(d){return this.coordinateLocation(this.pointCoordinate(d))}pointLocation3D(d,_e){return this.coordinateLocation(this.pointCoordinate3D(d,_e))}locationCoordinate(d,_e){const ot=_e?c.cf(_e,d.lat):void 0,ut=this.projection.project(d.lng,d.lat);return new c.ae(ut.x,ut.y,ot)}coordinateLocation(d){return this.projection.unproject(d.x,d.y)}pointRayIntersection(d,_e){const ot=_e??this._centerAltitude,ut=[d.x,d.y,0,1],mt=[d.x,d.y,1,1];c.aC(ut,ut,this.pixelMatrixInverse),c.aC(mt,mt,this.pixelMatrixInverse);const xt=mt[3];c.cK(ut,ut,1/ut[3]),c.cK(mt,mt,1/xt);const Tt=ut[2],kt=mt[2];return{p0:ut,p1:mt,t:Tt===kt?0:(ot-Tt)/(kt-Tt)}}screenPointToMercatorRay(d){const _e=[d.x,d.y,0,1],ot=[d.x,d.y,1,1];return c.aC(_e,_e,this.pixelMatrixInverse),c.aC(ot,ot,this.pixelMatrixInverse),c.cK(_e,_e,1/_e[3]),c.cK(ot,ot,1/ot[3]),_e[2]=c.cf(_e[2],this._center.lat)*this.worldSize,ot[2]=c.cf(ot[2],this._center.lat)*this.worldSize,c.cK(_e,_e,1/this.worldSize),c.cK(ot,ot,1/this.worldSize),new c.ax([_e[0],_e[1],_e[2]],c.aw([],c.av([],ot,_e)))}rayIntersectionCoordinate(d){const{p0:_e,p1:ot,t:ut}=d,mt=c.cf(_e[2],this._center.lat),xt=c.cf(ot[2],this._center.lat);return new c.ae(c.ak(_e[0],ot[0],ut)/this.worldSize,c.ak(_e[1],ot[1],ut)/this.worldSize,c.ak(mt,xt,ut))}pointCoordinate(d,_e=this._centerAltitude){return this.projection.pointCoordinate(this,d.x,d.y,_e)}pointCoordinate3D(d,_e){if(!this.elevation)return this.pointCoordinate(d,_e);let ot=this.projection.pointCoordinate3D(this,d.x,d.y);if(ot)return new c.ae(ot[0],ot[1],ot[2]);let ut=0,mt=this.horizonLineFromTop();if(d.y>mt)return this.pointCoordinate(d,_e);const xt=.02*mt,Tt=d.clone();for(let kt=0;kt<10&&mt-ut>xt;kt++){Tt.y=c.ak(ut,mt,.66);const $t=this.projection.pointCoordinate3D(this,Tt.x,Tt.y);$t?(mt=Tt.y,ot=$t):ut=Tt.y}return ot?new c.ae(ot[0],ot[1],ot[2]):this.pointCoordinate(d)}isPointAboveHorizon(d){return this.projection.isPointAboveHorizon(this,d)}isPointOnSurface(d){if(d.y<0||d.y>this.height||d.x<0||d.x>this.width)return!1;if(this.elevation||this.zoom>=c.cL)return!this.isPointAboveHorizon(d);const _e=this.pointCoordinate(d);return _e.y>=0&&_e.y<=1}_coordinatePoint(d,_e){const ot=_e&&this.elevation?this.elevation.getAtPointOrZero(d,this._centerAltitude):this._centerAltitude,ut=[d.x*this.worldSize,d.y*this.worldSize,ot+d.toAltitude(),1];return c.aC(ut,ut,this.pixelMatrix),ut[3]>0?new c.P(ut[0]/ut[3],ut[1]/ut[3]):new c.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:d,left:_e}=this._edgeInsets,ot=this.height-this._edgeInsets.bottom,ut=this.width-this._edgeInsets.right,mt=this.pointLocation3D(new c.P(_e,d)),xt=this.pointLocation3D(new c.P(ut,d)),Tt=this.pointLocation3D(new c.P(ut,ot)),kt=this.pointLocation3D(new c.P(_e,ot));let $t=Math.min(mt.lng,xt.lng,Tt.lng,kt.lng),Xt=Math.max(mt.lng,xt.lng,Tt.lng,kt.lng),rr=Math.min(mt.lat,xt.lat,Tt.lat,kt.lat),tr=Math.max(mt.lat,xt.lat,Tt.lat,kt.lat);const nr=Math.pow(2,-this.zoom)/16*270,cr=this.projection.name==="globe"?1:4,lr=(yr,xr,Ar,Dr,Tr)=>{const Wr=(yr+Ar)/2,zr=(xr+Dr)/2,$r=new c.P(Wr,zr),{lng:Or,lat:Br}=this.pointLocation3D($r),Xr=Math.max(0,$t-Or,rr-Br,Or-Xt,Br-tr);$t=Math.min($t,Or),Xt=Math.max(Xt,Or),rr=Math.min(rr,Br),tr=Math.max(tr,Br),(Tr<cr||Xr>nr)&&(lr(yr,xr,Wr,zr,Tr+1),lr(Wr,zr,Ar,Dr,Tr+1))};if(lr(_e,d,ut,d,1),lr(ut,d,ut,ot,1),lr(ut,ot,_e,ot,1),lr(_e,ot,_e,d,1),this.projection.name==="globe"){const[yr,xr]=c.cM(this);yr?(tr=90,Xt=180,$t=-180):xr&&(rr=-90,Xt=180,$t=-180)}return new c.aI(new c.aT($t,rr),new c.aT(Xt,tr))}_getBoundsRectangular(d,_e){const{top:ot,left:ut}=this._edgeInsets,mt=this.height-this._edgeInsets.bottom,xt=this.width-this._edgeInsets.right,Tt=new c.P(ut,ot),kt=new c.P(xt,ot),$t=new c.P(xt,mt),Xt=new c.P(ut,mt);let rr=this.pointCoordinate(Tt,d),tr=this.pointCoordinate(kt,d);const nr=this.pointCoordinate($t,_e),cr=this.pointCoordinate(Xt,_e),lr=(yr,xr)=>(xr.y-yr.y)/(xr.x-yr.x);return rr.y>1&&tr.y>=0?rr=new c.ae((1-cr.y)/lr(cr,rr)+cr.x,1):rr.y<0&&tr.y<=1&&(rr=new c.ae(-cr.y/lr(cr,rr)+cr.x,0)),tr.y>1&&rr.y>=0?tr=new c.ae((1-nr.y)/lr(nr,tr)+nr.x,1):tr.y<0&&rr.y<=1&&(tr=new c.ae(-nr.y/lr(nr,tr)+nr.x,0)),new c.aI().extend(this.coordinateLocation(rr)).extend(this.coordinateLocation(tr)).extend(this.coordinateLocation(cr)).extend(this.coordinateLocation(nr))}_getBoundsRectangularTerrain(){const d=this.elevation;if(!d.visibleDemTiles.length||d.isUsingMockSource())return this._getBoundsRectangular(0,0);const _e=d.visibleDemTiles.reduce((ot,ut)=>{if(ut.dem){const mt=ut.dem.tree;ot.min=Math.min(ot.min,mt.minimums[0]),ot.max=Math.max(ot.max,mt.maximums[0])}return ot},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(_e.min*d.exaggeration(),_e.max*d.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(d=!0){const _e=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,ot=this.height/2-_e*(1-this._horizonShift);return d?Math.max(0,ot):ot}getMaxBounds(){return this.maxBounds}setMaxBounds(d){this.maxBounds=d,this.minLat=-c.cJ,this.maxLat=c.cJ,this.minLng=-180,this.maxLng=180,d&&(this.minLat=d.getSouth(),this.maxLat=d.getNorth(),this.minLng=d.getWest(),this.maxLng=d.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=c.aF(this.minLng)*this.tileSize,this.worldMaxX=c.aF(this.maxLng)*this.tileSize,this.worldMinY=c.aJ(this.maxLat)*this.tileSize,this.worldMaxY=c.aJ(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(d,_e){return this.projection.createTileMatrix(this,_e,d)}calculateDistanceTileData(d){const _e=d.key,ot=this._distanceTileDataCache;if(ot[_e])return ot[_e];const ut=d.canonical,mt=1/this.height,xt=this.cameraWorldSize,Tt=xt/this.zoomScale(ut.z),kt=(ut.x+Math.pow(2,ut.z)*d.wrap)*Tt,$t=ut.y*Tt,Xt=this.point;Xt.x*=xt/this.worldSize,Xt.y*=xt/this.worldSize;const rr=this.angle,tr=Math.sin(-rr),nr=-Math.cos(-rr);return ot[_e]={bearing:[tr,nr],center:[(Xt.x-kt)*mt,(Xt.y-$t)*mt],scale:Tt/c.al*mt},ot[_e]}calculateFogTileMatrix(d){const _e=d.key,ot=this._fogTileMatrixCache;if(ot[_e])return ot[_e];const ut=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,d);return c.aB(ut,this.worldToFogMatrix,ut),ot[_e]=new Float32Array(ut),ot[_e]}calculateProjMatrix(d,_e=!1,ot=!1){const ut=d.key;let mt;if(mt=ot?this._expandedProjMatrixCache:_e?this._alignedProjMatrixCache:this._projMatrixCache,mt[ut])return mt[ut];const xt=this.calculatePosMatrix(d,this.worldSize);let Tt;return Tt=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:ot?this.expandedFarZProjMatrix:_e?this.alignedProjMatrix:this.projMatrix,c.aB(xt,Tt,xt),mt[ut]=new Float32Array(xt),mt[ut]}calculatePixelsToTileUnitsMatrix(d){const _e=d.tileID.key,ot=this._pixelsToTileUnitsCache;if(ot[_e])return ot[_e];const ut=c.cN(d,this);return ot[_e]=ut,ot[_e]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const d=1/this.worldSize,_e=c.bq([],[d,d,d]);return c.aB(_e,_e,this.globeMatrix),_e}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const d=this._elevation;this._updateCameraState();const _e=c.cf(1,this._center.lat)*this.worldSize,ot=this._computeCameraPosition(_e),ut=this._camera.forward(),mt=c.cf(1,this._center.lat);ot[2]/=mt,ut[2]/=mt,c.aw(ut,ut);const xt=d.raycast(ot,ut,d.exaggeration());if(xt){const Tt=c.bH([],ot,ut,xt),kt=new c.ae(Tt[0],Tt[1],c.cf(Tt[2],c.a$(Tt[1]))),$t=(kt.z+c.ag([kt.x-ot[0],kt.y-ot[1],kt.z-ot[2]*mt]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ($t),this._centerAltitude=kt.toAltitude(),this._center=this.coordinateLocation(kt),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(d=!1){if(!this._elevation)return;const _e=this._elevation,ot=c.cf(1,this._center.lat)*this.worldSize,ut=this._computeCameraPosition(ot),mt=_e.getAtPointOrZero(new c.ae(...ut)),xt=this.pixelsPerMeter/this.worldSize*mt,Tt=this._minimumHeightOverTerrain(),kt=ut[2]-xt;if(kt<=Tt)if(kt<0||d){const $t=this.locationCoordinate(this._center,this._centerAltitude),Xt=[ut[0],ut[1],$t.z-ut[2]],rr=c.ag(Xt);Xt[2]-=(Tt-kt)/this._pixelsPerMercatorPixel;const tr=c.ag(Xt);if(tr===0)return;c.c5(Xt,Xt,rr/tr*this._pixelsPerMercatorPixel),this._camera.position=[ut[0],ut[1],$t.z*this._pixelsPerMercatorPixel-Xt[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const d=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||d){const tr=this.center;return tr.lat=c.aA(tr.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!d)&&(tr.lng=c.aA(tr.lng,this.minLng,this.maxLng)),this.center=tr,void(this._constraining=!1)}const _e=this._unmodified,{x:ot,y:ut}=this.point;let mt=0,xt=ot,Tt=ut;const kt=this.width/2,$t=this.height/2,Xt=this.worldMinY*this.scale,rr=this.worldMaxY*this.scale;if(ut-$t<Xt&&(Tt=Xt+$t),ut+$t>rr&&(Tt=rr-$t),rr-Xt<this.height&&(mt=Math.max(mt,this.height/(rr-Xt)),Tt=(rr+Xt)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const tr=this.worldMinX*this.scale,nr=this.worldMaxX*this.scale,cr=this.worldSize/2-(tr+nr)/2;xt=(ot+cr+this.worldSize)%this.worldSize-cr,xt-kt<tr&&(xt=tr+kt),xt+kt>nr&&(xt=nr-kt),nr-tr<this.width&&(mt=Math.max(mt,this.width/(nr-tr)),xt=(nr+tr)/2)}xt===ot&&Tt===ut||this._allowWorldUnderZoom||(this.center=this.unproject(new c.P(xt,Tt))),mt&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(mt)),this._constrainCamera(),this._unmodified=_e,this._constraining=!1}_minZoomForBounds(){let d=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(d=Math.max(d,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),d}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const d=this.centerOffset,_e=this.projection.name==="globe",ot=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=c.cf(1,this.center.lat)/c.cf(1,c.d2));const ut=c.cO(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,ut),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const mt=this.projection.zAxisUnit==="meters"?ot:1,xt=this._camera.getWorldToCamera(this.worldSize,mt);let Tt;const kt=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(kt[8]=2*-d.x/this.width,kt[9]=2*d.y/this.height,this.isOrthographic){let Br=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Xr=Br*this.aspect,an=-Xr,sn=-Br;Xr-=d.x,an-=d.x,Br+=d.y,sn+=d.y,Tt=this._camera.getCameraToClipOrthographic(an,Xr,sn,Br,this._nearZ,this._farZ),((wn,Cn,Nn,Jn)=>{for(let yn=0;yn<16;yn++)wn[yn]=c.ak(Cn[yn],Nn[yn],Jn)})(Tt,Tt,kt,c.d0(this.pitch>=Jt?1:this.pitch/Jt))}else Tt=kt;const $t=c.cP([],kt,xt);let Xt=c.cP([],Tt,xt);if(this.projection.isReprojectedInTileSpace){const Br=this.locationCoordinate(this.center),Xr=c.bA([]);c.br(Xr,Xr,[Br.x*this.worldSize,Br.y*this.worldSize,0]),c.aB(Xr,Xr,c.cQ(this)),c.br(Xr,Xr,[-Br.x*this.worldSize,-Br.y*this.worldSize,0]),c.aB(Xt,Xt,Xr),c.aB($t,$t,Xr),this.inverseAdjustmentMatrix=c.cR(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=c.cS([],Xt,[this.worldSize,this.worldSize,this.worldSize/mt,1]),this.projMatrix=Xt,this.invProjMatrix=c.bl(new Float64Array(16),this.projMatrix),_e){const Br=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);Br[8]=2*-d.x/this.width,Br[9]=2*d.y/this.height,this.expandedFarZProjMatrix=c.cP([],Br,xt)}else this.expandedFarZProjMatrix=this.projMatrix;const rr=c.bl([],Tt);this.frustumCorners=c.cT.fromInvProjectionMatrix(rr,this.horizonLineFromTop(),this.height),this.cameraFrustum=c.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!_e);const tr=new Float32Array(16);c.bA(tr),c.cS(tr,tr,[1,-1,1]),c.cU(tr,tr,this._pitch),c.bB(tr,tr,this.angle);const nr=c.cd(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=c.bz(nr);const cr=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;nr[8]=2*-d.x/this.width,nr[9]=2*(d.y+cr)/this.height,this.skyboxMatrix=c.aB(tr,nr,tr);const lr=this.point,yr=lr.x,xr=lr.y,Ar=this.width%2/2,Dr=this.height%2/2,Tr=Math.cos(this.angle),Wr=Math.sin(this.angle),zr=yr-Math.round(yr)+Tr*Ar+Wr*Dr,$r=xr-Math.round(xr)+Tr*Dr+Wr*Ar,Or=new Float64Array(Xt);if(c.br(Or,Or,[zr>.5?zr-1:zr,$r>.5?$r-1:$r,0]),this.alignedProjMatrix=Or,Xt=c.bC(),c.cS(Xt,Xt,[this.width/2,-this.height/2,1]),c.br(Xt,Xt,[1,-1,0]),this.labelPlaneMatrix=Xt,Xt=c.bC(),c.cS(Xt,Xt,[1,-1,1]),c.br(Xt,Xt,[-1,-1,0]),c.cS(Xt,Xt,[2/this.width,2/this.height,1]),this.glCoordMatrix=Xt,this.pixelMatrix=c.aB(new Float64Array(16),this.labelPlaneMatrix,$t),this._calcFogMatrices(),this._distanceTileDataCache={},Xt=c.bl(new Float64Array(16),this.pixelMatrix),!Xt)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=Xt,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=c.cV(this);const Br=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=c.af(Br,Br,xt),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=Xt;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const d=this.cameraWorldSizeForFog,_e=this.cameraPixelsPerMeter,ot=this._camera.position,ut=1/this.height/this._pixelsPerMercatorPixel,mt=[d,d,_e];c.c5(mt,mt,ut),c.c5(ot,ot,-1),c.cW(ot,ot,mt);const xt=c.bC();c.br(xt,xt,ot),c.cS(xt,xt,mt),this.mercatorFogMatrix=xt,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(d,_e,ut)}_computeCameraPosition(d){const _e=(d=d||this.pixelsPerMeter)/this.pixelsPerMeter,ot=this._camera.forward(),ut=this.point,mt=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*_e-d/this.worldSize*this._centerAltitude;return[ut.x/this.worldSize-ot[0]*mt,ut.y/this.worldSize-ot[1]*mt,d/this.worldSize*this._centerAltitude-ot[2]*mt]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(d){const _e=this._maxCameraBoundsDistance()*Math.cos(this._pitch),ot=this._camera.position[2],ut=d[2];let mt=1;this.projection.wrap&&(this.center=this.center.wrap()),ut>0&&(mt=Math.min((_e-ot)/ut,1)),this._camera.position=c.bH([],this._camera.position,d,mt),this._updateStateFromCamera()}_updateStateFromCamera(){const d=this._camera.position,_e=this._camera.forward(),{pitch:ot,bearing:ut}=this._camera.getPitchBearing(),mt=c.cf(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,xt=this._mercatorZfromZoom(this._maxZoom)*Math.cos(c.an(this._maxPitch)),Tt=Math.max((d[2]-mt)/Math.cos(ot),xt),kt=this._zoomFromMercatorZ(Tt);c.bH(d,d,_e,Tt),this._pitch=c.aA(ot,c.an(this.minPitch),c.an(this.maxPitch)),this.angle=c.bT(ut,-Math.PI,Math.PI),this._setZoom(c.aA(kt,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new c.ae(d[0],d[1],d[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(d){return Math.pow(2,d)*this.tileSize}_mercatorZfromZoom(d){return this.cameraToCenterDistance/this._worldSizeFromZoom(d)}_minimumHeightOverTerrain(){const d=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(d)}_zoomFromMercatorZ(d){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,d)*this.tileSize))}zoomFromMercatorZAdjusted(d){let _e=0,ot=c.cL,ut=0,mt=1/0;for(;ot-_e>1e-6&&ot>_e;){const xt=_e+.5*(ot-_e),Tt=this.tileSize*Math.pow(2,xt),kt=this.getCameraToCenterDistance(this.projection,xt,Tt),$t=this.scaleZoom(kt/(Math.max(0,d)*this.tileSize)),Xt=Math.abs(xt-$t);Xt<mt&&(mt=Xt,ut=xt),xt<$t?_e=xt:ot=xt}return ut}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(c.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(d,_e){const ot=Math.min(d.x,_e.x),ut=Math.max(d.x,_e.x),mt=Math.min(d.y,_e.y),xt=Math.max(d.y,_e.y);if(mt<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const Tt=[new c.P(ot,mt),new c.P(ut,xt),new c.P(ot,xt),new c.P(ut,mt)],kt=this.renderWorldCopies?-3:0,$t=this.renderWorldCopies?4:1;for(const Xt of Tt){const rr=this.pointRayIntersection(Xt);if(rr.t<0)return!0;const tr=this.rayIntersectionCoordinate(rr);if(tr.x<kt||tr.y<0||tr.x>$t||tr.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+c.cX(this.fovAboveCenter)>88||this.anyCornerOffEdge(new c.P(0,0),new c.P(this.width,this.height))}zoomDeltaToMovement(d,_e){const ot=c.ag(c.av([],this._camera.position,d)),ut=this._zoomFromMercatorZ(ot)+_e;return ot-this._mercatorZfromZoom(ut)}getCameraPoint(){if(this.projection.name==="globe"){const d=function([_e,ot,ut],mt){const xt=[_e,ot,ut,1];c.aC(xt,xt,mt);const Tt=xt[3]=Math.max(xt[3],1e-6);return xt[0]/=Tt,xt[1]/=Tt,xt[2]/=Tt,xt}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new c.P(d[0],d[1])}{const d=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new c.P(0,d))}}getCameraToCenterDistance(d,_e=this.zoom,ot=this.worldSize){const ut=c.cO(d,_e,this.width,this.height,1024),mt=d.pixelSpaceConversion(this.center.lat,ot,ut);let xt=.5/Math.tan(.5*this._fov)*this.height*mt;return this.isOrthographic&&(xt=c.ak(1,xt,c.d0(this.pitch>=Jt?1:this.pitch/Jt))),xt}getWorldToCameraMatrix(){const d=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&c.aB(d,d,this.globeMatrix),d}getFrustum(d){return c.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,d,this.projection.zAxisUnit==="meters")}}const Er=(st,d)=>{if(d>0&&st.terrain&&c.w("Cutoff is currently disabled on terrain"),d<=0||st.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const _e=st.transform,ot=Math.max(Math.abs(_e._zoom-(st.minCutoffZoom-1)),1),ut=_e.isLODDisabled(!1)?c.ah(60,45,_e.pitch):c.ah(30,15,_e.pitch),mt=_e._farZ-_e._nearZ,xt=d*_e.height,Tt=((1-(kt=ut))*_e.cameraToCenterDistance+kt*(_e._farZ+xt))*ot;var kt;return{shouldRenderCutoff:ut<1,uniformValues:{u_cutoff_params:[_e._nearZ,_e._farZ,(Tt-_e._nearZ)/mt,(Tt-xt-_e._nearZ)/mt]}}},Pr=2048;class Gr{constructor(d,_e){this.aabb=d,this.lastCascade=_e}}class pn{add(d,_e){const ot=this.receivers[d.key];ot!==void 0?(ot.aabb.min[0]=Math.min(ot.aabb.min[0],_e.min[0]),ot.aabb.min[1]=Math.min(ot.aabb.min[1],_e.min[1]),ot.aabb.min[2]=Math.min(ot.aabb.min[2],_e.min[2]),ot.aabb.max[0]=Math.max(ot.aabb.max[0],_e.max[0]),ot.aabb.max[1]=Math.max(ot.aabb.max[1],_e.max[1]),ot.aabb.max[2]=Math.max(ot.aabb.max[2],_e.max[2])):this.receivers[d.key]=new Gr(_e,null)}clear(){this.receivers={}}get(d){return this.receivers[d.key]}computeRequiredCascades(d,_e,ot){const ut=c.d9.fromPoints(d.points);let mt=0;for(const xt in this.receivers){const Tt=this.receivers[xt];if(!Tt||!ut.intersectsAabb(Tt.aabb))continue;Tt.aabb.min=ut.closestPoint(Tt.aabb.min),Tt.aabb.max=ut.closestPoint(Tt.aabb.max);const kt=Tt.aabb.getCorners();for(let $t=0;$t<ot.length;$t++){let Xt=!0;for(const rr of kt){const tr=[rr[0]*_e,rr[1]*_e,rr[2]];if(c.af(tr,tr,ot[$t].matrix),tr[0]<-1||tr[0]>1||tr[1]<-1||tr[1]>1){Xt=!1;break}}if(Tt.lastCascade=$t,mt=Math.max(mt,$t),Xt)break}}return mt+1}}class An{constructor(d){this.painter=d,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new pn,this._depthMode=new Us(d.context.gl.LEQUAL,Us.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1}destroy(){for(const d of this._cascades)d.texture.destroy(),d.framebuffer.destroy();this._cascades=[]}updateShadowParameters(d,_e){const ot=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!_e||!_e.properties)return;const ut=_e.properties.get("shadow-intensity");if(!_e.shadowsEnabled()||ut<=0||(this._shadowLayerCount=ot.style.order.reduce((cr,lr)=>{const yr=ot.style._mergedLayers[lr];return cr+(yr.hasShadowPass()&&!yr.isHidden(d.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const mt=ot.context,xt=Pr,Tt=Pr;if(this._cascades.length===0||Pr!==this._cascades[0].texture.size[0]){this._cascades=[];for(let cr=0;cr<2;++cr){const lr=ot._shadowMapDebug,yr=mt.gl,xr=mt.createFramebuffer(xt,Tt,lr?1:0,"texture"),Ar=new c.T(mt,{width:xt,height:Tt,data:null},yr.DEPTH_COMPONENT16);if(xr.depthAttachment.set(Ar.texture),lr){const Dr=new c.T(mt,{width:xt,height:Tt,data:null},yr.RGBA8);xr.colorAttachment0.set(Dr.texture)}this._cascades.push({framebuffer:xr,texture:Ar,matrix:[],far:0,boundingSphereRadius:0,frustum:new c.cB,scale:0})}}this.shadowDirection=Xn(_e);let kt=0;if(d.elevation){const cr=d.elevation,lr=[1e4,-1e4];cr.visibleDemTiles.filter(yr=>yr.dem).forEach(yr=>{const xr=yr.dem.tree;lr[0]=Math.min(lr[0],xr.minimums[0]),lr[1]=Math.max(lr[1],xr.maximums[0])}),lr[0]!==1e4&&(kt=(lr[1]-lr[0])*cr.exaggeration())}const $t=1.5*d.cameraToCenterDistance,Xt=3*$t,rr=new Float64Array(16);for(let cr=0;cr<this._cascades.length;++cr){const lr=this._cascades[cr];let yr=d.height/50,xr=1;cr===0?xr=$t:(yr=$t,xr=Xt);const[Ar,Dr]=Ks(d,this.shadowDirection,yr,xr,Pr,kt);lr.scale=d.scale,lr.matrix=Ar,lr.boundingSphereRadius=Dr,c.bl(rr,lr.matrix),lr.frustum=c.cB.fromInvProjectionMatrix(rr,1,0,!0),lr.far=xr}const tr=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[tr].far,this._cascades[tr].far],this._uniformValues.u_shadow_intensity=ut,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=.00048828125,this._uniformValues.u_shadow_map_resolution=Pr,this._uniformValues.u_shadowmap_0=Dt.ShadowMap0,this._uniformValues.u_shadowmap_1=Dt.ShadowMap0+1,this._groundShadowTiles=ot.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const nr=ot.transform.elevation;for(const cr of this._groundShadowTiles){let lr={min:0,max:0};if(nr){const yr=nr.getMinMaxForTile(cr);yr&&(lr=yr)}this.addShadowReceiver(cr.toUnwrapped(),lr.min,lr.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(d){this._enabled=d}drawShadowPass(d,_e){if(!this.enabled)return;const ot=this.painter,ut=ot.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(ot.transform.getFrustum(0),ot.transform.worldSize,this._cascades),ut.viewport.set([0,0,Pr,Pr]);for(let mt=0;mt<this._numCascadesToRender;++mt){ot.currentShadowCascade=mt,ut.bindFramebuffer.set(this._cascades[mt].framebuffer.framebuffer),ut.clear({color:c.ao.white,depth:1});for(const xt of d.order){const Tt=d._mergedLayers[xt];if(!Tt.hasShadowPass()||Tt.isHidden(ot.transform.zoom))continue;const kt=d.getLayerSourceCache(Tt),$t=kt?_e[kt.id]:void 0;(Tt.type==="model"||$t&&$t.length)&&ot.renderLayer(ot,kt,Tt,$t)}}ot.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const d=this.painter,_e=d.style,ot=d.context,ut=ot.gl,mt=_e.directionalLight,xt=_e.ambientLight;if(!mt||!xt)return;const Tt=[],kt=Er(d,d.longestCutoffRange);kt.shouldRenderCutoff&&Tt.push("RENDER_CUTOFF"),Tt.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&Tt.push("NORMAL_OFFSET");const $t=os(_e,mt,xt),Xt=new Us(ut.LEQUAL,Us.ReadOnly,d.depthRangeFor3D),rr=new oo({func:ut.EQUAL,mask:255},0,255,ut.KEEP,ut.KEEP,ut.KEEP);for(const tr of this._groundShadowTiles){const nr=tr.toUnwrapped(),cr=d.isTileAffectedByFog(tr),lr=d.getOrCreateProgram("groundShadow",{defines:Tt,overrideFog:cr});this.setupShadows(nr,lr),d.uploadCommonUniforms(ot,lr,nr,null,kt);const yr={u_matrix:d.transform.calculateProjMatrix(nr),u_ground_shadow_factor:$t};lr.draw(d,ut.TRIANGLES,Xt,rr,co.multiply,wr.disabled,yr,"ground_shadow",d.tileExtentBuffer,d.quadTriangleIndexBuffer,d.tileExtentSegments,null,d.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?co.unblended:co.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(d){const _e=this.painter.transform,ot=_e.calculatePosMatrix(d,_e.worldSize);return c.aB(ot,this._cascades[this.painter.currentShadowCascade].matrix,ot),Float32Array.from(ot)}calculateShadowPassMatrixFromMatrix(d){const _e=c.bz(d);return c.aB(_e,this._cascades[this.painter.currentShadowCascade].matrix,d),_e}setupShadows(d,_e,ot){if(!this.enabled)return;const ut=this.painter.transform,mt=this.painter.context,xt=mt.gl,Tt=this._uniformValues,kt=new Float64Array(16),$t=ut.calculatePosMatrix(d,ut.worldSize);for(let Xt=0;Xt<this._cascades.length;Xt++)c.aB(kt,this._cascades[Xt].matrix,$t),Tt[Xt===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(kt),mt.activeTexture.set(xt.TEXTURE0+Dt.ShadowMap0+Xt),this._cascades[Xt].texture.bindExtraParam(xt.LINEAR,xt.LINEAR,xt.CLAMP_TO_EDGE,xt.CLAMP_TO_EDGE,xt.GREATER);if(this.useNormalOffset=!!ot,this.useNormalOffset){const Xt=c.d7(d.canonical),rr=2/ut.tileSize*c.al/Pr,tr=rr*this._cascades[0].boundingSphereRadius,nr=rr*this._cascades[this._cascades.length-1].boundingSphereRadius,cr=(ot==="vector-tile"?1:3)*function(lr,yr,xr,Ar,Dr){const Tr=c.aA((lr-22)/-22,0,1);return .125*(1-Tr)+4*Tr}(ut.zoom);Tt.u_shadow_normal_offset=[Xt,tr*cr,nr*cr],Tt.u_shadow_bias=[1e-4,.0012,.012]}else Tt.u_shadow_bias=[36e-5,.0012,.012];_e.setShadowUniformValues(mt,Tt)}setupShadowsFromMatrix(d,_e,ot=!1){if(!this.enabled)return;const ut=this.painter.context,mt=ut.gl,xt=this._uniformValues,Tt=new Float64Array(16);for(let kt=0;kt<2;kt++)c.aB(Tt,this._cascades[kt].matrix,d),xt[kt===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(Tt),ut.activeTexture.set(mt.TEXTURE0+Dt.ShadowMap0+kt),this._cascades[kt].texture.bindExtraParam(mt.LINEAR,mt.LINEAR,mt.CLAMP_TO_EDGE,mt.CLAMP_TO_EDGE,mt.GREATER);this.useNormalOffset=ot,ot?(xt.u_shadow_normal_offset=[1,3,3],xt.u_shadow_bias=[6e-5,.0012,.012]):xt.u_shadow_bias=[36e-5,.0012,.012],_e.setShadowUniformValues(ut,xt)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(d,_e,ot,ut){if(ut[2]>=0)return{};const mt=function(kt,$t,Xt){const rr=Xt/(1<<kt.canonical.z);return new c.d9([kt.canonical.x*rr+kt.wrap*Xt,kt.canonical.y*rr+kt.wrap*Xt,0],[(kt.canonical.x+1)*rr+kt.wrap*Xt,(kt.canonical.y+1)*rr+kt.wrap*Xt,$t])}(d,_e,ot).getCorners(),xt=_e/-ut[2];ut[0]<0?(c.d8(mt[0],mt[0],[ut[0]*xt,0,0]),c.d8(mt[3],mt[3],[ut[0]*xt,0,0])):ut[0]>0&&(c.d8(mt[1],mt[1],[ut[0]*xt,0,0]),c.d8(mt[2],mt[2],[ut[0]*xt,0,0])),ut[1]<0?(c.d8(mt[0],mt[0],[0,ut[1]*xt,0]),c.d8(mt[1],mt[1],[0,ut[1]*xt,0])):ut[1]>0&&(c.d8(mt[2],mt[2],[0,ut[1]*xt,0]),c.d8(mt[3],mt[3],[0,ut[1]*xt,0]));const Tt={};return Tt.vertices=mt,Tt.planes=[Pn(mt[1],mt[0],mt[4]),Pn(mt[2],mt[1],mt[5]),Pn(mt[3],mt[2],mt[6]),Pn(mt[0],mt[3],mt[7])],Tt}addShadowReceiver(d,_e,ot){this._receivers.add(d,c.d9.fromTileIdAndHeight(d,_e,ot))}getMaxCascadeForTile(d){const _e=this._receivers.get(d);return _e&&_e.lastCascade?_e.lastCascade:0}}function Pn(st,d,_e){const ot=c.av([],_e,d),ut=c.av([],st,d),mt=c.bI([],ot,ut),xt=c.ag(mt);return xt===0?[0,0,1,0]:(c.c5(mt,mt,1/xt),[mt[0],mt[1],mt[2],-c.bJ(mt,d)])}function Xn(st){const d=st.properties.get("direction"),_e=c.d4(d.x,d.y,d.z);_e[2]=c.aA(_e[2],0,75);const ot=c.d6([_e[0],_e[1],_e[2]]);return c.d5(ot.x,ot.y,ot.z)}function os(st,d,_e){const ot=d.properties.get("color-use-theme")==="none",ut=d.properties.get("color"),mt=d.properties.get("intensity"),xt=d.properties.get("direction"),Tt=[xt.x,xt.y,xt.z],kt=_e.properties.get("color-use-theme")==="none",$t=_e.properties.get("color"),Xt=_e.properties.get("intensity"),rr=Math.max(c.bJ([0,0,1],Tt),0),tr=[0,0,0];c.c5(tr,$t.toPremultipliedRenderColor(kt?null:st.getLut(d.scope)).toArray01Linear().slice(0,3),Xt);const nr=[0,0,0];return c.c5(nr,ut.toPremultipliedRenderColor(ot?null:st.getLut(_e.scope)).toArray01Linear().slice(0,3),rr*mt),c.db([tr[0]>0?tr[0]/(tr[0]+nr[0]):0,tr[1]>0?tr[1]/(tr[1]+nr[1]):0,tr[2]>0?tr[2]/(tr[2]+nr[2]):0])}function Ks(st,d,_e,ot,ut,mt){const xt=st.zoom,Tt=st.scale,kt=st.worldSize,$t=1/kt,Xt=st.aspect,rr=Math.sqrt(1+Xt*Xt)*Math.tan(.5*st.fovX),tr=rr*rr,nr=ot-_e,cr=ot+_e;let lr,yr;tr>nr/cr?(lr=ot,yr=ot*rr):(lr=.5*cr*(1+tr),yr=.5*Math.sqrt(nr*nr+2*(ot*ot+_e*_e)*tr+cr*cr*tr*tr));const xr=st.projection.pixelsPerMeter(st.center.lat,kt),Ar=st._camera.getCameraToWorldMercator(),Dr=[0,0,-lr*$t];c.af(Dr,Dr,Ar);let Tr=yr*$t;const Wr=st._edgeInsets;if(!(Wr.left===0&&Wr.top===0&&Wr.right===0&&Wr.bottom===0||Wr.left===Wr.right&&Wr.top===Wr.bottom)){const $n=st._camera.getWorldToCamera(st.worldSize,st.projection.zAxisUnit==="meters"?xr:1),ls=st._camera.getCameraToClipPerspective(st._fov,st.width/st.height,_e,ot);ls[8]=2*-st.centerOffset.x/st.width,ls[9]=2*st.centerOffset.y/st.height;const As=new Float64Array(16);c.cP(As,ls,$n);const is=new Float64Array(16);c.bl(is,As);const _i=c.cB.fromInvProjectionMatrix(is,kt,xt,!0);for(const Ls of _i.points){const Bs=((zr=Ls)[0]/=Tt,zr[1]/=Tt,zr[2]=c.cf(zr[2],st._center.lat),zr);Tr=Math.max(Tr,c.c6(c.da([],Dr,Bs)))}}var zr;Tr*=ut/(ut-1);const $r=Math.acos(d[2]),Or=Math.atan2(-d[0],-d[1]),Br=new It;Br.position=Dr,Br.setPitchBearing($r,Or);const Xr=Br.getWorldToCamera(kt,xr),an=Tr*kt,sn=Math.min(st._mercatorZfromZoom(17)*kt*-2,-2*an),wn=Br.getCameraToClipOrthographic(-an,an,-an,an,sn,(an+mt*xr)/d[2]),Cn=new Float64Array(16);c.aB(Cn,wn,Xr);const Nn=c.d5(Math.floor(1e6*Dr[0])/1e6*kt,Math.floor(1e6*Dr[1])/1e6*kt,0),Jn=.5*ut,yn=[0,0,0];c.af(yn,Nn,Cn),c.c5(yn,yn,Jn);const Qr=[Math.floor(yn[0]),Math.floor(yn[1]),Math.floor(yn[2])],Dn=[0,0,0];c.av(Dn,yn,Qr),c.c5(Dn,Dn,-1/Jn);const bn=new Float64Array(16);return c.bA(bn),c.br(bn,bn,Dn),c.aB(Cn,bn,Cn),[Cn,an]}class Js extends c.E{constructor(d){super(),this.requestManager=d,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(d,_e){return c.dc(this.requestManager.transformRequest(_e,c.R.Model).url).then(ot=>{if(!ot)return;const ut=c.dd(ot),mt=new c.de(d,_e,void 0,void 0,ut);return mt.computeBoundsAndApplyParent(),mt}).catch(ot=>{if(ot&&ot.status===404)return null;this.fire(new c.y(new Error(`Could not load model ${d} from ${_e}: ${ot.message}`)))})}load(d,_e,ot={forceReload:!1}){this.models[_e]||(this.models[_e]={});const ut=Object.keys(d),mt=[],xt=[];for(const Tt of ut){const kt=d[Tt];this.hasURLBeenRequested(kt)&&!ot.forceReload||(this.modelByURL[kt]={modelId:Tt,scope:_e},mt.push(this.loadModel(Tt,kt)),xt.push(Tt)),this.models[_e][Tt]||(this.models[_e][Tt]={model:null,numReferences:1})}this.numModelsLoading[_e]=(this.numModelsLoading[_e]||0)+xt.length,Promise.allSettled(mt).then(Tt=>{for(let kt=0;kt<Tt.length;kt++){const{status:$t}=Tt[kt];if($t==="rejected")continue;const{value:Xt}=Tt[kt];this.models[_e][xt[kt]]||(this.models[_e][xt[kt]]={model:null,numReferences:1}),this.models[_e][xt[kt]].model=Xt}this.numModelsLoading[_e]-=xt.length,this.fire(new c.z("data",{dataType:"style"}))}).catch(Tt=>{this.fire(new c.y(new Error(`Could not load models: ${Tt.message}`)))})}isLoaded(){for(const d in this.numModelsLoading)if(this.numModelsLoading[d]>0)return!1;return!0}hasModel(d,_e,ot={exactIdMatch:!1}){return!!(ot.exactIdMatch?this.getModel(d,_e):this.getModelByURL(this.modelUris[_e][d]))}getModel(d,_e){return this.models[_e]||(this.models[_e]={}),this.models[_e][d]?this.models[_e][d].model:void 0}getModelByURL(d){if(!d)return null;const _e=this.modelByURL[d];return _e?this.models[_e.scope][_e.modelId].model:null}hasModelBeenAdded(d,_e){return this.models[_e]&&this.models[_e][d]!==void 0}getModelURIs(d){return this.modelUris[d]||{}}addModel(d,_e,ot){this.models[ot]||(this.models[ot]={}),this.modelUris[ot]||(this.modelUris[ot]={});const ut=this.requestManager.normalizeModelURL(_e);if((this.hasModel(d,ot,{exactIdMatch:!0})||this.hasModelBeenAdded(d,ot))&&this.modelUris[ot][d]===ut)this.models[ot][d].numReferences++;else if(this.hasURLBeenRequested(ut)){const{scope:mt,modelId:xt}=this.modelByURL[ut];this.models[mt][xt].numReferences++}else this.modelUris[ot][d]=ut,this.load({[d]:this.modelUris[ot][d]},ot)}addModelURLs(d,_e){this.models[_e]||(this.models[_e]={}),this.modelUris[_e]||(this.modelUris[_e]={});const ot=this.modelUris[_e];for(const ut in d)ot[ut]=this.requestManager.normalizeModelURL(d[ut])}reloadModels(d){this.load(this.modelUris[d],d,{forceReload:!0})}addModelsFromBucket(d,_e){this.models[_e]||(this.models[_e]={}),this.modelUris[_e]||(this.modelUris[_e]={});const ot={};for(const ut of d)this.hasModel(ut,_e,{exactIdMatch:!0})||this.hasURLBeenRequested(ut)?this.models[_e][ut].numReferences++:this.modelUris[_e][ut]&&!this.hasURLBeenRequested(ut)?ot[ut]=this.modelUris[_e][ut]:!this.hasURLBeenRequested(ut)&&c.df(ut,!1)&&(this.modelUris[_e][ut]=this.requestManager.normalizeModelURL(ut),ot[ut]=this.modelUris[_e][ut]);this.load(ot,_e)}hasURLBeenRequested(d){return this.modelByURL[d]!==void 0}removeModel(d,_e,ot=!1,ut=!1){if(this.models[_e]&&this.models[_e][d]&&(this.models[_e][d].numReferences--,this.models[_e][d].numReferences===0||ut)){const mt=this.modelUris[_e][d];ot||delete this.modelUris[_e][d],delete this.modelByURL[mt];const xt=this.models[_e][d].model;if(!xt)return;delete this.models[_e][d],xt.destroy()}}destroy(){for(const d of Object.keys(this.models))for(const _e of Object.keys(this.models[d])){const ot=this.models[d][_e].model;delete this.models[d][_e],ot&&ot.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(d){return this.models[d]||(this.models[d]={}),Object.keys(this.models[d])}upload(d,_e){this.models[_e]||(this.models[_e]={});for(const ot in this.models[_e])this.models[_e][ot].model&&this.models[_e][ot].model.upload(d.context)}}const Hs=c.a6.colorTheme,lu=new c.a9({data:new c.aa(Hs.data)});function zl(st){if(!st.metadata||!st.metadata.content_area)return;const d=c.o.devicePixelRatio,{left:_e,top:ot,width:ut,height:mt}=st.metadata.content_area,xt=_e*d,Tt=ot*d;return[xt,Tt,xt+ut*d,Tt+mt*d]}function kp(st){if(st)return st.map(([d,_e])=>[d*c.o.devicePixelRatio,_e*c.o.devicePixelRatio])}class Up{constructor(d,_e,ot){this.id=d,this.scope=_e,this.sourceCache=ot,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(d){this.missingRequests.has(d.name)||this.pendingRequests.has(d.name)||this.pendingRequests.add(d.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const d=new Map;if(!this.sourceCache.loaded())return d;const _e=this.sourceCache.getVisibleCoordinates();if(_e.length===0)return d;const ot=this.sourceCache.getSource();if(!(ot instanceof Un))return d;const ut=_e.map(xt=>this.sourceCache.getTile(xt)),mt=ot.getImages(ut,Array.from(this.pendingRequests));for(const[xt,Tt]of mt)d.set(c.I.from({name:xt,iconsetId:this.id}),Tt),this.pendingRequests.delete(xt);for(const xt of this.pendingRequests)this.missingRequests.add(xt);return this.pendingRequests.clear(),d}}const ap=(st,d)=>kr(st,d&&d.filter(_e=>_e.identifier!=="source.canvas")),Ou=c.aH(qo,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setLayerProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),mp=c.aH(qo,["setCenter","setZoom","setBearing","setPitch"]),Cp=new Set(["background","sky","slot","custom"]),Gp={version:8,layers:[],sources:{}},E0={duration:300,delay:0};class Zp extends c.E{constructor(d,_e={}){super(),this.map=d,this.scope=_e.scope||"",this.globalId=null,this.fragments=[],this.importDepth=_e.importDepth||0,this.importsCache=_e.importsCache||new Map,this.resolvedImports=_e.resolvedImports||new Set,this.transition=Object.assign({},E0),this._buildingIndex=new J0(this),this.crossTileSymbolIndex=new n0,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedIndoor={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._hasAppearances=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._importedAsBasemap=!1,this._changes=_e.styleChanges||new tn,this._hasDataDrivenEmissive=!1,this.dispatcher=_e.dispatcher?_e.dispatcher:new c.D(c.dh(),this),_e.imageManager?this.imageManager=_e.imageManager:(this.imageManager=new Co(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=_e.glyphManager?_e.glyphManager:new c.di(d._requestManager,_e.localFontFamily?c.dj.all:_e.localIdeographFontFamily?c.dj.ideographs:c.dj.none,_e.localFontFamily||_e.localIdeographFontFamily),_e.modelManager?this.modelManager=_e.modelManager:(this.modelManager=new Js(d._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=_e.configOptions?_e.configOptions:new Map,this._configDependentLayers=_e.configDependentLayers?_e.configDependentLayers:new Set,this._indoorDependentLayers=_e.indoorDependentLayers?_e.indoorDependentLayers:new Set,this._config=_e.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:_e.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=_e.initialConfig,this.dispatcher.broadcast("setReferrer",c.dk());const ot=this;this._rtlTextPluginCallback=Zp.registerForPluginStateChange(ut=>{ot.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:ut.pluginStatus,pluginURL:ut.pluginURL},(mt,xt)=>{if(c.dl(mt),xt&&xt.every(Tt=>Tt))for(const Tt in ot._sourceCaches){const kt=ot._sourceCaches[Tt],$t=kt.getSource().type;$t!=="vector"&&$t!=="geojson"||kt.reload()}})}),this.on("data",ut=>{if(ut.dataType!=="source"||ut.sourceDataType!=="metadata")return;const mt=this.getOwnSource(ut.sourceId);if(mt&&mt.vectorLayerIds)for(const xt in this._layers){const Tt=this._layers[xt];Tt.source===mt.id&&this._validateLayer(Tt)}})}load(d){return d?(typeof d=="string"?this.loadURL(d):this.loadJSON(d),this):this}_getGlobalId(d){if(!d)return null;if(typeof d=="string"){if(c.h(d))return d;const _e=c.dm(d);if(!_e.startsWith("http"))try{return new URL(_e,location.href).toString()}catch{return _e}return _e}return`json://${c.dn(JSON.stringify(d))}`}_diffStyle(d,_e,ot){this.globalId=this._getGlobalId(d);const ut=(mt,xt)=>{try{xt(null,this.setState(mt,ot))}catch(Tt){xt(Tt,!1)}};if(typeof d=="string"){const mt=this.map._requestManager.normalizeStyleURL(d),xt=this.map._requestManager.transformRequest(mt,c.R.Style);c.m(xt,(Tt,kt)=>{Tt?this.fire(new c.y(Tt)):kt&&ut(kt,_e)})}else typeof d=="object"&&ut(d,_e)}loadURL(d,_e={}){this.fire(new c.z("dataloading",{dataType:"style"}));const ot=typeof _e.validate=="boolean"?_e.validate:!c.h(d);this.globalId=this._getGlobalId(d),d=this.map._requestManager.normalizeStyleURL(d,_e.accessToken),this.resolvedImports.add(d);const ut=this.importsCache.get(d);if(ut)return this._load(ut,ot);const mt=this.map._requestManager.transformRequest(d,c.R.Style);this._request=c.m(mt,(xt,Tt)=>{if(this._request=null,xt)this.fire(new c.y(xt));else if(Tt)return this.importsCache.set(d,Tt),this._load(Tt,ot)})}loadJSON(d,_e={}){this.fire(new c.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(d),this._request=c.o.frame(()=>{this._request=null,this._load(d,_e.validate!==!1)})}loadEmpty(){this.fire(new c.z("dataloading",{dataType:"style"})),this._load(Gp,!1)}_loadImports(d,_e,ot){if(this.importDepth>=4)return c.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const ut=[];for(const mt of d){const xt=this._createFragmentStyle(mt),Tt=new Promise(Xt=>{xt.once("style.import.load",Xt),xt.once("error",Xt)}).then(()=>this.mergeAll());if(ut.push(Tt),this.resolvedImports.has(mt.url)){xt.loadEmpty();continue}const kt=mt.data||this.importsCache.get(mt.url);kt?(xt.loadJSON(kt,{validate:_e}),this._isInternalStyle(kt)&&(xt.globalId=null)):mt.url?xt.loadURL(mt.url,{validate:_e}):xt.loadEmpty();const $t={style:xt,id:mt.id,config:mt.config};if(ot){const Xt=this.fragments.findIndex(({id:rr})=>rr===ot);this.fragments=this.fragments.slice(0,Xt).concat($t).concat(this.fragments.slice(Xt))}else this.fragments.push($t)}return Promise.allSettled(ut)}getImportGlobalIds(d=this,_e=new Set){for(const ot of d.fragments)ot.style.globalId&&_e.add(ot.style.globalId),this.getImportGlobalIds(ot.style,_e);return[..._e.values()]}_createFragmentStyle(d){const _e=this.scope?c.B(d.id,this.scope):d.id;let ot;const ut=this._initialConfig&&this._initialConfig[_e];(d.config||ut)&&(ot=Object.assign({},d.config,ut));const mt=new Zp(this.map,{scope:_e,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:ot,configOptions:this.options,colorThemeOverride:d["color-theme"],configDependentLayers:this._configDependentLayers,indoorDependentLayers:this._indoorDependentLayers});return mt.setEventedParent(this.map,{style:mt}),mt}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this._updateLayers(this._indoorDependentLayers),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(d){return this.isRootStyle()&&(d.fragment||!!d.schema&&d.fragment!==!1)}_load(d,_e){if(this._isInternalStyle(d)){const mt=Object.assign({},Gp,{imports:[{id:"basemap",data:d,url:""}]},d.center?{center:d.center}:{},d.bearing?{bearing:d.bearing}:{},d.pitch?{pitch:d.pitch}:{},d.zoom?{zoom:d.zoom}:{},d.light?{light:d.light}:{});return this._importedAsBasemap=!0,void this._load(mt,_e)}if(this.updateConfig(this._config,d.schema),_e&&ap(this,Jo(d)))return;this._loaded=!0,this.stylesheet=c.dp(d);const ot=()=>{for(const kt in d.sources)this.addSource(kt,d.sources[kt],{validate:!1,isInitialLoad:!0});if(d.iconsets)for(const kt in d.iconsets)this.addIconset(kt,d.iconsets[kt]);d.sprite?this._loadIconset(d.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&d.glyphs&&this.glyphManager.setURL(d.glyphs);const mt=I0(this.stylesheet.layers);if(this._order=mt.map(kt=>kt.id),this.stylesheet.light&&c.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const kt=this.stylesheet.lights[0];this.light=new rn(kt.properties,kt.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new rn(this.stylesheet.light)),this._layers={};for(const kt of mt){const $t=c.du(kt,this.scope,this._styleColorTheme.lut,this.options);$t.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add($t.fqid),$t.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add($t.fqid),this._hasAppearances=this._hasAppearances||$t.getAppearances().length!==0,$t.setEventedParent(this,{layer:{id:$t.id}}),this._layers[$t.id]=$t;const Xt=this.getOwnLayerSourceCache($t),rr=!!this.directionalLight&&this.directionalLight.shadowsEnabled();Xt&&$t.canCastShadows()&&rr&&(Xt.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const xt=this.stylesheet.terrain;xt&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(xt,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new c.z("data",{dataType:"style"}));const Tt=this.isRootStyle();d.imports?this._loadImports(d.imports,_e).then(()=>{this._reloadImports(),this.fire(new c.z(Tt?"style.load":"style.import.load"))}).catch(kt=>{this.fire(new c.y(new Error("Failed to load imports",kt))),this.fire(new c.z(Tt?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new c.z(Tt?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const ut=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(ut){const mt=this._evaluateColorThemeData(ut);this._loadColorTheme(mt).then(()=>{ot()}).catch(xt=>{c.w(`Couldn't load color theme from the stylesheet: ${xt}`),ot()})}else this._styleColorTheme.lut=null,ot()}isRootStyle(){return this.importDepth===0}hasAppearances(){return this._hasAppearances||this.fragments.some(d=>d.style.hasAppearances())}mergeAll(){let d,_e,ot,ut,mt,xt,Tt,kt,$t,Xt;const rr={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(tr=>{if(tr.stylesheet){if(tr.light!=null&&(d=tr.light),tr.stylesheet.lights)for(const nr of tr.stylesheet.lights)nr.type==="ambient"&&tr.ambientLight!=null&&(_e=tr.ambientLight),nr.type==="directional"&&tr.directionalLight!=null&&(ot=tr.directionalLight);ut=this._prioritizeTerrain(ut,tr.terrain,tr.stylesheet.terrain),tr.stylesheet.fog&&tr.fog!=null&&(mt=tr.fog),tr.stylesheet.snow&&tr.snow!=null&&(xt=tr.snow),tr.stylesheet.rain&&tr.rain!=null&&(Tt=tr.rain),tr.stylesheet.camera!=null&&(Xt=tr.stylesheet.camera),tr.stylesheet.projection!=null&&(kt=tr.stylesheet.projection),tr.stylesheet.transition!=null&&($t=tr.stylesheet.transition),rr[tr.scope]=tr._styleColorTheme}}),this.light=d,this.ambientLight=_e,this.directionalLight=ot,this.fog=mt,this.snow=xt,this.rain=Tt,this._styleColorThemeForScope=rr,ut===null?delete this.terrain:this.terrain=ut,this.camera=Xt||{"camera-projection":"perspective"},this.projection=kt||{name:"mercator"},this.transition=Object.assign({},E0,$t),this.mergeSources(),this.mergeLayers(),this.mergeIndoor()}forEachFragmentStyle(d){const _e=ot=>{for(const ut of ot.fragments)_e(ut.style);d(ot)};_e(this)}_prioritizeTerrain(d,_e,ot){const ut=d&&d.drapeRenderMode===0;return ot===null?_e&&_e.drapeRenderMode===0?_e:ut?d:null:_e!=null&&(!d||ut||_e&&_e.drapeRenderMode===1)?_e:d}mergeTerrain(){let d;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(_e=>{d=this._prioritizeTerrain(d,_e.terrain,_e.stylesheet.terrain)}),d===null?delete this.terrain:this.terrain=d}mergeProjection(){let d;this.forEachFragmentStyle(_e=>{_e.stylesheet.projection!=null&&(d=_e.stylesheet.projection)}),this.projection=d||{name:"mercator"}}mergeSources(){const d={},_e={},ot={};this.forEachFragmentStyle(ut=>{for(const mt in ut._sourceCaches){const xt=c.B(mt,ut.scope);d[xt]=ut._sourceCaches[mt]}for(const mt in ut._otherSourceCaches){const xt=c.B(mt,ut.scope);_e[xt]=ut._otherSourceCaches[mt]}for(const mt in ut._symbolSourceCaches){const xt=c.B(mt,ut.scope);ot[xt]=ut._symbolSourceCaches[mt]}}),this._mergedSourceCaches=d,this._mergedOtherSourceCaches=_e,this._mergedSymbolSourceCaches=ot}mergeIndoor(){this.forEachFragmentStyle(d=>{if(d.stylesheet&&d.stylesheet.indoor)for(const _e of Object.values(d.stylesheet.indoor)){const ot=_e,ut=c.B(ot.sourceId,d.scope);this._mergedIndoor[ut]=new Set(ot.sourceLayers||[])}})}mergeLayers(){const d={},_e=[],ot={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(xt=>{for(const Tt of xt._order){const kt=xt._layers[Tt];if(kt.type==="slot"){const $t=c.dq(Tt);if(d[$t])continue;d[$t]=[]}kt.slot&&d[kt.slot]?d[kt.slot].push(kt):_e.push(kt)}}),this._mergedOrder=[];let ut=-1;const mt=(xt=[])=>{for(const Tt of xt)if(Tt.type==="slot"){const kt=c.dq(Tt.id);d[kt]&&mt(d[kt]),this._mergedSlots.push(kt)}else{const kt=c.B(Tt.id,Tt.scope);this._mergedOrder.push(kt),ot[kt]=Tt,Tt.is3D(!!this.terrain)&&(this._has3DLayers=!0,ut=this._mergedOrder.length-1),Tt.type==="circle"&&(this._hasCircleLayers=!0),Tt.type==="symbol"&&(this._hasSymbolLayers=!0),Tt.type==="clip"&&(this._clipLayerPresent=!0)}};if(mt(_e),this._has3DLayers){const xt={};for(let Tt=0;Tt<this._mergedOrder.length;++Tt){const kt=this._mergedOrder[Tt];xt[kt]=Tt===ut?1:Tt<ut?ot[kt].hasOcclusionOpacityProperties?2:0:4}this._mergedOrder.sort((Tt,kt)=>xt[Tt]-xt[kt])}this._mergedLayers=ot,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged(),this._updateDataDrivenEmissiveStrength()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(d){return this.stylesheet.camera=Object.assign({},this.stylesheet.camera,d),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(d){return d.data?function(_e,ot,ut,mt){const xt=Object.assign({},ot);for(const kt of Object.keys(Hs))xt[kt]===void 0&&(xt[kt]=Hs[kt].default);const Tt=new c.a8(lu,_e,new Map(ut));return Tt.setTransitionOrValue(xt,ut),Tt.untransitioned().possiblyEvaluate(new c.ac(0,{worldview:void 0}))}(this.scope,d,this.options).get("data"):null}_loadColorTheme(d){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const _e=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((ot,ut)=>{const mt="data:image/png;base64,";if(!d||d.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void ot();let xt=d;xt.startsWith(mt)||(xt=mt+xt);const Tt=c.I.from("mapbox-reserved-lut"),kt=new Image;kt.src=xt,kt.onerror=()=>{this._styleColorTheme.lutLoading=!1,ut(new Error("Failed to load image data"))},kt.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==_e)return void ot();this._styleColorTheme.lutLoading=!1;const{width:$t,height:Xt,data:rr}=c.o.getImageData(kt);if(Xt>32)return void ut(new Error("The height of the image must be less than or equal to 32 pixels."));if($t!==Xt*Xt)return void ut(new Error("The width of the image must be equal to the height squared."));this.getImage(Tt)&&this.removeImage(Tt),this.addImage(Tt,{data:new c.q({width:$t,height:Xt},rr),pixelRatio:1,sdf:!1,usvg:!1,version:0});const tr=this.imageManager.getImage(Tt,this.scope);tr?(this._styleColorTheme.lut={image:tr.data,data:d},ot()):ut(new Error("Missing LUT image."))}})}getLut(d){const _e=this._styleColorThemeForScope[d];return _e?_e.lut:null}setProjection(d){d?this.stylesheet.projection=d:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(d){this._spriteRequest=function(_e,ot,ut){let mt,xt,Tt;const kt=c.o.devicePixelRatio>1?"@2x":"";let $t=c.m(ot.transformRequest(ot.normalizeSpriteURL(_e,kt,".json"),c.R.SpriteJSON),(tr,nr)=>{$t=null,Tt||(Tt=tr,mt=nr,rr())}),Xt=c.n(ot.transformRequest(ot.normalizeSpriteURL(_e,kt,".png"),c.R.SpriteImage),(tr,nr)=>{Xt=null,Tt||(Tt=tr,xt=nr,rr())});function rr(){if(Tt)ut(Tt);else if(mt&&xt){const tr=c.o.getImageData(xt),nr={};for(const cr in mt){const{width:lr,height:yr,x:xr,y:Ar,sdf:Dr,pixelRatio:Tr,stretchX:Wr,stretchY:zr,content:$r}=mt[cr],Or=new c.q({width:lr,height:yr});c.q.copy(tr,Or,{x:xr,y:Ar},{x:0,y:0},{width:lr,height:yr},null),nr[cr]={data:Or,pixelRatio:Tr!==void 0?Tr:1,sdf:Dr!==void 0&&Dr,stretchX:Wr,stretchY:zr,content:$r,usvg:!1,version:0}}ut(null,nr)}}return{cancel(){$t&&($t.cancel(),$t=null),Xt&&(Xt.cancel(),Xt=null)}}}(d,this.map._requestManager,(_e,ot)=>{if(this._spriteRequest=null,_e)this.fire(new c.y(_e));else if(ot){const ut=new Map;for(const mt in ot)ut.set(c.I.from(mt),ot[mt]);this.addImages(ut)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new c.z("data",{dataType:"style"}))})}addIconset(d,_e){if(_e.type==="sprite")return void this._loadSprite(_e.url);const ot=this.getOwnSourceCache(_e.source);if(!ot)return void this.fire(new c.y(new Error(`Source "${_e.source}" as specified by iconset "${d}" does not exist and cannot be used as an iconset source`)));const ut=ot.getSource();if(ut.type!=="raster-array")return void this.fire(new c.y(new Error(`Source "${_e.source}" as specified by iconset "${d}" is not a "raster-array" source and cannot be used as an iconset source`)));ut.partial=!1;const mt=new Up(d,this.scope,ot);this.imageManager.addImageProvider(mt,this.scope)}removeIconset(d){this.imageManager.removeImageProvider(d,this.scope)}_loadIconset(d){if(!c.h(d)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(d);const _e=this.map._spriteFormat==="auto";var ot,ut;this._spriteRequest=(ut=(mt,xt)=>{if(this._spriteRequest=null,mt)_e?this._loadSprite(d):this.fire(new c.y(mt));else if(xt){const Tt=new Map;for(const kt in xt)Tt.set(c.I.from(kt),xt[kt]);this.addImages(Tt)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new c.z("data",{dataType:"style"}))},c.bu((ot=this.map._requestManager).transformRequest(ot.normalizeIconsetURL(d),c.R.Iconset),(mt,xt)=>{if(mt)return void ut(mt);const Tt={},kt=c.dg(new c.bt(xt));for(const $t of kt.icons){const Xt={version:1,pixelRatio:c.o.devicePixelRatio,content:zl($t),stretchX:$t.metadata?kp($t.metadata.stretch_x_areas):void 0,stretchY:$t.metadata?kp($t.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:$t};Tt[$t.name]=Xt}ut(null,Tt)}))}_validateLayer(d){const _e=this.getOwnSource(d.source);if(!_e)return;const ot=d.sourceLayer;ot&&(_e.type==="geojson"||_e.vectorLayerIds&&_e.vectorLayerIds.indexOf(ot)===-1)&&this.fire(new c.y(new Error(`Source layer "${ot}" does not exist on source "${_e.id}" as specified by style layer "${d.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const d in this._sourceCaches)if(!this._sourceCaches[d].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:d}of this.fragments)if(!d.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((d,_e)=>{const ot=this.fragments[_e];return ot&&ot.style&&(d.data=ot.style.serialize()),d})}_serializeSources(){const d={};for(const _e in this._sourceCaches){const ot=this._sourceCaches[_e].getSource();d[ot.id]||(d[ot.id]=ot.serialize())}return d}_serializeLayers(d){const _e=[];for(const ot of d){const ut=this._layers[ot];ut&&ut.type!=="custom"&&_e.push(ut.serialize())}return _e}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const d in this._sourceCaches)if(this._sourceCaches[d].hasTransition())return!0;for(const d in this._layers)if(this._layers[d].hasTransition())return!0;return!1}_updateDataDrivenEmissiveStrength(){for(const d in this._mergedLayers){const _e=this._mergedLayers[d];if(_e._transitionablePaint&&_e._transitionablePaint._values){const ot=_e._transitionablePaint._values["line-emissive-strength"];if(ot&&ot.value&&ot.value.isDataDriven())return void(this._hasDataDrivenEmissive=!0)}}this._hasDataDrivenEmissive=!1}hasDataDrivenEmissiveStrength(){return this._hasDataDrivenEmissive}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(d){return d?this.order:this._mergedOrder}isLayerDraped(d){return!!this.terrain&&d.isDraped(this.getLayerSourceCache(d))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(d){const _e=this.getOwnLayer(d);if(_e)return _e;this.fire(new c.y(new Error(`The layer '${d}' does not exist in the map's style.`)))}_checkSource(d){const _e=this.getOwnSource(d);if(_e)return _e;this.fire(new c.y(new Error(`The source '${d}' does not exist in the map's style.`)))}precompilePrograms(d,_e){const ot=this.map.painter;if(ot)for(let ut=d.minzoom||0;ut<(d.maxzoom||25.5);ut++){const mt=d.getProgramIds();if(mt)for(const xt of mt){const Tt=d.getDefaultProgramParams(xt,_e.zoom,this._styleColorTheme.lut);Tt&&(ot.style=this,this.fog&&(ot._fogVisible=!0,Tt.overrideFog=!0,ot.getOrCreateProgram(xt,Tt)),ot._fogVisible=!1,Tt.overrideFog=!1,ot.getOrCreateProgram(xt,Tt),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(Tt.overrideRtt=!0,ot.getOrCreateProgram(xt,Tt)))}}}update(d){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(d),this.directionalLight&&this.directionalLight.recalculate(d);const _e=this.calculateLightsBrightness();d.brightness=_e||0,_e!==this._brightness&&(this._brightness=_e,this.dispatcher.broadcast("setBrightness",_e)),d.worldview!==this._worldview&&(this._worldview=d.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const ot=this._changes.isDirty();let ut=!1;if(this._changes.isDirty()){const Tt=this._changes.getLayerUpdatesByScope();for(const kt in Tt){const{updatedIds:$t,removedIds:Xt}=Tt[kt];($t||Xt)&&(this._updateWorkerLayers(kt,$t,Xt),ut=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(d),this.light&&this.light.updateTransitions(d),this.ambientLight&&this.ambientLight.updateTransitions(d),this.directionalLight&&this.directionalLight.updateTransitions(d),this.fog&&this.fog.updateTransitions(d),this.snow&&this.snow.updateTransitions(d),this.rain&&this.rain.updateTransitions(d),this._changes.reset()}const mt={};for(const Tt in this._mergedSourceCaches){const kt=this._mergedSourceCaches[Tt];mt[Tt]=kt.used,kt.used=!1,kt.tileCoverLift=0}for(const Tt of this._mergedOrder){const kt=this._mergedLayers[Tt];if(kt.visibility!=="none"&&kt.recalculate(d,this._availableImages),!kt.isHidden(d.zoom)){const $t=this.getLayerSourceCache(kt);$t&&($t.used=!0,$t.tileCoverLift=Math.max($t.tileCoverLift,kt.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(kt,d)}):this.precompilePrograms(kt,d))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&ut&&this.mergeLayers();const xt=this.imageManager.getPendingImageProviders();for(const Tt of xt)Tt.sourceCache.used=!0;for(const Tt in mt){const kt=this._mergedSourceCaches[Tt];mt[Tt]!==kt.used&&kt.getSource().fire(new c.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:kt.getSource().id}))}this.light&&this.light.recalculate(d),this.terrain&&this.terrain.recalculate(d),this.fog&&this.fog.recalculate(d),this.snow&&this.snow.recalculate(d),this.rain&&this.rain.recalculate(d),this.z=d.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),ot&&this.fire(new c.z("data",{dataType:"style"}))}updateImageProviders(){const d=this.imageManager.getPendingImageProviders();for(const _e of d){const ot=_e.resolvePendingRequests(),ut=this.getFragmentStyle(_e.scope);ut&&ut.addImages(ot)}}_updateTilesForChangedImages(){const d={};for(const _e in this._mergedSourceCaches){const ot=this._mergedSourceCaches[_e].getSource().scope;d[ot]=d[ot]||this._changes.getUpdatedImages(ot),d[ot].length!==0&&this._mergedSourceCaches[_e].reloadTilesForDependencies(["icons","patterns"],d[ot])}for(const _e in d)this._changes.resetUpdatedImages(_e)}_updateWorkerLayers(d,_e,ot){const ut=this.getFragmentStyle(d);ut&&this.dispatcher.broadcast("updateLayers",{layers:_e?ut._serializeLayers(_e):[],scope:d,removedIds:ot||[],options:ut.options})}setState(d,_e){if(this._checkLoaded(),ap(this,Jo(d)))return!1;(d=c.dp(d)).layers=I0(d.layers);const ot=function(xt,Tt){if(!xt)return[{command:qo.setStyle,args:[Tt]}];let kt=[];try{if(!c.by(xt.version,Tt.version))return[{command:qo.setStyle,args:[Tt]}];if(c.by(xt.center,Tt.center)||kt.push({command:qo.setCenter,args:[Tt.center]}),c.by(xt.zoom,Tt.zoom)||kt.push({command:qo.setZoom,args:[Tt.zoom]}),c.by(xt.bearing,Tt.bearing)||kt.push({command:qo.setBearing,args:[Tt.bearing]}),c.by(xt.pitch,Tt.pitch)||kt.push({command:qo.setPitch,args:[Tt.pitch]}),c.by(xt.sprite,Tt.sprite)||kt.push({command:qo.setSprite,args:[Tt.sprite]}),c.by(xt.glyphs,Tt.glyphs)||kt.push({command:qo.setGlyphs,args:[Tt.glyphs]}),c.by(xt.imports,Tt.imports)||function(nr=[],cr=[],lr){cr=cr||[];const yr=(nr=nr||[]).map(Rm),xr=cr.map(Rm),Ar=nr.reduce(Im,{}),Dr=cr.reduce(Im,{}),Tr=yr.slice();let Wr,zr,$r,Or;for(Wr=0,zr=0;Wr<yr.length;Wr++)$r=yr[Wr],Dr.hasOwnProperty($r)?zr++:(lr.push({command:qo.removeImport,args:[$r]}),Tr.splice(Tr.indexOf($r,zr),1));for(Wr=0,zr=0;Wr<xr.length;Wr++)$r=xr[xr.length-1-Wr],Tr[Tr.length-1-Wr]!==$r&&(Ar.hasOwnProperty($r)?(lr.push({command:qo.removeImport,args:[$r]}),Tr.splice(Tr.lastIndexOf($r,Tr.length-zr),1)):zr++,Or=Tr[Tr.length-Wr],lr.push({command:qo.addImport,args:[Dr[$r],Or]}),Tr.splice(Tr.length-Wr,0,$r));for(const Br of cr){const Xr=Ar[Br.id];Xr&&(delete Xr.data,c.by(Xr,Br)||lr.push({command:qo.updateImport,args:[Br.id,Br]}))}}(xt.imports,Tt.imports,kt),c.by(xt.transition,Tt.transition)||kt.push({command:qo.setTransition,args:[Tt.transition]}),c.by(xt.light,Tt.light)||kt.push({command:qo.setLight,args:[Tt.light]}),c.by(xt.fog,Tt.fog)||kt.push({command:qo.setFog,args:[Tt.fog]}),c.by(xt.snow,Tt.snow)||kt.push({command:qo.setSnow,args:[Tt.snow]}),c.by(xt.rain,Tt.rain)||kt.push({command:qo.setRain,args:[Tt.rain]}),c.by(xt.projection,Tt.projection)||kt.push({command:qo.setProjection,args:[Tt.projection]}),c.by(xt.lights,Tt.lights)||kt.push({command:qo.setLights,args:[Tt.lights]}),c.by(xt.camera,Tt.camera)||kt.push({command:qo.setCamera,args:[Tt.camera]}),c.by(xt.iconsets,Tt.iconsets)||function(nr,cr,lr){let yr;for(yr in cr=cr||{},nr=nr||{})nr.hasOwnProperty(yr)&&(cr.hasOwnProperty(yr)||lr.push({command:qo.removeIconset,args:[yr]}));for(yr in cr){if(!cr.hasOwnProperty(yr))continue;const xr=cr[yr];nr.hasOwnProperty(yr)?c.by(nr[yr],xr)||(lr.push({command:qo.removeIconset,args:[yr]}),lr.push({command:qo.addIconset,args:[yr,xr]})):lr.push({command:qo.addIconset,args:[yr,xr]})}}(xt.iconsets,Tt.iconsets,kt),!c.by(xt["color-theme"],Tt["color-theme"]))return[{command:qo.setStyle,args:[Tt]}];const $t={},Xt=[];(function(nr,cr,lr,yr){let xr;for(xr in cr=cr||{},nr=nr||{})nr.hasOwnProperty(xr)&&(cr.hasOwnProperty(xr)||Cx(xr,lr,yr));for(xr in cr){if(!cr.hasOwnProperty(xr))continue;const Ar=cr[xr];nr.hasOwnProperty(xr)?c.by(nr[xr],Ar)||(nr[xr].type==="geojson"&&Ar.type==="geojson"&&Tm(nr,cr,xr)?lr.push({command:qo.setGeoJSONSourceData,args:[xr,Ar.data]}):Sm(xr,cr,lr,yr)):z0(xr,cr,lr)}})(xt.sources,Tt.sources,Xt,$t);const rr=[];xt.layers&&xt.layers.forEach(nr=>{nr.source&&$t[nr.source]?kt.push({command:qo.removeLayer,args:[nr.id]}):rr.push(nr)});let tr=xt.terrain;tr&&$t[tr.source]&&(kt.push({command:qo.setTerrain,args:[void 0]}),tr=void 0),kt=kt.concat(Xt),c.by(tr,Tt.terrain)||kt.push({command:qo.setTerrain,args:[Tt.terrain]}),function(nr,cr,lr){cr=cr||[];const yr=(nr=nr||[]).map(Rm),xr=cr.map(Rm),Ar=nr.reduce(Im,{}),Dr=cr.reduce(Im,{}),Tr=yr.slice(),Wr=Object.create(null);let zr,$r,Or,Br,Xr,an,sn;for(zr=0,$r=0;zr<yr.length;zr++)Or=yr[zr],Dr.hasOwnProperty(Or)?$r++:(lr.push({command:qo.removeLayer,args:[Or]}),Tr.splice(Tr.indexOf(Or,$r),1));for(zr=0,$r=0;zr<xr.length;zr++)Or=xr[xr.length-1-zr],Tr[Tr.length-1-zr]!==Or&&(Ar.hasOwnProperty(Or)?(lr.push({command:qo.removeLayer,args:[Or]}),Tr.splice(Tr.lastIndexOf(Or,Tr.length-$r),1)):$r++,an=Tr[Tr.length-zr],lr.push({command:qo.addLayer,args:[Dr[Or],an]}),Tr.splice(Tr.length-zr,0,Or),Wr[Or]=!0);for(zr=0;zr<xr.length;zr++)if(Or=xr[zr],Br=Ar[Or],Xr=Dr[Or],!Wr[Or]&&!c.by(Br,Xr))if(c.by(Br.source,Xr.source)&&c.by(Br["source-layer"],Xr["source-layer"])&&c.by(Br.type,Xr.type)){for(sn in sp(Br.layout,Xr.layout,lr,Or,null,qo.setLayoutProperty),sp(Br.paint,Xr.paint,lr,Or,null,qo.setPaintProperty),c.by(Br.slot,Xr.slot)||lr.push({command:qo.setSlot,args:[Or,Xr.slot]}),c.by(Br.filter,Xr.filter)||lr.push({command:qo.setFilter,args:[Or,Xr.filter]}),c.by(Br.minzoom,Xr.minzoom)&&c.by(Br.maxzoom,Xr.maxzoom)||lr.push({command:qo.setLayerZoomRange,args:[Or,Xr.minzoom,Xr.maxzoom]}),Br)Br.hasOwnProperty(sn)&&sn!=="layout"&&sn!=="paint"&&sn!=="filter"&&sn!=="metadata"&&sn!=="minzoom"&&sn!=="maxzoom"&&sn!=="slot"&&(sn.indexOf("paint.")===0?sp(Br[sn],Xr[sn],lr,Or,sn.slice(6),qo.setPaintProperty):c.by(Br[sn],Xr[sn])||lr.push({command:qo.setLayerProperty,args:[Or,sn,Xr[sn]]}));for(sn in Xr)Xr.hasOwnProperty(sn)&&!Br.hasOwnProperty(sn)&&sn!=="layout"&&sn!=="paint"&&sn!=="filter"&&sn!=="metadata"&&sn!=="minzoom"&&sn!=="maxzoom"&&sn!=="slot"&&(sn.indexOf("paint.")===0?sp(Br[sn],Xr[sn],lr,Or,sn.slice(6),qo.setPaintProperty):c.by(Br[sn],Xr[sn])||lr.push({command:qo.setLayerProperty,args:[Or,sn,Xr[sn]]}))}else lr.push({command:qo.removeLayer,args:[Or]}),an=Tr[Tr.lastIndexOf(Or)+1],lr.push({command:qo.addLayer,args:[Xr,an]})}(rr,Tt.layers,kt)}catch($t){console.warn("Unable to compute style diff:",$t),kt=[{command:qo.setStyle,args:[Tt]}]}return kt}(this.serialize(),d).filter(xt=>!(xt.command in mp));if(ot.length===0)return!1;const ut=ot.filter(xt=>!(xt.command in Ou));if(ut.length>0)throw new Error(`Unimplemented: ${ut.map(xt=>xt.command).join(", ")}.`);const mt=[];return ot.forEach(xt=>{mt.push(this[xt.command](...xt.args))}),_e&&Promise.all(mt).then(_e).catch(_e),this.stylesheet=d,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(d){if(d.size===0)return this;for(const[_e,ot]of d.entries()){if(this.getImage(_e))return this.fire(new c.y(new Error(`An image with the name "${_e.name}" already exists.`)));this.imageManager.addImage(_e,this.scope,ot),this._changes.updateImage(_e,this.scope)}return this._updateWorkerImages(),this.fire(new c.z("data",{dataType:"style"})),this}addImage(d,_e){return this.getImage(d)?this.fire(new c.y(new Error(`An image with the name "${d.name}" already exists.`))):(this.imageManager.addImage(d,this.scope,_e),this._changes.updateImage(d,this.scope),this._updateWorkerImages(),this.fire(new c.z("data",{dataType:"style"})),this)}updateImage(d,_e,ot=!1){this.imageManager.updateImage(d,this.scope,_e),ot&&(this._changes.updateImage(d,this.scope),this._updateWorkerImages(),this.fire(new c.z("data",{dataType:"style"})))}getImage(d){return this.imageManager.getImage(d,this.scope)}removeImage(d){return this.getImage(d)?(this.imageManager.removeImage(d,this.scope),this._changes.updateImage(d,this.scope),this._updateWorkerImages(),this.fire(new c.z("data",{dataType:"style"})),this):this.fire(new c.y(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}getActualScope(){return this._importedAsBasemap?"basemap":this.scope}addModelURLs(d){return this.modelManager.addModelURLs(d,this.getActualScope()),this._updateWorkerModels(),this.fire(new c.z("data",{dataType:"style"})),this}addModel(d,_e,ot={}){return this._checkLoaded(),this._validate(pr,`models.${d}`,_e,null,ot)||(this.modelManager.addModel(d,_e,this.getActualScope()),this.fire(new c.z("data",{dataType:"style"}))),this}hasModel(d){return this.modelManager.hasModel(d,this.getActualScope())}removeModel(d){return this.hasModel(d)?(this.modelManager.removeModel(d,this.getActualScope(),!1,!0),this.fire(new c.z("data",{dataType:"style"})),this):this.fire(new c.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.getActualScope())}addSource(d,_e,ot={}){if(this._checkLoaded(),this.getOwnSource(d)!==void 0)throw new Error(`There is already a source with ID "${d}".`);if(!_e.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(_e).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(_e.type)>=0&&this._validate(Ku,`sources.${d}`,_e,null,ot))return;this.map&&this.map._collectResourceTiming&&(_e.collectResourceTiming=!0);const ut=uo(d,_e,this.dispatcher,this);ut.scope=this.scope,ut.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(ut.id),source:ut.serialize(),sourceId:ut.id}));const mt=xt=>{const Tt=(xt?"symbol:":"other:")+ut.id,kt=c.B(Tt,this.scope),$t=this._sourceCaches[Tt]=new Du(kt,ut,xt);(xt?this._symbolSourceCaches:this._otherSourceCaches)[ut.id]=$t,$t.onAdd(this.map)};mt(!1),_e.type!=="vector"&&_e.type!=="geojson"||mt(!0),ut.onAdd&&ut.onAdd(this.map),ot.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(d){this._checkLoaded();const _e=this.getOwnSource(d);if(!_e)throw new Error("There is no source with this ID");for(const ut in this._layers)if(this._layers[ut].source===d)return this.fire(new c.y(new Error(`Source "${d}" cannot be removed while layer "${ut}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===d)return this.fire(new c.y(new Error(`Source "${d}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const ut=Object.entries(this.stylesheet.iconsets).find(([mt,xt])=>xt.type==="source"&&xt.source===d);if(ut)return this.fire(new c.y(new Error(`Source "${d}" cannot be removed while iconset "${ut[0]}" is using it.`)))}const ot=this.getOwnSourceCaches(d);for(const ut of ot){const mt=c.dq(ut.id);delete this._sourceCaches[mt],this._changes.discardSourceCacheUpdate(ut.id),ut.fire(new c.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:ut.getSource().id})),ut.setEventedParent(null),ut.clearTiles()}return delete this._otherSourceCaches[d],delete this._symbolSourceCaches[d],this.mergeSources(),_e.setEventedParent(null),_e.onRemove&&_e.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(d,_e){this._checkLoaded(),this.getOwnSource(d).setData(_e),this._changes.setDirty()}getOwnSource(d){const _e=this.getOwnSourceCache(d);return _e&&_e.getSource()}getOwnSources(){const d=[];for(const _e in this._otherSourceCaches){const ot=this.getOwnSourceCache(_e);ot&&d.push(ot.getSource())}return d}areTilesLoaded(){const d=this._mergedSourceCaches;for(const _e in d){const ot=d[_e]._tiles;for(const ut in ot){const mt=ot[ut];if(mt.state!=="loaded"&&mt.state!=="errored")return!1}}return!0}setLights(d){if(this._checkLoaded(),!d)return delete this.ambientLight,void delete this.directionalLight;const _e=this._getTransitionParameters();for(const mt of d){if(this._validate(Vu,"lights",mt))return;switch(mt.type){case"ambient":if(this.ambientLight){const xt=this.ambientLight;xt.set(mt),xt.updateTransitions(_e)}else this.ambientLight=new na(mt,Yo||(Yo=new c.a9({color:new c.aa(c.a6.properties_light_ambient.color),"color-use-theme":new c.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new c.aa(c.a6.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const xt=this.directionalLight;xt.set(mt),xt.updateTransitions(_e)}else this.directionalLight=new na(mt,Lo||(Lo=new c.a9({direction:new c.ap(c.a6.properties_light_directional.direction),color:new c.aa(c.a6.properties_light_directional.color),"color-use-theme":new c.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new c.aa(c.a6.properties_light_directional.intensity),"cast-shadows":new c.aa(c.a6.properties_light_directional["cast-shadows"]),"shadow-quality":new c.aa(c.a6.properties_light_directional["shadow-quality"]),"shadow-intensity":new c.aa(c.a6.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const ot=Object.assign(_e,{worldview:this.map.getWorldview()}),ut=new c.ac(this.z||0,ot);this.ambientLight&&this.ambientLight.recalculate(ut),this.directionalLight&&this.directionalLight.recalculate(ut),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const d=this.directionalLight,_e=this.ambientLight;if(!d||!_e)return;const ot=tr=>.2126*(tr[0]<=.03928?tr[0]/12.92:Math.pow((tr[0]+.055)/1.055,2.4))+.7152*(tr[1]<=.03928?tr[1]/12.92:Math.pow((tr[1]+.055)/1.055,2.4))+.0722*(tr[2]<=.03928?tr[2]/12.92:Math.pow((tr[2]+.055)/1.055,2.4)),ut=d.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),mt=d.properties.get("intensity"),xt=d.properties.get("direction"),Tt=1-c.d4(xt.x,xt.y,xt.z)[2]/90,kt=ot(ut)*mt*Tt,$t=_e.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),Xt=_e.properties.get("intensity"),rr=ot($t)*Xt;return Number(((kt+rr)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const d=[];return this.directionalLight&&d.push(this.directionalLight.get()),this.ambientLight&&d.push(this.ambientLight.get()),d}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(d){if(d==null||d===""&&this.isRootStyle())return this;if(c.dr(d)){const _e=c.ds(d),ot=this.fragments.find(({id:mt})=>mt===_e);if(!ot)return;const ut=c.dq(d);return ot.style.getFragmentStyle(ut)}{const _e=this.fragments.find(({id:ot})=>ot===d);return _e?_e.style:void 0}}setFeaturesetSelectors(d){if(!d)return;const _e={},ot=(ut,mt="")=>`${ut}::${mt}`;this._featuresetSelectors={};for(const ut in d){const mt=this._featuresetSelectors[ut]=[];for(const xt of d[ut].selectors){if(xt.featureNamespace){const kt=this.getOwnLayer(xt.layer);if(!kt){c.w(`Layer is undefined for selector: ${xt.layer}`);continue}const $t=ot(kt.source,kt.sourceLayer);if($t in _e&&_e[$t]!==xt.featureNamespace){c.w(`"featureNamespace ${xt.featureNamespace} of featureset ${ut}'s selector is not associated to the same source, skip this selector`);continue}_e[$t]=xt.featureNamespace}let Tt;if(xt.properties)for(const kt in xt.properties){const $t=c.U(xt.properties[kt]);$t.result==="success"&&(Tt=Tt||{},Tt[kt]=$t.value)}mt.push({layerId:xt.layer,namespace:xt.featureNamespace,properties:Tt,uniqueFeatureID:xt._uniqueFeatureID})}}}getFeaturesetDescriptors(d){const _e=this.getFragmentStyle(d);if(!_e||!_e.stylesheet.featuresets)return[];const ot=[];for(const ut in _e.stylesheet.featuresets)ot.push({featuresetId:ut,importId:_e.scope?_e.scope:void 0});return ot}getFeaturesetLayers(d,_e){const ot=this.getFragmentStyle(_e),ut=ot.stylesheet.featuresets;if(!ut||!ut[d])return this.fire(new c.y(new Error(`The featureset '${d}' does not exist in the map's style and cannot be queried.`))),[];const mt=[];for(const xt of ut[d].selectors){const Tt=ot.getOwnLayer(xt.layer);Tt&&mt.push(Tt)}return mt}getConfigProperty(d,_e){const ot=this.getFragmentStyle(d);if(!ot)return null;const ut=c.B(_e,ot.scope),mt=ot.options.get(ut),xt=mt?mt.value||mt.default:null;return xt?xt.serialize():null}isIndoorEnabled(){return Object.keys(this._mergedIndoor).length>0}getIndoorSourceLayers(d,_e){const ot=c.B(d,_e);return this._mergedIndoor[ot]}setIndoorData(d,_e){this.map.indoor.setIndoorData(_e)}updateIndoorDependentLayers(){this._updateLayers(this._indoorDependentLayers),this.map._styleDirty=!0,this.map.triggerRepaint()}setConfigProperty(d,_e,ot){const ut=this.getFragmentStyle(d);if(!ut)return;const mt=ut.stylesheet.schema;if(!mt||!mt[_e])return;const xt=c.U(ot);if(xt.result!=="success")return void ap(this,xt.value);const Tt=xt.value.expression,kt=c.B(_e,ut.scope),$t=ut.options.get(kt);if(!$t)return;let Xt;const{minValue:rr,maxValue:tr,stepValue:nr,type:cr,values:lr}=mt[_e],yr=c.U(mt[_e].default);yr.result==="success"&&(Xt=yr.value.expression),Xt?(this.options.set(kt,Object.assign({},$t,{value:Tt,default:Xt,minValue:rr,maxValue:tr,stepValue:nr,type:cr,values:lr})),this.updateConfigDependencies(_e)):this.fire(new c.y(new Error(`No schema defined for the config option "${_e}" in the "${d}" fragment.`)))}getConfig(d){const _e=this.getFragmentStyle(d);if(!_e)return null;const ot=_e.stylesheet.schema;if(!ot)return null;const ut={};for(const mt in ot){const xt=c.B(mt,_e.scope),Tt=_e.options.get(xt),kt=Tt?Tt.value||Tt.default:null;ut[mt]=kt?kt.serialize():null}return ut}setConfig(d,_e){const ot=this.getFragmentStyle(d);ot&&(ot.updateConfig(_e,ot.stylesheet.schema),this.updateConfigDependencies())}getSchema(d){const _e=this.getFragmentStyle(d);return _e?_e.stylesheet.schema:null}setSchema(d,_e){const ot=this.getFragmentStyle(d);ot&&(ot.stylesheet.schema=_e,ot.updateConfig(ot._config,_e),this.updateConfigDependencies())}updateConfig(d,_e){if(this._config=d,d||_e)if(_e)for(const ot in _e){let ut,mt;const xt=c.U(_e[ot].default);if(xt.result==="success"&&(ut=xt.value.expression),d&&d[ot]!==void 0){const tr=c.U(d[ot]);tr.result==="success"&&(mt=tr.value.expression)}const{minValue:Tt,maxValue:kt,stepValue:$t,type:Xt,values:rr}=_e[ot];if(ut){const tr=c.B(ot,this.scope);this.options.set(tr,{default:ut,value:mt,minValue:Tt,maxValue:kt,stepValue:$t,type:Xt,values:rr})}else this.fire(new c.y(new Error(`No schema defined for config option "${ot}".`)))}else this.fire(new c.y(new Error("Attempting to set config for a style without schema.")))}_updateLayers(d,_e=()=>!0){for(const ot of d){const ut=this.getLayer(ot);ut&&_e(ut)&&(ut.possiblyEvaluateVisibility(),this._updateLayer(ut),this._changes.setDirty())}}updateConfigDependencies(d){this._updateLayers(this._configDependentLayers,_e=>!d||_e.expressionDependencies.configDependencies.has(d)),this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(_e=>{const ot=_e._styleColorTheme.colorThemeOverride?_e._styleColorTheme.colorThemeOverride:_e._styleColorTheme.colorTheme;if(ot){const ut=_e._evaluateColorThemeData(ot);(!_e._styleColorTheme.lut&&ut!==""||_e._styleColorTheme.lut&&ut!==_e._styleColorTheme.lut.data)&&_e.setColorTheme(ot)}}),this._changes.setDirty()}addLayer(d,_e,ot={}){this._checkLoaded();const ut=d.id;if(this._layers[ut])return void this.fire(new c.y(new Error(`Layer with id "${ut}" already exists on this map`)));let mt;if(d.type==="custom"){if(ap(this,c.dt(d)))return;mt=c.du(d,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof d.source=="object"&&(this.addSource(ut,d.source),d=c.dp(d),d=Object.assign(d,{source:ut})),this._validate(T0,`layers.${ut}`,d,{arrayIndex:-1},ot))return;mt=c.du(d,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(mt),mt.setEventedParent(this,{layer:{id:ut}})}const xt=c.B(mt.source,mt.scope);mt.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(xt),mt.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(xt);let Tt=this._order.length;if(_e){const rr=this._order.indexOf(_e);if(rr===-1)return void this.fire(new c.y(new Error(`Layer with id "${_e}" does not exist on this map.`)));mt.slot===this._layers[_e].slot?Tt=rr:c.w(`Layer with id "${_e}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(Tt,0,ut),this._layerOrderChanged=!0,this._layers[ut]=mt;const kt=this.getOwnLayerSourceCache(mt),$t=!!this.directionalLight&&this.directionalLight.shadowsEnabled();kt&&mt.canCastShadows()&&$t&&(kt.castsShadows=!0);const Xt=this._changes.getRemovedLayer(mt);if(Xt&&mt.source&&kt&&mt.type!=="custom"){this._changes.discardLayerRemoval(mt);const rr=c.B(mt.source,mt.scope);Xt.type!==mt.type?this._changes.updateSourceCache(rr,"clear"):(this._changes.updateSourceCache(rr,"reload"),kt.pause())}this._updateLayer(mt),mt.onAdd&&mt.onAdd(this.map),mt.scope=this.scope,this.mergeLayers()}moveLayer(d,_e){this._checkLoaded();const ot=this._checkLayer(d);if(!ot||d===_e)return;const ut=this._order.indexOf(d);this._order.splice(ut,1);let mt=this._order.length;if(_e){const xt=this._order.indexOf(_e);if(xt===-1)return void this.fire(new c.y(new Error(`Layer with id "${_e}" does not exist on this map.`)));ot.slot===this._layers[_e].slot?mt=xt:c.w(`Layer with id "${_e}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(mt,0,d),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(d){this._checkLoaded();const _e=this._checkLayer(d);if(!_e)return;_e.setEventedParent(null);const ot=this._order.indexOf(d);this._order.splice(ot,1),delete this._layers[d],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(_e.fqid),this._indoorDependentLayers.delete(_e.fqid),this._changes.removeLayer(_e);const ut=this.getOwnLayerSourceCache(_e);if(ut&&ut.castsShadows){let mt=!1;for(const xt in this._layers)if(this._layers[xt].source===_e.source&&this._layers[xt].canCastShadows()){mt=!0;break}ut.castsShadows=mt}_e.onRemove&&_e.onRemove(this.map),this.mergeLayers()}getOwnLayer(d){return this._layers[d]}hasLayer(d){return d in this._mergedLayers}hasLayerType(d){for(const _e in this._layers)if(this._layers[_e].type===d)return!0;return!1}setLayerZoomRange(d,_e,ot){this._checkLoaded();const ut=this._checkLayer(d);ut&&(ut.minzoom===_e&&ut.maxzoom===ot||(_e!=null&&(ut.minzoom=_e),ot!=null&&(ut.maxzoom=ot),this._updateLayer(ut)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(d,_e){this._checkLoaded();const ot=this._checkLayer(d);ot&&ot.slot!==_e&&(ot.slot=_e,this._updateLayer(ot))}setFilter(d,_e,ot={}){this._checkLoaded();const ut=this._checkLayer(d);if(ut&&!c.by(ut.filter,_e))return _e==null?(ut.filter=void 0,void this._updateLayer(ut)):void(this._validate(fp,`layers.${ut.id}.filter`,_e,{layerType:ut.type},ot)||(ut.filter=c.dp(_e),this._updateLayer(ut)))}getFilter(d){const _e=this._checkLayer(d);if(_e)return c.dp(_e.filter)}setLayoutProperty(d,_e,ot,ut={}){this._checkLoaded();const mt=this._checkLayer(d);if(mt&&!c.by(mt.getLayoutProperty(_e),ot)){if(ot!=null&&(!ut||ut.validate!==!1)&&ap(mt,xn.call(Jo,{key:`layers.${d}.layout.${_e}`,layerType:mt.type,objectKey:_e,value:ot,styleSpec:c.a6,style:{glyphs:!0,sprite:!0}})))return;mt.setLayoutProperty(_e,ot),mt.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(mt.fqid),mt.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(mt.fqid),this._updateLayer(mt)}}setLayerProperty(d,_e,ot,ut={}){this._checkLoaded();const mt=this._checkLayer(d);mt&&(_e==="appearances"?(mt.setAppearances(ot),this._changes.setDirty()):mt.isPaintProperty(_e)?this.setPaintProperty(d,_e,ot,ut):this.setLayoutProperty(d,_e,ot,ut))}getLayoutProperty(d,_e){const ot=this._checkLayer(d);if(ot)return ot.getLayoutProperty(_e)}setPaintProperty(d,_e,ot,ut={}){this._checkLoaded();const mt=this._checkLayer(d);if(!mt||c.by(mt.getPaintProperty(_e),ot)||ot!=null&&(!ut||ut.validate!==!1)&&ap(mt,xo.call(Jo,{key:`layers.${d}.paint.${_e}`,layerType:mt.type,objectKey:_e,value:ot,styleSpec:c.a6})))return;const xt=mt.setPaintProperty(_e,ot);mt.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(mt.fqid),mt.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(mt.fqid),xt&&this._updateLayer(mt),this._changes.updatePaintProperties(mt)}getPaintProperty(d,_e){const ot=this._checkLayer(d);if(ot)return ot.getPaintProperty(_e)}setFeatureState(d,_e){if(this._checkLoaded(),"target"in d){if("featuresetId"in d.target){const{featuresetId:kt,importId:$t}=d.target,Xt=this.getFragmentStyle($t),rr=Xt.getFeaturesetLayers(kt);for(const{source:tr,sourceLayer:nr}of rr)Xt.setFeatureState({id:d.id,source:tr,sourceLayer:nr},_e)}else if("layerId"in d.target){const{layerId:kt}=d.target,$t=this.getLayer(kt);this.setFeatureState({id:d.id,source:$t.source,sourceLayer:$t.sourceLayer},_e)}return}const ot=d.source,ut=d.sourceLayer,mt=this._checkSource(ot);if(!mt)return;const xt=mt.type;if(xt==="geojson"&&ut)return void this.fire(new c.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(xt==="vector"&&!ut)return void this.fire(new c.y(new Error("The sourceLayer parameter must be provided for vector source types.")));d.id===void 0&&this.fire(new c.y(new Error("The feature id parameter must be provided.")));const Tt=this.getOwnSourceCaches(ot);for(const kt of Tt)kt.setFeatureState(ut,d.id,_e)}removeFeatureState(d,_e){if(this._checkLoaded(),"target"in d){if("featuresetId"in d.target){const{featuresetId:kt,importId:$t}=d.target,Xt=this.getFragmentStyle($t),rr=Xt.getFeaturesetLayers(kt);for(const{source:tr,sourceLayer:nr}of rr)Xt.removeFeatureState({id:d.id,source:tr,sourceLayer:nr},_e)}else if("layerId"in d.target){const{layerId:kt}=d.target,$t=this.getLayer(kt);this.removeFeatureState({id:d.id,source:$t.source,sourceLayer:$t.sourceLayer},_e)}return}const ot=d.source,ut=this._checkSource(ot);if(!ut)return;const mt=ut.type,xt=mt==="vector"?d.sourceLayer:void 0;if(mt==="vector"&&!xt)return void this.fire(new c.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(_e&&typeof d.id!="string"&&typeof d.id!="number")return void this.fire(new c.y(new Error("A feature id is required to remove its specific state property.")));const Tt=this.getOwnSourceCaches(ot);for(const kt of Tt)kt.removeFeatureState(xt,d.id,_e)}getFeatureState(d){if(this._checkLoaded(),"target"in d){let mt;if("featuresetId"in d.target){const{featuresetId:xt,importId:Tt}=d.target,kt=this.getFragmentStyle(Tt),$t=kt.getFeaturesetLayers(xt);for(const{source:Xt,sourceLayer:rr}of $t){const tr=kt.getFeatureState({id:d.id,source:Xt,sourceLayer:rr});if(tr&&!mt)mt=tr;else if(!c.by(mt,tr))return void this.fire(new c.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in d.target){const{layerId:xt}=d.target,Tt=this.getLayer(xt);mt=this.getFeatureState({id:d.id,source:Tt.source,sourceLayer:Tt.sourceLayer})}return mt}const _e=d.source,ot=d.sourceLayer,ut=this._checkSource(_e);if(ut){if(ut.type!=="vector"||ot)return d.id===void 0&&this.fire(new c.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(_e)[0].getFeatureState(ot,d.id);this.fire(new c.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(d){return this.stylesheet.transition=Object.assign({},this.stylesheet.transition,d),this.transition=this.stylesheet.transition,this}getTransition(){return Object.assign({},this.stylesheet.transition)}serialize(){this._checkLoaded();const d=this.getTerrain(),_e=d&&this.terrain&&this.terrain.scope===this.scope?d:this.stylesheet.terrain;return c.dv({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:_e,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},ot=>ot!==void 0)}_updateFilteredLayers(d){for(const _e of Object.values(this._mergedLayers))d(_e)&&this._updateLayer(_e)}_updateLayer(d){this._changes.updateLayer(d);const _e=this.getLayerSourceCache(d),ot=c.B(d.source,d.scope),ut=this._changes.getUpdatedSourceCaches();d.source&&!ut[ot]&&_e&&_e.getSource().type!=="raster"&&(this._changes.updateSourceCache(ot,"reload"),_e.pause()),d.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(d){const _e=Tt=>this._mergedLayers[Tt].is3D(!!this.terrain),ot=this.order,ut={},mt=[];for(let Tt=ot.length-1;Tt>=0;Tt--){const kt=ot[Tt];if(_e(kt)){ut[kt]=Tt;for(const $t of d){const Xt=$t[kt];if(Xt)for(const rr of Xt)mt.push(rr)}}}mt.sort((Tt,kt)=>kt.intersectionZ-Tt.intersectionZ);const xt=[];for(let Tt=ot.length-1;Tt>=0;Tt--){const kt=ot[Tt];if(_e(kt))for(let $t=mt.length-1;$t>=0;$t--){const Xt=mt[$t].feature;if(Xt.layer&&ut[Xt.layer.id]<Tt)break;xt.push(Xt),mt.pop()}else for(const $t of d){const Xt=$t[kt];if(Xt)for(const rr of Xt)xt.push(rr.feature)}}return xt}queryRasterValue(d,_e,ot){const ut=this.getOwnSource(d);return ut?ut.type!=="raster-array"?(this.fire(new c.y(new Error('queryRasterValue support only "raster-array" sources.'))),Promise.resolve(null)):ut.queryRasterArrayValue(_e,ot):(this.fire(new c.y(new Error(`Source with id "${d}" does not exist in the style.`))),Promise.resolve(null))}queryRenderedFeatures(d,_e,ot){let ut;_e&&!Array.isArray(_e)&&_e.filter&&(this._validate(fp,"queryRenderedFeatures.filter",_e.filter,null,_e),ut=c.b6(_e.filter));const mt={},xt=Xt=>{if(Cp.has(Xt.type))return;const rr=this.getOwnLayerSourceCache(Xt),tr=mt[rr.id]=mt[rr.id]||{sourceCache:rr,layers:{},has3DLayers:!1};Xt.is3D(!!this.terrain)&&(tr.has3DLayers=!0),tr.layers[Xt.fqid]=tr.layers[Xt.fqid]||{styleLayer:Xt,targets:[]},tr.layers[Xt.fqid].targets.push({filter:ut})};if(_e&&_e.layers){if(!Array.isArray(_e.layers))return this.fire(new c.y(new Error("parameters.layers must be an Array."))),[];for(const Xt of _e.layers){const rr=this._layers[Xt];if(!rr)return this.fire(new c.y(new Error(`The layer '${Xt}' does not exist in the map's style and cannot be queried for features.`))),[];xt(rr)}}else for(const Xt in this._layers)xt(this._layers[Xt]);const Tt=this._queryRenderedFeatures(d,mt,ot),kt=this._flattenAndSortRenderedFeatures(Tt),$t=[];for(const Xt of kt)c.dw(Xt.layer.id)===this.scope&&$t.push(Xt);return $t}queryRenderedFeatureset(d,_e,ot){let ut;_e&&!Array.isArray(_e)&&_e.filter&&(this._validate(fp,"queryRenderedFeatures.filter",_e.filter,null,_e),ut=c.b6(_e.filter));const mt="mock",xt=[];if(_e&&_e.target)xt.push(Object.assign({},_e,{targetId:mt,filter:ut}));else{const Xt=this.getFeaturesetDescriptors();for(const rr of Xt)xt.push({targetId:mt,filter:ut,target:rr});for(const{style:rr}of this.fragments){const tr=rr.getFeaturesetDescriptors();for(const nr of tr)xt.push({targetId:mt,filter:ut,target:nr})}}const Tt=this.queryRenderedTargets(d,xt,ot),kt=[],$t=new Set;for(const Xt of Tt)for(const rr of Xt.variants[mt])yp(rr,Xt,$t)||kt.push(new c.dx(Xt,rr));return kt}queryRenderedTargets(d,_e,ot){const ut={},mt=(Tt,kt,$t,Xt)=>{const rr=ut[kt.id]=ut[kt.id]||{sourceCache:kt,layers:{},has3DLayers:!1};if(rr.layers[Tt.fqid]=rr.layers[Tt.fqid]||{styleLayer:Tt,targets:[]},Tt.is3D(!!this.terrain)&&(rr.has3DLayers=!0),!Xt)return $t.uniqueFeatureID=!1,void rr.layers[Tt.fqid].targets.push($t);rr.layers[Tt.fqid].targets.push(Object.assign({},$t,{namespace:Xt.namespace,properties:Xt.properties,uniqueFeatureID:Xt.uniqueFeatureID}))};for(const Tt of _e)if("featuresetId"in Tt.target){const{featuresetId:kt,importId:$t}=Tt.target,Xt=this.getFragmentStyle($t);if(!Xt||!Xt._featuresetSelectors)continue;const rr=Xt._featuresetSelectors[kt];if(!rr){this.fire(new c.y(new Error(`The featureset '${kt}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const tr of rr){const nr=Xt.getOwnLayer(tr.layerId);nr&&!Cp.has(nr.type)&&mt(nr,Xt.getOwnLayerSourceCache(nr),Tt,tr)}}else if("layerId"in Tt.target){const{layerId:kt}=Tt.target,$t=this.getLayer(kt);if(!$t||Cp.has($t.type))continue;mt($t,this.getLayerSourceCache($t),Tt)}const xt=this._queryRenderedFeatures(d,ut,ot);return this._flattenAndSortRenderedFeatures(xt)}_queryRenderedFeatures(d,_e,ot){const ut=[],mt=!!this.map._showQueryGeometry,xt=du.createFromScreenPoints(d,ot);for(const Tt in _e){const kt=bx(xt,_e[Tt],this._availableImages,ot,mt);Object.keys(kt).length&&ut.push(kt)}if(this.placement)for(const Tt in _e){if(!_e[Tt].sourceCache._onlySymbols)continue;const kt=Am(xt.screenGeometry,_e[Tt],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(kt).length&&ut.push(kt)}return ut}querySourceFeatures(d,_e){const ot=_e&&_e.filter;ot&&this._validate(fp,"querySourceFeatures.filter",ot,null,_e);let ut=[];const mt=this.getOwnSourceCaches(d);for(const xt of mt)ut=ut.concat(Dp(xt,_e));return ut}addSourceType(d,_e,ot){return Zp.getSourceType(d)?ot(new Error(`A source type called "${d}" already exists.`)):(Zp.setSourceType(d,_e),_e.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:d,url:_e.workerSourceURL},ot):ot(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(d,_e,ot={}){this._checkLoaded();const ut=this.light.getLight();let mt=!1;for(const Tt in d)if(!c.by(d[Tt],ut[Tt])){mt=!0;break}if(!mt)return;const xt=this._getTransitionParameters();this.light.setLight(d,_e,ot),this.light.updateTransitions(xt)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=c.o.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&c.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(d,_e=1){if(this._checkLoaded(),!d)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),_e===0&&delete this.terrain,d===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let ot=d;const ut=!("source"in d)||d.source==null;if(_e===1){if(this.disableElevatedTerrain)return;if("source"in ot&&typeof ot.source=="object"){const Tt="terrain-dem-src";this.addSource(Tt,ot.source),ot=c.dp(ot),ot=Object.assign(ot,{source:Tt})}const mt=Object.assign({},ot),xt={};if(this.terrain&&ut){mt.source=this.terrain.get().source;const Tt=this.terrain?this.getFragmentStyle(this.terrain.scope):null;Tt&&(xt.style=Tt.serialize())}if(this._validate(t0,"terrain",mt,xt))return}if(!this.terrain||this.terrain.scope!==this.scope&&!ut||this.terrain&&_e!==this.terrain.drapeRenderMode){if(!ot)return;this._createTerrain(ot,_e),this.fire(new c.z("data",{dataType:"style"}))}else{const mt=this.terrain,xt=mt.get();for(const Tt of Object.keys(c.a6.terrain))!ot.hasOwnProperty(Tt)&&c.a6.terrain[Tt].default&&(ot[Tt]=c.a6.terrain[Tt].default);for(const Tt in d)if(!c.by(d[Tt],xt[Tt])){mt.set(d,this.options),this.stylesheet.terrain=d;const kt=this._getTransitionParameters({duration:0});mt.updateTransitions(kt),this.fire(new c.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(d){const _e=this.fog=new Ys(d,this.map.transform,this.scope,this.options);this.stylesheet.fog=_e.get();const ot=this._getTransitionParameters({duration:0});_e.updateTransitions(ot)}_createSnow(d){const _e=this.snow=new zo(d,this.map.transform,this.scope,this.options);this.stylesheet.snow=_e.get();const ot=this._getTransitionParameters({duration:0});_e.updateTransitions(ot)}_createRain(d){const _e=this.rain=new uu(d,this.map.transform,this.scope,this.options);this.stylesheet.rain=_e.get();const ot=this._getTransitionParameters({duration:0});_e.updateTransitions(ot)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const d of this.map._markers)d._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(d){if(this._checkLoaded(),!d)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const _e=this.fog;if(!c.by(_e.get(),d)){_e.set(d,this.options),this.stylesheet.fog=_e.get();const ot=this._getTransitionParameters({duration:0});_e.updateTransitions(ot)}}else this._createFog(d);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(d){if(this._checkLoaded(),!d)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const _e=this.snow;if(!c.by(_e.get(),d)){_e.set(d,this.options),this.stylesheet.snow=_e.get();const ot=this._getTransitionParameters({duration:0});_e.updateTransitions(ot)}}else this._createSnow(d);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(d){if(this._checkLoaded(),!d)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const _e=this.rain;if(!c.by(_e.get(),d)){_e.set(d,this.options),this.stylesheet.rain=_e.get();const ot=this._getTransitionParameters({duration:0});_e.updateTransitions(ot)}}else this._createRain(d);this._markersNeedUpdate=!0}_reloadColorTheme(){const d=()=>{for(const ut in this._layers)this._layers[ut].lut=this._styleColorTheme.lut;for(const ut in this._sourceCaches)this._sourceCaches[ut].clearTiles()},_e=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!_e)return this._styleColorTheme.lut=null,void d();const ot=this._evaluateColorThemeData(_e);this._loadColorTheme(ot).then(()=>{this.fire(new c.z("colorthemeset")),d()}).catch(ut=>{c.w(`Couldn't set color theme: ${ut}`)})}setColorTheme(d){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&c.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=d,this._reloadColorTheme()}setImportColorTheme(d,_e){const ot=this.getFragmentStyle(d);ot&&(ot._styleColorTheme.colorThemeOverride=_e,ot._reloadColorTheme())}_getTransitionParameters(d){return{now:c.o.now(),transition:Object.assign(this.transition,d)}}updateDrapeFirstLayers(){if(!this.terrain)return;const d=[],_e=[];for(const ot of this._mergedOrder)this.isLayerDraped(this._mergedLayers[ot])?d.push(ot):_e.push(ot);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...d),this._drapedFirstOrder.push(..._e)}_createTerrain(d,_e){const ot=this.terrain=new hn(d,_e,this.scope,this.options,this.map.getWorldview());_e===1&&(this.stylesheet.terrain=d),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const ut=this._getTransitionParameters({duration:0});ot.updateTransitions(ut)}_force3DLayerUpdate(){for(const d in this._layers){const _e=this._layers[d];_e.type==="fill-extrusion"&&this._updateLayer(_e)}}_forceSymbolLayerUpdate(){for(const d in this._layers){const _e=this._layers[d];_e.type==="symbol"&&this._updateLayer(_e)}}_validate(d,_e,ot,ut,mt={}){if(mt&&mt.validate===!1)return!1;const xt=Object.assign({},this.serialize());return ap(this,d.call(Jo,Object.assign({key:_e,style:xt,value:ot,styleSpec:c.a6},ut)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),c.dy.off("pluginStateChange",this._rtlTextPluginCallback);for(const d in this._mergedLayers)this._mergedLayers[d].setEventedParent(null);for(const d in this._mergedSourceCaches)this._mergedSourceCaches[d].clearTiles(),this._mergedSourceCaches[d].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(d){const _e=this.getSourceCaches(d);for(const ot of _e)ot.clearTiles()}clearSources(){for(const d in this._mergedSourceCaches)this._mergedSourceCaches[d].clearTiles()}clearLayers(){for(const d in this._mergedLayers){const _e=this._mergedLayers[d];_e._clear&&_e._clear()}}reloadSource(d){const _e=this.getSourceCaches(d);for(const ot of _e)ot.resume(),ot.reload()}reloadSources(){for(const d of this.getSources())d.reload&&d.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(d=>{d.modelManager.reloadModels(d.scope)})}updateSources(d){let _e;this.directionalLight&&(_e=Xn(this.directionalLight));const ot=new Set,ut=new Set;for(const mt in this._mergedLayers){const xt=this._mergedLayers[mt];xt.type==="building"&&ot.add(xt.source),xt.hasElevation()&&!ut.has(xt.source)&&ut.add(xt.source)}for(const mt in this._mergedSourceCaches){const xt=this._mergedSourceCaches[mt],Tt=ut.has(xt._source.id);ot.has(xt._source.id)&&(xt._source.reparseOverscaled=!1),xt.update(d,void 0,void 0,_e,Tt)}}_generateCollisionBoxes(){for(const d in this._sourceCaches){const _e=this._sourceCaches[d];_e.resume(),_e.reload()}}_updatePlacement(d,_e,ot,ut,mt,xt,Tt=!1){let kt=!1,$t=!1;const Xt={},rr={};for(const lr of this._mergedOrder){const yr=this._mergedLayers[lr];if(yr.type!=="symbol")continue;const xr=c.B(yr.source,yr.scope);let Ar=Xt[xr];if(!Ar){const Tr=this.getLayerSourceCache(yr);if(!Tr)continue;const Wr=Tr.getRenderableIds(!0).map(zr=>Tr.getTileByID(zr));rr[xr]=Wr.slice(),Ar=Xt[xr]=Wr.sort((zr,$r)=>$r.tileID.overscaledZ-zr.tileID.overscaledZ||(zr.tileID.isLessThan($r.tileID)?-1:1))}const Dr=this.crossTileSymbolIndex.addLayer(yr,Ar,_e.center.lng,_e.projection);kt=kt||Dr}this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),Tt=Tt||this._layerOrderChanged,this._layerOrderChanged&&this.fire(new c.z("neworder"));const tr=!!(this.placement&&!_e.equals(this.placement.transform)),nr=!!(this.placement&&(this.placement.lastReplacementSourceUpdateTime!==0&&!xt||this.placement.lastReplacementSourceUpdateTime!==xt.updateTime)),cr=(tr||nr||kt||this.placement&&this.placement.isStale())&&ut===0;if((Tt||!this.pauseablePlacement||cr||ut!==0&&this.pauseablePlacement.isDone()&&!this.placement.stillRecent(c.o.now(),_e.zoom))&&(this.pauseablePlacement=new mu(_e,this._mergedOrder,Tt||ut===0,ot,ut,mt,this.placement,this.fog&&_e.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,Xt,rr,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(c.o.now()),$t=!0),kt&&this.pauseablePlacement.placement.setStale()),$t||kt){this._buildingIndex.onNewFrame(_e.zoom);for(let lr=0;lr<this._mergedOrder.length;lr++){const yr=this._mergedLayers[this._mergedOrder[lr]];if(yr.type!=="symbol"||yr.visibility==="none")continue;const xr=this.isLayerClipped(yr);this.placement.updateLayerOpacities(yr,Xt[c.B(yr.source,yr.scope)],lr,xr?xt:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(c.o.now())}}_releaseSymbolFadeTiles(){for(const d in this._sourceCaches)this._sourceCaches[d].releaseSymbolFadeTiles()}addImport(d,_e){this._checkLoaded();const ot=this.stylesheet.imports=this.stylesheet.imports||[];if(ot.findIndex(({id:mt})=>mt===d.id)!==-1)return void this.fire(new c.y(new Error(`Import with id '${d.id}' already exists in the map's style.`)));if(!_e)return ot.push(d),this._loadImports([d],!0);const ut=ot.findIndex(({id:mt})=>mt===_e);return ut===-1&&this.fire(new c.y(new Error(`Import with id "${_e}" does not exist on this map.`))),this.stylesheet.imports=ot.slice(0,ut).concat(d).concat(ot.slice(ut)),this._loadImports([d],!0,_e)}updateImport(d,_e){this._checkLoaded();const ot=this.stylesheet.imports||[],ut=this.getImportIndex(d);return ut===-1?this:typeof _e=="string"?(this.setImportUrl(d,_e),this):(_e.url&&_e.url!==ot[ut].url&&this.setImportUrl(d,_e.url),c.by(_e.config,ot[ut].config)||this.setImportConfig(d,_e.config,_e.data.schema),c.by(_e.data,ot[ut].data)||this.setImportData(d,_e.data),this)}moveImport(d,_e){this._checkLoaded();let ot=this.stylesheet.imports||[];const ut=this.getImportIndex(d);if(ut===-1)return this;const mt=this.getImportIndex(_e);if(mt===-1)return this;const xt=ot[ut],Tt=this.fragments[ut];return ot=ot.filter(({id:kt})=>kt!==d),this.fragments=this.fragments.filter(({id:kt})=>kt!==d),this.stylesheet.imports=ot.slice(0,mt).concat(xt).concat(ot.slice(mt)),this.fragments=this.fragments.slice(0,mt).concat(Tt).concat(this.fragments.slice(mt)),this.mergeLayers(),this}setImportUrl(d,_e){this._checkLoaded();const ot=this.stylesheet.imports||[],ut=this.getImportIndex(d);if(ut===-1)return this;ot[ut].url=_e;const mt=this.fragments[ut];return mt.style=this._createFragmentStyle(ot[ut]),mt.style.on("style.import.load",()=>this.mergeAll()),mt.style.loadURL(_e),this}setImportData(d,_e){this._checkLoaded();const ot=this.getImportIndex(d),ut=this.stylesheet.imports||[];return ot===-1?this:_e?(this.fragments[ot].style.setState(_e),this._reloadImports(),this):(delete ut[ot].data,this.setImportUrl(d,ut[ot].url))}setImportConfig(d,_e,ot){this._checkLoaded();const ut=this.getImportIndex(d),mt=this.stylesheet.imports||[];if(ut===-1)return this;_e?mt[ut].config=_e:delete mt[ut].config;const xt=this.fragments[ut];ot&&xt.style.stylesheet&&(xt.style.stylesheet.schema=ot);const Tt=xt.style.stylesheet&&xt.style.stylesheet.schema;return xt.config=_e,xt.style.updateConfig(_e,Tt),this.updateConfigDependencies(),this}removeImport(d){this._checkLoaded();const _e=this.stylesheet.imports||[],ot=this.getImportIndex(d);ot!==-1&&(_e.splice(ot,1),this.fragments[ot].style._remove(),this.fragments.splice(ot,1),this._reloadImports())}getImportIndex(d){const _e=(this.stylesheet.imports||[]).findIndex(ot=>ot.id===d);return _e===-1&&this.fire(new c.y(new Error(`Import '${d}' does not exist in the map's style and cannot be updated.`))),_e}getLayer(d){return this._mergedLayers[d]}getSources(){const d=[];for(const _e in this._mergedOtherSourceCaches){const ot=this._mergedOtherSourceCaches[_e];ot&&d.push(ot.getSource())}return d}getSource(d,_e){const ot=this.getSourceCache(d,_e);return ot&&ot.getSource()}getLayerSource(d){const _e=this.getLayerSourceCache(d);return _e&&_e.getSource()}getSourceCache(d,_e){const ot=c.B(d,_e);return this._mergedOtherSourceCaches[ot]}getLayerSourceCache(d){const _e=c.B(d.source,d.scope);return d.type==="symbol"?this._mergedSymbolSourceCaches[_e]:this._mergedOtherSourceCaches[_e]}getSourceCaches(d){if(d==null)return Object.values(this._mergedSourceCaches);const _e=[];return this._mergedOtherSourceCaches[d]&&_e.push(this._mergedOtherSourceCaches[d]),this._mergedSymbolSourceCaches[d]&&_e.push(this._mergedSymbolSourceCaches[d]),_e}updateSourceCaches(){const d=this._changes.getUpdatedSourceCaches();for(const _e in d){const ot=d[_e];ot==="reload"?this.reloadSource(_e):ot==="clear"&&this.clearSource(_e)}}updateLayers(d){const _e=this._changes.getUpdatedPaintProperties();for(const ot of _e){const ut=this.getLayer(ot);ut&&ut.updateTransitions(d)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(d){this.stylesheet.glyphs=d,this.glyphManager.setURL(d)}getImages(d,_e,ot){this.imageManager.getImages(_e.images,_e.scope,ot),this._updateTilesForChangedImages();const ut=xt=>{if(xt){const Tt=_e.images.map(kt=>c.I.toString(kt));xt.setDependencies(_e.tileID.key,_e.type,Tt)}},mt=c.B(_e.source,_e.scope);ut(this._mergedOtherSourceCaches[mt]),ut(this._mergedSymbolSourceCaches[mt]),_e.images.some(xt=>xt.iconsetId)&&this.fire(new c.z("data",{dataType:"style"}))}rasterizeImages(d,_e,ot){this.imageManager.rasterizeImages(_e,ot)}getGlyphs(d,_e,ot){this.glyphManager.getGlyphs(_e.stacks,ot)}getResource(d,_e,ot){return c.dz(_e,ot)}getOwnSourceCache(d){return this._otherSourceCaches[d]}getOwnLayerSourceCache(d){return d.type==="symbol"?this._symbolSourceCaches[d.source]:this._otherSourceCaches[d.source]}getOwnSourceCaches(d){const _e=[];return this._otherSourceCaches[d]&&_e.push(this._otherSourceCaches[d]),this._symbolSourceCaches[d]&&_e.push(this._symbolSourceCaches[d]),_e}_isSourceCacheLoaded(d){const _e=this.getOwnSourceCaches(d);return _e.length===0?(this.fire(new c.y(new Error(`There is no source with ID '${d}'`))),!1):_e.every(ot=>ot.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(d,_e){if(!this._clipLayerPresent&&d.type!=="fill-extrusion"&&d.type!=="building")return!1;const ot=d.type==="fill-extrusion"&&(d.sourceLayer==="building"||d.sourceLayer==="procedural_buildings"),ut=d.type==="building";if(d.is3D(!!this.terrain)){if(ot||ut||_e&&_e.type==="batched-model"||d.type==="model")return!0}else if(d.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(d=>{d.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Zp.getSourceType=function(st){return nn[st]},Zp.setSourceType=function(st,d){nn[st]=d},Zp.registerForPluginStateChange=c.dA;class ty extends c.E{constructor(d){super(),this._style=d,this._buildings={},this._activeFloors=new Set,this._activeFloorsVisible=!0,this._indoorState={selectedFloorId:null,lastActiveFloors:null,activeFloorsVisible:!0},c.aY(["_updateUI"],this)}destroy(){this._buildings={},this._activeFloors=new Set,this._indoorState=null}selectFloor(d){d===this._selectedFloorId&&this._activeFloorsVisible||(this._selectedFloorId=d,this._activeFloorsVisible=!0,this._updateActiveFloors())}setActiveFloorsVisibility(d){this._activeFloorsVisible=d,this._updateActiveFloors(),this._updateIndoorSelector()}setIndoorData(d){for(const[_e,ot]of Object.entries(d.buildings))if(this._buildings[_e])for(const ut of ot.floorIds)this._buildings[_e].floors[ut]||(this._buildings[_e].floors[ut]=ot.floors[ut]);else this._buildings[_e]=ot;for(const _e of d.activeFloors)this._activeFloors.add(_e);this._updateIndoorSelector()}getIndoorTileOptions(d,_e){const ot=this._style.getIndoorSourceLayers(d,_e);return ot&&this._indoorState?{sourceLayers:ot,indoorState:this._indoorState}:null}_updateUI(d,_e,ot){const ut=function(mt,xt,Tt,kt){let $t=null,Xt=Number.MAX_SAFE_INTEGER;if(kt<16)return null;for(const[rr,tr]of Object.entries(mt)){const nr=tr.center;if(nr){const cr=xt.distanceTo(c.aT.convert(nr));cr<Xt&&Tt.contains(nr)&&(Xt=cr,$t=rr)}}return $t}(this._buildings,_e,ot,d);ut!==this._closestBuildingId&&(this._closestBuildingId=ut,this._updateIndoorSelector())}_updateIndoorSelector(){const d=this._buildings,_e=this._closestBuildingId,ot=_e&&d?d[_e]:void 0;if(!ot)return void this.fire(new c.z("selector-update",{selectedFloorId:null,activeFloorsVisible:this._activeFloorsVisible,floors:[]}));let ut=null;for(const xt of ot.floorIds)if(this._activeFloors&&this._activeFloors.has(xt)){ut=xt;break}const mt=Array.from(ot.floorIds).map(xt=>({id:xt,name:ot.floors[xt].name,zIndex:ot.floors[xt].zIndex})).sort((xt,Tt)=>Tt.zIndex-xt.zIndex);this.fire(new c.z("selector-update",{selectedFloorId:ut,activeFloorsVisible:this._activeFloorsVisible,floors:mt}))}_updateActiveFloors(){const d=this._activeFloors;this._activeFloors=new Set,this._indoorState={selectedFloorId:this._selectedFloorId,lastActiveFloors:d,activeFloorsVisible:this._activeFloorsVisible},this._style.updateIndoorDependentLayers()}}var Dx=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Px=`
#ifdef DUAL_SOURCE_BLENDING
layout(location=0,index=0) out vec4 glFragColor;layout(location=0,index=1) out vec4 glFragColorSrc1;
#else
layout(location=0) out vec4 glFragColor;
#endif
#ifdef USE_MRT1
layout(location=1) out vec4 out_Target1;
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb*col.a,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,P_=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifndef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_id) attrib
#define DECLARE_MATERIAL_TABLE_INFO
#endif`,ry="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",s0=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif`,ny=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,ss=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,k_=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,iy=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,sy=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif`,F_=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {
#ifdef CLIP_ZERO_TO_ONE
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);
#else
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);
#endif
return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const h1=/#include\s+"([^"]+)"/g,G0=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,B_=/\b[A-Za-z_][A-Za-z0-9_]*\b/g,ex=new Set(["ifdef","ifndef","elif","if","defined"]),tx=new Set;Bm(Dx,tx),Bm(P_,tx),Bm(Px,tx);const Fm={"_prelude_fog.vertex.glsl":ny,"_prelude_terrain.vertex.glsl":s0,"_prelude_shadow.vertex.glsl":sy,"_prelude_material_table.vertex.glsl":`#ifdef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define MATERIAL_TABLE_DEBUG 0
uniform int u_material_offset;uniform int u_vertex_offset;layout(std140,binding=0)readonly buffer material_buffer{uvec4 material_data[];};struct MaterialInfo{uint dataOffset;
#if MATERIAL_TABLE_DEBUG
vec4 colorDebug;
#endif
};uint read_buf_no_offset(uint iDword) {return material_data[iDword/4u][iDword % 4u];}uint read_buf(uint iDword) {iDword+=uint(u_material_offset/4);return read_buf_no_offset(iDword);}float read_buf_float(uint iDword){return uintBitsToFloat(read_buf(iDword));}uint read_buf_uint8(uint iDword,uint iUint8){uint dwordOffset=iDword+(iUint8/4u);uint byteOffset=iUint8 & 3u;uint bitOffset=8u*byteOffset;uint mask=0xffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint read_buf_uint16(uint iDword,uint iUint16){uint dwordOffset=iDword+(iUint16 >> 1u);uint bitOffset=(iUint16 & 1u)*16u;uint mask=0xffffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint nrDwordsForVertexIdEntries(uint nrMaterialLookupEntries) {return nrMaterialLookupEntries;}uint nrDwordsForMaterialIdEntries(uint nrMaterialLookupEntries) {return (nrMaterialLookupEntries*2u+3u)/4u;}uint findRangeBinarySearch(uint vertexId,uint numRanges,uint dwordOffset) {uint left=0u;uint right=numRanges-1u;for (uint i=0u; i < 16u; i++) { 
if (left > right) {break;}uint mid=(left+right)/2u;uint start=read_buf(dwordOffset+mid);uint nextStart=(mid+1u < numRanges) ? read_buf(dwordOffset+mid+1u) : 0xffffffffu;if (vertexId >=start && vertexId < nextStart) {return mid;} else if (vertexId < start) {if (mid==0u) {break;}right=mid-1u;} else {left=mid+1u;}}return 0u; 
}uint readVertexId(uint dwordOffset,uint iMaterialLookupEntry) {return read_buf(dwordOffset+iMaterialLookupEntry);}uint findRange(uint vertexId,uint numRanges,uint dwordOffset) {uint iRange;if(numRanges <=64u){uint vertexBegin;for(iRange=0u; iRange < numRanges;++iRange) {vertexBegin=readVertexId(dwordOffset,iRange);if(vertexBegin > vertexId) {break;}}iRange=iRange==0u? 0u : iRange-1u;} else { 
iRange=findRangeBinarySearch(vertexId,numRanges,dwordOffset);}return iRange;}MaterialInfo read_material_info(uint vertex_id) {MaterialInfo info;
#if MATERIAL_TABLE_DEBUG
const vec4 red=vec4(1.0,0.0,0.0,1.0);const vec4 orange=vec4(1.0,0.5,0.0,1.0);const vec4 yellow=vec4(1.0,1.0,0.0,1.0);const vec4 green=vec4(0.0,1.0,0.0,1.0);const vec4 indigo=vec4(0.294,0.0,0.510,1.0);const vec4 blue=vec4(0.0,0.0,1.0,1.0);const vec4 purple=vec4(0.5,0.0,0.5,1.0);const vec4 pink=vec4(1.0,0.0,1.0,1.0);info.colorDebug=green;
#endif
uint offset=0u;
#if MATERIAL_TABLE_DEBUG
bool keepFinding=true;uint magic=read_buf(offset);if(magic !=0xCAFEBABEu) {info.colorDebug=red;keepFinding=false;return info;}
#endif
offset++;
#if MATERIAL_TABLE_DEBUG
uint nrMaterials=read_buf(offset);uint nrVertices=read_buf(offset+1u);if(keepFinding && vertex_id >=nrVertices) {info.colorDebug=red;keepFinding=false;}
#endif
offset+=2u;uint nrMaterialLookupEntries=read_buf(offset++);uint perMaterialEntrySizeDwords=read_buf(offset++);
#if MATERIAL_TABLE_DEBUG
if(keepFinding && perMaterialEntrySizeDwords !=1u) {info.colorDebug=red;keepFinding=false;}
#endif
uint iMaterialLookup=findRange(vertex_id,nrMaterialLookupEntries,offset);
#if MATERIAL_TABLE_DEBUG
if(keepFinding)
{uint vertexBeginCheck=readVertexId(offset,iMaterialLookup);if(vertexBeginCheck > vertex_id) {info.colorDebug=red;keepFinding=false;}if(iMaterialLookup < nrMaterialLookupEntries-1u) {uint vertexEndCheck=readVertexId(offset,iMaterialLookup+1u);if(vertexEndCheck <=vertex_id) {info.colorDebug=red;keepFinding=false;}}}
#endif
offset+=nrDwordsForVertexIdEntries(nrMaterialLookupEntries);uint materialId=iMaterialLookup;
#if MATERIAL_TABLE_DEBUG
if(keepFinding) {if(materialId >=nrMaterialLookupEntries) {info.colorDebug=red;}}
#endif
info.dataOffset=offset+materialId*perMaterialEntrySizeDwords;return info;}uint get_data_location(const MaterialInfo matInfo,uint attribOffsetBytes)
{uint attribFieldOffsetDwords=attribOffsetBytes/4u;return matInfo.dataOffset+attribFieldOffsetDwords;}vec4 read_material_vec4(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec4(read_buf_float(loc),read_buf_float(loc+1u),read_buf_float(loc+2u),read_buf_float(loc+3u));}vec2 read_material_vec2(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec2(read_buf_float(loc),read_buf_float(loc+1u));}float read_material_float(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return read_buf_float(loc);}
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_offset) read_material_float(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_offset) read_material_vec4(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_offset) read_material_vec2(matInfo,attrib_offset)
#define DECLARE_MATERIAL_TABLE_INFO MaterialInfo materialInfo=read_material_info(uint(gl_VertexID));
#define DECLARE_MATERIAL_TABLE_INFO_DEBUG(dbgColor) MaterialInfo materialInfo=read_material_info(uint(gl_VertexID)); dbgColor=materialInfo.colorDebug;
#endif`,"_prelude_fog.fragment.glsl":ss,"_prelude_shadow.fragment.glsl":F_,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif`,"_prelude_raster_array.glsl":k_,"_prelude_raster_particle.glsl":iy},oy={};ba("",s0),ba(ss,ny),ba(F_,sy),ba(k_,""),ba(iy,"");const xE=ba(Px,P_),ay=Dx,r2=[`
#if defined(GL_EXT_blend_func_extended) && defined(DUAL_SOURCE_BLENDING)
#extension GL_EXT_blend_func_extended : require
#endif`,"precision mediump float;",ay,xE.fragmentSource].join(`
`),gE=["precision highp float;",ay,xE.vertexSource].join(`
`);var M_={background:ba(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;uniform mediump float u_emissive_strength;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform mediump float u_emissive_strength;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:ba(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:ba(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
const float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
in lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;
#endif
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
#ifdef FLOOD_LIGHT
in highp float v_flood_radius;in float v_has_flood_light;
#endif
uniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;uniform vec3 u_flood_light_color;uniform float u_flood_light_intensity;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}
#ifdef BUILDING_FAUX_FACADE
float hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;
#if 0
if (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;
#else
if (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;
#endif
return out_color;}
#endif
vec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;
#ifdef BUILDING_FAUX_FACADE
if (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}
#endif
vec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
#else
shadowed_lighting_factor=dot(xy_flipped_normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=linearTosRGB(color.rgb);
#ifdef FLOOD_LIGHT
float flood_radiance=(1.0-min(v_pos.z/v_flood_radius,1.0))*u_flood_light_intensity*v_has_flood_light;color.rgb=mix(color.rgb,u_flood_light_color,flood_radiance);
#endif
color.rgb=mix(color.rgb,linearTosRGB(base_color.rgb),emissive);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));
#endif
color*=u_opacity;
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_pos.z);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in float a_flood_light_wall_radius_1i16;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
out lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#ifdef FLOOD_LIGHT
out highp float v_flood_radius;out float v_has_flood_light;
#endif
const float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;const float FLOOD_LIGHT_MAX_RADIUS_METER=2048.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#ifdef BUILDING_FAUX_FACADE
mat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}
#endif
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive
#ifdef FLOOD_LIGHT
v_flood_radius=(a_flood_light_wall_radius_1i16/MAX_INT_16*FLOOD_LIGHT_MAX_RADIUS_METER);v_has_flood_light=step(0.0,v_flood_radius);
#endif
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;float depth_offset=0.0;
#ifdef BUILDING_FAUX_FACADE
v_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);float height=a_centroid_3.z;depth_offset=min(1000.0,height)*0.0000002;}
#endif
v_pos=a_pos_3f;
#ifdef RENDER_CUTOFF
vec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=v_pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);
#endif
#ifdef FOG
v_fog_pos=fog_position(v_pos);
#endif
gl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);gl_Position.z-=depth_offset*gl_Position.w;}`),buildingBloom:ba(`in vec4 v_color_emissive;
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
float saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;
#ifdef HAS_ATTRIBUTE_a_bloom_attenuation
float distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);
#endif
#ifdef RENDER_CUTOFF
opacity*=v_cutoff_opacity;
#endif
glFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}`,`in vec3 a_pos_3f;
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
out vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
#ifdef HAS_ATTRIBUTE_a_part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);
#else
v_color_emissive=vec4(1.0);
#endif
gl_Position=u_matrix*vec4(a_pos_3f,1.0);
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),buildingDepth:ba(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:ba(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:ba("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:ba(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:ba(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:ba("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;
#endif
out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);
#ifdef PROJECTION_GLOBE_VIEW
#ifndef PROJECTED_POS_ON_VIEWPORT
vec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);
#endif
#endif
vec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:ba("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:ba("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:ba(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:ba(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#else
#ifdef FEATURE_CUTOUT
apply_feature_cutout(vec4(0.0,0.0,0.0,1.0),gl_FragCoord);
#endif
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:ba(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:ba(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:ba(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FLIP_Y
v_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:ba(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FLIP_Y
v_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:ba(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:ba(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);
#ifdef CLIP_ZERO_TO_ONE
cutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);
#else
cutoff=cutoff_opacity(u_cutoff_params,ground.z);
#endif
if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:ba(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:ba(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:ba(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:ba(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
#ifdef USE_MRT1
out_Target1=vec4(1.0-texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size)).a,0.0,0.0,0.0);
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:ba(`precision highp float;uniform highp sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ba(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:ba(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float side_z_offset
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
#pragma mapbox: define lowp float emissive_strength
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float side_z_offset
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
#pragma mapbox: initialize lowp float emissive_strength
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);alpha=side_z_offset > 0.0 ? 1.0-alpha : alpha;
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#ifdef MULTIPLY_LINE_GRADIENT_COLOR
out_color*=color;
#endif
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef DUAL_SOURCE_BLENDING
glFragColorSrc1=vec4(vec3(0.0),emissive_strength);
#else
#ifdef USE_MRT1
out_Target1=vec4(emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float side_z_offset
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float side_z_offset
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
#pragma mapbox: initialize lowp float emissive_strength
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
bool left=normal.y==1.0;halfwidth=(u_width_scale*(left ? a_z_offset_width.y : a_z_offset_width.z))/2.0;a_z_offset+=left ? side_z_offset : 0.0;v_normal=side_z_offset > 0.0 && left ? vec2(0.0) : v_normal;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:ba(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize lowp float emissive_strength
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef DUAL_SOURCE_BLENDING
glFragColorSrc1=vec4(vec3(0.0),emissive_strength);
#else
#ifdef USE_MRT1
out_Target1=vec4(emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize lowp float emissive_strength
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:ba(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:ba(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),1.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:ba("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:ba("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:ba(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:ba(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef TERRAIN
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#else
out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#define APPEARANCE_ICON 1.0
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float a_size_max= floor(a_size[1]*0.5);float a_apperance_icon=a_size[1]-2.0*a_size_max;vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (a_apperance_icon==APPEARANCE_ICON) {size=a_size_max/128.0;} else if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size_max,u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
#ifdef Z_TEST_OCCLUSION
out_fade_opacity*=occlusion_opacity;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
}`),terrainRaster:ba(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
uniform sampler2D u_image1;uniform float u_emissive_texture_available;
#endif
in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : image_color.a;vec3 unlit_base=image_color.rgb*(1.0-emissive_strength);vec3 emissive_base=image_color.rgb*emissive_strength;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : image_color.a;color.rgb=mix(color.rgb,image_color.rgb,emissive_strength);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:ba("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:ba(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,ry),skyboxGradient:ba(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,ry),skyboxCapture:ba(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:ba(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
uniform sampler2D u_image1;uniform float u_emissive_texture_available;
#endif
uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : raster.a;raster=apply_lighting_with_emission_ground(raster,emissive_strength);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : color.a;color=apply_lighting_with_emission_ground(color,emissive_strength);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:ba(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_atmosphere_fog_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_atmosphere_fog_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_atmosphere_fog_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:ba(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef FLIP_Y
coord.y=1.0-coord.y;
#endif
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;
#ifdef FLIP_Y
T=-T;B=-B;
#endif
highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));
#ifdef FLIP_Y
n=normalize(cross(fdx,fdy));
#else
n=normalize(cross(fdx,fdy))*-1.0;
#endif
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
#ifdef FEATURE_CUTOUT
finalColor=apply_feature_cutout(finalColor,gl_FragCoord);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#ifdef CLIP_ZERO_TO_ONE
v_depth=-1.0+2.0*v_depth; 
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:ba(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:ba(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:ba("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:ba("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:ba("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:ba("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Bm(st,d){const _e=st.split(`
`);for(let ot of _e){if(ot=ot.trimStart(),ot[0]!=="#"||!ot.includes("if")||ot.startsWith("#endif"))continue;const ut=ot.match(B_);if(ut)for(const mt of ut)ex.has(mt)||d.add(mt)}}function ba(st,d){const _e=new Set,ot=[],ut=[];st=st.replace(h1,(xt,Tt)=>(ut.push(Tt),"")),d=d.replace(h1,(xt,Tt)=>(ot.push(Tt),""));let mt=new Set(tx);Bm(st,mt),Bm(d,mt);for(const xt of[...ot,...ut])oy[xt]||(oy[xt]=new Set,Bm(Fm[xt],oy[xt])),mt=new Set([...mt,...oy[xt]]);return{fragmentSource:st=st.replace(G0,(xt,Tt,kt,$t,Xt)=>(_e.add(Xt),Tt==="define"?`
#ifndef HAS_UNIFORM_u_${Xt}
in ${kt} ${$t} ${Xt};
#else
uniform ${kt} ${$t} u_${Xt};
#endif
`:Tt==="initialize"?`
#ifdef HAS_UNIFORM_u_${Xt}
    ${kt} ${$t} ${Xt} = u_${Xt};
#endif
`:Tt==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${Xt}
    in ${kt} ${$t} ${Xt};
#endif
`:Tt==="initialize-attribute"?"":void 0)),vertexSource:d=d.replace(G0,(xt,Tt,kt,$t,Xt)=>{const rr=`MATERIAL_ATTRIBUTE_OFFSET_${Xt}`,tr=$t==="float"?"vec2":$t,nr=`GET_ATTRIBUTE_${tr}(a_${Xt}, materialInfo, ${rr})`,cr=Xt.match(/color/)?"color":tr;return Tt==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${Xt}
in ${kt} ${$t} a_${Xt};
#endif
`:_e.has(Xt)?Tt==="define"?`
#ifndef HAS_UNIFORM_u_${Xt}
uniform lowp float u_${Xt}_t;
    #if !defined(${rr})
        in ${kt} ${tr} a_${Xt};
    #endif
out ${kt} ${$t} ${Xt};
#else
uniform ${kt} ${$t} u_${Xt};
#endif
`:Tt==="initialize"?cr==="vec4"?`
#ifndef HAS_UNIFORM_u_${Xt}
    ${Xt} = a_${Xt};
#else
    ${kt} ${$t} ${Xt} = u_${Xt};
#endif
`:`
#if !defined(HAS_UNIFORM_u_${Xt})
    #ifdef ${rr}
        ${Xt} = unpack_mix_${cr}(${nr}, u_${Xt}_t);
    #else
        ${Xt} = unpack_mix_${cr}(a_${Xt}, u_${Xt}_t);
    #endif
#else
    ${kt} ${$t} ${Xt} = u_${Xt};
#endif
`:Tt==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${Xt}
    in ${kt} ${$t} a_${Xt};
    out ${kt} ${$t} ${Xt};
#endif
`:Tt==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${Xt}
    ${Xt} = a_${Xt};
#endif
`:void 0:Tt==="define"?`
#ifndef HAS_UNIFORM_u_${Xt}
uniform lowp float u_${Xt}_t;
    #if !defined(${rr})
        in ${kt} ${tr} a_${Xt};
    #endif
#else
uniform ${kt} ${$t} u_${Xt};
#endif
`:Tt==="define-instanced"?cr==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${Xt}0;
in vec4 a_${Xt}1;
in vec4 a_${Xt}2;
in vec4 a_${Xt}3;
#else
uniform ${kt} ${$t} u_${Xt};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${kt} ${tr} a_${Xt};
#else
uniform ${kt} ${$t} u_${Xt};
#endif
`:Tt==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${Xt}
    ${kt} ${$t} ${Xt} = a_${Xt};
#endif
`:cr==="vec4"?`
#ifndef HAS_UNIFORM_u_${Xt}
    #ifdef ${rr}
        ${kt} ${$t} ${Xt} = ${nr};
    #else
        ${kt} ${$t} ${Xt} = a_${Xt};
    #endif
#else
    ${kt} ${$t} ${Xt} = u_${Xt};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Xt}
    #ifdef ${rr}
        ${kt} ${$t} ${Xt} = unpack_mix_${cr}(${nr}, u_${Xt}_t);
    #else
        ${kt} ${$t} ${Xt} = unpack_mix_${cr}(a_${Xt}, u_${Xt}_t);
    #endif
#else
    ${kt} ${$t} ${Xt} = u_${Xt};
#endif
`}),usedDefines:mt,vertexIncludes:ot,fragmentIncludes:ut}}class n2{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(d,_e,ot,ut,mt,xt,Tt,kt){this.context=d;let $t=this.boundPaintVertexBuffers.length!==ut.length;for(let rr=0;!$t&&rr<ut.length;rr++)this.boundPaintVertexBuffers[rr]!==ut[rr]&&($t=!0);let Xt=this.boundDynamicVertexBuffers.length!==Tt.length;for(let rr=0;!Xt&&rr<Tt.length;rr++)this.boundDynamicVertexBuffers[rr]!==Tt[rr]&&(Xt=!0);if(!this.vao||this.boundProgram!==_e||this.boundLayoutVertexBuffer!==ot||$t||Xt||this.boundIndexBuffer!==mt||this.boundVertexOffset!==xt)this.freshBind(_e,ot,ut,mt,xt,Tt,kt);else{d.bindVertexArrayOES.set(this.vao);for(const rr of Tt)rr&&(rr.bind(),kt&&rr.instanceCount&&rr.setVertexAttribDivisor(d.gl,_e,kt));mt&&mt.dynamicDraw&&mt.bind()}}freshBind(d,_e,ot,ut,mt,xt,Tt){const kt=this.context,$t=kt.gl;this.vao&&this.destroy(),this.vao=kt.gl.createVertexArray(),kt.bindVertexArrayOES.set(this.vao),this.boundProgram=d,this.boundLayoutVertexBuffer=_e,this.boundPaintVertexBuffers=ot,this.boundIndexBuffer=ut,this.boundVertexOffset=mt,this.boundDynamicVertexBuffers=xt,_e.enableAttributes($t,d),_e.bind(),_e.setVertexAttribPointers($t,d,mt);for(const Xt of ot)Xt.enableAttributes($t,d),Xt.bind(),Xt.setVertexAttribPointers($t,d,mt);for(const Xt of xt)Xt&&(Xt.enableAttributes($t,d),Xt.bind(),Xt.setVertexAttribPointers($t,d,mt),Tt&&Xt.instanceCount&&Xt.setVertexAttribDivisor($t,d,Tt));ut&&ut.bind()}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function i2(st,d){const _e=Math.pow(2,d.canonical.z),ot=d.canonical.y;return[new c.ae(0,ot/_e).toLngLat().lat,new c.ae(0,(ot+1)/_e).toLngLat().lat]}function s2(st,d,_e,ot,ut,mt,xt){const Tt=st.context,kt=Tt.gl,$t=_e.hillshadeFBO;if(!$t)return;st.prepareDrawTile();const Xt=st.isTileAffectedByFog(d),rr=[];st.terrain&&st.terrain.renderingToTexture&&st.emissiveMode==="mrt-fallback"&&rr.push("USE_MRT1");const tr=st.getOrCreateProgram("hillshade",{overrideFog:Xt,defines:rr});Tt.activeTexture.set(kt.TEXTURE0),kt.bindTexture(kt.TEXTURE_2D,$t.colorAttachment0.get());const nr=((xr,Ar,Dr,Tr)=>{const Wr=Dr.paint.get("hillshade-shadow-color"),zr=Dr.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",$r=Dr.paint.get("hillshade-highlight-color"),Or=Dr.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",Br=Dr.paint.get("hillshade-accent-color"),Xr=Dr.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",an=Dr.paint.get("hillshade-emissive-strength");let sn=c.an(Dr.paint.get("hillshade-illumination-direction"));if(Dr.paint.get("hillshade-illumination-anchor")==="viewport")sn-=xr.transform.angle;else if(xr.style&&xr.style.enable3dLights()&&xr.style.directionalLight){const Cn=xr.style.directionalLight.properties.get("direction"),Nn=c.d4(Cn.x,Cn.y,Cn.z);sn=c.an(Nn[1])}const wn=!xr.options.moving;return{u_matrix:Tr||xr.transform.calculateProjMatrix(Ar.tileID.toUnwrapped(),wn),u_image:0,u_latrange:i2(0,Ar.tileID),u_light:[Dr.paint.get("hillshade-exaggeration"),sn],u_shadow:Wr.toPremultipliedRenderColor(zr?null:Dr.lut),u_highlight:$r.toPremultipliedRenderColor(Or?null:Dr.lut),u_emissive_strength:an,u_accent:Br.toPremultipliedRenderColor(Xr?null:Dr.lut)}})(st,_e,ot,st.terrain?d.projMatrix:null);st.uploadCommonUniforms(Tt,tr,d.toUnwrapped());const{tileBoundsBuffer:cr,tileBoundsIndexBuffer:lr,tileBoundsSegments:yr}=st.getTileBoundsBuffers(_e);tr.draw(st,kt.TRIANGLES,ut,mt,xt,wr.disabled,nr,ot.id,cr,lr,yr)}function N_(st,d,_e){if(!d.needsDEMTextureUpload)return;const ot=st.context,ut=ot.gl;ot.pixelStoreUnpackPremultiplyAlpha.set(!1),d.demTexture=d.demTexture||st.getTileTexture(_e.stride);const mt=_e.getPixels();d.demTexture?d.demTexture.update(mt,{premultiply:!1}):d.demTexture=new c.T(ot,mt,ut.R32F,{premultiply:!1}),d.needsDEMTextureUpload=!1}function o2(st,d,_e){const ot=st.context,ut=ot.gl;if(!d.dem)return;const mt=d.dem;if(ot.activeTexture.set(ut.TEXTURE1),N_(st,d,mt),!d.demTexture)return;d.demTexture.bind(ut.NEAREST,ut.CLAMP_TO_EDGE);const xt=mt.dim;ot.activeTexture.set(ut.TEXTURE0);let Tt=d.hillshadeFBO;if(!Tt){const tr=new c.T(ot,{width:xt,height:xt,data:null},ut.RGBA8);tr.bind(ut.LINEAR,ut.CLAMP_TO_EDGE),Tt=d.hillshadeFBO=ot.createFramebuffer(xt,xt,1,"renderbuffer"),Tt.colorAttachment0.set(tr.texture)}ot.bindFramebuffer.set(Tt.framebuffer),ot.viewport.set([0,0,xt,xt]);const{tileBoundsBuffer:kt,tileBoundsIndexBuffer:$t,tileBoundsSegments:Xt}=st.getMercatorTileBoundsBuffers(),rr=[];st.linearFloatFilteringSupported()&&rr.push("TERRAIN_DEM_FLOAT_FORMAT"),st.terrain&&st.terrain.renderingToTexture&&st.emissiveMode==="mrt-fallback"&&rr.push("USE_MRT1"),st.getOrCreateProgram("hillshadePrepare",{defines:rr}).draw(st,ut.TRIANGLES,Us.disabled,oo.disabled,co.unblended,wr.disabled,((tr,nr)=>{const cr=nr.stride,lr=c.bC();return c.ce(lr,0,c.al,-c.al,0,0,1),c.br(lr,lr,[0,-c.al,0]),{u_matrix:lr,u_image:1,u_dimension:[cr,cr],u_zoom:tr.overscaledZ}})(d.tileID,mt),_e.id,kt,$t,Xt),d.needsHillshadePrepare=!1}class xu{constructor(d){this.gl=d.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(d){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class a2 extends xu{getDefault(){return c.ao.transparent.toNonPremultipliedRenderColor(null)}set(d){const _e=this.current;(d.r!==_e.r||d.g!==_e.g||d.b!==_e.b||d.a!==_e.a||this.dirty)&&(this.gl.clearColor(d.r,d.g,d.b,d.a),this.current=d,this.dirty=!1)}}class yE extends xu{getDefault(){return 1}set(d){(d!==this.current||this.dirty)&&(this.gl.clearDepth(d),this.current=d,this.dirty=!1)}}class O_ extends xu{getDefault(){return 0}set(d){(d!==this.current||this.dirty)&&(this.gl.clearStencil(d),this.current=d,this.dirty=!1)}}class ly extends xu{getDefault(){return[!0,!0,!0,!0]}set(d){const _e=this.current;(d[0]!==_e[0]||d[1]!==_e[1]||d[2]!==_e[2]||d[3]!==_e[3]||this.dirty)&&(this.gl.colorMask(d[0],d[1],d[2],d[3]),this.current=d,this.dirty=!1)}}class L_ extends xu{getDefault(){return!0}set(d){(d!==this.current||this.dirty)&&(this.gl.depthMask(d),this.current=d,this.dirty=!1)}}class rx extends xu{getDefault(){return 255}set(d){(d!==this.current||this.dirty)&&(this.gl.stencilMask(d),this.current=d,this.dirty=!1)}}class kx extends xu{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(d){const _e=this.current;(d.func!==_e.func||d.ref!==_e.ref||d.mask!==_e.mask||this.dirty)&&(this.gl.stencilFunc(d.func,d.ref,d.mask),this.current=d,this.dirty=!1)}}class f1 extends xu{getDefault(){const d=this.gl;return[d.KEEP,d.KEEP,d.KEEP]}set(d){const _e=this.current;(d[0]!==_e[0]||d[1]!==_e[1]||d[2]!==_e[2]||this.dirty)&&(this.gl.stencilOp(d[0],d[1],d[2]),this.current=d,this.dirty=!1)}}class Fx extends xu{getDefault(){return!1}set(d){if(d===this.current&&!this.dirty)return;const _e=this.gl;d?_e.enable(_e.STENCIL_TEST):_e.disable(_e.STENCIL_TEST),this.current=d,this.dirty=!1}}class _E extends xu{getDefault(){return[0,1]}set(d){const _e=this.current;(d[0]!==_e[0]||d[1]!==_e[1]||this.dirty)&&(this.gl.depthRange(d[0],d[1]),this.current=d,this.dirty=!1)}}class j_ extends xu{getDefault(){return!1}set(d){if(d===this.current&&!this.dirty)return;const _e=this.gl;d?_e.enable(_e.DEPTH_TEST):_e.disable(_e.DEPTH_TEST),this.current=d,this.dirty=!1}}class vE extends xu{getDefault(){return this.gl.LESS}set(d){(d!==this.current||this.dirty)&&(this.gl.depthFunc(d),this.current=d,this.dirty=!1)}}class Bx extends xu{getDefault(){return!1}set(d){if(d===this.current&&!this.dirty)return;const _e=this.gl;d?_e.enable(_e.BLEND):_e.disable(_e.BLEND),this.current=d,this.dirty=!1}}class cy extends xu{getDefault(){const d=this.gl;return[d.ONE,d.ZERO,d.ONE,d.ZERO]}set(d){const _e=this.current;(d[0]!==_e[0]||d[1]!==_e[1]||d[2]!==_e[2]||d[3]!==_e[3]||this.dirty)&&(this.gl.blendFuncSeparate(d[0],d[1],d[2],d[3]),this.current=d,this.dirty=!1)}}class uy extends xu{getDefault(){return c.ao.transparent.toNonPremultipliedRenderColor(null)}set(d){const _e=this.current;(d.r!==_e.r||d.g!==_e.g||d.b!==_e.b||d.a!==_e.a||this.dirty)&&(this.gl.blendColor(d.r,d.g,d.b,d.a),this.current=d,this.dirty=!1)}}class z_ extends xu{getDefault(){return this.gl.FUNC_ADD}set(d){(d!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(d,d),this.current=d,this.dirty=!1)}}class dy extends xu{getDefault(){return!1}set(d){if(d===this.current&&!this.dirty)return;const _e=this.gl;d?_e.enable(_e.CULL_FACE):_e.disable(_e.CULL_FACE),this.current=d,this.dirty=!1}}class p1 extends xu{getDefault(){return this.gl.BACK}set(d){(d!==this.current||this.dirty)&&(this.gl.cullFace(d),this.current=d,this.dirty=!1)}}class EE extends xu{getDefault(){return this.gl.CCW}set(d){(d!==this.current||this.dirty)&&(this.gl.frontFace(d),this.current=d,this.dirty=!1)}}let bE=class extends xu{getDefault(){return null}set(st){(st!==this.current||this.dirty)&&(this.gl.useProgram(st),this.current=st,this.dirty=!1)}};class wE extends xu{getDefault(){return this.gl.TEXTURE0}set(d){(d!==this.current||this.dirty)&&(this.gl.activeTexture(d),this.current=d,this.dirty=!1)}}class Mx extends xu{getDefault(){const d=this.gl;return[0,0,d.drawingBufferWidth,d.drawingBufferHeight]}set(d){const _e=this.current;(d[0]!==_e[0]||d[1]!==_e[1]||d[2]!==_e[2]||d[3]!==_e[3]||this.dirty)&&(this.gl.viewport(d[0],d[1],d[2],d[3]),this.current=d,this.dirty=!1)}}class CE extends xu{getDefault(){return null}set(d){if(d===this.current&&!this.dirty)return;const _e=this.gl;_e.bindFramebuffer(_e.FRAMEBUFFER,d),this.current=d,this.dirty=!1}}class l2 extends xu{getDefault(){return null}set(d){if(d===this.current&&!this.dirty)return;const _e=this.gl;_e.bindRenderbuffer(_e.RENDERBUFFER,d),this.current=d,this.dirty=!1}}class c2 extends xu{getDefault(){return null}set(d){if(d===this.current&&!this.dirty)return;const _e=this.gl;_e.bindTexture(_e.TEXTURE_2D,d),this.current=d,this.dirty=!1}}class u2 extends xu{getDefault(){return null}set(d){if(d===this.current&&!this.dirty)return;const _e=this.gl;_e.bindBuffer(_e.ARRAY_BUFFER,d),this.current=d,this.dirty=!1}}class V_ extends xu{getDefault(){return null}set(d){const _e=this.gl;_e.bindBuffer(_e.ELEMENT_ARRAY_BUFFER,d),this.current=d,this.dirty=!1}}class U_ extends xu{getDefault(){return null}set(d){this.gl&&(d!==this.current||this.dirty)&&(this.gl.bindVertexArray(d),this.current=d,this.dirty=!1)}}class G_ extends xu{getDefault(){return 4}set(d){if(d===this.current&&!this.dirty)return;const _e=this.gl;_e.pixelStorei(_e.UNPACK_ALIGNMENT,d),this.current=d,this.dirty=!1}}class $_ extends xu{getDefault(){return!1}set(d){if(d===this.current&&!this.dirty)return;const _e=this.gl;_e.pixelStorei(_e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,d),this.current=d,this.dirty=!1}}class AE extends xu{getDefault(){return!1}set(d){if(d===this.current&&!this.dirty)return;const _e=this.gl;_e.pixelStorei(_e.UNPACK_FLIP_Y_WEBGL,d),this.current=d,this.dirty=!1}}class hy extends xu{constructor(d,_e){super(d),this.context=d,this.parent=_e}getDefault(){return null}}class fy extends hy{constructor(d,_e,ot=0){super(d,_e),this.attachmentPoint=d.gl.COLOR_ATTACHMENT0+ot}setDirty(){this.dirty=!0}set(d){if(d===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const _e=this.gl;_e.framebufferTexture2D(_e.FRAMEBUFFER,this.attachmentPoint,_e.TEXTURE_2D,d,0),this.current=d,this.dirty=!1}}class Nx extends hy{attachment(){return this.gl.DEPTH_ATTACHMENT}set(d){if(d===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const _e=this.gl;_e.framebufferRenderbuffer(_e.FRAMEBUFFER,this.attachment(),_e.RENDERBUFFER,d),this.current=d,this.dirty=!1}}class m1 extends hy{attachment(){return this.gl.DEPTH_ATTACHMENT}set(d){if(d===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const _e=this.gl;_e.framebufferTexture2D(_e.FRAMEBUFFER,this.attachment(),_e.TEXTURE_2D,d,0),this.current=d,this.dirty=!1}}class SE extends Nx{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const o0=(st,d,_e,ot)=>({u_matrix:st,u_image0:0,u_image1:1,u_skirt_height:d,u_ground_shadow_factor:_e,u_emissive_texture_available:ot}),py=(st,d,_e,ot,ut,mt,xt,Tt,kt,$t,Xt,rr,tr,nr,cr,lr,yr)=>({u_proj_matrix:Float32Array.from(st),u_globe_matrix:d,u_normalize_matrix:Float32Array.from(ot),u_merc_matrix:_e,u_zoom_transition:ut,u_merc_center:mt,u_image0:0,u_image1:1,u_frustum_tl:xt,u_frustum_tr:Tt,u_frustum_br:kt,u_frustum_bl:$t,u_globe_pos:Xt,u_globe_radius:rr,u_viewport:tr,u_grid_matrix:yr?Float32Array.from(yr):new Float32Array(9),u_skirt_height:nr,u_far_z_cutoff:cr,u_emissive_texture_available:lr});function x1(st,d){return st!=null&&d!=null&&!(!st.hasData()||!d.hasData())&&st.demTexture!=null&&d.demTexture!=null&&st.tileID.key!==d.tileID.key}const rm=new class{constructor(){this.operations={}}newMorphing(st,d,_e,ot,ut){if(st in this.operations){const mt=this.operations[st];mt.to.tileID.key!==_e.tileID.key&&(mt.queued=_e)}else this.operations[st]={startTime:ot,phase:0,duration:ut,from:d,to:_e,queued:null}}getMorphValuesForProxy(st){if(!(st in this.operations))return null;const d=this.operations[st];return{from:d.from,to:d.to,phase:d.phase}}update(st){for(const d in this.operations){const _e=this.operations[d];for(_e.phase=(st-_e.startTime)/_e.duration;_e.phase>=1||!this._validOp(_e);)if(!this._nextOp(_e,st)){delete this.operations[d];break}}}_nextOp(st,d){return!!st.queued&&(st.from=st.to,st.to=st.queued,st.queued=null,st.phase=0,st.startTime=d,!0)}_validOp(st){return st.from.hasData()&&st.to.hasData()}},my={0:null,1:"TERRAIN_VERTEX_MORPHING"};function xy(st,d,_e){if(d===0)return 0;const ot=d<1&&_e===514?.25/d:1;return 6*Math.pow(1.5,22-st)*Math.max(d,1)*ot}function H_(st,d){const _e=1<<st.z;return!d&&(st.x===0||st.x===_e-1)||st.y===0||st.y===_e-1}function Ox(st,d){if(!st.style||!st.style.enable3dLights())return;const _e=st.context,ot=_e.gl;_e.activeTexture.set(ot.TEXTURE1),d?d.bind(ot.LINEAR,ot.CLAMP_TO_EDGE):st.emptyTexture.bind(ot.LINEAR,ot.CLAMP_TO_EDGE)}const g1=st=>({u_matrix:st});function y1(st,d,_e,ot,ut){if(ut>0){const mt=c.o.now(),xt=(mt-st.timeAdded)/ut,Tt=d?(mt-d.timeAdded)/ut:-1,kt=_e.getSource(),$t=ot.coveringZoomLevel({tileSize:kt.tileSize,roundZoom:kt.roundZoom}),Xt=!d||Math.abs(d.tileID.overscaledZ-$t)>Math.abs(st.tileID.overscaledZ-$t),rr=Xt&&st.refreshedUponExpiration?1:c.aA(Xt?xt:1-Tt,0,1);return d?{opacity:1,mix:1-rr,isFading:xt<1}:{opacity:rr,mix:0,isFading:xt<1}}return{opacity:1,mix:0,isFading:!1}}class gy extends Du{constructor(d){const _e=uo("mock-dem",{type:"raster-dem",maxzoom:d.transform.maxZoom},d.style.dispatcher,d.style);super("mock-dem",_e,!1),_e.setEventedParent(this),this._sourceLoaded=!0}_loadTile(d,_e){d.state="loaded",_e(null)}}class W_ extends Du{constructor(d){const _e=uo("proxy",{type:"geojson",maxzoom:d.transform.maxZoom},d.style.dispatcher,d.style);super("proxy",_e,!1),_e.setEventedParent(this),this.map=this.getSource().map=d,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(d,_e,ot){if(d.freezeTileCoverage)return;this.transform=d;const ut=d.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((mt,xt)=>{if(mt[xt.key]="",!this._tiles[xt.key]){const Tt=new Fp(xt,this._source.tileSize*xt.overscaleFactor(),d.tileZoom,void 0,void 0,this._source.worldview);Tt.state="loaded",this._tiles[xt.key]=Tt}return mt},{});for(const mt in this._tiles)mt in ut||(this.freeFBO(mt),this._tiles[mt].unloadVectorData(),delete this._tiles[mt])}freeFBO(d){const _e=this.proxyCachedFBO[d];if(_e!==void 0){const ot=Object.values(_e);this.renderCachePool.push(...ot),delete this.proxyCachedFBO[d]}}deallocRenderCache(){this.renderCache.forEach(d=>d.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class q_ extends c.aQ{constructor(d,_e,ot){super(d.overscaledZ,d.wrap,d.canonical.z,d.canonical.x,d.canonical.y),this.proxyTileKey=_e,this.projMatrix=ot}}class X_ extends c.bV{constructor(d,_e){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},this.painter=d,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[ot,ut,mt]=function(kt){const $t=new c.bd,Xt=new c.b0,rr=131;$t.reserve(17161),Xt.reserve(33800);const tr=c.al/128,nr=c.al+tr/2,cr=nr+tr;for(let yr=-tr;yr<cr;yr+=tr)for(let xr=-tr;xr<cr;xr+=tr){const Ar=xr<0||xr>nr||yr<0||yr>nr?24575:0,Dr=c.aA(Math.round(xr),0,c.al),Tr=c.aA(Math.round(yr),0,c.al);$t.emplaceBack(Dr+Ar,Tr)}const lr=(yr,xr)=>{const Ar=xr*rr+yr;Xt.emplaceBack(Ar+1,Ar,Ar+rr),Xt.emplaceBack(Ar+rr,Ar+rr+1,Ar+1)};for(let yr=1;yr<129;yr++)for(let xr=1;xr<129;xr++)lr(xr,yr);return[0,129].forEach(yr=>{for(let xr=0;xr<130;xr++)lr(xr,yr),lr(yr,xr)}),[$t,Xt,32768]}(),xt=d.context;this.gridBuffer=xt.createVertexBuffer(ot,c.bf.members),this.gridIndexBuffer=xt.createIndexBuffer(ut),this.gridSegments=c.bg.simpleSegment(0,0,ot.length,ut.length),this.gridNoSkirtSegments=c.bg.simpleSegment(0,0,ot.length,mt),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new W_(_e.map),this.orthoMatrix=c.bC(),c.ce(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,c.al,0,c.al,0,1);const Tt=xt.gl;this._overlapStencilMode=new oo({func:Tt.GEQUAL,mask:255},0,255,Tt.KEEP,Tt.KEEP,Tt.REPLACE),this._previousZoom=d.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=_e,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new gy(_e.map),this._pendingGroundEffectLayers=[],this._emissiveTexture=!1}set style(d){d.on("data",this._onStyleDataEvent.bind(this)),this._style=d,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(d,_e,ot){if(d&&d.terrain){this._style!==d&&(this.style=d,this._evaluationZoom=void 0);const ut=d.terrain.properties,mt=d.terrain.drapeRenderMode===0,xt=d.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=c.o.now();const Tt=d.terrain&&d.terrain.scope,kt=ut.get("source"),$t=mt?this._mockSourceCache:d.getSourceCache(kt,Tt);if(!$t)return void c.w(`Couldn't find terrain source "${kt}".`);if(this.sourceCache=$t,this._attenuationRange=d.terrain.getAttenuationRange(),this._exaggeration=xt?this.calculateExaggeration(_e):ut.get("exaggeration"),!_e.projection.requiresDraping&&xt&&this._exaggeration===0)return void this._disable();this.enabled=!0;const Xt=()=>{this.sourceCache.used&&c.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const rr=this.getScaledDemTileSize();this.sourceCache.update(_e,rr,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,Xt(),this._initializing=!0),Xt(),_e.updateElevation(!0,ot),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(_e),this._emptyDEMTextureDirty=!0,this._previousZoom=_e.zoom}else this._disable()}calculateExaggeration(d){if(this._attenuationRange&&d.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(d.zoom);const _e=this._previousCameraAltitude,ot=d.getFreeCameraOptions().position.z/d.pixelsPerMeter*d.worldSize;this._previousCameraAltitude=ot;const ut=_e!=null?ot-_e:Number.MAX_VALUE;if(Math.abs(ut)<2)return this._exaggeration;const mt=d.zoom,xt=this._style.terrain;if(!this._previousUpdateTimestamp)return xt.getExaggeration(mt);let Tt=mt-this._previousZoom;const kt=this._previousUpdateTimestamp;let $t=mt;this._evaluationZoom!=null&&($t=this._evaluationZoom,Math.abs(mt-$t)>.5&&(Tt=.5*(mt-$t+Tt)),Tt*ut<0&&($t+=Tt)),this._evaluationZoom=$t;const Xt=xt.getExaggeration($t),rr=Xt===xt.getExaggeration(Math.max(0,$t-.1));if(rr&&Math.abs(Xt-this._exaggeration)<.01)return Xt;let tr=Math.min(.1,.00375*(this._updateTimestamp-kt));return(rr||Xt<.1||Math.abs(Tt)<1e-4)&&(tr=Math.min(.2,4*tr)),c.ak(this._exaggeration,Xt,tr)}resetTileLookupCache(d){this._findCoveringTileCache[d]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(d){d.dataType==="source"&&d.coord?this._clearRenderCacheForTile(d.sourceCacheId,d.coord):d.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const d in this._style._mergedSourceCaches)this._style._mergedSourceCaches[d].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(d=>d.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const d=2*this.proxySourceCache.getSource().tileSize;return[d,d]}set useVertexMorphing(d){this._useVertexMorphing=d}updateTileBinding(d){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const _e=this.proxySourceCache,ot=this.painter.transform;this._initializing&&(this._initializing=ot._centerAltitude===0&&this.getAtPointOrZero(c.ae.fromLngLat(ot.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const ut=this.proxyCoords=_e.getIds().map(kt=>{const $t=_e.getTileByID(kt).tileID;return $t.projMatrix=ot.calculateProjMatrix($t.toUnwrapped()),$t});(function(kt,$t){const Xt=$t.transform.pointCoordinate($t.transform.getCameraPoint()),rr=new c.P(Xt.x,Xt.y);kt.sort((tr,nr)=>{if(nr.overscaledZ-tr.overscaledZ)return nr.overscaledZ-tr.overscaledZ;const cr=new c.P(tr.canonical.x+(1<<tr.canonical.z)*tr.wrap,tr.canonical.y),lr=new c.P(nr.canonical.x+(1<<nr.canonical.z)*nr.wrap,nr.canonical.y),yr=rr.mult(1<<tr.canonical.z);return yr.x-=.5,yr.y-=.5,yr.distSqr(cr)-yr.distSqr(lr)})})(ut,this.painter);const mt=this.proxyToSource||{};this.proxyToSource={},ut.forEach(kt=>{this.proxyToSource[kt.key]={}}),this.terrainTileForTile={};const xt=this._style._mergedSourceCaches;for(const kt in xt){const $t=xt[kt];if(!$t.used||($t!==this.sourceCache&&this.resetTileLookupCache($t.id),this._setupProxiedCoordsForOrtho($t,d[kt],mt),$t.usedForTerrain))continue;const Xt=d[kt];$t.getSource().reparseOverscaled&&this._assignTerrainTiles(Xt)}this.proxiedCoords[_e.id]=ut.map(kt=>new q_(kt,kt.key,this.orthoMatrix)),this._assignTerrainTiles(ut),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(mt),this.renderingToTexture=!1;const Tt={};this._visibleDemTiles=[];for(const kt of this.proxyCoords){const $t=this.terrainTileForTile[kt.key];if(!$t)continue;const Xt=$t.tileID.key;Xt in Tt||(this._visibleDemTiles.push($t),Tt[Xt]=Xt)}}_assignTerrainTiles(d){this._initializing||d.forEach(_e=>{if(this.terrainTileForTile[_e.key])return;const ot=this._findTileCoveringTileID(_e,this.sourceCache);ot&&(this.terrainTileForTile[_e.key]=ot)})}_prepareDEMTextures(){const d=this.painter.context,_e=d.gl;for(const ot in this.terrainTileForTile){const ut=this.terrainTileForTile[ot],mt=ut.dem;!mt||ut.demTexture&&!ut.needsDEMTextureUpload||(d.activeTexture.set(_e.TEXTURE1),N_(this.painter,ut,mt))}}_prepareDemTileUniforms(d,_e,ot,ut){if(!_e||_e.demTexture==null)return!1;const mt=d.tileID.canonical,xt=Math.pow(2,_e.tileID.canonical.z-mt.z),Tt=ut||"";return ot[`u_dem_tl${Tt}`]=[mt.x*xt%1,mt.y*xt%1],ot[`u_dem_scale${Tt}`]=xt,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let d=0;const _e=this._visibleDemTiles.reduce((ot,ut)=>{if(!ut.dem)return ot;const mt=ut.dem.tree.minimums[0];return mt>0&&d++,ot+mt},0);return d?_e/d:0}_updateEmptyDEMTexture(){const d=this.painter.context,_e=d.gl;d.activeTexture.set(_e.TEXTURE2);const ot=this._getLoadedAreaMinimum(),ut=new c.dL({width:1,height:1},new Float32Array([ot]));this._emptyDEMTextureDirty=!1;let mt=this._emptyDEMTexture;return mt?mt.update(ut,{premultiply:!1}):mt=this._emptyDEMTexture=new c.T(d,ut,_e.R32F,{premultiply:!1}),mt}setupElevationDraw(d,_e,ot){const ut=this.painter.context,mt=ut.gl,xt={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};xt.u_exaggeration=this.exaggeration();let Tt=null,kt=null,$t=1;if(ot&&ot.morphing&&this._useVertexMorphing){const nr=ot.morphing.srcDemTile,cr=ot.morphing.dstDemTile;$t=ot.morphing.phase,nr&&cr&&(this._prepareDemTileUniforms(d,nr,xt,"_prev")&&(kt=nr),this._prepareDemTileUniforms(d,cr,xt)&&(Tt=cr))}const Xt=nr=>nr&&nr.demTexture&&this.painter.linearFloatFilteringSupported()?mt.LINEAR:mt.NEAREST;let rr=null;var tr;if(this.enabled?kt&&Tt?(rr=Tt.demTexture,ut.activeTexture.set(mt.TEXTURE4),kt.demTexture.bind(Xt(kt),mt.CLAMP_TO_EDGE),xt.u_dem_lerp=$t):(Tt=this.terrainTileForTile[d.tileID.key],rr=this._prepareDemTileUniforms(d,Tt,xt)?Tt.demTexture:this.emptyDEMTexture):rr=this.emptyDEMTexture,ut.activeTexture.set(mt.TEXTURE2),rr&&(xt.u_dem_size=(tr=rr).size[0]===1?1:tr.size[0]-2,rr.bind(Xt(Tt),mt.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(ot&&ot.useDepthForOcclusion,_e,xt),ot&&ot.useMeterToDem&&Tt){const nr=(1<<Tt.tileID.canonical.z)*c.cf(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;xt.u_meter_to_dem=nr}if(ot&&ot.labelPlaneMatrixInv&&(xt.u_label_plane_matrix_inv=ot.labelPlaneMatrixInv),_e.setTerrainUniformValues(ut,xt),this.painter.transform.projection.name==="globe"){const nr=this.globeUniformValues(this.painter.transform,d.tileID.canonical,ot&&ot.useDenormalizedUpVectorScale);_e.setGlobeUniformValues(ut,nr)}}globeUniformValues(d,_e,ot){const ut=d.projection;return{u_tile_tl_up:ut.upVector(_e,0,0),u_tile_tr_up:ut.upVector(_e,c.al,0),u_tile_br_up:ut.upVector(_e,c.al,c.al),u_tile_bl_up:ut.upVector(_e,0,c.al),u_tile_up_scale:ot?c.dM(1):ut.upVectorScale(_e,d.center.lat,d.worldSize).metersToTile}}renderToBackBuffer(d){const _e=this.painter,ot=this.painter.context;d.length!==0&&(ot.bindFramebuffer.set(null),ot.viewport.set([0,0,_e.width,_e.height]),_e.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(ut,mt,xt,Tt,kt){if(ut.transform.projection.name==="globe")(function($t,Xt,rr,tr,nr){const cr=$t.context,lr=cr.gl;let yr,xr;const Ar=$t.transform,Dr=c.dE($t,cr,Ar),Tr=(wn,Cn)=>{if(xr===Cn)return;const Nn=[my[Cn],"PROJECTION_GLOBE_VIEW"];Dr&&Nn.push("CUSTOM_ANTIALIASING");const Jn=$t.isTileAffectedByFog(wn);yr=$t.getOrCreateProgram("globeRaster",{defines:Nn,overrideFog:Jn}),xr=Cn},Wr=$t.colorModeForRenderPass(),zr=new Us(lr.LEQUAL,Us.ReadWrite,$t.depthRangeFor3D);rm.update(nr);const $r=c.dF(Ar),Or=[c.aF(Ar.center.lng),c.aJ(Ar.center.lat)],Br=$t.globeSharedBuffers,Xr=[Ar.width*c.o.devicePixelRatio,Ar.height*c.o.devicePixelRatio],an=Float32Array.from(Ar.globeMatrix),sn={useDenormalizedUpVectorScale:!0};{const wn=$t.transform,Cn=xy(wn.zoom,Xt.exaggeration(),Xt.sourceCache._source.tileSize);xr=-1;const Nn=lr.TRIANGLES;for(const Jn of tr){const yn=rr.getTile(Jn),Qr=oo.disabled,Dn=Xt.prevTerrainTileForTile[Jn.key],bn=Xt.terrainTileForTile[Jn.key];x1(Dn,bn)&&rm.newMorphing(Jn.key,Dn,bn,nr,250),Ox($t,yn.emissiveTexture),cr.activeTexture.set(lr.TEXTURE0),yn.texture&&yn.texture.bind(lr.LINEAR,lr.CLAMP_TO_EDGE);const $n=rm.getMorphValuesForProxy(Jn.key),ls=$n?1:0;$n&&Object.assign(sn,{morphing:{srcDemTile:$n.from,dstDemTile:$n.to,phase:c.dD($n.phase)}});const As=c.dG(Jn.canonical),is=c.dH(As.getCenter().lat),_i=c.dI(Jn.canonical,As,is,wn.worldSize/wn._pixelsPerMercatorPixel),Ls=c.bk(c.dJ(Jn.canonical)),Bs=$t.emissiveMode==="mrt-fallback"?1:0,_s=py(wn.expandedFarZProjMatrix,an,$r,Ls,c.aj(wn.zoom),Or,wn.frustumCorners.TL,wn.frustumCorners.TR,wn.frustumCorners.BR,wn.frustumCorners.BL,wn.globeCenterInViewSpace,wn.globeRadius,Xr,Cn,wn._farZ,Bs,_i);if(Tr(Jn,ls),yr&&(Xt.setupElevationDraw(yn,yr,sn),$t.uploadCommonUniforms(cr,yr,Jn.toUnwrapped()),Br)){const[Rs,Qs,_o]=Br.getGridBuffers(is,Cn!==0);yr.draw($t,Nn,zr,Qr,Wr,wr.backCCW,_s,"globe_raster",Rs,Qs,_o)}}}if(Br&&($t.renderDefaultNorthPole||$t.renderDefaultSouthPole)){const wn=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];Dr&&wn.push("CUSTOM_ANTIALIASING"),yr=$t.getOrCreateProgram("globeRaster",{defines:wn});for(const Cn of tr){const{x:Nn,y:Jn,z:yn}=Cn.canonical,Qr=Jn===0,Dn=Jn===(1<<yn)-1,[bn,$n,ls,As]=Br.getPoleBuffers(yn,!1);if(As&&(Qr||Dn)){const is=rr.getTile(Cn);Ox($t,is.emissiveTexture),cr.activeTexture.set(lr.TEXTURE0),is.texture&&is.texture.bind(lr.LINEAR,lr.CLAMP_TO_EDGE);let _i=c.dK(yn,Nn,Ar);const Ls=c.bk(c.dJ(Cn.canonical)),Bs=$t.emissiveMode==="mrt-fallback"?1:0,_s=(Rs,Qs)=>Rs.draw($t,lr.TRIANGLES,zr,oo.disabled,Wr,wr.disabled,py(Ar.expandedFarZProjMatrix,_i,_i,Ls,0,Or,Ar.frustumCorners.TL,Ar.frustumCorners.TR,Ar.frustumCorners.BR,Ar.frustumCorners.BL,Ar.globeCenterInViewSpace,Ar.globeRadius,Xr,0,Ar._farZ,Bs),"globe_pole_raster",Qs,ls,As);Xt.setupElevationDraw(is,yr,sn),$t.uploadCommonUniforms(cr,yr,Cn.toUnwrapped()),Qr&&$t.renderDefaultNorthPole&&_s(yr,bn),Dn&&$t.renderDefaultSouthPole&&(_i=c.cS(c.bC(),_i,[1,-1,1]),_s(yr,$n))}}}})(ut,mt,xt,Tt,kt);else{const $t=ut.context,Xt=$t.gl;let rr,tr;const nr=ut.shadowRenderer,cr=Er(ut,ut.longestCutoffRange),lr=Wr=>{if(tr===Wr)return;const zr=[];zr.push(my[Wr]),cr.shouldRenderCutoff&&zr.push("RENDER_CUTOFF"),nr&&(zr.push("RENDER_SHADOWS","DEPTH_TEXTURE"),nr.useNormalOffset&&zr.push("NORMAL_OFFSET")),rr=ut.getOrCreateProgram("terrainRaster",{defines:zr}),tr=Wr},yr=ut.colorModeForRenderPass(),xr=new Us(Xt.LEQUAL,Us.ReadWrite,ut.depthRangeFor3D);rm.update(kt);const Ar=ut.transform,Dr=xy(Ar.zoom,mt.exaggeration(),mt.sourceCache._source.tileSize);let Tr=[0,0,0];if(nr){const Wr=ut.style.directionalLight,zr=ut.style.ambientLight;Wr&&zr&&(Tr=os(ut.style,Wr,zr))}{tr=-1;const Wr=Xt.TRIANGLES,[zr,$r]=[mt.gridIndexBuffer,mt.gridSegments];for(const Or of Tt){const Br=xt.getTile(Or),Xr=oo.disabled,an=mt.prevTerrainTileForTile[Or.key],sn=mt.terrainTileForTile[Or.key];x1(an,sn)&&rm.newMorphing(Or.key,an,sn,kt,250),Ox(ut,Br.emissiveTexture),$t.activeTexture.set(Xt.TEXTURE0),Br.texture&&Br.texture.bind(Xt.LINEAR,Xt.CLAMP_TO_EDGE);const wn=rm.getMorphValuesForProxy(Or.key),Cn=wn?1:0;let Nn;wn&&(Nn={morphing:{srcDemTile:wn.from,dstDemTile:wn.to,phase:c.dD(wn.phase)}});const Jn=ut.emissiveMode==="mrt-fallback"?1:0,yn=o0(Or.projMatrix,H_(Or.canonical,Ar.renderWorldCopies)?Dr/10:Dr,Tr,Jn);if(lr(Cn),!rr)continue;mt.setupElevationDraw(Br,rr,Nn);const Qr=Or.toUnwrapped();nr&&nr.setupShadows(Qr,rr),ut.uploadCommonUniforms($t,rr,Qr,null,cr),rr.draw(ut,Wr,xr,Xr,yr,wr.backCCW,yn,"terrain_raster",mt.gridBuffer,zr,$r)}}}}(_e,this,this.proxySourceCache,d,this._updateTimestamp),this.renderingToTexture=!0,_e.gpuTimingDeferredRenderEnd(),d.splice(0,d.length))}renderBatch(d){if(this._drapedRenderBatches.length===0)return d+1;this.renderingToTexture=!0;const _e=this.painter,ot=this.painter.context,ut=this.proxySourceCache,mt=this.proxiedCoords[ut.id],xt=this._drapedRenderBatches.shift(),Tt=_e.style.order,kt=[];this._updateFBOs(_e.emissiveMode==="mrt-fallback");let $t=0;for(const Xt of mt){const rr=ut.getTileByID(Xt.proxyTileKey),tr=ut.proxyCachedFBO[Xt.key]?ut.proxyCachedFBO[Xt.key][d]:void 0,nr=tr!==void 0?ut.renderCache[tr]:this.pool[$t++],cr=tr!==void 0;if(rr.texture=nr.tex,rr.emissiveTexture=nr.emissiveTex,cr&&!nr.dirty){kt.push(rr.tileID);continue}ot.bindFramebuffer.set(nr.fb.framebuffer);const lr=ot.gl;let yr;lr.drawBuffers(_e.emissiveMode==="mrt-fallback"?[lr.COLOR_ATTACHMENT0,lr.COLOR_ATTACHMENT1]:[lr.COLOR_ATTACHMENT0]),this.renderedToTile=!1,nr.dirty&&(ot.clear({color:c.ao.transparent,stencil:0}),nr.dirty=!1);for(let xr=xt.start;xr<=xt.end;++xr){const Ar=_e.style._mergedLayers[Tt[xr]];if(Ar.isHidden(_e.transform.zoom))continue;const Dr=_e.style.getLayerSourceCache(Ar),Tr=Dr?this.proxyToSource[Xt.key][Dr.id]:[Xt];if(!Tr)continue;const Wr=Tr;ot.viewport.set([0,0,nr.fb.width,nr.fb.height]),yr!==(Dr?Dr.id:null)&&(this._setupStencil(nr,Tr,Ar,Dr),yr=Dr?Dr.id:null),_e.renderLayer(_e,Dr,Ar,Wr)}if(lr.drawBuffers([lr.COLOR_ATTACHMENT0]),this._drapedRenderBatches.length===0)for(const xr of this._pendingGroundEffectLayers){const Ar=_e.style._mergedLayers[Tt[xr]];if(Ar.isHidden(_e.transform.zoom))continue;const Dr=_e.style.getLayerSourceCache(Ar),Tr=Dr?this.proxyToSource[Xt.key][Dr.id]:[Xt];if(!Tr)continue;const Wr=Tr;ot.viewport.set([0,0,nr.fb.width,nr.fb.height]),yr!==(Dr?Dr.id:null)&&(this._setupStencil(nr,Tr,Ar,Dr),yr=Dr?Dr.id:null),_e.renderLayer(_e,Dr,Ar,Wr)}this.renderedToTile?(nr.dirty=!0,kt.push(rr.tileID)):cr||--$t,$t===5&&($t=0,this.renderToBackBuffer(kt))}return this.renderToBackBuffer(kt),this.renderingToTexture=!1,ot.bindFramebuffer.set(null),ot.viewport.set([0,0,_e.width,_e.height]),xt.end+1}postRender(){}isLayerOrderingCorrect(d){const _e=d.order.length;let ot=-1,ut=_e;for(let mt=0;mt<_e;++mt)this._style.isLayerDraped(d._mergedLayers[d.order[mt]])?ot=Math.max(ot,mt):ut=Math.min(ut,mt);return ut>ot}getMinElevationBelowMSL(){let d=0;return this._visibleDemTiles.filter(_e=>_e.dem).forEach(_e=>{d=Math.min(d,_e.dem.tree.minimums[0])}),d===0?d:(d-30)*this._exaggeration}raycast(d,_e,ot){if(!this._visibleDemTiles)return null;const ut=this._visibleDemTiles.filter(mt=>mt.dem).map(mt=>{const xt=mt.tileID,Tt=1<<xt.overscaledZ,{x:kt,y:$t}=xt.canonical,Xt=kt/Tt,rr=(kt+1)/Tt,tr=$t/Tt,nr=($t+1)/Tt;return{minx:Xt,miny:tr,maxx:rr,maxy:nr,t:mt.dem.tree.raycastRoot(Xt,tr,rr,nr,d,_e,ot),tile:mt}});ut.sort((mt,xt)=>(mt.t!==null?mt.t:Number.MAX_VALUE)-(xt.t!==null?xt.t:Number.MAX_VALUE));for(const mt of ut){if(mt.t==null)return null;const xt=mt.tile.dem.tree.raycast(mt.minx,mt.miny,mt.maxx,mt.maxy,d,_e,ot);if(xt!=null)return xt}return null}_createFBO(){const d=this.painter.context,_e=d.gl,ot=this.drapeBufferSize;d.activeTexture.set(_e.TEXTURE0);const ut=new c.T(d,{width:ot[0],height:ot[1],data:null},_e.RGBA8);ut.bind(_e.LINEAR,_e.CLAMP_TO_EDGE);const mt=d.createFramebuffer(ot[0],ot[1],1,null);let xt;return mt.colorAttachment0.set(ut.texture),this._emissiveTexture&&(xt=new c.T(d,{width:ot[0],height:ot[1],data:null},_e.R8),xt.bind(_e.LINEAR,_e.CLAMP_TO_EDGE),mt.createColorAttachment(d,1),mt.colorAttachment1.set(xt.texture)),mt.depthAttachment=new SE(d,mt.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=d.createRenderbuffer(d.gl.DEPTH_STENCIL,ot[0],ot[1]),this._stencilRef=0,mt.depthAttachment.set(this._sharedDepthStencil),d.clear({stencil:0})):mt.depthAttachment.set(this._sharedDepthStencil),d.extTextureFilterAnisotropic&&_e.texParameterf(_e.TEXTURE_2D,d.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,d.extTextureFilterAnisotropicMax),{fb:mt,tex:ut,emissiveTex:xt,dirty:!1}}_updateFBOs(d){if(this._emissiveTexture!==d){for(const _e of this.pool)this._updateFBO(_e,d);for(const _e of this.proxySourceCache.renderCache)this._updateFBO(_e,d);this._emissiveTexture=d}}_updateFBO(d,_e){const ot=d.fb,ut=this.painter.context,mt=ut.gl,xt=this.drapeBufferSize;if(_e){const Tt=new c.T(ut,{width:xt[0],height:xt[1],data:null},mt.R8);Tt.bind(mt.LINEAR,mt.CLAMP_TO_EDGE),d.emissiveTex=Tt,ot.createColorAttachment(ut,1),ot.colorAttachment1.set(Tt.texture)}else d.emissiveTex=void 0,ot.removeColorAttachment(ut,1);d.dirty=!0}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const d in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[d].hasTransition())return!0;return this._style.order.some(d=>{const _e=this._style._mergedLayers[d],ot=_e.isHidden(this.painter.transform.zoom);return _e.type==="hillshade"||_e.type==="custom"?!ot&&_e.shouldRedrape():!ot&&_e.hasTransition()})}_clearLineLayersFromRenderCache(){let d=!1;for(const ot of this._style.getSources())if(ot instanceof Xp){d=!0;break}if(!d)return;const _e={};for(let ot=0;ot<this._style.order.length;++ot){const ut=this._style._mergedLayers[this._style.order[ot]],mt=this._style.getLayerSourceCache(ut);if(!mt||_e[mt.id]||ut.isHidden(this.painter.transform.zoom)||ut.type!=="line")continue;const xt=ut.widthExpression(),Tt=ut.emissiveStrengthExpression();if(xt instanceof c.ad||Tt instanceof c.ad){_e[mt.id]=!0;for(const kt of this.proxyCoords){const $t=this.proxyToSource[kt.key][mt.id];if($t)for(const Xt of $t)this._clearRenderCacheForTile(mt.id,Xt)}}}}_clearRasterLayersFromRenderCache(){let d=!1;for(const ot in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[ot]._source instanceof Il){d=!0;break}if(!d)return;const _e={};for(let ot=0;ot<this._style.order.length;++ot){const ut=this._style._mergedLayers[this._style.order[ot]],mt=this._style.getLayerSourceCache(ut);if(!mt||_e[mt.id]||ut.isHidden(this.painter.transform.zoom)||ut.type!=="raster")continue;const xt=ut.paint.get("raster-fade-duration");for(const Tt of this.proxyCoords){const kt=this.proxyToSource[Tt.key][mt.id];if(kt)for(const $t of kt){const Xt=y1(mt.getTile($t),mt.findLoadedParent($t,0),mt,this.painter.transform,xt);(Xt.opacity!==1||Xt.mix!==0)&&this._clearRenderCacheForTile(mt.id,$t)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const d=this._style.order,_e=d.length;if(_e===0)return;const ot=[];this._pendingGroundEffectLayers=[];let ut,mt=0,xt=this._style._mergedLayers[d[mt]];for(;!this._style.isLayerDraped(xt)&&xt.isHidden(this.painter.transform.zoom)&&++mt<_e;)xt=this._style._mergedLayers[d[mt]];for(;mt<_e;++mt){const Tt=this._style._mergedLayers[d[mt]];Tt.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(Tt)?ut===void 0&&(ut=mt):(Tt.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(mt),ut!==void 0&&(ot.push({start:ut,end:mt-1}),ut=void 0)))}if(ut!==void 0&&ot.push({start:ut,end:mt-1}),ot.length!==0){const Tt=ot[ot.length-1];this._pendingGroundEffectLayers.every(kt=>kt>Tt.end)||c.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=ot}_setupRenderCache(d){const _e=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,_e.renderCache.length>_e.renderCachePool.length){const xt=Object.values(_e.proxyCachedFBO);_e.proxyCachedFBO={};for(let Tt=0;Tt<xt.length;++Tt){const kt=Object.values(xt[Tt]);_e.renderCachePool.push(...kt)}}return}this._clearRasterLayersFromRenderCache();const ot=this.proxyCoords,ut=this._tilesDirty;for(let xt=ot.length-1;xt>=0;xt--){const Tt=ot[xt];if(_e.getTileByID(Tt.key),_e.proxyCachedFBO[Tt.key]!==void 0){const kt=d[Tt.key],$t=this.proxyToSource[Tt.key];let Xt=0;for(const rr in $t){const tr=$t[rr],nr=kt[rr];if(!nr||nr.length!==tr.length||tr.some((cr,lr)=>cr!==nr[lr]||ut[rr]&&ut[rr].hasOwnProperty(cr.key))){Xt=-1;break}++Xt}for(const rr in _e.proxyCachedFBO[Tt.key])_e.renderCache[_e.proxyCachedFBO[Tt.key][rr]].dirty=Xt<0||Xt!==Object.values(kt).length}}const mt=[...this._drapedRenderBatches];mt.sort((xt,Tt)=>Tt.end-Tt.start-(xt.end-xt.start));for(const xt of mt)for(const Tt of ot){if(_e.proxyCachedFBO[Tt.key])continue;let kt=_e.renderCachePool.pop();kt===void 0&&_e.renderCache.length<50&&(kt=_e.renderCache.length,_e.renderCache.push(this._createFBO())),kt!==void 0&&(_e.proxyCachedFBO[Tt.key]={},_e.proxyCachedFBO[Tt.key][xt.start]=kt,_e.renderCache[kt].dirty=!0)}this._tilesDirty={}}_setupStencil(d,_e,ot,ut){if(!ut||!this._sourceTilesOverlap[ut.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const mt=this.painter.context,xt=mt.gl;if(_e.length<=1)return void(this._overlapStencilType=!1);let Tt;if(ot.isTileClipped())Tt=_e.length,this._overlapStencilMode.test={func:xt.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(_e[0].overscaledZ>_e[_e.length-1].overscaledZ))return void(this._overlapStencilType=!1);Tt=1,this._overlapStencilMode.test={func:xt.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+Tt>255&&(mt.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=Tt,this._overlapStencilMode.ref=this._stencilRef,ot.isTileClipped()&&this._renderTileClippingMasks(_e,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(d){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[d.key]),this._overlapStencilMode):oo.disabled}_renderTileClippingMasks(d,_e){const ot=this.painter,ut=this.painter.context,mt=ut.gl;ot._tileClippingMaskIDs={},ut.setColorMode(co.disabled),ut.setDepthMode(Us.disabled);const xt=ot.getOrCreateProgram("clippingMask");for(const Tt of d){const kt=ot._tileClippingMaskIDs[Tt.key]=--_e;xt.draw(ot,mt.TRIANGLES,Us.disabled,new oo({func:mt.ALWAYS,mask:0},kt,255,mt.KEEP,mt.KEEP,mt.REPLACE),co.disabled,wr.disabled,g1(Tt.projMatrix),"$clipping",ot.tileExtentBuffer,ot.quadTriangleIndexBuffer,ot.tileExtentSegments)}}pointCoordinate(d){const _e=this.painter.transform;if(d.x<0||d.x>_e.width||d.y<0||d.y>_e.height)return null;const ot=[d.x,d.y,1,1];c.aC(ot,ot,_e.pixelMatrixInverse),c.cK(ot,ot,1/ot[3]),ot[0]/=_e.worldSize,ot[1]/=_e.worldSize;const ut=_e._camera.position,mt=c.cf(1,_e.center.lat),xt=[ut[0],ut[1],ut[2]/mt,0],Tt=c.da([],ot.slice(0,3),xt);c.aw(Tt,Tt);const kt=this.raycast(xt,Tt,this._exaggeration);return kt!==null&&kt?(c.bH(xt,xt,Tt,kt),xt[3]=xt[2],xt[2]*=mt,xt):null}_setupProxiedCoordsForOrtho(d,_e,ot){if(d.getSource()instanceof c.aU)return this._setupProxiedCoordsForImageSource(d,_e,ot);this._findCoveringTileCache[d.id]=this._findCoveringTileCache[d.id]||{};const ut=this.proxiedCoords[d.id]=[],mt=this.proxyCoords;for(let kt=0;kt<mt.length;kt++){const $t=mt[kt],Xt=this._findTileCoveringTileID($t,d);if(Xt){const rr=this._createProxiedId($t,Xt,ot[$t.key]&&ot[$t.key][d.id]);ut.push(rr),this.proxyToSource[$t.key][d.id]=[rr]}}let xt=!1;const Tt=new Set;for(let kt=0;kt<_e.length;kt++){const $t=d.getTile(_e[kt]);if(!$t||!$t.hasData())continue;const Xt=this._findTileCoveringTileID($t.tileID,this.proxySourceCache);if(Xt&&Xt.tileID.canonical.z!==$t.tileID.canonical.z){const rr=this.proxyToSource[Xt.tileID.key][d.id],tr=this._createProxiedId(Xt.tileID,$t,ot[Xt.tileID.key]&&ot[Xt.tileID.key][d.id]);rr?rr.splice(rr.length-1,0,tr):this.proxyToSource[Xt.tileID.key][d.id]=[tr];const nr=this.proxyToSource[Xt.tileID.key][d.id];Tt.has(nr)||Tt.add(nr),ut.push(tr),xt=!0}}if(this._sourceTilesOverlap[d.id]=xt,xt&&this._debugParams.sortTilesHiZFirst)for(const kt of Tt)kt.sort(($t,Xt)=>Xt.overscaledZ-$t.overscaledZ)}_setupProxiedCoordsForImageSource(d,_e,ot){if(!d.getSource().loaded())return;const ut=this.proxiedCoords[d.id]=[],mt=this.proxyCoords,xt=d.getSource(),Tt=xt.tileID;if(!Tt)return;const kt=new c.P(Tt.x,Tt.y)._div(1<<Tt.z),$t=xt.coordinates.map(c.ae.fromLngLat).reduce((rr,tr)=>(rr.min.x=Math.min(rr.min.x,tr.x-kt.x),rr.min.y=Math.min(rr.min.y,tr.y-kt.y),rr.max.x=Math.max(rr.max.x,tr.x-kt.x),rr.max.y=Math.max(rr.max.y,tr.y-kt.y),rr),{min:new c.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new c.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),Xt=(rr,tr)=>{const nr=rr.wrap+rr.canonical.x/(1<<rr.canonical.z),cr=rr.canonical.y/(1<<rr.canonical.z),lr=c.al/(1<<rr.canonical.z),yr=tr.wrap+tr.canonical.x/(1<<tr.canonical.z),xr=tr.canonical.y/(1<<tr.canonical.z);return nr+lr<yr+$t.min.x||nr>yr+$t.max.x||cr+lr<xr+$t.min.y||cr>xr+$t.max.y};for(let rr=0;rr<mt.length;rr++){const tr=mt[rr];for(let nr=0;nr<_e.length;nr++){const cr=d.getTile(_e[nr]);if(!cr||!cr.hasData()||Xt(tr,cr.tileID))continue;const lr=this._createProxiedId(tr,cr,ot[tr.key]&&ot[tr.key][d.id]),yr=this.proxyToSource[tr.key][d.id];yr?yr.push(lr):this.proxyToSource[tr.key][d.id]=[lr],ut.push(lr)}}}_createProxiedId(d,_e,ot){let ut=this.orthoMatrix;if(ot){const mt=ot.find(xt=>xt.key===_e.tileID.key);if(mt)return mt}if(_e.tileID.key!==d.key){const mt=d.canonical.z-_e.tileID.canonical.z;let xt,Tt,kt;ut=c.bC();const $t=_e.tileID.wrap-d.wrap<<d.overscaledZ;mt>0?(xt=c.al>>mt,Tt=xt*((_e.tileID.canonical.x<<mt)-d.canonical.x+$t),kt=xt*((_e.tileID.canonical.y<<mt)-d.canonical.y)):(xt=c.al<<-mt,Tt=c.al*(_e.tileID.canonical.x-(d.canonical.x+$t<<-mt)),kt=c.al*(_e.tileID.canonical.y-(d.canonical.y<<-mt))),c.ce(ut,0,xt,0,xt,0,1),c.br(ut,ut,[Tt,kt,0])}return new q_(_e.tileID,d.key,ut)}_findTileCoveringTileID(d,_e){let ot=_e.getTile(d);if(ot&&ot.hasData())return ot;const ut=this._findCoveringTileCache[_e.id],mt=ut[d.key];if(ot=mt?_e.getTileByID(mt):null,ot&&ot.hasData()||mt===null)return ot;let xt=ot?ot.tileID:d,Tt=xt.overscaledZ;const kt=_e.getSource().minzoom,$t=[];if(!mt){const rr=_e.getSource().maxzoom;if(d.canonical.z>=rr){const tr=d.canonical.z-rr;_e.getSource().reparseOverscaled?(Tt=Math.max(d.canonical.z+2,_e.transform.tileZoom),xt=new c.aQ(Tt,d.wrap,rr,d.canonical.x>>tr,d.canonical.y>>tr)):tr!==0&&(Tt=rr,xt=new c.aQ(Tt,d.wrap,rr,d.canonical.x>>tr,d.canonical.y>>tr))}xt.key!==d.key&&($t.push(xt.key),ot=_e.getTile(xt))}const Xt=rr=>{$t.forEach(tr=>{ut[tr]=rr}),$t.length=0};for(Tt-=1;Tt>=kt&&(!ot||!ot.hasData());Tt--){ot&&Xt(ot.tileID.key);const rr=xt.calculateScaledKey(Tt);if(ot=_e.getTileByID(rr),ot&&ot.hasData())break;const tr=ut[rr];if(tr===null)break;tr===void 0?$t.push(rr):ot=_e.getTileByID(tr)}return Xt(ot?ot.tileID.key:null),ot&&ot.hasData()?ot:null}findDEMTileFor(d){return this.enabled?this._findTileCoveringTileID(d,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(d,_e){let ot=this._tilesDirty[d];ot||(ot=this._tilesDirty[d]={}),ot[_e.key]=!0}}function Lx(st,d,_e){const ot=function(Tt,kt,$t){const Xt=c.bJ(kt,Tt),rr=c.bJ($t,[.2126,.7152,.0722]),tr=(cr,lr,yr)=>(1-yr)*cr+yr*lr,nr=tr(1-.3*Math.min(rr,1),1,Math.min(Xt+1,1));return tr(.92,1,Math.asin(c.aA(kt[2],-1,1))/Math.PI+.5)*nr}(st,[0,0,1],d),ut=[0,0,0];c.c5(ut,_e.slice(0,3),ot);const mt=[0,0,0];c.c5(mt,d.slice(0,3),st[2]);const xt=[0,0,0];return c.d8(xt,ut,mt),c.db(xt)}const d2=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],h2=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","building","buildingBloom","elevatedStructures","model","symbol"];class TE{static cacheKey(d,_e,ot,ut){const mt=[_e];ut&&mt.push(ut.cacheKey);for(const xt of ot)d.usedDefines.has(xt)&&mt.push(xt);return mt.join("/")}constructor(d,_e,ot,ut,mt,xt){const Tt=d.gl;this.program=Tt.createProgram(),this.configuration=ut,this.name=_e,this.fixedDefines=[...xt];const kt=`#version 300 es
${(ut?ut.defines():[]).concat(xt.map(lr=>`#define ${lr}`)).join(`
`)}`,$t=[kt,r2];for(const lr of ot.fragmentIncludes)$t.push(Fm[lr]);$t.push(ot.fragmentSource);const Xt=$t.join(`
`),rr=[kt,gE];for(const lr of ot.vertexIncludes)rr.push(Fm[lr]);this.forceManualRenderingForInstanceIDShaders=d.forceManualRenderingForInstanceIDShaders&&ot.vertexSource.includes("gl_InstanceID"),this.forceManualRenderingForInstanceIDShaders&&rr.push("uniform int u_instanceID;"),rr.push(ot.vertexSource);let tr=rr.join(`
`);this.forceManualRenderingForInstanceIDShaders&&(tr=tr.replaceAll("gl_InstanceID","u_instanceID"));const nr=Tt.createShader(Tt.FRAGMENT_SHADER);if(Tt.isContextLost())return void(this.failedToCreate=!0);Tt.shaderSource(nr,Xt),Tt.compileShader(nr),Tt.attachShader(this.program,nr);const cr=Tt.createShader(Tt.VERTEX_SHADER);Tt.isContextLost()?this.failedToCreate=!0:(Tt.shaderSource(cr,tr),Tt.compileShader(cr),Tt.attachShader(this.program,cr),this.attributes={},Tt.linkProgram(this.program),Tt.deleteShader(cr),Tt.deleteShader(nr),this.fixedUniforms=mt(d),this.fixedUniformsEntries=Object.entries(this.fixedUniforms),this.binderUniforms=ut?ut.getUniforms(d):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(lr=>({u_instanceID:new c.ch(lr)}))(d)),(xt.includes("TERRAIN")||_e.includes("symbol")||_e.includes("circle"))&&(this.terrainUniforms=(lr=>({u_dem:new c.ch(lr),u_dem_prev:new c.ch(lr),u_dem_tl:new c.ck(lr),u_dem_scale:new c.cj(lr),u_dem_tl_prev:new c.ck(lr),u_dem_scale_prev:new c.cj(lr),u_dem_size:new c.cj(lr),u_dem_lerp:new c.cj(lr),u_exaggeration:new c.cj(lr),u_depth:new c.ch(lr),u_depth_size_inv:new c.ck(lr),u_depth_range_unpack:new c.ck(lr),u_occluder_half_size:new c.cj(lr),u_occlusion_depth_offset:new c.cj(lr),u_meter_to_dem:new c.cj(lr),u_label_plane_matrix_inv:new c.cl(lr)}))(d)),xt.includes("GLOBE")&&(this.globeUniforms=(lr=>({u_tile_tl_up:new c.ci(lr),u_tile_tr_up:new c.ci(lr),u_tile_br_up:new c.ci(lr),u_tile_bl_up:new c.ci(lr),u_tile_up_scale:new c.cj(lr)}))(d)),xt.includes("FOG")&&(this.fogUniforms=(lr=>({u_fog_matrix:new c.cl(lr),u_fog_range:new c.ck(lr),u_fog_color:new c.d3(lr),u_fog_horizon_blend:new c.cj(lr),u_fog_vertical_limit:new c.ck(lr),u_fog_temporal_offset:new c.cj(lr),u_frustum_tl:new c.ci(lr),u_frustum_tr:new c.ci(lr),u_frustum_br:new c.ci(lr),u_frustum_bl:new c.ci(lr),u_globe_pos:new c.ci(lr),u_globe_radius:new c.cj(lr),u_globe_transition:new c.cj(lr),u_is_globe:new c.ch(lr),u_viewport:new c.ck(lr)}))(d)),xt.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(lr=>({u_cutoff_params:new c.d3(lr)}))(d)),xt.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(lr=>({u_lighting_ambient_color:new c.ci(lr),u_lighting_directional_dir:new c.ci(lr),u_lighting_directional_color:new c.ci(lr),u_ground_radiance:new c.ci(lr)}))(d)),xt.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(lr=>({u_light_matrix_0:new c.cl(lr),u_light_matrix_1:new c.cl(lr),u_fade_range:new c.ck(lr),u_shadow_normal_offset:new c.ci(lr),u_shadow_intensity:new c.cj(lr),u_shadow_texel_size:new c.cj(lr),u_shadow_map_resolution:new c.cj(lr),u_shadow_direction:new c.ci(lr),u_shadow_bias:new c.ci(lr),u_shadowmap_0:new c.ch(lr),u_shadowmap_1:new c.ch(lr)}))(d)))}getAttributeLocation(d,_e){let ot=this.attributes[_e];return ot===void 0&&(ot=this.attributes[_e]=d.getAttribLocation(this.program,_e)),ot}setTerrainUniformValues(d,_e){if(!this.terrainUniforms)return;const ot=this.terrainUniforms;if(!this.failedToCreate){d.program.set(this.program);for(const ut in _e)ot[ut]&&ot[ut].set(this.program,ut,_e[ut])}}setGlobeUniformValues(d,_e){if(!this.globeUniforms)return;const ot=this.globeUniforms;if(!this.failedToCreate){d.program.set(this.program);for(const ut in _e)ot[ut]&&ot[ut].set(this.program,ut,_e[ut])}}setFogUniformValues(d,_e){if(!this.fogUniforms)return;const ot=this.fogUniforms;if(!this.failedToCreate){d.program.set(this.program);for(const ut in _e)ot[ut].set(this.program,ut,_e[ut])}}setCutoffUniformValues(d,_e){if(!this.cutoffUniforms)return;const ot=this.cutoffUniforms;if(!this.failedToCreate){d.program.set(this.program);for(const ut in _e)ot[ut].set(this.program,ut,_e[ut])}}setLightsUniformValues(d,_e){if(!this.lightsUniforms)return;const ot=this.lightsUniforms;if(!this.failedToCreate){d.program.set(this.program);for(const ut in _e)ot[ut].set(this.program,ut,_e[ut])}}setShadowUniformValues(d,_e){if(this.failedToCreate||!this.shadowUniforms)return;const ot=this.shadowUniforms;d.program.set(this.program);for(const ut in _e)ot[ut].set(this.program,ut,_e[ut])}_drawDebugWireframe(d,_e,ot,ut,mt,xt,Tt,kt,$t,Xt){const rr=d.options.wireframe;if(rr.terrain===!1&&rr.layers2D===!1&&rr.layers3D===!1)return;const tr=d.context;if(!(!(!rr.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!rr.layers2D||d._terrain&&d._terrain.renderingToTexture||!d2.includes(this.name))||!(!rr.layers3D||!h2.includes(this.name))))return;const nr=tr.gl,cr=d.wireframeDebugCache.getLinesFromTrianglesBuffer(d.frameCounter,mt,tr);if(!cr)return;const lr=[...this.fixedDefines,"DEBUG_WIREFRAME"],yr=d.getOrCreateProgram(this.name,{config:this.configuration,defines:lr});tr.program.set(yr.program);const xr=(Tr,Wr,zr)=>{if(Wr[Tr]&&zr[Tr])for(const $r in Wr[Tr])zr[Tr][$r]&&zr[Tr][$r].set(zr.program,$r,Wr[Tr][$r].current)};$t&&$t.setUniforms(yr.program,tr,yr.binderUniforms,Tt,{zoom:kt}),xr("fixedUniforms",this,yr),xr("terrainUniforms",this,yr),xr("globeUniforms",this,yr),xr("fogUniforms",this,yr),xr("lightsUniforms",this,yr),xr("shadowUniforms",this,yr),cr.bind(),tr.setColorMode(new co([nr.ONE,nr.ONE_MINUS_SRC_ALPHA,nr.ZERO,nr.ONE],c.ao.transparent,[!0,!0,!0,!1])),tr.setDepthMode(new Us(_e.func===nr.LESS?nr.LEQUAL:_e.func,Us.ReadOnly,_e.range)),tr.setStencilMode(oo.disabled);const Ar=3*xt.primitiveLength*2,Dr=3*xt.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const Tr=Xt||1;for(let Wr=0;Wr<Tr;++Wr)yr.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Wr),nr.drawElements(nr.LINES,Ar,nr.UNSIGNED_SHORT,Dr)}else Xt&&Xt>1?nr.drawElementsInstanced(nr.LINES,Ar,nr.UNSIGNED_SHORT,Dr,Xt):nr.drawElements(nr.LINES,Ar,nr.UNSIGNED_SHORT,Dr);mt.bind(),tr.program.set(this.program),tr.setDepthMode(_e),tr.setStencilMode(ot),tr.setColorMode(ut)}checkUniforms(d,_e,ot){if(this.fixedDefines.includes(_e)){for(const ut of Object.keys(ot))if(!ot[ut].initialized)throw new Error(`Program '${this.name}', from draw '${d}': uniform ${ut} not set but required by ${_e} being defined`)}}draw(d,_e,ot,ut,mt,xt,Tt,kt,$t,Xt,rr,tr,nr,cr,lr,yr){const xr=d.context,Ar=xr.gl;if(this.failedToCreate)return;xr.program.set(this.program),xr.setDepthMode(ot),xr.setStencilMode(ut),xr.setColorMode(mt),xr.setCullFace(xt);for(const[Or,Br]of this.fixedUniformsEntries)Br.set(this.program,Or,Tt[Or]);cr&&cr.setUniforms(this.program,xr,this.binderUniforms,tr,{zoom:nr});const Dr={[Ar.POINTS]:1,[Ar.LINES]:2,[Ar.TRIANGLES]:3,[Ar.LINE_STRIP]:1}[_e];this.checkUniforms(kt,"RENDER_SHADOWS",this.shadowUniforms);const Tr=lr||[],Wr=cr?cr.getPaintVertexBuffers():[],zr=_e===Ar.TRIANGLES&&Xt,$r=yr&&yr>0?1:void 0;for(const Or of rr.get()){const Br=Or.vaos||(Or.vaos={});if((Br[kt]||(Br[kt]=new n2)).bind(xr,this,$t,Wr,Xt,Or.vertexOffset,Tr,$r),this.forceManualRenderingForInstanceIDShaders){const Xr=yr||1;for(let an=0;an<Xr;++an)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",an),Xt?Ar.drawElements(_e,Or.primitiveLength*Dr,Ar.UNSIGNED_SHORT,Or.primitiveOffset*Dr*2):Ar.drawArrays(_e,Or.vertexOffset,Or.vertexLength)}else yr&&yr>1?Ar.drawElementsInstanced(_e,Or.primitiveLength*Dr,Ar.UNSIGNED_SHORT,Or.primitiveOffset*Dr*2,yr):Xt?Ar.drawElements(_e,Or.primitiveLength*Dr,Ar.UNSIGNED_SHORT,Or.primitiveOffset*Dr*2):Ar.drawArrays(_e,Or.vertexOffset,Or.vertexLength);zr&&this._drawDebugWireframe(d,ot,ut,mt,Xt,Or,tr,nr,cr,yr)}}}function RE(st,d,_e=0){const ot=Math.pow(2,d.tileID.overscaledZ),ut=d.tileSize*Math.pow(2,st.transform.tileZoom)/ot,mt=ut*(d.tileID.canonical.x+d.tileID.wrap*ot),xt=ut*d.tileID.canonical.y;return{u_image:0,u_texsize:d.imageAtlasTexture?d.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/c.ay(d,1,st.transform.tileZoom),u_pixel_coord_upper:[mt>>16,xt>>16],u_pixel_coord_lower:[65535&mt,65535&xt],u_pattern_transition:_e}}const yy={terrain:0,flat:1},f2=c.bC(),_y=(st,d,_e,ot,ut,mt,xt,Tt,kt,$t,Xt,rr,tr,nr,cr,lr,yr,xr)=>{const Ar=d.style.light,Dr=Ar.properties.get("position"),Tr=[Dr.x,Dr.y,Dr.z],Wr=c.dO();Ar.properties.get("anchor")==="viewport"&&(c.dP(Wr,-d.transform.angle),c.dQ(Tr,Tr,Wr));const zr=Ar.properties.get("color").toPremultipliedRenderColor(null),$r=d.transform,Or={u_matrix:st,u_lightpos:Tr,u_lightintensity:Ar.properties.get("intensity"),u_lightcolor:[zr.r,zr.g,zr.b],u_vertical_gradient:+_e,u_opacity:ot,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:f2,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:yy[$t],u_base_type:yy[Xt],u_ao:ut,u_edge_radius:mt,u_width_scale:xt,u_flood_light_color:cr,u_vertical_scale:lr,u_flood_light_intensity:yr,u_ground_shadow_factor:xr};return $r.projection.name==="globe"&&(Or.u_tile_id=[Tt.canonical.x,Tt.canonical.y,1<<Tt.canonical.z],Or.u_zoom_transition=rr,Or.u_inv_rot_matrix=nr,Or.u_merc_center=tr,Or.u_up_dir=$r.projection.upVector(new c.cD(0,0,0),tr[0]*c.al,tr[1]*c.al),Or.u_height_lift=kt),Or},K_=(st,d,_e,ot,ut,mt)=>({u_matrix:st,u_edge_radius:d,u_width_scale:_e,u_vertical_scale:ot,u_height_type:yy[ut],u_base_type:yy[mt]}),IE=(st,d,_e,ot,ut,mt,xt,Tt,kt,$t,Xt,rr,tr,nr,cr,lr,yr,xr)=>{const Ar=_y(st,d,_e,ot,ut,mt,xt,Tt,$t,Xt,rr,tr,nr,cr,lr,yr,1,[0,0,0]),Dr={u_height_factor:-Math.pow(2,Tt.overscaledZ)/kt.tileSize/8};return Object.assign(Ar,RE(d,kt,xr),Dr)},jx=(st,d,_e,ot,ut,mt,xt,Tt,kt,$t,Xt)=>({u_matrix:d,u_opacity:_e,u_ao_pass:ot?1:0,u_meter_to_tile:ut,u_ao:mt,u_flood_light_intensity:xt,u_flood_light_color:Tt,u_attenuation:kt,u_edge_radius:$t,u_fb:0,u_fb_size:Xt,u_dynamic_offset:1}),Z_=(st,d,_e)=>({u_matrix:st,u_emissive_strength:d,u_ground_shadow_factor:_e}),Y_=(st,d,_e,ot,ut,mt=0)=>Object.assign(Z_(st,d,ut),RE(_e,ot,mt)),DE=(st,d,_e,ot)=>({u_matrix:st,u_world:_e,u_emissive_strength:d,u_ground_shadow_factor:ot}),Q_=(st,d,_e,ot,ut,mt,xt=0)=>Object.assign(Y_(st,d,_e,ot,mt,xt),{u_world:ut}),Mm=(st,d)=>({u_matrix:st,u_ground_shadow_factor:d}),nx=(st,d,_e,ot,ut)=>({u_matrix:st,u_camera_pos:[d[0],d[1],d[2]],u_depth_bias:_e,u_height_scale:ot,u_reset_depth:ut}),vy=(st,d,_e,ot,ut,mt,xt,Tt,kt)=>({u_matrix:st,u_normal_matrix:d,u_opacity:_e,u_faux_facade_ao_intensity:ot,u_camera_pos:ut,u_tile_to_meter:mt,u_facade_emissive_chance:xt,u_flood_light_color:Tt,u_flood_light_intensity:kt}),PE=st=>({u_matrix:st}),Nm=st=>({u_matrix:st}),J_=(st,d,_e,ot,ut,mt,xt,Tt)=>{const kt=c.al/mt.tileSize;return{u_matrix:st,u_inv_rot_matrix:d,u_camera_to_center_distance:_e.getCameraToCenterDistance(Tt),u_extrude_scale:[_e.pixelsToGLUnits[0]/kt,_e.pixelsToGLUnits[1]/kt],u_zoom_transition:ot,u_tile_id:xt,u_merc_center:ut}},_1=(st,d,_e=1)=>({u_matrix:st,u_color:d,u_overlay:0,u_overlay_scale:_e}),kE=c.bC(),FE=(st,d,_e,ot,ut,mt,xt)=>{const Tt=st.transform,kt=Tt.projection.name==="globe",$t=kt?c.dR(Tt.zoom,d.canonical)*Tt._pixelsPerMercatorPixel:c.ay(_e,1,mt),Xt={u_matrix:d.projMatrix,u_extrude_scale:$t,u_intensity:xt,u_inv_rot_matrix:kE,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(kt){Xt.u_inv_rot_matrix=ot,Xt.u_merc_center=ut,Xt.u_tile_id=[d.canonical.x,d.canonical.y,1<<d.canonical.z],Xt.u_zoom_transition=c.aj(Tt.zoom);const rr=ut[0]*c.al,tr=ut[1]*c.al;Xt.u_up_dir=Tt.projection.upVector(new c.cD(0,0,0),rr,tr)}return Xt};function Ey(st,[d,_e,ot,ut],[mt,xt]){if(mt===xt)return[0,0,0,0];const Tt=255*(st-1)/(st*(xt-mt));return[d*Tt,_e*Tt,ot*Tt,ut*Tt]}function by(st,d,[_e,ot]){return _e===ot?0:.5/st+(d-_e)*(st-1)/(st*(ot-_e))}const BE=(st,d,_e,ot,ut,mt,xt,Tt,kt,$t,Xt,rr,tr,nr,cr,lr,yr,xr,Ar,Dr,Tr)=>({u_matrix:st,u_normalize_matrix:d,u_globe_matrix:_e,u_merc_matrix:ot,u_grid_matrix:ut,u_tl_parent:mt,u_scale_parent:$t,u_fade_t:Xt.mix,u_opacity:Xt.opacity*rr.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:rr.paint.get("raster-brightness-min"),u_brightness_high:rr.paint.get("raster-brightness-max"),u_saturation_factor:c.dT(rr.paint.get("raster-saturation")),u_contrast_factor:c.dS(rr.paint.get("raster-contrast")),u_spin_weights:ME(rr.paint.get("raster-hue-rotate")),u_perspective_transform:tr,u_raster_elevation:nr,u_zoom_transition:xt,u_merc_center:Tt,u_cutoff_params:kt,u_colorization_mix:Ey(c.dU,lr,xr),u_colorization_offset:by(c.dU,yr,xr),u_color_ramp:cr,u_texture_offset:[Dr/(Ar+2*Dr),Ar/(Ar+2*Dr)],u_texture_res:[Ar+2*Dr,Ar+2*Dr],u_emissive_strength:Tr});function ME(st){st*=Math.PI/180;const d=Math.sin(st),_e=Math.cos(st);return[(2*_e+1)/3,(-Math.sqrt(3)*d-_e+1)/3,(Math.sqrt(3)*d-_e+1)/3]}const $0=.05,p2=(st,d,_e,ot,ut,mt,xt,Tt,kt,$t,Xt,rr)=>({u_matrix:st,u_normalize_matrix:d,u_globe_matrix:_e,u_merc_matrix:ot,u_grid_matrix:ut,u_tl_parent:mt,u_scale_parent:$t,u_fade_t:Xt.mix,u_opacity:Xt.opacity,u_image0:0,u_image1:1,u_raster_elevation:rr,u_zoom_transition:xt,u_merc_center:Tt,u_cutoff_params:kt}),m2=(st,d,_e,ot,ut,mt,xt,Tt,kt,$t)=>({u_particle_texture:st,u_particle_texture_side_len:d,u_tile_offset:_e,u_velocity:ot,u_color_ramp:mt,u_velocity_res:ut,u_max_speed:xt,u_uv_offset:Tt,u_data_scale:[255*kt[0],255*kt[1]],u_data_offset:$t,u_particle_pos_scale:1.1,u_particle_pos_offset:[$0,$0]}),NE=(st,d,_e,ot,ut,mt,xt,Tt,kt,$t)=>({u_particle_texture:st,u_particle_texture_side_len:d,u_velocity:_e,u_velocity_res:ot,u_max_speed:ut,u_speed_factor:mt,u_reset_rate:xt,u_rand_seed:Math.random(),u_uv_offset:Tt,u_data_scale:[255*kt[0],255*kt[1]],u_data_offset:$t,u_particle_pos_scale:1.1,u_particle_pos_offset:[$0,$0]}),OE=c.bC(),wy=(st,d,_e,ot,ut,mt,xt,Tt,kt,$t,Xt,rr,tr,nr,cr,lr,yr,xr,Ar,Dr,Tr,Wr,zr,$r)=>{const Or=ut.transform,Br={u_is_size_zoom_constant:+(st==="constant"||st==="source"),u_is_size_feature_constant:+(st==="constant"||st==="camera"),u_size_t:d?d.uSizeT:0,u_size:d?d.uSize:0,u_camera_to_center_distance:Or.getCameraToCenterDistance(Ar),u_rotate_symbol:+_e,u_aspect_ratio:Or.width/Or.height,u_fade_change:ut.options.fadeDuration?ut.symbolFadeChange:1,u_matrix:mt,u_label_plane_matrix:xt,u_coord_matrix:Tt,u_is_text:+$t,u_elevation_from_sea:kt?1:0,u_pitch_with_map:+ot,u_texsize:Xt,u_texsize_icon:rr,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:OE,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:OE,u_up_vector:[0,-1,0],u_color_adj_mat:Wr,u_icon_transition:zr||0,u_gamma_scale:ot?ut.transform.getCameraToCenterDistance(Ar)*Math.cos(ut.terrain?0:ut.transform._pitch):1,u_device_pixel_ratio:c.o.devicePixelRatio,u_is_halo:1,u_scale_factor:$r||1,u_ground_shadow_factor:Dr,u_inv_matrix:c.bl(c.bC(),xt),u_normal_scale:Tr,u_lutTexture:Dt.LUT};return Ar.name==="globe"&&(Br.u_tile_id=[nr.canonical.x,nr.canonical.y,1<<nr.canonical.z],Br.u_zoom_transition=cr,Br.u_inv_rot_matrix=yr,Br.u_merc_center=lr,Br.u_camera_forward=Or._camera.forward(),Br.u_ecef_origin=c.dV(Or.globeMatrix,nr.toUnwrapped()),Br.u_tile_matrix=Float32Array.from(Or.globeMatrix),Br.u_up_vector=xr),Br},v1=(st,d,_e,ot)=>({u_matrix:st,u_emissive_strength:d,u_opacity:_e,u_color:ot}),Om=(st,d,_e,ot,ut,mt,xt,Tt,kt)=>Object.assign(function($t,Xt,rr,tr,nr,cr){const{width:lr,height:yr}=tr.imageManager.getPixelSize(Xt),xr=Math.pow(2,cr.tileID.overscaledZ),Ar=cr.tileSize*Math.pow(2,tr.transform.tileZoom)/xr,Dr=Ar*(cr.tileID.canonical.x+cr.tileID.wrap*xr),Tr=Ar*cr.tileID.canonical.y;return{u_image:0,u_pattern_tl:rr.tl,u_pattern_br:rr.br,u_texsize:[lr,yr],u_pattern_size:rr.displaySize,u_pattern_units_to_pixels:nr?[tr.transform.width,-1*tr.transform.height]:[1/c.ay(cr,1,tr.transform.tileZoom),1/c.ay(cr,1,tr.transform.tileZoom)],u_pixel_coord_upper:[Dr>>16,Tr>>16],u_pixel_coord_lower:[65535&Dr,65535&Tr]}}(0,mt,xt,ot,Tt,kt),{u_matrix:st,u_emissive_strength:d,u_opacity:_e}),zx=new Float32Array(c.bA([])),ix=(st,d,_e,ot,ut,mt,xt,Tt,kt,$t,Xt,rr,tr,nr=[0,0,0],cr,lr,yr)=>{const xr=ut.style.light,Ar=xr.properties.get("position"),Dr=[-Ar.x,-Ar.y,Ar.z],Tr=c.dO();xr.properties.get("anchor")==="viewport"&&(c.dP(Tr,-ut.transform.angle),c.dQ(Dr,Dr,Tr));const Wr=Xt.alphaMode==="MASK",zr=xr.properties.get("color").toNonPremultipliedRenderColor(null),$r=tr.paint.get("model-ambient-occlusion-intensity"),Or=tr.paint.get("model-color").constantOr(c.ao.white).toNonPremultipliedRenderColor(null);return Or.a=tr.paint.get("model-color-mix-intensity").constantOr(0),yr&&(Or.r=yr[0],Or.g=yr[1],Or.b=yr[2],Or.a=yr[3]),lr&&(Or.r=lr.color.r,Or.g=lr.color.g,Or.b=lr.color.b,Or.a=lr.colorMix,rr=lr.emissionStrength,mt*=lr.opacity),{u_matrix:st,u_lighting_matrix:d,u_normal_matrix:_e,u_node_matrix:ot||zx,u_lightpos:Dr,u_lightintensity:xr.properties.get("intensity"),u_lightcolor:[zr.r,zr.g,zr.b],u_camera_pos:nr,u_opacity:mt,u_baseTextureIsAlpha:0,u_alphaMask:+Wr,u_alphaCutoff:Xt.alphaCutoff,u_baseColorFactor:xt.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:Tt.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:kt,u_roughnessFactor:$t,u_baseColorTexture:Dt.BaseColor,u_metallicRoughnessTexture:Dt.MetallicRoughness,u_normalTexture:Dt.Normal,u_occlusionTexture:Dt.Occlusion,u_emissionTexture:Dt.Emission,u_lutTexture:Dt.LUT,u_color_mix:Or.toArray01(),u_aoIntensity:$r,u_emissive_strength:rr,u_occlusionTextureTransform:cr||[0,0,0,0]}},ev=(st,d=zx,_e=zx)=>({u_matrix:st,u_instance:d,u_node_matrix:_e}),Cy={fillExtrusion:st=>({u_matrix:new c.cl(st),u_lightpos:new c.ci(st),u_lightintensity:new c.cj(st),u_lightcolor:new c.ci(st),u_vertical_gradient:new c.cj(st),u_opacity:new c.cj(st),u_edge_radius:new c.cj(st),u_width_scale:new c.cj(st),u_ao:new c.ck(st),u_height_type:new c.ch(st),u_base_type:new c.ch(st),u_tile_id:new c.ci(st),u_zoom_transition:new c.cj(st),u_inv_rot_matrix:new c.cl(st),u_merc_center:new c.ck(st),u_up_dir:new c.ci(st),u_height_lift:new c.cj(st),u_flood_light_color:new c.ci(st),u_vertical_scale:new c.cj(st),u_flood_light_intensity:new c.cj(st),u_ground_shadow_factor:new c.ci(st)}),fillExtrusionDepth:st=>({u_matrix:new c.cl(st),u_edge_radius:new c.cj(st),u_width_scale:new c.cj(st),u_vertical_scale:new c.cj(st),u_height_type:new c.ch(st),u_base_type:new c.ch(st)}),fillExtrusionPattern:st=>({u_matrix:new c.cl(st),u_lightpos:new c.ci(st),u_lightintensity:new c.cj(st),u_lightcolor:new c.ci(st),u_vertical_gradient:new c.cj(st),u_height_factor:new c.cj(st),u_edge_radius:new c.cj(st),u_width_scale:new c.cj(st),u_ao:new c.ck(st),u_height_type:new c.ch(st),u_base_type:new c.ch(st),u_tile_id:new c.ci(st),u_zoom_transition:new c.cj(st),u_inv_rot_matrix:new c.cl(st),u_merc_center:new c.ck(st),u_up_dir:new c.ci(st),u_height_lift:new c.cj(st),u_image:new c.ch(st),u_texsize:new c.ck(st),u_pixel_coord_upper:new c.ck(st),u_pixel_coord_lower:new c.ck(st),u_tile_units_to_pixels:new c.cj(st),u_opacity:new c.cj(st),u_pattern_transition:new c.cj(st)}),fillExtrusionGroundEffect:st=>({u_matrix:new c.cl(st),u_opacity:new c.cj(st),u_ao_pass:new c.cj(st),u_meter_to_tile:new c.cj(st),u_ao:new c.ck(st),u_flood_light_intensity:new c.cj(st),u_flood_light_color:new c.ci(st),u_attenuation:new c.cj(st),u_edge_radius:new c.cj(st),u_fb:new c.ch(st),u_fb_size:new c.cj(st),u_dynamic_offset:new c.cj(st)}),fill:st=>({u_matrix:new c.cl(st),u_emissive_strength:new c.cj(st),u_ground_shadow_factor:new c.ci(st)}),fillPattern:st=>({u_matrix:new c.cl(st),u_emissive_strength:new c.cj(st),u_image:new c.ch(st),u_texsize:new c.ck(st),u_pixel_coord_upper:new c.ck(st),u_pixel_coord_lower:new c.ck(st),u_tile_units_to_pixels:new c.cj(st),u_ground_shadow_factor:new c.ci(st),u_pattern_transition:new c.cj(st)}),fillOutline:st=>({u_matrix:new c.cl(st),u_emissive_strength:new c.cj(st),u_world:new c.ck(st),u_ground_shadow_factor:new c.ci(st)}),fillOutlinePattern:st=>({u_matrix:new c.cl(st),u_emissive_strength:new c.cj(st),u_world:new c.ck(st),u_image:new c.ch(st),u_texsize:new c.ck(st),u_pixel_coord_upper:new c.ck(st),u_pixel_coord_lower:new c.ck(st),u_tile_units_to_pixels:new c.cj(st),u_ground_shadow_factor:new c.ci(st),u_pattern_transition:new c.cj(st)}),building:st=>({u_matrix:new c.cl(st),u_normal_matrix:new c.cl(st),u_opacity:new c.cj(st),u_faux_facade_ao_intensity:new c.cj(st),u_camera_pos:new c.ci(st),u_tile_to_meter:new c.cj(st),u_facade_emissive_chance:new c.cj(st),u_flood_light_color:new c.ci(st),u_flood_light_intensity:new c.cj(st)}),buildingBloom:st=>({u_matrix:new c.cl(st)}),buildingDepth:st=>({u_matrix:new c.cl(st)}),elevatedStructuresDepth:st=>({u_matrix:new c.cl(st),u_depth_bias:new c.cj(st)}),elevatedStructures:st=>({u_matrix:new c.cl(st),u_ground_shadow_factor:new c.ci(st)}),elevatedStructuresDepthReconstruct:st=>({u_matrix:new c.cl(st),u_camera_pos:new c.ci(st),u_depth_bias:new c.cj(st),u_height_scale:new c.cj(st),u_reset_depth:new c.cj(st)}),circle:c.dY,collisionBox:st=>({u_matrix:new c.cl(st),u_inv_rot_matrix:new c.cl(st),u_camera_to_center_distance:new c.cj(st),u_extrude_scale:new c.ck(st),u_zoom_transition:new c.cj(st),u_merc_center:new c.ck(st),u_tile_id:new c.ci(st)}),collisionCircle:st=>({u_matrix:new c.cl(st),u_inv_matrix:new c.cl(st),u_camera_to_center_distance:new c.cj(st),u_viewport_size:new c.ck(st)}),debug:st=>({u_color:new c.dB(st),u_matrix:new c.cl(st),u_overlay:new c.ch(st),u_overlay_scale:new c.cj(st)}),clippingMask:st=>({u_matrix:new c.cl(st)}),heatmap:st=>({u_extrude_scale:new c.cj(st),u_intensity:new c.cj(st),u_matrix:new c.cl(st),u_inv_rot_matrix:new c.cl(st),u_merc_center:new c.ck(st),u_tile_id:new c.ci(st),u_zoom_transition:new c.cj(st),u_up_dir:new c.ci(st)}),heatmapTexture:st=>({u_image:new c.ch(st),u_color_ramp:new c.ch(st),u_opacity:new c.cj(st)}),hillshade:st=>({u_matrix:new c.cl(st),u_image:new c.ch(st),u_latrange:new c.ck(st),u_light:new c.ck(st),u_shadow:new c.dB(st),u_highlight:new c.dB(st),u_emissive_strength:new c.cj(st),u_accent:new c.dB(st)}),hillshadePrepare:st=>({u_matrix:new c.cl(st),u_image:new c.ch(st),u_dimension:new c.ck(st),u_zoom:new c.cj(st)}),line:c.dX,linePattern:c.dW,raster:st=>({u_matrix:new c.cl(st),u_normalize_matrix:new c.cl(st),u_globe_matrix:new c.cl(st),u_merc_matrix:new c.cl(st),u_grid_matrix:new c.dC(st),u_tl_parent:new c.ck(st),u_scale_parent:new c.cj(st),u_fade_t:new c.cj(st),u_opacity:new c.cj(st),u_image0:new c.ch(st),u_image1:new c.ch(st),u_brightness_low:new c.cj(st),u_brightness_high:new c.cj(st),u_saturation_factor:new c.cj(st),u_contrast_factor:new c.cj(st),u_spin_weights:new c.ci(st),u_perspective_transform:new c.ck(st),u_raster_elevation:new c.cj(st),u_zoom_transition:new c.cj(st),u_merc_center:new c.ck(st),u_cutoff_params:new c.d3(st),u_colorization_mix:new c.d3(st),u_colorization_offset:new c.cj(st),u_color_ramp:new c.ch(st),u_texture_offset:new c.ck(st),u_texture_res:new c.ck(st),u_emissive_strength:new c.cj(st)}),rasterParticle:st=>({u_matrix:new c.cl(st),u_normalize_matrix:new c.cl(st),u_globe_matrix:new c.cl(st),u_merc_matrix:new c.cl(st),u_grid_matrix:new c.dC(st),u_tl_parent:new c.ck(st),u_scale_parent:new c.cj(st),u_fade_t:new c.cj(st),u_opacity:new c.cj(st),u_image0:new c.ch(st),u_image1:new c.ch(st),u_raster_elevation:new c.cj(st),u_zoom_transition:new c.cj(st),u_merc_center:new c.ck(st),u_cutoff_params:new c.d3(st)}),rasterParticleTexture:st=>({u_texture:new c.ch(st),u_opacity:new c.cj(st)}),rasterParticleDraw:st=>({u_particle_texture:new c.ch(st),u_particle_texture_side_len:new c.cj(st),u_tile_offset:new c.ck(st),u_velocity:new c.ch(st),u_color_ramp:new c.ch(st),u_velocity_res:new c.ck(st),u_max_speed:new c.cj(st),u_uv_offset:new c.ck(st),u_data_scale:new c.ck(st),u_data_offset:new c.cj(st),u_particle_pos_scale:new c.cj(st),u_particle_pos_offset:new c.ck(st)}),rasterParticleUpdate:st=>({u_particle_texture:new c.ch(st),u_particle_texture_side_len:new c.cj(st),u_velocity:new c.ch(st),u_velocity_res:new c.ck(st),u_max_speed:new c.cj(st),u_speed_factor:new c.cj(st),u_reset_rate:new c.cj(st),u_rand_seed:new c.cj(st),u_uv_offset:new c.ck(st),u_data_scale:new c.ck(st),u_data_offset:new c.cj(st),u_particle_pos_scale:new c.cj(st),u_particle_pos_offset:new c.ck(st)}),symbol:st=>({u_is_size_zoom_constant:new c.ch(st),u_is_size_feature_constant:new c.ch(st),u_size_t:new c.cj(st),u_size:new c.cj(st),u_camera_to_center_distance:new c.cj(st),u_rotate_symbol:new c.ch(st),u_aspect_ratio:new c.cj(st),u_fade_change:new c.cj(st),u_matrix:new c.cl(st),u_label_plane_matrix:new c.cl(st),u_coord_matrix:new c.cl(st),u_is_text:new c.ch(st),u_elevation_from_sea:new c.ch(st),u_pitch_with_map:new c.ch(st),u_texsize:new c.ck(st),u_texsize_icon:new c.ck(st),u_texture:new c.ch(st),u_texture_icon:new c.ch(st),u_gamma_scale:new c.cj(st),u_device_pixel_ratio:new c.cj(st),u_tile_id:new c.ci(st),u_zoom_transition:new c.cj(st),u_inv_rot_matrix:new c.cl(st),u_merc_center:new c.ck(st),u_camera_forward:new c.ci(st),u_tile_matrix:new c.cl(st),u_up_vector:new c.ci(st),u_ecef_origin:new c.ci(st),u_is_halo:new c.ch(st),u_icon_transition:new c.cj(st),u_color_adj_mat:new c.cl(st),u_scale_factor:new c.cj(st),u_ground_shadow_factor:new c.ci(st),u_inv_matrix:new c.cl(st),u_normal_scale:new c.cj(st),u_lutTexture:new c.ch(st)}),background:st=>({u_matrix:new c.cl(st),u_emissive_strength:new c.cj(st),u_opacity:new c.cj(st),u_color:new c.dB(st)}),backgroundPattern:st=>({u_matrix:new c.cl(st),u_emissive_strength:new c.cj(st),u_opacity:new c.cj(st),u_image:new c.ch(st),u_pattern_tl:new c.ck(st),u_pattern_br:new c.ck(st),u_texsize:new c.ck(st),u_pattern_size:new c.ck(st),u_pixel_coord_upper:new c.ck(st),u_pixel_coord_lower:new c.ck(st),u_pattern_units_to_pixels:new c.ck(st)}),terrainRaster:st=>({u_matrix:new c.cl(st),u_image0:new c.ch(st),u_image1:new c.ch(st),u_skirt_height:new c.cj(st),u_ground_shadow_factor:new c.ci(st),u_emissive_texture_available:new c.cj(st)}),skybox:st=>({u_matrix:new c.cl(st),u_sun_direction:new c.ci(st),u_cubemap:new c.ch(st),u_opacity:new c.cj(st),u_temporal_offset:new c.cj(st)}),skyboxGradient:st=>({u_matrix:new c.cl(st),u_color_ramp:new c.ch(st),u_center_direction:new c.ci(st),u_radius:new c.cj(st),u_opacity:new c.cj(st),u_temporal_offset:new c.cj(st)}),skyboxCapture:st=>({u_matrix_3f:new c.dC(st),u_sun_direction:new c.ci(st),u_sun_intensity:new c.cj(st),u_color_tint_r:new c.d3(st),u_color_tint_m:new c.d3(st),u_luminance:new c.cj(st)}),globeRaster:st=>({u_proj_matrix:new c.cl(st),u_globe_matrix:new c.cl(st),u_normalize_matrix:new c.cl(st),u_merc_matrix:new c.cl(st),u_zoom_transition:new c.cj(st),u_merc_center:new c.ck(st),u_image0:new c.ch(st),u_image1:new c.ch(st),u_grid_matrix:new c.dC(st),u_skirt_height:new c.cj(st),u_far_z_cutoff:new c.cj(st),u_frustum_tl:new c.ci(st),u_frustum_tr:new c.ci(st),u_frustum_br:new c.ci(st),u_frustum_bl:new c.ci(st),u_globe_pos:new c.ci(st),u_globe_radius:new c.cj(st),u_viewport:new c.ck(st),u_emissive_texture_available:new c.cj(st)}),globeAtmosphere:st=>({u_frustum_tl:new c.ci(st),u_frustum_tr:new c.ci(st),u_frustum_br:new c.ci(st),u_frustum_bl:new c.ci(st),u_horizon:new c.cj(st),u_transition:new c.cj(st),u_fadeout_range:new c.cj(st),u_atmosphere_fog_color:new c.d3(st),u_high_color:new c.d3(st),u_space_color:new c.d3(st),u_temporal_offset:new c.cj(st),u_horizon_angle:new c.cj(st)}),model:st=>({u_matrix:new c.cl(st),u_lighting_matrix:new c.cl(st),u_normal_matrix:new c.cl(st),u_node_matrix:new c.cl(st),u_lightpos:new c.ci(st),u_lightintensity:new c.cj(st),u_lightcolor:new c.ci(st),u_camera_pos:new c.ci(st),u_opacity:new c.cj(st),u_baseColorFactor:new c.d3(st),u_emissiveFactor:new c.d3(st),u_metallicFactor:new c.cj(st),u_roughnessFactor:new c.cj(st),u_baseTextureIsAlpha:new c.ch(st),u_alphaMask:new c.ch(st),u_alphaCutoff:new c.cj(st),u_baseColorTexture:new c.ch(st),u_metallicRoughnessTexture:new c.ch(st),u_normalTexture:new c.ch(st),u_occlusionTexture:new c.ch(st),u_emissionTexture:new c.ch(st),u_lutTexture:new c.ch(st),u_color_mix:new c.d3(st),u_aoIntensity:new c.cj(st),u_emissive_strength:new c.cj(st),u_occlusionTextureTransform:new c.d3(st)}),modelDepth:st=>({u_matrix:new c.cl(st),u_instance:new c.cl(st),u_node_matrix:new c.cl(st)}),groundShadow:st=>({u_matrix:new c.cl(st),u_ground_shadow_factor:new c.ci(st)}),stars:st=>({u_matrix:new c.cl(st),u_up:new c.ci(st),u_right:new c.ci(st),u_intensity_multiplier:new c.cj(st)}),snowParticle:st=>({u_modelview:new c.cl(st),u_projection:new c.cl(st),u_time:new c.cj(st),u_cam_pos:new c.ci(st),u_velocityConeAperture:new c.cj(st),u_velocity:new c.cj(st),u_horizontalOscillationRadius:new c.cj(st),u_horizontalOscillationRate:new c.cj(st),u_boxSize:new c.cj(st),u_billboardSize:new c.cj(st),u_simpleShapeParameters:new c.ck(st),u_screenSize:new c.ck(st),u_thinningCenterPos:new c.ck(st),u_thinningShape:new c.ci(st),u_thinningAffectedRatio:new c.cj(st),u_thinningParticleOffset:new c.cj(st),u_particleColor:new c.d3(st),u_direction:new c.ci(st)}),rainParticle:st=>({u_modelview:new c.cl(st),u_projection:new c.cl(st),u_time:new c.cj(st),u_cam_pos:new c.ci(st),u_texScreen:new c.ch(st),u_velocityConeAperture:new c.cj(st),u_velocity:new c.cj(st),u_boxSize:new c.cj(st),u_rainDropletSize:new c.ck(st),u_distortionStrength:new c.cj(st),u_rainDirection:new c.ci(st),u_color:new c.d3(st),u_screenSize:new c.ck(st),u_thinningCenterPos:new c.ck(st),u_thinningShape:new c.ci(st),u_thinningAffectedRatio:new c.cj(st),u_thinningParticleOffset:new c.cj(st),u_shapeDirectionalPower:new c.cj(st),u_shapeNormalPower:new c.cj(st),u_mode:new c.cj(st)}),vignette:st=>({u_vignetteShape:new c.ci(st),u_vignetteColor:new c.d3(st)}),occlusion:st=>({u_matrix:new c.cl(st),u_anchorPos:new c.ci(st),u_screenSizePx:new c.ck(st),u_occluderSizePx:new c.ck(st),u_color:new c.d3(st)})};class k0{constructor(d,_e,ot,ut){this.id=k0.uniqueIdxCounter,k0.uniqueIdxCounter++,this.context=d;const mt=d.gl;this.buffer=mt.createBuffer(),this.dynamicDraw=!!ot,this.context.unbindVAO(),d.bindElementBuffer.set(this.buffer),mt.bufferData(mt.ELEMENT_ARRAY_BUFFER,_e.arrayBuffer,this.dynamicDraw?mt.DYNAMIC_DRAW:mt.STATIC_DRAW),this.dynamicDraw||ut||_e.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(d){this.id=k0.uniqueIdxCounter,k0.uniqueIdxCounter++;const _e=this.context.gl;this.context.unbindVAO(),this.bind(),_e.bufferSubData(_e.ELEMENT_ARRAY_BUFFER,0,d.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}k0.uniqueIdxCounter=0;const tv={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class LE{constructor(d,_e,ot,ut,mt,xt){this.length=_e.length,this.attributes=ot,this.itemSize=_e.bytesPerElement,this.dynamicDraw=ut,this.instanceCount=xt,this.context=d;const Tt=d.gl;this.buffer=Tt.createBuffer(),d.bindVertexBuffer.set(this.buffer),Tt.bufferData(Tt.ARRAY_BUFFER,_e.arrayBuffer,this.dynamicDraw?Tt.DYNAMIC_DRAW:Tt.STATIC_DRAW),this.dynamicDraw||mt||_e.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(d){const _e=this.context.gl;this.bind(),_e.bufferSubData(_e.ARRAY_BUFFER,0,d.arrayBuffer)}enableAttributes(d,_e){for(let ot=0;ot<this.attributes.length;ot++){const ut=_e.getAttributeLocation(d,this.attributes[ot].name);ut!==-1&&d.enableVertexAttribArray(ut)}}setVertexAttribPointers(d,_e,ot){for(let ut=0;ut<this.attributes.length;ut++){const mt=this.attributes[ut],xt=_e.getAttributeLocation(d,mt.name);xt!==-1&&d.vertexAttribPointer(xt,mt.components,d[tv[mt.type]],!1,this.itemSize,mt.offset+this.itemSize*(ot||0))}}setVertexAttribDivisor(d,_e,ot){for(let ut=0;ut<this.attributes.length;ut++){const mt=_e.getAttributeLocation(d,this.attributes[ut].name);mt!==-1&&this.instanceCount&&this.instanceCount>0&&d.vertexAttribDivisor(mt,ot)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class jE{constructor(d,_e,ot,ut,mt){this.context=d,this.width=_e,this.height=ot;const xt=this.framebuffer=d.gl.createFramebuffer();ut>0&&(this.colorAttachment0=new fy(d,xt,0)),ut>1&&(this.colorAttachment1=new fy(d,xt,1)),mt&&(this.depthAttachmentType=mt,this.depthAttachment=mt==="renderbuffer"?new Nx(d,xt):new m1(d,xt))}createColorAttachment(d,_e){_e===0?this.colorAttachment0=new fy(d,this.framebuffer,0):_e===1&&(this.colorAttachment1=new fy(d,this.framebuffer,1))}removeColorAttachment(d,_e){const ot=this.context.gl;let ut;_e===0?(ut=this.colorAttachment0.get(),this.colorAttachment0=void 0):_e===1&&(ut=this.colorAttachment1.get(),this.colorAttachment1=void 0),ut&&ot.deleteTexture(ut)}destroy(){const d=this.context.gl;if(this.colorAttachment0){const _e=this.colorAttachment0.get();_e&&d.deleteTexture(_e)}if(this.colorAttachment1){const _e=this.colorAttachment1.get();_e&&d.deleteTexture(_e)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const _e=this.depthAttachment.get();_e&&d.deleteRenderbuffer(_e)}else{const _e=this.depthAttachment.get();_e&&d.deleteTexture(_e)}d.deleteFramebuffer(this.framebuffer)}}class Vx{constructor(d,_e){this.gl=d,this.clearColor=new a2(this),this.clearDepth=new yE(this),this.clearStencil=new O_(this),this.colorMask=new ly(this),this.depthMask=new L_(this),this.stencilMask=new rx(this),this.stencilFunc=new kx(this),this.stencilOp=new f1(this),this.stencilTest=new Fx(this),this.depthRange=new _E(this),this.depthTest=new j_(this),this.depthFunc=new vE(this),this.blend=new Bx(this),this.blendFunc=new cy(this),this.blendColor=new uy(this),this.blendEquation=new z_(this),this.cullFace=new dy(this),this.cullFaceSide=new p1(this),this.frontFace=new EE(this),this.program=new bE(this),this.activeTexture=new wE(this),this.viewport=new Mx(this),this.bindFramebuffer=new CE(this),this.bindRenderbuffer=new l2(this),this.bindTexture=new c2(this),this.bindVertexBuffer=new u2(this),this.bindElementBuffer=new V_(this),this.bindVertexArrayOES=new U_(this),this.pixelStoreUnpack=new G_(this),this.pixelStoreUnpackPremultiplyAlpha=new $_(this),this.pixelStoreUnpackFlipY=new AE(this),this.options=_e?Object.assign({},_e):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=d.getExtension("EXT_texture_filter_anisotropic")||d.getExtension("MOZ_EXT_texture_filter_anisotropic")||d.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=d.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=d.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=d.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=d.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=_e&&!!_e.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=d.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=d.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=d.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=d.getParameter(d.MAX_TEXTURE_SIZE),this.extBlendFuncExtended=d.getExtension("WEBGL_blend_func_extended")}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(d,_e,ot){return new k0(this,d,_e,ot)}createVertexBuffer(d,_e,ot,ut,mt){return new LE(this,d,_e,ot,ut,mt)}createRenderbuffer(d,_e,ot){const ut=this.gl,mt=ut.createRenderbuffer();return this.bindRenderbuffer.set(mt),ut.renderbufferStorage(ut.RENDERBUFFER,d,_e,ot),this.bindRenderbuffer.set(null),mt}createFramebuffer(d,_e,ot,ut){return new jE(this,d,_e,ot,ut)}clear({color:d,depth:_e,stencil:ot,colorMask:ut}){const mt=this.gl;let xt=0;d&&(xt|=mt.COLOR_BUFFER_BIT,this.clearColor.set(d.toNonPremultipliedRenderColor(null)),this.colorMask.set(ut||[!0,!0,!0,!0])),_e!==void 0&&(xt|=mt.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(_e),this.depthMask.set(!0)),ot!==void 0&&(xt|=mt.STENCIL_BUFFER_BIT,this.clearStencil.set(ot),this.stencilMask.set(255)),mt.clear(xt)}setCullFace(d){d.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(d.mode),this.frontFace.set(d.frontFace))}setDepthMode(d){d.func!==this.gl.ALWAYS||d.mask?(this.depthTest.set(!0),this.depthFunc.set(d.func),this.depthMask.set(d.mask),this.depthRange.set(d.range)):this.depthTest.set(!1)}setStencilMode(d){d.test.func!==this.gl.ALWAYS||d.mask?(this.stencilTest.set(!0),this.stencilMask.set(d.mask),this.stencilOp.set([d.fail,d.depthFail,d.pass]),this.stencilFunc.set({func:d.test.func,ref:d.ref,mask:d.test.mask})):this.stencilTest.set(!1)}setColorMode(d){c.by(d.blendFunction,co.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(d.blendFunction),this.blendColor.set(d.blendColor),d.blendEquation?this.blendEquation.set(d.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(d.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let sx;function Ps(st,d,_e,ot,ut,mt,xt){const Tt=st.context,kt=Tt.gl,$t=st.transform,Xt=[c.aF($t.center.lng),c.aJ($t.center.lat)],rr=_e.layout.get("symbol-placement"),tr=_e.layout.get("text-variable-anchor"),nr=_e.layout.get("icon-rotation-alignment")==="map",cr=_e.layout.get("text-rotation-alignment")==="map",lr=rr!=="point",yr=[];let xr=0,Ar=0;for(let Br=0;Br<ot.length;Br++){const Xr=ot[Br],an=d.getTile(Xr),sn=an.getBucket(_e);if(!sn)continue;const wn=sn.getProjection().createInversionMatrix($t,Xr.canonical),Cn=[],Nn=Sx(Xr,sn,$t),Jn=!xt&&nr&&lr,yn=xt&&cr&&lr,Qr=tr&&sn.hasTextData(),Dn=sn.hasIconTextFit()&&Qr&&sn.hasIconData(),bn=Jn||yn||xt&&Qr||Dn,$n=sn.projection.name==="globe",ls=$n?c.aj($t.zoom):0;$n&&(Cn.push("PROJECTION_GLOBE_VIEW"),bn&&Cn.push("PROJECTED_POS_ON_VIEWPORT"));const As=st.getOrCreateProgram("collisionBox",{defines:Cn});let is=Nn;ut[0]===0&&ut[1]===0||(is=st.translatePosMatrix(Nn,an,ut,mt));const _i=xt?sn.textCollisionBox:sn.iconCollisionBox,Ls=sn.collisionCircleArray;if(Ls.length>0){const _s=c.bC(),Rs=is;c.cP(_s,sn.placementInvProjMatrix,$t.glCoordMatrix),c.cP(_s,_s,sn.placementViewportMatrix),yr.push({circleArray:Ls,circleOffset:Ar,transform:Rs,invTransform:_s,projection:sn.getProjection()}),xr+=Ls.length/4,Ar=xr}if(!_i)continue;st.terrain&&st.terrain.setupElevationDraw(an,As);const Bs=$n?[Xr.canonical.x,Xr.canonical.y,1<<Xr.canonical.z]:[0,0,0];As.draw(st,kt.LINES,Us.disabled,oo.disabled,st.colorModeForRenderPass(),wr.disabled,J_(is,wn,$t,ls,Xt,an,Bs,sn.getProjection()),_e.id,_i.layoutVertexBuffer,_i.indexBuffer,_i.segments,null,$t.zoom,null,[_i.collisionVertexBuffer,_i.collisionVertexBufferExt])}if(!xt||!yr.length)return;const Dr=st.getOrCreateProgram("collisionCircle"),Tr=new c.dZ;Tr.resize(4*xr),Tr._trim();let Wr=0;for(const Br of yr)for(let Xr=0;Xr<Br.circleArray.length/4;Xr++){const an=4*Xr,sn=Br.circleArray[an+0],wn=Br.circleArray[an+1],Cn=Br.circleArray[an+2],Nn=Br.circleArray[an+3];Tr.emplace(Wr++,sn,wn,Cn,Nn,0),Tr.emplace(Wr++,sn,wn,Cn,Nn,1),Tr.emplace(Wr++,sn,wn,Cn,Nn,2),Tr.emplace(Wr++,sn,wn,Cn,Nn,3)}(!sx||sx.length<2*xr)&&(sx=function(Br){const Xr=2*Br,an=new c.b0;an.resize(Xr),an._trim();for(let sn=0;sn<Xr;sn++){const wn=6*sn;an.uint16[wn+0]=4*sn+0,an.uint16[wn+1]=4*sn+1,an.uint16[wn+2]=4*sn+2,an.uint16[wn+3]=4*sn+2,an.uint16[wn+4]=4*sn+3,an.uint16[wn+5]=4*sn+0}return an}(xr));const zr=Tt.createIndexBuffer(sx,!0),$r=Tt.createVertexBuffer(Tr,c.d_.members,!0);for(const Br of yr){const Xr={u_matrix:Br.transform,u_inv_matrix:Br.invTransform,u_camera_to_center_distance:(Or=$t).getCameraToCenterDistance(Br.projection),u_viewport_size:[Or.width,Or.height]};Dr.draw(st,kt.TRIANGLES,Us.disabled,oo.disabled,st.colorModeForRenderPass(),wr.disabled,Xr,_e.id,$r,zr,c.bg.simpleSegment(0,2*Br.circleOffset,Br.circleArray.length,Br.circleArray.length/2),null,$t.zoom)}var Or;$r.destroy(),zr.destroy()}const E1=c.bC();function im(st){const d=st._camera.getWorldToCamera(st.worldSize,1),_e=c.aB([],d,st.globeMatrix);c.bl(_e,_e);const ot=[0,0,0],ut=[0,1,0,0];return c.aC(ut,ut,_e),ot[0]=ut[0],ot[1]=ut[1],ot[2]=ut[2],c.aw(ot,ot),ot}function Lm({width:st,height:d,anchor:_e,textOffset:ot,textScale:ut},mt){const{horizontalAlign:xt,verticalAlign:Tt}=c.c1(_e),kt=-(xt-.5)*st,$t=-(Tt-.5)*d,Xt=c.c2(_e,ot);return new c.P((kt/ut+Xt[0])*mt,($t/ut+Xt[1])*mt)}function eo(st,d,_e,ot,ut,mt,xt,Tt,kt,$t){const Xt=st.text.placedSymbolArray,rr=st.text.dynamicLayoutVertexArray,tr=st.icon.dynamicLayoutVertexArray,nr={},cr=st.getProjection(),lr=m0(xt,cr,ut),yr=ut.elevation,xr=cr.upVectorScale(xt.canonical,ut.center.lat,ut.worldSize).metersToTile;rr.clear();for(let Ar=0;Ar<Xt.length;Ar++){const Dr=Xt.get(Ar),{tileAnchorX:Tr,tileAnchorY:Wr,numGlyphs:zr}=Dr,$r=Dr.hidden||!Dr.crossTileID||st.allowVerticalPlacement&&!Dr.placedOrientation?null:ot[Dr.crossTileID];if($r){let Or=0,Br=0,Xr=0;const an=st.elevationType==="road";if(yr||an){const bn=an?st.getElevationFeatureForText(Ar):null,$n=c.bV.getAtTileOffset(xt,new c.P(Tr,Wr),yr,bn),[ls,As,is]=cr.upVector(xt.canonical,Tr,Wr);Or=$n*ls*xr,Br=$n*As*xr,Xr=$n*is*xr}let[sn,wn,Cn,Nn]=yl(Dr.projectedAnchorX+Or,Dr.projectedAnchorY+Br,Dr.projectedAnchorZ+Xr,_e?lr:mt);const Jn=Mo(ut.getCameraToCenterDistance(cr),Nn);let yn=c.bM(st.textSizeData,kt,Dr)*Jn/c.bY;_e&&(yn*=st.tilePixelRatio/Tt);const Qr=Lm($r,yn);_e?({x:sn,y:wn,z:Cn}=cr.projectTilePoint(Tr+Qr.x,Wr+Qr.y,xt.canonical),[sn,wn,Cn]=yl(sn+Or,wn+Br,Cn+Xr,mt)):(d&&Qr._rotate(-ut.angle),sn+=Qr.x,wn+=Qr.y,Cn=0);const Dn=st.allowVerticalPlacement&&Dr.placedOrientation===c.bL.vertical?Math.PI/2:0;for(let bn=0;bn<zr;bn++)c.bO(rr,sn,wn,Cn,Dn);$t&&Dr.associatedIconIndex>=0&&(nr[Dr.associatedIconIndex]={x:sn,y:wn,z:Cn,angle:Dn})}else vu(zr,rr)}if($t){tr.clear();const Ar=st.icon.placedSymbolArray;for(let Dr=0;Dr<Ar.length;Dr++){const Tr=Ar.get(Dr),{numGlyphs:Wr}=Tr,zr=nr[Dr];if(Tr.hidden||!zr)vu(Wr,tr);else{const{x:$r,y:Or,z:Br,angle:Xr}=zr;for(let an=0;an<Wr;an++)c.bO(tr,$r,Or,Br,Xr)}}st.icon.dynamicLayoutVertexBuffer.updateData(tr)}st.text.dynamicLayoutVertexBuffer.updateData(rr)}function b1(st,d,_e,ot,ut,mt,xt={}){const Tt=_e.paint.get("icon-translate"),kt=_e.paint.get("text-translate"),$t=_e.paint.get("icon-translate-anchor"),Xt=_e.paint.get("text-translate-anchor"),rr=_e.layout.get("icon-rotation-alignment"),tr=_e.layout.get("text-rotation-alignment"),nr=_e.layout.get("icon-pitch-alignment"),cr=_e.layout.get("text-pitch-alignment"),lr=_e.layout.get("icon-keep-upright"),yr=_e.layout.get("text-keep-upright"),xr=_e.paint.get("icon-color-saturation"),Ar=_e.paint.get("icon-color-contrast"),Dr=_e.paint.get("icon-color-brightness-min"),Tr=_e.paint.get("icon-color-brightness-max"),Wr=_e.layout.get("symbol-elevation-reference")==="sea",zr=_e.layout.get("icon-image-use-theme")==="none",$r=st.context,Or=$r.gl,Br=st.transform,Xr=rr==="map",an=tr==="map",sn=nr==="map",wn=cr==="map",Cn=_e.layout.get("symbol-sort-key").constantOr(1)!==void 0;let Nn=!1;const Jn=st.depthModeForSublayer(0,Us.ReadOnly),yn=new Us(st.context.gl.LEQUAL,Us.ReadOnly,st.depthRangeFor3D),Qr=[c.aF(Br.center.lng),c.aJ(Br.center.lat)],Dn=_e.layout.get("text-variable-anchor"),bn=Br.projection.name==="globe",$n=[],ls=[0,-1,0];for(const As of ot){const is=d.getTile(As),_i=is.getBucket(_e);if(!_i||_i.projection.name==="mercator"&&bn||_i.fullyClipped)continue;const Ls=_i.projection.name==="globe",Bs=Ls?c.aj(Br.zoom):0,_s=m0(As,_i.getProjection(),Br),Rs=Br.calculatePixelsToTileUnitsMatrix(is),Qs=Dn&&_i.hasTextData(),_o=_i.hasIconTextFit()&&Qs&&_i.hasIconData(),Xo=_i.getProjection().createInversionMatrix(Br,As.canonical),Al=(1<<is.tileID.canonical.z)*c.al/st.transform.worldSize,zs=Pl=>{let $a=[0,0,0];if(Pl){const To=st.style.directionalLight,cu=st.style.ambientLight;To&&cu&&($a=os(st.style,To,cu))}return $a},El=Pl=>{Br.depthOcclusionForSymbolsAndCircles&&(_e.hasOcclusionOpacityProperties||st.terrain)&&(Pl.push("DEPTH_D24"),Pl.push("DEPTH_OCCLUSION"))},mo=Pl=>{_e.lut&&!zr&&(_e.lut.texture||(_e.lut.texture=new c.d$(st.context,_e.lut.image,[_e.lut.image.height,_e.lut.image.height,_e.lut.image.height],$r.gl.RGBA8)),$r.activeTexture.set($r.gl.TEXTURE0+Dt.LUT),_e.lut.texture&&_e.lut.texture.bind($r.gl.LINEAR,$r.gl.CLAMP_TO_EDGE),Pl.push("APPLY_LUT_ON_GPU"))},Dl=()=>{const Pl=Xr&&_e.layout.get("symbol-placement")!=="point",$a=[];El($a),mo($a);const To=Pl||_o,cu=_i.elevationType==="road",Lu=st.shadowRenderer,bu=cu&&sn&&!!Lu&&Lu.enabled,Zl=zs(bu),Op=cu&&sn&&!st.terrain?yn:Jn,_p=_e.paint.get("icon-image-cross-fade");st.terrainRenderModeElevated()&&sn&&$a.push("PITCH_WITH_MAP_TERRAIN"),Ls&&($a.push("PROJECTION_GLOBE_VIEW"),To&&$a.push("PROJECTED_POS_ON_VIEWPORT")),_p>0&&_i.hasAnySecondaryIcon&&$a.push("ICON_TRANSITION"),!_i.icon.zOffsetVertexBuffer||cu&&st.terrain||$a.push("Z_OFFSET"),xr===0&&Ar===0&&Dr===0&&Tr===1||$a.push("COLOR_ADJUSTMENT"),_i.sdfIcons&&$a.push("RENDER_SDF"),bu&&$a.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),cu&&sn&&!st.terrain&&_i.icon.orientationVertexBuffer&&$a.push("ELEVATED_ROADS");const tp=_i.icon.programConfigurations.get(_e.id),Sp=st.getOrCreateProgram("symbol",{config:tp,defines:$a}),Tp=is.imageAtlasTexture?is.imageAtlasTexture.size:[0,0],xp=_i.iconSizeData,c0=c.bK(xp,Br.zoom),A0=sn||!Br.isOrthographic,Wp=Qu(_s,is.tileID.canonical,sn,Xr,Br,_i.getProjection(),Rs),Bu=cs(_s,is.tileID.canonical,sn,Xr,Br,_i.getProjection(),Rs),Gu=st.translatePosMatrix(Bu,is,Tt,$t,!0),Yl=st.translatePosMatrix(_s,is,Tt,$t),Xu=To?E1:Wp,Su=Xr&&!sn&&!Pl;let wu=ls;!bn&&!Br.mercatorFromTransition||Xr||(wu=im(Br));const S0=Ls?wu:ls,B1=_e.getColorAdjustmentMatrix(xr,Ar,Dr,Tr),M0=wy(xp.kind,c0,Su,sn,st,Yl,Xu,Gu,Wr,!1,Tp,[0,0],0,As,Bs,Qr,Xo,S0,_i.getProjection(),Zl,Al,B1,_p,null),M1=is.imageAtlasTexture?is.imageAtlasTexture:null,Zx=_e.layout.get("icon-size").constantOr(0)!==1||_i.iconsNeedLinear,K0=_i.sdfIcons||st.options.rotating||st.options.zooming||Zx||A0?Or.LINEAR:Or.NEAREST,fm=_i.sdfIcons&&_e.paint.get("icon-halo-width").constantOr(1)!==0,Yx=st.terrain&&sn&&Pl?c.bl(c.bC(),Wp):E1;if(Pl&&_i.icon){const Gm=c.bV.getAtTileOffsetFunc(As,Br.center.lat,Br.worldSize,_i.getProjection()),pm=Tx(_s,is.tileID.canonical,sn,Xr,Br,_i.getProjection(),Rs),N0=_e.layout.get("icon-size-scale-range"),mm=c.aA(st.scaleFactor,N0[0],N0[1]);u1(_i,_s,st,!1,pm,Bu,sn,lr,Gm,As,mm)}return{program:Sp,buffers:_i.icon,uniformValues:M0,atlasTexture:M1,atlasTextureIcon:null,atlasInterpolation:K0,atlasInterpolationIcon:null,isSDF:_i.sdfIcons,hasHalo:fm,depthMode:Op,tile:is,renderWithShadows:bu,labelPlaneMatrixInv:Yx}},Vl=()=>{const Pl=an&&_e.layout.get("symbol-placement")!=="point",$a=[],To=Pl||Dn||_o,cu=_i.elevationType==="road",Lu=st.shadowRenderer,bu=cu&&wn&&!!Lu&&Lu.enabled,Zl=zs(bu),Op=cu&&wn&&!st.terrain?yn:Jn;st.terrainRenderModeElevated()&&wn&&$a.push("PITCH_WITH_MAP_TERRAIN"),Ls&&($a.push("PROJECTION_GLOBE_VIEW"),To&&$a.push("PROJECTED_POS_ON_VIEWPORT")),!_i.text.zOffsetVertexBuffer||cu&&st.terrain||$a.push("Z_OFFSET"),_i.iconsInText&&$a.push("RENDER_TEXT_AND_SYMBOL"),$a.push("RENDER_SDF"),bu&&$a.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),cu&&wn&&!st.terrain&&_i.text.orientationVertexBuffer&&$a.push("ELEVATED_ROADS"),El($a);const _p=_i.text.programConfigurations.get(_e.id),tp=st.getOrCreateProgram("symbol",{config:_p,defines:$a});let Sp,Tp=[0,0],xp=null;const c0=_i.textSizeData;_i.iconsInText&&(Tp=is.imageAtlasTexture?is.imageAtlasTexture.size:[0,0],xp=is.imageAtlasTexture?is.imageAtlasTexture:null,Sp=wn||!Br.isOrthographic||st.options.rotating||st.options.zooming||c0.kind==="composite"||c0.kind==="camera"?Or.LINEAR:Or.NEAREST);const A0=is.glyphAtlasTexture?is.glyphAtlasTexture.size:[0,0],Wp=_e.layout.get("text-size-scale-range"),Bu=c.aA(st.scaleFactor,Wp[0],Wp[1]),Gu=c.bK(c0,Br.zoom,Bu),Yl=Qu(_s,is.tileID.canonical,wn,an,Br,_i.getProjection(),Rs),Xu=cs(_s,is.tileID.canonical,wn,an,Br,_i.getProjection(),Rs),Su=st.translatePosMatrix(Xu,is,kt,Xt,!0),wu=st.translatePosMatrix(_s,is,kt,Xt),S0=To?E1:Yl,B1=an&&!wn&&!Pl;let M0=ls;!bn&&!Br.mercatorFromTransition||an||(M0=im(Br));const M1=wy(c0.kind,Gu,B1,wn,st,wu,S0,Su,Wr,!0,A0,Tp,0,As,Bs,Qr,Xo,Ls?M0:ls,_i.getProjection(),Zl,Al,null,null,Bu),Zx=is.glyphAtlasTexture?is.glyphAtlasTexture:null,K0=Or.LINEAR,fm=_e.paint.get("text-halo-width").constantOr(1)!==0,Yx=st.terrain&&wn&&Pl?c.bl(c.bC(),Yl):E1;if(Pl&&_i.text){const Gm=c.bV.getAtTileOffsetFunc(As,Br.center.lat,Br.worldSize,_i.getProjection()),pm=Tx(_s,is.tileID.canonical,wn,an,Br,_i.getProjection(),Rs);u1(_i,_s,st,!0,pm,Xu,wn,yr,Gm,As,Bu)}return{program:tp,buffers:_i.text,uniformValues:M1,atlasTexture:Zx,atlasTextureIcon:xp,atlasInterpolation:K0,atlasInterpolationIcon:Sp,isSDF:!0,hasHalo:fm,depthMode:Op,tile:is,renderWithShadows:bu,labelPlaneMatrixInv:Yx}},Ml=_i.icon.segments.get().length,_l=_i.text.segments.get().length,So=Ml&&!xt.onlyText?Dl():null,Rl=_l&&!xt.onlyIcons?Vl():null,Au=_e.paint.get("icon-opacity").constantOr(1),fu=_e.paint.get("text-opacity").constantOr(1);if(Cn&&_i.canOverlap){Nn=!0;const Pl=Au&&!xt.onlyText?_i.icon.segments.get():[],$a=fu&&!xt.onlyIcons?_i.text.segments.get():[];for(const To of Pl)$n.push({segments:new c.bg([To]),sortKey:To.sortKey,state:So});for(const To of $a)$n.push({segments:new c.bg([To]),sortKey:To.sortKey,state:Rl})}else xt.onlyText||$n.push({segments:Au?_i.icon.segments:new c.bg([]),sortKey:0,state:So}),xt.onlyIcons||$n.push({segments:fu?_i.text.segments:new c.bg([]),sortKey:0,state:Rl})}Nn&&$n.sort((As,is)=>As.sortKey-is.sortKey);for(const As of $n){const is=As.state;if(is)if(st.terrain?st.terrain.setupElevationDraw(is.tile,is.program,{useDepthForOcclusion:Br.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:is.labelPlaneMatrixInv}):st.setupDepthForOcclusion(Br.depthOcclusionForSymbolsAndCircles,is.program),$r.activeTexture.set(Or.TEXTURE0),is.atlasTexture&&is.atlasTexture.bind(is.atlasInterpolation,Or.CLAMP_TO_EDGE,!0),is.atlasTextureIcon&&($r.activeTexture.set(Or.TEXTURE1),is.atlasTextureIcon&&is.atlasTextureIcon.bind(is.atlasInterpolationIcon,Or.CLAMP_TO_EDGE,!0)),is.renderWithShadows&&st.shadowRenderer.setupShadows(is.tile.tileID.toUnwrapped(),is.program,"vector-tile"),st.uploadCommonLightUniforms(st.context,is.program),is.hasHalo){const _i=is.uniformValues;_i.u_is_halo=1,rv(is.buffers,As.segments,_e,st,is.program,is.depthMode,ut,mt,_i,2),_i.u_is_halo=0}else{if(is.isSDF){const _i=is.uniformValues;is.hasHalo&&(_i.u_is_halo=1,rv(is.buffers,As.segments,_e,st,is.program,is.depthMode,ut,mt,_i,1)),_i.u_is_halo=0}rv(is.buffers,As.segments,_e,st,is.program,is.depthMode,ut,mt,is.uniformValues,1)}}}function rv(st,d,_e,ot,ut,mt,xt,Tt,kt,$t){const Xt=[st.dynamicLayoutVertexBuffer,st.opacityVertexBuffer,st.iconTransitioningVertexBuffer,st.globeExtVertexBuffer,st.zOffsetVertexBuffer,st.orientationVertexBuffer];ut.draw(ot,ot.context.gl.TRIANGLES,mt,xt,Tt,wr.disabled,kt,_e.id,st.layoutVertexBuffer,st.indexBuffer,d,_e.paint,ot.transform.zoom,st.programConfigurations.get(_e.id),Xt,$t)}function zE(st,d){const _e=1<<st.canonical.z,ot=(d.x*_e-st.canonical.x-st.wrap*_e)*c.al,ut=(d.y*_e-st.canonical.y)*c.al,mt=c.e8(d.z,d.y);return c.d5(ot,ut,mt)}function Ay(st,d,_e,ot,ut){if(!_e.layout||_e.layout.get("fill-elevation-reference")==="none"||_e.paint.get("fill-opacity").constantOr(1)===0)return;const mt=st.context.gl,xt=new Us(st.context.gl.LEQUAL,Us.ReadWrite,st.depthRangeFor3D),Tt=new Us(st.context.gl.GREATER,Us.ReadWrite,st.depthRangeFor3D),kt=function(nr){let cr=.01;return nr.isOrthographic&&(cr=c.ak(1e-4,cr,c.d0(nr.pitch>=Jt?1:nr.pitch/Jt))),2*cr}(st.transform),$t=st.transform.getFreeCameraOptions().position,Xt="elevatedStructuresDepthReconstruct",rr=st.getOrCreateProgram(Xt,{defines:["DEPTH_RECONSTRUCTION"]}),tr=st.getOrCreateProgram(Xt);for(const nr of ot){const cr=d.getTile(nr),lr=cr.getBucket(_e);if(!lr)continue;const yr=lr.elevatedStructures;if(!yr)continue;const xr=lr.elevationBufferData.heightRange,Ar=zE(nr.toUnwrapped(),$t),Dr=st.translatePosMatrix(nr.projMatrix,cr,_e.paint.get("fill-translate"),_e.paint.get("fill-translate-anchor"));let Tr,Wr,zr,$r;if(ut==="initialize"){if(!xr||xr.min>=1||yr.depthSegments.segments[0].primitiveLength===0)continue;Tr=nx(Dr,Ar,kt,1,0),Wr=xt,zr=yr.depthSegments,$r=rr}else if(ut==="reset"){if(!xr||xr.min>=0||yr.maskSegments.segments[0].primitiveLength===0)continue;Tr=nx(Dr,Ar,0,0,1),Wr=Tt,zr=yr.maskSegments,$r=rr}else if(ut==="geometry"){if(yr.depthSegments.segments[0].primitiveLength===0)continue;Tr=nx(Dr,Ar,kt,1,0),Wr=xt,zr=yr.depthSegments,$r=tr}$r.draw(st,mt.TRIANGLES,Wr,oo.disabled,co.disabled,wr.disabled,Tr,_e.id,yr.vertexBuffer,yr.indexBuffer,zr,_e.paint,st.transform.zoom)}}function Sy(st,d,_e,ot){const{painter:ut,sourceCache:mt,layer:xt,coords:Tt,colorMode:kt,elevationType:$t,terrainEnabled:Xt,pass:rr}=st,tr=ut.context.gl,nr=xt.paint.get("fill-pattern"),cr=xt.paint.get("fill-pattern-cross-fade"),lr=nr.constantOr(null);let yr=$t;$t!=="road"||d&&!Xt||(yr="none");const xr=yr==="road",Ar=st.painter.shadowRenderer,Dr=xr&&!!Ar&&Ar.enabled,Tr=new Us(ut.context.gl.LEQUAL,Us.ReadOnly,ut.depthRangeFor3D);let Wr=[0,0,0];if(Dr){const Br=ut.style.directionalLight,Xr=ut.style.ambientLight;Br&&Xr&&(Wr=os(ut.style,Br,Xr))}const zr=nr&&nr.constantOr(1),$r=ut.terrain&&ut.terrain.renderingToTexture,Or=(Br,Xr)=>{let an,sn,wn,Cn,Nn;Xr?(an=zr&&!xt.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",wn=tr.LINES):(an=zr?"fillPattern":"fill",wn=tr.TRIANGLES);for(const Jn of Tt){const yn=mt.getTile(Jn);if(zr&&!yn.patternsLoaded())continue;const Qr=yn.getBucket(xt);if(!Qr)continue;const Dn=d?Qr.elevationBufferData:Qr.bufferData;if(Dn.isEmpty())continue;ut.prepareDrawTile();const bn=Dn.programConfigurations.get(xt.id),$n=ut.isTileAffectedByFog(Jn),ls=[],As=[];xr&&(ls.push("ELEVATED_ROADS"),As.push(Dn.elevatedLayoutVertexBuffer)),Dr&&ls.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),$r&&_e&&ls.push("USE_MRT1"),zr&&(ut.context.activeTexture.set(tr.TEXTURE0),yn.imageAtlasTexture&&yn.imageAtlasTexture.bind(tr.LINEAR,tr.CLAMP_TO_EDGE),bn.updatePaintBuffers());let is=!1;if(lr&&yn.imageAtlas){const Rs=yn.imageAtlas,Qs=c.e3.from(lr),_o=Qs.getPrimary().scaleSelf(c.o.devicePixelRatio).toString(),Xo=Qs.getSecondary(),Al=Rs.patternPositions.get(_o),zs=Xo?Rs.patternPositions.get(Xo.scaleSelf(c.o.devicePixelRatio).toString()):null;is=!!Al&&!!zs,Al&&bn.setConstantPatternPositions(Al,zs)}cr>0&&(is||bn.getPatternTransitionVertexBuffer("fill-pattern"))&&ls.push("FILL_PATTERN_TRANSITION");const _i=ut.getOrCreateProgram(an,{config:bn,overrideFog:$n,defines:ls}),Ls=ut.translatePosMatrix(Jn.projMatrix,yn,xt.paint.get("fill-translate"),xt.paint.get("fill-translate-anchor"));Dr&&Ar.setupShadows(yn.tileID.toUnwrapped(),_i,"vector-tile");const Bs=xt.paint.get("fill-emissive-strength");if(Xr){Cn=Dn.lineIndexBuffer,Nn=Dn.lineSegments;const Rs=ut.terrain&&ut.terrain.renderingToTexture?ut.terrain.drapeBufferSize:[tr.drawingBufferWidth,tr.drawingBufferHeight];sn=an==="fillOutlinePattern"&&zr?Q_(Ls,Bs,ut,yn,Rs,Wr,cr):DE(Ls,Bs,Rs,Wr)}else Cn=Dn.indexBuffer,Nn=Dn.triangleSegments,sn=zr?Y_(Ls,Bs,ut,yn,Wr,cr):Z_(Ls,Bs,Wr);ut.uploadCommonUniforms(ut.context,_i,Jn.toUnwrapped());let _s=Br;($t==="road"&&!Xt||$t==="offset")&&(_s=Tr),_i.draw(ut,wn,_s,ot||ut.stencilModeForClipping(Jn),kt,wr.disabled,sn,xt.id,Dn.layoutVertexBuffer,Cn,Nn,xt.paint,ut.transform.zoom,bn,As)}};ut.renderPass===rr&&Or(ut.depthModeForSublayer(1,ut.renderPass==="opaque"?Us.ReadWrite:Us.ReadOnly),!1),yr==="none"&&ut.renderPass==="translucent"&&xt.paint.get("fill-antialias")&&Or(ut.depthModeForSublayer(xt.getPaintProperty("fill-outline-color")?2:0,Us.ReadOnly),!0)}function Ty(st,d,_e,ot,ut,mt,xt,Tt){_e.resetLayerRenderingStats(st);const kt=st.context,$t=kt.gl,Xt=st.transform,rr=_e.paint.get("fill-extrusion-pattern"),tr=_e.paint.get("fill-extrusion-pattern-cross-fade"),nr=rr.constantOr(null),cr=rr.constantOr(1),lr=_e.paint.get("fill-extrusion-opacity"),yr=st.style.enable3dLights(),xr=_e.paint.get(yr&&!cr?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),Ar=[_e.paint.get("fill-extrusion-ambient-occlusion-intensity"),xr],Dr=_e.layout.get("fill-extrusion-edge-radius"),Tr=Dr>0&&!_e.paint.get("fill-extrusion-rounded-roof"),Wr=Tr?0:Dr,zr=Xt.projection.name==="globe"?c.eb():0,$r=Xt.projection.name==="globe",Or=$r?c.aj(Xt.zoom):0,Br=[c.aF(Xt.center.lng),c.aJ(Xt.center.lat)],Xr=_e.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",an=_e.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(Xr?null:_e.lut).toArray01().slice(0,3),sn=_e.paint.get("fill-extrusion-flood-light-intensity"),wn=_e.paint.get("fill-extrusion-vertical-scale"),Cn=_e.paint.get("fill-extrusion-line-width").constantOr(1)!==0,Nn=_e.paint.get("fill-extrusion-height-alignment"),Jn=_e.paint.get("fill-extrusion-base-alignment"),yn=Er(st,_e.paint.get("fill-extrusion-cutoff-fade-range")),Qr=[];let Dn;$r&&Qr.push("PROJECTION_GLOBE_VIEW"),Ar[0]>0&&Qr.push("FAUX_AO"),Tr&&Qr.push("ZERO_ROOF_RADIUS"),Tt&&Qr.push("HAS_CENTROID"),sn>0&&Qr.push("FLOOD_LIGHT"),yn.shouldRenderCutoff&&Qr.push("RENDER_CUTOFF"),Cn&&Qr.push("RENDER_WALL_MODE");const bn=st.renderPass==="shadow",$n=st.shadowRenderer,ls=bn&&!!$n,As=bn?wr.disabled:wr.backCCW;st.shadowRenderer&&(st.shadowRenderer.useNormalOffset=!0);let is=[0,0,0];if($n){const Bs=st.style.directionalLight,_s=st.style.ambientLight;Bs&&_s&&(is=os(st.style,Bs,_s)),bn||(Qr.push("RENDER_SHADOWS","DEPTH_TEXTURE"),$n.useNormalOffset&&Qr.push("NORMAL_OFFSET")),Dn=Qr.concat(["SHADOWS_SINGLE_CASCADE"])}const _i=ls?"fillExtrusionDepth":cr?"fillExtrusionPattern":"fillExtrusion",Ls=_e.getLayerRenderingStats();for(const Bs of ot){const _s=d.getTile(Bs),Rs=_s.getBucket(_e);if(!Rs||Rs.projection.name!==Xt.projection.name)continue;let Qs=!1;$n&&(Qs=$n.getMaxCascadeForTile(Bs.toUnwrapped())===0);const _o=st.isTileAffectedByFog(Bs),Xo=Rs.programConfigurations.get(_e.id);let Al=!1;if(nr&&_s.imageAtlas){const _l=_s.imageAtlas,So=c.e3.from(nr),Rl=So.getPrimary().scaleSelf(c.o.devicePixelRatio).toString(),Au=So.getSecondary(),fu=_l.patternPositions.get(Rl),Pl=Au?_l.patternPositions.get(Au.scaleSelf(c.o.devicePixelRatio).toString()):null;Al=!!fu&&!!Pl,fu&&Xo.setConstantPatternPositions(fu,Pl)}tr>0&&(Al||Xo.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&Qr.push("FILL_EXTRUSION_PATTERN_TRANSITION");const zs=st.getOrCreateProgram(_i,{config:Xo,defines:Qs?Dn:Qr,overrideFog:_o});if(st.terrain&&st.terrain.setupElevationDraw(_s,zs,{useMeterToDem:!0}),!Rs.centroidVertexBuffer){const _l=zs.getAttributeLocation($t,"a_centroid_pos");_l!==-1&&$t.vertexAttrib2f(_l,0,0)}!bn&&$n&&$n.setupShadows(_s.tileID.toUnwrapped(),zs,"vector-tile"),cr&&(st.context.activeTexture.set($t.TEXTURE0),_s.imageAtlasTexture&&_s.imageAtlasTexture.bind($t.LINEAR,$t.CLAMP_TO_EDGE),Xo.updatePaintBuffers());const El=_e.paint.get("fill-extrusion-vertical-gradient"),mo=1/Rs.tileToMeter;let Dl;if(bn&&$n){if(om(_s.tileID,Rs.maxHeight,st))continue;const _l=$n.calculateShadowPassMatrixFromTile(_s.tileID.toUnwrapped());Dl=K_(_l,Wr,mo,wn,Nn,Jn)}else{const _l=st.translatePosMatrix(Bs.expandedProjMatrix,_s,_e.paint.get("fill-extrusion-translate"),_e.paint.get("fill-extrusion-translate-anchor")),So=Xt.projection.createInversionMatrix(Xt,Bs.canonical);Dl=cr?IE(_l,st,El,lr,Ar,Wr,mo,Bs,_s,zr,Nn,Jn,Or,Br,So,an,wn,tr):_y(_l,st,El,lr,Ar,Wr,mo,Bs,zr,Nn,Jn,Or,Br,So,an,wn,sn,is)}st.uploadCommonUniforms(kt,zs,Bs.toUnwrapped(),null,yn);let Vl=Rs.segments;if(Xt.projection.name==="mercator"&&!bn&&(Vl=Rs.getVisibleSegments(_s.tileID,st.terrain,st.transform.getFrustum(0)),!Vl.get().length))continue;if(Ls)if(bn)for(const _l of Vl.get())Ls.numRenderedVerticesInShadowPass+=_l.primitiveLength;else for(const _l of Vl.get())Ls.numRenderedVerticesInTransparentPass+=_l.primitiveLength;const Ml=[];(st.terrain||Tt)&&Ml.push(Rs.centroidVertexBuffer),$r&&Ml.push(Rs.layoutVertexExtBuffer),Cn&&Ml.push(Rs.wallVertexBuffer),zs.draw(st,kt.gl.TRIANGLES,ut,mt,xt,As,Dl,_e.id,Rs.layoutVertexBuffer,Rs.indexBuffer,Vl,_e.paint,st.transform.zoom,Xo,Ml)}st.shadowRenderer&&(st.shadowRenderer.useNormalOffset=!1)}class nv{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0}}function sm(st,d,_e,ot,ut,mt,xt,Tt,kt,$t,Xt,rr,tr,nr,cr,lr,yr,xr,Ar,Dr){const Tr=d.context,Wr=Tr.gl,zr=d.transform,$r=d.transform.zoom,Or=[],Br=st.translate,Xr=st.translateAnchor,an=st.edgeRadius,sn=Er(d,st.cutoffFadeRange);Xt==="clear"?(Or.push("CLEAR_SUBPASS"),Dr&&(Or.push("CLEAR_FROM_TEXTURE"),Tr.activeTexture.set(Wr.TEXTURE0),Dr.bind(Wr.LINEAR,Wr.CLAMP_TO_EDGE))):Xt==="sdf"?Or.push("SDF_SUBPASS"):Xt==="emissive"&&(Or.push("USE_MRT1"),Tr.activeTexture.set(Wr.TEXTURE0),Dr.bind(Wr.LINEAR,Wr.CLAMP_TO_EDGE)),xr&&Or.push("HAS_CENTROID"),sn.shouldRenderCutoff&&Or.push("RENDER_CUTOFF");const wn=(Cn,Nn,Jn,yn,Qr)=>{let Dn=Or;Nn.groundRadiusBuffer!=null&&(Dn=Or.concat("HAS_ATTRIBUTE_a_flood_light_ground_radius"));const bn=Nn.programConfigurations.get(ot.id),$n=d.isTileAffectedByFog(Cn),ls=d.getOrCreateProgram("fillExtrusionGroundEffect",{config:bn,defines:Dn,overrideFog:$n}),As=jx(d,yn,rr,$t,Qr,[tr,nr*Qr],cr,lr,yr,$r>=17?0:an*Qr,Dr?Dr.size[0]:0),is=[];xr&&is.push(Nn.hiddenByLandmarkVertexBuffer),Nn.groundRadiusBuffer!=null&&is.push(Nn.groundRadiusBuffer),d.uploadCommonUniforms(Tr,ls,Cn.toUnwrapped(),null,sn),ls.draw(d,Tr.gl.TRIANGLES,mt,xt,Tt,kt,As,ot.id,Nn.vertexBuffer,Nn.indexBuffer,Jn,ot.paint,$r,bn,is)};for(const Cn of ut){const Nn=_e.getTile(Cn),Jn=Nn.getBucket(ot);if(!Jn||Jn.projection.name!==zr.projection.name||!Jn.groundEffect||Jn.groundEffect&&!Jn.groundEffect.hasData())continue;const yn=Jn.groundEffect,Qr=1/Jn.tileToMeter;{const Dn=d.translatePosMatrix(Cn.projMatrix,Nn,Br,Xr),bn=yn.getDefaultSegment();wn(Cn,yn,bn,Dn,Qr)}if(Ar)for(let Dn=0;Dn<4;Dn++){const bn=c.e9[Dn](Cn),$n=_e.getTile(bn);if(!$n)continue;const ls=$n.getBucket(ot);if(!ls||ls.projection.name!==zr.projection.name||!ls.groundEffect||ls.groundEffect&&!ls.groundEffect.hasData())continue;const As=ls.groundEffect;let is,_i;Dn===0?(is=[-c.al,0,0],_i=1):Dn===1?(is=[c.al,0,0],_i=0):Dn===2?(is=[0,-c.al,0],_i=3):(is=[0,c.al,0],_i=2);const Ls=As.regionSegments[_i];if(!Ls)continue;const Bs=new Float32Array(16);c.br(Bs,Cn.projMatrix,is),wn(Cn,As,Ls,d.translatePosMatrix(Bs,Nn,Br,Xr),Qr)}}}function x2(st,d,_e,ot,ut,mt,xt){ot.centroidVertexArray.length===0&&ot.createCentroidsBuffer();const Tt=mt?mt.findDEMTileFor(_e):null;if(!(Tt&&Tt.dem||xt))return;mt&&Tt&&Tt.dem&&ot.selfDEMTileTimestamp!==Tt.dem._timestamp&&(ot.borderDoneWithNeighborZ=[-1,-1,-1,-1],ot.selfDEMTileTimestamp=Tt.dem._timestamp);const kt=xr=>new c.P(Math.ceil((xr+c.ed)*c.ee),0),$t=xr=>{const Ar=d.getSource().minzoom,Dr=Wr=>{const zr=d.getTileByID(Wr);if(zr&&zr.hasData())return zr.getBucket(ut)},Tr=[0,-1,1];for(const Wr of Tr){if(xr.overscaledZ+Wr<Ar)continue;const zr=Dr(xr.calculateScaledKey(xr.overscaledZ+Wr));if(zr)return zr}},Xt=[0,0,0],rr=(xr,Ar)=>(Xt[0]=Math.min(xr.min.y,Ar.min.y),Xt[1]=Math.max(xr.max.y,Ar.max.y),Xt[2]=c.al-Ar.min.x>xr.max.x?Ar.min.x-c.al:xr.max.x,Xt),tr=(xr,Ar)=>(Xt[0]=Math.min(xr.min.x,Ar.min.x),Xt[1]=Math.max(xr.max.x,Ar.max.x),Xt[2]=c.al-Ar.min.y>xr.max.y?Ar.min.y-c.al:xr.max.y,Xt),nr=[(xr,Ar)=>rr(xr,Ar),(xr,Ar)=>rr(Ar,xr),(xr,Ar)=>tr(xr,Ar),(xr,Ar)=>tr(Ar,xr)],cr=(xr,Ar,Dr,Tr,Wr,zr,$r)=>{if(!mt)return 0;const Or=[[zr?Dr:xr,zr?xr:Dr,0],[zr?Dr:Ar,zr?Ar:Dr,0]],Br=$r<0?c.al+$r:$r,Xr=[zr?Br:(xr+Ar)/2,zr?(xr+Ar)/2:Br,0];return Dr===0&&$r<0||Dr!==0&&$r>0?mt.getForTilePoints(Wr,[Xr],!0,Tr):Or.push(Xr),mt.getForTilePoints(_e,Or,!0,Tt),Math.max(Or[0][2],Or[1][2],Xr[2])/mt.exaggeration()};for(let xr=0;xr<4;xr++){const Ar=ot.borderFeatureIndices[xr];if(Ar.length===0)continue;const Dr=c.e9[xr](_e),Tr=$t(Dr);if(!(Tr&&Tr instanceof c.ea))continue;const Wr=mt?mt.findDEMTileFor(Dr):null;if(!(Wr&&Wr.dem||xt)||(mt&&Wr&&Wr.dem&&ot.borderDEMTileTimestamp[xr]!==Wr.dem._timestamp&&(ot.borderDoneWithNeighborZ[xr]=-1,ot.borderDEMTileTimestamp[xr]=Wr.dem._timestamp),ot.borderDoneWithNeighborZ[xr]===Tr.canonical.z))continue;Tr.centroidVertexArray.length===0&&Tr.createCentroidsBuffer();const zr=(xr<2?1:5)-xr,$r=Tr.borderDoneWithNeighborZ[zr]!==ot.canonical.z,Or=Tr.borderFeatureIndices[zr];let Br=0;if(ot.canonical.z!==Tr.canonical.z){for(const Xr of Ar)ot.showCentroid(ot.featuresOnBorder[Xr]);if($r)for(const Xr of Or)Tr.showCentroid(Tr.featuresOnBorder[Xr]);ot.borderDoneWithNeighborZ[xr]=Tr.canonical.z,Tr.borderDoneWithNeighborZ[zr]=ot.canonical.z}for(const Xr of Ar){const an=ot.featuresOnBorder[Xr],sn=ot.centroidData[an.centroidDataIndex],wn=an.borders[xr];let Cn;for(;Br<Or.length;){Cn=Tr.featuresOnBorder[Or[Br]];const Nn=Cn.borders[zr];if(Nn[1]>wn[0]+3||Nn[0]>wn[0]-3)break;Tr.showCentroid(Cn),Br++}if(Cn&&Br<Or.length){const Nn=Br;let Jn=0;for(;!(Cn.borders[zr][0]>wn[1]-3)&&(Jn++,++Br!==Or.length);)Cn=Tr.featuresOnBorder[Or[Br]];Cn=Tr.featuresOnBorder[Or[Nn]];let yn=!1;if(Jn>=1){const bn=Cn.borders[zr];Math.abs(wn[0]-bn[0])<3&&Math.abs(wn[1]-bn[1])<3&&(Jn=1,yn=!0,Br=Nn+1)}else if(Jn===0){ot.showCentroid(an);continue}const Qr=Tr.centroidData[Cn.centroidDataIndex];xt&&yn&&(((lr=sn).flags|(yr=Qr).flags)&c.ec?(lr.flags|=c.ec,yr.flags|=c.ec):(lr.flags&=~c.ec,yr.flags&=~c.ec));const Dn=an.intersectsCount()>1||Cn.intersectsCount()>1;if(Jn>1)Br=Nn,sn.centroidXY=Qr.centroidXY=new c.P(0,0);else if(Wr&&Wr.dem&&!Dn){const bn=nr[xr](sn,Qr),$n=xr%2?c.al-1:0,ls=cr(bn[0],Math.min(c.al-1,bn[1]),$n,Wr,Dr,xr<2,bn[2]);sn.centroidXY=Qr.centroidXY=kt(ls)}else Dn?sn.centroidXY=Qr.centroidXY=new c.P(0,0):(sn.centroidXY=ot.encodeBorderCentroid(an),Qr.centroidXY=Tr.encodeBorderCentroid(Cn));ot.writeCentroidToBuffer(sn),Tr.writeCentroidToBuffer(Qr)}else ot.showCentroid(an)}ot.borderDoneWithNeighborZ[xr]=Tr.canonical.z,Tr.borderDoneWithNeighborZ[zr]=ot.canonical.z}var lr,yr;(ot.needsCentroidUpdate||!ot.centroidVertexBuffer&&ot.centroidVertexArray.length!==0)&&ot.uploadCentroid(st)}const Yp=[1,0,0],iv=[0,1,0],Mp=[0,0,1];function om(st,d,_e){const ot=_e.transform,ut=_e.shadowRenderer;if(!ut)return!0;const mt=st.toUnwrapped(),xt=ot.tileSize*ut._cascades[_e.currentShadowCascade].scale;let Tt=d;if(ot.elevation){const lr=ot.elevation.getMinMaxForTile(st);lr&&(Tt+=lr.max)}const kt=[...ut.shadowDirection];kt[2]=-kt[2];const $t=ut.computeSimplifiedTileShadowVolume(mt,Tt,xt,kt);if(!$t)return!1;const Xt=[Yp,iv,Mp,kt,[kt[0],0,kt[2]],[0,kt[1],kt[2]]],rr=ot.projection.name==="globe",tr=ot.scaleZoom(xt),nr=c.cB.fromInvProjectionMatrix(ot.invProjMatrix,ot.worldSize,tr,!rr),cr=ut.getCurrentCascadeFrustum();return nr.intersectsPrecise($t.vertices,$t.planes,Xt)===0||cr.intersectsPrecise($t.vertices,$t.planes,Xt)===0}function w1(st){const{painter:d,source:_e,layer:ot,coords:ut}=st;let mt=st.defines;const xt=d.context,Tt=d.renderPass==="shadow",kt=d.renderPass==="light-beam",$t=d.shadowRenderer,Xt=c.ef(d.transform.center.lat,d.transform.zoom),rr=Er(d,ot.paint.get("building-cutoff-fade-range"));rr.shouldRenderCutoff&&(mt=mt.concat("RENDER_CUTOFF")),st.floodLightIntensity>0&&(mt=mt.concat("FLOOD_LIGHT"));for(const tr of ut){const nr=_e.getTile(tr),cr=nr.getBucket(ot);if(!cr)continue;$t&&$t.getMaxCascadeForTile(tr.toUnwrapped())===0&&(mt=mt.concat("SHADOWS_SINGLE_CASCADE"));const lr=cr.programConfigurations.get(ot.id);let yr,xr,Ar,Dr=d.translatePosMatrix(tr.expandedProjMatrix,nr,[0,0],"map");if(Dr=c.cS(c.bC(),Dr,[1,1,st.verticalScale]),Tt&&$t){if(om(nr.tileID,cr.maxHeight*Xt,d))continue;let Wr=$t.calculateShadowPassMatrixFromTile(nr.tileID.toUnwrapped());Wr=c.cS(c.bC(),Wr,[1,1,st.verticalScale]),Ar=Nm(Wr),yr=xr=d.getOrCreateProgram("buildingDepth",{config:lr,defines:mt,overrideFog:!1})}else if(kt)yr=xr=d.getOrCreateProgram("buildingBloom",{config:lr,defines:mt,overrideFog:!1}),Ar=PE(Dr);else{const Wr=d.transform.calculatePosMatrix(tr.toUnwrapped(),d.transform.worldSize);c.cS(Wr,Wr,[1,1,st.verticalScale]);const zr=c.bC();c.cS(zr,Wr,[1,-1,1/Xt]),c.bl(zr,zr),c.eg(zr,zr);const $r=d.transform.getFreeCameraOptions().position,Or=1<<tr.canonical.z;if(Ar=vy(Dr,zr,st.opacity,st.facadeAOIntensity,[(($r.x-tr.wrap)*Or-tr.canonical.x)*c.al,($r.y*Or-tr.canonical.y)*c.al,$r.z*Or*c.al],cr.tileToMeter,st.facadeEmissiveChance,st.floodLightColor,st.floodLightIntensity),xr=d.getOrCreateProgram("building",{config:lr,defines:mt,overrideFog:!1}),st.depthOnly===!0)yr=xr;else{const Br=mt.concat(["BUILDING_FAUX_FACADE","HAS_ATTRIBUTE_a_faux_facade_color_emissive"]);yr=d.getOrCreateProgram("building",{config:lr,defines:Br,overrideFog:!1})}$t&&($t.setupShadowsFromMatrix(Wr,xr,!0),yr!==xr&&$t.setupShadowsFromMatrix(Wr,yr,!0))}const Tr=(Wr,zr)=>{if(kt){const $r=Wr.entranceBloom;zr.draw(d,xt.gl.TRIANGLES,st.depthMode,oo.disabled,st.blendMode,wr.disabled,Ar,ot.id,$r.layoutVertexBuffer,$r.indexBuffer,$r.segmentsBucket,ot.paint,d.transform.zoom,lr,[$r.layoutAttenuationBuffer,$r.layoutColorBuffer])}else{const $r=Wr.segmentsBucket;let Or=[Wr.layoutNormalBuffer,Wr.layoutCentroidBuffer,Wr.layoutColorBuffer,Wr.layoutFloodLightDataBuffer];Wr.layoutFacadePaintBuffer&&(Or=Or.concat([Wr.layoutFacadeDataBuffer,Wr.layoutFacadeVerticalRangeBuffer,Wr.layoutFacadePaintBuffer])),zr.draw(d,xt.gl.TRIANGLES,st.depthMode,oo.disabled,st.blendMode,Tt?wr.disabled:wr.backCW,Ar,ot.id,Wr.layoutVertexBuffer,Wr.indexBuffer,$r,ot.paint,d.transform.zoom,lr,Or)}};d.uploadCommonUniforms(xt,xr,tr.toUnwrapped(),null,rr),cr.buildingWithoutFacade&&Tr(cr.buildingWithoutFacade,xr),cr.buildingWithFacade&&(yr!==xr&&d.uploadCommonUniforms(xt,yr,tr.toUnwrapped(),null,rr),Tr(cr.buildingWithFacade,yr))}}function Ry(st,d,_e,ot,ut,mt,xt,Tt,kt,$t,Xt,rr,tr){const nr=st.context.gl,cr=st.depthModeForSublayer(1,Us.ReadOnly,nr.LEQUAL,!0),lr=.1*(1-(yr=Xt))+3*yr;var yr;const xr=st._showOverdrawInspector,Ar=rr,Dr=new nv;xr||sm(Dr,st,d,_e,ot,cr,new oo({func:nr.ALWAYS,mask:255},255,255,nr.KEEP,nr.KEEP,nr.REPLACE),new co([nr.ONE,nr.ONE,nr.ONE,nr.ONE],c.ao.transparent,[!1,!1,!1,!0],nr.MIN),wr.disabled,ut,"sdf",mt,xt,Tt,kt,$t,lr,Ar,!1);{const Tr=xr?oo.disabled:new oo({func:nr.EQUAL,mask:255},255,255,nr.KEEP,nr.DECR,nr.DECR),Wr=xr?st.colorModeForRenderPass():new co([nr.ONE_MINUS_DST_ALPHA,nr.DST_ALPHA,nr.ONE,nr.ONE],c.ao.transparent,[!0,!0,!0,!0]);sm(Dr,st,d,_e,ot,cr,Tr,Wr,wr.disabled,ut,"color",mt,xt,Tt,kt,$t,lr,Ar,!1)}}function Iy(st){return[st[0]*c.eh,st[1]*c.eh,st[2]*c.eh,0]}function C1(st,d,_e,ot,ut,mt,xt,Tt,kt){const $t=ot.getSource(),Xt=_e.globeSharedBuffers;if(!Xt)return;let rr,tr,nr;if(d&&(rr=ot.getTile(d)),$t instanceof c.aU?(tr=$t.texture,nr=c.dK(0,0,_e.transform)):rr&&d&&(tr=rr.texture,nr=c.dK(d.canonical.z,d.canonical.x,_e.transform)),!tr||!nr)return;st||(nr=c.cS(c.bC(),nr,[1,-1,1]));const cr=_e.context,lr=cr.gl,yr=ut.paint.get("raster-resampling")==="nearest"?lr.NEAREST:lr.LINEAR,xr=_e.colorModeForDrapableLayerRenderPass(mt),Ar=xt.defines;Ar.push("GLOBE_POLES");const Dr=new Us(lr.LEQUAL,Us.ReadWrite,_e.depthRangeFor3D),Tr=Float32Array.from(_e.transform.expandedFarZProjMatrix),Wr=Float32Array.from(c.bk(c.dJ(new c.cD(0,0,0))));_e.terrain&&_e.terrain.prepareDrawTile(),cr.activeTexture.set(lr.TEXTURE0),tr.bind(yr,lr.CLAMP_TO_EDGE),cr.activeTexture.set(lr.TEXTURE1),tr.bind(yr,lr.CLAMP_TO_EDGE),"useMipmap"in tr&&cr.extTextureFilterAnisotropic&&_e.transform.pitch>20&&lr.texParameterf(lr.TEXTURE_2D,cr.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,cr.extTextureFilterAnisotropicMax);const[zr,$r,Or,Br]=d?Xt.getPoleBuffers(d.canonical.z,!1):Xt.getPoleBuffers(0,!0),Xr=ut.paint.get("raster-elevation");let an;st?(an=zr,_e.renderDefaultNorthPole=Xr!==0):(an=$r,_e.renderDefaultSouthPole=Xr!==0);const sn=Iy(xt.mix),wn=((Nn,Jn,yn,Qr,Dn,bn,$n,ls,As,is,_i,Ls,Bs)=>BE(Nn,Jn,yn,new Float32Array(16),new Float32Array(9),[0,0],Qr,[0,0],[0,0,0,0],1,{opacity:1,mix:0},bn,[0,0],ls,2,is,_i,Ls,1,0,Bs))(Tr,Wr,nr,c.aj(_e.transform.zoom),0,ut,0,Xr,0,sn,xt.offset,xt.range,mt),Cn=_e.getOrCreateProgram("raster",{defines:Ar});_e.uploadCommonUniforms(cr,Cn,null),Cn.draw(_e,lr.TRIANGLES,Dr,kt,xr,Tt,wn,ut.id,an,Or,Br)}function VE(st){const d=st._nearZ,_e=st.projection.farthestPixelDistance(st),ot=_e-d,ut=.2*st.height,mt=d+ut;return[d,_e,(mt-ut-d)/ot,(mt-d)/ot]}function am(st,d,_e,ot){if(st)return d instanceof Un&&st instanceof _a?d.getTextureDescriptor(st,_e,!0):{texture:st.texture,mix:Iy(ot.mix),offset:ot.offset,buffer:0,tileSize:1}}var ou=c.ei([{name:"a_index",type:"Int16",components:1}]);class Dy{constructor(d,_e,ot,ut){const mt={width:ot[0],height:ot[1],data:null},xt=d.gl;this.targetColorTexture=new c.T(d,mt,xt.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new c.T(d,mt,xt.RGBA8,{useMipmap:!1}),this.context=d,this.updateParticleTexture(_e,ut),this.lastInvalidatedAt=0}updateParticleTexture(d,_e){if(this.particleTextureDimension===_e.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const ot=this.context.gl,ut=_e.width*_e.height;this.particleTexture0=new c.T(this.context,_e,ot.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new c.T(this.context,_e,ot.RGBA8,{premultiply:!1,useMipmap:!1});const mt=new c.ej;mt.reserve(ut);for(let xt=0;xt<ut;xt++)mt.emplaceBack(xt);this.particleIndexBuffer=this.context.createVertexBuffer(mt,ou.members,!0),this.particleSegment=c.bg.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=_e.width}update(d){return!(this.lastInvalidatedAt<d&&(this.lastInvalidatedAt=c.o.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function sv(st,d,_e){if(!st)return null;const ot=d.getTextureDescriptor(st,_e,!0);if(!ot)return null;let{texture:ut,mix:mt,offset:xt,tileSize:Tt,buffer:kt,format:$t}=ot;if(!ut||!$t)return null;let Xt=!1;return $t==="uint32"&&(Xt=!0,mt[3]=0,mt=Ey(c.ek,mt,[0,_e.paint.get("raster-particle-max-speed")]),xt=by(c.ek,xt,[0,_e.paint.get("raster-particle-max-speed")])),{texture:ut,textureOffset:[kt/(Tt+2*kt),Tt/(Tt+2*kt)],tileSize:Tt,scalarData:Xt,scale:mt,offset:xt,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[$t]]}}function UE(st){const d=st._nearZ,_e=st.projection.farthestPixelDistance(st),ot=_e-d,ut=.2*st.height,mt=d+ut;return[d,_e,(mt-ut-d)/ot,(mt-d)/ot]}const GE=new c.ao(1,0,0,1),$E=new c.ao(0,1,0,1),HE=new c.ao(0,0,1,1),ox=new c.ao(1,0,1,1),ax=new c.ao(0,1,1,1);function ns(st,d,_e,ot,ut,mt){for(let xt=0;xt<_e.length;xt++)if(ut){const $t=new c.ao(ot.r*.8,ot.g*.8,ot.b*.8,1);hs(st,d,_e[xt],ot,-1,-1,mt),hs(st,d,_e[xt],ot,-1,1,mt),hs(st,d,_e[xt],ot,1,1,mt),hs(st,d,_e[xt],ot,1,-1,mt),hs(st,d,_e[xt],$t,0,0,mt)}else hs(st,d,_e[xt],ot,0,0,mt)}function hs(st,d,_e,ot,ut,mt,xt){const Tt=st.context,kt=st.transform,$t=Tt.gl,Xt=kt.projection.name==="globe",rr=Xt?["PROJECTION_GLOBE_VIEW"]:[];let tr=c.bz(_e.projMatrix);if(Xt&&c.aj(kt.zoom)>0){const sn=c.bj(_e.canonical,kt),wn=c.el(sn);tr=c.aB(new Float32Array(16),kt.globeMatrix,wn),c.aB(tr,kt.projMatrix,tr)}const nr=c.bC();nr[12]+=2*ut/(c.o.devicePixelRatio*kt.width),nr[13]+=2*mt/(c.o.devicePixelRatio*kt.height),c.aB(tr,nr,tr);const cr=st.getOrCreateProgram("debug",{defines:rr}),lr=d.getTileByID(_e.key);st.terrain&&st.terrain.setupElevationDraw(lr,cr);const yr=Us.disabled,xr=oo.disabled,Ar=st.colorModeForRenderPass(),Dr="$debug";Tt.activeTexture.set($t.TEXTURE0),st.emptyTexture.bind($t.LINEAR,$t.CLAMP_TO_EDGE),Xt?lr._makeGlobeTileDebugBuffers(st.context,kt):lr._makeDebugTileBoundsBuffers(st.context,kt.projection);const Tr=lr._tileDebugBuffer||st.debugBuffer,Wr=lr._tileDebugIndexBuffer||st.debugIndexBuffer,zr=lr._tileDebugSegments||st.debugSegments;if(cr.draw(st,$t.LINE_STRIP,yr,xr,Ar,wr.disabled,_1(tr,ot.toPremultipliedRenderColor(null)),Dr,Tr,Wr,zr,null,null,null,[lr._globeTileDebugBorderBuffer]),xt){const sn=lr.latestRawTileData,wn=Math.floor((sn&&sn.byteLength||0)/1024);let Cn=_e.canonical.toString();_e.overscaledZ!==_e.canonical.z&&(Cn+=` => ${_e.overscaledZ}`),Cn+=` ${lr.state}`,Cn+=` ${wn}kb`,function(Nn,Jn){Nn.initDebugOverlayCanvas();const yn=Nn.debugOverlayCanvas,Qr=Nn.context.gl,Dn=Nn.debugOverlayCanvas.getContext("2d");Dn.clearRect(0,0,yn.width,yn.height),Dn.shadowColor="white",Dn.shadowBlur=2,Dn.lineWidth=1.5,Dn.strokeStyle="white",Dn.textBaseline="top",Dn.font="bold 36px Open Sans, sans-serif",Dn.fillText(Jn,5,5),Dn.strokeText(Jn,5,5),Nn.debugOverlayTexture.update(yn),Nn.debugOverlayTexture.bind(Qr.LINEAR,Qr.CLAMP_TO_EDGE)}(st,Cn)}const $r=d.getTile(_e).tileSize,Or=512/Math.min($r,512)*(_e.overscaledZ/kt.zoom)*.5,Br=lr._tileDebugTextBuffer||st.debugBuffer,Xr=lr._tileDebugTextIndexBuffer||st.quadTriangleIndexBuffer,an=lr._tileDebugTextSegments||st.debugSegments;cr.draw(st,$t.TRIANGLES,yr,xr,co.alphaBlended,wr.disabled,_1(tr,c.ao.transparent.toPremultipliedRenderColor(null),Or),Dr,Br,Xr,an,null,null,null,[lr._globeTileDebugTextBuffer])}function lx(st,d,_e,ot){mn(st,0,d+_e/2,st.transform.width,_e,ot)}function Fu(st,d,_e,ot){mn(st,d-_e/2,0,_e,st.transform.height,ot)}function mn(st,d,_e,ot,ut,mt){const xt=st.context,Tt=xt.gl;Tt.enable(Tt.SCISSOR_TEST),Tt.scissor(d*c.o.devicePixelRatio,_e*c.o.devicePixelRatio,ot*c.o.devicePixelRatio,ut*c.o.devicePixelRatio),xt.clear({color:mt}),Tt.disable(Tt.SCISSOR_TEST)}const WE=c.ei([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Py}=WE;function H0(st,d,_e,ot){st.emplaceBack(d,_e,ot)}class ky{constructor(d){this.vertexArray=new c.em,this.indices=new c.b0,H0(this.vertexArray,-1,-1,1),H0(this.vertexArray,1,-1,1),H0(this.vertexArray,-1,1,1),H0(this.vertexArray,1,1,1),H0(this.vertexArray,-1,-1,-1),H0(this.vertexArray,1,-1,-1),H0(this.vertexArray,-1,1,-1),H0(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=d.createVertexBuffer(this.vertexArray,Py),this.indexBuffer=d.createIndexBuffer(this.indices),this.segment=c.bg.simpleSegment(0,0,36,12)}}function ux(st,d,_e,ot,ut,mt){const xt=st.context.gl,Tt=d.paint.get("sky-atmosphere-color"),kt=d.paint.get("sky-atmosphere-halo-color"),$t=d.paint.get("sky-atmosphere-sun-intensity"),Xt=((rr,tr,nr,cr,lr)=>({u_matrix_3f:rr,u_sun_direction:tr,u_sun_intensity:nr,u_color_tint_r:[cr.r,cr.g,cr.b,cr.a],u_color_tint_m:[lr.r,lr.g,lr.b,lr.a],u_luminance:5e-5}))(c.eo(c.dO(),ot),ut,$t,Tt.toPremultipliedRenderColor(null),kt.toPremultipliedRenderColor(null));xt.framebufferTexture2D(xt.FRAMEBUFFER,xt.COLOR_ATTACHMENT0,xt.TEXTURE_CUBE_MAP_POSITIVE_X+mt,d.skyboxTexture,0),_e.draw(st,xt.TRIANGLES,Us.disabled,oo.disabled,co.unblended,wr.frontCW,Xt,"skyboxCapture",d.skyboxGeometry.vertexBuffer,d.skyboxGeometry.indexBuffer,d.skyboxGeometry.segment)}const qE=c.ei([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Ux{constructor(d){const _e=new c.ep;_e.emplaceBack(-1,1,1,0,0),_e.emplaceBack(1,1,1,1,0),_e.emplaceBack(1,-1,1,1,1),_e.emplaceBack(-1,-1,1,0,1);const ot=new c.b0;ot.emplaceBack(0,1,2),ot.emplaceBack(2,3,0),this.vertexBuffer=d.createVertexBuffer(_e,qE.members),this.indexBuffer=d.createIndexBuffer(ot),this.segments=c.bg.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const g2=c.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class y2{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class XE{constructor(d){this.colorModeAlphaBlendedWriteRGB=new co([1,i0,1,i0],c.ao.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new co([1,0,1,0],c.ao.transparent,[!1,!1,!1,!0]),this.params=new y2,this.updateNeeded=!0}update(d){const _e=d.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Ux(_e);const ot=this.params.sizeRange,ut=this.params.intensityRange,mt=function(Xt){const rr=c.eq(30),tr=[];for(let nr=0;nr<Xt;++nr){const cr=2*Math.PI*rr(),lr=Math.acos(1-2*rr())-.5*Math.PI;tr.push(c.d5(Math.cos(lr)*Math.cos(cr),Math.cos(lr)*Math.sin(cr),Math.sin(lr)))}return tr}(this.params.starsCount),xt=c.eq(300),Tt=new c.er,kt=new c.b0;let $t=0;for(let Xt=0;Xt<mt.length;++Xt){const rr=c.c5([],mt[Xt],200),tr=Math.max(0,1+.01*ot*(1*xt()-.5)),nr=Math.max(0,1+.01*ut*(1*xt()-.5));Tt.emplaceBack(rr[0],rr[1],rr[2],-1,-1,tr,nr),Tt.emplaceBack(rr[0],rr[1],rr[2],1,-1,tr,nr),Tt.emplaceBack(rr[0],rr[1],rr[2],1,1,tr,nr),Tt.emplaceBack(rr[0],rr[1],rr[2],-1,1,tr,nr),kt.emplaceBack($t+0,$t+1,$t+2),kt.emplaceBack($t+0,$t+2,$t+3),$t+=4}this.starsVx=_e.createVertexBuffer(Tt,g2.members),this.starsIdx=_e.createIndexBuffer(kt),this.starsSegments=c.bg.simpleSegment(0,0,Tt.length,kt.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(d,_e){const ot=d.context,ut=ot.gl,mt=d.transform,xt=new Us(ut.LEQUAL,Us.ReadOnly,[0,1]),Tt=c.aj(mt.zoom),kt=d.style.getLut(_e.scope),$t=_e.properties.get("color-use-theme")==="none",Xt=_e.properties.get("color").toNonPremultipliedRenderColor($t?null:kt),rr=_e.properties.get("high-color-use-theme")==="none",tr=_e.properties.get("high-color").toNonPremultipliedRenderColor(rr?null:kt),nr=_e.properties.get("space-color-use-theme")==="none",cr=_e.properties.get("space-color").toNonPremultipliedRenderColor(nr?null:kt),lr=5e-4,yr=c.es(_e.properties.get("horizon-blend"),0,1,lr,.25),xr=c.dE(d,ot,mt)&&yr===lr?mt.worldSize/(2*Math.PI*1.025)-1:mt.globeRadius,Ar=d.frameCounter/1e3%1,Dr=c.ag(mt.globeCenterInViewSpace),Tr=Math.sqrt(Math.pow(Dr,2)-Math.pow(xr,2)),Wr=Math.acos(Tr/Dr),zr=$r=>{const Or=mt.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];$r&&Or.push("ALPHA_PASS");const Br=d.getOrCreateProgram("globeAtmosphere",{defines:Or}),Xr=((sn,wn,Cn,Nn,Jn,yn,Qr,Dn,bn,$n,ls,As)=>({u_frustum_tl:sn,u_frustum_tr:wn,u_frustum_br:Cn,u_frustum_bl:Nn,u_horizon:Jn,u_transition:yn,u_fadeout_range:Qr,u_atmosphere_fog_color:Dn.toArray01(),u_high_color:bn.toArray01(),u_space_color:$n.toArray01(),u_temporal_offset:ls,u_horizon_angle:As}))(mt.frustumCorners.TL,mt.frustumCorners.TR,mt.frustumCorners.BR,mt.frustumCorners.BL,mt.frustumCorners.horizon,Tt,yr,Xt,tr,cr,Ar,Wr);d.uploadCommonUniforms(ot,Br);const an=this.atmosphereBuffer;an&&Br.draw(d,ut.TRIANGLES,xt,oo.disabled,$r?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,wr.backCW,Xr,$r?"atmosphere_glow_alpha":"atmosphere_glow",an.vertexBuffer,an.indexBuffer,an.segments)};zr(!1),zr(!0)}drawStars(d,_e){const ot=c.aA(_e.properties.get("star-intensity"),0,1);if(ot===0)return;const ut=d.context,mt=ut.gl,xt=d.transform,Tt=d.getOrCreateProgram("stars"),kt=c.c7([]);c.c9(kt,kt,-xt._pitch),c.c8(kt,kt,-xt.angle),c.c9(kt,kt,c.an(xt._center.lat)),c.et(kt,kt,-c.an(xt._center.lng));const $t=c.cc(new Float32Array(16),kt),Xt=c.aB([],xt.starsProjMatrix,$t),rr=c.eo([],$t),tr=c.eu([],rr),nr=[0,1,0];c.dQ(nr,nr,tr),c.c5(nr,nr,this.params.sizeMultiplier);const cr=[1,0,0];c.dQ(cr,cr,tr),c.c5(cr,cr,this.params.sizeMultiplier);const lr=(yr=nr,xr=cr,Ar=ot,{u_matrix:Float32Array.from(Xt),u_up:yr,u_right:xr,u_intensity_multiplier:Ar});var yr,xr,Ar;d.uploadCommonUniforms(ut,Tt),this.starsVx&&this.starsIdx&&Tt.draw(d,mt.TRIANGLES,Us.disabled,oo.disabled,this.colorModeAlphaBlendedWriteRGB,wr.disabled,lr,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}class Fy{constructor(){this.visibleTiles=[]}updateBorders(d,_e){const ot=[],ut=[],mt=d._getRenderableCoordinates(!1,!0);for(const kt of mt){const $t=d.getTile(kt);if(!$t.hasData())continue;const Xt=$t.getBucket(_e);Xt&&(Xt.isEmpty()||(ot.push(kt.key),ut.push({bucket:Xt,tileID:kt.canonical})))}let xt=ot.length!==this.visibleTiles.length;if(!xt){ot.sort();for(let kt=0;kt<ot.length;kt++)if(ot[kt]!==this.visibleTiles[kt]){xt=!0;break}}if(!xt)return;const Tt=new Set;this.visibleTiles=ot,ut.sort((kt,$t)=>kt.tileID.z-$t.tileID.z||kt.tileID.x-$t.tileID.x||kt.tileID.y-$t.tileID.y);for(const kt of ut){const $t=new Array,Xt=new Array,rr=kt.bucket;for(const tr of rr.featuresOnBorder)Tt.has(tr.featureId)?Xt.push(tr.footprintIndex):(Tt.add(tr.featureId),$t.push(tr.footprintIndex));rr.updateFootprintHiddenFlags($t,c.ev,!1),rr.updateFootprintHiddenFlags(Xt,c.ev,!0)}}}function By(st,d){const _e=[...st],ot=d.cameraWorldSizeForFog/d.worldSize,ut=c.bA([]);return c.cS(ut,ut,[ot,ot,1]),c.aB(_e,ut,_e),c.aB(_e,d.worldToFogMatrix,_e),_e}function My(st,d,_e,ot,ut){const mt=_e.material,xt=ot.context,{baseColorTexture:Tt,metallicRoughnessTexture:kt}=mt.pbrMetallicRoughness,{normalTexture:$t,occlusionTexture:Xt,emissionTexture:rr}=mt;function tr(cr,lr,yr){if(cr&&(st.push(lr),xt.activeTexture.set(xt.gl.TEXTURE0+yr),cr.gfxTexture)){const{minFilter:xr,magFilter:Ar,wrapS:Dr,wrapT:Tr}=cr.sampler;cr.gfxTexture.bindExtraParam(xr,Ar,Dr,Tr)}}tr(Tt,"HAS_TEXTURE_u_baseColorTexture",Dt.BaseColor),tr(kt,"HAS_TEXTURE_u_metallicRoughnessTexture",Dt.MetallicRoughness),tr($t,"HAS_TEXTURE_u_normalTexture",Dt.Normal),tr(Xt,"HAS_TEXTURE_u_occlusionTexture",Dt.Occlusion),tr(rr,"HAS_TEXTURE_u_emissionTexture",Dt.Emission),ut&&(ut.texture||(ut.texture=new c.d$(ot.context,ut.image,[ut.image.height,ut.image.height,ut.image.height],xt.gl.RGBA8)),xt.activeTexture.set(xt.gl.TEXTURE0+Dt.LUT),ut.texture&&ut.texture.bind(xt.gl.LINEAR,xt.gl.CLAMP_TO_EDGE),st.push("APPLY_LUT_ON_GPU")),_e.texcoordBuffer&&(st.push("HAS_ATTRIBUTE_a_uv_2f"),d.push(_e.texcoordBuffer)),_e.colorBuffer&&(st.push(_e.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),d.push(_e.colorBuffer)),_e.normalBuffer&&(st.push("HAS_ATTRIBUTE_a_normal_3f"),d.push(_e.normalBuffer)),_e.pbrBuffer&&(st.push("HAS_ATTRIBUTE_a_pbr"),st.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),d.push(_e.pbrBuffer)),mt.alphaMode!=="OPAQUE"&&mt.alphaMode!=="MASK"||st.push("UNPREMULT_TEXTURE_IN_SHADER"),mt.defined||st.push("DIFFUSE_SHADED");const nr=ot.shadowRenderer;nr&&(st.push("RENDER_SHADOWS","DEPTH_TEXTURE"),nr.useNormalOffset&&st.push("NORMAL_OFFSET"))}function Ny(st,d,_e,ot,ut,mt){const xt=st.modelOpacity,Tt=d.context,kt=new Us(d.context.gl.LEQUAL,st.isLightMesh?Us.ReadOnly:Us.ReadWrite,d.depthRangeFor3D),$t=d.transform,Xt=st.mesh,rr=Xt.material,tr=rr.pbrMetallicRoughness,nr=d.style.fog;let cr;cr=d.transform.projection.zAxisUnit==="pixels"?[...st.nodeModelMatrix]:c.aB([],ot.zScaleMatrix,st.nodeModelMatrix),c.aB(cr,ot.negCameraPosMatrix,cr);const lr=c.bl([],cr);c.eg(lr,lr);const yr=_e.paint.get("model-color-use-theme").constantOr("default")==="none",xr=_e.paint.get("model-emissive-strength").constantOr(0),Ar=ix(new Float32Array(st.worldViewProjection),new Float32Array(cr),new Float32Array(lr),null,d,xt,tr.baseColorFactor,rr.emissiveFactor,tr.metallicFactor,tr.roughnessFactor,rr,xr,_e,void 0,void 0,st.materialOverride,st.modelColor),Dr={defines:[]},Tr=[],Wr=d.shadowRenderer;Wr&&(Wr.useNormalOffset=!1),My(Dr.defines,Tr,Xt,d,yr?null:_e.lut);let zr=null;if(nr){const Br=By(st.nodeModelMatrix,d.transform);if(zr=new Float32Array(Br),$t.projection.name!=="globe"){const Xr=Xt.aabb.min,an=Xt.aabb.max,[sn,wn]=nr.getOpacityForBounds(Br,Xr[0],Xr[1],an[0],an[1]);Dr.overrideFog=sn>=Rn||wn>=Rn}}const $r=Er(d,_e.paint.get("model-cutoff-fade-range"));$r.shouldRenderCutoff&&Dr.defines.push("RENDER_CUTOFF");const Or=d.getOrCreateProgram("model",Dr);d.uploadCommonUniforms(Tt,Or,null,zr,$r),d.renderPass!=="shadow"&&Wr&&Wr.setupShadowsFromMatrix(st.nodeModelMatrix,Or),Or.draw(d,Tt.gl.TRIANGLES,kt,ut,mt,Xt.material.doubleSided?wr.disabled:wr.backCCW,Ar,_e.id,Xt.vertexBuffer,Xt.indexBuffer,Xt.segments,_e.paint,d.transform.zoom,void 0,Tr)}function A1(st,d){return st.style._importedAsBasemap?"basemap":d.scope}function dx(st,d,_e,ot,ut,mt,xt,Tt,kt,$t){const Xt=st.transform,rr=!!d.isGeometryBloom&&d.isGeometryBloom;if(rr&&st.renderPass==="shadow")return;const tr=Xt.projection.name==="globe"?c.eD(_e,Xt):[..._e];c.aB(tr,tr,d.globalMatrix);const nr=c.aB([],ot,tr);if(d.meshes)for(const cr of d.meshes){const lr=Tt.get(cr.material.name);if(lr&&lr.opacity<=0)continue;if(cr.material.alphaMode!=="BLEND"){xt.push({mesh:cr,depth:0,modelIndex:ut,worldViewProjection:nr,nodeModelMatrix:tr,isLightMesh:rr,materialOverride:lr,modelOpacity:kt,modelColor:$t});continue}const yr=c.af([],cr.centroid,nr);!Xt.isOrthographic&&yr[2]<=0||mt.push({mesh:cr,depth:yr[2],modelIndex:ut,worldViewProjection:nr,nodeModelMatrix:tr,isLightMesh:rr,materialOverride:lr,modelOpacity:kt,modelColor:$t})}if(d.children)for(const cr of d.children)dx(st,cr,_e,ot,ut,mt,xt,Tt,kt,$t)}function F0(st,d,_e,ot){const ut=_e.shadowRenderer;if(!ut)return;const mt=ut.getShadowPassDepthMode(),xt=ut.getShadowPassColorMode(),Tt=ut.calculateShadowPassMatrixFromMatrix(d),kt=ev(Tt);_e.getOrCreateProgram("modelDepth",{defines:_e._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(_e,_e.context.gl.TRIANGLES,mt,oo.disabled,xt,wr.disabled,kt,ot.id,st.vertexBuffer,st.indexBuffer,st.segments,ot.paint,_e.transform.zoom,void 0,void 0)}function KE(st,d,_e,ot,ut,mt){for(const xt of ut){const Tt=Object.assign({},ot);Tt.part=xt;const kt={type:"Unknown",id:d,properties:Tt},$t={orientation:st.paint.get("model-rotation").evaluate(kt,_e)};mt.set(xt,$t)}}function ZE(st,d,_e,ot,ut,mt){for(const xt of ut){const Tt=Object.assign({},ot);Tt.part=xt;const kt={type:"Unknown",id:d,properties:Tt},$t={color:st.paint.get("model-color").evaluate(kt,_e),colorMix:st.paint.get("model-color-mix-intensity").evaluate(kt,_e),opacity:st.paint.get("model-opacity").evaluate(kt,_e),emissionStrength:st.paint.get("model-emissive-strength").evaluate(kt,_e)};mt.set(xt,$t)}}function YE(st,d,_e,ot,ut){let mt=!1;for(const Tt of ot)Tt.modelOpacity!==1&&(Ny(Tt,st,d,ut[Tt.modelIndex],oo.disabled,co.disabled),mt=!0);for(const Tt of ot)Ny(Tt,st,d,ut[Tt.modelIndex],Tt.modelOpacity!==1?st.stencilModeFor3D():oo.disabled,st.colorModeForRenderPass());mt&&st.resetStencilClippingMasks();const xt=co.additive;for(const Tt of _e)Ny(Tt,st,d,ut[Tt.modelIndex],oo.disabled,Tt.isLightMesh?xt:st.colorModeForRenderPass())}function QE(st,d,_e){const ot=d.updateZoomBasedPaintProperties(),ut=function(mt,xt,Tt){let kt,$t,Xt,rr=mt.terrain?mt.terrain.exaggeration():0;if(mt.terrain&&rr>0){const tr=mt.terrain,nr=tr.findDEMTileFor(Tt);nr&&nr.dem?kt=c.eF.create(tr,Tt,nr):rr=0}if(rr===0&&(xt.terrainElevationMin=0,xt.terrainElevationMax=0),rr===xt.validForExaggeration&&(rr===0||kt&&kt._demTile&&kt._demTile.tileID===xt.validForDEMTile.id&&kt._dem._timestamp===xt.validForDEMTile.timestamp))return!1;for(const tr in xt.instancesPerModel){const nr=xt.instancesPerModel[tr];for(let cr=0;cr<nr.instancedDataArray.length;++cr){const lr=(kt?rr*kt.getElevationAt(0|nr.instancedDataArray.float32[16*cr],0|nr.instancedDataArray.float32[16*cr+1],!0,!0):0)+nr.instancesEvaluatedElevation[cr];nr.instancedDataArray.float32[16*cr+6]=lr,$t=$t?Math.min(xt.terrainElevationMin,lr):lr,Xt=Xt?Math.max(xt.terrainElevationMax,lr):lr}}return xt.terrainElevationMin=$t||0,xt.terrainElevationMax=Xt||0,xt.validForExaggeration=rr,xt.validForDEMTile=kt&&kt._demTile?{id:kt._demTile.tileID,timestamp:kt._dem._timestamp}:{id:void 0,timestamp:0},!0}(st,d,_e);(ot||ut)&&(d.uploaded=!1,d.upload(st.context))}const W0={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new c.d9([0,0,0],[c.al,c.al,0])};function Np(st,d){const _e=1<<st.canonical.z,ot=d.getFreeCameraOptions().position,ut=d.elevation,mt=st.canonical.x/_e,xt=(st.canonical.x+1)/_e,Tt=st.canonical.y/_e,kt=(st.canonical.y+1)/_e;let $t=d._centerAltitude;if(ut){const nr=ut.getMinMaxForTile(st);nr&&nr.max>$t&&($t=nr.max)}const Xt=c.aA(ot.x,mt,xt)-ot.x,rr=c.aA(ot.y,Tt,kt)-ot.y,tr=c.cf($t,d.center.lat)-ot.z;return d._zoomFromMercatorZ(Math.sqrt(Xt*Xt+rr*rr+tr*tr))}function JE(st,d,_e,ot,ut,mt,xt){const Tt=st.context,kt=st.renderPass==="shadow",$t=st.shadowRenderer,Xt=kt&&$t?$t.getShadowPassDepthMode():new Us(Tt.gl.LEQUAL,Us.ReadWrite,st.depthRangeFor3D),rr=st.isTileAffectedByFog(mt),tr=st.transform.projection.name==="globe";if(_e.meshes)for(const nr of _e.meshes){const cr=tr?[]:["MODEL_POSITION_ON_GPU"],lr=[];let yr,xr,Ar;const Dr=!tr&&ot.instancedDataArray.length>20;Dr&&cr.push("INSTANCED_ARRAYS");const Tr=Er(st,d.paint.get("model-cutoff-fade-range"));if(Tr.shouldRenderCutoff&&cr.push("RENDER_CUTOFF"),kt&&$t)yr=st.getOrCreateProgram("modelDepth",{defines:cr}),xr=ev(xt.shadowTileMatrix,xt.shadowTileMatrix,Float32Array.from(_e.globalMatrix)),Ar=$t.getShadowPassColorMode();else{My(cr,lr,nr,st,d.paint.get("model-color-use-theme").constantOr("default")==="none"?null:d.lut),yr=st.getOrCreateProgram("model",{defines:cr,overrideFog:rr});const zr=nr.material,$r=zr.pbrMetallicRoughness,Or=d.paint.get("model-opacity").constantOr(1),Br=d.paint.get("model-emissive-strength").constantOr(0);xr=ix(mt.expandedProjMatrix,Float32Array.from(_e.globalMatrix),new Float32Array(16),null,st,Or,$r.baseColorFactor,zr.emissiveFactor,$r.metallicFactor,$r.roughnessFactor,zr,Br,d,ut),$t&&(xt.shadowUniformsInitialized?yr.setShadowUniformValues(Tt,$t.getShadowUniformValues()):($t.setupShadows(mt.toUnwrapped(),yr,"model-tile"),xt.shadowUniformsInitialized=!0)),Ar=Tr.shouldRenderCutoff||Or<1||zr.alphaMode!=="OPAQUE"?co.alphaBlended:co.unblended}st.uploadCommonUniforms(Tt,yr,mt.toUnwrapped(),null,Tr);const Wr=nr.material.doubleSided?wr.disabled:wr.backCCW;if(Dr)lr.push(ot.instancedDataBuffer),yr.draw(st,Tt.gl.TRIANGLES,Xt,oo.disabled,Ar,Wr,xr,d.id,nr.vertexBuffer,nr.indexBuffer,nr.segments,d.paint,st.transform.zoom,void 0,lr,ot.instancedDataArray.length);else{const zr=kt?"u_instance":"u_normal_matrix";for(let $r=0;$r<ot.instancedDataArray.length;++$r)xr[zr]=new Float32Array(ot.instancedDataArray.arrayBuffer,64*$r,16),yr.draw(st,Tt.gl.TRIANGLES,Xt,oo.disabled,Ar,Wr,xr,d.id,nr.vertexBuffer,nr.indexBuffer,nr.segments,d.paint,st.transform.zoom,void 0,lr)}}if(_e.children)for(const nr of _e.children)JE(st,d,nr,ot,ut,mt,xt)}const S1=[1,-1,1];function _2(st,d,_e,ot){if(!_e.modelManager)return!0;const ut=_e.modelManager;if(!_e.shadowRenderer)return!0;const mt=_e.shadowRenderer,xt=d.aabb;let Tt=!0,kt=st.maxHeight;if(kt===0){let Xt=0;for(const rr in st.instancesPerModel){const tr=ut.getModel(rr,ot);tr?Xt=Math.max(Xt,Math.max(Math.max(tr.aabb.max[0],tr.aabb.max[1]),tr.aabb.max[2])):Tt=!1}kt=st.maxScale*Xt*1.41+st.maxVerticalOffset,Tt&&(st.maxHeight=kt)}xt.max[2]=kt,xt.min[2]+=st.terrainElevationMin,xt.max[2]+=st.terrainElevationMax,c.af(xt.min,xt.min,d.tileMatrix),c.af(xt.max,xt.max,d.tileMatrix);const $t=xt.intersects(mt.getCurrentCascadeFrustum());return _e.currentShadowCascade===0&&(st.isInsideFirstShadowMapFrustum=$t===2),$t===0}function hu(st,d){const _e=st.uniformValues.u_cutoff_params[0],ot=st.uniformValues.u_cutoff_params[1],ut=st.uniformValues.u_cutoff_params[2],mt=st.uniformValues.u_cutoff_params[3];return ot===_e||mt===ut?1:c.aA(((d-_e)/(ot-_e)-ut)/(mt-ut),0,1)}function Go(st,d,_e,ot){if(d.pitch<20)return 1;const ut=d.getWorldToCameraMatrix();c.aB(ut,ut,st);const mt=c.bU(_e.min[0],_e.min[1],_e.min[2],1);let xt=c.aC(c.eG(),mt,ut),Tt=xt,kt=xt;mt[1]=_e.max[1],xt=c.aC(c.eG(),mt,ut),Tt=xt[1]<Tt[1]?xt:Tt,kt=xt[1]>kt[1]?xt:kt,mt[0]=_e.max[0],xt=c.aC(c.eG(),mt,ut),Tt=xt[1]<Tt[1]?xt:Tt,kt=xt[1]>kt[1]?xt:kt,mt[1]=_e.min[1],xt=c.aC(c.eG(),mt,ut),Tt=xt[1]<Tt[1]?xt:Tt,kt=xt[1]>kt[1]?xt:kt;const $t=c.aA(ot[0],0,1),Xt=100*d.pixelsPerMeter*c.aA(ot[1],0,1),rr=c.aA(ot[2],0,1),tr=c.eH(c.eG(),Tt,kt,$t),nr=Math.tan(.5*d.fovX),cr=-tr[2]*nr;if(Xt===0)return tr[1]<-Math.abs(cr)?rr:1;const lr=(-Math.abs(cr)-tr[1])/Xt,yr=(Ar,Dr,Tr)=>(1-Tr)*Ar+Tr*Dr,xr=c.aA(yr(1,rr,lr),rr,1);return yr(1,xr,c.aA((d.pitch-20)/20,0,1))}class _b{}class jm{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(d,_e,ot){{const rr=this._storage.get(_e.id);if(rr)return rr.lastUsedFrameIdx=d,rr.buf}const ut=ot.gl,mt=ut.getBufferParameter(ut.ELEMENT_ARRAY_BUFFER,ut.BUFFER_SIZE),xt=new ArrayBuffer(mt),Tt=new Int16Array(xt);ut.getBufferSubData(ut.ELEMENT_ARRAY_BUFFER,0,new Int16Array(xt));const kt=new c.eJ;for(let rr=0;rr<mt/2;rr+=3){const tr=Tt[rr],nr=Tt[rr+1],cr=Tt[rr+2];kt.emplaceBack(tr,nr),kt.emplaceBack(nr,cr),kt.emplaceBack(cr,tr)}const $t=ot.bindVertexArrayOES.current,Xt=new _b;return Xt.buf=new k0(ot,kt),Xt.lastUsedFrameIdx=d,this._storage.set(_e.id,Xt),ot.bindVertexArrayOES.set($t),Xt.buf}update(d){for(const[_e,ot]of this._storage)d-ot.lastUsedFrameIdx>30&&(ot.buf.destroy(),this._storage.delete(_e))}destroy(){for(const[d,_e]of this._storage)_e.buf.destroy(),this._storage.delete(d)}}class Gx{constructor(){this.occluderSize=30,this.depthOffset=-1e-4}}const $x=c.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class lm{constructor(d){this.revealStart=11,this.revealRange=2}}const ov=c.ei([{type:"Float32",name:"a_pos_2f",components:2}]);class av{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(d,_e){const ot=d.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const xt=new c.eK,Tt=new c.b0;xt.emplaceBack(-1,-1),xt.emplaceBack(1,-1),xt.emplaceBack(1,1),xt.emplaceBack(-1,1),Tt.emplaceBack(0,1,2),Tt.emplaceBack(0,2,3),this.vignetteVx=d.context.createVertexBuffer(xt,ov.members),this.vignetteIdx=d.context.createIndexBuffer(Tt)}const ut=c.bg.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){d.uploadCommonUniforms(d.context,ot);const xt={u_vignetteShape:(mt={vignetteShape:[_e.start,_e.range,Math.pow(10,_e.fadePower)],vignetteColor:[_e.color.r,_e.color.g,_e.color.b,_e.color.a*_e.strength]}).vignetteShape,u_vignetteColor:mt.vignetteColor};ot.draw(d,d.context.gl.TRIANGLES,Us.disabled,oo.disabled,co.alphaBlended,wr.disabled,xt,"vignette",this.vignetteVx,this.vignetteIdx,ut)}var mt}}class lv{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(d,_e){const ot=d.getFreeCameraOptions().position,ut=ot.toAltitude(),mt=ot.toLngLat(),xt=c.an(mt.lng),Tt=c.an(mt.lat),kt=d.pixelsPerMeter/_e,$t=xt*c.eM,Xt=c.eM*Math.log(Math.tan(Math.PI/4+Tt/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const rr=-this._offsetYPrev+Xt,tr=-this._elevationPrev+ut;this._accumulatedOffsetX+=(-this._offsetXPrev+$t)*kt,this._accumulatedOffsetY+=rr*kt,this._accumulatedElevation+=tr*kt,this._offsetXPrev=$t,this._offsetYPrev=Xt,this._elevationPrev=ut}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function Oy(st,d){return[-(st[0]-Math.floor(st[0]/d)*d),-(st[1]-Math.floor(st[1]/d)*d),-(st[2]-Math.floor(st[2]/d)*d)]}function a0(st){const d=c.eq(1323123451230),_e=[];for(let ot=0;ot<st;++ot){const ut=2*d()-1,mt=2*d()-1,xt=2*d()-1;_e.push(c.d5(ut,mt,xt))}return _e}function $p(st,d,_e,ot,ut){const mt=c.aA((ut-_e)/(ot-_e),0,1);return(1-mt)*st+mt*d}class hx{constructor(d){this._movement=new lv,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new av,this._ppmScaleFactor=d}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(d,_e){const ot=d.transform;this._movement.update(ot,this._ppmScaleFactor);const ut=ot.starsProjMatrix,mt=c.c7([]);c.c9(mt,mt,c.an(90)-ot._pitch),c.c8(mt,mt,-ot.angle);const xt=c.cc(new Float32Array(16),mt),Tt=c.eL(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),kt=c.eg([],Tt),$t=c.aB([],kt,xt),Xt=Date.now()/1e3;return this._accumulatedTimeFromStart+=(Xt-this._prevTime)*_e,this._prevTime=Xt,{projectionMatrix:ut,modelviewMatrix:$t}}}class Ly extends hx{constructor(d){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new lm("Precipitation > Rain"),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(d){const _e=d.context;if(!this.particlesVx){const ot=a0(this.particlesCount),ut=new c.eN,mt=new c.b0;let xt=0;const Tt=c.eq(1323123451230);for(let kt=0;kt<ot.length;++kt){const $t=ot[kt],Xt=[2*Tt()-1,Tt(),Tt(),Tt()];ut.emplaceBack($t[0],$t[1],$t[2],-1,-1,...Xt),ut.emplaceBack($t[0],$t[1],$t[2],1,-1,...Xt),ut.emplaceBack($t[0],$t[1],$t[2],1,1,...Xt),ut.emplaceBack($t[0],$t[1],$t[2],-1,1,...Xt),mt.emplaceBack(xt+0,xt+1,xt+2),mt.emplaceBack(xt+0,xt+2,xt+3),xt+=4}this.particlesVx=_e.createVertexBuffer(ut,$x.members),this.particlesIdx=_e.createIndexBuffer(mt)}}draw(d){if(!this._params.overrideStyleParameters&&!d.style.rain)return;const _e=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},ot=d.transform.zoom;if(_e.revealStart>ot)return;const ut=$p(0,1,_e.revealStart,_e.revealStart+_e.revealRange,ot);if(!this.particlesVx||!this.particlesIdx)return;const mt=structuredClone(this._params);let xt=[-mt.direction.x,mt.direction.y,-100];c.aw(xt,xt);const Tt=structuredClone(this._vignetteParams);Tt.strength*=ut,mt.overrideStyleParameters||(mt.intensity=d.style.rain.state.density,mt.timeFactor=d.style.rain.state.intensity,mt.color=structuredClone(d.style.rain.state.color),xt=structuredClone(d.style.rain.state.direction),mt.screenThinning.intensity=d.style.rain.state.centerThinning,mt.dropletSizeX=d.style.rain.state.dropletSize[0],mt.dropletSizeYScale=d.style.rain.state.dropletSize[1]/d.style.rain.state.dropletSize[0],mt.distortionStrength=100*d.style.rain.state.distortionStrength,Tt.strength=1,Tt.color=structuredClone(d.style.rain.state.vignetteColor));const kt=this.updateOnRender(d,mt.timeFactor),$t=d.context,Xt=$t.gl,rr=d.transform;this.screenTexture&&this.screenTexture.size[0]===d.width&&this.screenTexture.size[1]===d.height||(this.screenTexture=new c.T($t,{width:d.width,height:d.height,data:null},Xt.RGBA8)),mt.distortionStrength>0&&($t.activeTexture.set(Xt.TEXTURE0),this.screenTexture.bind(Xt.LINEAR,Xt.CLAMP_TO_EDGE),Xt.copyTexSubImage2D(Xt.TEXTURE_2D,0,0,0,0,0,d.width,d.height));const tr=d.getOrCreateProgram("rainParticle");d.uploadCommonUniforms($t,tr),$t.activeTexture.set(Xt.TEXTURE0),this.screenTexture.bind(Xt.LINEAR,Xt.CLAMP_TO_EDGE);const nr=[mt.color.r,mt.color.g,mt.color.b,mt.color.a],cr=(lr,yr)=>{const xr=Oy(this._movement.getPosition(),lr),Ar=mt.dropletSizeX,Dr=mt.dropletSizeX*mt.dropletSizeYScale,Tr=d.width/2,Wr=d.height/2,zr=$p(0,mt.screenThinning.start,0,1,mt.screenThinning.intensity),$r=$p(.001,mt.screenThinning.range,0,1,mt.screenThinning.intensity),Or=$p(0,mt.screenThinning.particleOffset,0,1,mt.screenThinning.intensity),Br=(Xr={modelview:kt.modelviewMatrix,projection:kt.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:xr,velocityConeAperture:mt.velocityConeAperture,velocity:mt.velocity,boxSize:lr,rainDropletSize:[Ar,Dr],distortionStrength:mt.distortionStrength,rainDirection:xt,color:nr,screenSize:[rr.width,rr.height],thinningCenterPos:[Tr,Wr],thinningShape:[zr,$r,Math.pow(10,mt.screenThinning.fadePower)],thinningAffectedRatio:mt.screenThinning.affectedRatio,thinningParticleOffset:Or,shapeDirectionalPower:mt.shapeDirPower,shapeNormalPower:mt.shapeNormalPower,mode:yr?0:1},{u_modelview:Float32Array.from(Xr.modelview),u_projection:Float32Array.from(Xr.projection),u_time:Xr.time,u_cam_pos:Xr.camPos,u_texScreen:0,u_velocityConeAperture:Xr.velocityConeAperture,u_velocity:Xr.velocity,u_boxSize:Xr.boxSize,u_rainDropletSize:Xr.rainDropletSize,u_distortionStrength:Xr.distortionStrength,u_rainDirection:Xr.rainDirection,u_color:Xr.color,u_screenSize:Xr.screenSize,u_thinningCenterPos:Xr.thinningCenterPos,u_thinningShape:Xr.thinningShape,u_thinningAffectedRatio:Xr.thinningAffectedRatio,u_thinningParticleOffset:Xr.thinningParticleOffset,u_shapeDirectionalPower:Xr.shapeDirectionalPower,u_shapeNormalPower:Xr.shapeNormalPower,u_mode:Xr.mode});var Xr;const an=Math.round(mt.intensity*this.particlesCount),sn=c.bg.simpleSegment(0,0,4*an,2*an);tr.draw(d,Xt.TRIANGLES,Us.disabled,oo.disabled,co.alphaBlended,wr.disabled,Br,"rain_particles",this.particlesVx,this.particlesIdx,sn)};mt.distortionStrength>0&&cr(mt.boxSize,!0),cr(mt.boxSize,!1),this._vignette.draw(d,Tt)}}const cv=c.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class uv extends hx{constructor(d){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new lm("Precipitation > Snow"),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(d){const _e=d.context;if(!this.particlesVx){const ot=a0(this.particlesCount),ut=new c.eO,mt=new c.b0;let xt=0;const Tt=c.eq(1323123451230);for(let kt=0;kt<ot.length;++kt){const $t=ot[kt],Xt=Tt(),rr=Tt(),tr=Tt(),nr=[kt/ot.length,Xt,rr,tr],cr=[Tt(),Tt()];ut.emplaceBack($t[0],$t[1],$t[2],-1,-1,...nr,...cr),ut.emplaceBack($t[0],$t[1],$t[2],1,-1,...nr,...cr),ut.emplaceBack($t[0],$t[1],$t[2],1,1,...nr,...cr),ut.emplaceBack($t[0],$t[1],$t[2],-1,1,...nr,...cr),mt.emplaceBack(xt+0,xt+1,xt+2),mt.emplaceBack(xt+0,xt+2,xt+3),xt+=4}this.particlesVx=_e.createVertexBuffer(ut,cv.members),this.particlesIdx=_e.createIndexBuffer(mt)}}draw(d){if(!this._params.overrideStyleParameters&&!d.style.snow)return;const _e=structuredClone(this._params);let ot=[-_e.direction.x,_e.direction.y,-100];c.aw(ot,ot);const ut=structuredClone(this._vignetteParams),mt=_e.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},xt=d.transform.zoom;if(mt.revealStart>xt)return;const Tt=$p(0,1,mt.revealStart,mt.revealStart+mt.revealRange,xt);ut.strength*=Tt,_e.overrideStyleParameters||(_e.intensity=d.style.snow.state.density,_e.timeFactor=d.style.snow.state.intensity,_e.color=structuredClone(d.style.snow.state.color),ot=structuredClone(d.style.snow.state.direction),_e.screenThinning.intensity=d.style.snow.state.centerThinning,_e.billboardSize=2.79*d.style.snow.state.flakeSize,ut.strength=1,ut.color=structuredClone(d.style.snow.state.vignetteColor));const kt=this.updateOnRender(d,_e.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const $t=d.context,Xt=$t.gl,rr=d.transform,tr=d.getOrCreateProgram("snowParticle");d.uploadCommonUniforms($t,tr),((nr,cr,lr)=>{const yr=Oy(this._movement.getPosition(),nr),xr=rr.width/2,Ar=rr.height/2,Dr=$p(0,lr.screenThinning.start,0,1,lr.screenThinning.intensity),Tr=$p(.001,lr.screenThinning.range,0,1,lr.screenThinning.intensity),Wr=$p(0,lr.screenThinning.particleOffset,0,1,lr.screenThinning.intensity),zr=($r={modelview:kt.modelviewMatrix,projection:kt.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:yr,velocityConeAperture:lr.velocityConeAperture,velocity:lr.velocity,horizontalOscillationRadius:lr.horizontalOscillationRadius,horizontalOscillationRate:lr.horizontalOscillationRate,boxSize:nr,billboardSize:1*lr.billboardSize,simpleShapeParameters:[lr.shapeFadeStart,lr.shapeFadePower],screenSize:[rr.width,rr.height],thinningCenterPos:[xr,Ar],thinningShape:[Dr,Tr,Math.pow(10,lr.screenThinning.fadePower)],thinningAffectedRatio:lr.screenThinning.affectedRatio,thinningParticleOffset:Wr,color:[lr.color.r,lr.color.g,lr.color.b,lr.color.a],direction:ot},{u_modelview:Float32Array.from($r.modelview),u_projection:Float32Array.from($r.projection),u_time:$r.time,u_cam_pos:$r.camPos,u_velocityConeAperture:$r.velocityConeAperture,u_velocity:$r.velocity,u_horizontalOscillationRadius:$r.horizontalOscillationRadius,u_horizontalOscillationRate:$r.horizontalOscillationRate,u_boxSize:$r.boxSize,u_billboardSize:$r.billboardSize,u_simpleShapeParameters:$r.simpleShapeParameters,u_screenSize:$r.screenSize,u_thinningCenterPos:$r.thinningCenterPos,u_thinningShape:$r.thinningShape,u_thinningAffectedRatio:$r.thinningAffectedRatio,u_thinningParticleOffset:$r.thinningParticleOffset,u_particleColor:$r.color,u_direction:$r.direction});var $r;const Or=Math.round(lr.intensity*this.particlesCount),Br=c.bg.simpleSegment(0,0,4*Or,2*Or);this.particlesVx&&this.particlesIdx&&tr.draw(d,Xt.TRIANGLES,Us.disabled,oo.disabled,co.alphaBlended,wr.disabled,zr,"snow_particles",this.particlesVx,this.particlesIdx,Br)})(_e.boxSize,0,_e),this._vignette.draw(d,ut)}}const zm={symbol:function(st,d,_e,ot,ut){if(st.renderPass!=="translucent")return;const mt=oo.disabled,xt=st.colorModeForRenderPass(),Tt=_e.layout.get("text-variable-anchor"),kt=_e.layout.get("text-size-scale-range"),$t=c.aA(st.scaleFactor,kt[0],kt[1]);Tt&&function(tr,nr,cr,lr,yr,xr,Ar,Dr){const Tr=nr.transform,Wr=yr==="map",zr=xr==="map";for(const $r of tr){const Or=lr.getTile($r),Br=Or.getBucket(cr);if(!Br||!Br.text||!Br.text.segments.get().length)continue;const Xr=c.bK(Br.textSizeData,Tr.zoom,Dr),an=m0($r,Br.getProjection(),Tr),sn=Tr.calculatePixelsToTileUnitsMatrix(Or),wn=Qu(an,Or.tileID.canonical,zr,Wr,Tr,Br.getProjection(),sn),Cn=Br.hasIconTextFit()&&Br.hasIconData();Xr&&eo(Br,Wr,zr,Ar,Tr,wn,$r,Math.pow(2,Tr.zoom-Or.tileID.overscaledZ),Xr,Cn)}}(ot,st,_e,d,_e.layout.get("text-rotation-alignment"),_e.layout.get("text-pitch-alignment"),ut,$t);const Xt=_e.paint.get("icon-opacity").constantOr(1)!==0,rr=_e.paint.get("text-opacity").constantOr(1)!==0;_e.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(Xt||rr)?b1(st,d,_e,ot,mt,xt):(Xt&&b1(st,d,_e,ot,mt,xt,{onlyIcons:!0}),rr&&b1(st,d,_e,ot,mt,xt,{onlyText:!0})),d.map.showCollisionBoxes&&(Ps(st,d,_e,ot,_e.paint.get("text-translate"),_e.paint.get("text-translate-anchor"),!0),Ps(st,d,_e,ot,_e.paint.get("icon-translate"),_e.paint.get("icon-translate-anchor"),!1))},circle:function(st,d,_e,ot){if(st.renderPass!=="translucent")return;const ut=_e.paint.get("circle-opacity"),mt=_e.paint.get("circle-stroke-width"),xt=_e.paint.get("circle-stroke-opacity"),Tt=_e.layout.get("circle-sort-key").constantOr(1)!==void 0,kt=_e.paint.get("circle-emissive-strength");if(ut.constantOr(1)===0&&(mt.constantOr(1)===0||xt.constantOr(1)===0))return;const $t=st.context,Xt=$t.gl,rr=st.transform,tr=!(!st.terrain||!st.terrain.enabled),nr=_e.layout.get("circle-elevation-reference"),cr=st.depthModeForSublayer(0,Us.ReadOnly),lr=new Us(st.context.gl.LEQUAL,Us.ReadOnly,st.depthRangeFor3D),yr=nr==="none"||tr?cr:lr,xr=oo.disabled,Ar=st.colorModeForDrapableLayerRenderPass(kt),Dr=rr.projection.name==="globe",Tr=[c.aF(rr.center.lng),c.aJ(rr.center.lat)],Wr=[];for(let $r=0;$r<ot.length;$r++){const Or=ot[$r],Br=d.getTile(Or),Xr=Br.getBucket(_e);if(!Xr||Xr.projection.name!==rr.projection.name)continue;const an=Xr.programConfigurations.get(_e.id),sn=Xr.layoutVertexBuffer,wn=Xr.globeExtVertexBuffer,Cn=Xr.indexBuffer,Nn=c.e0(_e),Jn=[wn],yn=st.isTileAffectedByFog(Or);Dr&&Nn.push("PROJECTION_GLOBE_VIEW"),Nn.push("DEPTH_D24"),st.terrain&&rr.depthOcclusionForSymbolsAndCircles&&Nn.push("DEPTH_OCCLUSION"),Xr.hasElevation&&!st.terrain&&(Nn.push("ELEVATED_ROADS"),Jn.push(Xr.elevatedLayoutVertexBuffer));const Qr=st.getOrCreateProgram("circle",{config:an,defines:Nn,overrideFog:yn}),Dn=rr.projection.createInversionMatrix(rr,Or.canonical),bn={programConfiguration:an,program:Qr,layoutVertexBuffer:sn,dynamicBuffers:Jn,indexBuffer:Cn,uniformValues:c.e1(st,Or,Br,Dn,Tr,_e),tile:Br};if(Tt){const $n=Xr.segments.get();for(const ls of $n)Wr.push({segments:new c.bg([ls]),sortKey:ls.sortKey,state:bn})}else Wr.push({segments:Xr.segments,sortKey:0,state:bn})}Tt&&Wr.sort(($r,Or)=>$r.sortKey-Or.sortKey);const zr={useDepthForOcclusion:rr.depthOcclusionForSymbolsAndCircles};for(const $r of Wr){const{programConfiguration:Or,program:Br,layoutVertexBuffer:Xr,dynamicBuffers:an,indexBuffer:sn,uniformValues:wn,tile:Cn}=$r.state,Nn=$r.segments;st.terrain&&st.terrain.setupElevationDraw(Cn,Br,zr),st.uploadCommonUniforms($t,Br,Cn.tileID.toUnwrapped()),Br.draw(st,Xt.TRIANGLES,yr,xr,Ar,wr.disabled,wn,_e.id,Xr,sn,Nn,_e.paint,rr.zoom,Or,an)}},heatmap:function(st,d,_e,ot){if(_e.paint.get("heatmap-opacity")!==0)if(st.renderPass==="offscreen"){const ut=st.context,mt=ut.gl,xt=oo.disabled,Tt=new co([mt.ONE,mt.ONE,mt.ONE,mt.ONE],c.ao.transparent,[!0,!0,!0,!0]);(function(nr,cr,lr,yr){const xr=nr.gl,Ar=cr.width*yr,Dr=cr.height*yr;nr.activeTexture.set(xr.TEXTURE1),nr.viewport.set([0,0,Ar,Dr]);let Tr=lr.heatmapFbo;if(!Tr||Tr&&(Tr.width!==Ar||Tr.height!==Dr)){Tr&&Tr.destroy();const Wr=xr.createTexture();xr.bindTexture(xr.TEXTURE_2D,Wr),xr.texParameteri(xr.TEXTURE_2D,xr.TEXTURE_WRAP_S,xr.CLAMP_TO_EDGE),xr.texParameteri(xr.TEXTURE_2D,xr.TEXTURE_WRAP_T,xr.CLAMP_TO_EDGE),xr.texParameteri(xr.TEXTURE_2D,xr.TEXTURE_MIN_FILTER,xr.LINEAR),xr.texParameteri(xr.TEXTURE_2D,xr.TEXTURE_MAG_FILTER,xr.LINEAR),Tr=lr.heatmapFbo=nr.createFramebuffer(Ar,Dr,1,null),function(zr,$r,Or,Br,Xr,an){const sn=zr.gl;sn.texImage2D(sn.TEXTURE_2D,0,zr.extRenderToTextureHalfFloat?sn.RGBA16F:sn.RGBA,Xr,an,0,sn.RGBA,zr.extRenderToTextureHalfFloat?sn.HALF_FLOAT:sn.UNSIGNED_BYTE,null),Br.colorAttachment0.set(Or)}(nr,0,Wr,Tr,Ar,Dr)}else xr.bindTexture(xr.TEXTURE_2D,Tr.colorAttachment0.get()),nr.bindFramebuffer.set(Tr.framebuffer)})(ut,st,_e,st.transform.projection.name==="globe"?.5:.25),ut.clear({color:c.ao.transparent});const kt=st.transform,$t=kt.projection.name==="globe",Xt=$t?["PROJECTION_GLOBE_VIEW"]:[],rr=$t?wr.frontCCW:wr.disabled,tr=[c.aF(kt.center.lng),c.aJ(kt.center.lat)];for(let nr=0;nr<ot.length;nr++){const cr=ot[nr];if(d.hasRenderableParent(cr))continue;const lr=d.getTile(cr),yr=lr.getBucket(_e);if(!yr||yr.projection.name!==kt.projection.name)continue;const xr=st.isTileAffectedByFog(cr),Ar=yr.programConfigurations.get(_e.id),Dr=st.getOrCreateProgram("heatmap",{config:Ar,defines:Xt,overrideFog:xr}),{zoom:Tr}=st.transform;st.terrain&&st.terrain.setupElevationDraw(lr,Dr),st.uploadCommonUniforms(ut,Dr,cr.toUnwrapped());const Wr=kt.projection.createInversionMatrix(kt,cr.canonical);Dr.draw(st,mt.TRIANGLES,Us.disabled,xt,Tt,rr,FE(st,cr,lr,Wr,tr,Tr,_e.paint.get("heatmap-intensity")),_e.id,yr.layoutVertexBuffer,yr.indexBuffer,yr.segments,_e.paint,st.transform.zoom,Ar,$t?[yr.globeExtVertexBuffer]:null)}ut.viewport.set([0,0,st.width,st.height])}else st.renderPass==="translucent"&&(st.context.setColorMode(st.colorModeForRenderPass()),function(ut,mt){const xt=ut.context,Tt=xt.gl,kt=mt.heatmapFbo;if(!kt)return;xt.activeTexture.set(Tt.TEXTURE0),Tt.bindTexture(Tt.TEXTURE_2D,kt.colorAttachment0.get()),xt.activeTexture.set(Tt.TEXTURE1);let $t=mt.colorRampTexture;$t||($t=mt.colorRampTexture=new c.T(xt,mt.colorRamp,Tt.RGBA8)),$t.bind(Tt.LINEAR,Tt.CLAMP_TO_EDGE),ut.getOrCreateProgram("heatmapTexture").draw(ut,Tt.TRIANGLES,Us.disabled,oo.disabled,ut.colorModeForRenderPass(),wr.disabled,((Xt,rr,tr,nr)=>({u_image:0,u_color_ramp:1,u_opacity:rr.paint.get("heatmap-opacity")}))(0,mt),mt.id,ut.viewportBuffer,ut.quadTriangleIndexBuffer,ut.viewportSegments,mt.paint,ut.transform.zoom)}(st,_e))},line:function(st,d,_e,ot){if(st.renderPass!=="translucent")return;const ut=_e.paint.get("line-opacity"),mt=_e.paint.get("line-width");if(ut.constantOr(1)===0||mt.constantOr(1)===0)return;const xt=_e.paint.get("line-emissive-strength").isConstant(),Tt=_e.paint.get("line-emissive-strength").constantOr(0),kt=_e.paint.get("line-occlusion-opacity"),$t=_e.layout.get("line-elevation-reference"),Xt=_e.layout.get("line-width-unit")==="meters",rr=$t==="sea",tr=!(!st.terrain||!st.terrain.enabled),nr=st.context,cr=nr.gl;if(_e.hasElevatedBuckets&&st.transform.projection.name==="globe")return;const lr=_e.layout.get("line-cross-slope"),yr=lr!==void 0,xr=lr<1,Ar=st.colorModeForDrapableLayerRenderPass(xt?Tt:null),Dr=st.terrain&&st.terrain.renderingToTexture,Tr=Dr?1:c.o.devicePixelRatio,Wr=_e.paint.get("line-dasharray"),zr=Wr.constantOr(1),$r=_e.layout.get("line-cap"),Or=Wr.constantOr(null),Br=$r.constantOr(null),Xr=_e.paint.get("line-pattern"),an=Xr.constantOr(1),sn=_e.paint.get("line-pattern-cross-fade"),wn=Xr.constantOr(null),Cn=_e.paint.get("line-opacity").constantOr(1);let Nn=!an&&Cn!==1||st.depthOcclusion&&kt>0&&kt<1;const Jn=_e.paint.get("line-gradient"),yn=an?"linePattern":"line",Qr=c.e2(_e);let Dn;if(Dr&&st.terrain&&st.terrain.clipOrMaskOverlapStencilType()&&(Nn=!1),kt!==0&&st.depthOcclusion){const As=_e.paint._values["line-opacity"];As&&As.value&&As.value.kind==="constant"?Dn=As.value:c.w(`Occlusion opacity for layer ${_e.id} is supported only when line-opacity isn't data-driven.`)}mt.value.kind!=="constant"&&mt.value.isLineProgressConstant===!1&&Qr.push("VARIABLE_LINE_WIDTH"),Dr&&(st.emissiveMode!=="dual-source-blending"||xt?st.emissiveMode==="mrt-fallback"&&Qr.push("USE_MRT1"):Qr.push("DUAL_SOURCE_BLENDING"));const bn=(As,is,_i,Ls,Bs,_s)=>{for(const Rs of As){const Qs=d.getTile(Rs);if(an&&!Qs.patternsLoaded())continue;const _o=Qs.getBucket(_e);if(!_o||_o.elevationType!=="none"&&!Bs||_o.elevationType==="none"&&Bs)continue;st.prepareDrawTile();const Xo=[...is],Al=st.shadowRenderer,zs=_o.elevationType==="road"&&!!Al&&Al.enabled;let El=[0,0,0];if(zs){const To=st.style.directionalLight,cu=st.style.ambientLight;To&&cu&&(El=os(st.style,To,cu)),Xo.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const mo=_o.programConfigurations.get(_e.id);let Dl=!1;if(wn&&Qs.imageAtlas){const To=c.e3.from(wn),cu=To.getPrimary().scaleSelf(Tr).toString(),Lu=Qs.imageAtlas.patternPositions.get(cu),bu=To.getSecondary(),Zl=bu?Qs.imageAtlas.patternPositions.get(bu.scaleSelf(Tr).toString()):null;Dl=!!Lu&&!!Zl,Lu&&mo.setConstantPatternPositions(Lu,Zl)}sn>0&&(Dl||mo.getPatternTransitionVertexBuffer("line-pattern"))&&Xo.push("LINE_PATTERN_TRANSITION");const Vl=st.isTileAffectedByFog(Rs),Ml=st.getOrCreateProgram(yn,{config:mo,defines:Xo,overrideFog:Vl});if(!an&&Or&&Br&&Qs.lineAtlas){const To=Qs.lineAtlas.getDash(Or,Br);To&&mo.setConstantPatternPositions(To)}zs&&Al.setupShadows(Qs.tileID.toUnwrapped(),Ml,"vector-tile");let[_l,So]=_e.paint.get("line-trim-offset");(Br==="round"||Br==="square")&&_l!==So&&(_l===0&&(_l-=1),So===1&&(So+=1));const Rl=Dr?Rs.projMatrix:null,Au=Xt?1/_o.tileToMeter/c.ay(Qs,1,st.transform.zoom):1,fu=Xt?1/_o.tileToMeter/c.ay(Qs,1,Math.floor(st.transform.zoom)):1,Pl=an?c.e4(st,Qs,_e,Rl,Tr,Au,fu,[_l,So],El,sn):c.e5(st,Qs,_e,Rl,_o.lineClipsArray.length,Tr,Au,fu,[_l,So],El);if(Jn){const To=_o.gradients[_e.id];let cu=To.texture;if(_e.gradientVersion!==To.version){let Lu=256;if(_e.stepInterpolant){const bu=d.getSource().maxzoom,Zl=Rs.canonical.z===bu?Math.ceil(1<<st.transform.maxZoom-Rs.canonical.z):1;Lu=c.aA(c.e6(_o.maxLineLength/c.al*1024*Zl),256,nr.maxTextureSize)}To.gradient=c.e7({expression:_e.gradientExpression(),evaluationKey:"lineProgress",resolution:Lu,image:To.gradient||void 0,clips:_o.lineClipsArray}),To.texture?To.texture.update(To.gradient):To.texture=new c.T(nr,To.gradient,cr.RGBA8),To.version=_e.gradientVersion,cu=To.texture}nr.activeTexture.set(cr.TEXTURE1),cu.bind(_e.stepInterpolant?cr.NEAREST:cr.LINEAR,cr.CLAMP_TO_EDGE)}zr&&(nr.activeTexture.set(cr.TEXTURE0),Qs.lineAtlasTexture&&Qs.lineAtlasTexture.bind(cr.LINEAR,cr.REPEAT),mo.updatePaintBuffers()),an&&(nr.activeTexture.set(cr.TEXTURE0),Qs.imageAtlasTexture&&Qs.imageAtlasTexture.bind(cr.LINEAR,cr.CLAMP_TO_EDGE),mo.updatePaintBuffers()),Bs&&!rr&&st.terrain.setupElevationDraw(Qs,Ml),st.uploadCommonUniforms(nr,Ml,Rs.toUnwrapped());const $a=To=>{Dn!=null&&(Dn.value=Cn*kt),Ml.draw(st,cr.TRIANGLES,_i,To,Ar,wr.disabled,Pl,_e.id,_o.layoutVertexBuffer,_o.indexBuffer,_o.segments,_e.paint,st.transform.zoom,mo,[_o.layoutVertexBuffer2,_o.patternVertexBuffer,_o.zOffsetVertexBuffer]),Dn!=null&&(Dn.value=Cn)};if(Nn&&!Bs){const To=st.stencilModeForClipping(Rs).ref;To===0&&Dr&&nr.clear({stencil:0});const cu={func:cr.EQUAL,mask:255};Pl.u_alpha_discard_threshold=.8,$a(new oo(cu,To,255,cr.KEEP,cr.KEEP,cr.INVERT)),Pl.u_alpha_discard_threshold=0,$a(new oo(cu,To,255,cr.KEEP,cr.KEEP,cr.KEEP))}else Pl.u_alpha_discard_threshold=Nn&&Bs&&_s?.8:0,$a(Bs?Ls:st.stencilModeForClipping(Rs))}};let $n=st.depthModeForSublayer(0,Us.ReadOnly);const ls=new Us(st.depthOcclusion?cr.GREATER:cr.LEQUAL,Us.ReadOnly,st.depthRangeFor3D);if(_e.hasNonElevatedBuckets){const As=!Dr&&st.terrain;kt!==0&&As?c.w(`Occlusion opacity for layer ${_e.id} is supported on terrain only if the layer has line-z-offset enabled.`):As?c.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${_e.id}.`):bn(ot,Qr,$n,oo.disabled,!1,!0)}if(_e.hasElevatedBuckets){$t==="hd-road-markup"?tr||($n=ls,Qr.push("ELEVATED_ROADS")):(Qr.push("ELEVATED"),$n=ls,yr&&Qr.push(xr?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),rr&&Qr.push("ELEVATION_REFERENCE_SEA"));const As=Nn?st.stencilModeFor3D():oo.disabled;st.forceTerrainMode=!0,bn(ot,Qr,$n,As,!0,!0),Nn&&bn(ot,Qr,$n,As,!0,!1),st.forceTerrainMode=!1}Nn&&(st.resetStencilClippingMasks(),Dr&&nr.clear({stencil:0})),kt===0||st.depthOcclusion||Dr||st.layersWithOcclusionOpacity.push(st.currentLayer)},fill:function(st,d,_e,ot){const ut=_e.paint.get("fill-color"),mt=_e.paint.get("fill-opacity");if(mt.constantOr(1)===0)return;const xt=_e.paint.get("fill-emissive-strength"),Tt=st.colorModeForDrapableLayerRenderPass(xt),kt=_e.paint.get("fill-pattern"),$t=st.opaquePassEnabledForLayer()&&!kt.constantOr(1)&&ut.constantOr(c.ao.transparent).a===1&&mt.constantOr(0)===1?"opaque":"translucent";let Xt="none";_e.layout.get("fill-elevation-reference")!=="none"?Xt="road":_e.paint.get("fill-z-offset").constantOr(1)!==0&&(Xt="offset");const rr=!(!st.terrain||!st.terrain.enabled),tr={painter:st,sourceCache:d,layer:_e,coords:ot,colorMode:Tt,elevationType:Xt,terrainEnabled:rr,pass:$t};if(st.renderPass==="shadow")return void(st.shadowRenderer&&Xt==="road"&&!rr&&function(cr){const{painter:lr,sourceCache:yr,layer:xr,coords:Ar}=cr,Dr=lr.context.gl,Tr=cr.painter.shadowRenderer;for(const Wr of Ar){const zr=yr.getTile(Wr),$r=zr.getBucket(xr);if(!$r)continue;const Or=$r.elevatedStructures;if(!Or||!Or.shadowCasterSegments||Or.shadowCasterSegments.segments[0].primitiveLength===0)continue;lr.prepareDrawTile();const Br=$r.bufferData.programConfigurations.get(xr.id),Xr=lr.isTileAffectedByFog(Wr),an=lr.getOrCreateProgram("elevatedStructuresDepth",{config:Br,overrideFog:Xr}),sn=Tr.calculateShadowPassMatrixFromTile(zr.tileID.toUnwrapped());lr.uploadCommonUniforms(lr.context,an,Wr.toUnwrapped());const wn={u_matrix:sn,u_depth_bias:0};an.draw(lr,Dr.TRIANGLES,Tr.getShadowPassDepthMode(),oo.disabled,Tr.getShadowPassColorMode(),wr.disabled,wn,xr.id,Or.vertexBuffer,Or.indexBuffer,Or.shadowCasterSegments,xr.paint,lr.transform.zoom,Br)}}(tr));const nr=st.emissiveMode==="mrt-fallback";if(Xt!=="offset"){if(Sy(tr,!1,nr),Xt==="road"){const cr=!rr&&st.renderPass==="translucent";cr&&Ay(st,d,_e,ot,"geometry"),Sy(tr,!0,nr,oo.disabled),cr&&function(lr){const{painter:yr,sourceCache:xr,layer:Ar,coords:Dr,colorMode:Tr}=lr,Wr=yr.context.gl,zr=lr.painter.shadowRenderer,$r=!!zr&&zr.enabled,Or=new Us(yr.context.gl.LEQUAL,Us.ReadOnly,yr.depthRangeFor3D);let Br=[0,0,0];if($r){const an=yr.style.directionalLight,sn=yr.style.ambientLight;an&&sn&&(Br=os(yr.style,an,sn))}const Xr=an=>{for(const sn of Dr){const wn=xr.getTile(sn),Cn=wn.getBucket(Ar);if(!Cn)continue;const Nn=Cn.elevatedStructures;if(!Nn)continue;let Jn,yn;if(an?(Jn=Nn.renderableBridgeSegments,yn=Nn.bridgeProgramConfigurations.get(Ar.id)):(Jn=Nn.renderableTunnelSegments,yn=Nn.tunnelProgramConfigurations.get(Ar.id)),!Jn||Jn.segments[0].primitiveLength===0)continue;yn.updatePaintBuffers(),yr.prepareDrawTile();const Qr=yr.isTileAffectedByFog(sn),Dn=[];$r&&Dn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const bn=yr.getOrCreateProgram("elevatedStructures",{config:yn,overrideFog:Qr,defines:Dn}),$n=yr.translatePosMatrix(sn.projMatrix,wn,Ar.paint.get("fill-translate"),Ar.paint.get("fill-translate-anchor"));$r&&zr.setupShadows(wn.tileID.toUnwrapped(),bn,"vector-tile");const ls=Mm($n,Br);yr.uploadCommonUniforms(yr.context,bn,sn.toUnwrapped()),bn.draw(yr,Wr.TRIANGLES,Or,oo.disabled,Tr,wr.backCCW,ls,Ar.id,Nn.vertexBuffer,Nn.indexBuffer,Jn,Ar.paint,yr.transform.zoom,yn,[Nn.vertexBufferNormal])}};Xr(!0),Xr(!1)}(tr)}}else Sy(tr,!1,nr,st.stencilModeFor3D())},"fill-extrusion":function(st,d,_e,ot){const ut=_e.paint.get("fill-extrusion-opacity"),mt=st.context,xt=mt.gl,Tt=st.terrain,kt=Tt&&Tt.renderingToTexture;if(ut===0)return;const $t=st.emissiveMode==="mrt-fallback",Xt=st.conflationActive&&st.style.isLayerClipped(_e,d.getSource()),rr=st.style.order.indexOf(_e.fqid);if(Xt&&function(tr,nr,cr,lr,yr){for(const xr of lr){const Ar=nr.getTile(xr).getBucket(cr);Ar&&(Ar.updateReplacement(xr,tr.replacementSource,yr),Ar.uploadCentroid(tr.context))}}(st,d,_e,ot,rr),Tt||Xt)for(const tr of ot){const nr=d.getTile(tr).getBucket(_e);nr&&x2(st.context,d,tr,nr,_e,Tt,Xt)}if(st.renderPass==="shadow"&&st.shadowRenderer){const tr=st.shadowRenderer;if(Tt&&ut<.65&&_e._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof c.ad)return;const nr=tr.getShadowPassDepthMode(),cr=tr.getShadowPassColorMode();Ty(st,d,_e,ot,nr,oo.disabled,cr,Xt)}else if(st.renderPass==="translucent"){const tr=!_e.paint.get("fill-extrusion-pattern").constantOr(1),nr=_e.paint.get("fill-extrusion-color").constantOr(c.ao.white);if(!kt&&nr.a!==0){const cr=new Us(st.context.gl.LEQUAL,Us.ReadWrite,st.depthRangeFor3D);ut===1&&tr?Ty(st,d,_e,ot,cr,oo.disabled,co.unblended,Xt):(Ty(st,d,_e,ot,cr,oo.disabled,co.disabled,Xt),Ty(st,d,_e,ot,cr,st.stencilModeFor3D(),st.colorModeForRenderPass(),Xt),st.resetStencilClippingMasks())}if(st.style.enable3dLights()&&tr&&(!Tt&&st.transform.projection.name!=="globe"||kt)){const cr=_e.paint.get("fill-extrusion-opacity"),lr=_e.paint.get("fill-extrusion-ambient-occlusion-intensity"),yr=_e.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),xr=_e.paint.get("fill-extrusion-flood-light-intensity"),Ar=_e.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Dr=_e.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(Ar?null:_e.lut).toArray01().slice(0,3),Tr=lr>0&&yr>0,Wr=xr>0,zr=(Br,Xr,an)=>(1-an)*Br+an*Xr,$r=new nv;$r.translate=_e.paint.get("fill-extrusion-translate"),$r.translateAnchor=_e.paint.get("fill-extrusion-translate-anchor"),$r.edgeRadius=_e.layout.get("fill-extrusion-edge-radius"),$r.cutoffFadeRange=_e.paint.get("fill-extrusion-cutoff-fade-range");const Or=Br=>{const Xr=st.depthModeForSublayer(1,Us.ReadOnly,xt.LEQUAL,!0),an=_e.paint.get(Br?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),sn=zr(.1,3,an),wn=st._showOverdrawInspector;if(!wn){const Cn=new oo({func:xt.ALWAYS,mask:255},255,255,xt.KEEP,xt.KEEP,xt.REPLACE),Nn=new co([xt.ONE,xt.ONE,xt.ONE,xt.ONE],c.ao.transparent,[!1,!1,!1,!0],xt.MIN);sm($r,st,d,_e,ot,Xr,Cn,Nn,wr.disabled,Br,"sdf",cr,lr,yr,xr,Dr,sn,Xt,!1)}{const Cn=wn?oo.disabled:new oo({func:xt.EQUAL,mask:255},255,255,xt.KEEP,xt.DECR,xt.DECR),Nn=wn?st.colorModeForRenderPass():new co([xt.ONE_MINUS_DST_ALPHA,xt.DST_ALPHA,xt.ONE,xt.ONE],c.ao.transparent,[!0,!0,!0,!0]);sm($r,st,d,_e,ot,Xr,Cn,Nn,wr.disabled,Br,"color",cr,lr,yr,xr,Dr,sn,Xt,!1)}};if(kt){const Br=()=>{const an=Tt.drapeBufferSize[0],sn=Tt.drapeBufferSize[1];let wn=Tt.framebufferCopyTexture;return wn&&(!wn||wn.size[0]===an&&wn.size[1]===sn)||(wn&&wn.destroy(),wn=Tt.framebufferCopyTexture=new c.T(mt,new c.q({width:an,height:sn}),xt.RGBA8)),wn.bind(xt.LINEAR,xt.CLAMP_TO_EDGE),xt.copyTexSubImage2D(xt.TEXTURE_2D,0,0,0,0,0,an,sn),wn},Xr=(an,sn,wn)=>{const Cn=st.depthModeForSublayer(1,Us.ReadOnly,xt.LEQUAL,!1),Nn=_e.paint.get(an?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Jn=zr(.1,3,Nn);{const yn=new co([xt.ONE,xt.ONE,xt.ONE,xt.ONE],c.ao.transparent,[!1,!1,!1,!0]);sm($r,st,d,_e,ot,Cn,oo.disabled,yn,wr.disabled,an,"clear",cr,lr,yr,xr,Dr,Jn,Xt,sn)}{const yn=new oo({func:xt.ALWAYS,mask:255},255,255,xt.KEEP,xt.KEEP,xt.REPLACE),Qr=new co([xt.ONE,xt.ONE,xt.ONE,xt.ONE],c.ao.transparent,[!1,!1,!1,!0],xt.MIN);sm($r,st,d,_e,ot,Cn,yn,Qr,wr.disabled,an,"sdf",cr,lr,yr,xr,Dr,Jn,Xt,sn)}$t&&!an&&(wn=Br());{const yn=an?xt.ZERO:xt.ONE_MINUS_DST_ALPHA,Qr=new oo({func:xt.EQUAL,mask:255},255,255,xt.KEEP,xt.DECR,xt.DECR),Dn=new co([yn,xt.DST_ALPHA,xt.ONE_MINUS_DST_ALPHA,xt.ZERO],c.ao.transparent,[!0,!0,!0,!0]);sm($r,st,d,_e,ot,Cn,Qr,Dn,wr.disabled,an,"color",cr,lr,yr,xr,Dr,Jn,Xt,sn)}if(!$t||an){const yn=new co([xt.ONE,xt.ONE,xt.ONE,an?xt.ZERO:xt.ONE],c.ao.transparent,[!1,!1,!1,!0],an?xt.FUNC_ADD:xt.MAX);sm($r,st,d,_e,ot,Cn,oo.disabled,yn,wr.disabled,an,"clear",cr,lr,yr,xr,Dr,Jn,Xt,sn,wn)}else{xt.drawBuffers([xt.NONE,xt.COLOR_ATTACHMENT1]);const yn=new oo({func:xt.EQUAL,mask:255},254,255,xt.KEEP,xt.DECR,xt.DECR),Qr=new co([xt.ONE,xt.ONE,xt.ONE,xt.ONE],c.ao.transparent,[!0,!1,!1,!1],xt.MAX);sm($r,st,d,_e,ot,Cn,yn,Qr,wr.disabled,an,"emissive",cr,lr,yr,xr,Dr,Jn,Xt,sn,wn),xt.drawBuffers([xt.COLOR_ATTACHMENT0])}};if(Tr||Wr){let an;st.prepareDrawTile(),$t&&!Tr||(an=Br()),Tr&&Xr(!0,!1,an),Wr&&Xr(!1,!0,an)}}else Tr&&Or(!0),Wr&&Or(!1),(Tr||Wr)&&st.resetStencilClippingMasks()}}},building:function(st,d,_e,ot){st.currentLayer<st.firstLightBeamLayer&&(st.firstLightBeamLayer=st.currentLayer);const ut=_e.paint.get("building-ambient-occlusion-ground-intensity"),mt=_e.paint.get("building-ambient-occlusion-ground-radius"),xt=_e.paint.get("building-ambient-occlusion-ground-attenuation"),Tt=_e.paint.get("building-opacity");if(Tt<=0)return;let kt=ut>0&&mt>0,$t=!0;const Xt=_e.paint.get("building-vertical-scale");if(Xt<=0)return;st.shadowRenderer||($t=!1);const rr=st.conflationActive&&st.style.isLayerClipped(_e,d.getSource()),tr=st.style.order.indexOf(_e.fqid);if(function(nr,cr,lr,yr,xr,Ar){for(const Dr of Ar){const Tr=cr.getTile(Dr).getBucket(lr);Tr&&(xr&&Tr.updateReplacement(Dr,nr.replacementSource,yr),Tr.uploadUpdatedIndexBuffer(nr.context))}}(st,d,_e,tr,rr,ot),function(nr,cr,lr,yr){for(const xr of yr){const Ar=cr.getTile(xr).getBucket(lr);Ar&&Ar.needsEvaluation()&&Ar.uploadUpdatedColorBuffer(nr.context)}}(st,d,_e,ot),_e.resetLayerRenderingStats(st),st.shadowRenderer&&(st.shadowRenderer.useNormalOffset=!0),st.renderPass==="shadow"&&st.shadowRenderer){const nr=st.shadowRenderer,cr=[],lr=nr.getShadowPassDepthMode();w1({painter:st,source:d,layer:_e,coords:ot,defines:cr,blendMode:nr.getShadowPassColorMode(),depthMode:lr,opacity:Tt,verticalScale:Xt,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}else if(st.renderPass==="translucent"){let nr=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];$t&&(nr=nr.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),st.shadowRenderer&&st.shadowRenderer.useNormalOffset&&(nr=nr.concat("NORMAL_OFFSET"));const cr=_e.paint.get("building-facade-emissive-chance"),lr=_e.paint.get("building-ambient-occlusion-intensity"),yr=_e.paint.get("building-flood-light-intensity"),xr=_e.paint.get("building-flood-light-color-use-theme").constantOr("default")==="none",Ar=_e.paint.get("building-flood-light-color").toNonPremultipliedRenderColor(xr?null:_e.lut).toArray01().slice(0,3),Dr=_e.paint.get("building-flood-light-ground-attenuation"),Tr=yr>0,Wr=new Us(st.context.gl.LEQUAL,Us.ReadWrite,st.depthRangeFor3D);Tt<1&&w1({painter:st,source:d,layer:_e,coords:ot,defines:nr,blendMode:co.disabled,depthMode:Wr,opacity:Tt,verticalScale:Xt,facadeEmissiveChance:cr,facadeAOIntensity:lr,floodLightIntensity:yr,floodLightColor:Ar,depthOnly:!0});const zr=st.colorModeForRenderPass();w1({painter:st,source:d,layer:_e,coords:ot,defines:nr,blendMode:zr,depthMode:Wr,opacity:Tt,verticalScale:Xt,facadeEmissiveChance:cr,facadeAOIntensity:lr,floodLightIntensity:yr,floodLightColor:Ar}),kt&&Ry(st,d,_e,ot,!0,Tt,ut,mt,yr,Ar,xt,rr),Tr&&Ry(st,d,_e,ot,!1,Tt,ut,mt,yr,Ar,Dr,rr)}else if(st.renderPass==="light-beam"){const nr=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],cr=new Us(st.context.gl.LEQUAL,Us.ReadOnly,st.depthRangeFor3D);w1({painter:st,source:d,layer:_e,coords:ot,defines:nr,blendMode:co.alphaBlended,depthMode:cr,opacity:Tt,verticalScale:Xt,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}st.shadowRenderer&&(st.shadowRenderer.useNormalOffset=!1),st.resetStencilClippingMasks()},hillshade:function(st,d,_e,ot){if(st.renderPass!=="offscreen"&&st.renderPass!=="translucent"||st.style.disableElevatedTerrain)return;const ut=st.context,mt=st.terrain&&st.terrain.renderingToTexture,[xt,Tt]=st.renderPass!=="translucent"||mt?[{},ot]:st.stencilConfigForOverlap(ot);for(const kt of Tt){const $t=d.getTile(kt);if($t.needsHillshadePrepare&&st.renderPass==="offscreen")o2(st,$t,_e);else if(st.renderPass==="translucent"){const Xt=st.depthModeForSublayer(0,Us.ReadOnly),rr=_e.paint.get("hillshade-emissive-strength"),tr=st.colorModeForDrapableLayerRenderPass(rr),nr=mt&&st.terrain?st.terrain.stencilModeForRTTOverlap(kt):xt[kt.overscaledZ];s2(st,kt,$t,_e,Xt,nr,tr)}}ut.viewport.set([0,0,st.width,st.height]),st.resetStencilClippingMasks()},raster:function(st,d,_e,ot,ut,mt){if(st.renderPass!=="translucent"||_e.paint.get("raster-opacity")===0)return;const xt=st.transform.projection.name==="globe",Tt=_e.paint.get("raster-elevation")!==0,kt=Tt&&xt;if(st.renderElevatedRasterBackface&&!kt)return;const $t=st.context,Xt=$t.gl,rr=d.getSource(),tr=function(zr,$r,Or,Br,Xr){const an=$r.paint.get("raster-color"),sn=zr.type==="raster-array",wn=[],Cn=$r.paint.get("raster-resampling"),Nn=$r.paint.get("raster-color-mix");let Jn=$r.paint.get("raster-color-range");const yn=[Nn[0],Nn[1],Nn[2],0],Qr=Nn[3];let Dn=Cn==="nearest"?Br.NEAREST:Br.LINEAR;if(sn&&(wn.push("RASTER_ARRAY"),an||wn.push("RASTER_COLOR"),Cn==="linear"&&wn.push("RASTER_ARRAY_LINEAR"),Dn=Br.NEAREST,!Jn&&zr.rasterLayers)){const bn=zr.rasterLayers.find(({id:$n})=>$n===$r.sourceLayer);bn&&bn.fields&&bn.fields.range&&(Jn=bn.fields.range)}if(Jn=Jn||[0,1],an){wn.push("RASTER_COLOR"),Or.activeTexture.set(Br.TEXTURE2),$r.updateColorRamp(Jn);let bn=$r.colorRampTexture;bn||(bn=$r.colorRampTexture=new c.T(Or,$r.colorRamp,Br.RGBA8)),bn.bind(Br.LINEAR,Br.CLAMP_TO_EDGE)}return Xr&&wn.push("USE_MRT1"),{mix:yn,range:Jn,offset:Qr,defines:wn,resampling:Dn}}(rr,_e,$t,Xt,st.terrain&&st.terrain.renderingToTexture&&st.emissiveMode==="mrt-fallback");if(rr instanceof c.aU&&!ot.length&&!xt)return;const nr=_e.paint.get("raster-emissive-strength"),cr=st.colorModeForDrapableLayerRenderPass(nr),lr=st.terrain&&st.terrain.renderingToTexture,yr=!st.options.moving,xr=_e.paint.get("raster-resampling")==="nearest"?Xt.NEAREST:Xt.LINEAR;if(rr instanceof c.aU&&!ot.length&&(rr.onNorthPole||rr.onSouthPole)){const zr=Tt?st.stencilModeFor3D():oo.disabled;return void C1(!!rr.onNorthPole,null,st,d,_e,nr,tr,wr.disabled,zr)}if(!ot.length)return;const[Ar,Dr]=rr instanceof c.aU||lr?[{},ot]:st.stencilConfigForOverlap(ot),Tr=Dr[Dr.length-1].overscaledZ;kt&&tr.defines.push("PROJECTION_GLOBE_VIEW"),Tt&&tr.defines.push("RENDER_CUTOFF");const Wr=(zr,$r,Or)=>{for(const Br of zr){const Xr=Br.toUnwrapped(),an=d.getTile(Br);if(lr&&(!an||!an.hasData()))continue;$t.activeTexture.set(Xt.TEXTURE0);const sn=am(an,rr,_e,tr);if(!sn||!sn.texture)continue;const{texture:wn,mix:Cn,offset:Nn,tileSize:Jn,buffer:yn}=sn;let Qr,Dn;lr?(Qr=Us.disabled,Dn=Br.projMatrix):Tt?(Qr=new Us(Xt.LEQUAL,Us.ReadWrite,st.depthRangeFor3D),Dn=xt?Float32Array.from(st.transform.expandedFarZProjMatrix):st.transform.calculateProjMatrix(Xr,yr)):(Qr=st.depthModeForSublayer(Br.overscaledZ-Tr,_e.paint.get("raster-opacity")===1?Us.ReadWrite:Us.ReadOnly,Xt.LESS),Dn=st.transform.calculateProjMatrix(Xr,yr));const bn=st.terrain&&lr?st.terrain.stencilModeForRTTOverlap(Br):Ar[Br.overscaledZ],$n=mt?0:_e.paint.get("raster-fade-duration");an.registerFadeDuration($n);const ls=d.findLoadedParent(Br,0),As=y1(an,ls,d,st.transform,$n);let is,_i;!As.isFading&&an.refreshedUponExpiration&&(an.refreshedUponExpiration=!1),st.terrain&&st.terrain.prepareDrawTile(),$t.activeTexture.set(Xt.TEXTURE0),wn.bind(xr,Xt.CLAMP_TO_EDGE),$t.activeTexture.set(Xt.TEXTURE1),ls?(ls.texture&&ls.texture.bind(xr,Xt.CLAMP_TO_EDGE),is=Math.pow(2,ls.tileID.overscaledZ-an.tileID.overscaledZ),_i=[an.tileID.canonical.x*is%1,an.tileID.canonical.y*is%1]):wn.bind(xr,Xt.CLAMP_TO_EDGE),"useMipmap"in wn&&$t.extTextureFilterAnisotropic&&st.transform.pitch>20&&Xt.texParameterf(Xt.TEXTURE_2D,$t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,$t.extTextureFilterAnisotropicMax);const Ls=st.transform;let Bs;const _s=Tt?VE(Ls):[0,0,0,0];let Rs,Qs,_o,Xo,Al,zs=0;if(kt&&rr instanceof c.aU&&rr.coordinates.length>3)Rs=Float32Array.from(c.bk(c.dJ(new c.cD(0,0,0)))),Qs=Float32Array.from(Ls.globeMatrix),_o=Float32Array.from(c.dF(Ls)),Xo=[c.aF(Ls.center.lng),c.aJ(Ls.center.lat)],Bs=rr.elevatedGlobePerspectiveTransform,Al=rr.elevatedGlobeGridMatrix||new Float32Array(9);else if(kt){const Vl=c.dG(Br.canonical);zs=c.dH(Vl.getCenter().lat),Rs=Float32Array.from(c.bk(c.dJ(Br.canonical))),Qs=Float32Array.from(Ls.globeMatrix),_o=Float32Array.from(c.dF(Ls)),Xo=[c.aF(Ls.center.lng),c.aJ(Ls.center.lat)],Bs=[0,0],Al=Float32Array.from(c.dI(Br.canonical,Vl,zs,Ls.worldSize/Ls._pixelsPerMercatorPixel))}else Bs=rr instanceof c.aU?rr.perspectiveTransform:[0,0],Rs=new Float32Array(16),Qs=new Float32Array(9),_o=new Float32Array(16),Xo=[0,0],Al=new Float32Array(9);const El=BE(Dn,Rs,Qs,_o,Al,_i||[0,0],c.aj(st.transform.zoom),Xo,_s,is||1,As,_e,Bs,Tt?_e.paint.get("raster-elevation"):0,2,Cn,Nn,tr.range,Jn,yn,nr),mo=st.isTileAffectedByFog(Br),Dl=st.getOrCreateProgram("raster",{defines:tr.defines,overrideFog:mo});if(st.uploadCommonUniforms($t,Dl,Xr),rr instanceof c.aU){const Vl=rr.elevatedGlobeVertexBuffer,Ml=rr.elevatedGlobeIndexBuffer;if(lr||!xt)rr.boundsBuffer&&rr.boundsSegments&&Dl.draw(st,Xt.TRIANGLES,Qr,oo.disabled,cr,wr.disabled,El,_e.id,rr.boundsBuffer,st.quadTriangleIndexBuffer,rr.boundsSegments);else if(Vl&&Ml){const _l=Ls.zoom<=c.c_?rr.elevatedGlobeSegments:rr.getSegmentsForLongitude(Ls.center.lng);_l&&Dl.draw(st,Xt.TRIANGLES,Qr,oo.disabled,cr,$r,El,_e.id,Vl,Ml,_l)}}else if(kt){Qr=new Us(Xt.LEQUAL,Us.ReadOnly,st.depthRangeFor3D);const Vl=st.globeSharedBuffers;if(Vl){const[Ml,_l,So]=Vl.getGridBuffers(zs,!1);Dl.draw(st,Xt.TRIANGLES,Qr,Or||bn,st.colorModeForRenderPass(),$r,El,_e.id,Ml,_l,So)}}else{const{tileBoundsBuffer:Vl,tileBoundsIndexBuffer:Ml,tileBoundsSegments:_l}=st.getTileBoundsBuffers(an);Dl.draw(st,Xt.TRIANGLES,Qr,bn,cr,wr.disabled,El,_e.id,Vl,Ml,_l)}}if(!(rr instanceof c.aU)&&kt)for(const Br of zr){const Xr=Br.canonical.y===(1<<Br.canonical.z)-1;Br.canonical.y===0&&C1(!0,Br,st,d,_e,nr,tr,$r,Or||oo.disabled),Xr&&C1(!1,Br,st,d,_e,nr,tr,$r===wr.frontCW?wr.backCW:wr.frontCW,Or||oo.disabled)}};kt?Wr(Dr,st.renderElevatedRasterBackface?wr.backCW:wr.frontCW,st.stencilModeFor3D()):Wr(Dr,wr.disabled,void 0),st.resetStencilClippingMasks()},"raster-particle":function(st,d,_e,ot,ut,mt){st.renderPass==="offscreen"&&function(xt,Tt,kt,$t){if(!$t.length)return;const Xt=xt.context,rr=Xt.gl,tr=Tt.getSource();if(!(tr instanceof Un))return;const nr=Math.ceil(Math.sqrt(kt.paint.get("raster-particle-count")));let cr=kt.particlePositionRGBAImage;if(!cr||cr.width!==nr){const Dr=function(Tr){const Wr=Tr*Tr,zr=new Uint8Array(4*Wr),$r=function(Br){return Br|=0,Br=Math.imul(2747636419^Br,2654435769),Br=Math.imul(Br^Br>>>16,2654435769),((Br=Math.imul(Br^Br>>>16,2654435769))>>>0)/4294967296},Or=1/1.1;for(let Br=0;Br<Wr;Br++){const Xr=Or*($r(2*Br+0)+$0),an=Or*($r(2*Br+1)+$0),sn=255*Xr%1,wn=255*an%1,Cn=sn,Nn=an-wn/255,Jn=wn;zr[4*Br+0]=255*(Xr-sn/255),zr[4*Br+1]=255*Cn,zr[4*Br+2]=255*Nn,zr[4*Br+3]=255*Jn}return zr}(nr);cr=kt.particlePositionRGBAImage=new c.q({width:nr,height:nr},Dr)}let lr=kt.particleFramebuffer;lr?lr.width!==nr&&(lr.destroy(),lr=kt.particleFramebuffer=Xt.createFramebuffer(nr,nr,1,null)):lr=kt.particleFramebuffer=Xt.createFramebuffer(nr,nr,1,null);const yr=[];for(const Dr of $t){const Tr=Tt.getTile(Dr);if(!(Tr instanceof _a))continue;const Wr=sv(Tr,tr,kt);if(!Wr)continue;const zr=[Tr.tileSize,Tr.tileSize];let $r=kt.tileFramebuffer;$r||($r=kt.tileFramebuffer=Xt.createFramebuffer(zr[0],zr[1],1,null));let Or=Tr.rasterParticleState;Or||(Or=Tr.rasterParticleState=new Dy(Xt,Dr,zr,cr));const Br=Or.update(kt.lastInvalidatedAt);Or.particleTextureDimension!==nr&&Or.updateParticleTexture(Dr,cr);const Xr=Or.targetColorTexture;Or.targetColorTexture=Or.backgroundColorTexture,Or.backgroundColorTexture=Xr;const an=Or.particleTexture0;Or.particleTexture0=Or.particleTexture1,Or.particleTexture1=an,yr.push([Dr,Wr,Or,Br])}if(yr.length===0)return;const xr=c.o.now(),Ar=kt.previousDrawTimestamp?.001*(xr-kt.previousDrawTimestamp):.0167;if(kt.previousDrawTimestamp=xr,kt.hasColorMap()){Xt.activeTexture.set(rr.TEXTURE0+2);let Dr=kt.colorRampTexture;Dr||(Dr=kt.colorRampTexture=new c.T(Xt,kt.colorRamp,rr.RGBA8)),Dr.bind(rr.LINEAR,rr.CLAMP_TO_EDGE)}Xt.bindFramebuffer.set(kt.tileFramebuffer.framebuffer),function(Dr,Tr,Wr){const zr=Dr.context,$r=zr.gl,Or=Tr.tileFramebuffer;zr.activeTexture.set($r.TEXTURE0);const Br={u_texture:0,u_opacity:1.05*(an=Tr.paint.get("raster-particle-fade-opacity-factor"))/(an+.05)},Xr=Dr.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var an;for(const sn of Wr){const[,,wn,Cn]=sn;Or.colorAttachment0.set(wn.targetColorTexture.texture),zr.viewport.set([0,0,Or.width,Or.height]),zr.clear({color:c.ao.transparent}),Cn&&(wn.backgroundColorTexture.bind($r.NEAREST,$r.CLAMP_TO_EDGE),Xr.draw(Dr,$r.TRIANGLES,Us.disabled,oo.disabled,co.alphaBlended,wr.disabled,Br,Tr.id,Dr.viewportBuffer,Dr.quadTriangleIndexBuffer,Dr.viewportSegments))}}(xt,kt,yr),function(Dr,Tr,Wr,zr){const $r=Dr.context,Or=$r.gl,Br=Wr.tileFramebuffer,Xr=Dr.transform.projection.name==="globe",an=Wr.paint.get("raster-particle-max-speed");for(const sn of zr){const[wn,Cn,Nn]=sn;$r.activeTexture.set(Or.TEXTURE0+0),Cn.texture.bind(Or.LINEAR,Or.CLAMP_TO_EDGE),Br.colorAttachment0.set(Nn.targetColorTexture.texture);const Jn=Dr.getOrCreateProgram("rasterParticleDraw",{defines:Cn.defines,overrideFog:!1});$r.activeTexture.set(Or.TEXTURE0+1);const yn=Cn.scalarData?[]:[0,1,2,3].map(bn=>c.e9[bn](wn));yn.push(wn);const Qr=wn.canonical.x,Dn=wn.canonical.y;for(const bn of yn){const $n=Tr.getTile(Xr?bn.wrapped():bn);if(!$n)continue;const ls=$n.rasterParticleState;if(!ls)continue;const As=bn.canonical.x+(1<<bn.canonical.z)*(bn.wrap-wn.wrap),is=bn.canonical.y;ls.particleTexture0.bind(Or.NEAREST,Or.CLAMP_TO_EDGE);const _i=m2(1,ls.particleTexture0.size[0],[As-Qr,is-Dn],0,Cn.texture.size,2,an,Cn.textureOffset,Cn.scale,Cn.offset);Jn.draw(Dr,Or.POINTS,Us.disabled,oo.disabled,co.alphaBlended,wr.disabled,_i,Wr.id,ls.particleIndexBuffer,void 0,ls.particleSegment)}}}(xt,Tt,kt,yr),Xt.bindFramebuffer.set(kt.particleFramebuffer.framebuffer),function(Dr,Tr,Wr,zr){const $r=Dr.context,Or=$r.gl,Br=Tr.paint.get("raster-particle-max-speed"),Xr=zr*Tr.paint.get("raster-particle-speed-factor")*.15,an=function(wn){return Math.pow(wn,6)}(.01+1*Tr.paint.get("raster-particle-reset-rate-factor")),sn=Tr.particleFramebuffer;$r.viewport.set([0,0,sn.width,sn.height]);for(const wn of Wr){const[,Cn,Nn]=wn;$r.activeTexture.set(Or.TEXTURE0+0),Cn.texture.bind(Or.LINEAR,Or.CLAMP_TO_EDGE),$r.activeTexture.set(Or.TEXTURE0+1);const Jn=Nn.particleTexture0;Jn.bind(Or.NEAREST,Or.CLAMP_TO_EDGE);const yn=NE(1,Jn.size[0],0,Cn.texture.size,Br,Xr,an,Cn.textureOffset,Cn.scale,Cn.offset);sn.colorAttachment0.set(Nn.particleTexture1.texture),$r.clear({color:c.ao.transparent}),Dr.getOrCreateProgram("rasterParticleUpdate",{defines:Cn.defines}).draw(Dr,Or.TRIANGLES,Us.disabled,oo.disabled,co.unblended,wr.disabled,yn,Tr.id,Dr.viewportBuffer,Dr.quadTriangleIndexBuffer,Dr.viewportSegments)}}(xt,kt,yr,Ar)}(st,d,_e,ot),st.renderPass==="translucent"&&(function(xt,Tt,kt,$t,Xt){const rr=xt.context,tr=rr.gl,nr=Tt.getSource().tileSize,cr=5*(1-c.ah(c.cL,c.cL+1,xt.transform.zoom))*nr+kt.paint.get("raster-particle-elevation"),lr=!xt.options.moving,yr=xt.transform.projection.name==="globe";if(!$t.length)return;const[xr,Ar]=xt.stencilConfigForOverlap($t),Dr=[];yr&&Dr.push("PROJECTION_GLOBE_VIEW");const Tr=xt.stencilModeFor3D();for(const Wr of Ar){const zr=Wr.toUnwrapped(),$r=Tt.getTile(Wr);if(!$r.rasterParticleState)continue;const Or=$r.rasterParticleState,Br=100;$r.registerFadeDuration(Br);const Xr=Tt.findLoadedParent(Wr,0),an=y1($r,Xr,Tt,xt.transform,Br);let sn,wn;xt.terrain&&xt.terrain.prepareDrawTile(),rr.activeTexture.set(tr.TEXTURE0),Or.targetColorTexture.bind(tr.LINEAR,tr.CLAMP_TO_EDGE),rr.activeTexture.set(tr.TEXTURE1),Xr&&Xr.rasterParticleState?(Xr.rasterParticleState.targetColorTexture.bind(tr.LINEAR,tr.CLAMP_TO_EDGE),sn=Math.pow(2,Xr.tileID.overscaledZ-$r.tileID.overscaledZ),wn=[$r.tileID.canonical.x*sn%1,$r.tileID.canonical.y*sn%1]):Or.targetColorTexture.bind(tr.LINEAR,tr.CLAMP_TO_EDGE);const Cn=yr?Float32Array.from(xt.transform.expandedFarZProjMatrix):xt.transform.calculateProjMatrix(zr,lr),Nn=xt.transform,Jn=UE(Nn),yn=c.dG(Wr.canonical),Qr=c.dH(yn.getCenter().lat);let Dn,bn,$n,ls,As;yr?(Dn=Float32Array.from(c.bk(c.dJ(Wr.canonical))),bn=Float32Array.from(Nn.globeMatrix),$n=Float32Array.from(c.dF(Nn)),ls=[c.aF(Nn.center.lng),c.aJ(Nn.center.lat)],As=Float32Array.from(c.dI(Wr.canonical,yn,Qr,Nn.worldSize/Nn._pixelsPerMercatorPixel))):(Dn=new Float32Array(16),bn=new Float32Array(9),$n=new Float32Array(16),ls=[0,0],As=new Float32Array(9));const is=p2(Cn,Dn,bn,$n,As,wn||[0,0],c.aj(xt.transform.zoom),ls,Jn,sn||1,an,cr),_i=xt.isTileAffectedByFog(Wr),Ls=xt.getOrCreateProgram("rasterParticle",{defines:Dr,overrideFog:_i});if(xt.uploadCommonUniforms(rr,Ls,zr),yr){const Bs=new Us(tr.LEQUAL,Us.ReadOnly,xt.depthRangeFor3D),_s=0,Rs=xt.globeSharedBuffers;if(Rs){const[Qs,_o,Xo]=Rs.getGridBuffers(Qr,_s!==0);Ls.draw(xt,tr.TRIANGLES,Bs,Tr,co.alphaBlended,xt.renderElevatedRasterBackface?wr.frontCCW:wr.backCCW,is,kt.id,Qs,_o,Xo)}}else{const Bs=xt.depthModeForSublayer(0,Us.ReadOnly),_s=xr[Wr.overscaledZ],{tileBoundsBuffer:Rs,tileBoundsIndexBuffer:Qs,tileBoundsSegments:_o}=xt.getTileBoundsBuffers($r);Ls.draw(xt,tr.TRIANGLES,Bs,_s,co.alphaBlended,wr.disabled,is,kt.id,Rs,Qs,_o)}}xt.resetStencilClippingMasks()}(st,d,_e,ot),st.style.map.triggerRepaint())},background:function(st,d,_e,ot){const ut=_e.paint.get("background-color"),mt=_e.paint.get("background-color-use-theme").constantOr("default")==="none",xt=_e.paint.get("background-opacity"),Tt=_e.paint.get("background-emissive-strength"),kt=_e.paint.get("background-pitch-alignment")==="viewport";if(xt===0)return;const $t=st.context,Xt=$t.gl,rr=st.transform,tr=rr.tileSize,nr=_e.paint.get("background-pattern");let cr;if(nr!==void 0&&(nr===null||(cr=st.imageManager.getPattern(c.I.from(nr.toString()),_e.scope,st.style.getLut(_e.scope)),!cr)))return;const lr=!nr&&ut.a===1&&xt===1&&st.opaquePassEnabledForLayer()?"opaque":"translucent";if(st.renderPass!==lr)return;const yr=oo.disabled,xr=st.depthModeForSublayer(0,lr==="opaque"?Us.ReadWrite:Us.ReadOnly),Ar=st.colorModeForDrapableLayerRenderPass(Tt),Dr=nr?"backgroundPattern":"background";let Tr,Wr=ot;Wr||(Tr=st.getBackgroundTiles(),Wr=Object.values(Tr).map($r=>$r.tileID)),nr&&($t.activeTexture.set(Xt.TEXTURE0),st.imageManager.bind(st.context,_e.scope));const zr=[];if(st.terrain&&st.terrain.renderingToTexture&&st.emissiveMode==="mrt-fallback"&&zr.push("USE_MRT1"),kt){const $r=st.getOrCreateProgram(Dr,{overrideFog:!1,overrideRtt:!0,defines:zr}),Or=new Float32Array(c.bA([])),Br=new c.aQ(0,0,0,0,0),Xr=nr?Om(Or,Tt,xt,st,0,_e.scope,cr,kt,{tileID:Br,tileSize:tr}):v1(Or,Tt,xt,ut.toPremultipliedRenderColor(mt?null:_e.lut));$r.draw(st,Xt.TRIANGLES,xr,yr,Ar,wr.disabled,Xr,_e.id,st.viewportBuffer,st.quadTriangleIndexBuffer,st.viewportSegments)}else for(const $r of Wr){const Or=st.isTileAffectedByFog($r),Br=st.getOrCreateProgram(Dr,{overrideFog:Or,defines:zr}),Xr=$r.toUnwrapped(),an=ot?$r.projMatrix:st.transform.calculateProjMatrix(Xr);st.prepareDrawTile();const sn=d?d.getTile($r):Tr?Tr[$r.key]:new Fp($r,tr,rr.zoom,st),wn=nr?Om(an,Tt,xt,st,0,_e.scope,cr,kt,{tileID:$r,tileSize:tr}):v1(an,Tt,xt,ut.toPremultipliedRenderColor(mt?null:_e.lut));st.uploadCommonUniforms($t,Br,Xr);const{tileBoundsBuffer:Cn,tileBoundsIndexBuffer:Nn,tileBoundsSegments:Jn}=st.getTileBoundsBuffers(sn);Br.draw(st,Xt.TRIANGLES,xr,yr,Ar,wr.disabled,wn,_e.id,Cn,Nn,Jn)}},sky:function(st,d,_e){const ot=st._atmosphere?c.aj(st.transform.zoom):1,ut=_e.paint.get("sky-opacity")*ot;if(ut===0)return;const mt=st.context,xt=_e.paint.get("sky-type"),Tt=new Us(mt.gl.LEQUAL,Us.ReadOnly,[0,1]),kt=st.frameCounter/1e3%1;xt==="atmosphere"?st.renderPass==="offscreen"?_e.needsSkyboxCapture(st)&&(function($t,Xt,rr,tr){const nr=$t.context,cr=nr.gl;let lr=Xt.skyboxFbo;if(!lr){lr=Xt.skyboxFbo=nr.createFramebuffer(32,32,1,null),Xt.skyboxGeometry=new ky(nr),Xt.skyboxTexture=nr.gl.createTexture(),cr.bindTexture(cr.TEXTURE_CUBE_MAP,Xt.skyboxTexture),cr.texParameteri(cr.TEXTURE_CUBE_MAP,cr.TEXTURE_WRAP_S,cr.CLAMP_TO_EDGE),cr.texParameteri(cr.TEXTURE_CUBE_MAP,cr.TEXTURE_WRAP_T,cr.CLAMP_TO_EDGE),cr.texParameteri(cr.TEXTURE_CUBE_MAP,cr.TEXTURE_MIN_FILTER,cr.LINEAR),cr.texParameteri(cr.TEXTURE_CUBE_MAP,cr.TEXTURE_MAG_FILTER,cr.LINEAR);for(let Dr=0;Dr<6;++Dr)cr.texImage2D(cr.TEXTURE_CUBE_MAP_POSITIVE_X+Dr,0,cr.RGBA,32,32,0,cr.RGBA,cr.UNSIGNED_BYTE,null)}nr.bindFramebuffer.set(lr.framebuffer),nr.viewport.set([0,0,32,32]);const yr=Xt.getCenter($t,!0),xr=$t.getOrCreateProgram("skyboxCapture"),Ar=new Float64Array(16);c.bA(Ar),c.en(Ar,Ar,.5*-Math.PI),ux($t,Xt,xr,Ar,yr,0),c.bA(Ar),c.en(Ar,Ar,.5*Math.PI),ux($t,Xt,xr,Ar,yr,1),c.bA(Ar),c.cU(Ar,Ar,.5*-Math.PI),ux($t,Xt,xr,Ar,yr,2),c.bA(Ar),c.cU(Ar,Ar,.5*Math.PI),ux($t,Xt,xr,Ar,yr,3),c.bA(Ar),ux($t,Xt,xr,Ar,yr,4),c.bA(Ar),c.en(Ar,Ar,Math.PI),ux($t,Xt,xr,Ar,yr,5),nr.viewport.set([0,0,$t.width,$t.height])}(st,_e),_e.markSkyboxValid(st)):st.renderPass==="sky"&&function($t,Xt,rr,tr,nr){const cr=$t.context,lr=cr.gl,yr=$t.transform,xr=$t.getOrCreateProgram("skybox");cr.activeTexture.set(lr.TEXTURE0),lr.bindTexture(lr.TEXTURE_CUBE_MAP,Xt.skyboxTexture);const Ar=((Dr,Tr,Wr,zr,$r)=>({u_matrix:Dr,u_sun_direction:Tr,u_cubemap:0,u_opacity:zr,u_temporal_offset:$r}))(yr.skyboxMatrix,Xt.getCenter($t,!1),0,tr,nr);$t.uploadCommonUniforms(cr,xr),xr.draw($t,lr.TRIANGLES,rr,oo.disabled,$t.colorModeForRenderPass(),wr.backCW,Ar,"skybox",Xt.skyboxGeometry.vertexBuffer,Xt.skyboxGeometry.indexBuffer,Xt.skyboxGeometry.segment)}(st,_e,Tt,ut,kt):xt==="gradient"&&st.renderPass==="sky"&&function($t,Xt,rr,tr,nr){const cr=$t.context,lr=cr.gl,yr=$t.transform,xr=$t.getOrCreateProgram("skyboxGradient");Xt.skyboxGeometry||(Xt.skyboxGeometry=new ky(cr)),cr.activeTexture.set(lr.TEXTURE0);let Ar=Xt.colorRampTexture;Ar||(Ar=Xt.colorRampTexture=new c.T(cr,Xt.colorRamp,lr.RGBA8)),Ar.bind(lr.LINEAR,lr.CLAMP_TO_EDGE);const Dr=((Tr,Wr,zr,$r,Or)=>({u_matrix:Tr,u_color_ramp:0,u_center_direction:Wr,u_radius:c.an(zr),u_opacity:$r,u_temporal_offset:Or}))(yr.skyboxMatrix,Xt.getCenter($t,!1),Xt.paint.get("sky-gradient-radius"),tr,nr);$t.uploadCommonUniforms(cr,xr),xr.draw($t,lr.TRIANGLES,rr,oo.disabled,$t.colorModeForRenderPass(),wr.backCW,Dr,"skyboxGradient",Xt.skyboxGeometry.vertexBuffer,Xt.skyboxGeometry.indexBuffer,Xt.skyboxGeometry.segment)}(st,_e,Tt,ut,kt)},custom:function(st,d,_e,ot){const ut=st.context,mt=_e.implementation;if(!st.transform.projection.unsupportedLayers||!st.transform.projection.unsupportedLayers.includes("custom")||st.terrain&&(st.terrain.renderingToTexture||st.renderPass==="offscreen")&&_e.isDraped(d)){if(st.renderPass==="offscreen"){const xt=mt.prerender;if(xt){if(st.setCustomLayerDefaults(),ut.setColorMode(st.colorModeForRenderPass()),st.transform.projection.name==="globe"){const Tt=st.transform.pointMerc;xt.call(mt,ut.gl,st.transform.customLayerMatrix(),st.transform.getProjection(),st.transform.globeToMercatorMatrix(),c.aj(st.transform.zoom),[Tt.x,Tt.y],st.transform.pixelsPerMeterRatio)}else xt.call(mt,ut.gl,st.transform.customLayerMatrix());ut.setDirty(),st.setBaseState()}}else if(st.renderPass==="translucent"){if(st.terrain&&st.terrain.renderingToTexture){const Tt=mt.renderToTile;if(Tt){const kt=ot[0].canonical,$t={x:kt.x+ot[0].wrap*(mt.wrapTileId?0:1<<kt.z),y:kt.y,z:kt.z};ut.setDepthMode(Us.disabled),ut.setStencilMode(oo.disabled),ut.setColorMode(st.colorModeForRenderPass()),st.setCustomLayerDefaults(),Tt.call(mt,ut.gl,$t),ut.setDirty(),st.setBaseState()}return}st.setCustomLayerDefaults(),ut.setColorMode(st.colorModeForRenderPass()),ut.setStencilMode(oo.disabled);const xt=mt.renderingMode==="3d"?new Us(st.context.gl.LEQUAL,Us.ReadWrite,st.depthRangeFor3D):st.depthModeForSublayer(0,Us.ReadOnly);if(ut.setDepthMode(xt),st.transform.projection.name==="globe"){const Tt=st.transform.pointMerc;mt.render(ut.gl,st.transform.customLayerMatrix(),st.transform.getProjection(),st.transform.globeToMercatorMatrix(),c.aj(st.transform.zoom),[Tt.x,Tt.y],st.transform.pixelsPerMeterRatio)}else mt.render(ut.gl,st.transform.customLayerMatrix());ut.setDirty(),st.setBaseState(),ut.bindFramebuffer.set(null)}}else c.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(st,d,_e,ot){if(st.renderPass==="opaque")return;const ut=_e.paint.get("model-opacity").constantOr(1),mt=_e.paint.get("model-elevation-reference"),xt=mt==="ground",Tt=mt==="ground";if(ut===0)return;const kt=_e.paint.get("model-cast-shadows");if(st.renderPass==="shadow"&&(!kt||st.terrain&&ut<.65&&_e._transitionablePaint._values["model-opacity"].value.expression instanceof c.ad))return;const $t=st.shadowRenderer,Xt=_e.paint.get("model-receive-shadows");$t&&($t.useNormalOffset=!0,Xt||($t.enabled=!1));const rr=()=>{$t&&($t.useNormalOffset=!0,Xt||($t.enabled=!0))},tr=d.getSource();if(st.renderPass==="light-beam"&&tr.type!=="batched-model")return;if(tr.type==="vector"||tr.type==="geojson")return function(Tr,Wr,zr,$r,Or){const Br=Tr.transform,Xr=Br.projection.name==="globe",an=Br.getFreeCameraOptions().position;if(!Tr.modelManager)return;const sn=Tr.modelManager;zr.modelManager=sn;const wn=Tr.shadowRenderer;if(!zr._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Cn=zr._unevaluatedLayout._values["model-id"],Nn=Object.assign({},zr.layout.get("model-id").parameters),Jn=Tr.style.order.indexOf(zr.fqid),yn=zr.paint.get("model-opacity").constantOr(1);for(const Qr of $r){const Dn=Wr.getTile(Qr).getBucket(zr);if(!Dn||Dn.projection.name!==Br.projection.name)continue;const bn=Dn.getModelUris();if(bn&&!Dn.modelsRequested&&(sn.addModelsFromBucket(bn,Or),Dn.modelsRequested=!0),Xr)Nn.zoom=Qr.overscaledZ;else{const _s=Np(Qr,Br);Nn.zoom=_s}const $n=Cn.possiblyEvaluate(Nn);if(QE(Tr,Dn,Qr),W0.shadowUniformsInitialized=!1,W0.useSingleShadowCascade=!!wn&&wn.getMaxCascadeForTile(Qr.toUnwrapped())===0,Tr.renderPass==="shadow"&&wn){if(Tr.currentShadowCascade===1&&Dn.isInsideFirstShadowMapFrustum)continue;const _s=Br.calculatePosMatrix(Qr.toUnwrapped(),Br.worldSize);if(W0.tileMatrix.set(_s),W0.shadowTileMatrix=Float32Array.from(wn.calculateShadowPassMatrixFromMatrix(_s)),W0.aabb.min=[0,0,0],W0.aabb.max[0]=W0.aabb.max[1]=c.al,W0.aabb.max[2]=0,_2(Dn,W0,Tr,zr.scope))continue}const ls=1<<Qr.canonical.z,As=[((an.x-Qr.wrap)*ls-Qr.canonical.x)*c.al,(an.y*ls-Qr.canonical.y)*c.al,an.z*ls*c.al];Tr.conflationActive&&Object.keys(Dn.instancesPerModel).length>0&&Tr.style.isLayerClipped(zr,Wr.getSource())&&Dn.updateReplacement(Qr,Tr.replacementSource,Jn,zr.scope)&&(Dn.uploaded=!1,Dn.upload(Tr.context));let is=0;const _i=new Array,Ls=new Array,Bs=new Array;for(let _s in Dn.instancesPerModel){const Rs=Dn.instancesPerModel[_s];Rs.features.length>0&&!Xr&&(_s=$n.evaluate(Rs.features[0].feature,{}));const Qs=sn.getModel(_s,Or);if(Qs||sn.hasURLBeenRequested(_s)||Dn.modelUris.includes(_s)||(Dn.modelUris.push(_s),Dn.modelsRequested=!1),Qs&&Qs.uploaded)if(Xr){const _o=c.c5([],[an.x,an.y,an.z],Tr.transform.worldSize);c.ew(_o,_o);for(let Xo=0;Xo<Rs.instancedDataArray.length;++Xo){const Al=[0,0,0],zs=[1,1,1],El=c.ex(),mo=Rs.tileCoordinatesForInstance(Xo),Dl=Rs.transformForInstance(Xo);c.ey(zs,Dl),c.ez(El,Dl),c.eA(Al,El);const Vl=Rs.translationForInstance(Xo),Ml=new c.aT(0,0);c.eB(Dn.canonical,Ml,mo.x,mo.y);const _l=c.bC();c.eC(_l,Qs,Tr.transform,Ml,Al,zs,Vl,!0,!1,!1);const So=Rs.colorForInstance(Xo),Rl=c.bA([]),Au=c.ef(Ml.lat,Tr.transform.zoom),fu=c.bq([],[1,1,1/Au]);c.br(Rl,Rl,_o),Bs.push({zScaleMatrix:fu,negCameraPosMatrix:Rl});for(const Pl of Qs.nodes)dx(Tr,Pl,_l,Tr.transform.expandedFarZProjMatrix,is,_i,Ls,Qs.materialOverrides,yn,So);++is}}else for(const _o of Qs.nodes)JE(Tr,zr,_o,Rs,As,Qr,W0)}if(Xr)if(Tr.renderPass==="shadow"){for(const _s of Ls)F0(_s.mesh,_s.nodeModelMatrix,Tr,zr);for(const _s of _i)F0(_s.mesh,_s.nodeModelMatrix,Tr,zr)}else YE(Tr,zr,_i,Ls,Bs)}}(st,d,_e,ot,A1(st,_e)),void rr();if(!tr.loaded())return;if(tr.type==="batched-model")return function(Tr,Wr,zr,$r){zr.resetLayerRenderingStats(Tr);const Or=Tr.context,Br=Tr.transform,Xr=Tr.style.fog,an=Tr.shadowRenderer;if(Br.projection.name!=="mercator")return void c.w(`Drawing 3D landmark models for ${Br.projection.name} projection is not yet implemented`);const sn=Tr.transform.getFreeCameraOptions().position,wn=c.c5([],[sn.x,sn.y,sn.z],Tr.transform.worldSize),Cn=c.ew([],wn),Nn=c.bA([]),Jn=c.ef(Br.center.lat,Br.zoom),yn=c.bq([],[1,1,1/Jn]);c.br(Nn,Nn,Cn);const Qr=zr.paint.get("model-opacity").constantOr(1),Dn=new Us(Or.gl.LEQUAL,Us.ReadWrite,Tr.depthRangeFor3D),bn=new Us(Or.gl.LEQUAL,Us.ReadOnly,Tr.depthRangeFor3D),$n=new c.d9([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),ls=Tr.renderPass==="shadow",As=ls&&an?an.getCurrentCascadeFrustum():Br.getFrustum(Br.scaleZoom(Br.worldSize)),is=zr.paint.get("model-front-cutoff"),_i=is[2]<1,Ls=Er(Tr,zr.paint.get("model-cutoff-fade-range")),Bs=zr.getLayerRenderingStats();(function(_s,Rs,Qs,_o){const Xo=_s.terrain?_s.terrain.exaggeration():0,Al=_s.transform.zoom;for(const zs of _o){const El=Rs.getTile(zs).getBucket(Qs);El&&(El.setFilter(Qs.filter),_s.conflationActive&&El.updateReplacement(zs,_s.replacementSource),El.evaluateTransform(_s,Qs),_s.terrain&&Xo>0&&El.elevationUpdate(_s.terrain,Xo,zs,Qs.source),El.needsReEvaluation(_s,Al,Qs)&&El.evaluate(Qs))}})(Tr,Wr,zr,$r),function(){let _s,Rs,Qs;_i?(_s=$r.length-1,Rs=-1,Qs=-1):(_s=0,Rs=$r.length,Qs=1);const _o=new Float64Array(16),Xo=c.cA(),Al=new c.P(0,0);for(let zs=_s;zs!==Rs;zs+=Qs){const El=$r[zs],mo=Wr.getTile(El).getBucket(zr);if(!mo||!mo.uploaded)continue;let Dl=!1;an&&(Dl=an.getMaxCascadeForTile(El.toUnwrapped())===0);const Vl=Br.calculatePosMatrix(El.toUnwrapped(),Br.worldSize),Ml=mo.modelTraits;!ls&&_i&&(c.bl(_o,Vl),c.af(Xo,wn,_o),Al.x=Xo[0],Al.y=Xo[1]);const _l=[];mo.setFilter(zr.filter);for(const So of mo.getNodesInfo()){if(So.hiddenByReplacement||!So.node.meshes)continue;const Rl=So.node;let Au=0;Tr.terrain&&Rl.elevation&&(Au=Rl.elevation*Tr.terrain.exaggeration());const fu=(()=>{const Sp=So.aabb;return $n.min=[...Sp.min],$n.max=[...Sp.max],$n.min[2]+=Au,$n.max[2]+=Au,c.af($n.min,$n.min,Vl),c.af($n.max,$n.max,Vl),$n})(),Pl=So.evaluatedScale;if(Pl[0]<=1&&Pl[1]<=1&&Pl[2]<=1&&fu.intersects(As)===0)continue;if(!ls&&_i){const Sp=.16666666666666666;So.cameraCollisionOpacity=wn[0]>fu.min[0]&&wn[0]<fu.max[0]&&wn[1]>fu.min[1]&&wn[1]<fu.max[1]&&wn[2]*Jn<fu.max[2]&&Rl.footprint&&c.c0(Al,Rl.footprint)?Math.max(So.cameraCollisionOpacity-Sp,0):Math.min(1,So.cameraCollisionOpacity+Sp)}const $a=[...Vl],To=1/c.d7(El.canonical),cu=Rl.anchor?Rl.anchor[0]:0,Lu=Rl.anchor?Rl.anchor[1]:0;c.br($a,$a,[cu*(Pl[0]-1)+So.evaluatedTranslation[0]*To,Lu*(Pl[1]-1)+So.evaluatedTranslation[1]*To,Au+So.evaluatedTranslation[2]]),c.cq(Pl,c.eE)||c.cS($a,$a,Pl);const bu=c.aB([],$a,Rl.globalMatrix),Zl=c.aB([],Br.expandedFarZProjMatrix,bu),Op=c.aB([],Br.expandedFarZProjMatrix,$a),_p=c.aC([],[cu,Lu,Au,1],Zl)[2];Rl.hidden=!1;let tp=Qr;ls||(_i&&(tp*=So.cameraCollisionOpacity,tp*=Go($a,Br,So.aabb,is)),tp*=hu(Ls,_p)),tp!==0?_l.push({nodeInfo:So,depth:_p,opacity:tp,wvpForNode:Zl,wvpForTile:Op,nodeModelMatrix:bu,tileModelMatrix:$a}):Rl.hidden=!0}ls||_l.sort((So,Rl)=>!_i||So.opacity===1&&Rl.opacity===1?So.depth<Rl.depth?-1:1:So.opacity===1?-1:Rl.opacity===1?1:So.depth>Rl.depth?-1:1);for(const So of _l){const Rl=So.nodeInfo,Au=Rl.node;let fu=c.aB([],yn,So.tileModelMatrix);c.aB(fu,Nn,fu);const Pl=c.bl([],fu);c.eg(Pl,Pl),c.cS(Pl,Pl,S1),fu=c.aB(fu,fu,Au.globalMatrix);const $a=Tr.renderPass==="light-beam",To=zr.paint.get("model-color-use-theme").constantOr("default")==="none",cu=Ml&c.eI.HasMapboxMeshFeatures,Lu=cu?0:Rl.evaluatedRMEA[0][2];for(let bu=0;bu<Au.meshes.length;++bu){const Zl=Au.meshes[bu],Op=bu===Au.lightMeshIndex;let _p=So.wvpForNode;if(Op){if(!$a&&!Tr.terrain&&Tr.shadowRenderer){Tr.currentLayer<Tr.firstLightBeamLayer&&(Tr.firstLightBeamLayer=Tr.currentLayer);continue}_p=So.wvpForTile}else if($a)continue;const tp={defines:[]},Sp=[];if(!ls&&an&&(an.useNormalOffset=!!Zl.normalBuffer),My(tp.defines,Sp,Zl,Tr,To?null:zr.lut),cu||tp.defines.push("DIFFUSE_SHADED"),Dl&&tp.defines.push("SHADOWS_SINGLE_CASCADE"),Bs&&(ls?Bs.numRenderedVerticesInShadowPass+=Zl.vertexArray.length:Bs.numRenderedVerticesInTransparentPass+=Zl.vertexArray.length),ls){F0(Zl,So.nodeModelMatrix,Tr,zr);continue}let Tp=null;if(Xr){const Gu=By(So.nodeModelMatrix,Tr.transform);if(Tp=new Float32Array(Gu),Br.projection.name!=="globe"){const Yl=Zl.aabb.min,Xu=Zl.aabb.max,[Su,wu]=Xr.getOpacityForBounds(Gu,Yl[0],Yl[1],Xu[0],Xu[1]);tp.overrideFog=Su>=Rn||wu>=Rn}}const xp=Zl.material;let c0;xp.occlusionTexture&&xp.occlusionTexture.offsetScale&&(c0=xp.occlusionTexture.offsetScale,tp.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const A0=Tr.getOrCreateProgram("model",tp);!ls&&an&&an.setupShadowsFromMatrix(So.tileModelMatrix,A0,an.useNormalOffset),Tr.uploadCommonUniforms(Or,A0,null,Tp);const Wp=xp.pbrMetallicRoughness;Wp.metallicFactor=.9,Wp.roughnessFactor=.5;const Bu=ix(new Float32Array(_p),new Float32Array(fu),new Float32Array(Pl),new Float32Array(Au.globalMatrix),Tr,So.opacity,Wp.baseColorFactor,xp.emissiveFactor,Wp.metallicFactor,Wp.roughnessFactor,xp,Lu,zr,[0,0,0],c0);!Op&&(Rl.hasTranslucentParts||So.opacity<1)&&A0.draw(Tr,Or.gl.TRIANGLES,Dn,oo.disabled,co.disabled,wr.backCCW,Bu,zr.id,Zl.vertexBuffer,Zl.indexBuffer,Zl.segments,zr.paint,Tr.transform.zoom,void 0,Sp),A0.draw(Tr,Or.gl.TRIANGLES,Op?bn:Dn,oo.disabled,Op||So.opacity<1||Rl.hasTranslucentParts?co.alphaBlended:co.unblended,wr.backCCW,Bu,zr.id,Zl.vertexBuffer,Zl.indexBuffer,Zl.segments,zr.paint,Tr.transform.zoom,void 0,Sp)}}}}()}(st,d,_e,ot),void rr();if(tr.type!=="model")return;const nr=tr.getModels(),cr=[],lr=st.transform.getFreeCameraOptions().position,yr=c.c5([],[lr.x,lr.y,lr.z],st.transform.worldSize);c.ew(yr,yr);const xr=[],Ar=[];let Dr=0;for(const Tr of nr){const Wr=d.getFeatureState("",Tr.id),zr={type:"Unknown",id:Tr.id,properties:Tr.featureProperties},$r=_e.paint.get("model-rotation").evaluate(zr,Wr),Or=_e.paint.get("model-scale").evaluate(zr,Wr),Br=_e.paint.get("model-translation").evaluate(zr,Wr),Xr=_e.paint.get("model-opacity").evaluate(zr,Wr);KE(_e,Tr.id,Wr,Tr.featureProperties,Tr.nodeOverrideNames,Tr.nodeOverrides),ZE(_e,Tr.id,Wr,Tr.featureProperties,Tr.materialOverrideNames,Tr.materialOverrides),Tr.nodeOverrides.size>0&&Tr.computeBoundsAndApplyParent(),Tr.computeModelMatrix(st,$r,Or,Br,Tt,xt,!1);const an=c.bA([]),sn=c.ef(Tr.position.lat,st.transform.zoom),wn=c.bq([],[1,1,1/sn]);c.br(an,an,yr),cr.push({zScaleMatrix:wn,negCameraPosMatrix:an});for(const Cn of Tr.nodes)dx(st,Cn,Tr.matrix,st.transform.expandedFarZProjMatrix,Dr,xr,Ar,Tr.materialOverrides,Xr);Dr++}if(xr.sort((Tr,Wr)=>Wr.depth-Tr.depth),st.renderPass!=="shadow")YE(st,_e,xr,Ar,cr),rr();else{for(const Tr of Ar)F0(Tr.mesh,Tr.nodeModelMatrix,st,_e);for(const Tr of xr)F0(Tr.mesh,Tr.nodeModelMatrix,st,_e);rr()}}},jy={line:function(st,d,_e){if(st.hasElevatedBuckets=!1,st.hasNonElevatedBuckets=!1,st._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||st._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(d){const ot=d.getVisibleCoordinates();for(const ut of ot){const mt=d.getTile(ut).getBucket(st);if(mt&&(mt.elevationType!=="none"?st.hasElevatedBuckets=!0:st.hasNonElevatedBuckets=!0,st.hasElevatedBuckets&&st.hasNonElevatedBuckets))break}}}else st.hasNonElevatedBuckets=!0},model:function(st,d,_e){const ot=d.getSource();if(!ot.loaded())return;if(ot.type==="vector"||ot.type==="geojson")return void(_e.modelManager&&_e.modelManager.upload(_e,A1(_e,st)));if(ot.type==="batched-model"||ot.type!=="model")return;const ut=ot.getModels();for(const mt of ut)mt.upload(_e.context)},raster:function(st,d,_e){const ot=d.getSource();if(!(ot instanceof Un&&ot.loaded()))return;const ut=st.sourceLayer||ot.rasterLayerIds&&ot.rasterLayerIds[0];if(!ut)return;const mt=st.paint.get("raster-array-band")||ot.getInitialBand(ut);if(mt==null)return;const xt=d.getIds().map(Tt=>d.getTileByID(Tt));for(const Tt of xt)Tt.updateNeeded(st.id,mt)&&ot.prepareTile(Tt,ut,st.id,mt)},"raster-particle":function(st,d,_e){const ot=d.getSource();if(!(ot instanceof Un&&ot.loaded()))return;const ut=st.sourceLayer||ot.rasterLayerIds&&ot.rasterLayerIds[0];if(!ut)return;const mt=st.paint.get("raster-particle-array-band")||ot.getInitialBand(ut);if(mt==null)return;const xt=d.getIds().map(Tt=>d.getTileByID(Tt));for(const Tt of xt)Tt.updateNeeded(st.id,mt)&&ot.prepareTile(Tt,ut,st.id,mt)}},l0={fill:Ay},zy={fill:function(st,d,_e,ot){if(!_e.layout||_e.layout.get("fill-elevation-reference")==="none"||_e.paint.get("fill-opacity").constantOr(1)===0)return;const ut=st.context.gl,mt=new Us(ut.LEQUAL,Us.ReadOnly,st.depthRangeFor3D),xt=new oo({func:ut.ALWAYS,mask:255},255,255,ut.KEEP,ut.KEEP,ut.REPLACE),Tt=st.transform.getFreeCameraOptions().position,kt=st.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(const $t of ot){const Xt=d.getTile($t),rr=Xt.getBucket(_e);if(!rr)continue;const tr=rr.elevatedStructures;if(!tr||tr.depthSegments.segments[0].primitiveLength===0)continue;const nr=zE($t.toUnwrapped(),Tt),cr=st.translatePosMatrix($t.projMatrix,Xt,_e.paint.get("fill-translate"),_e.paint.get("fill-translate-anchor")),lr=nx(cr,nr,0,1,0);kt.draw(st,ut.TRIANGLES,mt,xt,co.disabled,wr.disabled,lr,_e.id,tr.vertexBuffer,tr.indexBuffer,tr.depthSegments,_e.paint,st.transform.zoom)}}};class Vy{constructor(d,_e,ot,ut,mt){this.context=new Vx(d,_e),this.transform=ot,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this._timeStamp=c.o.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const xt=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const kt of xt)this._debugParams.enabledLayers[kt]=!0;for(const kt of xt);this.occlusionParams=new Gx,this.setup(),this.numSublayers=Du.maxUnderzooming+Du.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new c.eP,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new An(this),this._wireframeDebugCache=new jm,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const Tt=new c.q({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new c.T(this.context,Tt,d.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=ut,this.worldview=mt,this._forceEmissiveMode=!1,this.emissiveMode="constant"}updateTerrain(d,_e){const ot=!!d&&!!d.terrain&&this.transform.projection.supportsTerrain;if(!(ot||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new X_(this,d));const ut=this._terrain;this.transform.elevation=ot?ut:null,ut.update(d,this.transform,_e),this.transform.elevation&&!ut.enabled&&(this.transform.elevation=null)}_updateFog(d){const _e=d.fog;if(!_e||this.transform.projection.name==="globe"||_e.getOpacity(this.transform.pitch)<1||_e.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[ot,ut]=_e.getFovAdjustedRange(this.transform._fov);if(ot>ut)return void(this.transform.fogCullDistSq=null);const mt=ot+.78*(ut-ot);this.transform.fogCullDistSq=mt*mt}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(d){d&&!this._terrain&&(this._terrain=new X_(this,this.style)),this._forceTerrainMode=d}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(d,_e){if(this.width=d*c.o.devicePixelRatio,this.height=_e*c.o.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const ot of this.style.order)this.style._mergedLayers[ot].resize()}setup(){const d=this.context,_e=new c.bd;_e.emplaceBack(0,0),_e.emplaceBack(c.al,0),_e.emplaceBack(0,c.al),_e.emplaceBack(c.al,c.al),this.tileExtentBuffer=d.createVertexBuffer(_e,c.bf.members),this.tileExtentSegments=c.bg.simpleSegment(0,0,4,2);const ot=new c.bd;ot.emplaceBack(0,0),ot.emplaceBack(c.al,0),ot.emplaceBack(0,c.al),ot.emplaceBack(c.al,c.al),this.debugBuffer=d.createVertexBuffer(ot,c.bf.members),this.debugSegments=c.bg.simpleSegment(0,0,4,5);const ut=new c.bd;ut.emplaceBack(-1,-1),ut.emplaceBack(1,-1),ut.emplaceBack(-1,1),ut.emplaceBack(1,1),this.viewportBuffer=d.createVertexBuffer(ut,c.bf.members),this.viewportSegments=c.bg.simpleSegment(0,0,4,2);const mt=new c.b1;mt.emplaceBack(0,0,0,0),mt.emplaceBack(c.al,0,c.al,0),mt.emplaceBack(0,c.al,0,c.al),mt.emplaceBack(c.al,c.al,c.al,c.al),this.mercatorBoundsBuffer=d.createVertexBuffer(mt,c.bi.members),this.mercatorBoundsSegments=c.bg.simpleSegment(0,0,4,2);const xt=new c.b0;xt.emplaceBack(0,1,2),xt.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=d.createIndexBuffer(xt);const Tt=new c.be;for(const $t of[0,1,3,2,0])Tt.emplaceBack($t);this.debugIndexBuffer=d.createIndexBuffer(Tt),this.emptyTexture=new c.T(d,new c.q({width:1,height:1},Uint8Array.of(0,0,0,0)),d.gl.RGBA8),this.identityMat=c.bC();const kt=this.context.gl;this.stencilClearMode=new oo({func:kt.ALWAYS,mask:0},0,255,kt.ZERO,kt.ZERO,kt.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(d){return d._makeTileBoundsBuffers(this.context,this.transform.projection),d._tileBoundsBuffer?{tileBoundsBuffer:d._tileBoundsBuffer,tileBoundsIndexBuffer:d._tileBoundsIndexBuffer,tileBoundsSegments:d._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const d=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,d.TRIANGLES,Us.disabled,this.stencilClearMode,co.disabled,wr.disabled,g1(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(d,_e,ot){if(!_e||this.currentStencilSource===_e.id||!d.isTileClipped()||!ot||ot.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let Tt=!1;for(const kt of ot)if(this._tileClippingMaskIDs[kt.key]===void 0){Tt=!0;break}if(!Tt)return}this.currentStencilSource=_e.id;const ut=this.context,mt=ut.gl;this.nextStencilID+ot.length>256&&this.clearStencil(),ut.setColorMode(co.disabled),ut.setDepthMode(Us.disabled);const xt=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const Tt of ot){const kt=_e.getTile(Tt),$t=this._tileClippingMaskIDs[Tt.key]=this.nextStencilID++,{tileBoundsBuffer:Xt,tileBoundsIndexBuffer:rr,tileBoundsSegments:tr}=this.getTileBoundsBuffers(kt);xt.draw(this,mt.TRIANGLES,Us.disabled,new oo({func:mt.ALWAYS,mask:0},$t,255,mt.KEEP,mt.KEEP,mt.REPLACE),co.disabled,wr.disabled,g1(Tt.projMatrix),"$clipping",Xt,rr,tr)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const d=this.nextStencilID++,_e=this.context.gl;return new oo({func:_e.NOTEQUAL,mask:255},d,255,_e.KEEP,_e.KEEP,_e.REPLACE)}stencilModeForClipping(d){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(d);const _e=this.context.gl;return new oo({func:_e.EQUAL,mask:255},this._tileClippingMaskIDs[d.key],0,_e.KEEP,_e.KEEP,_e.REPLACE)}stencilConfigForOverlap(d){const _e=this.context.gl,ot=d.sort((xt,Tt)=>Tt.overscaledZ-xt.overscaledZ),ut=ot[ot.length-1].overscaledZ,mt=ot[0].overscaledZ-ut+1;if(mt>1){this.currentStencilSource=void 0,this.nextStencilID+mt>256&&this.clearStencil();const xt={};for(let Tt=0;Tt<mt;Tt++)xt[Tt+ut]=new oo({func:_e.GEQUAL,mask:255},Tt+this.nextStencilID,255,_e.KEEP,_e.KEEP,_e.REPLACE);return this.nextStencilID+=mt,[xt,ot]}return[{[ut]:oo.disabled},ot]}colorModeForRenderPass(){const d=this.context.gl;return this._showOverdrawInspector?new co([d.CONSTANT_COLOR,d.ONE,d.CONSTANT_COLOR,d.ONE],new c.ao(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?co.unblended:co.alphaBlended}colorModeForDrapableLayerRenderPass(d){const _e=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?d!=null&&this.emissiveMode!=="mrt-fallback"||this.emissiveMode==="constant"?new co([_e.ONE,_e.ONE_MINUS_SRC_ALPHA,_e.CONSTANT_ALPHA,_e.ONE_MINUS_SRC_ALPHA],new c.ao(0,0,0,d??0),[!0,!0,!0,!0]):this.emissiveMode==="dual-source-blending"?new co([_e.ONE,_e.ONE_MINUS_SRC_ALPHA,this.context.extBlendFuncExtended.SRC1_ALPHA_WEBGL,_e.ONE_MINUS_SRC_ALPHA],c.ao.transparent,[!0,!0,!0,!0]):this.colorModeForRenderPass():this.colorModeForRenderPass()}depthModeForSublayer(d,_e,ot,ut=!1){if(this.depthOcclusion)return new Us(this.context.gl.GREATER,Us.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!ut)return Us.disabled;const mt=1-((1+this.currentLayer)*this.numSublayers+d)*this.depthEpsilon;return new Us(ot||this.context.gl.LEQUAL,_e,[mt,mt])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const d=this.context.gl,_e=Math.ceil(this.width),ot=Math.ceil(this.height),ut=this.context.bindFramebuffer.get(),mt=d.getParameter(d.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===_e&&this.depthFBO.height===ot||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),_e!==0&&ot!==0&&(this.depthFBO=new jE(this.context,_e,ot,0,"texture"),this.depthTexture=new c.T(this.context,{width:_e,height:ot,data:null},d.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(ut),d.bindTexture(d.TEXTURE_2D,mt),this.depthFBO&&(d.bindFramebuffer(d.READ_FRAMEBUFFER,null),d.bindFramebuffer(d.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),d.blitFramebuffer(0,0,_e,ot,0,0,_e,ot,d.DEPTH_BUFFER_BIT,d.NEAREST),d.bindFramebuffer(d.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((d,_e)=>d+_e/this._fpsHistory.length,0))}render(d,_e){const ot=c.o.now();this._dt=ot-this._timeStamp,this._timeStamp=ot,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=d.map.repaint,this.style=d,this.options=_e;const ut=this.style._mergedLayers,mt=!(!this.terrain||!this.terrain.enabled),xt=()=>this.style._getOrder(mt).filter(yn=>{const Qr=ut[yn];return!(Qr.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Qr.type]});let Tt=xt(),kt=!1,$t=!1,Xt=null,rr=0,tr=!1;for(const yn of Tt){const Qr=ut[yn];Qr.visibility!=="none"&&(Qr.type==="circle"?kt=!0:Qr.type==="building"?(Xt=Qr,++rr):Qr.type==="symbol"&&(Qr.hasOcclusionOpacityProperties?$t=!0:kt=!0))}this.updateEmissiveMode();let nr=Tt.map(yn=>ut[yn]);const cr=this.style._mergedSourceCaches;this.imageManager=d.imageManager,this.modelManager=d.modelManager,this.symbolFadeChange=d.placement.symbolFadeChange(c.o.now()),this.imageManager.beginFrame();for(const yn in cr){const Qr=cr[yn];Qr.used&&(Qr.prepare(this.context),Qr.getSource().usedInConflation&&++rr)}let lr=!1;for(const yn of nr)yn.isHidden(this.transform.zoom)||(yn.type==="clip"&&(lr=!0),this.prepareLayer(yn));const yr={},xr={},Ar={},Dr={},Tr={};for(const yn in cr){const Qr=cr[yn];yr[yn]=Qr.getVisibleCoordinates(),xr[yn]=yr[yn].slice().reverse(),Ar[yn]=Qr.getVisibleCoordinates(!0).reverse(),Dr[yn]=Qr.getShadowCasterCoordinates(),Tr[yn]=Qr.sortCoordinatesByDistance(yr[yn])}const Wr=yn=>{const Qr=this.style.getLayerSourceCache(yn);return Qr&&Qr.used?Qr.getSource():null};if(rr||lr||this._clippingActiveLastFrame){const yn=[],Qr=[];let Dn=0;for(const bn of nr)this.isSourceForClippingOrConflation(bn,Wr(bn))&&(yn.push(bn),Qr.push(Dn)),Dn++;if(yn&&(lr||yn.length>1)||this._clippingActiveLastFrame){lr=!1;const bn=[];for(let $n=0;$n<yn.length;$n++){const ls=yn[$n],As=Qr[$n],is=this.style.getLayerSourceCache(ls);if(!is||!is.used||!is.getSource().usedInConflation&&ls.type!=="clip"&&ls.type!=="building")continue;let _i=c.eQ,Ls=c.b_.None;const Bs=[];let _s=!0;if(ls.type==="building")_i=c.eS;else if(ls.type==="clip"){_i=As;for(const Rs of ls.layout.get("clip-layer-types"))Ls|=Rs==="model"?c.b_.Model:Rs==="symbol"?c.b_.Symbol:c.b_.FillExtrusion;for(const Rs of ls.layout.get("clip-layer-scope"))Bs.push(Rs);ls.isHidden(this.transform.zoom)?_s=!1:lr=!0}_s&&bn.push({layer:ls.fqid,cache:is,order:_i,clipMask:Ls,clipScope:Bs})}this.replacementSource.setSources(bn),tr=!0}}this._clippingActiveLastFrame=lr,tr||this.replacementSource.clear(),this.conflationActive=tr,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let yn=0;yn<nr.length;yn++){const Qr=nr[yn];if(Qr.visibility==="none")continue;const Dn=Qr.cutoffRange();if(this.longestCutoffRange=Math.max(Dn,this.longestCutoffRange),Dn>0){const bn=Wr(Qr);bn&&(this.minCutoffZoom=Math.max(bn.minzoom,this.minCutoffZoom)),Qr.minzoom&&(this.minCutoffZoom=Math.max(Qr.minzoom,this.minCutoffZoom))}Qr.is3D(mt)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=yn),this._lastOcclusionLayer=yn)}const zr=this.style&&this.style.fog;zr?(this._fogVisible=zr.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=zr.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(Ar),this.opaquePassCutoff=0,Tt=xt(),nr=Tt.map(yn=>ut[yn]));const $r=this._shadowRenderer;if($r){$r.updateShadowParameters(this.transform,this.style.directionalLight);for(const yn in cr)for(const Qr of yr[yn]){let Dn={min:0,max:0};this.terrain&&(Dn=this.terrain.getMinMaxForTile(Qr)||Dn),$r.addShadowReceiver(Qr.toUnwrapped(),Dn.min,Dn.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new c.eR(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new XE(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const Or=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),Br=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(Or&&!this._snow&&(this._snow=new uv(this)),!Or&&this._snow&&(this._snow.destroy(),delete this._snow),Br&&!this._rain&&(this._rain=new Ly(this)),!Br&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),Xt){this.buildingTileBorderManager||(this.buildingTileBorderManager=new Fy);const yn=this.style.getLayerSourceCache(Xt);this.buildingTileBorderManager.updateBorders(yn,Xt)}if(!po.has(this.context.gl))return;this.renderPass="offscreen";for(const yn of nr){const Qr=d.getLayerSourceCache(yn);if(!yn.hasOffscreenPass()||yn.isHidden(this.transform.zoom))continue;const Dn=Qr?xr[Qr.id]:void 0;(yn.type==="custom"||yn.type==="raster"||yn.type==="raster-particle"||yn.isSky()||Dn&&Dn.length)&&this.renderLayer(this,Qr,yn,Dn)}this.depthRangeFor3D=[0,1-(nr.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,Dr)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Xr=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),an=(()=>{if(_e.showOverdrawInspector)return c.ao.black;const yn=this.style.fog;if(yn&&this.transform.projection.supportsFog){const Qr=this.style.getLut(yn.scope);if(!Xr){const Dn=yn.properties.get("color-use-theme")==="none",bn=yn.properties.get("color").toNonPremultipliedRenderColor(Dn?null:Qr).toArray01();return new c.ao(...bn)}if(Xr){const Dn=yn.properties.get("space-color-use-theme")==="none",bn=yn.properties.get("space-color").toNonPremultipliedRenderColor(Dn?null:Qr).toArray01();return new c.ao(...bn)}}return c.ao.transparent})();if(this.context.clear({color:an,depth:1}),this.clearStencil(),this._showOverdrawInspector=_e.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Xr&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=Tt.length-1;this.currentLayer>=0;this.currentLayer--){const yn=nr[this.currentLayer],Qr=d.getLayerSourceCache(yn);if(yn.isSky())continue;const Dn=Qr?(yn.is3D(mt)?Tr:xr)[Qr.id]:void 0;this._renderTileClippingMasks(yn,Qr,Dn),this.renderLayer(this,Qr,yn,Dn)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Xr&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||c.aj(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<Tt.length;this.currentLayer++){const yn=nr[this.currentLayer],Qr=d.getLayerSourceCache(yn);yn.isSky()&&this.renderLayer(this,Qr,yn,Qr?xr[Qr.id]:void 0)}function sn(yn,Qr){let Dn;return Qr&&(Dn=(yn.type==="symbol"?Ar:yn.is3D(mt)?Tr:xr)[Qr.id]),Dn}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<Tt.length;){const yn=nr[this.currentLayer];if(yn.type==="raster"||yn.type==="raster-particle"){const Qr=d.getLayerSourceCache(yn);this.renderLayer(this,Qr,yn,sn(yn,Qr))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let wn=0;$r&&(wn=$r.getShadowCastingLayerCount());let Cn=!1,Nn=-1;for(let yn=0;yn<Tt.length;++yn){const Qr=nr[yn];Qr.isHidden(this.transform.zoom)||Qr.is3D(mt)&&(Nn=yn)}$t&&Nn===-1&&(kt=!0);let Jn=!1;for(;this.currentLayer<Tt.length;){const yn=nr[this.currentLayer],Qr=d.getLayerSourceCache(yn);if(yn.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(yn)){if(yn.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!Jn&&yn.is3D(mt)&&!mt){const Dn=this.currentLayer,bn=$n=>{for(this.currentLayer=0;this.currentLayer<nr.length;this.currentLayer++){const ls=nr[this.currentLayer];if(l0[ls.type]){const As=this.style.getLayerSourceCache(ls);l0[ls.type](this,As,ls,sn(ls,As),$n)}}};bn("initialize"),bn("reset"),this.currentLayer=Dn,Jn=!0}if(kt&&!Cn&&this.terrain&&!this.transform.isOrthographic&&(Cn=!0,this.blitDepth()),$t&&Nn!==-1&&this.currentLayer===Nn+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(yn,Qr,Qr?yr[Qr.id]:void 0),this.renderLayer(this,Qr,yn,sn(yn,Qr)),!this.terrain&&$r&&wn>0&&yn.hasShadowPass()&&--wn==0){{this.clearStencil(),this.resetStencilClippingMasks();const Dn=this.currentLayer;for(this.currentLayer=0;this.currentLayer<nr.length;this.currentLayer++){const bn=nr[this.currentLayer];if(zy[bn.type]){const $n=this.style.getLayerSourceCache(bn);zy[bn.type](this,$n,bn,sn(bn,$n))}}this.currentLayer=Dn}if($r.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const Dn=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=Dn;this.currentLayer++){const bn=nr[this.currentLayer];if(!bn.hasLightBeamPass())continue;const $n=d.getLayerSourceCache(bn);this.renderLayer(this,$n,bn,$n?xr[$n.id]:void 0)}this.currentLayer=Dn,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const Dn=this.currentLayer;this.depthOcclusion=!0;for(const bn of this.layersWithOcclusionOpacity){this.currentLayer=bn;const $n=nr[this.currentLayer],ls=d.getLayerSourceCache($n),As=ls?xr[ls.id]:void 0;this.terrain||this._renderTileClippingMasks($n,ls,ls?yr[ls.id]:void 0),this.renderLayer(this,ls,$n,As)}this.depthOcclusion=!1,this.currentLayer=Dn,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let yn=null;nr.forEach(Qr=>{const Dn=d.getLayerSourceCache(Qr);Dn&&!Qr.isHidden(this.transform.zoom)&&Dn.getVisibleCoordinates().length&&(!yn||yn.getSource().maxzoom<Dn.getSource().maxzoom)&&(yn=Dn)}),yn&&this.options.showTileBoundaries&&ns(this,yn,yn.getVisibleCoordinates(),c.ao.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&ns(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new c.ao(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(yn){const Qr=yn.transform.padding;lx(yn,yn.transform.height-(Qr.top||0),3,GE),lx(yn,Qr.bottom||0,3,$E),Fu(yn,Qr.left||0,3,HE),Fu(yn,yn.transform.width-(Qr.right||0),3,ox);const Dn=yn.transform.centerPoint;(function(bn,$n,ls,As){mn(bn,$n-1,ls-10,2,20,As),mn(bn,$n-10,ls-1,20,2,As)})(yn,Dn.x,yn.transform.height-Dn.y,ax)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),tr||(this.conflationActive=!1)}prepareLayer(d){this.gpuTimingStart(d);const{unsupportedLayers:_e}=this.transform.projection,ot=!_e||!_e.includes(d.type);if(jy[d.type]&&(ot||this.terrain&&d.type==="custom")){const ut=this.style.getLayerSourceCache(d);jy[d.type](d,ut,this)}this.gpuTimingEnd()}renderLayer(d,_e,ot,ut){ot.isHidden(this.transform.zoom)||(ot.type==="background"||ot.type==="sky"||ot.type==="custom"||ot.type==="model"||ot.type==="raster"||ot.type==="raster-particle"||ut&&ut.length)&&(this.id=ot.id,this.gpuTimingStart(ot),d.transform.projection.unsupportedLayers&&d.transform.projection.unsupportedLayers.includes(ot.type)&&(!d.terrain||ot.type!=="custom")||ot.type==="clip"||zm[ot.type](d,_e,ot,ut,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(d){if(!this.options.gpuTiming)return;const _e=this.context.extTimerQuery,ot=this.context.gl;let ut=this.gpuTimers[d.id];ut||(ut=this.gpuTimers[d.id]={calls:0,cpuTime:0,query:ot.createQuery()}),ut.calls++,ot.beginQuery(_e.TIME_ELAPSED_EXT,ut.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const d=this.context.extTimerQuery,_e=this.context.gl,ot=_e.createQuery();this.deferredRenderGpuTimeQueries.push(ot),_e.beginQuery(d.TIME_ELAPSED_EXT,ot)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const d=this.gpuTimers;return this.gpuTimers={},d}collectDeferredRenderGpuQueries(){const d=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],d}queryGpuTimers(d){const _e={};for(const ot in d){const ut=d[ot],mt=this.context.extTimerQuery,xt=mt.getQueryParameter(ut.query,this.context.gl.QUERY_RESULT)/1e6;mt.deleteQueryEXT(ut.query),_e[ot]=xt}return _e}queryGpuTimeDeferredRender(d){if(!this.options.gpuTimingDeferredRender)return 0;const _e=this.context.gl;let ot=0;for(const ut of d)ot+=_e.getQueryParameter(ut,_e.QUERY_RESULT)/1e6,_e.deleteQuery(ut);return ot}translatePosMatrix(d,_e,ot,ut,mt){if(!ot[0]&&!ot[1])return d;const xt=mt?ut==="map"?this.transform.angle:0:ut==="viewport"?-this.transform.angle:0;if(xt){const $t=Math.sin(xt),Xt=Math.cos(xt);ot=[ot[0]*Xt-ot[1]*$t,ot[0]*$t+ot[1]*Xt]}const Tt=[mt?ot[0]:c.ay(_e,ot[0],this.transform.zoom),mt?ot[1]:c.ay(_e,ot[1],this.transform.zoom),0],kt=new Float32Array(16);return c.br(kt,d,Tt),kt}saveTileTexture(d){if(d.context!==this.context)return;const _e=d.size[0],ot=this._tileTextures[_e];ot?ot.push(d):this._tileTextures[_e]=[d]}getTileTexture(d){const _e=this._tileTextures[d];return _e&&_e.length>0?_e.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(d,_e,ot){const ut=ot===void 0?this.terrain&&this.terrain.renderingToTexture:ot,mt=[];return this.style&&this.style.enable3dLights()&&(d==="globeRaster"||d==="terrainRaster"?(mt.push("LIGHTING_3D_MODE"),mt.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):ut||mt.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||mt.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(mt.push("TERRAIN"),this.linearFloatFilteringSupported()&&mt.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&mt.push("GLOBE"),!this._fogVisible||ut||_e!==void 0&&!_e||mt.push("FOG","FOG_DITHERING"),ut&&mt.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&mt.push("OVERDRAW_INSPECTOR"),mt}getOrCreateProgram(d,_e){this.cache=this.cache||{};const ot=_e&&_e.defines||[],ut=_e&&_e.config,mt=this.currentGlobalDefines(d,_e&&_e.overrideFog,_e&&_e.overrideRtt).concat(ot),xt=TE.cacheKey(M_[d],d,mt,ut);return this.cache[xt]||(this.cache[xt]=new TE(this.context,d,M_[d],ut,Cy[d],mt)),this.cache[xt]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const d=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(d.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new c.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(d,_e){if(this.style.enable3dLights()){const ot=this.style.directionalLight,ut=this.style.ambientLight;if(ot&&ut){const mt=((xt,Tt,kt)=>{const $t=xt.properties.get("direction"),Xt=xt.properties.get("color-use-theme")==="none",rr=xt.properties.get("color").toNonPremultipliedRenderColor(Xt?null:kt.getLut(xt.scope)).toArray01(),tr=xt.properties.get("intensity"),nr=Tt.properties.get("color-use-theme")==="none",cr=Tt.properties.get("color").toNonPremultipliedRenderColor(nr?null:kt.getLut(Tt.scope)).toArray01(),lr=Tt.properties.get("intensity"),yr=[$t.x,$t.y,$t.z],xr=c.dN(cr,lr),Ar=c.dN(rr,tr);return{u_lighting_ambient_color:xr,u_lighting_directional_dir:yr,u_lighting_directional_color:Ar,u_ground_radiance:Lx(yr,Ar,xr)}})(ot,ut,this.style);_e.setLightsUniformValues(d,mt)}}}uploadCommonUniforms(d,_e,ot,ut,mt){if(this.uploadCommonLightUniforms(d,_e),this.terrain&&this.terrain.renderingToTexture)return;const xt=this.style.fog;if(xt){const Tt=xt.getOpacity(this.transform.pitch),kt=(($t,Xt,rr,tr,nr,cr,lr,yr,xr,Ar,Dr,Tr)=>{const Wr=$t.transform,zr=Xt.properties.get("color-use-theme")==="none",$r=Xt.properties.get("color").toNonPremultipliedRenderColor(zr?null:$t.style.getLut(Xt.scope)).toArray01();$r[3]=tr;const Or=$t.frameCounter/1e3%1,[Br,Xr]=Xt.properties.get("vertical-range");return{u_fog_matrix:rr?Wr.calculateFogTileMatrix(rr):Tr||$t.identityMat,u_fog_range:Xt.getFovAdjustedRange(Wr._fov),u_fog_color:$r,u_fog_horizon_blend:Xt.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(Br,Xr),Xr],u_fog_temporal_offset:Or,u_frustum_tl:nr,u_frustum_tr:cr,u_frustum_br:lr,u_frustum_bl:yr,u_globe_pos:xr,u_globe_radius:Ar,u_viewport:Dr,u_globe_transition:c.aj(Wr.zoom),u_is_globe:+(Wr.projection.name==="globe")}})(this,xt,ot,Tt,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*c.o.devicePixelRatio,this.transform.height*c.o.devicePixelRatio],ut);_e.setFogUniformValues(d,kt)}mt&&_e.setCutoffUniformValues(d,mt.uniformValues)}setTileLoadedFlag(d){this.tileLoaded=d}saveCanvasCopy(){const d=this.canvasCopy();d&&(this.frameCopies.push(d),this.tileLoaded=!1)}canvasCopy(){const d=this.context.gl,_e=d.createTexture();return d.bindTexture(d.TEXTURE_2D,_e),d.copyTexImage2D(d.TEXTURE_2D,0,d.RGBA,0,0,d.drawingBufferWidth,d.drawingBufferHeight,0),_e}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const d=this.style&&this.style.fog;return!!d&&d.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const d=this._backgroundTiles,_e=this._backgroundTiles={},ot=this.transform.coveringTiles({tileSize:512});for(const ut of ot)_e[ut.key]=d[ut.key]||new Fp(ut,512,this.transform.tileZoom,this,void 0,this.worldview);return _e}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(d,_e){return!(!d.is3D(!(!this.terrain||!this.terrain.enabled))||d.type!=="clip"&&d.type!=="building"&&(d.minzoom&&d.minzoom>this.transform.zoom||(this.style._clipLayerPresent||d.sourceLayer!=="building"&&d.sourceLayer!=="procedural_buildings")&&(!_e||_e.type!=="batched-model")))}isTileAffectedByFog(d){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let _e=this._cachedTileFogOpacities[d.key];return _e||(this._cachedTileFogOpacities[d.key]=_e=this.style.fog.getOpacityForTile(d)),_e[0]>=Rn||_e[1]>=Rn}setupDepthForOcclusion(d,_e,ot){const ut=this.context,mt=ut.gl,xt=!!ot;var Tt;ot||(ot={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),ut.activeTexture.set(mt.TEXTURE3),d&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(mt.NEAREST,mt.CLAMP_TO_EDGE),ot.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],ot.u_depth_range_unpack=[2/((Tt=this.depthRangeFor3D)[1]-Tt[0]),-1-2*Tt[0]/(Tt[1]-Tt[0])],ot.u_occluder_half_size=.5*this.occlusionParams.occluderSize,ot.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(mt.NEAREST,mt.CLAMP_TO_EDGE),ut.activeTexture.set(mt.TEXTURE0),xt||_e.setTerrainUniformValues(ut,ot)}updateEmissiveMode(){if(this._forceEmissiveMode)return;const d=this.style.hasDataDrivenEmissiveStrength();this.emissiveMode=d?this.context.extBlendFuncExtended?"dual-source-blending":"mrt-fallback":"constant"}}function Uy(st,d){let _e=!1,ot=null;const ut=()=>{ot=null,_e&&(st(),ot=setTimeout(ut,d),_e=!1)};return()=>(_e=!0,ot||ut(),ot)}class dv{constructor(d){this._hashName=d&&encodeURIComponent(d),c.aY(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Uy(this._updateHashUnthrottled.bind(this),300)}addTo(d){return this._map=d,window.addEventListener("hashchange",this._onHashChange,!1),d.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const d=this._map;if(!d)return"";const _e=_f(d);if(this._hashName){const ot=this._hashName;let ut=!1;const mt=location.hash.slice(1).split("&").map(xt=>{const Tt=xt.split("=")[0];return Tt===ot?(ut=!0,`${Tt}=${_e}`):xt}).filter(xt=>xt);return ut||mt.push(`${ot}=${_e}`),`#${mt.join("&")}`}return`#${_e}`}_getCurrentHash(){const d=location.hash.replace("#","");if(this._hashName){let _e;return d.split("&").map(ot=>ot.split("=")).forEach(ot=>{ot[0]===this._hashName&&(_e=ot)}),(_e&&_e[1]||"").split("/")}return d.split("/")}_onHashChange(){const d=this._map;if(!d)return!1;const _e=this._getCurrentHash();if(_e.length>=3&&!_e.some(ot=>isNaN(Number(ot)))){const ot=d.dragRotate.isEnabled()&&d.touchZoomRotate.isEnabled()?+(_e[3]||0):d.getBearing();return d.jumpTo({center:[+_e[2],+_e[1]],zoom:+_e[0],bearing:ot,pitch:+(_e[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function _f(st,d){const _e=st.getCenter(),ot=Math.round(100*st.getZoom())/100,ut=Math.ceil((ot*Math.LN2+Math.log(512/360/.5))/Math.LN10),mt=Math.pow(10,ut),xt=Math.round(_e.lng*mt)/mt,Tt=Math.round(_e.lat*mt)/mt,kt=st.getBearing(),$t=st.getPitch();let Xt=d?`/${xt}/${Tt}/${ot}`:`${ot}/${Tt}/${xt}`;return(kt||$t)&&(Xt+="/"+Math.round(10*kt)/10),$t&&(Xt+=`/${Math.round($t)}`),Xt}const Hx={linearity:.3,easing:c.eT(0,0,.3,1)},hv=Object.assign({deceleration:2500,maxSpeed:1400},Hx),fv=Object.assign({deceleration:20,maxSpeed:1400},Hx),fx=Object.assign({deceleration:1e3,maxSpeed:360},Hx),pv=Object.assign({deceleration:1e3,maxSpeed:90},Hx);class mv{constructor(d){this._map=d,this.clear()}clear(){this._inertiaBuffer=[]}record(d){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:c.o.now(),settings:d})}_drainInertiaBuffer(){const d=this._inertiaBuffer,_e=c.o.now();for(;d.length>0&&_e-d[0].time>160;)d.shift()}_onMoveEnd(d){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const _e={zoom:0,bearing:0,pitch:0,pan:new c.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:mt}of this._inertiaBuffer)_e.zoom+=mt.zoomDelta||0,_e.bearing+=mt.bearingDelta||0,_e.pitch+=mt.pitchDelta||0,mt.panDelta&&_e.pan._add(mt.panDelta),mt.around&&(_e.around=mt.around),mt.pinchAround&&(_e.pinchAround=mt.pinchAround);const ot=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,ut={};if(_e.pan.mag()){const mt=q0(_e.pan.mag(),ot,Object.assign({},hv,d||{}));ut.offset=_e.pan.mult(mt.amount/_e.pan.mag()),ut.center=this._map.transform.center,Wx(ut,mt)}if(_e.zoom){const mt=q0(_e.zoom,ot,fv);ut.zoom=this._map.transform.zoom+mt.amount,Wx(ut,mt)}if(_e.bearing){const mt=q0(_e.bearing,ot,fx);ut.bearing=this._map.transform.bearing+c.aA(mt.amount,-179,179),Wx(ut,mt)}if(_e.pitch){const mt=q0(_e.pitch,ot,pv);ut.pitch=this._map.transform.pitch+mt.amount,Wx(ut,mt)}if(ut.zoom||ut.bearing){const mt=_e.pinchAround===void 0?_e.around:_e.pinchAround;ut.around=mt?this._map.unproject(mt):this._map.getCenter()}return this.clear(),ut.noMoveStart=!0,ut}}function Wx(st,d){(!st.duration||st.duration<d.duration)&&(st.duration=d.duration,st.easing=d.easing)}function q0(st,d,_e){const{maxSpeed:ot,linearity:ut,deceleration:mt}=_e,xt=c.aA(st*ut/(d/1e3),-ot,ot),Tt=Math.abs(xt)/(mt*ut);return{easing:_e.easing,duration:1e3*Tt,amount:xt*(Tt/2)}}class Hp extends c.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(d,_e,ot,ut={}){const mt=mr(_e.getCanvasContainer(),ot),xt=_e.unproject(mt);super(d,Object.assign({point:mt,lngLat:xt,originalEvent:ot},ut)),this._defaultPrevented=!1,this.target=_e}}class Vm extends c.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(d,_e,ot){const ut=d==="touchend"?ot.changedTouches:ot.touches,mt=Rr(_e.getCanvasContainer(),ut),xt=mt.map(kt=>_e.unproject(kt)),Tt=mt.reduce((kt,$t,Xt,rr)=>kt.add($t.div(rr.length)),new c.P(0,0));super(d,{points:mt,point:Tt,lngLats:xt,lngLat:_e.unproject(Tt),originalEvent:ot}),this._defaultPrevented=!1}}class xv extends c.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(d,_e){super("wheel",{originalEvent:_e}),this._defaultPrevented=!1}}class Gy{constructor(d,_e){this._map=d,this._clickTolerance=_e.clickTolerance}reset(){this._mousedownPos=void 0}wheel(d){return this._firePreventable(new xv(this._map,d))}mousedown(d,_e){return this._mousedownPos=_e,this._firePreventable(new Hp(d.type,this._map,d))}mouseup(d){this._map.fire(new Hp(d.type,this._map,d))}preclick(d){const _e=new MouseEvent("preclick",d);this._map.fire(new Hp(_e.type,this._map,_e))}click(d,_e){this._mousedownPos&&this._mousedownPos.dist(_e)>=this._clickTolerance||(this.preclick(d),this._map.fire(new Hp(d.type,this._map,d)))}dblclick(d){return this._firePreventable(new Hp(d.type,this._map,d))}mouseover(d){this._map.fire(new Hp(d.type,this._map,d))}mouseout(d){this._map.fire(new Hp(d.type,this._map,d))}touchstart(d){return this._firePreventable(new Vm(d.type,this._map,d))}touchmove(d){this._map.fire(new Vm(d.type,this._map,d))}touchend(d){this._map.fire(new Vm(d.type,this._map,d))}touchcancel(d){this._map.fire(new Vm(d.type,this._map,d))}_firePreventable(d){if(this._map.fire(d),d.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class gv{constructor(d){this._map=d}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(d){this._map.fire(new Hp(d.type,this._map,d))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Hp("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(d){this._delayContextMenu?this._contextMenuEvent=d:this._map.fire(new Hp(d.type,this._map,d)),this._map.listens("contextmenu")&&d.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class $y{constructor(d,_e){this._map=d,this._el=d.getCanvasContainer(),this._container=d.getContainer(),this._clickTolerance=_e.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(d,_e){this.isEnabled()&&d.shiftKey&&d.button===0&&(Gt(),this._startPos=this._lastPos=_e,this._active=!0)}mousemoveWindow(d,_e){if(!this._active)return;const ot=_e,ut=this._startPos,mt=this._lastPos;if(!ut||!mt||mt.equals(ot)||!this._box&&ot.dist(ut)<this._clickTolerance)return;this._lastPos=ot,this._box||(this._box=Bt("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",d));const xt=Math.min(ut.x,ot.x),Tt=Math.max(ut.x,ot.x),kt=Math.min(ut.y,ot.y),$t=Math.max(ut.y,ot.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${xt}px,${kt}px)`,this._box.style.width=Tt-xt+"px",this._box.style.height=$t-kt+"px")})}mouseupWindow(d,_e){if(!this._active)return;const ot=this._startPos,ut=_e;if(ot&&d.button===0){if(this.reset(),or(),ot.x!==ut.x||ot.y!==ut.y)return this._map.fire(new c.z("boxzoomend",{originalEvent:d})),{cameraAnimation:mt=>mt.fitScreenCoordinates(ot,ut,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",d)}}keydown(d){this._active&&d.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",d))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),er(),delete this._startPos,delete this._lastPos}_fireEvent(d,_e){return this._map.fire(new c.z(d,{originalEvent:_e}))}}function Hy(st,d){const _e={};for(let ot=0;ot<st.length;ot++)_e[st[ot].identifier]=d[ot];return _e}class ew{constructor(d){this.reset(),this.numTouches=d.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(d,_e,ot){(this.centroid||ot.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=d.timeStamp),ot.length===this.numTouches&&(this.centroid=function(ut){const mt=new c.P(0,0);for(const xt of ut)mt._add(xt);return mt.div(ut.length)}(_e),this.touches=Hy(ot,_e)))}touchmove(d,_e,ot){if(this.aborted||!this.centroid)return;const ut=Hy(ot,_e);for(const mt in this.touches){const xt=ut[mt];(!xt||xt.dist(this.touches[mt])>30)&&(this.aborted=!0)}}touchend(d,_e,ot){if((!this.centroid||d.timeStamp-this.startTime>500)&&(this.aborted=!0),ot.length===0){const ut=!this.aborted&&this.centroid;if(this.reset(),ut)return ut}}}class Wy{constructor(d){this.singleTap=new ew(d),this.numTaps=d.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(d,_e,ot){this.singleTap.touchstart(d,_e,ot)}touchmove(d,_e,ot){this.singleTap.touchmove(d,_e,ot)}touchend(d,_e,ot){const ut=this.singleTap.touchend(d,_e,ot);if(ut){const mt=d.timeStamp-this.lastTime<500,xt=!this.lastTap||this.lastTap.dist(ut)<30;if(mt&&xt||this.reset(),this.count++,this.lastTime=d.timeStamp,this.lastTap=ut,this.count===this.numTaps)return this.reset(),ut}}}class tw{constructor(){this._zoomIn=new Wy({numTouches:1,numTaps:2}),this._zoomOut=new Wy({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(d,_e,ot){this._zoomIn.touchstart(d,_e,ot),this._zoomOut.touchstart(d,_e,ot)}touchmove(d,_e,ot){this._zoomIn.touchmove(d,_e,ot),this._zoomOut.touchmove(d,_e,ot)}touchend(d,_e,ot){const ut=this._zoomIn.touchend(d,_e,ot),mt=this._zoomOut.touchend(d,_e,ot);return ut?(this._active=!0,d.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:xt=>xt.easeTo({duration:300,zoom:xt.getZoom()+1,around:xt.unproject(ut)},{originalEvent:d})}):mt?(this._active=!0,d.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:xt=>xt.easeTo({duration:300,zoom:xt.getZoom()-1,around:xt.unproject(mt)},{originalEvent:d})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const rw={0:1,2:2},yv={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class qy{constructor(d){this.reset(),this._clickTolerance=d.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(d,_e){return!1}_move(d,_e){return{}}mousedown(d,_e){if(this._lastPoint)return;const ot=on(d);this._correctButton(d,ot)&&(this._lastPoint=_e,this._eventButton=ot)}mousemoveWindow(d,_e){const ot=this._lastPoint;if(ot){if(d.preventDefault(),this._eventButton!=null&&function(ut,mt){const xt=rw[mt];return ut.buttons===void 0||(ut.buttons&xt)!==xt}(d,this._eventButton))this.reset();else if(this._moved||!(_e.dist(ot)<this._clickTolerance))return this._moved=!0,this._lastPoint=_e,this._move(ot,_e)}}mouseupWindow(d){this._lastPoint&&on(d)===this._eventButton&&(this._moved&&or(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class nw extends qy{mousedown(d,_e){super.mousedown(d,_e),this._lastPoint&&(this._active=!0)}_correctButton(d,_e){return _e===0&&!d.ctrlKey}_move(d,_e){return{around:_e,panDelta:_e.sub(d)}}}class _v extends qy{constructor(d){super(d),this._pitchRotateKey=d.pitchRotateKey?yv[d.pitchRotateKey]:void 0}_correctButton(d,_e){return this._pitchRotateKey?_e===0&&d[this._pitchRotateKey]:_e===0&&d.ctrlKey||_e===2}_move(d,_e){const ot=.8*(_e.x-d.x);if(ot)return this._active=!0,{bearingDelta:ot}}contextmenu(d){this._pitchRotateKey||d.preventDefault()}}class vv extends qy{constructor(d){super(d),this._pitchRotateKey=d.pitchRotateKey?yv[d.pitchRotateKey]:void 0}_correctButton(d,_e){return this._pitchRotateKey?_e===0&&d[this._pitchRotateKey]:_e===0&&d.ctrlKey||_e===2}_move(d,_e){const ot=-.5*(_e.y-d.y);if(ot)return this._active=!0,{pitchDelta:ot}}contextmenu(d){this._pitchRotateKey||d.preventDefault()}}class iw{constructor(d,_e){this._map=d,this._el=d.getCanvasContainer(),this._minTouches=1,this._clickTolerance=_e.clickTolerance||1,this.reset(),c.aY(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new c.P(0,0)}touchstart(d,_e,ot){return this._calculateTransform(d,_e,ot)}touchmove(d,_e,ot){if(this._active&&!(ot.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(ot.length===1&&!c.eU())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return d.cancelable&&d.preventDefault(),this._calculateTransform(d,_e,ot)}}touchend(d,_e,ot){this._calculateTransform(d,_e,ot),this._active&&ot.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(d,_e,ot){ot.length>0&&(this._active=!0);const ut=Hy(ot,_e),mt=new c.P(0,0),xt=new c.P(0,0);let Tt=0;for(const $t in ut){const Xt=ut[$t],rr=this._touches[$t];rr&&(mt._add(Xt),xt._add(Xt.sub(rr)),Tt++,ut[$t]=Xt)}if(this._touches=ut,Tt<this._minTouches||!xt.mag())return;const kt=xt.div(Tt);return this._sum._add(kt),this._sum.mag()<this._clickTolerance?void 0:{around:mt.div(Tt),panDelta:kt}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Bt("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Xy{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(d){}_move(d,_e,ot){return{}}touchstart(d,_e,ot){this._firstTwoTouches||ot.length<2||(this._firstTwoTouches=[ot[0].identifier,ot[1].identifier],this._start([_e[0],_e[1]]))}touchmove(d,_e,ot){const ut=this._firstTwoTouches;if(!ut)return;d.preventDefault();const[mt,xt]=ut,Tt=T1(ot,_e,mt),kt=T1(ot,_e,xt);if(!Tt||!kt)return;const $t=this._aroundCenter?null:Tt.add(kt).div(2);return this._move([Tt,kt],$t,d)}touchend(d,_e,ot){if(!this._firstTwoTouches)return;const[ut,mt]=this._firstTwoTouches,xt=T1(ot,_e,ut),Tt=T1(ot,_e,mt);xt&&Tt||(this._active&&or(),this.reset())}touchcancel(){this.reset()}enable(d){this._enabled=!0,this._aroundCenter=!!d&&d.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function T1(st,d,_e){for(let ot=0;ot<st.length;ot++)if(st[ot].identifier===_e)return d[ot]}function sw(st,d){return Math.log2(st/d)}class v2 extends Xy{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(d){this._startDistance=this._distance=d[0].dist(d[1])}_move(d,_e){const ot=this._distance;if(this._distance=d[0].dist(d[1]),this._active||!(Math.abs(sw(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:sw(this._distance,ot),pinchAround:_e}}}function ow(st,d){return 180*st.angleWith(d)/Math.PI}class Eu extends Xy{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(d){this._startVector=this._vector=d[0].sub(d[1]),this._minDiameter=d[0].dist(d[1])}_move(d,_e){const ot=this._vector;if(this._vector=d[0].sub(d[1]),ot&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:ow(this._vector,ot),pinchAround:_e}}_isBelowThreshold(d){this._minDiameter=Math.min(this._minDiameter,d.mag());const _e=25/(Math.PI*this._minDiameter)*360,ot=this._startVector;if(!ot)return!1;const ut=ow(d,ot);return Math.abs(ut)<_e}}function Ky(st){return Math.abs(st.y)>Math.abs(st.x)}class E2 extends Xy{constructor(d){super(),this._map=d}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(d){this._lastPoints=d,Ky(d[0].sub(d[1]))&&(this._valid=!1)}_move(d,_e,ot){const ut=this._lastPoints;if(!ut)return;const mt=d[0].sub(ut[0]),xt=d[1].sub(ut[1]);return this._map._cooperativeGestures&&!c.eU()&&ot.touches.length<3||(this._valid=this.gestureBeginsVertically(mt,xt,ot.timeStamp),!this._valid)?void 0:(this._lastPoints=d,this._active=!0,{pitchDelta:(mt.y+xt.y)/2*-.5})}gestureBeginsVertically(d,_e,ot){if(this._valid!==void 0)return this._valid;const ut=d.mag()>=2,mt=_e.mag()>=2;if(!ut&&!mt)return;if(!ut||!mt)return this._firstMove==null&&(this._firstMove=ot),ot-this._firstMove<100&&void 0;const xt=d.y>0==_e.y>0;return Ky(d)&&Ky(_e)&&xt}}const b2={panStep:100,bearingStep:15,pitchStep:10};class w2{constructor(){const d=b2;this._panStep=d.panStep,this._bearingStep=d.bearingStep,this._pitchStep=d.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(d){if(d.altKey||d.ctrlKey||d.metaKey)return;let _e=0,ot=0,ut=0,mt=0,xt=0;switch(d.keyCode){case 61:case 107:case 171:case 187:_e=1;break;case 189:case 109:case 173:_e=-1;break;case 37:d.shiftKey?ot=-1:(d.preventDefault(),mt=-1);break;case 39:d.shiftKey?ot=1:(d.preventDefault(),mt=1);break;case 38:d.shiftKey?ut=1:(d.preventDefault(),xt=-1);break;case 40:d.shiftKey?ut=-1:(d.preventDefault(),xt=1);break;default:return}return this._rotationDisabled&&(ot=0,ut=0),{cameraAnimation:Tt=>{const kt=Tt.getZoom();Tt.easeTo({duration:300,easeId:"keyboardHandler",easing:R1,zoom:_e?Math.round(kt)+_e*(d.shiftKey?2:1):kt,bearing:Tt.getBearing()+ot*this._bearingStep,pitch:Tt.getPitch()+ut*this._pitchStep,offset:[-mt*this._panStep,-xt*this._panStep],center:Tt.getCenter()},{originalEvent:d})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function R1(st){return st*(2-st)}const Ev=4.000244140625,bv=1/450;class Zy{constructor(d,_e){this._map=d,this._el=d.getCanvasContainer(),this._handler=_e,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=bv,c.aY(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(d){this._defaultZoomRate=d}setWheelZoomRate(d){this._wheelZoomRate=d}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(d){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!d&&d.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(d){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(d.ctrlKey||d.metaKey||this.isZooming()||c.eU()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let _e=d.deltaMode===WheelEvent.DOM_DELTA_LINE?40*d.deltaY:d.deltaY;const ot=c.o.now(),ut=ot-(this._lastWheelEventTime||0);this._lastWheelEventTime=ot,_e!==0&&_e%Ev==0?this._type="wheel":_e!==0&&Math.abs(_e)<4?this._type="trackpad":ut>400?(this._type=null,this._lastValue=_e,this._timeout=window.setTimeout(this._onTimeout,40,d)):this._type||(this._type=Math.abs(ut*_e)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,_e+=this._lastValue)),d.shiftKey&&_e&&(_e/=4),this._type&&(this._lastWheelEvent=d,this._delta-=_e,this._active||this._start(d)),d.preventDefault()}_onTimeout(d){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(d)}_start(d){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const _e=mr(this._el,d);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:_e,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const d=this._map.transform;this._type==="wheel"&&d.projection.wrap&&(d._center.lng>=180||d._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const _e=()=>d._terrainEnabled()&&this._aroundCoord?d.computeZoomRelativeTo(this._aroundCoord):d.zoom;if(this._delta!==0){const $t=this._type==="wheel"&&Math.abs(this._delta)>Ev?this._wheelZoomRate:this._defaultZoomRate;let Xt=2/(1+Math.exp(-Math.abs(this._delta*$t)));this._delta<0&&Xt!==0&&(Xt=1/Xt);const rr=_e(),tr=Math.pow(2,rr),nr=typeof this._targetZoom=="number"?d.zoomScale(this._targetZoom):tr;this._targetZoom=Math.min(d.maxZoom,Math.max(d.minZoom,d.scaleZoom(nr*Xt))),this._type==="wheel"&&(this._startZoom=rr,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const ot=typeof this._targetZoom=="number"?this._targetZoom:_e(),ut=this._startZoom,mt=this._easing;let xt,Tt=!1;if(this._type==="wheel"&&ut&&mt){const $t=Math.min((c.o.now()-this._lastWheelEventTime)/200,1),Xt=mt($t);xt=c.ak(ut,ot,Xt),$t<1?this._frameId||(this._frameId=!0):Tt=!0}else xt=ot,Tt=!0;this._active=!0,Tt&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let kt=xt-_e();return kt*this._lastDelta<0&&(kt=0),{noInertia:!0,needsRenderFrame:!Tt,zoomDelta:kt,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(d){let _e=c.eV;if(this._prevEase){const ot=this._prevEase,ut=(c.o.now()-ot.start)/ot.duration,mt=ot.easing(ut+.01)-ot.easing(ut),xt=.27/Math.sqrt(mt*mt+1e-4)*.01,Tt=Math.sqrt(.0729-xt*xt);_e=c.eT(xt,Tt,.25,1)}return this._prevEase={start:c.o.now(),duration:d,easing:_e},_e}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Bt("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class cm{constructor(d,_e){this._clickZoom=d,this._tapZoom=_e}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Yy{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(d,_e){return d.preventDefault(),{cameraAnimation:ot=>{ot.easeTo({duration:300,zoom:ot.getZoom()+(d.shiftKey?-1:1),around:ot.unproject(_e)},{originalEvent:d})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ep{constructor(){this._tap=new Wy({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(d,_e,ot){this._swipePoint||(this._tapTime&&d.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?ot.length>0&&(this._swipePoint=_e[0],this._swipeTouch=ot[0].identifier):this._tap.touchstart(d,_e,ot))}touchmove(d,_e,ot){if(this._tapTime){if(this._swipePoint){if(ot[0].identifier!==this._swipeTouch)return;const ut=_e[0],mt=ut.y-this._swipePoint.y;return this._swipePoint=ut,d.preventDefault(),this._active=!0,{zoomDelta:mt/128}}}else this._tap.touchmove(d,_e,ot)}touchend(d,_e,ot){this._tapTime?this._swipePoint&&ot.length===0&&this.reset():this._tap.touchend(d,_e,ot)&&(this._tapTime=d.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class X0{constructor(d,_e,ot){this._el=d,this._mousePan=_e,this._touchPan=ot}enable(d){this._inertiaOptions=d||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class I1{constructor(d,_e,ot){this._pitchWithRotate=d.pitchWithRotate,this._mouseRotate=_e,this._mousePitch=ot}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Qy{constructor(d,_e,ot,ut){this._el=d,this._touchZoom=_e,this._touchRotate=ot,this._tapDragZoom=ut,this._rotationDisabled=!1,this._enabled=!0}enable(d){this._touchZoom.enable(d),this._rotationDisabled||this._touchRotate.enable(d),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const D1=st=>st.zoom||st.drag||st.pitch||st.rotate;class C2 extends c.z{}class P1{constructor(){this.constants=[1,1,.01],this.radius=0}setup(d,_e){const ot=c.av([],_e,d);this.radius=c.ag(ot[2]<0?c.eX([],ot,this.constants):[ot[0],ot[1],0])}projectRay(d){c.eX(d,d,this.constants),c.aw(d,d),c.eY(d,d,this.constants);const _e=c.c5([],d,this.radius);if(_e[2]>0){const ot=c.c5([],[0,0,1],c.bJ(_e,[0,0,1])),ut=c.c5([],c.aw([],[_e[0],_e[1],0]),this.radius),mt=c.d8([],_e,c.c5([],c.av([],c.d8([],ut,ot),_e),2));_e[0]=mt[0],_e[1]=mt[1]}return _e}}function Jy(st){return st.panDelta&&st.panDelta.mag()||st.zoomDelta||st.bearingDelta||st.pitchDelta}class A2{constructor(d,_e){this._map=d,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new mv(d),this._bearingSnap=_e.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new P1,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(_e),c.aY(["handleEvent","handleWindowEvent"],this);const ot=this._el;this._listeners=[[ot,"touchstart",{passive:!0}],[ot,"touchmove",{passive:!1}],[ot,"touchend",void 0],[ot,"touchcancel",void 0],[ot,"mousedown",void 0],[ot,"mousemove",void 0],[ot,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[ot,"mouseover",void 0],[ot,"mouseout",void 0],[ot,"dblclick",void 0],[ot,"click",void 0],[ot,"keydown",{capture:!1}],[ot,"keyup",void 0],[ot,"wheel",{passive:!1}],[ot,"contextmenu",void 0],[window,"blur",void 0]];for(const[ut,mt,xt]of this._listeners){const Tt=ut===document?this.handleWindowEvent:this.handleEvent;ut.addEventListener(mt,Tt,xt)}}destroy(){for(const[d,_e,ot]of this._listeners){const ut=d===document?this.handleWindowEvent:this.handleEvent;d.removeEventListener(_e,ut,ot)}}_addDefaultHandlers(d){const _e=this._map,ot=_e.getCanvasContainer();this._add("mapEvent",new Gy(_e,d));const ut=_e.boxZoom=new $y(_e,d);this._add("boxZoom",ut);const mt=new tw,xt=new Yy;_e.doubleClickZoom=new cm(xt,mt),this._add("tapZoom",mt),this._add("clickZoom",xt);const Tt=new ep;this._add("tapDragZoom",Tt);const kt=_e.touchPitch=new E2(_e);this._add("touchPitch",kt);const $t=new _v(d),Xt=new vv(d);_e.dragRotate=new I1(d,$t,Xt),this._add("mouseRotate",$t,["mousePitch"]),this._add("mousePitch",Xt,["mouseRotate"]);const rr=new nw(d),tr=new iw(_e,d);_e.dragPan=new X0(ot,rr,tr),this._add("mousePan",rr),this._add("touchPan",tr,["touchZoom","touchRotate"]);const nr=new Eu,cr=new v2;_e.touchZoomRotate=new Qy(ot,cr,nr,Tt),this._add("touchRotate",nr,["touchPan","touchZoom"]),this._add("touchZoom",cr,["touchPan","touchRotate"]),this._add("blockableMapEvent",new gv(_e));const lr=_e.scrollZoom=new Zy(_e,this);this._add("scrollZoom",lr,["mousePan"]);const yr=_e.keyboard=new w2;this._add("keyboard",yr);for(const xr of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])d.interactive&&d[xr]&&_e[xr].enable(d[xr])}_add(d,_e,ot){this._handlers.push({handlerName:d,handler:_e,allowed:ot}),this._handlersById[d]=_e}stop(d){if(!this._updatingCamera){for(const{handler:_e}of this._handlers)_e.reset();this._inertia.clear(),this._fireEvents({},{},d),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:d}of this._handlers)if(d.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!D1(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(d,_e,ot){for(const ut in d)if(ut!==ot&&(!_e||_e.indexOf(ut)<0))return!0;return!1}handleWindowEvent(d){this.handleEvent(d,`${d.type}Window`)}_getMapTouches(d){const _e=[];for(const ot of d)this._el.contains(ot.target)&&_e.push(ot);return _e}handleEvent(d,_e){this._updatingCamera=!0;const ot=d.type==="renderFrame",ut=ot?void 0:d,mt={needsRenderFrame:!1},xt={},Tt={},kt=d.touches?this._getMapTouches(d.touches):void 0,$t=kt?Rr(this._el,kt):ot?void 0:mr(this._el,d);for(const{handlerName:tr,handler:nr,allowed:cr}of this._handlers){if(!nr.isEnabled())continue;let lr;this._blockedByActive(Tt,cr,tr)?nr.reset():nr[_e||d.type]&&(lr=nr[_e||d.type](d,$t,kt),this.mergeHandlerResult(mt,xt,lr,tr,ut),lr&&lr.needsRenderFrame&&this._triggerRenderFrame()),(lr||nr.isActive())&&(Tt[tr]=nr)}const Xt={};for(const tr in this._previousActiveHandlers)Tt[tr]||(Xt[tr]=ut);this._previousActiveHandlers=Tt,(Object.keys(Xt).length||Jy(mt))&&(this._changes.push([mt,xt,Xt]),this._triggerRenderFrame()),(Object.keys(Tt).length||Jy(mt))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:rr}=mt;rr&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],rr(this._map))}mergeHandlerResult(d,_e,ot,ut,mt){if(!ot)return;Object.assign(d,ot);const xt={handlerName:ut,originalEvent:ot.originalEvent||mt};ot.zoomDelta!==void 0&&(_e.zoom=xt),ot.panDelta!==void 0&&(_e.drag=xt),ot.pitchDelta!==void 0&&(_e.pitch=xt),ot.bearingDelta!==void 0&&(_e.rotate=xt)}_applyChanges(){const d={},_e={},ot={};for(const[ut,mt,xt]of this._changes)ut.panDelta&&(d.panDelta=(d.panDelta||new c.P(0,0))._add(ut.panDelta)),ut.zoomDelta&&(d.zoomDelta=(d.zoomDelta||0)+ut.zoomDelta),ut.bearingDelta&&(d.bearingDelta=(d.bearingDelta||0)+ut.bearingDelta),ut.pitchDelta&&(d.pitchDelta=(d.pitchDelta||0)+ut.pitchDelta),ut.around!==void 0&&(d.around=ut.around),ut.aroundCoord!==void 0&&(d.aroundCoord=ut.aroundCoord),ut.pinchAround!==void 0&&(d.pinchAround=ut.pinchAround),ut.noInertia&&(d.noInertia=ut.noInertia),Object.assign(_e,mt),Object.assign(ot,xt);this._updateMapTransform(d,_e,ot),this._changes=[]}_updateMapTransform(d,_e,ot){const ut=this._map,mt=ut.transform,xt=Ar=>[Ar.x,Ar.y,Ar.z];if((Ar=>{const Dr=this._eventsInProgress.drag;return Dr&&!this._handlersById[Dr.handlerName].isActive()})()&&!Jy(d)){const Ar=mt.zoom;mt.cameraElevationReference="sea",this._originalZoom!=null&&mt._orthographicProjectionAtLowPitch&&mt.projection.name!=="globe"&&mt.pitch===0?(mt.cameraElevationReference="ground",mt.zoom=this._originalZoom):(mt.recenterOnTerrain(),mt.cameraElevationReference="ground"),Ar!==mt.zoom&&this._map._update(!0)}if(mt._isCameraConstrained&&ut._stop(!0),!Jy(d))return void this._fireEvents(_e,ot,!0);let{panDelta:Tt,zoomDelta:kt,bearingDelta:$t,pitchDelta:Xt,around:rr,aroundCoord:tr,pinchAround:nr}=d;mt._isCameraConstrained&&(kt>0&&(kt=0),mt._isCameraConstrained=!1),nr!==void 0&&(rr=nr),(kt||(Ar=>_e[Ar]&&!this._eventsInProgress[Ar])("drag"))&&rr&&(this._dragOrigin=xt(mt.pointCoordinate3D(rr)),this._originalZoom=mt.zoom,this._trackingEllipsoid.setup(mt._camera.position,this._dragOrigin)),mt.cameraElevationReference="sea",ut._stop(!0),rr=rr||ut.transform.centerPoint,$t&&(mt.bearing+=$t),Xt&&(mt.pitch+=Xt),mt._updateCameraState();const cr=[0,0,0];if(Tt)if(mt.projection.name==="mercator"){const Ar=this._trackingEllipsoid.projectRay(mt.screenPointToMercatorRay(rr).dir),Dr=this._trackingEllipsoid.projectRay(mt.screenPointToMercatorRay(rr.sub(Tt)).dir);cr[0]=Dr[0]-Ar[0],cr[1]=Dr[1]-Ar[1]}else{const Ar=mt.pointCoordinate(rr);if(mt.projection.name==="globe"){Tt=Tt.rotate(-mt.angle);const Dr=mt._pixelsPerMercatorPixel/mt.worldSize;cr[0]=-Tt.x*c.eW(c.a$(Ar.y))*Dr,cr[1]=-Tt.y*c.eW(mt.center.lat)*Dr}else{const Dr=mt.pointCoordinate(rr.sub(Tt));Ar&&Dr&&(cr[0]=Dr.x-Ar.x,cr[1]=Dr.y-Ar.y)}}const lr=mt.zoom,yr=[0,0,0];if(kt){const Ar=xt(tr||mt.pointCoordinate3D(rr)),Dr={dir:c.aw([],c.av([],Ar,mt._camera.position))};if(Dr.dir[2]<0){const Tr=mt.zoomDeltaToMovement(Ar,kt);c.c5(yr,Dr.dir,Tr)}}const xr=c.d8(cr,cr,yr);mt._translateCameraConstrained(xr),kt&&Math.abs(mt.zoom-lr)>1e-4&&mt.recenterOnTerrain(),mt.cameraElevationReference="ground",this._map._update(),d.noInertia||this._inertia.record(d),this._fireEvents(_e,ot,!0)}_fireEvents(d,_e,ot){const ut=D1(this._eventsInProgress),mt=D1(d),xt={};for(const Xt in d){const{originalEvent:rr}=d[Xt];this._eventsInProgress[Xt]||(xt[`${Xt}start`]=rr),this._eventsInProgress[Xt]=d[Xt]}!ut&&mt&&this._fireEvent("movestart",mt.originalEvent);for(const Xt in xt)this._fireEvent(Xt,xt[Xt]);mt&&this._fireEvent("move",mt.originalEvent);for(const Xt in d){const{originalEvent:rr}=d[Xt];this._fireEvent(Xt,rr)}const Tt={};let kt;for(const Xt in this._eventsInProgress){const{handlerName:rr,originalEvent:tr}=this._eventsInProgress[Xt];this._handlersById[rr].isActive()||(delete this._eventsInProgress[Xt],kt=_e[rr]||tr,Tt[`${Xt}end`]=kt)}for(const Xt in Tt)this._fireEvent(Xt,Tt[Xt]);const $t=D1(this._eventsInProgress);if(ot&&(ut||mt)&&!$t){this._updatingCamera=!0;const Xt=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),rr=tr=>tr!==0&&-this._bearingSnap<tr&&tr<this._bearingSnap;Xt?(rr(Xt.bearing||this._map.getBearing())&&(Xt.bearing=0),this._map.easeTo(Xt,{originalEvent:kt})):(this._map.fire(new c.z("moveend",{originalEvent:kt})),rr(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(d,_e){this._map.fire(new c.z(d,_e?{originalEvent:_e}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(d=>{this._frameId=void 0,this.handleEvent(new C2("renderFrame",{timeStamp:d})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const e_="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class wv extends c.E{constructor(d,_e){super(),this._moving=!1,this._zooming=!1,this.transform=d,this._bearingSnap=_e.bearingSnap,this._respectPrefersReducedMotion=_e.respectPrefersReducedMotion!==!1,c.aY(["_renderFrameCallback"],this)}getCenter(){return new c.aT(this.transform.center.lng,this.transform.center.lat)}setCenter(d,_e){return this.jumpTo({center:d},_e)}panBy(d,_e,ot){return d=c.P.convert(d).mult(-1),this.panTo(this.transform.center,Object.assign({offset:d},_e),ot)}panTo(d,_e,ot){return this.easeTo(Object.assign({center:d},_e),ot)}getZoom(){return this.transform.zoom}setZoom(d,_e){return this.jumpTo({zoom:d},_e),this}zoomTo(d,_e,ot){return this.easeTo(Object.assign({zoom:d},_e),ot)}zoomIn(d,_e){return this.zoomTo(this.getZoom()+1,d,_e),this}zoomOut(d,_e){return this.zoomTo(this.getZoom()-1,d,_e),this}getBearing(){return this.transform.bearing}setBearing(d,_e){return this.jumpTo({bearing:d},_e),this}getPadding(){return this.transform.padding}setPadding(d,_e){return this.jumpTo({padding:d},_e),this}rotateTo(d,_e,ot){return this.easeTo(Object.assign({bearing:d},_e),ot)}resetNorth(d,_e){return this.rotateTo(0,Object.assign({duration:1e3},d),_e),this}resetNorthPitch(d,_e){return this.easeTo(Object.assign({bearing:0,pitch:0,duration:1e3},d),_e),this}snapToNorth(d,_e){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(d,_e):this}getPitch(){return this.transform.pitch}setPitch(d,_e){return this.jumpTo({pitch:d},_e),this}cameraForBounds(d,_e){d=c.aI.convert(d);const ot=_e&&_e.bearing||0,ut=_e&&_e.pitch||0,mt=d.getNorthWest(),xt=d.getSouthEast();return this._cameraForBounds(this.transform,mt,xt,ot,ut,_e)}_extendPadding(d){const _e={top:0,right:0,bottom:0,left:0};return d==null?Object.assign({},_e,this.transform.padding):typeof d=="number"?{top:d,bottom:d,right:d,left:d}:Object.assign({},_e,d)}_extendCameraOptions(d){return(d=Object.assign({offset:[0,0],maxZoom:this.transform.maxZoom},d)).padding=this._extendPadding(d.padding),d}_minimumAABBFrustumDistance(d,_e){const ot=_e.max[0]-_e.min[0],ut=_e.max[1]-_e.min[1];return ot/ut>d.aspect?ot/(2*Math.tan(.5*d.fovX)*d.aspect):ut/(2*Math.tan(.5*d.fovY)*d.aspect)}_cameraForBoundsOnGlobe(d,_e,ot,ut,mt,xt){const Tt=d.clone(),kt=this._extendCameraOptions(xt);Tt.bearing=ut,Tt.pitch=mt;const $t=c.aT.convert(_e),Xt=c.aT.convert(ot),rr=.5*($t.lat+Xt.lat),tr=.5*($t.lng+Xt.lng),nr=c.eZ(rr,tr),cr=c.aw([],nr),lr=c.aw([],c.bI([],cr,[0,1,0])),yr=c.bI([],lr,cr),xr=[lr[0],lr[1],lr[2],0,yr[0],yr[1],yr[2],0,cr[0],cr[1],cr[2],0,0,0,0,1],Ar=[nr,c.eZ($t.lat,$t.lng),c.eZ(Xt.lat,$t.lng),c.eZ(Xt.lat,Xt.lng),c.eZ($t.lat,Xt.lng),c.eZ(rr,$t.lng),c.eZ(rr,Xt.lng),c.eZ($t.lat,tr),c.eZ(Xt.lat,tr)];let Dr=c.d9.fromPoints(Ar.map(bn=>[c.bJ(lr,bn),c.bJ(yr,bn),c.bJ(cr,bn)]));const Tr=c.af([],Dr.center,xr);c.e_(Tr)===0&&c.e$(Tr,0,0,1),c.aw(Tr,Tr),c.c5(Tr,Tr,c.aD),Tt.center=c.f0(Tr);const Wr=Tt.getWorldToCameraMatrix(),zr=c.bl(new Float64Array(16),Wr);Dr=c.d9.applyTransform(Dr,c.aB([],Wr,xr));const $r=this._extendAABB(Dr,Tt,kt,ut);if(!$r)return void c.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");Dr=$r,c.af(Tr,Tr,Wr);const Or=.5*(Dr.max[2]-Dr.min[2]),Br=this._minimumAABBFrustumDistance(Tt,Dr),Xr=c.c5([],[0,0,1],Or),an=c.d8(Xr,Tr,Xr),sn=Br+(Tt.pitch===0?0:c.bG(Tr,an)),wn=Tt.globeCenterInViewSpace,Cn=c.av([],Tr,[wn[0],wn[1],wn[2]]);c.aw(Cn,Cn),c.c5(Cn,Cn,sn);const Nn=c.d8([],Tr,Cn);c.af(Nn,Nn,zr);const Jn=c.eM/c.aD,yn=c.ag(Nn),Qr=c.cf(Math.max(yn*Jn-c.eM,Number.EPSILON),0),Dn=Math.min(Tt.zoomFromMercatorZAdjusted(Qr),kt.maxZoom);return Dn>.5*(c.c_+c.cL)?(Tt.setProjection({name:"mercator"}),Tt.zoom=Dn,this._cameraForBounds(Tt,_e,ot,ut,mt,xt)):{center:Tt.center,zoom:Dn,bearing:ut,pitch:mt}}_extendAABB(d,_e,ot,ut){const mt=.5*((ot.padding.left||0)+(ot.padding.right||0)),xt=.5*((ot.padding.top||0)+(ot.padding.bottom||0)),Tt=xt,kt=mt,$t=mt,Xt=xt,rr=_e.width-(kt+$t),tr=_e.height-(Tt+Xt),nr=c.av([],d.max,d.min),cr=Math.min(rr/nr[0],tr/nr[1]),lr=Math.min(_e.scaleZoom(_e.scale*cr),ot.maxZoom);if(isNaN(lr))return null;const yr=_e.scale/_e.zoomScale(lr),xr=new c.d9([d.min[0]-kt*yr,d.min[1]-Xt*yr,d.min[2]],[d.max[0]+$t*yr,d.max[1]+Tt*yr,d.max[2]]),Ar=(typeof ot.offset.x=="number"&&typeof ot.offset.y=="number"?new c.P(ot.offset.x,ot.offset.y):c.P.convert(ot.offset)).rotate(-c.an(ut));return xr.center[0]-=Ar.x*yr,xr.center[1]+=Ar.y*yr,xr}queryTerrainElevation(d,_e){const ot=this.transform.elevation;return ot?(_e=Object.assign({},{exaggerated:!0},_e),ot.getAtPoint(c.ae.fromLngLat(d),null,_e.exaggerated)):null}_cameraForBounds(d,_e,ot,ut,mt,xt){if(d.projection.name==="globe")return this._cameraForBoundsOnGlobe(d,_e,ot,ut,mt,xt);const Tt=d.clone(),kt=this._extendCameraOptions(xt);Tt.bearing=ut,Tt.pitch=mt;const $t=c.aT.convert(_e),Xt=c.aT.convert(ot),rr=new c.aT($t.lng,Xt.lat),tr=new c.aT(Xt.lng,$t.lat),nr=Tt.project($t),cr=Tt.project(Xt),lr=this.queryTerrainElevation($t),yr=this.queryTerrainElevation(Xt),xr=this.queryTerrainElevation(rr),Ar=this.queryTerrainElevation(tr),Dr=[[nr.x,nr.y,Math.min(lr||0,yr||0,xr||0,Ar||0)],[cr.x,cr.y,Math.max(lr||0,yr||0,xr||0,Ar||0)]];let Tr=c.d9.fromPoints(Dr);const Wr=Tt.getWorldToCameraMatrix(),zr=c.bl(new Float64Array(16),Wr);Tr=c.d9.applyTransform(Tr,Wr);const $r=this._extendAABB(Tr,Tt,kt,ut);if(!$r)return void c.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");Tr=$r;const Or=.5*c.av([],Tr.max,Tr.min)[2],Br=this._minimumAABBFrustumDistance(Tt,Tr),Xr=[0,0,1,0];c.aC(Xr,Xr,Wr),c.f1(Xr,Xr);const an=c.c5([],Xr,Br+Or),sn=c.d8([],Tr.center,an);c.af(Tr.center,Tr.center,zr),c.af(sn,sn,zr);const wn=Tt.unproject(new c.P(Tr.center[0],Tr.center[1])),Cn=c.f2(Tt.projection,wn),Nn=Math.pow(2,Cn),Jn=Math.min(Tt._zoomFromMercatorZ(sn[2]*Tt.pixelsPerMeter*Nn/Tt.worldSize),kt.maxZoom);return Tt.mercatorFromTransition&&Jn<.5*(c.c_+c.cL)?(Tt.setProjection({name:"globe"}),Tt.zoom=Jn,this._cameraForBounds(Tt,_e,ot,ut,mt,xt)):{center:wn,zoom:Jn,bearing:ut,pitch:mt}}fitBounds(d,_e,ot){const ut=this.cameraForBounds(d,_e);return this._fitInternal(ut,_e,ot)}fitScreenCoordinates(d,_e,ot,ut,mt){const xt=c.P.convert(d),Tt=c.P.convert(_e),kt=new c.P(Math.min(xt.x,Tt.x),Math.min(xt.y,Tt.y)),$t=new c.P(Math.max(xt.x,Tt.x),Math.max(xt.y,Tt.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(xt,Tt))return this;const Xt=this.transform.pointLocation3D(kt),rr=this.transform.pointLocation3D($t),tr=this.transform.pointLocation3D(new c.P(kt.x,$t.y)),nr=this.transform.pointLocation3D(new c.P($t.x,kt.y)),cr=[Math.min(Xt.lng,rr.lng,tr.lng,nr.lng),Math.min(Xt.lat,rr.lat,tr.lat,nr.lat)],lr=[Math.max(Xt.lng,rr.lng,tr.lng,nr.lng),Math.max(Xt.lat,rr.lat,tr.lat,nr.lat)],yr=ut&&ut.pitch?ut.pitch:this.getPitch(),xr=this._cameraForBounds(this.transform,cr,lr,ot,yr,ut);return this._fitInternal(xr,ut,mt)}_fitInternal(d,_e,ot){return d?(_e=Object.assign(d,_e)).linear?this.easeTo(_e,ot):this.flyTo(_e,ot):this}jumpTo(d,_e){this.stop();const ot=d.preloadOnly?this.transform.clone():this.transform;let ut=!1,mt=!1,xt=!1;"zoom"in d&&ot.zoom!==+d.zoom&&(ut=!0,ot.zoom=+d.zoom),d.center!==void 0&&(ot.center=c.aT.convert(d.center)),"bearing"in d&&ot.bearing!==+d.bearing&&(mt=!0,ot.bearing=+d.bearing),"pitch"in d&&ot.pitch!==+d.pitch&&(xt=!0,ot.pitch=+d.pitch);const Tt=typeof d.padding=="number"?this._extendPadding(d.padding):d.padding;if(d.padding!=null&&!ot.isPaddingEqual(Tt))if(d.retainPadding===!1){const kt=ot.clone();kt.padding=Tt,ot.setLocationAtPoint(ot.center,kt.centerPoint)}else ot.padding=Tt;return d.preloadOnly?(this._preloadTiles(ot),this):(this.fire(new c.z("movestart",_e)).fire(new c.z("move",_e)),ut&&this.fire(new c.z("zoomstart",_e)).fire(new c.z("zoom",_e)).fire(new c.z("zoomend",_e)),mt&&this.fire(new c.z("rotatestart",_e)).fire(new c.z("rotate",_e)).fire(new c.z("rotateend",_e)),xt&&this.fire(new c.z("pitchstart",_e)).fire(new c.z("pitch",_e)).fire(new c.z("pitchend",_e)),this.fire(new c.z("moveend",_e)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||c.w(e_),this.transform.getFreeCameraOptions()}setFreeCameraOptions(d,_e){const ot=this.transform;if(!ot.projection.supportsFreeCamera)return c.w(e_),this;this.stop();const ut=ot.zoom,mt=ot.pitch,xt=ot.bearing;ot.setFreeCameraOptions(d);const Tt=ut!==ot.zoom,kt=mt!==ot.pitch,$t=xt!==ot.bearing;return this.fire(new c.z("movestart",_e)).fire(new c.z("move",_e)),Tt&&this.fire(new c.z("zoomstart",_e)).fire(new c.z("zoom",_e)).fire(new c.z("zoomend",_e)),$t&&this.fire(new c.z("rotatestart",_e)).fire(new c.z("rotate",_e)).fire(new c.z("rotateend",_e)),kt&&this.fire(new c.z("pitchstart",_e)).fire(new c.z("pitch",_e)).fire(new c.z("pitchend",_e)),this.fire(new c.z("moveend",_e)),this}easeTo(d,_e){this._stop(!1,d.easeId),((d=Object.assign({offset:[0,0],duration:500,easing:c.eV},d)).animate===!1||this._prefersReducedMotion(d))&&(d.duration=0);const ot=this.transform,ut=this.getZoom(),mt=this.getBearing(),xt=this.getPitch(),Tt=this.getPadding(),kt="zoom"in d?+d.zoom:ut,$t="bearing"in d?this._normalizeBearing(d.bearing,mt):mt,Xt="pitch"in d?+d.pitch:xt,rr=this._extendPadding(d.padding),tr=c.P.convert(d.offset);let nr,cr,lr;if(ot.projection.name==="globe"){const Xr=c.ae.fromLngLat(ot.center),an=tr.rotate(-ot.angle);Xr.x+=an.x/ot.worldSize,Xr.y+=an.y/ot.worldSize;const sn=Xr.toLngLat(),wn=c.aT.convert(d.center||sn);this._normalizeCenter(wn),nr=ot.centerPoint.add(an),cr=new c.P(Xr.x,Xr.y).mult(ot.worldSize),lr=new c.P(c.aF(wn.lng),c.aJ(wn.lat)).mult(ot.worldSize).sub(cr)}else{nr=ot.centerPoint.add(tr);const Xr=ot.pointLocation(nr),an=c.aT.convert(d.center||Xr);this._normalizeCenter(an),cr=ot.project(Xr),lr=ot.project(an).sub(cr)}const yr=ot.zoomScale(kt-ut);let xr,Ar;d.around&&(xr=c.aT.convert(d.around),Ar=ot.locationPoint(xr));const Dr=this._zooming||kt!==ut,Tr=this._rotating||mt!==$t,Wr=this._pitching||Xt!==xt,zr=!ot.isPaddingEqual(rr),$r=d.retainPadding===!1?ot.clone():ot,Or=Xr=>an=>{if(Dr&&(Xr.zoom=c.ak(ut,kt,an)),Tr&&(Xr.bearing=c.ak(mt,$t,an)),Wr&&(Xr.pitch=c.ak(xt,Xt,an)),zr&&($r.interpolatePadding(Tt,rr,an),nr=$r.centerPoint.add(tr)),xr)Xr.setLocationAtPoint(xr,Ar);else{const sn=Xr.zoomScale(Xr.zoom-ut),wn=kt>ut?Math.min(2,yr):Math.max(.5,yr),Cn=Math.pow(wn,1-an),Nn=Xr.unproject(cr.add(lr.mult(an*Cn)).mult(sn));Xr.setLocationAtPoint(Xr.renderWorldCopies?Nn.wrap():Nn,nr)}return d.preloadOnly||this._fireMoveEvents(_e),Xr};if(d.preloadOnly){const Xr=this._emulate(Or,d.duration,ot);return this._preloadTiles(Xr),this}const Br={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=Dr,this._rotating=Tr,this._pitching=Wr,this._padding=zr,this._easeId=d.easeId,this._prepareEase(_e,d.noMoveStart,Br),this._ease(Or(ot),Xr=>{ot.cameraElevationReference==="sea"&&ot.recenterOnTerrain(),this._afterEase(_e,Xr)},d),this}_prepareEase(d,_e,ot={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),_e||ot.moving||this.fire(new c.z("movestart",d)),this._zooming&&!ot.zooming&&this.fire(new c.z("zoomstart",d)),this._rotating&&!ot.rotating&&this.fire(new c.z("rotatestart",d)),this._pitching&&!ot.pitching&&this.fire(new c.z("pitchstart",d))}_fireMoveEvents(d){this.fire(new c.z("move",d)),this._zooming&&this.fire(new c.z("zoom",d)),this._rotating&&this.fire(new c.z("rotate",d)),this._pitching&&this.fire(new c.z("pitch",d))}_afterEase(d,_e){if(this._easeId&&_e&&this._easeId===_e)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const ot=this._zooming,ut=this._rotating,mt=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,ot&&this.fire(new c.z("zoomend",d)),ut&&this.fire(new c.z("rotateend",d)),mt&&this.fire(new c.z("pitchend",d)),this.fire(new c.z("moveend",d))}flyTo(d,_e){if(this._prefersReducedMotion(d)){const bn=c.aH(d,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(bn,_e)}this.stop(),d=Object.assign({offset:[0,0],speed:1.2,curve:1.42,easing:c.eV},d);const ot=this.transform,ut=this.getZoom(),mt=this.getBearing(),xt=this.getPitch(),Tt=this.getPadding(),kt="zoom"in d?c.aA(+d.zoom,ot.minZoom,ot.maxZoom):ut,$t="bearing"in d?this._normalizeBearing(d.bearing,mt):mt,Xt="pitch"in d?+d.pitch:xt,rr=this._extendPadding(d.padding),tr=ot.zoomScale(kt-ut),nr=c.P.convert(d.offset);let cr=ot.centerPoint.add(nr);const lr=ot.pointLocation(cr),yr=c.aT.convert(d.center||lr);this._normalizeCenter(yr);const xr=ot.project(lr),Ar=ot.project(yr).sub(xr);let Dr=d.curve;const Tr=Math.max(ot.width,ot.height),Wr=Tr/tr,zr=Ar.mag();if("minZoom"in d){const bn=c.aA(Math.min(d.minZoom,ut,kt),ot.minZoom,ot.maxZoom),$n=Tr/ot.zoomScale(bn-ut);Dr=Math.sqrt($n/zr*2)}const $r=Dr*Dr;function Or(bn){const $n=(Wr*Wr-Tr*Tr+(bn?-1:1)*$r*$r*zr*zr)/(2*(bn?Wr:Tr)*$r*zr);return Math.log(Math.sqrt($n*$n+1)-$n)}function Br(bn){return(Math.exp(bn)-Math.exp(-bn))/2}function Xr(bn){return(Math.exp(bn)+Math.exp(-bn))/2}const an=Or(0);let sn=function(bn){return Xr(an)/Xr(an+Dr*bn)},wn=function(bn){return Tr*((Xr(an)*(Br($n=an+Dr*bn)/Xr($n))-Br(an))/$r)/zr;var $n},Cn=(Or(1)-an)/Dr;if(Math.abs(zr)<1e-6||!isFinite(Cn)){if(Math.abs(Tr-Wr)<1e-6)return this.easeTo(d,_e);const bn=Wr<Tr?-1:1;Cn=Math.abs(Math.log(Wr/Tr))/Dr,wn=function(){return 0},sn=function($n){return Math.exp(bn*Dr*$n)}}d.duration="duration"in d?+d.duration:1e3*Cn/("screenSpeed"in d?+d.screenSpeed/Dr:+d.speed),d.maxDuration&&d.duration>d.maxDuration&&(d.duration=0);const Nn=mt!==$t,Jn=Xt!==xt,yn=!ot.isPaddingEqual(rr),Qr=d.retainPadding===!1?ot.clone():ot,Dn=bn=>$n=>{const ls=$n*Cn,As=1/sn(ls);bn.zoom=$n===1?kt:ut+bn.scaleZoom(As),Nn&&(bn.bearing=c.ak(mt,$t,$n)),Jn&&(bn.pitch=c.ak(xt,Xt,$n)),yn&&(Qr.interpolatePadding(Tt,rr,$n),cr=Qr.centerPoint.add(nr));const is=$n===1?yr:bn.unproject(xr.add(Ar.mult(wn(ls))).mult(As));return bn.setLocationAtPoint(bn.renderWorldCopies?is.wrap():is,cr),bn._updateCameraOnTerrain(),d.preloadOnly||this._fireMoveEvents(_e),bn};if(d.preloadOnly){const bn=this._emulate(Dn,d.duration,ot);return this._preloadTiles(bn),this}return this._zooming=!0,this._rotating=Nn,this._pitching=Jn,this._padding=yn,this._prepareEase(_e,!1),this._ease(Dn(ot),()=>this._afterEase(_e),d),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(d){}_cancelRenderFrame(d){}_stop(d,_e){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const ot=this._onEaseEnd;this._onEaseEnd=void 0,ot.call(this,_e)}if(!d){const ot=this.handlers;ot&&ot.stop(!1)}return this}_ease(d,_e,ot){ot.animate===!1||ot.duration===0?(d(1),_e()):(this._easeStart=c.o.now(),this._easeOptions=ot,this._onEaseFrame=d,this._onEaseEnd=_e,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const d=Math.min((c.o.now()-this._easeStart)/this._easeOptions.duration,1),_e=this._onEaseFrame;_e&&_e(this._easeOptions.easing(d)),d<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(d,_e){d=c.bT(d,-180,180);const ot=Math.abs(d-_e);return Math.abs(d-360-_e)<ot&&(d-=360),Math.abs(d+360-_e)<ot&&(d+=360),d}_normalizeCenter(d){const _e=this.transform;if(_e.maxBounds||_e.projection.name!=="globe"&&!_e.renderWorldCopies)return;const ot=d.lng-_e.center.lng;d.lng+=ot>180?-360:ot<-180?360:0}_prefersReducedMotion(d){return this._respectPrefersReducedMotion&&c.o.prefersReducedMotion&&!(d&&d.essential)}_emulate(d,_e,ot){const ut=Math.ceil(15*_e/1e3),mt=[],xt=d(ot.clone());for(let Tt=0;Tt<=ut;Tt++){const kt=xt(Tt/ut);mt.push(kt.clone())}return mt}_preloadTiles(d,_e){}}class k1{constructor(d={}){this.options=d,c.aY(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(d){const _e=this.options&&this.options.compact,ot=d._getUIString("AttributionControl.ToggleAttribution");this._map=d,this._container=Bt("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Bt("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",ot);const ut=Bt("span","mapboxgl-ctrl-icon",this._compactButton);return ut.setAttribute("aria-hidden","true"),ut.setAttribute("title",ot),this._innerContainer=Bt("div","mapboxgl-ctrl-attrib-inner",this._container),_e&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),_e===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let d=this._editLink;d||(d=this._editLink=this._container.querySelector(".mapbox-improve-map"));const _e=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||c.e.ACCESS_TOKEN}];if(d){const ot=_e.reduce((ut,mt,xt)=>(mt.value&&(ut+=`${mt.key}=${mt.value}${xt<_e.length-1?"&":""}`),ut),"?");d.href=`${c.e.FEEDBACK_URL}/${ot}#${_f(this._map,!0)}`,d.rel="noopener nofollow"}}_updateData(d){!d||(d.dataType!=="source"||d.sourceDataType!=="metadata"&&d.sourceDataType!=="visibility")&&d.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let d=[];if(this._map.style.stylesheet){const ut=this._map.style.stylesheet;this.styleOwner=ut.owner,this.styleId=ut.id}const _e=this._map.style._mergedSourceCaches;for(const ut in _e){const mt=_e[ut];if(mt.used){const xt=mt.getSource();xt.attribution&&d.indexOf(xt.attribution)<0&&d.push(xt.attribution)}}d.sort((ut,mt)=>ut.length-mt.length),d=d.filter((ut,mt)=>{for(let xt=mt+1;xt<d.length;xt++)if(d[xt].indexOf(ut)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?d=[...this.options.customAttribution,...d]:d.unshift(this.options.customAttribution));const ot=d.map(ut=>function(mt){const xt=new DOMParser().parseFromString(mt,"text/html");return Array.from(xt.body.querySelectorAll("*")).forEach(Tt=>{const kt=Tt.textContent||"";if(Tt.tagName!=="A")return void Tt.replaceWith(xt.createTextNode(kt));const $t=Tt.getAttribute("href");if(!$t||!/^(https?:|mailto:)/i.test($t))return void Tt.replaceWith(xt.createTextNode(kt));const Xt=xt.createElement("a");Xt.href=$t,Xt.textContent=kt,Xt.rel="noopener nofollow";const rr=Tt.getAttribute("class");rr&&(Xt.className=rr),Tt.replaceWith(Xt)}),xt.body.innerHTML}(ut)).join(" | ");ot!==this._attribHTML&&(this._attribHTML=ot,d.length?(this._innerContainer.innerHTML=ot,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class F1{constructor(){c.aY(["_updateLogo","_updateCompact"],this)}onAdd(d){this._map=d,this._container=Bt("div","mapboxgl-ctrl");const _e=Bt("a","mapboxgl-ctrl-logo");return _e.target="_blank",_e.rel="noopener nofollow",_e.href="https://www.mapbox.com/",_e.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),_e.setAttribute("rel","noopener nofollow"),this._container.appendChild(_e),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(d){d&&d.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const d=this._map.style._sourceCaches;if(Object.entries(d).length===0)return!0;for(const _e in d){const ot=d[_e].getSource();if(ot.hasOwnProperty("mapbox_logo")&&!ot.mapbox_logo)return!1}return!0}_updateCompact(){const d=this._container.children;if(d.length){const _e=d[0];this._map.getCanvasContainer().offsetWidth<250?_e.classList.add("mapboxgl-compact"):_e.classList.remove("mapboxgl-compact")}}}class qx{constructor(){c.aY(["_onIndoorUpdate"],this)}onAdd(d){return this._map=d,this._container=Bt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.indoor.on("selector-update",_e=>this._onIndoorUpdate(_e)),this._container}_createButton(d,_e){const ot=Bt("button",d,this._container);return ot.type="button",ot.addEventListener("click",_e),ot}_createSeparator(){return Bt("div","mapboxgl-ctrl-separator",this._container)}_setButtonTitle(d,_e){this._map&&(d.setAttribute("aria-label",_e),d.textContent=_e)}onRemove(){this._container&&this._container.remove(),this._map&&this._map.indoor&&(this._map.indoor.off("selector-update",this._onIndoorUpdate),this._map=null)}getDefaultPosition(){return"right"}_onIndoorUpdate(d){if(!d||!d.floors)return this._model=d,void(this._container.style.display="none");const _e=this._model;this._model=d,this._container.style.display="inline-block",this._container.style.borderRadius="8px",_e&&Array.from(this._container.children).forEach(ot=>ot.remove()),d.floors.length>0&&(this.addBuildingsToggleButton(),this.addCurrentFloors(d.floors,d.activeFloorsVisible),this._updateBuildingsButtonState())}addBuildingsToggleButton(){const d=this._createButton("mapboxgl-ctrl-buildings-toggle",()=>{const _e=this._map;this._model&&_e&&_e._setIndoorActiveFloorsVisibility(!this._model.activeFloorsVisible)});Bt("span","mapboxgl-ctrl-icon",d).setAttribute("aria-hidden","true"),d.classList.add("mapboxgl-ctrl-level-button","mapboxgl-ctrl-buildings-toggle"),this._model&&!this._model.activeFloorsVisible&&d.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(d),this._createSeparator()}_updateBuildingsButtonState(){const d=this._container.querySelector(".mapboxgl-ctrl-buildings-toggle");d&&this._model&&(this._model.activeFloorsVisible?d.classList.remove("mapboxgl-ctrl-level-button-selected"):d.classList.add("mapboxgl-ctrl-level-button-selected"))}addCurrentFloors(d,_e){for(let ot=0;ot<d.length;ot++){const ut=d[ot],mt=this._createButton("mapboxgl-ctrl-level-button",()=>{this._map._selectIndoorFloor(ut.id)});this._setButtonTitle(mt,ut.zIndex.toString()),this._model&&ut.id===this._model.selectedFloorId&&_e&&mt.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(mt),ot<d.length-1&&this._createSeparator()}}}class um{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(d){const _e=++this._id;return this._queue.push({callback:d,id:_e,cancelled:!1}),_e}remove(d){const _e=this._currentlyRunning,ot=_e?this._queue.concat(_e):this._queue;for(const ut of ot)if(ut.id===d)return void(ut.cancelled=!0)}run(d=0){const _e=this._currentlyRunning=this._queue;this._queue=[];for(const ot of _e)if(!ot.cancelled&&(ot.callback(d),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class dm{constructor(d){this.jumpTo(d)}getValue(d){if(d<=this._startTime)return this._start;if(d>=this._endTime)return this._end;const _e=c.dD((d-this._startTime)/(this._endTime-this._startTime));return this._start*(1-_e)+this._end*_e}isEasing(d){return d>=this._startTime&&d<=this._endTime}jumpTo(d){this._startTime=-1/0,this._endTime=-1/0,this._start=d,this._end=d}easeTo(d,_e,ot){this._start=this.getValue(_e),this._end=d,this._startTime=_e,this._endTime=_e+ot}}const hm={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class Um extends c.z{constructor(d,_e,ot,ut){const{point:mt,lngLat:xt,originalEvent:Tt,target:kt}=d;super(d.type,{point:mt,lngLat:xt,originalEvent:Tt,target:kt}),this.preventDefault=()=>{d.preventDefault()},this.id=_e,this.interaction=ot,this.feature=ut}}class B0{constructor(d){this.map=d,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(d,_e){if(this.typeById.has(d))throw new Error(`Interaction id "${d}" already exists.`);const ot=_e.filter;let ut=_e.type;ot&&this.filters.set(d,c.b6(ot)),ut==="mouseover"&&(ut="mouseenter"),ut==="mouseout"&&(ut="mouseleave");const mt=this.interactionsByType.get(ut)||new Map;ut==="mouseenter"||ut==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(d,_e)):mt.size===0&&this.map.on(ut,this.handleType),mt.size===0&&this.interactionsByType.set(ut,mt),mt.set(d,_e),this.typeById.set(d,ut)}get(d){const _e=this.typeById.get(d);if(!_e)return;const ot=this.interactionsByType.get(_e);return ot?ot.get(d):void 0}remove(d){const _e=this.typeById.get(d);if(!_e)return;this.typeById.delete(d),this.filters.delete(d);const ot=this.interactionsByType.get(_e);ot&&(ot.delete(d),_e==="mouseenter"||_e==="mouseleave"?(this.delegatedInteractions.delete(d),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):ot.size===0&&this.map.off(_e,this.handleType))}queryTargets(d,_e){const ot=[];for(const[ut,mt]of _e)mt.target&&ot.push({targetId:ut,target:mt.target,filter:this.filters.get(ut)});return this.map.style.queryRenderedTargets(d,ot,this.map.transform)}handleMove(d){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const _e=this.queryTargets(d.point,Array.from(this.delegatedInteractions).reverse());_e.length&&(d.type="mouseenter",this.handleType(d,_e));const ot=new Map;for(const[ut,{feature:mt}]of this.prevHoveredFeatures)this.hoveredFeatures.has(ut)||ot.set(mt.id,mt);ot.size&&(d.type="mouseleave",this.handleType(d,Array.from(ot.values())))}handleOut(d){const _e=Array.from(this.hoveredFeatures.values()).map(({feature:ot})=>ot);_e.length&&(d.type="mouseleave",this.handleType(d,_e)),this.hoveredFeatures.clear()}handleType(d,_e){const ot=d.type==="mouseenter";if(ot&&!this.interactionsByType.has(d.type))return void c.w("mouseenter interaction required for mouseleave to work.");const ut=Array.from(this.interactionsByType.get(d.type)).reverse(),mt=!!_e;_e=_e||this.queryTargets(d.point,ut);let xt=!1;const Tt=new Set;for(const kt of _e){for(const[$t,Xt]of ut){if(!Xt.target)continue;const rr=kt.variants?kt.variants[$t]:null;if(rr){for(const tr of rr){if(yp(tr,kt,Tt,$t))continue;const nr=new c.dx(kt,tr),cr=Zu(tr,kt,$t);mt&&nr.id!==void 0&&(nr.state=this.map.getFeatureState(nr));const lr=ot?this.prevHoveredFeatures.get(cr):null,yr=new Um(d,$t,Xt,nr),xr=lr?lr.stop:Xt.handler(yr);if(ot&&this.hoveredFeatures.set(cr,{feature:kt,stop:xr}),xr!==!1){xt=!0;break}}if(xt)break}}if(xt)break}if(!xt)for(const[kt,$t]of ut){const{handler:Xt,target:rr}=$t;if(!rr&&Xt(new Um(d,kt,$t,null))!==!1)break}}}function S2(st,d){if(Array.isArray(st)&&Array.isArray(d)){const _e=new Set(st),ot=new Set(d);return _e.size===ot.size&&st.every(ut=>ot.has(ut))}return c.by(st,d)}const T2={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},R2={showCompass:!0,showZoom:!0,visualizePitch:!1};class I2{constructor(d,_e,ot=!1){this._clickTolerance=10,this.element=_e,this.mouseRotate=new _v({clickTolerance:d.dragRotate._mouseRotate._clickTolerance}),this.map=d,ot&&(this.mousePitch=new vv({clickTolerance:d.dragRotate._mousePitch._clickTolerance})),c.aY(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),_e.addEventListener("mousedown",this.mousedown),_e.addEventListener("touchstart",this.touchstart,{passive:!1}),_e.addEventListener("touchmove",this.touchmove),_e.addEventListener("touchend",this.touchend),_e.addEventListener("touchcancel",this.reset)}down(d,_e){this.mouseRotate.mousedown(d,_e),this.mousePitch&&this.mousePitch.mousedown(d,_e),Gt()}move(d,_e){const ot=this.map,ut=this.mouseRotate.mousemoveWindow(d,_e),mt=ut&&ut.bearingDelta;if(mt&&ot.setBearing(ot.getBearing()+mt),this.mousePitch){const xt=this.mousePitch.mousemoveWindow(d,_e),Tt=xt&&xt.pitchDelta;Tt&&ot.setPitch(ot.getPitch()+Tt)}}off(){const d=this.element;d.removeEventListener("mousedown",this.mousedown),d.removeEventListener("touchstart",this.touchstart),d.removeEventListener("touchmove",this.touchmove),d.removeEventListener("touchend",this.touchend),d.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){er(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(d){this.down(Object.assign({},d,{ctrlKey:!0,preventDefault:()=>d.preventDefault()}),mr(this.element,d)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(d){this.move(d,mr(this.element,d))}mouseup(d){this.mouseRotate.mouseupWindow(d),this.mousePitch&&this.mousePitch.mouseupWindow(d),this.offTemp()}touchstart(d){d.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Rr(this.element,d.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>d.preventDefault()},this._startPos))}touchmove(d){d.targetTouches.length!==1?this.reset():(this._lastPos=Rr(this.element,d.targetTouches)[0],this.move({preventDefault:()=>d.preventDefault()},this._lastPos))}touchend(d){d.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Cv(st,d,_e){if(st=new c.aT(st.lng,st.lat),d){const ot=new c.aT(st.lng-360,st.lat),ut=new c.aT(st.lng+360,st.lat),mt=360*Math.ceil(Math.abs(st.lng-_e.center.lng)/360),xt=_e.locationPoint3D(st).distSqr(d),Tt=d.x<0||d.y<0||d.x>_e.width||d.y>_e.height;_e.locationPoint3D(ot).distSqr(d)<xt&&(Tt||Math.abs(ot.lng-_e.center.lng)<mt)?st=ot:_e.locationPoint3D(ut).distSqr(d)<xt&&(Tt||Math.abs(ut.lng-_e.center.lng)<mt)&&(st=ut)}for(;Math.abs(st.lng-_e.center.lng)>180;){const ot=_e.locationPoint3D(st);if(ot.x>=0&&ot.y>=0&&ot.x<=_e.width&&ot.y<=_e.height)break;st.lng>_e.center.lng?st.lng-=360:st.lng+=360}return st}const Ap={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},b0={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class t_ extends c.E{constructor(d,_e){super(),(d instanceof HTMLElement||_e)&&(d=Object.assign({element:d},_e)),c.aY(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:ot="center",color:ut="#3FB1CE",scale:mt=1,draggable:xt=!1,clickTolerance:Tt=0,rotation:kt=b0.rotation,rotationAlignment:$t=b0.rotationAlignment,pitchAlignment:Xt=b0.pitchAlignment,occludedOpacity:rr=b0.occludedOpacity,altitude:tr=b0.altitude}=d||{};this._anchor=ot,this._color=ut,this._scale=mt,this._draggable=xt,this._clickTolerance=Tt,this._rotation=kt,this._rotationAlignment=$t,this._pitchAlignment=Xt,this._occludedOpacity=rr,this._altitude=tr,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),d&&d.element?(this._element=d.element,this._offset=c.P.convert(d&&d.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=c.P.convert(d&&d.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",lr=>{lr.preventDefault()}),this._element.addEventListener("mousedown",lr=>{lr.preventDefault()});const nr=this._element.classList;for(const lr in Ap)nr.remove(`mapboxgl-marker-anchor-${lr}`);nr.add(`mapboxgl-marker-anchor-${this._anchor}`);const cr=d&&d.className?d.className.trim().split(/\s+/):[];nr.add(...cr),this._popup=null}_createDefaultMarker(){const d=Bt("div"),_e=Zt("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},d);if(this._altitude===0){const ot=Zt("radialGradient",{id:"shadowGradient"},Zt("defs",{},_e));Zt("stop",{offset:"10%","stop-opacity":.4},ot),Zt("stop",{offset:"100%","stop-opacity":.05},ot),Zt("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},_e)}return Zt("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},_e),Zt("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},_e),Zt("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},_e),d}addTo(d){return d===this._map||(this.remove(),this._map=d,d.getCanvasContainer().appendChild(this._element),d.on("move",this._updateMoving),d.on("moveend",this._update),d.on("remove",this._clearFadeTimer),d._addMarker(this),this.setDraggable(this._draggable),this._update(),d.on("click",this._onMapClick)),this}remove(){const d=this._map;return d&&(d.off("click",this._onMapClick),d.off("move",this._updateMoving),d.off("moveend",this._update),d.off("mousedown",this._addDragHandler),d.off("touchstart",this._addDragHandler),d.off("mouseup",this._onUp),d.off("touchend",this._onUp),d.off("mousemove",this._onMove),d.off("touchmove",this._onMove),d.off("remove",this._clearFadeTimer),d._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(d){return this._lngLat=c.aT.convert(d),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(d){return d===this._altitude||(this._defaultMarker&&(this._altitude===0&&d!==0||this._altitude!==0&&d===0)&&(this._element=this._createDefaultMarker()),this._altitude=d||b0.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(d){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),d){if(!("offset"in d.options)){const ut=Math.sqrt(Math.pow(13.5,2)/2);d.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[ut,-1*(38.1-13.5+ut)],"bottom-right":[-ut,-1*(38.1-13.5+ut)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=d,d._marker=this,d._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(d){const _e=d.code,ot=d.charCode||d.keyCode;_e!=="Space"&&_e!=="Enter"&&ot!==32&&ot!==13||this.togglePopup()}_onMapClick(d){const _e=d.originalEvent.target,ot=this._element;this._popup&&(_e===ot||ot.contains(_e))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const d=this._popup;return d?(d.isOpen()?(d.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(d.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const d=this._map,_e=this._pos;if(!d||!_e)return!1;const ot=d.unproject(_e,this._altitude),ut=d.getFreeCameraOptions();if(!ut.position)return!1;const mt=ut.position.toLngLat();return mt.distanceTo(ot)<.9*mt.distanceTo(this._lngLat)}_evaluateOpacity(){const d=this._map;if(!d)return;const _e=this._pos;if(!_e||_e.x<0||_e.x>d.transform.width||_e.y<0||_e.y>d.transform.height)return void this._clearFadeTimer();const ot=d.unproject(_e,this._altitude);let ut;d._showingGlobe()&&c.f5(d.transform,this._lngLat)?ut=0:(ut=1-d._queryFogOpacity(ot),d.transform._terrainEnabled()&&d.getTerrain()&&this._behindTerrain()&&(ut*=this._occludedOpacity)),this._element.style.opacity=`${ut}`,this._element.style.pointerEvents=ut>0?"auto":"none",this._popup&&this._popup._setOpacity(ut),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const d=this._pos;if(!d||!this._map)return;const _e=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${d.x}px,${d.y}px)
            ${Ap[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${_e.x}px,${_e.y}px)
        `}_calculateXYTransform(){const d=this._pos,_e=this._map,ot=this.getPitchAlignment();if(!_e||!d||ot!=="map")return"";if(!_e._showingGlobe()){const kt=_e.getPitch();return kt?`rotateX(${kt}deg)`:""}const ut=c.cX(c.f6(_e.transform,this._lngLat)),mt=d.sub(c.f7(_e.transform)),xt=Math.abs(mt.x)+Math.abs(mt.y);if(xt===0)return"";const Tt=ut/xt;return`rotateX(${-mt.y*Tt}deg) rotateY(${mt.x*Tt}deg)`}_calculateZTransform(){const d=this._pos,_e=this._map;if(!_e||!d)return"";let ot=0;const ut=this.getRotationAlignment();if(ut==="map")if(_e._showingGlobe()){const mt=_e.project(new c.aT(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),xt=_e.project(new c.aT(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(mt);ot=c.cX(Math.atan2(xt.y,xt.x))-90}else ot=-_e.getBearing();else if(ut==="horizon"){const mt=c.ah(4,6,_e.getZoom()),xt=c.f7(_e.transform);xt.y+=mt*_e.transform.height;const Tt=d.sub(xt),kt=c.cX(Math.atan2(Tt.y,Tt.x));ot=(kt>90?kt-270:kt+90)*(1-mt)}return ot+=this._rotation,ot?`rotateZ(${ot}deg)`:""}_update(d){cancelAnimationFrame(this._updateFrameId);const _e=this._map;_e&&(_e.transform.renderWorldCopies&&(this._lngLat=Cv(this._lngLat,this._pos,_e.transform)),this._pos=_e.project(this._lngLat,this._altitude),d===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),_e._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(_e._showingGlobe()||_e.getTerrain()||_e.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(d){return this._offset=c.P.convert(d),this._update(),this}addClassName(d){return this._element.classList.add(d),this}removeClassName(d){return this._element.classList.remove(d),this}toggleClassName(d){return this._element.classList.toggle(d)}_onMove(d){const _e=this._map;if(!_e)return;const ot=this._pointerdownPos,ut=this._positionDelta;if(ot&&ut){if(!this._isDragging){const mt=this._clickTolerance||_e._clickTolerance;if(d.point.dist(ot)<mt)return;this._isDragging=!0}this._pos=d.point.sub(ut),this._lngLat=_e.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new c.z("dragstart"))),this.fire(new c.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const d=this._map;d&&(d.off("mousemove",this._onMove),d.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new c.z("dragend")),this._state="inactive"}_addDragHandler(d){const _e=this._map,ot=this._pos;_e&&ot&&this._element.contains(d.originalEvent.target)&&(d.preventDefault(),this._positionDelta=d.point.sub(ot),this._pointerdownPos=d.point,this._state="pending",_e.on("mousemove",this._onMove),_e.on("touchmove",this._onMove),_e.once("mouseup",this._onUp),_e.once("touchend",this._onUp))}setDraggable(d){this._draggable=!!d;const _e=this._map;return _e&&(d?(_e.on("mousedown",this._addDragHandler),_e.on("touchstart",this._addDragHandler)):(_e.off("mousedown",this._addDragHandler),_e.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(d){return this._rotation=d||b0.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(d){return this._rotationAlignment=d||b0.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(d){return this._pitchAlignment=d||b0.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(d){return this._occludedOpacity=d||b0.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const D2={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Xx={maxWidth:100,unit:"metric"},Av={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},w0={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},C0=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function mx(st=new c.P(0,0),d="bottom"){if(typeof st=="number"){const _e=Math.round(Math.sqrt(.5*Math.pow(st,2)));switch(d){case"top":return new c.P(0,st);case"top-left":return new c.P(_e,_e);case"top-right":return new c.P(-_e,_e);case"bottom":return new c.P(0,-st);case"bottom-left":return new c.P(_e,-_e);case"bottom-right":return new c.P(-_e,-_e);case"left":return new c.P(st,0);case"right":return new c.P(-st,0)}return new c.P(0,0)}return st instanceof c.P||Array.isArray(st)?c.P.convert(st):c.P.convert(st[d]||[0,0])}return{version:dt,supported:Vt.supported,setRTLTextPlugin:c.fb,getRTLTextPluginStatus:c.fa,Map:class extends wv{constructor(st){Et.mark(ht.create);const d=st;if((st=Object.assign({},T2,st)).minZoom!=null&&st.maxZoom!=null&&st.minZoom>st.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(st.minPitch!=null&&st.maxPitch!=null&&st.minPitch>st.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(st.minPitch!=null&&st.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(st.maxPitch!=null&&st.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(st.antialias&&c.f3(window)&&(st.antialias=!1,c.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new ar(st.minZoom,st.maxZoom,st.minPitch,st.maxPitch,st.renderWorldCopies,null,null),st),this._repaint=!!st.repaint,this._interactive=st.interactive,this._minTileCacheSize=st.minTileCacheSize,this._maxTileCacheSize=st.maxTileCacheSize,this._failIfMajorPerformanceCaveat=st.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=st.preserveDrawingBuffer,this._antialias=st.antialias,this._trackResize=st.trackResize,this._bearingSnap=st.bearingSnap,this._refreshExpiredTiles=st.refreshExpiredTiles,this._fadeDuration=st.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=st.crossSourceCollisions,this._collectResourceTiming=st.collectResourceTiming,this._language=this._parseLanguage(st.language),this._worldview=st.worldview,this._renderTaskQueue=new um,this._domRenderTaskQueue=new um,this._controls=[],this._markers=[],this._popups=[],this._mapId=c.b2(),this._locale=Object.assign({},hm,st.locale),this._clickTolerance=st.clickTolerance,this._cooperativeGestures=st.cooperativeGestures,this._performanceMetricsCollection=st.performanceMetricsCollection,this._tessellationStep=st.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=st.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new dm(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=st.scaleFactor,this._requestManager=new fn(st.transformRequest,st.accessToken,st.testMode),this._silenceAuthErrors=!!st.testMode,this._contextCreateOptions=st.contextCreateOptions?Object.assign({},st.contextCreateOptions):{},typeof st.container=="string"){const _e=document.getElementById(st.container);if(!_e)throw new Error(`Container '${st.container.toString()}' not found.`);this._container=_e}else{if(!(st.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=st.container}if(this._container.childNodes.length>0&&c.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),st.maxBounds&&this.setMaxBounds(st.maxBounds),this._spriteFormat=st.spriteFormat,c.aY(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new A2(this,st),this._localFontFamily=st.localFontFamily,this._localIdeographFontFamily=st.localIdeographFontFamily,(st.style||!st.testMode)&&this.setStyle(st.style||c.e.DEFAULT_STYLE,{config:st.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),st.projection&&this.setProjection(st.projection),st.hash&&(this._hash=new dv(typeof st.hash=="string"&&st.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){d.center==null&&d.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:st.center,zoom:st.zoom,bearing:st.bearing,pitch:st.pitch});const _e=st.bounds;_e&&(this.resize(),this.fitBounds(_e,Object.assign({},st.fitBoundsOptions,{duration:0})))}this.resize(),st.attributionControl&&this.addControl(new k1({customAttribution:st.customAttribution})),this._logoControl=new F1,this.addControl(this._logoControl,st.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent(),this._postStyleWithAppearanceEvent(),this._setupIndoor()}),this.on("data",_e=>{this._update(_e.dataType==="style"),this.fire(new c.z(`${_e.dataType}data`,_e))}),this.on("dataloading",_e=>{this.fire(new c.z(`${_e.dataType}dataloading`,_e))}),this._interactions=new B0(this)}_getMapId(){return this._mapId}addControl(st,d){if(d===void 0&&(d=st.getDefaultPosition?st.getDefaultPosition():"top-right"),!st||!st.onAdd)return this.fire(new c.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const _e=st.onAdd(this);this._controls.push(st);const ot=this._controlPositions[d];return d.indexOf("bottom")!==-1?ot.insertBefore(_e,ot.firstChild):ot.appendChild(_e),this}removeControl(st){if(!st||!st.onRemove)return this.fire(new c.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const d=this._controls.indexOf(st);return d>-1&&this._controls.splice(d,1),st.onRemove(this),this}hasControl(st){return this._controls.indexOf(st)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(st){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const d=!this._moving;return d&&this.fire(new c.z("movestart",st)).fire(new c.z("move",st)),this.fire(new c.z("resize",st)),d&&this.fire(new c.z("moveend",st)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(st){return this.transform.setMaxBounds(c.aI.convert(st)),this._update()}setMinZoom(st){if((st=st??-2)>=-2&&st<=this.transform.maxZoom)return this.transform.minZoom=st,this._update(),this.getZoom()<st?this.setZoom(st):this.fire(new c.z("zoomstart")).fire(new c.z("zoom")).fire(new c.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(st){if((st=st??22)>=this.transform.minZoom)return this.transform.maxZoom=st,this._update(),this.getZoom()>st?this.setZoom(st):this.fire(new c.z("zoomstart")).fire(new c.z("zoom")).fire(new c.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(st){if((st=st??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(st>=0&&st<=this.transform.maxPitch)return this.transform.minPitch=st,this._update(),this.getPitch()<st?this.setPitch(st):this.fire(new c.z("pitchstart")).fire(new c.z("pitch")).fire(new c.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(st){if((st=st??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(st>=this.transform.minPitch)return this.transform.maxPitch=st,this._update(),this.getPitch()>st?this.setPitch(st):this.fire(new c.z("pitchstart")).fire(new c.z("pitch")).fire(new c.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(st){return this._scaleFactor=st,this.painter.scaleFactor=st,this._scaleFactorChanged=!0,this.style._updateFilteredLayers(d=>d.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(st){return this.transform.renderWorldCopies=st,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(st){return st==="auto"?navigator.language:Array.isArray(st)?st.length===0?void 0:st.map(d=>d==="auto"?navigator.language:d):st}setLanguage(st){const d=this._parseLanguage(st);if(!this.style||d===this._language)return this;this._language=d,this.style.reloadSources();for(const _e of this._controls)_e._setLanguage&&_e._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(st){return this.style&&st!==this._worldview?(this._worldview=st,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(st){return this._lazyInitEmptyStyle(),st?typeof st=="string"&&(st={name:st}):st=null,this._useExplicitProjection=!!st,this._prioritizeAndUpdateProjection(st,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const st=this.transform,d=st.projection.name;let _e;d==="globe"&&st.zoom>=c.cL?(st.setMercatorFromTransition(),_e=!0):d==="mercator"&&st.zoom<c.cL&&(st.setProjection({name:"globe"}),_e=!0),_e&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(st,d){return this._updateProjection(st||d||{name:"mercator"})}_updateProjection(st){let d;const _e=this.transform.mercatorFromTransition;d=st.name==="globe"&&this.transform.zoom>=c.cL?this.transform.setMercatorFromTransition():this.transform.setProjection(st),this.style.applyProjectionUpdate();const ot=this.transform.getProjection().name==="mercator"&&_e!==this.transform.mercatorFromTransition;return(d||ot)&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(st,d){return this.transform.locationPoint3D(c.aT.convert(st),d)}unproject(st,d){return this.transform.pointLocation3D(c.P.convert(st),d)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(st,d,_e){const ot=ut=>{let mt=[];if(Array.isArray(d)){const xt=d.filter(Tt=>this.getLayer(Tt));mt=xt.length?this.queryRenderedFeatures(ut,{layers:xt}):[]}else mt=this.queryRenderedFeatures(ut,{target:d});return mt};if(st==="mouseenter"||st==="mouseover"){let ut=!1;return{listener:_e,targets:d,delegates:{mousemove:xt=>{const Tt=ot(xt.point);Tt.length?ut||(ut=!0,_e.call(this,new Hp(st,this,xt.originalEvent,{features:Tt}))):ut=!1},mouseout:()=>{ut=!1}}}}if(st==="mouseleave"||st==="mouseout"){let ut=!1;return{listener:_e,targets:d,delegates:{mousemove:Tt=>{ot(Tt.point).length?ut=!0:ut&&(ut=!1,_e.call(this,new Hp(st,this,Tt.originalEvent)))},mouseout:Tt=>{ut&&(ut=!1,_e.call(this,new Hp(st,this,Tt.originalEvent)))}}}}{const ut=mt=>{const xt=ot(mt.point);xt.length&&(mt.features=xt,_e.call(this,mt),delete mt.features)};return{listener:_e,targets:d,delegates:{[st]:ut}}}}on(st,d,_e){if(typeof d=="function"||_e===void 0)return super.on(st,d);if(typeof d=="string"&&(d=[d]),!this._areTargetsValid(d))return this;const ot=this._createDelegatedListener(st,d,_e);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[st]=this._delegatedListeners[st]||[],this._delegatedListeners[st].push(ot);for(const ut in ot.delegates)this.on(ut,ot.delegates[ut]);return this}once(st,d,_e){if(typeof d=="function"||_e===void 0)return super.once(st,d);if(typeof d=="string"&&(d=[d]),!this._areTargetsValid(d))return this;const ot=this._createDelegatedListener(st,d,_e);for(const ut in ot.delegates)this.once(ut,ot.delegates[ut]);return this}off(st,d,_e){if(typeof d=="function"||_e===void 0)return super.off(st,d);if(typeof d=="string"&&(d=[d]),!this._areTargetsValid(d))return this;const ot=this._delegatedListeners?this._delegatedListeners[st]:void 0;return ot&&(ut=>{for(let mt=0;mt<ut.length;mt++){const xt=ut[mt];if(xt.listener===_e&&S2(xt.targets,d)){for(const Tt in xt.delegates)this.off(Tt,xt.delegates[Tt]);return ut.splice(mt,1),this}}})(ot),this}queryRenderedFeatures(st,d){if(!this.style)return[];if(st===void 0||st instanceof c.P||Array.isArray(st)||d!==void 0||(d=st,st=void 0),st=st||[[0,0],[this.transform.width,this.transform.height]],!d){const mt=this.style.queryRenderedFeatures(st,void 0,this.transform),xt=this.style.queryRenderedFeatureset(st,void 0,this.transform);return mt.concat(xt)}let _e=!0;if(d.target&&(_e=this._isTargetValid(d.target),_e&&!d.layers))return this.style.queryRenderedFeatureset(st,d,this.transform);let ot=!0;if(d.layers&&Array.isArray(d.layers)){for(const mt of d.layers)if(!this._isValidId(mt)){ot=!1;break}if(ot&&!d.target)return this.style.queryRenderedFeatures(st,d,this.transform)}let ut=[];return ot&&(ut=ut.concat(this.style.queryRenderedFeatures(st,d,this.transform))),_e&&(ut=ut.concat(this.style.queryRenderedFeatureset(st,d,this.transform))),ut}querySourceFeatures(st,d){return!st||typeof st=="string"&&!this._isValidId(st)?[]:this.style.querySourceFeatures(st,d)}queryRasterValue(st,d,_e){return this._isValidId(st)?this.style.queryRasterValue(st,d,_e):Promise.resolve(null)}isPointOnSurface(st){const{name:d}=this.transform.projection;return d!=="globe"&&d!=="mercator"&&c.w(`${d} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(c.P.convert(st))}addInteraction(st,d){return this._interactions.add(st,d),this}removeInteraction(st){return this._interactions.remove(st),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(st){return this._cooperativeGestures=st,this}setStyle(st,d){return d=Object.assign({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},d),this.style&&st&&d.diff!==!1&&d.localFontFamily===this._localFontFamily&&d.localIdeographFontFamily===this._localIdeographFontFamily&&!d.config?(this.style._diffStyle(st,(_e,ot)=>{if(_e){const ut=typeof _e=="string"?_e:_e instanceof Error?_e.message:_e.error;c.w(`Unable to perform style diff: ${ut}. Rebuilding the style from scratch.`),this._updateStyle(st,d)}else ot&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=d.localIdeographFontFamily,this._localFontFamily=d.localFontFamily,this._updateStyle(st,d))}_getUIString(st){const d=this._locale[st];if(d==null)throw new Error(`Missing UI string '${st}'`);return d}_updateStyle(st,d){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),st){const _e=Object.assign({},d);d&&d.config&&(_e.initialConfig=d.config,delete _e.config),this.style=new Zp(this,_e).load(st),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Zp(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(c.w("There is no style added to the map."),!1)}_isValidId(st){return st==null?(this.fire(new c.y(new Error("IDs can't be empty."))),!1):!c.dr(st)||(this.fire(new c.y(new Error(`IDs can't contain special symbols: "${st}".`))),!1)}_isTargetValid(st){return"featuresetId"in st?this._isValidId("importId"in st?st.importId:st.featuresetId):"layerId"in st&&this._isValidId(st.layerId)}_areTargetsValid(st){if(Array.isArray(st)){for(const d of st)if(!this._isValidId(d))return!1;return!0}return this._isTargetValid(st)}addSource(st,d){return this._isValidId(st)?(this._lazyInitEmptyStyle(),this.style.addSource(st,d),this._update(!0)):this}isSourceLoaded(st){return!!this._isValidId(st)&&!!this.style&&this.style._isSourceCacheLoaded(st)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(st,d,_e){this._lazyInitEmptyStyle(),this.style.addSourceType(st,d,_e)}removeSource(st){return this._isValidId(st)?(this.style.removeSource(st),this._updateTerrain(),this._update(!0)):this}getSource(st){return this._isValidId(st)?this.style.getOwnSource(st):null}addImage(st,d,{pixelRatio:_e=1,sdf:ot=!1,stretchX:ut,stretchY:mt,content:xt}={}){this._lazyInitEmptyStyle();const Tt=c.I.from(st);if(d instanceof HTMLImageElement||ImageBitmap&&d instanceof ImageBitmap){const{width:kt,height:$t,data:Xt}=c.o.getImageData(d);this.style.addImage(Tt,{data:new c.q({width:kt,height:$t},Xt),pixelRatio:_e,stretchX:ut,stretchY:mt,content:xt,sdf:ot,version:0,usvg:!1})}else if(d.width===void 0||d.height===void 0)this.fire(new c.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:kt,height:$t}=d,Xt=d;this.style.addImage(Tt,{data:new c.q({width:kt,height:$t},new Uint8Array(Xt.data)),pixelRatio:_e,stretchX:ut,stretchY:mt,content:xt,sdf:ot,usvg:!1,version:0,userImage:Xt}),Xt.onAdd&&Xt.onAdd(this,st)}}updateImage(st,d){this._lazyInitEmptyStyle();const _e=c.I.from(st),ot=this.style.getImage(_e);if(!ot)return void this.fire(new c.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const ut=d instanceof HTMLImageElement||ImageBitmap&&d instanceof ImageBitmap?c.o.getImageData(d):d,{width:mt,height:xt,data:Tt}=ut;if(mt===void 0||xt===void 0)return void this.fire(new c.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(mt!==(ot.usvg?ot.icon.usvg_tree.width:ot.data.width)||xt!==(ot.usvg?ot.icon.usvg_tree.height:ot.data.height))return void this.fire(new c.y(new Error(`The width and height of the updated image (${mt}, ${xt})
                must be that same as the previous version of the image
                (${ot.data.width}, ${ot.data.height})`)));const kt=!(d instanceof HTMLImageElement||ImageBitmap&&d instanceof ImageBitmap);let $t=!1;ot.usvg?(ot.data=new c.q({width:mt,height:xt},new Uint8Array(Tt)),ot.usvg=!1,ot.icon=void 0,$t=!0):ot.data.replace(Tt,kt),this.style.updateImage(_e,ot,$t)}hasImage(st){return st?!!this.style&&!!this.style.getImage(c.I.from(st)):(this.fire(new c.y(new Error("Missing required image id"))),!1)}removeImage(st){this.style.removeImage(c.I.from(st))}loadImage(st,d){c.n(this._requestManager.transformRequest(st,c.R.Image),(_e,ot)=>{d(_e,ot instanceof HTMLImageElement?c.o.getImageData(ot):ot)})}listImages(){return this.style.listImages().map(st=>st.name)}addModel(st,d){this._lazyInitEmptyStyle(),this.style.addModel(st,d)}hasModel(st){return st?this.style.hasModel(st):(this.fire(new c.y(new Error("Missing required model id"))),!1)}removeModel(st){this.style.removeModel(st)}listModels(){return this.style.listModels()}addLayer(st,d){return this._isValidId(st.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(st,d),this._update(!0)):this}getSlot(st){const d=this.getLayer(st);return d&&d.slot||null}setSlot(st,d){return this.style.setSlot(st,d),this.style.mergeLayers(),this._update(!0)}addImport(st,d){return this.style.addImport(st,d).catch(_e=>this.fire(new c.y(new Error("Failed to add import",_e)))),this}updateImport(st,d){return typeof d!="string"&&d.id!==st?(this.removeImport(st),this.addImport(d)):(this.style.updateImport(st,d),this._update(!0))}removeImport(st){return this.style.removeImport(st),this}moveImport(st,d){return this.style.moveImport(st,d),this._update(!0)}moveLayer(st,d){return this._isValidId(st)?(this.style.moveLayer(st,d),this._update(!0)):this}removeLayer(st){return this._isValidId(st)?(this.style.removeLayer(st),this._update(!0)):this}getLayer(st){if(!this._isValidId(st))return null;const d=this.style.getOwnLayer(st);return d?d.type==="custom"?d.implementation:d.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(st,d,_e){return this._isValidId(st)?(this.style.setLayerZoomRange(st,d,_e),this._update(!0)):this}setFilter(st,d,_e={}){return this._isValidId(st)?(this.style.setFilter(st,d,_e),this._update(!0)):this}getFilter(st){return this._isValidId(st)?this.style.getFilter(st):null}setPaintProperty(st,d,_e,ot={}){return this._isValidId(st)?(this.style.setPaintProperty(st,d,_e,ot),this._update(!0)):this}getPaintProperty(st,d){return this._isValidId(st)?this.style.getPaintProperty(st,d):null}setLayoutProperty(st,d,_e,ot={}){return this._isValidId(st)?(this.style.setLayoutProperty(st,d,_e,ot),this._update(!0)):this}getLayoutProperty(st,d){return this._isValidId(st)?this.style.getLayoutProperty(st,d):null}setLayerProperty(st,d,_e,ot={}){return this._isValidId(st)?(d==="appearances"&&this._postAddingAppearancesToStyleEvent(),this.style.setLayerProperty(st,d,_e,ot),this._update(!0)):this}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(st){return this.style.setGlyphsUrl(st),this._update(!0)}getSchema(st){return this.style.getSchema(st)}setSchema(st,d){return this.style.setSchema(st,d),this._update(!0)}getConfig(st){return this.style.getConfig(st)}setConfig(st,d){return this.style.setConfig(st,d),this._update(!0)}getConfigProperty(st,d){return this.style.getConfigProperty(st,d)}setConfigProperty(st,d,_e){return this.style.setConfigProperty(st,d,_e),this._update(!0)}getFeaturesetDescriptors(st){return this.style.getFeaturesetDescriptors(st)}setLights(st){if(this._lazyInitEmptyStyle(),st&&st.length===1&&st[0].type==="flat"){const d=st[0];d.properties?this.style.setFlatLight(d.properties,d.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(st),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const st=this.style.getLights()||[];return st.length===0&&st.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),st}setLight(st,d={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:st}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(st){return this._lazyInitEmptyStyle(),!st&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(st),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(st){return this._lazyInitEmptyStyle(),this.style.setFog(st),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(st){return this._lazyInitEmptyStyle(),this.style.setSnow(st),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(st){return this._lazyInitEmptyStyle(),this.style.setRain(st),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(st){return this._lazyInitEmptyStyle(),this.style.setColorTheme(st),this._update(!0)}setImportColorTheme(st,d){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(st,d),this._update(!0)}setCamera(st){return this.style.setCamera(st),this._triggerCameraUpdate(st)}_triggerCameraUpdate(st){return this._update(this.transform.setOrthographicProjectionAtLowPitch(st["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(st){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(c.aT.convert(st),this.transform):0}setFeatureState(st,d){return st.source&&!this._isValidId(st.source)?this:(this.style.setFeatureState(st,d),this._update())}removeFeatureState(st,d){return st.source&&!this._isValidId(st.source)?this:(this.style.removeFeatureState(st,d),this._update())}getFeatureState(st){return st.source&&!this._isValidId(st.source)?null:this.style.getFeatureState(st)}_selectIndoorFloor(st){this.indoor.selectFloor(st)}_setIndoorActiveFloorsVisibility(st){this.indoor.setActiveFloorsVisibility(st)}_addIndoorControl(){this._indoorControl||(this._indoorControl=new qx),this.addControl(this._indoorControl,"right")}_removeIndoorControl(){this._indoorControl&&this.removeControl(this._indoorControl)}_updateContainerDimensions(){if(!this._container)return;const st=this._container.getBoundingClientRect().width||400,d=this._container.getBoundingClientRect().height||300;let _e,ot,ut,mt=this._container;for(;mt&&(!ot||!ut);){const xt=window.getComputedStyle(mt).transform;xt&&xt!=="none"&&(_e=xt.match(/matrix.*\((.+)\)/)[1].split(", "),_e[0]&&_e[0]!=="0"&&_e[0]!=="1"&&(ot=_e[0]),_e[3]&&_e[3]!=="0"&&_e[3]!=="1"&&(ut=_e[3])),mt=mt.parentElement}this._containerWidth=ot?Math.abs(st/ot):st,this._containerHeight=ut?Math.abs(d/ut):d}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&c.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupIndoor(){this.style.isIndoorEnabled()&&(this.indoor=new ty(this.style),this.on("load",()=>{this._addIndoorControl(),this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds()),this.on("move",()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())}),this.on("idle",()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())})}))}_setupContainer(){const st=this._container;st.classList.add("mapboxgl-map"),(this._missingCSSCanary=Bt("div","mapboxgl-canary",st)).style.visibility="hidden",this._detectMissingCSS();const d=this._canvasContainer=Bt("div","mapboxgl-canvas-container",st);this._canvas=Bt("canvas","mapboxgl-canvas",d),this._interactive&&(d.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const _e=this._controlContainer=Bt("div","mapboxgl-control-container",st),ot=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(ut=>{ot[ut]=Bt("div",`mapboxgl-ctrl-${ut}`,_e)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(st,d){const _e=c.o.devicePixelRatio||1;this._canvas.width=_e*Math.ceil(st),this._canvas.height=_e*Math.ceil(d),this._canvas.style.width=`${st}px`,this._canvas.style.height=`${d}px`}_addMarker(st){this._markers.push(st)}_removeMarker(st){const d=this._markers.indexOf(st);d!==-1&&this._markers.splice(d,1)}_addPopup(st){this._popups.push(st)}_removePopup(st){const d=this._popups.indexOf(st);d!==-1&&this._popups.splice(d,1)}_setupPainter(){const st=Object.assign({},Vt.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),d=this._canvas.getContext("webgl2",st);d?(no(d,!0),this.painter=new Vy(d,this._contextCreateOptions,this.transform,this._scaleFactor,this._worldview),this.on("data",_e=>{_e.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),c.k.testSupport(d)):this.fire(new c.y(new Error("Failed to initialize WebGL")))}_contextLost(st){st.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new c.z("webglcontextlost",{originalEvent:st}))}_contextRestored(st){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new c.z("webglcontextrestored",{originalEvent:st}))}_onMapScroll(st){if(st.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(st){return this.style?(this._styleDirty=this._styleDirty||st,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(st){return this._update(),this._renderTaskQueue.add(st)}_cancelRenderFrame(st){this._renderTaskQueue.remove(st)}_requestDomTask(st){!this.loaded()||this.loaded()&&!this.isMoving()?st():this._domRenderTaskQueue.add(st)}_render(st){let d;this.fire(new c.z("renderstart")),++this._frameId;const _e=this.painter.context.extTimerQuery,ot=c.o.now(),ut=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(d=ut.createQuery(),ut.beginQuery(_e.TIME_ELAPSED_EXT,d)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(st),this._domRenderTaskQueue.run(st),this._removed)return;this._updateProjectionTransition();const mt=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const $t=this.transform.zoom,Xt=this.transform.pitch,rr=c.o.now(),tr=new c.ac($t,{now:rr,fadeDuration:mt,pitch:Xt,transition:this.style.transition,worldview:this._worldview});this.style.update(tr)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let xt=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),xt=this._updateAverageElevation(ot),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):xt=this._updateAverageElevation(ot);const Tt=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,mt,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),Tt&&(this._placementDirty=Tt.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:mt,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new c.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,Et.mark(ht.load),this.fire(new c.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),d){const $t=c.o.now()-ot;ut.endQuery(_e.TIME_ELAPSED_EXT),setTimeout(()=>{const Xt=ut.getQueryParameter(d,ut.QUERY_RESULT)/1e6;ut.deleteQuery(d),this.fire(new c.z("gpu-timing-frame",{cpuTime:$t,gpuTime:Xt}))},50)}if(this.listens("gpu-timing-layer")){const $t=this.painter.collectGpuTimers();setTimeout(()=>{const Xt=this.painter.queryGpuTimers($t);this.fire(new c.z("gpu-timing-layer",{layerTimes:Xt}))},50)}if(this.listens("gpu-timing-deferred-render")){const $t=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const Xt=this.painter.queryGpuTimeDeferredRender($t);this.fire(new c.z("gpu-timing-deferred-render",{gpuTime:Xt}))},50)}const kt=this._sourcesDirty||this._styleDirty||this._placementDirty||xt;if(kt||this._repaint)this.triggerRepaint();else{const $t=this.idle();if($t&&(xt=this._updateAverageElevation(ot,!0)),xt)this.triggerRepaint();else if(this._triggerFrame(!1),$t&&(this.fire(new c.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const Xt=this._calculateSpeedIndex();this.fire(new c.z("speedindexcompleted",{speedIndex:Xt})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||kt||(this._fullyLoaded=!0,Et.mark(ht.fullLoad),this._performanceMetricsCollection&&ys(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(st){for(const d of this._markers)st&&!this.getRenderWorldCopies()&&(d._lngLat=d._lngLat.wrap()),d._update();for(const d of this._popups)!st||this.getRenderWorldCopies()||d._trackPointer||(d._lngLat=d._lngLat.wrap()),d._update()}_updateAverageElevation(st,d=!1){const _e=ut=>(this.transform.averageElevation=ut,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&_e(0);const ot=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(ot||(d||st-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(st)){const ut=this.transform.averageElevation;let mt=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(mt)?mt=0:this._averageElevationLastSampledAt=st;const xt=Math.abs(ut-mt);if(xt>1){if(this._isInitialLoad||ot)return this._averageElevation.jumpTo(mt),_e(mt);this._averageElevation.easeTo(mt,st,300)}else if(xt>1e-4)return this._averageElevation.jumpTo(mt),_e(mt)}return!!this._averageElevation.isEasing(st)&&_e(this._averageElevation.getValue(st))}_authenticate(){Es(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,st=>{if(st&&(st.message===Jr||st.status===401)){const d=this.painter.context.gl;no(d,!1),this._logoControl instanceof F1&&this._logoControl._updateLogo(),d&&d.clear(d.DEPTH_BUFFER_BIT|d.COLOR_BUFFER_BIT|d.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new c.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),Fs(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&ms(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_postStyleWithAppearanceEvent(){this.style.globalId&&this.style.hasAppearances()&&ws(this._requestManager._customAccessToken)}_postAddingAppearancesToStyleEvent(){ks(this._requestManager._customAccessToken)}_updateTerrain(){const st=this._isDragging();this.painter.updateTerrain(this.style,st)}_calculateSpeedIndex(){const st=this.painter.canvasCopy(),d=this.painter.getCanvasCopiesAndTimestamps();d.timeStamps.push(performance.now());const _e=this.painter.context.gl,ot=_e.createFramebuffer();function ut(mt){_e.framebufferTexture2D(_e.FRAMEBUFFER,_e.COLOR_ATTACHMENT0,_e.TEXTURE_2D,mt,0);const xt=new Uint8Array(_e.drawingBufferWidth*_e.drawingBufferHeight*4);return _e.readPixels(0,0,_e.drawingBufferWidth,_e.drawingBufferHeight,_e.RGBA,_e.UNSIGNED_BYTE,xt),xt}return _e.bindFramebuffer(_e.FRAMEBUFFER,ot),this._canvasPixelComparison(ut(st),d.canvasCopies.map(ut),d.timeStamps)}_canvasPixelComparison(st,d,_e){let ot=_e[1]-_e[0];const ut=st.length/4;for(let mt=0;mt<d.length;mt++){const xt=d[mt];let Tt=0;for(let kt=0;kt<xt.length;kt+=4)xt[kt]===st[kt]&&xt[kt+1]===st[kt+1]&&xt[kt+2]===st[kt+2]&&xt[kt+3]===st[kt+3]&&(Tt+=1);ot+=(_e[mt+2]-_e[mt+1])*(1-Tt/ut)}return ot}remove(){this._hash&&this._hash.remove();for(const d of this._controls)d.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor&&this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const st=this.painter.context.gl.getExtension("WEBGL_lose_context");st&&st.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),po.delete(this.painter.context.gl),dn.remove(),Sn.remove(),this._removed=!0,this.fire(new c.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(st){this._renderNextFrame=this._renderNextFrame||st,this.style&&!this._frame&&(this._frame=c.o.frame(d=>{const _e=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,_e&&this._render(d)}))}_preloadTiles(st){const d=this.style?this.style.getSourceCaches():[];return c.bw(d,(_e,ot)=>_e._preloadTiles(st,ot),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(st){this._trackResize&&this.resize({originalEvent:st})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(st){this._showTileBoundaries!==st&&(this._showTileBoundaries=st,this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(st){this._showParseStatus!==st&&(this._showParseStatus=st,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(st){this._showTerrainWireframe!==st&&(this._showTerrainWireframe=st,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(st){this._showLayers2DWireframe!==st&&(this._showLayers2DWireframe=st,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(st){this._showLayers3DWireframe!==st&&(this._showLayers3DWireframe=st,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(st){this._speedIndexTiming!==st&&(this._speedIndexTiming=st,this._update())}get showPadding(){return!!this._showPadding}set showPadding(st){this._showPadding!==st&&(this._showPadding=st,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(st){this._showCollisionBoxes!==st&&(this._showCollisionBoxes=st,this.style&&st?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(st){this._showOverdrawInspector!==st&&(this._showOverdrawInspector=st,this._update())}get repaint(){return!!this._repaint}set repaint(st){this._repaint!==st&&(this._repaint=st,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(st){this._vertices=st,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(st){this._showTileAABBs!==st&&(this._showTileAABBs=st,st&&this._update())}_setCacheLimits(st,d){c.f4(st,d)}get version(){return dt}},NavigationControl:class{constructor(st={}){this.options=Object.assign({},R2,st),this._container=Bt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",d=>d.preventDefault()),this.options.showZoom&&(c.aY(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",d=>{this._map&&this._map.zoomIn({},{originalEvent:d})}),Bt("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",d=>{this._map&&this._map.zoomOut({},{originalEvent:d})}),Bt("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(c.aY(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",d=>{const _e=this._map;_e&&(this.options.visualizePitch?_e.resetNorthPitch({},{originalEvent:d}):_e.resetNorth({},{originalEvent:d}))}),this._compassIcon=Bt("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const st=this._map;if(!st)return;const d=st.getZoom(),_e=d===st.getMaxZoom(),ot=d===st.getMinZoom();this._zoomInButton.disabled=_e,this._zoomOutButton.disabled=ot,this._zoomInButton.setAttribute("aria-disabled",_e.toString()),this._zoomOutButton.setAttribute("aria-disabled",ot.toString())}_rotateCompassArrow(){const st=this._map;if(!st)return;const d=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(st.transform.pitch*(Math.PI/180)),.5)}) rotateX(${st.transform.pitch}deg) rotateZ(${st.transform.angle*(180/Math.PI)}deg)`:`rotate(${st.transform.angle*(180/Math.PI)}deg)`;st._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=d)})}onAdd(st){return this._map=st,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),st.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&st.on("pitch",this._rotateCompassArrow),st.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new I2(st,this._compass,this.options.visualizePitch)),this._container}onRemove(){const st=this._map;st&&(this._container.remove(),this.options.showZoom&&st.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&st.off("pitch",this._rotateCompassArrow),st.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(st,d){const _e=Bt("button",st,this._container);return _e.type="button",_e.addEventListener("click",d),_e}_setButtonTitle(st,d){if(!this._map)return;const _e=this._map._getUIString(`NavigationControl.${d}`);st.setAttribute("aria-label",_e),st.firstElementChild&&st.firstElementChild.setAttribute("title",_e)}},GeolocateControl:class extends c.E{constructor(st={}){super();const d=navigator.geolocation;this.options=Object.assign({geolocation:d},D2,st),c.aY(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Uy(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(st){return this._map=st,this._container=Bt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(st){const d=(_e=!!this.options.geolocation)=>{this._supportsGeolocation=_e,st(_e)};this._supportsGeolocation!==void 0?st(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(_e=>d(_e.state!=="denied")).catch(()=>d()):d()}_isOutOfMapMaxBounds(st){const d=this._map.getMaxBounds(),_e=st.coords;return!!d&&(_e.longitude<d.getWest()||_e.longitude>d.getEast()||_e.latitude<d.getSouth()||_e.latitude>d.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(st){if(this._map){if(this._isOutOfMapMaxBounds(st))return this._setErrorState(),this.fire(new c.z("outofmaxbounds",st)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=st,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(st),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(st),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new c.z("geolocate",Object.assign({coords:st.coords,timestamp:st.timestamp},st.toJSON?{toJSON:st.toJSON.bind(st)}:{}))),this._finish()}}_updateCamera(st){const d=new c.aT(st.coords.longitude,st.coords.latitude),_e=st.coords.accuracy,ot=this._map.getBearing(),ut=Object.assign({bearing:ot},this.options.fitBoundsOptions);this._map.fitBounds(d.toBounds(_e),ut,{geolocateSource:!0})}_updateMarker(st){if(st){const d=new c.aT(st.coords.longitude,st.coords.latitude);this._accuracyCircleMarker.setLngLat(d).addTo(this._map),this._userLocationDotMarker.setLngLat(d).addTo(this._map),this._accuracy=st.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const st=this._map.transform,d=c.cf(1,st._center.lat)*st.worldSize,_e=Math.ceil(2*this._accuracy*d);this._circleElement.style.width=`${_e}px`,this._circleElement.style.height=`${_e}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(st){if(this._map){if(this.options.trackUserLocation)if(st.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",d),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",d),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(st.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new c.z("error",st)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(st){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",d=>d.preventDefault()),this._geolocateButton=Bt("button","mapboxgl-ctrl-geolocate",this._container),Bt("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",st===!1){c.w("Geolocation support is not available so the GeolocateControl will be disabled.");const d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",d),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",d)}else{const d=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",d),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",d)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Bt("div","mapboxgl-user-location"),this._dotElement.appendChild(Bt("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Bt("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new t_({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Bt("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new t_({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",d=>{d.geolocateSource||this._watchState!=="ACTIVE_LOCK"||d.originalEvent&&d.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new c.z("trackuserlocationend")))})}}_onDeviceOrientation(st){this._userLocationDotMarker&&(st.webkitCompassHeading?this._heading=st.webkitCompassHeading:st.absolute===!0&&(this._heading=-1*st.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return c.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new c.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new c.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new c.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let st;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(st={maximumAge:6e5,timeout:0},this._noTimeout=!0):(st=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,st),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const st=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(d=>{d==="granted"&&st()}).catch(console.error):st()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:k1,ScaleControl:class{constructor(st={}){this.options=Object.assign({},Xx,st),c.aY(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const st=this.options.maxWidth||100,d=this._map,_e=d._containerHeight/2,ot=d._containerWidth/2-st/2,ut=d.unproject([ot,_e]),mt=d.unproject([ot+st,_e]),xt=ut.distanceTo(mt);if(this.options.unit==="imperial"){const Tt=3.2808*xt;Tt>5280?this._setScale(st,Tt/5280,"mile"):this._setScale(st,Tt,"foot")}else this.options.unit==="nautical"?this._setScale(st,xt/1852,"nautical-mile"):xt>=1e3?this._setScale(st,xt/1e3,"kilometer"):this._setScale(st,xt,"meter")}_setScale(st,d,_e){this._map._requestDomTask(()=>{const ot=function(mt){const xt=Math.pow(10,`${Math.floor(mt)}`.length-1);let Tt=mt/xt;return Tt=Tt>=10?10:Tt>=5?5:Tt>=3?3:Tt>=2?2:Tt>=1?1:function(kt){const $t=Math.pow(10,Math.ceil(-Math.log(kt)/Math.LN10));return Math.round(kt*$t)/$t}(Tt),xt*Tt}(d),ut=ot/d;this._container.innerHTML=_e!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:_e}).format(ot):`${ot}&nbsp;${Av[_e]}`,this._container.style.width=st*ut+"px"})}onAdd(st){return this._map=st,this._language=st.getLanguage(),this._container=Bt("div","mapboxgl-ctrl mapboxgl-ctrl-scale",st.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(st){this._language=st,this._update()}setUnit(st){this.options.unit=st,this._update()}},FullscreenControl:class{constructor(st={}){this._fullscreen=!1,st&&st.container&&(st.container instanceof HTMLElement?this._container=st.container:c.w("Full screen control 'container' must be a DOM element.")),c.aY(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(st){return this._map=st,this._container||(this._container=this._map.getContainer()),this._controlContainer=Bt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",c.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const st=this._fullscreenButton=Bt("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Bt("span","mapboxgl-ctrl-icon",st).setAttribute("aria-hidden","true"),st.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const st=this._getTitle();this._fullscreenButton.setAttribute("aria-label",st),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",st)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},IndoorControl:qx,Popup:class extends c.E{constructor(st){super(),this.options=Object.assign(Object.create(w0),st),this._altitude=this.options.altitude,c.aY(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(st&&st.className?st.className.trim().split(/\s+/):[])}addTo(st){return this._map&&this.remove(),this._map=st,this.options.closeOnClick&&st.on("preclick",this._onClose),this.options.closeOnMove&&st.on("move",this._onClose),st.on("remove",this.remove),this._update(),st._addPopup(this),this._focusFirstElement(),this._trackPointer?(st.on("mousemove",this._onMouseEvent),st.on("mouseup",this._onMouseEvent),st._canvasContainer.classList.add("mapboxgl-track-pointer")):st.on("move",this._update),this.fire(new c.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const st=this._map;return st&&(st.off("move",this._update),st.off("move",this._onClose),st.off("preclick",this._onClose),st.off("click",this._onClose),st.off("remove",this.remove),st.off("mousemove",this._onMouseEvent),st.off("mouseup",this._onMouseEvent),st.off("drag",this._onMouseEvent),st._canvasContainer&&st._canvasContainer.classList.remove("mapboxgl-track-pointer"),st._removePopup(this),this._map=void 0),this.fire(new c.z("close")),this}getLngLat(){return this._lngLat}setLngLat(st){this._lngLat=c.aT.convert(st),this._pos=null,this._trackPointer=!1,this._update();const d=this._map;return d&&(d.on("move",this._update),d.off("mousemove",this._onMouseEvent),d._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(st){return this._altitude=st,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const st=this._map;return st&&(st.off("move",this._update),st.on("mousemove",this._onMouseEvent),st.on("drag",this._onMouseEvent),st._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(st){return this.setDOMContent(document.createTextNode(st))}setHTML(st){const d=document.createDocumentFragment(),_e=document.createElement("body");let ot;for(_e.innerHTML=st;ot=_e.firstChild,ot;)d.appendChild(ot);return this.setDOMContent(d)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(st){return this.options.maxWidth=st,this._update(),this}setDOMContent(st){let d=this._content;if(d)for(;d.hasChildNodes();)d.firstChild&&d.removeChild(d.firstChild);else d=this._content=Bt("div","mapboxgl-popup-content",this._container||void 0);if(d.appendChild(st),this.options.closeButton){const _e=this._closeButton=Bt("button","mapboxgl-popup-close-button",d);_e.type="button",_e.setAttribute("aria-label","Close popup"),_e.innerHTML='<span aria-hidden="true">&#215;</span>',_e.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(st){return this._classList.add(st),this._updateClassList(),this}removeClassName(st){return this._classList.delete(st),this._updateClassList(),this}setOffset(st){return this.options.offset=st,this._update(),this}toggleClassName(st){let d;return this._classList.delete(st)?d=!1:(this._classList.add(st),d=!0),this._updateClassList(),d}_onMouseEvent(st){this._update(st.point)}_getAnchor(st){if(this.options.anchor)return this.options.anchor;const d=this._map,_e=this._container,ot=this._pos;if(!d||!_e||!ot)return"bottom";const ut=_e.offsetWidth,mt=_e.offsetHeight,xt=ot.x<ut/2,Tt=ot.x>d.transform.width-ut/2;if(ot.y+st<mt)return xt?"top-left":Tt?"top-right":"top";if(ot.y>d.transform.height-mt){if(xt)return"bottom-left";if(Tt)return"bottom-right"}return xt?"left":Tt?"right":"bottom"}_updateClassList(){const st=this._container;if(!st)return;const d=[...this._classList];d.push("mapboxgl-popup"),this._anchor&&d.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&d.push("mapboxgl-popup-track-pointer"),st.className=d.join(" ")}_update(st){const d=this._map,_e=this._content;if(!d||!this._lngLat&&!this._trackPointer||!_e)return;let ot=this._container;if(ot||(ot=this._container=Bt("div","mapboxgl-popup",d.getContainer()),this._tip=Bt("div","mapboxgl-popup-tip",ot),ot.appendChild(_e)),this.options.maxWidth&&ot.style.maxWidth!==this.options.maxWidth&&(ot.style.maxWidth=this.options.maxWidth),d.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Cv(this._lngLat,this._pos,d.transform)),!this._trackPointer||st){const ut=this._pos=this._trackPointer&&st instanceof c.P?st:d.project(this._lngLat,this._altitude),mt=mx(this.options.offset),xt=this._anchor=this._getAnchor(mt.y),Tt=mx(this.options.offset,xt),kt=ut.add(Tt).round();d._requestDomTask(()=>{this._container&&xt&&(this._container.style.transform=`${Ap[xt]} translate(${kt.x}px,${kt.y}px)`)})}if(!this._marker&&d._showingGlobe()){const ut=c.f5(d.transform,this._lngLat)?0:1;this._setOpacity(ut)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const st=this._container.querySelector(C0);st&&st.focus()}_onClose(){this.remove()}_setOpacity(st){this._container&&(this._container.style.opacity=`${st}`),this._content&&(this._content.style.pointerEvents=st?"auto":"none")}},Marker:t_,Style:Zp,LngLat:c.aT,LngLatBounds:c.aI,Point:c.P,MercatorCoordinate:c.ae,FreeCameraOptions:Ct,Evented:c.E,config:c.e,prewarm:c.f9,clearPrewarmedResources:c.f8,get accessToken(){return c.e.ACCESS_TOKEN},set accessToken(st){c.e.ACCESS_TOKEN=st},get baseApiUrl(){return c.e.API_URL},set baseApiUrl(st){c.e.API_URL=st},get workerCount(){return c.fi.workerCount},set workerCount(st){c.fi.workerCount=st},get maxParallelImageRequests(){return c.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(st){c.e.MAX_PARALLEL_IMAGE_REQUESTS=st},clearStorage(st){c.fh(st)},get workerUrl(){return c.fg.workerUrl},set workerUrl(st){c.fg.workerUrl=st},get workerClass(){return c.fg.workerClass},set workerClass(st){c.fg.workerClass=st},get workerParams(){return c.fg.workerParams},set workerParams(st){c.fg.workerParams=st},get dracoUrl(){return c.ff()},set dracoUrl(st){c.fe(st)},get meshoptUrl(){return c.fd()},set meshoptUrl(st){c.fc(st)},setNow:c.o.setNow,restoreNow:c.o.restoreNow}});var rt=_;return rt})})(mapboxGl);var mapboxGlExports=mapboxGl.exports;const mapboxgl=getDefaultExportFromCjs(mapboxGlExports);function useFranchises(){const[e,i]=reactExports.useState([]),[s,a]=reactExports.useState(!0),[_,$]=reactExports.useState(null);return reactExports.useEffect(()=>{const rt=ref(database,"franchises"),c=onValue(rt,dt=>{try{const ht=dt.val();if(ht){const Et=Object.entries(ht).map(([St,At])=>({...At,id:St}));i(Et)}else i([]);a(!1)}catch{$("Failed to fetch franchises"),a(!1)}});return()=>c()},[]),{franchises:e,loading:s,error:_}}function useFranchise(e){const[i,s]=reactExports.useState(null),[a,_]=reactExports.useState(!0),[$,rt]=reactExports.useState(null);return reactExports.useEffect(()=>{if(!e){_(!1);return}const c=ref(database,`franchises/${e}`),dt=onValue(c,ht=>{try{const Et=ht.val();s(Et?{...Et,id:e}:null),_(!1)}catch{rt("Failed to fetch franchise"),_(!1)}});return()=>dt()},[e]),{franchise:i,loading:a,error:$}}function useAllUsersForAdmin(){const[e,i]=reactExports.useState([]),[s,a]=reactExports.useState(!0),[_,$]=reactExports.useState(0),rt=reactExports.useCallback(()=>{$(c=>c+1)},[]);return reactExports.useEffect(()=>{const c=ref(database,"users"),dt=onValue(c,ht=>{const Et=ht.val();if(Et){const St=Object.entries(Et).map(([At,Pt])=>({...Pt,id:At}));i(St)}else i([]);a(!1)});return()=>dt()},[_]),{users:e,loading:s,refetch:rt}}async function createFranchise(e){try{const i=ref(database,"franchises"),s=push(i);return await set(s,e),e.adminId&&await update(ref(database,`users/${e.adminId}`),{role:"franchise_admin",franchiseId:s.key}),s.key}catch(i){return console.error("Error creating franchise:",i),null}}async function deleteFranchise(e,i){i&&await update(ref(database,`users/${i}`),{role:"user",franchiseId:null});const s=ref(database,`franchises/${e}`);await remove(s)}async function createFranchiseAdmin(e,i,s,a){try{const _=await createUserWithEmailAndPassword(auth,e,i),$={id:_.user.uid,email:e,name:s,phone:a,role:"franchise_admin",createdAt:Date.now()};return await set(ref(database,`users/${_.user.uid}`),$),_.user.uid}catch(_){throw _.code==="auth/email-already-in-use"?new Error("Email already in use"):_}}function FranchiseZoneLocationPicker({onLocationSelect:e,initialLocation:i,label:s="Kitchen Location",instructions:a="Select location within green zone",fullScreen:_=!1,showZoomControls:$=!0}){var un;const rt=reactExports.useRef(null),c=reactExports.useRef(null),dt=reactExports.useRef(null),[ht,Et]=reactExports.useState(!0),[St,At]=reactExports.useState(!1),[Pt,Vt]=reactExports.useState("Tap on map to select location"),[Bt,Zt]=reactExports.useState(!1),[zt,Ut]=reactExports.useState(null),{franchises:Nt,loading:Gt}=useFranchises(),er=async(jr,Jr)=>{try{const Fr=await(await fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${Jr},${jr}.json?access_token=${MAPBOX_ACCESS_TOKEN}&types=address,place,postcode`)).json();if(Fr.features&&Fr.features.length>0){const Cr=Fr.features[0].place_name,Sr=Cr.split(",").map(dr=>dr.trim());return Sr.length>=5?Sr.slice(2).join(", "):Cr}return"Unknown location"}catch(fn){return console.error("Geocoding error:",fn),"Unknown location"}},ir=(jr,Jr)=>{for(const fn of Nt)if(fn.zone&&isPointInPolygon({lat:jr,lng:Jr},fn.zone))return{isInZone:!0,franchiseId:fn.id};return{isInZone:!1,franchiseId:null}},or=async jr=>{if(!c.current)return;At(!0);const{isInZone:Jr,franchiseId:fn}=ir(jr.lat,jr.lng);Zt(!Jr),Ut(fn),dt.current?dt.current.setLngLat([jr.lng,jr.lat]):(dt.current=new mapboxgl.Marker({color:"#f97316",draggable:!0}).setLngLat([jr.lng,jr.lat]).addTo(c.current),dt.current.on("dragend",async()=>{var Sr;const Cr=(Sr=dt.current)==null?void 0:Sr.getLngLat();if(Cr){At(!0);const{isInZone:dr,franchiseId:gr}=ir(Cr.lat,Cr.lng);Zt(!dr),Ut(gr);const qr=await er(Cr.lat,Cr.lng);Vt(qr),e({lat:Cr.lat,lng:Cr.lng,address:qr,franchiseId:dr?gr:null}),At(!1)}}));const Fr=await er(jr.lat,jr.lng);Vt(Fr),e({lat:jr.lat,lng:jr.lng,address:Fr,franchiseId:Jr?fn:null}),At(!1)},mr=()=>{"geolocation"in navigator&&(At(!0),navigator.geolocation.getCurrentPosition(async jr=>{const{latitude:Jr,longitude:fn}=jr.coords;c.current&&c.current.flyTo({center:[fn,Jr],zoom:14,duration:1500}),await or({lat:Jr,lng:fn})},jr=>{console.error("Location error:",jr),At(!1)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:6e4}))},Rr=()=>{!c.current||Nt.length===0||Nt.forEach((jr,Jr)=>{if(!jr.zone||!c.current)return;const fn=`franchise-zone-${jr.id}`,Fr=`franchise-zone-fill-${jr.id}`,Cr=`franchise-zone-line-${jr.id}`;c.current.getLayer(Fr)&&c.current.removeLayer(Fr),c.current.getLayer(Cr)&&c.current.removeLayer(Cr),c.current.getSource(fn)&&c.current.removeSource(fn),c.current.addSource(fn,{type:"geojson",data:{type:"Feature",properties:{name:jr.name},geometry:jr.zone}}),c.current.addLayer({id:Fr,type:"fill",source:fn,paint:{"fill-color":"#22c55e","fill-opacity":.15}}),c.current.addLayer({id:Cr,type:"line",source:fn,paint:{"line-color":"#22c55e","line-width":2,"line-dasharray":[2,2]}})})};reactExports.useEffect(()=>{if(!rt.current||Gt)return;mapboxgl.accessToken=MAPBOX_ACCESS_TOKEN;let jr=[78.4867,17.385];if(i)jr=[i.lng,i.lat];else if(Nt.length>0&&Nt[0].zone){const Jr=getPolygonCenter(Nt[0].zone);Jr&&(jr=[Jr.lng,Jr.lat])}return c.current=new mapboxgl.Map({container:rt.current,style:"mapbox://styles/mapbox/streets-v12",center:jr,zoom:12,attributionControl:!1}),c.current.on("load",()=>{Et(!1),Rr(),i&&or({lat:i.lat,lng:i.lng})}),c.current.on("click",async Jr=>{await or({lat:Jr.lngLat.lat,lng:Jr.lngLat.lng})}),$&&c.current.addControl(new mapboxgl.NavigationControl({showCompass:!1}),"bottom-right"),()=>{var Jr;(Jr=c.current)==null||Jr.remove()}},[Gt,Nt]),reactExports.useEffect(()=>{c.current&&!ht&&Nt.length>0&&Rr()},[Nt,ht]);const on=zt?(un=Nt.find(jr=>jr.id===zt))==null?void 0:un.name:null;return jsxRuntimeExports.jsxs("div",{className:`flex flex-col ${_?"absolute inset-0":"space-y-3 h-full"}`,children:[jsxRuntimeExports.jsxs("div",{className:`relative overflow-hidden ${_?"flex-1 w-full h-full":"rounded-xl flex-1 min-h-[435px]"}`,children:[jsxRuntimeExports.jsx("div",{ref:rt,className:"absolute inset-0",style:{marginBottom:"-30px",height:"calc(100% + 30px)"}}),(ht||Gt)&&jsxRuntimeExports.jsx("div",{className:"absolute inset-0 bg-secondary flex items-center justify-center z-10",children:jsxRuntimeExports.jsx(LoaderCircle,{className:"w-6 h-6 animate-spin text-primary"})}),jsxRuntimeExports.jsx(Button,{size:"icon",variant:"secondary",className:`absolute right-3 rounded-full shadow-md z-10 ${_?"top-safe-offset":"top-3"}`,style:{top:_?"1rem":void 0},onClick:mr,children:jsxRuntimeExports.jsx(Navigation,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx("div",{className:`absolute left-3 bg-card/90 backdrop-blur-sm rounded-lg px-3 py-1.5 z-10 ${_?"top-safe-offset":"top-3"}`,style:{top:_?"1rem":void 0},children:jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:a})}),!_&&jsxRuntimeExports.jsxs("div",{className:"absolute bottom-3 left-3 bg-card/90 backdrop-blur-sm rounded-lg px-3 py-1.5 flex items-center gap-2 z-10",children:[jsxRuntimeExports.jsx("div",{className:"w-3 h-3 rounded-sm bg-green-500/30 border border-green-500"}),jsxRuntimeExports.jsx("span",{className:"text-xs text-muted-foreground",children:"Service Area"})]})]}),jsxRuntimeExports.jsxs("div",{className:`${_?"absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-background/80 to-transparent pt-12":"space-y-3"}`,children:[Bt&&jsxRuntimeExports.jsxs("div",{className:`bg-destructive/10 border border-destructive/20 p-3 flex items-start gap-3 ${_?"rounded-xl mb-3 bg-background/95 backdrop-blur-sm":"rounded-xl"}`,children:[jsxRuntimeExports.jsx(TriangleAlert,{className:"w-5 h-5 text-destructive flex-shrink-0 mt-0.5"}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-destructive",children:"Outside Service Area"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Please select a location within the green zone."})]})]}),jsxRuntimeExports.jsxs("div",{className:`p-3 flex items-start gap-3 ${_?"rounded-xl bg-background/95 backdrop-blur-sm shadow-sm border border-border/50":`rounded-xl ${Bt?"bg-muted":"bg-secondary"}`}`,children:[jsxRuntimeExports.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 ${Bt?"bg-muted-foreground/10":"bg-primary/10"}`,children:St?jsxRuntimeExports.jsx(LoaderCircle,{className:"w-4 h-4 text-primary animate-spin"}):jsxRuntimeExports.jsx(MapPin,{className:`w-4 h-4 ${Bt?"text-muted-foreground":"text-primary"}`})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:s}),jsxRuntimeExports.jsx("p",{className:`text-sm font-medium break-words leading-tight ${Bt?"text-muted-foreground":"text-foreground"}`,children:St?"Finding address...":Pt}),on&&!Bt&&jsxRuntimeExports.jsxs("p",{className:"text-xs text-green-600 mt-1",children:[" ",on," zone"]})]})]})]})]})}function RegisterKitchen(){const{user:e}=useAuth(),i=useNavigate(),[s,a]=reactExports.useState(!1),[_,$]=reactExports.useState(null),[rt,c]=reactExports.useState(null),[dt,ht]=reactExports.useState(null),[Et,St]=reactExports.useState({name:"",description:"",specialties:"",cookingTime:"20-30 mins",isVeg:!0,address:{line1:"",line2:"",city:"",pincode:"",lat:0,lng:0}}),At=Vt=>{var Zt;const Bt=(Zt=Vt.target.files)==null?void 0:Zt[0];if(Bt){$(Bt);const zt=new FileReader;zt.onloadend=()=>{c(zt.result)},zt.readAsDataURL(Bt)}},Pt=async Vt=>{if(Vt.preventDefault(),!e){ue.error("Please login first");return}if(!Et.name||!Et.address.line1||!dt){ue.error("Please fill in all required fields and select location within service area");return}a(!0);try{let Bt="https://images.unsplash.com/photo-1556909114-f6e7ad7d3136?w=400";if(_){const Zt=await uploadToImgBB(_);Zt&&(Bt=Zt.display_url)}await createKitchen({ownerId:e.id,franchiseId:dt,name:Et.name,description:Et.description,image:Bt,coverImage:Bt,address:Et.address,rating:0,totalRatings:0,isOpen:!1,specialties:Et.specialties.split(",").map(Zt=>Zt.trim()).filter(Boolean),cookingTime:Et.cookingTime,isVeg:Et.isVeg,isApproved:!1,createdAt:Date.now()}),ue.success("Kitchen registered! Waiting for admin approval."),i("/amma/dashboard")}catch(Bt){console.error("Registration failed:",Bt),ue.error("Failed to register kitchen")}finally{a(!1)}};return!e||e.role!=="amma"?jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background flex flex-col items-center justify-center px-4",children:[jsxRuntimeExports.jsx("p",{className:"text-muted-foreground mb-4",children:"You need to be registered as an Amma"}),jsxRuntimeExports.jsx(Link,{to:"/auth",children:jsxRuntimeExports.jsx(Button,{className:"gradient-primary text-primary-foreground",children:"Login as Amma"})})]}):jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-24",children:[jsxRuntimeExports.jsx("header",{className:"sticky top-0 z-40 bg-card/95 backdrop-blur-lg border-b border-border",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-4 px-4 py-4",children:[jsxRuntimeExports.jsx(Link,{to:"/amma/dashboard",children:jsxRuntimeExports.jsx(motion.div,{whileTap:{scale:.9},className:"w-10 h-10 rounded-full bg-secondary flex items-center justify-center",children:jsxRuntimeExports.jsx(ArrowLeft,{className:"w-5 h-5"})})}),jsxRuntimeExports.jsx("h1",{className:"font-semibold text-foreground",children:"Register Kitchen"})]})}),jsxRuntimeExports.jsxs("form",{onSubmit:Pt,className:"px-4 py-6 space-y-6",children:[jsxRuntimeExports.jsx("div",{className:"flex justify-center",children:jsxRuntimeExports.jsxs("label",{className:"cursor-pointer",children:[jsxRuntimeExports.jsx("div",{className:"w-32 h-32 rounded-2xl bg-secondary flex items-center justify-center overflow-hidden",children:rt?jsxRuntimeExports.jsx("img",{src:rt,alt:"Preview",className:"w-full h-full object-cover"}):jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx(Camera,{className:"w-8 h-8 text-muted-foreground mx-auto mb-1"}),jsxRuntimeExports.jsx("span",{className:"text-xs text-muted-foreground",children:"Add Photo"})]})}),jsxRuntimeExports.jsx("input",{type:"file",accept:"image/*",onChange:At,className:"hidden"})]})}),jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Label$1,{children:"Kitchen Name *"}),jsxRuntimeExports.jsx(Input,{placeholder:"e.g., Lakshmi Amma's Kitchen",value:Et.name,onChange:Vt=>St({...Et,name:Vt.target.value}),className:"bg-secondary border-0 mt-1"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Label$1,{children:"Description"}),jsxRuntimeExports.jsx(Textarea,{placeholder:"Tell customers about your kitchen and cooking style...",value:Et.description,onChange:Vt=>St({...Et,description:Vt.target.value}),className:"bg-secondary border-0 mt-1 resize-none",rows:3})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Label$1,{children:"Specialties (comma separated)"}),jsxRuntimeExports.jsx(Input,{placeholder:"e.g., Biryani, Andhra Meals, Pickles",value:Et.specialties,onChange:Vt=>St({...Et,specialties:Vt.target.value}),className:"bg-secondary border-0 mt-1"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Label$1,{children:"Cooking Time"}),jsxRuntimeExports.jsx(Input,{placeholder:"e.g., 20-30 mins",value:Et.cookingTime,onChange:Vt=>St({...Et,cookingTime:Vt.target.value}),className:"bg-secondary border-0 mt-1"})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between bg-secondary rounded-xl p-4",children:[jsxRuntimeExports.jsx(Label$1,{htmlFor:"veg-switch",children:"Pure Vegetarian Kitchen"}),jsxRuntimeExports.jsx(Switch,{id:"veg-switch",checked:Et.isVeg,onCheckedChange:Vt=>St({...Et,isVeg:Vt})})]})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("h3",{className:"font-semibold text-foreground flex items-center gap-2",children:[jsxRuntimeExports.jsx(MapPin,{className:"w-4 h-4"})," Kitchen Location"]}),jsxRuntimeExports.jsx(FranchiseZoneLocationPicker,{onLocationSelect:Vt=>{var zt;ht(Vt.franchiseId);const Bt=Vt.address.split(","),Zt=Bt.length>1?(zt=Bt[Bt.length-2])==null?void 0:zt.trim():"";St({...Et,address:{...Et.address,line1:Vt.address,city:Zt||Et.address.city,lat:Vt.lat,lng:Vt.lng}})}}),jsxRuntimeExports.jsx(Input,{placeholder:"Additional address details (optional)",value:Et.address.line2,onChange:Vt=>St({...Et,address:{...Et.address,line2:Vt.target.value}}),className:"bg-secondary border-0"}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[jsxRuntimeExports.jsx(Input,{placeholder:"City",value:Et.address.city,onChange:Vt=>St({...Et,address:{...Et.address,city:Vt.target.value}}),className:"bg-secondary border-0"}),jsxRuntimeExports.jsx(Input,{placeholder:"Pincode",value:Et.address.pincode,onChange:Vt=>St({...Et,address:{...Et.address,pincode:Vt.target.value}}),className:"bg-secondary border-0"})]})]}),jsxRuntimeExports.jsx(Button,{type:"submit",disabled:s,className:"w-full gradient-primary text-primary-foreground py-6 rounded-xl",children:s?jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx(LoaderCircle,{className:"w-5 h-5 animate-spin"}),jsxRuntimeExports.jsx("span",{children:"Registering..."})]}):"Register Kitchen"})]})]})}const categories=["Biryani","Meals","Curries","Tiffin","Dosa","Sweets","Snacks","Beverages","Starters","Desserts"],prepTimes=["10-15 mins","15-30 mins","30-45 mins","45-60 mins","1 hr+"],servingSizes=["1 person","2 people","4 people","Family Pack"],commonTags=["Spicy","Sweet","Vegan","Gluten Free","Best Seller","Kids Special","Healthy","Traditional"];function AddDish(){const{user:e}=useAuth(),i=useNavigate(),{dishId:s}=useParams(),{kitchens:a}=useAmmaKitchens(e==null?void 0:e.id),[_,$]=reactExports.useState(!1),[rt,c]=reactExports.useState(!!s),[dt,ht]=reactExports.useState(null),[Et,St]=reactExports.useState(null),[At,Pt]=reactExports.useState({kitchenId:"",name:"",description:"",price:"",originalPrice:"",category:"Meals",preparationTime:"15-30 mins",servingSize:"1 person",isVeg:!0,isAvailable:!0,tags:[]});reactExports.useEffect(()=>{(async()=>{var Ut;if(s)try{const Nt=await get(ref(database,`dishes/${s}`));if(Nt.exists()){const Gt=Nt.val();Pt({kitchenId:Gt.kitchenId,name:Gt.name,description:Gt.description,price:Gt.price.toString(),originalPrice:((Ut=Gt.originalPrice)==null?void 0:Ut.toString())||"",category:Gt.category,preparationTime:Gt.preparationTime||"15-30 mins",servingSize:Gt.servingSize||"1 person",isVeg:Gt.isVeg,isAvailable:Gt.isAvailable,tags:Gt.tags||[]}),St(Gt.image)}else ue.error("Dish not found"),i("/amma/dashboard")}catch(Nt){console.error("Error fetching dish:",Nt),ue.error("Failed to load dish details")}finally{c(!1)}})()},[s,i]);const Vt=zt=>{var Nt;const Ut=(Nt=zt.target.files)==null?void 0:Nt[0];if(Ut){ht(Ut);const Gt=new FileReader;Gt.onloadend=()=>{St(Gt.result)},Gt.readAsDataURL(Ut)}},Bt=zt=>{Pt(Ut=>({...Ut,tags:Ut.tags.includes(zt)?Ut.tags.filter(Nt=>Nt!==zt):[...Ut.tags,zt]}))},Zt=async zt=>{var Nt;zt.preventDefault();const Ut=At.kitchenId||((Nt=a[0])==null?void 0:Nt.id);if(!Ut){ue.error("No kitchen found. Please register your kitchen first.");return}if(!At.name||!At.price){ue.error("Please fill in all required fields");return}$(!0);try{let Gt=Et||"https://images.unsplash.com/photo-1546069901-ba9599a7e63c?w=400";if(dt){const ir=await uploadToImgBB(dt);ir&&(Gt=ir.display_url)}const er={name:At.name,description:At.description,image:Gt,price:parseFloat(At.price),originalPrice:At.originalPrice?parseFloat(At.originalPrice):void 0,isVeg:At.isVeg,isAvailable:At.isAvailable,category:At.category,tags:At.tags,preparationTime:At.preparationTime,servingSize:At.servingSize};s?(await updateDish(s,er),ue.success("Dish updated successfully!")):(await createDish({...er,kitchenId:Ut}),ue.success("Dish added successfully!")),i("/amma/dashboard")}catch(Gt){console.error("Failed to save dish:",Gt),ue.error("Failed to save dish")}finally{$(!1)}};return rt?jsxRuntimeExports.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:jsxRuntimeExports.jsx(LoaderCircle,{className:"w-8 h-8 animate-spin text-primary"})}):!e||e.role!=="amma"?jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background flex flex-col items-center justify-center px-4",children:[jsxRuntimeExports.jsx("p",{className:"text-muted-foreground mb-4",children:"You need to be registered as an Amma"}),jsxRuntimeExports.jsx(Link,{to:"/auth",children:jsxRuntimeExports.jsx(Button,{className:"gradient-primary text-primary-foreground",children:"Login as Amma"})})]}):jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-24",children:[jsxRuntimeExports.jsx("header",{className:"sticky top-0 z-40 bg-card/95 backdrop-blur-lg border-b border-border",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-4 px-4 py-4",children:[jsxRuntimeExports.jsx(Link,{to:"/amma/dashboard",children:jsxRuntimeExports.jsx(motion.div,{whileTap:{scale:.9},className:"w-10 h-10 rounded-full bg-secondary flex items-center justify-center",children:jsxRuntimeExports.jsx(ArrowLeft,{className:"w-5 h-5"})})}),jsxRuntimeExports.jsx("h1",{className:"font-semibold text-foreground",children:s?"Edit Dish":"Add New Dish"})]})}),jsxRuntimeExports.jsxs("form",{onSubmit:Zt,className:"px-4 py-6 space-y-6",children:[jsxRuntimeExports.jsx("div",{className:"flex justify-center",children:jsxRuntimeExports.jsxs("label",{className:"cursor-pointer group relative",children:[jsxRuntimeExports.jsx("div",{className:"w-40 h-40 rounded-2xl bg-secondary flex items-center justify-center overflow-hidden border-2 border-dashed border-border group-hover:border-primary transition-colors",children:Et?jsxRuntimeExports.jsx("img",{src:Et,alt:"Preview",className:"w-full h-full object-cover"}):jsxRuntimeExports.jsxs("div",{className:"text-center p-4",children:[jsxRuntimeExports.jsx(Camera,{className:"w-8 h-8 text-muted-foreground mx-auto mb-2"}),jsxRuntimeExports.jsx("span",{className:"text-xs text-muted-foreground block",children:"Tap to take photo"})]})}),jsxRuntimeExports.jsx("input",{type:"file",accept:"image/*",capture:"environment",onChange:Vt,className:"hidden"}),jsxRuntimeExports.jsx("div",{className:"absolute -bottom-2 -right-2 bg-primary text-primary-foreground p-2 rounded-full shadow-lg",children:jsxRuntimeExports.jsx(Camera,{className:"w-4 h-4"})})]})}),jsxRuntimeExports.jsxs("div",{className:"space-y-6",children:[jsxRuntimeExports.jsxs("section",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Label$1,{children:"Dish Name *"}),jsxRuntimeExports.jsx(Input,{placeholder:"e.g., Chicken Biryani",value:At.name,onChange:zt=>Pt({...At,name:zt.target.value}),className:"bg-secondary border-0 mt-1"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Label$1,{children:"Description"}),jsxRuntimeExports.jsx(Textarea,{placeholder:"Describe your dish...",value:At.description,onChange:zt=>Pt({...At,description:zt.target.value}),className:"bg-secondary border-0 mt-1 resize-none",rows:2})]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Label$1,{children:"Price () *"}),jsxRuntimeExports.jsx(Input,{type:"number",placeholder:"180",value:At.price,onChange:zt=>Pt({...At,price:zt.target.value}),className:"bg-secondary border-0 mt-1"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Label$1,{children:"Original Price ()"}),jsxRuntimeExports.jsx(Input,{type:"number",placeholder:"220",value:At.originalPrice,onChange:zt=>Pt({...At,originalPrice:zt.target.value}),className:"bg-secondary border-0 mt-1"})]})]})]}),jsxRuntimeExports.jsxs("section",{children:[jsxRuntimeExports.jsx(Label$1,{className:"mb-2 block",children:"Category"}),jsxRuntimeExports.jsx("div",{className:"grid grid-cols-3 gap-2",children:categories.map(zt=>jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>Pt({...At,category:zt}),className:cn("py-2 px-1 rounded-lg text-xs font-medium border transition-all truncate",At.category===zt?"bg-primary text-primary-foreground border-primary shadow-sm":"bg-card border-border text-muted-foreground hover:bg-secondary"),children:zt},zt))})]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-1 gap-6",children:[jsxRuntimeExports.jsxs("section",{children:[jsxRuntimeExports.jsx(Label$1,{className:"mb-2 block",children:"Preparation Time"}),jsxRuntimeExports.jsx("div",{className:"flex flex-wrap gap-2",children:prepTimes.map(zt=>jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>Pt({...At,preparationTime:zt}),className:cn("py-1.5 px-3 rounded-full text-xs font-medium border transition-all",At.preparationTime===zt?"bg-accent text-accent-foreground border-accent":"bg-secondary border-transparent text-muted-foreground"),children:zt},zt))})]}),jsxRuntimeExports.jsxs("section",{children:[jsxRuntimeExports.jsx(Label$1,{className:"mb-2 block",children:"Serving Size"}),jsxRuntimeExports.jsx("div",{className:"flex flex-wrap gap-2",children:servingSizes.map(zt=>jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>Pt({...At,servingSize:zt}),className:cn("py-1.5 px-3 rounded-full text-xs font-medium border transition-all",At.servingSize===zt?"bg-blue-500 text-white border-blue-500":"bg-secondary border-transparent text-muted-foreground"),children:zt},zt))})]})]}),jsxRuntimeExports.jsxs("section",{children:[jsxRuntimeExports.jsx(Label$1,{className:"mb-2 block",children:"Tags"}),jsxRuntimeExports.jsx("div",{className:"flex flex-wrap gap-2",children:commonTags.map(zt=>jsxRuntimeExports.jsxs("button",{type:"button",onClick:()=>Bt(zt),className:cn("py-1.5 px-3 rounded-full text-xs font-medium border transition-all flex items-center gap-1",At.tags.includes(zt)?"bg-gold text-white border-gold":"bg-secondary border-transparent text-muted-foreground"),children:[At.tags.includes(zt)&&jsxRuntimeExports.jsx(Check,{className:"w-3 h-3"}),zt]},zt))})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-3 pt-2",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between bg-secondary rounded-xl p-4",children:[jsxRuntimeExports.jsx(Label$1,{htmlFor:"veg-dish",children:"Vegetarian"}),jsxRuntimeExports.jsx(Switch,{id:"veg-dish",checked:At.isVeg,onCheckedChange:zt=>Pt({...At,isVeg:zt})})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between bg-secondary rounded-xl p-4",children:[jsxRuntimeExports.jsx(Label$1,{htmlFor:"available",children:"Available Now"}),jsxRuntimeExports.jsx(Switch,{id:"available",checked:At.isAvailable,onCheckedChange:zt=>Pt({...At,isAvailable:zt})})]})]})]}),jsxRuntimeExports.jsx(Button,{type:"submit",disabled:_,className:"w-full gradient-primary text-primary-foreground py-6 rounded-xl text-base font-semibold shadow-lg",children:_?jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx(LoaderCircle,{className:"w-5 h-5 animate-spin"}),jsxRuntimeExports.jsx("span",{children:s?"Updating...":"Adding..."})]}):s?"Update Dish":"Add Dish"})]})]})}function EditKitchen(){const{kitchenId:e}=useParams(),i=useNavigate(),{user:s}=useAuth();useLocationContext();const[a,_]=reactExports.useState(!0),[$,rt]=reactExports.useState(!1),[c,dt]=reactExports.useState(""),[ht,Et]=reactExports.useState(null),[St,At]=reactExports.useState(null),[Pt,Vt]=reactExports.useState(null),[Bt,Zt]=reactExports.useState({name:"",description:"",specialties:"",cookingTime:"30-45 mins",isVeg:!0,address:{line1:"",city:"",pincode:""}});reactExports.useEffect(()=>{(async()=>{if(e){try{const er=ref(database,`kitchens/${e}`),ir=await get(er);if(ir.exists()){const or=ir.val();if(or.ownerId!==(s==null?void 0:s.id)){ue.error("You do not have permission to edit this kitchen"),i("/amma/dashboard");return}Zt({name:or.name,description:or.description,specialties:or.specialties.join(", "),cookingTime:or.cookingTime,isVeg:or.isVeg,address:{line1:or.address.line1,city:or.address.city,pincode:or.address.pincode}}),dt(or.image),or.address.lat&&or.address.lng&&At({lat:or.address.lat,lng:or.address.lng,address:or.address.line1}),Vt(or.franchiseId||null)}}catch(er){console.error("Error loading kitchen:",er),ue.error("Failed to load kitchen data")}_(!1)}})()},[e,s==null?void 0:s.id,i]);const zt=Gt=>{var ir;const er=(ir=Gt.target.files)==null?void 0:ir[0];if(er){Et(er);const or=new FileReader;or.onload=()=>dt(or.result),or.readAsDataURL(er)}},Ut=Gt=>{At(Gt),Vt(Gt.franchiseId),Zt(er=>({...er,address:{...er.address,line1:Gt.address}}))},Nt=async()=>{if(e){if(!Bt.name.trim()){ue.error("Please enter your kitchen name");return}if(!St){ue.error("Please select your kitchen location on the map");return}if(!Pt){ue.error("Your location must be within a service area");return}rt(!0);try{let Gt=c;ht&&(Gt=(await uploadImage(ht)).data.display_url),await updateKitchen(e,{name:Bt.name,description:Bt.description,specialties:Bt.specialties.split(",").map(er=>er.trim()).filter(Boolean),cookingTime:Bt.cookingTime,isVeg:Bt.isVeg,image:Gt,franchiseId:Pt,address:{line1:St.address,city:Bt.address.city,pincode:Bt.address.pincode,lat:St.lat,lng:St.lng}}),ue.success("Kitchen updated successfully!"),i("/amma/dashboard")}catch(Gt){console.error("Error updating kitchen:",Gt),ue.error("Failed to update kitchen")}rt(!1)}};return a?jsxRuntimeExports.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:jsxRuntimeExports.jsx(LoaderCircle,{className:"w-8 h-8 animate-spin text-primary"})}):jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-8",children:[jsxRuntimeExports.jsx("header",{className:"sticky top-0 z-40 bg-card/95 backdrop-blur-lg border-b border-border",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-4 px-4 py-4",children:[jsxRuntimeExports.jsx(Button,{variant:"ghost",size:"icon",onClick:()=>i(-1),children:jsxRuntimeExports.jsx(ChevronLeft,{className:"w-5 h-5"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h1",{className:"font-semibold text-foreground",children:"Edit Kitchen"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Update your kitchen details"})]})]})}),jsxRuntimeExports.jsxs("div",{className:"px-4 py-6 space-y-6",children:[jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:jsxRuntimeExports.jsxs("label",{className:"block",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-foreground mb-2",children:"Kitchen Image"}),jsxRuntimeExports.jsxs("div",{className:"relative w-full h-48 rounded-2xl bg-secondary overflow-hidden cursor-pointer group",children:[c?jsxRuntimeExports.jsx("img",{src:c,alt:"Kitchen",className:"w-full h-full object-cover"}):jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center h-full",children:[jsxRuntimeExports.jsx(Camera,{className:"w-10 h-10 text-muted-foreground mb-2"}),jsxRuntimeExports.jsx("span",{className:"text-sm text-muted-foreground",children:"Add kitchen photo"})]}),jsxRuntimeExports.jsx("div",{className:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center",children:jsxRuntimeExports.jsx(Camera,{className:"w-8 h-8 text-white"})}),jsxRuntimeExports.jsx("input",{type:"file",accept:"image/*",onChange:zt,className:"absolute inset-0 opacity-0 cursor-pointer"})]})]})}),jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"text-sm font-medium text-foreground",children:"Kitchen Name *"}),jsxRuntimeExports.jsx(Input,{value:Bt.name,onChange:Gt=>Zt({...Bt,name:Gt.target.value}),placeholder:"e.g., Amma's Kitchen",className:"mt-1 bg-secondary border-0"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"text-sm font-medium text-foreground",children:"Description"}),jsxRuntimeExports.jsx("textarea",{value:Bt.description,onChange:Gt=>Zt({...Bt,description:Gt.target.value}),placeholder:"Tell customers about your kitchen...",rows:3,className:"mt-1 w-full px-4 py-3 rounded-xl bg-secondary text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary/20 resize-none"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"text-sm font-medium text-foreground",children:"Specialties"}),jsxRuntimeExports.jsx(Input,{value:Bt.specialties,onChange:Gt=>Zt({...Bt,specialties:Gt.target.value}),placeholder:"e.g., Biryani, South Indian, Sweets",className:"mt-1 bg-secondary border-0"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Separate with commas"})]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsx("label",{className:"text-sm font-medium text-foreground",children:"Cooking Time"}),jsxRuntimeExports.jsxs("select",{value:Bt.cookingTime,onChange:Gt=>Zt({...Bt,cookingTime:Gt.target.value}),className:"mt-1 w-full px-4 py-3 rounded-xl bg-secondary text-foreground",children:[jsxRuntimeExports.jsx("option",{value:"15-30 mins",children:"15-30 mins"}),jsxRuntimeExports.jsx("option",{value:"30-45 mins",children:"30-45 mins"}),jsxRuntimeExports.jsx("option",{value:"45-60 mins",children:"45-60 mins"})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3 pt-6",children:[jsxRuntimeExports.jsx("label",{className:"text-sm font-medium text-foreground",children:"Pure Veg?"}),jsxRuntimeExports.jsx("button",{onClick:()=>Zt({...Bt,isVeg:!Bt.isVeg}),className:`w-12 h-6 rounded-full transition-colors ${Bt.isVeg?"bg-veg":"bg-muted"}`,children:jsxRuntimeExports.jsx("div",{className:`w-5 h-5 rounded-full bg-white shadow-md transition-transform ${Bt.isVeg?"translate-x-6":"translate-x-1"}`})})]})]})]}),jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[jsxRuntimeExports.jsx(MapPin,{className:"w-4 h-4 text-primary"}),jsxRuntimeExports.jsx("label",{className:"text-sm font-medium text-foreground",children:"Kitchen Location *"})]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground mb-3",children:"Tap on the map to set your kitchen location. It must be within a service zone."}),jsxRuntimeExports.jsx(FranchiseZoneLocationPicker,{onLocationSelect:Ut,initialLocation:St||void 0})]}),St&&jsxRuntimeExports.jsxs("div",{className:"bg-secondary rounded-xl p-4",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-foreground",children:"Selected Address"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:St.address}),Pt&&jsxRuntimeExports.jsx("p",{className:"text-xs text-veg mt-2",children:" Within service area"})]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"text-sm font-medium text-foreground",children:"City"}),jsxRuntimeExports.jsx(Input,{value:Bt.address.city,onChange:Gt=>Zt({...Bt,address:{...Bt.address,city:Gt.target.value}}),placeholder:"City",className:"mt-1 bg-secondary border-0"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"text-sm font-medium text-foreground",children:"Pincode"}),jsxRuntimeExports.jsx(Input,{value:Bt.address.pincode,onChange:Gt=>Zt({...Bt,address:{...Bt.address,pincode:Gt.target.value}}),placeholder:"Pincode",className:"mt-1 bg-secondary border-0"})]})]})]}),jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:jsxRuntimeExports.jsx(Button,{onClick:Nt,disabled:$,className:"w-full gradient-primary text-primary-foreground py-6 rounded-xl text-lg font-semibold",children:$?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(LoaderCircle,{className:"w-5 h-5 animate-spin mr-2"}),"Saving..."]}):"Save Changes"})})]})]})}const roleDashboardMap={super_admin:"/super-admin",franchise_admin:"/franchise-admin",admin:"/admin",amma:"/amma/dashboard",user:"/"};function useRoleRedirect(e){const i=useAuth(),s=useNavigate(),{user:a,loading:_}=i;return reactExports.useEffect(()=>{if(!_){if(!a){s("/auth",{replace:!0});return}if(!e.includes(a.role)){const rt=roleDashboardMap[a.role]||"/";s(rt,{replace:!0})}}},[a,_,e,s]),{isAuthorized:!_&&a&&e.includes(a.role),isLoading:_}}const KitchenMap=({kitchens:e=[],userLocation:i,selectedKitchen:s,onKitchenSelect:a,height:_="300px",showUserLocation:$=!0})=>{const rt=reactExports.useRef(null),c=reactExports.useRef(null),dt=reactExports.useRef([]),[ht,Et]=reactExports.useState(!1),St=[80.648,16.5062];return reactExports.useEffect(()=>{if(!(!rt.current||c.current))return mapboxgl.accessToken=MAPBOX_ACCESS_TOKEN,c.current=new mapboxgl.Map({container:rt.current,style:"mapbox://styles/mapbox/streets-v12",center:i?[i.lng,i.lat]:St,zoom:13}),c.current.addControl(new mapboxgl.NavigationControl,"top-right"),c.current.on("load",()=>{Et(!0)}),()=>{var At;(At=c.current)==null||At.remove(),c.current=null}},[]),reactExports.useEffect(()=>{if(!c.current||!ht||!i||!$)return;const At=new mapboxgl.Marker({color:"#D97706"}).setLngLat([i.lng,i.lat]).setPopup(new mapboxgl.Popup().setHTML("<strong>Your Location</strong>")).addTo(c.current);return c.current.flyTo({center:[i.lng,i.lat],zoom:14}),()=>{At.remove()}},[i,ht,$]),reactExports.useEffect(()=>{var At;if(!(!c.current||!ht)&&(dt.current.forEach(Pt=>Pt.remove()),dt.current=[],e.forEach(Pt=>{if(!Pt.address.lat||!Pt.address.lng)return;const Vt=document.createElement("div");Vt.className="kitchen-marker",Vt.innerHTML=`
        <div class="w-10 h-10 rounded-full ${Pt.isOpen?"bg-primary":"bg-muted"} flex items-center justify-center shadow-lg cursor-pointer transform hover:scale-110 transition-transform">
          <span class="text-lg"></span>
        </div>
      `;const Bt=new mapboxgl.Popup({offset:25}).setHTML(`
        <div class="p-2">
          <h3 class="font-bold text-sm">${Pt.name}</h3>
          <p class="text-xs text-gray-500">${Pt.specialties.join(", ")}</p>
          <p class="text-xs ${Pt.isOpen?"text-green-600":"text-red-500"}">
            ${Pt.isOpen?" Open":" Closed"}
          </p>
        </div>
      `),Zt=new mapboxgl.Marker(Vt).setLngLat([Pt.address.lng,Pt.address.lat]).setPopup(Bt).addTo(c.current);Vt.addEventListener("click",()=>{a&&a(Pt.id)}),dt.current.push(Zt)}),e.length>0)){const Pt=new mapboxgl.LngLatBounds;e.forEach(Vt=>{Vt.address.lat&&Vt.address.lng&&Pt.extend([Vt.address.lng,Vt.address.lat])}),i&&Pt.extend([i.lng,i.lat]),Pt.isEmpty()||(At=c.current)==null||At.fitBounds(Pt,{padding:50})}},[e,ht,a]),reactExports.useEffect(()=>{if(!c.current||!s)return;const At=e.find(Pt=>Pt.id===s);At!=null&&At.address.lat&&(At!=null&&At.address.lng)&&c.current.flyTo({center:[At.address.lng,At.address.lat],zoom:15})},[s,e]),jsxRuntimeExports.jsxs("div",{className:"relative w-full rounded-xl overflow-hidden shadow-lg",style:{height:_},children:[jsxRuntimeExports.jsx("div",{ref:rt,className:"absolute inset-0"}),jsxRuntimeExports.jsx("div",{className:"absolute inset-0 pointer-events-none bg-gradient-to-b from-transparent to-background/5 rounded-xl"})]})};function AdminDashboard(){useAuth();const{isAuthorized:e,isLoading:i}=useRoleRedirect(["admin","franchise_admin"]),{kitchens:s,loading:a}=useAllKitchens(),{orders:_,loading:$}=useAllOrders(),{users:rt,loading:c}=useAllUsers(),[dt,ht]=reactExports.useState("overview"),[Et,St]=reactExports.useState(""),At=s.filter(Gt=>!Gt.isApproved),Pt=s.filter(Gt=>Gt.isApproved),Vt=_.filter(Gt=>{const er=new Date;return new Date(Gt.createdAt).toDateString()===er.toDateString()}),Bt=_.reduce((Gt,er)=>Gt+er.totalAmount,0),Zt=async Gt=>{try{await approveKitchen(Gt),ue.success("Kitchen approved!")}catch{ue.error("Failed to approve kitchen")}},zt=async Gt=>{try{await rejectKitchen(Gt),ue.success("Kitchen rejected")}catch{ue.error("Failed to reject kitchen")}},Ut=async Gt=>{if(confirm("Are you sure you want to delete this user?"))try{await deleteUser(Gt),ue.success("User deleted")}catch{ue.error("Failed to delete user")}};return i||a||$||c||!e?jsxRuntimeExports.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:jsxRuntimeExports.jsx(LoaderCircle,{className:"w-8 h-8 animate-spin text-primary"})}):jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-24",children:[jsxRuntimeExports.jsxs("header",{className:"sticky top-0 z-40 bg-card/95 backdrop-blur-lg border-b border-border",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between px-4 py-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-4",children:[jsxRuntimeExports.jsx(Link,{to:"/profile",children:jsxRuntimeExports.jsx(motion.div,{whileTap:{scale:.9},className:"w-10 h-10 rounded-full bg-secondary flex items-center justify-center",children:jsxRuntimeExports.jsx(ArrowLeft,{className:"w-5 h-5"})})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h1",{className:"font-semibold text-foreground",children:"Admin Dashboard"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Manage everything"})]})]}),At.length>0&&jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 rounded-full bg-gold text-foreground text-xs",children:[jsxRuntimeExports.jsx(TriangleAlert,{className:"w-3 h-3"}),At.length," pending"]})]}),jsxRuntimeExports.jsx("div",{className:"flex bg-secondary mx-4 rounded-xl p-1 mb-4 overflow-x-auto",children:["overview","kitchens","users","orders"].map(Gt=>jsxRuntimeExports.jsx("button",{onClick:()=>ht(Gt),className:`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all capitalize whitespace-nowrap ${dt===Gt?"bg-card text-foreground shadow-soft":"text-muted-foreground"}`,children:Gt},Gt))})]}),jsxRuntimeExports.jsxs("div",{className:"px-4 py-4",children:[dt==="overview"&&jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-xl p-4 shadow-card",children:[jsxRuntimeExports.jsx(Store$1,{className:"w-6 h-6 text-primary mb-2"}),jsxRuntimeExports.jsx("p",{className:"text-2xl font-bold text-foreground",children:Pt.length}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Active Kitchens"})]}),jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-xl p-4 shadow-card",children:[jsxRuntimeExports.jsx(Users,{className:"w-6 h-6 text-accent mb-2"}),jsxRuntimeExports.jsx("p",{className:"text-2xl font-bold text-foreground",children:rt.length}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Users"})]}),jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-xl p-4 shadow-card",children:[jsxRuntimeExports.jsx(Package,{className:"w-6 h-6 text-gold mb-2"}),jsxRuntimeExports.jsx("p",{className:"text-2xl font-bold text-foreground",children:Vt.length}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Today's Orders"})]}),jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-xl p-4 shadow-card",children:[jsxRuntimeExports.jsx(TrendingUp,{className:"w-6 h-6 text-veg mb-2"}),jsxRuntimeExports.jsxs("p",{className:"text-2xl font-bold text-foreground",children:["",Bt]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Revenue"})]})]}),At.length>0&&jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-2xl p-4 shadow-card",children:[jsxRuntimeExports.jsxs("h3",{className:"font-semibold text-foreground mb-4 flex items-center gap-2",children:[jsxRuntimeExports.jsx(TriangleAlert,{className:"w-4 h-4 text-gold"}),"Pending Kitchen Approvals"]}),jsxRuntimeExports.jsx("div",{className:"space-y-3",children:At.map(Gt=>jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between p-3 bg-secondary rounded-xl",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"font-medium text-foreground",children:Gt.name}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:Gt.address.city})]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsx(Button,{size:"sm",className:"bg-veg text-primary-foreground",onClick:()=>Zt(Gt.id),children:jsxRuntimeExports.jsx(Check,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx(Button,{size:"sm",variant:"outline",className:"text-destructive border-destructive",onClick:()=>zt(Gt.id),children:jsxRuntimeExports.jsx(X,{className:"w-4 h-4"})})]})]},Gt.id))})]}),jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-2xl p-4 shadow-card",children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-foreground mb-4",children:"Kitchen Locations"}),jsxRuntimeExports.jsx(KitchenMap,{kitchens:Pt,height:"250px",showUserLocation:!1})]})]}),dt==="kitchens"&&jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsx(Input,{placeholder:"Search kitchens...",value:Et,onChange:Gt=>St(Gt.target.value),className:"bg-secondary border-0"}),s.filter(Gt=>Gt.name.toLowerCase().includes(Et.toLowerCase())).map(Gt=>jsxRuntimeExports.jsxs(motion.div,{className:"bg-card rounded-xl p-4 shadow-card flex gap-4",children:[jsxRuntimeExports.jsx("img",{src:Gt.image,alt:Gt.name,className:"w-16 h-16 rounded-lg object-cover"}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("h3",{className:"font-medium text-foreground",children:Gt.name}),!Gt.isApproved&&jsxRuntimeExports.jsx("span",{className:"px-2 py-0.5 bg-gold/20 text-gold text-xs rounded-full",children:"Pending"})]}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:Gt.specialties.join(", ")}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:Gt.address.city})]}),jsxRuntimeExports.jsxs("div",{className:"flex flex-col gap-1",children:[jsxRuntimeExports.jsx("span",{className:cn("text-xs px-2 py-1 rounded-full text-center",Gt.isOpen?"bg-veg/20 text-veg":"bg-muted text-muted-foreground"),children:Gt.isOpen?"Open":"Closed"}),!Gt.isApproved&&jsxRuntimeExports.jsx(Button,{size:"sm",className:"bg-veg text-primary-foreground text-xs",onClick:()=>Zt(Gt.id),children:"Approve"})]})]},Gt.id))]}),dt==="users"&&jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsx(Input,{placeholder:"Search users...",value:Et,onChange:Gt=>St(Gt.target.value),className:"bg-secondary border-0"}),rt.filter(Gt=>Gt.name.toLowerCase().includes(Et.toLowerCase())||Gt.email.toLowerCase().includes(Et.toLowerCase())).map(Gt=>jsxRuntimeExports.jsxs(motion.div,{className:"bg-card rounded-xl p-4 shadow-card flex items-center gap-4",children:[jsxRuntimeExports.jsx("div",{className:"w-12 h-12 rounded-full bg-secondary flex items-center justify-center",children:jsxRuntimeExports.jsx(Users,{className:"w-6 h-6 text-muted-foreground"})}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsx("h3",{className:"font-medium text-foreground",children:Gt.name}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:Gt.email})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("span",{className:cn("text-xs px-2 py-1 rounded-full capitalize",Gt.role==="admin"?"bg-primary/20 text-primary":Gt.role==="amma"?"bg-gold/20 text-gold":"bg-secondary text-muted-foreground"),children:Gt.role}),Gt.role!=="admin"&&jsxRuntimeExports.jsx(Button,{size:"icon",variant:"ghost",className:"text-destructive",onClick:()=>Ut(Gt.id),children:jsxRuntimeExports.jsx(X,{className:"w-4 h-4"})})]})]},Gt.id))]}),dt==="orders"&&jsxRuntimeExports.jsx("div",{className:"space-y-4",children:_.length===0?jsxRuntimeExports.jsxs("div",{className:"text-center py-12",children:[jsxRuntimeExports.jsx(Package,{className:"w-12 h-12 text-muted-foreground mx-auto mb-3"}),jsxRuntimeExports.jsx("p",{className:"text-muted-foreground",children:"No orders yet"})]}):_.slice(0,20).map(Gt=>jsxRuntimeExports.jsxs(motion.div,{className:"bg-card rounded-xl p-4 shadow-card",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-start justify-between mb-2",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"font-medium text-foreground",children:Gt.kitchenName}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-muted-foreground",children:["#",Gt.id.slice(-8),"  ",new Date(Gt.createdAt).toLocaleDateString()]})]}),jsxRuntimeExports.jsx("span",{className:cn("text-xs px-2 py-1 rounded-full capitalize",Gt.status==="delivered"?"bg-veg/20 text-veg":Gt.status==="cancelled"?"bg-destructive/20 text-destructive":"bg-primary/20 text-primary"),children:Gt.status})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between text-sm",children:[jsxRuntimeExports.jsxs("span",{className:"text-muted-foreground",children:[Gt.items.length," items"]}),jsxRuntimeExports.jsxs("span",{className:"font-semibold text-foreground",children:["",Gt.totalAmount]})]})]},Gt.id))})]})]})}function FranchiseZoneMap({zone:e,kitchens:i=[],users:s=[],height:a="400px",onKitchenClick:_}){const $=reactExports.useRef(null),rt=reactExports.useRef(null),[c,dt]=reactExports.useState(!0),ht=reactExports.useRef([]);return reactExports.useEffect(()=>{if($.current)return mapboxgl.accessToken=MAPBOX_ACCESS_TOKEN,rt.current=new mapboxgl.Map({container:$.current,style:"mapbox://styles/mapbox/streets-v12",center:[78.4867,17.385],zoom:10,attributionControl:!1}),rt.current.addControl(new mapboxgl.NavigationControl,"bottom-right"),rt.current.on("load",()=>{if(dt(!1),!rt.current)return;rt.current.addSource("franchise-zone",{type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:e.coordinates}}}),rt.current.addLayer({id:"franchise-zone-fill",type:"fill",source:"franchise-zone",paint:{"fill-color":"#f97316","fill-opacity":.15}}),rt.current.addLayer({id:"franchise-zone-border",type:"line",source:"franchise-zone",paint:{"line-color":"#f97316","line-width":3,"line-dasharray":[2,1]}});const Et=e.coordinates[0],St=new mapboxgl.LngLatBounds;Et.forEach(At=>St.extend([At[0],At[1]])),rt.current.fitBounds(St,{padding:50})}),()=>{var Et;(Et=rt.current)==null||Et.remove()}},[]),reactExports.useEffect(()=>{!rt.current||c||(ht.current.forEach(Et=>Et.remove()),ht.current=[],i.forEach(Et=>{var Vt;if(!Et.address.lat||!Et.address.lng)return;const St=document.createElement("div");St.className="kitchen-marker",St.innerHTML=`
        <div class="w-10 h-10 rounded-full bg-orange-500 flex items-center justify-center shadow-lg border-2 border-white cursor-pointer transform hover:scale-110 transition-transform">
          <span class="text-lg"></span>
        </div>
      `,St.addEventListener("click",()=>{_&&_(Et.id)});const At=new mapboxgl.Popup({offset:25}).setHTML(`
        <div class="p-2">
          <h3 class="font-bold text-sm text-orange-600"> ${Et.name}</h3>
          <p class="text-xs text-gray-500">${((Vt=Et.specialties)==null?void 0:Vt.join(", "))||"Home Kitchen"}</p>
          <p class="text-xs ${Et.isOpen?"text-green-600":"text-red-500"}">
            ${Et.isOpen?" Open":" Closed"}
          </p>
          ${Et.isApproved?"":'<p class="text-xs text-yellow-600"> Pending Approval</p>'}
          <p class="text-xs text-blue-500 mt-1 cursor-pointer">Click for details </p>
        </div>
      `),Pt=new mapboxgl.Marker(St).setLngLat([Et.address.lng,Et.address.lat]).setPopup(At).addTo(rt.current);ht.current.push(Pt)}),s.forEach(Et=>{const St=document.createElement("div");St.className="user-marker",St.innerHTML=`
        <div class="w-8 h-8 rounded-full bg-blue-500 flex items-center justify-center shadow-lg border-2 border-white cursor-pointer transform hover:scale-110 transition-transform">
          <span class="text-sm"></span>
        </div>
      `;const At=new mapboxgl.Popup({offset:20}).setHTML(`
        <div class="p-2">
          <h3 class="font-bold text-sm text-blue-600"> ${Et.name}</h3>
          ${Et.email?`<p class="text-xs text-gray-500">${Et.email}</p>`:""}
          ${Et.city?`<p class="text-xs text-gray-400">${Et.city}</p>`:""}
        </div>
      `),Pt=new mapboxgl.Marker(St).setLngLat([Et.lng,Et.lat]).setPopup(At).addTo(rt.current);ht.current.push(Pt)}))},[i,s,c,_]),jsxRuntimeExports.jsxs("div",{className:"relative rounded-xl overflow-hidden shadow-lg",style:{height:a},children:[jsxRuntimeExports.jsx("div",{ref:$,className:"absolute inset-0"}),c&&jsxRuntimeExports.jsx("div",{className:"absolute inset-0 bg-secondary flex items-center justify-center",children:jsxRuntimeExports.jsx(LoaderCircle,{className:"w-6 h-6 animate-spin text-primary"})}),jsxRuntimeExports.jsxs("div",{className:"absolute bottom-4 left-4 bg-card/95 backdrop-blur-sm rounded-lg px-3 py-2 shadow-lg",children:[jsxRuntimeExports.jsx("p",{className:"text-xs font-medium text-foreground mb-2",children:"Legend"}),jsxRuntimeExports.jsxs("div",{className:"space-y-1",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("div",{className:"w-4 h-4 rounded-full bg-orange-500 flex items-center justify-center",children:jsxRuntimeExports.jsx("span",{className:"text-[8px]",children:""})}),jsxRuntimeExports.jsx("span",{className:"text-xs text-muted-foreground",children:"Amma (Kitchen)"})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("div",{className:"w-4 h-4 rounded-full bg-blue-500 flex items-center justify-center",children:jsxRuntimeExports.jsx("span",{className:"text-[8px]",children:""})}),jsxRuntimeExports.jsx("span",{className:"text-xs text-muted-foreground",children:"Customer"})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("div",{className:"w-4 h-1 bg-orange-500 rounded",style:{borderStyle:"dashed"}}),jsxRuntimeExports.jsx("span",{className:"text-xs text-muted-foreground",children:"Service Zone"})]})]})]})]})}function FranchiseAdminDashboard(){var lo,ys;const{user:e,signOut:i}=useAuth(),s=useNavigate(),{isAuthorized:a,isLoading:_}=useRoleRedirect(["franchise_admin"]),{franchise:$,loading:rt}=useFranchise(e==null?void 0:e.franchiseId),{kitchens:c,loading:dt}=useAllKitchens(),{orders:ht,loading:Et}=useAllOrders(),{users:St,loading:At}=useAllUsers(),{dishes:Pt,loading:Vt}=useAllDishes(),{withdrawals:Bt,loading:Zt}=useAllWithdrawals(),[zt,Ut]=reactExports.useState("orders"),[Nt,Gt]=reactExports.useState(null),[er,ir]=reactExports.useState(""),[or,mr]=reactExports.useState(null),[Rr,on]=reactExports.useState(!1),[un,jr]=reactExports.useState(null),[Jr,fn]=reactExports.useState(""),Fr=async()=>{await i(),s("/auth")},Cr=dn=>{const Es=Sr.find(po=>po.id===dn);Es&&mr(Es)},Sr=c.filter(dn=>!($!=null&&$.zone)||!dn.address.lat||!dn.address.lng?!1:isPointInZone(dn.address.lat,dn.address.lng,$.zone)),dr=St.filter(dn=>{var Es,po;return!($!=null&&$.zone)||!((Es=dn.address)!=null&&Es.lat)||!((po=dn.address)!=null&&po.lng)||dn.role!=="user"?!1:isPointInZone(dn.address.lat,dn.address.lng,$.zone)});St.filter(dn=>{var Es,po;return!($!=null&&$.zone)||!((Es=dn.address)!=null&&Es.lat)||!((po=dn.address)!=null&&po.lng)?!1:dn.role==="amma"&&isPointInZone(dn.address.lat,dn.address.lng,$.zone)});const gr=Sr.filter(dn=>!dn.isApproved),qr=Sr.filter(dn=>dn.isApproved),Lr=ht.filter(dn=>{const Es=c.find(po=>po.id===dn.kitchenId);return!($!=null&&$.zone)||!(Es!=null&&Es.address.lat)||!(Es!=null&&Es.address.lng)?!1:isPointInZone(Es.address.lat,Es.address.lng,$.zone)}),_n=Lr.filter(dn=>{const Es=new Date;return new Date(dn.createdAt).toDateString()===Es.toDateString()}),gn=Lr.reduce((dn,Es)=>dn+Es.totalAmount,0),Sn=Pt.filter(dn=>{const Es=c.find(po=>po.id===dn.kitchenId);return!($!=null&&$.zone)||!(Es!=null&&Es.address.lat)||!(Es!=null&&Es.address.lng)?!1:isPointInZone(Es.address.lat,Es.address.lng,$.zone)}),Fs=Bt.filter(dn=>{const Es=c.find(po=>po.id===dn.kitchenId);return!($!=null&&$.zone)||!(Es!=null&&Es.address.lat)||!(Es!=null&&Es.address.lng)?!1:isPointInZone(Es.address.lat,Es.address.lng,$.zone)}),rs=Fs.filter(dn=>dn.status==="pending").length,ms=async(dn,Es)=>{try{await updateDish(dn,{isBestSeller:!Es}),ue.success(Es?"Removed from Best Sellers":"Added to Best Sellers")}catch{ue.error("Failed to update dish")}},On=async dn=>{try{await approveKitchen(dn),ue.success("Kitchen approved!")}catch{ue.error("Failed to approve kitchen")}},ws=async dn=>{try{await rejectKitchen(dn),ue.success("Kitchen rejected")}catch{ue.error("Failed to reject kitchen")}},Vs=async()=>{if(un)try{if(un.type==="approve"){if(!Jr.trim()){ue.error("Please enter a Transaction ID");return}await updateWithdrawalStatus(un.id,"approved",{transactionId:Jr}),ue.success("Withdrawal Approved")}else await updateWithdrawalStatus(un.id,"rejected",{adminNote:Jr}),ue.success("Withdrawal Rejected");jr(null),fn("")}catch{ue.error("Failed to update status")}};return _||rt||dt||Et||At||Vt||Zt||!a?jsxRuntimeExports.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:jsxRuntimeExports.jsx(LoaderCircle,{className:"w-8 h-8 animate-spin text-primary"})}):$?jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-24",children:[jsxRuntimeExports.jsxs("header",{className:"sticky top-0 z-40 bg-card/95 backdrop-blur-lg border-b border-border",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between px-4 py-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h1",{className:"font-semibold text-foreground",children:$.name}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Franchise Dashboard"})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[gr.length>0&&jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 rounded-full bg-gold text-foreground text-xs",children:[jsxRuntimeExports.jsx(TriangleAlert,{className:"w-3 h-3"}),gr.length," pending"]}),jsxRuntimeExports.jsxs(Button,{variant:"ghost",size:"sm",onClick:Fr,className:"text-destructive",children:[jsxRuntimeExports.jsx(LogOut,{className:"w-4 h-4 mr-1"}),"Logout"]})]})]}),!Nt&&jsxRuntimeExports.jsx("div",{className:"flex bg-secondary mx-4 rounded-xl p-1 mb-4 select-none",children:["orders","kitchens","more"].map(dn=>jsxRuntimeExports.jsxs("button",{onClick:()=>Ut(dn),className:`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all duration-300 capitalize relative ${zt===dn?"text-foreground shadow-sm":"text-muted-foreground hover:bg-white/10"}`,children:[zt===dn&&jsxRuntimeExports.jsx(motion.div,{layoutId:"activeTab",className:"absolute inset-0 bg-card rounded-lg shadow-sm",transition:{type:"spring",bounce:.2,duration:.6}}),jsxRuntimeExports.jsx("span",{className:"relative z-10 flex items-center justify-center gap-1",children:dn==="more"?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Menu,{className:"w-4 h-4"})," More",rs>0&&jsxRuntimeExports.jsx("span",{className:"bg-destructive text-destructive-foreground w-2 h-2 rounded-full absolute top-1 right-1"})]}):dn})]},dn))}),Nt&&jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 px-4 mb-4",children:[jsxRuntimeExports.jsx(Button,{variant:"ghost",size:"sm",onClick:()=>{Gt(null),Ut("more")},className:"p-0 hover:bg-transparent",children:jsxRuntimeExports.jsx(ArrowLeft,{className:"w-5 h-5"})}),jsxRuntimeExports.jsx("h2",{className:"font-semibold text-lg capitalize",children:Nt.replace("_"," ")})]})]}),jsxRuntimeExports.jsxs("div",{className:"px-4 py-4",children:[zt==="orders"&&!Nt&&jsxRuntimeExports.jsx("div",{className:"space-y-4",children:jsxRuntimeExports.jsx("h2",{className:"font-semibold text-foreground px-1 hidden",children:"Active Deliveries"})}),zt==="kitchens"&&!Nt&&jsxRuntimeExports.jsx("div",{className:"space-y-4"}),zt==="more"&&!Nt&&jsxRuntimeExports.jsx(motion.div,{className:"grid grid-cols-2 gap-4",initial:"hidden",animate:"visible",variants:{hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}},children:[{id:"overview",icon:TrendingUp,label:"Overview",color:"text-primary",bg:"bg-primary/10"},{id:"map",icon:MapPin,label:"Zone Map",color:"text-blue-500",bg:"bg-blue-500/10"},{id:"users",icon:Users,label:"Customers",color:"text-accent",bg:"bg-accent/10"},{id:"best_sellers",icon:Sparkles,label:"Best Sellers",color:"text-gold",bg:"bg-gold/10"},{id:"withdrawals",icon:Wallet,label:"Withdrawals",color:"text-veg",bg:"bg-veg/10",count:rs}].map(dn=>jsxRuntimeExports.jsxs(motion.div,{variants:{hidden:{opacity:0,y:20},visible:{opacity:1,y:0}},onClick:()=>Gt(dn.id),className:"bg-card p-6 rounded-2xl shadow-card flex flex-col items-center justify-center gap-3 active:scale-95 transition-all cursor-pointer hover:shadow-lg border border-transparent hover:border-primary/10 relative overflow-hidden group",children:[jsxRuntimeExports.jsx("div",{className:`p-4 rounded-full ${dn.bg} group-hover:scale-110 transition-transform duration-300`,children:jsxRuntimeExports.jsx(dn.icon,{className:`w-8 h-8 ${dn.color}`})}),jsxRuntimeExports.jsx("span",{className:"font-medium text-foreground",children:dn.label}),dn.count?dn.count>0&&jsxRuntimeExports.jsx("span",{className:"absolute top-3 right-3 bg-destructive text-destructive-foreground text-xs font-bold px-2 py-0.5 rounded-full shadow-sm",children:dn.count}):null]},dn.id))}),Nt==="overview"&&jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-xl p-4 shadow-card",children:[jsxRuntimeExports.jsx(Store$1,{className:"w-6 h-6 text-primary mb-2"}),jsxRuntimeExports.jsx("p",{className:"text-2xl font-bold text-foreground",children:qr.length}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Active Kitchens"})]}),jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-xl p-4 shadow-card",children:[jsxRuntimeExports.jsx(Users,{className:"w-6 h-6 text-blue-500 mb-2"}),jsxRuntimeExports.jsx("p",{className:"text-2xl font-bold text-foreground",children:dr.length}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Customers"})]}),jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-xl p-4 shadow-card",children:[jsxRuntimeExports.jsx(Package,{className:"w-6 h-6 text-gold mb-2"}),jsxRuntimeExports.jsx("p",{className:"text-2xl font-bold text-foreground",children:_n.length}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Today's Orders"})]}),jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-xl p-4 shadow-card",children:[jsxRuntimeExports.jsx(TrendingUp,{className:"w-6 h-6 text-veg mb-2"}),jsxRuntimeExports.jsxs("p",{className:"text-2xl font-bold text-foreground",children:["",gn]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Revenue"})]})]}),gr.length>0&&jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-2xl p-4 shadow-card",children:[jsxRuntimeExports.jsxs("h3",{className:"font-semibold text-foreground mb-4 flex items-center gap-2",children:[jsxRuntimeExports.jsx(TriangleAlert,{className:"w-4 h-4 text-gold"}),"Pending Kitchen Approvals"]}),jsxRuntimeExports.jsx("div",{className:"space-y-3",children:gr.map(dn=>jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between p-3 bg-secondary rounded-xl",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"font-medium text-foreground",children:dn.name}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:dn.address.city})]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsx(Button,{size:"sm",className:"bg-veg text-primary-foreground",onClick:()=>On(dn.id),children:jsxRuntimeExports.jsx(Check,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx(Button,{size:"sm",variant:"outline",className:"text-destructive border-destructive",onClick:()=>ws(dn.id),children:jsxRuntimeExports.jsx(X,{className:"w-4 h-4"})})]})]},dn.id))})]}),jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-2xl p-4 shadow-card",children:[jsxRuntimeExports.jsxs("h3",{className:"font-semibold text-foreground mb-4 flex items-center gap-2",children:[jsxRuntimeExports.jsx(MapPin,{className:"w-4 h-4 text-primary"}),"Service Zone"]}),jsxRuntimeExports.jsx(FranchiseZoneMap,{zone:$.zone,kitchens:Sr,users:dr.map(dn=>{var Es;return{id:dn.id,name:dn.name,lat:dn.address.lat,lng:dn.address.lng,email:dn.email,city:(Es=dn.address)==null?void 0:Es.city}}),height:"500px",onKitchenClick:Cr}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-muted-foreground text-center mt-2",children:[Sr.length," Ammas  ",dr.length," Customers in zone"]})]})]}),zt==="orders"&&!Nt&&jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsx("h2",{className:"font-semibold text-foreground px-1",children:Rr?"All Orders History":"Active Deliveries"}),jsxRuntimeExports.jsx(Button,{variant:"outline",size:"sm",onClick:()=>on(!Rr),className:"text-primary border-primary/20 hover:bg-primary/5",children:Rr?"Show Active Only":"Fetch All Orders"})]}),Lr.filter(dn=>Rr?!0:!["delivered","cancelled"].includes(dn.status)).length===0?jsxRuntimeExports.jsxs("div",{className:"text-center py-12",children:[jsxRuntimeExports.jsx(Package,{className:"w-12 h-12 text-muted-foreground mx-auto mb-3"}),jsxRuntimeExports.jsx("p",{className:"text-muted-foreground",children:"No orders found"})]}):Lr.filter(dn=>Rr?!0:!["delivered","cancelled"].includes(dn.status)).sort((dn,Es)=>Es.createdAt-dn.createdAt).map(dn=>{const Es=dn.status==="packed",po=dn.status==="out_for_delivery",no=c.find(tn=>tn.id===dn.kitchenId);return jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"bg-card rounded-xl p-4 shadow-card",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-start mb-3",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-foreground",children:(no==null?void 0:no.name)||"Unknown Kitchen"}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-muted-foreground",children:["#",dn.id.slice(-8),"  ",new Date(dn.createdAt).toLocaleTimeString()]})]}),jsxRuntimeExports.jsx("span",{className:cn("px-2 py-1 rounded-full text-xs font-medium",dn.status==="packed"?"bg-veg text-primary-foreground":dn.status==="out_for_delivery"?"bg-accent text-accent-foreground":"bg-secondary text-muted-foreground"),children:dn.status==="packed"?"Ready for Pickup":dn.status.replace(/_/g," ")})]}),jsxRuntimeExports.jsx("div",{className:"space-y-1 mb-3",children:dn.items.map((tn,us)=>jsxRuntimeExports.jsx("div",{className:"flex justify-between text-sm",children:jsxRuntimeExports.jsxs("span",{className:"text-foreground",children:[tn.dish.name," x",tn.quantity]})},us))}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground mb-4",children:[jsxRuntimeExports.jsx(MapPin,{className:"w-3 h-3"}),jsxRuntimeExports.jsxs("span",{children:[dn.deliveryAddress.line1,", ",dn.deliveryAddress.city]})]}),jsxRuntimeExports.jsx("div",{className:"flex gap-2 mb-4",children:(()=>{const tn=St.find(Co=>Co.id===dn.userId),us=St.find(Co=>Co.id===(no==null?void 0:no.ownerId));return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[(tn==null?void 0:tn.phone)&&jsxRuntimeExports.jsxs(Button,{size:"sm",variant:"outline",className:"flex-1 h-8 text-xs border-primary/20 text-primary hover:bg-primary/5",onClick:()=>window.location.href=`tel:${tn.phone}`,children:[jsxRuntimeExports.jsx(Phone,{className:"w-3 h-3 mr-2"})," Call User"]}),(us==null?void 0:us.phone)&&jsxRuntimeExports.jsxs(Button,{size:"sm",variant:"outline",className:"flex-1 h-8 text-xs border-primary/20 text-primary hover:bg-primary/5",onClick:()=>window.location.href=`tel:${us.phone}`,children:[jsxRuntimeExports.jsx(Phone,{className:"w-3 h-3 mr-2"})," Call Kitchen"]})]})})()}),jsxRuntimeExports.jsxs("div",{className:"pt-3 border-t border-border space-y-3",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-muted-foreground",children:"Total Amount"}),jsxRuntimeExports.jsxs("span",{className:"font-bold text-foreground",children:["",dn.totalAmount]})]}),(Es||po||dn.status==="cooking")&&jsxRuntimeExports.jsxs("div",{className:"w-full space-y-3",children:[jsxRuntimeExports.jsxs(Button,{variant:"outline",className:"w-full border-primary/20 text-primary hover:bg-primary/5",onClick:()=>{const tn=no!=null&&no.address.lat&&(no!=null&&no.address.lng)?`${no.address.lat},${no.address.lng}`:encodeURIComponent(`${no==null?void 0:no.address.line1}, ${no==null?void 0:no.address.city}`),us=dn.deliveryAddress.lat&&dn.deliveryAddress.lng?`${dn.deliveryAddress.lat},${dn.deliveryAddress.lng}`:encodeURIComponent(`${dn.deliveryAddress.line1}, ${dn.deliveryAddress.city}`),Ul=`https://www.google.com/maps/dir/?api=1&destination=${dn.status==="cooking"||dn.status==="packed"?tn:us}&travelmode=driving`;window.open(Ul,"_blank")},children:[jsxRuntimeExports.jsx(MapPin,{className:"w-4 h-4 mr-2"}),dn.status==="cooking"||dn.status==="packed"?"Navigate to Kitchen":"Navigate to Customer"]}),jsxRuntimeExports.jsx(SlideAction,{onSuccess:async()=>{let tn=null;if(dn.status==="cooking"?tn="packed":Es?tn="out_for_delivery":po&&(tn="delivered"),tn)try{await updateOrderStatus(dn.id,tn),ue.success(`Order updated to ${tn.replace(/_/g," ")}`)}catch{ue.error("Failed to update order")}},text:dn.status==="cooking"?"SLIDE TO REACH KITCHEN":Es?"SLIDE TO START DELIVERY":"SLIDE TO COMPLETE DELIVERY",icon:Es?TrendingUp:dn.status==="cooking"?MapPin:Check,className:"h-12 bg-secondary/50 border-primary/20 w-full",sliderColor:"bg-primary",textColor:"text-primary"})]})]})]},dn.id)})]}),Nt==="map"&&jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-2xl p-4 shadow-card",children:[jsxRuntimeExports.jsxs("h3",{className:"font-semibold text-foreground mb-4 flex items-center gap-2",children:[jsxRuntimeExports.jsx(MapPin,{className:"w-4 h-4 text-primary"}),$.name," - Service Zone Map"]}),jsxRuntimeExports.jsx(FranchiseZoneMap,{zone:$.zone,kitchens:Sr,users:dr.map(dn=>{var Es;return{id:dn.id,name:dn.name,lat:dn.address.lat,lng:dn.address.lng,email:dn.email,city:(Es=dn.address)==null?void 0:Es.city}}),height:"750px",onKitchenClick:Cr})]}),or&&jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-card rounded-2xl p-4 shadow-card",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-4",children:[jsxRuntimeExports.jsx("img",{src:or.image,alt:or.name,className:"w-20 h-20 rounded-xl object-cover"}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-foreground",children:or.name}),!or.isApproved&&jsxRuntimeExports.jsx("span",{className:"px-2 py-0.5 bg-gold/20 text-gold text-xs rounded-full",children:"Pending"})]}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:(lo=or.specialties)==null?void 0:lo.join(", ")}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-muted-foreground",children:[or.address.line1,", ",or.address.city]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3 mt-2",children:[jsxRuntimeExports.jsx("span",{className:cn("text-xs px-2 py-1 rounded-full",or.isOpen?"bg-veg/20 text-veg":"bg-muted text-muted-foreground"),children:or.isOpen?" Open":" Closed"}),jsxRuntimeExports.jsxs("span",{className:"text-xs text-muted-foreground",children:[" ",((ys=or.rating)==null?void 0:ys.toFixed(1))||"N/A"]})]})]}),jsxRuntimeExports.jsx(Button,{variant:"ghost",size:"sm",onClick:()=>mr(null),className:"text-muted-foreground",children:jsxRuntimeExports.jsx(X,{className:"w-4 h-4"})})]}),!or.isApproved&&jsxRuntimeExports.jsxs("div",{className:"flex gap-2 mt-4",children:[jsxRuntimeExports.jsxs(Button,{size:"sm",className:"flex-1 bg-veg text-primary-foreground",onClick:()=>{On(or.id),mr(null)},children:[jsxRuntimeExports.jsx(Check,{className:"w-4 h-4 mr-1"})," Approve"]}),jsxRuntimeExports.jsxs(Button,{size:"sm",variant:"outline",className:"flex-1 text-destructive border-destructive",onClick:()=>{ws(or.id),mr(null)},children:[jsxRuntimeExports.jsx(X,{className:"w-4 h-4 mr-1"})," Reject"]})]})]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-xl p-3 shadow-card text-center",children:[jsxRuntimeExports.jsx("p",{className:"text-xl font-bold text-orange-500",children:Sr.length}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Ammas"})]}),jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-xl p-3 shadow-card text-center",children:[jsxRuntimeExports.jsx("p",{className:"text-xl font-bold text-blue-500",children:dr.length}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Customers"})]}),jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-xl p-3 shadow-card text-center",children:[jsxRuntimeExports.jsx("p",{className:"text-xl font-bold text-veg",children:Lr.length}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Orders"})]})]})]}),zt==="kitchens"&&!Nt&&jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsx(Input,{placeholder:"Search kitchens...",value:er,onChange:dn=>ir(dn.target.value),className:"bg-secondary border-0"}),Sr.length===0?jsxRuntimeExports.jsxs("div",{className:"text-center py-12",children:[jsxRuntimeExports.jsx(Store$1,{className:"w-12 h-12 text-muted-foreground mx-auto mb-3"}),jsxRuntimeExports.jsx("p",{className:"text-muted-foreground",children:"No kitchens in your zone yet"})]}):Sr.filter(dn=>dn.name.toLowerCase().includes(er.toLowerCase())).map(dn=>{var Es;return jsxRuntimeExports.jsxs(motion.div,{className:"bg-card rounded-xl p-4 shadow-card flex gap-4",children:[jsxRuntimeExports.jsx("img",{src:dn.image,alt:dn.name,className:"w-16 h-16 rounded-lg object-cover"}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("h3",{className:"font-medium text-foreground",children:dn.name}),!dn.isApproved&&jsxRuntimeExports.jsx("span",{className:"px-2 py-0.5 bg-gold/20 text-gold text-xs rounded-full",children:"Pending"})]}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:(Es=dn.specialties)==null?void 0:Es.join(", ")}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:dn.address.city})]}),jsxRuntimeExports.jsxs("div",{className:"flex flex-col gap-1",children:[jsxRuntimeExports.jsx("span",{className:cn("text-xs px-2 py-1 rounded-full text-center",dn.isOpen?"bg-veg/20 text-veg":"bg-muted text-muted-foreground"),children:dn.isOpen?"Open":"Closed"}),!dn.isApproved&&jsxRuntimeExports.jsx(Button,{size:"sm",className:"bg-veg text-primary-foreground text-xs",onClick:()=>On(dn.id),children:"Approve"})]})]},dn.id)})]}),Nt==="users"&&jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsx(Input,{placeholder:"Search users...",value:er,onChange:dn=>ir(dn.target.value),className:"bg-secondary border-0"}),dr.length===0?jsxRuntimeExports.jsxs("div",{className:"text-center py-12",children:[jsxRuntimeExports.jsx(Users,{className:"w-12 h-12 text-muted-foreground mx-auto mb-3"}),jsxRuntimeExports.jsx("p",{className:"text-muted-foreground",children:"No customers in your zone yet"})]}):dr.filter(dn=>dn.name.toLowerCase().includes(er.toLowerCase())||dn.email.toLowerCase().includes(er.toLowerCase())).map(dn=>{var Es;return jsxRuntimeExports.jsxs(motion.div,{className:"bg-card rounded-xl p-4 shadow-card flex items-center gap-4",children:[jsxRuntimeExports.jsx("div",{className:"w-12 h-12 rounded-full bg-blue-500/20 flex items-center justify-center",children:jsxRuntimeExports.jsx(Users,{className:"w-6 h-6 text-blue-500"})}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsx("h3",{className:"font-medium text-foreground",children:dn.name}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:dn.email}),((Es=dn.address)==null?void 0:Es.city)&&jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:dn.address.city})]}),jsxRuntimeExports.jsx("span",{className:"text-xs px-2 py-1 rounded-full bg-blue-500/20 text-blue-500",children:"Customer"})]},dn.id)})]}),Nt==="best_sellers"&&jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsx("div",{className:"bg-card rounded-xl p-4 shadow-card mb-4 border-l-4 border-gold",children:jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-4",children:[jsxRuntimeExports.jsx("div",{className:"p-3 bg-gold/10 rounded-full",children:jsxRuntimeExports.jsx(Sparkles,{className:"w-6 h-6 text-gold"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-foreground",children:"Manage Best Sellers"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:'Highlight popular dishes to appear in the "Best Selling" section on the home page.'})]})]})}),jsxRuntimeExports.jsx(Input,{placeholder:"Search dishes...",value:er,onChange:dn=>ir(dn.target.value),className:"bg-secondary border-0"}),Sn.length===0?jsxRuntimeExports.jsxs("div",{className:"text-center py-12",children:[jsxRuntimeExports.jsx(Store$1,{className:"w-12 h-12 text-muted-foreground mx-auto mb-3"}),jsxRuntimeExports.jsx("p",{className:"text-muted-foreground",children:"No dishes available in your zone yet"})]}):Sn.filter(dn=>dn.name.toLowerCase().includes(er.toLowerCase())).map(dn=>{const Es=c.find(po=>po.id===dn.kitchenId);return jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"bg-card rounded-xl p-4 shadow-card flex items-center gap-4",children:[jsxRuntimeExports.jsx("img",{src:dn.image,alt:dn.name,className:"w-16 h-16 rounded-lg object-cover"}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("h3",{className:"font-medium text-foreground",children:dn.name}),dn.isBestSeller&&jsxRuntimeExports.jsxs("span",{className:"px-2 py-0.5 bg-gold text-white text-xs rounded-full flex items-center gap-1",children:[jsxRuntimeExports.jsx(Sparkles,{className:"w-3 h-3"})," Featured"]})]}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground line-clamp-1",children:dn.description}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[jsxRuntimeExports.jsxs("p",{className:"text-xs font-semibold text-primary",children:["",dn.price]}),jsxRuntimeExports.jsx("span",{className:"text-xs text-muted-foreground",children:""}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:(Es==null?void 0:Es.name)||"Unknown Kitchen"})]})]}),jsxRuntimeExports.jsx(Button,{size:"sm",variant:dn.isBestSeller?"secondary":"default",className:cn(dn.isBestSeller?"bg-secondary text-foreground hover:bg-destructive/10 hover:text-destructive":"bg-gold hover:bg-gold/90 text-white"),onClick:()=>ms(dn.id,dn.isBestSeller),children:dn.isBestSeller?"Remove":"Highlight"})]},dn.id)})]}),Nt==="withdrawals"&&jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsx("div",{className:"bg-card rounded-xl p-4 shadow-card mb-4 border-l-4 border-primary",children:jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-4",children:[jsxRuntimeExports.jsx("div",{className:"p-3 bg-primary/10 rounded-full",children:jsxRuntimeExports.jsx(Wallet,{className:"w-6 h-6 text-primary"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-foreground",children:"Withdrawal Requests"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:"Review and approve payout requests from kitchen partners in your zone."})]})]})}),Fs.length===0?jsxRuntimeExports.jsxs("div",{className:"text-center py-12",children:[jsxRuntimeExports.jsx(Wallet,{className:"w-12 h-12 text-muted-foreground mx-auto mb-3"}),jsxRuntimeExports.jsx("p",{className:"text-muted-foreground",children:"No withdrawal requests found"})]}):jsxRuntimeExports.jsx("div",{className:"space-y-3",children:Fs.map(dn=>{const Es=c.find(po=>po.id===dn.kitchenId);return jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-xl p-4 shadow-card",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-start mb-3",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("img",{src:Es==null?void 0:Es.image,alt:"k",className:"w-10 h-10 rounded-lg object-cover bg-secondary"}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-foreground",children:(Es==null?void 0:Es.name)||"Unknown"}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-muted-foreground",children:[new Date(dn.requestedAt).toLocaleDateString()," at ",new Date(dn.requestedAt).toLocaleTimeString()]})]})]}),jsxRuntimeExports.jsx("span",{className:cn("px-2 py-1 rounded-full text-xs font-medium capitalize",dn.status==="approved"?"bg-veg/10 text-veg":dn.status==="rejected"?"bg-destructive/10 text-destructive":"bg-gold/10 text-gold"),children:dn.status})]}),jsxRuntimeExports.jsxs("div",{className:"bg-secondary/50 p-3 rounded-lg mb-4 space-y-2",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-muted-foreground",children:"Amount"}),jsxRuntimeExports.jsxs("span",{className:"text-lg font-bold text-foreground",children:["",dn.amount]})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-muted-foreground",children:"UPI ID"}),jsxRuntimeExports.jsxs("span",{className:"text-sm font-medium flex items-center gap-1",children:[dn.upiId,jsxRuntimeExports.jsxs(Button,{variant:"ghost",size:"icon",className:"h-4 w-4",onClick:()=>{navigator.clipboard.writeText(dn.upiId),ue.success("Copied")},children:[jsxRuntimeExports.jsx("span",{className:"sr-only",children:"Copy"}),jsxRuntimeExports.jsxs("svg",{width:"10",height:"10",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[jsxRuntimeExports.jsx("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"}),jsxRuntimeExports.jsx("path",{d:"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"})]})]})]})]}),dn.qrCodeImage&&jsxRuntimeExports.jsxs("div",{className:"mt-2",children:[jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"QR Code"}),jsxRuntimeExports.jsx("img",{src:dn.qrCodeImage,alt:"QR",className:"w-24 h-24 rounded border bg-white object-contain"})]}),dn.transactionId&&jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center pt-2 border-t border-border/50",children:[jsxRuntimeExports.jsx("span",{className:"text-xs text-muted-foreground",children:"Transaction ID"}),jsxRuntimeExports.jsx("span",{className:"text-xs font-mono",children:dn.transactionId})]}),dn.adminNote&&jsxRuntimeExports.jsx("div",{className:"pt-2 border-t border-border/50",children:jsxRuntimeExports.jsxs("p",{className:"text-xs text-destructive",children:["Rejected Reason: ",dn.adminNote]})})]}),dn.status==="pending"&&jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsxs(Button,{className:"flex-1 bg-veg text-primary-foreground",size:"sm",onClick:()=>{jr({id:dn.id,type:"approve"}),fn("")},children:[jsxRuntimeExports.jsx(Check,{className:"w-4 h-4 mr-2"})," Approve (Paid)"]}),jsxRuntimeExports.jsxs(Button,{className:"flex-1",variant:"destructive",size:"sm",onClick:()=>{jr({id:dn.id,type:"reject"}),fn("")},children:[jsxRuntimeExports.jsx(X,{className:"w-4 h-4 mr-2"})," Reject"]})]})]},dn.id)})})]})]}),un&&jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",children:jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"bg-card w-full max-w-md rounded-2xl shadow-xl overflow-hidden",children:jsxRuntimeExports.jsxs("div",{className:"p-6",children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-semibold mb-2",children:un.type==="approve"?"Approve Withdrawal":"Reject Withdrawal"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:un.type==="approve"?"Please confirm that you have transferred the funds and enter the transaction reference ID below.":"Please provide a reason for rejecting this request."}),jsxRuntimeExports.jsx(Input,{placeholder:un.type==="approve"?"Transaction ID (e.g. UPI Ref No)":"Reason for rejection",value:Jr,onChange:dn=>fn(dn.target.value),className:"mb-4"}),jsxRuntimeExports.jsxs("div",{className:"flex justify-end gap-3",children:[jsxRuntimeExports.jsx(Button,{variant:"ghost",onClick:()=>jr(null),children:"Cancel"}),jsxRuntimeExports.jsx(Button,{disabled:!Jr.trim(),onClick:Vs,className:un.type==="approve"?"bg-veg text-primary-foreground":"bg-destructive text-destructive-foreground",children:"Confirm"})]})]})})})]}):jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background flex flex-col items-center justify-center px-4",children:[jsxRuntimeExports.jsx(TriangleAlert,{className:"w-16 h-16 text-gold mb-4"}),jsxRuntimeExports.jsx("p",{className:"text-muted-foreground mb-4",children:"No franchise assigned to your account"}),jsxRuntimeExports.jsx(Link,{to:"/",children:jsxRuntimeExports.jsx(Button,{className:"gradient-primary text-primary-foreground",children:"Go Home"})})]})}function clamp(e,[i,s]){return Math.min(s,Math.max(i,e))}var OPEN_KEYS=[" ","Enter","ArrowUp","ArrowDown"],SELECTION_KEYS=[" ","Enter"],SELECT_NAME="Select",[Collection,useCollection,createCollectionScope]=createCollection(SELECT_NAME),[createSelectContext,createSelectScope]=createContextScope(SELECT_NAME,[createCollectionScope,createPopperScope]),usePopperScope=createPopperScope(),[SelectProvider,useSelectContext]=createSelectContext(SELECT_NAME),[SelectNativeOptionsProvider,useSelectNativeOptionsContext]=createSelectContext(SELECT_NAME),Select$1=e=>{const{__scopeSelect:i,children:s,open:a,defaultOpen:_,onOpenChange:$,value:rt,defaultValue:c,onValueChange:dt,dir:ht,name:Et,autoComplete:St,disabled:At,required:Pt,form:Vt}=e,Bt=usePopperScope(i),[Zt,zt]=reactExports.useState(null),[Ut,Nt]=reactExports.useState(null),[Gt,er]=reactExports.useState(!1),ir=useDirection(ht),[or,mr]=useControllableState({prop:a,defaultProp:_??!1,onChange:$,caller:SELECT_NAME}),[Rr,on]=useControllableState({prop:rt,defaultProp:c,onChange:dt,caller:SELECT_NAME}),un=reactExports.useRef(null),jr=Zt?Vt||!!Zt.closest("form"):!0,[Jr,fn]=reactExports.useState(new Set),Fr=Array.from(Jr).map(Cr=>Cr.props.value).join(";");return jsxRuntimeExports.jsx(Root2$3,{...Bt,children:jsxRuntimeExports.jsxs(SelectProvider,{required:Pt,scope:i,trigger:Zt,onTriggerChange:zt,valueNode:Ut,onValueNodeChange:Nt,valueNodeHasChildren:Gt,onValueNodeHasChildrenChange:er,contentId:useId(),value:Rr,onValueChange:on,open:or,onOpenChange:mr,dir:ir,triggerPointerDownPosRef:un,disabled:At,children:[jsxRuntimeExports.jsx(Collection.Provider,{scope:i,children:jsxRuntimeExports.jsx(SelectNativeOptionsProvider,{scope:e.__scopeSelect,onNativeOptionAdd:reactExports.useCallback(Cr=>{fn(Sr=>new Set(Sr).add(Cr))},[]),onNativeOptionRemove:reactExports.useCallback(Cr=>{fn(Sr=>{const dr=new Set(Sr);return dr.delete(Cr),dr})},[]),children:s})}),jr?jsxRuntimeExports.jsxs(SelectBubbleInput,{"aria-hidden":!0,required:Pt,tabIndex:-1,name:Et,autoComplete:St,value:Rr,onChange:Cr=>on(Cr.target.value),disabled:At,form:Vt,children:[Rr===void 0?jsxRuntimeExports.jsx("option",{value:""}):null,Array.from(Jr)]},Fr):null]})})};Select$1.displayName=SELECT_NAME;var TRIGGER_NAME="SelectTrigger",SelectTrigger$1=reactExports.forwardRef((e,i)=>{const{__scopeSelect:s,disabled:a=!1,..._}=e,$=usePopperScope(s),rt=useSelectContext(TRIGGER_NAME,s),c=rt.disabled||a,dt=useComposedRefs$1(i,rt.onTriggerChange),ht=useCollection(s),Et=reactExports.useRef("touch"),[St,At,Pt]=useTypeaheadSearch(Bt=>{const Zt=ht().filter(Nt=>!Nt.disabled),zt=Zt.find(Nt=>Nt.value===rt.value),Ut=findNextItem(Zt,Bt,zt);Ut!==void 0&&rt.onValueChange(Ut.value)}),Vt=Bt=>{c||(rt.onOpenChange(!0),Pt()),Bt&&(rt.triggerPointerDownPosRef.current={x:Math.round(Bt.pageX),y:Math.round(Bt.pageY)})};return jsxRuntimeExports.jsx(Anchor,{asChild:!0,...$,children:jsxRuntimeExports.jsx(Primitive.button,{type:"button",role:"combobox","aria-controls":rt.contentId,"aria-expanded":rt.open,"aria-required":rt.required,"aria-autocomplete":"none",dir:rt.dir,"data-state":rt.open?"open":"closed",disabled:c,"data-disabled":c?"":void 0,"data-placeholder":shouldShowPlaceholder(rt.value)?"":void 0,..._,ref:dt,onClick:composeEventHandlers(_.onClick,Bt=>{Bt.currentTarget.focus(),Et.current!=="mouse"&&Vt(Bt)}),onPointerDown:composeEventHandlers(_.onPointerDown,Bt=>{Et.current=Bt.pointerType;const Zt=Bt.target;Zt.hasPointerCapture(Bt.pointerId)&&Zt.releasePointerCapture(Bt.pointerId),Bt.button===0&&Bt.ctrlKey===!1&&Bt.pointerType==="mouse"&&(Vt(Bt),Bt.preventDefault())}),onKeyDown:composeEventHandlers(_.onKeyDown,Bt=>{const Zt=St.current!=="";!(Bt.ctrlKey||Bt.altKey||Bt.metaKey)&&Bt.key.length===1&&At(Bt.key),!(Zt&&Bt.key===" ")&&OPEN_KEYS.includes(Bt.key)&&(Vt(),Bt.preventDefault())})})})});SelectTrigger$1.displayName=TRIGGER_NAME;var VALUE_NAME="SelectValue",SelectValue$1=reactExports.forwardRef((e,i)=>{const{__scopeSelect:s,className:a,style:_,children:$,placeholder:rt="",...c}=e,dt=useSelectContext(VALUE_NAME,s),{onValueNodeHasChildrenChange:ht}=dt,Et=$!==void 0,St=useComposedRefs$1(i,dt.onValueNodeChange);return useLayoutEffect2(()=>{ht(Et)},[ht,Et]),jsxRuntimeExports.jsx(Primitive.span,{...c,ref:St,style:{pointerEvents:"none"},children:shouldShowPlaceholder(dt.value)?jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:rt}):$})});SelectValue$1.displayName=VALUE_NAME;var ICON_NAME="SelectIcon",SelectIcon=reactExports.forwardRef((e,i)=>{const{__scopeSelect:s,children:a,..._}=e;return jsxRuntimeExports.jsx(Primitive.span,{"aria-hidden":!0,..._,ref:i,children:a||""})});SelectIcon.displayName=ICON_NAME;var PORTAL_NAME="SelectPortal",SelectPortal=e=>jsxRuntimeExports.jsx(Portal$2,{asChild:!0,...e});SelectPortal.displayName=PORTAL_NAME;var CONTENT_NAME="SelectContent",SelectContent$1=reactExports.forwardRef((e,i)=>{const s=useSelectContext(CONTENT_NAME,e.__scopeSelect),[a,_]=reactExports.useState();if(useLayoutEffect2(()=>{_(new DocumentFragment)},[]),!s.open){const $=a;return $?reactDomExports.createPortal(jsxRuntimeExports.jsx(SelectContentProvider,{scope:e.__scopeSelect,children:jsxRuntimeExports.jsx(Collection.Slot,{scope:e.__scopeSelect,children:jsxRuntimeExports.jsx("div",{children:e.children})})}),$):null}return jsxRuntimeExports.jsx(SelectContentImpl,{...e,ref:i})});SelectContent$1.displayName=CONTENT_NAME;var CONTENT_MARGIN=10,[SelectContentProvider,useSelectContentContext]=createSelectContext(CONTENT_NAME),CONTENT_IMPL_NAME="SelectContentImpl",Slot=createSlot("SelectContent.RemoveScroll"),SelectContentImpl=reactExports.forwardRef((e,i)=>{const{__scopeSelect:s,position:a="item-aligned",onCloseAutoFocus:_,onEscapeKeyDown:$,onPointerDownOutside:rt,side:c,sideOffset:dt,align:ht,alignOffset:Et,arrowPadding:St,collisionBoundary:At,collisionPadding:Pt,sticky:Vt,hideWhenDetached:Bt,avoidCollisions:Zt,...zt}=e,Ut=useSelectContext(CONTENT_NAME,s),[Nt,Gt]=reactExports.useState(null),[er,ir]=reactExports.useState(null),or=useComposedRefs$1(i,ms=>Gt(ms)),[mr,Rr]=reactExports.useState(null),[on,un]=reactExports.useState(null),jr=useCollection(s),[Jr,fn]=reactExports.useState(!1),Fr=reactExports.useRef(!1);reactExports.useEffect(()=>{if(Nt)return hideOthers(Nt)},[Nt]),useFocusGuards();const Cr=reactExports.useCallback(ms=>{const[On,...ws]=jr().map(lo=>lo.ref.current),[Vs]=ws.slice(-1),ks=document.activeElement;for(const lo of ms)if(lo===ks||(lo==null||lo.scrollIntoView({block:"nearest"}),lo===On&&er&&(er.scrollTop=0),lo===Vs&&er&&(er.scrollTop=er.scrollHeight),lo==null||lo.focus(),document.activeElement!==ks))return},[jr,er]),Sr=reactExports.useCallback(()=>Cr([mr,Nt]),[Cr,mr,Nt]);reactExports.useEffect(()=>{Jr&&Sr()},[Jr,Sr]);const{onOpenChange:dr,triggerPointerDownPosRef:gr}=Ut;reactExports.useEffect(()=>{if(Nt){let ms={x:0,y:0};const On=Vs=>{var ks,lo;ms={x:Math.abs(Math.round(Vs.pageX)-(((ks=gr.current)==null?void 0:ks.x)??0)),y:Math.abs(Math.round(Vs.pageY)-(((lo=gr.current)==null?void 0:lo.y)??0))}},ws=Vs=>{ms.x<=10&&ms.y<=10?Vs.preventDefault():Nt.contains(Vs.target)||dr(!1),document.removeEventListener("pointermove",On),gr.current=null};return gr.current!==null&&(document.addEventListener("pointermove",On),document.addEventListener("pointerup",ws,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",On),document.removeEventListener("pointerup",ws,{capture:!0})}}},[Nt,dr,gr]),reactExports.useEffect(()=>{const ms=()=>dr(!1);return window.addEventListener("blur",ms),window.addEventListener("resize",ms),()=>{window.removeEventListener("blur",ms),window.removeEventListener("resize",ms)}},[dr]);const[qr,Lr]=useTypeaheadSearch(ms=>{const On=jr().filter(ks=>!ks.disabled),ws=On.find(ks=>ks.ref.current===document.activeElement),Vs=findNextItem(On,ms,ws);Vs&&setTimeout(()=>Vs.ref.current.focus())}),_n=reactExports.useCallback((ms,On,ws)=>{const Vs=!Fr.current&&!ws;(Ut.value!==void 0&&Ut.value===On||Vs)&&(Rr(ms),Vs&&(Fr.current=!0))},[Ut.value]),gn=reactExports.useCallback(()=>Nt==null?void 0:Nt.focus(),[Nt]),Sn=reactExports.useCallback((ms,On,ws)=>{const Vs=!Fr.current&&!ws;(Ut.value!==void 0&&Ut.value===On||Vs)&&un(ms)},[Ut.value]),Fs=a==="popper"?SelectPopperPosition:SelectItemAlignedPosition,rs=Fs===SelectPopperPosition?{side:c,sideOffset:dt,align:ht,alignOffset:Et,arrowPadding:St,collisionBoundary:At,collisionPadding:Pt,sticky:Vt,hideWhenDetached:Bt,avoidCollisions:Zt}:{};return jsxRuntimeExports.jsx(SelectContentProvider,{scope:s,content:Nt,viewport:er,onViewportChange:ir,itemRefCallback:_n,selectedItem:mr,onItemLeave:gn,itemTextRefCallback:Sn,focusSelectedItem:Sr,selectedItemText:on,position:a,isPositioned:Jr,searchRef:qr,children:jsxRuntimeExports.jsx(ReactRemoveScroll,{as:Slot,allowPinchZoom:!0,children:jsxRuntimeExports.jsx(FocusScope,{asChild:!0,trapped:Ut.open,onMountAutoFocus:ms=>{ms.preventDefault()},onUnmountAutoFocus:composeEventHandlers(_,ms=>{var On;(On=Ut.trigger)==null||On.focus({preventScroll:!0}),ms.preventDefault()}),children:jsxRuntimeExports.jsx(DismissableLayer,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:$,onPointerDownOutside:rt,onFocusOutside:ms=>ms.preventDefault(),onDismiss:()=>Ut.onOpenChange(!1),children:jsxRuntimeExports.jsx(Fs,{role:"listbox",id:Ut.contentId,"data-state":Ut.open?"open":"closed",dir:Ut.dir,onContextMenu:ms=>ms.preventDefault(),...zt,...rs,onPlaced:()=>fn(!0),ref:or,style:{display:"flex",flexDirection:"column",outline:"none",...zt.style},onKeyDown:composeEventHandlers(zt.onKeyDown,ms=>{const On=ms.ctrlKey||ms.altKey||ms.metaKey;if(ms.key==="Tab"&&ms.preventDefault(),!On&&ms.key.length===1&&Lr(ms.key),["ArrowUp","ArrowDown","Home","End"].includes(ms.key)){let Vs=jr().filter(ks=>!ks.disabled).map(ks=>ks.ref.current);if(["ArrowUp","End"].includes(ms.key)&&(Vs=Vs.slice().reverse()),["ArrowUp","ArrowDown"].includes(ms.key)){const ks=ms.target,lo=Vs.indexOf(ks);Vs=Vs.slice(lo+1)}setTimeout(()=>Cr(Vs)),ms.preventDefault()}})})})})})})});SelectContentImpl.displayName=CONTENT_IMPL_NAME;var ITEM_ALIGNED_POSITION_NAME="SelectItemAlignedPosition",SelectItemAlignedPosition=reactExports.forwardRef((e,i)=>{const{__scopeSelect:s,onPlaced:a,..._}=e,$=useSelectContext(CONTENT_NAME,s),rt=useSelectContentContext(CONTENT_NAME,s),[c,dt]=reactExports.useState(null),[ht,Et]=reactExports.useState(null),St=useComposedRefs$1(i,or=>Et(or)),At=useCollection(s),Pt=reactExports.useRef(!1),Vt=reactExports.useRef(!0),{viewport:Bt,selectedItem:Zt,selectedItemText:zt,focusSelectedItem:Ut}=rt,Nt=reactExports.useCallback(()=>{if($.trigger&&$.valueNode&&c&&ht&&Bt&&Zt&&zt){const or=$.trigger.getBoundingClientRect(),mr=ht.getBoundingClientRect(),Rr=$.valueNode.getBoundingClientRect(),on=zt.getBoundingClientRect();if($.dir!=="rtl"){const ks=on.left-mr.left,lo=Rr.left-ks,ys=or.left-lo,dn=or.width+ys,Es=Math.max(dn,mr.width),po=window.innerWidth-CONTENT_MARGIN,no=clamp(lo,[CONTENT_MARGIN,Math.max(CONTENT_MARGIN,po-Es)]);c.style.minWidth=dn+"px",c.style.left=no+"px"}else{const ks=mr.right-on.right,lo=window.innerWidth-Rr.right-ks,ys=window.innerWidth-or.right-lo,dn=or.width+ys,Es=Math.max(dn,mr.width),po=window.innerWidth-CONTENT_MARGIN,no=clamp(lo,[CONTENT_MARGIN,Math.max(CONTENT_MARGIN,po-Es)]);c.style.minWidth=dn+"px",c.style.right=no+"px"}const un=At(),jr=window.innerHeight-CONTENT_MARGIN*2,Jr=Bt.scrollHeight,fn=window.getComputedStyle(ht),Fr=parseInt(fn.borderTopWidth,10),Cr=parseInt(fn.paddingTop,10),Sr=parseInt(fn.borderBottomWidth,10),dr=parseInt(fn.paddingBottom,10),gr=Fr+Cr+Jr+dr+Sr,qr=Math.min(Zt.offsetHeight*5,gr),Lr=window.getComputedStyle(Bt),_n=parseInt(Lr.paddingTop,10),gn=parseInt(Lr.paddingBottom,10),Sn=or.top+or.height/2-CONTENT_MARGIN,Fs=jr-Sn,rs=Zt.offsetHeight/2,ms=Zt.offsetTop+rs,On=Fr+Cr+ms,ws=gr-On;if(On<=Sn){const ks=un.length>0&&Zt===un[un.length-1].ref.current;c.style.bottom="0px";const lo=ht.clientHeight-Bt.offsetTop-Bt.offsetHeight,ys=Math.max(Fs,rs+(ks?gn:0)+lo+Sr),dn=On+ys;c.style.height=dn+"px"}else{const ks=un.length>0&&Zt===un[0].ref.current;c.style.top="0px";const ys=Math.max(Sn,Fr+Bt.offsetTop+(ks?_n:0)+rs)+ws;c.style.height=ys+"px",Bt.scrollTop=On-Sn+Bt.offsetTop}c.style.margin=`${CONTENT_MARGIN}px 0`,c.style.minHeight=qr+"px",c.style.maxHeight=jr+"px",a==null||a(),requestAnimationFrame(()=>Pt.current=!0)}},[At,$.trigger,$.valueNode,c,ht,Bt,Zt,zt,$.dir,a]);useLayoutEffect2(()=>Nt(),[Nt]);const[Gt,er]=reactExports.useState();useLayoutEffect2(()=>{ht&&er(window.getComputedStyle(ht).zIndex)},[ht]);const ir=reactExports.useCallback(or=>{or&&Vt.current===!0&&(Nt(),Ut==null||Ut(),Vt.current=!1)},[Nt,Ut]);return jsxRuntimeExports.jsx(SelectViewportProvider,{scope:s,contentWrapper:c,shouldExpandOnScrollRef:Pt,onScrollButtonChange:ir,children:jsxRuntimeExports.jsx("div",{ref:dt,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:Gt},children:jsxRuntimeExports.jsx(Primitive.div,{..._,ref:St,style:{boxSizing:"border-box",maxHeight:"100%",..._.style}})})})});SelectItemAlignedPosition.displayName=ITEM_ALIGNED_POSITION_NAME;var POPPER_POSITION_NAME="SelectPopperPosition",SelectPopperPosition=reactExports.forwardRef((e,i)=>{const{__scopeSelect:s,align:a="start",collisionPadding:_=CONTENT_MARGIN,...$}=e,rt=usePopperScope(s);return jsxRuntimeExports.jsx(Content$2,{...rt,...$,ref:i,align:a,collisionPadding:_,style:{boxSizing:"border-box",...$.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});SelectPopperPosition.displayName=POPPER_POSITION_NAME;var[SelectViewportProvider,useSelectViewportContext]=createSelectContext(CONTENT_NAME,{}),VIEWPORT_NAME="SelectViewport",SelectViewport=reactExports.forwardRef((e,i)=>{const{__scopeSelect:s,nonce:a,..._}=e,$=useSelectContentContext(VIEWPORT_NAME,s),rt=useSelectViewportContext(VIEWPORT_NAME,s),c=useComposedRefs$1(i,$.onViewportChange),dt=reactExports.useRef(0);return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:a}),jsxRuntimeExports.jsx(Collection.Slot,{scope:s,children:jsxRuntimeExports.jsx(Primitive.div,{"data-radix-select-viewport":"",role:"presentation",..._,ref:c,style:{position:"relative",flex:1,overflow:"hidden auto",..._.style},onScroll:composeEventHandlers(_.onScroll,ht=>{const Et=ht.currentTarget,{contentWrapper:St,shouldExpandOnScrollRef:At}=rt;if(At!=null&&At.current&&St){const Pt=Math.abs(dt.current-Et.scrollTop);if(Pt>0){const Vt=window.innerHeight-CONTENT_MARGIN*2,Bt=parseFloat(St.style.minHeight),Zt=parseFloat(St.style.height),zt=Math.max(Bt,Zt);if(zt<Vt){const Ut=zt+Pt,Nt=Math.min(Vt,Ut),Gt=Ut-Nt;St.style.height=Nt+"px",St.style.bottom==="0px"&&(Et.scrollTop=Gt>0?Gt:0,St.style.justifyContent="flex-end")}}}dt.current=Et.scrollTop})})})]})});SelectViewport.displayName=VIEWPORT_NAME;var GROUP_NAME="SelectGroup",[SelectGroupContextProvider,useSelectGroupContext]=createSelectContext(GROUP_NAME),SelectGroup=reactExports.forwardRef((e,i)=>{const{__scopeSelect:s,...a}=e,_=useId();return jsxRuntimeExports.jsx(SelectGroupContextProvider,{scope:s,id:_,children:jsxRuntimeExports.jsx(Primitive.div,{role:"group","aria-labelledby":_,...a,ref:i})})});SelectGroup.displayName=GROUP_NAME;var LABEL_NAME="SelectLabel",SelectLabel$1=reactExports.forwardRef((e,i)=>{const{__scopeSelect:s,...a}=e,_=useSelectGroupContext(LABEL_NAME,s);return jsxRuntimeExports.jsx(Primitive.div,{id:_.id,...a,ref:i})});SelectLabel$1.displayName=LABEL_NAME;var ITEM_NAME="SelectItem",[SelectItemContextProvider,useSelectItemContext]=createSelectContext(ITEM_NAME),SelectItem$1=reactExports.forwardRef((e,i)=>{const{__scopeSelect:s,value:a,disabled:_=!1,textValue:$,...rt}=e,c=useSelectContext(ITEM_NAME,s),dt=useSelectContentContext(ITEM_NAME,s),ht=c.value===a,[Et,St]=reactExports.useState($??""),[At,Pt]=reactExports.useState(!1),Vt=useComposedRefs$1(i,Ut=>{var Nt;return(Nt=dt.itemRefCallback)==null?void 0:Nt.call(dt,Ut,a,_)}),Bt=useId(),Zt=reactExports.useRef("touch"),zt=()=>{_||(c.onValueChange(a),c.onOpenChange(!1))};if(a==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return jsxRuntimeExports.jsx(SelectItemContextProvider,{scope:s,value:a,disabled:_,textId:Bt,isSelected:ht,onItemTextChange:reactExports.useCallback(Ut=>{St(Nt=>Nt||((Ut==null?void 0:Ut.textContent)??"").trim())},[]),children:jsxRuntimeExports.jsx(Collection.ItemSlot,{scope:s,value:a,disabled:_,textValue:Et,children:jsxRuntimeExports.jsx(Primitive.div,{role:"option","aria-labelledby":Bt,"data-highlighted":At?"":void 0,"aria-selected":ht&&At,"data-state":ht?"checked":"unchecked","aria-disabled":_||void 0,"data-disabled":_?"":void 0,tabIndex:_?void 0:-1,...rt,ref:Vt,onFocus:composeEventHandlers(rt.onFocus,()=>Pt(!0)),onBlur:composeEventHandlers(rt.onBlur,()=>Pt(!1)),onClick:composeEventHandlers(rt.onClick,()=>{Zt.current!=="mouse"&&zt()}),onPointerUp:composeEventHandlers(rt.onPointerUp,()=>{Zt.current==="mouse"&&zt()}),onPointerDown:composeEventHandlers(rt.onPointerDown,Ut=>{Zt.current=Ut.pointerType}),onPointerMove:composeEventHandlers(rt.onPointerMove,Ut=>{var Nt;Zt.current=Ut.pointerType,_?(Nt=dt.onItemLeave)==null||Nt.call(dt):Zt.current==="mouse"&&Ut.currentTarget.focus({preventScroll:!0})}),onPointerLeave:composeEventHandlers(rt.onPointerLeave,Ut=>{var Nt;Ut.currentTarget===document.activeElement&&((Nt=dt.onItemLeave)==null||Nt.call(dt))}),onKeyDown:composeEventHandlers(rt.onKeyDown,Ut=>{var Gt;((Gt=dt.searchRef)==null?void 0:Gt.current)!==""&&Ut.key===" "||(SELECTION_KEYS.includes(Ut.key)&&zt(),Ut.key===" "&&Ut.preventDefault())})})})})});SelectItem$1.displayName=ITEM_NAME;var ITEM_TEXT_NAME="SelectItemText",SelectItemText=reactExports.forwardRef((e,i)=>{const{__scopeSelect:s,className:a,style:_,...$}=e,rt=useSelectContext(ITEM_TEXT_NAME,s),c=useSelectContentContext(ITEM_TEXT_NAME,s),dt=useSelectItemContext(ITEM_TEXT_NAME,s),ht=useSelectNativeOptionsContext(ITEM_TEXT_NAME,s),[Et,St]=reactExports.useState(null),At=useComposedRefs$1(i,zt=>St(zt),dt.onItemTextChange,zt=>{var Ut;return(Ut=c.itemTextRefCallback)==null?void 0:Ut.call(c,zt,dt.value,dt.disabled)}),Pt=Et==null?void 0:Et.textContent,Vt=reactExports.useMemo(()=>jsxRuntimeExports.jsx("option",{value:dt.value,disabled:dt.disabled,children:Pt},dt.value),[dt.disabled,dt.value,Pt]),{onNativeOptionAdd:Bt,onNativeOptionRemove:Zt}=ht;return useLayoutEffect2(()=>(Bt(Vt),()=>Zt(Vt)),[Bt,Zt,Vt]),jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Primitive.span,{id:dt.textId,...$,ref:At}),dt.isSelected&&rt.valueNode&&!rt.valueNodeHasChildren?reactDomExports.createPortal($.children,rt.valueNode):null]})});SelectItemText.displayName=ITEM_TEXT_NAME;var ITEM_INDICATOR_NAME="SelectItemIndicator",SelectItemIndicator=reactExports.forwardRef((e,i)=>{const{__scopeSelect:s,...a}=e;return useSelectItemContext(ITEM_INDICATOR_NAME,s).isSelected?jsxRuntimeExports.jsx(Primitive.span,{"aria-hidden":!0,...a,ref:i}):null});SelectItemIndicator.displayName=ITEM_INDICATOR_NAME;var SCROLL_UP_BUTTON_NAME="SelectScrollUpButton",SelectScrollUpButton$1=reactExports.forwardRef((e,i)=>{const s=useSelectContentContext(SCROLL_UP_BUTTON_NAME,e.__scopeSelect),a=useSelectViewportContext(SCROLL_UP_BUTTON_NAME,e.__scopeSelect),[_,$]=reactExports.useState(!1),rt=useComposedRefs$1(i,a.onScrollButtonChange);return useLayoutEffect2(()=>{if(s.viewport&&s.isPositioned){let c=function(){const ht=dt.scrollTop>0;$(ht)};const dt=s.viewport;return c(),dt.addEventListener("scroll",c),()=>dt.removeEventListener("scroll",c)}},[s.viewport,s.isPositioned]),_?jsxRuntimeExports.jsx(SelectScrollButtonImpl,{...e,ref:rt,onAutoScroll:()=>{const{viewport:c,selectedItem:dt}=s;c&&dt&&(c.scrollTop=c.scrollTop-dt.offsetHeight)}}):null});SelectScrollUpButton$1.displayName=SCROLL_UP_BUTTON_NAME;var SCROLL_DOWN_BUTTON_NAME="SelectScrollDownButton",SelectScrollDownButton$1=reactExports.forwardRef((e,i)=>{const s=useSelectContentContext(SCROLL_DOWN_BUTTON_NAME,e.__scopeSelect),a=useSelectViewportContext(SCROLL_DOWN_BUTTON_NAME,e.__scopeSelect),[_,$]=reactExports.useState(!1),rt=useComposedRefs$1(i,a.onScrollButtonChange);return useLayoutEffect2(()=>{if(s.viewport&&s.isPositioned){let c=function(){const ht=dt.scrollHeight-dt.clientHeight,Et=Math.ceil(dt.scrollTop)<ht;$(Et)};const dt=s.viewport;return c(),dt.addEventListener("scroll",c),()=>dt.removeEventListener("scroll",c)}},[s.viewport,s.isPositioned]),_?jsxRuntimeExports.jsx(SelectScrollButtonImpl,{...e,ref:rt,onAutoScroll:()=>{const{viewport:c,selectedItem:dt}=s;c&&dt&&(c.scrollTop=c.scrollTop+dt.offsetHeight)}}):null});SelectScrollDownButton$1.displayName=SCROLL_DOWN_BUTTON_NAME;var SelectScrollButtonImpl=reactExports.forwardRef((e,i)=>{const{__scopeSelect:s,onAutoScroll:a,..._}=e,$=useSelectContentContext("SelectScrollButton",s),rt=reactExports.useRef(null),c=useCollection(s),dt=reactExports.useCallback(()=>{rt.current!==null&&(window.clearInterval(rt.current),rt.current=null)},[]);return reactExports.useEffect(()=>()=>dt(),[dt]),useLayoutEffect2(()=>{var Et;const ht=c().find(St=>St.ref.current===document.activeElement);(Et=ht==null?void 0:ht.ref.current)==null||Et.scrollIntoView({block:"nearest"})},[c]),jsxRuntimeExports.jsx(Primitive.div,{"aria-hidden":!0,..._,ref:i,style:{flexShrink:0,..._.style},onPointerDown:composeEventHandlers(_.onPointerDown,()=>{rt.current===null&&(rt.current=window.setInterval(a,50))}),onPointerMove:composeEventHandlers(_.onPointerMove,()=>{var ht;(ht=$.onItemLeave)==null||ht.call($),rt.current===null&&(rt.current=window.setInterval(a,50))}),onPointerLeave:composeEventHandlers(_.onPointerLeave,()=>{dt()})})}),SEPARATOR_NAME="SelectSeparator",SelectSeparator$1=reactExports.forwardRef((e,i)=>{const{__scopeSelect:s,...a}=e;return jsxRuntimeExports.jsx(Primitive.div,{"aria-hidden":!0,...a,ref:i})});SelectSeparator$1.displayName=SEPARATOR_NAME;var ARROW_NAME="SelectArrow",SelectArrow=reactExports.forwardRef((e,i)=>{const{__scopeSelect:s,...a}=e,_=usePopperScope(s),$=useSelectContext(ARROW_NAME,s),rt=useSelectContentContext(ARROW_NAME,s);return $.open&&rt.position==="popper"?jsxRuntimeExports.jsx(Arrow,{..._,...a,ref:i}):null});SelectArrow.displayName=ARROW_NAME;var BUBBLE_INPUT_NAME="SelectBubbleInput",SelectBubbleInput=reactExports.forwardRef(({__scopeSelect:e,value:i,...s},a)=>{const _=reactExports.useRef(null),$=useComposedRefs$1(a,_),rt=usePrevious(i);return reactExports.useEffect(()=>{const c=_.current;if(!c)return;const dt=window.HTMLSelectElement.prototype,Et=Object.getOwnPropertyDescriptor(dt,"value").set;if(rt!==i&&Et){const St=new Event("change",{bubbles:!0});Et.call(c,i),c.dispatchEvent(St)}},[rt,i]),jsxRuntimeExports.jsx(Primitive.select,{...s,style:{...VISUALLY_HIDDEN_STYLES,...s.style},ref:$,defaultValue:i})});SelectBubbleInput.displayName=BUBBLE_INPUT_NAME;function shouldShowPlaceholder(e){return e===""||e===void 0}function useTypeaheadSearch(e){const i=useCallbackRef$1(e),s=reactExports.useRef(""),a=reactExports.useRef(0),_=reactExports.useCallback(rt=>{const c=s.current+rt;i(c),function dt(ht){s.current=ht,window.clearTimeout(a.current),ht!==""&&(a.current=window.setTimeout(()=>dt(""),1e3))}(c)},[i]),$=reactExports.useCallback(()=>{s.current="",window.clearTimeout(a.current)},[]);return reactExports.useEffect(()=>()=>window.clearTimeout(a.current),[]),[s,_,$]}function findNextItem(e,i,s){const _=i.length>1&&Array.from(i).every(ht=>ht===i[0])?i[0]:i,$=s?e.indexOf(s):-1;let rt=wrapArray(e,Math.max($,0));_.length===1&&(rt=rt.filter(ht=>ht!==s));const dt=rt.find(ht=>ht.textValue.toLowerCase().startsWith(_.toLowerCase()));return dt!==s?dt:void 0}function wrapArray(e,i){return e.map((s,a)=>e[(i+a)%e.length])}var Root2=Select$1,Trigger=SelectTrigger$1,Value=SelectValue$1,Icon=SelectIcon,Portal=SelectPortal,Content2=SelectContent$1,Viewport=SelectViewport,Label=SelectLabel$1,Item=SelectItem$1,ItemText=SelectItemText,ItemIndicator=SelectItemIndicator,ScrollUpButton=SelectScrollUpButton$1,ScrollDownButton=SelectScrollDownButton$1,Separator=SelectSeparator$1;const Select=Root2,SelectValue=Value,SelectTrigger=reactExports.forwardRef(({className:e,children:i,...s},a)=>jsxRuntimeExports.jsxs(Trigger,{ref:a,className:cn("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",e),...s,children:[i,jsxRuntimeExports.jsx(Icon,{asChild:!0,children:jsxRuntimeExports.jsx(ChevronDown,{className:"h-4 w-4 opacity-50"})})]}));SelectTrigger.displayName=Trigger.displayName;const SelectScrollUpButton=reactExports.forwardRef(({className:e,...i},s)=>jsxRuntimeExports.jsx(ScrollUpButton,{ref:s,className:cn("flex cursor-default items-center justify-center py-1",e),...i,children:jsxRuntimeExports.jsx(ChevronUp,{className:"h-4 w-4"})}));SelectScrollUpButton.displayName=ScrollUpButton.displayName;const SelectScrollDownButton=reactExports.forwardRef(({className:e,...i},s)=>jsxRuntimeExports.jsx(ScrollDownButton,{ref:s,className:cn("flex cursor-default items-center justify-center py-1",e),...i,children:jsxRuntimeExports.jsx(ChevronDown,{className:"h-4 w-4"})}));SelectScrollDownButton.displayName=ScrollDownButton.displayName;const SelectContent=reactExports.forwardRef(({className:e,children:i,position:s="popper",...a},_)=>jsxRuntimeExports.jsx(Portal,{children:jsxRuntimeExports.jsxs(Content2,{ref:_,className:cn("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:s,...a,children:[jsxRuntimeExports.jsx(SelectScrollUpButton,{}),jsxRuntimeExports.jsx(Viewport,{className:cn("p-1",s==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:i}),jsxRuntimeExports.jsx(SelectScrollDownButton,{})]})}));SelectContent.displayName=Content2.displayName;const SelectLabel=reactExports.forwardRef(({className:e,...i},s)=>jsxRuntimeExports.jsx(Label,{ref:s,className:cn("py-1.5 pl-8 pr-2 text-sm font-semibold",e),...i}));SelectLabel.displayName=Label.displayName;const SelectItem=reactExports.forwardRef(({className:e,children:i,...s},a)=>jsxRuntimeExports.jsxs(Item,{ref:a,className:cn("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",e),...s,children:[jsxRuntimeExports.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:jsxRuntimeExports.jsx(ItemIndicator,{children:jsxRuntimeExports.jsx(Check,{className:"h-4 w-4"})})}),jsxRuntimeExports.jsx(ItemText,{children:i})]}));SelectItem.displayName=Item.displayName;const SelectSeparator=reactExports.forwardRef(({className:e,...i},s)=>jsxRuntimeExports.jsx(Separator,{ref:s,className:cn("-mx-1 my-1 h-px bg-muted",e),...i}));SelectSeparator.displayName=Separator.displayName;const Dialog=Root$1,DialogTrigger=Trigger$2,DialogPortal=Portal$1,DialogOverlay=reactExports.forwardRef(({className:e,...i},s)=>jsxRuntimeExports.jsx(Overlay,{ref:s,className:cn("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...i}));DialogOverlay.displayName=Overlay.displayName;const DialogContent=reactExports.forwardRef(({className:e,children:i,...s},a)=>jsxRuntimeExports.jsxs(DialogPortal,{children:[jsxRuntimeExports.jsx(DialogOverlay,{}),jsxRuntimeExports.jsxs(Content$1,{ref:a,className:cn("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...s,children:[i,jsxRuntimeExports.jsxs(Close,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity data-[state=open]:bg-accent data-[state=open]:text-muted-foreground hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none",children:[jsxRuntimeExports.jsx(X,{className:"h-4 w-4"}),jsxRuntimeExports.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));DialogContent.displayName=Content$1.displayName;const DialogHeader=({className:e,...i})=>jsxRuntimeExports.jsx("div",{className:cn("flex flex-col space-y-1.5 text-center sm:text-left",e),...i});DialogHeader.displayName="DialogHeader";const DialogTitle=reactExports.forwardRef(({className:e,...i},s)=>jsxRuntimeExports.jsx(Title,{ref:s,className:cn("text-lg font-semibold leading-none tracking-tight",e),...i}));DialogTitle.displayName=Title.displayName;const DialogDescription=reactExports.forwardRef(({className:e,...i},s)=>jsxRuntimeExports.jsx(Description,{ref:s,className:cn("text-sm text-muted-foreground",e),...i}));DialogDescription.displayName=Description.displayName;const classes={CANVAS:"mapboxgl-canvas",CONTROL_BASE:"mapboxgl-ctrl",CONTROL_PREFIX:"mapboxgl-ctrl-",CONTROL_BUTTON:"mapbox-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"mapbox-gl-draw_line",CONTROL_BUTTON_POLYGON:"mapbox-gl-draw_polygon",CONTROL_BUTTON_POINT:"mapbox-gl-draw_point",CONTROL_BUTTON_TRASH:"mapbox-gl-draw_trash",CONTROL_BUTTON_COMBINE_FEATURES:"mapbox-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"mapbox-gl-draw_uncombine",CONTROL_GROUP:"mapboxgl-ctrl-group",ATTRIBUTION:"mapboxgl-ctrl-attrib",ACTIVE_BUTTON:"active",BOX_SELECT:"mapbox-gl-draw_boxselect"},sources={HOT:"mapbox-gl-draw-hot",COLD:"mapbox-gl-draw-cold"},cursors={ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},types$1={POLYGON:"polygon",LINE:"line_string",POINT:"point"},geojsonTypes={FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},modes$1={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select"},events$1={CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},updateActions={MOVE:"move",CHANGE_PROPERTIES:"change_properties",CHANGE_COORDINATES:"change_coordinates"},meta={FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},activeStates={ACTIVE:"true",INACTIVE:"false"},interactions=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],LAT_MIN$1=-90,LAT_RENDERED_MIN$1=-85,LAT_MAX$1=90,LAT_RENDERED_MAX$1=85,LNG_MIN$1=-270,LNG_MAX$1=270,Constants=Object.freeze(Object.defineProperty({__proto__:null,LAT_MAX:LAT_MAX$1,LAT_MIN:LAT_MIN$1,LAT_RENDERED_MAX:LAT_RENDERED_MAX$1,LAT_RENDERED_MIN:LAT_RENDERED_MIN$1,LNG_MAX:LNG_MAX$1,LNG_MIN:LNG_MIN$1,activeStates,classes,cursors,events:events$1,geojsonTypes,interactions,meta,modes:modes$1,sources,types:types$1,updateActions},Symbol.toStringTag,{value:"Module"}));function isOfMetaType(e){return function(i){const s=i.featureTarget;return!s||!s.properties?!1:s.properties.meta===e}}function isShiftMousedown(e){return!e.originalEvent||!e.originalEvent.shiftKey?!1:e.originalEvent.button===0}function isActiveFeature(e){return!e.featureTarget||!e.featureTarget.properties?!1:e.featureTarget.properties.active===activeStates.ACTIVE&&e.featureTarget.properties.meta===meta.FEATURE}function isInactiveFeature(e){return!e.featureTarget||!e.featureTarget.properties?!1:e.featureTarget.properties.active===activeStates.INACTIVE&&e.featureTarget.properties.meta===meta.FEATURE}function noTarget(e){return e.featureTarget===void 0}function isFeature(e){return!e.featureTarget||!e.featureTarget.properties?!1:e.featureTarget.properties.meta===meta.FEATURE}function isVertex$1(e){const i=e.featureTarget;return!i||!i.properties?!1:i.properties.meta===meta.VERTEX}function isShiftDown(e){return e.originalEvent?e.originalEvent.shiftKey===!0:!1}function isEscapeKey(e){return e.key==="Escape"||e.keyCode===27}function isEnterKey(e){return e.key==="Enter"||e.keyCode===13}function isBackspaceKey(e){return e.key==="Backspace"||e.keyCode===8}function isDeleteKey(e){return e.key==="Delete"||e.keyCode===46}function isDigit1Key(e){return e.key==="1"||e.keyCode===49}function isDigit2Key(e){return e.key==="2"||e.keyCode===50}function isDigit3Key(e){return e.key==="3"||e.keyCode===51}function isDigitKey(e){const i=e.key||String.fromCharCode(e.keyCode);return i>="0"&&i<="9"}function isTrue(){return!0}const common_selectors=Object.freeze(Object.defineProperty({__proto__:null,isActiveFeature,isBackspaceKey,isDeleteKey,isDigit1Key,isDigit2Key,isDigit3Key,isDigitKey,isEnterKey,isEscapeKey,isFeature,isInactiveFeature,isOfMetaType,isShiftDown,isShiftMousedown,isTrue,isVertex:isVertex$1,noTarget},Symbol.toStringTag,{value:"Module"}));var geojsonArea={},wgs84$1={};wgs84$1.RADIUS=6378137;wgs84$1.FLATTENING=1/298.257223563;wgs84$1.POLAR_RADIUS=63567523142e-4;var wgs84=wgs84$1;geojsonArea.geometry=geometry;geojsonArea.ring=ringArea;function geometry(e){var i=0,s;switch(e.type){case"Polygon":return polygonArea(e.coordinates);case"MultiPolygon":for(s=0;s<e.coordinates.length;s++)i+=polygonArea(e.coordinates[s]);return i;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(s=0;s<e.geometries.length;s++)i+=geometry(e.geometries[s]);return i}}function polygonArea(e){var i=0;if(e&&e.length>0){i+=Math.abs(ringArea(e[0]));for(var s=1;s<e.length;s++)i-=Math.abs(ringArea(e[s]))}return i}function ringArea(e){var i,s,a,_,$,rt,c,dt=0,ht=e.length;if(ht>2){for(c=0;c<ht;c++)c===ht-2?(_=ht-2,$=ht-1,rt=0):c===ht-1?(_=ht-1,$=0,rt=1):(_=c,$=c+1,rt=c+2),i=e[_],s=e[$],a=e[rt],dt+=(rad(a[0])-rad(i[0]))*Math.sin(rad(s[1]));dt=dt*wgs84.RADIUS*wgs84.RADIUS/2}return dt}function rad(e){return e*Math.PI/180}const FEATURE_SORT_RANKS={Point:0,LineString:1,MultiLineString:1,Polygon:2};function comparator(e,i){const s=FEATURE_SORT_RANKS[e.geometry.type]-FEATURE_SORT_RANKS[i.geometry.type];return s===0&&e.geometry.type===geojsonTypes.POLYGON?e.area-i.area:s}function sortFeatures(e){return e.map(i=>(i.geometry.type===geojsonTypes.POLYGON&&(i.area=geojsonArea.geometry({type:geojsonTypes.FEATURE,property:{},geometry:i.geometry})),i)).sort(comparator).map(i=>(delete i.area,i))}function mapEventToBoundingBox(e,i=0){return[[e.point.x-i,e.point.y-i],[e.point.x+i,e.point.y+i]]}function StringSet(e){if(this._items={},this._nums={},this._length=e?e.length:0,!!e)for(let i=0,s=e.length;i<s;i++)this.add(e[i]),e[i]!==void 0&&(typeof e[i]=="string"?this._items[e[i]]=i:this._nums[e[i]]=i)}StringSet.prototype.add=function(e){return this.has(e)?this:(this._length++,typeof e=="string"?this._items[e]=this._length:this._nums[e]=this._length,this)};StringSet.prototype.delete=function(e){return this.has(e)===!1?this:(this._length--,delete this._items[e],delete this._nums[e],this)};StringSet.prototype.has=function(e){return typeof e!="string"&&typeof e!="number"?!1:this._items[e]!==void 0||this._nums[e]!==void 0};StringSet.prototype.values=function(){const e=[];return Object.keys(this._items).forEach(i=>{e.push({k:i,v:this._items[i]})}),Object.keys(this._nums).forEach(i=>{e.push({k:JSON.parse(i),v:this._nums[i]})}),e.sort((i,s)=>i.v-s.v).map(i=>i.k)};StringSet.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};const META_TYPES=[meta.FEATURE,meta.MIDPOINT,meta.VERTEX],featuresAt={click:featuresAtClick,touch:featuresAtTouch};function featuresAtClick(e,i,s){return featuresAt$1(e,i,s,s.options.clickBuffer)}function featuresAtTouch(e,i,s){return featuresAt$1(e,i,s,s.options.touchBuffer)}function featuresAt$1(e,i,s,a){if(s.map===null)return[];const _=e?mapEventToBoundingBox(e,a):i,$={};s.options.styles&&($.layers=s.options.styles.map(ht=>ht.id).filter(ht=>s.map.getLayer(ht)!=null));const rt=s.map.queryRenderedFeatures(_,$).filter(ht=>META_TYPES.indexOf(ht.properties.meta)!==-1),c=new StringSet,dt=[];return rt.forEach(ht=>{const Et=ht.properties.id;c.has(Et)||(c.add(Et),dt.push(ht))}),sortFeatures(dt)}function getFeatureAtAndSetCursors(e,i){const s=featuresAt.click(e,null,i),a={mouse:cursors.NONE};return s[0]&&(a.mouse=s[0].properties.active===activeStates.ACTIVE?cursors.MOVE:cursors.POINTER,a.feature=s[0].properties.meta),i.events.currentModeName().indexOf("draw")!==-1&&(a.mouse=cursors.ADD),i.ui.queueMapClasses(a),i.ui.updateMapClasses(),s[0]}function euclideanDistance(e,i){const s=e.x-i.x,a=e.y-i.y;return Math.sqrt(s*s+a*a)}const FINE_TOLERANCE=4,GROSS_TOLERANCE=12,INTERVAL=500;function isClick(e,i,s={}){const a=s.fineTolerance!=null?s.fineTolerance:FINE_TOLERANCE,_=s.grossTolerance!=null?s.grossTolerance:GROSS_TOLERANCE,$=s.interval!=null?s.interval:INTERVAL;e.point=e.point||i.point,e.time=e.time||i.time;const rt=euclideanDistance(e.point,i.point);return rt<a||rt<_&&i.time-e.time<$}const TAP_TOLERANCE=25,TAP_INTERVAL=250;function isTap(e,i,s={}){const a=s.tolerance!=null?s.tolerance:TAP_TOLERANCE,_=s.interval!=null?s.interval:TAP_INTERVAL;return e.point=e.point||i.point,e.time=e.time||i.time,euclideanDistance(e.point,i.point)<a&&i.time-e.time<_}const ModeHandler=function(e,i){const s={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},a={on($,rt,c){if(s[$]===void 0)throw new Error(`Invalid event type: ${$}`);s[$].push({selector:rt,fn:c})},render($){i.store.featureChanged($)}},_=function($,rt){const c=s[$];let dt=c.length;for(;dt--;){const ht=c[dt];if(ht.selector(rt)){ht.fn.call(a,rt)||i.store.render(),i.ui.updateMapClasses();break}}};return e.start.call(a),{render:e.render,stop(){e.stop&&e.stop()},trash(){e.trash&&(e.trash(),i.store.render())},combineFeatures(){e.combineFeatures&&e.combineFeatures()},uncombineFeatures(){e.uncombineFeatures&&e.uncombineFeatures()},drag($){_("drag",$)},click($){_("click",$)},mousemove($){_("mousemove",$)},mousedown($){_("mousedown",$)},mouseup($){_("mouseup",$)},mouseout($){_("mouseout",$)},keydown($){_("keydown",$)},keyup($){_("keyup",$)},touchstart($){_("touchstart",$)},touchmove($){_("touchmove",$)},touchend($){_("touchend",$)},tap($){_("tap",$)}}};let customAlphabet=(e,i=21)=>(s=i)=>{let a="",_=s|0;for(;_--;)a+=e[Math.random()*e.length|0];return a};const nanoid=customAlphabet("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",32);function generateID(){return nanoid()}const Feature=function(e,i){this.ctx=e,this.properties=i.properties||{},this.coordinates=i.geometry.coordinates,this.id=i.id||generateID(),this.type=i.geometry.type};Feature.prototype.changed=function(){this.ctx.store.featureChanged(this.id)};Feature.prototype.incomingCoords=function(e){this.setCoordinates(e)};Feature.prototype.setCoordinates=function(e){this.coordinates=e,this.changed()};Feature.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))};Feature.prototype.setProperty=function(e,i){this.properties[e]=i};Feature.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:geojsonTypes.FEATURE,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))};Feature.prototype.internal=function(e){const i={id:this.id,meta:meta.FEATURE,"meta:type":this.type,active:activeStates.INACTIVE,mode:e};if(this.ctx.options.userProperties)for(const s in this.properties)i[`user_${s}`]=this.properties[s];return{type:geojsonTypes.FEATURE,properties:i,geometry:{coordinates:this.getCoordinates(),type:this.type}}};const Point$1=function(e,i){Feature.call(this,e,i)};Point$1.prototype=Object.create(Feature.prototype);Point$1.prototype.isValid=function(){return typeof this.coordinates[0]=="number"&&typeof this.coordinates[1]=="number"};Point$1.prototype.updateCoordinate=function(e,i,s){arguments.length===3?this.coordinates=[i,s]:this.coordinates=[e,i],this.changed()};Point$1.prototype.getCoordinate=function(){return this.getCoordinates()};const LineString=function(e,i){Feature.call(this,e,i)};LineString.prototype=Object.create(Feature.prototype);LineString.prototype.isValid=function(){return this.coordinates.length>1};LineString.prototype.addCoordinate=function(e,i,s){this.changed();const a=parseInt(e,10);this.coordinates.splice(a,0,[i,s])};LineString.prototype.getCoordinate=function(e){const i=parseInt(e,10);return JSON.parse(JSON.stringify(this.coordinates[i]))};LineString.prototype.removeCoordinate=function(e){this.changed(),this.coordinates.splice(parseInt(e,10),1)};LineString.prototype.updateCoordinate=function(e,i,s){const a=parseInt(e,10);this.coordinates[a]=[i,s],this.changed()};const Polygon=function(e,i){Feature.call(this,e,i),this.coordinates=this.coordinates.map(s=>s.slice(0,-1))};Polygon.prototype=Object.create(Feature.prototype);Polygon.prototype.isValid=function(){return this.coordinates.length===0?!1:this.coordinates.every(e=>e.length>2)};Polygon.prototype.incomingCoords=function(e){this.coordinates=e.map(i=>i.slice(0,-1)),this.changed()};Polygon.prototype.setCoordinates=function(e){this.coordinates=e,this.changed()};Polygon.prototype.addCoordinate=function(e,i,s){this.changed();const a=e.split(".").map($=>parseInt($,10));this.coordinates[a[0]].splice(a[1],0,[i,s])};Polygon.prototype.removeCoordinate=function(e){this.changed();const i=e.split(".").map(a=>parseInt(a,10)),s=this.coordinates[i[0]];s&&(s.splice(i[1],1),s.length<3&&this.coordinates.splice(i[0],1))};Polygon.prototype.getCoordinate=function(e){const i=e.split(".").map(a=>parseInt(a,10)),s=this.coordinates[i[0]];return JSON.parse(JSON.stringify(s[i[1]]))};Polygon.prototype.getCoordinates=function(){return this.coordinates.map(e=>e.concat([e[0]]))};Polygon.prototype.updateCoordinate=function(e,i,s){this.changed();const a=e.split("."),_=parseInt(a[0],10),$=parseInt(a[1],10);this.coordinates[_]===void 0&&(this.coordinates[_]=[]),this.coordinates[_][$]=[i,s]};const models={MultiPoint:Point$1,MultiLineString:LineString,MultiPolygon:Polygon},takeAction=(e,i,s,a,_)=>{const $=s.split("."),rt=parseInt($[0],10),c=$[1]?$.slice(1).join("."):null;return e[rt][i](c,a,_)},MultiFeature=function(e,i){if(Feature.call(this,e,i),delete this.coordinates,this.model=models[i.geometry.type],this.model===void 0)throw new TypeError(`${i.geometry.type} is not a valid type`);this.features=this._coordinatesToFeatures(i.geometry.coordinates)};MultiFeature.prototype=Object.create(Feature.prototype);MultiFeature.prototype._coordinatesToFeatures=function(e){const i=this.model.bind(this);return e.map(s=>new i(this.ctx,{id:generateID(),type:geojsonTypes.FEATURE,properties:{},geometry:{coordinates:s,type:this.type.replace("Multi","")}}))};MultiFeature.prototype.isValid=function(){return this.features.every(e=>e.isValid())};MultiFeature.prototype.setCoordinates=function(e){this.features=this._coordinatesToFeatures(e),this.changed()};MultiFeature.prototype.getCoordinate=function(e){return takeAction(this.features,"getCoordinate",e)};MultiFeature.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map(e=>e.type===geojsonTypes.POLYGON?e.getCoordinates():e.coordinates)))};MultiFeature.prototype.updateCoordinate=function(e,i,s){takeAction(this.features,"updateCoordinate",e,i,s),this.changed()};MultiFeature.prototype.addCoordinate=function(e,i,s){takeAction(this.features,"addCoordinate",e,i,s),this.changed()};MultiFeature.prototype.removeCoordinate=function(e){takeAction(this.features,"removeCoordinate",e),this.changed()};MultiFeature.prototype.getFeatures=function(){return this.features};function ModeInterface(e){this.map=e.map,this.drawConfig=JSON.parse(JSON.stringify(e.options||{})),this._ctx=e}ModeInterface.prototype.setSelected=function(e){return this._ctx.store.setSelected(e)};ModeInterface.prototype.setSelectedCoordinates=function(e){this._ctx.store.setSelectedCoordinates(e),e.reduce((i,s)=>(i[s.feature_id]===void 0&&(i[s.feature_id]=!0,this._ctx.store.get(s.feature_id).changed()),i),{})};ModeInterface.prototype.getSelected=function(){return this._ctx.store.getSelected()};ModeInterface.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()};ModeInterface.prototype.isSelected=function(e){return this._ctx.store.isSelected(e)};ModeInterface.prototype.getFeature=function(e){return this._ctx.store.get(e)};ModeInterface.prototype.select=function(e){return this._ctx.store.select(e)};ModeInterface.prototype.deselect=function(e){return this._ctx.store.deselect(e)};ModeInterface.prototype.deleteFeature=function(e,i={}){return this._ctx.store.delete(e,i)};ModeInterface.prototype.addFeature=function(e,i={}){return this._ctx.store.add(e,i)};ModeInterface.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()};ModeInterface.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()};ModeInterface.prototype.setActionableState=function(e={}){const i={trash:e.trash||!1,combineFeatures:e.combineFeatures||!1,uncombineFeatures:e.uncombineFeatures||!1};return this._ctx.events.actionable(i)};ModeInterface.prototype.changeMode=function(e,i={},s={}){return this._ctx.events.changeMode(e,i,s)};ModeInterface.prototype.fire=function(e,i){return this._ctx.events.fire(e,i)};ModeInterface.prototype.updateUIClasses=function(e){return this._ctx.ui.queueMapClasses(e)};ModeInterface.prototype.activateUIButton=function(e){return this._ctx.ui.setActiveButton(e)};ModeInterface.prototype.featuresAt=function(e,i,s="click"){if(s!=="click"&&s!=="touch")throw new Error("invalid buffer type");return featuresAt[s](e,i,this._ctx)};ModeInterface.prototype.newFeature=function(e){const i=e.geometry.type;return i===geojsonTypes.POINT?new Point$1(this._ctx,e):i===geojsonTypes.LINE_STRING?new LineString(this._ctx,e):i===geojsonTypes.POLYGON?new Polygon(this._ctx,e):new MultiFeature(this._ctx,e)};ModeInterface.prototype.isInstanceOf=function(e,i){if(e===geojsonTypes.POINT)return i instanceof Point$1;if(e===geojsonTypes.LINE_STRING)return i instanceof LineString;if(e===geojsonTypes.POLYGON)return i instanceof Polygon;if(e==="MultiFeature")return i instanceof MultiFeature;throw new Error(`Unknown feature class: ${e}`)};ModeInterface.prototype.doRender=function(e){return this._ctx.store.featureChanged(e)};ModeInterface.prototype.onSetup=function(){};ModeInterface.prototype.onDrag=function(){};ModeInterface.prototype.onClick=function(){};ModeInterface.prototype.onMouseMove=function(){};ModeInterface.prototype.onMouseDown=function(){};ModeInterface.prototype.onMouseUp=function(){};ModeInterface.prototype.onMouseOut=function(){};ModeInterface.prototype.onKeyUp=function(){};ModeInterface.prototype.onKeyDown=function(){};ModeInterface.prototype.onTouchStart=function(){};ModeInterface.prototype.onTouchMove=function(){};ModeInterface.prototype.onTouchEnd=function(){};ModeInterface.prototype.onTap=function(){};ModeInterface.prototype.onStop=function(){};ModeInterface.prototype.onTrash=function(){};ModeInterface.prototype.onCombineFeature=function(){};ModeInterface.prototype.onUncombineFeature=function(){};ModeInterface.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};const eventMapper={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},eventKeys=Object.keys(eventMapper);function objectToMode(e){const i=Object.keys(e);return function(s,a={}){let _={};const $=i.reduce((c,dt)=>(c[dt]=e[dt],c),new ModeInterface(s));function rt(c){return dt=>$[c](_,dt)}return{start(){_=$.onSetup(a),eventKeys.forEach(c=>{const dt=eventMapper[c];let ht=()=>!1;e[dt]&&(ht=()=>!0),this.on(c,ht,rt(dt))})},stop(){$.onStop(_)},trash(){$.onTrash(_)},combineFeatures(){$.onCombineFeatures(_)},uncombineFeatures(){$.onUncombineFeatures(_)},render(c,dt){$.toDisplayFeatures(_,c,dt)}}}}function events(e){const i=Object.keys(e.options.modes).reduce((At,Pt)=>(At[Pt]=objectToMode(e.options.modes[Pt]),At),{});let s={},a={};const _={};let $=null,rt=null;_.drag=function(At,Pt){Pt({point:At.point,time:new Date().getTime()})?(e.ui.queueMapClasses({mouse:cursors.DRAG}),rt.drag(At)):At.originalEvent.stopPropagation()},_.mousedrag=function(At){_.drag(At,Pt=>!isClick(s,Pt))},_.touchdrag=function(At){_.drag(At,Pt=>!isTap(a,Pt))},_.mousemove=function(At){if((At.originalEvent.buttons!==void 0?At.originalEvent.buttons:At.originalEvent.which)===1)return _.mousedrag(At);const Vt=getFeatureAtAndSetCursors(At,e);At.featureTarget=Vt,rt.mousemove(At)},_.mousedown=function(At){s={time:new Date().getTime(),point:At.point};const Pt=getFeatureAtAndSetCursors(At,e);At.featureTarget=Pt,rt.mousedown(At)},_.mouseup=function(At){const Pt=getFeatureAtAndSetCursors(At,e);At.featureTarget=Pt,isClick(s,{point:At.point,time:new Date().getTime()})?rt.click(At):rt.mouseup(At)},_.mouseout=function(At){rt.mouseout(At)},_.touchstart=function(At){if(!e.options.touchEnabled)return;a={time:new Date().getTime(),point:At.point};const Pt=featuresAt.touch(At,null,e)[0];At.featureTarget=Pt,rt.touchstart(At)},_.touchmove=function(At){if(e.options.touchEnabled)return rt.touchmove(At),_.touchdrag(At)},_.touchend=function(At){if(At.originalEvent.preventDefault(),!e.options.touchEnabled)return;const Pt=featuresAt.touch(At,null,e)[0];At.featureTarget=Pt,isTap(a,{time:new Date().getTime(),point:At.point})?rt.tap(At):rt.touchend(At)};const c=At=>{const Pt=isBackspaceKey(At),Vt=isDeleteKey(At),Bt=isDigitKey(At);return!(Pt||Vt||Bt)};_.keydown=function(At){(At.srcElement||At.target).classList.contains(classes.CANVAS)&&((isBackspaceKey(At)||isDeleteKey(At))&&e.options.controls.trash?(At.preventDefault(),rt.trash()):c(At)?rt.keydown(At):isDigit1Key(At)&&e.options.controls.point?dt(modes$1.DRAW_POINT):isDigit2Key(At)&&e.options.controls.line_string?dt(modes$1.DRAW_LINE_STRING):isDigit3Key(At)&&e.options.controls.polygon&&dt(modes$1.DRAW_POLYGON))},_.keyup=function(At){c(At)&&rt.keyup(At)},_.zoomend=function(){e.store.changeZoom()},_.data=function(At){if(At.dataType==="style"){const{setup:Pt,map:Vt,options:Bt,store:Zt}=e;Bt.styles.some(Ut=>Vt.getLayer(Ut.id))||(Pt.addLayers(),Zt.setDirty(),Zt.render())}};function dt(At,Pt,Vt={}){rt.stop();const Bt=i[At];if(Bt===void 0)throw new Error(`${At} is not valid`);$=At;const Zt=Bt(e,Pt);rt=ModeHandler(Zt,e),Vt.silent||e.map.fire(events$1.MODE_CHANGE,{mode:At}),e.store.setDirty(),e.store.render()}const ht={trash:!1,combineFeatures:!1,uncombineFeatures:!1};function Et(At){let Pt=!1;Object.keys(At).forEach(Vt=>{if(ht[Vt]===void 0)throw new Error("Invalid action type");ht[Vt]!==At[Vt]&&(Pt=!0),ht[Vt]=At[Vt]}),Pt&&e.map.fire(events$1.ACTIONABLE,{actions:ht})}return{start(){$=e.options.defaultMode,rt=ModeHandler(i[$](e),e)},changeMode:dt,actionable:Et,currentModeName(){return $},currentModeRender(At,Pt){return rt.render(At,Pt)},fire(At,Pt){e.map&&e.map.fire(At,Pt)},addEventListeners(){e.map.on("mousemove",_.mousemove),e.map.on("mousedown",_.mousedown),e.map.on("mouseup",_.mouseup),e.map.on("data",_.data),e.map.on("touchmove",_.touchmove),e.map.on("touchstart",_.touchstart),e.map.on("touchend",_.touchend),e.container.addEventListener("mouseout",_.mouseout),e.options.keybindings&&(e.container.addEventListener("keydown",_.keydown),e.container.addEventListener("keyup",_.keyup))},removeEventListeners(){e.map.off("mousemove",_.mousemove),e.map.off("mousedown",_.mousedown),e.map.off("mouseup",_.mouseup),e.map.off("data",_.data),e.map.off("touchmove",_.touchmove),e.map.off("touchstart",_.touchstart),e.map.off("touchend",_.touchend),e.container.removeEventListener("mouseout",_.mouseout),e.options.keybindings&&(e.container.removeEventListener("keydown",_.keydown),e.container.removeEventListener("keyup",_.keyup))},trash(At){rt.trash(At)},combineFeatures(){rt.combineFeatures()},uncombineFeatures(){rt.uncombineFeatures()},getMode(){return $}}}function toDenseArray(e){return[].concat(e).filter(i=>i!==void 0)}function render(){const e=this;if(!(e.ctx.map&&e.ctx.map.getSource(sources.HOT)!==void 0))return dt();const s=e.ctx.events.currentModeName();e.ctx.ui.queueMapClasses({mode:s});let a=[],_=[];e.isDirty?_=e.getAllIds():(a=e.getChangedIds().filter(ht=>e.get(ht)!==void 0),_=e.sources.hot.filter(ht=>ht.properties.id&&a.indexOf(ht.properties.id)===-1&&e.get(ht.properties.id)!==void 0).map(ht=>ht.properties.id)),e.sources.hot=[];const $=e.sources.cold.length;e.sources.cold=e.isDirty?[]:e.sources.cold.filter(ht=>{const Et=ht.properties.id||ht.properties.parent;return a.indexOf(Et)===-1});const rt=$!==e.sources.cold.length||_.length>0;a.forEach(ht=>c(ht,"hot")),_.forEach(ht=>c(ht,"cold"));function c(ht,Et){const At=e.get(ht).internal(s);e.ctx.events.currentModeRender(At,Pt=>{Pt.properties.mode=s,e.sources[Et].push(Pt)})}rt&&e.ctx.map.getSource(sources.COLD).setData({type:geojsonTypes.FEATURE_COLLECTION,features:e.sources.cold}),e.ctx.map.getSource(sources.HOT).setData({type:geojsonTypes.FEATURE_COLLECTION,features:e.sources.hot}),dt();function dt(){e.isDirty=!1,e.clearChangedIds()}}function Store(e){this._features={},this._featureIds=new StringSet,this._selectedFeatureIds=new StringSet,this._selectedCoordinates=[],this._changedFeatureIds=new StringSet,this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=e,this.sources={hot:[],cold:[]};let i;this.render=()=>{i||(i=requestAnimationFrame(()=>{i=null,render.call(this),this._emitSelectionChange&&(this.ctx.events.fire(events$1.SELECTION_CHANGE,{features:this.getSelected().map(s=>s.toGeoJSON()),points:this.getSelectedCoordinates().map(s=>({type:geojsonTypes.FEATURE,properties:{},geometry:{type:geojsonTypes.POINT,coordinates:s.coordinates}}))}),this._emitSelectionChange=!1),this.ctx.events.fire(events$1.RENDER,{})}))},this.isDirty=!1}Store.prototype.createRenderBatch=function(){const e=this.render;let i=0;return this.render=function(){i++},()=>{this.render=e,i>0&&this.render()}};Store.prototype.setDirty=function(){return this.isDirty=!0,this};Store.prototype.featureCreated=function(e,i={}){if(this._changedFeatureIds.add(e),(i.silent!=null?i.silent:this.ctx.options.suppressAPIEvents)!==!0){const a=this.get(e);this.ctx.events.fire(events$1.CREATE,{features:[a.toGeoJSON()]})}return this};Store.prototype.featureChanged=function(e,i={}){return this._changedFeatureIds.add(e),(i.silent!=null?i.silent:this.ctx.options.suppressAPIEvents)!==!0&&this.ctx.events.fire(events$1.UPDATE,{action:i.action?i.action:updateActions.CHANGE_COORDINATES,features:[this.get(e).toGeoJSON()]}),this};Store.prototype.getChangedIds=function(){return this._changedFeatureIds.values()};Store.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this};Store.prototype.getAllIds=function(){return this._featureIds.values()};Store.prototype.add=function(e,i={}){return this._features[e.id]=e,this._featureIds.add(e.id),this.featureCreated(e.id,{silent:i.silent}),this};Store.prototype.delete=function(e,i={}){const s=[];return toDenseArray(e).forEach(a=>{this._featureIds.has(a)&&(this._featureIds.delete(a),this._selectedFeatureIds.delete(a),i.silent||s.indexOf(this._features[a])===-1&&s.push(this._features[a].toGeoJSON()),delete this._features[a],this.isDirty=!0)}),s.length&&this.ctx.events.fire(events$1.DELETE,{features:s}),refreshSelectedCoordinates(this,i),this};Store.prototype.get=function(e){return this._features[e]};Store.prototype.getAll=function(){return Object.keys(this._features).map(e=>this._features[e])};Store.prototype.select=function(e,i={}){return toDenseArray(e).forEach(s=>{this._selectedFeatureIds.has(s)||(this._selectedFeatureIds.add(s),this._changedFeatureIds.add(s),i.silent||(this._emitSelectionChange=!0))}),this};Store.prototype.deselect=function(e,i={}){return toDenseArray(e).forEach(s=>{this._selectedFeatureIds.has(s)&&(this._selectedFeatureIds.delete(s),this._changedFeatureIds.add(s),i.silent||(this._emitSelectionChange=!0))}),refreshSelectedCoordinates(this,i),this};Store.prototype.clearSelected=function(e={}){return this.deselect(this._selectedFeatureIds.values(),{silent:e.silent}),this};Store.prototype.setSelected=function(e,i={}){return e=toDenseArray(e),this.deselect(this._selectedFeatureIds.values().filter(s=>e.indexOf(s)===-1),{silent:i.silent}),this.select(e.filter(s=>!this._selectedFeatureIds.has(s)),{silent:i.silent}),this};Store.prototype.setSelectedCoordinates=function(e){return this._selectedCoordinates=e,this._emitSelectionChange=!0,this};Store.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this};Store.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()};Store.prototype.getSelected=function(){return this.getSelectedIds().map(e=>this.get(e))};Store.prototype.getSelectedCoordinates=function(){return this._selectedCoordinates.map(i=>({coordinates:this.get(i.feature_id).getCoordinate(i.coord_path)}))};Store.prototype.isSelected=function(e){return this._selectedFeatureIds.has(e)};Store.prototype.setFeatureProperty=function(e,i,s,a={}){this.get(e).setProperty(i,s),this.featureChanged(e,{silent:a.silent,action:updateActions.CHANGE_PROPERTIES})};function refreshSelectedCoordinates(e,i={}){const s=e._selectedCoordinates.filter(a=>e._selectedFeatureIds.has(a.feature_id));e._selectedCoordinates.length!==s.length&&!i.silent&&(e._emitSelectionChange=!0),e._selectedCoordinates=s}Store.prototype.storeMapConfig=function(){interactions.forEach(e=>{this.ctx.map[e]&&(this._mapInitialConfig[e]=this.ctx.map[e].isEnabled())})};Store.prototype.restoreMapConfig=function(){Object.keys(this._mapInitialConfig).forEach(e=>{this._mapInitialConfig[e]?this.ctx.map[e].enable():this.ctx.map[e].disable()})};Store.prototype.getInitialConfigValue=function(e){return this._mapInitialConfig[e]!==void 0?this._mapInitialConfig[e]:!0};const classTypes=["mode","feature","mouse"];function ui(e){const i={};let s=null,a={mode:null,feature:null,mouse:null},_={mode:null,feature:null,mouse:null};function $(){rt({mode:null,feature:null,mouse:null}),c()}function rt(Pt){_=Object.assign(_,Pt)}function c(){if(!e.container)return;const Pt=[],Vt=[];classTypes.forEach(Bt=>{_[Bt]!==a[Bt]&&(Pt.push(`${Bt}-${a[Bt]}`),_[Bt]!==null&&Vt.push(`${Bt}-${_[Bt]}`))}),Pt.length>0&&e.container.classList.remove(...Pt),Vt.length>0&&e.container.classList.add(...Vt),a=Object.assign(a,_)}function dt(Pt,Vt={}){const Bt=document.createElement("button");return Bt.className=`${classes.CONTROL_BUTTON} ${Vt.className}`,Bt.setAttribute("title",Vt.title),Vt.container.appendChild(Bt),Bt.addEventListener("click",Zt=>{if(Zt.preventDefault(),Zt.stopPropagation(),Zt.target===s){ht(),Vt.onDeactivate();return}Et(Pt),Vt.onActivate()},!0),Bt}function ht(){s&&(s.classList.remove(classes.ACTIVE_BUTTON),s=null)}function Et(Pt){ht();const Vt=i[Pt];Vt&&Vt&&Pt!=="trash"&&(Vt.classList.add(classes.ACTIVE_BUTTON),s=Vt)}function St(){const Pt=e.options.controls,Vt=document.createElement("div");return Vt.className=`${classes.CONTROL_GROUP} ${classes.CONTROL_BASE}`,Pt&&(Pt[types$1.POINT]&&(i[types$1.POINT]=dt(types$1.POINT,{container:Vt,className:classes.CONTROL_BUTTON_POINT,title:`Marker tool ${e.options.keybindings?"(1)":""}`,onActivate:()=>e.events.changeMode(modes$1.DRAW_POINT),onDeactivate:()=>e.events.trash()})),Pt[types$1.LINE]&&(i[types$1.LINE]=dt(types$1.LINE,{container:Vt,className:classes.CONTROL_BUTTON_LINE,title:`LineString tool ${e.options.keybindings?"(2)":""}`,onActivate:()=>e.events.changeMode(modes$1.DRAW_LINE_STRING),onDeactivate:()=>e.events.trash()})),Pt[types$1.POLYGON]&&(i[types$1.POLYGON]=dt(types$1.POLYGON,{container:Vt,className:classes.CONTROL_BUTTON_POLYGON,title:`Polygon tool ${e.options.keybindings?"(3)":""}`,onActivate:()=>e.events.changeMode(modes$1.DRAW_POLYGON),onDeactivate:()=>e.events.trash()})),Pt.trash&&(i.trash=dt("trash",{container:Vt,className:classes.CONTROL_BUTTON_TRASH,title:"Delete",onActivate:()=>{e.events.trash()}})),Pt.combine_features&&(i.combine_features=dt("combineFeatures",{container:Vt,className:classes.CONTROL_BUTTON_COMBINE_FEATURES,title:"Combine",onActivate:()=>{e.events.combineFeatures()}})),Pt.uncombine_features&&(i.uncombine_features=dt("uncombineFeatures",{container:Vt,className:classes.CONTROL_BUTTON_UNCOMBINE_FEATURES,title:"Uncombine",onActivate:()=>{e.events.uncombineFeatures()}}))),Vt}function At(){Object.keys(i).forEach(Pt=>{const Vt=i[Pt];Vt.parentNode&&Vt.parentNode.removeChild(Vt),delete i[Pt]})}return{setActiveButton:Et,queueMapClasses:rt,updateMapClasses:c,clearMapClasses:$,addButtons:St,removeButtons:At}}function runSetup(e){let i=null,s=null;const a={onRemove(){return e.map.off("load",a.connect),clearInterval(s),a.removeLayers(),e.store.restoreMapConfig(),e.ui.removeButtons(),e.events.removeEventListeners(),e.ui.clearMapClasses(),e.boxZoomInitial&&e.map.boxZoom.enable(),e.map=null,e.container=null,e.store=null,i&&i.parentNode&&i.parentNode.removeChild(i),i=null,this},connect(){e.map.off("load",a.connect),clearInterval(s),a.addLayers(),e.store.storeMapConfig(),e.events.addEventListeners()},onAdd(_){if(e.map=_,e.events=events(e),e.ui=ui(e),e.container=_.getContainer(),e.store=new Store(e),i=e.ui.addButtons(),e.options.boxSelect){e.boxZoomInitial=_.boxZoom.isEnabled(),_.boxZoom.disable();const $=_.dragPan.isEnabled();_.dragPan.disable(),_.dragPan.enable(),$||_.dragPan.disable()}return _.loaded()?a.connect():(_.on("load",a.connect),s=setInterval(()=>{_.loaded()&&a.connect()},16)),e.events.start(),i},addLayers(){e.map.addSource(sources.COLD,{data:{type:geojsonTypes.FEATURE_COLLECTION,features:[]},type:"geojson"}),e.map.addSource(sources.HOT,{data:{type:geojsonTypes.FEATURE_COLLECTION,features:[]},type:"geojson"}),e.options.styles.forEach(_=>{e.map.addLayer(_)}),e.store.setDirty(!0),e.store.render()},removeLayers(){e.options.styles.forEach(_=>{e.map.getLayer(_.id)&&e.map.removeLayer(_.id)}),e.map.getSource(sources.COLD)&&e.map.removeSource(sources.COLD),e.map.getSource(sources.HOT)&&e.map.removeSource(sources.HOT)}};return e.setup=a,a}const blue="#3bb2d0",orange="#fbb03b",white="#fff",styles=[{id:"gl-draw-polygon-fill",type:"fill",filter:["all",["==","$type","Polygon"]],paint:{"fill-color":["case",["==",["get","active"],"true"],orange,blue],"fill-opacity":.1}},{id:"gl-draw-lines",type:"line",filter:["any",["==","$type","LineString"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":["case",["==",["get","active"],"true"],orange,blue],"line-dasharray":["case",["==",["get","active"],"true"],[.2,2],[2,0]],"line-width":2}},{id:"gl-draw-point-outer",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],7,5],"circle-color":white}},{id:"gl-draw-point-inner",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],5,3],"circle-color":["case",["==",["get","active"],"true"],orange,blue]}},{id:"gl-draw-vertex-outer",type:"circle",filter:["all",["==","$type","Point"],["==","meta","vertex"],["!=","mode","simple_select"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],7,5],"circle-color":white}},{id:"gl-draw-vertex-inner",type:"circle",filter:["all",["==","$type","Point"],["==","meta","vertex"],["!=","mode","simple_select"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],5,3],"circle-color":orange}},{id:"gl-draw-midpoint",type:"circle",filter:["all",["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":orange}}];function Point(e,i){this.x=e,this.y=i}Point.prototype={clone(){return new Point(this.x,this.y)},add(e){return this.clone()._add(e)},sub(e){return this.clone()._sub(e)},multByPoint(e){return this.clone()._multByPoint(e)},divByPoint(e){return this.clone()._divByPoint(e)},mult(e){return this.clone()._mult(e)},div(e){return this.clone()._div(e)},rotate(e){return this.clone()._rotate(e)},rotateAround(e,i){return this.clone()._rotateAround(e,i)},matMult(e){return this.clone()._matMult(e)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(e){return this.x===e.x&&this.y===e.y},dist(e){return Math.sqrt(this.distSqr(e))},distSqr(e){const i=e.x-this.x,s=e.y-this.y;return i*i+s*s},angle(){return Math.atan2(this.y,this.x)},angleTo(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith(e){return this.angleWithSep(e.x,e.y)},angleWithSep(e,i){return Math.atan2(this.x*i-this.y*e,this.x*e+this.y*i)},_matMult(e){const i=e[0]*this.x+e[1]*this.y,s=e[2]*this.x+e[3]*this.y;return this.x=i,this.y=s,this},_add(e){return this.x+=e.x,this.y+=e.y,this},_sub(e){return this.x-=e.x,this.y-=e.y,this},_mult(e){return this.x*=e,this.y*=e,this},_div(e){return this.x/=e,this.y/=e,this},_multByPoint(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint(e){return this.x/=e.x,this.y/=e.y,this},_unit(){return this._div(this.mag()),this},_perp(){const e=this.y;return this.y=this.x,this.x=-e,this},_rotate(e){const i=Math.cos(e),s=Math.sin(e),a=i*this.x-s*this.y,_=s*this.x+i*this.y;return this.x=a,this.y=_,this},_rotateAround(e,i){const s=Math.cos(e),a=Math.sin(e),_=i.x+s*(this.x-i.x)-a*(this.y-i.y),$=i.y+a*(this.x-i.x)+s*(this.y-i.y);return this.x=_,this.y=$,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:Point};Point.convert=function(e){if(e instanceof Point)return e;if(Array.isArray(e))return new Point(+e[0],+e[1]);if(e.x!==void 0&&e.y!==void 0)return new Point(+e.x,+e.y);throw new Error("Expected [x, y] or {x, y} point format")};function mouseEventPoint(e,i){const s=i.getBoundingClientRect();return new Point(e.clientX-s.left-(i.clientLeft||0),e.clientY-s.top-(i.clientTop||0))}function createVertex(e,i,s,a){return{type:geojsonTypes.FEATURE,properties:{meta:meta.VERTEX,parent:e,coord_path:s,active:a?activeStates.ACTIVE:activeStates.INACTIVE},geometry:{type:geojsonTypes.POINT,coordinates:i}}}function isNumber(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function coordEach(e,i,s){if(e!==null)for(var a,_,$,rt,c,dt,ht,Et=0,St=0,At,Pt=e.type,Vt=Pt==="FeatureCollection",Bt=Pt==="Feature",Zt=Vt?e.features.length:1,zt=0;zt<Zt;zt++){ht=Vt?e.features[zt].geometry:Bt?e.geometry:e,At=ht?ht.type==="GeometryCollection":!1,c=At?ht.geometries.length:1;for(var Ut=0;Ut<c;Ut++){var Nt=0,Gt=0;if(rt=At?ht.geometries[Ut]:ht,rt!==null){dt=rt.coordinates;var er=rt.type;switch(Et=0,er){case null:break;case"Point":if(i(dt,St,zt,Nt,Gt)===!1)return!1;St++,Nt++;break;case"LineString":case"MultiPoint":for(a=0;a<dt.length;a++){if(i(dt[a],St,zt,Nt,Gt)===!1)return!1;St++,er==="MultiPoint"&&Nt++}er==="LineString"&&Nt++;break;case"Polygon":case"MultiLineString":for(a=0;a<dt.length;a++){for(_=0;_<dt[a].length-Et;_++){if(i(dt[a][_],St,zt,Nt,Gt)===!1)return!1;St++}er==="MultiLineString"&&Nt++,er==="Polygon"&&Gt++}er==="Polygon"&&Nt++;break;case"MultiPolygon":for(a=0;a<dt.length;a++){for(Gt=0,_=0;_<dt[a].length;_++){for($=0;$<dt[a][_].length-Et;$++){if(i(dt[a][_][$],St,zt,Nt,Gt)===!1)return!1;St++}Gt++}Nt++}break;case"GeometryCollection":for(a=0;a<rt.geometries.length;a++)if(coordEach(rt.geometries[a],i)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function clone(e){if(!e)throw new Error("geojson is required");switch(e.type){case"Feature":return cloneFeature(e);case"FeatureCollection":return cloneFeatureCollection(e);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return cloneGeometry(e);default:throw new Error("unknown GeoJSON type")}}function cloneFeature(e){const i={type:"Feature"};return Object.keys(e).forEach(s=>{switch(s){case"type":case"properties":case"geometry":return;default:i[s]=e[s]}}),i.properties=cloneProperties(e.properties),e.geometry==null?i.geometry=null:i.geometry=cloneGeometry(e.geometry),i}function cloneProperties(e){const i={};return e&&Object.keys(e).forEach(s=>{const a=e[s];typeof a=="object"?a===null?i[s]=null:Array.isArray(a)?i[s]=a.map(_=>_):i[s]=cloneProperties(a):i[s]=a}),i}function cloneFeatureCollection(e){const i={type:"FeatureCollection"};return Object.keys(e).forEach(s=>{switch(s){case"type":case"features":return;default:i[s]=e[s]}}),i.features=e.features.map(s=>cloneFeature(s)),i}function cloneGeometry(e){const i={type:e.type};return e.bbox&&(i.bbox=e.bbox),e.type==="GeometryCollection"?(i.geometries=e.geometries.map(s=>cloneGeometry(s)),i):(i.coordinates=deepSlice(e.coordinates),i)}function deepSlice(e){const i=e;return typeof i[0]!="object"?i.slice():i.map(s=>deepSlice(s))}function toMercator(e,i={}){return convert(e,"mercator",i)}function toWgs84(e,i={}){return convert(e,"wgs84",i)}function convert(e,i,s={}){s=s||{};var a=s.mutate;if(!e)throw new Error("geojson is required");return Array.isArray(e)&&isNumber(e[0])?e=i==="mercator"?convertToMercator(e):convertToWgs84(e):(a!==!0&&(e=clone(e)),coordEach(e,function(_){var $=i==="mercator"?convertToMercator(_):convertToWgs84(_);_[0]=$[0],_[1]=$[1]})),e}function convertToMercator(e){var i=Math.PI/180,s=6378137,a=20037508342789244e-9,_=Math.abs(e[0])<=180?e[0]:e[0]-sign(e[0])*360,$=[s*_*i,s*Math.log(Math.tan(Math.PI*.25+.5*e[1]*i))];return $[0]>a&&($[0]=a),$[0]<-a&&($[0]=-a),$[1]>a&&($[1]=a),$[1]<-a&&($[1]=-a),$}function convertToWgs84(e){var i=180/Math.PI,s=6378137;return[e[0]*i/s,(Math.PI*.5-2*Math.atan(Math.exp(-e[1]/s)))*i]}function sign(e){return e<0?-1:e>0?1:0}function createMidpoint(e,i,s){const a=i.geometry.coordinates,_=s.geometry.coordinates;if(a[1]>LAT_RENDERED_MAX$1||a[1]<LAT_RENDERED_MIN$1||_[1]>LAT_RENDERED_MAX$1||_[1]<LAT_RENDERED_MIN$1)return null;const $=toMercator(a),rt=toMercator(_),c=St=>Number(St.toFixed(8)),dt=(St,At)=>(St+At)/2,ht=toWgs84([dt($[0],rt[0]),dt($[1],rt[1])]),Et=[c(ht[0]),c(ht[1])];return{type:geojsonTypes.FEATURE,properties:{meta:meta.MIDPOINT,parent:e,lng:Et[0],lat:Et[1],coord_path:s.properties.coord_path},geometry:{type:geojsonTypes.POINT,coordinates:Et}}}function createSupplementaryPoints(e,i={},s=null){const{type:a,coordinates:_}=e.geometry,$=e.properties&&e.properties.id;let rt=[];a===geojsonTypes.POINT?rt.push(createVertex($,_,s,dt(s))):a===geojsonTypes.POLYGON?_.forEach((Et,St)=>{c(Et,s!==null?`${s}.${St}`:String(St))}):a===geojsonTypes.LINE_STRING?c(_,s):a.indexOf(geojsonTypes.MULTI_PREFIX)===0&&ht();function c(Et,St){let At="",Pt=null;Et.forEach((Vt,Bt)=>{const Zt=St!=null?`${St}.${Bt}`:String(Bt),zt=createVertex($,Vt,Zt,dt(Zt));if(i.midpoints&&Pt){const Nt=createMidpoint($,Pt,zt);Nt&&rt.push(Nt)}Pt=zt;const Ut=JSON.stringify(Vt);At!==Ut&&rt.push(zt),Bt===0&&(At=Ut)})}function dt(Et){return i.selectedPaths?i.selectedPaths.indexOf(Et)!==-1:!1}function ht(){const Et=a.replace(geojsonTypes.MULTI_PREFIX,"");_.forEach((St,At)=>{const Pt={type:geojsonTypes.FEATURE,properties:e.properties,geometry:{type:Et,coordinates:St}};rt=rt.concat(createSupplementaryPoints(Pt,i,At))})}return rt}const doubleClickZoom={enable(e){setTimeout(()=>{!e.map||!e.map.doubleClickZoom||!e._ctx||!e._ctx.store||!e._ctx.store.getInitialConfigValue||e._ctx.store.getInitialConfigValue("doubleClickZoom")&&e.map.doubleClickZoom.enable()},0)},disable(e){setTimeout(()=>{!e.map||!e.map.doubleClickZoom||e.map.doubleClickZoom.disable()},0)}},{LAT_MIN,LAT_MAX,LAT_RENDERED_MIN,LAT_RENDERED_MAX,LNG_MIN,LNG_MAX}=Constants;function extent(e){const i={Point:0,LineString:1,Polygon:2,MultiPoint:1,MultiLineString:2,MultiPolygon:3}[e.geometry.type],s=[e.geometry.coordinates].flat(i),a=s.map(c=>c[0]),_=s.map(c=>c[1]),$=c=>Math.min.apply(null,c),rt=c=>Math.max.apply(null,c);return[$(a),$(_),rt(a),rt(_)]}function constrainFeatureMovement(e,i){let s=LAT_MIN,a=LAT_MAX,_=LAT_MIN,$=LAT_MAX,rt=LNG_MAX,c=LNG_MIN;e.forEach(ht=>{const Et=extent(ht),St=Et[1],At=Et[3],Pt=Et[0],Vt=Et[2];St>s&&(s=St),At<a&&(a=At),At>_&&(_=At),St<$&&($=St),Pt<rt&&(rt=Pt),Vt>c&&(c=Vt)});const dt=i;return s+dt.lat>LAT_RENDERED_MAX&&(dt.lat=LAT_RENDERED_MAX-s),_+dt.lat>LAT_MAX&&(dt.lat=LAT_MAX-_),a+dt.lat<LAT_RENDERED_MIN&&(dt.lat=LAT_RENDERED_MIN-a),$+dt.lat<LAT_MIN&&(dt.lat=LAT_MIN-$),rt+dt.lng<=LNG_MIN&&(dt.lng+=Math.ceil(Math.abs(dt.lng)/360)*360),c+dt.lng>=LNG_MAX&&(dt.lng-=Math.ceil(Math.abs(dt.lng)/360)*360),dt}function moveFeatures(e,i){const s=constrainFeatureMovement(e.map(a=>a.toGeoJSON()),i);e.forEach(a=>{const _=a.getCoordinates(),$=ht=>{const Et={lng:ht[0]+s.lng,lat:ht[1]+s.lat};return[Et.lng,Et.lat]},rt=ht=>ht.map(Et=>$(Et)),c=ht=>ht.map(Et=>rt(Et));let dt;a.type===geojsonTypes.POINT?dt=$(_):a.type===geojsonTypes.LINE_STRING||a.type===geojsonTypes.MULTI_POINT?dt=_.map($):a.type===geojsonTypes.POLYGON||a.type===geojsonTypes.MULTI_LINE_STRING?dt=_.map(rt):a.type===geojsonTypes.MULTI_POLYGON&&(dt=_.map(c)),a.incomingCoords(dt)})}const SimpleSelect={};SimpleSelect.onSetup=function(e){const i={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initialDragPanState:this.map.dragPan.isEnabled(),initiallySelectedFeatureIds:e.featureIds||[]};return this.setSelected(i.initiallySelectedFeatureIds.filter(s=>this.getFeature(s)!==void 0)),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),i};SimpleSelect.fireUpdate=function(){this.fire(events$1.UPDATE,{action:updateActions.MOVE,features:this.getSelected().map(e=>e.toGeoJSON())})};SimpleSelect.fireActionable=function(){const e=this.getSelected(),i=e.filter($=>this.isInstanceOf("MultiFeature",$));let s=!1;if(e.length>1){s=!0;const $=e[0].type.replace("Multi","");e.forEach(rt=>{rt.type.replace("Multi","")!==$&&(s=!1)})}const a=i.length>0,_=e.length>0;this.setActionableState({combineFeatures:s,uncombineFeatures:a,trash:_})};SimpleSelect.getUniqueIds=function(e){return e.length?e.map(s=>s.properties.id).filter(s=>s!==void 0).reduce((s,a)=>(s.add(a),s),new StringSet).values():[]};SimpleSelect.stopExtendedInteractions=function(e){e.boxSelectElement&&(e.boxSelectElement.parentNode&&e.boxSelectElement.parentNode.removeChild(e.boxSelectElement),e.boxSelectElement=null),(e.canDragMove||e.canBoxSelect)&&e.initialDragPanState===!0&&this.map.dragPan.enable(),e.boxSelecting=!1,e.canBoxSelect=!1,e.dragMoving=!1,e.canDragMove=!1};SimpleSelect.onStop=function(){doubleClickZoom.enable(this)};SimpleSelect.onMouseMove=function(e,i){return isFeature(i)&&e.dragMoving&&this.fireUpdate(),this.stopExtendedInteractions(e),!0};SimpleSelect.onMouseOut=function(e){return e.dragMoving?this.fireUpdate():!0};SimpleSelect.onTap=SimpleSelect.onClick=function(e,i){if(noTarget(i))return this.clickAnywhere(e,i);if(isOfMetaType(meta.VERTEX)(i))return this.clickOnVertex(e,i);if(isFeature(i))return this.clickOnFeature(e,i)};SimpleSelect.clickAnywhere=function(e){const i=this.getSelectedIds();i.length&&(this.clearSelectedFeatures(),i.forEach(s=>this.doRender(s))),doubleClickZoom.enable(this),this.stopExtendedInteractions(e)};SimpleSelect.clickOnVertex=function(e,i){this.changeMode(modes$1.DIRECT_SELECT,{featureId:i.featureTarget.properties.parent,coordPath:i.featureTarget.properties.coord_path,startPos:i.lngLat}),this.updateUIClasses({mouse:cursors.MOVE})};SimpleSelect.startOnActiveFeature=function(e,i){this.stopExtendedInteractions(e),this.map.dragPan.disable(),this.doRender(i.featureTarget.properties.id),e.canDragMove=!0,e.dragMoveLocation=i.lngLat};SimpleSelect.clickOnFeature=function(e,i){doubleClickZoom.disable(this),this.stopExtendedInteractions(e);const s=isShiftDown(i),a=this.getSelectedIds(),_=i.featureTarget.properties.id,$=this.isSelected(_);if(!s&&$&&this.getFeature(_).type!==geojsonTypes.POINT)return this.changeMode(modes$1.DIRECT_SELECT,{featureId:_});$&&s?(this.deselect(_),this.updateUIClasses({mouse:cursors.POINTER}),a.length===1&&doubleClickZoom.enable(this)):!$&&s?(this.select(_),this.updateUIClasses({mouse:cursors.MOVE})):!$&&!s&&(a.forEach(rt=>this.doRender(rt)),this.setSelected(_),this.updateUIClasses({mouse:cursors.MOVE})),this.doRender(_)};SimpleSelect.onMouseDown=function(e,i){if(e.initialDragPanState=this.map.dragPan.isEnabled(),isActiveFeature(i))return this.startOnActiveFeature(e,i);if(this.drawConfig.boxSelect&&isShiftMousedown(i))return this.startBoxSelect(e,i)};SimpleSelect.startBoxSelect=function(e,i){this.stopExtendedInteractions(e),this.map.dragPan.disable(),e.boxSelectStartLocation=mouseEventPoint(i.originalEvent,this.map.getContainer()),e.canBoxSelect=!0};SimpleSelect.onTouchStart=function(e,i){if(isActiveFeature(i))return this.startOnActiveFeature(e,i)};SimpleSelect.onDrag=function(e,i){if(e.canDragMove)return this.dragMove(e,i);if(this.drawConfig.boxSelect&&e.canBoxSelect)return this.whileBoxSelect(e,i)};SimpleSelect.whileBoxSelect=function(e,i){e.boxSelecting=!0,this.updateUIClasses({mouse:cursors.ADD}),e.boxSelectElement||(e.boxSelectElement=document.createElement("div"),e.boxSelectElement.classList.add(classes.BOX_SELECT),this.map.getContainer().appendChild(e.boxSelectElement));const s=mouseEventPoint(i.originalEvent,this.map.getContainer()),a=Math.min(e.boxSelectStartLocation.x,s.x),_=Math.max(e.boxSelectStartLocation.x,s.x),$=Math.min(e.boxSelectStartLocation.y,s.y),rt=Math.max(e.boxSelectStartLocation.y,s.y),c=`translate(${a}px, ${$}px)`;e.boxSelectElement.style.transform=c,e.boxSelectElement.style.WebkitTransform=c,e.boxSelectElement.style.width=`${_-a}px`,e.boxSelectElement.style.height=`${rt-$}px`};SimpleSelect.dragMove=function(e,i){e.dragMoving=!0,i.originalEvent.stopPropagation();const s={lng:i.lngLat.lng-e.dragMoveLocation.lng,lat:i.lngLat.lat-e.dragMoveLocation.lat};moveFeatures(this.getSelected(),s),e.dragMoveLocation=i.lngLat};SimpleSelect.onTouchEnd=SimpleSelect.onMouseUp=function(e,i){if(e.dragMoving)this.fireUpdate();else if(e.boxSelecting){const s=[e.boxSelectStartLocation,mouseEventPoint(i.originalEvent,this.map.getContainer())],a=this.featuresAt(null,s,"click"),_=this.getUniqueIds(a).filter($=>!this.isSelected($));_.length&&(this.select(_),_.forEach($=>this.doRender($)),this.updateUIClasses({mouse:cursors.MOVE}))}this.stopExtendedInteractions(e)};SimpleSelect.toDisplayFeatures=function(e,i,s){i.properties.active=this.isSelected(i.properties.id)?activeStates.ACTIVE:activeStates.INACTIVE,s(i),this.fireActionable(),!(i.properties.active!==activeStates.ACTIVE||i.geometry.type===geojsonTypes.POINT)&&createSupplementaryPoints(i).forEach(s)};SimpleSelect.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()};SimpleSelect.onCombineFeatures=function(){const e=this.getSelected();if(e.length===0||e.length<2)return;const i=[],s=[],a=e[0].type.replace("Multi","");for(let _=0;_<e.length;_++){const $=e[_];if($.type.replace("Multi","")!==a)return;$.type.includes("Multi")?$.getCoordinates().forEach(rt=>{i.push(rt)}):i.push($.getCoordinates()),s.push($.toGeoJSON())}if(s.length>1){const _=this.newFeature({type:geojsonTypes.FEATURE,properties:s[0].properties,geometry:{type:`Multi${a}`,coordinates:i}});this.addFeature(_),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([_.id]),this.fire(events$1.COMBINE_FEATURES,{createdFeatures:[_.toGeoJSON()],deletedFeatures:s})}this.fireActionable()};SimpleSelect.onUncombineFeatures=function(){const e=this.getSelected();if(e.length===0)return;const i=[],s=[];for(let a=0;a<e.length;a++){const _=e[a];this.isInstanceOf("MultiFeature",_)&&(_.getFeatures().forEach($=>{this.addFeature($),$.properties=_.properties,i.push($.toGeoJSON()),this.select([$.id])}),this.deleteFeature(_.id,{silent:!0}),s.push(_.toGeoJSON()))}i.length>1&&this.fire(events$1.UNCOMBINE_FEATURES,{createdFeatures:i,deletedFeatures:s}),this.fireActionable()};const isVertex=isOfMetaType(meta.VERTEX),isMidpoint=isOfMetaType(meta.MIDPOINT),DirectSelect={};DirectSelect.fireUpdate=function(){this.fire(events$1.UPDATE,{action:updateActions.CHANGE_COORDINATES,features:this.getSelected().map(e=>e.toGeoJSON())})};DirectSelect.fireActionable=function(e){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:e.selectedCoordPaths.length>0})};DirectSelect.startDragging=function(e,i){e.initialDragPanState==null&&(e.initialDragPanState=this.map.dragPan.isEnabled()),this.map.dragPan.disable(),e.canDragMove=!0,e.dragMoveLocation=i.lngLat};DirectSelect.stopDragging=function(e){e.canDragMove&&e.initialDragPanState===!0&&this.map.dragPan.enable(),e.initialDragPanState=null,e.dragMoving=!1,e.canDragMove=!1,e.dragMoveLocation=null};DirectSelect.onVertex=function(e,i){this.startDragging(e,i);const s=i.featureTarget.properties,a=e.selectedCoordPaths.indexOf(s.coord_path);!isShiftDown(i)&&a===-1?e.selectedCoordPaths=[s.coord_path]:isShiftDown(i)&&a===-1&&e.selectedCoordPaths.push(s.coord_path);const _=this.pathsToCoordinates(e.featureId,e.selectedCoordPaths);this.setSelectedCoordinates(_)};DirectSelect.onMidpoint=function(e,i){this.startDragging(e,i);const s=i.featureTarget.properties;e.feature.addCoordinate(s.coord_path,s.lng,s.lat),this.fireUpdate(),e.selectedCoordPaths=[s.coord_path]};DirectSelect.pathsToCoordinates=function(e,i){return i.map(s=>({feature_id:e,coord_path:s}))};DirectSelect.onFeature=function(e,i){e.selectedCoordPaths.length===0?this.startDragging(e,i):this.stopDragging(e)};DirectSelect.dragFeature=function(e,i,s){moveFeatures(this.getSelected(),s),e.dragMoveLocation=i.lngLat};DirectSelect.dragVertex=function(e,i,s){const a=e.selectedCoordPaths.map(rt=>e.feature.getCoordinate(rt)),_=a.map(rt=>({type:geojsonTypes.FEATURE,properties:{},geometry:{type:geojsonTypes.POINT,coordinates:rt}})),$=constrainFeatureMovement(_,s);for(let rt=0;rt<a.length;rt++){const c=a[rt];e.feature.updateCoordinate(e.selectedCoordPaths[rt],c[0]+$.lng,c[1]+$.lat)}};DirectSelect.clickNoTarget=function(){this.changeMode(modes$1.SIMPLE_SELECT)};DirectSelect.clickInactive=function(){this.changeMode(modes$1.SIMPLE_SELECT)};DirectSelect.clickActiveFeature=function(e){e.selectedCoordPaths=[],this.clearSelectedCoordinates(),e.feature.changed()};DirectSelect.onSetup=function(e){const i=e.featureId,s=this.getFeature(i);if(!s)throw new Error("You must provide a featureId to enter direct_select mode");if(s.type===geojsonTypes.POINT)throw new TypeError("direct_select mode doesn't handle point features");const a={featureId:i,feature:s,dragMoveLocation:e.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:e.coordPath?[e.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(i,a.selectedCoordPaths)),this.setSelected(i),doubleClickZoom.disable(this),this.setActionableState({trash:!0}),a};DirectSelect.onStop=function(){doubleClickZoom.enable(this),this.clearSelectedCoordinates()};DirectSelect.toDisplayFeatures=function(e,i,s){e.featureId===i.properties.id?(i.properties.active=activeStates.ACTIVE,s(i),createSupplementaryPoints(i,{map:this.map,midpoints:!0,selectedPaths:e.selectedCoordPaths}).forEach(s)):(i.properties.active=activeStates.INACTIVE,s(i)),this.fireActionable(e)};DirectSelect.onTrash=function(e){e.selectedCoordPaths.sort((i,s)=>s.localeCompare(i,"en",{numeric:!0})).forEach(i=>e.feature.removeCoordinate(i)),this.fireUpdate(),e.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(e),e.feature.isValid()===!1&&(this.deleteFeature([e.featureId]),this.changeMode(modes$1.SIMPLE_SELECT,{}))};DirectSelect.onMouseMove=function(e,i){const s=isActiveFeature(i),a=isVertex(i),_=isMidpoint(i),$=e.selectedCoordPaths.length===0;return s&&$?this.updateUIClasses({mouse:cursors.MOVE}):a&&!$?this.updateUIClasses({mouse:cursors.MOVE}):this.updateUIClasses({mouse:cursors.NONE}),(a||s||_)&&e.dragMoving&&this.fireUpdate(),this.stopDragging(e),!0};DirectSelect.onMouseOut=function(e){return e.dragMoving&&this.fireUpdate(),!0};DirectSelect.onTouchStart=DirectSelect.onMouseDown=function(e,i){if(isVertex(i))return this.onVertex(e,i);if(isActiveFeature(i))return this.onFeature(e,i);if(isMidpoint(i))return this.onMidpoint(e,i)};DirectSelect.onDrag=function(e,i){if(e.canDragMove!==!0)return;e.dragMoving=!0,i.originalEvent.stopPropagation();const s={lng:i.lngLat.lng-e.dragMoveLocation.lng,lat:i.lngLat.lat-e.dragMoveLocation.lat};e.selectedCoordPaths.length>0?this.dragVertex(e,i,s):this.dragFeature(e,i,s),e.dragMoveLocation=i.lngLat};DirectSelect.onClick=function(e,i){if(noTarget(i))return this.clickNoTarget(e,i);if(isActiveFeature(i))return this.clickActiveFeature(e,i);if(isInactiveFeature(i))return this.clickInactive(e,i);this.stopDragging(e)};DirectSelect.onTap=function(e,i){if(noTarget(i))return this.clickNoTarget(e,i);if(isActiveFeature(i))return this.clickActiveFeature(e,i);if(isInactiveFeature(i))return this.clickInactive(e,i)};DirectSelect.onTouchEnd=DirectSelect.onMouseUp=function(e){e.dragMoving&&this.fireUpdate(),this.stopDragging(e)};const DrawPoint={};DrawPoint.onSetup=function(){const e=this.newFeature({type:geojsonTypes.FEATURE,properties:{},geometry:{type:geojsonTypes.POINT,coordinates:[]}});return this.addFeature(e),this.clearSelectedFeatures(),this.updateUIClasses({mouse:cursors.ADD}),this.activateUIButton(types$1.POINT),this.setActionableState({trash:!0}),{point:e}};DrawPoint.stopDrawingAndRemove=function(e){this.deleteFeature([e.point.id],{silent:!0}),this.changeMode(modes$1.SIMPLE_SELECT)};DrawPoint.onTap=DrawPoint.onClick=function(e,i){this.updateUIClasses({mouse:cursors.MOVE}),e.point.updateCoordinate("",i.lngLat.lng,i.lngLat.lat),this.fire(events$1.CREATE,{features:[e.point.toGeoJSON()]}),this.changeMode(modes$1.SIMPLE_SELECT,{featureIds:[e.point.id]})};DrawPoint.onStop=function(e){this.activateUIButton(),e.point.getCoordinate().length||this.deleteFeature([e.point.id],{silent:!0})};DrawPoint.toDisplayFeatures=function(e,i,s){const a=i.properties.id===e.point.id;if(i.properties.active=a?activeStates.ACTIVE:activeStates.INACTIVE,!a)return s(i)};DrawPoint.onTrash=DrawPoint.stopDrawingAndRemove;DrawPoint.onKeyUp=function(e,i){if(isEscapeKey(i)||isEnterKey(i))return this.stopDrawingAndRemove(e,i)};function isEventAtCoordinates(e,i){return e.lngLat?e.lngLat.lng===i[0]&&e.lngLat.lat===i[1]:!1}const DrawPolygon={};DrawPolygon.onSetup=function(){const e=this.newFeature({type:geojsonTypes.FEATURE,properties:{},geometry:{type:geojsonTypes.POLYGON,coordinates:[[]]}});return this.addFeature(e),this.clearSelectedFeatures(),doubleClickZoom.disable(this),this.updateUIClasses({mouse:cursors.ADD}),this.activateUIButton(types$1.POLYGON),this.setActionableState({trash:!0}),{polygon:e,currentVertexPosition:0}};DrawPolygon.clickAnywhere=function(e,i){if(e.currentVertexPosition>0&&isEventAtCoordinates(i,e.polygon.coordinates[0][e.currentVertexPosition-1]))return this.changeMode(modes$1.SIMPLE_SELECT,{featureIds:[e.polygon.id]});this.updateUIClasses({mouse:cursors.ADD}),e.polygon.updateCoordinate(`0.${e.currentVertexPosition}`,i.lngLat.lng,i.lngLat.lat),e.currentVertexPosition++,e.polygon.updateCoordinate(`0.${e.currentVertexPosition}`,i.lngLat.lng,i.lngLat.lat)};DrawPolygon.clickOnVertex=function(e){return this.changeMode(modes$1.SIMPLE_SELECT,{featureIds:[e.polygon.id]})};DrawPolygon.onMouseMove=function(e,i){e.polygon.updateCoordinate(`0.${e.currentVertexPosition}`,i.lngLat.lng,i.lngLat.lat),isVertex$1(i)&&this.updateUIClasses({mouse:cursors.POINTER})};DrawPolygon.onTap=DrawPolygon.onClick=function(e,i){return isVertex$1(i)?this.clickOnVertex(e,i):this.clickAnywhere(e,i)};DrawPolygon.onKeyUp=function(e,i){isEscapeKey(i)?(this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(modes$1.SIMPLE_SELECT)):isEnterKey(i)&&this.changeMode(modes$1.SIMPLE_SELECT,{featureIds:[e.polygon.id]})};DrawPolygon.onStop=function(e){this.updateUIClasses({mouse:cursors.NONE}),doubleClickZoom.enable(this),this.activateUIButton(),this.getFeature(e.polygon.id)!==void 0&&(e.polygon.removeCoordinate(`0.${e.currentVertexPosition}`),e.polygon.isValid()?this.fire(events$1.CREATE,{features:[e.polygon.toGeoJSON()]}):(this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(modes$1.SIMPLE_SELECT,{},{silent:!0})))};DrawPolygon.toDisplayFeatures=function(e,i,s){const a=i.properties.id===e.polygon.id;if(i.properties.active=a?activeStates.ACTIVE:activeStates.INACTIVE,!a)return s(i);if(i.geometry.coordinates.length===0)return;const _=i.geometry.coordinates[0].length;if(!(_<3)){if(i.properties.meta=meta.FEATURE,s(createVertex(e.polygon.id,i.geometry.coordinates[0][0],"0.0",!1)),_>3){const $=i.geometry.coordinates[0].length-3;s(createVertex(e.polygon.id,i.geometry.coordinates[0][$],`0.${$}`,!1))}if(_<=4){const $=[[i.geometry.coordinates[0][0][0],i.geometry.coordinates[0][0][1]],[i.geometry.coordinates[0][1][0],i.geometry.coordinates[0][1][1]]];if(s({type:geojsonTypes.FEATURE,properties:i.properties,geometry:{coordinates:$,type:geojsonTypes.LINE_STRING}}),_===3)return}return s(i)}};DrawPolygon.onTrash=function(e){this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(modes$1.SIMPLE_SELECT)};const DrawLineString={};DrawLineString.onSetup=function(e){e=e||{};const i=e.featureId;let s,a,_="forward";if(i){if(s=this.getFeature(i),!s)throw new Error("Could not find a feature with the provided featureId");let $=e.from;if($&&$.type==="Feature"&&$.geometry&&$.geometry.type==="Point"&&($=$.geometry),$&&$.type==="Point"&&$.coordinates&&$.coordinates.length===2&&($=$.coordinates),!$||!Array.isArray($))throw new Error("Please use the `from` property to indicate which point to continue the line from");const rt=s.coordinates.length-1;if(s.coordinates[rt][0]===$[0]&&s.coordinates[rt][1]===$[1])a=rt+1,s.addCoordinate(a,...s.coordinates[rt]);else if(s.coordinates[0][0]===$[0]&&s.coordinates[0][1]===$[1])_="backwards",a=0,s.addCoordinate(a,...s.coordinates[0]);else throw new Error("`from` should match the point at either the start or the end of the provided LineString")}else s=this.newFeature({type:geojsonTypes.FEATURE,properties:{},geometry:{type:geojsonTypes.LINE_STRING,coordinates:[]}}),a=0,this.addFeature(s);return this.clearSelectedFeatures(),doubleClickZoom.disable(this),this.updateUIClasses({mouse:cursors.ADD}),this.activateUIButton(types$1.LINE),this.setActionableState({trash:!0}),{line:s,currentVertexPosition:a,direction:_}};DrawLineString.clickAnywhere=function(e,i){if(e.currentVertexPosition>0&&isEventAtCoordinates(i,e.line.coordinates[e.currentVertexPosition-1])||e.direction==="backwards"&&isEventAtCoordinates(i,e.line.coordinates[e.currentVertexPosition+1]))return this.changeMode(modes$1.SIMPLE_SELECT,{featureIds:[e.line.id]});this.updateUIClasses({mouse:cursors.ADD}),e.line.updateCoordinate(e.currentVertexPosition,i.lngLat.lng,i.lngLat.lat),e.direction==="forward"?(e.currentVertexPosition++,e.line.updateCoordinate(e.currentVertexPosition,i.lngLat.lng,i.lngLat.lat)):e.line.addCoordinate(0,i.lngLat.lng,i.lngLat.lat)};DrawLineString.clickOnVertex=function(e){return this.changeMode(modes$1.SIMPLE_SELECT,{featureIds:[e.line.id]})};DrawLineString.onMouseMove=function(e,i){e.line.updateCoordinate(e.currentVertexPosition,i.lngLat.lng,i.lngLat.lat),isVertex$1(i)&&this.updateUIClasses({mouse:cursors.POINTER})};DrawLineString.onTap=DrawLineString.onClick=function(e,i){if(isVertex$1(i))return this.clickOnVertex(e,i);this.clickAnywhere(e,i)};DrawLineString.onKeyUp=function(e,i){isEnterKey(i)?this.changeMode(modes$1.SIMPLE_SELECT,{featureIds:[e.line.id]}):isEscapeKey(i)&&(this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(modes$1.SIMPLE_SELECT))};DrawLineString.onStop=function(e){doubleClickZoom.enable(this),this.activateUIButton(),this.getFeature(e.line.id)!==void 0&&(e.line.removeCoordinate(`${e.currentVertexPosition}`),e.line.isValid()?this.fire(events$1.CREATE,{features:[e.line.toGeoJSON()]}):(this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(modes$1.SIMPLE_SELECT,{},{silent:!0})))};DrawLineString.onTrash=function(e){this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(modes$1.SIMPLE_SELECT)};DrawLineString.toDisplayFeatures=function(e,i,s){const a=i.properties.id===e.line.id;if(i.properties.active=a?activeStates.ACTIVE:activeStates.INACTIVE,!a)return s(i);i.geometry.coordinates.length<2||(i.properties.meta=meta.FEATURE,s(createVertex(e.line.id,i.geometry.coordinates[e.direction==="forward"?i.geometry.coordinates.length-2:1],`${e.direction==="forward"?i.geometry.coordinates.length-2:1}`,!1)),s(i))};const modes={simple_select:SimpleSelect,direct_select:DirectSelect,draw_point:DrawPoint,draw_polygon:DrawPolygon,draw_line_string:DrawLineString},defaultOptions$1={defaultMode:modes$1.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles,modes,controls:{},userProperties:!1,suppressAPIEvents:!0},showControls={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},hideControls={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function addSources(e,i){return e.map(s=>s.source?s:Object.assign({},s,{id:`${s.id}.${i}`,source:i==="hot"?sources.HOT:sources.COLD}))}function setupOptions(e={}){let i=Object.assign({},e);return e.controls||(i.controls={}),e.displayControlsDefault===!1?i.controls=Object.assign({},hideControls,e.controls):i.controls=Object.assign({},showControls,e.controls),i=Object.assign({},defaultOptions$1,i),i.styles=addSources(i.styles,"cold").concat(addSources(i.styles,"hot")),i}var fastDeepEqual=function e(i,s){if(i===s)return!0;if(i&&s&&typeof i=="object"&&typeof s=="object"){if(i.constructor!==s.constructor)return!1;var a,_,$;if(Array.isArray(i)){if(a=i.length,a!=s.length)return!1;for(_=a;_--!==0;)if(!e(i[_],s[_]))return!1;return!0}if(i.constructor===RegExp)return i.source===s.source&&i.flags===s.flags;if(i.valueOf!==Object.prototype.valueOf)return i.valueOf()===s.valueOf();if(i.toString!==Object.prototype.toString)return i.toString()===s.toString();if($=Object.keys(i),a=$.length,a!==Object.keys(s).length)return!1;for(_=a;_--!==0;)if(!Object.prototype.hasOwnProperty.call(s,$[_]))return!1;for(_=a;_--!==0;){var rt=$[_];if(!e(i[rt],s[rt]))return!1}return!0}return i!==i&&s!==s};const isEqual=getDefaultExportFromCjs(fastDeepEqual);var geojsonNormalize=normalize,types={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"};function normalize(e){if(!e||!e.type)return null;var i=types[e.type];if(!i)return null;if(i==="geometry")return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:e}]};if(i==="feature")return{type:"FeatureCollection",features:[e]};if(i==="featurecollection")return e}const normalize$1=getDefaultExportFromCjs(geojsonNormalize);function stringSetsAreEqual(e,i){return e.length!==i.length?!1:JSON.stringify(e.map(s=>s).sort())===JSON.stringify(i.map(s=>s).sort())}const featureTypes={Polygon,LineString,Point:Point$1,MultiPolygon:MultiFeature,MultiLineString:MultiFeature,MultiPoint:MultiFeature};function setupAPI(e,i){i.modes=modes$1;const s=e.options.suppressAPIEvents!==void 0?!!e.options.suppressAPIEvents:!0;return i.getFeatureIdsAt=function(a){return featuresAt.click({point:a},null,e).map($=>$.properties.id)},i.getSelectedIds=function(){return e.store.getSelectedIds()},i.getSelected=function(){return{type:geojsonTypes.FEATURE_COLLECTION,features:e.store.getSelectedIds().map(a=>e.store.get(a)).map(a=>a.toGeoJSON())}},i.getSelectedPoints=function(){return{type:geojsonTypes.FEATURE_COLLECTION,features:e.store.getSelectedCoordinates().map(a=>({type:geojsonTypes.FEATURE,properties:{},geometry:{type:geojsonTypes.POINT,coordinates:a.coordinates}}))}},i.set=function(a){if(a.type===void 0||a.type!==geojsonTypes.FEATURE_COLLECTION||!Array.isArray(a.features))throw new Error("Invalid FeatureCollection");const _=e.store.createRenderBatch();let $=e.store.getAllIds().slice();const rt=i.add(a),c=new StringSet(rt);return $=$.filter(dt=>!c.has(dt)),$.length&&i.delete($),_(),rt},i.add=function(a){const $=JSON.parse(JSON.stringify(normalize$1(a))).features.map(rt=>{if(rt.id=rt.id||generateID(),rt.geometry===null)throw new Error("Invalid geometry: null");if(e.store.get(rt.id)===void 0||e.store.get(rt.id).type!==rt.geometry.type){const c=featureTypes[rt.geometry.type];if(c===void 0)throw new Error(`Invalid geometry type: ${rt.geometry.type}.`);const dt=new c(e,rt);e.store.add(dt,{silent:s})}else{const c=e.store.get(rt.id),dt=c.properties;c.properties=rt.properties,isEqual(dt,rt.properties)||e.store.featureChanged(c.id,{silent:s}),isEqual(c.getCoordinates(),rt.geometry.coordinates)||c.incomingCoords(rt.geometry.coordinates)}return rt.id});return e.store.render(),$},i.get=function(a){const _=e.store.get(a);if(_)return _.toGeoJSON()},i.getAll=function(){return{type:geojsonTypes.FEATURE_COLLECTION,features:e.store.getAll().map(a=>a.toGeoJSON())}},i.delete=function(a){return e.store.delete(a,{silent:s}),i.getMode()===modes$1.DIRECT_SELECT&&!e.store.getSelectedIds().length?e.events.changeMode(modes$1.SIMPLE_SELECT,void 0,{silent:s}):e.store.render(),i},i.deleteAll=function(){return e.store.delete(e.store.getAllIds(),{silent:s}),i.getMode()===modes$1.DIRECT_SELECT?e.events.changeMode(modes$1.SIMPLE_SELECT,void 0,{silent:s}):e.store.render(),i},i.changeMode=function(a,_={}){return a===modes$1.SIMPLE_SELECT&&i.getMode()===modes$1.SIMPLE_SELECT?(stringSetsAreEqual(_.featureIds||[],e.store.getSelectedIds())||(e.store.setSelected(_.featureIds,{silent:s}),e.store.render()),i):(a===modes$1.DIRECT_SELECT&&i.getMode()===modes$1.DIRECT_SELECT&&_.featureId===e.store.getSelectedIds()[0]||e.events.changeMode(a,_,{silent:s}),i)},i.getMode=function(){return e.events.getMode()},i.trash=function(){return e.events.trash({silent:s}),i},i.combineFeatures=function(){return e.events.combineFeatures({silent:s}),i},i.uncombineFeatures=function(){return e.events.uncombineFeatures({silent:s}),i},i.setFeatureProperty=function(a,_,$){return e.store.setFeatureProperty(a,_,$,{silent:s}),i},i}const lib=Object.freeze(Object.defineProperty({__proto__:null,CommonSelectors:common_selectors,ModeHandler,StringSet,constrainFeatureMovement,createMidPoint:createMidpoint,createSupplementaryPoints,createVertex,doubleClickZoom,euclideanDistance,featuresAt,getFeatureAtAndSetCursors,isClick,isEventAtCoordinates,isTap,mapEventToBoundingBox,moveFeatures,sortFeatures,stringSetsAreEqual,theme:styles,toDenseArray},Symbol.toStringTag,{value:"Module"})),setupDraw=function(e,i){e=setupOptions(e);const s={options:e};i=setupAPI(s,i),s.api=i;const a=runSetup(s);return i.onAdd=a.onAdd,i.onRemove=a.onRemove,i.types=types$1,i.options=e,i};function MapboxDraw(e){setupDraw(e,this)}MapboxDraw.modes=modes;MapboxDraw.constants=Constants;MapboxDraw.lib=lib;function ZoneDrawer({onZoneChange:e,initialZone:i,height:s="400px",showCurrentLocation:a=!0}){const _=reactExports.useRef(null),$=reactExports.useRef(null),rt=reactExports.useRef(null),c=reactExports.useRef(null),[dt,ht]=reactExports.useState(!0),[Et,St]=reactExports.useState(!!i),[At,Pt]=reactExports.useState(null),[Vt,Bt]=reactExports.useState(!1),Zt=()=>{navigator.geolocation&&(Bt(!0),navigator.geolocation.getCurrentPosition(Ut=>{var er;const{latitude:Nt,longitude:Gt}=Ut.coords;if(Pt({lat:Nt,lng:Gt}),c.current)c.current.setLngLat([Gt,Nt]);else if($.current){const ir=document.createElement("div");ir.className="current-location-marker",ir.innerHTML=`
            <div style="
              width: 20px;
              height: 20px;
              background: hsl(24, 95%, 53%);
              border: 3px solid white;
              border-radius: 50%;
              box-shadow: 0 2px 8px rgba(0,0,0,0.3);
              position: relative;
            ">
              <div style="
                position: absolute;
                width: 40px;
                height: 40px;
                background: hsla(24, 95%, 53%, 0.2);
                border-radius: 50%;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                animation: pulse 2s infinite;
              "></div>
            </div>
          `,c.current=new mapboxgl.Marker(ir).setLngLat([Gt,Nt]).setPopup(new mapboxgl.Popup({offset:25}).setText("Your current location")).addTo($.current)}(er=$.current)==null||er.flyTo({center:[Gt,Nt],zoom:13,duration:1500}),Bt(!1)},Ut=>{console.error("Location error:",Ut),Bt(!1)},{enableHighAccuracy:!0,timeout:1e4}))};reactExports.useEffect(()=>{if(!_.current)return;mapboxgl.accessToken=MAPBOX_ACCESS_TOKEN,$.current=new mapboxgl.Map({container:_.current,style:"mapbox://styles/mapbox/streets-v12",center:[78.4867,17.385],zoom:10,attributionControl:!1}),rt.current=new MapboxDraw({displayControlsDefault:!1,controls:{polygon:!0,trash:!0},defaultMode:"simple_select",styles:[{id:"gl-draw-polygon-fill",type:"fill",filter:["all",["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":"#f97316","fill-outline-color":"#f97316","fill-opacity":.2}},{id:"gl-draw-polygon-stroke",type:"line",filter:["all",["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#f97316","line-width":3}},{id:"gl-draw-polygon-and-line-vertex-halo-active",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-active",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#f97316"}}]}),$.current.addControl(rt.current,"top-left"),$.current.addControl(new mapboxgl.NavigationControl,"bottom-right"),$.current.on("load",()=>{var Nt;if(ht(!1),i&&rt.current){const Gt={type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:i.coordinates}};rt.current.add(Gt),St(!0);const er=i.coordinates[0],ir=new mapboxgl.LngLatBounds;er.forEach(or=>ir.extend([or[0],or[1]])),(Nt=$.current)==null||Nt.fitBounds(ir,{padding:50})}}),$.current.on("draw.create",Ut),$.current.on("draw.update",Ut),$.current.on("draw.delete",()=>{St(!1),e(null)});function Ut(){if(!rt.current)return;const Nt=rt.current.getAll();if(Nt.features.length>0){const Gt=Nt.features.filter(or=>or.geometry.type==="Polygon");if(Gt.length>1)for(let or=0;or<Gt.length-1;or++)rt.current.delete(Gt[or].id);const er=Gt[Gt.length-1],ir=geoJSONToZonePolygon(er);St(!!ir),e(ir)}else St(!1),e(null)}return a&&Zt(),()=>{var Nt,Gt;(Nt=c.current)==null||Nt.remove(),(Gt=$.current)==null||Gt.remove()}},[]);const zt=()=>{rt.current&&(rt.current.deleteAll(),St(!1),e(null))};return jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsx("style",{children:`
        @keyframes pulse {
          0% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
          100% { transform: translate(-50%, -50%) scale(2); opacity: 0; }
        }
      `}),jsxRuntimeExports.jsxs("div",{className:"relative rounded-xl overflow-hidden",style:{height:s},children:[jsxRuntimeExports.jsx("div",{ref:_,className:"absolute inset-0"}),dt&&jsxRuntimeExports.jsx("div",{className:"absolute inset-0 bg-secondary flex items-center justify-center",children:jsxRuntimeExports.jsx(LoaderCircle,{className:"w-6 h-6 animate-spin text-primary"})}),a&&jsxRuntimeExports.jsx(Button,{size:"sm",variant:"secondary",className:"absolute bottom-3 left-3 shadow-lg",onClick:Zt,disabled:Vt,children:Vt?jsxRuntimeExports.jsx(LoaderCircle,{className:"w-4 h-4 animate-spin"}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Navigation,{className:"w-4 h-4 mr-1"}),"My Location"]})}),jsxRuntimeExports.jsx("div",{className:"absolute top-3 right-3 bg-card/90 backdrop-blur-sm rounded-lg px-3 py-2 max-w-[200px]",children:jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:Et?"Zone drawn! Click on the zone to edit or delete.":"Click the polygon tool (top-left) to draw a service zone."})}),At&&jsxRuntimeExports.jsx("div",{className:"absolute top-3 left-14 bg-card/90 backdrop-blur-sm rounded-lg px-3 py-2",children:jsxRuntimeExports.jsxs("p",{className:"text-xs text-primary font-medium flex items-center gap-1",children:[jsxRuntimeExports.jsx("span",{className:"w-2 h-2 bg-primary rounded-full animate-pulse"}),"Live Location"]})})]}),Et&&jsxRuntimeExports.jsxs(Button,{variant:"outline",className:"w-full text-destructive border-destructive",onClick:zt,children:[jsxRuntimeExports.jsx(Trash2,{className:"w-4 h-4 mr-2"})," Clear Zone"]})]})}const ALL_ROLES=[{value:"user",label:"User"},{value:"amma",label:"Amma"},{value:"admin",label:"Admin"},{value:"franchise_admin",label:"Franchise Admin"},{value:"super_admin",label:"Super Admin"}];function SuperAdminDashboard(){const{user:e,signOut:i}=useAuth(),s=useNavigate(),{isAuthorized:a,isLoading:_}=useRoleRedirect(["super_admin","admin"]),{franchises:$,loading:rt}=useFranchises(),{users:c,refetch:dt}=useAllUsersForAdmin(),{kitchens:ht}=useAllKitchens(),[Et,St]=reactExports.useState("franchises"),[At,Pt]=reactExports.useState(!1),Vt=async()=>{if(confirm('CRITICAL WARNING: This will delete ALL users, franchises, kitchens, dishes, and orders. Only the Super Admin account will remain. This action cannot be undone. Type "DELETE" to confirm.')&&prompt('Type "DELETE" to confirm database reset:')==="DELETE"){Pt(!0);try{await clearAllDataExceptSuperAdmin(),ue.success("Database has been reset successfully"),dt(),window.location.reload()}catch{ue.error("Failed to reset database")}finally{Pt(!1)}}},[Bt,Zt]=reactExports.useState(!1),[zt,Ut]=reactExports.useState(!1),[Nt,Gt]=reactExports.useState(!1),[er,ir]=reactExports.useState(null),[or,mr]=reactExports.useState("user"),[Rr,on]=reactExports.useState(!1),[un,jr]=reactExports.useState(!1),[Jr,fn]=reactExports.useState(!1),[Fr,Cr]=reactExports.useState({name:"",description:"",adminId:"",zone:null}),[Sr,dr]=reactExports.useState({email:"",password:"",name:"",phone:""}),gr=c.filter(On=>On.role==="user"||On.role==="admin"||On.role==="franchise_admin"),qr=ht.filter(On=>!On.isApproved),Lr=async()=>{if(!Sr.email||!Sr.password||!Sr.name||!Sr.phone){ue.error("Please fill all fields");return}if(Sr.password.length<6){ue.error("Password must be at least 6 characters");return}jr(!0);try{await createFranchiseAdmin(Sr.email,Sr.password,Sr.name,Sr.phone),ue.success("Franchise Admin created successfully!"),Ut(!1),dr({email:"",password:"",name:"",phone:""}),dt()}catch(On){ue.error(On.message||"Failed to create admin")}finally{jr(!1)}},_n=async On=>{try{await approveKitchen(On),ue.success("Kitchen approved!")}catch{ue.error("Failed to approve kitchen")}},gn=async On=>{if(confirm("Are you sure you want to reject this kitchen?"))try{await rejectKitchen(On),ue.success("Kitchen rejected")}catch{ue.error("Failed to reject kitchen")}},Sn=async()=>{if(!er)return;if(er.currentRole==="amma"&&or!=="amma"||er.currentRole==="franchise_admin"&&or!=="franchise_admin"){const ws=er.currentRole==="amma"?"kitchens and dishes":"franchise assignment";if(!confirm(`Warning: Changing this role will delete all ${ws} for this user. Continue?`))return}fn(!0);try{await updateUserRole(er.id,or,er.currentRole),ue.success(`Role updated to ${or.replace("_"," ")}`),Gt(!1),ir(null),dt()}catch{ue.error("Failed to update role")}finally{fn(!1)}},Fs=(On,ws,Vs)=>{ir({id:On,name:ws,currentRole:Vs}),mr(Vs),Gt(!0)},rs=async()=>{if(!e)return;if(!Fr.name||!Fr.adminId||!Fr.zone){ue.error("Please fill all fields and draw a zone");return}const On=c.find(ws=>ws.id===Fr.adminId);if(!On){ue.error("Invalid admin selected");return}on(!0);try{await createFranchise({name:Fr.name,description:Fr.description,adminId:Fr.adminId,adminName:On.name,adminEmail:On.email,zone:Fr.zone,isActive:!0,createdAt:Date.now(),createdBy:e.id}),ue.success("Franchise created successfully!"),Zt(!1),Cr({name:"",description:"",adminId:"",zone:null})}catch{ue.error("Failed to create franchise")}finally{on(!1)}},ms=async(On,ws)=>{if(confirm("Are you sure you want to delete this franchise?"))try{await deleteFranchise(On,ws),ue.success("Franchise deleted")}catch{ue.error("Failed to delete franchise")}};return _||!a?jsxRuntimeExports.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:jsxRuntimeExports.jsx(LoaderCircle,{className:"w-8 h-8 animate-spin text-primary"})}):jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-24",children:[jsxRuntimeExports.jsxs("header",{className:"sticky top-0 z-40 bg-card/95 backdrop-blur-lg border-b border-border",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between px-4 py-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h1",{className:"font-semibold text-foreground",children:"Super Admin"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Franchise Management"})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[qr.length>0&&jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 rounded-full bg-gold text-foreground text-xs",children:[jsxRuntimeExports.jsx(TriangleAlert,{className:"w-3 h-3"}),qr.length," pending"]}),jsxRuntimeExports.jsx(Button,{variant:"ghost",size:"sm",onClick:async()=>{await i(),s("/auth")},className:"text-destructive",children:"Logout"})]})]}),jsxRuntimeExports.jsx("div",{className:"flex bg-secondary mx-4 rounded-xl p-1 mb-4",children:["franchises","users","kitchens","system"].map(On=>jsxRuntimeExports.jsx("button",{onClick:()=>St(On),className:`flex-1 py-2 rounded-lg text-sm font-medium transition-all capitalize ${Et===On?"bg-card text-foreground shadow-soft":"text-muted-foreground"}`,children:On},On))})]}),jsxRuntimeExports.jsxs("div",{className:"px-4 py-4",children:[Et==="franchises"&&jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsxs("h2",{className:"font-semibold text-foreground",children:["Franchises (",$.length,")"]}),jsxRuntimeExports.jsxs(Dialog,{open:Bt,onOpenChange:Zt,children:[jsxRuntimeExports.jsx(DialogTrigger,{asChild:!0,children:jsxRuntimeExports.jsxs(Button,{size:"sm",className:"gradient-primary text-primary-foreground",children:[jsxRuntimeExports.jsx(Plus,{className:"w-4 h-4 mr-1"})," Add Franchise"]})}),jsxRuntimeExports.jsxs(DialogContent,{className:"max-w-lg max-h-[90vh] overflow-y-auto",children:[jsxRuntimeExports.jsx(DialogHeader,{children:jsxRuntimeExports.jsx(DialogTitle,{children:"Create New Franchise"})}),jsxRuntimeExports.jsxs("div",{className:"space-y-4 mt-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Label$1,{children:"Franchise Name"}),jsxRuntimeExports.jsx(Input,{placeholder:"e.g., Hyderabad Central",value:Fr.name,onChange:On=>Cr({...Fr,name:On.target.value}),className:"bg-secondary border-0 mt-1"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Label$1,{children:"Description"}),jsxRuntimeExports.jsx(Textarea,{placeholder:"Brief description of this franchise area...",value:Fr.description,onChange:On=>Cr({...Fr,description:On.target.value}),className:"bg-secondary border-0 mt-1 resize-none",rows:2})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Label$1,{children:"Assign Franchise Admin"}),jsxRuntimeExports.jsxs(Select,{value:Fr.adminId,onValueChange:On=>Cr({...Fr,adminId:On}),children:[jsxRuntimeExports.jsx(SelectTrigger,{className:"bg-secondary border-0 mt-1",children:jsxRuntimeExports.jsx(SelectValue,{placeholder:"Select a user to assign as admin"})}),jsxRuntimeExports.jsx(SelectContent,{children:gr.map(On=>jsxRuntimeExports.jsxs(SelectItem,{value:On.id,children:[On.name," (",On.email,")"]},On.id))})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Label$1,{children:"Draw Service Zone"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground mb-2",children:"Draw a polygon on the map to define the service area"}),jsxRuntimeExports.jsx(ZoneDrawer,{onZoneChange:On=>Cr({...Fr,zone:On}),height:"300px"})]}),jsxRuntimeExports.jsx(Button,{onClick:rs,disabled:Rr,className:"w-full gradient-primary text-primary-foreground",children:Rr?jsxRuntimeExports.jsx(LoaderCircle,{className:"w-5 h-5 animate-spin"}):"Create Franchise"})]})]})]})]}),rt?jsxRuntimeExports.jsx("div",{className:"flex justify-center py-8",children:jsxRuntimeExports.jsx(LoaderCircle,{className:"w-8 h-8 animate-spin text-primary"})}):$.length===0?jsxRuntimeExports.jsxs("div",{className:"text-center py-12",children:[jsxRuntimeExports.jsx(Store$1,{className:"w-12 h-12 text-muted-foreground mx-auto mb-3"}),jsxRuntimeExports.jsx("p",{className:"text-muted-foreground",children:"No franchises yet"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:"Create your first franchise to get started"})]}):$.map(On=>jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"bg-card rounded-2xl p-4 shadow-card",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-start justify-between mb-3",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-foreground",children:On.name}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:On.description})]}),jsxRuntimeExports.jsx("span",{className:cn("px-2 py-1 rounded-full text-xs font-medium",On.isActive?"bg-veg/20 text-veg":"bg-muted text-muted-foreground"),children:On.isActive?"Active":"Inactive"})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground mb-3",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1",children:[jsxRuntimeExports.jsx(Users,{className:"w-4 h-4"}),jsxRuntimeExports.jsx("span",{children:On.adminName})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1",children:[jsxRuntimeExports.jsx(Store$1,{className:"w-4 h-4"}),jsxRuntimeExports.jsxs("span",{children:[ht.filter(ws=>ws.franchiseId===On.id).length," kitchens"]})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsxs(Button,{variant:"outline",size:"sm",onClick:()=>s(`/super-admin/franchise/${On.id}`),children:[jsxRuntimeExports.jsx(Eye,{className:"w-4 h-4 mr-1"})," View"]}),jsxRuntimeExports.jsx(Button,{variant:"outline",size:"sm",className:"text-destructive border-destructive",onClick:()=>ms(On.id,On.adminId),children:jsxRuntimeExports.jsx(Trash2,{className:"w-4 h-4"})})]})]},On.id))]}),Et==="users"&&jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsxs("h2",{className:"font-semibold text-foreground",children:["All Users (",c.length,")"]}),jsxRuntimeExports.jsxs(Dialog,{open:zt,onOpenChange:Ut,children:[jsxRuntimeExports.jsx(DialogTrigger,{asChild:!0,children:jsxRuntimeExports.jsxs(Button,{size:"sm",className:"gradient-primary text-primary-foreground",children:[jsxRuntimeExports.jsx(UserPlus,{className:"w-4 h-4 mr-1"})," Create Admin"]})}),jsxRuntimeExports.jsxs(DialogContent,{className:"max-w-md",children:[jsxRuntimeExports.jsx(DialogHeader,{children:jsxRuntimeExports.jsx(DialogTitle,{children:"Create Franchise Admin"})}),jsxRuntimeExports.jsxs("div",{className:"space-y-4 mt-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Label$1,{children:"Name"}),jsxRuntimeExports.jsx(Input,{placeholder:"Admin Name",value:Sr.name,onChange:On=>dr({...Sr,name:On.target.value}),className:"bg-secondary border-0 mt-1"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Label$1,{children:"Email"}),jsxRuntimeExports.jsx(Input,{type:"email",placeholder:"admin@example.com",value:Sr.email,onChange:On=>dr({...Sr,email:On.target.value}),className:"bg-secondary border-0 mt-1"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Label$1,{children:"Phone"}),jsxRuntimeExports.jsx(Input,{placeholder:"9876543210",value:Sr.phone,onChange:On=>dr({...Sr,phone:On.target.value}),className:"bg-secondary border-0 mt-1"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Label$1,{children:"Password"}),jsxRuntimeExports.jsx(Input,{type:"password",placeholder:"Min 6 characters",value:Sr.password,onChange:On=>dr({...Sr,password:On.target.value}),className:"bg-secondary border-0 mt-1"})]}),jsxRuntimeExports.jsx(Button,{onClick:Lr,disabled:un,className:"w-full gradient-primary text-primary-foreground",children:un?jsxRuntimeExports.jsx(LoaderCircle,{className:"w-5 h-5 animate-spin"}):"Create Franchise Admin"})]})]})]})]}),c.map(On=>jsxRuntimeExports.jsx("div",{className:"bg-card rounded-xl p-4 shadow-card",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsx("p",{className:"font-medium text-foreground",children:On.name}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:On.email})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("span",{className:cn("px-2 py-1 rounded-full text-xs font-medium capitalize",On.role==="super_admin"&&"bg-primary/20 text-primary",On.role==="franchise_admin"&&"bg-accent/20 text-accent-foreground",On.role==="amma"&&"bg-veg/20 text-veg",On.role==="admin"&&"bg-gold/20 text-gold",On.role==="user"&&"bg-secondary text-secondary-foreground"),children:On.role.replace("_"," ")}),On.id!==(e==null?void 0:e.id)&&jsxRuntimeExports.jsx(Button,{variant:"outline",size:"sm",onClick:()=>Fs(On.id,On.name,On.role),children:jsxRuntimeExports.jsx(SquarePen,{className:"w-3 h-3"})})]})]})},On.id)),jsxRuntimeExports.jsx(Dialog,{open:Nt,onOpenChange:Gt,children:jsxRuntimeExports.jsxs(DialogContent,{className:"max-w-sm",children:[jsxRuntimeExports.jsx(DialogHeader,{children:jsxRuntimeExports.jsx(DialogTitle,{children:"Change User Role"})}),jsxRuntimeExports.jsxs("div",{className:"space-y-4 mt-4",children:[jsxRuntimeExports.jsxs("p",{className:"text-sm text-muted-foreground",children:["Change role for ",jsxRuntimeExports.jsx("span",{className:"font-medium text-foreground",children:er==null?void 0:er.name})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Label$1,{children:"New Role"}),jsxRuntimeExports.jsxs(Select,{value:or,onValueChange:On=>mr(On),children:[jsxRuntimeExports.jsx(SelectTrigger,{className:"bg-secondary border-0 mt-1",children:jsxRuntimeExports.jsx(SelectValue,{})}),jsxRuntimeExports.jsx(SelectContent,{children:ALL_ROLES.map(On=>jsxRuntimeExports.jsx(SelectItem,{value:On.value,children:On.label},On.value))})]})]}),jsxRuntimeExports.jsx(Button,{onClick:Sn,disabled:Jr||or===(er==null?void 0:er.currentRole),className:"w-full gradient-primary text-primary-foreground",children:Jr?jsxRuntimeExports.jsx(LoaderCircle,{className:"w-5 h-5 animate-spin"}):"Update Role"})]})]})})]}),Et==="kitchens"&&jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("h2",{className:"font-semibold text-foreground",children:["All Kitchens (",ht.length,")"]}),qr.length>0&&jsxRuntimeExports.jsxs("div",{className:"bg-gold/10 rounded-2xl p-4 mb-4",children:[jsxRuntimeExports.jsxs("h3",{className:"font-semibold text-foreground mb-3 flex items-center gap-2",children:[jsxRuntimeExports.jsx(TriangleAlert,{className:"w-4 h-4 text-gold"}),"Pending Approvals (",qr.length,")"]}),jsxRuntimeExports.jsx("div",{className:"space-y-3",children:qr.map(On=>{var ws;return jsxRuntimeExports.jsx("div",{className:"bg-card rounded-xl p-4 shadow-card",children:jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("img",{src:On.image,alt:On.name,className:"w-16 h-16 rounded-lg object-cover"}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsx("p",{className:"font-medium text-foreground",children:On.name}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:On.address.city}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:(ws=On.specialties)==null?void 0:ws.join(", ")})]}),jsxRuntimeExports.jsxs("div",{className:"flex flex-col gap-1",children:[jsxRuntimeExports.jsx(Button,{size:"sm",className:"bg-veg text-primary-foreground",onClick:()=>_n(On.id),children:jsxRuntimeExports.jsx(Check,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx(Button,{size:"sm",variant:"outline",className:"text-destructive border-destructive",onClick:()=>gn(On.id),children:jsxRuntimeExports.jsx(X,{className:"w-4 h-4"})})]})]})},On.id)})})]}),ht.filter(On=>On.isApproved).map(On=>{const ws=$.find(Vs=>Vs.id===On.franchiseId);return jsxRuntimeExports.jsx("div",{className:"bg-card rounded-xl p-4 shadow-card",children:jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("img",{src:On.image,alt:On.name,className:"w-16 h-16 rounded-lg object-cover"}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsx("p",{className:"font-medium text-foreground",children:On.name}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:On.address.city}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[jsxRuntimeExports.jsx("span",{className:"px-2 py-0.5 rounded-full text-xs bg-veg/20 text-veg",children:"Approved"}),ws&&jsxRuntimeExports.jsx("span",{className:"px-2 py-0.5 rounded-full text-xs bg-primary/20 text-primary",children:ws.name})]})]})]})},On.id)})]}),Et==="system"&&jsxRuntimeExports.jsxs("div",{className:"space-y-6",children:[jsxRuntimeExports.jsx("h2",{className:"font-semibold text-foreground",children:"System Management"}),jsxRuntimeExports.jsxs("div",{className:"bg-destructive/10 border border-destructive/20 rounded-2xl p-6",children:[jsxRuntimeExports.jsxs("h3",{className:"font-semibold text-destructive flex items-center gap-2 mb-4",children:[jsxRuntimeExports.jsx(TriangleAlert,{className:"w-5 h-5"}),"Danger Zone"]}),jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h4",{className:"font-medium text-foreground",children:"Reset Database"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"This will permanently delete all data including users, franchises, kitchens, dishes, and orders. Only the Super Admin account will be preserved."})]}),jsxRuntimeExports.jsx(Button,{variant:"destructive",onClick:Vt,disabled:At,className:"w-full sm:w-auto",children:At?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(LoaderCircle,{className:"w-4 h-4 mr-2 animate-spin"}),"Resetting..."]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Trash2,{className:"w-4 h-4 mr-2"}),"Reset Database (Keep Super Admin)"]})})]})]})]})]})]})}function PendingApproval({kitchenName:e}){const{signOut:i}=useAuth(),s=useNavigate();return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[jsxRuntimeExports.jsx("header",{className:"sticky top-0 z-40 bg-card/95 backdrop-blur-lg border-b border-border",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between px-4 py-4",children:[jsxRuntimeExports.jsx("h1",{className:"font-semibold text-foreground",children:"Kitchen Status"}),jsxRuntimeExports.jsx(Button,{variant:"ghost",size:"icon",onClick:async()=>{await i(),s("/auth")},className:"text-destructive",children:jsxRuntimeExports.jsx(LogOut,{className:"w-5 h-5"})})]})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center px-6 py-12",children:[jsxRuntimeExports.jsx(motion.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:200,damping:20},className:"w-24 h-24 rounded-full bg-gold/20 flex items-center justify-center mb-6",children:jsxRuntimeExports.jsx(Clock,{className:"w-12 h-12 text-gold"})}),jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"text-center max-w-sm",children:[jsxRuntimeExports.jsx("h2",{className:"text-2xl font-bold text-foreground mb-2",children:"Pending Approval"}),jsxRuntimeExports.jsx("div",{className:"bg-card rounded-xl p-4 shadow-card mb-6",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[jsxRuntimeExports.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center",children:jsxRuntimeExports.jsx(ChefHat,{className:"w-6 h-6 text-primary"})}),jsxRuntimeExports.jsxs("div",{className:"text-left",children:[jsxRuntimeExports.jsx("p",{className:"font-semibold text-foreground",children:e}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Your Kitchen"})]})]})}),jsxRuntimeExports.jsx("p",{className:"text-muted-foreground mb-6",children:"Your kitchen registration is under review by the franchise admin. You'll be automatically redirected once approved."}),jsxRuntimeExports.jsx("div",{className:"space-y-3",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground bg-secondary rounded-lg p-3",children:[jsxRuntimeExports.jsx("div",{className:"w-2 h-2 rounded-full bg-gold animate-pulse"}),jsxRuntimeExports.jsx("span",{children:"Waiting for franchise admin approval..."})]})})]}),jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.4},className:"mt-8",children:jsxRuntimeExports.jsxs(Button,{variant:"outline",onClick:()=>s("/"),className:"gap-2",children:[jsxRuntimeExports.jsx(House,{className:"w-4 h-4"}),"Browse as Customer"]})})]})]})}function AmmaRouteWrapper({children:e}){const{user:i,loading:s}=useAuth(),{kitchens:a,loading:_}=useAmmaKitchens(i==null?void 0:i.id);if(s)return jsxRuntimeExports.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:jsxRuntimeExports.jsx(LoaderCircle,{className:"w-8 h-8 animate-spin text-primary"})});if(!i)return jsxRuntimeExports.jsx(Navigate,{to:"/auth",replace:!0});if(_)return jsxRuntimeExports.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:jsxRuntimeExports.jsx(LoaderCircle,{className:"w-8 h-8 animate-spin text-primary"})});if(a.length>0){const $=a[0];if(!$.isApproved)return jsxRuntimeExports.jsx(PendingApproval,{kitchenName:$.name})}return jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:e})}function LocationSelectionPage(){const e=useNavigate(),{userLocation:i,setUserLocation:s}=useLocationContext(),{user:a,updateUserLocation:_}=useAuth(),[$,rt]=reactExports.useState(null),[c,dt]=reactExports.useState(!1),[ht,Et]=reactExports.useState("home"),St=Pt=>{rt(Pt)},At=async()=>{if(!(!$||!$.franchiseId)){if(dt(!0),s({lat:$.lat,lng:$.lng,address:$.address}),a)try{await _($.lat,$.lng,$.address,ht)}catch(Pt){console.error("Failed to update user profile location:",Pt)}await new Promise(Pt=>setTimeout(Pt,500)),dt(!1),e(-1)}};return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[jsxRuntimeExports.jsxs("div",{className:"px-4 py-3 border-b border-border flex items-center gap-3 bg-card sticky top-0 z-10",children:[jsxRuntimeExports.jsx(Button,{variant:"ghost",size:"icon",onClick:()=>e(-1),children:jsxRuntimeExports.jsx(ArrowLeft,{className:"w-5 h-5"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h1",{className:"font-semibold text-lg",children:"Select Location"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Deliver to"})]})]}),jsxRuntimeExports.jsx("div",{className:"flex-1 relative",children:jsxRuntimeExports.jsx(FranchiseZoneLocationPicker,{onLocationSelect:St,initialLocation:i?{lat:i.lat,lng:i.lng}:void 0,label:"Delivery Location",instructions:"Drag pin to your exact delivery location",fullScreen:!0,showZoomControls:!1})}),jsxRuntimeExports.jsx("div",{className:"p-4 bg-card border-t border-border sticky bottom-0 z-10",children:jsxRuntimeExports.jsxs("div",{className:"max-w-md mx-auto",children:[jsxRuntimeExports.jsxs("div",{className:"mb-4",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium mb-3",children:"Save as"}),jsxRuntimeExports.jsx("div",{className:"flex gap-3",children:["home","work","other"].map(Pt=>jsxRuntimeExports.jsxs("button",{onClick:()=>Et(Pt),className:`flex items-center gap-2 px-4 py-2 rounded-full border transition-all ${ht===Pt?"bg-primary text-primary-foreground border-primary":"bg-background border-border text-muted-foreground hover:border-primary/50"}`,children:[Pt==="home"&&jsxRuntimeExports.jsx(House,{className:"w-4 h-4"}),Pt==="work"&&jsxRuntimeExports.jsx(Briefcase,{className:"w-4 h-4"}),Pt==="other"&&jsxRuntimeExports.jsx(MapPin,{className:"w-4 h-4"}),jsxRuntimeExports.jsx("span",{className:"capitalize",children:Pt})]},Pt))})]}),jsxRuntimeExports.jsx(Button,{className:"w-full font-semibold py-6 text-base",size:"lg",onClick:At,disabled:!$||!$.franchiseId||c,children:c?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(LoaderCircle,{className:"mr-2 h-5 w-5 animate-spin"}),"Confirming..."]}):"Confirm Location"}),$&&!$.franchiseId&&jsxRuntimeExports.jsx("p",{className:"text-center text-destructive text-sm mt-2",children:"Location outside service area"})]})})]})}function CouponsPage(){var c;const e=useNavigate(),{cart:i,applyCoupon:s}=useCart(),{coupons:a,loading:_}=useCoupons(i.kitchenId||void 0),$=dt=>{s(dt),ue.success(`Coupon ${dt.code} applied!`),e("/cart")},rt={id:"pa1-default",code:"PA1",kitchenId:"system",discountType:"final_price",discountValue:1,minOrderAmount:0,usedCount:0,isActive:!0,createdAt:Date.now()};return i.kitchenId?jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background",children:[jsxRuntimeExports.jsxs("div",{className:"sticky top-0 z-10 bg-card/95 backdrop-blur-md border-b border-border px-4 py-3 flex items-center gap-3",children:[jsxRuntimeExports.jsx(Button,{variant:"ghost",size:"icon",onClick:()=>e(-1),children:jsxRuntimeExports.jsx(ArrowLeft,{className:"w-5 h-5"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h1",{className:"font-semibold text-lg",children:"Apply Coupon"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Detailed Savings"})]})]}),jsxRuntimeExports.jsx("div",{className:"p-4 space-y-6",children:jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h2",{className:"text-sm font-semibold text-muted-foreground uppercase tracking-wide mb-3",children:"Best Offers for You"}),jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{onClick:()=>$(rt),className:"bg-card border border-border rounded-xl p-4 relative overflow-hidden cursor-pointer hover:border-primary transition-all shadow-sm active:scale-[0.98]",children:[jsxRuntimeExports.jsx("div",{className:"absolute top-0 right-0 bg-gold/10 text-gold text-[10px] font-bold px-2 py-1 rounded-bl-lg",children:"SPECIAL"}),jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-4",children:[jsxRuntimeExports.jsx("div",{className:"w-12 h-12 rounded-lg bg-gold/10 flex items-center justify-center flex-shrink-0",children:jsxRuntimeExports.jsx(Percent,{className:"w-6 h-6 text-gold"})}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsx("h3",{className:"font-bold text-foreground",children:"PAY ONLY 1"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-green-600 font-medium mb-1",children:"Code: PA1"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Get your entire order for just 1. Limited time special offer!"})]}),((c=i.appliedCoupon)==null?void 0:c.code)==="PA1"&&jsxRuntimeExports.jsx(Check,{className:"w-6 h-6 text-primary"})]}),jsxRuntimeExports.jsx("div",{className:"mt-3 pt-3 border-t border-dashed border-border flex justify-between items-center text-xs",children:jsxRuntimeExports.jsx("span",{className:"text-primary font-bold",children:"APPLY COUPON"})})]}),_?jsxRuntimeExports.jsx(LoadingAnimation,{fullScreen:!1,className:"h-40"}):a.length>0?a.map(dt=>{var ht,Et;return jsxRuntimeExports.jsxs("div",{onClick:()=>$(dt),className:`bg-card border ${((ht=i.appliedCoupon)==null?void 0:ht.id)===dt.id?"border-primary bg-primary/5":"border-border"} rounded-xl p-4 relative overflow-hidden cursor-pointer hover:border-primary transition-all shadow-sm active:scale-[0.98]`,children:[jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-4",children:[jsxRuntimeExports.jsx("div",{className:"w-12 h-12 rounded-lg bg-primary/10 flex items-center justify-center flex-shrink-0",children:jsxRuntimeExports.jsx(Tag,{className:"w-6 h-6 text-primary"})}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsx("h3",{className:"font-bold text-foreground",children:dt.discountType==="percentage"?`${dt.discountValue}% OFF`:dt.discountType==="fixed"?`FLAT ${dt.discountValue} OFF`:`PAY ${dt.discountValue}`}),jsxRuntimeExports.jsxs("p",{className:"text-sm text-green-600 font-medium mb-1",children:["Code: ",dt.code]}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-muted-foreground",children:[dt.minOrderAmount?`Min order: ${dt.minOrderAmount}`:"No minimum order",dt.maxDiscount?` | Max info: ${dt.maxDiscount}`:""]})]}),((Et=i.appliedCoupon)==null?void 0:Et.id)===dt.id&&jsxRuntimeExports.jsx(Check,{className:"w-6 h-6 text-primary"})]}),jsxRuntimeExports.jsx("div",{className:"mt-3 pt-3 border-t border-dashed border-border flex justify-between items-center text-xs",children:jsxRuntimeExports.jsx("span",{className:"text-primary font-bold",children:"APPLY COUPON"})})]},dt.id)}):jsxRuntimeExports.jsx("div",{className:"text-center py-4 text-muted-foreground text-sm",children:"No other coupons available"})]})]})})]}):jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background flex flex-col items-center justify-center p-4",children:[jsxRuntimeExports.jsx("p",{className:"text-muted-foreground mb-4",children:"Cart is empty or no kitchen selected."}),jsxRuntimeExports.jsx(Button,{onClick:()=>e("/"),children:"Go Home"})]})}const NotFound=()=>{const e=useLocation();return reactExports.useEffect(()=>{console.error("404 Error: User attempted to access non-existent route:",e.pathname)},[e.pathname]),jsxRuntimeExports.jsx("div",{className:"flex min-h-screen items-center justify-center bg-muted",children:jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx("h1",{className:"mb-4 text-4xl font-bold",children:"404"}),jsxRuntimeExports.jsx("p",{className:"mb-4 text-xl text-muted-foreground",children:"Oops! Page not found"}),jsxRuntimeExports.jsx(Link,{to:"/",className:"text-primary underline hover:text-primary/90",children:"Return to Home"})]})})},v="5.1.7",fr=30,ip=25,op=69,w=600,h=600,nm="success",ddd=0,assets=[{id:"comp_0",layers:[{ddd:0,ind:1,ty:4,nm:"Layer 4 Outlines",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[115.68,468.673,0],ix:2},a:{a:0,k:[26.859,26.86,0],ix:1},s:{a:0,k:[100,100,100],ix:6}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0]],o:[[0,0],[0,0]],v:[[-20.859,20.86],[20.859,-20.86]],c:!1},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"st",c:{a:0,k:[0,.788000009574,.522000002394,1],ix:3},o:{a:0,k:100,ix:4},w:{a:0,k:12,ix:5},lc:1,lj:1,ml:10,nm:"Stroke 1",mn:"ADBE Vector Graphic - Stroke",hd:!1},{ty:"tr",p:{a:0,k:[26.859,26.86],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,ix:1,mn:"ADBE Vector Group",hd:!1},{ty:"tm",s:{a:0,k:0,ix:1},e:{a:1,k:[{i:{x:[0],y:[1]},o:{x:[.333],y:[0]},n:["0_1_0p333_0"],t:4,s:[100],e:[0]},{t:22}],ix:2},o:{a:0,k:0,ix:3},m:1,ix:2,nm:"Trim Paths 1",mn:"ADBE Vector Filter - Trim",hd:!1}],ip:0,op:28,st:0,bm:0},{ddd:0,ind:2,ty:4,nm:"Layer 5 Outlines",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[467.82,115.827,0],ix:2},a:{a:0,k:[26.86,26.859,0],ix:1},s:{a:0,k:[100,100,100],ix:6}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0]],o:[[0,0],[0,0]],v:[[-20.86,20.859],[20.86,-20.859]],c:!1},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"st",c:{a:0,k:[0,.788000009574,.522000002394,1],ix:3},o:{a:0,k:100,ix:4},w:{a:0,k:12,ix:5},lc:1,lj:1,ml:10,nm:"Stroke 1",mn:"ADBE Vector Graphic - Stroke",hd:!1},{ty:"tr",p:{a:0,k:[26.86,26.859],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,ix:1,mn:"ADBE Vector Group",hd:!1},{ty:"tm",s:{a:1,k:[{i:{x:[0],y:[1]},o:{x:[.333],y:[0]},n:["0_1_0p333_0"],t:4,s:[0],e:[100]},{t:22}],ix:1},e:{a:0,k:100,ix:2},o:{a:0,k:0,ix:3},m:1,ix:2,nm:"Trim Paths 1",mn:"ADBE Vector Filter - Trim",hd:!1}],ip:0,op:28,st:0,bm:0},{ddd:0,ind:3,ty:4,nm:"Layer 6 Outlines",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[115.327,116.18,0],ix:2},a:{a:0,k:[26.859,26.859,0],ix:1},s:{a:0,k:[100,100,100],ix:6}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0]],o:[[0,0],[0,0]],v:[[-20.859,-20.86],[20.859,20.86]],c:!1},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"st",c:{a:0,k:[0,.788000009574,.522000002394,1],ix:3},o:{a:0,k:100,ix:4},w:{a:0,k:12,ix:5},lc:1,lj:1,ml:10,nm:"Stroke 1",mn:"ADBE Vector Graphic - Stroke",hd:!1},{ty:"tr",p:{a:0,k:[26.859,26.86],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,ix:1,mn:"ADBE Vector Group",hd:!1},{ty:"tm",s:{a:0,k:0,ix:1},e:{a:1,k:[{i:{x:[0],y:[1]},o:{x:[.333],y:[0]},n:["0_1_0p333_0"],t:4,s:[100],e:[0]},{t:22}],ix:2},o:{a:0,k:0,ix:3},m:1,ix:2,nm:"Trim Paths 1",mn:"ADBE Vector Filter - Trim",hd:!1}],ip:0,op:28,st:0,bm:0},{ddd:0,ind:4,ty:4,nm:"Layer 7 Outlines",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[468.174,468.32,0],ix:2},a:{a:0,k:[26.86,26.86,0],ix:1},s:{a:0,k:[100,100,100],ix:6}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0]],o:[[0,0],[0,0]],v:[[-20.86,-20.86],[20.86,20.86]],c:!1},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"st",c:{a:0,k:[0,.788000009574,.522000002394,1],ix:3},o:{a:0,k:100,ix:4},w:{a:0,k:12,ix:5},lc:1,lj:1,ml:10,nm:"Stroke 1",mn:"ADBE Vector Graphic - Stroke",hd:!1},{ty:"tr",p:{a:0,k:[26.86,26.86],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,ix:1,mn:"ADBE Vector Group",hd:!1},{ty:"tm",s:{a:1,k:[{i:{x:[0],y:[1]},o:{x:[.333],y:[0]},n:["0_1_0p333_0"],t:4,s:[0],e:[100]},{t:22}],ix:1},e:{a:0,k:100,ix:2},o:{a:0,k:0,ix:3},m:1,ix:2,nm:"Trim Paths 1",mn:"ADBE Vector Filter - Trim",hd:!1}],ip:0,op:28,st:0,bm:0},{ddd:0,ind:5,ty:4,nm:"Layer 8 Outlines",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[42.5,292.5,0],ix:2},a:{a:0,k:[35.5,6,0],ix:1},s:{a:0,k:[100,100,100],ix:6}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0]],o:[[0,0],[0,0]],v:[[6,6],[65,6]],c:!1},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"st",c:{a:0,k:[0,.788000009574,.522000002394,1],ix:3},o:{a:0,k:100,ix:4},w:{a:0,k:12,ix:5},lc:1,lj:1,ml:10,nm:"Stroke 1",mn:"ADBE Vector Graphic - Stroke",hd:!1},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,ix:1,mn:"ADBE Vector Group",hd:!1},{ty:"tm",s:{a:0,k:0,ix:1},e:{a:1,k:[{i:{x:[0],y:[1]},o:{x:[.333],y:[0]},n:["0_1_0p333_0"],t:4,s:[100],e:[0]},{t:22}],ix:2},o:{a:0,k:0,ix:3},m:1,ix:2,nm:"Trim Paths 1",mn:"ADBE Vector Filter - Trim",hd:!1}],ip:0,op:28,st:0,bm:0},{ddd:0,ind:6,ty:4,nm:"Layer 9 Outlines",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[541,292,0],ix:2},a:{a:0,k:[35.5,6,0],ix:1},s:{a:0,k:[100,100,100],ix:6}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0]],o:[[0,0],[0,0]],v:[[6,6],[65,6]],c:!1},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"st",c:{a:0,k:[0,.788000009574,.522000002394,1],ix:3},o:{a:0,k:100,ix:4},w:{a:0,k:12,ix:5},lc:1,lj:1,ml:10,nm:"Stroke 1",mn:"ADBE Vector Graphic - Stroke",hd:!1},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,ix:1,mn:"ADBE Vector Group",hd:!1},{ty:"tm",s:{a:1,k:[{i:{x:[0],y:[1]},o:{x:[.333],y:[0]},n:["0_1_0p333_0"],t:4,s:[0],e:[100]},{t:22}],ix:1},e:{a:0,k:100,ix:2},o:{a:0,k:0,ix:3},m:1,ix:2,nm:"Trim Paths 1",mn:"ADBE Vector Filter - Trim",hd:!1}],ip:0,op:28,st:0,bm:0},{ddd:0,ind:7,ty:4,nm:"Layer 10 Outlines",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[292,541.5,0],ix:2},a:{a:0,k:[6,35.5,0],ix:1},s:{a:0,k:[100,100,100],ix:6}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0]],o:[[0,0],[0,0]],v:[[6,65],[6,6]],c:!1},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"st",c:{a:0,k:[0,.788000009574,.522000002394,1],ix:3},o:{a:0,k:100,ix:4},w:{a:0,k:12,ix:5},lc:1,lj:1,ml:10,nm:"Stroke 1",mn:"ADBE Vector Graphic - Stroke",hd:!1},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,ix:1,mn:"ADBE Vector Group",hd:!1},{ty:"tm",s:{a:0,k:0,ix:1},e:{a:1,k:[{i:{x:[0],y:[1]},o:{x:[.333],y:[0]},n:["0_1_0p333_0"],t:4,s:[100],e:[0]},{t:22}],ix:2},o:{a:0,k:0,ix:3},m:1,ix:2,nm:"Trim Paths 1",mn:"ADBE Vector Filter - Trim",hd:!1}],ip:0,op:28,st:0,bm:0},{ddd:0,ind:8,ty:4,nm:"Layer 11 Outlines",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[291.5,43,0],ix:2},a:{a:0,k:[6,35.5,0],ix:1},s:{a:0,k:[100,100,100],ix:6}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0]],o:[[0,0],[0,0]],v:[[6,65],[6,6]],c:!1},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"st",c:{a:0,k:[0,.788000009574,.522000002394,1],ix:3},o:{a:0,k:100,ix:4},w:{a:0,k:12,ix:5},lc:1,lj:1,ml:10,nm:"Stroke 1",mn:"ADBE Vector Graphic - Stroke",hd:!1},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,ix:1,mn:"ADBE Vector Group",hd:!1},{ty:"tm",s:{a:1,k:[{i:{x:[0],y:[1]},o:{x:[.333],y:[0]},n:["0_1_0p333_0"],t:4,s:[0],e:[100]},{t:22}],ix:1},e:{a:0,k:100,ix:2},o:{a:0,k:0,ix:3},m:1,ix:2,nm:"Trim Paths 1",mn:"ADBE Vector Filter - Trim",hd:!1}],ip:0,op:28,st:0,bm:0}]}],layers=[{ddd:0,ind:1,ty:4,nm:"Shape Layer 2",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[300,300,0],ix:2},a:{a:0,k:[0,0,0],ix:1},s:{a:0,k:[100,100,100],ix:6}},ao:0,shapes:[{ty:"gr",it:[{d:1,ty:"el",s:{a:0,k:[367.859,367.859],ix:2},p:{a:0,k:[0,0],ix:3},nm:"Ellipse Path 1",mn:"ADBE Vector Shape - Ellipse",hd:!1},{ty:"tm",s:{a:1,k:[{i:{x:[0],y:[1]},o:{x:[.333],y:[0]},n:["0_1_0p333_0"],t:25,s:[0],e:[0]},{i:{x:[.089],y:[1]},o:{x:[.655],y:[0]},n:["0p089_1_0p655_0"],t:36,s:[0],e:[100]},{t:50}],ix:1},e:{a:1,k:[{i:{x:[.333],y:[1]},o:{x:[.829],y:[0]},n:["0p333_1_0p829_0"],t:25,s:[0],e:[100]},{t:39}],ix:2},o:{a:0,k:0,ix:3},m:1,ix:2,nm:"Trim Paths 1",mn:"ADBE Vector Filter - Trim",hd:!1},{ty:"st",c:{a:0,k:[.893382352941,.893382352941,.893382352941,1],ix:3},o:{a:0,k:100,ix:4},w:{a:0,k:20,ix:5},lc:1,lj:1,ml:4,nm:"Stroke 1",mn:"ADBE Vector Graphic - Stroke",hd:!1},{ty:"tr",p:{a:0,k:[1.93,-10.07],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Ellipse 1",np:4,cix:2,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:25,op:50,st:25,bm:0},{ddd:0,ind:2,ty:4,nm:"Shape Layer 1",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[300,300,0],ix:2},a:{a:0,k:[0,0,0],ix:1},s:{a:0,k:[100,100,100],ix:6}},ao:0,shapes:[{ty:"gr",it:[{d:1,ty:"el",s:{a:0,k:[367.859,367.859],ix:2},p:{a:0,k:[0,0],ix:3},nm:"Ellipse Path 1",mn:"ADBE Vector Shape - Ellipse",hd:!1},{ty:"tm",s:{a:1,k:[{i:{x:[0],y:[1]},o:{x:[.333],y:[0]},n:["0_1_0p333_0"],t:0,s:[0],e:[0]},{i:{x:[.089],y:[1]},o:{x:[.655],y:[0]},n:["0p089_1_0p655_0"],t:11,s:[0],e:[100]},{t:25}],ix:1},e:{a:1,k:[{i:{x:[.333],y:[1]},o:{x:[.829],y:[0]},n:["0p333_1_0p829_0"],t:0,s:[0],e:[100]},{t:14}],ix:2},o:{a:0,k:0,ix:3},m:1,ix:2,nm:"Trim Paths 1",mn:"ADBE Vector Filter - Trim",hd:!1},{ty:"st",c:{a:0,k:[.893382352941,.893382352941,.893382352941,1],ix:3},o:{a:0,k:100,ix:4},w:{a:0,k:20,ix:5},lc:1,lj:1,ml:4,nm:"Stroke 1",mn:"ADBE Vector Graphic - Stroke",hd:!1},{ty:"tr",p:{a:0,k:[1.93,-10.07],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Ellipse 1",np:4,cix:2,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:0,op:25,st:0,bm:0},{ddd:0,ind:3,ty:0,nm:"Pre-comp 1",refId:"comp_0",sr:1,ks:{o:{a:1,k:[{i:{x:[.833],y:[.833]},o:{x:[.167],y:[.167]},n:["0p833_0p833_0p167_0p167"],t:54,s:[0],e:[100]},{i:{x:[.833],y:[.833]},o:{x:[.167],y:[.167]},n:["0p833_0p833_0p167_0p167"],t:56,s:[100],e:[100]},{t:62}],ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[300,300,0],ix:2},a:{a:0,k:[300,300,0],ix:1},s:{a:1,k:[{i:{x:[.833,.833,.833],y:[.833,.833,.833]},o:{x:[.167,.167,.167],y:[.167,.167,.167]},n:["0p833_0p833_0p167_0p167","0p833_0p833_0p167_0p167","0p833_0p833_0p167_0p167"],t:54,s:[86,86,100],e:[94,94,100]},{t:62}],ix:6}},ao:0,w:600,h:600,ip:54,op:354,st:54,bm:0},{ddd:0,ind:4,ty:4,nm:"Layer 2 Outlines",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[300,300,0],ix:2},a:{a:0,k:[137.378,109.309,0],ix:1},s:{a:0,k:[100,100,100],ix:6}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0]],v:[[-84.878,.669],[-28.738,56.809],[84.878,-56.809]],c:!1},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"st",c:{a:0,k:[1,1,1,1],ix:3},o:{a:0,k:100,ix:4},w:{a:0,k:21,ix:5},lc:1,lj:1,ml:10,nm:"Stroke 1",mn:"ADBE Vector Graphic - Stroke",hd:!1},{ty:"tr",p:{a:0,k:[137.378,109.308],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,ix:1,mn:"ADBE Vector Group",hd:!1},{ty:"tm",s:{a:1,k:[{i:{x:[.185],y:[1]},o:{x:[.333],y:[0]},n:["0p185_1_0p333_0"],t:59,s:[0],e:[6]},{i:{x:[.306],y:[1]},o:{x:[.333],y:[0]},n:["0p306_1_0p333_0"],t:62,s:[6],e:[0]},{t:66}],ix:1},e:{a:1,k:[{i:{x:[.35],y:[1]},o:{x:[.333],y:[0]},n:["0p35_1_0p333_0"],t:54,s:[0],e:[100]},{i:{x:[.032],y:[1]},o:{x:[.333],y:[0]},n:["0p032_1_0p333_0"],t:62,s:[100],e:[94]},{t:66}],ix:2},o:{a:0,k:0,ix:3},m:1,ix:2,nm:"Trim Paths 1",mn:"ADBE Vector Filter - Trim",hd:!1}],ip:54,op:354,st:54,bm:0},{ddd:0,ind:5,ty:4,nm:"Layer 1 Outlines",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[299.988,299.91,0],ix:2},a:{a:0,k:[190.878,189.014,0],ix:1},s:{a:1,k:[{i:{x:[.046,.046,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},n:["0p046_1_0p333_0","0p046_1_0p333_0","0p667_1_0p333_0"],t:50,s:[0,0,100],e:[116,116,100]},{i:{x:[.019,.019,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[.032,.032,0]},n:["0p019_1_0p333_0p032","0p019_1_0p333_0p032","0p667_1_0p333_0"],t:61,s:[116,116,100],e:[100,100,100]},{t:67}],ix:6}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-4.067,-3.573],[0,0],[-2.665,-.588],[0,0],[-1.937,-5.043],[0,0],[-2.087,-1.753],[0,0],[.635,-5.357],[0,0],[-1.033,-2.517],[0,0],[3.063,-4.444],[0,0],[.259,-2.704],[0,0],[4.789,-2.513],[0,0],[1.492,-2.273],[0,0],[5.418,-.007],[0,0],[2.383,-1.32],[0,0],[4.806,2.501],[0,0],[2.727,-.064],[0,0],[3.093,4.437],[0,0],[2.448,1.205],[0,0],[.67,5.356],[0,0],[1.607,2.198],[0,0],[-1.904,5.047],[0,0],[.399,2.689],[0,0],[-4.043,3.583],[0,0],[-.901,2.564],[0,0],[-5.257,1.298],[0,0],[-1.995,1.85],[0,0],[-5.265,-1.284],[0,0],[-2.632,.713],[0,0]],o:[[0,0],[2.049,1.8],[0,0],[5.292,1.166],[0,0],[.976,2.539],[0,0],[4.146,3.481],[0,0],[-.32,2.698],[0,0],[2.05,4.998],[0,0],[-1.542,2.239],[0,0],[-.514,5.372],[0,0],[-2.412,1.266],[0,0],[-2.961,4.512],[0,0],[-2.728,.003],[0,0],[-4.73,2.62],[0,0],[-2.42,-1.26],[0,0],[-5.416,.129],[0,0],[-1.557,-2.233],[0,0],[-4.861,-2.393],[0,0],[-.338,-2.697],[0,0],[-3.192,-4.367],[0,0],[.959,-2.542],[0,0],[-.792,-5.339],[0,0],[2.036,-1.805],[0,0],[1.789,-5.09],[0,0],[2.647,-.653],[0,0],[3.961,-3.674],[0,0],[2.651,.646],[0,0],[5.226,-1.416]],v:[[49.728,-183.893],[75.948,-160.861],[83.134,-157.221],[117.251,-149.704],[128.834,-139.758],[141.329,-107.249],[146,-100.704],[172.734,-78.264],[178.36,-64.104],[174.265,-29.568],[175.352,-21.617],[188.578,10.606],[186.957,25.734],[167.211,54.389],[164.465,61.924],[161.152,96.546],[152.657,109.178],[121.785,125.385],[115.833,130.78],[96.742,159.871],[83.317,167.112],[48.39,167.159],[40.598,169.176],[10.101,186.072],[-5.177,186.263],[-36.157,170.138],[-44.005,168.317],[-78.921,169.146],[-92.553,162.244],[-112.489,133.642],[-118.596,128.399],[-149.931,112.972],[-158.793,100.558],[-163.119,66.033],[-166.084,58.567],[-186.661,30.418],[-188.724,15.336],[-176.447,-17.206],[-175.593,-25.182],[-180.697,-59.604],[-175.488,-73.898],[-149.422,-97.001],[-144.943,-103.66],[-133.405,-136.47],[-122.117,-146.703],[-88.233,-155.074],[-81.156,-158.891],[-55.62,-182.572],[-40.839,-186.4],[-6.899,-178.12],[1.156,-178.22],[34.84,-187.349]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[0,.788000009574,.522000002394,1],ix:4},o:{a:0,k:100,ix:5},r:1,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[190.878,189.015],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:50,op:350,st:50,bm:0}],markers=[],successAnimation={v,fr,ip,op,w,h,nm,ddd,assets,layers,markers};function OrderSuccessPage(){const e=useNavigate(),i=reactExports.useRef(null);return reactExports.useEffect(()=>{i.current&&i.current.setSpeed(.8)},[]),jsxRuntimeExports.jsx("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gradient-to-b from-green-50 to-white px-4",children:jsxRuntimeExports.jsxs(motion.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.5},className:"w-full max-w-md flex flex-col items-center text-center",children:[jsxRuntimeExports.jsx("div",{className:"w-64 h-64",children:jsxRuntimeExports.jsx(Lottie,{lottieRef:i,animationData:successAnimation,loop:!1})}),jsxRuntimeExports.jsx(motion.h1,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.3},className:"text-2xl font-bold text-foreground mt-4 mb-2",children:"Order Placed!"}),jsxRuntimeExports.jsx(motion.p,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.4},className:"text-muted-foreground mb-8",children:"Your order has been placed successfully and sent to the kitchen."}),jsxRuntimeExports.jsxs(motion.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.5},className:"w-full space-y-3",children:[jsxRuntimeExports.jsx(Button,{onClick:()=>e("/orders"),className:"w-full gradient-primary text-primary-foreground py-6 rounded-xl font-semibold shadow-elevated",children:"View Order Status"}),jsxRuntimeExports.jsx(Button,{variant:"ghost",onClick:()=>e("/"),className:"w-full",children:"Back to Home"})]})]})})}function toDate(e){const i=Object.prototype.toString.call(e);return e instanceof Date||typeof e=="object"&&i==="[object Date]"?new e.constructor(+e):typeof e=="number"||i==="[object Number]"||typeof e=="string"||i==="[object String]"?new Date(e):new Date(NaN)}function constructFrom(e,i){return e instanceof Date?new e.constructor(i):new Date(i)}const minutesInMonth=43200,minutesInDay=1440;let defaultOptions={};function getDefaultOptions(){return defaultOptions}function getTimezoneOffsetInMilliseconds(e){const i=toDate(e),s=new Date(Date.UTC(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds(),i.getMilliseconds()));return s.setUTCFullYear(i.getFullYear()),+e-+s}function compareAsc(e,i){const s=toDate(e),a=toDate(i),_=s.getTime()-a.getTime();return _<0?-1:_>0?1:_}function constructNow(e){return constructFrom(e,Date.now())}function differenceInCalendarMonths(e,i){const s=toDate(e),a=toDate(i),_=s.getFullYear()-a.getFullYear(),$=s.getMonth()-a.getMonth();return _*12+$}function getRoundingMethod(e){return i=>{const a=(e?Math[e]:Math.trunc)(i);return a===0?0:a}}function differenceInMilliseconds(e,i){return+toDate(e)-+toDate(i)}function endOfDay(e){const i=toDate(e);return i.setHours(23,59,59,999),i}function endOfMonth(e){const i=toDate(e),s=i.getMonth();return i.setFullYear(i.getFullYear(),s+1,0),i.setHours(23,59,59,999),i}function isLastDayOfMonth(e){const i=toDate(e);return+endOfDay(i)==+endOfMonth(i)}function differenceInMonths(e,i){const s=toDate(e),a=toDate(i),_=compareAsc(s,a),$=Math.abs(differenceInCalendarMonths(s,a));let rt;if($<1)rt=0;else{s.getMonth()===1&&s.getDate()>27&&s.setDate(30),s.setMonth(s.getMonth()-_*$);let c=compareAsc(s,a)===-_;isLastDayOfMonth(toDate(e))&&$===1&&compareAsc(e,a)===1&&(c=!1),rt=_*($-Number(c))}return rt===0?0:rt}function differenceInSeconds(e,i,s){const a=differenceInMilliseconds(e,i)/1e3;return getRoundingMethod(s==null?void 0:s.roundingMethod)(a)}const formatDistanceLocale={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},formatDistance$1=(e,i,s)=>{let a;const _=formatDistanceLocale[e];return typeof _=="string"?a=_:i===1?a=_.one:a=_.other.replace("{{count}}",i.toString()),s!=null&&s.addSuffix?s.comparison&&s.comparison>0?"in "+a:a+" ago":a};function buildFormatLongFn(e){return(i={})=>{const s=i.width?String(i.width):e.defaultWidth;return e.formats[s]||e.formats[e.defaultWidth]}}const dateFormats={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},timeFormats={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},dateTimeFormats={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},formatLong={date:buildFormatLongFn({formats:dateFormats,defaultWidth:"full"}),time:buildFormatLongFn({formats:timeFormats,defaultWidth:"full"}),dateTime:buildFormatLongFn({formats:dateTimeFormats,defaultWidth:"full"})},formatRelativeLocale={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},formatRelative=(e,i,s,a)=>formatRelativeLocale[e];function buildLocalizeFn(e){return(i,s)=>{const a=s!=null&&s.context?String(s.context):"standalone";let _;if(a==="formatting"&&e.formattingValues){const rt=e.defaultFormattingWidth||e.defaultWidth,c=s!=null&&s.width?String(s.width):rt;_=e.formattingValues[c]||e.formattingValues[rt]}else{const rt=e.defaultWidth,c=s!=null&&s.width?String(s.width):e.defaultWidth;_=e.values[c]||e.values[rt]}const $=e.argumentCallback?e.argumentCallback(i):i;return _[$]}}const eraValues={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},quarterValues={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},monthValues={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},dayValues={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},dayPeriodValues={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},formattingDayPeriodValues={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},ordinalNumber=(e,i)=>{const s=Number(e),a=s%100;if(a>20||a<10)switch(a%10){case 1:return s+"st";case 2:return s+"nd";case 3:return s+"rd"}return s+"th"},localize={ordinalNumber,era:buildLocalizeFn({values:eraValues,defaultWidth:"wide"}),quarter:buildLocalizeFn({values:quarterValues,defaultWidth:"wide",argumentCallback:e=>e-1}),month:buildLocalizeFn({values:monthValues,defaultWidth:"wide"}),day:buildLocalizeFn({values:dayValues,defaultWidth:"wide"}),dayPeriod:buildLocalizeFn({values:dayPeriodValues,defaultWidth:"wide",formattingValues:formattingDayPeriodValues,defaultFormattingWidth:"wide"})};function buildMatchFn(e){return(i,s={})=>{const a=s.width,_=a&&e.matchPatterns[a]||e.matchPatterns[e.defaultMatchWidth],$=i.match(_);if(!$)return null;const rt=$[0],c=a&&e.parsePatterns[a]||e.parsePatterns[e.defaultParseWidth],dt=Array.isArray(c)?findIndex(c,St=>St.test(rt)):findKey(c,St=>St.test(rt));let ht;ht=e.valueCallback?e.valueCallback(dt):dt,ht=s.valueCallback?s.valueCallback(ht):ht;const Et=i.slice(rt.length);return{value:ht,rest:Et}}}function findKey(e,i){for(const s in e)if(Object.prototype.hasOwnProperty.call(e,s)&&i(e[s]))return s}function findIndex(e,i){for(let s=0;s<e.length;s++)if(i(e[s]))return s}function buildMatchPatternFn(e){return(i,s={})=>{const a=i.match(e.matchPattern);if(!a)return null;const _=a[0],$=i.match(e.parsePattern);if(!$)return null;let rt=e.valueCallback?e.valueCallback($[0]):$[0];rt=s.valueCallback?s.valueCallback(rt):rt;const c=i.slice(_.length);return{value:rt,rest:c}}}const matchOrdinalNumberPattern=/^(\d+)(th|st|nd|rd)?/i,parseOrdinalNumberPattern=/\d+/i,matchEraPatterns={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},parseEraPatterns={any:[/^b/i,/^(a|c)/i]},matchQuarterPatterns={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},parseQuarterPatterns={any:[/1/i,/2/i,/3/i,/4/i]},matchMonthPatterns={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},parseMonthPatterns={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},matchDayPatterns={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},parseDayPatterns={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},matchDayPeriodPatterns={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},parseDayPeriodPatterns={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},match={ordinalNumber:buildMatchPatternFn({matchPattern:matchOrdinalNumberPattern,parsePattern:parseOrdinalNumberPattern,valueCallback:e=>parseInt(e,10)}),era:buildMatchFn({matchPatterns:matchEraPatterns,defaultMatchWidth:"wide",parsePatterns:parseEraPatterns,defaultParseWidth:"any"}),quarter:buildMatchFn({matchPatterns:matchQuarterPatterns,defaultMatchWidth:"wide",parsePatterns:parseQuarterPatterns,defaultParseWidth:"any",valueCallback:e=>e+1}),month:buildMatchFn({matchPatterns:matchMonthPatterns,defaultMatchWidth:"wide",parsePatterns:parseMonthPatterns,defaultParseWidth:"any"}),day:buildMatchFn({matchPatterns:matchDayPatterns,defaultMatchWidth:"wide",parsePatterns:parseDayPatterns,defaultParseWidth:"any"}),dayPeriod:buildMatchFn({matchPatterns:matchDayPeriodPatterns,defaultMatchWidth:"any",parsePatterns:parseDayPeriodPatterns,defaultParseWidth:"any"})},enUS={code:"en-US",formatDistance:formatDistance$1,formatLong,formatRelative,localize,match,options:{weekStartsOn:0,firstWeekContainsDate:1}};function formatDistance(e,i,s){const a=getDefaultOptions(),_=(s==null?void 0:s.locale)??a.locale??enUS,$=2520,rt=compareAsc(e,i);if(isNaN(rt))throw new RangeError("Invalid time value");const c=Object.assign({},s,{addSuffix:s==null?void 0:s.addSuffix,comparison:rt});let dt,ht;rt>0?(dt=toDate(i),ht=toDate(e)):(dt=toDate(e),ht=toDate(i));const Et=differenceInSeconds(ht,dt),St=(getTimezoneOffsetInMilliseconds(ht)-getTimezoneOffsetInMilliseconds(dt))/1e3,At=Math.round((Et-St)/60);let Pt;if(At<2)return s!=null&&s.includeSeconds?Et<5?_.formatDistance("lessThanXSeconds",5,c):Et<10?_.formatDistance("lessThanXSeconds",10,c):Et<20?_.formatDistance("lessThanXSeconds",20,c):Et<40?_.formatDistance("halfAMinute",0,c):Et<60?_.formatDistance("lessThanXMinutes",1,c):_.formatDistance("xMinutes",1,c):At===0?_.formatDistance("lessThanXMinutes",1,c):_.formatDistance("xMinutes",At,c);if(At<45)return _.formatDistance("xMinutes",At,c);if(At<90)return _.formatDistance("aboutXHours",1,c);if(At<minutesInDay){const Vt=Math.round(At/60);return _.formatDistance("aboutXHours",Vt,c)}else{if(At<$)return _.formatDistance("xDays",1,c);if(At<minutesInMonth){const Vt=Math.round(At/minutesInDay);return _.formatDistance("xDays",Vt,c)}else if(At<minutesInMonth*2)return Pt=Math.round(At/minutesInMonth),_.formatDistance("aboutXMonths",Pt,c)}if(Pt=differenceInMonths(ht,dt),Pt<12){const Vt=Math.round(At/minutesInMonth);return _.formatDistance("xMonths",Vt,c)}else{const Vt=Pt%12,Bt=Math.trunc(Pt/12);return Vt<3?_.formatDistance("aboutXYears",Bt,c):Vt<9?_.formatDistance("overXYears",Bt,c):_.formatDistance("almostXYears",Bt+1,c)}}function formatDistanceToNow(e,i){return formatDistance(e,constructNow(e),i)}function NotificationsPage(){const{user:e}=useAuth(),{notifications:i,loading:s}=useNotifications(e==null?void 0:e.id),a=useNavigate(),_=async $=>{$.read||await markNotificationAsRead($.id),$.link&&a($.link)};return s?jsxRuntimeExports.jsx(LoadingAnimation,{}):e?jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-32",children:[jsxRuntimeExports.jsxs("header",{className:"sticky top-0 z-40 bg-card/95 backdrop-blur-lg border-b border-border px-4 py-4 flex items-center gap-3 safe-top",children:[jsxRuntimeExports.jsx(Link,{to:"/",children:jsxRuntimeExports.jsx(Button,{variant:"ghost",size:"icon",className:"h-9 w-9 -ml-2 rounded-full hover:bg-muted",children:jsxRuntimeExports.jsx(ArrowLeft,{className:"w-5 h-5 text-foreground"})})}),jsxRuntimeExports.jsx("h1",{className:"text-xl font-bold text-foreground",children:"Notifications"})]}),jsxRuntimeExports.jsx("div",{className:"px-4 py-4 space-y-3",children:i.length===0?jsxRuntimeExports.jsxs("div",{className:"text-center py-12",children:[jsxRuntimeExports.jsx(Bell,{className:"w-12 h-12 text-muted-foreground mx-auto mb-3"}),jsxRuntimeExports.jsx("p",{className:"text-muted-foreground",children:"No notifications yet"})]}):i.map(($,rt)=>jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:rt*.05},onClick:()=>_($),className:cn("p-4 rounded-xl cursor-pointer transition-all relative overflow-hidden",$.read?"bg-card border border-border":"bg-card shadow-soft border border-primary/20 bg-primary/5"),children:[jsxRuntimeExports.jsxs("div",{className:"flex gap-4",children:[jsxRuntimeExports.jsx("div",{className:cn("w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0",$.type==="order"?"bg-blue-100 text-blue-600 dark:bg-blue-900/30 dark:text-blue-400":"bg-gray-100 text-gray-600 dark:bg-muted dark:text-muted-foreground"),children:$.type==="order"?jsxRuntimeExports.jsx(Package,{className:"w-5 h-5"}):jsxRuntimeExports.jsx(Info,{className:"w-5 h-5"})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-start mb-1",children:[jsxRuntimeExports.jsx("h3",{className:cn("text-base",$.read?"font-medium text-foreground/80":"font-bold text-foreground"),children:$.title}),jsxRuntimeExports.jsx("span",{className:"text-xs text-muted-foreground whitespace-nowrap ml-2",children:formatDistanceToNow($.createdAt,{addSuffix:!0})})]}),jsxRuntimeExports.jsx("p",{className:cn("text-sm leading-relaxed line-clamp-2",$.read?"text-muted-foreground":"text-foreground/90"),children:$.message})]})]}),!$.read&&jsxRuntimeExports.jsx("div",{className:"absolute top-4 right-2 w-2 h-2 rounded-full bg-primary animate-pulse"})]},$.id))}),jsxRuntimeExports.jsx(BottomNav,{})]}):jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background flex flex-col items-center justify-center px-4 pb-24",children:[jsxRuntimeExports.jsx(Bell,{className:"w-16 h-16 text-muted-foreground mb-4"}),jsxRuntimeExports.jsx("p",{className:"text-muted-foreground mb-4",children:"Please login to view notifications"}),jsxRuntimeExports.jsx(Link,{to:"/auth",children:jsxRuntimeExports.jsx(Button,{className:"gradient-primary text-primary-foreground",children:"Login"})}),jsxRuntimeExports.jsx(BottomNav,{})]})}function ScrollToTop(){const{pathname:e}=useLocation();return reactExports.useEffect(()=>{window.scrollTo(0,0)},[e]),null}function NotificationListener(){const{user:e}=useAuth(),{notifications:i}=useNotifications(e==null?void 0:e.id),s=reactExports.useRef(Date.now()),a=useNavigate();return reactExports.useEffect(()=>{if(!e)return;const _=i.filter($=>$.createdAt>s.current&&!$.read);if(_.length>0){_.forEach(rt=>{ue(rt.title||"New Notification",{description:rt.message,action:rt.link?{label:"View",onClick:()=>a(rt.link)}:void 0})});const $=Math.max(..._.map(rt=>rt.createdAt));s.current=$}},[i,e,a]),null}const queryClient=new QueryClient;function SplashScreen({onFinish:e}){return reactExports.useEffect(()=>{const i=setTimeout(()=>{e()},3e3);return()=>clearTimeout(i)},[e]),jsxRuntimeExports.jsx("div",{className:"w-full h-full",children:jsxRuntimeExports.jsx(LoadingAnimation,{message:"Welcome to Amma Cheythi Vanta..."})})}const AppRoutes=()=>{const[e,i]=reactExports.useState(!0);return e?jsxRuntimeExports.jsx(SplashScreen,{onFinish:()=>i(!1)}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(ScrollToTop,{}),jsxRuntimeExports.jsxs(Routes,{children:[jsxRuntimeExports.jsx(Route,{path:"/",element:jsxRuntimeExports.jsx(HomePage,{})}),jsxRuntimeExports.jsx(Route,{path:"/kitchen/:id",element:jsxRuntimeExports.jsx(KitchenPage,{})}),jsxRuntimeExports.jsx(Route,{path:"/cart",element:jsxRuntimeExports.jsx(CartPage,{})}),jsxRuntimeExports.jsx(Route,{path:"/checkout",element:jsxRuntimeExports.jsx(CheckoutPage,{})}),jsxRuntimeExports.jsx(Route,{path:"/auth",element:jsxRuntimeExports.jsx(AuthPage,{})}),jsxRuntimeExports.jsx(Route,{path:"/profile",element:jsxRuntimeExports.jsx(ProfilePage,{})}),jsxRuntimeExports.jsx(Route,{path:"/settings",element:jsxRuntimeExports.jsx(SettingsPage,{})}),jsxRuntimeExports.jsx(Route,{path:"/help",element:jsxRuntimeExports.jsx(HelpSupportPage,{})}),jsxRuntimeExports.jsx(Route,{path:"/search",element:jsxRuntimeExports.jsx(SearchPage,{})}),jsxRuntimeExports.jsx(Route,{path:"/orders",element:jsxRuntimeExports.jsx(OrdersPage,{})}),jsxRuntimeExports.jsx(Route,{path:"/notifications",element:jsxRuntimeExports.jsx(NotificationsPage,{})}),jsxRuntimeExports.jsx(Route,{path:"/order-success",element:jsxRuntimeExports.jsx(OrderSuccessPage,{})}),jsxRuntimeExports.jsx(Route,{path:"/favorites",element:jsxRuntimeExports.jsx(FavoritesPage,{})}),jsxRuntimeExports.jsx(Route,{path:"/addresses",element:jsxRuntimeExports.jsx(SavedAddressesPage,{})}),jsxRuntimeExports.jsx(Route,{path:"/amma/dashboard",element:jsxRuntimeExports.jsx(AmmaRouteWrapper,{children:jsxRuntimeExports.jsx(AmmaDashboard,{})})}),jsxRuntimeExports.jsx(Route,{path:"/amma/register",element:jsxRuntimeExports.jsx(AmmaRouteWrapper,{children:jsxRuntimeExports.jsx(RegisterKitchen,{})})}),jsxRuntimeExports.jsx(Route,{path:"/amma/add-dish",element:jsxRuntimeExports.jsx(AmmaRouteWrapper,{children:jsxRuntimeExports.jsx(AddDish,{})})}),jsxRuntimeExports.jsx(Route,{path:"/amma/edit-dish/:dishId",element:jsxRuntimeExports.jsx(AmmaRouteWrapper,{children:jsxRuntimeExports.jsx(AddDish,{})})}),jsxRuntimeExports.jsx(Route,{path:"/amma/edit-kitchen/:kitchenId",element:jsxRuntimeExports.jsx(AmmaRouteWrapper,{children:jsxRuntimeExports.jsx(EditKitchen,{})})}),jsxRuntimeExports.jsx(Route,{path:"/admin",element:jsxRuntimeExports.jsx(AdminDashboard,{})}),jsxRuntimeExports.jsx(Route,{path:"/franchise-admin",element:jsxRuntimeExports.jsx(FranchiseAdminDashboard,{})}),jsxRuntimeExports.jsx(Route,{path:"/super-admin",element:jsxRuntimeExports.jsx(SuperAdminDashboard,{})}),jsxRuntimeExports.jsx(Route,{path:"/location-select",element:jsxRuntimeExports.jsx(LocationSelectionPage,{})}),jsxRuntimeExports.jsx(Route,{path:"/coupons",element:jsxRuntimeExports.jsx(CouponsPage,{})}),jsxRuntimeExports.jsx(Route,{path:"*",element:jsxRuntimeExports.jsx(NotFound,{})})]})]})},App=()=>jsxRuntimeExports.jsx(QueryClientProvider,{client:queryClient,children:jsxRuntimeExports.jsx(AuthProvider,{children:jsxRuntimeExports.jsx(LocationProvider,{children:jsxRuntimeExports.jsx(DataProvider,{children:jsxRuntimeExports.jsx(CartProvider,{children:jsxRuntimeExports.jsx(TooltipProvider,{children:jsxRuntimeExports.jsxs(BrowserRouter,{basename:"/ammacheythivantalive",children:[jsxRuntimeExports.jsx(Toaster$1,{}),jsxRuntimeExports.jsx(Toaster,{}),jsxRuntimeExports.jsx(NotificationListener,{}),jsxRuntimeExports.jsx(AppRoutes,{})]})})})})})})});createRoot(document.getElementById("root")).render(jsxRuntimeExports.jsx(App,{}));
